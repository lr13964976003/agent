// Tensor Parallelism (8) + Pipeline Parallelism (2)
digraph Helix_Baseline_Method {
	rankdir=TB size="20,20"
	node [fontsize=10]
	input [label="Input\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, hidden=4096]" fillcolor=lightblue shape=ellipse style=filled]
	stage0_label [label="STAGE 0 - Devices 0-7" shape=plaintext]
	s0_tp0_q_proj [label="S0 Q TP0\nGPU 0\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp0_k_proj [label="S0 K TP0\nGPU 0\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp0_v_proj [label="S0 V TP0\nGPU 0\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp0_attn [label="S0 Attn TP0\nGPU 0\nMulti-head slice\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgreen shape=rectangle style=filled]
	s0_tp0_mlp1 [label="S0 MLP1 TP0\nGPU 0\nColumn parallel\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, ffn=1024]" fillcolor=lightcoral shape=rectangle style=filled]
	s0_tp0_mlp2 [label="S0 MLP2 TP0\nGPU 0\nRow parallel\nInput: [batch=128, seq_len=10000, ffn=1024]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightcoral shape=rectangle style=filled]
	s0_tp0_residual [label="S0 Residual TP0\nGPU 0\nAdd & Norm\nInput: 2×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgray shape=parallelogram style=filled]
	s0_tp0_q_proj -> s0_tp0_attn
	s0_tp0_k_proj -> s0_tp0_attn
	s0_tp0_v_proj -> s0_tp0_attn
	s0_tp0_attn -> s0_tp0_mlp1
	s0_tp0_mlp1 -> s0_tp0_mlp2
	s0_tp0_mlp2 -> s0_tp0_residual
	input -> s0_tp0_q_proj
	input -> s0_tp0_k_proj
	input -> s0_tp0_v_proj
	s0_tp1_q_proj [label="S0 Q TP1\nGPU 1\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp1_k_proj [label="S0 K TP1\nGPU 1\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp1_v_proj [label="S0 V TP1\nGPU 1\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp1_attn [label="S0 Attn TP1\nGPU 1\nMulti-head slice\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgreen shape=rectangle style=filled]
	s0_tp1_mlp1 [label="S0 MLP1 TP1\nGPU 1\nColumn parallel\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, ffn=1024]" fillcolor=lightcoral shape=rectangle style=filled]
	s0_tp1_mlp2 [label="S0 MLP2 TP1\nGPU 1\nRow parallel\nInput: [batch=128, seq_len=10000, ffn=1024]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightcoral shape=rectangle style=filled]
	s0_tp1_residual [label="S0 Residual TP1\nGPU 1\nAdd & Norm\nInput: 2×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgray shape=parallelogram style=filled]
	s0_tp1_q_proj -> s0_tp1_attn
	s0_tp1_k_proj -> s0_tp1_attn
	s0_tp1_v_proj -> s0_tp1_attn
	s0_tp1_attn -> s0_tp1_mlp1
	s0_tp1_mlp1 -> s0_tp1_mlp2
	s0_tp1_mlp2 -> s0_tp1_residual
	input -> s0_tp1_q_proj
	input -> s0_tp1_k_proj
	input -> s0_tp1_v_proj
	s0_tp2_q_proj [label="S0 Q TP2\nGPU 2\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp2_k_proj [label="S0 K TP2\nGPU 2\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp2_v_proj [label="S0 V TP2\nGPU 2\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp2_attn [label="S0 Attn TP2\nGPU 2\nMulti-head slice\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgreen shape=rectangle style=filled]
	s0_tp2_mlp1 [label="S0 MLP1 TP2\nGPU 2\nColumn parallel\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, ffn=1024]" fillcolor=lightcoral shape=rectangle style=filled]
	s0_tp2_mlp2 [label="S0 MLP2 TP2\nGPU 2\nRow parallel\nInput: [batch=128, seq_len=10000, ffn=1024]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightcoral shape=rectangle style=filled]
	s0_tp2_residual [label="S0 Residual TP2\nGPU 2\nAdd & Norm\nInput: 2×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgray shape=parallelogram style=filled]
	s0_tp2_q_proj -> s0_tp2_attn
	s0_tp2_k_proj -> s0_tp2_attn
	s0_tp2_v_proj -> s0_tp2_attn
	s0_tp2_attn -> s0_tp2_mlp1
	s0_tp2_mlp1 -> s0_tp2_mlp2
	s0_tp2_mlp2 -> s0_tp2_residual
	input -> s0_tp2_q_proj
	input -> s0_tp2_k_proj
	input -> s0_tp2_v_proj
	s0_tp3_q_proj [label="S0 Q TP3\nGPU 3\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp3_k_proj [label="S0 K TP3\nGPU 3\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp3_v_proj [label="S0 V TP3\nGPU 3\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp3_attn [label="S0 Attn TP3\nGPU 3\nMulti-head slice\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgreen shape=rectangle style=filled]
	s0_tp3_mlp1 [label="S0 MLP1 TP3\nGPU 3\nColumn parallel\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, ffn=1024]" fillcolor=lightcoral shape=rectangle style=filled]
	s0_tp3_mlp2 [label="S0 MLP2 TP3\nGPU 3\nRow parallel\nInput: [batch=128, seq_len=10000, ffn=1024]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightcoral shape=rectangle style=filled]
	s0_tp3_residual [label="S0 Residual TP3\nGPU 3\nAdd & Norm\nInput: 2×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgray shape=parallelogram style=filled]
	s0_tp3_q_proj -> s0_tp3_attn
	s0_tp3_k_proj -> s0_tp3_attn
	s0_tp3_v_proj -> s0_tp3_attn
	s0_tp3_attn -> s0_tp3_mlp1
	s0_tp3_mlp1 -> s0_tp3_mlp2
	s0_tp3_mlp2 -> s0_tp3_residual
	input -> s0_tp3_q_proj
	input -> s0_tp3_k_proj
	input -> s0_tp3_v_proj
	s0_tp4_q_proj [label="S0 Q TP4\nGPU 4\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp4_k_proj [label="S0 K TP4\nGPU 4\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp4_v_proj [label="S0 V TP4\nGPU 4\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp4_attn [label="S0 Attn TP4\nGPU 4\nMulti-head slice\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgreen shape=rectangle style=filled]
	s0_tp4_mlp1 [label="S0 MLP1 TP4\nGPU 4\nColumn parallel\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, ffn=1024]" fillcolor=lightcoral shape=rectangle style=filled]
	s0_tp4_mlp2 [label="S0 MLP2 TP4\nGPU 4\nRow parallel\nInput: [batch=128, seq_len=10000, ffn=1024]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightcoral shape=rectangle style=filled]
	s0_tp4_residual [label="S0 Residual TP4\nGPU 4\nAdd & Norm\nInput: 2×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgray shape=parallelogram style=filled]
	s0_tp4_q_proj -> s0_tp4_attn
	s0_tp4_k_proj -> s0_tp4_attn
	s0_tp4_v_proj -> s0_tp4_attn
	s0_tp4_attn -> s0_tp4_mlp1
	s0_tp4_mlp1 -> s0_tp4_mlp2
	s0_tp4_mlp2 -> s0_tp4_residual
	input -> s0_tp4_q_proj
	input -> s0_tp4_k_proj
	input -> s0_tp4_v_proj
	s0_tp5_q_proj [label="S0 Q TP5\nGPU 5\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp5_k_proj [label="S0 K TP5\nGPU 5\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp5_v_proj [label="S0 V TP5\nGPU 5\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp5_attn [label="S0 Attn TP5\nGPU 5\nMulti-head slice\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgreen shape=rectangle style=filled]
	s0_tp5_mlp1 [label="S0 MLP1 TP5\nGPU 5\nColumn parallel\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, ffn=1024]" fillcolor=lightcoral shape=rectangle style=filled]
	s0_tp5_mlp2 [label="S0 MLP2 TP5\nGPU 5\nRow parallel\nInput: [batch=128, seq_len=10000, ffn=1024]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightcoral shape=rectangle style=filled]
	s0_tp5_residual [label="S0 Residual TP5\nGPU 5\nAdd & Norm\nInput: 2×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgray shape=parallelogram style=filled]
	s0_tp5_q_proj -> s0_tp5_attn
	s0_tp5_k_proj -> s0_tp5_attn
	s0_tp5_v_proj -> s0_tp5_attn
	s0_tp5_attn -> s0_tp5_mlp1
	s0_tp5_mlp1 -> s0_tp5_mlp2
	s0_tp5_mlp2 -> s0_tp5_residual
	input -> s0_tp5_q_proj
	input -> s0_tp5_k_proj
	input -> s0_tp5_v_proj
	s0_tp6_q_proj [label="S0 Q TP6\nGPU 6\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp6_k_proj [label="S0 K TP6\nGPU 6\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp6_v_proj [label="S0 V TP6\nGPU 6\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp6_attn [label="S0 Attn TP6\nGPU 6\nMulti-head slice\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgreen shape=rectangle style=filled]
	s0_tp6_mlp1 [label="S0 MLP1 TP6\nGPU 6\nColumn parallel\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, ffn=1024]" fillcolor=lightcoral shape=rectangle style=filled]
	s0_tp6_mlp2 [label="S0 MLP2 TP6\nGPU 6\nRow parallel\nInput: [batch=128, seq_len=10000, ffn=1024]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightcoral shape=rectangle style=filled]
	s0_tp6_residual [label="S0 Residual TP6\nGPU 6\nAdd & Norm\nInput: 2×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgray shape=parallelogram style=filled]
	s0_tp6_q_proj -> s0_tp6_attn
	s0_tp6_k_proj -> s0_tp6_attn
	s0_tp6_v_proj -> s0_tp6_attn
	s0_tp6_attn -> s0_tp6_mlp1
	s0_tp6_mlp1 -> s0_tp6_mlp2
	s0_tp6_mlp2 -> s0_tp6_residual
	input -> s0_tp6_q_proj
	input -> s0_tp6_k_proj
	input -> s0_tp6_v_proj
	s0_tp7_q_proj [label="S0 Q TP7\nGPU 7\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp7_k_proj [label="S0 K TP7\nGPU 7\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp7_v_proj [label="S0 V TP7\nGPU 7\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s0_tp7_attn [label="S0 Attn TP7\nGPU 7\nMulti-head slice\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgreen shape=rectangle style=filled]
	s0_tp7_mlp1 [label="S0 MLP1 TP7\nGPU 7\nColumn parallel\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, ffn=1024]" fillcolor=lightcoral shape=rectangle style=filled]
	s0_tp7_mlp2 [label="S0 MLP2 TP7\nGPU 7\nRow parallel\nInput: [batch=128, seq_len=10000, ffn=1024]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightcoral shape=rectangle style=filled]
	s0_tp7_residual [label="S0 Residual TP7\nGPU 7\nAdd & Norm\nInput: 2×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgray shape=parallelogram style=filled]
	s0_tp7_q_proj -> s0_tp7_attn
	s0_tp7_k_proj -> s0_tp7_attn
	s0_tp7_v_proj -> s0_tp7_attn
	s0_tp7_attn -> s0_tp7_mlp1
	s0_tp7_mlp1 -> s0_tp7_mlp2
	s0_tp7_mlp2 -> s0_tp7_residual
	input -> s0_tp7_q_proj
	input -> s0_tp7_k_proj
	input -> s0_tp7_v_proj
	s0_allreduce [label="Stage 0 All-Reduce\nCross-GPU reduction\nInput: 8×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, hidden=4096]" fillcolor=orange shape=parallelogram style=filled]
	s0_tp0_residual -> s0_allreduce
	s0_tp1_residual -> s0_allreduce
	s0_tp2_residual -> s0_allreduce
	s0_tp3_residual -> s0_allreduce
	s0_tp4_residual -> s0_allreduce
	s0_tp5_residual -> s0_allreduce
	s0_tp6_residual -> s0_allreduce
	s0_tp7_residual -> s0_allreduce
	pipeline_comm [label="Pipeline Communication\nStage 0 → Stage 1\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, hidden=4096]" fillcolor=purple shape=parallelogram style=filled]
	s0_allreduce -> pipeline_comm
	stage1_label [label="STAGE 1 - Devices 8-15" shape=plaintext]
	s1_tp0_q_proj [label="S1 Q TP0\nGPU 8\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp0_k_proj [label="S1 K TP0\nGPU 8\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp0_v_proj [label="S1 V TP0\nGPU 8\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp0_attn [label="S1 Attn TP0\nGPU 8\nMulti-head slice\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgreen shape=rectangle style=filled]
	s1_tp0_mlp1 [label="S1 MLP1 TP0\nGPU 8\nColumn parallel\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, ffn=1024]" fillcolor=lightcoral shape=rectangle style=filled]
	s1_tp0_mlp2 [label="S1 MLP2 TP0\nGPU 8\nRow parallel\nInput: [batch=128, seq_len=10000, ffn=1024]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightcoral shape=rectangle style=filled]
	s1_tp0_residual [label="S1 Residual TP0\nGPU 8\nAdd & Norm\nInput: 2×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgray shape=parallelogram style=filled]
	s1_tp0_q_proj -> s1_tp0_attn
	s1_tp0_k_proj -> s1_tp0_attn
	s1_tp0_v_proj -> s1_tp0_attn
	s1_tp0_attn -> s1_tp0_mlp1
	s1_tp0_mlp1 -> s1_tp0_mlp2
	s1_tp0_mlp2 -> s1_tp0_residual
	s1_tp1_q_proj [label="S1 Q TP1\nGPU 9\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp1_k_proj [label="S1 K TP1\nGPU 9\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp1_v_proj [label="S1 V TP1\nGPU 9\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp1_attn [label="S1 Attn TP1\nGPU 9\nMulti-head slice\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgreen shape=rectangle style=filled]
	s1_tp1_mlp1 [label="S1 MLP1 TP1\nGPU 9\nColumn parallel\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, ffn=1024]" fillcolor=lightcoral shape=rectangle style=filled]
	s1_tp1_mlp2 [label="S1 MLP2 TP1\nGPU 9\nRow parallel\nInput: [batch=128, seq_len=10000, ffn=1024]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightcoral shape=rectangle style=filled]
	s1_tp1_residual [label="S1 Residual TP1\nGPU 9\nAdd & Norm\nInput: 2×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgray shape=parallelogram style=filled]
	s1_tp1_q_proj -> s1_tp1_attn
	s1_tp1_k_proj -> s1_tp1_attn
	s1_tp1_v_proj -> s1_tp1_attn
	s1_tp1_attn -> s1_tp1_mlp1
	s1_tp1_mlp1 -> s1_tp1_mlp2
	s1_tp1_mlp2 -> s1_tp1_residual
	s1_tp2_q_proj [label="S1 Q TP2\nGPU 10\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp2_k_proj [label="S1 K TP2\nGPU 10\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp2_v_proj [label="S1 V TP2\nGPU 10\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp2_attn [label="S1 Attn TP2\nGPU 10\nMulti-head slice\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgreen shape=rectangle style=filled]
	s1_tp2_mlp1 [label="S1 MLP1 TP2\nGPU 10\nColumn parallel\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, ffn=1024]" fillcolor=lightcoral shape=rectangle style=filled]
	s1_tp2_mlp2 [label="S1 MLP2 TP2\nGPU 10\nRow parallel\nInput: [batch=128, seq_len=10000, ffn=1024]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightcoral shape=rectangle style=filled]
	s1_tp2_residual [label="S1 Residual TP2\nGPU 10\nAdd & Norm\nInput: 2×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgray shape=parallelogram style=filled]
	s1_tp2_q_proj -> s1_tp2_attn
	s1_tp2_k_proj -> s1_tp2_attn
	s1_tp2_v_proj -> s1_tp2_attn
	s1_tp2_attn -> s1_tp2_mlp1
	s1_tp2_mlp1 -> s1_tp2_mlp2
	s1_tp2_mlp2 -> s1_tp2_residual
	s1_tp3_q_proj [label="S1 Q TP3\nGPU 11\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp3_k_proj [label="S1 K TP3\nGPU 11\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp3_v_proj [label="S1 V TP3\nGPU 11\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp3_attn [label="S1 Attn TP3\nGPU 11\nMulti-head slice\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgreen shape=rectangle style=filled]
	s1_tp3_mlp1 [label="S1 MLP1 TP3\nGPU 11\nColumn parallel\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, ffn=1024]" fillcolor=lightcoral shape=rectangle style=filled]
	s1_tp3_mlp2 [label="S1 MLP2 TP3\nGPU 11\nRow parallel\nInput: [batch=128, seq_len=10000, ffn=1024]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightcoral shape=rectangle style=filled]
	s1_tp3_residual [label="S1 Residual TP3\nGPU 11\nAdd & Norm\nInput: 2×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgray shape=parallelogram style=filled]
	s1_tp3_q_proj -> s1_tp3_attn
	s1_tp3_k_proj -> s1_tp3_attn
	s1_tp3_v_proj -> s1_tp3_attn
	s1_tp3_attn -> s1_tp3_mlp1
	s1_tp3_mlp1 -> s1_tp3_mlp2
	s1_tp3_mlp2 -> s1_tp3_residual
	s1_tp4_q_proj [label="S1 Q TP4\nGPU 12\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp4_k_proj [label="S1 K TP4\nGPU 12\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp4_v_proj [label="S1 V TP4\nGPU 12\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp4_attn [label="S1 Attn TP4\nGPU 12\nMulti-head slice\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgreen shape=rectangle style=filled]
	s1_tp4_mlp1 [label="S1 MLP1 TP4\nGPU 12\nColumn parallel\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, ffn=1024]" fillcolor=lightcoral shape=rectangle style=filled]
	s1_tp4_mlp2 [label="S1 MLP2 TP4\nGPU 12\nRow parallel\nInput: [batch=128, seq_len=10000, ffn=1024]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightcoral shape=rectangle style=filled]
	s1_tp4_residual [label="S1 Residual TP4\nGPU 12\nAdd & Norm\nInput: 2×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgray shape=parallelogram style=filled]
	s1_tp4_q_proj -> s1_tp4_attn
	s1_tp4_k_proj -> s1_tp4_attn
	s1_tp4_v_proj -> s1_tp4_attn
	s1_tp4_attn -> s1_tp4_mlp1
	s1_tp4_mlp1 -> s1_tp4_mlp2
	s1_tp4_mlp2 -> s1_tp4_residual
	s1_tp5_q_proj [label="S1 Q TP5\nGPU 13\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp5_k_proj [label="S1 K TP5\nGPU 13\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp5_v_proj [label="S1 V TP5\nGPU 13\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp5_attn [label="S1 Attn TP5\nGPU 13\nMulti-head slice\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgreen shape=rectangle style=filled]
	s1_tp5_mlp1 [label="S1 MLP1 TP5\nGPU 13\nColumn parallel\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, ffn=1024]" fillcolor=lightcoral shape=rectangle style=filled]
	s1_tp5_mlp2 [label="S1 MLP2 TP5\nGPU 13\nRow parallel\nInput: [batch=128, seq_len=10000, ffn=1024]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightcoral shape=rectangle style=filled]
	s1_tp5_residual [label="S1 Residual TP5\nGPU 13\nAdd & Norm\nInput: 2×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgray shape=parallelogram style=filled]
	s1_tp5_q_proj -> s1_tp5_attn
	s1_tp5_k_proj -> s1_tp5_attn
	s1_tp5_v_proj -> s1_tp5_attn
	s1_tp5_attn -> s1_tp5_mlp1
	s1_tp5_mlp1 -> s1_tp5_mlp2
	s1_tp5_mlp2 -> s1_tp5_residual
	s1_tp6_q_proj [label="S1 Q TP6\nGPU 14\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp6_k_proj [label="S1 K TP6\nGPU 14\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp6_v_proj [label="S1 V TP6\nGPU 14\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp6_attn [label="S1 Attn TP6\nGPU 14\nMulti-head slice\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgreen shape=rectangle style=filled]
	s1_tp6_mlp1 [label="S1 MLP1 TP6\nGPU 14\nColumn parallel\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, ffn=1024]" fillcolor=lightcoral shape=rectangle style=filled]
	s1_tp6_mlp2 [label="S1 MLP2 TP6\nGPU 14\nRow parallel\nInput: [batch=128, seq_len=10000, ffn=1024]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightcoral shape=rectangle style=filled]
	s1_tp6_residual [label="S1 Residual TP6\nGPU 14\nAdd & Norm\nInput: 2×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgray shape=parallelogram style=filled]
	s1_tp6_q_proj -> s1_tp6_attn
	s1_tp6_k_proj -> s1_tp6_attn
	s1_tp6_v_proj -> s1_tp6_attn
	s1_tp6_attn -> s1_tp6_mlp1
	s1_tp6_mlp1 -> s1_tp6_mlp2
	s1_tp6_mlp2 -> s1_tp6_residual
	s1_tp7_q_proj [label="S1 Q TP7\nGPU 15\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp7_k_proj [label="S1 K TP7\nGPU 15\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp7_v_proj [label="S1 V TP7\nGPU 15\nColumn parallel\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightyellow shape=rectangle style=filled]
	s1_tp7_attn [label="S1 Attn TP7\nGPU 15\nMulti-head slice\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgreen shape=rectangle style=filled]
	s1_tp7_mlp1 [label="S1 MLP1 TP7\nGPU 15\nColumn parallel\nInput: [batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, ffn=1024]" fillcolor=lightcoral shape=rectangle style=filled]
	s1_tp7_mlp2 [label="S1 MLP2 TP7\nGPU 15\nRow parallel\nInput: [batch=128, seq_len=10000, ffn=1024]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightcoral shape=rectangle style=filled]
	s1_tp7_residual [label="S1 Residual TP7\nGPU 15\nAdd & Norm\nInput: 2×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, slice=512]" fillcolor=lightgray shape=parallelogram style=filled]
	s1_tp7_q_proj -> s1_tp7_attn
	s1_tp7_k_proj -> s1_tp7_attn
	s1_tp7_v_proj -> s1_tp7_attn
	s1_tp7_attn -> s1_tp7_mlp1
	s1_tp7_mlp1 -> s1_tp7_mlp2
	s1_tp7_mlp2 -> s1_tp7_residual
	s1_allreduce [label="Stage 1 All-Reduce\nCross-GPU reduction\nInput: 8×[batch=128, seq_len=10000, slice=512]\nOutput: [batch=128, seq_len=10000, hidden=4096]" fillcolor=orange shape=parallelogram style=filled]
	s1_tp0_residual -> s1_allreduce
	s1_tp1_residual -> s1_allreduce
	s1_tp2_residual -> s1_allreduce
	s1_tp3_residual -> s1_allreduce
	s1_tp4_residual -> s1_allreduce
	s1_tp5_residual -> s1_allreduce
	s1_tp6_residual -> s1_allreduce
	s1_tp7_residual -> s1_allreduce
	pipeline_comm -> s1_tp0_q_proj
	pipeline_comm -> s1_tp0_k_proj
	pipeline_comm -> s1_tp0_v_proj
	pipeline_comm -> s1_tp1_q_proj
	pipeline_comm -> s1_tp1_k_proj
	pipeline_comm -> s1_tp1_v_proj
	pipeline_comm -> s1_tp2_q_proj
	pipeline_comm -> s1_tp2_k_proj
	pipeline_comm -> s1_tp2_v_proj
	pipeline_comm -> s1_tp3_q_proj
	pipeline_comm -> s1_tp3_k_proj
	pipeline_comm -> s1_tp3_v_proj
	pipeline_comm -> s1_tp4_q_proj
	pipeline_comm -> s1_tp4_k_proj
	pipeline_comm -> s1_tp4_v_proj
	pipeline_comm -> s1_tp5_q_proj
	pipeline_comm -> s1_tp5_k_proj
	pipeline_comm -> s1_tp5_v_proj
	pipeline_comm -> s1_tp6_q_proj
	pipeline_comm -> s1_tp6_k_proj
	pipeline_comm -> s1_tp6_v_proj
	pipeline_comm -> s1_tp7_q_proj
	pipeline_comm -> s1_tp7_k_proj
	pipeline_comm -> s1_tp7_v_proj
	output [label="Output\nFinal Output\nInput: [batch=128, seq_len=10000, hidden=4096]\nOutput: [batch=128, seq_len=10000, hidden=4096]" fillcolor=lightblue shape=ellipse style=filled]
	s1_allreduce -> output
}
