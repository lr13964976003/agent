<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1899pt" height="9000pt"
 viewBox="0.00 0.00 455.80 2160.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.63 1.63) rotate(0) translate(4 5509.76)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-5509.76 1159.52,-5509.76 1159.52,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="lightblue" stroke="black" points="551,-5505.76 333,-5505.76 333,-5453.76 551,-5453.76 551,-5505.76"/>
<text text-anchor="middle" x="442" y="-5493.76" font-family="Times,serif" font-size="10.00">Input</text>
<text text-anchor="middle" x="442" y="-5482.76" font-family="Times,serif" font-size="10.00">DP Replica</text>
<text text-anchor="middle" x="442" y="-5471.76" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="442" y="-5460.76" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- layernorm_l0 -->
<g id="node2" class="node">
<title>layernorm_l0</title>
<polygon fill="lightblue" stroke="black" points="548,-5417.76 336,-5417.76 336,-5365.76 548,-5365.76 548,-5417.76"/>
<text text-anchor="middle" x="442" y="-5405.76" font-family="Times,serif" font-size="10.00">LayerNorm L0</text>
<text text-anchor="middle" x="442" y="-5394.76" font-family="Times,serif" font-size="10.00">TP Split</text>
<text text-anchor="middle" x="442" y="-5383.76" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="442" y="-5372.76" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=128]</text>
</g>
<!-- input&#45;&gt;layernorm_l0 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;layernorm_l0</title>
<path fill="none" stroke="black" d="M442,-5453.43C442,-5445.47 442,-5436.53 442,-5428.01"/>
<polygon fill="black" stroke="black" points="445.5,-5427.92 442,-5417.92 438.5,-5427.92 445.5,-5427.92"/>
</g>
<!-- attn_q_l0 -->
<g id="node3" class="node">
<title>attn_q_l0</title>
<polygon fill="lightblue" stroke="black" points="304.5,-5329.76 65.5,-5329.76 65.5,-5277.76 304.5,-5277.76 304.5,-5329.76"/>
<text text-anchor="middle" x="185" y="-5317.76" font-family="Times,serif" font-size="10.00">Attention Query</text>
<text text-anchor="middle" x="185" y="-5306.76" font-family="Times,serif" font-size="10.00">L0 Col&#45;Parallel</text>
<text text-anchor="middle" x="185" y="-5295.76" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="185" y="-5284.76" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, d_k=64]</text>
</g>
<!-- layernorm_l0&#45;&gt;attn_q_l0 -->
<g id="edge2" class="edge">
<title>layernorm_l0&#45;&gt;attn_q_l0</title>
<path fill="none" stroke="black" d="M366.97,-5365.66C336.5,-5355.46 301.13,-5343.62 269.73,-5333.12"/>
<polygon fill="black" stroke="black" points="270.71,-5329.76 260.12,-5329.9 268.49,-5336.39 270.71,-5329.76"/>
</g>
<!-- attn_k_l0 -->
<g id="node4" class="node">
<title>attn_k_l0</title>
<polygon fill="lightblue" stroke="black" points="561.5,-5329.76 322.5,-5329.76 322.5,-5277.76 561.5,-5277.76 561.5,-5329.76"/>
<text text-anchor="middle" x="442" y="-5317.76" font-family="Times,serif" font-size="10.00">Attention Key</text>
<text text-anchor="middle" x="442" y="-5306.76" font-family="Times,serif" font-size="10.00">L0 Col&#45;Parallel</text>
<text text-anchor="middle" x="442" y="-5295.76" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="442" y="-5284.76" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, d_k=64]</text>
</g>
<!-- layernorm_l0&#45;&gt;attn_k_l0 -->
<g id="edge3" class="edge">
<title>layernorm_l0&#45;&gt;attn_k_l0</title>
<path fill="none" stroke="black" d="M442,-5365.43C442,-5357.47 442,-5348.53 442,-5340.01"/>
<polygon fill="black" stroke="black" points="445.5,-5339.92 442,-5329.92 438.5,-5339.92 445.5,-5339.92"/>
</g>
<!-- attn_v_l0 -->
<g id="node5" class="node">
<title>attn_v_l0</title>
<polygon fill="lightblue" stroke="black" points="709.5,-5241.76 470.5,-5241.76 470.5,-5189.76 709.5,-5189.76 709.5,-5241.76"/>
<text text-anchor="middle" x="590" y="-5229.76" font-family="Times,serif" font-size="10.00">Attention Value</text>
<text text-anchor="middle" x="590" y="-5218.76" font-family="Times,serif" font-size="10.00">L0 Col&#45;Parallel</text>
<text text-anchor="middle" x="590" y="-5207.76" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="590" y="-5196.76" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, d_k=64]</text>
</g>
<!-- layernorm_l0&#45;&gt;attn_v_l0 -->
<g id="edge4" class="edge">
<title>layernorm_l0&#45;&gt;attn_v_l0</title>
<path fill="none" stroke="black" d="M524.39,-5365.63C541.73,-5356.82 558.3,-5345.14 570,-5329.76 586.82,-5307.67 591.25,-5276.14 591.8,-5252"/>
<polygon fill="black" stroke="black" points="595.3,-5251.82 591.82,-5241.82 588.3,-5251.81 595.3,-5251.82"/>
</g>
<!-- attn_score_l0 -->
<g id="node6" class="node">
<title>attn_score_l0</title>
<polygon fill="lightblue" stroke="black" points="452,-5241.76 220,-5241.76 220,-5189.76 452,-5189.76 452,-5241.76"/>
<text text-anchor="middle" x="336" y="-5229.76" font-family="Times,serif" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="336" y="-5218.76" font-family="Times,serif" font-size="10.00">L0</text>
<text text-anchor="middle" x="336" y="-5207.76" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, heads=2, d_k=64]</text>
<text text-anchor="middle" x="336" y="-5196.76" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, seq=?]</text>
</g>
<!-- attn_q_l0&#45;&gt;attn_score_l0 -->
<g id="edge5" class="edge">
<title>attn_q_l0&#45;&gt;attn_score_l0</title>
<path fill="none" stroke="black" d="M229.08,-5277.66C245.91,-5268.07 265.27,-5257.05 282.85,-5247.03"/>
<polygon fill="black" stroke="black" points="284.91,-5249.89 291.86,-5241.9 281.44,-5243.81 284.91,-5249.89"/>
</g>
<!-- attn_k_l0&#45;&gt;attn_score_l0 -->
<g id="edge6" class="edge">
<title>attn_k_l0&#45;&gt;attn_score_l0</title>
<path fill="none" stroke="black" d="M411.06,-5277.66C399.83,-5268.55 387.01,-5258.15 375.17,-5248.54"/>
<polygon fill="black" stroke="black" points="377.14,-5245.63 367.17,-5242.05 372.73,-5251.07 377.14,-5245.63"/>
</g>
<!-- attn_out_l0 -->
<g id="node8" class="node">
<title>attn_out_l0</title>
<polygon fill="lightblue" stroke="black" points="578.5,-5065.76 347.5,-5065.76 347.5,-5013.76 578.5,-5013.76 578.5,-5065.76"/>
<text text-anchor="middle" x="463" y="-5053.76" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="463" y="-5042.76" font-family="Times,serif" font-size="10.00">L0 Row&#45;Parallel</text>
<text text-anchor="middle" x="463" y="-5031.76" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, heads=2, d_k=64]</text>
<text text-anchor="middle" x="463" y="-5020.76" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=128]</text>
</g>
<!-- attn_v_l0&#45;&gt;attn_out_l0 -->
<g id="edge9" class="edge">
<title>attn_v_l0&#45;&gt;attn_out_l0</title>
<path fill="none" stroke="black" d="M574.77,-5189.41C560.43,-5166.06 537.93,-5130.75 516,-5101.76 508.87,-5092.33 500.68,-5082.5 492.91,-5073.55"/>
<polygon fill="black" stroke="black" points="495.46,-5071.14 486.23,-5065.94 490.2,-5075.76 495.46,-5071.14"/>
</g>
<!-- attn_softmax_l0 -->
<g id="node7" class="node">
<title>attn_softmax_l0</title>
<polygon fill="lightblue" stroke="black" points="507,-5153.76 275,-5153.76 275,-5101.76 507,-5101.76 507,-5153.76"/>
<text text-anchor="middle" x="391" y="-5141.76" font-family="Times,serif" font-size="10.00">Attention Softmax</text>
<text text-anchor="middle" x="391" y="-5130.76" font-family="Times,serif" font-size="10.00">L0</text>
<text text-anchor="middle" x="391" y="-5119.76" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, heads=2, seq=?]</text>
<text text-anchor="middle" x="391" y="-5108.76" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, seq=?]</text>
</g>
<!-- attn_score_l0&#45;&gt;attn_softmax_l0 -->
<g id="edge7" class="edge">
<title>attn_score_l0&#45;&gt;attn_softmax_l0</title>
<path fill="none" stroke="black" d="M352.2,-5189.43C357.58,-5181.03 363.64,-5171.54 369.36,-5162.61"/>
<polygon fill="black" stroke="black" points="372.47,-5164.23 374.91,-5153.92 366.58,-5160.46 372.47,-5164.23"/>
</g>
<!-- attn_softmax_l0&#45;&gt;attn_out_l0 -->
<g id="edge8" class="edge">
<title>attn_softmax_l0&#45;&gt;attn_out_l0</title>
<path fill="none" stroke="black" d="M412.21,-5101.43C419.46,-5092.77 427.68,-5082.95 435.36,-5073.77"/>
<polygon fill="black" stroke="black" points="438.2,-5075.83 441.94,-5065.92 432.84,-5071.34 438.2,-5075.83"/>
</g>
<!-- attn_allreduce_l0 -->
<g id="node9" class="node">
<title>attn_allreduce_l0</title>
<ellipse fill="lightgreen" stroke="black" cx="463" cy="-4933.22" rx="154.3" ry="44.6"/>
<text text-anchor="middle" x="463" y="-4952.72" font-family="Times,serif" font-size="10.00">All&#45;Reduce</text>
<text text-anchor="middle" x="463" y="-4941.72" font-family="Times,serif" font-size="10.00">Attention L0</text>
<text text-anchor="middle" x="463" y="-4930.72" font-family="Times,serif" font-size="10.00">TP Group</text>
<text text-anchor="middle" x="463" y="-4919.72" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="463" y="-4908.72" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- attn_out_l0&#45;&gt;attn_allreduce_l0 -->
<g id="edge10" class="edge">
<title>attn_out_l0&#45;&gt;attn_allreduce_l0</title>
<path fill="none" stroke="black" d="M463,-5013.72C463,-5005.91 463,-4996.97 463,-4987.97"/>
<polygon fill="black" stroke="black" points="466.5,-4987.85 463,-4977.85 459.5,-4987.85 466.5,-4987.85"/>
</g>
<!-- mlp_gate_l0 -->
<g id="node10" class="node">
<title>mlp_gate_l0</title>
<polygon fill="yellow" stroke="black" points="680.94,-4852.67 334.25,-4852.67 245.06,-4748.67 591.75,-4748.67 680.94,-4852.67"/>
<text text-anchor="middle" x="463" y="-4814.67" font-family="Times,serif" font-size="10.00">MLP Gate</text>
<text text-anchor="middle" x="463" y="-4803.67" font-family="Times,serif" font-size="10.00">L0</text>
<text text-anchor="middle" x="463" y="-4792.67" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="463" y="-4781.67" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, experts=4]</text>
</g>
<!-- attn_allreduce_l0&#45;&gt;mlp_gate_l0 -->
<g id="edge11" class="edge">
<title>attn_allreduce_l0&#45;&gt;mlp_gate_l0</title>
<path fill="none" stroke="black" d="M463,-4888.38C463,-4880.18 463,-4871.48 463,-4862.86"/>
<polygon fill="black" stroke="black" points="466.5,-4862.84 463,-4852.84 459.5,-4862.84 466.5,-4862.84"/>
</g>
<!-- expert0_l0 -->
<g id="node11" class="node">
<title>expert0_l0</title>
<polygon fill="lightblue" stroke="black" points="218,-4712.67 0,-4712.67 0,-4660.67 218,-4660.67 218,-4712.67"/>
<text text-anchor="middle" x="109" y="-4700.67" font-family="Times,serif" font-size="10.00">Expert 0</text>
<text text-anchor="middle" x="109" y="-4689.67" font-family="Times,serif" font-size="10.00">L0</text>
<text text-anchor="middle" x="109" y="-4678.67" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="109" y="-4667.67" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_gate_l0&#45;&gt;expert0_l0 -->
<g id="edge12" class="edge">
<title>mlp_gate_l0&#45;&gt;expert0_l0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M301.8,-4748.67C266.07,-4737.36 229.48,-4725.79 197.91,-4715.8"/>
<polygon fill="black" stroke="black" points="198.87,-4712.43 188.28,-4712.75 196.76,-4719.11 198.87,-4712.43"/>
</g>
<!-- expert1_l0 -->
<g id="node12" class="node">
<title>expert1_l0</title>
<polygon fill="lightblue" stroke="black" points="454,-4712.67 236,-4712.67 236,-4660.67 454,-4660.67 454,-4712.67"/>
<text text-anchor="middle" x="345" y="-4700.67" font-family="Times,serif" font-size="10.00">Expert 1</text>
<text text-anchor="middle" x="345" y="-4689.67" font-family="Times,serif" font-size="10.00">L0</text>
<text text-anchor="middle" x="345" y="-4678.67" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="345" y="-4667.67" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_gate_l0&#45;&gt;expert1_l0 -->
<g id="edge14" class="edge">
<title>mlp_gate_l0&#45;&gt;expert1_l0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M409.18,-4748.58C398.82,-4738.75 388.25,-4728.71 378.75,-4719.7"/>
<polygon fill="black" stroke="black" points="381.05,-4717.06 371.39,-4712.71 376.23,-4722.13 381.05,-4717.06"/>
</g>
<!-- expert2_l0 -->
<g id="node13" class="node">
<title>expert2_l0</title>
<polygon fill="lightblue" stroke="black" points="690,-4712.67 472,-4712.67 472,-4660.67 690,-4660.67 690,-4712.67"/>
<text text-anchor="middle" x="581" y="-4700.67" font-family="Times,serif" font-size="10.00">Expert 2</text>
<text text-anchor="middle" x="581" y="-4689.67" font-family="Times,serif" font-size="10.00">L0</text>
<text text-anchor="middle" x="581" y="-4678.67" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="581" y="-4667.67" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_gate_l0&#45;&gt;expert2_l0 -->
<g id="edge16" class="edge">
<title>mlp_gate_l0&#45;&gt;expert2_l0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M516.82,-4748.58C527.18,-4738.75 537.75,-4728.71 547.25,-4719.7"/>
<polygon fill="black" stroke="black" points="549.77,-4722.13 554.61,-4712.71 544.95,-4717.06 549.77,-4722.13"/>
</g>
<!-- expert3_l0 -->
<g id="node14" class="node">
<title>expert3_l0</title>
<polygon fill="lightblue" stroke="black" points="926,-4712.67 708,-4712.67 708,-4660.67 926,-4660.67 926,-4712.67"/>
<text text-anchor="middle" x="817" y="-4700.67" font-family="Times,serif" font-size="10.00">Expert 3</text>
<text text-anchor="middle" x="817" y="-4689.67" font-family="Times,serif" font-size="10.00">L0</text>
<text text-anchor="middle" x="817" y="-4678.67" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="817" y="-4667.67" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_gate_l0&#45;&gt;expert3_l0 -->
<g id="edge18" class="edge">
<title>mlp_gate_l0&#45;&gt;expert3_l0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M598.85,-4756.69C642.17,-4742.98 688.97,-4728.17 728.08,-4715.8"/>
<polygon fill="black" stroke="black" points="729.37,-4719.07 737.84,-4712.71 727.25,-4712.39 729.37,-4719.07"/>
</g>
<!-- expert_agg_l0 -->
<g id="node15" class="node">
<title>expert_agg_l0</title>
<polygon fill="yellow" stroke="black" points="740.7,-4624.67 298.94,-4624.67 185.3,-4520.67 627.06,-4520.67 740.7,-4624.67"/>
<text text-anchor="middle" x="463" y="-4586.67" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="463" y="-4575.67" font-family="Times,serif" font-size="10.00">L0</text>
<text text-anchor="middle" x="463" y="-4564.67" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, experts=4, hidden=1024]</text>
<text text-anchor="middle" x="463" y="-4553.67" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- expert0_l0&#45;&gt;expert_agg_l0 -->
<g id="edge13" class="edge">
<title>expert0_l0&#45;&gt;expert_agg_l0</title>
<path fill="none" stroke="black" d="M188.44,-4660.53C219.23,-4650.79 255.73,-4639.24 291.91,-4627.8"/>
<polygon fill="black" stroke="black" points="293.12,-4631.09 301.6,-4624.73 291.01,-4624.41 293.12,-4631.09"/>
</g>
<!-- expert1_l0&#45;&gt;expert_agg_l0 -->
<g id="edge15" class="edge">
<title>expert1_l0&#45;&gt;expert_agg_l0</title>
<path fill="none" stroke="black" d="M371.48,-4660.53C380.54,-4651.94 391.08,-4641.93 401.72,-4631.84"/>
<polygon fill="black" stroke="black" points="404.24,-4634.27 409.08,-4624.85 399.42,-4629.19 404.24,-4634.27"/>
</g>
<!-- expert2_l0&#45;&gt;expert_agg_l0 -->
<g id="edge17" class="edge">
<title>expert2_l0&#45;&gt;expert_agg_l0</title>
<path fill="none" stroke="black" d="M554.52,-4660.53C545.46,-4651.94 534.92,-4641.93 524.28,-4631.84"/>
<polygon fill="black" stroke="black" points="526.58,-4629.19 516.92,-4624.85 521.76,-4634.27 526.58,-4629.19"/>
</g>
<!-- expert3_l0&#45;&gt;expert_agg_l0 -->
<g id="edge19" class="edge">
<title>expert3_l0&#45;&gt;expert_agg_l0</title>
<path fill="none" stroke="black" d="M737.56,-4660.53C706.77,-4650.79 670.27,-4639.24 634.09,-4627.8"/>
<polygon fill="black" stroke="black" points="634.99,-4624.41 624.4,-4624.73 632.88,-4631.09 634.99,-4624.41"/>
</g>
<!-- mlp_fc1_l0 -->
<g id="node16" class="node">
<title>mlp_fc1_l0</title>
<polygon fill="lightblue" stroke="black" points="568,-4484.67 358,-4484.67 358,-4432.67 568,-4432.67 568,-4484.67"/>
<text text-anchor="middle" x="463" y="-4472.67" font-family="Times,serif" font-size="10.00">MLP FC1</text>
<text text-anchor="middle" x="463" y="-4461.67" font-family="Times,serif" font-size="10.00">L0 Col&#45;Parallel</text>
<text text-anchor="middle" x="463" y="-4450.67" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="463" y="-4439.67" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, ffn=512]</text>
</g>
<!-- expert_agg_l0&#45;&gt;mlp_fc1_l0 -->
<g id="edge20" class="edge">
<title>expert_agg_l0&#45;&gt;mlp_fc1_l0</title>
<path fill="none" stroke="black" d="M463,-4520.58C463,-4511.92 463,-4503.1 463,-4494.95"/>
<polygon fill="black" stroke="black" points="466.5,-4494.71 463,-4484.71 459.5,-4494.71 466.5,-4494.71"/>
</g>
<!-- mlp_gelu_l0 -->
<g id="node17" class="node">
<title>mlp_gelu_l0</title>
<polygon fill="lightblue" stroke="black" points="557.5,-4396.67 368.5,-4396.67 368.5,-4344.67 557.5,-4344.67 557.5,-4396.67"/>
<text text-anchor="middle" x="463" y="-4384.67" font-family="Times,serif" font-size="10.00">MLP GELU</text>
<text text-anchor="middle" x="463" y="-4373.67" font-family="Times,serif" font-size="10.00">L0</text>
<text text-anchor="middle" x="463" y="-4362.67" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, ffn=512]</text>
<text text-anchor="middle" x="463" y="-4351.67" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, ffn=512]</text>
</g>
<!-- mlp_fc1_l0&#45;&gt;mlp_gelu_l0 -->
<g id="edge21" class="edge">
<title>mlp_fc1_l0&#45;&gt;mlp_gelu_l0</title>
<path fill="none" stroke="black" d="M463,-4432.33C463,-4424.37 463,-4415.43 463,-4406.91"/>
<polygon fill="black" stroke="black" points="466.5,-4406.82 463,-4396.82 459.5,-4406.82 466.5,-4406.82"/>
</g>
<!-- mlp_fc2_l0 -->
<g id="node18" class="node">
<title>mlp_fc2_l0</title>
<polygon fill="lightblue" stroke="black" points="569,-4308.67 357,-4308.67 357,-4256.67 569,-4256.67 569,-4308.67"/>
<text text-anchor="middle" x="463" y="-4296.67" font-family="Times,serif" font-size="10.00">MLP FC2</text>
<text text-anchor="middle" x="463" y="-4285.67" font-family="Times,serif" font-size="10.00">L0 Row&#45;Parallel</text>
<text text-anchor="middle" x="463" y="-4274.67" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, ffn=512]</text>
<text text-anchor="middle" x="463" y="-4263.67" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=128]</text>
</g>
<!-- mlp_gelu_l0&#45;&gt;mlp_fc2_l0 -->
<g id="edge22" class="edge">
<title>mlp_gelu_l0&#45;&gt;mlp_fc2_l0</title>
<path fill="none" stroke="black" d="M463,-4344.33C463,-4336.37 463,-4327.43 463,-4318.91"/>
<polygon fill="black" stroke="black" points="466.5,-4318.82 463,-4308.82 459.5,-4318.82 466.5,-4318.82"/>
</g>
<!-- mlp_allreduce_l0 -->
<g id="node19" class="node">
<title>mlp_allreduce_l0</title>
<ellipse fill="lightgreen" stroke="black" cx="463" cy="-4176.12" rx="154.3" ry="44.6"/>
<text text-anchor="middle" x="463" y="-4195.62" font-family="Times,serif" font-size="10.00">All&#45;Reduce</text>
<text text-anchor="middle" x="463" y="-4184.62" font-family="Times,serif" font-size="10.00">MLP L0</text>
<text text-anchor="middle" x="463" y="-4173.62" font-family="Times,serif" font-size="10.00">TP Group</text>
<text text-anchor="middle" x="463" y="-4162.62" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="463" y="-4151.62" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_fc2_l0&#45;&gt;mlp_allreduce_l0 -->
<g id="edge23" class="edge">
<title>mlp_fc2_l0&#45;&gt;mlp_allreduce_l0</title>
<path fill="none" stroke="black" d="M463,-4256.63C463,-4248.81 463,-4239.88 463,-4230.88"/>
<polygon fill="black" stroke="black" points="466.5,-4230.75 463,-4220.75 459.5,-4230.75 466.5,-4230.75"/>
</g>
<!-- layernorm_l1 -->
<g id="node20" class="node">
<title>layernorm_l1</title>
<polygon fill="lightblue" stroke="black" points="569,-4095.57 357,-4095.57 357,-4043.57 569,-4043.57 569,-4095.57"/>
<text text-anchor="middle" x="463" y="-4083.57" font-family="Times,serif" font-size="10.00">LayerNorm L1</text>
<text text-anchor="middle" x="463" y="-4072.57" font-family="Times,serif" font-size="10.00">TP Split</text>
<text text-anchor="middle" x="463" y="-4061.57" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="463" y="-4050.57" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=128]</text>
</g>
<!-- mlp_allreduce_l0&#45;&gt;layernorm_l1 -->
<g id="edge24" class="edge">
<title>mlp_allreduce_l0&#45;&gt;layernorm_l1</title>
<path fill="none" stroke="black" d="M463,-4131.39C463,-4122.81 463,-4113.92 463,-4105.67"/>
<polygon fill="black" stroke="black" points="466.5,-4105.64 463,-4095.64 459.5,-4105.64 466.5,-4105.64"/>
</g>
<!-- attn_q_l1 -->
<g id="node21" class="node">
<title>attn_q_l1</title>
<polygon fill="lightblue" stroke="black" points="325.5,-4007.57 86.5,-4007.57 86.5,-3955.57 325.5,-3955.57 325.5,-4007.57"/>
<text text-anchor="middle" x="206" y="-3995.57" font-family="Times,serif" font-size="10.00">Attention Query</text>
<text text-anchor="middle" x="206" y="-3984.57" font-family="Times,serif" font-size="10.00">L1 Col&#45;Parallel</text>
<text text-anchor="middle" x="206" y="-3973.57" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="206" y="-3962.57" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, d_k=64]</text>
</g>
<!-- layernorm_l1&#45;&gt;attn_q_l1 -->
<g id="edge25" class="edge">
<title>layernorm_l1&#45;&gt;attn_q_l1</title>
<path fill="none" stroke="black" d="M387.97,-4043.47C357.5,-4033.27 322.13,-4021.43 290.73,-4010.93"/>
<polygon fill="black" stroke="black" points="291.71,-4007.56 281.12,-4007.71 289.49,-4014.2 291.71,-4007.56"/>
</g>
<!-- attn_k_l1 -->
<g id="node22" class="node">
<title>attn_k_l1</title>
<polygon fill="lightblue" stroke="black" points="582.5,-4007.57 343.5,-4007.57 343.5,-3955.57 582.5,-3955.57 582.5,-4007.57"/>
<text text-anchor="middle" x="463" y="-3995.57" font-family="Times,serif" font-size="10.00">Attention Key</text>
<text text-anchor="middle" x="463" y="-3984.57" font-family="Times,serif" font-size="10.00">L1 Col&#45;Parallel</text>
<text text-anchor="middle" x="463" y="-3973.57" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="463" y="-3962.57" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, d_k=64]</text>
</g>
<!-- layernorm_l1&#45;&gt;attn_k_l1 -->
<g id="edge26" class="edge">
<title>layernorm_l1&#45;&gt;attn_k_l1</title>
<path fill="none" stroke="black" d="M463,-4043.24C463,-4035.27 463,-4026.34 463,-4017.82"/>
<polygon fill="black" stroke="black" points="466.5,-4017.73 463,-4007.73 459.5,-4017.73 466.5,-4017.73"/>
</g>
<!-- attn_v_l1 -->
<g id="node23" class="node">
<title>attn_v_l1</title>
<polygon fill="lightblue" stroke="black" points="730.5,-3919.57 491.5,-3919.57 491.5,-3867.57 730.5,-3867.57 730.5,-3919.57"/>
<text text-anchor="middle" x="611" y="-3907.57" font-family="Times,serif" font-size="10.00">Attention Value</text>
<text text-anchor="middle" x="611" y="-3896.57" font-family="Times,serif" font-size="10.00">L1 Col&#45;Parallel</text>
<text text-anchor="middle" x="611" y="-3885.57" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="611" y="-3874.57" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, d_k=64]</text>
</g>
<!-- layernorm_l1&#45;&gt;attn_v_l1 -->
<g id="edge27" class="edge">
<title>layernorm_l1&#45;&gt;attn_v_l1</title>
<path fill="none" stroke="black" d="M545.39,-4043.44C562.73,-4034.63 579.3,-4022.95 591,-4007.57 607.82,-3985.48 612.25,-3953.95 612.8,-3929.8"/>
<polygon fill="black" stroke="black" points="616.3,-3929.63 612.82,-3919.63 609.3,-3929.62 616.3,-3929.63"/>
</g>
<!-- attn_score_l1 -->
<g id="node24" class="node">
<title>attn_score_l1</title>
<polygon fill="lightblue" stroke="black" points="473,-3919.57 241,-3919.57 241,-3867.57 473,-3867.57 473,-3919.57"/>
<text text-anchor="middle" x="357" y="-3907.57" font-family="Times,serif" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="357" y="-3896.57" font-family="Times,serif" font-size="10.00">L1</text>
<text text-anchor="middle" x="357" y="-3885.57" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, heads=2, d_k=64]</text>
<text text-anchor="middle" x="357" y="-3874.57" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, seq=?]</text>
</g>
<!-- attn_q_l1&#45;&gt;attn_score_l1 -->
<g id="edge28" class="edge">
<title>attn_q_l1&#45;&gt;attn_score_l1</title>
<path fill="none" stroke="black" d="M250.08,-3955.47C266.91,-3945.88 286.27,-3934.86 303.85,-3924.84"/>
<polygon fill="black" stroke="black" points="305.91,-3927.7 312.86,-3919.71 302.44,-3921.62 305.91,-3927.7"/>
</g>
<!-- attn_k_l1&#45;&gt;attn_score_l1 -->
<g id="edge29" class="edge">
<title>attn_k_l1&#45;&gt;attn_score_l1</title>
<path fill="none" stroke="black" d="M432.06,-3955.47C420.83,-3946.36 408.01,-3935.96 396.17,-3926.35"/>
<polygon fill="black" stroke="black" points="398.14,-3923.44 388.17,-3919.86 393.73,-3928.88 398.14,-3923.44"/>
</g>
<!-- attn_out_l1 -->
<g id="node26" class="node">
<title>attn_out_l1</title>
<polygon fill="lightblue" stroke="black" points="599.5,-3743.57 368.5,-3743.57 368.5,-3691.57 599.5,-3691.57 599.5,-3743.57"/>
<text text-anchor="middle" x="484" y="-3731.57" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="484" y="-3720.57" font-family="Times,serif" font-size="10.00">L1 Row&#45;Parallel</text>
<text text-anchor="middle" x="484" y="-3709.57" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, heads=2, d_k=64]</text>
<text text-anchor="middle" x="484" y="-3698.57" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=128]</text>
</g>
<!-- attn_v_l1&#45;&gt;attn_out_l1 -->
<g id="edge32" class="edge">
<title>attn_v_l1&#45;&gt;attn_out_l1</title>
<path fill="none" stroke="black" d="M595.77,-3867.22C581.43,-3843.87 558.93,-3808.56 537,-3779.57 529.87,-3770.14 521.68,-3760.3 513.91,-3751.35"/>
<polygon fill="black" stroke="black" points="516.46,-3748.95 507.23,-3743.75 511.2,-3753.57 516.46,-3748.95"/>
</g>
<!-- attn_softmax_l1 -->
<g id="node25" class="node">
<title>attn_softmax_l1</title>
<polygon fill="lightblue" stroke="black" points="528,-3831.57 296,-3831.57 296,-3779.57 528,-3779.57 528,-3831.57"/>
<text text-anchor="middle" x="412" y="-3819.57" font-family="Times,serif" font-size="10.00">Attention Softmax</text>
<text text-anchor="middle" x="412" y="-3808.57" font-family="Times,serif" font-size="10.00">L1</text>
<text text-anchor="middle" x="412" y="-3797.57" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, heads=2, seq=?]</text>
<text text-anchor="middle" x="412" y="-3786.57" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, seq=?]</text>
</g>
<!-- attn_score_l1&#45;&gt;attn_softmax_l1 -->
<g id="edge30" class="edge">
<title>attn_score_l1&#45;&gt;attn_softmax_l1</title>
<path fill="none" stroke="black" d="M373.2,-3867.24C378.58,-3858.84 384.64,-3849.35 390.36,-3840.42"/>
<polygon fill="black" stroke="black" points="393.47,-3842.04 395.91,-3831.73 387.58,-3838.27 393.47,-3842.04"/>
</g>
<!-- attn_softmax_l1&#45;&gt;attn_out_l1 -->
<g id="edge31" class="edge">
<title>attn_softmax_l1&#45;&gt;attn_out_l1</title>
<path fill="none" stroke="black" d="M433.21,-3779.24C440.46,-3770.57 448.68,-3760.76 456.36,-3751.58"/>
<polygon fill="black" stroke="black" points="459.2,-3753.64 462.94,-3743.73 453.84,-3749.15 459.2,-3753.64"/>
</g>
<!-- attn_allreduce_l1 -->
<g id="node27" class="node">
<title>attn_allreduce_l1</title>
<ellipse fill="lightgreen" stroke="black" cx="484" cy="-3611.02" rx="154.3" ry="44.6"/>
<text text-anchor="middle" x="484" y="-3630.52" font-family="Times,serif" font-size="10.00">All&#45;Reduce</text>
<text text-anchor="middle" x="484" y="-3619.52" font-family="Times,serif" font-size="10.00">Attention L1</text>
<text text-anchor="middle" x="484" y="-3608.52" font-family="Times,serif" font-size="10.00">TP Group</text>
<text text-anchor="middle" x="484" y="-3597.52" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="484" y="-3586.52" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- attn_out_l1&#45;&gt;attn_allreduce_l1 -->
<g id="edge33" class="edge">
<title>attn_out_l1&#45;&gt;attn_allreduce_l1</title>
<path fill="none" stroke="black" d="M484,-3691.53C484,-3683.72 484,-3674.78 484,-3665.78"/>
<polygon fill="black" stroke="black" points="487.5,-3665.66 484,-3655.66 480.5,-3665.66 487.5,-3665.66"/>
</g>
<!-- mlp_gate_l1 -->
<g id="node28" class="node">
<title>mlp_gate_l1</title>
<polygon fill="yellow" stroke="black" points="701.94,-3530.48 355.25,-3530.48 266.06,-3426.48 612.75,-3426.48 701.94,-3530.48"/>
<text text-anchor="middle" x="484" y="-3492.48" font-family="Times,serif" font-size="10.00">MLP Gate</text>
<text text-anchor="middle" x="484" y="-3481.48" font-family="Times,serif" font-size="10.00">L1</text>
<text text-anchor="middle" x="484" y="-3470.48" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="484" y="-3459.48" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, experts=4]</text>
</g>
<!-- attn_allreduce_l1&#45;&gt;mlp_gate_l1 -->
<g id="edge34" class="edge">
<title>attn_allreduce_l1&#45;&gt;mlp_gate_l1</title>
<path fill="none" stroke="black" d="M484,-3566.19C484,-3557.99 484,-3549.29 484,-3540.67"/>
<polygon fill="black" stroke="black" points="487.5,-3540.64 484,-3530.64 480.5,-3540.64 487.5,-3540.64"/>
</g>
<!-- expert0_l1 -->
<g id="node29" class="node">
<title>expert0_l1</title>
<polygon fill="lightblue" stroke="black" points="239,-3390.48 21,-3390.48 21,-3338.48 239,-3338.48 239,-3390.48"/>
<text text-anchor="middle" x="130" y="-3378.48" font-family="Times,serif" font-size="10.00">Expert 0</text>
<text text-anchor="middle" x="130" y="-3367.48" font-family="Times,serif" font-size="10.00">L1</text>
<text text-anchor="middle" x="130" y="-3356.48" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="130" y="-3345.48" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_gate_l1&#45;&gt;expert0_l1 -->
<g id="edge35" class="edge">
<title>mlp_gate_l1&#45;&gt;expert0_l1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M322.8,-3426.48C287.07,-3415.17 250.48,-3403.6 218.91,-3393.61"/>
<polygon fill="black" stroke="black" points="219.87,-3390.24 209.28,-3390.56 217.76,-3396.91 219.87,-3390.24"/>
</g>
<!-- expert1_l1 -->
<g id="node30" class="node">
<title>expert1_l1</title>
<polygon fill="lightblue" stroke="black" points="475,-3390.48 257,-3390.48 257,-3338.48 475,-3338.48 475,-3390.48"/>
<text text-anchor="middle" x="366" y="-3378.48" font-family="Times,serif" font-size="10.00">Expert 1</text>
<text text-anchor="middle" x="366" y="-3367.48" font-family="Times,serif" font-size="10.00">L1</text>
<text text-anchor="middle" x="366" y="-3356.48" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="366" y="-3345.48" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_gate_l1&#45;&gt;expert1_l1 -->
<g id="edge37" class="edge">
<title>mlp_gate_l1&#45;&gt;expert1_l1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M430.18,-3426.39C419.82,-3416.56 409.25,-3406.52 399.75,-3397.51"/>
<polygon fill="black" stroke="black" points="402.05,-3394.87 392.39,-3390.52 397.23,-3399.94 402.05,-3394.87"/>
</g>
<!-- expert2_l1 -->
<g id="node31" class="node">
<title>expert2_l1</title>
<polygon fill="lightblue" stroke="black" points="711,-3390.48 493,-3390.48 493,-3338.48 711,-3338.48 711,-3390.48"/>
<text text-anchor="middle" x="602" y="-3378.48" font-family="Times,serif" font-size="10.00">Expert 2</text>
<text text-anchor="middle" x="602" y="-3367.48" font-family="Times,serif" font-size="10.00">L1</text>
<text text-anchor="middle" x="602" y="-3356.48" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="602" y="-3345.48" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_gate_l1&#45;&gt;expert2_l1 -->
<g id="edge39" class="edge">
<title>mlp_gate_l1&#45;&gt;expert2_l1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M537.82,-3426.39C548.18,-3416.56 558.75,-3406.52 568.25,-3397.51"/>
<polygon fill="black" stroke="black" points="570.77,-3399.94 575.61,-3390.52 565.95,-3394.87 570.77,-3399.94"/>
</g>
<!-- expert3_l1 -->
<g id="node32" class="node">
<title>expert3_l1</title>
<polygon fill="lightblue" stroke="black" points="947,-3390.48 729,-3390.48 729,-3338.48 947,-3338.48 947,-3390.48"/>
<text text-anchor="middle" x="838" y="-3378.48" font-family="Times,serif" font-size="10.00">Expert 3</text>
<text text-anchor="middle" x="838" y="-3367.48" font-family="Times,serif" font-size="10.00">L1</text>
<text text-anchor="middle" x="838" y="-3356.48" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="838" y="-3345.48" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_gate_l1&#45;&gt;expert3_l1 -->
<g id="edge41" class="edge">
<title>mlp_gate_l1&#45;&gt;expert3_l1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M619.85,-3434.5C663.17,-3420.79 709.97,-3405.98 749.08,-3393.61"/>
<polygon fill="black" stroke="black" points="750.37,-3396.87 758.84,-3390.52 748.25,-3390.2 750.37,-3396.87"/>
</g>
<!-- expert_agg_l1 -->
<g id="node33" class="node">
<title>expert_agg_l1</title>
<polygon fill="yellow" stroke="black" points="761.7,-3302.48 319.94,-3302.48 206.3,-3198.48 648.06,-3198.48 761.7,-3302.48"/>
<text text-anchor="middle" x="484" y="-3264.48" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="484" y="-3253.48" font-family="Times,serif" font-size="10.00">L1</text>
<text text-anchor="middle" x="484" y="-3242.48" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, experts=4, hidden=1024]</text>
<text text-anchor="middle" x="484" y="-3231.48" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- expert0_l1&#45;&gt;expert_agg_l1 -->
<g id="edge36" class="edge">
<title>expert0_l1&#45;&gt;expert_agg_l1</title>
<path fill="none" stroke="black" d="M209.44,-3338.34C240.23,-3328.6 276.73,-3317.05 312.91,-3305.61"/>
<polygon fill="black" stroke="black" points="314.12,-3308.9 322.6,-3302.54 312.01,-3302.22 314.12,-3308.9"/>
</g>
<!-- expert1_l1&#45;&gt;expert_agg_l1 -->
<g id="edge38" class="edge">
<title>expert1_l1&#45;&gt;expert_agg_l1</title>
<path fill="none" stroke="black" d="M392.48,-3338.34C401.54,-3329.75 412.08,-3319.74 422.72,-3309.65"/>
<polygon fill="black" stroke="black" points="425.24,-3312.08 430.08,-3302.66 420.42,-3307 425.24,-3312.08"/>
</g>
<!-- expert2_l1&#45;&gt;expert_agg_l1 -->
<g id="edge40" class="edge">
<title>expert2_l1&#45;&gt;expert_agg_l1</title>
<path fill="none" stroke="black" d="M575.52,-3338.34C566.46,-3329.75 555.92,-3319.74 545.28,-3309.65"/>
<polygon fill="black" stroke="black" points="547.58,-3307 537.92,-3302.66 542.76,-3312.08 547.58,-3307"/>
</g>
<!-- expert3_l1&#45;&gt;expert_agg_l1 -->
<g id="edge42" class="edge">
<title>expert3_l1&#45;&gt;expert_agg_l1</title>
<path fill="none" stroke="black" d="M758.56,-3338.34C727.77,-3328.6 691.27,-3317.05 655.09,-3305.61"/>
<polygon fill="black" stroke="black" points="655.99,-3302.22 645.4,-3302.54 653.88,-3308.9 655.99,-3302.22"/>
</g>
<!-- mlp_fc1_l1 -->
<g id="node34" class="node">
<title>mlp_fc1_l1</title>
<polygon fill="lightblue" stroke="black" points="589,-3162.48 379,-3162.48 379,-3110.48 589,-3110.48 589,-3162.48"/>
<text text-anchor="middle" x="484" y="-3150.48" font-family="Times,serif" font-size="10.00">MLP FC1</text>
<text text-anchor="middle" x="484" y="-3139.48" font-family="Times,serif" font-size="10.00">L1 Col&#45;Parallel</text>
<text text-anchor="middle" x="484" y="-3128.48" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="484" y="-3117.48" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, ffn=512]</text>
</g>
<!-- expert_agg_l1&#45;&gt;mlp_fc1_l1 -->
<g id="edge43" class="edge">
<title>expert_agg_l1&#45;&gt;mlp_fc1_l1</title>
<path fill="none" stroke="black" d="M484,-3198.39C484,-3189.73 484,-3180.91 484,-3172.76"/>
<polygon fill="black" stroke="black" points="487.5,-3172.52 484,-3162.52 480.5,-3172.52 487.5,-3172.52"/>
</g>
<!-- mlp_gelu_l1 -->
<g id="node35" class="node">
<title>mlp_gelu_l1</title>
<polygon fill="lightblue" stroke="black" points="578.5,-3074.48 389.5,-3074.48 389.5,-3022.48 578.5,-3022.48 578.5,-3074.48"/>
<text text-anchor="middle" x="484" y="-3062.48" font-family="Times,serif" font-size="10.00">MLP GELU</text>
<text text-anchor="middle" x="484" y="-3051.48" font-family="Times,serif" font-size="10.00">L1</text>
<text text-anchor="middle" x="484" y="-3040.48" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, ffn=512]</text>
<text text-anchor="middle" x="484" y="-3029.48" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, ffn=512]</text>
</g>
<!-- mlp_fc1_l1&#45;&gt;mlp_gelu_l1 -->
<g id="edge44" class="edge">
<title>mlp_fc1_l1&#45;&gt;mlp_gelu_l1</title>
<path fill="none" stroke="black" d="M484,-3110.14C484,-3102.18 484,-3093.24 484,-3084.72"/>
<polygon fill="black" stroke="black" points="487.5,-3084.63 484,-3074.63 480.5,-3084.63 487.5,-3084.63"/>
</g>
<!-- mlp_fc2_l1 -->
<g id="node36" class="node">
<title>mlp_fc2_l1</title>
<polygon fill="lightblue" stroke="black" points="590,-2986.48 378,-2986.48 378,-2934.48 590,-2934.48 590,-2986.48"/>
<text text-anchor="middle" x="484" y="-2974.48" font-family="Times,serif" font-size="10.00">MLP FC2</text>
<text text-anchor="middle" x="484" y="-2963.48" font-family="Times,serif" font-size="10.00">L1 Row&#45;Parallel</text>
<text text-anchor="middle" x="484" y="-2952.48" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, ffn=512]</text>
<text text-anchor="middle" x="484" y="-2941.48" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=128]</text>
</g>
<!-- mlp_gelu_l1&#45;&gt;mlp_fc2_l1 -->
<g id="edge45" class="edge">
<title>mlp_gelu_l1&#45;&gt;mlp_fc2_l1</title>
<path fill="none" stroke="black" d="M484,-3022.14C484,-3014.18 484,-3005.24 484,-2996.72"/>
<polygon fill="black" stroke="black" points="487.5,-2996.63 484,-2986.63 480.5,-2996.63 487.5,-2996.63"/>
</g>
<!-- mlp_allreduce_l1 -->
<g id="node37" class="node">
<title>mlp_allreduce_l1</title>
<ellipse fill="lightgreen" stroke="black" cx="484" cy="-2853.93" rx="154.3" ry="44.6"/>
<text text-anchor="middle" x="484" y="-2873.43" font-family="Times,serif" font-size="10.00">All&#45;Reduce</text>
<text text-anchor="middle" x="484" y="-2862.43" font-family="Times,serif" font-size="10.00">MLP L1</text>
<text text-anchor="middle" x="484" y="-2851.43" font-family="Times,serif" font-size="10.00">TP Group</text>
<text text-anchor="middle" x="484" y="-2840.43" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="484" y="-2829.43" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_fc2_l1&#45;&gt;mlp_allreduce_l1 -->
<g id="edge46" class="edge">
<title>mlp_fc2_l1&#45;&gt;mlp_allreduce_l1</title>
<path fill="none" stroke="black" d="M484,-2934.44C484,-2926.62 484,-2917.68 484,-2908.69"/>
<polygon fill="black" stroke="black" points="487.5,-2908.56 484,-2898.56 480.5,-2908.56 487.5,-2908.56"/>
</g>
<!-- layernorm_l2 -->
<g id="node38" class="node">
<title>layernorm_l2</title>
<polygon fill="lightblue" stroke="black" points="590,-2773.38 378,-2773.38 378,-2721.38 590,-2721.38 590,-2773.38"/>
<text text-anchor="middle" x="484" y="-2761.38" font-family="Times,serif" font-size="10.00">LayerNorm L2</text>
<text text-anchor="middle" x="484" y="-2750.38" font-family="Times,serif" font-size="10.00">TP Split</text>
<text text-anchor="middle" x="484" y="-2739.38" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="484" y="-2728.38" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=128]</text>
</g>
<!-- mlp_allreduce_l1&#45;&gt;layernorm_l2 -->
<g id="edge47" class="edge">
<title>mlp_allreduce_l1&#45;&gt;layernorm_l2</title>
<path fill="none" stroke="black" d="M484,-2809.2C484,-2800.62 484,-2791.73 484,-2783.48"/>
<polygon fill="black" stroke="black" points="487.5,-2783.44 484,-2773.44 480.5,-2783.44 487.5,-2783.44"/>
</g>
<!-- attn_q_l2 -->
<g id="node39" class="node">
<title>attn_q_l2</title>
<polygon fill="lightblue" stroke="black" points="346.5,-2685.38 107.5,-2685.38 107.5,-2633.38 346.5,-2633.38 346.5,-2685.38"/>
<text text-anchor="middle" x="227" y="-2673.38" font-family="Times,serif" font-size="10.00">Attention Query</text>
<text text-anchor="middle" x="227" y="-2662.38" font-family="Times,serif" font-size="10.00">L2 Col&#45;Parallel</text>
<text text-anchor="middle" x="227" y="-2651.38" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="227" y="-2640.38" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, d_k=64]</text>
</g>
<!-- layernorm_l2&#45;&gt;attn_q_l2 -->
<g id="edge48" class="edge">
<title>layernorm_l2&#45;&gt;attn_q_l2</title>
<path fill="none" stroke="black" d="M408.97,-2721.28C378.5,-2711.08 343.13,-2699.24 311.73,-2688.73"/>
<polygon fill="black" stroke="black" points="312.71,-2685.37 302.12,-2685.52 310.49,-2692.01 312.71,-2685.37"/>
</g>
<!-- attn_k_l2 -->
<g id="node40" class="node">
<title>attn_k_l2</title>
<polygon fill="lightblue" stroke="black" points="603.5,-2685.38 364.5,-2685.38 364.5,-2633.38 603.5,-2633.38 603.5,-2685.38"/>
<text text-anchor="middle" x="484" y="-2673.38" font-family="Times,serif" font-size="10.00">Attention Key</text>
<text text-anchor="middle" x="484" y="-2662.38" font-family="Times,serif" font-size="10.00">L2 Col&#45;Parallel</text>
<text text-anchor="middle" x="484" y="-2651.38" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="484" y="-2640.38" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, d_k=64]</text>
</g>
<!-- layernorm_l2&#45;&gt;attn_k_l2 -->
<g id="edge49" class="edge">
<title>layernorm_l2&#45;&gt;attn_k_l2</title>
<path fill="none" stroke="black" d="M484,-2721.04C484,-2713.08 484,-2704.15 484,-2695.63"/>
<polygon fill="black" stroke="black" points="487.5,-2695.54 484,-2685.54 480.5,-2695.54 487.5,-2695.54"/>
</g>
<!-- attn_v_l2 -->
<g id="node41" class="node">
<title>attn_v_l2</title>
<polygon fill="lightblue" stroke="black" points="751.5,-2597.38 512.5,-2597.38 512.5,-2545.38 751.5,-2545.38 751.5,-2597.38"/>
<text text-anchor="middle" x="632" y="-2585.38" font-family="Times,serif" font-size="10.00">Attention Value</text>
<text text-anchor="middle" x="632" y="-2574.38" font-family="Times,serif" font-size="10.00">L2 Col&#45;Parallel</text>
<text text-anchor="middle" x="632" y="-2563.38" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="632" y="-2552.38" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, d_k=64]</text>
</g>
<!-- layernorm_l2&#45;&gt;attn_v_l2 -->
<g id="edge50" class="edge">
<title>layernorm_l2&#45;&gt;attn_v_l2</title>
<path fill="none" stroke="black" d="M566.39,-2721.25C583.73,-2712.44 600.3,-2700.76 612,-2685.38 628.82,-2663.29 633.25,-2631.76 633.8,-2607.61"/>
<polygon fill="black" stroke="black" points="637.3,-2607.44 633.82,-2597.44 630.3,-2607.43 637.3,-2607.44"/>
</g>
<!-- attn_score_l2 -->
<g id="node42" class="node">
<title>attn_score_l2</title>
<polygon fill="lightblue" stroke="black" points="494,-2597.38 262,-2597.38 262,-2545.38 494,-2545.38 494,-2597.38"/>
<text text-anchor="middle" x="378" y="-2585.38" font-family="Times,serif" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="378" y="-2574.38" font-family="Times,serif" font-size="10.00">L2</text>
<text text-anchor="middle" x="378" y="-2563.38" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, heads=2, d_k=64]</text>
<text text-anchor="middle" x="378" y="-2552.38" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, seq=?]</text>
</g>
<!-- attn_q_l2&#45;&gt;attn_score_l2 -->
<g id="edge51" class="edge">
<title>attn_q_l2&#45;&gt;attn_score_l2</title>
<path fill="none" stroke="black" d="M271.08,-2633.28C287.91,-2623.69 307.27,-2612.67 324.85,-2602.65"/>
<polygon fill="black" stroke="black" points="326.91,-2605.51 333.86,-2597.52 323.44,-2599.43 326.91,-2605.51"/>
</g>
<!-- attn_k_l2&#45;&gt;attn_score_l2 -->
<g id="edge52" class="edge">
<title>attn_k_l2&#45;&gt;attn_score_l2</title>
<path fill="none" stroke="black" d="M453.06,-2633.28C441.83,-2624.17 429.01,-2613.77 417.17,-2604.16"/>
<polygon fill="black" stroke="black" points="419.14,-2601.25 409.17,-2597.67 414.73,-2606.69 419.14,-2601.25"/>
</g>
<!-- attn_out_l2 -->
<g id="node44" class="node">
<title>attn_out_l2</title>
<polygon fill="lightblue" stroke="black" points="620.5,-2421.38 389.5,-2421.38 389.5,-2369.38 620.5,-2369.38 620.5,-2421.38"/>
<text text-anchor="middle" x="505" y="-2409.38" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="505" y="-2398.38" font-family="Times,serif" font-size="10.00">L2 Row&#45;Parallel</text>
<text text-anchor="middle" x="505" y="-2387.38" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, heads=2, d_k=64]</text>
<text text-anchor="middle" x="505" y="-2376.38" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=128]</text>
</g>
<!-- attn_v_l2&#45;&gt;attn_out_l2 -->
<g id="edge55" class="edge">
<title>attn_v_l2&#45;&gt;attn_out_l2</title>
<path fill="none" stroke="black" d="M616.77,-2545.03C602.43,-2521.68 579.93,-2486.37 558,-2457.38 550.87,-2447.95 542.68,-2438.11 534.91,-2429.16"/>
<polygon fill="black" stroke="black" points="537.46,-2426.76 528.23,-2421.56 532.2,-2431.38 537.46,-2426.76"/>
</g>
<!-- attn_softmax_l2 -->
<g id="node43" class="node">
<title>attn_softmax_l2</title>
<polygon fill="lightblue" stroke="black" points="549,-2509.38 317,-2509.38 317,-2457.38 549,-2457.38 549,-2509.38"/>
<text text-anchor="middle" x="433" y="-2497.38" font-family="Times,serif" font-size="10.00">Attention Softmax</text>
<text text-anchor="middle" x="433" y="-2486.38" font-family="Times,serif" font-size="10.00">L2</text>
<text text-anchor="middle" x="433" y="-2475.38" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, heads=2, seq=?]</text>
<text text-anchor="middle" x="433" y="-2464.38" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, seq=?]</text>
</g>
<!-- attn_score_l2&#45;&gt;attn_softmax_l2 -->
<g id="edge53" class="edge">
<title>attn_score_l2&#45;&gt;attn_softmax_l2</title>
<path fill="none" stroke="black" d="M394.2,-2545.04C399.58,-2536.65 405.64,-2527.16 411.36,-2518.23"/>
<polygon fill="black" stroke="black" points="414.47,-2519.85 416.91,-2509.54 408.58,-2516.08 414.47,-2519.85"/>
</g>
<!-- attn_softmax_l2&#45;&gt;attn_out_l2 -->
<g id="edge54" class="edge">
<title>attn_softmax_l2&#45;&gt;attn_out_l2</title>
<path fill="none" stroke="black" d="M454.21,-2457.04C461.46,-2448.38 469.68,-2438.57 477.36,-2429.39"/>
<polygon fill="black" stroke="black" points="480.2,-2431.45 483.94,-2421.54 474.84,-2426.96 480.2,-2431.45"/>
</g>
<!-- attn_allreduce_l2 -->
<g id="node45" class="node">
<title>attn_allreduce_l2</title>
<ellipse fill="lightgreen" stroke="black" cx="505" cy="-2288.83" rx="154.3" ry="44.6"/>
<text text-anchor="middle" x="505" y="-2308.33" font-family="Times,serif" font-size="10.00">All&#45;Reduce</text>
<text text-anchor="middle" x="505" y="-2297.33" font-family="Times,serif" font-size="10.00">Attention L2</text>
<text text-anchor="middle" x="505" y="-2286.33" font-family="Times,serif" font-size="10.00">TP Group</text>
<text text-anchor="middle" x="505" y="-2275.33" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="505" y="-2264.33" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- attn_out_l2&#45;&gt;attn_allreduce_l2 -->
<g id="edge56" class="edge">
<title>attn_out_l2&#45;&gt;attn_allreduce_l2</title>
<path fill="none" stroke="black" d="M505,-2369.34C505,-2361.53 505,-2352.59 505,-2343.59"/>
<polygon fill="black" stroke="black" points="508.5,-2343.47 505,-2333.47 501.5,-2343.47 508.5,-2343.47"/>
</g>
<!-- mlp_gate_l2 -->
<g id="node46" class="node">
<title>mlp_gate_l2</title>
<polygon fill="yellow" stroke="black" points="722.94,-2208.29 376.25,-2208.29 287.06,-2104.29 633.75,-2104.29 722.94,-2208.29"/>
<text text-anchor="middle" x="505" y="-2170.29" font-family="Times,serif" font-size="10.00">MLP Gate</text>
<text text-anchor="middle" x="505" y="-2159.29" font-family="Times,serif" font-size="10.00">L2</text>
<text text-anchor="middle" x="505" y="-2148.29" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="505" y="-2137.29" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, experts=4]</text>
</g>
<!-- attn_allreduce_l2&#45;&gt;mlp_gate_l2 -->
<g id="edge57" class="edge">
<title>attn_allreduce_l2&#45;&gt;mlp_gate_l2</title>
<path fill="none" stroke="black" d="M505,-2244C505,-2235.8 505,-2227.09 505,-2218.48"/>
<polygon fill="black" stroke="black" points="508.5,-2218.45 505,-2208.45 501.5,-2218.45 508.5,-2218.45"/>
</g>
<!-- expert0_l2 -->
<g id="node47" class="node">
<title>expert0_l2</title>
<polygon fill="lightblue" stroke="black" points="260,-2068.29 42,-2068.29 42,-2016.29 260,-2016.29 260,-2068.29"/>
<text text-anchor="middle" x="151" y="-2056.29" font-family="Times,serif" font-size="10.00">Expert 0</text>
<text text-anchor="middle" x="151" y="-2045.29" font-family="Times,serif" font-size="10.00">L2</text>
<text text-anchor="middle" x="151" y="-2034.29" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="151" y="-2023.29" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_gate_l2&#45;&gt;expert0_l2 -->
<g id="edge58" class="edge">
<title>mlp_gate_l2&#45;&gt;expert0_l2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M343.8,-2104.28C308.07,-2092.98 271.48,-2081.41 239.91,-2071.42"/>
<polygon fill="black" stroke="black" points="240.87,-2068.05 230.28,-2068.37 238.76,-2074.72 240.87,-2068.05"/>
</g>
<!-- expert1_l2 -->
<g id="node48" class="node">
<title>expert1_l2</title>
<polygon fill="lightblue" stroke="black" points="496,-2068.29 278,-2068.29 278,-2016.29 496,-2016.29 496,-2068.29"/>
<text text-anchor="middle" x="387" y="-2056.29" font-family="Times,serif" font-size="10.00">Expert 1</text>
<text text-anchor="middle" x="387" y="-2045.29" font-family="Times,serif" font-size="10.00">L2</text>
<text text-anchor="middle" x="387" y="-2034.29" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="387" y="-2023.29" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_gate_l2&#45;&gt;expert1_l2 -->
<g id="edge60" class="edge">
<title>mlp_gate_l2&#45;&gt;expert1_l2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M451.18,-2104.2C440.82,-2094.37 430.25,-2084.33 420.75,-2075.32"/>
<polygon fill="black" stroke="black" points="423.05,-2072.68 413.39,-2068.33 418.23,-2077.75 423.05,-2072.68"/>
</g>
<!-- expert2_l2 -->
<g id="node49" class="node">
<title>expert2_l2</title>
<polygon fill="lightblue" stroke="black" points="732,-2068.29 514,-2068.29 514,-2016.29 732,-2016.29 732,-2068.29"/>
<text text-anchor="middle" x="623" y="-2056.29" font-family="Times,serif" font-size="10.00">Expert 2</text>
<text text-anchor="middle" x="623" y="-2045.29" font-family="Times,serif" font-size="10.00">L2</text>
<text text-anchor="middle" x="623" y="-2034.29" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="623" y="-2023.29" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_gate_l2&#45;&gt;expert2_l2 -->
<g id="edge62" class="edge">
<title>mlp_gate_l2&#45;&gt;expert2_l2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M558.82,-2104.2C569.18,-2094.37 579.75,-2084.33 589.25,-2075.32"/>
<polygon fill="black" stroke="black" points="591.77,-2077.75 596.61,-2068.33 586.95,-2072.68 591.77,-2077.75"/>
</g>
<!-- expert3_l2 -->
<g id="node50" class="node">
<title>expert3_l2</title>
<polygon fill="lightblue" stroke="black" points="968,-2068.29 750,-2068.29 750,-2016.29 968,-2016.29 968,-2068.29"/>
<text text-anchor="middle" x="859" y="-2056.29" font-family="Times,serif" font-size="10.00">Expert 3</text>
<text text-anchor="middle" x="859" y="-2045.29" font-family="Times,serif" font-size="10.00">L2</text>
<text text-anchor="middle" x="859" y="-2034.29" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="859" y="-2023.29" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_gate_l2&#45;&gt;expert3_l2 -->
<g id="edge64" class="edge">
<title>mlp_gate_l2&#45;&gt;expert3_l2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M640.85,-2112.3C684.17,-2098.6 730.97,-2083.79 770.08,-2071.42"/>
<polygon fill="black" stroke="black" points="771.37,-2074.68 779.84,-2068.33 769.25,-2068.01 771.37,-2074.68"/>
</g>
<!-- expert_agg_l2 -->
<g id="node51" class="node">
<title>expert_agg_l2</title>
<polygon fill="yellow" stroke="black" points="782.7,-1980.29 340.94,-1980.29 227.3,-1876.29 669.06,-1876.29 782.7,-1980.29"/>
<text text-anchor="middle" x="505" y="-1942.29" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="505" y="-1931.29" font-family="Times,serif" font-size="10.00">L2</text>
<text text-anchor="middle" x="505" y="-1920.29" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, experts=4, hidden=1024]</text>
<text text-anchor="middle" x="505" y="-1909.29" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- expert0_l2&#45;&gt;expert_agg_l2 -->
<g id="edge59" class="edge">
<title>expert0_l2&#45;&gt;expert_agg_l2</title>
<path fill="none" stroke="black" d="M230.44,-2016.15C261.23,-2006.41 297.73,-1994.86 333.91,-1983.42"/>
<polygon fill="black" stroke="black" points="335.12,-1986.7 343.6,-1980.35 333.01,-1980.03 335.12,-1986.7"/>
</g>
<!-- expert1_l2&#45;&gt;expert_agg_l2 -->
<g id="edge61" class="edge">
<title>expert1_l2&#45;&gt;expert_agg_l2</title>
<path fill="none" stroke="black" d="M413.48,-2016.15C422.54,-2007.56 433.08,-1997.55 443.72,-1987.45"/>
<polygon fill="black" stroke="black" points="446.24,-1989.89 451.08,-1980.46 441.42,-1984.81 446.24,-1989.89"/>
</g>
<!-- expert2_l2&#45;&gt;expert_agg_l2 -->
<g id="edge63" class="edge">
<title>expert2_l2&#45;&gt;expert_agg_l2</title>
<path fill="none" stroke="black" d="M596.52,-2016.15C587.46,-2007.56 576.92,-1997.55 566.28,-1987.45"/>
<polygon fill="black" stroke="black" points="568.58,-1984.81 558.92,-1980.46 563.76,-1989.89 568.58,-1984.81"/>
</g>
<!-- expert3_l2&#45;&gt;expert_agg_l2 -->
<g id="edge65" class="edge">
<title>expert3_l2&#45;&gt;expert_agg_l2</title>
<path fill="none" stroke="black" d="M779.56,-2016.15C748.77,-2006.41 712.27,-1994.86 676.09,-1983.42"/>
<polygon fill="black" stroke="black" points="676.99,-1980.03 666.4,-1980.35 674.88,-1986.7 676.99,-1980.03"/>
</g>
<!-- mlp_fc1_l2 -->
<g id="node52" class="node">
<title>mlp_fc1_l2</title>
<polygon fill="lightblue" stroke="black" points="610,-1840.29 400,-1840.29 400,-1788.29 610,-1788.29 610,-1840.29"/>
<text text-anchor="middle" x="505" y="-1828.29" font-family="Times,serif" font-size="10.00">MLP FC1</text>
<text text-anchor="middle" x="505" y="-1817.29" font-family="Times,serif" font-size="10.00">L2 Col&#45;Parallel</text>
<text text-anchor="middle" x="505" y="-1806.29" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="505" y="-1795.29" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, ffn=512]</text>
</g>
<!-- expert_agg_l2&#45;&gt;mlp_fc1_l2 -->
<g id="edge66" class="edge">
<title>expert_agg_l2&#45;&gt;mlp_fc1_l2</title>
<path fill="none" stroke="black" d="M505,-1876.2C505,-1867.54 505,-1858.71 505,-1850.57"/>
<polygon fill="black" stroke="black" points="508.5,-1850.33 505,-1840.33 501.5,-1850.33 508.5,-1850.33"/>
</g>
<!-- mlp_gelu_l2 -->
<g id="node53" class="node">
<title>mlp_gelu_l2</title>
<polygon fill="lightblue" stroke="black" points="599.5,-1752.29 410.5,-1752.29 410.5,-1700.29 599.5,-1700.29 599.5,-1752.29"/>
<text text-anchor="middle" x="505" y="-1740.29" font-family="Times,serif" font-size="10.00">MLP GELU</text>
<text text-anchor="middle" x="505" y="-1729.29" font-family="Times,serif" font-size="10.00">L2</text>
<text text-anchor="middle" x="505" y="-1718.29" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, ffn=512]</text>
<text text-anchor="middle" x="505" y="-1707.29" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, ffn=512]</text>
</g>
<!-- mlp_fc1_l2&#45;&gt;mlp_gelu_l2 -->
<g id="edge67" class="edge">
<title>mlp_fc1_l2&#45;&gt;mlp_gelu_l2</title>
<path fill="none" stroke="black" d="M505,-1787.95C505,-1779.99 505,-1771.05 505,-1762.53"/>
<polygon fill="black" stroke="black" points="508.5,-1762.44 505,-1752.44 501.5,-1762.44 508.5,-1762.44"/>
</g>
<!-- mlp_fc2_l2 -->
<g id="node54" class="node">
<title>mlp_fc2_l2</title>
<polygon fill="lightblue" stroke="black" points="611,-1664.29 399,-1664.29 399,-1612.29 611,-1612.29 611,-1664.29"/>
<text text-anchor="middle" x="505" y="-1652.29" font-family="Times,serif" font-size="10.00">MLP FC2</text>
<text text-anchor="middle" x="505" y="-1641.29" font-family="Times,serif" font-size="10.00">L2 Row&#45;Parallel</text>
<text text-anchor="middle" x="505" y="-1630.29" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, ffn=512]</text>
<text text-anchor="middle" x="505" y="-1619.29" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=128]</text>
</g>
<!-- mlp_gelu_l2&#45;&gt;mlp_fc2_l2 -->
<g id="edge68" class="edge">
<title>mlp_gelu_l2&#45;&gt;mlp_fc2_l2</title>
<path fill="none" stroke="black" d="M505,-1699.95C505,-1691.99 505,-1683.05 505,-1674.53"/>
<polygon fill="black" stroke="black" points="508.5,-1674.44 505,-1664.44 501.5,-1674.44 508.5,-1674.44"/>
</g>
<!-- mlp_allreduce_l2 -->
<g id="node55" class="node">
<title>mlp_allreduce_l2</title>
<ellipse fill="lightgreen" stroke="black" cx="505" cy="-1531.74" rx="154.3" ry="44.6"/>
<text text-anchor="middle" x="505" y="-1551.24" font-family="Times,serif" font-size="10.00">All&#45;Reduce</text>
<text text-anchor="middle" x="505" y="-1540.24" font-family="Times,serif" font-size="10.00">MLP L2</text>
<text text-anchor="middle" x="505" y="-1529.24" font-family="Times,serif" font-size="10.00">TP Group</text>
<text text-anchor="middle" x="505" y="-1518.24" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="505" y="-1507.24" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_fc2_l2&#45;&gt;mlp_allreduce_l2 -->
<g id="edge69" class="edge">
<title>mlp_fc2_l2&#45;&gt;mlp_allreduce_l2</title>
<path fill="none" stroke="black" d="M505,-1612.24C505,-1604.43 505,-1595.49 505,-1586.5"/>
<polygon fill="black" stroke="black" points="508.5,-1586.37 505,-1576.37 501.5,-1586.37 508.5,-1586.37"/>
</g>
<!-- layernorm_l3 -->
<g id="node56" class="node">
<title>layernorm_l3</title>
<polygon fill="lightblue" stroke="black" points="611,-1451.19 399,-1451.19 399,-1399.19 611,-1399.19 611,-1451.19"/>
<text text-anchor="middle" x="505" y="-1439.19" font-family="Times,serif" font-size="10.00">LayerNorm L3</text>
<text text-anchor="middle" x="505" y="-1428.19" font-family="Times,serif" font-size="10.00">TP Split</text>
<text text-anchor="middle" x="505" y="-1417.19" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="505" y="-1406.19" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=128]</text>
</g>
<!-- mlp_allreduce_l2&#45;&gt;layernorm_l3 -->
<g id="edge70" class="edge">
<title>mlp_allreduce_l2&#45;&gt;layernorm_l3</title>
<path fill="none" stroke="black" d="M505,-1487.01C505,-1478.43 505,-1469.54 505,-1461.29"/>
<polygon fill="black" stroke="black" points="508.5,-1461.25 505,-1451.25 501.5,-1461.25 508.5,-1461.25"/>
</g>
<!-- attn_q_l3 -->
<g id="node57" class="node">
<title>attn_q_l3</title>
<polygon fill="lightblue" stroke="black" points="367.5,-1363.19 128.5,-1363.19 128.5,-1311.19 367.5,-1311.19 367.5,-1363.19"/>
<text text-anchor="middle" x="248" y="-1351.19" font-family="Times,serif" font-size="10.00">Attention Query</text>
<text text-anchor="middle" x="248" y="-1340.19" font-family="Times,serif" font-size="10.00">L3 Col&#45;Parallel</text>
<text text-anchor="middle" x="248" y="-1329.19" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="248" y="-1318.19" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, d_k=64]</text>
</g>
<!-- layernorm_l3&#45;&gt;attn_q_l3 -->
<g id="edge71" class="edge">
<title>layernorm_l3&#45;&gt;attn_q_l3</title>
<path fill="none" stroke="black" d="M429.97,-1399.08C399.5,-1388.89 364.13,-1377.05 332.73,-1366.54"/>
<polygon fill="black" stroke="black" points="333.71,-1363.18 323.12,-1363.33 331.49,-1369.82 333.71,-1363.18"/>
</g>
<!-- attn_k_l3 -->
<g id="node58" class="node">
<title>attn_k_l3</title>
<polygon fill="lightblue" stroke="black" points="624.5,-1363.19 385.5,-1363.19 385.5,-1311.19 624.5,-1311.19 624.5,-1363.19"/>
<text text-anchor="middle" x="505" y="-1351.19" font-family="Times,serif" font-size="10.00">Attention Key</text>
<text text-anchor="middle" x="505" y="-1340.19" font-family="Times,serif" font-size="10.00">L3 Col&#45;Parallel</text>
<text text-anchor="middle" x="505" y="-1329.19" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="505" y="-1318.19" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, d_k=64]</text>
</g>
<!-- layernorm_l3&#45;&gt;attn_k_l3 -->
<g id="edge72" class="edge">
<title>layernorm_l3&#45;&gt;attn_k_l3</title>
<path fill="none" stroke="black" d="M505,-1398.85C505,-1390.89 505,-1381.95 505,-1373.44"/>
<polygon fill="black" stroke="black" points="508.5,-1373.35 505,-1363.35 501.5,-1373.35 508.5,-1373.35"/>
</g>
<!-- attn_v_l3 -->
<g id="node59" class="node">
<title>attn_v_l3</title>
<polygon fill="lightblue" stroke="black" points="772.5,-1275.19 533.5,-1275.19 533.5,-1223.19 772.5,-1223.19 772.5,-1275.19"/>
<text text-anchor="middle" x="653" y="-1263.19" font-family="Times,serif" font-size="10.00">Attention Value</text>
<text text-anchor="middle" x="653" y="-1252.19" font-family="Times,serif" font-size="10.00">L3 Col&#45;Parallel</text>
<text text-anchor="middle" x="653" y="-1241.19" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="653" y="-1230.19" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, d_k=64]</text>
</g>
<!-- layernorm_l3&#45;&gt;attn_v_l3 -->
<g id="edge73" class="edge">
<title>layernorm_l3&#45;&gt;attn_v_l3</title>
<path fill="none" stroke="black" d="M587.39,-1399.06C604.73,-1390.25 621.3,-1378.57 633,-1363.19 649.82,-1341.1 654.25,-1309.57 654.8,-1285.42"/>
<polygon fill="black" stroke="black" points="658.3,-1285.25 654.82,-1275.24 651.3,-1285.24 658.3,-1285.25"/>
</g>
<!-- attn_score_l3 -->
<g id="node60" class="node">
<title>attn_score_l3</title>
<polygon fill="lightblue" stroke="black" points="515,-1275.19 283,-1275.19 283,-1223.19 515,-1223.19 515,-1275.19"/>
<text text-anchor="middle" x="399" y="-1263.19" font-family="Times,serif" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="399" y="-1252.19" font-family="Times,serif" font-size="10.00">L3</text>
<text text-anchor="middle" x="399" y="-1241.19" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, heads=2, d_k=64]</text>
<text text-anchor="middle" x="399" y="-1230.19" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, seq=?]</text>
</g>
<!-- attn_q_l3&#45;&gt;attn_score_l3 -->
<g id="edge74" class="edge">
<title>attn_q_l3&#45;&gt;attn_score_l3</title>
<path fill="none" stroke="black" d="M292.08,-1311.08C308.91,-1301.5 328.27,-1290.47 345.85,-1280.46"/>
<polygon fill="black" stroke="black" points="347.91,-1283.32 354.86,-1275.33 344.44,-1277.24 347.91,-1283.32"/>
</g>
<!-- attn_k_l3&#45;&gt;attn_score_l3 -->
<g id="edge75" class="edge">
<title>attn_k_l3&#45;&gt;attn_score_l3</title>
<path fill="none" stroke="black" d="M474.06,-1311.08C462.83,-1301.98 450.01,-1291.57 438.17,-1281.97"/>
<polygon fill="black" stroke="black" points="440.14,-1279.06 430.17,-1275.48 435.73,-1284.5 440.14,-1279.06"/>
</g>
<!-- attn_out_l3 -->
<g id="node62" class="node">
<title>attn_out_l3</title>
<polygon fill="lightblue" stroke="black" points="641.5,-1099.19 410.5,-1099.19 410.5,-1047.19 641.5,-1047.19 641.5,-1099.19"/>
<text text-anchor="middle" x="526" y="-1087.19" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="526" y="-1076.19" font-family="Times,serif" font-size="10.00">L3 Row&#45;Parallel</text>
<text text-anchor="middle" x="526" y="-1065.19" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, heads=2, d_k=64]</text>
<text text-anchor="middle" x="526" y="-1054.19" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=128]</text>
</g>
<!-- attn_v_l3&#45;&gt;attn_out_l3 -->
<g id="edge78" class="edge">
<title>attn_v_l3&#45;&gt;attn_out_l3</title>
<path fill="none" stroke="black" d="M637.77,-1222.84C623.43,-1199.49 600.93,-1164.18 579,-1135.19 571.87,-1125.76 563.68,-1115.92 555.91,-1106.97"/>
<polygon fill="black" stroke="black" points="558.46,-1104.57 549.23,-1099.37 553.2,-1109.19 558.46,-1104.57"/>
</g>
<!-- attn_softmax_l3 -->
<g id="node61" class="node">
<title>attn_softmax_l3</title>
<polygon fill="lightblue" stroke="black" points="570,-1187.19 338,-1187.19 338,-1135.19 570,-1135.19 570,-1187.19"/>
<text text-anchor="middle" x="454" y="-1175.19" font-family="Times,serif" font-size="10.00">Attention Softmax</text>
<text text-anchor="middle" x="454" y="-1164.19" font-family="Times,serif" font-size="10.00">L3</text>
<text text-anchor="middle" x="454" y="-1153.19" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, heads=2, seq=?]</text>
<text text-anchor="middle" x="454" y="-1142.19" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, heads=2, seq=?]</text>
</g>
<!-- attn_score_l3&#45;&gt;attn_softmax_l3 -->
<g id="edge76" class="edge">
<title>attn_score_l3&#45;&gt;attn_softmax_l3</title>
<path fill="none" stroke="black" d="M415.2,-1222.85C420.58,-1214.46 426.64,-1204.97 432.36,-1196.04"/>
<polygon fill="black" stroke="black" points="435.47,-1197.66 437.91,-1187.35 429.58,-1193.89 435.47,-1197.66"/>
</g>
<!-- attn_softmax_l3&#45;&gt;attn_out_l3 -->
<g id="edge77" class="edge">
<title>attn_softmax_l3&#45;&gt;attn_out_l3</title>
<path fill="none" stroke="black" d="M475.21,-1134.85C482.46,-1126.19 490.68,-1116.38 498.36,-1107.2"/>
<polygon fill="black" stroke="black" points="501.2,-1109.26 504.94,-1099.35 495.84,-1104.77 501.2,-1109.26"/>
</g>
<!-- attn_allreduce_l3 -->
<g id="node63" class="node">
<title>attn_allreduce_l3</title>
<ellipse fill="lightgreen" stroke="black" cx="526" cy="-966.64" rx="154.3" ry="44.6"/>
<text text-anchor="middle" x="526" y="-986.14" font-family="Times,serif" font-size="10.00">All&#45;Reduce</text>
<text text-anchor="middle" x="526" y="-975.14" font-family="Times,serif" font-size="10.00">Attention L3</text>
<text text-anchor="middle" x="526" y="-964.14" font-family="Times,serif" font-size="10.00">TP Group</text>
<text text-anchor="middle" x="526" y="-953.14" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="526" y="-942.14" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- attn_out_l3&#45;&gt;attn_allreduce_l3 -->
<g id="edge79" class="edge">
<title>attn_out_l3&#45;&gt;attn_allreduce_l3</title>
<path fill="none" stroke="black" d="M526,-1047.15C526,-1039.34 526,-1030.4 526,-1021.4"/>
<polygon fill="black" stroke="black" points="529.5,-1021.27 526,-1011.27 522.5,-1021.27 529.5,-1021.27"/>
</g>
<!-- mlp_gate_l3 -->
<g id="node64" class="node">
<title>mlp_gate_l3</title>
<polygon fill="yellow" stroke="black" points="743.94,-886.1 397.25,-886.1 308.06,-782.1 654.75,-782.1 743.94,-886.1"/>
<text text-anchor="middle" x="526" y="-848.1" font-family="Times,serif" font-size="10.00">MLP Gate</text>
<text text-anchor="middle" x="526" y="-837.1" font-family="Times,serif" font-size="10.00">L3</text>
<text text-anchor="middle" x="526" y="-826.1" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="526" y="-815.1" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, experts=4]</text>
</g>
<!-- attn_allreduce_l3&#45;&gt;mlp_gate_l3 -->
<g id="edge80" class="edge">
<title>attn_allreduce_l3&#45;&gt;mlp_gate_l3</title>
<path fill="none" stroke="black" d="M526,-921.81C526,-913.61 526,-904.9 526,-896.29"/>
<polygon fill="black" stroke="black" points="529.5,-896.26 526,-886.26 522.5,-896.26 529.5,-896.26"/>
</g>
<!-- expert0_l3 -->
<g id="node65" class="node">
<title>expert0_l3</title>
<polygon fill="lightblue" stroke="black" points="281,-746.1 63,-746.1 63,-694.1 281,-694.1 281,-746.1"/>
<text text-anchor="middle" x="172" y="-734.1" font-family="Times,serif" font-size="10.00">Expert 0</text>
<text text-anchor="middle" x="172" y="-723.1" font-family="Times,serif" font-size="10.00">L3</text>
<text text-anchor="middle" x="172" y="-712.1" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="172" y="-701.1" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_gate_l3&#45;&gt;expert0_l3 -->
<g id="edge81" class="edge">
<title>mlp_gate_l3&#45;&gt;expert0_l3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M364.8,-782.09C329.07,-770.79 292.48,-759.21 260.91,-749.23"/>
<polygon fill="black" stroke="black" points="261.87,-745.86 251.28,-746.18 259.76,-752.53 261.87,-745.86"/>
</g>
<!-- expert1_l3 -->
<g id="node66" class="node">
<title>expert1_l3</title>
<polygon fill="lightblue" stroke="black" points="517,-746.1 299,-746.1 299,-694.1 517,-694.1 517,-746.1"/>
<text text-anchor="middle" x="408" y="-734.1" font-family="Times,serif" font-size="10.00">Expert 1</text>
<text text-anchor="middle" x="408" y="-723.1" font-family="Times,serif" font-size="10.00">L3</text>
<text text-anchor="middle" x="408" y="-712.1" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="408" y="-701.1" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_gate_l3&#45;&gt;expert1_l3 -->
<g id="edge83" class="edge">
<title>mlp_gate_l3&#45;&gt;expert1_l3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M472.18,-782.01C461.82,-772.18 451.25,-762.14 441.75,-753.13"/>
<polygon fill="black" stroke="black" points="444.05,-750.48 434.39,-746.14 439.23,-755.56 444.05,-750.48"/>
</g>
<!-- expert2_l3 -->
<g id="node67" class="node">
<title>expert2_l3</title>
<polygon fill="lightblue" stroke="black" points="753,-746.1 535,-746.1 535,-694.1 753,-694.1 753,-746.1"/>
<text text-anchor="middle" x="644" y="-734.1" font-family="Times,serif" font-size="10.00">Expert 2</text>
<text text-anchor="middle" x="644" y="-723.1" font-family="Times,serif" font-size="10.00">L3</text>
<text text-anchor="middle" x="644" y="-712.1" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="644" y="-701.1" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_gate_l3&#45;&gt;expert2_l3 -->
<g id="edge85" class="edge">
<title>mlp_gate_l3&#45;&gt;expert2_l3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M579.82,-782.01C590.18,-772.18 600.75,-762.14 610.25,-753.13"/>
<polygon fill="black" stroke="black" points="612.77,-755.56 617.61,-746.14 607.95,-750.48 612.77,-755.56"/>
</g>
<!-- expert3_l3 -->
<g id="node68" class="node">
<title>expert3_l3</title>
<polygon fill="lightblue" stroke="black" points="989,-746.1 771,-746.1 771,-694.1 989,-694.1 989,-746.1"/>
<text text-anchor="middle" x="880" y="-734.1" font-family="Times,serif" font-size="10.00">Expert 3</text>
<text text-anchor="middle" x="880" y="-723.1" font-family="Times,serif" font-size="10.00">L3</text>
<text text-anchor="middle" x="880" y="-712.1" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="880" y="-701.1" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_gate_l3&#45;&gt;expert3_l3 -->
<g id="edge87" class="edge">
<title>mlp_gate_l3&#45;&gt;expert3_l3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M661.85,-790.11C705.17,-776.41 751.97,-761.6 791.08,-749.23"/>
<polygon fill="black" stroke="black" points="792.37,-752.49 800.84,-746.14 790.25,-745.82 792.37,-752.49"/>
</g>
<!-- expert_agg_l3 -->
<g id="node69" class="node">
<title>expert_agg_l3</title>
<polygon fill="yellow" stroke="black" points="803.7,-658.1 361.94,-658.1 248.3,-554.1 690.06,-554.1 803.7,-658.1"/>
<text text-anchor="middle" x="526" y="-620.1" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="526" y="-609.1" font-family="Times,serif" font-size="10.00">L3</text>
<text text-anchor="middle" x="526" y="-598.1" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, experts=4, hidden=1024]</text>
<text text-anchor="middle" x="526" y="-587.1" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- expert0_l3&#45;&gt;expert_agg_l3 -->
<g id="edge82" class="edge">
<title>expert0_l3&#45;&gt;expert_agg_l3</title>
<path fill="none" stroke="black" d="M251.44,-693.96C282.23,-684.22 318.73,-672.67 354.91,-661.23"/>
<polygon fill="black" stroke="black" points="356.12,-664.51 364.6,-658.16 354.01,-657.84 356.12,-664.51"/>
</g>
<!-- expert1_l3&#45;&gt;expert_agg_l3 -->
<g id="edge84" class="edge">
<title>expert1_l3&#45;&gt;expert_agg_l3</title>
<path fill="none" stroke="black" d="M434.48,-693.96C443.54,-685.37 454.08,-675.36 464.72,-665.26"/>
<polygon fill="black" stroke="black" points="467.24,-667.7 472.08,-658.27 462.42,-662.62 467.24,-667.7"/>
</g>
<!-- expert2_l3&#45;&gt;expert_agg_l3 -->
<g id="edge86" class="edge">
<title>expert2_l3&#45;&gt;expert_agg_l3</title>
<path fill="none" stroke="black" d="M617.52,-693.96C608.46,-685.37 597.92,-675.36 587.28,-665.26"/>
<polygon fill="black" stroke="black" points="589.58,-662.62 579.92,-658.27 584.76,-667.7 589.58,-662.62"/>
</g>
<!-- expert3_l3&#45;&gt;expert_agg_l3 -->
<g id="edge88" class="edge">
<title>expert3_l3&#45;&gt;expert_agg_l3</title>
<path fill="none" stroke="black" d="M800.56,-693.96C769.77,-684.22 733.27,-672.67 697.09,-661.23"/>
<polygon fill="black" stroke="black" points="697.99,-657.84 687.4,-658.16 695.88,-664.51 697.99,-657.84"/>
</g>
<!-- mlp_fc1_l3 -->
<g id="node70" class="node">
<title>mlp_fc1_l3</title>
<polygon fill="lightblue" stroke="black" points="631,-518.1 421,-518.1 421,-466.1 631,-466.1 631,-518.1"/>
<text text-anchor="middle" x="526" y="-506.1" font-family="Times,serif" font-size="10.00">MLP FC1</text>
<text text-anchor="middle" x="526" y="-495.1" font-family="Times,serif" font-size="10.00">L3 Col&#45;Parallel</text>
<text text-anchor="middle" x="526" y="-484.1" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="526" y="-473.1" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, ffn=512]</text>
</g>
<!-- expert_agg_l3&#45;&gt;mlp_fc1_l3 -->
<g id="edge89" class="edge">
<title>expert_agg_l3&#45;&gt;mlp_fc1_l3</title>
<path fill="none" stroke="black" d="M526,-554.01C526,-545.35 526,-536.52 526,-528.38"/>
<polygon fill="black" stroke="black" points="529.5,-528.14 526,-518.14 522.5,-528.14 529.5,-528.14"/>
</g>
<!-- mlp_gelu_l3 -->
<g id="node71" class="node">
<title>mlp_gelu_l3</title>
<polygon fill="lightblue" stroke="black" points="620.5,-430.1 431.5,-430.1 431.5,-378.1 620.5,-378.1 620.5,-430.1"/>
<text text-anchor="middle" x="526" y="-418.1" font-family="Times,serif" font-size="10.00">MLP GELU</text>
<text text-anchor="middle" x="526" y="-407.1" font-family="Times,serif" font-size="10.00">L3</text>
<text text-anchor="middle" x="526" y="-396.1" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, ffn=512]</text>
<text text-anchor="middle" x="526" y="-385.1" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, ffn=512]</text>
</g>
<!-- mlp_fc1_l3&#45;&gt;mlp_gelu_l3 -->
<g id="edge90" class="edge">
<title>mlp_fc1_l3&#45;&gt;mlp_gelu_l3</title>
<path fill="none" stroke="black" d="M526,-465.76C526,-457.8 526,-448.86 526,-440.34"/>
<polygon fill="black" stroke="black" points="529.5,-440.25 526,-430.25 522.5,-440.25 529.5,-440.25"/>
</g>
<!-- mlp_fc2_l3 -->
<g id="node72" class="node">
<title>mlp_fc2_l3</title>
<polygon fill="lightblue" stroke="black" points="632,-342.1 420,-342.1 420,-290.1 632,-290.1 632,-342.1"/>
<text text-anchor="middle" x="526" y="-330.1" font-family="Times,serif" font-size="10.00">MLP FC2</text>
<text text-anchor="middle" x="526" y="-319.1" font-family="Times,serif" font-size="10.00">L3 Row&#45;Parallel</text>
<text text-anchor="middle" x="526" y="-308.1" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, ffn=512]</text>
<text text-anchor="middle" x="526" y="-297.1" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=128]</text>
</g>
<!-- mlp_gelu_l3&#45;&gt;mlp_fc2_l3 -->
<g id="edge91" class="edge">
<title>mlp_gelu_l3&#45;&gt;mlp_fc2_l3</title>
<path fill="none" stroke="black" d="M526,-377.76C526,-369.8 526,-360.86 526,-352.34"/>
<polygon fill="black" stroke="black" points="529.5,-352.25 526,-342.25 522.5,-352.25 529.5,-352.25"/>
</g>
<!-- mlp_allreduce_l3 -->
<g id="node73" class="node">
<title>mlp_allreduce_l3</title>
<ellipse fill="lightgreen" stroke="black" cx="526" cy="-209.55" rx="154.3" ry="44.6"/>
<text text-anchor="middle" x="526" y="-229.05" font-family="Times,serif" font-size="10.00">All&#45;Reduce</text>
<text text-anchor="middle" x="526" y="-218.05" font-family="Times,serif" font-size="10.00">MLP L3</text>
<text text-anchor="middle" x="526" y="-207.05" font-family="Times,serif" font-size="10.00">TP Group</text>
<text text-anchor="middle" x="526" y="-196.05" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=128]</text>
<text text-anchor="middle" x="526" y="-185.05" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- mlp_fc2_l3&#45;&gt;mlp_allreduce_l3 -->
<g id="edge92" class="edge">
<title>mlp_fc2_l3&#45;&gt;mlp_allreduce_l3</title>
<path fill="none" stroke="black" d="M526,-290.05C526,-282.24 526,-273.3 526,-264.31"/>
<polygon fill="black" stroke="black" points="529.5,-264.18 526,-254.18 522.5,-264.18 529.5,-264.18"/>
</g>
<!-- more_layers -->
<g id="node74" class="node">
<title>more_layers</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="575,-129 477,-129 477,-88 575,-88 575,-129"/>
<text text-anchor="middle" x="526" y="-117" font-family="Times,serif" font-size="10.00">...</text>
<text text-anchor="middle" x="526" y="-106" font-family="Times,serif" font-size="10.00">12 More Layers</text>
<text text-anchor="middle" x="526" y="-95" font-family="Times,serif" font-size="10.00">(Similar Pattern)</text>
</g>
<!-- mlp_allreduce_l3&#45;&gt;more_layers -->
<g id="edge93" class="edge">
<title>mlp_allreduce_l3&#45;&gt;more_layers</title>
<path fill="none" stroke="black" d="M526,-164.82C526,-156.17 526,-147.28 526,-139.23"/>
<polygon fill="black" stroke="black" points="529.5,-139.22 526,-129.22 522.5,-139.22 529.5,-139.22"/>
</g>
<!-- output -->
<g id="node75" class="node">
<title>output</title>
<polygon fill="lightblue" stroke="black" points="635,-52 417,-52 417,0 635,0 635,-52"/>
<text text-anchor="middle" x="526" y="-40" font-family="Times,serif" font-size="10.00">Output</text>
<text text-anchor="middle" x="526" y="-29" font-family="Times,serif" font-size="10.00">DP Replica</text>
<text text-anchor="middle" x="526" y="-18" font-family="Times,serif" font-size="10.00">Input: [batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="526" y="-7" font-family="Times,serif" font-size="10.00">Output: [batch=?, seq=?, hidden=1024]</text>
</g>
<!-- more_layers&#45;&gt;output -->
<g id="edge94" class="edge">
<title>more_layers&#45;&gt;output</title>
<path fill="none" stroke="black" d="M526,-87.6C526,-79.99 526,-71.06 526,-62.43"/>
<polygon fill="black" stroke="black" points="529.5,-62.16 526,-52.16 522.5,-62.16 529.5,-62.16"/>
</g>
<!-- tp_comm -->
<g id="node76" class="node">
<title>tp_comm</title>
<ellipse fill="lightgreen" stroke="black" cx="681" cy="-5479.76" rx="112.36" ry="21.43"/>
<text text-anchor="middle" x="681" y="-5482.76" font-family="Times,serif" font-size="10.00">Tensor Parallel</text>
<text text-anchor="middle" x="681" y="-5471.76" font-family="Times,serif" font-size="10.00">All&#45;Reduce Communications</text>
</g>
<!-- ep_comm -->
<g id="node77" class="node">
<title>ep_comm</title>
<ellipse fill="lightgreen" stroke="black" cx="913" cy="-5479.76" rx="101.65" ry="21.43"/>
<text text-anchor="middle" x="913" y="-5482.76" font-family="Times,serif" font-size="10.00">Expert Parallel</text>
<text text-anchor="middle" x="913" y="-5471.76" font-family="Times,serif" font-size="10.00">Routing Communications</text>
</g>
<!-- dp_comm -->
<g id="node78" class="node">
<title>dp_comm</title>
<ellipse fill="lightgreen" stroke="black" cx="1094" cy="-5479.76" rx="61.54" ry="21.43"/>
<text text-anchor="middle" x="1094" y="-5482.76" font-family="Times,serif" font-size="10.00">Data Parallel</text>
<text text-anchor="middle" x="1094" y="-5471.76" font-family="Times,serif" font-size="10.00">Gradient Sync</text>
</g>
</g>
</svg>
