<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="2492pt" height="1791pt"
 viewBox="0.00 0.00 2492.00 1790.88" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1786.88)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1786.88 2488,-1786.88 2488,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_input</title>
<path fill="none" stroke="black" d="M801,-1639.71C801,-1639.71 1429,-1639.71 1429,-1639.71 1435,-1639.71 1441,-1645.71 1441,-1651.71 1441,-1651.71 1441,-1762.88 1441,-1762.88 1441,-1768.88 1435,-1774.88 1429,-1774.88 1429,-1774.88 801,-1774.88 801,-1774.88 795,-1774.88 789,-1768.88 789,-1762.88 789,-1762.88 789,-1651.71 789,-1651.71 789,-1645.71 795,-1639.71 801,-1639.71"/>
<text text-anchor="middle" x="1115" y="-1759.68" font-family="Times,serif" font-size="14.00">Input Stage</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_embedding</title>
<path fill="none" stroke="blue" d="M907,-1033.55C907,-1033.55 1323,-1033.55 1323,-1033.55 1329,-1033.55 1335,-1039.55 1335,-1045.55 1335,-1045.55 1335,-1619.71 1335,-1619.71 1335,-1625.71 1329,-1631.71 1323,-1631.71 1323,-1631.71 907,-1631.71 907,-1631.71 901,-1631.71 895,-1625.71 895,-1619.71 895,-1619.71 895,-1045.55 895,-1045.55 895,-1039.55 901,-1033.55 907,-1033.55"/>
<text text-anchor="middle" x="1115" y="-1616.51" font-family="Times,serif" font-size="14.00">Embedding Stage (TP&#45;2)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_expert</title>
<path fill="none" stroke="green" d="M20,-350.96C20,-350.96 2022,-350.96 2022,-350.96 2028,-350.96 2034,-356.96 2034,-362.96 2034,-362.96 2034,-1013.55 2034,-1013.55 2034,-1019.55 2028,-1025.55 2022,-1025.55 2022,-1025.55 20,-1025.55 20,-1025.55 14,-1025.55 8,-1019.55 8,-1013.55 8,-1013.55 8,-362.96 8,-362.96 8,-356.96 14,-350.96 20,-350.96"/>
<text text-anchor="middle" x="1021" y="-1010.35" font-family="Times,serif" font-size="14.00">Expert Parallel Stage (EP&#45;64)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_aggregation</title>
<path fill="none" stroke="orange" d="M2067,-172.38C2067,-172.38 2464,-172.38 2464,-172.38 2470,-172.38 2476,-178.38 2476,-184.38 2476,-184.38 2476,-806.63 2476,-806.63 2476,-812.63 2470,-818.63 2464,-818.63 2464,-818.63 2067,-818.63 2067,-818.63 2061,-818.63 2055,-812.63 2055,-806.63 2055,-806.63 2055,-184.38 2055,-184.38 2055,-178.38 2061,-172.38 2067,-172.38"/>
<text text-anchor="middle" x="2265.5" y="-803.43" font-family="Times,serif" font-size="14.00">Aggregation Stage (TP&#45;2)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_output</title>
<path fill="none" stroke="black" d="M2132,-8C2132,-8 2398,-8 2398,-8 2404,-8 2410,-14 2410,-20 2410,-20 2410,-152.38 2410,-152.38 2410,-158.38 2404,-164.38 2398,-164.38 2398,-164.38 2132,-164.38 2132,-164.38 2126,-164.38 2120,-158.38 2120,-152.38 2120,-152.38 2120,-20 2120,-20 2120,-14 2126,-8 2132,-8"/>
<text text-anchor="middle" x="2265" y="-149.18" font-family="Times,serif" font-size="14.00">Output Stage</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="white" stroke="black" cx="1115" cy="-1695.8" rx="318.4" ry="48.17"/>
<text text-anchor="middle" x="1115" y="-1714.6" font-family="Times,serif" font-size="14.00">Input Layer</text>
<text text-anchor="middle" x="1115" y="-1699.6" font-family="Times,serif" font-size="14.00">GPU: All</text>
<text text-anchor="middle" x="1115" y="-1684.6" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=1024]</text>
<text text-anchor="middle" x="1115" y="-1669.6" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=1024, hidden_size=1024]</text>
</g>
<!-- split_embed -->
<g id="node2" class="node">
<title>split_embed</title>
<polygon fill="lightgray" stroke="black" points="1306.6,-1600.71 1001.81,-1600.71 923.4,-1464.71 1228.19,-1464.71 1306.6,-1600.71"/>
<text text-anchor="middle" x="1115" y="-1551.51" font-family="Times,serif" font-size="14.00">Split Input</text>
<text text-anchor="middle" x="1115" y="-1536.51" font-family="Times,serif" font-size="14.00">GPU: 0,1</text>
<text text-anchor="middle" x="1115" y="-1521.51" font-family="Times,serif" font-size="14.00">Input: [128,1024,1024]</text>
<text text-anchor="middle" x="1115" y="-1506.51" font-family="Times,serif" font-size="14.00">Output: [128,1024,512]</text>
</g>
<!-- input&#45;&gt;split_embed -->
<g id="edge1" class="edge">
<title>input&#45;&gt;split_embed</title>
<path fill="none" stroke="black" d="M1115,-1647.34C1115,-1635.95 1115,-1623.5 1115,-1611.15"/>
<polygon fill="black" stroke="black" points="1118.5,-1610.82 1115,-1600.82 1111.5,-1610.82 1118.5,-1610.82"/>
</g>
<!-- embed_0 -->
<g id="node3" class="node">
<title>embed_0</title>
<polygon fill="lightblue" stroke="black" points="1097,-1428.71 903,-1428.71 903,-1345.71 1097,-1345.71 1097,-1428.71"/>
<text text-anchor="middle" x="1000" y="-1413.51" font-family="Times,serif" font-size="14.00">Embedding Layer 0</text>
<text text-anchor="middle" x="1000" y="-1398.51" font-family="Times,serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="1000" y="-1383.51" font-family="Times,serif" font-size="14.00">Input: [128,1024,512]</text>
<text text-anchor="middle" x="1000" y="-1368.51" font-family="Times,serif" font-size="14.00">Output: [128,1024,2048]</text>
<text text-anchor="middle" x="1000" y="-1353.51" font-family="Times,serif" font-size="14.00">Weight: [1024,2048]</text>
</g>
<!-- split_embed&#45;&gt;embed_0 -->
<g id="edge2" class="edge">
<title>split_embed&#45;&gt;embed_0</title>
<path fill="none" stroke="black" d="M1061.2,-1464.58C1053.68,-1455.2 1046.08,-1445.71 1038.91,-1436.76"/>
<polygon fill="black" stroke="black" points="1041.44,-1434.33 1032.46,-1428.72 1035.98,-1438.71 1041.44,-1434.33"/>
</g>
<!-- embed_1 -->
<g id="node4" class="node">
<title>embed_1</title>
<polygon fill="lightblue" stroke="black" points="1327,-1428.71 1133,-1428.71 1133,-1345.71 1327,-1345.71 1327,-1428.71"/>
<text text-anchor="middle" x="1230" y="-1413.51" font-family="Times,serif" font-size="14.00">Embedding Layer 1</text>
<text text-anchor="middle" x="1230" y="-1398.51" font-family="Times,serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="1230" y="-1383.51" font-family="Times,serif" font-size="14.00">Input: [128,1024,512]</text>
<text text-anchor="middle" x="1230" y="-1368.51" font-family="Times,serif" font-size="14.00">Output: [128,1024,2048]</text>
<text text-anchor="middle" x="1230" y="-1353.51" font-family="Times,serif" font-size="14.00">Weight: [1024,2048]</text>
</g>
<!-- split_embed&#45;&gt;embed_1 -->
<g id="edge3" class="edge">
<title>split_embed&#45;&gt;embed_1</title>
<path fill="none" stroke="black" d="M1168.8,-1464.58C1176.32,-1455.2 1183.92,-1445.71 1191.09,-1436.76"/>
<polygon fill="black" stroke="black" points="1194.02,-1438.71 1197.54,-1428.72 1188.56,-1434.33 1194.02,-1438.71"/>
</g>
<!-- embed_allreduce -->
<g id="node5" class="node">
<title>embed_allreduce</title>
<ellipse fill="lightcoral" stroke="black" cx="1115" cy="-1261.63" rx="137.36" ry="48.17"/>
<text text-anchor="middle" x="1115" y="-1280.43" font-family="Times,serif" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1115" y="-1265.43" font-family="Times,serif" font-size="14.00">GPU: 0,1</text>
<text text-anchor="middle" x="1115" y="-1250.43" font-family="Times,serif" font-size="14.00">Input: [128,1024,2048]</text>
<text text-anchor="middle" x="1115" y="-1235.43" font-family="Times,serif" font-size="14.00">Output: [128,1024,2048]</text>
</g>
<!-- embed_0&#45;&gt;embed_allreduce -->
<g id="edge4" class="edge">
<title>embed_0&#45;&gt;embed_allreduce</title>
<path fill="none" stroke="black" d="M1037.97,-1345.4C1047.03,-1335.67 1056.82,-1325.15 1066.28,-1314.99"/>
<polygon fill="black" stroke="black" points="1068.85,-1317.36 1073.1,-1307.66 1063.72,-1312.59 1068.85,-1317.36"/>
</g>
<!-- embed_1&#45;&gt;embed_allreduce -->
<g id="edge5" class="edge">
<title>embed_1&#45;&gt;embed_allreduce</title>
<path fill="none" stroke="black" d="M1192.03,-1345.4C1182.97,-1335.67 1173.18,-1325.15 1163.72,-1314.99"/>
<polygon fill="black" stroke="black" points="1166.28,-1312.59 1156.9,-1307.66 1161.15,-1317.36 1166.28,-1312.59"/>
</g>
<!-- embed_merge -->
<g id="node6" class="node">
<title>embed_merge</title>
<polygon fill="lightgray" stroke="black" points="1316.26,-1177.55 996.1,-1177.55 913.74,-1041.55 1233.9,-1041.55 1316.26,-1177.55"/>
<text text-anchor="middle" x="1115" y="-1128.35" font-family="Times,serif" font-size="14.00">Merge Embeddings</text>
<text text-anchor="middle" x="1115" y="-1113.35" font-family="Times,serif" font-size="14.00">GPU: 0,1</text>
<text text-anchor="middle" x="1115" y="-1098.35" font-family="Times,serif" font-size="14.00">Input: [128,1024,2048]</text>
<text text-anchor="middle" x="1115" y="-1083.35" font-family="Times,serif" font-size="14.00">Output: [128,1024,1024]</text>
</g>
<!-- embed_allreduce&#45;&gt;embed_merge -->
<g id="edge6" class="edge">
<title>embed_allreduce&#45;&gt;embed_merge</title>
<path fill="none" stroke="black" d="M1115,-1213.14C1115,-1205.06 1115,-1196.47 1115,-1187.85"/>
<polygon fill="black" stroke="black" points="1118.5,-1187.74 1115,-1177.74 1111.5,-1187.74 1118.5,-1187.74"/>
</g>
<!-- broadcast_expert -->
<g id="node7" class="node">
<title>broadcast_expert</title>
<ellipse fill="lightcoral" stroke="black" cx="1115" cy="-926.55" rx="137.36" ry="48.17"/>
<text text-anchor="middle" x="1115" y="-945.35" font-family="Times,serif" font-size="14.00">Broadcast to Experts</text>
<text text-anchor="middle" x="1115" y="-930.35" font-family="Times,serif" font-size="14.00">GPU: 0,1 → 2&#45;65</text>
<text text-anchor="middle" x="1115" y="-915.35" font-family="Times,serif" font-size="14.00">Input: [128,1024,1024]</text>
<text text-anchor="middle" x="1115" y="-900.35" font-family="Times,serif" font-size="14.00">Output: [128,1024,1024]</text>
</g>
<!-- embed_merge&#45;&gt;broadcast_expert -->
<g id="edge7" class="edge">
<title>embed_merge&#45;&gt;broadcast_expert</title>
<path fill="none" stroke="black" d="M1115,-1041.41C1115,-1022.82 1115,-1002.82 1115,-984.84"/>
<polygon fill="black" stroke="black" points="1118.5,-984.81 1115,-974.81 1111.5,-984.81 1118.5,-984.81"/>
</g>
<!-- gate_compute -->
<g id="node8" class="node">
<title>gate_compute</title>
<polygon fill="lightpink" stroke="black" points="1070.88,-822.55 770.42,-822.55 693.12,-656.55 993.58,-656.55 1070.88,-822.55"/>
<text text-anchor="middle" x="882" y="-765.85" font-family="Times,serif" font-size="14.00">Gate Computation</text>
<text text-anchor="middle" x="882" y="-750.85" font-family="Times,serif" font-size="14.00">GPU: 2&#45;65</text>
<text text-anchor="middle" x="882" y="-735.85" font-family="Times,serif" font-size="14.00">Input: [128,1024,1024]</text>
<text text-anchor="middle" x="882" y="-720.85" font-family="Times,serif" font-size="14.00">Output: [128,1024,64]</text>
<text text-anchor="middle" x="882" y="-705.85" font-family="Times,serif" font-size="14.00">(gate scores)</text>
</g>
<!-- broadcast_expert&#45;&gt;gate_compute -->
<g id="edge8" class="edge">
<title>broadcast_expert&#45;&gt;gate_compute</title>
<path fill="none" stroke="black" d="M1060.37,-882.17C1040.31,-866.24 1016.8,-847.58 993.56,-829.12"/>
<polygon fill="black" stroke="black" points="995.7,-826.35 985.69,-822.87 991.34,-831.83 995.7,-826.35"/>
</g>
<!-- alltoall_expert -->
<g id="node19" class="node">
<title>alltoall_expert</title>
<ellipse fill="lightcoral" stroke="black" cx="1348" cy="-739.55" rx="137.77" ry="37.45"/>
<text text-anchor="middle" x="1348" y="-750.85" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="1348" y="-735.85" font-family="Times,serif" font-size="14.00">GPU: 2&#45;65</text>
<text text-anchor="middle" x="1348" y="-720.85" font-family="Times,serif" font-size="14.00">Routes tokens to experts</text>
</g>
<!-- broadcast_expert&#45;&gt;alltoall_expert -->
<g id="edge19" class="edge">
<title>broadcast_expert&#45;&gt;alltoall_expert</title>
<path fill="none" stroke="black" d="M1169.63,-882.17C1207.77,-851.89 1258.37,-811.71 1295.94,-781.88"/>
<polygon fill="black" stroke="black" points="1298.57,-784.26 1304.22,-775.3 1294.22,-778.78 1298.57,-784.26"/>
</g>
<!-- expert_select -->
<g id="node9" class="node">
<title>expert_select</title>
<polygon fill="lightpink" stroke="black" points="870.13,-620.55 542.22,-620.55 457.87,-484.55 785.78,-484.55 870.13,-620.55"/>
<text text-anchor="middle" x="664" y="-571.35" font-family="Times,serif" font-size="14.00">Expert Selection</text>
<text text-anchor="middle" x="664" y="-556.35" font-family="Times,serif" font-size="14.00">GPU: 2&#45;65</text>
<text text-anchor="middle" x="664" y="-541.35" font-family="Times,serif" font-size="14.00">Input: [128,1024,64]</text>
<text text-anchor="middle" x="664" y="-526.35" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
</g>
<!-- gate_compute&#45;&gt;expert_select -->
<g id="edge9" class="edge">
<title>gate_compute&#45;&gt;expert_select</title>
<path fill="none" stroke="black" d="M785.11,-656.33C773.75,-646.68 762.21,-636.89 750.99,-627.37"/>
<polygon fill="black" stroke="black" points="753.17,-624.63 743.28,-620.83 748.64,-629.96 753.17,-624.63"/>
</g>
<!-- expert_2 -->
<g id="node10" class="node">
<title>expert_2</title>
<polygon fill="lightgreen" stroke="black" points="210,-441.96 16,-441.96 16,-358.96 210,-358.96 210,-441.96"/>
<text text-anchor="middle" x="113" y="-426.76" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="113" y="-411.76" font-family="Times,serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="113" y="-396.76" font-family="Times,serif" font-size="14.00">Input: [128,1024,1024]</text>
<text text-anchor="middle" x="113" y="-381.76" font-family="Times,serif" font-size="14.00">Output: [128,1024,2048]</text>
<text text-anchor="middle" x="113" y="-366.76" font-family="Times,serif" font-size="14.00">Weight: [1024,2048]</text>
</g>
<!-- expert_select&#45;&gt;expert_2 -->
<g id="edge10" class="edge">
<title>expert_select&#45;&gt;expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M476.06,-513.91C398.5,-496.64 308.17,-474.25 228,-448.55 224.87,-447.54 221.7,-446.49 218.51,-445.4"/>
<polygon fill="black" stroke="black" points="219.5,-442.04 208.91,-442.02 217.18,-448.64 219.5,-442.04"/>
</g>
<!-- expert_3 -->
<g id="node11" class="node">
<title>expert_3</title>
<polygon fill="lightgreen" stroke="black" points="440,-441.96 246,-441.96 246,-358.96 440,-358.96 440,-441.96"/>
<text text-anchor="middle" x="343" y="-426.76" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="343" y="-411.76" font-family="Times,serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="343" y="-396.76" font-family="Times,serif" font-size="14.00">Input: [128,1024,1024]</text>
<text text-anchor="middle" x="343" y="-381.76" font-family="Times,serif" font-size="14.00">Output: [128,1024,2048]</text>
<text text-anchor="middle" x="343" y="-366.76" font-family="Times,serif" font-size="14.00">Weight: [1024,2048]</text>
</g>
<!-- expert_select&#45;&gt;expert_3 -->
<g id="edge11" class="edge">
<title>expert_select&#45;&gt;expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M520.4,-484.41C492.9,-471.55 464.72,-458.37 439.16,-446.42"/>
<polygon fill="black" stroke="black" points="440.41,-443.14 429.86,-442.08 437.44,-449.48 440.41,-443.14"/>
</g>
<!-- expert_4 -->
<g id="node12" class="node">
<title>expert_4</title>
<polygon fill="lightgreen" stroke="black" points="670,-441.96 476,-441.96 476,-358.96 670,-358.96 670,-441.96"/>
<text text-anchor="middle" x="573" y="-426.76" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="573" y="-411.76" font-family="Times,serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="573" y="-396.76" font-family="Times,serif" font-size="14.00">Input: [128,1024,1024]</text>
<text text-anchor="middle" x="573" y="-381.76" font-family="Times,serif" font-size="14.00">Output: [128,1024,2048]</text>
<text text-anchor="middle" x="573" y="-366.76" font-family="Times,serif" font-size="14.00">Weight: [1024,2048]</text>
</g>
<!-- expert_select&#45;&gt;expert_4 -->
<g id="edge12" class="edge">
<title>expert_select&#45;&gt;expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M623.29,-484.41C616.49,-473.19 609.54,-461.73 603.07,-451.05"/>
<polygon fill="black" stroke="black" points="605.93,-449.02 597.75,-442.29 599.95,-452.65 605.93,-449.02"/>
</g>
<!-- expert_5 -->
<g id="node13" class="node">
<title>expert_5</title>
<polygon fill="lightgreen" stroke="black" points="900,-441.96 706,-441.96 706,-358.96 900,-358.96 900,-441.96"/>
<text text-anchor="middle" x="803" y="-426.76" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="803" y="-411.76" font-family="Times,serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="803" y="-396.76" font-family="Times,serif" font-size="14.00">Input: [128,1024,1024]</text>
<text text-anchor="middle" x="803" y="-381.76" font-family="Times,serif" font-size="14.00">Output: [128,1024,2048]</text>
<text text-anchor="middle" x="803" y="-366.76" font-family="Times,serif" font-size="14.00">Weight: [1024,2048]</text>
</g>
<!-- expert_select&#45;&gt;expert_5 -->
<g id="edge13" class="edge">
<title>expert_select&#45;&gt;expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M726.18,-484.41C736.99,-472.74 748.03,-460.81 758.26,-449.77"/>
<polygon fill="black" stroke="black" points="760.96,-452 765.19,-442.29 755.83,-447.25 760.96,-452"/>
</g>
<!-- expert_6 -->
<g id="node14" class="node">
<title>expert_6</title>
<polygon fill="lightgreen" stroke="black" points="1130,-441.96 936,-441.96 936,-358.96 1130,-358.96 1130,-441.96"/>
<text text-anchor="middle" x="1033" y="-426.76" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1033" y="-411.76" font-family="Times,serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="1033" y="-396.76" font-family="Times,serif" font-size="14.00">Input: [128,1024,1024]</text>
<text text-anchor="middle" x="1033" y="-381.76" font-family="Times,serif" font-size="14.00">Output: [128,1024,2048]</text>
<text text-anchor="middle" x="1033" y="-366.76" font-family="Times,serif" font-size="14.00">Weight: [1024,2048]</text>
</g>
<!-- expert_select&#45;&gt;expert_6 -->
<g id="edge14" class="edge">
<title>expert_select&#45;&gt;expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M794.56,-498.7C834.21,-482.62 877.9,-464.89 918,-448.55 920.72,-447.44 923.47,-446.32 926.24,-445.19"/>
<polygon fill="black" stroke="black" points="927.82,-448.32 935.76,-441.3 925.18,-441.84 927.82,-448.32"/>
</g>
<!-- expert_7 -->
<g id="node15" class="node">
<title>expert_7</title>
<polygon fill="lightgreen" stroke="black" points="1360,-441.96 1166,-441.96 1166,-358.96 1360,-358.96 1360,-441.96"/>
<text text-anchor="middle" x="1263" y="-426.76" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1263" y="-411.76" font-family="Times,serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="1263" y="-396.76" font-family="Times,serif" font-size="14.00">Input: [128,1024,1024]</text>
<text text-anchor="middle" x="1263" y="-381.76" font-family="Times,serif" font-size="14.00">Output: [128,1024,2048]</text>
<text text-anchor="middle" x="1263" y="-366.76" font-family="Times,serif" font-size="14.00">Weight: [1024,2048]</text>
</g>
<!-- expert_select&#45;&gt;expert_7 -->
<g id="edge15" class="edge">
<title>expert_select&#45;&gt;expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M799.95,-507.26C828.81,-498.88 859.24,-490.8 888,-484.55 1001.99,-459.76 1035.36,-478.89 1148,-448.55 1151.87,-447.5 1155.79,-446.36 1159.73,-445.15"/>
<polygon fill="black" stroke="black" points="1161.09,-448.38 1169.53,-441.97 1158.93,-441.72 1161.09,-448.38"/>
</g>
<!-- expert_8 -->
<g id="node16" class="node">
<title>expert_8</title>
<polygon fill="lightgreen" stroke="black" points="1590,-441.96 1396,-441.96 1396,-358.96 1590,-358.96 1590,-441.96"/>
<text text-anchor="middle" x="1493" y="-426.76" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1493" y="-411.76" font-family="Times,serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="1493" y="-396.76" font-family="Times,serif" font-size="14.00">Input: [128,1024,1024]</text>
<text text-anchor="middle" x="1493" y="-381.76" font-family="Times,serif" font-size="14.00">Output: [128,1024,2048]</text>
<text text-anchor="middle" x="1493" y="-366.76" font-family="Times,serif" font-size="14.00">Weight: [1024,2048]</text>
</g>
<!-- expert_select&#45;&gt;expert_8 -->
<g id="edge16" class="edge">
<title>expert_select&#45;&gt;expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M799.37,-505.92C828.33,-497.61 858.96,-489.89 888,-484.55 1102.76,-445.03 1165.43,-498.53 1378,-448.55 1382.43,-447.5 1386.91,-446.31 1391.41,-445.01"/>
<polygon fill="black" stroke="black" points="1392.73,-448.26 1401.25,-441.97 1390.67,-441.57 1392.73,-448.26"/>
</g>
<!-- expert_9 -->
<g id="node17" class="node">
<title>expert_9</title>
<polygon fill="lightgreen" stroke="black" points="1820,-441.96 1626,-441.96 1626,-358.96 1820,-358.96 1820,-441.96"/>
<text text-anchor="middle" x="1723" y="-426.76" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="1723" y="-411.76" font-family="Times,serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="1723" y="-396.76" font-family="Times,serif" font-size="14.00">Input: [128,1024,1024]</text>
<text text-anchor="middle" x="1723" y="-381.76" font-family="Times,serif" font-size="14.00">Output: [128,1024,2048]</text>
<text text-anchor="middle" x="1723" y="-366.76" font-family="Times,serif" font-size="14.00">Weight: [1024,2048]</text>
</g>
<!-- expert_select&#45;&gt;expert_9 -->
<g id="edge17" class="edge">
<title>expert_select&#45;&gt;expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M798.98,-505.48C828.03,-497.17 858.8,-489.57 888,-484.55 1203.76,-430.25 1295.27,-518.24 1608,-448.55 1612.69,-447.5 1617.43,-446.28 1622.18,-444.93"/>
<polygon fill="black" stroke="black" points="1623.39,-448.22 1631.94,-441.97 1621.35,-441.52 1623.39,-448.22"/>
</g>
<!-- experts_ellipsis -->
<g id="node18" class="node">
<title>experts_ellipsis</title>
<text text-anchor="middle" x="1941" y="-404.26" font-family="Times,serif" font-size="14.00">... 56 more experts ...</text>
<text text-anchor="middle" x="1941" y="-389.26" font-family="Times,serif" font-size="14.00">GPUs: 10&#45;65</text>
</g>
<!-- expert_select&#45;&gt;experts_ellipsis -->
<g id="edge18" class="edge">
<title>expert_select&#45;&gt;experts_ellipsis</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M798.93,-505.21C827.99,-496.92 858.77,-489.39 888,-484.55 1096.42,-450 1632.46,-497.39 1838,-448.55 1859.6,-443.41 1882.19,-433.65 1900.68,-424.33"/>
<polygon fill="black" stroke="black" points="1902.41,-427.38 1909.69,-419.68 1899.2,-421.16 1902.41,-427.38"/>
</g>
<!-- expert_compute_2 -->
<g id="node20" class="node">
<title>expert_compute_2</title>
<polygon fill="lightgreen" stroke="black" points="2026,-586.55 1832,-586.55 1832,-518.55 2026,-518.55 2026,-586.55"/>
<text text-anchor="middle" x="1929" y="-571.35" font-family="Times,serif" font-size="14.00">Expert 0 Compute</text>
<text text-anchor="middle" x="1929" y="-556.35" font-family="Times,serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="1929" y="-541.35" font-family="Times,serif" font-size="14.00">Input: routed tokens</text>
<text text-anchor="middle" x="1929" y="-526.35" font-family="Times,serif" font-size="14.00">Output: [128,1024,2048]</text>
</g>
<!-- alltoall_expert&#45;&gt;expert_compute_2 -->
<g id="edge20" class="edge">
<title>alltoall_expert&#45;&gt;expert_compute_2</title>
<path fill="none" stroke="black" d="M1462.88,-718.77C1558.97,-700.04 1698.5,-667.72 1814,-620.55 1833.04,-612.77 1852.73,-602.31 1870.33,-591.96"/>
<polygon fill="black" stroke="black" points="1872.55,-594.71 1879.33,-586.58 1868.95,-588.71 1872.55,-594.71"/>
</g>
<!-- expert_compute_3 -->
<g id="node21" class="node">
<title>expert_compute_3</title>
<polygon fill="lightgreen" stroke="black" points="1100,-586.55 906,-586.55 906,-518.55 1100,-518.55 1100,-586.55"/>
<text text-anchor="middle" x="1003" y="-571.35" font-family="Times,serif" font-size="14.00">Expert 1 Compute</text>
<text text-anchor="middle" x="1003" y="-556.35" font-family="Times,serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="1003" y="-541.35" font-family="Times,serif" font-size="14.00">Input: routed tokens</text>
<text text-anchor="middle" x="1003" y="-526.35" font-family="Times,serif" font-size="14.00">Output: [128,1024,2048]</text>
</g>
<!-- alltoall_expert&#45;&gt;expert_compute_3 -->
<g id="edge21" class="edge">
<title>alltoall_expert&#45;&gt;expert_compute_3</title>
<path fill="none" stroke="black" d="M1283.07,-706.4C1236.74,-683.17 1173.12,-650.71 1118,-620.55 1101.5,-611.51 1083.86,-601.45 1067.48,-591.92"/>
<polygon fill="black" stroke="black" points="1068.92,-588.71 1058.52,-586.7 1065.39,-594.76 1068.92,-588.71"/>
</g>
<!-- expert_compute_4 -->
<g id="node22" class="node">
<title>expert_compute_4</title>
<polygon fill="lightgreen" stroke="black" points="1330,-586.55 1136,-586.55 1136,-518.55 1330,-518.55 1330,-586.55"/>
<text text-anchor="middle" x="1233" y="-571.35" font-family="Times,serif" font-size="14.00">Expert 2 Compute</text>
<text text-anchor="middle" x="1233" y="-556.35" font-family="Times,serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="1233" y="-541.35" font-family="Times,serif" font-size="14.00">Input: routed tokens</text>
<text text-anchor="middle" x="1233" y="-526.35" font-family="Times,serif" font-size="14.00">Output: [128,1024,2048]</text>
</g>
<!-- alltoall_expert&#45;&gt;expert_compute_4 -->
<g id="edge22" class="edge">
<title>alltoall_expert&#45;&gt;expert_compute_4</title>
<path fill="none" stroke="black" d="M1325.55,-702.44C1306.49,-671.78 1279.13,-627.75 1259.09,-595.52"/>
<polygon fill="black" stroke="black" points="1261.9,-593.41 1253.65,-586.77 1255.96,-597.11 1261.9,-593.41"/>
</g>
<!-- expert_compute_5 -->
<g id="node23" class="node">
<title>expert_compute_5</title>
<polygon fill="lightgreen" stroke="black" points="1560,-586.55 1366,-586.55 1366,-518.55 1560,-518.55 1560,-586.55"/>
<text text-anchor="middle" x="1463" y="-571.35" font-family="Times,serif" font-size="14.00">Expert 3 Compute</text>
<text text-anchor="middle" x="1463" y="-556.35" font-family="Times,serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="1463" y="-541.35" font-family="Times,serif" font-size="14.00">Input: routed tokens</text>
<text text-anchor="middle" x="1463" y="-526.35" font-family="Times,serif" font-size="14.00">Output: [128,1024,2048]</text>
</g>
<!-- alltoall_expert&#45;&gt;expert_compute_5 -->
<g id="edge23" class="edge">
<title>alltoall_expert&#45;&gt;expert_compute_5</title>
<path fill="none" stroke="black" d="M1370.45,-702.44C1389.51,-671.78 1416.87,-627.75 1436.91,-595.52"/>
<polygon fill="black" stroke="black" points="1440.04,-597.11 1442.35,-586.77 1434.1,-593.41 1440.04,-597.11"/>
</g>
<!-- expert_compute_ellipsis -->
<g id="node24" class="node">
<title>expert_compute_ellipsis</title>
<text text-anchor="middle" x="1696" y="-548.85" font-family="Times,serif" font-size="14.00">... expert computations ...</text>
</g>
<!-- alltoall_expert&#45;&gt;expert_compute_ellipsis -->
<g id="edge24" class="edge">
<title>alltoall_expert&#45;&gt;expert_compute_ellipsis</title>
<path fill="none" stroke="black" d="M1412.82,-706.21C1459.11,-682.9 1522.72,-650.4 1578,-620.55 1604.9,-606.02 1634.85,-589 1657.85,-575.75"/>
<polygon fill="black" stroke="black" points="1659.7,-578.72 1666.61,-570.69 1656.2,-572.66 1659.7,-578.72"/>
</g>
<!-- expert_agg -->
<g id="node25" class="node">
<title>expert_agg</title>
<polygon fill="lightgray" stroke="black" points="2025.58,-994.55 1676.28,-994.55 1586.42,-858.55 1935.72,-858.55 2025.58,-994.55"/>
<text text-anchor="middle" x="1806" y="-945.35" font-family="Times,serif" font-size="14.00">Expert Output Aggregation</text>
<text text-anchor="middle" x="1806" y="-930.35" font-family="Times,serif" font-size="14.00">GPU: 2&#45;65</text>
<text text-anchor="middle" x="1806" y="-915.35" font-family="Times,serif" font-size="14.00">Input: [128,1024,2048]</text>
<text text-anchor="middle" x="1806" y="-900.35" font-family="Times,serif" font-size="14.00">Output: [128,1024,1024]</text>
</g>
<!-- reduce_scatter -->
<g id="node26" class="node">
<title>reduce_scatter</title>
<ellipse fill="lightcoral" stroke="black" cx="2194" cy="-739.55" rx="130.63" ry="48.17"/>
<text text-anchor="middle" x="2194" y="-758.35" font-family="Times,serif" font-size="14.00">Reduce&#45;Scatter</text>
<text text-anchor="middle" x="2194" y="-743.35" font-family="Times,serif" font-size="14.00">GPU: 2&#45;65 → 66,67</text>
<text text-anchor="middle" x="2194" y="-728.35" font-family="Times,serif" font-size="14.00">Input: [128,1024,1024]</text>
<text text-anchor="middle" x="2194" y="-713.35" font-family="Times,serif" font-size="14.00">Output: [128,1024,512]</text>
</g>
<!-- expert_agg&#45;&gt;reduce_scatter -->
<g id="edge25" class="edge">
<title>expert_agg&#45;&gt;reduce_scatter</title>
<path fill="none" stroke="black" d="M1942.6,-868.61C1975.72,-854.14 2010.84,-838.23 2043,-822.55 2066.67,-811 2091.97,-797.67 2114.97,-785.15"/>
<polygon fill="black" stroke="black" points="2116.9,-788.09 2123.99,-780.22 2113.54,-781.94 2116.9,-788.09"/>
</g>
<!-- agg_0 -->
<g id="node27" class="node">
<title>agg_0</title>
<polygon fill="lightyellow" stroke="black" points="2247.5,-594.05 2062.5,-594.05 2062.5,-511.05 2247.5,-511.05 2247.5,-594.05"/>
<text text-anchor="middle" x="2155" y="-578.85" font-family="Times,serif" font-size="14.00">Aggregation Layer 0</text>
<text text-anchor="middle" x="2155" y="-563.85" font-family="Times,serif" font-size="14.00">GPU: 66</text>
<text text-anchor="middle" x="2155" y="-548.85" font-family="Times,serif" font-size="14.00">Input: [128,1024,512]</text>
<text text-anchor="middle" x="2155" y="-533.85" font-family="Times,serif" font-size="14.00">Output: [128,1024,512]</text>
<text text-anchor="middle" x="2155" y="-518.85" font-family="Times,serif" font-size="14.00">Weight: [512,1024]</text>
</g>
<!-- reduce_scatter&#45;&gt;agg_0 -->
<g id="edge26" class="edge">
<title>reduce_scatter&#45;&gt;agg_0</title>
<path fill="none" stroke="black" d="M2184.06,-691.38C2178.45,-664.81 2171.45,-631.59 2165.73,-604.43"/>
<polygon fill="black" stroke="black" points="2169.09,-603.4 2163.6,-594.34 2162.24,-604.85 2169.09,-603.4"/>
</g>
<!-- agg_1 -->
<g id="node28" class="node">
<title>agg_1</title>
<polygon fill="lightyellow" stroke="black" points="2468.5,-594.05 2283.5,-594.05 2283.5,-511.05 2468.5,-511.05 2468.5,-594.05"/>
<text text-anchor="middle" x="2376" y="-578.85" font-family="Times,serif" font-size="14.00">Aggregation Layer 1</text>
<text text-anchor="middle" x="2376" y="-563.85" font-family="Times,serif" font-size="14.00">GPU: 67</text>
<text text-anchor="middle" x="2376" y="-548.85" font-family="Times,serif" font-size="14.00">Input: [128,1024,512]</text>
<text text-anchor="middle" x="2376" y="-533.85" font-family="Times,serif" font-size="14.00">Output: [128,1024,512]</text>
<text text-anchor="middle" x="2376" y="-518.85" font-family="Times,serif" font-size="14.00">Weight: [512,1024]</text>
</g>
<!-- reduce_scatter&#45;&gt;agg_1 -->
<g id="edge27" class="edge">
<title>reduce_scatter&#45;&gt;agg_1</title>
<path fill="none" stroke="black" d="M2238.06,-693.76C2265.48,-665.88 2300.74,-630.04 2328.75,-601.58"/>
<polygon fill="black" stroke="black" points="2331.56,-603.71 2336.07,-594.13 2326.57,-598.81 2331.56,-603.71"/>
</g>
<!-- agg_allreduce -->
<g id="node29" class="node">
<title>agg_allreduce</title>
<ellipse fill="lightcoral" stroke="black" cx="2265" cy="-400.46" rx="137.36" ry="48.17"/>
<text text-anchor="middle" x="2265" y="-419.26" font-family="Times,serif" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="2265" y="-404.26" font-family="Times,serif" font-size="14.00">GPU: 66,67</text>
<text text-anchor="middle" x="2265" y="-389.26" font-family="Times,serif" font-size="14.00">Input: [128,1024,512]</text>
<text text-anchor="middle" x="2265" y="-374.26" font-family="Times,serif" font-size="14.00">Output: [128,1024,1024]</text>
</g>
<!-- agg_0&#45;&gt;agg_allreduce -->
<g id="edge28" class="edge">
<title>agg_0&#45;&gt;agg_allreduce</title>
<path fill="none" stroke="black" d="M2184.77,-510.93C2197.29,-493.84 2212.05,-473.71 2225.46,-455.41"/>
<polygon fill="black" stroke="black" points="2228.43,-457.27 2231.52,-447.14 2222.79,-453.14 2228.43,-457.27"/>
</g>
<!-- agg_1&#45;&gt;agg_allreduce -->
<g id="edge29" class="edge">
<title>agg_1&#45;&gt;agg_allreduce</title>
<path fill="none" stroke="black" d="M2345.96,-510.93C2333.32,-493.84 2318.43,-473.71 2304.9,-455.41"/>
<polygon fill="black" stroke="black" points="2307.54,-453.1 2298.78,-447.14 2301.91,-457.26 2307.54,-453.1"/>
</g>
<!-- final_merge -->
<g id="node30" class="node">
<title>final_merge</title>
<polygon fill="lightgray" stroke="black" points="2466.26,-316.38 2146.1,-316.38 2063.74,-180.38 2383.9,-180.38 2466.26,-316.38"/>
<text text-anchor="middle" x="2265" y="-267.18" font-family="Times,serif" font-size="14.00">Final Output Merge</text>
<text text-anchor="middle" x="2265" y="-252.18" font-family="Times,serif" font-size="14.00">GPU: 66,67</text>
<text text-anchor="middle" x="2265" y="-237.18" font-family="Times,serif" font-size="14.00">Input: [128,1024,512]</text>
<text text-anchor="middle" x="2265" y="-222.18" font-family="Times,serif" font-size="14.00">Output: [128,1024,1024]</text>
</g>
<!-- agg_allreduce&#45;&gt;final_merge -->
<g id="edge30" class="edge">
<title>agg_allreduce&#45;&gt;final_merge</title>
<path fill="none" stroke="black" d="M2265,-351.98C2265,-343.89 2265,-335.31 2265,-326.69"/>
<polygon fill="black" stroke="black" points="2268.5,-326.57 2265,-316.57 2261.5,-326.57 2268.5,-326.57"/>
</g>
<!-- output -->
<g id="node31" class="node">
<title>output</title>
<ellipse fill="white" stroke="black" cx="2265" cy="-74.69" rx="137.36" ry="58.88"/>
<text text-anchor="middle" x="2265" y="-100.99" font-family="Times,serif" font-size="14.00">Output Layer</text>
<text text-anchor="middle" x="2265" y="-85.99" font-family="Times,serif" font-size="14.00">GPU: 66,67</text>
<text text-anchor="middle" x="2265" y="-70.99" font-family="Times,serif" font-size="14.00">Input: [128,1024,1024]</text>
<text text-anchor="middle" x="2265" y="-55.99" font-family="Times,serif" font-size="14.00">Output: [128,1024,1024]</text>
<text text-anchor="middle" x="2265" y="-40.99" font-family="Times,serif" font-size="14.00">(final hidden states)</text>
</g>
<!-- final_merge&#45;&gt;output -->
<g id="edge31" class="edge">
<title>final_merge&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2265,-180.02C2265,-168.1 2265,-155.68 2265,-143.75"/>
<polygon fill="black" stroke="black" points="2268.5,-143.41 2265,-133.41 2261.5,-143.41 2268.5,-143.41"/>
</g>
</g>
</svg>
