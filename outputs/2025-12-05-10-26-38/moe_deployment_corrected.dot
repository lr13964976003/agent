// 30B MoE Model Deployment - Corrected DAG
digraph {
	graph [bgcolor=white fontname=Arial fontsize=12 rank=same rankdir=TB]
	input [label="Input\nBatch: 128, Seq: 1024, Hidden: 1024\n[batch_size=128, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	data_parallel_split [label="Data Parallel Split\n2-way split\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	input -> data_parallel_split [label=data_parallel]
	stage_0_boundary [label="Pipeline Stage 0\nGPUs 0-3" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	data_parallel_split -> stage_0_boundary
	layer0_boundary [label="Layer 0\nStage 0" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	stage_0_boundary -> layer0_boundary
	layer0_attn_qkv_gpu0 [label="Layer 0 Attention QKV\nGPU 0\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_attn_scores_gpu0 [label="Layer 0 Attention Scores\nGPU 0\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_attn_out_gpu0 [label="Layer 0 Attention Output\nGPU 0\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_boundary -> layer0_attn_qkv_gpu0
	layer0_attn_qkv_gpu0 -> layer0_attn_scores_gpu0
	layer0_attn_scores_gpu0 -> layer0_attn_out_gpu0
	layer0_attn_qkv_gpu1 [label="Layer 0 Attention QKV\nGPU 1\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_attn_scores_gpu1 [label="Layer 0 Attention Scores\nGPU 1\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_attn_out_gpu1 [label="Layer 0 Attention Output\nGPU 1\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_attn_qkv_gpu1 -> layer0_attn_scores_gpu1
	layer0_attn_scores_gpu1 -> layer0_attn_out_gpu1
	layer0_attn_qkv_gpu2 [label="Layer 0 Attention QKV\nGPU 2\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_attn_scores_gpu2 [label="Layer 0 Attention Scores\nGPU 2\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_attn_out_gpu2 [label="Layer 0 Attention Output\nGPU 2\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_attn_qkv_gpu2 -> layer0_attn_scores_gpu2
	layer0_attn_scores_gpu2 -> layer0_attn_out_gpu2
	layer0_attn_qkv_gpu3 [label="Layer 0 Attention QKV\nGPU 3\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_attn_scores_gpu3 [label="Layer 0 Attention Scores\nGPU 3\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_attn_out_gpu3 [label="Layer 0 Attention Output\nGPU 3\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_attn_qkv_gpu3 -> layer0_attn_scores_gpu3
	layer0_attn_scores_gpu3 -> layer0_attn_out_gpu3
	layer0_attn_allreduce [label="Layer 0 Attention All-Reduce\nGPUs 0-3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightcoral fontname=Arial shape=ellipse style=filled]
	layer0_attn_out_gpu0 -> layer0_attn_allreduce
	layer0_attn_out_gpu1 -> layer0_attn_allreduce
	layer0_attn_out_gpu2 -> layer0_attn_allreduce
	layer0_attn_out_gpu3 -> layer0_attn_allreduce
	layer0_moe_router [label="Layer 0 MoE Router\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer0_attn_allreduce -> layer0_moe_router
	layer0_expert0_gpu0 [label="Layer 0 Expert 0\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert0_gpu0
	layer0_expert1_gpu0 [label="Layer 0 Expert 1\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert1_gpu0
	layer0_expert2_gpu0 [label="Layer 0 Expert 2\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert2_gpu0
	layer0_expert3_gpu0 [label="Layer 0 Expert 3\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert3_gpu0
	layer0_expert4_gpu1 [label="Layer 0 Expert 4\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert4_gpu1
	layer0_expert5_gpu1 [label="Layer 0 Expert 5\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert5_gpu1
	layer0_expert6_gpu1 [label="Layer 0 Expert 6\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert6_gpu1
	layer0_expert7_gpu1 [label="Layer 0 Expert 7\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert7_gpu1
	layer0_expert8_gpu2 [label="Layer 0 Expert 8\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert8_gpu2
	layer0_expert9_gpu2 [label="Layer 0 Expert 9\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert9_gpu2
	layer0_expert10_gpu2 [label="Layer 0 Expert 10\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert10_gpu2
	layer0_expert11_gpu2 [label="Layer 0 Expert 11\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert11_gpu2
	layer0_expert12_gpu3 [label="Layer 0 Expert 12\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert12_gpu3
	layer0_expert13_gpu3 [label="Layer 0 Expert 13\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert13_gpu3
	layer0_expert14_gpu3 [label="Layer 0 Expert 14\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert14_gpu3
	layer0_expert15_gpu3 [label="Layer 0 Expert 15\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert15_gpu3
	layer0_expert16_gpu4 [label="Layer 0 Expert 16\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert16_gpu4
	layer0_expert17_gpu4 [label="Layer 0 Expert 17\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert17_gpu4
	layer0_expert18_gpu4 [label="Layer 0 Expert 18\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert18_gpu4
	layer0_expert19_gpu4 [label="Layer 0 Expert 19\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert19_gpu4
	layer0_expert20_gpu5 [label="Layer 0 Expert 20\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert20_gpu5
	layer0_expert21_gpu5 [label="Layer 0 Expert 21\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert21_gpu5
	layer0_expert22_gpu5 [label="Layer 0 Expert 22\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert22_gpu5
	layer0_expert23_gpu5 [label="Layer 0 Expert 23\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert23_gpu5
	layer0_expert24_gpu6 [label="Layer 0 Expert 24\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert24_gpu6
	layer0_expert25_gpu6 [label="Layer 0 Expert 25\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert25_gpu6
	layer0_expert26_gpu6 [label="Layer 0 Expert 26\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert26_gpu6
	layer0_expert27_gpu6 [label="Layer 0 Expert 27\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert27_gpu6
	layer0_expert28_gpu7 [label="Layer 0 Expert 28\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert28_gpu7
	layer0_expert29_gpu7 [label="Layer 0 Expert 29\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert29_gpu7
	layer0_expert30_gpu7 [label="Layer 0 Expert 30\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert30_gpu7
	layer0_expert31_gpu7 [label="Layer 0 Expert 31\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert31_gpu7
	layer0_expert32_gpu8 [label="Layer 0 Expert 32\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert32_gpu8
	layer0_expert33_gpu8 [label="Layer 0 Expert 33\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert33_gpu8
	layer0_expert34_gpu8 [label="Layer 0 Expert 34\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert34_gpu8
	layer0_expert35_gpu8 [label="Layer 0 Expert 35\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert35_gpu8
	layer0_expert36_gpu9 [label="Layer 0 Expert 36\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert36_gpu9
	layer0_expert37_gpu9 [label="Layer 0 Expert 37\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert37_gpu9
	layer0_expert38_gpu9 [label="Layer 0 Expert 38\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert38_gpu9
	layer0_expert39_gpu9 [label="Layer 0 Expert 39\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert39_gpu9
	layer0_expert40_gpu10 [label="Layer 0 Expert 40\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert40_gpu10
	layer0_expert41_gpu10 [label="Layer 0 Expert 41\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert41_gpu10
	layer0_expert42_gpu10 [label="Layer 0 Expert 42\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert42_gpu10
	layer0_expert43_gpu10 [label="Layer 0 Expert 43\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert43_gpu10
	layer0_expert44_gpu11 [label="Layer 0 Expert 44\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert44_gpu11
	layer0_expert45_gpu11 [label="Layer 0 Expert 45\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert45_gpu11
	layer0_expert46_gpu11 [label="Layer 0 Expert 46\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert46_gpu11
	layer0_expert47_gpu11 [label="Layer 0 Expert 47\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert47_gpu11
	layer0_expert48_gpu12 [label="Layer 0 Expert 48\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert48_gpu12
	layer0_expert49_gpu12 [label="Layer 0 Expert 49\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert49_gpu12
	layer0_expert50_gpu12 [label="Layer 0 Expert 50\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert50_gpu12
	layer0_expert51_gpu12 [label="Layer 0 Expert 51\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert51_gpu12
	layer0_expert52_gpu13 [label="Layer 0 Expert 52\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert52_gpu13
	layer0_expert53_gpu13 [label="Layer 0 Expert 53\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert53_gpu13
	layer0_expert54_gpu13 [label="Layer 0 Expert 54\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert54_gpu13
	layer0_expert55_gpu13 [label="Layer 0 Expert 55\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert55_gpu13
	layer0_expert56_gpu14 [label="Layer 0 Expert 56\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert56_gpu14
	layer0_expert57_gpu14 [label="Layer 0 Expert 57\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert57_gpu14
	layer0_expert58_gpu14 [label="Layer 0 Expert 58\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert58_gpu14
	layer0_expert59_gpu14 [label="Layer 0 Expert 59\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert59_gpu14
	layer0_expert60_gpu15 [label="Layer 0 Expert 60\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert60_gpu15
	layer0_expert61_gpu15 [label="Layer 0 Expert 61\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert61_gpu15
	layer0_expert62_gpu15 [label="Layer 0 Expert 62\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert62_gpu15
	layer0_expert63_gpu15 [label="Layer 0 Expert 63\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_router -> layer0_expert63_gpu15
	layer0_moe_agg [label="Layer 0 MoE Aggregation\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightgreen fontname=Arial shape=parallelogram style=filled]
	layer0_expert0_gpu0 -> layer0_moe_agg
	layer0_expert1_gpu0 -> layer0_moe_agg
	layer0_expert2_gpu0 -> layer0_moe_agg
	layer0_expert3_gpu0 -> layer0_moe_agg
	layer0_expert4_gpu1 -> layer0_moe_agg
	layer0_expert5_gpu1 -> layer0_moe_agg
	layer0_expert6_gpu1 -> layer0_moe_agg
	layer0_expert7_gpu1 -> layer0_moe_agg
	layer0_expert8_gpu2 -> layer0_moe_agg
	layer0_expert9_gpu2 -> layer0_moe_agg
	layer0_expert10_gpu2 -> layer0_moe_agg
	layer0_expert11_gpu2 -> layer0_moe_agg
	layer0_expert12_gpu3 -> layer0_moe_agg
	layer0_expert13_gpu3 -> layer0_moe_agg
	layer0_expert14_gpu3 -> layer0_moe_agg
	layer0_expert15_gpu3 -> layer0_moe_agg
	layer0_expert16_gpu4 -> layer0_moe_agg
	layer0_expert17_gpu4 -> layer0_moe_agg
	layer0_expert18_gpu4 -> layer0_moe_agg
	layer0_expert19_gpu4 -> layer0_moe_agg
	layer0_expert20_gpu5 -> layer0_moe_agg
	layer0_expert21_gpu5 -> layer0_moe_agg
	layer0_expert22_gpu5 -> layer0_moe_agg
	layer0_expert23_gpu5 -> layer0_moe_agg
	layer0_expert24_gpu6 -> layer0_moe_agg
	layer0_expert25_gpu6 -> layer0_moe_agg
	layer0_expert26_gpu6 -> layer0_moe_agg
	layer0_expert27_gpu6 -> layer0_moe_agg
	layer0_expert28_gpu7 -> layer0_moe_agg
	layer0_expert29_gpu7 -> layer0_moe_agg
	layer0_expert30_gpu7 -> layer0_moe_agg
	layer0_expert31_gpu7 -> layer0_moe_agg
	layer0_expert32_gpu8 -> layer0_moe_agg
	layer0_expert33_gpu8 -> layer0_moe_agg
	layer0_expert34_gpu8 -> layer0_moe_agg
	layer0_expert35_gpu8 -> layer0_moe_agg
	layer0_expert36_gpu9 -> layer0_moe_agg
	layer0_expert37_gpu9 -> layer0_moe_agg
	layer0_expert38_gpu9 -> layer0_moe_agg
	layer0_expert39_gpu9 -> layer0_moe_agg
	layer0_expert40_gpu10 -> layer0_moe_agg
	layer0_expert41_gpu10 -> layer0_moe_agg
	layer0_expert42_gpu10 -> layer0_moe_agg
	layer0_expert43_gpu10 -> layer0_moe_agg
	layer0_expert44_gpu11 -> layer0_moe_agg
	layer0_expert45_gpu11 -> layer0_moe_agg
	layer0_expert46_gpu11 -> layer0_moe_agg
	layer0_expert47_gpu11 -> layer0_moe_agg
	layer0_expert48_gpu12 -> layer0_moe_agg
	layer0_expert49_gpu12 -> layer0_moe_agg
	layer0_expert50_gpu12 -> layer0_moe_agg
	layer0_expert51_gpu12 -> layer0_moe_agg
	layer0_expert52_gpu13 -> layer0_moe_agg
	layer0_expert53_gpu13 -> layer0_moe_agg
	layer0_expert54_gpu13 -> layer0_moe_agg
	layer0_expert55_gpu13 -> layer0_moe_agg
	layer0_expert56_gpu14 -> layer0_moe_agg
	layer0_expert57_gpu14 -> layer0_moe_agg
	layer0_expert58_gpu14 -> layer0_moe_agg
	layer0_expert59_gpu14 -> layer0_moe_agg
	layer0_expert60_gpu15 -> layer0_moe_agg
	layer0_expert61_gpu15 -> layer0_moe_agg
	layer0_expert62_gpu15 -> layer0_moe_agg
	layer0_expert63_gpu15 -> layer0_moe_agg
	layer0_norm_residual [label="Layer 0 Norm + Residual\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_moe_agg -> layer0_norm_residual
	layer0_output_final [label="Layer 0 Final Output\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer0_norm_residual -> layer0_output_final
	layer1_boundary [label="Layer 1\nStage 0" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer0_output_final -> layer1_boundary
	layer1_attn_qkv_gpu0 [label="Layer 1 Attention QKV\nGPU 0\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_attn_scores_gpu0 [label="Layer 1 Attention Scores\nGPU 0\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_attn_out_gpu0 [label="Layer 1 Attention Output\nGPU 0\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_boundary -> layer1_attn_qkv_gpu0
	layer1_attn_qkv_gpu0 -> layer1_attn_scores_gpu0
	layer1_attn_scores_gpu0 -> layer1_attn_out_gpu0
	layer1_attn_qkv_gpu1 [label="Layer 1 Attention QKV\nGPU 1\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_attn_scores_gpu1 [label="Layer 1 Attention Scores\nGPU 1\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_attn_out_gpu1 [label="Layer 1 Attention Output\nGPU 1\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_attn_qkv_gpu1 -> layer1_attn_scores_gpu1
	layer1_attn_scores_gpu1 -> layer1_attn_out_gpu1
	layer1_attn_qkv_gpu2 [label="Layer 1 Attention QKV\nGPU 2\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_attn_scores_gpu2 [label="Layer 1 Attention Scores\nGPU 2\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_attn_out_gpu2 [label="Layer 1 Attention Output\nGPU 2\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_attn_qkv_gpu2 -> layer1_attn_scores_gpu2
	layer1_attn_scores_gpu2 -> layer1_attn_out_gpu2
	layer1_attn_qkv_gpu3 [label="Layer 1 Attention QKV\nGPU 3\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_attn_scores_gpu3 [label="Layer 1 Attention Scores\nGPU 3\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_attn_out_gpu3 [label="Layer 1 Attention Output\nGPU 3\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_attn_qkv_gpu3 -> layer1_attn_scores_gpu3
	layer1_attn_scores_gpu3 -> layer1_attn_out_gpu3
	layer1_attn_allreduce [label="Layer 1 Attention All-Reduce\nGPUs 0-3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightcoral fontname=Arial shape=ellipse style=filled]
	layer1_attn_out_gpu0 -> layer1_attn_allreduce
	layer1_attn_out_gpu1 -> layer1_attn_allreduce
	layer1_attn_out_gpu2 -> layer1_attn_allreduce
	layer1_attn_out_gpu3 -> layer1_attn_allreduce
	layer1_moe_router [label="Layer 1 MoE Router\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer1_attn_allreduce -> layer1_moe_router
	layer1_expert0_gpu0 [label="Layer 1 Expert 0\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert0_gpu0
	layer1_expert1_gpu0 [label="Layer 1 Expert 1\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert1_gpu0
	layer1_expert2_gpu0 [label="Layer 1 Expert 2\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert2_gpu0
	layer1_expert3_gpu0 [label="Layer 1 Expert 3\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert3_gpu0
	layer1_expert4_gpu1 [label="Layer 1 Expert 4\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert4_gpu1
	layer1_expert5_gpu1 [label="Layer 1 Expert 5\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert5_gpu1
	layer1_expert6_gpu1 [label="Layer 1 Expert 6\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert6_gpu1
	layer1_expert7_gpu1 [label="Layer 1 Expert 7\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert7_gpu1
	layer1_expert8_gpu2 [label="Layer 1 Expert 8\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert8_gpu2
	layer1_expert9_gpu2 [label="Layer 1 Expert 9\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert9_gpu2
	layer1_expert10_gpu2 [label="Layer 1 Expert 10\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert10_gpu2
	layer1_expert11_gpu2 [label="Layer 1 Expert 11\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert11_gpu2
	layer1_expert12_gpu3 [label="Layer 1 Expert 12\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert12_gpu3
	layer1_expert13_gpu3 [label="Layer 1 Expert 13\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert13_gpu3
	layer1_expert14_gpu3 [label="Layer 1 Expert 14\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert14_gpu3
	layer1_expert15_gpu3 [label="Layer 1 Expert 15\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert15_gpu3
	layer1_expert16_gpu4 [label="Layer 1 Expert 16\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert16_gpu4
	layer1_expert17_gpu4 [label="Layer 1 Expert 17\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert17_gpu4
	layer1_expert18_gpu4 [label="Layer 1 Expert 18\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert18_gpu4
	layer1_expert19_gpu4 [label="Layer 1 Expert 19\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert19_gpu4
	layer1_expert20_gpu5 [label="Layer 1 Expert 20\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert20_gpu5
	layer1_expert21_gpu5 [label="Layer 1 Expert 21\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert21_gpu5
	layer1_expert22_gpu5 [label="Layer 1 Expert 22\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert22_gpu5
	layer1_expert23_gpu5 [label="Layer 1 Expert 23\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert23_gpu5
	layer1_expert24_gpu6 [label="Layer 1 Expert 24\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert24_gpu6
	layer1_expert25_gpu6 [label="Layer 1 Expert 25\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert25_gpu6
	layer1_expert26_gpu6 [label="Layer 1 Expert 26\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert26_gpu6
	layer1_expert27_gpu6 [label="Layer 1 Expert 27\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert27_gpu6
	layer1_expert28_gpu7 [label="Layer 1 Expert 28\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert28_gpu7
	layer1_expert29_gpu7 [label="Layer 1 Expert 29\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert29_gpu7
	layer1_expert30_gpu7 [label="Layer 1 Expert 30\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert30_gpu7
	layer1_expert31_gpu7 [label="Layer 1 Expert 31\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert31_gpu7
	layer1_expert32_gpu8 [label="Layer 1 Expert 32\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert32_gpu8
	layer1_expert33_gpu8 [label="Layer 1 Expert 33\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert33_gpu8
	layer1_expert34_gpu8 [label="Layer 1 Expert 34\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert34_gpu8
	layer1_expert35_gpu8 [label="Layer 1 Expert 35\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert35_gpu8
	layer1_expert36_gpu9 [label="Layer 1 Expert 36\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert36_gpu9
	layer1_expert37_gpu9 [label="Layer 1 Expert 37\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert37_gpu9
	layer1_expert38_gpu9 [label="Layer 1 Expert 38\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert38_gpu9
	layer1_expert39_gpu9 [label="Layer 1 Expert 39\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert39_gpu9
	layer1_expert40_gpu10 [label="Layer 1 Expert 40\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert40_gpu10
	layer1_expert41_gpu10 [label="Layer 1 Expert 41\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert41_gpu10
	layer1_expert42_gpu10 [label="Layer 1 Expert 42\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert42_gpu10
	layer1_expert43_gpu10 [label="Layer 1 Expert 43\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert43_gpu10
	layer1_expert44_gpu11 [label="Layer 1 Expert 44\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert44_gpu11
	layer1_expert45_gpu11 [label="Layer 1 Expert 45\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert45_gpu11
	layer1_expert46_gpu11 [label="Layer 1 Expert 46\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert46_gpu11
	layer1_expert47_gpu11 [label="Layer 1 Expert 47\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert47_gpu11
	layer1_expert48_gpu12 [label="Layer 1 Expert 48\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert48_gpu12
	layer1_expert49_gpu12 [label="Layer 1 Expert 49\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert49_gpu12
	layer1_expert50_gpu12 [label="Layer 1 Expert 50\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert50_gpu12
	layer1_expert51_gpu12 [label="Layer 1 Expert 51\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert51_gpu12
	layer1_expert52_gpu13 [label="Layer 1 Expert 52\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert52_gpu13
	layer1_expert53_gpu13 [label="Layer 1 Expert 53\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert53_gpu13
	layer1_expert54_gpu13 [label="Layer 1 Expert 54\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert54_gpu13
	layer1_expert55_gpu13 [label="Layer 1 Expert 55\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert55_gpu13
	layer1_expert56_gpu14 [label="Layer 1 Expert 56\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert56_gpu14
	layer1_expert57_gpu14 [label="Layer 1 Expert 57\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert57_gpu14
	layer1_expert58_gpu14 [label="Layer 1 Expert 58\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert58_gpu14
	layer1_expert59_gpu14 [label="Layer 1 Expert 59\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert59_gpu14
	layer1_expert60_gpu15 [label="Layer 1 Expert 60\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert60_gpu15
	layer1_expert61_gpu15 [label="Layer 1 Expert 61\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert61_gpu15
	layer1_expert62_gpu15 [label="Layer 1 Expert 62\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert62_gpu15
	layer1_expert63_gpu15 [label="Layer 1 Expert 63\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_router -> layer1_expert63_gpu15
	layer1_moe_agg [label="Layer 1 MoE Aggregation\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightgreen fontname=Arial shape=parallelogram style=filled]
	layer1_expert0_gpu0 -> layer1_moe_agg
	layer1_expert1_gpu0 -> layer1_moe_agg
	layer1_expert2_gpu0 -> layer1_moe_agg
	layer1_expert3_gpu0 -> layer1_moe_agg
	layer1_expert4_gpu1 -> layer1_moe_agg
	layer1_expert5_gpu1 -> layer1_moe_agg
	layer1_expert6_gpu1 -> layer1_moe_agg
	layer1_expert7_gpu1 -> layer1_moe_agg
	layer1_expert8_gpu2 -> layer1_moe_agg
	layer1_expert9_gpu2 -> layer1_moe_agg
	layer1_expert10_gpu2 -> layer1_moe_agg
	layer1_expert11_gpu2 -> layer1_moe_agg
	layer1_expert12_gpu3 -> layer1_moe_agg
	layer1_expert13_gpu3 -> layer1_moe_agg
	layer1_expert14_gpu3 -> layer1_moe_agg
	layer1_expert15_gpu3 -> layer1_moe_agg
	layer1_expert16_gpu4 -> layer1_moe_agg
	layer1_expert17_gpu4 -> layer1_moe_agg
	layer1_expert18_gpu4 -> layer1_moe_agg
	layer1_expert19_gpu4 -> layer1_moe_agg
	layer1_expert20_gpu5 -> layer1_moe_agg
	layer1_expert21_gpu5 -> layer1_moe_agg
	layer1_expert22_gpu5 -> layer1_moe_agg
	layer1_expert23_gpu5 -> layer1_moe_agg
	layer1_expert24_gpu6 -> layer1_moe_agg
	layer1_expert25_gpu6 -> layer1_moe_agg
	layer1_expert26_gpu6 -> layer1_moe_agg
	layer1_expert27_gpu6 -> layer1_moe_agg
	layer1_expert28_gpu7 -> layer1_moe_agg
	layer1_expert29_gpu7 -> layer1_moe_agg
	layer1_expert30_gpu7 -> layer1_moe_agg
	layer1_expert31_gpu7 -> layer1_moe_agg
	layer1_expert32_gpu8 -> layer1_moe_agg
	layer1_expert33_gpu8 -> layer1_moe_agg
	layer1_expert34_gpu8 -> layer1_moe_agg
	layer1_expert35_gpu8 -> layer1_moe_agg
	layer1_expert36_gpu9 -> layer1_moe_agg
	layer1_expert37_gpu9 -> layer1_moe_agg
	layer1_expert38_gpu9 -> layer1_moe_agg
	layer1_expert39_gpu9 -> layer1_moe_agg
	layer1_expert40_gpu10 -> layer1_moe_agg
	layer1_expert41_gpu10 -> layer1_moe_agg
	layer1_expert42_gpu10 -> layer1_moe_agg
	layer1_expert43_gpu10 -> layer1_moe_agg
	layer1_expert44_gpu11 -> layer1_moe_agg
	layer1_expert45_gpu11 -> layer1_moe_agg
	layer1_expert46_gpu11 -> layer1_moe_agg
	layer1_expert47_gpu11 -> layer1_moe_agg
	layer1_expert48_gpu12 -> layer1_moe_agg
	layer1_expert49_gpu12 -> layer1_moe_agg
	layer1_expert50_gpu12 -> layer1_moe_agg
	layer1_expert51_gpu12 -> layer1_moe_agg
	layer1_expert52_gpu13 -> layer1_moe_agg
	layer1_expert53_gpu13 -> layer1_moe_agg
	layer1_expert54_gpu13 -> layer1_moe_agg
	layer1_expert55_gpu13 -> layer1_moe_agg
	layer1_expert56_gpu14 -> layer1_moe_agg
	layer1_expert57_gpu14 -> layer1_moe_agg
	layer1_expert58_gpu14 -> layer1_moe_agg
	layer1_expert59_gpu14 -> layer1_moe_agg
	layer1_expert60_gpu15 -> layer1_moe_agg
	layer1_expert61_gpu15 -> layer1_moe_agg
	layer1_expert62_gpu15 -> layer1_moe_agg
	layer1_expert63_gpu15 -> layer1_moe_agg
	layer1_norm_residual [label="Layer 1 Norm + Residual\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_moe_agg -> layer1_norm_residual
	layer1_output_final [label="Layer 1 Final Output\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer1_norm_residual -> layer1_output_final
	layer2_boundary [label="Layer 2\nStage 0" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer1_output_final -> layer2_boundary
	layer2_attn_qkv_gpu0 [label="Layer 2 Attention QKV\nGPU 0\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_attn_scores_gpu0 [label="Layer 2 Attention Scores\nGPU 0\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_attn_out_gpu0 [label="Layer 2 Attention Output\nGPU 0\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_boundary -> layer2_attn_qkv_gpu0
	layer2_attn_qkv_gpu0 -> layer2_attn_scores_gpu0
	layer2_attn_scores_gpu0 -> layer2_attn_out_gpu0
	layer2_attn_qkv_gpu1 [label="Layer 2 Attention QKV\nGPU 1\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_attn_scores_gpu1 [label="Layer 2 Attention Scores\nGPU 1\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_attn_out_gpu1 [label="Layer 2 Attention Output\nGPU 1\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_attn_qkv_gpu1 -> layer2_attn_scores_gpu1
	layer2_attn_scores_gpu1 -> layer2_attn_out_gpu1
	layer2_attn_qkv_gpu2 [label="Layer 2 Attention QKV\nGPU 2\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_attn_scores_gpu2 [label="Layer 2 Attention Scores\nGPU 2\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_attn_out_gpu2 [label="Layer 2 Attention Output\nGPU 2\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_attn_qkv_gpu2 -> layer2_attn_scores_gpu2
	layer2_attn_scores_gpu2 -> layer2_attn_out_gpu2
	layer2_attn_qkv_gpu3 [label="Layer 2 Attention QKV\nGPU 3\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_attn_scores_gpu3 [label="Layer 2 Attention Scores\nGPU 3\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_attn_out_gpu3 [label="Layer 2 Attention Output\nGPU 3\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_attn_qkv_gpu3 -> layer2_attn_scores_gpu3
	layer2_attn_scores_gpu3 -> layer2_attn_out_gpu3
	layer2_attn_allreduce [label="Layer 2 Attention All-Reduce\nGPUs 0-3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightcoral fontname=Arial shape=ellipse style=filled]
	layer2_attn_out_gpu0 -> layer2_attn_allreduce
	layer2_attn_out_gpu1 -> layer2_attn_allreduce
	layer2_attn_out_gpu2 -> layer2_attn_allreduce
	layer2_attn_out_gpu3 -> layer2_attn_allreduce
	layer2_moe_router [label="Layer 2 MoE Router\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer2_attn_allreduce -> layer2_moe_router
	layer2_expert0_gpu0 [label="Layer 2 Expert 0\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert0_gpu0
	layer2_expert1_gpu0 [label="Layer 2 Expert 1\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert1_gpu0
	layer2_expert2_gpu0 [label="Layer 2 Expert 2\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert2_gpu0
	layer2_expert3_gpu0 [label="Layer 2 Expert 3\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert3_gpu0
	layer2_expert4_gpu1 [label="Layer 2 Expert 4\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert4_gpu1
	layer2_expert5_gpu1 [label="Layer 2 Expert 5\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert5_gpu1
	layer2_expert6_gpu1 [label="Layer 2 Expert 6\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert6_gpu1
	layer2_expert7_gpu1 [label="Layer 2 Expert 7\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert7_gpu1
	layer2_expert8_gpu2 [label="Layer 2 Expert 8\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert8_gpu2
	layer2_expert9_gpu2 [label="Layer 2 Expert 9\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert9_gpu2
	layer2_expert10_gpu2 [label="Layer 2 Expert 10\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert10_gpu2
	layer2_expert11_gpu2 [label="Layer 2 Expert 11\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert11_gpu2
	layer2_expert12_gpu3 [label="Layer 2 Expert 12\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert12_gpu3
	layer2_expert13_gpu3 [label="Layer 2 Expert 13\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert13_gpu3
	layer2_expert14_gpu3 [label="Layer 2 Expert 14\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert14_gpu3
	layer2_expert15_gpu3 [label="Layer 2 Expert 15\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert15_gpu3
	layer2_expert16_gpu4 [label="Layer 2 Expert 16\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert16_gpu4
	layer2_expert17_gpu4 [label="Layer 2 Expert 17\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert17_gpu4
	layer2_expert18_gpu4 [label="Layer 2 Expert 18\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert18_gpu4
	layer2_expert19_gpu4 [label="Layer 2 Expert 19\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert19_gpu4
	layer2_expert20_gpu5 [label="Layer 2 Expert 20\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert20_gpu5
	layer2_expert21_gpu5 [label="Layer 2 Expert 21\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert21_gpu5
	layer2_expert22_gpu5 [label="Layer 2 Expert 22\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert22_gpu5
	layer2_expert23_gpu5 [label="Layer 2 Expert 23\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert23_gpu5
	layer2_expert24_gpu6 [label="Layer 2 Expert 24\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert24_gpu6
	layer2_expert25_gpu6 [label="Layer 2 Expert 25\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert25_gpu6
	layer2_expert26_gpu6 [label="Layer 2 Expert 26\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert26_gpu6
	layer2_expert27_gpu6 [label="Layer 2 Expert 27\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert27_gpu6
	layer2_expert28_gpu7 [label="Layer 2 Expert 28\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert28_gpu7
	layer2_expert29_gpu7 [label="Layer 2 Expert 29\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert29_gpu7
	layer2_expert30_gpu7 [label="Layer 2 Expert 30\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert30_gpu7
	layer2_expert31_gpu7 [label="Layer 2 Expert 31\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert31_gpu7
	layer2_expert32_gpu8 [label="Layer 2 Expert 32\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert32_gpu8
	layer2_expert33_gpu8 [label="Layer 2 Expert 33\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert33_gpu8
	layer2_expert34_gpu8 [label="Layer 2 Expert 34\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert34_gpu8
	layer2_expert35_gpu8 [label="Layer 2 Expert 35\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert35_gpu8
	layer2_expert36_gpu9 [label="Layer 2 Expert 36\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert36_gpu9
	layer2_expert37_gpu9 [label="Layer 2 Expert 37\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert37_gpu9
	layer2_expert38_gpu9 [label="Layer 2 Expert 38\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert38_gpu9
	layer2_expert39_gpu9 [label="Layer 2 Expert 39\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert39_gpu9
	layer2_expert40_gpu10 [label="Layer 2 Expert 40\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert40_gpu10
	layer2_expert41_gpu10 [label="Layer 2 Expert 41\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert41_gpu10
	layer2_expert42_gpu10 [label="Layer 2 Expert 42\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert42_gpu10
	layer2_expert43_gpu10 [label="Layer 2 Expert 43\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert43_gpu10
	layer2_expert44_gpu11 [label="Layer 2 Expert 44\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert44_gpu11
	layer2_expert45_gpu11 [label="Layer 2 Expert 45\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert45_gpu11
	layer2_expert46_gpu11 [label="Layer 2 Expert 46\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert46_gpu11
	layer2_expert47_gpu11 [label="Layer 2 Expert 47\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert47_gpu11
	layer2_expert48_gpu12 [label="Layer 2 Expert 48\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert48_gpu12
	layer2_expert49_gpu12 [label="Layer 2 Expert 49\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert49_gpu12
	layer2_expert50_gpu12 [label="Layer 2 Expert 50\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert50_gpu12
	layer2_expert51_gpu12 [label="Layer 2 Expert 51\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert51_gpu12
	layer2_expert52_gpu13 [label="Layer 2 Expert 52\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert52_gpu13
	layer2_expert53_gpu13 [label="Layer 2 Expert 53\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert53_gpu13
	layer2_expert54_gpu13 [label="Layer 2 Expert 54\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert54_gpu13
	layer2_expert55_gpu13 [label="Layer 2 Expert 55\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert55_gpu13
	layer2_expert56_gpu14 [label="Layer 2 Expert 56\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert56_gpu14
	layer2_expert57_gpu14 [label="Layer 2 Expert 57\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert57_gpu14
	layer2_expert58_gpu14 [label="Layer 2 Expert 58\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert58_gpu14
	layer2_expert59_gpu14 [label="Layer 2 Expert 59\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert59_gpu14
	layer2_expert60_gpu15 [label="Layer 2 Expert 60\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert60_gpu15
	layer2_expert61_gpu15 [label="Layer 2 Expert 61\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert61_gpu15
	layer2_expert62_gpu15 [label="Layer 2 Expert 62\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert62_gpu15
	layer2_expert63_gpu15 [label="Layer 2 Expert 63\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_router -> layer2_expert63_gpu15
	layer2_moe_agg [label="Layer 2 MoE Aggregation\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightgreen fontname=Arial shape=parallelogram style=filled]
	layer2_expert0_gpu0 -> layer2_moe_agg
	layer2_expert1_gpu0 -> layer2_moe_agg
	layer2_expert2_gpu0 -> layer2_moe_agg
	layer2_expert3_gpu0 -> layer2_moe_agg
	layer2_expert4_gpu1 -> layer2_moe_agg
	layer2_expert5_gpu1 -> layer2_moe_agg
	layer2_expert6_gpu1 -> layer2_moe_agg
	layer2_expert7_gpu1 -> layer2_moe_agg
	layer2_expert8_gpu2 -> layer2_moe_agg
	layer2_expert9_gpu2 -> layer2_moe_agg
	layer2_expert10_gpu2 -> layer2_moe_agg
	layer2_expert11_gpu2 -> layer2_moe_agg
	layer2_expert12_gpu3 -> layer2_moe_agg
	layer2_expert13_gpu3 -> layer2_moe_agg
	layer2_expert14_gpu3 -> layer2_moe_agg
	layer2_expert15_gpu3 -> layer2_moe_agg
	layer2_expert16_gpu4 -> layer2_moe_agg
	layer2_expert17_gpu4 -> layer2_moe_agg
	layer2_expert18_gpu4 -> layer2_moe_agg
	layer2_expert19_gpu4 -> layer2_moe_agg
	layer2_expert20_gpu5 -> layer2_moe_agg
	layer2_expert21_gpu5 -> layer2_moe_agg
	layer2_expert22_gpu5 -> layer2_moe_agg
	layer2_expert23_gpu5 -> layer2_moe_agg
	layer2_expert24_gpu6 -> layer2_moe_agg
	layer2_expert25_gpu6 -> layer2_moe_agg
	layer2_expert26_gpu6 -> layer2_moe_agg
	layer2_expert27_gpu6 -> layer2_moe_agg
	layer2_expert28_gpu7 -> layer2_moe_agg
	layer2_expert29_gpu7 -> layer2_moe_agg
	layer2_expert30_gpu7 -> layer2_moe_agg
	layer2_expert31_gpu7 -> layer2_moe_agg
	layer2_expert32_gpu8 -> layer2_moe_agg
	layer2_expert33_gpu8 -> layer2_moe_agg
	layer2_expert34_gpu8 -> layer2_moe_agg
	layer2_expert35_gpu8 -> layer2_moe_agg
	layer2_expert36_gpu9 -> layer2_moe_agg
	layer2_expert37_gpu9 -> layer2_moe_agg
	layer2_expert38_gpu9 -> layer2_moe_agg
	layer2_expert39_gpu9 -> layer2_moe_agg
	layer2_expert40_gpu10 -> layer2_moe_agg
	layer2_expert41_gpu10 -> layer2_moe_agg
	layer2_expert42_gpu10 -> layer2_moe_agg
	layer2_expert43_gpu10 -> layer2_moe_agg
	layer2_expert44_gpu11 -> layer2_moe_agg
	layer2_expert45_gpu11 -> layer2_moe_agg
	layer2_expert46_gpu11 -> layer2_moe_agg
	layer2_expert47_gpu11 -> layer2_moe_agg
	layer2_expert48_gpu12 -> layer2_moe_agg
	layer2_expert49_gpu12 -> layer2_moe_agg
	layer2_expert50_gpu12 -> layer2_moe_agg
	layer2_expert51_gpu12 -> layer2_moe_agg
	layer2_expert52_gpu13 -> layer2_moe_agg
	layer2_expert53_gpu13 -> layer2_moe_agg
	layer2_expert54_gpu13 -> layer2_moe_agg
	layer2_expert55_gpu13 -> layer2_moe_agg
	layer2_expert56_gpu14 -> layer2_moe_agg
	layer2_expert57_gpu14 -> layer2_moe_agg
	layer2_expert58_gpu14 -> layer2_moe_agg
	layer2_expert59_gpu14 -> layer2_moe_agg
	layer2_expert60_gpu15 -> layer2_moe_agg
	layer2_expert61_gpu15 -> layer2_moe_agg
	layer2_expert62_gpu15 -> layer2_moe_agg
	layer2_expert63_gpu15 -> layer2_moe_agg
	layer2_norm_residual [label="Layer 2 Norm + Residual\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_moe_agg -> layer2_norm_residual
	layer2_output_final [label="Layer 2 Final Output\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer2_norm_residual -> layer2_output_final
	layer3_boundary [label="Layer 3\nStage 0" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer2_output_final -> layer3_boundary
	layer3_attn_qkv_gpu0 [label="Layer 3 Attention QKV\nGPU 0\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_attn_scores_gpu0 [label="Layer 3 Attention Scores\nGPU 0\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_attn_out_gpu0 [label="Layer 3 Attention Output\nGPU 0\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_boundary -> layer3_attn_qkv_gpu0
	layer3_attn_qkv_gpu0 -> layer3_attn_scores_gpu0
	layer3_attn_scores_gpu0 -> layer3_attn_out_gpu0
	layer3_attn_qkv_gpu1 [label="Layer 3 Attention QKV\nGPU 1\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_attn_scores_gpu1 [label="Layer 3 Attention Scores\nGPU 1\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_attn_out_gpu1 [label="Layer 3 Attention Output\nGPU 1\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_attn_qkv_gpu1 -> layer3_attn_scores_gpu1
	layer3_attn_scores_gpu1 -> layer3_attn_out_gpu1
	layer3_attn_qkv_gpu2 [label="Layer 3 Attention QKV\nGPU 2\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_attn_scores_gpu2 [label="Layer 3 Attention Scores\nGPU 2\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_attn_out_gpu2 [label="Layer 3 Attention Output\nGPU 2\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_attn_qkv_gpu2 -> layer3_attn_scores_gpu2
	layer3_attn_scores_gpu2 -> layer3_attn_out_gpu2
	layer3_attn_qkv_gpu3 [label="Layer 3 Attention QKV\nGPU 3\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_attn_scores_gpu3 [label="Layer 3 Attention Scores\nGPU 3\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_attn_out_gpu3 [label="Layer 3 Attention Output\nGPU 3\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_attn_qkv_gpu3 -> layer3_attn_scores_gpu3
	layer3_attn_scores_gpu3 -> layer3_attn_out_gpu3
	layer3_attn_allreduce [label="Layer 3 Attention All-Reduce\nGPUs 0-3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightcoral fontname=Arial shape=ellipse style=filled]
	layer3_attn_out_gpu0 -> layer3_attn_allreduce
	layer3_attn_out_gpu1 -> layer3_attn_allreduce
	layer3_attn_out_gpu2 -> layer3_attn_allreduce
	layer3_attn_out_gpu3 -> layer3_attn_allreduce
	layer3_moe_router [label="Layer 3 MoE Router\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer3_attn_allreduce -> layer3_moe_router
	layer3_expert0_gpu0 [label="Layer 3 Expert 0\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert0_gpu0
	layer3_expert1_gpu0 [label="Layer 3 Expert 1\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert1_gpu0
	layer3_expert2_gpu0 [label="Layer 3 Expert 2\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert2_gpu0
	layer3_expert3_gpu0 [label="Layer 3 Expert 3\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert3_gpu0
	layer3_expert4_gpu1 [label="Layer 3 Expert 4\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert4_gpu1
	layer3_expert5_gpu1 [label="Layer 3 Expert 5\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert5_gpu1
	layer3_expert6_gpu1 [label="Layer 3 Expert 6\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert6_gpu1
	layer3_expert7_gpu1 [label="Layer 3 Expert 7\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert7_gpu1
	layer3_expert8_gpu2 [label="Layer 3 Expert 8\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert8_gpu2
	layer3_expert9_gpu2 [label="Layer 3 Expert 9\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert9_gpu2
	layer3_expert10_gpu2 [label="Layer 3 Expert 10\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert10_gpu2
	layer3_expert11_gpu2 [label="Layer 3 Expert 11\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert11_gpu2
	layer3_expert12_gpu3 [label="Layer 3 Expert 12\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert12_gpu3
	layer3_expert13_gpu3 [label="Layer 3 Expert 13\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert13_gpu3
	layer3_expert14_gpu3 [label="Layer 3 Expert 14\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert14_gpu3
	layer3_expert15_gpu3 [label="Layer 3 Expert 15\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert15_gpu3
	layer3_expert16_gpu4 [label="Layer 3 Expert 16\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert16_gpu4
	layer3_expert17_gpu4 [label="Layer 3 Expert 17\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert17_gpu4
	layer3_expert18_gpu4 [label="Layer 3 Expert 18\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert18_gpu4
	layer3_expert19_gpu4 [label="Layer 3 Expert 19\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert19_gpu4
	layer3_expert20_gpu5 [label="Layer 3 Expert 20\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert20_gpu5
	layer3_expert21_gpu5 [label="Layer 3 Expert 21\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert21_gpu5
	layer3_expert22_gpu5 [label="Layer 3 Expert 22\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert22_gpu5
	layer3_expert23_gpu5 [label="Layer 3 Expert 23\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert23_gpu5
	layer3_expert24_gpu6 [label="Layer 3 Expert 24\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert24_gpu6
	layer3_expert25_gpu6 [label="Layer 3 Expert 25\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert25_gpu6
	layer3_expert26_gpu6 [label="Layer 3 Expert 26\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert26_gpu6
	layer3_expert27_gpu6 [label="Layer 3 Expert 27\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert27_gpu6
	layer3_expert28_gpu7 [label="Layer 3 Expert 28\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert28_gpu7
	layer3_expert29_gpu7 [label="Layer 3 Expert 29\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert29_gpu7
	layer3_expert30_gpu7 [label="Layer 3 Expert 30\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert30_gpu7
	layer3_expert31_gpu7 [label="Layer 3 Expert 31\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert31_gpu7
	layer3_expert32_gpu8 [label="Layer 3 Expert 32\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert32_gpu8
	layer3_expert33_gpu8 [label="Layer 3 Expert 33\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert33_gpu8
	layer3_expert34_gpu8 [label="Layer 3 Expert 34\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert34_gpu8
	layer3_expert35_gpu8 [label="Layer 3 Expert 35\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert35_gpu8
	layer3_expert36_gpu9 [label="Layer 3 Expert 36\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert36_gpu9
	layer3_expert37_gpu9 [label="Layer 3 Expert 37\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert37_gpu9
	layer3_expert38_gpu9 [label="Layer 3 Expert 38\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert38_gpu9
	layer3_expert39_gpu9 [label="Layer 3 Expert 39\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert39_gpu9
	layer3_expert40_gpu10 [label="Layer 3 Expert 40\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert40_gpu10
	layer3_expert41_gpu10 [label="Layer 3 Expert 41\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert41_gpu10
	layer3_expert42_gpu10 [label="Layer 3 Expert 42\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert42_gpu10
	layer3_expert43_gpu10 [label="Layer 3 Expert 43\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert43_gpu10
	layer3_expert44_gpu11 [label="Layer 3 Expert 44\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert44_gpu11
	layer3_expert45_gpu11 [label="Layer 3 Expert 45\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert45_gpu11
	layer3_expert46_gpu11 [label="Layer 3 Expert 46\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert46_gpu11
	layer3_expert47_gpu11 [label="Layer 3 Expert 47\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert47_gpu11
	layer3_expert48_gpu12 [label="Layer 3 Expert 48\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert48_gpu12
	layer3_expert49_gpu12 [label="Layer 3 Expert 49\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert49_gpu12
	layer3_expert50_gpu12 [label="Layer 3 Expert 50\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert50_gpu12
	layer3_expert51_gpu12 [label="Layer 3 Expert 51\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert51_gpu12
	layer3_expert52_gpu13 [label="Layer 3 Expert 52\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert52_gpu13
	layer3_expert53_gpu13 [label="Layer 3 Expert 53\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert53_gpu13
	layer3_expert54_gpu13 [label="Layer 3 Expert 54\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert54_gpu13
	layer3_expert55_gpu13 [label="Layer 3 Expert 55\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert55_gpu13
	layer3_expert56_gpu14 [label="Layer 3 Expert 56\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert56_gpu14
	layer3_expert57_gpu14 [label="Layer 3 Expert 57\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert57_gpu14
	layer3_expert58_gpu14 [label="Layer 3 Expert 58\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert58_gpu14
	layer3_expert59_gpu14 [label="Layer 3 Expert 59\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert59_gpu14
	layer3_expert60_gpu15 [label="Layer 3 Expert 60\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert60_gpu15
	layer3_expert61_gpu15 [label="Layer 3 Expert 61\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert61_gpu15
	layer3_expert62_gpu15 [label="Layer 3 Expert 62\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert62_gpu15
	layer3_expert63_gpu15 [label="Layer 3 Expert 63\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_router -> layer3_expert63_gpu15
	layer3_moe_agg [label="Layer 3 MoE Aggregation\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightgreen fontname=Arial shape=parallelogram style=filled]
	layer3_expert0_gpu0 -> layer3_moe_agg
	layer3_expert1_gpu0 -> layer3_moe_agg
	layer3_expert2_gpu0 -> layer3_moe_agg
	layer3_expert3_gpu0 -> layer3_moe_agg
	layer3_expert4_gpu1 -> layer3_moe_agg
	layer3_expert5_gpu1 -> layer3_moe_agg
	layer3_expert6_gpu1 -> layer3_moe_agg
	layer3_expert7_gpu1 -> layer3_moe_agg
	layer3_expert8_gpu2 -> layer3_moe_agg
	layer3_expert9_gpu2 -> layer3_moe_agg
	layer3_expert10_gpu2 -> layer3_moe_agg
	layer3_expert11_gpu2 -> layer3_moe_agg
	layer3_expert12_gpu3 -> layer3_moe_agg
	layer3_expert13_gpu3 -> layer3_moe_agg
	layer3_expert14_gpu3 -> layer3_moe_agg
	layer3_expert15_gpu3 -> layer3_moe_agg
	layer3_expert16_gpu4 -> layer3_moe_agg
	layer3_expert17_gpu4 -> layer3_moe_agg
	layer3_expert18_gpu4 -> layer3_moe_agg
	layer3_expert19_gpu4 -> layer3_moe_agg
	layer3_expert20_gpu5 -> layer3_moe_agg
	layer3_expert21_gpu5 -> layer3_moe_agg
	layer3_expert22_gpu5 -> layer3_moe_agg
	layer3_expert23_gpu5 -> layer3_moe_agg
	layer3_expert24_gpu6 -> layer3_moe_agg
	layer3_expert25_gpu6 -> layer3_moe_agg
	layer3_expert26_gpu6 -> layer3_moe_agg
	layer3_expert27_gpu6 -> layer3_moe_agg
	layer3_expert28_gpu7 -> layer3_moe_agg
	layer3_expert29_gpu7 -> layer3_moe_agg
	layer3_expert30_gpu7 -> layer3_moe_agg
	layer3_expert31_gpu7 -> layer3_moe_agg
	layer3_expert32_gpu8 -> layer3_moe_agg
	layer3_expert33_gpu8 -> layer3_moe_agg
	layer3_expert34_gpu8 -> layer3_moe_agg
	layer3_expert35_gpu8 -> layer3_moe_agg
	layer3_expert36_gpu9 -> layer3_moe_agg
	layer3_expert37_gpu9 -> layer3_moe_agg
	layer3_expert38_gpu9 -> layer3_moe_agg
	layer3_expert39_gpu9 -> layer3_moe_agg
	layer3_expert40_gpu10 -> layer3_moe_agg
	layer3_expert41_gpu10 -> layer3_moe_agg
	layer3_expert42_gpu10 -> layer3_moe_agg
	layer3_expert43_gpu10 -> layer3_moe_agg
	layer3_expert44_gpu11 -> layer3_moe_agg
	layer3_expert45_gpu11 -> layer3_moe_agg
	layer3_expert46_gpu11 -> layer3_moe_agg
	layer3_expert47_gpu11 -> layer3_moe_agg
	layer3_expert48_gpu12 -> layer3_moe_agg
	layer3_expert49_gpu12 -> layer3_moe_agg
	layer3_expert50_gpu12 -> layer3_moe_agg
	layer3_expert51_gpu12 -> layer3_moe_agg
	layer3_expert52_gpu13 -> layer3_moe_agg
	layer3_expert53_gpu13 -> layer3_moe_agg
	layer3_expert54_gpu13 -> layer3_moe_agg
	layer3_expert55_gpu13 -> layer3_moe_agg
	layer3_expert56_gpu14 -> layer3_moe_agg
	layer3_expert57_gpu14 -> layer3_moe_agg
	layer3_expert58_gpu14 -> layer3_moe_agg
	layer3_expert59_gpu14 -> layer3_moe_agg
	layer3_expert60_gpu15 -> layer3_moe_agg
	layer3_expert61_gpu15 -> layer3_moe_agg
	layer3_expert62_gpu15 -> layer3_moe_agg
	layer3_expert63_gpu15 -> layer3_moe_agg
	layer3_norm_residual [label="Layer 3 Norm + Residual\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_moe_agg -> layer3_norm_residual
	layer3_output_final [label="Layer 3 Final Output\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer3_norm_residual -> layer3_output_final
	stage_1_boundary [label="Pipeline Stage 1\nGPUs 4-7" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer3_output_final -> stage_1_boundary
	layer4_boundary [label="Layer 4\nStage 1" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	stage_1_boundary -> layer4_boundary
	layer4_attn_qkv_gpu4 [label="Layer 4 Attention QKV\nGPU 4\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_attn_scores_gpu4 [label="Layer 4 Attention Scores\nGPU 4\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_attn_out_gpu4 [label="Layer 4 Attention Output\nGPU 4\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_boundary -> layer4_attn_qkv_gpu4
	layer4_attn_qkv_gpu4 -> layer4_attn_scores_gpu4
	layer4_attn_scores_gpu4 -> layer4_attn_out_gpu4
	layer4_attn_qkv_gpu5 [label="Layer 4 Attention QKV\nGPU 5\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_attn_scores_gpu5 [label="Layer 4 Attention Scores\nGPU 5\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_attn_out_gpu5 [label="Layer 4 Attention Output\nGPU 5\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_attn_qkv_gpu5 -> layer4_attn_scores_gpu5
	layer4_attn_scores_gpu5 -> layer4_attn_out_gpu5
	layer4_attn_qkv_gpu6 [label="Layer 4 Attention QKV\nGPU 6\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_attn_scores_gpu6 [label="Layer 4 Attention Scores\nGPU 6\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_attn_out_gpu6 [label="Layer 4 Attention Output\nGPU 6\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_attn_qkv_gpu6 -> layer4_attn_scores_gpu6
	layer4_attn_scores_gpu6 -> layer4_attn_out_gpu6
	layer4_attn_qkv_gpu7 [label="Layer 4 Attention QKV\nGPU 7\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_attn_scores_gpu7 [label="Layer 4 Attention Scores\nGPU 7\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_attn_out_gpu7 [label="Layer 4 Attention Output\nGPU 7\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_attn_qkv_gpu7 -> layer4_attn_scores_gpu7
	layer4_attn_scores_gpu7 -> layer4_attn_out_gpu7
	layer4_attn_allreduce [label="Layer 4 Attention All-Reduce\nGPUs 4-7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightcoral fontname=Arial shape=ellipse style=filled]
	layer4_attn_out_gpu4 -> layer4_attn_allreduce
	layer4_attn_out_gpu5 -> layer4_attn_allreduce
	layer4_attn_out_gpu6 -> layer4_attn_allreduce
	layer4_attn_out_gpu7 -> layer4_attn_allreduce
	layer4_moe_router [label="Layer 4 MoE Router\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer4_attn_allreduce -> layer4_moe_router
	layer4_expert0_gpu0 [label="Layer 4 Expert 0\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert0_gpu0
	layer4_expert1_gpu0 [label="Layer 4 Expert 1\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert1_gpu0
	layer4_expert2_gpu0 [label="Layer 4 Expert 2\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert2_gpu0
	layer4_expert3_gpu0 [label="Layer 4 Expert 3\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert3_gpu0
	layer4_expert4_gpu1 [label="Layer 4 Expert 4\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert4_gpu1
	layer4_expert5_gpu1 [label="Layer 4 Expert 5\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert5_gpu1
	layer4_expert6_gpu1 [label="Layer 4 Expert 6\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert6_gpu1
	layer4_expert7_gpu1 [label="Layer 4 Expert 7\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert7_gpu1
	layer4_expert8_gpu2 [label="Layer 4 Expert 8\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert8_gpu2
	layer4_expert9_gpu2 [label="Layer 4 Expert 9\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert9_gpu2
	layer4_expert10_gpu2 [label="Layer 4 Expert 10\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert10_gpu2
	layer4_expert11_gpu2 [label="Layer 4 Expert 11\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert11_gpu2
	layer4_expert12_gpu3 [label="Layer 4 Expert 12\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert12_gpu3
	layer4_expert13_gpu3 [label="Layer 4 Expert 13\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert13_gpu3
	layer4_expert14_gpu3 [label="Layer 4 Expert 14\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert14_gpu3
	layer4_expert15_gpu3 [label="Layer 4 Expert 15\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert15_gpu3
	layer4_expert16_gpu4 [label="Layer 4 Expert 16\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert16_gpu4
	layer4_expert17_gpu4 [label="Layer 4 Expert 17\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert17_gpu4
	layer4_expert18_gpu4 [label="Layer 4 Expert 18\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert18_gpu4
	layer4_expert19_gpu4 [label="Layer 4 Expert 19\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert19_gpu4
	layer4_expert20_gpu5 [label="Layer 4 Expert 20\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert20_gpu5
	layer4_expert21_gpu5 [label="Layer 4 Expert 21\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert21_gpu5
	layer4_expert22_gpu5 [label="Layer 4 Expert 22\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert22_gpu5
	layer4_expert23_gpu5 [label="Layer 4 Expert 23\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert23_gpu5
	layer4_expert24_gpu6 [label="Layer 4 Expert 24\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert24_gpu6
	layer4_expert25_gpu6 [label="Layer 4 Expert 25\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert25_gpu6
	layer4_expert26_gpu6 [label="Layer 4 Expert 26\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert26_gpu6
	layer4_expert27_gpu6 [label="Layer 4 Expert 27\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert27_gpu6
	layer4_expert28_gpu7 [label="Layer 4 Expert 28\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert28_gpu7
	layer4_expert29_gpu7 [label="Layer 4 Expert 29\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert29_gpu7
	layer4_expert30_gpu7 [label="Layer 4 Expert 30\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert30_gpu7
	layer4_expert31_gpu7 [label="Layer 4 Expert 31\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert31_gpu7
	layer4_expert32_gpu8 [label="Layer 4 Expert 32\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert32_gpu8
	layer4_expert33_gpu8 [label="Layer 4 Expert 33\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert33_gpu8
	layer4_expert34_gpu8 [label="Layer 4 Expert 34\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert34_gpu8
	layer4_expert35_gpu8 [label="Layer 4 Expert 35\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert35_gpu8
	layer4_expert36_gpu9 [label="Layer 4 Expert 36\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert36_gpu9
	layer4_expert37_gpu9 [label="Layer 4 Expert 37\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert37_gpu9
	layer4_expert38_gpu9 [label="Layer 4 Expert 38\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert38_gpu9
	layer4_expert39_gpu9 [label="Layer 4 Expert 39\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert39_gpu9
	layer4_expert40_gpu10 [label="Layer 4 Expert 40\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert40_gpu10
	layer4_expert41_gpu10 [label="Layer 4 Expert 41\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert41_gpu10
	layer4_expert42_gpu10 [label="Layer 4 Expert 42\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert42_gpu10
	layer4_expert43_gpu10 [label="Layer 4 Expert 43\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert43_gpu10
	layer4_expert44_gpu11 [label="Layer 4 Expert 44\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert44_gpu11
	layer4_expert45_gpu11 [label="Layer 4 Expert 45\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert45_gpu11
	layer4_expert46_gpu11 [label="Layer 4 Expert 46\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert46_gpu11
	layer4_expert47_gpu11 [label="Layer 4 Expert 47\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert47_gpu11
	layer4_expert48_gpu12 [label="Layer 4 Expert 48\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert48_gpu12
	layer4_expert49_gpu12 [label="Layer 4 Expert 49\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert49_gpu12
	layer4_expert50_gpu12 [label="Layer 4 Expert 50\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert50_gpu12
	layer4_expert51_gpu12 [label="Layer 4 Expert 51\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert51_gpu12
	layer4_expert52_gpu13 [label="Layer 4 Expert 52\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert52_gpu13
	layer4_expert53_gpu13 [label="Layer 4 Expert 53\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert53_gpu13
	layer4_expert54_gpu13 [label="Layer 4 Expert 54\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert54_gpu13
	layer4_expert55_gpu13 [label="Layer 4 Expert 55\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert55_gpu13
	layer4_expert56_gpu14 [label="Layer 4 Expert 56\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert56_gpu14
	layer4_expert57_gpu14 [label="Layer 4 Expert 57\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert57_gpu14
	layer4_expert58_gpu14 [label="Layer 4 Expert 58\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert58_gpu14
	layer4_expert59_gpu14 [label="Layer 4 Expert 59\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert59_gpu14
	layer4_expert60_gpu15 [label="Layer 4 Expert 60\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert60_gpu15
	layer4_expert61_gpu15 [label="Layer 4 Expert 61\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert61_gpu15
	layer4_expert62_gpu15 [label="Layer 4 Expert 62\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert62_gpu15
	layer4_expert63_gpu15 [label="Layer 4 Expert 63\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_router -> layer4_expert63_gpu15
	layer4_moe_agg [label="Layer 4 MoE Aggregation\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightgreen fontname=Arial shape=parallelogram style=filled]
	layer4_expert0_gpu0 -> layer4_moe_agg
	layer4_expert1_gpu0 -> layer4_moe_agg
	layer4_expert2_gpu0 -> layer4_moe_agg
	layer4_expert3_gpu0 -> layer4_moe_agg
	layer4_expert4_gpu1 -> layer4_moe_agg
	layer4_expert5_gpu1 -> layer4_moe_agg
	layer4_expert6_gpu1 -> layer4_moe_agg
	layer4_expert7_gpu1 -> layer4_moe_agg
	layer4_expert8_gpu2 -> layer4_moe_agg
	layer4_expert9_gpu2 -> layer4_moe_agg
	layer4_expert10_gpu2 -> layer4_moe_agg
	layer4_expert11_gpu2 -> layer4_moe_agg
	layer4_expert12_gpu3 -> layer4_moe_agg
	layer4_expert13_gpu3 -> layer4_moe_agg
	layer4_expert14_gpu3 -> layer4_moe_agg
	layer4_expert15_gpu3 -> layer4_moe_agg
	layer4_expert16_gpu4 -> layer4_moe_agg
	layer4_expert17_gpu4 -> layer4_moe_agg
	layer4_expert18_gpu4 -> layer4_moe_agg
	layer4_expert19_gpu4 -> layer4_moe_agg
	layer4_expert20_gpu5 -> layer4_moe_agg
	layer4_expert21_gpu5 -> layer4_moe_agg
	layer4_expert22_gpu5 -> layer4_moe_agg
	layer4_expert23_gpu5 -> layer4_moe_agg
	layer4_expert24_gpu6 -> layer4_moe_agg
	layer4_expert25_gpu6 -> layer4_moe_agg
	layer4_expert26_gpu6 -> layer4_moe_agg
	layer4_expert27_gpu6 -> layer4_moe_agg
	layer4_expert28_gpu7 -> layer4_moe_agg
	layer4_expert29_gpu7 -> layer4_moe_agg
	layer4_expert30_gpu7 -> layer4_moe_agg
	layer4_expert31_gpu7 -> layer4_moe_agg
	layer4_expert32_gpu8 -> layer4_moe_agg
	layer4_expert33_gpu8 -> layer4_moe_agg
	layer4_expert34_gpu8 -> layer4_moe_agg
	layer4_expert35_gpu8 -> layer4_moe_agg
	layer4_expert36_gpu9 -> layer4_moe_agg
	layer4_expert37_gpu9 -> layer4_moe_agg
	layer4_expert38_gpu9 -> layer4_moe_agg
	layer4_expert39_gpu9 -> layer4_moe_agg
	layer4_expert40_gpu10 -> layer4_moe_agg
	layer4_expert41_gpu10 -> layer4_moe_agg
	layer4_expert42_gpu10 -> layer4_moe_agg
	layer4_expert43_gpu10 -> layer4_moe_agg
	layer4_expert44_gpu11 -> layer4_moe_agg
	layer4_expert45_gpu11 -> layer4_moe_agg
	layer4_expert46_gpu11 -> layer4_moe_agg
	layer4_expert47_gpu11 -> layer4_moe_agg
	layer4_expert48_gpu12 -> layer4_moe_agg
	layer4_expert49_gpu12 -> layer4_moe_agg
	layer4_expert50_gpu12 -> layer4_moe_agg
	layer4_expert51_gpu12 -> layer4_moe_agg
	layer4_expert52_gpu13 -> layer4_moe_agg
	layer4_expert53_gpu13 -> layer4_moe_agg
	layer4_expert54_gpu13 -> layer4_moe_agg
	layer4_expert55_gpu13 -> layer4_moe_agg
	layer4_expert56_gpu14 -> layer4_moe_agg
	layer4_expert57_gpu14 -> layer4_moe_agg
	layer4_expert58_gpu14 -> layer4_moe_agg
	layer4_expert59_gpu14 -> layer4_moe_agg
	layer4_expert60_gpu15 -> layer4_moe_agg
	layer4_expert61_gpu15 -> layer4_moe_agg
	layer4_expert62_gpu15 -> layer4_moe_agg
	layer4_expert63_gpu15 -> layer4_moe_agg
	layer4_norm_residual [label="Layer 4 Norm + Residual\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_moe_agg -> layer4_norm_residual
	layer4_output_final [label="Layer 4 Final Output\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer4_norm_residual -> layer4_output_final
	layer5_boundary [label="Layer 5\nStage 1" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer4_output_final -> layer5_boundary
	layer5_attn_qkv_gpu4 [label="Layer 5 Attention QKV\nGPU 4\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_attn_scores_gpu4 [label="Layer 5 Attention Scores\nGPU 4\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_attn_out_gpu4 [label="Layer 5 Attention Output\nGPU 4\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_boundary -> layer5_attn_qkv_gpu4
	layer5_attn_qkv_gpu4 -> layer5_attn_scores_gpu4
	layer5_attn_scores_gpu4 -> layer5_attn_out_gpu4
	layer5_attn_qkv_gpu5 [label="Layer 5 Attention QKV\nGPU 5\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_attn_scores_gpu5 [label="Layer 5 Attention Scores\nGPU 5\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_attn_out_gpu5 [label="Layer 5 Attention Output\nGPU 5\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_attn_qkv_gpu5 -> layer5_attn_scores_gpu5
	layer5_attn_scores_gpu5 -> layer5_attn_out_gpu5
	layer5_attn_qkv_gpu6 [label="Layer 5 Attention QKV\nGPU 6\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_attn_scores_gpu6 [label="Layer 5 Attention Scores\nGPU 6\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_attn_out_gpu6 [label="Layer 5 Attention Output\nGPU 6\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_attn_qkv_gpu6 -> layer5_attn_scores_gpu6
	layer5_attn_scores_gpu6 -> layer5_attn_out_gpu6
	layer5_attn_qkv_gpu7 [label="Layer 5 Attention QKV\nGPU 7\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_attn_scores_gpu7 [label="Layer 5 Attention Scores\nGPU 7\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_attn_out_gpu7 [label="Layer 5 Attention Output\nGPU 7\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_attn_qkv_gpu7 -> layer5_attn_scores_gpu7
	layer5_attn_scores_gpu7 -> layer5_attn_out_gpu7
	layer5_attn_allreduce [label="Layer 5 Attention All-Reduce\nGPUs 4-7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightcoral fontname=Arial shape=ellipse style=filled]
	layer5_attn_out_gpu4 -> layer5_attn_allreduce
	layer5_attn_out_gpu5 -> layer5_attn_allreduce
	layer5_attn_out_gpu6 -> layer5_attn_allreduce
	layer5_attn_out_gpu7 -> layer5_attn_allreduce
	layer5_moe_router [label="Layer 5 MoE Router\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer5_attn_allreduce -> layer5_moe_router
	layer5_expert0_gpu0 [label="Layer 5 Expert 0\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert0_gpu0
	layer5_expert1_gpu0 [label="Layer 5 Expert 1\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert1_gpu0
	layer5_expert2_gpu0 [label="Layer 5 Expert 2\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert2_gpu0
	layer5_expert3_gpu0 [label="Layer 5 Expert 3\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert3_gpu0
	layer5_expert4_gpu1 [label="Layer 5 Expert 4\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert4_gpu1
	layer5_expert5_gpu1 [label="Layer 5 Expert 5\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert5_gpu1
	layer5_expert6_gpu1 [label="Layer 5 Expert 6\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert6_gpu1
	layer5_expert7_gpu1 [label="Layer 5 Expert 7\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert7_gpu1
	layer5_expert8_gpu2 [label="Layer 5 Expert 8\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert8_gpu2
	layer5_expert9_gpu2 [label="Layer 5 Expert 9\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert9_gpu2
	layer5_expert10_gpu2 [label="Layer 5 Expert 10\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert10_gpu2
	layer5_expert11_gpu2 [label="Layer 5 Expert 11\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert11_gpu2
	layer5_expert12_gpu3 [label="Layer 5 Expert 12\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert12_gpu3
	layer5_expert13_gpu3 [label="Layer 5 Expert 13\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert13_gpu3
	layer5_expert14_gpu3 [label="Layer 5 Expert 14\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert14_gpu3
	layer5_expert15_gpu3 [label="Layer 5 Expert 15\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert15_gpu3
	layer5_expert16_gpu4 [label="Layer 5 Expert 16\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert16_gpu4
	layer5_expert17_gpu4 [label="Layer 5 Expert 17\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert17_gpu4
	layer5_expert18_gpu4 [label="Layer 5 Expert 18\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert18_gpu4
	layer5_expert19_gpu4 [label="Layer 5 Expert 19\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert19_gpu4
	layer5_expert20_gpu5 [label="Layer 5 Expert 20\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert20_gpu5
	layer5_expert21_gpu5 [label="Layer 5 Expert 21\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert21_gpu5
	layer5_expert22_gpu5 [label="Layer 5 Expert 22\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert22_gpu5
	layer5_expert23_gpu5 [label="Layer 5 Expert 23\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert23_gpu5
	layer5_expert24_gpu6 [label="Layer 5 Expert 24\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert24_gpu6
	layer5_expert25_gpu6 [label="Layer 5 Expert 25\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert25_gpu6
	layer5_expert26_gpu6 [label="Layer 5 Expert 26\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert26_gpu6
	layer5_expert27_gpu6 [label="Layer 5 Expert 27\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert27_gpu6
	layer5_expert28_gpu7 [label="Layer 5 Expert 28\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert28_gpu7
	layer5_expert29_gpu7 [label="Layer 5 Expert 29\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert29_gpu7
	layer5_expert30_gpu7 [label="Layer 5 Expert 30\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert30_gpu7
	layer5_expert31_gpu7 [label="Layer 5 Expert 31\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert31_gpu7
	layer5_expert32_gpu8 [label="Layer 5 Expert 32\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert32_gpu8
	layer5_expert33_gpu8 [label="Layer 5 Expert 33\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert33_gpu8
	layer5_expert34_gpu8 [label="Layer 5 Expert 34\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert34_gpu8
	layer5_expert35_gpu8 [label="Layer 5 Expert 35\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert35_gpu8
	layer5_expert36_gpu9 [label="Layer 5 Expert 36\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert36_gpu9
	layer5_expert37_gpu9 [label="Layer 5 Expert 37\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert37_gpu9
	layer5_expert38_gpu9 [label="Layer 5 Expert 38\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert38_gpu9
	layer5_expert39_gpu9 [label="Layer 5 Expert 39\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert39_gpu9
	layer5_expert40_gpu10 [label="Layer 5 Expert 40\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert40_gpu10
	layer5_expert41_gpu10 [label="Layer 5 Expert 41\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert41_gpu10
	layer5_expert42_gpu10 [label="Layer 5 Expert 42\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert42_gpu10
	layer5_expert43_gpu10 [label="Layer 5 Expert 43\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert43_gpu10
	layer5_expert44_gpu11 [label="Layer 5 Expert 44\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert44_gpu11
	layer5_expert45_gpu11 [label="Layer 5 Expert 45\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert45_gpu11
	layer5_expert46_gpu11 [label="Layer 5 Expert 46\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert46_gpu11
	layer5_expert47_gpu11 [label="Layer 5 Expert 47\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert47_gpu11
	layer5_expert48_gpu12 [label="Layer 5 Expert 48\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert48_gpu12
	layer5_expert49_gpu12 [label="Layer 5 Expert 49\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert49_gpu12
	layer5_expert50_gpu12 [label="Layer 5 Expert 50\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert50_gpu12
	layer5_expert51_gpu12 [label="Layer 5 Expert 51\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert51_gpu12
	layer5_expert52_gpu13 [label="Layer 5 Expert 52\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert52_gpu13
	layer5_expert53_gpu13 [label="Layer 5 Expert 53\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert53_gpu13
	layer5_expert54_gpu13 [label="Layer 5 Expert 54\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert54_gpu13
	layer5_expert55_gpu13 [label="Layer 5 Expert 55\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert55_gpu13
	layer5_expert56_gpu14 [label="Layer 5 Expert 56\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert56_gpu14
	layer5_expert57_gpu14 [label="Layer 5 Expert 57\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert57_gpu14
	layer5_expert58_gpu14 [label="Layer 5 Expert 58\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert58_gpu14
	layer5_expert59_gpu14 [label="Layer 5 Expert 59\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert59_gpu14
	layer5_expert60_gpu15 [label="Layer 5 Expert 60\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert60_gpu15
	layer5_expert61_gpu15 [label="Layer 5 Expert 61\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert61_gpu15
	layer5_expert62_gpu15 [label="Layer 5 Expert 62\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert62_gpu15
	layer5_expert63_gpu15 [label="Layer 5 Expert 63\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_router -> layer5_expert63_gpu15
	layer5_moe_agg [label="Layer 5 MoE Aggregation\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightgreen fontname=Arial shape=parallelogram style=filled]
	layer5_expert0_gpu0 -> layer5_moe_agg
	layer5_expert1_gpu0 -> layer5_moe_agg
	layer5_expert2_gpu0 -> layer5_moe_agg
	layer5_expert3_gpu0 -> layer5_moe_agg
	layer5_expert4_gpu1 -> layer5_moe_agg
	layer5_expert5_gpu1 -> layer5_moe_agg
	layer5_expert6_gpu1 -> layer5_moe_agg
	layer5_expert7_gpu1 -> layer5_moe_agg
	layer5_expert8_gpu2 -> layer5_moe_agg
	layer5_expert9_gpu2 -> layer5_moe_agg
	layer5_expert10_gpu2 -> layer5_moe_agg
	layer5_expert11_gpu2 -> layer5_moe_agg
	layer5_expert12_gpu3 -> layer5_moe_agg
	layer5_expert13_gpu3 -> layer5_moe_agg
	layer5_expert14_gpu3 -> layer5_moe_agg
	layer5_expert15_gpu3 -> layer5_moe_agg
	layer5_expert16_gpu4 -> layer5_moe_agg
	layer5_expert17_gpu4 -> layer5_moe_agg
	layer5_expert18_gpu4 -> layer5_moe_agg
	layer5_expert19_gpu4 -> layer5_moe_agg
	layer5_expert20_gpu5 -> layer5_moe_agg
	layer5_expert21_gpu5 -> layer5_moe_agg
	layer5_expert22_gpu5 -> layer5_moe_agg
	layer5_expert23_gpu5 -> layer5_moe_agg
	layer5_expert24_gpu6 -> layer5_moe_agg
	layer5_expert25_gpu6 -> layer5_moe_agg
	layer5_expert26_gpu6 -> layer5_moe_agg
	layer5_expert27_gpu6 -> layer5_moe_agg
	layer5_expert28_gpu7 -> layer5_moe_agg
	layer5_expert29_gpu7 -> layer5_moe_agg
	layer5_expert30_gpu7 -> layer5_moe_agg
	layer5_expert31_gpu7 -> layer5_moe_agg
	layer5_expert32_gpu8 -> layer5_moe_agg
	layer5_expert33_gpu8 -> layer5_moe_agg
	layer5_expert34_gpu8 -> layer5_moe_agg
	layer5_expert35_gpu8 -> layer5_moe_agg
	layer5_expert36_gpu9 -> layer5_moe_agg
	layer5_expert37_gpu9 -> layer5_moe_agg
	layer5_expert38_gpu9 -> layer5_moe_agg
	layer5_expert39_gpu9 -> layer5_moe_agg
	layer5_expert40_gpu10 -> layer5_moe_agg
	layer5_expert41_gpu10 -> layer5_moe_agg
	layer5_expert42_gpu10 -> layer5_moe_agg
	layer5_expert43_gpu10 -> layer5_moe_agg
	layer5_expert44_gpu11 -> layer5_moe_agg
	layer5_expert45_gpu11 -> layer5_moe_agg
	layer5_expert46_gpu11 -> layer5_moe_agg
	layer5_expert47_gpu11 -> layer5_moe_agg
	layer5_expert48_gpu12 -> layer5_moe_agg
	layer5_expert49_gpu12 -> layer5_moe_agg
	layer5_expert50_gpu12 -> layer5_moe_agg
	layer5_expert51_gpu12 -> layer5_moe_agg
	layer5_expert52_gpu13 -> layer5_moe_agg
	layer5_expert53_gpu13 -> layer5_moe_agg
	layer5_expert54_gpu13 -> layer5_moe_agg
	layer5_expert55_gpu13 -> layer5_moe_agg
	layer5_expert56_gpu14 -> layer5_moe_agg
	layer5_expert57_gpu14 -> layer5_moe_agg
	layer5_expert58_gpu14 -> layer5_moe_agg
	layer5_expert59_gpu14 -> layer5_moe_agg
	layer5_expert60_gpu15 -> layer5_moe_agg
	layer5_expert61_gpu15 -> layer5_moe_agg
	layer5_expert62_gpu15 -> layer5_moe_agg
	layer5_expert63_gpu15 -> layer5_moe_agg
	layer5_norm_residual [label="Layer 5 Norm + Residual\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_moe_agg -> layer5_norm_residual
	layer5_output_final [label="Layer 5 Final Output\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer5_norm_residual -> layer5_output_final
	layer6_boundary [label="Layer 6\nStage 1" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer5_output_final -> layer6_boundary
	layer6_attn_qkv_gpu4 [label="Layer 6 Attention QKV\nGPU 4\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_attn_scores_gpu4 [label="Layer 6 Attention Scores\nGPU 4\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_attn_out_gpu4 [label="Layer 6 Attention Output\nGPU 4\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_boundary -> layer6_attn_qkv_gpu4
	layer6_attn_qkv_gpu4 -> layer6_attn_scores_gpu4
	layer6_attn_scores_gpu4 -> layer6_attn_out_gpu4
	layer6_attn_qkv_gpu5 [label="Layer 6 Attention QKV\nGPU 5\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_attn_scores_gpu5 [label="Layer 6 Attention Scores\nGPU 5\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_attn_out_gpu5 [label="Layer 6 Attention Output\nGPU 5\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_attn_qkv_gpu5 -> layer6_attn_scores_gpu5
	layer6_attn_scores_gpu5 -> layer6_attn_out_gpu5
	layer6_attn_qkv_gpu6 [label="Layer 6 Attention QKV\nGPU 6\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_attn_scores_gpu6 [label="Layer 6 Attention Scores\nGPU 6\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_attn_out_gpu6 [label="Layer 6 Attention Output\nGPU 6\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_attn_qkv_gpu6 -> layer6_attn_scores_gpu6
	layer6_attn_scores_gpu6 -> layer6_attn_out_gpu6
	layer6_attn_qkv_gpu7 [label="Layer 6 Attention QKV\nGPU 7\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_attn_scores_gpu7 [label="Layer 6 Attention Scores\nGPU 7\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_attn_out_gpu7 [label="Layer 6 Attention Output\nGPU 7\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_attn_qkv_gpu7 -> layer6_attn_scores_gpu7
	layer6_attn_scores_gpu7 -> layer6_attn_out_gpu7
	layer6_attn_allreduce [label="Layer 6 Attention All-Reduce\nGPUs 4-7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightcoral fontname=Arial shape=ellipse style=filled]
	layer6_attn_out_gpu4 -> layer6_attn_allreduce
	layer6_attn_out_gpu5 -> layer6_attn_allreduce
	layer6_attn_out_gpu6 -> layer6_attn_allreduce
	layer6_attn_out_gpu7 -> layer6_attn_allreduce
	layer6_moe_router [label="Layer 6 MoE Router\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer6_attn_allreduce -> layer6_moe_router
	layer6_expert0_gpu0 [label="Layer 6 Expert 0\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert0_gpu0
	layer6_expert1_gpu0 [label="Layer 6 Expert 1\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert1_gpu0
	layer6_expert2_gpu0 [label="Layer 6 Expert 2\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert2_gpu0
	layer6_expert3_gpu0 [label="Layer 6 Expert 3\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert3_gpu0
	layer6_expert4_gpu1 [label="Layer 6 Expert 4\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert4_gpu1
	layer6_expert5_gpu1 [label="Layer 6 Expert 5\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert5_gpu1
	layer6_expert6_gpu1 [label="Layer 6 Expert 6\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert6_gpu1
	layer6_expert7_gpu1 [label="Layer 6 Expert 7\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert7_gpu1
	layer6_expert8_gpu2 [label="Layer 6 Expert 8\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert8_gpu2
	layer6_expert9_gpu2 [label="Layer 6 Expert 9\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert9_gpu2
	layer6_expert10_gpu2 [label="Layer 6 Expert 10\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert10_gpu2
	layer6_expert11_gpu2 [label="Layer 6 Expert 11\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert11_gpu2
	layer6_expert12_gpu3 [label="Layer 6 Expert 12\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert12_gpu3
	layer6_expert13_gpu3 [label="Layer 6 Expert 13\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert13_gpu3
	layer6_expert14_gpu3 [label="Layer 6 Expert 14\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert14_gpu3
	layer6_expert15_gpu3 [label="Layer 6 Expert 15\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert15_gpu3
	layer6_expert16_gpu4 [label="Layer 6 Expert 16\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert16_gpu4
	layer6_expert17_gpu4 [label="Layer 6 Expert 17\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert17_gpu4
	layer6_expert18_gpu4 [label="Layer 6 Expert 18\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert18_gpu4
	layer6_expert19_gpu4 [label="Layer 6 Expert 19\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert19_gpu4
	layer6_expert20_gpu5 [label="Layer 6 Expert 20\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert20_gpu5
	layer6_expert21_gpu5 [label="Layer 6 Expert 21\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert21_gpu5
	layer6_expert22_gpu5 [label="Layer 6 Expert 22\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert22_gpu5
	layer6_expert23_gpu5 [label="Layer 6 Expert 23\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert23_gpu5
	layer6_expert24_gpu6 [label="Layer 6 Expert 24\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert24_gpu6
	layer6_expert25_gpu6 [label="Layer 6 Expert 25\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert25_gpu6
	layer6_expert26_gpu6 [label="Layer 6 Expert 26\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert26_gpu6
	layer6_expert27_gpu6 [label="Layer 6 Expert 27\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert27_gpu6
	layer6_expert28_gpu7 [label="Layer 6 Expert 28\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert28_gpu7
	layer6_expert29_gpu7 [label="Layer 6 Expert 29\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert29_gpu7
	layer6_expert30_gpu7 [label="Layer 6 Expert 30\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert30_gpu7
	layer6_expert31_gpu7 [label="Layer 6 Expert 31\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert31_gpu7
	layer6_expert32_gpu8 [label="Layer 6 Expert 32\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert32_gpu8
	layer6_expert33_gpu8 [label="Layer 6 Expert 33\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert33_gpu8
	layer6_expert34_gpu8 [label="Layer 6 Expert 34\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert34_gpu8
	layer6_expert35_gpu8 [label="Layer 6 Expert 35\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert35_gpu8
	layer6_expert36_gpu9 [label="Layer 6 Expert 36\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert36_gpu9
	layer6_expert37_gpu9 [label="Layer 6 Expert 37\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert37_gpu9
	layer6_expert38_gpu9 [label="Layer 6 Expert 38\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert38_gpu9
	layer6_expert39_gpu9 [label="Layer 6 Expert 39\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert39_gpu9
	layer6_expert40_gpu10 [label="Layer 6 Expert 40\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert40_gpu10
	layer6_expert41_gpu10 [label="Layer 6 Expert 41\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert41_gpu10
	layer6_expert42_gpu10 [label="Layer 6 Expert 42\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert42_gpu10
	layer6_expert43_gpu10 [label="Layer 6 Expert 43\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert43_gpu10
	layer6_expert44_gpu11 [label="Layer 6 Expert 44\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert44_gpu11
	layer6_expert45_gpu11 [label="Layer 6 Expert 45\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert45_gpu11
	layer6_expert46_gpu11 [label="Layer 6 Expert 46\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert46_gpu11
	layer6_expert47_gpu11 [label="Layer 6 Expert 47\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert47_gpu11
	layer6_expert48_gpu12 [label="Layer 6 Expert 48\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert48_gpu12
	layer6_expert49_gpu12 [label="Layer 6 Expert 49\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert49_gpu12
	layer6_expert50_gpu12 [label="Layer 6 Expert 50\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert50_gpu12
	layer6_expert51_gpu12 [label="Layer 6 Expert 51\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert51_gpu12
	layer6_expert52_gpu13 [label="Layer 6 Expert 52\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert52_gpu13
	layer6_expert53_gpu13 [label="Layer 6 Expert 53\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert53_gpu13
	layer6_expert54_gpu13 [label="Layer 6 Expert 54\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert54_gpu13
	layer6_expert55_gpu13 [label="Layer 6 Expert 55\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert55_gpu13
	layer6_expert56_gpu14 [label="Layer 6 Expert 56\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert56_gpu14
	layer6_expert57_gpu14 [label="Layer 6 Expert 57\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert57_gpu14
	layer6_expert58_gpu14 [label="Layer 6 Expert 58\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert58_gpu14
	layer6_expert59_gpu14 [label="Layer 6 Expert 59\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert59_gpu14
	layer6_expert60_gpu15 [label="Layer 6 Expert 60\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert60_gpu15
	layer6_expert61_gpu15 [label="Layer 6 Expert 61\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert61_gpu15
	layer6_expert62_gpu15 [label="Layer 6 Expert 62\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert62_gpu15
	layer6_expert63_gpu15 [label="Layer 6 Expert 63\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_router -> layer6_expert63_gpu15
	layer6_moe_agg [label="Layer 6 MoE Aggregation\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightgreen fontname=Arial shape=parallelogram style=filled]
	layer6_expert0_gpu0 -> layer6_moe_agg
	layer6_expert1_gpu0 -> layer6_moe_agg
	layer6_expert2_gpu0 -> layer6_moe_agg
	layer6_expert3_gpu0 -> layer6_moe_agg
	layer6_expert4_gpu1 -> layer6_moe_agg
	layer6_expert5_gpu1 -> layer6_moe_agg
	layer6_expert6_gpu1 -> layer6_moe_agg
	layer6_expert7_gpu1 -> layer6_moe_agg
	layer6_expert8_gpu2 -> layer6_moe_agg
	layer6_expert9_gpu2 -> layer6_moe_agg
	layer6_expert10_gpu2 -> layer6_moe_agg
	layer6_expert11_gpu2 -> layer6_moe_agg
	layer6_expert12_gpu3 -> layer6_moe_agg
	layer6_expert13_gpu3 -> layer6_moe_agg
	layer6_expert14_gpu3 -> layer6_moe_agg
	layer6_expert15_gpu3 -> layer6_moe_agg
	layer6_expert16_gpu4 -> layer6_moe_agg
	layer6_expert17_gpu4 -> layer6_moe_agg
	layer6_expert18_gpu4 -> layer6_moe_agg
	layer6_expert19_gpu4 -> layer6_moe_agg
	layer6_expert20_gpu5 -> layer6_moe_agg
	layer6_expert21_gpu5 -> layer6_moe_agg
	layer6_expert22_gpu5 -> layer6_moe_agg
	layer6_expert23_gpu5 -> layer6_moe_agg
	layer6_expert24_gpu6 -> layer6_moe_agg
	layer6_expert25_gpu6 -> layer6_moe_agg
	layer6_expert26_gpu6 -> layer6_moe_agg
	layer6_expert27_gpu6 -> layer6_moe_agg
	layer6_expert28_gpu7 -> layer6_moe_agg
	layer6_expert29_gpu7 -> layer6_moe_agg
	layer6_expert30_gpu7 -> layer6_moe_agg
	layer6_expert31_gpu7 -> layer6_moe_agg
	layer6_expert32_gpu8 -> layer6_moe_agg
	layer6_expert33_gpu8 -> layer6_moe_agg
	layer6_expert34_gpu8 -> layer6_moe_agg
	layer6_expert35_gpu8 -> layer6_moe_agg
	layer6_expert36_gpu9 -> layer6_moe_agg
	layer6_expert37_gpu9 -> layer6_moe_agg
	layer6_expert38_gpu9 -> layer6_moe_agg
	layer6_expert39_gpu9 -> layer6_moe_agg
	layer6_expert40_gpu10 -> layer6_moe_agg
	layer6_expert41_gpu10 -> layer6_moe_agg
	layer6_expert42_gpu10 -> layer6_moe_agg
	layer6_expert43_gpu10 -> layer6_moe_agg
	layer6_expert44_gpu11 -> layer6_moe_agg
	layer6_expert45_gpu11 -> layer6_moe_agg
	layer6_expert46_gpu11 -> layer6_moe_agg
	layer6_expert47_gpu11 -> layer6_moe_agg
	layer6_expert48_gpu12 -> layer6_moe_agg
	layer6_expert49_gpu12 -> layer6_moe_agg
	layer6_expert50_gpu12 -> layer6_moe_agg
	layer6_expert51_gpu12 -> layer6_moe_agg
	layer6_expert52_gpu13 -> layer6_moe_agg
	layer6_expert53_gpu13 -> layer6_moe_agg
	layer6_expert54_gpu13 -> layer6_moe_agg
	layer6_expert55_gpu13 -> layer6_moe_agg
	layer6_expert56_gpu14 -> layer6_moe_agg
	layer6_expert57_gpu14 -> layer6_moe_agg
	layer6_expert58_gpu14 -> layer6_moe_agg
	layer6_expert59_gpu14 -> layer6_moe_agg
	layer6_expert60_gpu15 -> layer6_moe_agg
	layer6_expert61_gpu15 -> layer6_moe_agg
	layer6_expert62_gpu15 -> layer6_moe_agg
	layer6_expert63_gpu15 -> layer6_moe_agg
	layer6_norm_residual [label="Layer 6 Norm + Residual\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_moe_agg -> layer6_norm_residual
	layer6_output_final [label="Layer 6 Final Output\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer6_norm_residual -> layer6_output_final
	layer7_boundary [label="Layer 7\nStage 1" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer6_output_final -> layer7_boundary
	layer7_attn_qkv_gpu4 [label="Layer 7 Attention QKV\nGPU 4\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_attn_scores_gpu4 [label="Layer 7 Attention Scores\nGPU 4\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_attn_out_gpu4 [label="Layer 7 Attention Output\nGPU 4\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_boundary -> layer7_attn_qkv_gpu4
	layer7_attn_qkv_gpu4 -> layer7_attn_scores_gpu4
	layer7_attn_scores_gpu4 -> layer7_attn_out_gpu4
	layer7_attn_qkv_gpu5 [label="Layer 7 Attention QKV\nGPU 5\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_attn_scores_gpu5 [label="Layer 7 Attention Scores\nGPU 5\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_attn_out_gpu5 [label="Layer 7 Attention Output\nGPU 5\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_attn_qkv_gpu5 -> layer7_attn_scores_gpu5
	layer7_attn_scores_gpu5 -> layer7_attn_out_gpu5
	layer7_attn_qkv_gpu6 [label="Layer 7 Attention QKV\nGPU 6\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_attn_scores_gpu6 [label="Layer 7 Attention Scores\nGPU 6\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_attn_out_gpu6 [label="Layer 7 Attention Output\nGPU 6\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_attn_qkv_gpu6 -> layer7_attn_scores_gpu6
	layer7_attn_scores_gpu6 -> layer7_attn_out_gpu6
	layer7_attn_qkv_gpu7 [label="Layer 7 Attention QKV\nGPU 7\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_attn_scores_gpu7 [label="Layer 7 Attention Scores\nGPU 7\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_attn_out_gpu7 [label="Layer 7 Attention Output\nGPU 7\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_attn_qkv_gpu7 -> layer7_attn_scores_gpu7
	layer7_attn_scores_gpu7 -> layer7_attn_out_gpu7
	layer7_attn_allreduce [label="Layer 7 Attention All-Reduce\nGPUs 4-7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightcoral fontname=Arial shape=ellipse style=filled]
	layer7_attn_out_gpu4 -> layer7_attn_allreduce
	layer7_attn_out_gpu5 -> layer7_attn_allreduce
	layer7_attn_out_gpu6 -> layer7_attn_allreduce
	layer7_attn_out_gpu7 -> layer7_attn_allreduce
	layer7_moe_router [label="Layer 7 MoE Router\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer7_attn_allreduce -> layer7_moe_router
	layer7_expert0_gpu0 [label="Layer 7 Expert 0\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert0_gpu0
	layer7_expert1_gpu0 [label="Layer 7 Expert 1\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert1_gpu0
	layer7_expert2_gpu0 [label="Layer 7 Expert 2\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert2_gpu0
	layer7_expert3_gpu0 [label="Layer 7 Expert 3\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert3_gpu0
	layer7_expert4_gpu1 [label="Layer 7 Expert 4\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert4_gpu1
	layer7_expert5_gpu1 [label="Layer 7 Expert 5\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert5_gpu1
	layer7_expert6_gpu1 [label="Layer 7 Expert 6\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert6_gpu1
	layer7_expert7_gpu1 [label="Layer 7 Expert 7\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert7_gpu1
	layer7_expert8_gpu2 [label="Layer 7 Expert 8\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert8_gpu2
	layer7_expert9_gpu2 [label="Layer 7 Expert 9\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert9_gpu2
	layer7_expert10_gpu2 [label="Layer 7 Expert 10\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert10_gpu2
	layer7_expert11_gpu2 [label="Layer 7 Expert 11\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert11_gpu2
	layer7_expert12_gpu3 [label="Layer 7 Expert 12\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert12_gpu3
	layer7_expert13_gpu3 [label="Layer 7 Expert 13\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert13_gpu3
	layer7_expert14_gpu3 [label="Layer 7 Expert 14\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert14_gpu3
	layer7_expert15_gpu3 [label="Layer 7 Expert 15\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert15_gpu3
	layer7_expert16_gpu4 [label="Layer 7 Expert 16\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert16_gpu4
	layer7_expert17_gpu4 [label="Layer 7 Expert 17\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert17_gpu4
	layer7_expert18_gpu4 [label="Layer 7 Expert 18\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert18_gpu4
	layer7_expert19_gpu4 [label="Layer 7 Expert 19\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert19_gpu4
	layer7_expert20_gpu5 [label="Layer 7 Expert 20\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert20_gpu5
	layer7_expert21_gpu5 [label="Layer 7 Expert 21\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert21_gpu5
	layer7_expert22_gpu5 [label="Layer 7 Expert 22\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert22_gpu5
	layer7_expert23_gpu5 [label="Layer 7 Expert 23\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert23_gpu5
	layer7_expert24_gpu6 [label="Layer 7 Expert 24\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert24_gpu6
	layer7_expert25_gpu6 [label="Layer 7 Expert 25\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert25_gpu6
	layer7_expert26_gpu6 [label="Layer 7 Expert 26\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert26_gpu6
	layer7_expert27_gpu6 [label="Layer 7 Expert 27\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert27_gpu6
	layer7_expert28_gpu7 [label="Layer 7 Expert 28\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert28_gpu7
	layer7_expert29_gpu7 [label="Layer 7 Expert 29\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert29_gpu7
	layer7_expert30_gpu7 [label="Layer 7 Expert 30\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert30_gpu7
	layer7_expert31_gpu7 [label="Layer 7 Expert 31\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert31_gpu7
	layer7_expert32_gpu8 [label="Layer 7 Expert 32\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert32_gpu8
	layer7_expert33_gpu8 [label="Layer 7 Expert 33\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert33_gpu8
	layer7_expert34_gpu8 [label="Layer 7 Expert 34\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert34_gpu8
	layer7_expert35_gpu8 [label="Layer 7 Expert 35\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert35_gpu8
	layer7_expert36_gpu9 [label="Layer 7 Expert 36\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert36_gpu9
	layer7_expert37_gpu9 [label="Layer 7 Expert 37\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert37_gpu9
	layer7_expert38_gpu9 [label="Layer 7 Expert 38\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert38_gpu9
	layer7_expert39_gpu9 [label="Layer 7 Expert 39\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert39_gpu9
	layer7_expert40_gpu10 [label="Layer 7 Expert 40\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert40_gpu10
	layer7_expert41_gpu10 [label="Layer 7 Expert 41\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert41_gpu10
	layer7_expert42_gpu10 [label="Layer 7 Expert 42\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert42_gpu10
	layer7_expert43_gpu10 [label="Layer 7 Expert 43\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert43_gpu10
	layer7_expert44_gpu11 [label="Layer 7 Expert 44\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert44_gpu11
	layer7_expert45_gpu11 [label="Layer 7 Expert 45\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert45_gpu11
	layer7_expert46_gpu11 [label="Layer 7 Expert 46\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert46_gpu11
	layer7_expert47_gpu11 [label="Layer 7 Expert 47\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert47_gpu11
	layer7_expert48_gpu12 [label="Layer 7 Expert 48\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert48_gpu12
	layer7_expert49_gpu12 [label="Layer 7 Expert 49\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert49_gpu12
	layer7_expert50_gpu12 [label="Layer 7 Expert 50\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert50_gpu12
	layer7_expert51_gpu12 [label="Layer 7 Expert 51\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert51_gpu12
	layer7_expert52_gpu13 [label="Layer 7 Expert 52\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert52_gpu13
	layer7_expert53_gpu13 [label="Layer 7 Expert 53\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert53_gpu13
	layer7_expert54_gpu13 [label="Layer 7 Expert 54\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert54_gpu13
	layer7_expert55_gpu13 [label="Layer 7 Expert 55\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert55_gpu13
	layer7_expert56_gpu14 [label="Layer 7 Expert 56\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert56_gpu14
	layer7_expert57_gpu14 [label="Layer 7 Expert 57\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert57_gpu14
	layer7_expert58_gpu14 [label="Layer 7 Expert 58\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert58_gpu14
	layer7_expert59_gpu14 [label="Layer 7 Expert 59\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert59_gpu14
	layer7_expert60_gpu15 [label="Layer 7 Expert 60\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert60_gpu15
	layer7_expert61_gpu15 [label="Layer 7 Expert 61\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert61_gpu15
	layer7_expert62_gpu15 [label="Layer 7 Expert 62\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert62_gpu15
	layer7_expert63_gpu15 [label="Layer 7 Expert 63\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_router -> layer7_expert63_gpu15
	layer7_moe_agg [label="Layer 7 MoE Aggregation\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightgreen fontname=Arial shape=parallelogram style=filled]
	layer7_expert0_gpu0 -> layer7_moe_agg
	layer7_expert1_gpu0 -> layer7_moe_agg
	layer7_expert2_gpu0 -> layer7_moe_agg
	layer7_expert3_gpu0 -> layer7_moe_agg
	layer7_expert4_gpu1 -> layer7_moe_agg
	layer7_expert5_gpu1 -> layer7_moe_agg
	layer7_expert6_gpu1 -> layer7_moe_agg
	layer7_expert7_gpu1 -> layer7_moe_agg
	layer7_expert8_gpu2 -> layer7_moe_agg
	layer7_expert9_gpu2 -> layer7_moe_agg
	layer7_expert10_gpu2 -> layer7_moe_agg
	layer7_expert11_gpu2 -> layer7_moe_agg
	layer7_expert12_gpu3 -> layer7_moe_agg
	layer7_expert13_gpu3 -> layer7_moe_agg
	layer7_expert14_gpu3 -> layer7_moe_agg
	layer7_expert15_gpu3 -> layer7_moe_agg
	layer7_expert16_gpu4 -> layer7_moe_agg
	layer7_expert17_gpu4 -> layer7_moe_agg
	layer7_expert18_gpu4 -> layer7_moe_agg
	layer7_expert19_gpu4 -> layer7_moe_agg
	layer7_expert20_gpu5 -> layer7_moe_agg
	layer7_expert21_gpu5 -> layer7_moe_agg
	layer7_expert22_gpu5 -> layer7_moe_agg
	layer7_expert23_gpu5 -> layer7_moe_agg
	layer7_expert24_gpu6 -> layer7_moe_agg
	layer7_expert25_gpu6 -> layer7_moe_agg
	layer7_expert26_gpu6 -> layer7_moe_agg
	layer7_expert27_gpu6 -> layer7_moe_agg
	layer7_expert28_gpu7 -> layer7_moe_agg
	layer7_expert29_gpu7 -> layer7_moe_agg
	layer7_expert30_gpu7 -> layer7_moe_agg
	layer7_expert31_gpu7 -> layer7_moe_agg
	layer7_expert32_gpu8 -> layer7_moe_agg
	layer7_expert33_gpu8 -> layer7_moe_agg
	layer7_expert34_gpu8 -> layer7_moe_agg
	layer7_expert35_gpu8 -> layer7_moe_agg
	layer7_expert36_gpu9 -> layer7_moe_agg
	layer7_expert37_gpu9 -> layer7_moe_agg
	layer7_expert38_gpu9 -> layer7_moe_agg
	layer7_expert39_gpu9 -> layer7_moe_agg
	layer7_expert40_gpu10 -> layer7_moe_agg
	layer7_expert41_gpu10 -> layer7_moe_agg
	layer7_expert42_gpu10 -> layer7_moe_agg
	layer7_expert43_gpu10 -> layer7_moe_agg
	layer7_expert44_gpu11 -> layer7_moe_agg
	layer7_expert45_gpu11 -> layer7_moe_agg
	layer7_expert46_gpu11 -> layer7_moe_agg
	layer7_expert47_gpu11 -> layer7_moe_agg
	layer7_expert48_gpu12 -> layer7_moe_agg
	layer7_expert49_gpu12 -> layer7_moe_agg
	layer7_expert50_gpu12 -> layer7_moe_agg
	layer7_expert51_gpu12 -> layer7_moe_agg
	layer7_expert52_gpu13 -> layer7_moe_agg
	layer7_expert53_gpu13 -> layer7_moe_agg
	layer7_expert54_gpu13 -> layer7_moe_agg
	layer7_expert55_gpu13 -> layer7_moe_agg
	layer7_expert56_gpu14 -> layer7_moe_agg
	layer7_expert57_gpu14 -> layer7_moe_agg
	layer7_expert58_gpu14 -> layer7_moe_agg
	layer7_expert59_gpu14 -> layer7_moe_agg
	layer7_expert60_gpu15 -> layer7_moe_agg
	layer7_expert61_gpu15 -> layer7_moe_agg
	layer7_expert62_gpu15 -> layer7_moe_agg
	layer7_expert63_gpu15 -> layer7_moe_agg
	layer7_norm_residual [label="Layer 7 Norm + Residual\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_moe_agg -> layer7_norm_residual
	layer7_output_final [label="Layer 7 Final Output\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer7_norm_residual -> layer7_output_final
	stage_2_boundary [label="Pipeline Stage 2\nGPUs 8-11" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer7_output_final -> stage_2_boundary
	layer8_boundary [label="Layer 8\nStage 2" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	stage_2_boundary -> layer8_boundary
	layer8_attn_qkv_gpu8 [label="Layer 8 Attention QKV\nGPU 8\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_attn_scores_gpu8 [label="Layer 8 Attention Scores\nGPU 8\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_attn_out_gpu8 [label="Layer 8 Attention Output\nGPU 8\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_boundary -> layer8_attn_qkv_gpu8
	layer8_attn_qkv_gpu8 -> layer8_attn_scores_gpu8
	layer8_attn_scores_gpu8 -> layer8_attn_out_gpu8
	layer8_attn_qkv_gpu9 [label="Layer 8 Attention QKV\nGPU 9\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_attn_scores_gpu9 [label="Layer 8 Attention Scores\nGPU 9\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_attn_out_gpu9 [label="Layer 8 Attention Output\nGPU 9\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_attn_qkv_gpu9 -> layer8_attn_scores_gpu9
	layer8_attn_scores_gpu9 -> layer8_attn_out_gpu9
	layer8_attn_qkv_gpu10 [label="Layer 8 Attention QKV\nGPU 10\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_attn_scores_gpu10 [label="Layer 8 Attention Scores\nGPU 10\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_attn_out_gpu10 [label="Layer 8 Attention Output\nGPU 10\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_attn_qkv_gpu10 -> layer8_attn_scores_gpu10
	layer8_attn_scores_gpu10 -> layer8_attn_out_gpu10
	layer8_attn_qkv_gpu11 [label="Layer 8 Attention QKV\nGPU 11\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_attn_scores_gpu11 [label="Layer 8 Attention Scores\nGPU 11\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_attn_out_gpu11 [label="Layer 8 Attention Output\nGPU 11\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_attn_qkv_gpu11 -> layer8_attn_scores_gpu11
	layer8_attn_scores_gpu11 -> layer8_attn_out_gpu11
	layer8_attn_allreduce [label="Layer 8 Attention All-Reduce\nGPUs 8-11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightcoral fontname=Arial shape=ellipse style=filled]
	layer8_attn_out_gpu8 -> layer8_attn_allreduce
	layer8_attn_out_gpu9 -> layer8_attn_allreduce
	layer8_attn_out_gpu10 -> layer8_attn_allreduce
	layer8_attn_out_gpu11 -> layer8_attn_allreduce
	layer8_moe_router [label="Layer 8 MoE Router\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer8_attn_allreduce -> layer8_moe_router
	layer8_expert0_gpu0 [label="Layer 8 Expert 0\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert0_gpu0
	layer8_expert1_gpu0 [label="Layer 8 Expert 1\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert1_gpu0
	layer8_expert2_gpu0 [label="Layer 8 Expert 2\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert2_gpu0
	layer8_expert3_gpu0 [label="Layer 8 Expert 3\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert3_gpu0
	layer8_expert4_gpu1 [label="Layer 8 Expert 4\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert4_gpu1
	layer8_expert5_gpu1 [label="Layer 8 Expert 5\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert5_gpu1
	layer8_expert6_gpu1 [label="Layer 8 Expert 6\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert6_gpu1
	layer8_expert7_gpu1 [label="Layer 8 Expert 7\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert7_gpu1
	layer8_expert8_gpu2 [label="Layer 8 Expert 8\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert8_gpu2
	layer8_expert9_gpu2 [label="Layer 8 Expert 9\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert9_gpu2
	layer8_expert10_gpu2 [label="Layer 8 Expert 10\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert10_gpu2
	layer8_expert11_gpu2 [label="Layer 8 Expert 11\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert11_gpu2
	layer8_expert12_gpu3 [label="Layer 8 Expert 12\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert12_gpu3
	layer8_expert13_gpu3 [label="Layer 8 Expert 13\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert13_gpu3
	layer8_expert14_gpu3 [label="Layer 8 Expert 14\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert14_gpu3
	layer8_expert15_gpu3 [label="Layer 8 Expert 15\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert15_gpu3
	layer8_expert16_gpu4 [label="Layer 8 Expert 16\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert16_gpu4
	layer8_expert17_gpu4 [label="Layer 8 Expert 17\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert17_gpu4
	layer8_expert18_gpu4 [label="Layer 8 Expert 18\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert18_gpu4
	layer8_expert19_gpu4 [label="Layer 8 Expert 19\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert19_gpu4
	layer8_expert20_gpu5 [label="Layer 8 Expert 20\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert20_gpu5
	layer8_expert21_gpu5 [label="Layer 8 Expert 21\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert21_gpu5
	layer8_expert22_gpu5 [label="Layer 8 Expert 22\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert22_gpu5
	layer8_expert23_gpu5 [label="Layer 8 Expert 23\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert23_gpu5
	layer8_expert24_gpu6 [label="Layer 8 Expert 24\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert24_gpu6
	layer8_expert25_gpu6 [label="Layer 8 Expert 25\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert25_gpu6
	layer8_expert26_gpu6 [label="Layer 8 Expert 26\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert26_gpu6
	layer8_expert27_gpu6 [label="Layer 8 Expert 27\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert27_gpu6
	layer8_expert28_gpu7 [label="Layer 8 Expert 28\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert28_gpu7
	layer8_expert29_gpu7 [label="Layer 8 Expert 29\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert29_gpu7
	layer8_expert30_gpu7 [label="Layer 8 Expert 30\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert30_gpu7
	layer8_expert31_gpu7 [label="Layer 8 Expert 31\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert31_gpu7
	layer8_expert32_gpu8 [label="Layer 8 Expert 32\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert32_gpu8
	layer8_expert33_gpu8 [label="Layer 8 Expert 33\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert33_gpu8
	layer8_expert34_gpu8 [label="Layer 8 Expert 34\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert34_gpu8
	layer8_expert35_gpu8 [label="Layer 8 Expert 35\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert35_gpu8
	layer8_expert36_gpu9 [label="Layer 8 Expert 36\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert36_gpu9
	layer8_expert37_gpu9 [label="Layer 8 Expert 37\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert37_gpu9
	layer8_expert38_gpu9 [label="Layer 8 Expert 38\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert38_gpu9
	layer8_expert39_gpu9 [label="Layer 8 Expert 39\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert39_gpu9
	layer8_expert40_gpu10 [label="Layer 8 Expert 40\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert40_gpu10
	layer8_expert41_gpu10 [label="Layer 8 Expert 41\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert41_gpu10
	layer8_expert42_gpu10 [label="Layer 8 Expert 42\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert42_gpu10
	layer8_expert43_gpu10 [label="Layer 8 Expert 43\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert43_gpu10
	layer8_expert44_gpu11 [label="Layer 8 Expert 44\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert44_gpu11
	layer8_expert45_gpu11 [label="Layer 8 Expert 45\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert45_gpu11
	layer8_expert46_gpu11 [label="Layer 8 Expert 46\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert46_gpu11
	layer8_expert47_gpu11 [label="Layer 8 Expert 47\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert47_gpu11
	layer8_expert48_gpu12 [label="Layer 8 Expert 48\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert48_gpu12
	layer8_expert49_gpu12 [label="Layer 8 Expert 49\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert49_gpu12
	layer8_expert50_gpu12 [label="Layer 8 Expert 50\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert50_gpu12
	layer8_expert51_gpu12 [label="Layer 8 Expert 51\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert51_gpu12
	layer8_expert52_gpu13 [label="Layer 8 Expert 52\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert52_gpu13
	layer8_expert53_gpu13 [label="Layer 8 Expert 53\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert53_gpu13
	layer8_expert54_gpu13 [label="Layer 8 Expert 54\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert54_gpu13
	layer8_expert55_gpu13 [label="Layer 8 Expert 55\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert55_gpu13
	layer8_expert56_gpu14 [label="Layer 8 Expert 56\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert56_gpu14
	layer8_expert57_gpu14 [label="Layer 8 Expert 57\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert57_gpu14
	layer8_expert58_gpu14 [label="Layer 8 Expert 58\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert58_gpu14
	layer8_expert59_gpu14 [label="Layer 8 Expert 59\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert59_gpu14
	layer8_expert60_gpu15 [label="Layer 8 Expert 60\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert60_gpu15
	layer8_expert61_gpu15 [label="Layer 8 Expert 61\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert61_gpu15
	layer8_expert62_gpu15 [label="Layer 8 Expert 62\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert62_gpu15
	layer8_expert63_gpu15 [label="Layer 8 Expert 63\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_router -> layer8_expert63_gpu15
	layer8_moe_agg [label="Layer 8 MoE Aggregation\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightgreen fontname=Arial shape=parallelogram style=filled]
	layer8_expert0_gpu0 -> layer8_moe_agg
	layer8_expert1_gpu0 -> layer8_moe_agg
	layer8_expert2_gpu0 -> layer8_moe_agg
	layer8_expert3_gpu0 -> layer8_moe_agg
	layer8_expert4_gpu1 -> layer8_moe_agg
	layer8_expert5_gpu1 -> layer8_moe_agg
	layer8_expert6_gpu1 -> layer8_moe_agg
	layer8_expert7_gpu1 -> layer8_moe_agg
	layer8_expert8_gpu2 -> layer8_moe_agg
	layer8_expert9_gpu2 -> layer8_moe_agg
	layer8_expert10_gpu2 -> layer8_moe_agg
	layer8_expert11_gpu2 -> layer8_moe_agg
	layer8_expert12_gpu3 -> layer8_moe_agg
	layer8_expert13_gpu3 -> layer8_moe_agg
	layer8_expert14_gpu3 -> layer8_moe_agg
	layer8_expert15_gpu3 -> layer8_moe_agg
	layer8_expert16_gpu4 -> layer8_moe_agg
	layer8_expert17_gpu4 -> layer8_moe_agg
	layer8_expert18_gpu4 -> layer8_moe_agg
	layer8_expert19_gpu4 -> layer8_moe_agg
	layer8_expert20_gpu5 -> layer8_moe_agg
	layer8_expert21_gpu5 -> layer8_moe_agg
	layer8_expert22_gpu5 -> layer8_moe_agg
	layer8_expert23_gpu5 -> layer8_moe_agg
	layer8_expert24_gpu6 -> layer8_moe_agg
	layer8_expert25_gpu6 -> layer8_moe_agg
	layer8_expert26_gpu6 -> layer8_moe_agg
	layer8_expert27_gpu6 -> layer8_moe_agg
	layer8_expert28_gpu7 -> layer8_moe_agg
	layer8_expert29_gpu7 -> layer8_moe_agg
	layer8_expert30_gpu7 -> layer8_moe_agg
	layer8_expert31_gpu7 -> layer8_moe_agg
	layer8_expert32_gpu8 -> layer8_moe_agg
	layer8_expert33_gpu8 -> layer8_moe_agg
	layer8_expert34_gpu8 -> layer8_moe_agg
	layer8_expert35_gpu8 -> layer8_moe_agg
	layer8_expert36_gpu9 -> layer8_moe_agg
	layer8_expert37_gpu9 -> layer8_moe_agg
	layer8_expert38_gpu9 -> layer8_moe_agg
	layer8_expert39_gpu9 -> layer8_moe_agg
	layer8_expert40_gpu10 -> layer8_moe_agg
	layer8_expert41_gpu10 -> layer8_moe_agg
	layer8_expert42_gpu10 -> layer8_moe_agg
	layer8_expert43_gpu10 -> layer8_moe_agg
	layer8_expert44_gpu11 -> layer8_moe_agg
	layer8_expert45_gpu11 -> layer8_moe_agg
	layer8_expert46_gpu11 -> layer8_moe_agg
	layer8_expert47_gpu11 -> layer8_moe_agg
	layer8_expert48_gpu12 -> layer8_moe_agg
	layer8_expert49_gpu12 -> layer8_moe_agg
	layer8_expert50_gpu12 -> layer8_moe_agg
	layer8_expert51_gpu12 -> layer8_moe_agg
	layer8_expert52_gpu13 -> layer8_moe_agg
	layer8_expert53_gpu13 -> layer8_moe_agg
	layer8_expert54_gpu13 -> layer8_moe_agg
	layer8_expert55_gpu13 -> layer8_moe_agg
	layer8_expert56_gpu14 -> layer8_moe_agg
	layer8_expert57_gpu14 -> layer8_moe_agg
	layer8_expert58_gpu14 -> layer8_moe_agg
	layer8_expert59_gpu14 -> layer8_moe_agg
	layer8_expert60_gpu15 -> layer8_moe_agg
	layer8_expert61_gpu15 -> layer8_moe_agg
	layer8_expert62_gpu15 -> layer8_moe_agg
	layer8_expert63_gpu15 -> layer8_moe_agg
	layer8_norm_residual [label="Layer 8 Norm + Residual\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_moe_agg -> layer8_norm_residual
	layer8_output_final [label="Layer 8 Final Output\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer8_norm_residual -> layer8_output_final
	layer9_boundary [label="Layer 9\nStage 2" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer8_output_final -> layer9_boundary
	layer9_attn_qkv_gpu8 [label="Layer 9 Attention QKV\nGPU 8\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_attn_scores_gpu8 [label="Layer 9 Attention Scores\nGPU 8\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_attn_out_gpu8 [label="Layer 9 Attention Output\nGPU 8\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_boundary -> layer9_attn_qkv_gpu8
	layer9_attn_qkv_gpu8 -> layer9_attn_scores_gpu8
	layer9_attn_scores_gpu8 -> layer9_attn_out_gpu8
	layer9_attn_qkv_gpu9 [label="Layer 9 Attention QKV\nGPU 9\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_attn_scores_gpu9 [label="Layer 9 Attention Scores\nGPU 9\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_attn_out_gpu9 [label="Layer 9 Attention Output\nGPU 9\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_attn_qkv_gpu9 -> layer9_attn_scores_gpu9
	layer9_attn_scores_gpu9 -> layer9_attn_out_gpu9
	layer9_attn_qkv_gpu10 [label="Layer 9 Attention QKV\nGPU 10\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_attn_scores_gpu10 [label="Layer 9 Attention Scores\nGPU 10\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_attn_out_gpu10 [label="Layer 9 Attention Output\nGPU 10\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_attn_qkv_gpu10 -> layer9_attn_scores_gpu10
	layer9_attn_scores_gpu10 -> layer9_attn_out_gpu10
	layer9_attn_qkv_gpu11 [label="Layer 9 Attention QKV\nGPU 11\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_attn_scores_gpu11 [label="Layer 9 Attention Scores\nGPU 11\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_attn_out_gpu11 [label="Layer 9 Attention Output\nGPU 11\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_attn_qkv_gpu11 -> layer9_attn_scores_gpu11
	layer9_attn_scores_gpu11 -> layer9_attn_out_gpu11
	layer9_attn_allreduce [label="Layer 9 Attention All-Reduce\nGPUs 8-11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightcoral fontname=Arial shape=ellipse style=filled]
	layer9_attn_out_gpu8 -> layer9_attn_allreduce
	layer9_attn_out_gpu9 -> layer9_attn_allreduce
	layer9_attn_out_gpu10 -> layer9_attn_allreduce
	layer9_attn_out_gpu11 -> layer9_attn_allreduce
	layer9_moe_router [label="Layer 9 MoE Router\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer9_attn_allreduce -> layer9_moe_router
	layer9_expert0_gpu0 [label="Layer 9 Expert 0\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert0_gpu0
	layer9_expert1_gpu0 [label="Layer 9 Expert 1\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert1_gpu0
	layer9_expert2_gpu0 [label="Layer 9 Expert 2\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert2_gpu0
	layer9_expert3_gpu0 [label="Layer 9 Expert 3\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert3_gpu0
	layer9_expert4_gpu1 [label="Layer 9 Expert 4\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert4_gpu1
	layer9_expert5_gpu1 [label="Layer 9 Expert 5\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert5_gpu1
	layer9_expert6_gpu1 [label="Layer 9 Expert 6\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert6_gpu1
	layer9_expert7_gpu1 [label="Layer 9 Expert 7\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert7_gpu1
	layer9_expert8_gpu2 [label="Layer 9 Expert 8\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert8_gpu2
	layer9_expert9_gpu2 [label="Layer 9 Expert 9\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert9_gpu2
	layer9_expert10_gpu2 [label="Layer 9 Expert 10\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert10_gpu2
	layer9_expert11_gpu2 [label="Layer 9 Expert 11\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert11_gpu2
	layer9_expert12_gpu3 [label="Layer 9 Expert 12\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert12_gpu3
	layer9_expert13_gpu3 [label="Layer 9 Expert 13\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert13_gpu3
	layer9_expert14_gpu3 [label="Layer 9 Expert 14\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert14_gpu3
	layer9_expert15_gpu3 [label="Layer 9 Expert 15\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert15_gpu3
	layer9_expert16_gpu4 [label="Layer 9 Expert 16\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert16_gpu4
	layer9_expert17_gpu4 [label="Layer 9 Expert 17\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert17_gpu4
	layer9_expert18_gpu4 [label="Layer 9 Expert 18\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert18_gpu4
	layer9_expert19_gpu4 [label="Layer 9 Expert 19\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert19_gpu4
	layer9_expert20_gpu5 [label="Layer 9 Expert 20\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert20_gpu5
	layer9_expert21_gpu5 [label="Layer 9 Expert 21\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert21_gpu5
	layer9_expert22_gpu5 [label="Layer 9 Expert 22\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert22_gpu5
	layer9_expert23_gpu5 [label="Layer 9 Expert 23\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert23_gpu5
	layer9_expert24_gpu6 [label="Layer 9 Expert 24\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert24_gpu6
	layer9_expert25_gpu6 [label="Layer 9 Expert 25\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert25_gpu6
	layer9_expert26_gpu6 [label="Layer 9 Expert 26\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert26_gpu6
	layer9_expert27_gpu6 [label="Layer 9 Expert 27\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert27_gpu6
	layer9_expert28_gpu7 [label="Layer 9 Expert 28\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert28_gpu7
	layer9_expert29_gpu7 [label="Layer 9 Expert 29\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert29_gpu7
	layer9_expert30_gpu7 [label="Layer 9 Expert 30\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert30_gpu7
	layer9_expert31_gpu7 [label="Layer 9 Expert 31\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert31_gpu7
	layer9_expert32_gpu8 [label="Layer 9 Expert 32\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert32_gpu8
	layer9_expert33_gpu8 [label="Layer 9 Expert 33\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert33_gpu8
	layer9_expert34_gpu8 [label="Layer 9 Expert 34\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert34_gpu8
	layer9_expert35_gpu8 [label="Layer 9 Expert 35\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert35_gpu8
	layer9_expert36_gpu9 [label="Layer 9 Expert 36\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert36_gpu9
	layer9_expert37_gpu9 [label="Layer 9 Expert 37\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert37_gpu9
	layer9_expert38_gpu9 [label="Layer 9 Expert 38\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert38_gpu9
	layer9_expert39_gpu9 [label="Layer 9 Expert 39\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert39_gpu9
	layer9_expert40_gpu10 [label="Layer 9 Expert 40\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert40_gpu10
	layer9_expert41_gpu10 [label="Layer 9 Expert 41\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert41_gpu10
	layer9_expert42_gpu10 [label="Layer 9 Expert 42\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert42_gpu10
	layer9_expert43_gpu10 [label="Layer 9 Expert 43\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert43_gpu10
	layer9_expert44_gpu11 [label="Layer 9 Expert 44\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert44_gpu11
	layer9_expert45_gpu11 [label="Layer 9 Expert 45\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert45_gpu11
	layer9_expert46_gpu11 [label="Layer 9 Expert 46\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert46_gpu11
	layer9_expert47_gpu11 [label="Layer 9 Expert 47\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert47_gpu11
	layer9_expert48_gpu12 [label="Layer 9 Expert 48\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert48_gpu12
	layer9_expert49_gpu12 [label="Layer 9 Expert 49\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert49_gpu12
	layer9_expert50_gpu12 [label="Layer 9 Expert 50\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert50_gpu12
	layer9_expert51_gpu12 [label="Layer 9 Expert 51\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert51_gpu12
	layer9_expert52_gpu13 [label="Layer 9 Expert 52\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert52_gpu13
	layer9_expert53_gpu13 [label="Layer 9 Expert 53\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert53_gpu13
	layer9_expert54_gpu13 [label="Layer 9 Expert 54\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert54_gpu13
	layer9_expert55_gpu13 [label="Layer 9 Expert 55\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert55_gpu13
	layer9_expert56_gpu14 [label="Layer 9 Expert 56\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert56_gpu14
	layer9_expert57_gpu14 [label="Layer 9 Expert 57\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert57_gpu14
	layer9_expert58_gpu14 [label="Layer 9 Expert 58\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert58_gpu14
	layer9_expert59_gpu14 [label="Layer 9 Expert 59\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert59_gpu14
	layer9_expert60_gpu15 [label="Layer 9 Expert 60\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert60_gpu15
	layer9_expert61_gpu15 [label="Layer 9 Expert 61\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert61_gpu15
	layer9_expert62_gpu15 [label="Layer 9 Expert 62\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert62_gpu15
	layer9_expert63_gpu15 [label="Layer 9 Expert 63\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_router -> layer9_expert63_gpu15
	layer9_moe_agg [label="Layer 9 MoE Aggregation\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightgreen fontname=Arial shape=parallelogram style=filled]
	layer9_expert0_gpu0 -> layer9_moe_agg
	layer9_expert1_gpu0 -> layer9_moe_agg
	layer9_expert2_gpu0 -> layer9_moe_agg
	layer9_expert3_gpu0 -> layer9_moe_agg
	layer9_expert4_gpu1 -> layer9_moe_agg
	layer9_expert5_gpu1 -> layer9_moe_agg
	layer9_expert6_gpu1 -> layer9_moe_agg
	layer9_expert7_gpu1 -> layer9_moe_agg
	layer9_expert8_gpu2 -> layer9_moe_agg
	layer9_expert9_gpu2 -> layer9_moe_agg
	layer9_expert10_gpu2 -> layer9_moe_agg
	layer9_expert11_gpu2 -> layer9_moe_agg
	layer9_expert12_gpu3 -> layer9_moe_agg
	layer9_expert13_gpu3 -> layer9_moe_agg
	layer9_expert14_gpu3 -> layer9_moe_agg
	layer9_expert15_gpu3 -> layer9_moe_agg
	layer9_expert16_gpu4 -> layer9_moe_agg
	layer9_expert17_gpu4 -> layer9_moe_agg
	layer9_expert18_gpu4 -> layer9_moe_agg
	layer9_expert19_gpu4 -> layer9_moe_agg
	layer9_expert20_gpu5 -> layer9_moe_agg
	layer9_expert21_gpu5 -> layer9_moe_agg
	layer9_expert22_gpu5 -> layer9_moe_agg
	layer9_expert23_gpu5 -> layer9_moe_agg
	layer9_expert24_gpu6 -> layer9_moe_agg
	layer9_expert25_gpu6 -> layer9_moe_agg
	layer9_expert26_gpu6 -> layer9_moe_agg
	layer9_expert27_gpu6 -> layer9_moe_agg
	layer9_expert28_gpu7 -> layer9_moe_agg
	layer9_expert29_gpu7 -> layer9_moe_agg
	layer9_expert30_gpu7 -> layer9_moe_agg
	layer9_expert31_gpu7 -> layer9_moe_agg
	layer9_expert32_gpu8 -> layer9_moe_agg
	layer9_expert33_gpu8 -> layer9_moe_agg
	layer9_expert34_gpu8 -> layer9_moe_agg
	layer9_expert35_gpu8 -> layer9_moe_agg
	layer9_expert36_gpu9 -> layer9_moe_agg
	layer9_expert37_gpu9 -> layer9_moe_agg
	layer9_expert38_gpu9 -> layer9_moe_agg
	layer9_expert39_gpu9 -> layer9_moe_agg
	layer9_expert40_gpu10 -> layer9_moe_agg
	layer9_expert41_gpu10 -> layer9_moe_agg
	layer9_expert42_gpu10 -> layer9_moe_agg
	layer9_expert43_gpu10 -> layer9_moe_agg
	layer9_expert44_gpu11 -> layer9_moe_agg
	layer9_expert45_gpu11 -> layer9_moe_agg
	layer9_expert46_gpu11 -> layer9_moe_agg
	layer9_expert47_gpu11 -> layer9_moe_agg
	layer9_expert48_gpu12 -> layer9_moe_agg
	layer9_expert49_gpu12 -> layer9_moe_agg
	layer9_expert50_gpu12 -> layer9_moe_agg
	layer9_expert51_gpu12 -> layer9_moe_agg
	layer9_expert52_gpu13 -> layer9_moe_agg
	layer9_expert53_gpu13 -> layer9_moe_agg
	layer9_expert54_gpu13 -> layer9_moe_agg
	layer9_expert55_gpu13 -> layer9_moe_agg
	layer9_expert56_gpu14 -> layer9_moe_agg
	layer9_expert57_gpu14 -> layer9_moe_agg
	layer9_expert58_gpu14 -> layer9_moe_agg
	layer9_expert59_gpu14 -> layer9_moe_agg
	layer9_expert60_gpu15 -> layer9_moe_agg
	layer9_expert61_gpu15 -> layer9_moe_agg
	layer9_expert62_gpu15 -> layer9_moe_agg
	layer9_expert63_gpu15 -> layer9_moe_agg
	layer9_norm_residual [label="Layer 9 Norm + Residual\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_moe_agg -> layer9_norm_residual
	layer9_output_final [label="Layer 9 Final Output\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer9_norm_residual -> layer9_output_final
	layer10_boundary [label="Layer 10\nStage 2" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer9_output_final -> layer10_boundary
	layer10_attn_qkv_gpu8 [label="Layer 10 Attention QKV\nGPU 8\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_attn_scores_gpu8 [label="Layer 10 Attention Scores\nGPU 8\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_attn_out_gpu8 [label="Layer 10 Attention Output\nGPU 8\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_boundary -> layer10_attn_qkv_gpu8
	layer10_attn_qkv_gpu8 -> layer10_attn_scores_gpu8
	layer10_attn_scores_gpu8 -> layer10_attn_out_gpu8
	layer10_attn_qkv_gpu9 [label="Layer 10 Attention QKV\nGPU 9\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_attn_scores_gpu9 [label="Layer 10 Attention Scores\nGPU 9\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_attn_out_gpu9 [label="Layer 10 Attention Output\nGPU 9\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_attn_qkv_gpu9 -> layer10_attn_scores_gpu9
	layer10_attn_scores_gpu9 -> layer10_attn_out_gpu9
	layer10_attn_qkv_gpu10 [label="Layer 10 Attention QKV\nGPU 10\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_attn_scores_gpu10 [label="Layer 10 Attention Scores\nGPU 10\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_attn_out_gpu10 [label="Layer 10 Attention Output\nGPU 10\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_attn_qkv_gpu10 -> layer10_attn_scores_gpu10
	layer10_attn_scores_gpu10 -> layer10_attn_out_gpu10
	layer10_attn_qkv_gpu11 [label="Layer 10 Attention QKV\nGPU 11\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_attn_scores_gpu11 [label="Layer 10 Attention Scores\nGPU 11\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_attn_out_gpu11 [label="Layer 10 Attention Output\nGPU 11\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_attn_qkv_gpu11 -> layer10_attn_scores_gpu11
	layer10_attn_scores_gpu11 -> layer10_attn_out_gpu11
	layer10_attn_allreduce [label="Layer 10 Attention All-Reduce\nGPUs 8-11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightcoral fontname=Arial shape=ellipse style=filled]
	layer10_attn_out_gpu8 -> layer10_attn_allreduce
	layer10_attn_out_gpu9 -> layer10_attn_allreduce
	layer10_attn_out_gpu10 -> layer10_attn_allreduce
	layer10_attn_out_gpu11 -> layer10_attn_allreduce
	layer10_moe_router [label="Layer 10 MoE Router\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer10_attn_allreduce -> layer10_moe_router
	layer10_expert0_gpu0 [label="Layer 10 Expert 0\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert0_gpu0
	layer10_expert1_gpu0 [label="Layer 10 Expert 1\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert1_gpu0
	layer10_expert2_gpu0 [label="Layer 10 Expert 2\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert2_gpu0
	layer10_expert3_gpu0 [label="Layer 10 Expert 3\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert3_gpu0
	layer10_expert4_gpu1 [label="Layer 10 Expert 4\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert4_gpu1
	layer10_expert5_gpu1 [label="Layer 10 Expert 5\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert5_gpu1
	layer10_expert6_gpu1 [label="Layer 10 Expert 6\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert6_gpu1
	layer10_expert7_gpu1 [label="Layer 10 Expert 7\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert7_gpu1
	layer10_expert8_gpu2 [label="Layer 10 Expert 8\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert8_gpu2
	layer10_expert9_gpu2 [label="Layer 10 Expert 9\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert9_gpu2
	layer10_expert10_gpu2 [label="Layer 10 Expert 10\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert10_gpu2
	layer10_expert11_gpu2 [label="Layer 10 Expert 11\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert11_gpu2
	layer10_expert12_gpu3 [label="Layer 10 Expert 12\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert12_gpu3
	layer10_expert13_gpu3 [label="Layer 10 Expert 13\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert13_gpu3
	layer10_expert14_gpu3 [label="Layer 10 Expert 14\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert14_gpu3
	layer10_expert15_gpu3 [label="Layer 10 Expert 15\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert15_gpu3
	layer10_expert16_gpu4 [label="Layer 10 Expert 16\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert16_gpu4
	layer10_expert17_gpu4 [label="Layer 10 Expert 17\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert17_gpu4
	layer10_expert18_gpu4 [label="Layer 10 Expert 18\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert18_gpu4
	layer10_expert19_gpu4 [label="Layer 10 Expert 19\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert19_gpu4
	layer10_expert20_gpu5 [label="Layer 10 Expert 20\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert20_gpu5
	layer10_expert21_gpu5 [label="Layer 10 Expert 21\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert21_gpu5
	layer10_expert22_gpu5 [label="Layer 10 Expert 22\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert22_gpu5
	layer10_expert23_gpu5 [label="Layer 10 Expert 23\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert23_gpu5
	layer10_expert24_gpu6 [label="Layer 10 Expert 24\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert24_gpu6
	layer10_expert25_gpu6 [label="Layer 10 Expert 25\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert25_gpu6
	layer10_expert26_gpu6 [label="Layer 10 Expert 26\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert26_gpu6
	layer10_expert27_gpu6 [label="Layer 10 Expert 27\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert27_gpu6
	layer10_expert28_gpu7 [label="Layer 10 Expert 28\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert28_gpu7
	layer10_expert29_gpu7 [label="Layer 10 Expert 29\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert29_gpu7
	layer10_expert30_gpu7 [label="Layer 10 Expert 30\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert30_gpu7
	layer10_expert31_gpu7 [label="Layer 10 Expert 31\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert31_gpu7
	layer10_expert32_gpu8 [label="Layer 10 Expert 32\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert32_gpu8
	layer10_expert33_gpu8 [label="Layer 10 Expert 33\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert33_gpu8
	layer10_expert34_gpu8 [label="Layer 10 Expert 34\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert34_gpu8
	layer10_expert35_gpu8 [label="Layer 10 Expert 35\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert35_gpu8
	layer10_expert36_gpu9 [label="Layer 10 Expert 36\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert36_gpu9
	layer10_expert37_gpu9 [label="Layer 10 Expert 37\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert37_gpu9
	layer10_expert38_gpu9 [label="Layer 10 Expert 38\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert38_gpu9
	layer10_expert39_gpu9 [label="Layer 10 Expert 39\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert39_gpu9
	layer10_expert40_gpu10 [label="Layer 10 Expert 40\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert40_gpu10
	layer10_expert41_gpu10 [label="Layer 10 Expert 41\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert41_gpu10
	layer10_expert42_gpu10 [label="Layer 10 Expert 42\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert42_gpu10
	layer10_expert43_gpu10 [label="Layer 10 Expert 43\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert43_gpu10
	layer10_expert44_gpu11 [label="Layer 10 Expert 44\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert44_gpu11
	layer10_expert45_gpu11 [label="Layer 10 Expert 45\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert45_gpu11
	layer10_expert46_gpu11 [label="Layer 10 Expert 46\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert46_gpu11
	layer10_expert47_gpu11 [label="Layer 10 Expert 47\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert47_gpu11
	layer10_expert48_gpu12 [label="Layer 10 Expert 48\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert48_gpu12
	layer10_expert49_gpu12 [label="Layer 10 Expert 49\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert49_gpu12
	layer10_expert50_gpu12 [label="Layer 10 Expert 50\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert50_gpu12
	layer10_expert51_gpu12 [label="Layer 10 Expert 51\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert51_gpu12
	layer10_expert52_gpu13 [label="Layer 10 Expert 52\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert52_gpu13
	layer10_expert53_gpu13 [label="Layer 10 Expert 53\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert53_gpu13
	layer10_expert54_gpu13 [label="Layer 10 Expert 54\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert54_gpu13
	layer10_expert55_gpu13 [label="Layer 10 Expert 55\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert55_gpu13
	layer10_expert56_gpu14 [label="Layer 10 Expert 56\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert56_gpu14
	layer10_expert57_gpu14 [label="Layer 10 Expert 57\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert57_gpu14
	layer10_expert58_gpu14 [label="Layer 10 Expert 58\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert58_gpu14
	layer10_expert59_gpu14 [label="Layer 10 Expert 59\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert59_gpu14
	layer10_expert60_gpu15 [label="Layer 10 Expert 60\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert60_gpu15
	layer10_expert61_gpu15 [label="Layer 10 Expert 61\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert61_gpu15
	layer10_expert62_gpu15 [label="Layer 10 Expert 62\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert62_gpu15
	layer10_expert63_gpu15 [label="Layer 10 Expert 63\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_router -> layer10_expert63_gpu15
	layer10_moe_agg [label="Layer 10 MoE Aggregation\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightgreen fontname=Arial shape=parallelogram style=filled]
	layer10_expert0_gpu0 -> layer10_moe_agg
	layer10_expert1_gpu0 -> layer10_moe_agg
	layer10_expert2_gpu0 -> layer10_moe_agg
	layer10_expert3_gpu0 -> layer10_moe_agg
	layer10_expert4_gpu1 -> layer10_moe_agg
	layer10_expert5_gpu1 -> layer10_moe_agg
	layer10_expert6_gpu1 -> layer10_moe_agg
	layer10_expert7_gpu1 -> layer10_moe_agg
	layer10_expert8_gpu2 -> layer10_moe_agg
	layer10_expert9_gpu2 -> layer10_moe_agg
	layer10_expert10_gpu2 -> layer10_moe_agg
	layer10_expert11_gpu2 -> layer10_moe_agg
	layer10_expert12_gpu3 -> layer10_moe_agg
	layer10_expert13_gpu3 -> layer10_moe_agg
	layer10_expert14_gpu3 -> layer10_moe_agg
	layer10_expert15_gpu3 -> layer10_moe_agg
	layer10_expert16_gpu4 -> layer10_moe_agg
	layer10_expert17_gpu4 -> layer10_moe_agg
	layer10_expert18_gpu4 -> layer10_moe_agg
	layer10_expert19_gpu4 -> layer10_moe_agg
	layer10_expert20_gpu5 -> layer10_moe_agg
	layer10_expert21_gpu5 -> layer10_moe_agg
	layer10_expert22_gpu5 -> layer10_moe_agg
	layer10_expert23_gpu5 -> layer10_moe_agg
	layer10_expert24_gpu6 -> layer10_moe_agg
	layer10_expert25_gpu6 -> layer10_moe_agg
	layer10_expert26_gpu6 -> layer10_moe_agg
	layer10_expert27_gpu6 -> layer10_moe_agg
	layer10_expert28_gpu7 -> layer10_moe_agg
	layer10_expert29_gpu7 -> layer10_moe_agg
	layer10_expert30_gpu7 -> layer10_moe_agg
	layer10_expert31_gpu7 -> layer10_moe_agg
	layer10_expert32_gpu8 -> layer10_moe_agg
	layer10_expert33_gpu8 -> layer10_moe_agg
	layer10_expert34_gpu8 -> layer10_moe_agg
	layer10_expert35_gpu8 -> layer10_moe_agg
	layer10_expert36_gpu9 -> layer10_moe_agg
	layer10_expert37_gpu9 -> layer10_moe_agg
	layer10_expert38_gpu9 -> layer10_moe_agg
	layer10_expert39_gpu9 -> layer10_moe_agg
	layer10_expert40_gpu10 -> layer10_moe_agg
	layer10_expert41_gpu10 -> layer10_moe_agg
	layer10_expert42_gpu10 -> layer10_moe_agg
	layer10_expert43_gpu10 -> layer10_moe_agg
	layer10_expert44_gpu11 -> layer10_moe_agg
	layer10_expert45_gpu11 -> layer10_moe_agg
	layer10_expert46_gpu11 -> layer10_moe_agg
	layer10_expert47_gpu11 -> layer10_moe_agg
	layer10_expert48_gpu12 -> layer10_moe_agg
	layer10_expert49_gpu12 -> layer10_moe_agg
	layer10_expert50_gpu12 -> layer10_moe_agg
	layer10_expert51_gpu12 -> layer10_moe_agg
	layer10_expert52_gpu13 -> layer10_moe_agg
	layer10_expert53_gpu13 -> layer10_moe_agg
	layer10_expert54_gpu13 -> layer10_moe_agg
	layer10_expert55_gpu13 -> layer10_moe_agg
	layer10_expert56_gpu14 -> layer10_moe_agg
	layer10_expert57_gpu14 -> layer10_moe_agg
	layer10_expert58_gpu14 -> layer10_moe_agg
	layer10_expert59_gpu14 -> layer10_moe_agg
	layer10_expert60_gpu15 -> layer10_moe_agg
	layer10_expert61_gpu15 -> layer10_moe_agg
	layer10_expert62_gpu15 -> layer10_moe_agg
	layer10_expert63_gpu15 -> layer10_moe_agg
	layer10_norm_residual [label="Layer 10 Norm + Residual\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_moe_agg -> layer10_norm_residual
	layer10_output_final [label="Layer 10 Final Output\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer10_norm_residual -> layer10_output_final
	layer11_boundary [label="Layer 11\nStage 2" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer10_output_final -> layer11_boundary
	layer11_attn_qkv_gpu8 [label="Layer 11 Attention QKV\nGPU 8\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_attn_scores_gpu8 [label="Layer 11 Attention Scores\nGPU 8\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_attn_out_gpu8 [label="Layer 11 Attention Output\nGPU 8\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_boundary -> layer11_attn_qkv_gpu8
	layer11_attn_qkv_gpu8 -> layer11_attn_scores_gpu8
	layer11_attn_scores_gpu8 -> layer11_attn_out_gpu8
	layer11_attn_qkv_gpu9 [label="Layer 11 Attention QKV\nGPU 9\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_attn_scores_gpu9 [label="Layer 11 Attention Scores\nGPU 9\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_attn_out_gpu9 [label="Layer 11 Attention Output\nGPU 9\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_attn_qkv_gpu9 -> layer11_attn_scores_gpu9
	layer11_attn_scores_gpu9 -> layer11_attn_out_gpu9
	layer11_attn_qkv_gpu10 [label="Layer 11 Attention QKV\nGPU 10\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_attn_scores_gpu10 [label="Layer 11 Attention Scores\nGPU 10\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_attn_out_gpu10 [label="Layer 11 Attention Output\nGPU 10\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_attn_qkv_gpu10 -> layer11_attn_scores_gpu10
	layer11_attn_scores_gpu10 -> layer11_attn_out_gpu10
	layer11_attn_qkv_gpu11 [label="Layer 11 Attention QKV\nGPU 11\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_attn_scores_gpu11 [label="Layer 11 Attention Scores\nGPU 11\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_attn_out_gpu11 [label="Layer 11 Attention Output\nGPU 11\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_attn_qkv_gpu11 -> layer11_attn_scores_gpu11
	layer11_attn_scores_gpu11 -> layer11_attn_out_gpu11
	layer11_attn_allreduce [label="Layer 11 Attention All-Reduce\nGPUs 8-11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightcoral fontname=Arial shape=ellipse style=filled]
	layer11_attn_out_gpu8 -> layer11_attn_allreduce
	layer11_attn_out_gpu9 -> layer11_attn_allreduce
	layer11_attn_out_gpu10 -> layer11_attn_allreduce
	layer11_attn_out_gpu11 -> layer11_attn_allreduce
	layer11_moe_router [label="Layer 11 MoE Router\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer11_attn_allreduce -> layer11_moe_router
	layer11_expert0_gpu0 [label="Layer 11 Expert 0\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert0_gpu0
	layer11_expert1_gpu0 [label="Layer 11 Expert 1\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert1_gpu0
	layer11_expert2_gpu0 [label="Layer 11 Expert 2\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert2_gpu0
	layer11_expert3_gpu0 [label="Layer 11 Expert 3\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert3_gpu0
	layer11_expert4_gpu1 [label="Layer 11 Expert 4\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert4_gpu1
	layer11_expert5_gpu1 [label="Layer 11 Expert 5\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert5_gpu1
	layer11_expert6_gpu1 [label="Layer 11 Expert 6\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert6_gpu1
	layer11_expert7_gpu1 [label="Layer 11 Expert 7\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert7_gpu1
	layer11_expert8_gpu2 [label="Layer 11 Expert 8\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert8_gpu2
	layer11_expert9_gpu2 [label="Layer 11 Expert 9\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert9_gpu2
	layer11_expert10_gpu2 [label="Layer 11 Expert 10\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert10_gpu2
	layer11_expert11_gpu2 [label="Layer 11 Expert 11\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert11_gpu2
	layer11_expert12_gpu3 [label="Layer 11 Expert 12\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert12_gpu3
	layer11_expert13_gpu3 [label="Layer 11 Expert 13\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert13_gpu3
	layer11_expert14_gpu3 [label="Layer 11 Expert 14\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert14_gpu3
	layer11_expert15_gpu3 [label="Layer 11 Expert 15\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert15_gpu3
	layer11_expert16_gpu4 [label="Layer 11 Expert 16\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert16_gpu4
	layer11_expert17_gpu4 [label="Layer 11 Expert 17\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert17_gpu4
	layer11_expert18_gpu4 [label="Layer 11 Expert 18\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert18_gpu4
	layer11_expert19_gpu4 [label="Layer 11 Expert 19\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert19_gpu4
	layer11_expert20_gpu5 [label="Layer 11 Expert 20\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert20_gpu5
	layer11_expert21_gpu5 [label="Layer 11 Expert 21\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert21_gpu5
	layer11_expert22_gpu5 [label="Layer 11 Expert 22\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert22_gpu5
	layer11_expert23_gpu5 [label="Layer 11 Expert 23\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert23_gpu5
	layer11_expert24_gpu6 [label="Layer 11 Expert 24\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert24_gpu6
	layer11_expert25_gpu6 [label="Layer 11 Expert 25\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert25_gpu6
	layer11_expert26_gpu6 [label="Layer 11 Expert 26\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert26_gpu6
	layer11_expert27_gpu6 [label="Layer 11 Expert 27\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert27_gpu6
	layer11_expert28_gpu7 [label="Layer 11 Expert 28\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert28_gpu7
	layer11_expert29_gpu7 [label="Layer 11 Expert 29\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert29_gpu7
	layer11_expert30_gpu7 [label="Layer 11 Expert 30\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert30_gpu7
	layer11_expert31_gpu7 [label="Layer 11 Expert 31\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert31_gpu7
	layer11_expert32_gpu8 [label="Layer 11 Expert 32\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert32_gpu8
	layer11_expert33_gpu8 [label="Layer 11 Expert 33\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert33_gpu8
	layer11_expert34_gpu8 [label="Layer 11 Expert 34\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert34_gpu8
	layer11_expert35_gpu8 [label="Layer 11 Expert 35\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert35_gpu8
	layer11_expert36_gpu9 [label="Layer 11 Expert 36\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert36_gpu9
	layer11_expert37_gpu9 [label="Layer 11 Expert 37\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert37_gpu9
	layer11_expert38_gpu9 [label="Layer 11 Expert 38\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert38_gpu9
	layer11_expert39_gpu9 [label="Layer 11 Expert 39\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert39_gpu9
	layer11_expert40_gpu10 [label="Layer 11 Expert 40\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert40_gpu10
	layer11_expert41_gpu10 [label="Layer 11 Expert 41\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert41_gpu10
	layer11_expert42_gpu10 [label="Layer 11 Expert 42\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert42_gpu10
	layer11_expert43_gpu10 [label="Layer 11 Expert 43\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert43_gpu10
	layer11_expert44_gpu11 [label="Layer 11 Expert 44\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert44_gpu11
	layer11_expert45_gpu11 [label="Layer 11 Expert 45\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert45_gpu11
	layer11_expert46_gpu11 [label="Layer 11 Expert 46\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert46_gpu11
	layer11_expert47_gpu11 [label="Layer 11 Expert 47\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert47_gpu11
	layer11_expert48_gpu12 [label="Layer 11 Expert 48\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert48_gpu12
	layer11_expert49_gpu12 [label="Layer 11 Expert 49\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert49_gpu12
	layer11_expert50_gpu12 [label="Layer 11 Expert 50\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert50_gpu12
	layer11_expert51_gpu12 [label="Layer 11 Expert 51\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert51_gpu12
	layer11_expert52_gpu13 [label="Layer 11 Expert 52\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert52_gpu13
	layer11_expert53_gpu13 [label="Layer 11 Expert 53\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert53_gpu13
	layer11_expert54_gpu13 [label="Layer 11 Expert 54\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert54_gpu13
	layer11_expert55_gpu13 [label="Layer 11 Expert 55\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert55_gpu13
	layer11_expert56_gpu14 [label="Layer 11 Expert 56\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert56_gpu14
	layer11_expert57_gpu14 [label="Layer 11 Expert 57\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert57_gpu14
	layer11_expert58_gpu14 [label="Layer 11 Expert 58\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert58_gpu14
	layer11_expert59_gpu14 [label="Layer 11 Expert 59\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert59_gpu14
	layer11_expert60_gpu15 [label="Layer 11 Expert 60\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert60_gpu15
	layer11_expert61_gpu15 [label="Layer 11 Expert 61\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert61_gpu15
	layer11_expert62_gpu15 [label="Layer 11 Expert 62\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert62_gpu15
	layer11_expert63_gpu15 [label="Layer 11 Expert 63\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_router -> layer11_expert63_gpu15
	layer11_moe_agg [label="Layer 11 MoE Aggregation\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightgreen fontname=Arial shape=parallelogram style=filled]
	layer11_expert0_gpu0 -> layer11_moe_agg
	layer11_expert1_gpu0 -> layer11_moe_agg
	layer11_expert2_gpu0 -> layer11_moe_agg
	layer11_expert3_gpu0 -> layer11_moe_agg
	layer11_expert4_gpu1 -> layer11_moe_agg
	layer11_expert5_gpu1 -> layer11_moe_agg
	layer11_expert6_gpu1 -> layer11_moe_agg
	layer11_expert7_gpu1 -> layer11_moe_agg
	layer11_expert8_gpu2 -> layer11_moe_agg
	layer11_expert9_gpu2 -> layer11_moe_agg
	layer11_expert10_gpu2 -> layer11_moe_agg
	layer11_expert11_gpu2 -> layer11_moe_agg
	layer11_expert12_gpu3 -> layer11_moe_agg
	layer11_expert13_gpu3 -> layer11_moe_agg
	layer11_expert14_gpu3 -> layer11_moe_agg
	layer11_expert15_gpu3 -> layer11_moe_agg
	layer11_expert16_gpu4 -> layer11_moe_agg
	layer11_expert17_gpu4 -> layer11_moe_agg
	layer11_expert18_gpu4 -> layer11_moe_agg
	layer11_expert19_gpu4 -> layer11_moe_agg
	layer11_expert20_gpu5 -> layer11_moe_agg
	layer11_expert21_gpu5 -> layer11_moe_agg
	layer11_expert22_gpu5 -> layer11_moe_agg
	layer11_expert23_gpu5 -> layer11_moe_agg
	layer11_expert24_gpu6 -> layer11_moe_agg
	layer11_expert25_gpu6 -> layer11_moe_agg
	layer11_expert26_gpu6 -> layer11_moe_agg
	layer11_expert27_gpu6 -> layer11_moe_agg
	layer11_expert28_gpu7 -> layer11_moe_agg
	layer11_expert29_gpu7 -> layer11_moe_agg
	layer11_expert30_gpu7 -> layer11_moe_agg
	layer11_expert31_gpu7 -> layer11_moe_agg
	layer11_expert32_gpu8 -> layer11_moe_agg
	layer11_expert33_gpu8 -> layer11_moe_agg
	layer11_expert34_gpu8 -> layer11_moe_agg
	layer11_expert35_gpu8 -> layer11_moe_agg
	layer11_expert36_gpu9 -> layer11_moe_agg
	layer11_expert37_gpu9 -> layer11_moe_agg
	layer11_expert38_gpu9 -> layer11_moe_agg
	layer11_expert39_gpu9 -> layer11_moe_agg
	layer11_expert40_gpu10 -> layer11_moe_agg
	layer11_expert41_gpu10 -> layer11_moe_agg
	layer11_expert42_gpu10 -> layer11_moe_agg
	layer11_expert43_gpu10 -> layer11_moe_agg
	layer11_expert44_gpu11 -> layer11_moe_agg
	layer11_expert45_gpu11 -> layer11_moe_agg
	layer11_expert46_gpu11 -> layer11_moe_agg
	layer11_expert47_gpu11 -> layer11_moe_agg
	layer11_expert48_gpu12 -> layer11_moe_agg
	layer11_expert49_gpu12 -> layer11_moe_agg
	layer11_expert50_gpu12 -> layer11_moe_agg
	layer11_expert51_gpu12 -> layer11_moe_agg
	layer11_expert52_gpu13 -> layer11_moe_agg
	layer11_expert53_gpu13 -> layer11_moe_agg
	layer11_expert54_gpu13 -> layer11_moe_agg
	layer11_expert55_gpu13 -> layer11_moe_agg
	layer11_expert56_gpu14 -> layer11_moe_agg
	layer11_expert57_gpu14 -> layer11_moe_agg
	layer11_expert58_gpu14 -> layer11_moe_agg
	layer11_expert59_gpu14 -> layer11_moe_agg
	layer11_expert60_gpu15 -> layer11_moe_agg
	layer11_expert61_gpu15 -> layer11_moe_agg
	layer11_expert62_gpu15 -> layer11_moe_agg
	layer11_expert63_gpu15 -> layer11_moe_agg
	layer11_norm_residual [label="Layer 11 Norm + Residual\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_moe_agg -> layer11_norm_residual
	layer11_output_final [label="Layer 11 Final Output\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer11_norm_residual -> layer11_output_final
	stage_3_boundary [label="Pipeline Stage 3\nGPUs 12-15" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer11_output_final -> stage_3_boundary
	layer12_boundary [label="Layer 12\nStage 3" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	stage_3_boundary -> layer12_boundary
	layer12_attn_qkv_gpu12 [label="Layer 12 Attention QKV\nGPU 12\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_attn_scores_gpu12 [label="Layer 12 Attention Scores\nGPU 12\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_attn_out_gpu12 [label="Layer 12 Attention Output\nGPU 12\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_boundary -> layer12_attn_qkv_gpu12
	layer12_attn_qkv_gpu12 -> layer12_attn_scores_gpu12
	layer12_attn_scores_gpu12 -> layer12_attn_out_gpu12
	layer12_attn_qkv_gpu13 [label="Layer 12 Attention QKV\nGPU 13\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_attn_scores_gpu13 [label="Layer 12 Attention Scores\nGPU 13\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_attn_out_gpu13 [label="Layer 12 Attention Output\nGPU 13\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_attn_qkv_gpu13 -> layer12_attn_scores_gpu13
	layer12_attn_scores_gpu13 -> layer12_attn_out_gpu13
	layer12_attn_qkv_gpu14 [label="Layer 12 Attention QKV\nGPU 14\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_attn_scores_gpu14 [label="Layer 12 Attention Scores\nGPU 14\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_attn_out_gpu14 [label="Layer 12 Attention Output\nGPU 14\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_attn_qkv_gpu14 -> layer12_attn_scores_gpu14
	layer12_attn_scores_gpu14 -> layer12_attn_out_gpu14
	layer12_attn_qkv_gpu15 [label="Layer 12 Attention QKV\nGPU 15\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_attn_scores_gpu15 [label="Layer 12 Attention Scores\nGPU 15\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_attn_out_gpu15 [label="Layer 12 Attention Output\nGPU 15\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_attn_qkv_gpu15 -> layer12_attn_scores_gpu15
	layer12_attn_scores_gpu15 -> layer12_attn_out_gpu15
	layer12_attn_allreduce [label="Layer 12 Attention All-Reduce\nGPUs 12-15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightcoral fontname=Arial shape=ellipse style=filled]
	layer12_attn_out_gpu12 -> layer12_attn_allreduce
	layer12_attn_out_gpu13 -> layer12_attn_allreduce
	layer12_attn_out_gpu14 -> layer12_attn_allreduce
	layer12_attn_out_gpu15 -> layer12_attn_allreduce
	layer12_moe_router [label="Layer 12 MoE Router\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer12_attn_allreduce -> layer12_moe_router
	layer12_expert0_gpu0 [label="Layer 12 Expert 0\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert0_gpu0
	layer12_expert1_gpu0 [label="Layer 12 Expert 1\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert1_gpu0
	layer12_expert2_gpu0 [label="Layer 12 Expert 2\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert2_gpu0
	layer12_expert3_gpu0 [label="Layer 12 Expert 3\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert3_gpu0
	layer12_expert4_gpu1 [label="Layer 12 Expert 4\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert4_gpu1
	layer12_expert5_gpu1 [label="Layer 12 Expert 5\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert5_gpu1
	layer12_expert6_gpu1 [label="Layer 12 Expert 6\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert6_gpu1
	layer12_expert7_gpu1 [label="Layer 12 Expert 7\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert7_gpu1
	layer12_expert8_gpu2 [label="Layer 12 Expert 8\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert8_gpu2
	layer12_expert9_gpu2 [label="Layer 12 Expert 9\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert9_gpu2
	layer12_expert10_gpu2 [label="Layer 12 Expert 10\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert10_gpu2
	layer12_expert11_gpu2 [label="Layer 12 Expert 11\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert11_gpu2
	layer12_expert12_gpu3 [label="Layer 12 Expert 12\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert12_gpu3
	layer12_expert13_gpu3 [label="Layer 12 Expert 13\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert13_gpu3
	layer12_expert14_gpu3 [label="Layer 12 Expert 14\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert14_gpu3
	layer12_expert15_gpu3 [label="Layer 12 Expert 15\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert15_gpu3
	layer12_expert16_gpu4 [label="Layer 12 Expert 16\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert16_gpu4
	layer12_expert17_gpu4 [label="Layer 12 Expert 17\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert17_gpu4
	layer12_expert18_gpu4 [label="Layer 12 Expert 18\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert18_gpu4
	layer12_expert19_gpu4 [label="Layer 12 Expert 19\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert19_gpu4
	layer12_expert20_gpu5 [label="Layer 12 Expert 20\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert20_gpu5
	layer12_expert21_gpu5 [label="Layer 12 Expert 21\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert21_gpu5
	layer12_expert22_gpu5 [label="Layer 12 Expert 22\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert22_gpu5
	layer12_expert23_gpu5 [label="Layer 12 Expert 23\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert23_gpu5
	layer12_expert24_gpu6 [label="Layer 12 Expert 24\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert24_gpu6
	layer12_expert25_gpu6 [label="Layer 12 Expert 25\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert25_gpu6
	layer12_expert26_gpu6 [label="Layer 12 Expert 26\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert26_gpu6
	layer12_expert27_gpu6 [label="Layer 12 Expert 27\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert27_gpu6
	layer12_expert28_gpu7 [label="Layer 12 Expert 28\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert28_gpu7
	layer12_expert29_gpu7 [label="Layer 12 Expert 29\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert29_gpu7
	layer12_expert30_gpu7 [label="Layer 12 Expert 30\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert30_gpu7
	layer12_expert31_gpu7 [label="Layer 12 Expert 31\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert31_gpu7
	layer12_expert32_gpu8 [label="Layer 12 Expert 32\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert32_gpu8
	layer12_expert33_gpu8 [label="Layer 12 Expert 33\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert33_gpu8
	layer12_expert34_gpu8 [label="Layer 12 Expert 34\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert34_gpu8
	layer12_expert35_gpu8 [label="Layer 12 Expert 35\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert35_gpu8
	layer12_expert36_gpu9 [label="Layer 12 Expert 36\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert36_gpu9
	layer12_expert37_gpu9 [label="Layer 12 Expert 37\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert37_gpu9
	layer12_expert38_gpu9 [label="Layer 12 Expert 38\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert38_gpu9
	layer12_expert39_gpu9 [label="Layer 12 Expert 39\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert39_gpu9
	layer12_expert40_gpu10 [label="Layer 12 Expert 40\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert40_gpu10
	layer12_expert41_gpu10 [label="Layer 12 Expert 41\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert41_gpu10
	layer12_expert42_gpu10 [label="Layer 12 Expert 42\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert42_gpu10
	layer12_expert43_gpu10 [label="Layer 12 Expert 43\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert43_gpu10
	layer12_expert44_gpu11 [label="Layer 12 Expert 44\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert44_gpu11
	layer12_expert45_gpu11 [label="Layer 12 Expert 45\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert45_gpu11
	layer12_expert46_gpu11 [label="Layer 12 Expert 46\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert46_gpu11
	layer12_expert47_gpu11 [label="Layer 12 Expert 47\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert47_gpu11
	layer12_expert48_gpu12 [label="Layer 12 Expert 48\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert48_gpu12
	layer12_expert49_gpu12 [label="Layer 12 Expert 49\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert49_gpu12
	layer12_expert50_gpu12 [label="Layer 12 Expert 50\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert50_gpu12
	layer12_expert51_gpu12 [label="Layer 12 Expert 51\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert51_gpu12
	layer12_expert52_gpu13 [label="Layer 12 Expert 52\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert52_gpu13
	layer12_expert53_gpu13 [label="Layer 12 Expert 53\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert53_gpu13
	layer12_expert54_gpu13 [label="Layer 12 Expert 54\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert54_gpu13
	layer12_expert55_gpu13 [label="Layer 12 Expert 55\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert55_gpu13
	layer12_expert56_gpu14 [label="Layer 12 Expert 56\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert56_gpu14
	layer12_expert57_gpu14 [label="Layer 12 Expert 57\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert57_gpu14
	layer12_expert58_gpu14 [label="Layer 12 Expert 58\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert58_gpu14
	layer12_expert59_gpu14 [label="Layer 12 Expert 59\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert59_gpu14
	layer12_expert60_gpu15 [label="Layer 12 Expert 60\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert60_gpu15
	layer12_expert61_gpu15 [label="Layer 12 Expert 61\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert61_gpu15
	layer12_expert62_gpu15 [label="Layer 12 Expert 62\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert62_gpu15
	layer12_expert63_gpu15 [label="Layer 12 Expert 63\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_router -> layer12_expert63_gpu15
	layer12_moe_agg [label="Layer 12 MoE Aggregation\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightgreen fontname=Arial shape=parallelogram style=filled]
	layer12_expert0_gpu0 -> layer12_moe_agg
	layer12_expert1_gpu0 -> layer12_moe_agg
	layer12_expert2_gpu0 -> layer12_moe_agg
	layer12_expert3_gpu0 -> layer12_moe_agg
	layer12_expert4_gpu1 -> layer12_moe_agg
	layer12_expert5_gpu1 -> layer12_moe_agg
	layer12_expert6_gpu1 -> layer12_moe_agg
	layer12_expert7_gpu1 -> layer12_moe_agg
	layer12_expert8_gpu2 -> layer12_moe_agg
	layer12_expert9_gpu2 -> layer12_moe_agg
	layer12_expert10_gpu2 -> layer12_moe_agg
	layer12_expert11_gpu2 -> layer12_moe_agg
	layer12_expert12_gpu3 -> layer12_moe_agg
	layer12_expert13_gpu3 -> layer12_moe_agg
	layer12_expert14_gpu3 -> layer12_moe_agg
	layer12_expert15_gpu3 -> layer12_moe_agg
	layer12_expert16_gpu4 -> layer12_moe_agg
	layer12_expert17_gpu4 -> layer12_moe_agg
	layer12_expert18_gpu4 -> layer12_moe_agg
	layer12_expert19_gpu4 -> layer12_moe_agg
	layer12_expert20_gpu5 -> layer12_moe_agg
	layer12_expert21_gpu5 -> layer12_moe_agg
	layer12_expert22_gpu5 -> layer12_moe_agg
	layer12_expert23_gpu5 -> layer12_moe_agg
	layer12_expert24_gpu6 -> layer12_moe_agg
	layer12_expert25_gpu6 -> layer12_moe_agg
	layer12_expert26_gpu6 -> layer12_moe_agg
	layer12_expert27_gpu6 -> layer12_moe_agg
	layer12_expert28_gpu7 -> layer12_moe_agg
	layer12_expert29_gpu7 -> layer12_moe_agg
	layer12_expert30_gpu7 -> layer12_moe_agg
	layer12_expert31_gpu7 -> layer12_moe_agg
	layer12_expert32_gpu8 -> layer12_moe_agg
	layer12_expert33_gpu8 -> layer12_moe_agg
	layer12_expert34_gpu8 -> layer12_moe_agg
	layer12_expert35_gpu8 -> layer12_moe_agg
	layer12_expert36_gpu9 -> layer12_moe_agg
	layer12_expert37_gpu9 -> layer12_moe_agg
	layer12_expert38_gpu9 -> layer12_moe_agg
	layer12_expert39_gpu9 -> layer12_moe_agg
	layer12_expert40_gpu10 -> layer12_moe_agg
	layer12_expert41_gpu10 -> layer12_moe_agg
	layer12_expert42_gpu10 -> layer12_moe_agg
	layer12_expert43_gpu10 -> layer12_moe_agg
	layer12_expert44_gpu11 -> layer12_moe_agg
	layer12_expert45_gpu11 -> layer12_moe_agg
	layer12_expert46_gpu11 -> layer12_moe_agg
	layer12_expert47_gpu11 -> layer12_moe_agg
	layer12_expert48_gpu12 -> layer12_moe_agg
	layer12_expert49_gpu12 -> layer12_moe_agg
	layer12_expert50_gpu12 -> layer12_moe_agg
	layer12_expert51_gpu12 -> layer12_moe_agg
	layer12_expert52_gpu13 -> layer12_moe_agg
	layer12_expert53_gpu13 -> layer12_moe_agg
	layer12_expert54_gpu13 -> layer12_moe_agg
	layer12_expert55_gpu13 -> layer12_moe_agg
	layer12_expert56_gpu14 -> layer12_moe_agg
	layer12_expert57_gpu14 -> layer12_moe_agg
	layer12_expert58_gpu14 -> layer12_moe_agg
	layer12_expert59_gpu14 -> layer12_moe_agg
	layer12_expert60_gpu15 -> layer12_moe_agg
	layer12_expert61_gpu15 -> layer12_moe_agg
	layer12_expert62_gpu15 -> layer12_moe_agg
	layer12_expert63_gpu15 -> layer12_moe_agg
	layer12_norm_residual [label="Layer 12 Norm + Residual\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_moe_agg -> layer12_norm_residual
	layer12_output_final [label="Layer 12 Final Output\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer12_norm_residual -> layer12_output_final
	layer13_boundary [label="Layer 13\nStage 3" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer12_output_final -> layer13_boundary
	layer13_attn_qkv_gpu12 [label="Layer 13 Attention QKV\nGPU 12\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_attn_scores_gpu12 [label="Layer 13 Attention Scores\nGPU 12\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_attn_out_gpu12 [label="Layer 13 Attention Output\nGPU 12\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_boundary -> layer13_attn_qkv_gpu12
	layer13_attn_qkv_gpu12 -> layer13_attn_scores_gpu12
	layer13_attn_scores_gpu12 -> layer13_attn_out_gpu12
	layer13_attn_qkv_gpu13 [label="Layer 13 Attention QKV\nGPU 13\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_attn_scores_gpu13 [label="Layer 13 Attention Scores\nGPU 13\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_attn_out_gpu13 [label="Layer 13 Attention Output\nGPU 13\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_attn_qkv_gpu13 -> layer13_attn_scores_gpu13
	layer13_attn_scores_gpu13 -> layer13_attn_out_gpu13
	layer13_attn_qkv_gpu14 [label="Layer 13 Attention QKV\nGPU 14\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_attn_scores_gpu14 [label="Layer 13 Attention Scores\nGPU 14\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_attn_out_gpu14 [label="Layer 13 Attention Output\nGPU 14\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_attn_qkv_gpu14 -> layer13_attn_scores_gpu14
	layer13_attn_scores_gpu14 -> layer13_attn_out_gpu14
	layer13_attn_qkv_gpu15 [label="Layer 13 Attention QKV\nGPU 15\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_attn_scores_gpu15 [label="Layer 13 Attention Scores\nGPU 15\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_attn_out_gpu15 [label="Layer 13 Attention Output\nGPU 15\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_attn_qkv_gpu15 -> layer13_attn_scores_gpu15
	layer13_attn_scores_gpu15 -> layer13_attn_out_gpu15
	layer13_attn_allreduce [label="Layer 13 Attention All-Reduce\nGPUs 12-15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightcoral fontname=Arial shape=ellipse style=filled]
	layer13_attn_out_gpu12 -> layer13_attn_allreduce
	layer13_attn_out_gpu13 -> layer13_attn_allreduce
	layer13_attn_out_gpu14 -> layer13_attn_allreduce
	layer13_attn_out_gpu15 -> layer13_attn_allreduce
	layer13_moe_router [label="Layer 13 MoE Router\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer13_attn_allreduce -> layer13_moe_router
	layer13_expert0_gpu0 [label="Layer 13 Expert 0\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert0_gpu0
	layer13_expert1_gpu0 [label="Layer 13 Expert 1\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert1_gpu0
	layer13_expert2_gpu0 [label="Layer 13 Expert 2\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert2_gpu0
	layer13_expert3_gpu0 [label="Layer 13 Expert 3\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert3_gpu0
	layer13_expert4_gpu1 [label="Layer 13 Expert 4\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert4_gpu1
	layer13_expert5_gpu1 [label="Layer 13 Expert 5\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert5_gpu1
	layer13_expert6_gpu1 [label="Layer 13 Expert 6\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert6_gpu1
	layer13_expert7_gpu1 [label="Layer 13 Expert 7\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert7_gpu1
	layer13_expert8_gpu2 [label="Layer 13 Expert 8\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert8_gpu2
	layer13_expert9_gpu2 [label="Layer 13 Expert 9\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert9_gpu2
	layer13_expert10_gpu2 [label="Layer 13 Expert 10\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert10_gpu2
	layer13_expert11_gpu2 [label="Layer 13 Expert 11\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert11_gpu2
	layer13_expert12_gpu3 [label="Layer 13 Expert 12\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert12_gpu3
	layer13_expert13_gpu3 [label="Layer 13 Expert 13\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert13_gpu3
	layer13_expert14_gpu3 [label="Layer 13 Expert 14\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert14_gpu3
	layer13_expert15_gpu3 [label="Layer 13 Expert 15\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert15_gpu3
	layer13_expert16_gpu4 [label="Layer 13 Expert 16\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert16_gpu4
	layer13_expert17_gpu4 [label="Layer 13 Expert 17\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert17_gpu4
	layer13_expert18_gpu4 [label="Layer 13 Expert 18\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert18_gpu4
	layer13_expert19_gpu4 [label="Layer 13 Expert 19\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert19_gpu4
	layer13_expert20_gpu5 [label="Layer 13 Expert 20\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert20_gpu5
	layer13_expert21_gpu5 [label="Layer 13 Expert 21\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert21_gpu5
	layer13_expert22_gpu5 [label="Layer 13 Expert 22\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert22_gpu5
	layer13_expert23_gpu5 [label="Layer 13 Expert 23\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert23_gpu5
	layer13_expert24_gpu6 [label="Layer 13 Expert 24\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert24_gpu6
	layer13_expert25_gpu6 [label="Layer 13 Expert 25\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert25_gpu6
	layer13_expert26_gpu6 [label="Layer 13 Expert 26\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert26_gpu6
	layer13_expert27_gpu6 [label="Layer 13 Expert 27\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert27_gpu6
	layer13_expert28_gpu7 [label="Layer 13 Expert 28\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert28_gpu7
	layer13_expert29_gpu7 [label="Layer 13 Expert 29\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert29_gpu7
	layer13_expert30_gpu7 [label="Layer 13 Expert 30\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert30_gpu7
	layer13_expert31_gpu7 [label="Layer 13 Expert 31\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert31_gpu7
	layer13_expert32_gpu8 [label="Layer 13 Expert 32\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert32_gpu8
	layer13_expert33_gpu8 [label="Layer 13 Expert 33\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert33_gpu8
	layer13_expert34_gpu8 [label="Layer 13 Expert 34\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert34_gpu8
	layer13_expert35_gpu8 [label="Layer 13 Expert 35\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert35_gpu8
	layer13_expert36_gpu9 [label="Layer 13 Expert 36\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert36_gpu9
	layer13_expert37_gpu9 [label="Layer 13 Expert 37\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert37_gpu9
	layer13_expert38_gpu9 [label="Layer 13 Expert 38\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert38_gpu9
	layer13_expert39_gpu9 [label="Layer 13 Expert 39\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert39_gpu9
	layer13_expert40_gpu10 [label="Layer 13 Expert 40\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert40_gpu10
	layer13_expert41_gpu10 [label="Layer 13 Expert 41\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert41_gpu10
	layer13_expert42_gpu10 [label="Layer 13 Expert 42\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert42_gpu10
	layer13_expert43_gpu10 [label="Layer 13 Expert 43\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert43_gpu10
	layer13_expert44_gpu11 [label="Layer 13 Expert 44\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert44_gpu11
	layer13_expert45_gpu11 [label="Layer 13 Expert 45\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert45_gpu11
	layer13_expert46_gpu11 [label="Layer 13 Expert 46\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert46_gpu11
	layer13_expert47_gpu11 [label="Layer 13 Expert 47\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert47_gpu11
	layer13_expert48_gpu12 [label="Layer 13 Expert 48\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert48_gpu12
	layer13_expert49_gpu12 [label="Layer 13 Expert 49\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert49_gpu12
	layer13_expert50_gpu12 [label="Layer 13 Expert 50\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert50_gpu12
	layer13_expert51_gpu12 [label="Layer 13 Expert 51\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert51_gpu12
	layer13_expert52_gpu13 [label="Layer 13 Expert 52\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert52_gpu13
	layer13_expert53_gpu13 [label="Layer 13 Expert 53\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert53_gpu13
	layer13_expert54_gpu13 [label="Layer 13 Expert 54\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert54_gpu13
	layer13_expert55_gpu13 [label="Layer 13 Expert 55\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert55_gpu13
	layer13_expert56_gpu14 [label="Layer 13 Expert 56\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert56_gpu14
	layer13_expert57_gpu14 [label="Layer 13 Expert 57\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert57_gpu14
	layer13_expert58_gpu14 [label="Layer 13 Expert 58\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert58_gpu14
	layer13_expert59_gpu14 [label="Layer 13 Expert 59\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert59_gpu14
	layer13_expert60_gpu15 [label="Layer 13 Expert 60\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert60_gpu15
	layer13_expert61_gpu15 [label="Layer 13 Expert 61\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert61_gpu15
	layer13_expert62_gpu15 [label="Layer 13 Expert 62\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert62_gpu15
	layer13_expert63_gpu15 [label="Layer 13 Expert 63\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_router -> layer13_expert63_gpu15
	layer13_moe_agg [label="Layer 13 MoE Aggregation\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightgreen fontname=Arial shape=parallelogram style=filled]
	layer13_expert0_gpu0 -> layer13_moe_agg
	layer13_expert1_gpu0 -> layer13_moe_agg
	layer13_expert2_gpu0 -> layer13_moe_agg
	layer13_expert3_gpu0 -> layer13_moe_agg
	layer13_expert4_gpu1 -> layer13_moe_agg
	layer13_expert5_gpu1 -> layer13_moe_agg
	layer13_expert6_gpu1 -> layer13_moe_agg
	layer13_expert7_gpu1 -> layer13_moe_agg
	layer13_expert8_gpu2 -> layer13_moe_agg
	layer13_expert9_gpu2 -> layer13_moe_agg
	layer13_expert10_gpu2 -> layer13_moe_agg
	layer13_expert11_gpu2 -> layer13_moe_agg
	layer13_expert12_gpu3 -> layer13_moe_agg
	layer13_expert13_gpu3 -> layer13_moe_agg
	layer13_expert14_gpu3 -> layer13_moe_agg
	layer13_expert15_gpu3 -> layer13_moe_agg
	layer13_expert16_gpu4 -> layer13_moe_agg
	layer13_expert17_gpu4 -> layer13_moe_agg
	layer13_expert18_gpu4 -> layer13_moe_agg
	layer13_expert19_gpu4 -> layer13_moe_agg
	layer13_expert20_gpu5 -> layer13_moe_agg
	layer13_expert21_gpu5 -> layer13_moe_agg
	layer13_expert22_gpu5 -> layer13_moe_agg
	layer13_expert23_gpu5 -> layer13_moe_agg
	layer13_expert24_gpu6 -> layer13_moe_agg
	layer13_expert25_gpu6 -> layer13_moe_agg
	layer13_expert26_gpu6 -> layer13_moe_agg
	layer13_expert27_gpu6 -> layer13_moe_agg
	layer13_expert28_gpu7 -> layer13_moe_agg
	layer13_expert29_gpu7 -> layer13_moe_agg
	layer13_expert30_gpu7 -> layer13_moe_agg
	layer13_expert31_gpu7 -> layer13_moe_agg
	layer13_expert32_gpu8 -> layer13_moe_agg
	layer13_expert33_gpu8 -> layer13_moe_agg
	layer13_expert34_gpu8 -> layer13_moe_agg
	layer13_expert35_gpu8 -> layer13_moe_agg
	layer13_expert36_gpu9 -> layer13_moe_agg
	layer13_expert37_gpu9 -> layer13_moe_agg
	layer13_expert38_gpu9 -> layer13_moe_agg
	layer13_expert39_gpu9 -> layer13_moe_agg
	layer13_expert40_gpu10 -> layer13_moe_agg
	layer13_expert41_gpu10 -> layer13_moe_agg
	layer13_expert42_gpu10 -> layer13_moe_agg
	layer13_expert43_gpu10 -> layer13_moe_agg
	layer13_expert44_gpu11 -> layer13_moe_agg
	layer13_expert45_gpu11 -> layer13_moe_agg
	layer13_expert46_gpu11 -> layer13_moe_agg
	layer13_expert47_gpu11 -> layer13_moe_agg
	layer13_expert48_gpu12 -> layer13_moe_agg
	layer13_expert49_gpu12 -> layer13_moe_agg
	layer13_expert50_gpu12 -> layer13_moe_agg
	layer13_expert51_gpu12 -> layer13_moe_agg
	layer13_expert52_gpu13 -> layer13_moe_agg
	layer13_expert53_gpu13 -> layer13_moe_agg
	layer13_expert54_gpu13 -> layer13_moe_agg
	layer13_expert55_gpu13 -> layer13_moe_agg
	layer13_expert56_gpu14 -> layer13_moe_agg
	layer13_expert57_gpu14 -> layer13_moe_agg
	layer13_expert58_gpu14 -> layer13_moe_agg
	layer13_expert59_gpu14 -> layer13_moe_agg
	layer13_expert60_gpu15 -> layer13_moe_agg
	layer13_expert61_gpu15 -> layer13_moe_agg
	layer13_expert62_gpu15 -> layer13_moe_agg
	layer13_expert63_gpu15 -> layer13_moe_agg
	layer13_norm_residual [label="Layer 13 Norm + Residual\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_moe_agg -> layer13_norm_residual
	layer13_output_final [label="Layer 13 Final Output\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer13_norm_residual -> layer13_output_final
	layer14_boundary [label="Layer 14\nStage 3" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer13_output_final -> layer14_boundary
	layer14_attn_qkv_gpu12 [label="Layer 14 Attention QKV\nGPU 12\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_attn_scores_gpu12 [label="Layer 14 Attention Scores\nGPU 12\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_attn_out_gpu12 [label="Layer 14 Attention Output\nGPU 12\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_boundary -> layer14_attn_qkv_gpu12
	layer14_attn_qkv_gpu12 -> layer14_attn_scores_gpu12
	layer14_attn_scores_gpu12 -> layer14_attn_out_gpu12
	layer14_attn_qkv_gpu13 [label="Layer 14 Attention QKV\nGPU 13\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_attn_scores_gpu13 [label="Layer 14 Attention Scores\nGPU 13\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_attn_out_gpu13 [label="Layer 14 Attention Output\nGPU 13\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_attn_qkv_gpu13 -> layer14_attn_scores_gpu13
	layer14_attn_scores_gpu13 -> layer14_attn_out_gpu13
	layer14_attn_qkv_gpu14 [label="Layer 14 Attention QKV\nGPU 14\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_attn_scores_gpu14 [label="Layer 14 Attention Scores\nGPU 14\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_attn_out_gpu14 [label="Layer 14 Attention Output\nGPU 14\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_attn_qkv_gpu14 -> layer14_attn_scores_gpu14
	layer14_attn_scores_gpu14 -> layer14_attn_out_gpu14
	layer14_attn_qkv_gpu15 [label="Layer 14 Attention QKV\nGPU 15\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_attn_scores_gpu15 [label="Layer 14 Attention Scores\nGPU 15\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_attn_out_gpu15 [label="Layer 14 Attention Output\nGPU 15\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_attn_qkv_gpu15 -> layer14_attn_scores_gpu15
	layer14_attn_scores_gpu15 -> layer14_attn_out_gpu15
	layer14_attn_allreduce [label="Layer 14 Attention All-Reduce\nGPUs 12-15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightcoral fontname=Arial shape=ellipse style=filled]
	layer14_attn_out_gpu12 -> layer14_attn_allreduce
	layer14_attn_out_gpu13 -> layer14_attn_allreduce
	layer14_attn_out_gpu14 -> layer14_attn_allreduce
	layer14_attn_out_gpu15 -> layer14_attn_allreduce
	layer14_moe_router [label="Layer 14 MoE Router\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer14_attn_allreduce -> layer14_moe_router
	layer14_expert0_gpu0 [label="Layer 14 Expert 0\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert0_gpu0
	layer14_expert1_gpu0 [label="Layer 14 Expert 1\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert1_gpu0
	layer14_expert2_gpu0 [label="Layer 14 Expert 2\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert2_gpu0
	layer14_expert3_gpu0 [label="Layer 14 Expert 3\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert3_gpu0
	layer14_expert4_gpu1 [label="Layer 14 Expert 4\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert4_gpu1
	layer14_expert5_gpu1 [label="Layer 14 Expert 5\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert5_gpu1
	layer14_expert6_gpu1 [label="Layer 14 Expert 6\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert6_gpu1
	layer14_expert7_gpu1 [label="Layer 14 Expert 7\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert7_gpu1
	layer14_expert8_gpu2 [label="Layer 14 Expert 8\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert8_gpu2
	layer14_expert9_gpu2 [label="Layer 14 Expert 9\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert9_gpu2
	layer14_expert10_gpu2 [label="Layer 14 Expert 10\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert10_gpu2
	layer14_expert11_gpu2 [label="Layer 14 Expert 11\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert11_gpu2
	layer14_expert12_gpu3 [label="Layer 14 Expert 12\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert12_gpu3
	layer14_expert13_gpu3 [label="Layer 14 Expert 13\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert13_gpu3
	layer14_expert14_gpu3 [label="Layer 14 Expert 14\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert14_gpu3
	layer14_expert15_gpu3 [label="Layer 14 Expert 15\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert15_gpu3
	layer14_expert16_gpu4 [label="Layer 14 Expert 16\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert16_gpu4
	layer14_expert17_gpu4 [label="Layer 14 Expert 17\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert17_gpu4
	layer14_expert18_gpu4 [label="Layer 14 Expert 18\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert18_gpu4
	layer14_expert19_gpu4 [label="Layer 14 Expert 19\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert19_gpu4
	layer14_expert20_gpu5 [label="Layer 14 Expert 20\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert20_gpu5
	layer14_expert21_gpu5 [label="Layer 14 Expert 21\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert21_gpu5
	layer14_expert22_gpu5 [label="Layer 14 Expert 22\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert22_gpu5
	layer14_expert23_gpu5 [label="Layer 14 Expert 23\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert23_gpu5
	layer14_expert24_gpu6 [label="Layer 14 Expert 24\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert24_gpu6
	layer14_expert25_gpu6 [label="Layer 14 Expert 25\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert25_gpu6
	layer14_expert26_gpu6 [label="Layer 14 Expert 26\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert26_gpu6
	layer14_expert27_gpu6 [label="Layer 14 Expert 27\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert27_gpu6
	layer14_expert28_gpu7 [label="Layer 14 Expert 28\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert28_gpu7
	layer14_expert29_gpu7 [label="Layer 14 Expert 29\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert29_gpu7
	layer14_expert30_gpu7 [label="Layer 14 Expert 30\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert30_gpu7
	layer14_expert31_gpu7 [label="Layer 14 Expert 31\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert31_gpu7
	layer14_expert32_gpu8 [label="Layer 14 Expert 32\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert32_gpu8
	layer14_expert33_gpu8 [label="Layer 14 Expert 33\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert33_gpu8
	layer14_expert34_gpu8 [label="Layer 14 Expert 34\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert34_gpu8
	layer14_expert35_gpu8 [label="Layer 14 Expert 35\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert35_gpu8
	layer14_expert36_gpu9 [label="Layer 14 Expert 36\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert36_gpu9
	layer14_expert37_gpu9 [label="Layer 14 Expert 37\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert37_gpu9
	layer14_expert38_gpu9 [label="Layer 14 Expert 38\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert38_gpu9
	layer14_expert39_gpu9 [label="Layer 14 Expert 39\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert39_gpu9
	layer14_expert40_gpu10 [label="Layer 14 Expert 40\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert40_gpu10
	layer14_expert41_gpu10 [label="Layer 14 Expert 41\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert41_gpu10
	layer14_expert42_gpu10 [label="Layer 14 Expert 42\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert42_gpu10
	layer14_expert43_gpu10 [label="Layer 14 Expert 43\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert43_gpu10
	layer14_expert44_gpu11 [label="Layer 14 Expert 44\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert44_gpu11
	layer14_expert45_gpu11 [label="Layer 14 Expert 45\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert45_gpu11
	layer14_expert46_gpu11 [label="Layer 14 Expert 46\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert46_gpu11
	layer14_expert47_gpu11 [label="Layer 14 Expert 47\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert47_gpu11
	layer14_expert48_gpu12 [label="Layer 14 Expert 48\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert48_gpu12
	layer14_expert49_gpu12 [label="Layer 14 Expert 49\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert49_gpu12
	layer14_expert50_gpu12 [label="Layer 14 Expert 50\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert50_gpu12
	layer14_expert51_gpu12 [label="Layer 14 Expert 51\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert51_gpu12
	layer14_expert52_gpu13 [label="Layer 14 Expert 52\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert52_gpu13
	layer14_expert53_gpu13 [label="Layer 14 Expert 53\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert53_gpu13
	layer14_expert54_gpu13 [label="Layer 14 Expert 54\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert54_gpu13
	layer14_expert55_gpu13 [label="Layer 14 Expert 55\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert55_gpu13
	layer14_expert56_gpu14 [label="Layer 14 Expert 56\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert56_gpu14
	layer14_expert57_gpu14 [label="Layer 14 Expert 57\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert57_gpu14
	layer14_expert58_gpu14 [label="Layer 14 Expert 58\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert58_gpu14
	layer14_expert59_gpu14 [label="Layer 14 Expert 59\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert59_gpu14
	layer14_expert60_gpu15 [label="Layer 14 Expert 60\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert60_gpu15
	layer14_expert61_gpu15 [label="Layer 14 Expert 61\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert61_gpu15
	layer14_expert62_gpu15 [label="Layer 14 Expert 62\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert62_gpu15
	layer14_expert63_gpu15 [label="Layer 14 Expert 63\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_router -> layer14_expert63_gpu15
	layer14_moe_agg [label="Layer 14 MoE Aggregation\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightgreen fontname=Arial shape=parallelogram style=filled]
	layer14_expert0_gpu0 -> layer14_moe_agg
	layer14_expert1_gpu0 -> layer14_moe_agg
	layer14_expert2_gpu0 -> layer14_moe_agg
	layer14_expert3_gpu0 -> layer14_moe_agg
	layer14_expert4_gpu1 -> layer14_moe_agg
	layer14_expert5_gpu1 -> layer14_moe_agg
	layer14_expert6_gpu1 -> layer14_moe_agg
	layer14_expert7_gpu1 -> layer14_moe_agg
	layer14_expert8_gpu2 -> layer14_moe_agg
	layer14_expert9_gpu2 -> layer14_moe_agg
	layer14_expert10_gpu2 -> layer14_moe_agg
	layer14_expert11_gpu2 -> layer14_moe_agg
	layer14_expert12_gpu3 -> layer14_moe_agg
	layer14_expert13_gpu3 -> layer14_moe_agg
	layer14_expert14_gpu3 -> layer14_moe_agg
	layer14_expert15_gpu3 -> layer14_moe_agg
	layer14_expert16_gpu4 -> layer14_moe_agg
	layer14_expert17_gpu4 -> layer14_moe_agg
	layer14_expert18_gpu4 -> layer14_moe_agg
	layer14_expert19_gpu4 -> layer14_moe_agg
	layer14_expert20_gpu5 -> layer14_moe_agg
	layer14_expert21_gpu5 -> layer14_moe_agg
	layer14_expert22_gpu5 -> layer14_moe_agg
	layer14_expert23_gpu5 -> layer14_moe_agg
	layer14_expert24_gpu6 -> layer14_moe_agg
	layer14_expert25_gpu6 -> layer14_moe_agg
	layer14_expert26_gpu6 -> layer14_moe_agg
	layer14_expert27_gpu6 -> layer14_moe_agg
	layer14_expert28_gpu7 -> layer14_moe_agg
	layer14_expert29_gpu7 -> layer14_moe_agg
	layer14_expert30_gpu7 -> layer14_moe_agg
	layer14_expert31_gpu7 -> layer14_moe_agg
	layer14_expert32_gpu8 -> layer14_moe_agg
	layer14_expert33_gpu8 -> layer14_moe_agg
	layer14_expert34_gpu8 -> layer14_moe_agg
	layer14_expert35_gpu8 -> layer14_moe_agg
	layer14_expert36_gpu9 -> layer14_moe_agg
	layer14_expert37_gpu9 -> layer14_moe_agg
	layer14_expert38_gpu9 -> layer14_moe_agg
	layer14_expert39_gpu9 -> layer14_moe_agg
	layer14_expert40_gpu10 -> layer14_moe_agg
	layer14_expert41_gpu10 -> layer14_moe_agg
	layer14_expert42_gpu10 -> layer14_moe_agg
	layer14_expert43_gpu10 -> layer14_moe_agg
	layer14_expert44_gpu11 -> layer14_moe_agg
	layer14_expert45_gpu11 -> layer14_moe_agg
	layer14_expert46_gpu11 -> layer14_moe_agg
	layer14_expert47_gpu11 -> layer14_moe_agg
	layer14_expert48_gpu12 -> layer14_moe_agg
	layer14_expert49_gpu12 -> layer14_moe_agg
	layer14_expert50_gpu12 -> layer14_moe_agg
	layer14_expert51_gpu12 -> layer14_moe_agg
	layer14_expert52_gpu13 -> layer14_moe_agg
	layer14_expert53_gpu13 -> layer14_moe_agg
	layer14_expert54_gpu13 -> layer14_moe_agg
	layer14_expert55_gpu13 -> layer14_moe_agg
	layer14_expert56_gpu14 -> layer14_moe_agg
	layer14_expert57_gpu14 -> layer14_moe_agg
	layer14_expert58_gpu14 -> layer14_moe_agg
	layer14_expert59_gpu14 -> layer14_moe_agg
	layer14_expert60_gpu15 -> layer14_moe_agg
	layer14_expert61_gpu15 -> layer14_moe_agg
	layer14_expert62_gpu15 -> layer14_moe_agg
	layer14_expert63_gpu15 -> layer14_moe_agg
	layer14_norm_residual [label="Layer 14 Norm + Residual\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_moe_agg -> layer14_norm_residual
	layer14_output_final [label="Layer 14 Final Output\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer14_norm_residual -> layer14_output_final
	layer15_boundary [label="Layer 15\nStage 3" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer14_output_final -> layer15_boundary
	layer15_attn_qkv_gpu12 [label="Layer 15 Attention QKV\nGPU 12\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_attn_scores_gpu12 [label="Layer 15 Attention Scores\nGPU 12\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_attn_out_gpu12 [label="Layer 15 Attention Output\nGPU 12\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_boundary -> layer15_attn_qkv_gpu12
	layer15_attn_qkv_gpu12 -> layer15_attn_scores_gpu12
	layer15_attn_scores_gpu12 -> layer15_attn_out_gpu12
	layer15_attn_qkv_gpu13 [label="Layer 15 Attention QKV\nGPU 13\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_attn_scores_gpu13 [label="Layer 15 Attention Scores\nGPU 13\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_attn_out_gpu13 [label="Layer 15 Attention Output\nGPU 13\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_attn_qkv_gpu13 -> layer15_attn_scores_gpu13
	layer15_attn_scores_gpu13 -> layer15_attn_out_gpu13
	layer15_attn_qkv_gpu14 [label="Layer 15 Attention QKV\nGPU 14\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_attn_scores_gpu14 [label="Layer 15 Attention Scores\nGPU 14\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_attn_out_gpu14 [label="Layer 15 Attention Output\nGPU 14\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_attn_qkv_gpu14 -> layer15_attn_scores_gpu14
	layer15_attn_scores_gpu14 -> layer15_attn_out_gpu14
	layer15_attn_qkv_gpu15 [label="Layer 15 Attention QKV\nGPU 15\n4 heads, 64 dim each\n[batch_size=64, seq_len=1024, heads=4, d_k=64]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_attn_scores_gpu15 [label="Layer 15 Attention Scores\nGPU 15\n[batch_size=64, seq_len=1024, seq_len=1024, heads=4]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_attn_out_gpu15 [label="Layer 15 Attention Output\nGPU 15\n[batch_size=64, seq_len=1024, hidden=256]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_attn_qkv_gpu15 -> layer15_attn_scores_gpu15
	layer15_attn_scores_gpu15 -> layer15_attn_out_gpu15
	layer15_attn_allreduce [label="Layer 15 Attention All-Reduce\nGPUs 12-15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightcoral fontname=Arial shape=ellipse style=filled]
	layer15_attn_out_gpu12 -> layer15_attn_allreduce
	layer15_attn_out_gpu13 -> layer15_attn_allreduce
	layer15_attn_out_gpu14 -> layer15_attn_allreduce
	layer15_attn_out_gpu15 -> layer15_attn_allreduce
	layer15_moe_router [label="Layer 15 MoE Router\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightyellow fontname=Arial shape=parallelogram style=filled]
	layer15_attn_allreduce -> layer15_moe_router
	layer15_expert0_gpu0 [label="Layer 15 Expert 0\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert0_gpu0
	layer15_expert1_gpu0 [label="Layer 15 Expert 1\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert1_gpu0
	layer15_expert2_gpu0 [label="Layer 15 Expert 2\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert2_gpu0
	layer15_expert3_gpu0 [label="Layer 15 Expert 3\nGPU 0\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert3_gpu0
	layer15_expert4_gpu1 [label="Layer 15 Expert 4\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert4_gpu1
	layer15_expert5_gpu1 [label="Layer 15 Expert 5\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert5_gpu1
	layer15_expert6_gpu1 [label="Layer 15 Expert 6\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert6_gpu1
	layer15_expert7_gpu1 [label="Layer 15 Expert 7\nGPU 1\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert7_gpu1
	layer15_expert8_gpu2 [label="Layer 15 Expert 8\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert8_gpu2
	layer15_expert9_gpu2 [label="Layer 15 Expert 9\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert9_gpu2
	layer15_expert10_gpu2 [label="Layer 15 Expert 10\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert10_gpu2
	layer15_expert11_gpu2 [label="Layer 15 Expert 11\nGPU 2\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert11_gpu2
	layer15_expert12_gpu3 [label="Layer 15 Expert 12\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert12_gpu3
	layer15_expert13_gpu3 [label="Layer 15 Expert 13\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert13_gpu3
	layer15_expert14_gpu3 [label="Layer 15 Expert 14\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert14_gpu3
	layer15_expert15_gpu3 [label="Layer 15 Expert 15\nGPU 3\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert15_gpu3
	layer15_expert16_gpu4 [label="Layer 15 Expert 16\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert16_gpu4
	layer15_expert17_gpu4 [label="Layer 15 Expert 17\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert17_gpu4
	layer15_expert18_gpu4 [label="Layer 15 Expert 18\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert18_gpu4
	layer15_expert19_gpu4 [label="Layer 15 Expert 19\nGPU 4\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert19_gpu4
	layer15_expert20_gpu5 [label="Layer 15 Expert 20\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert20_gpu5
	layer15_expert21_gpu5 [label="Layer 15 Expert 21\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert21_gpu5
	layer15_expert22_gpu5 [label="Layer 15 Expert 22\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert22_gpu5
	layer15_expert23_gpu5 [label="Layer 15 Expert 23\nGPU 5\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert23_gpu5
	layer15_expert24_gpu6 [label="Layer 15 Expert 24\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert24_gpu6
	layer15_expert25_gpu6 [label="Layer 15 Expert 25\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert25_gpu6
	layer15_expert26_gpu6 [label="Layer 15 Expert 26\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert26_gpu6
	layer15_expert27_gpu6 [label="Layer 15 Expert 27\nGPU 6\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert27_gpu6
	layer15_expert28_gpu7 [label="Layer 15 Expert 28\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert28_gpu7
	layer15_expert29_gpu7 [label="Layer 15 Expert 29\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert29_gpu7
	layer15_expert30_gpu7 [label="Layer 15 Expert 30\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert30_gpu7
	layer15_expert31_gpu7 [label="Layer 15 Expert 31\nGPU 7\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert31_gpu7
	layer15_expert32_gpu8 [label="Layer 15 Expert 32\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert32_gpu8
	layer15_expert33_gpu8 [label="Layer 15 Expert 33\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert33_gpu8
	layer15_expert34_gpu8 [label="Layer 15 Expert 34\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert34_gpu8
	layer15_expert35_gpu8 [label="Layer 15 Expert 35\nGPU 8\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert35_gpu8
	layer15_expert36_gpu9 [label="Layer 15 Expert 36\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert36_gpu9
	layer15_expert37_gpu9 [label="Layer 15 Expert 37\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert37_gpu9
	layer15_expert38_gpu9 [label="Layer 15 Expert 38\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert38_gpu9
	layer15_expert39_gpu9 [label="Layer 15 Expert 39\nGPU 9\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert39_gpu9
	layer15_expert40_gpu10 [label="Layer 15 Expert 40\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert40_gpu10
	layer15_expert41_gpu10 [label="Layer 15 Expert 41\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert41_gpu10
	layer15_expert42_gpu10 [label="Layer 15 Expert 42\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert42_gpu10
	layer15_expert43_gpu10 [label="Layer 15 Expert 43\nGPU 10\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert43_gpu10
	layer15_expert44_gpu11 [label="Layer 15 Expert 44\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert44_gpu11
	layer15_expert45_gpu11 [label="Layer 15 Expert 45\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert45_gpu11
	layer15_expert46_gpu11 [label="Layer 15 Expert 46\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert46_gpu11
	layer15_expert47_gpu11 [label="Layer 15 Expert 47\nGPU 11\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert47_gpu11
	layer15_expert48_gpu12 [label="Layer 15 Expert 48\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert48_gpu12
	layer15_expert49_gpu12 [label="Layer 15 Expert 49\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert49_gpu12
	layer15_expert50_gpu12 [label="Layer 15 Expert 50\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert50_gpu12
	layer15_expert51_gpu12 [label="Layer 15 Expert 51\nGPU 12\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert51_gpu12
	layer15_expert52_gpu13 [label="Layer 15 Expert 52\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert52_gpu13
	layer15_expert53_gpu13 [label="Layer 15 Expert 53\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert53_gpu13
	layer15_expert54_gpu13 [label="Layer 15 Expert 54\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert54_gpu13
	layer15_expert55_gpu13 [label="Layer 15 Expert 55\nGPU 13\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert55_gpu13
	layer15_expert56_gpu14 [label="Layer 15 Expert 56\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert56_gpu14
	layer15_expert57_gpu14 [label="Layer 15 Expert 57\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert57_gpu14
	layer15_expert58_gpu14 [label="Layer 15 Expert 58\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert58_gpu14
	layer15_expert59_gpu14 [label="Layer 15 Expert 59\nGPU 14\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert59_gpu14
	layer15_expert60_gpu15 [label="Layer 15 Expert 60\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert60_gpu15
	layer15_expert61_gpu15 [label="Layer 15 Expert 61\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert61_gpu15
	layer15_expert62_gpu15 [label="Layer 15 Expert 62\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert62_gpu15
	layer15_expert63_gpu15 [label="Layer 15 Expert 63\nGPU 15\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_router -> layer15_expert63_gpu15
	layer15_moe_agg [label="Layer 15 MoE Aggregation\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightgreen fontname=Arial shape=parallelogram style=filled]
	layer15_expert0_gpu0 -> layer15_moe_agg
	layer15_expert1_gpu0 -> layer15_moe_agg
	layer15_expert2_gpu0 -> layer15_moe_agg
	layer15_expert3_gpu0 -> layer15_moe_agg
	layer15_expert4_gpu1 -> layer15_moe_agg
	layer15_expert5_gpu1 -> layer15_moe_agg
	layer15_expert6_gpu1 -> layer15_moe_agg
	layer15_expert7_gpu1 -> layer15_moe_agg
	layer15_expert8_gpu2 -> layer15_moe_agg
	layer15_expert9_gpu2 -> layer15_moe_agg
	layer15_expert10_gpu2 -> layer15_moe_agg
	layer15_expert11_gpu2 -> layer15_moe_agg
	layer15_expert12_gpu3 -> layer15_moe_agg
	layer15_expert13_gpu3 -> layer15_moe_agg
	layer15_expert14_gpu3 -> layer15_moe_agg
	layer15_expert15_gpu3 -> layer15_moe_agg
	layer15_expert16_gpu4 -> layer15_moe_agg
	layer15_expert17_gpu4 -> layer15_moe_agg
	layer15_expert18_gpu4 -> layer15_moe_agg
	layer15_expert19_gpu4 -> layer15_moe_agg
	layer15_expert20_gpu5 -> layer15_moe_agg
	layer15_expert21_gpu5 -> layer15_moe_agg
	layer15_expert22_gpu5 -> layer15_moe_agg
	layer15_expert23_gpu5 -> layer15_moe_agg
	layer15_expert24_gpu6 -> layer15_moe_agg
	layer15_expert25_gpu6 -> layer15_moe_agg
	layer15_expert26_gpu6 -> layer15_moe_agg
	layer15_expert27_gpu6 -> layer15_moe_agg
	layer15_expert28_gpu7 -> layer15_moe_agg
	layer15_expert29_gpu7 -> layer15_moe_agg
	layer15_expert30_gpu7 -> layer15_moe_agg
	layer15_expert31_gpu7 -> layer15_moe_agg
	layer15_expert32_gpu8 -> layer15_moe_agg
	layer15_expert33_gpu8 -> layer15_moe_agg
	layer15_expert34_gpu8 -> layer15_moe_agg
	layer15_expert35_gpu8 -> layer15_moe_agg
	layer15_expert36_gpu9 -> layer15_moe_agg
	layer15_expert37_gpu9 -> layer15_moe_agg
	layer15_expert38_gpu9 -> layer15_moe_agg
	layer15_expert39_gpu9 -> layer15_moe_agg
	layer15_expert40_gpu10 -> layer15_moe_agg
	layer15_expert41_gpu10 -> layer15_moe_agg
	layer15_expert42_gpu10 -> layer15_moe_agg
	layer15_expert43_gpu10 -> layer15_moe_agg
	layer15_expert44_gpu11 -> layer15_moe_agg
	layer15_expert45_gpu11 -> layer15_moe_agg
	layer15_expert46_gpu11 -> layer15_moe_agg
	layer15_expert47_gpu11 -> layer15_moe_agg
	layer15_expert48_gpu12 -> layer15_moe_agg
	layer15_expert49_gpu12 -> layer15_moe_agg
	layer15_expert50_gpu12 -> layer15_moe_agg
	layer15_expert51_gpu12 -> layer15_moe_agg
	layer15_expert52_gpu13 -> layer15_moe_agg
	layer15_expert53_gpu13 -> layer15_moe_agg
	layer15_expert54_gpu13 -> layer15_moe_agg
	layer15_expert55_gpu13 -> layer15_moe_agg
	layer15_expert56_gpu14 -> layer15_moe_agg
	layer15_expert57_gpu14 -> layer15_moe_agg
	layer15_expert58_gpu14 -> layer15_moe_agg
	layer15_expert59_gpu14 -> layer15_moe_agg
	layer15_expert60_gpu15 -> layer15_moe_agg
	layer15_expert61_gpu15 -> layer15_moe_agg
	layer15_expert62_gpu15 -> layer15_moe_agg
	layer15_expert63_gpu15 -> layer15_moe_agg
	layer15_norm_residual [label="Layer 15 Norm + Residual\nAll GPUs\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_moe_agg -> layer15_norm_residual
	layer15_output_final [label="Layer 15 Final Output\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_norm_residual -> layer15_output_final
	output_final [label="Final Output\n[batch_size=64, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	layer15_output_final -> output_final
	data_parallel_reduce [label="Data Parallel Reduce\n2-way reduce\n[batch_size=128, seq_len=1024, hidden=1024]" fillcolor=lightcoral fontname=Arial shape=ellipse style=filled]
	output_final -> data_parallel_reduce
	output [label="Model Output\n[batch_size=128, seq_len=1024, hidden=1024]" fillcolor=lightblue fontname=Arial shape=rectangle style=filled]
	data_parallel_reduce -> output
}
