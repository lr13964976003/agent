// Megatron-LM Tensor + Pipeline Parallelism
digraph Megatron_LM {
	graph [compound=true nodesep=0.3 rankdir=TB ranksep=1.0]
	subgraph cluster_LLaMA_7B {
		fillcolor=lightyellow label="LLaMA_7B Megatron-LM\nTensor×2 Pipeline×3" style="rounded,filled"
		subgraph cluster_LLaMA_7B_stage_1 {
			fillcolor=lightblue label="Stage 1\nLayers 1-10" style="rounded,filled"
			subgraph cluster_LLaMA_7B_stage_1_rank_1 {
				fillcolor=lightgreen label="Rank 1\nGPU_1" style="rounded,filled"
				LLaMA_7B_S1_R1_L1_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L1_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L1_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L1_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L1_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L1_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L1_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L1_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L1_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L1_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L1_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L1_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L1_split -> LLaMA_7B_S1_R1_L1_norm1
				LLaMA_7B_S1_R1_L1_norm1 -> LLaMA_7B_S1_R1_L1_qkv
				LLaMA_7B_S1_R1_L1_qkv -> LLaMA_7B_S1_R1_L1_attn
				LLaMA_7B_S1_R1_L1_attn -> LLaMA_7B_S1_R1_L1_ar1
				LLaMA_7B_S1_R1_L1_ar1 -> LLaMA_7B_S1_R1_L1_res1
				LLaMA_7B_S1_R1_L1_res1 -> LLaMA_7B_S1_R1_L1_norm2
				LLaMA_7B_S1_R1_L1_norm2 -> LLaMA_7B_S1_R1_L1_ffn_up
				LLaMA_7B_S1_R1_L1_ffn_up -> LLaMA_7B_S1_R1_L1_ffn_gate
				LLaMA_7B_S1_R1_L1_ffn_gate -> LLaMA_7B_S1_R1_L1_ffn_down
				LLaMA_7B_S1_R1_L1_ffn_down -> LLaMA_7B_S1_R1_L1_ar2
				LLaMA_7B_S1_R1_L1_ar2 -> LLaMA_7B_S1_R1_L1_res2
				LLaMA_7B_S1_R1_L2_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L2_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L2_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L2_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L2_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L2_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L2_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L2_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L2_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L2_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L2_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L2_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L2_split -> LLaMA_7B_S1_R1_L2_norm1
				LLaMA_7B_S1_R1_L2_norm1 -> LLaMA_7B_S1_R1_L2_qkv
				LLaMA_7B_S1_R1_L2_qkv -> LLaMA_7B_S1_R1_L2_attn
				LLaMA_7B_S1_R1_L2_attn -> LLaMA_7B_S1_R1_L2_ar1
				LLaMA_7B_S1_R1_L2_ar1 -> LLaMA_7B_S1_R1_L2_res1
				LLaMA_7B_S1_R1_L2_res1 -> LLaMA_7B_S1_R1_L2_norm2
				LLaMA_7B_S1_R1_L2_norm2 -> LLaMA_7B_S1_R1_L2_ffn_up
				LLaMA_7B_S1_R1_L2_ffn_up -> LLaMA_7B_S1_R1_L2_ffn_gate
				LLaMA_7B_S1_R1_L2_ffn_gate -> LLaMA_7B_S1_R1_L2_ffn_down
				LLaMA_7B_S1_R1_L2_ffn_down -> LLaMA_7B_S1_R1_L2_ar2
				LLaMA_7B_S1_R1_L2_ar2 -> LLaMA_7B_S1_R1_L2_res2
				LLaMA_7B_S1_R1_L3_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L3_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L3_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L3_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L3_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L3_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L3_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L3_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L3_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L3_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L3_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L3_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L3_split -> LLaMA_7B_S1_R1_L3_norm1
				LLaMA_7B_S1_R1_L3_norm1 -> LLaMA_7B_S1_R1_L3_qkv
				LLaMA_7B_S1_R1_L3_qkv -> LLaMA_7B_S1_R1_L3_attn
				LLaMA_7B_S1_R1_L3_attn -> LLaMA_7B_S1_R1_L3_ar1
				LLaMA_7B_S1_R1_L3_ar1 -> LLaMA_7B_S1_R1_L3_res1
				LLaMA_7B_S1_R1_L3_res1 -> LLaMA_7B_S1_R1_L3_norm2
				LLaMA_7B_S1_R1_L3_norm2 -> LLaMA_7B_S1_R1_L3_ffn_up
				LLaMA_7B_S1_R1_L3_ffn_up -> LLaMA_7B_S1_R1_L3_ffn_gate
				LLaMA_7B_S1_R1_L3_ffn_gate -> LLaMA_7B_S1_R1_L3_ffn_down
				LLaMA_7B_S1_R1_L3_ffn_down -> LLaMA_7B_S1_R1_L3_ar2
				LLaMA_7B_S1_R1_L3_ar2 -> LLaMA_7B_S1_R1_L3_res2
				LLaMA_7B_S1_R1_L4_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L4_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L4_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L4_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L4_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L4_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L4_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L4_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L4_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L4_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L4_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L4_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L4_split -> LLaMA_7B_S1_R1_L4_norm1
				LLaMA_7B_S1_R1_L4_norm1 -> LLaMA_7B_S1_R1_L4_qkv
				LLaMA_7B_S1_R1_L4_qkv -> LLaMA_7B_S1_R1_L4_attn
				LLaMA_7B_S1_R1_L4_attn -> LLaMA_7B_S1_R1_L4_ar1
				LLaMA_7B_S1_R1_L4_ar1 -> LLaMA_7B_S1_R1_L4_res1
				LLaMA_7B_S1_R1_L4_res1 -> LLaMA_7B_S1_R1_L4_norm2
				LLaMA_7B_S1_R1_L4_norm2 -> LLaMA_7B_S1_R1_L4_ffn_up
				LLaMA_7B_S1_R1_L4_ffn_up -> LLaMA_7B_S1_R1_L4_ffn_gate
				LLaMA_7B_S1_R1_L4_ffn_gate -> LLaMA_7B_S1_R1_L4_ffn_down
				LLaMA_7B_S1_R1_L4_ffn_down -> LLaMA_7B_S1_R1_L4_ar2
				LLaMA_7B_S1_R1_L4_ar2 -> LLaMA_7B_S1_R1_L4_res2
				LLaMA_7B_S1_R1_L5_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L5_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L5_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L5_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L5_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L5_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L5_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L5_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L5_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L5_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L5_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L5_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L5_split -> LLaMA_7B_S1_R1_L5_norm1
				LLaMA_7B_S1_R1_L5_norm1 -> LLaMA_7B_S1_R1_L5_qkv
				LLaMA_7B_S1_R1_L5_qkv -> LLaMA_7B_S1_R1_L5_attn
				LLaMA_7B_S1_R1_L5_attn -> LLaMA_7B_S1_R1_L5_ar1
				LLaMA_7B_S1_R1_L5_ar1 -> LLaMA_7B_S1_R1_L5_res1
				LLaMA_7B_S1_R1_L5_res1 -> LLaMA_7B_S1_R1_L5_norm2
				LLaMA_7B_S1_R1_L5_norm2 -> LLaMA_7B_S1_R1_L5_ffn_up
				LLaMA_7B_S1_R1_L5_ffn_up -> LLaMA_7B_S1_R1_L5_ffn_gate
				LLaMA_7B_S1_R1_L5_ffn_gate -> LLaMA_7B_S1_R1_L5_ffn_down
				LLaMA_7B_S1_R1_L5_ffn_down -> LLaMA_7B_S1_R1_L5_ar2
				LLaMA_7B_S1_R1_L5_ar2 -> LLaMA_7B_S1_R1_L5_res2
				LLaMA_7B_S1_R1_L6_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L6_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L6_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L6_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L6_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L6_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L6_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L6_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L6_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L6_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L6_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L6_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L6_split -> LLaMA_7B_S1_R1_L6_norm1
				LLaMA_7B_S1_R1_L6_norm1 -> LLaMA_7B_S1_R1_L6_qkv
				LLaMA_7B_S1_R1_L6_qkv -> LLaMA_7B_S1_R1_L6_attn
				LLaMA_7B_S1_R1_L6_attn -> LLaMA_7B_S1_R1_L6_ar1
				LLaMA_7B_S1_R1_L6_ar1 -> LLaMA_7B_S1_R1_L6_res1
				LLaMA_7B_S1_R1_L6_res1 -> LLaMA_7B_S1_R1_L6_norm2
				LLaMA_7B_S1_R1_L6_norm2 -> LLaMA_7B_S1_R1_L6_ffn_up
				LLaMA_7B_S1_R1_L6_ffn_up -> LLaMA_7B_S1_R1_L6_ffn_gate
				LLaMA_7B_S1_R1_L6_ffn_gate -> LLaMA_7B_S1_R1_L6_ffn_down
				LLaMA_7B_S1_R1_L6_ffn_down -> LLaMA_7B_S1_R1_L6_ar2
				LLaMA_7B_S1_R1_L6_ar2 -> LLaMA_7B_S1_R1_L6_res2
				LLaMA_7B_S1_R1_L7_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L7_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L7_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L7_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L7_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L7_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L7_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L7_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L7_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L7_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L7_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L7_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L7_split -> LLaMA_7B_S1_R1_L7_norm1
				LLaMA_7B_S1_R1_L7_norm1 -> LLaMA_7B_S1_R1_L7_qkv
				LLaMA_7B_S1_R1_L7_qkv -> LLaMA_7B_S1_R1_L7_attn
				LLaMA_7B_S1_R1_L7_attn -> LLaMA_7B_S1_R1_L7_ar1
				LLaMA_7B_S1_R1_L7_ar1 -> LLaMA_7B_S1_R1_L7_res1
				LLaMA_7B_S1_R1_L7_res1 -> LLaMA_7B_S1_R1_L7_norm2
				LLaMA_7B_S1_R1_L7_norm2 -> LLaMA_7B_S1_R1_L7_ffn_up
				LLaMA_7B_S1_R1_L7_ffn_up -> LLaMA_7B_S1_R1_L7_ffn_gate
				LLaMA_7B_S1_R1_L7_ffn_gate -> LLaMA_7B_S1_R1_L7_ffn_down
				LLaMA_7B_S1_R1_L7_ffn_down -> LLaMA_7B_S1_R1_L7_ar2
				LLaMA_7B_S1_R1_L7_ar2 -> LLaMA_7B_S1_R1_L7_res2
				LLaMA_7B_S1_R1_L8_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L8_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L8_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L8_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L8_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L8_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L8_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L8_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L8_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L8_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L8_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L8_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L8_split -> LLaMA_7B_S1_R1_L8_norm1
				LLaMA_7B_S1_R1_L8_norm1 -> LLaMA_7B_S1_R1_L8_qkv
				LLaMA_7B_S1_R1_L8_qkv -> LLaMA_7B_S1_R1_L8_attn
				LLaMA_7B_S1_R1_L8_attn -> LLaMA_7B_S1_R1_L8_ar1
				LLaMA_7B_S1_R1_L8_ar1 -> LLaMA_7B_S1_R1_L8_res1
				LLaMA_7B_S1_R1_L8_res1 -> LLaMA_7B_S1_R1_L8_norm2
				LLaMA_7B_S1_R1_L8_norm2 -> LLaMA_7B_S1_R1_L8_ffn_up
				LLaMA_7B_S1_R1_L8_ffn_up -> LLaMA_7B_S1_R1_L8_ffn_gate
				LLaMA_7B_S1_R1_L8_ffn_gate -> LLaMA_7B_S1_R1_L8_ffn_down
				LLaMA_7B_S1_R1_L8_ffn_down -> LLaMA_7B_S1_R1_L8_ar2
				LLaMA_7B_S1_R1_L8_ar2 -> LLaMA_7B_S1_R1_L8_res2
				LLaMA_7B_S1_R1_L9_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L9_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L9_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L9_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L9_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L9_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L9_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L9_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L9_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L9_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L9_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L9_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L9_split -> LLaMA_7B_S1_R1_L9_norm1
				LLaMA_7B_S1_R1_L9_norm1 -> LLaMA_7B_S1_R1_L9_qkv
				LLaMA_7B_S1_R1_L9_qkv -> LLaMA_7B_S1_R1_L9_attn
				LLaMA_7B_S1_R1_L9_attn -> LLaMA_7B_S1_R1_L9_ar1
				LLaMA_7B_S1_R1_L9_ar1 -> LLaMA_7B_S1_R1_L9_res1
				LLaMA_7B_S1_R1_L9_res1 -> LLaMA_7B_S1_R1_L9_norm2
				LLaMA_7B_S1_R1_L9_norm2 -> LLaMA_7B_S1_R1_L9_ffn_up
				LLaMA_7B_S1_R1_L9_ffn_up -> LLaMA_7B_S1_R1_L9_ffn_gate
				LLaMA_7B_S1_R1_L9_ffn_gate -> LLaMA_7B_S1_R1_L9_ffn_down
				LLaMA_7B_S1_R1_L9_ffn_down -> LLaMA_7B_S1_R1_L9_ar2
				LLaMA_7B_S1_R1_L9_ar2 -> LLaMA_7B_S1_R1_L9_res2
				LLaMA_7B_S1_R1_L10_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L10_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L10_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L10_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L10_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L10_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L10_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R1_L10_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L10_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L10_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R1_L10_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R1_L10_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R1_L10_split -> LLaMA_7B_S1_R1_L10_norm1
				LLaMA_7B_S1_R1_L10_norm1 -> LLaMA_7B_S1_R1_L10_qkv
				LLaMA_7B_S1_R1_L10_qkv -> LLaMA_7B_S1_R1_L10_attn
				LLaMA_7B_S1_R1_L10_attn -> LLaMA_7B_S1_R1_L10_ar1
				LLaMA_7B_S1_R1_L10_ar1 -> LLaMA_7B_S1_R1_L10_res1
				LLaMA_7B_S1_R1_L10_res1 -> LLaMA_7B_S1_R1_L10_norm2
				LLaMA_7B_S1_R1_L10_norm2 -> LLaMA_7B_S1_R1_L10_ffn_up
				LLaMA_7B_S1_R1_L10_ffn_up -> LLaMA_7B_S1_R1_L10_ffn_gate
				LLaMA_7B_S1_R1_L10_ffn_gate -> LLaMA_7B_S1_R1_L10_ffn_down
				LLaMA_7B_S1_R1_L10_ffn_down -> LLaMA_7B_S1_R1_L10_ar2
				LLaMA_7B_S1_R1_L10_ar2 -> LLaMA_7B_S1_R1_L10_res2
			}
			subgraph cluster_LLaMA_7B_stage_1_rank_2 {
				fillcolor=lightgreen label="Rank 2\nGPU_2" style="rounded,filled"
				LLaMA_7B_S1_R2_L1_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L1_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L1_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L1_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L1_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L1_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L1_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L1_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L1_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L1_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L1_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L1_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L1_split -> LLaMA_7B_S1_R2_L1_norm1
				LLaMA_7B_S1_R2_L1_norm1 -> LLaMA_7B_S1_R2_L1_qkv
				LLaMA_7B_S1_R2_L1_qkv -> LLaMA_7B_S1_R2_L1_attn
				LLaMA_7B_S1_R2_L1_attn -> LLaMA_7B_S1_R2_L1_ar1
				LLaMA_7B_S1_R2_L1_ar1 -> LLaMA_7B_S1_R2_L1_res1
				LLaMA_7B_S1_R2_L1_res1 -> LLaMA_7B_S1_R2_L1_norm2
				LLaMA_7B_S1_R2_L1_norm2 -> LLaMA_7B_S1_R2_L1_ffn_up
				LLaMA_7B_S1_R2_L1_ffn_up -> LLaMA_7B_S1_R2_L1_ffn_gate
				LLaMA_7B_S1_R2_L1_ffn_gate -> LLaMA_7B_S1_R2_L1_ffn_down
				LLaMA_7B_S1_R2_L1_ffn_down -> LLaMA_7B_S1_R2_L1_ar2
				LLaMA_7B_S1_R2_L1_ar2 -> LLaMA_7B_S1_R2_L1_res2
				LLaMA_7B_S1_R2_L2_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L2_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L2_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L2_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L2_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L2_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L2_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L2_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L2_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L2_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L2_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L2_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L2_split -> LLaMA_7B_S1_R2_L2_norm1
				LLaMA_7B_S1_R2_L2_norm1 -> LLaMA_7B_S1_R2_L2_qkv
				LLaMA_7B_S1_R2_L2_qkv -> LLaMA_7B_S1_R2_L2_attn
				LLaMA_7B_S1_R2_L2_attn -> LLaMA_7B_S1_R2_L2_ar1
				LLaMA_7B_S1_R2_L2_ar1 -> LLaMA_7B_S1_R2_L2_res1
				LLaMA_7B_S1_R2_L2_res1 -> LLaMA_7B_S1_R2_L2_norm2
				LLaMA_7B_S1_R2_L2_norm2 -> LLaMA_7B_S1_R2_L2_ffn_up
				LLaMA_7B_S1_R2_L2_ffn_up -> LLaMA_7B_S1_R2_L2_ffn_gate
				LLaMA_7B_S1_R2_L2_ffn_gate -> LLaMA_7B_S1_R2_L2_ffn_down
				LLaMA_7B_S1_R2_L2_ffn_down -> LLaMA_7B_S1_R2_L2_ar2
				LLaMA_7B_S1_R2_L2_ar2 -> LLaMA_7B_S1_R2_L2_res2
				LLaMA_7B_S1_R2_L3_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L3_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L3_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L3_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L3_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L3_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L3_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L3_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L3_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L3_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L3_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L3_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L3_split -> LLaMA_7B_S1_R2_L3_norm1
				LLaMA_7B_S1_R2_L3_norm1 -> LLaMA_7B_S1_R2_L3_qkv
				LLaMA_7B_S1_R2_L3_qkv -> LLaMA_7B_S1_R2_L3_attn
				LLaMA_7B_S1_R2_L3_attn -> LLaMA_7B_S1_R2_L3_ar1
				LLaMA_7B_S1_R2_L3_ar1 -> LLaMA_7B_S1_R2_L3_res1
				LLaMA_7B_S1_R2_L3_res1 -> LLaMA_7B_S1_R2_L3_norm2
				LLaMA_7B_S1_R2_L3_norm2 -> LLaMA_7B_S1_R2_L3_ffn_up
				LLaMA_7B_S1_R2_L3_ffn_up -> LLaMA_7B_S1_R2_L3_ffn_gate
				LLaMA_7B_S1_R2_L3_ffn_gate -> LLaMA_7B_S1_R2_L3_ffn_down
				LLaMA_7B_S1_R2_L3_ffn_down -> LLaMA_7B_S1_R2_L3_ar2
				LLaMA_7B_S1_R2_L3_ar2 -> LLaMA_7B_S1_R2_L3_res2
				LLaMA_7B_S1_R2_L4_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L4_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L4_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L4_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L4_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L4_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L4_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L4_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L4_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L4_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L4_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L4_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L4_split -> LLaMA_7B_S1_R2_L4_norm1
				LLaMA_7B_S1_R2_L4_norm1 -> LLaMA_7B_S1_R2_L4_qkv
				LLaMA_7B_S1_R2_L4_qkv -> LLaMA_7B_S1_R2_L4_attn
				LLaMA_7B_S1_R2_L4_attn -> LLaMA_7B_S1_R2_L4_ar1
				LLaMA_7B_S1_R2_L4_ar1 -> LLaMA_7B_S1_R2_L4_res1
				LLaMA_7B_S1_R2_L4_res1 -> LLaMA_7B_S1_R2_L4_norm2
				LLaMA_7B_S1_R2_L4_norm2 -> LLaMA_7B_S1_R2_L4_ffn_up
				LLaMA_7B_S1_R2_L4_ffn_up -> LLaMA_7B_S1_R2_L4_ffn_gate
				LLaMA_7B_S1_R2_L4_ffn_gate -> LLaMA_7B_S1_R2_L4_ffn_down
				LLaMA_7B_S1_R2_L4_ffn_down -> LLaMA_7B_S1_R2_L4_ar2
				LLaMA_7B_S1_R2_L4_ar2 -> LLaMA_7B_S1_R2_L4_res2
				LLaMA_7B_S1_R2_L5_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L5_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L5_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L5_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L5_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L5_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L5_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L5_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L5_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L5_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L5_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L5_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L5_split -> LLaMA_7B_S1_R2_L5_norm1
				LLaMA_7B_S1_R2_L5_norm1 -> LLaMA_7B_S1_R2_L5_qkv
				LLaMA_7B_S1_R2_L5_qkv -> LLaMA_7B_S1_R2_L5_attn
				LLaMA_7B_S1_R2_L5_attn -> LLaMA_7B_S1_R2_L5_ar1
				LLaMA_7B_S1_R2_L5_ar1 -> LLaMA_7B_S1_R2_L5_res1
				LLaMA_7B_S1_R2_L5_res1 -> LLaMA_7B_S1_R2_L5_norm2
				LLaMA_7B_S1_R2_L5_norm2 -> LLaMA_7B_S1_R2_L5_ffn_up
				LLaMA_7B_S1_R2_L5_ffn_up -> LLaMA_7B_S1_R2_L5_ffn_gate
				LLaMA_7B_S1_R2_L5_ffn_gate -> LLaMA_7B_S1_R2_L5_ffn_down
				LLaMA_7B_S1_R2_L5_ffn_down -> LLaMA_7B_S1_R2_L5_ar2
				LLaMA_7B_S1_R2_L5_ar2 -> LLaMA_7B_S1_R2_L5_res2
				LLaMA_7B_S1_R2_L6_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L6_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L6_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L6_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L6_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L6_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L6_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L6_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L6_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L6_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L6_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L6_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L6_split -> LLaMA_7B_S1_R2_L6_norm1
				LLaMA_7B_S1_R2_L6_norm1 -> LLaMA_7B_S1_R2_L6_qkv
				LLaMA_7B_S1_R2_L6_qkv -> LLaMA_7B_S1_R2_L6_attn
				LLaMA_7B_S1_R2_L6_attn -> LLaMA_7B_S1_R2_L6_ar1
				LLaMA_7B_S1_R2_L6_ar1 -> LLaMA_7B_S1_R2_L6_res1
				LLaMA_7B_S1_R2_L6_res1 -> LLaMA_7B_S1_R2_L6_norm2
				LLaMA_7B_S1_R2_L6_norm2 -> LLaMA_7B_S1_R2_L6_ffn_up
				LLaMA_7B_S1_R2_L6_ffn_up -> LLaMA_7B_S1_R2_L6_ffn_gate
				LLaMA_7B_S1_R2_L6_ffn_gate -> LLaMA_7B_S1_R2_L6_ffn_down
				LLaMA_7B_S1_R2_L6_ffn_down -> LLaMA_7B_S1_R2_L6_ar2
				LLaMA_7B_S1_R2_L6_ar2 -> LLaMA_7B_S1_R2_L6_res2
				LLaMA_7B_S1_R2_L7_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L7_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L7_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L7_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L7_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L7_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L7_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L7_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L7_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L7_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L7_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L7_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L7_split -> LLaMA_7B_S1_R2_L7_norm1
				LLaMA_7B_S1_R2_L7_norm1 -> LLaMA_7B_S1_R2_L7_qkv
				LLaMA_7B_S1_R2_L7_qkv -> LLaMA_7B_S1_R2_L7_attn
				LLaMA_7B_S1_R2_L7_attn -> LLaMA_7B_S1_R2_L7_ar1
				LLaMA_7B_S1_R2_L7_ar1 -> LLaMA_7B_S1_R2_L7_res1
				LLaMA_7B_S1_R2_L7_res1 -> LLaMA_7B_S1_R2_L7_norm2
				LLaMA_7B_S1_R2_L7_norm2 -> LLaMA_7B_S1_R2_L7_ffn_up
				LLaMA_7B_S1_R2_L7_ffn_up -> LLaMA_7B_S1_R2_L7_ffn_gate
				LLaMA_7B_S1_R2_L7_ffn_gate -> LLaMA_7B_S1_R2_L7_ffn_down
				LLaMA_7B_S1_R2_L7_ffn_down -> LLaMA_7B_S1_R2_L7_ar2
				LLaMA_7B_S1_R2_L7_ar2 -> LLaMA_7B_S1_R2_L7_res2
				LLaMA_7B_S1_R2_L8_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L8_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L8_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L8_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L8_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L8_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L8_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L8_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L8_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L8_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L8_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L8_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L8_split -> LLaMA_7B_S1_R2_L8_norm1
				LLaMA_7B_S1_R2_L8_norm1 -> LLaMA_7B_S1_R2_L8_qkv
				LLaMA_7B_S1_R2_L8_qkv -> LLaMA_7B_S1_R2_L8_attn
				LLaMA_7B_S1_R2_L8_attn -> LLaMA_7B_S1_R2_L8_ar1
				LLaMA_7B_S1_R2_L8_ar1 -> LLaMA_7B_S1_R2_L8_res1
				LLaMA_7B_S1_R2_L8_res1 -> LLaMA_7B_S1_R2_L8_norm2
				LLaMA_7B_S1_R2_L8_norm2 -> LLaMA_7B_S1_R2_L8_ffn_up
				LLaMA_7B_S1_R2_L8_ffn_up -> LLaMA_7B_S1_R2_L8_ffn_gate
				LLaMA_7B_S1_R2_L8_ffn_gate -> LLaMA_7B_S1_R2_L8_ffn_down
				LLaMA_7B_S1_R2_L8_ffn_down -> LLaMA_7B_S1_R2_L8_ar2
				LLaMA_7B_S1_R2_L8_ar2 -> LLaMA_7B_S1_R2_L8_res2
				LLaMA_7B_S1_R2_L9_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L9_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L9_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L9_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L9_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L9_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L9_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L9_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L9_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L9_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L9_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L9_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L9_split -> LLaMA_7B_S1_R2_L9_norm1
				LLaMA_7B_S1_R2_L9_norm1 -> LLaMA_7B_S1_R2_L9_qkv
				LLaMA_7B_S1_R2_L9_qkv -> LLaMA_7B_S1_R2_L9_attn
				LLaMA_7B_S1_R2_L9_attn -> LLaMA_7B_S1_R2_L9_ar1
				LLaMA_7B_S1_R2_L9_ar1 -> LLaMA_7B_S1_R2_L9_res1
				LLaMA_7B_S1_R2_L9_res1 -> LLaMA_7B_S1_R2_L9_norm2
				LLaMA_7B_S1_R2_L9_norm2 -> LLaMA_7B_S1_R2_L9_ffn_up
				LLaMA_7B_S1_R2_L9_ffn_up -> LLaMA_7B_S1_R2_L9_ffn_gate
				LLaMA_7B_S1_R2_L9_ffn_gate -> LLaMA_7B_S1_R2_L9_ffn_down
				LLaMA_7B_S1_R2_L9_ffn_down -> LLaMA_7B_S1_R2_L9_ar2
				LLaMA_7B_S1_R2_L9_ar2 -> LLaMA_7B_S1_R2_L9_res2
				LLaMA_7B_S1_R2_L10_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L10_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L10_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L10_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L10_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L10_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L10_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S1_R2_L10_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L10_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L10_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S1_R2_L10_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S1_R2_L10_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S1_R2_L10_split -> LLaMA_7B_S1_R2_L10_norm1
				LLaMA_7B_S1_R2_L10_norm1 -> LLaMA_7B_S1_R2_L10_qkv
				LLaMA_7B_S1_R2_L10_qkv -> LLaMA_7B_S1_R2_L10_attn
				LLaMA_7B_S1_R2_L10_attn -> LLaMA_7B_S1_R2_L10_ar1
				LLaMA_7B_S1_R2_L10_ar1 -> LLaMA_7B_S1_R2_L10_res1
				LLaMA_7B_S1_R2_L10_res1 -> LLaMA_7B_S1_R2_L10_norm2
				LLaMA_7B_S1_R2_L10_norm2 -> LLaMA_7B_S1_R2_L10_ffn_up
				LLaMA_7B_S1_R2_L10_ffn_up -> LLaMA_7B_S1_R2_L10_ffn_gate
				LLaMA_7B_S1_R2_L10_ffn_gate -> LLaMA_7B_S1_R2_L10_ffn_down
				LLaMA_7B_S1_R2_L10_ffn_down -> LLaMA_7B_S1_R2_L10_ar2
				LLaMA_7B_S1_R2_L10_ar2 -> LLaMA_7B_S1_R2_L10_res2
			}
		}
		subgraph cluster_LLaMA_7B_stage_2 {
			fillcolor=lightblue label="Stage 2\nLayers 11-20" style="rounded,filled"
			subgraph cluster_LLaMA_7B_stage_2_rank_1 {
				fillcolor=lightgreen label="Rank 1\nGPU_3" style="rounded,filled"
				LLaMA_7B_S2_R1_L11_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L11_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L11_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L11_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L11_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L11_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L11_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L11_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L11_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L11_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L11_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L11_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L11_split -> LLaMA_7B_S2_R1_L11_norm1
				LLaMA_7B_S2_R1_L11_norm1 -> LLaMA_7B_S2_R1_L11_qkv
				LLaMA_7B_S2_R1_L11_qkv -> LLaMA_7B_S2_R1_L11_attn
				LLaMA_7B_S2_R1_L11_attn -> LLaMA_7B_S2_R1_L11_ar1
				LLaMA_7B_S2_R1_L11_ar1 -> LLaMA_7B_S2_R1_L11_res1
				LLaMA_7B_S2_R1_L11_res1 -> LLaMA_7B_S2_R1_L11_norm2
				LLaMA_7B_S2_R1_L11_norm2 -> LLaMA_7B_S2_R1_L11_ffn_up
				LLaMA_7B_S2_R1_L11_ffn_up -> LLaMA_7B_S2_R1_L11_ffn_gate
				LLaMA_7B_S2_R1_L11_ffn_gate -> LLaMA_7B_S2_R1_L11_ffn_down
				LLaMA_7B_S2_R1_L11_ffn_down -> LLaMA_7B_S2_R1_L11_ar2
				LLaMA_7B_S2_R1_L11_ar2 -> LLaMA_7B_S2_R1_L11_res2
				LLaMA_7B_S2_R1_L12_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L12_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L12_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L12_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L12_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L12_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L12_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L12_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L12_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L12_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L12_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L12_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L12_split -> LLaMA_7B_S2_R1_L12_norm1
				LLaMA_7B_S2_R1_L12_norm1 -> LLaMA_7B_S2_R1_L12_qkv
				LLaMA_7B_S2_R1_L12_qkv -> LLaMA_7B_S2_R1_L12_attn
				LLaMA_7B_S2_R1_L12_attn -> LLaMA_7B_S2_R1_L12_ar1
				LLaMA_7B_S2_R1_L12_ar1 -> LLaMA_7B_S2_R1_L12_res1
				LLaMA_7B_S2_R1_L12_res1 -> LLaMA_7B_S2_R1_L12_norm2
				LLaMA_7B_S2_R1_L12_norm2 -> LLaMA_7B_S2_R1_L12_ffn_up
				LLaMA_7B_S2_R1_L12_ffn_up -> LLaMA_7B_S2_R1_L12_ffn_gate
				LLaMA_7B_S2_R1_L12_ffn_gate -> LLaMA_7B_S2_R1_L12_ffn_down
				LLaMA_7B_S2_R1_L12_ffn_down -> LLaMA_7B_S2_R1_L12_ar2
				LLaMA_7B_S2_R1_L12_ar2 -> LLaMA_7B_S2_R1_L12_res2
				LLaMA_7B_S2_R1_L13_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L13_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L13_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L13_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L13_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L13_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L13_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L13_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L13_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L13_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L13_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L13_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L13_split -> LLaMA_7B_S2_R1_L13_norm1
				LLaMA_7B_S2_R1_L13_norm1 -> LLaMA_7B_S2_R1_L13_qkv
				LLaMA_7B_S2_R1_L13_qkv -> LLaMA_7B_S2_R1_L13_attn
				LLaMA_7B_S2_R1_L13_attn -> LLaMA_7B_S2_R1_L13_ar1
				LLaMA_7B_S2_R1_L13_ar1 -> LLaMA_7B_S2_R1_L13_res1
				LLaMA_7B_S2_R1_L13_res1 -> LLaMA_7B_S2_R1_L13_norm2
				LLaMA_7B_S2_R1_L13_norm2 -> LLaMA_7B_S2_R1_L13_ffn_up
				LLaMA_7B_S2_R1_L13_ffn_up -> LLaMA_7B_S2_R1_L13_ffn_gate
				LLaMA_7B_S2_R1_L13_ffn_gate -> LLaMA_7B_S2_R1_L13_ffn_down
				LLaMA_7B_S2_R1_L13_ffn_down -> LLaMA_7B_S2_R1_L13_ar2
				LLaMA_7B_S2_R1_L13_ar2 -> LLaMA_7B_S2_R1_L13_res2
				LLaMA_7B_S2_R1_L14_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L14_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L14_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L14_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L14_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L14_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L14_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L14_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L14_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L14_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L14_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L14_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L14_split -> LLaMA_7B_S2_R1_L14_norm1
				LLaMA_7B_S2_R1_L14_norm1 -> LLaMA_7B_S2_R1_L14_qkv
				LLaMA_7B_S2_R1_L14_qkv -> LLaMA_7B_S2_R1_L14_attn
				LLaMA_7B_S2_R1_L14_attn -> LLaMA_7B_S2_R1_L14_ar1
				LLaMA_7B_S2_R1_L14_ar1 -> LLaMA_7B_S2_R1_L14_res1
				LLaMA_7B_S2_R1_L14_res1 -> LLaMA_7B_S2_R1_L14_norm2
				LLaMA_7B_S2_R1_L14_norm2 -> LLaMA_7B_S2_R1_L14_ffn_up
				LLaMA_7B_S2_R1_L14_ffn_up -> LLaMA_7B_S2_R1_L14_ffn_gate
				LLaMA_7B_S2_R1_L14_ffn_gate -> LLaMA_7B_S2_R1_L14_ffn_down
				LLaMA_7B_S2_R1_L14_ffn_down -> LLaMA_7B_S2_R1_L14_ar2
				LLaMA_7B_S2_R1_L14_ar2 -> LLaMA_7B_S2_R1_L14_res2
				LLaMA_7B_S2_R1_L15_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L15_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L15_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L15_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L15_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L15_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L15_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L15_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L15_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L15_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L15_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L15_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L15_split -> LLaMA_7B_S2_R1_L15_norm1
				LLaMA_7B_S2_R1_L15_norm1 -> LLaMA_7B_S2_R1_L15_qkv
				LLaMA_7B_S2_R1_L15_qkv -> LLaMA_7B_S2_R1_L15_attn
				LLaMA_7B_S2_R1_L15_attn -> LLaMA_7B_S2_R1_L15_ar1
				LLaMA_7B_S2_R1_L15_ar1 -> LLaMA_7B_S2_R1_L15_res1
				LLaMA_7B_S2_R1_L15_res1 -> LLaMA_7B_S2_R1_L15_norm2
				LLaMA_7B_S2_R1_L15_norm2 -> LLaMA_7B_S2_R1_L15_ffn_up
				LLaMA_7B_S2_R1_L15_ffn_up -> LLaMA_7B_S2_R1_L15_ffn_gate
				LLaMA_7B_S2_R1_L15_ffn_gate -> LLaMA_7B_S2_R1_L15_ffn_down
				LLaMA_7B_S2_R1_L15_ffn_down -> LLaMA_7B_S2_R1_L15_ar2
				LLaMA_7B_S2_R1_L15_ar2 -> LLaMA_7B_S2_R1_L15_res2
				LLaMA_7B_S2_R1_L16_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L16_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L16_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L16_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L16_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L16_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L16_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L16_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L16_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L16_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L16_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L16_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L16_split -> LLaMA_7B_S2_R1_L16_norm1
				LLaMA_7B_S2_R1_L16_norm1 -> LLaMA_7B_S2_R1_L16_qkv
				LLaMA_7B_S2_R1_L16_qkv -> LLaMA_7B_S2_R1_L16_attn
				LLaMA_7B_S2_R1_L16_attn -> LLaMA_7B_S2_R1_L16_ar1
				LLaMA_7B_S2_R1_L16_ar1 -> LLaMA_7B_S2_R1_L16_res1
				LLaMA_7B_S2_R1_L16_res1 -> LLaMA_7B_S2_R1_L16_norm2
				LLaMA_7B_S2_R1_L16_norm2 -> LLaMA_7B_S2_R1_L16_ffn_up
				LLaMA_7B_S2_R1_L16_ffn_up -> LLaMA_7B_S2_R1_L16_ffn_gate
				LLaMA_7B_S2_R1_L16_ffn_gate -> LLaMA_7B_S2_R1_L16_ffn_down
				LLaMA_7B_S2_R1_L16_ffn_down -> LLaMA_7B_S2_R1_L16_ar2
				LLaMA_7B_S2_R1_L16_ar2 -> LLaMA_7B_S2_R1_L16_res2
				LLaMA_7B_S2_R1_L17_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L17_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L17_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L17_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L17_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L17_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L17_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L17_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L17_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L17_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L17_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L17_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L17_split -> LLaMA_7B_S2_R1_L17_norm1
				LLaMA_7B_S2_R1_L17_norm1 -> LLaMA_7B_S2_R1_L17_qkv
				LLaMA_7B_S2_R1_L17_qkv -> LLaMA_7B_S2_R1_L17_attn
				LLaMA_7B_S2_R1_L17_attn -> LLaMA_7B_S2_R1_L17_ar1
				LLaMA_7B_S2_R1_L17_ar1 -> LLaMA_7B_S2_R1_L17_res1
				LLaMA_7B_S2_R1_L17_res1 -> LLaMA_7B_S2_R1_L17_norm2
				LLaMA_7B_S2_R1_L17_norm2 -> LLaMA_7B_S2_R1_L17_ffn_up
				LLaMA_7B_S2_R1_L17_ffn_up -> LLaMA_7B_S2_R1_L17_ffn_gate
				LLaMA_7B_S2_R1_L17_ffn_gate -> LLaMA_7B_S2_R1_L17_ffn_down
				LLaMA_7B_S2_R1_L17_ffn_down -> LLaMA_7B_S2_R1_L17_ar2
				LLaMA_7B_S2_R1_L17_ar2 -> LLaMA_7B_S2_R1_L17_res2
				LLaMA_7B_S2_R1_L18_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L18_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L18_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L18_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L18_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L18_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L18_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L18_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L18_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L18_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L18_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L18_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L18_split -> LLaMA_7B_S2_R1_L18_norm1
				LLaMA_7B_S2_R1_L18_norm1 -> LLaMA_7B_S2_R1_L18_qkv
				LLaMA_7B_S2_R1_L18_qkv -> LLaMA_7B_S2_R1_L18_attn
				LLaMA_7B_S2_R1_L18_attn -> LLaMA_7B_S2_R1_L18_ar1
				LLaMA_7B_S2_R1_L18_ar1 -> LLaMA_7B_S2_R1_L18_res1
				LLaMA_7B_S2_R1_L18_res1 -> LLaMA_7B_S2_R1_L18_norm2
				LLaMA_7B_S2_R1_L18_norm2 -> LLaMA_7B_S2_R1_L18_ffn_up
				LLaMA_7B_S2_R1_L18_ffn_up -> LLaMA_7B_S2_R1_L18_ffn_gate
				LLaMA_7B_S2_R1_L18_ffn_gate -> LLaMA_7B_S2_R1_L18_ffn_down
				LLaMA_7B_S2_R1_L18_ffn_down -> LLaMA_7B_S2_R1_L18_ar2
				LLaMA_7B_S2_R1_L18_ar2 -> LLaMA_7B_S2_R1_L18_res2
				LLaMA_7B_S2_R1_L19_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L19_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L19_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L19_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L19_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L19_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L19_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L19_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L19_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L19_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L19_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L19_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L19_split -> LLaMA_7B_S2_R1_L19_norm1
				LLaMA_7B_S2_R1_L19_norm1 -> LLaMA_7B_S2_R1_L19_qkv
				LLaMA_7B_S2_R1_L19_qkv -> LLaMA_7B_S2_R1_L19_attn
				LLaMA_7B_S2_R1_L19_attn -> LLaMA_7B_S2_R1_L19_ar1
				LLaMA_7B_S2_R1_L19_ar1 -> LLaMA_7B_S2_R1_L19_res1
				LLaMA_7B_S2_R1_L19_res1 -> LLaMA_7B_S2_R1_L19_norm2
				LLaMA_7B_S2_R1_L19_norm2 -> LLaMA_7B_S2_R1_L19_ffn_up
				LLaMA_7B_S2_R1_L19_ffn_up -> LLaMA_7B_S2_R1_L19_ffn_gate
				LLaMA_7B_S2_R1_L19_ffn_gate -> LLaMA_7B_S2_R1_L19_ffn_down
				LLaMA_7B_S2_R1_L19_ffn_down -> LLaMA_7B_S2_R1_L19_ar2
				LLaMA_7B_S2_R1_L19_ar2 -> LLaMA_7B_S2_R1_L19_res2
				LLaMA_7B_S2_R1_L20_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L20_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L20_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L20_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L20_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L20_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L20_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R1_L20_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L20_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L20_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R1_L20_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R1_L20_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R1_L20_split -> LLaMA_7B_S2_R1_L20_norm1
				LLaMA_7B_S2_R1_L20_norm1 -> LLaMA_7B_S2_R1_L20_qkv
				LLaMA_7B_S2_R1_L20_qkv -> LLaMA_7B_S2_R1_L20_attn
				LLaMA_7B_S2_R1_L20_attn -> LLaMA_7B_S2_R1_L20_ar1
				LLaMA_7B_S2_R1_L20_ar1 -> LLaMA_7B_S2_R1_L20_res1
				LLaMA_7B_S2_R1_L20_res1 -> LLaMA_7B_S2_R1_L20_norm2
				LLaMA_7B_S2_R1_L20_norm2 -> LLaMA_7B_S2_R1_L20_ffn_up
				LLaMA_7B_S2_R1_L20_ffn_up -> LLaMA_7B_S2_R1_L20_ffn_gate
				LLaMA_7B_S2_R1_L20_ffn_gate -> LLaMA_7B_S2_R1_L20_ffn_down
				LLaMA_7B_S2_R1_L20_ffn_down -> LLaMA_7B_S2_R1_L20_ar2
				LLaMA_7B_S2_R1_L20_ar2 -> LLaMA_7B_S2_R1_L20_res2
			}
			subgraph cluster_LLaMA_7B_stage_2_rank_2 {
				fillcolor=lightgreen label="Rank 2\nGPU_4" style="rounded,filled"
				LLaMA_7B_S2_R2_L11_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L11_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L11_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L11_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L11_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L11_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L11_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L11_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L11_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L11_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L11_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L11_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L11_split -> LLaMA_7B_S2_R2_L11_norm1
				LLaMA_7B_S2_R2_L11_norm1 -> LLaMA_7B_S2_R2_L11_qkv
				LLaMA_7B_S2_R2_L11_qkv -> LLaMA_7B_S2_R2_L11_attn
				LLaMA_7B_S2_R2_L11_attn -> LLaMA_7B_S2_R2_L11_ar1
				LLaMA_7B_S2_R2_L11_ar1 -> LLaMA_7B_S2_R2_L11_res1
				LLaMA_7B_S2_R2_L11_res1 -> LLaMA_7B_S2_R2_L11_norm2
				LLaMA_7B_S2_R2_L11_norm2 -> LLaMA_7B_S2_R2_L11_ffn_up
				LLaMA_7B_S2_R2_L11_ffn_up -> LLaMA_7B_S2_R2_L11_ffn_gate
				LLaMA_7B_S2_R2_L11_ffn_gate -> LLaMA_7B_S2_R2_L11_ffn_down
				LLaMA_7B_S2_R2_L11_ffn_down -> LLaMA_7B_S2_R2_L11_ar2
				LLaMA_7B_S2_R2_L11_ar2 -> LLaMA_7B_S2_R2_L11_res2
				LLaMA_7B_S2_R2_L12_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L12_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L12_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L12_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L12_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L12_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L12_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L12_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L12_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L12_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L12_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L12_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L12_split -> LLaMA_7B_S2_R2_L12_norm1
				LLaMA_7B_S2_R2_L12_norm1 -> LLaMA_7B_S2_R2_L12_qkv
				LLaMA_7B_S2_R2_L12_qkv -> LLaMA_7B_S2_R2_L12_attn
				LLaMA_7B_S2_R2_L12_attn -> LLaMA_7B_S2_R2_L12_ar1
				LLaMA_7B_S2_R2_L12_ar1 -> LLaMA_7B_S2_R2_L12_res1
				LLaMA_7B_S2_R2_L12_res1 -> LLaMA_7B_S2_R2_L12_norm2
				LLaMA_7B_S2_R2_L12_norm2 -> LLaMA_7B_S2_R2_L12_ffn_up
				LLaMA_7B_S2_R2_L12_ffn_up -> LLaMA_7B_S2_R2_L12_ffn_gate
				LLaMA_7B_S2_R2_L12_ffn_gate -> LLaMA_7B_S2_R2_L12_ffn_down
				LLaMA_7B_S2_R2_L12_ffn_down -> LLaMA_7B_S2_R2_L12_ar2
				LLaMA_7B_S2_R2_L12_ar2 -> LLaMA_7B_S2_R2_L12_res2
				LLaMA_7B_S2_R2_L13_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L13_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L13_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L13_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L13_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L13_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L13_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L13_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L13_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L13_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L13_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L13_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L13_split -> LLaMA_7B_S2_R2_L13_norm1
				LLaMA_7B_S2_R2_L13_norm1 -> LLaMA_7B_S2_R2_L13_qkv
				LLaMA_7B_S2_R2_L13_qkv -> LLaMA_7B_S2_R2_L13_attn
				LLaMA_7B_S2_R2_L13_attn -> LLaMA_7B_S2_R2_L13_ar1
				LLaMA_7B_S2_R2_L13_ar1 -> LLaMA_7B_S2_R2_L13_res1
				LLaMA_7B_S2_R2_L13_res1 -> LLaMA_7B_S2_R2_L13_norm2
				LLaMA_7B_S2_R2_L13_norm2 -> LLaMA_7B_S2_R2_L13_ffn_up
				LLaMA_7B_S2_R2_L13_ffn_up -> LLaMA_7B_S2_R2_L13_ffn_gate
				LLaMA_7B_S2_R2_L13_ffn_gate -> LLaMA_7B_S2_R2_L13_ffn_down
				LLaMA_7B_S2_R2_L13_ffn_down -> LLaMA_7B_S2_R2_L13_ar2
				LLaMA_7B_S2_R2_L13_ar2 -> LLaMA_7B_S2_R2_L13_res2
				LLaMA_7B_S2_R2_L14_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L14_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L14_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L14_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L14_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L14_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L14_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L14_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L14_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L14_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L14_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L14_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L14_split -> LLaMA_7B_S2_R2_L14_norm1
				LLaMA_7B_S2_R2_L14_norm1 -> LLaMA_7B_S2_R2_L14_qkv
				LLaMA_7B_S2_R2_L14_qkv -> LLaMA_7B_S2_R2_L14_attn
				LLaMA_7B_S2_R2_L14_attn -> LLaMA_7B_S2_R2_L14_ar1
				LLaMA_7B_S2_R2_L14_ar1 -> LLaMA_7B_S2_R2_L14_res1
				LLaMA_7B_S2_R2_L14_res1 -> LLaMA_7B_S2_R2_L14_norm2
				LLaMA_7B_S2_R2_L14_norm2 -> LLaMA_7B_S2_R2_L14_ffn_up
				LLaMA_7B_S2_R2_L14_ffn_up -> LLaMA_7B_S2_R2_L14_ffn_gate
				LLaMA_7B_S2_R2_L14_ffn_gate -> LLaMA_7B_S2_R2_L14_ffn_down
				LLaMA_7B_S2_R2_L14_ffn_down -> LLaMA_7B_S2_R2_L14_ar2
				LLaMA_7B_S2_R2_L14_ar2 -> LLaMA_7B_S2_R2_L14_res2
				LLaMA_7B_S2_R2_L15_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L15_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L15_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L15_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L15_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L15_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L15_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L15_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L15_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L15_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L15_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L15_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L15_split -> LLaMA_7B_S2_R2_L15_norm1
				LLaMA_7B_S2_R2_L15_norm1 -> LLaMA_7B_S2_R2_L15_qkv
				LLaMA_7B_S2_R2_L15_qkv -> LLaMA_7B_S2_R2_L15_attn
				LLaMA_7B_S2_R2_L15_attn -> LLaMA_7B_S2_R2_L15_ar1
				LLaMA_7B_S2_R2_L15_ar1 -> LLaMA_7B_S2_R2_L15_res1
				LLaMA_7B_S2_R2_L15_res1 -> LLaMA_7B_S2_R2_L15_norm2
				LLaMA_7B_S2_R2_L15_norm2 -> LLaMA_7B_S2_R2_L15_ffn_up
				LLaMA_7B_S2_R2_L15_ffn_up -> LLaMA_7B_S2_R2_L15_ffn_gate
				LLaMA_7B_S2_R2_L15_ffn_gate -> LLaMA_7B_S2_R2_L15_ffn_down
				LLaMA_7B_S2_R2_L15_ffn_down -> LLaMA_7B_S2_R2_L15_ar2
				LLaMA_7B_S2_R2_L15_ar2 -> LLaMA_7B_S2_R2_L15_res2
				LLaMA_7B_S2_R2_L16_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L16_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L16_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L16_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L16_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L16_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L16_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L16_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L16_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L16_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L16_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L16_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L16_split -> LLaMA_7B_S2_R2_L16_norm1
				LLaMA_7B_S2_R2_L16_norm1 -> LLaMA_7B_S2_R2_L16_qkv
				LLaMA_7B_S2_R2_L16_qkv -> LLaMA_7B_S2_R2_L16_attn
				LLaMA_7B_S2_R2_L16_attn -> LLaMA_7B_S2_R2_L16_ar1
				LLaMA_7B_S2_R2_L16_ar1 -> LLaMA_7B_S2_R2_L16_res1
				LLaMA_7B_S2_R2_L16_res1 -> LLaMA_7B_S2_R2_L16_norm2
				LLaMA_7B_S2_R2_L16_norm2 -> LLaMA_7B_S2_R2_L16_ffn_up
				LLaMA_7B_S2_R2_L16_ffn_up -> LLaMA_7B_S2_R2_L16_ffn_gate
				LLaMA_7B_S2_R2_L16_ffn_gate -> LLaMA_7B_S2_R2_L16_ffn_down
				LLaMA_7B_S2_R2_L16_ffn_down -> LLaMA_7B_S2_R2_L16_ar2
				LLaMA_7B_S2_R2_L16_ar2 -> LLaMA_7B_S2_R2_L16_res2
				LLaMA_7B_S2_R2_L17_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L17_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L17_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L17_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L17_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L17_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L17_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L17_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L17_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L17_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L17_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L17_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L17_split -> LLaMA_7B_S2_R2_L17_norm1
				LLaMA_7B_S2_R2_L17_norm1 -> LLaMA_7B_S2_R2_L17_qkv
				LLaMA_7B_S2_R2_L17_qkv -> LLaMA_7B_S2_R2_L17_attn
				LLaMA_7B_S2_R2_L17_attn -> LLaMA_7B_S2_R2_L17_ar1
				LLaMA_7B_S2_R2_L17_ar1 -> LLaMA_7B_S2_R2_L17_res1
				LLaMA_7B_S2_R2_L17_res1 -> LLaMA_7B_S2_R2_L17_norm2
				LLaMA_7B_S2_R2_L17_norm2 -> LLaMA_7B_S2_R2_L17_ffn_up
				LLaMA_7B_S2_R2_L17_ffn_up -> LLaMA_7B_S2_R2_L17_ffn_gate
				LLaMA_7B_S2_R2_L17_ffn_gate -> LLaMA_7B_S2_R2_L17_ffn_down
				LLaMA_7B_S2_R2_L17_ffn_down -> LLaMA_7B_S2_R2_L17_ar2
				LLaMA_7B_S2_R2_L17_ar2 -> LLaMA_7B_S2_R2_L17_res2
				LLaMA_7B_S2_R2_L18_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L18_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L18_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L18_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L18_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L18_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L18_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L18_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L18_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L18_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L18_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L18_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L18_split -> LLaMA_7B_S2_R2_L18_norm1
				LLaMA_7B_S2_R2_L18_norm1 -> LLaMA_7B_S2_R2_L18_qkv
				LLaMA_7B_S2_R2_L18_qkv -> LLaMA_7B_S2_R2_L18_attn
				LLaMA_7B_S2_R2_L18_attn -> LLaMA_7B_S2_R2_L18_ar1
				LLaMA_7B_S2_R2_L18_ar1 -> LLaMA_7B_S2_R2_L18_res1
				LLaMA_7B_S2_R2_L18_res1 -> LLaMA_7B_S2_R2_L18_norm2
				LLaMA_7B_S2_R2_L18_norm2 -> LLaMA_7B_S2_R2_L18_ffn_up
				LLaMA_7B_S2_R2_L18_ffn_up -> LLaMA_7B_S2_R2_L18_ffn_gate
				LLaMA_7B_S2_R2_L18_ffn_gate -> LLaMA_7B_S2_R2_L18_ffn_down
				LLaMA_7B_S2_R2_L18_ffn_down -> LLaMA_7B_S2_R2_L18_ar2
				LLaMA_7B_S2_R2_L18_ar2 -> LLaMA_7B_S2_R2_L18_res2
				LLaMA_7B_S2_R2_L19_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L19_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L19_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L19_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L19_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L19_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L19_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L19_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L19_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L19_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L19_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L19_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L19_split -> LLaMA_7B_S2_R2_L19_norm1
				LLaMA_7B_S2_R2_L19_norm1 -> LLaMA_7B_S2_R2_L19_qkv
				LLaMA_7B_S2_R2_L19_qkv -> LLaMA_7B_S2_R2_L19_attn
				LLaMA_7B_S2_R2_L19_attn -> LLaMA_7B_S2_R2_L19_ar1
				LLaMA_7B_S2_R2_L19_ar1 -> LLaMA_7B_S2_R2_L19_res1
				LLaMA_7B_S2_R2_L19_res1 -> LLaMA_7B_S2_R2_L19_norm2
				LLaMA_7B_S2_R2_L19_norm2 -> LLaMA_7B_S2_R2_L19_ffn_up
				LLaMA_7B_S2_R2_L19_ffn_up -> LLaMA_7B_S2_R2_L19_ffn_gate
				LLaMA_7B_S2_R2_L19_ffn_gate -> LLaMA_7B_S2_R2_L19_ffn_down
				LLaMA_7B_S2_R2_L19_ffn_down -> LLaMA_7B_S2_R2_L19_ar2
				LLaMA_7B_S2_R2_L19_ar2 -> LLaMA_7B_S2_R2_L19_res2
				LLaMA_7B_S2_R2_L20_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L20_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L20_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L20_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L20_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L20_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L20_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S2_R2_L20_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L20_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L20_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S2_R2_L20_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S2_R2_L20_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S2_R2_L20_split -> LLaMA_7B_S2_R2_L20_norm1
				LLaMA_7B_S2_R2_L20_norm1 -> LLaMA_7B_S2_R2_L20_qkv
				LLaMA_7B_S2_R2_L20_qkv -> LLaMA_7B_S2_R2_L20_attn
				LLaMA_7B_S2_R2_L20_attn -> LLaMA_7B_S2_R2_L20_ar1
				LLaMA_7B_S2_R2_L20_ar1 -> LLaMA_7B_S2_R2_L20_res1
				LLaMA_7B_S2_R2_L20_res1 -> LLaMA_7B_S2_R2_L20_norm2
				LLaMA_7B_S2_R2_L20_norm2 -> LLaMA_7B_S2_R2_L20_ffn_up
				LLaMA_7B_S2_R2_L20_ffn_up -> LLaMA_7B_S2_R2_L20_ffn_gate
				LLaMA_7B_S2_R2_L20_ffn_gate -> LLaMA_7B_S2_R2_L20_ffn_down
				LLaMA_7B_S2_R2_L20_ffn_down -> LLaMA_7B_S2_R2_L20_ar2
				LLaMA_7B_S2_R2_L20_ar2 -> LLaMA_7B_S2_R2_L20_res2
			}
		}
		subgraph cluster_LLaMA_7B_stage_3 {
			fillcolor=lightblue label="Stage 3\nLayers 21-30" style="rounded,filled"
			subgraph cluster_LLaMA_7B_stage_3_rank_1 {
				fillcolor=lightgreen label="Rank 1\nGPU_5" style="rounded,filled"
				LLaMA_7B_S3_R1_L21_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L21_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L21_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L21_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L21_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L21_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L21_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L21_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L21_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L21_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L21_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L21_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L21_split -> LLaMA_7B_S3_R1_L21_norm1
				LLaMA_7B_S3_R1_L21_norm1 -> LLaMA_7B_S3_R1_L21_qkv
				LLaMA_7B_S3_R1_L21_qkv -> LLaMA_7B_S3_R1_L21_attn
				LLaMA_7B_S3_R1_L21_attn -> LLaMA_7B_S3_R1_L21_ar1
				LLaMA_7B_S3_R1_L21_ar1 -> LLaMA_7B_S3_R1_L21_res1
				LLaMA_7B_S3_R1_L21_res1 -> LLaMA_7B_S3_R1_L21_norm2
				LLaMA_7B_S3_R1_L21_norm2 -> LLaMA_7B_S3_R1_L21_ffn_up
				LLaMA_7B_S3_R1_L21_ffn_up -> LLaMA_7B_S3_R1_L21_ffn_gate
				LLaMA_7B_S3_R1_L21_ffn_gate -> LLaMA_7B_S3_R1_L21_ffn_down
				LLaMA_7B_S3_R1_L21_ffn_down -> LLaMA_7B_S3_R1_L21_ar2
				LLaMA_7B_S3_R1_L21_ar2 -> LLaMA_7B_S3_R1_L21_res2
				LLaMA_7B_S3_R1_L22_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L22_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L22_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L22_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L22_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L22_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L22_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L22_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L22_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L22_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L22_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L22_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L22_split -> LLaMA_7B_S3_R1_L22_norm1
				LLaMA_7B_S3_R1_L22_norm1 -> LLaMA_7B_S3_R1_L22_qkv
				LLaMA_7B_S3_R1_L22_qkv -> LLaMA_7B_S3_R1_L22_attn
				LLaMA_7B_S3_R1_L22_attn -> LLaMA_7B_S3_R1_L22_ar1
				LLaMA_7B_S3_R1_L22_ar1 -> LLaMA_7B_S3_R1_L22_res1
				LLaMA_7B_S3_R1_L22_res1 -> LLaMA_7B_S3_R1_L22_norm2
				LLaMA_7B_S3_R1_L22_norm2 -> LLaMA_7B_S3_R1_L22_ffn_up
				LLaMA_7B_S3_R1_L22_ffn_up -> LLaMA_7B_S3_R1_L22_ffn_gate
				LLaMA_7B_S3_R1_L22_ffn_gate -> LLaMA_7B_S3_R1_L22_ffn_down
				LLaMA_7B_S3_R1_L22_ffn_down -> LLaMA_7B_S3_R1_L22_ar2
				LLaMA_7B_S3_R1_L22_ar2 -> LLaMA_7B_S3_R1_L22_res2
				LLaMA_7B_S3_R1_L23_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L23_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L23_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L23_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L23_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L23_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L23_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L23_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L23_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L23_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L23_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L23_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L23_split -> LLaMA_7B_S3_R1_L23_norm1
				LLaMA_7B_S3_R1_L23_norm1 -> LLaMA_7B_S3_R1_L23_qkv
				LLaMA_7B_S3_R1_L23_qkv -> LLaMA_7B_S3_R1_L23_attn
				LLaMA_7B_S3_R1_L23_attn -> LLaMA_7B_S3_R1_L23_ar1
				LLaMA_7B_S3_R1_L23_ar1 -> LLaMA_7B_S3_R1_L23_res1
				LLaMA_7B_S3_R1_L23_res1 -> LLaMA_7B_S3_R1_L23_norm2
				LLaMA_7B_S3_R1_L23_norm2 -> LLaMA_7B_S3_R1_L23_ffn_up
				LLaMA_7B_S3_R1_L23_ffn_up -> LLaMA_7B_S3_R1_L23_ffn_gate
				LLaMA_7B_S3_R1_L23_ffn_gate -> LLaMA_7B_S3_R1_L23_ffn_down
				LLaMA_7B_S3_R1_L23_ffn_down -> LLaMA_7B_S3_R1_L23_ar2
				LLaMA_7B_S3_R1_L23_ar2 -> LLaMA_7B_S3_R1_L23_res2
				LLaMA_7B_S3_R1_L24_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L24_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L24_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L24_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L24_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L24_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L24_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L24_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L24_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L24_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L24_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L24_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L24_split -> LLaMA_7B_S3_R1_L24_norm1
				LLaMA_7B_S3_R1_L24_norm1 -> LLaMA_7B_S3_R1_L24_qkv
				LLaMA_7B_S3_R1_L24_qkv -> LLaMA_7B_S3_R1_L24_attn
				LLaMA_7B_S3_R1_L24_attn -> LLaMA_7B_S3_R1_L24_ar1
				LLaMA_7B_S3_R1_L24_ar1 -> LLaMA_7B_S3_R1_L24_res1
				LLaMA_7B_S3_R1_L24_res1 -> LLaMA_7B_S3_R1_L24_norm2
				LLaMA_7B_S3_R1_L24_norm2 -> LLaMA_7B_S3_R1_L24_ffn_up
				LLaMA_7B_S3_R1_L24_ffn_up -> LLaMA_7B_S3_R1_L24_ffn_gate
				LLaMA_7B_S3_R1_L24_ffn_gate -> LLaMA_7B_S3_R1_L24_ffn_down
				LLaMA_7B_S3_R1_L24_ffn_down -> LLaMA_7B_S3_R1_L24_ar2
				LLaMA_7B_S3_R1_L24_ar2 -> LLaMA_7B_S3_R1_L24_res2
				LLaMA_7B_S3_R1_L25_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L25_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L25_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L25_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L25_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L25_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L25_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L25_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L25_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L25_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L25_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L25_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L25_split -> LLaMA_7B_S3_R1_L25_norm1
				LLaMA_7B_S3_R1_L25_norm1 -> LLaMA_7B_S3_R1_L25_qkv
				LLaMA_7B_S3_R1_L25_qkv -> LLaMA_7B_S3_R1_L25_attn
				LLaMA_7B_S3_R1_L25_attn -> LLaMA_7B_S3_R1_L25_ar1
				LLaMA_7B_S3_R1_L25_ar1 -> LLaMA_7B_S3_R1_L25_res1
				LLaMA_7B_S3_R1_L25_res1 -> LLaMA_7B_S3_R1_L25_norm2
				LLaMA_7B_S3_R1_L25_norm2 -> LLaMA_7B_S3_R1_L25_ffn_up
				LLaMA_7B_S3_R1_L25_ffn_up -> LLaMA_7B_S3_R1_L25_ffn_gate
				LLaMA_7B_S3_R1_L25_ffn_gate -> LLaMA_7B_S3_R1_L25_ffn_down
				LLaMA_7B_S3_R1_L25_ffn_down -> LLaMA_7B_S3_R1_L25_ar2
				LLaMA_7B_S3_R1_L25_ar2 -> LLaMA_7B_S3_R1_L25_res2
				LLaMA_7B_S3_R1_L26_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L26_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L26_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L26_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L26_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L26_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L26_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L26_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L26_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L26_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L26_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L26_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L26_split -> LLaMA_7B_S3_R1_L26_norm1
				LLaMA_7B_S3_R1_L26_norm1 -> LLaMA_7B_S3_R1_L26_qkv
				LLaMA_7B_S3_R1_L26_qkv -> LLaMA_7B_S3_R1_L26_attn
				LLaMA_7B_S3_R1_L26_attn -> LLaMA_7B_S3_R1_L26_ar1
				LLaMA_7B_S3_R1_L26_ar1 -> LLaMA_7B_S3_R1_L26_res1
				LLaMA_7B_S3_R1_L26_res1 -> LLaMA_7B_S3_R1_L26_norm2
				LLaMA_7B_S3_R1_L26_norm2 -> LLaMA_7B_S3_R1_L26_ffn_up
				LLaMA_7B_S3_R1_L26_ffn_up -> LLaMA_7B_S3_R1_L26_ffn_gate
				LLaMA_7B_S3_R1_L26_ffn_gate -> LLaMA_7B_S3_R1_L26_ffn_down
				LLaMA_7B_S3_R1_L26_ffn_down -> LLaMA_7B_S3_R1_L26_ar2
				LLaMA_7B_S3_R1_L26_ar2 -> LLaMA_7B_S3_R1_L26_res2
				LLaMA_7B_S3_R1_L27_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L27_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L27_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L27_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L27_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L27_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L27_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L27_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L27_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L27_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L27_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L27_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L27_split -> LLaMA_7B_S3_R1_L27_norm1
				LLaMA_7B_S3_R1_L27_norm1 -> LLaMA_7B_S3_R1_L27_qkv
				LLaMA_7B_S3_R1_L27_qkv -> LLaMA_7B_S3_R1_L27_attn
				LLaMA_7B_S3_R1_L27_attn -> LLaMA_7B_S3_R1_L27_ar1
				LLaMA_7B_S3_R1_L27_ar1 -> LLaMA_7B_S3_R1_L27_res1
				LLaMA_7B_S3_R1_L27_res1 -> LLaMA_7B_S3_R1_L27_norm2
				LLaMA_7B_S3_R1_L27_norm2 -> LLaMA_7B_S3_R1_L27_ffn_up
				LLaMA_7B_S3_R1_L27_ffn_up -> LLaMA_7B_S3_R1_L27_ffn_gate
				LLaMA_7B_S3_R1_L27_ffn_gate -> LLaMA_7B_S3_R1_L27_ffn_down
				LLaMA_7B_S3_R1_L27_ffn_down -> LLaMA_7B_S3_R1_L27_ar2
				LLaMA_7B_S3_R1_L27_ar2 -> LLaMA_7B_S3_R1_L27_res2
				LLaMA_7B_S3_R1_L28_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L28_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L28_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L28_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L28_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L28_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L28_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L28_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L28_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L28_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L28_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L28_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L28_split -> LLaMA_7B_S3_R1_L28_norm1
				LLaMA_7B_S3_R1_L28_norm1 -> LLaMA_7B_S3_R1_L28_qkv
				LLaMA_7B_S3_R1_L28_qkv -> LLaMA_7B_S3_R1_L28_attn
				LLaMA_7B_S3_R1_L28_attn -> LLaMA_7B_S3_R1_L28_ar1
				LLaMA_7B_S3_R1_L28_ar1 -> LLaMA_7B_S3_R1_L28_res1
				LLaMA_7B_S3_R1_L28_res1 -> LLaMA_7B_S3_R1_L28_norm2
				LLaMA_7B_S3_R1_L28_norm2 -> LLaMA_7B_S3_R1_L28_ffn_up
				LLaMA_7B_S3_R1_L28_ffn_up -> LLaMA_7B_S3_R1_L28_ffn_gate
				LLaMA_7B_S3_R1_L28_ffn_gate -> LLaMA_7B_S3_R1_L28_ffn_down
				LLaMA_7B_S3_R1_L28_ffn_down -> LLaMA_7B_S3_R1_L28_ar2
				LLaMA_7B_S3_R1_L28_ar2 -> LLaMA_7B_S3_R1_L28_res2
				LLaMA_7B_S3_R1_L29_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L29_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L29_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L29_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L29_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L29_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L29_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L29_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L29_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L29_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L29_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L29_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L29_split -> LLaMA_7B_S3_R1_L29_norm1
				LLaMA_7B_S3_R1_L29_norm1 -> LLaMA_7B_S3_R1_L29_qkv
				LLaMA_7B_S3_R1_L29_qkv -> LLaMA_7B_S3_R1_L29_attn
				LLaMA_7B_S3_R1_L29_attn -> LLaMA_7B_S3_R1_L29_ar1
				LLaMA_7B_S3_R1_L29_ar1 -> LLaMA_7B_S3_R1_L29_res1
				LLaMA_7B_S3_R1_L29_res1 -> LLaMA_7B_S3_R1_L29_norm2
				LLaMA_7B_S3_R1_L29_norm2 -> LLaMA_7B_S3_R1_L29_ffn_up
				LLaMA_7B_S3_R1_L29_ffn_up -> LLaMA_7B_S3_R1_L29_ffn_gate
				LLaMA_7B_S3_R1_L29_ffn_gate -> LLaMA_7B_S3_R1_L29_ffn_down
				LLaMA_7B_S3_R1_L29_ffn_down -> LLaMA_7B_S3_R1_L29_ar2
				LLaMA_7B_S3_R1_L29_ar2 -> LLaMA_7B_S3_R1_L29_res2
				LLaMA_7B_S3_R1_L30_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L30_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L30_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L30_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L30_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L30_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L30_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R1_L30_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L30_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L30_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R1_L30_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R1_L30_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R1_L30_split -> LLaMA_7B_S3_R1_L30_norm1
				LLaMA_7B_S3_R1_L30_norm1 -> LLaMA_7B_S3_R1_L30_qkv
				LLaMA_7B_S3_R1_L30_qkv -> LLaMA_7B_S3_R1_L30_attn
				LLaMA_7B_S3_R1_L30_attn -> LLaMA_7B_S3_R1_L30_ar1
				LLaMA_7B_S3_R1_L30_ar1 -> LLaMA_7B_S3_R1_L30_res1
				LLaMA_7B_S3_R1_L30_res1 -> LLaMA_7B_S3_R1_L30_norm2
				LLaMA_7B_S3_R1_L30_norm2 -> LLaMA_7B_S3_R1_L30_ffn_up
				LLaMA_7B_S3_R1_L30_ffn_up -> LLaMA_7B_S3_R1_L30_ffn_gate
				LLaMA_7B_S3_R1_L30_ffn_gate -> LLaMA_7B_S3_R1_L30_ffn_down
				LLaMA_7B_S3_R1_L30_ffn_down -> LLaMA_7B_S3_R1_L30_ar2
				LLaMA_7B_S3_R1_L30_ar2 -> LLaMA_7B_S3_R1_L30_res2
			}
			subgraph cluster_LLaMA_7B_stage_3_rank_2 {
				fillcolor=lightgreen label="Rank 2\nGPU_6" style="rounded,filled"
				LLaMA_7B_S3_R2_L21_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L21_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L21_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L21_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L21_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L21_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L21_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L21_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L21_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L21_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L21_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L21_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L21_split -> LLaMA_7B_S3_R2_L21_norm1
				LLaMA_7B_S3_R2_L21_norm1 -> LLaMA_7B_S3_R2_L21_qkv
				LLaMA_7B_S3_R2_L21_qkv -> LLaMA_7B_S3_R2_L21_attn
				LLaMA_7B_S3_R2_L21_attn -> LLaMA_7B_S3_R2_L21_ar1
				LLaMA_7B_S3_R2_L21_ar1 -> LLaMA_7B_S3_R2_L21_res1
				LLaMA_7B_S3_R2_L21_res1 -> LLaMA_7B_S3_R2_L21_norm2
				LLaMA_7B_S3_R2_L21_norm2 -> LLaMA_7B_S3_R2_L21_ffn_up
				LLaMA_7B_S3_R2_L21_ffn_up -> LLaMA_7B_S3_R2_L21_ffn_gate
				LLaMA_7B_S3_R2_L21_ffn_gate -> LLaMA_7B_S3_R2_L21_ffn_down
				LLaMA_7B_S3_R2_L21_ffn_down -> LLaMA_7B_S3_R2_L21_ar2
				LLaMA_7B_S3_R2_L21_ar2 -> LLaMA_7B_S3_R2_L21_res2
				LLaMA_7B_S3_R2_L22_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L22_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L22_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L22_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L22_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L22_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L22_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L22_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L22_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L22_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L22_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L22_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L22_split -> LLaMA_7B_S3_R2_L22_norm1
				LLaMA_7B_S3_R2_L22_norm1 -> LLaMA_7B_S3_R2_L22_qkv
				LLaMA_7B_S3_R2_L22_qkv -> LLaMA_7B_S3_R2_L22_attn
				LLaMA_7B_S3_R2_L22_attn -> LLaMA_7B_S3_R2_L22_ar1
				LLaMA_7B_S3_R2_L22_ar1 -> LLaMA_7B_S3_R2_L22_res1
				LLaMA_7B_S3_R2_L22_res1 -> LLaMA_7B_S3_R2_L22_norm2
				LLaMA_7B_S3_R2_L22_norm2 -> LLaMA_7B_S3_R2_L22_ffn_up
				LLaMA_7B_S3_R2_L22_ffn_up -> LLaMA_7B_S3_R2_L22_ffn_gate
				LLaMA_7B_S3_R2_L22_ffn_gate -> LLaMA_7B_S3_R2_L22_ffn_down
				LLaMA_7B_S3_R2_L22_ffn_down -> LLaMA_7B_S3_R2_L22_ar2
				LLaMA_7B_S3_R2_L22_ar2 -> LLaMA_7B_S3_R2_L22_res2
				LLaMA_7B_S3_R2_L23_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L23_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L23_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L23_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L23_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L23_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L23_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L23_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L23_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L23_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L23_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L23_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L23_split -> LLaMA_7B_S3_R2_L23_norm1
				LLaMA_7B_S3_R2_L23_norm1 -> LLaMA_7B_S3_R2_L23_qkv
				LLaMA_7B_S3_R2_L23_qkv -> LLaMA_7B_S3_R2_L23_attn
				LLaMA_7B_S3_R2_L23_attn -> LLaMA_7B_S3_R2_L23_ar1
				LLaMA_7B_S3_R2_L23_ar1 -> LLaMA_7B_S3_R2_L23_res1
				LLaMA_7B_S3_R2_L23_res1 -> LLaMA_7B_S3_R2_L23_norm2
				LLaMA_7B_S3_R2_L23_norm2 -> LLaMA_7B_S3_R2_L23_ffn_up
				LLaMA_7B_S3_R2_L23_ffn_up -> LLaMA_7B_S3_R2_L23_ffn_gate
				LLaMA_7B_S3_R2_L23_ffn_gate -> LLaMA_7B_S3_R2_L23_ffn_down
				LLaMA_7B_S3_R2_L23_ffn_down -> LLaMA_7B_S3_R2_L23_ar2
				LLaMA_7B_S3_R2_L23_ar2 -> LLaMA_7B_S3_R2_L23_res2
				LLaMA_7B_S3_R2_L24_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L24_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L24_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L24_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L24_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L24_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L24_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L24_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L24_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L24_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L24_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L24_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L24_split -> LLaMA_7B_S3_R2_L24_norm1
				LLaMA_7B_S3_R2_L24_norm1 -> LLaMA_7B_S3_R2_L24_qkv
				LLaMA_7B_S3_R2_L24_qkv -> LLaMA_7B_S3_R2_L24_attn
				LLaMA_7B_S3_R2_L24_attn -> LLaMA_7B_S3_R2_L24_ar1
				LLaMA_7B_S3_R2_L24_ar1 -> LLaMA_7B_S3_R2_L24_res1
				LLaMA_7B_S3_R2_L24_res1 -> LLaMA_7B_S3_R2_L24_norm2
				LLaMA_7B_S3_R2_L24_norm2 -> LLaMA_7B_S3_R2_L24_ffn_up
				LLaMA_7B_S3_R2_L24_ffn_up -> LLaMA_7B_S3_R2_L24_ffn_gate
				LLaMA_7B_S3_R2_L24_ffn_gate -> LLaMA_7B_S3_R2_L24_ffn_down
				LLaMA_7B_S3_R2_L24_ffn_down -> LLaMA_7B_S3_R2_L24_ar2
				LLaMA_7B_S3_R2_L24_ar2 -> LLaMA_7B_S3_R2_L24_res2
				LLaMA_7B_S3_R2_L25_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L25_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L25_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L25_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L25_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L25_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L25_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L25_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L25_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L25_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L25_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L25_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L25_split -> LLaMA_7B_S3_R2_L25_norm1
				LLaMA_7B_S3_R2_L25_norm1 -> LLaMA_7B_S3_R2_L25_qkv
				LLaMA_7B_S3_R2_L25_qkv -> LLaMA_7B_S3_R2_L25_attn
				LLaMA_7B_S3_R2_L25_attn -> LLaMA_7B_S3_R2_L25_ar1
				LLaMA_7B_S3_R2_L25_ar1 -> LLaMA_7B_S3_R2_L25_res1
				LLaMA_7B_S3_R2_L25_res1 -> LLaMA_7B_S3_R2_L25_norm2
				LLaMA_7B_S3_R2_L25_norm2 -> LLaMA_7B_S3_R2_L25_ffn_up
				LLaMA_7B_S3_R2_L25_ffn_up -> LLaMA_7B_S3_R2_L25_ffn_gate
				LLaMA_7B_S3_R2_L25_ffn_gate -> LLaMA_7B_S3_R2_L25_ffn_down
				LLaMA_7B_S3_R2_L25_ffn_down -> LLaMA_7B_S3_R2_L25_ar2
				LLaMA_7B_S3_R2_L25_ar2 -> LLaMA_7B_S3_R2_L25_res2
				LLaMA_7B_S3_R2_L26_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L26_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L26_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L26_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L26_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L26_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L26_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L26_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L26_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L26_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L26_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L26_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L26_split -> LLaMA_7B_S3_R2_L26_norm1
				LLaMA_7B_S3_R2_L26_norm1 -> LLaMA_7B_S3_R2_L26_qkv
				LLaMA_7B_S3_R2_L26_qkv -> LLaMA_7B_S3_R2_L26_attn
				LLaMA_7B_S3_R2_L26_attn -> LLaMA_7B_S3_R2_L26_ar1
				LLaMA_7B_S3_R2_L26_ar1 -> LLaMA_7B_S3_R2_L26_res1
				LLaMA_7B_S3_R2_L26_res1 -> LLaMA_7B_S3_R2_L26_norm2
				LLaMA_7B_S3_R2_L26_norm2 -> LLaMA_7B_S3_R2_L26_ffn_up
				LLaMA_7B_S3_R2_L26_ffn_up -> LLaMA_7B_S3_R2_L26_ffn_gate
				LLaMA_7B_S3_R2_L26_ffn_gate -> LLaMA_7B_S3_R2_L26_ffn_down
				LLaMA_7B_S3_R2_L26_ffn_down -> LLaMA_7B_S3_R2_L26_ar2
				LLaMA_7B_S3_R2_L26_ar2 -> LLaMA_7B_S3_R2_L26_res2
				LLaMA_7B_S3_R2_L27_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L27_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L27_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L27_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L27_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L27_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L27_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L27_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L27_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L27_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L27_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L27_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L27_split -> LLaMA_7B_S3_R2_L27_norm1
				LLaMA_7B_S3_R2_L27_norm1 -> LLaMA_7B_S3_R2_L27_qkv
				LLaMA_7B_S3_R2_L27_qkv -> LLaMA_7B_S3_R2_L27_attn
				LLaMA_7B_S3_R2_L27_attn -> LLaMA_7B_S3_R2_L27_ar1
				LLaMA_7B_S3_R2_L27_ar1 -> LLaMA_7B_S3_R2_L27_res1
				LLaMA_7B_S3_R2_L27_res1 -> LLaMA_7B_S3_R2_L27_norm2
				LLaMA_7B_S3_R2_L27_norm2 -> LLaMA_7B_S3_R2_L27_ffn_up
				LLaMA_7B_S3_R2_L27_ffn_up -> LLaMA_7B_S3_R2_L27_ffn_gate
				LLaMA_7B_S3_R2_L27_ffn_gate -> LLaMA_7B_S3_R2_L27_ffn_down
				LLaMA_7B_S3_R2_L27_ffn_down -> LLaMA_7B_S3_R2_L27_ar2
				LLaMA_7B_S3_R2_L27_ar2 -> LLaMA_7B_S3_R2_L27_res2
				LLaMA_7B_S3_R2_L28_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L28_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L28_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L28_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L28_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L28_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L28_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L28_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L28_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L28_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L28_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L28_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L28_split -> LLaMA_7B_S3_R2_L28_norm1
				LLaMA_7B_S3_R2_L28_norm1 -> LLaMA_7B_S3_R2_L28_qkv
				LLaMA_7B_S3_R2_L28_qkv -> LLaMA_7B_S3_R2_L28_attn
				LLaMA_7B_S3_R2_L28_attn -> LLaMA_7B_S3_R2_L28_ar1
				LLaMA_7B_S3_R2_L28_ar1 -> LLaMA_7B_S3_R2_L28_res1
				LLaMA_7B_S3_R2_L28_res1 -> LLaMA_7B_S3_R2_L28_norm2
				LLaMA_7B_S3_R2_L28_norm2 -> LLaMA_7B_S3_R2_L28_ffn_up
				LLaMA_7B_S3_R2_L28_ffn_up -> LLaMA_7B_S3_R2_L28_ffn_gate
				LLaMA_7B_S3_R2_L28_ffn_gate -> LLaMA_7B_S3_R2_L28_ffn_down
				LLaMA_7B_S3_R2_L28_ffn_down -> LLaMA_7B_S3_R2_L28_ar2
				LLaMA_7B_S3_R2_L28_ar2 -> LLaMA_7B_S3_R2_L28_res2
				LLaMA_7B_S3_R2_L29_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L29_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L29_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L29_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L29_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L29_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L29_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L29_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L29_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L29_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L29_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L29_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L29_split -> LLaMA_7B_S3_R2_L29_norm1
				LLaMA_7B_S3_R2_L29_norm1 -> LLaMA_7B_S3_R2_L29_qkv
				LLaMA_7B_S3_R2_L29_qkv -> LLaMA_7B_S3_R2_L29_attn
				LLaMA_7B_S3_R2_L29_attn -> LLaMA_7B_S3_R2_L29_ar1
				LLaMA_7B_S3_R2_L29_ar1 -> LLaMA_7B_S3_R2_L29_res1
				LLaMA_7B_S3_R2_L29_res1 -> LLaMA_7B_S3_R2_L29_norm2
				LLaMA_7B_S3_R2_L29_norm2 -> LLaMA_7B_S3_R2_L29_ffn_up
				LLaMA_7B_S3_R2_L29_ffn_up -> LLaMA_7B_S3_R2_L29_ffn_gate
				LLaMA_7B_S3_R2_L29_ffn_gate -> LLaMA_7B_S3_R2_L29_ffn_down
				LLaMA_7B_S3_R2_L29_ffn_down -> LLaMA_7B_S3_R2_L29_ar2
				LLaMA_7B_S3_R2_L29_ar2 -> LLaMA_7B_S3_R2_L29_res2
				LLaMA_7B_S3_R2_L30_split [label="Input Split\n[batch=6, seq=2048, hidden=4096]→[hidden=2048]" fillcolor=orange shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L30_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L30_qkv [label="QKV Proj\n[hidden=2048]→[heads=16, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L30_attn [label="MHA\n[heads=16, dim=128]→[hidden=2048]" fillcolor=lightcoral shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L30_ar1 [label="All-Reduce\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L30_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L30_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				LLaMA_7B_S3_R2_L30_ffn_up [label="FFN Up\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L30_ffn_gate [label="FFN Gate\n[hidden=2048]→[ffn=5504]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L30_ffn_down [label="FFN Down\n[ffn=5504]→[hidden=2048]" fillcolor=lightcyan shape=rectangle style=filled]
				LLaMA_7B_S3_R2_L30_ar2 [label="All-Reduce 2\n[hidden=2048]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				LLaMA_7B_S3_R2_L30_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				LLaMA_7B_S3_R2_L30_split -> LLaMA_7B_S3_R2_L30_norm1
				LLaMA_7B_S3_R2_L30_norm1 -> LLaMA_7B_S3_R2_L30_qkv
				LLaMA_7B_S3_R2_L30_qkv -> LLaMA_7B_S3_R2_L30_attn
				LLaMA_7B_S3_R2_L30_attn -> LLaMA_7B_S3_R2_L30_ar1
				LLaMA_7B_S3_R2_L30_ar1 -> LLaMA_7B_S3_R2_L30_res1
				LLaMA_7B_S3_R2_L30_res1 -> LLaMA_7B_S3_R2_L30_norm2
				LLaMA_7B_S3_R2_L30_norm2 -> LLaMA_7B_S3_R2_L30_ffn_up
				LLaMA_7B_S3_R2_L30_ffn_up -> LLaMA_7B_S3_R2_L30_ffn_gate
				LLaMA_7B_S3_R2_L30_ffn_gate -> LLaMA_7B_S3_R2_L30_ffn_down
				LLaMA_7B_S3_R2_L30_ffn_down -> LLaMA_7B_S3_R2_L30_ar2
				LLaMA_7B_S3_R2_L30_ar2 -> LLaMA_7B_S3_R2_L30_res2
			}
		}
		LLaMA_7B_comm_1_2 [label="Pipeline Comm\nStage 1 → 2\n[batch=6, seq=2048, hidden=4096]" fillcolor=lightyellow shape=ellipse style="dashed,filled"]
		LLaMA_7B_S1_R1_L10_res2 -> LLaMA_7B_comm_1_2
		LLaMA_7B_comm_1_2 -> LLaMA_7B_S2_R1_L11_split
		LLaMA_7B_S1_R2_L10_res2 -> LLaMA_7B_comm_1_2
		LLaMA_7B_comm_1_2 -> LLaMA_7B_S2_R2_L11_split
		LLaMA_7B_comm_2_3 [label="Pipeline Comm\nStage 2 → 3\n[batch=6, seq=2048, hidden=4096]" fillcolor=lightyellow shape=ellipse style="dashed,filled"]
		LLaMA_7B_S2_R1_L20_res2 -> LLaMA_7B_comm_2_3
		LLaMA_7B_comm_2_3 -> LLaMA_7B_S3_R1_L21_split
		LLaMA_7B_S2_R2_L20_res2 -> LLaMA_7B_comm_2_3
		LLaMA_7B_comm_2_3 -> LLaMA_7B_S3_R2_L21_split
		LLaMA_7B_input [label="Input\n[batch=6, seq=2048, vocab=32000]" fillcolor=lightgreen shape=ellipse style=filled]
		LLaMA_7B_output [label="Output\n[batch=6, seq=2048, vocab=32000]" fillcolor=lightgreen shape=doubleoctagon style=filled]
		LLaMA_7B_input -> LLaMA_7B_S1_R1_L1_split
		LLaMA_7B_input -> LLaMA_7B_S1_R2_L1_split
		LLaMA_7B_S3_R1_L32_res2 -> LLaMA_7B_output
		LLaMA_7B_S3_R2_L32_res2 -> LLaMA_7B_output
	}
	subgraph cluster_GPT3_2B {
		fillcolor=lightyellow label="GPT3_2B Megatron-LM\nTensor×2 Pipeline×3" style="rounded,filled"
		subgraph cluster_GPT3_2B_stage_1 {
			fillcolor=lightblue label="Stage 1\nLayers 1-8" style="rounded,filled"
			subgraph cluster_GPT3_2B_stage_1_rank_1 {
				fillcolor=lightgreen label="Rank 1\nGPU_1" style="rounded,filled"
				GPT3_2B_S1_R1_L1_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L1_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R1_L1_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R1_L1_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R1_L1_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R1_L1_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L1_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R1_L1_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L1_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L1_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L1_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R1_L1_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L1_split -> GPT3_2B_S1_R1_L1_norm1
				GPT3_2B_S1_R1_L1_norm1 -> GPT3_2B_S1_R1_L1_qkv
				GPT3_2B_S1_R1_L1_qkv -> GPT3_2B_S1_R1_L1_attn
				GPT3_2B_S1_R1_L1_attn -> GPT3_2B_S1_R1_L1_ar1
				GPT3_2B_S1_R1_L1_ar1 -> GPT3_2B_S1_R1_L1_res1
				GPT3_2B_S1_R1_L1_res1 -> GPT3_2B_S1_R1_L1_norm2
				GPT3_2B_S1_R1_L1_norm2 -> GPT3_2B_S1_R1_L1_ffn_up
				GPT3_2B_S1_R1_L1_ffn_up -> GPT3_2B_S1_R1_L1_ffn_gate
				GPT3_2B_S1_R1_L1_ffn_gate -> GPT3_2B_S1_R1_L1_ffn_down
				GPT3_2B_S1_R1_L1_ffn_down -> GPT3_2B_S1_R1_L1_ar2
				GPT3_2B_S1_R1_L1_ar2 -> GPT3_2B_S1_R1_L1_res2
				GPT3_2B_S1_R1_L2_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L2_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R1_L2_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R1_L2_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R1_L2_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R1_L2_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L2_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R1_L2_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L2_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L2_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L2_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R1_L2_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L2_split -> GPT3_2B_S1_R1_L2_norm1
				GPT3_2B_S1_R1_L2_norm1 -> GPT3_2B_S1_R1_L2_qkv
				GPT3_2B_S1_R1_L2_qkv -> GPT3_2B_S1_R1_L2_attn
				GPT3_2B_S1_R1_L2_attn -> GPT3_2B_S1_R1_L2_ar1
				GPT3_2B_S1_R1_L2_ar1 -> GPT3_2B_S1_R1_L2_res1
				GPT3_2B_S1_R1_L2_res1 -> GPT3_2B_S1_R1_L2_norm2
				GPT3_2B_S1_R1_L2_norm2 -> GPT3_2B_S1_R1_L2_ffn_up
				GPT3_2B_S1_R1_L2_ffn_up -> GPT3_2B_S1_R1_L2_ffn_gate
				GPT3_2B_S1_R1_L2_ffn_gate -> GPT3_2B_S1_R1_L2_ffn_down
				GPT3_2B_S1_R1_L2_ffn_down -> GPT3_2B_S1_R1_L2_ar2
				GPT3_2B_S1_R1_L2_ar2 -> GPT3_2B_S1_R1_L2_res2
				GPT3_2B_S1_R1_L3_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L3_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R1_L3_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R1_L3_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R1_L3_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R1_L3_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L3_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R1_L3_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L3_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L3_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L3_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R1_L3_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L3_split -> GPT3_2B_S1_R1_L3_norm1
				GPT3_2B_S1_R1_L3_norm1 -> GPT3_2B_S1_R1_L3_qkv
				GPT3_2B_S1_R1_L3_qkv -> GPT3_2B_S1_R1_L3_attn
				GPT3_2B_S1_R1_L3_attn -> GPT3_2B_S1_R1_L3_ar1
				GPT3_2B_S1_R1_L3_ar1 -> GPT3_2B_S1_R1_L3_res1
				GPT3_2B_S1_R1_L3_res1 -> GPT3_2B_S1_R1_L3_norm2
				GPT3_2B_S1_R1_L3_norm2 -> GPT3_2B_S1_R1_L3_ffn_up
				GPT3_2B_S1_R1_L3_ffn_up -> GPT3_2B_S1_R1_L3_ffn_gate
				GPT3_2B_S1_R1_L3_ffn_gate -> GPT3_2B_S1_R1_L3_ffn_down
				GPT3_2B_S1_R1_L3_ffn_down -> GPT3_2B_S1_R1_L3_ar2
				GPT3_2B_S1_R1_L3_ar2 -> GPT3_2B_S1_R1_L3_res2
				GPT3_2B_S1_R1_L4_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L4_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R1_L4_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R1_L4_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R1_L4_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R1_L4_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L4_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R1_L4_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L4_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L4_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L4_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R1_L4_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L4_split -> GPT3_2B_S1_R1_L4_norm1
				GPT3_2B_S1_R1_L4_norm1 -> GPT3_2B_S1_R1_L4_qkv
				GPT3_2B_S1_R1_L4_qkv -> GPT3_2B_S1_R1_L4_attn
				GPT3_2B_S1_R1_L4_attn -> GPT3_2B_S1_R1_L4_ar1
				GPT3_2B_S1_R1_L4_ar1 -> GPT3_2B_S1_R1_L4_res1
				GPT3_2B_S1_R1_L4_res1 -> GPT3_2B_S1_R1_L4_norm2
				GPT3_2B_S1_R1_L4_norm2 -> GPT3_2B_S1_R1_L4_ffn_up
				GPT3_2B_S1_R1_L4_ffn_up -> GPT3_2B_S1_R1_L4_ffn_gate
				GPT3_2B_S1_R1_L4_ffn_gate -> GPT3_2B_S1_R1_L4_ffn_down
				GPT3_2B_S1_R1_L4_ffn_down -> GPT3_2B_S1_R1_L4_ar2
				GPT3_2B_S1_R1_L4_ar2 -> GPT3_2B_S1_R1_L4_res2
				GPT3_2B_S1_R1_L5_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L5_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R1_L5_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R1_L5_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R1_L5_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R1_L5_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L5_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R1_L5_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L5_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L5_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L5_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R1_L5_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L5_split -> GPT3_2B_S1_R1_L5_norm1
				GPT3_2B_S1_R1_L5_norm1 -> GPT3_2B_S1_R1_L5_qkv
				GPT3_2B_S1_R1_L5_qkv -> GPT3_2B_S1_R1_L5_attn
				GPT3_2B_S1_R1_L5_attn -> GPT3_2B_S1_R1_L5_ar1
				GPT3_2B_S1_R1_L5_ar1 -> GPT3_2B_S1_R1_L5_res1
				GPT3_2B_S1_R1_L5_res1 -> GPT3_2B_S1_R1_L5_norm2
				GPT3_2B_S1_R1_L5_norm2 -> GPT3_2B_S1_R1_L5_ffn_up
				GPT3_2B_S1_R1_L5_ffn_up -> GPT3_2B_S1_R1_L5_ffn_gate
				GPT3_2B_S1_R1_L5_ffn_gate -> GPT3_2B_S1_R1_L5_ffn_down
				GPT3_2B_S1_R1_L5_ffn_down -> GPT3_2B_S1_R1_L5_ar2
				GPT3_2B_S1_R1_L5_ar2 -> GPT3_2B_S1_R1_L5_res2
				GPT3_2B_S1_R1_L6_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L6_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R1_L6_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R1_L6_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R1_L6_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R1_L6_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L6_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R1_L6_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L6_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L6_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L6_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R1_L6_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L6_split -> GPT3_2B_S1_R1_L6_norm1
				GPT3_2B_S1_R1_L6_norm1 -> GPT3_2B_S1_R1_L6_qkv
				GPT3_2B_S1_R1_L6_qkv -> GPT3_2B_S1_R1_L6_attn
				GPT3_2B_S1_R1_L6_attn -> GPT3_2B_S1_R1_L6_ar1
				GPT3_2B_S1_R1_L6_ar1 -> GPT3_2B_S1_R1_L6_res1
				GPT3_2B_S1_R1_L6_res1 -> GPT3_2B_S1_R1_L6_norm2
				GPT3_2B_S1_R1_L6_norm2 -> GPT3_2B_S1_R1_L6_ffn_up
				GPT3_2B_S1_R1_L6_ffn_up -> GPT3_2B_S1_R1_L6_ffn_gate
				GPT3_2B_S1_R1_L6_ffn_gate -> GPT3_2B_S1_R1_L6_ffn_down
				GPT3_2B_S1_R1_L6_ffn_down -> GPT3_2B_S1_R1_L6_ar2
				GPT3_2B_S1_R1_L6_ar2 -> GPT3_2B_S1_R1_L6_res2
				GPT3_2B_S1_R1_L7_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L7_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R1_L7_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R1_L7_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R1_L7_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R1_L7_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L7_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R1_L7_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L7_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L7_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L7_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R1_L7_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L7_split -> GPT3_2B_S1_R1_L7_norm1
				GPT3_2B_S1_R1_L7_norm1 -> GPT3_2B_S1_R1_L7_qkv
				GPT3_2B_S1_R1_L7_qkv -> GPT3_2B_S1_R1_L7_attn
				GPT3_2B_S1_R1_L7_attn -> GPT3_2B_S1_R1_L7_ar1
				GPT3_2B_S1_R1_L7_ar1 -> GPT3_2B_S1_R1_L7_res1
				GPT3_2B_S1_R1_L7_res1 -> GPT3_2B_S1_R1_L7_norm2
				GPT3_2B_S1_R1_L7_norm2 -> GPT3_2B_S1_R1_L7_ffn_up
				GPT3_2B_S1_R1_L7_ffn_up -> GPT3_2B_S1_R1_L7_ffn_gate
				GPT3_2B_S1_R1_L7_ffn_gate -> GPT3_2B_S1_R1_L7_ffn_down
				GPT3_2B_S1_R1_L7_ffn_down -> GPT3_2B_S1_R1_L7_ar2
				GPT3_2B_S1_R1_L7_ar2 -> GPT3_2B_S1_R1_L7_res2
				GPT3_2B_S1_R1_L8_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L8_norm1 [label="LayerNorm\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R1_L8_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R1_L8_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R1_L8_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R1_L8_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L8_norm2 [label="LayerNorm 2\nDevice: GPU_1" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R1_L8_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L8_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L8_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R1_L8_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R1_L8_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R1_L8_split -> GPT3_2B_S1_R1_L8_norm1
				GPT3_2B_S1_R1_L8_norm1 -> GPT3_2B_S1_R1_L8_qkv
				GPT3_2B_S1_R1_L8_qkv -> GPT3_2B_S1_R1_L8_attn
				GPT3_2B_S1_R1_L8_attn -> GPT3_2B_S1_R1_L8_ar1
				GPT3_2B_S1_R1_L8_ar1 -> GPT3_2B_S1_R1_L8_res1
				GPT3_2B_S1_R1_L8_res1 -> GPT3_2B_S1_R1_L8_norm2
				GPT3_2B_S1_R1_L8_norm2 -> GPT3_2B_S1_R1_L8_ffn_up
				GPT3_2B_S1_R1_L8_ffn_up -> GPT3_2B_S1_R1_L8_ffn_gate
				GPT3_2B_S1_R1_L8_ffn_gate -> GPT3_2B_S1_R1_L8_ffn_down
				GPT3_2B_S1_R1_L8_ffn_down -> GPT3_2B_S1_R1_L8_ar2
				GPT3_2B_S1_R1_L8_ar2 -> GPT3_2B_S1_R1_L8_res2
			}
			subgraph cluster_GPT3_2B_stage_1_rank_2 {
				fillcolor=lightgreen label="Rank 2\nGPU_2" style="rounded,filled"
				GPT3_2B_S1_R2_L1_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L1_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R2_L1_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R2_L1_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R2_L1_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R2_L1_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L1_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R2_L1_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L1_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L1_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L1_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R2_L1_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L1_split -> GPT3_2B_S1_R2_L1_norm1
				GPT3_2B_S1_R2_L1_norm1 -> GPT3_2B_S1_R2_L1_qkv
				GPT3_2B_S1_R2_L1_qkv -> GPT3_2B_S1_R2_L1_attn
				GPT3_2B_S1_R2_L1_attn -> GPT3_2B_S1_R2_L1_ar1
				GPT3_2B_S1_R2_L1_ar1 -> GPT3_2B_S1_R2_L1_res1
				GPT3_2B_S1_R2_L1_res1 -> GPT3_2B_S1_R2_L1_norm2
				GPT3_2B_S1_R2_L1_norm2 -> GPT3_2B_S1_R2_L1_ffn_up
				GPT3_2B_S1_R2_L1_ffn_up -> GPT3_2B_S1_R2_L1_ffn_gate
				GPT3_2B_S1_R2_L1_ffn_gate -> GPT3_2B_S1_R2_L1_ffn_down
				GPT3_2B_S1_R2_L1_ffn_down -> GPT3_2B_S1_R2_L1_ar2
				GPT3_2B_S1_R2_L1_ar2 -> GPT3_2B_S1_R2_L1_res2
				GPT3_2B_S1_R2_L2_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L2_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R2_L2_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R2_L2_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R2_L2_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R2_L2_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L2_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R2_L2_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L2_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L2_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L2_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R2_L2_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L2_split -> GPT3_2B_S1_R2_L2_norm1
				GPT3_2B_S1_R2_L2_norm1 -> GPT3_2B_S1_R2_L2_qkv
				GPT3_2B_S1_R2_L2_qkv -> GPT3_2B_S1_R2_L2_attn
				GPT3_2B_S1_R2_L2_attn -> GPT3_2B_S1_R2_L2_ar1
				GPT3_2B_S1_R2_L2_ar1 -> GPT3_2B_S1_R2_L2_res1
				GPT3_2B_S1_R2_L2_res1 -> GPT3_2B_S1_R2_L2_norm2
				GPT3_2B_S1_R2_L2_norm2 -> GPT3_2B_S1_R2_L2_ffn_up
				GPT3_2B_S1_R2_L2_ffn_up -> GPT3_2B_S1_R2_L2_ffn_gate
				GPT3_2B_S1_R2_L2_ffn_gate -> GPT3_2B_S1_R2_L2_ffn_down
				GPT3_2B_S1_R2_L2_ffn_down -> GPT3_2B_S1_R2_L2_ar2
				GPT3_2B_S1_R2_L2_ar2 -> GPT3_2B_S1_R2_L2_res2
				GPT3_2B_S1_R2_L3_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L3_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R2_L3_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R2_L3_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R2_L3_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R2_L3_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L3_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R2_L3_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L3_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L3_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L3_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R2_L3_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L3_split -> GPT3_2B_S1_R2_L3_norm1
				GPT3_2B_S1_R2_L3_norm1 -> GPT3_2B_S1_R2_L3_qkv
				GPT3_2B_S1_R2_L3_qkv -> GPT3_2B_S1_R2_L3_attn
				GPT3_2B_S1_R2_L3_attn -> GPT3_2B_S1_R2_L3_ar1
				GPT3_2B_S1_R2_L3_ar1 -> GPT3_2B_S1_R2_L3_res1
				GPT3_2B_S1_R2_L3_res1 -> GPT3_2B_S1_R2_L3_norm2
				GPT3_2B_S1_R2_L3_norm2 -> GPT3_2B_S1_R2_L3_ffn_up
				GPT3_2B_S1_R2_L3_ffn_up -> GPT3_2B_S1_R2_L3_ffn_gate
				GPT3_2B_S1_R2_L3_ffn_gate -> GPT3_2B_S1_R2_L3_ffn_down
				GPT3_2B_S1_R2_L3_ffn_down -> GPT3_2B_S1_R2_L3_ar2
				GPT3_2B_S1_R2_L3_ar2 -> GPT3_2B_S1_R2_L3_res2
				GPT3_2B_S1_R2_L4_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L4_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R2_L4_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R2_L4_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R2_L4_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R2_L4_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L4_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R2_L4_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L4_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L4_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L4_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R2_L4_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L4_split -> GPT3_2B_S1_R2_L4_norm1
				GPT3_2B_S1_R2_L4_norm1 -> GPT3_2B_S1_R2_L4_qkv
				GPT3_2B_S1_R2_L4_qkv -> GPT3_2B_S1_R2_L4_attn
				GPT3_2B_S1_R2_L4_attn -> GPT3_2B_S1_R2_L4_ar1
				GPT3_2B_S1_R2_L4_ar1 -> GPT3_2B_S1_R2_L4_res1
				GPT3_2B_S1_R2_L4_res1 -> GPT3_2B_S1_R2_L4_norm2
				GPT3_2B_S1_R2_L4_norm2 -> GPT3_2B_S1_R2_L4_ffn_up
				GPT3_2B_S1_R2_L4_ffn_up -> GPT3_2B_S1_R2_L4_ffn_gate
				GPT3_2B_S1_R2_L4_ffn_gate -> GPT3_2B_S1_R2_L4_ffn_down
				GPT3_2B_S1_R2_L4_ffn_down -> GPT3_2B_S1_R2_L4_ar2
				GPT3_2B_S1_R2_L4_ar2 -> GPT3_2B_S1_R2_L4_res2
				GPT3_2B_S1_R2_L5_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L5_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R2_L5_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R2_L5_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R2_L5_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R2_L5_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L5_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R2_L5_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L5_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L5_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L5_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R2_L5_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L5_split -> GPT3_2B_S1_R2_L5_norm1
				GPT3_2B_S1_R2_L5_norm1 -> GPT3_2B_S1_R2_L5_qkv
				GPT3_2B_S1_R2_L5_qkv -> GPT3_2B_S1_R2_L5_attn
				GPT3_2B_S1_R2_L5_attn -> GPT3_2B_S1_R2_L5_ar1
				GPT3_2B_S1_R2_L5_ar1 -> GPT3_2B_S1_R2_L5_res1
				GPT3_2B_S1_R2_L5_res1 -> GPT3_2B_S1_R2_L5_norm2
				GPT3_2B_S1_R2_L5_norm2 -> GPT3_2B_S1_R2_L5_ffn_up
				GPT3_2B_S1_R2_L5_ffn_up -> GPT3_2B_S1_R2_L5_ffn_gate
				GPT3_2B_S1_R2_L5_ffn_gate -> GPT3_2B_S1_R2_L5_ffn_down
				GPT3_2B_S1_R2_L5_ffn_down -> GPT3_2B_S1_R2_L5_ar2
				GPT3_2B_S1_R2_L5_ar2 -> GPT3_2B_S1_R2_L5_res2
				GPT3_2B_S1_R2_L6_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L6_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R2_L6_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R2_L6_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R2_L6_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R2_L6_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L6_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R2_L6_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L6_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L6_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L6_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R2_L6_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L6_split -> GPT3_2B_S1_R2_L6_norm1
				GPT3_2B_S1_R2_L6_norm1 -> GPT3_2B_S1_R2_L6_qkv
				GPT3_2B_S1_R2_L6_qkv -> GPT3_2B_S1_R2_L6_attn
				GPT3_2B_S1_R2_L6_attn -> GPT3_2B_S1_R2_L6_ar1
				GPT3_2B_S1_R2_L6_ar1 -> GPT3_2B_S1_R2_L6_res1
				GPT3_2B_S1_R2_L6_res1 -> GPT3_2B_S1_R2_L6_norm2
				GPT3_2B_S1_R2_L6_norm2 -> GPT3_2B_S1_R2_L6_ffn_up
				GPT3_2B_S1_R2_L6_ffn_up -> GPT3_2B_S1_R2_L6_ffn_gate
				GPT3_2B_S1_R2_L6_ffn_gate -> GPT3_2B_S1_R2_L6_ffn_down
				GPT3_2B_S1_R2_L6_ffn_down -> GPT3_2B_S1_R2_L6_ar2
				GPT3_2B_S1_R2_L6_ar2 -> GPT3_2B_S1_R2_L6_res2
				GPT3_2B_S1_R2_L7_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L7_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R2_L7_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R2_L7_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R2_L7_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R2_L7_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L7_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R2_L7_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L7_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L7_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L7_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R2_L7_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L7_split -> GPT3_2B_S1_R2_L7_norm1
				GPT3_2B_S1_R2_L7_norm1 -> GPT3_2B_S1_R2_L7_qkv
				GPT3_2B_S1_R2_L7_qkv -> GPT3_2B_S1_R2_L7_attn
				GPT3_2B_S1_R2_L7_attn -> GPT3_2B_S1_R2_L7_ar1
				GPT3_2B_S1_R2_L7_ar1 -> GPT3_2B_S1_R2_L7_res1
				GPT3_2B_S1_R2_L7_res1 -> GPT3_2B_S1_R2_L7_norm2
				GPT3_2B_S1_R2_L7_norm2 -> GPT3_2B_S1_R2_L7_ffn_up
				GPT3_2B_S1_R2_L7_ffn_up -> GPT3_2B_S1_R2_L7_ffn_gate
				GPT3_2B_S1_R2_L7_ffn_gate -> GPT3_2B_S1_R2_L7_ffn_down
				GPT3_2B_S1_R2_L7_ffn_down -> GPT3_2B_S1_R2_L7_ar2
				GPT3_2B_S1_R2_L7_ar2 -> GPT3_2B_S1_R2_L7_res2
				GPT3_2B_S1_R2_L8_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L8_norm1 [label="LayerNorm\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R2_L8_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R2_L8_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S1_R2_L8_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R2_L8_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L8_norm2 [label="LayerNorm 2\nDevice: GPU_2" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S1_R2_L8_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L8_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L8_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S1_R2_L8_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S1_R2_L8_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S1_R2_L8_split -> GPT3_2B_S1_R2_L8_norm1
				GPT3_2B_S1_R2_L8_norm1 -> GPT3_2B_S1_R2_L8_qkv
				GPT3_2B_S1_R2_L8_qkv -> GPT3_2B_S1_R2_L8_attn
				GPT3_2B_S1_R2_L8_attn -> GPT3_2B_S1_R2_L8_ar1
				GPT3_2B_S1_R2_L8_ar1 -> GPT3_2B_S1_R2_L8_res1
				GPT3_2B_S1_R2_L8_res1 -> GPT3_2B_S1_R2_L8_norm2
				GPT3_2B_S1_R2_L8_norm2 -> GPT3_2B_S1_R2_L8_ffn_up
				GPT3_2B_S1_R2_L8_ffn_up -> GPT3_2B_S1_R2_L8_ffn_gate
				GPT3_2B_S1_R2_L8_ffn_gate -> GPT3_2B_S1_R2_L8_ffn_down
				GPT3_2B_S1_R2_L8_ffn_down -> GPT3_2B_S1_R2_L8_ar2
				GPT3_2B_S1_R2_L8_ar2 -> GPT3_2B_S1_R2_L8_res2
			}
		}
		subgraph cluster_GPT3_2B_stage_2 {
			fillcolor=lightblue label="Stage 2\nLayers 9-16" style="rounded,filled"
			subgraph cluster_GPT3_2B_stage_2_rank_1 {
				fillcolor=lightgreen label="Rank 1\nGPU_3" style="rounded,filled"
				GPT3_2B_S2_R1_L9_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L9_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R1_L9_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R1_L9_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R1_L9_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R1_L9_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L9_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R1_L9_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L9_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L9_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L9_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R1_L9_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L9_split -> GPT3_2B_S2_R1_L9_norm1
				GPT3_2B_S2_R1_L9_norm1 -> GPT3_2B_S2_R1_L9_qkv
				GPT3_2B_S2_R1_L9_qkv -> GPT3_2B_S2_R1_L9_attn
				GPT3_2B_S2_R1_L9_attn -> GPT3_2B_S2_R1_L9_ar1
				GPT3_2B_S2_R1_L9_ar1 -> GPT3_2B_S2_R1_L9_res1
				GPT3_2B_S2_R1_L9_res1 -> GPT3_2B_S2_R1_L9_norm2
				GPT3_2B_S2_R1_L9_norm2 -> GPT3_2B_S2_R1_L9_ffn_up
				GPT3_2B_S2_R1_L9_ffn_up -> GPT3_2B_S2_R1_L9_ffn_gate
				GPT3_2B_S2_R1_L9_ffn_gate -> GPT3_2B_S2_R1_L9_ffn_down
				GPT3_2B_S2_R1_L9_ffn_down -> GPT3_2B_S2_R1_L9_ar2
				GPT3_2B_S2_R1_L9_ar2 -> GPT3_2B_S2_R1_L9_res2
				GPT3_2B_S2_R1_L10_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L10_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R1_L10_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R1_L10_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R1_L10_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R1_L10_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L10_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R1_L10_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L10_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L10_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L10_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R1_L10_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L10_split -> GPT3_2B_S2_R1_L10_norm1
				GPT3_2B_S2_R1_L10_norm1 -> GPT3_2B_S2_R1_L10_qkv
				GPT3_2B_S2_R1_L10_qkv -> GPT3_2B_S2_R1_L10_attn
				GPT3_2B_S2_R1_L10_attn -> GPT3_2B_S2_R1_L10_ar1
				GPT3_2B_S2_R1_L10_ar1 -> GPT3_2B_S2_R1_L10_res1
				GPT3_2B_S2_R1_L10_res1 -> GPT3_2B_S2_R1_L10_norm2
				GPT3_2B_S2_R1_L10_norm2 -> GPT3_2B_S2_R1_L10_ffn_up
				GPT3_2B_S2_R1_L10_ffn_up -> GPT3_2B_S2_R1_L10_ffn_gate
				GPT3_2B_S2_R1_L10_ffn_gate -> GPT3_2B_S2_R1_L10_ffn_down
				GPT3_2B_S2_R1_L10_ffn_down -> GPT3_2B_S2_R1_L10_ar2
				GPT3_2B_S2_R1_L10_ar2 -> GPT3_2B_S2_R1_L10_res2
				GPT3_2B_S2_R1_L11_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L11_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R1_L11_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R1_L11_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R1_L11_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R1_L11_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L11_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R1_L11_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L11_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L11_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L11_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R1_L11_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L11_split -> GPT3_2B_S2_R1_L11_norm1
				GPT3_2B_S2_R1_L11_norm1 -> GPT3_2B_S2_R1_L11_qkv
				GPT3_2B_S2_R1_L11_qkv -> GPT3_2B_S2_R1_L11_attn
				GPT3_2B_S2_R1_L11_attn -> GPT3_2B_S2_R1_L11_ar1
				GPT3_2B_S2_R1_L11_ar1 -> GPT3_2B_S2_R1_L11_res1
				GPT3_2B_S2_R1_L11_res1 -> GPT3_2B_S2_R1_L11_norm2
				GPT3_2B_S2_R1_L11_norm2 -> GPT3_2B_S2_R1_L11_ffn_up
				GPT3_2B_S2_R1_L11_ffn_up -> GPT3_2B_S2_R1_L11_ffn_gate
				GPT3_2B_S2_R1_L11_ffn_gate -> GPT3_2B_S2_R1_L11_ffn_down
				GPT3_2B_S2_R1_L11_ffn_down -> GPT3_2B_S2_R1_L11_ar2
				GPT3_2B_S2_R1_L11_ar2 -> GPT3_2B_S2_R1_L11_res2
				GPT3_2B_S2_R1_L12_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L12_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R1_L12_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R1_L12_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R1_L12_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R1_L12_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L12_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R1_L12_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L12_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L12_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L12_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R1_L12_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L12_split -> GPT3_2B_S2_R1_L12_norm1
				GPT3_2B_S2_R1_L12_norm1 -> GPT3_2B_S2_R1_L12_qkv
				GPT3_2B_S2_R1_L12_qkv -> GPT3_2B_S2_R1_L12_attn
				GPT3_2B_S2_R1_L12_attn -> GPT3_2B_S2_R1_L12_ar1
				GPT3_2B_S2_R1_L12_ar1 -> GPT3_2B_S2_R1_L12_res1
				GPT3_2B_S2_R1_L12_res1 -> GPT3_2B_S2_R1_L12_norm2
				GPT3_2B_S2_R1_L12_norm2 -> GPT3_2B_S2_R1_L12_ffn_up
				GPT3_2B_S2_R1_L12_ffn_up -> GPT3_2B_S2_R1_L12_ffn_gate
				GPT3_2B_S2_R1_L12_ffn_gate -> GPT3_2B_S2_R1_L12_ffn_down
				GPT3_2B_S2_R1_L12_ffn_down -> GPT3_2B_S2_R1_L12_ar2
				GPT3_2B_S2_R1_L12_ar2 -> GPT3_2B_S2_R1_L12_res2
				GPT3_2B_S2_R1_L13_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L13_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R1_L13_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R1_L13_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R1_L13_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R1_L13_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L13_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R1_L13_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L13_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L13_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L13_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R1_L13_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L13_split -> GPT3_2B_S2_R1_L13_norm1
				GPT3_2B_S2_R1_L13_norm1 -> GPT3_2B_S2_R1_L13_qkv
				GPT3_2B_S2_R1_L13_qkv -> GPT3_2B_S2_R1_L13_attn
				GPT3_2B_S2_R1_L13_attn -> GPT3_2B_S2_R1_L13_ar1
				GPT3_2B_S2_R1_L13_ar1 -> GPT3_2B_S2_R1_L13_res1
				GPT3_2B_S2_R1_L13_res1 -> GPT3_2B_S2_R1_L13_norm2
				GPT3_2B_S2_R1_L13_norm2 -> GPT3_2B_S2_R1_L13_ffn_up
				GPT3_2B_S2_R1_L13_ffn_up -> GPT3_2B_S2_R1_L13_ffn_gate
				GPT3_2B_S2_R1_L13_ffn_gate -> GPT3_2B_S2_R1_L13_ffn_down
				GPT3_2B_S2_R1_L13_ffn_down -> GPT3_2B_S2_R1_L13_ar2
				GPT3_2B_S2_R1_L13_ar2 -> GPT3_2B_S2_R1_L13_res2
				GPT3_2B_S2_R1_L14_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L14_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R1_L14_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R1_L14_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R1_L14_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R1_L14_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L14_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R1_L14_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L14_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L14_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L14_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R1_L14_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L14_split -> GPT3_2B_S2_R1_L14_norm1
				GPT3_2B_S2_R1_L14_norm1 -> GPT3_2B_S2_R1_L14_qkv
				GPT3_2B_S2_R1_L14_qkv -> GPT3_2B_S2_R1_L14_attn
				GPT3_2B_S2_R1_L14_attn -> GPT3_2B_S2_R1_L14_ar1
				GPT3_2B_S2_R1_L14_ar1 -> GPT3_2B_S2_R1_L14_res1
				GPT3_2B_S2_R1_L14_res1 -> GPT3_2B_S2_R1_L14_norm2
				GPT3_2B_S2_R1_L14_norm2 -> GPT3_2B_S2_R1_L14_ffn_up
				GPT3_2B_S2_R1_L14_ffn_up -> GPT3_2B_S2_R1_L14_ffn_gate
				GPT3_2B_S2_R1_L14_ffn_gate -> GPT3_2B_S2_R1_L14_ffn_down
				GPT3_2B_S2_R1_L14_ffn_down -> GPT3_2B_S2_R1_L14_ar2
				GPT3_2B_S2_R1_L14_ar2 -> GPT3_2B_S2_R1_L14_res2
				GPT3_2B_S2_R1_L15_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L15_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R1_L15_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R1_L15_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R1_L15_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R1_L15_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L15_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R1_L15_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L15_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L15_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L15_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R1_L15_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L15_split -> GPT3_2B_S2_R1_L15_norm1
				GPT3_2B_S2_R1_L15_norm1 -> GPT3_2B_S2_R1_L15_qkv
				GPT3_2B_S2_R1_L15_qkv -> GPT3_2B_S2_R1_L15_attn
				GPT3_2B_S2_R1_L15_attn -> GPT3_2B_S2_R1_L15_ar1
				GPT3_2B_S2_R1_L15_ar1 -> GPT3_2B_S2_R1_L15_res1
				GPT3_2B_S2_R1_L15_res1 -> GPT3_2B_S2_R1_L15_norm2
				GPT3_2B_S2_R1_L15_norm2 -> GPT3_2B_S2_R1_L15_ffn_up
				GPT3_2B_S2_R1_L15_ffn_up -> GPT3_2B_S2_R1_L15_ffn_gate
				GPT3_2B_S2_R1_L15_ffn_gate -> GPT3_2B_S2_R1_L15_ffn_down
				GPT3_2B_S2_R1_L15_ffn_down -> GPT3_2B_S2_R1_L15_ar2
				GPT3_2B_S2_R1_L15_ar2 -> GPT3_2B_S2_R1_L15_res2
				GPT3_2B_S2_R1_L16_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L16_norm1 [label="LayerNorm\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R1_L16_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R1_L16_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R1_L16_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R1_L16_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L16_norm2 [label="LayerNorm 2\nDevice: GPU_3" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R1_L16_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L16_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L16_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R1_L16_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R1_L16_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R1_L16_split -> GPT3_2B_S2_R1_L16_norm1
				GPT3_2B_S2_R1_L16_norm1 -> GPT3_2B_S2_R1_L16_qkv
				GPT3_2B_S2_R1_L16_qkv -> GPT3_2B_S2_R1_L16_attn
				GPT3_2B_S2_R1_L16_attn -> GPT3_2B_S2_R1_L16_ar1
				GPT3_2B_S2_R1_L16_ar1 -> GPT3_2B_S2_R1_L16_res1
				GPT3_2B_S2_R1_L16_res1 -> GPT3_2B_S2_R1_L16_norm2
				GPT3_2B_S2_R1_L16_norm2 -> GPT3_2B_S2_R1_L16_ffn_up
				GPT3_2B_S2_R1_L16_ffn_up -> GPT3_2B_S2_R1_L16_ffn_gate
				GPT3_2B_S2_R1_L16_ffn_gate -> GPT3_2B_S2_R1_L16_ffn_down
				GPT3_2B_S2_R1_L16_ffn_down -> GPT3_2B_S2_R1_L16_ar2
				GPT3_2B_S2_R1_L16_ar2 -> GPT3_2B_S2_R1_L16_res2
			}
			subgraph cluster_GPT3_2B_stage_2_rank_2 {
				fillcolor=lightgreen label="Rank 2\nGPU_4" style="rounded,filled"
				GPT3_2B_S2_R2_L9_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L9_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R2_L9_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R2_L9_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R2_L9_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R2_L9_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L9_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R2_L9_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L9_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L9_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L9_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R2_L9_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L9_split -> GPT3_2B_S2_R2_L9_norm1
				GPT3_2B_S2_R2_L9_norm1 -> GPT3_2B_S2_R2_L9_qkv
				GPT3_2B_S2_R2_L9_qkv -> GPT3_2B_S2_R2_L9_attn
				GPT3_2B_S2_R2_L9_attn -> GPT3_2B_S2_R2_L9_ar1
				GPT3_2B_S2_R2_L9_ar1 -> GPT3_2B_S2_R2_L9_res1
				GPT3_2B_S2_R2_L9_res1 -> GPT3_2B_S2_R2_L9_norm2
				GPT3_2B_S2_R2_L9_norm2 -> GPT3_2B_S2_R2_L9_ffn_up
				GPT3_2B_S2_R2_L9_ffn_up -> GPT3_2B_S2_R2_L9_ffn_gate
				GPT3_2B_S2_R2_L9_ffn_gate -> GPT3_2B_S2_R2_L9_ffn_down
				GPT3_2B_S2_R2_L9_ffn_down -> GPT3_2B_S2_R2_L9_ar2
				GPT3_2B_S2_R2_L9_ar2 -> GPT3_2B_S2_R2_L9_res2
				GPT3_2B_S2_R2_L10_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L10_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R2_L10_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R2_L10_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R2_L10_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R2_L10_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L10_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R2_L10_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L10_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L10_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L10_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R2_L10_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L10_split -> GPT3_2B_S2_R2_L10_norm1
				GPT3_2B_S2_R2_L10_norm1 -> GPT3_2B_S2_R2_L10_qkv
				GPT3_2B_S2_R2_L10_qkv -> GPT3_2B_S2_R2_L10_attn
				GPT3_2B_S2_R2_L10_attn -> GPT3_2B_S2_R2_L10_ar1
				GPT3_2B_S2_R2_L10_ar1 -> GPT3_2B_S2_R2_L10_res1
				GPT3_2B_S2_R2_L10_res1 -> GPT3_2B_S2_R2_L10_norm2
				GPT3_2B_S2_R2_L10_norm2 -> GPT3_2B_S2_R2_L10_ffn_up
				GPT3_2B_S2_R2_L10_ffn_up -> GPT3_2B_S2_R2_L10_ffn_gate
				GPT3_2B_S2_R2_L10_ffn_gate -> GPT3_2B_S2_R2_L10_ffn_down
				GPT3_2B_S2_R2_L10_ffn_down -> GPT3_2B_S2_R2_L10_ar2
				GPT3_2B_S2_R2_L10_ar2 -> GPT3_2B_S2_R2_L10_res2
				GPT3_2B_S2_R2_L11_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L11_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R2_L11_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R2_L11_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R2_L11_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R2_L11_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L11_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R2_L11_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L11_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L11_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L11_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R2_L11_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L11_split -> GPT3_2B_S2_R2_L11_norm1
				GPT3_2B_S2_R2_L11_norm1 -> GPT3_2B_S2_R2_L11_qkv
				GPT3_2B_S2_R2_L11_qkv -> GPT3_2B_S2_R2_L11_attn
				GPT3_2B_S2_R2_L11_attn -> GPT3_2B_S2_R2_L11_ar1
				GPT3_2B_S2_R2_L11_ar1 -> GPT3_2B_S2_R2_L11_res1
				GPT3_2B_S2_R2_L11_res1 -> GPT3_2B_S2_R2_L11_norm2
				GPT3_2B_S2_R2_L11_norm2 -> GPT3_2B_S2_R2_L11_ffn_up
				GPT3_2B_S2_R2_L11_ffn_up -> GPT3_2B_S2_R2_L11_ffn_gate
				GPT3_2B_S2_R2_L11_ffn_gate -> GPT3_2B_S2_R2_L11_ffn_down
				GPT3_2B_S2_R2_L11_ffn_down -> GPT3_2B_S2_R2_L11_ar2
				GPT3_2B_S2_R2_L11_ar2 -> GPT3_2B_S2_R2_L11_res2
				GPT3_2B_S2_R2_L12_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L12_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R2_L12_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R2_L12_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R2_L12_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R2_L12_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L12_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R2_L12_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L12_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L12_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L12_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R2_L12_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L12_split -> GPT3_2B_S2_R2_L12_norm1
				GPT3_2B_S2_R2_L12_norm1 -> GPT3_2B_S2_R2_L12_qkv
				GPT3_2B_S2_R2_L12_qkv -> GPT3_2B_S2_R2_L12_attn
				GPT3_2B_S2_R2_L12_attn -> GPT3_2B_S2_R2_L12_ar1
				GPT3_2B_S2_R2_L12_ar1 -> GPT3_2B_S2_R2_L12_res1
				GPT3_2B_S2_R2_L12_res1 -> GPT3_2B_S2_R2_L12_norm2
				GPT3_2B_S2_R2_L12_norm2 -> GPT3_2B_S2_R2_L12_ffn_up
				GPT3_2B_S2_R2_L12_ffn_up -> GPT3_2B_S2_R2_L12_ffn_gate
				GPT3_2B_S2_R2_L12_ffn_gate -> GPT3_2B_S2_R2_L12_ffn_down
				GPT3_2B_S2_R2_L12_ffn_down -> GPT3_2B_S2_R2_L12_ar2
				GPT3_2B_S2_R2_L12_ar2 -> GPT3_2B_S2_R2_L12_res2
				GPT3_2B_S2_R2_L13_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L13_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R2_L13_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R2_L13_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R2_L13_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R2_L13_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L13_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R2_L13_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L13_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L13_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L13_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R2_L13_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L13_split -> GPT3_2B_S2_R2_L13_norm1
				GPT3_2B_S2_R2_L13_norm1 -> GPT3_2B_S2_R2_L13_qkv
				GPT3_2B_S2_R2_L13_qkv -> GPT3_2B_S2_R2_L13_attn
				GPT3_2B_S2_R2_L13_attn -> GPT3_2B_S2_R2_L13_ar1
				GPT3_2B_S2_R2_L13_ar1 -> GPT3_2B_S2_R2_L13_res1
				GPT3_2B_S2_R2_L13_res1 -> GPT3_2B_S2_R2_L13_norm2
				GPT3_2B_S2_R2_L13_norm2 -> GPT3_2B_S2_R2_L13_ffn_up
				GPT3_2B_S2_R2_L13_ffn_up -> GPT3_2B_S2_R2_L13_ffn_gate
				GPT3_2B_S2_R2_L13_ffn_gate -> GPT3_2B_S2_R2_L13_ffn_down
				GPT3_2B_S2_R2_L13_ffn_down -> GPT3_2B_S2_R2_L13_ar2
				GPT3_2B_S2_R2_L13_ar2 -> GPT3_2B_S2_R2_L13_res2
				GPT3_2B_S2_R2_L14_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L14_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R2_L14_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R2_L14_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R2_L14_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R2_L14_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L14_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R2_L14_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L14_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L14_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L14_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R2_L14_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L14_split -> GPT3_2B_S2_R2_L14_norm1
				GPT3_2B_S2_R2_L14_norm1 -> GPT3_2B_S2_R2_L14_qkv
				GPT3_2B_S2_R2_L14_qkv -> GPT3_2B_S2_R2_L14_attn
				GPT3_2B_S2_R2_L14_attn -> GPT3_2B_S2_R2_L14_ar1
				GPT3_2B_S2_R2_L14_ar1 -> GPT3_2B_S2_R2_L14_res1
				GPT3_2B_S2_R2_L14_res1 -> GPT3_2B_S2_R2_L14_norm2
				GPT3_2B_S2_R2_L14_norm2 -> GPT3_2B_S2_R2_L14_ffn_up
				GPT3_2B_S2_R2_L14_ffn_up -> GPT3_2B_S2_R2_L14_ffn_gate
				GPT3_2B_S2_R2_L14_ffn_gate -> GPT3_2B_S2_R2_L14_ffn_down
				GPT3_2B_S2_R2_L14_ffn_down -> GPT3_2B_S2_R2_L14_ar2
				GPT3_2B_S2_R2_L14_ar2 -> GPT3_2B_S2_R2_L14_res2
				GPT3_2B_S2_R2_L15_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L15_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R2_L15_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R2_L15_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R2_L15_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R2_L15_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L15_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R2_L15_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L15_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L15_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L15_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R2_L15_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L15_split -> GPT3_2B_S2_R2_L15_norm1
				GPT3_2B_S2_R2_L15_norm1 -> GPT3_2B_S2_R2_L15_qkv
				GPT3_2B_S2_R2_L15_qkv -> GPT3_2B_S2_R2_L15_attn
				GPT3_2B_S2_R2_L15_attn -> GPT3_2B_S2_R2_L15_ar1
				GPT3_2B_S2_R2_L15_ar1 -> GPT3_2B_S2_R2_L15_res1
				GPT3_2B_S2_R2_L15_res1 -> GPT3_2B_S2_R2_L15_norm2
				GPT3_2B_S2_R2_L15_norm2 -> GPT3_2B_S2_R2_L15_ffn_up
				GPT3_2B_S2_R2_L15_ffn_up -> GPT3_2B_S2_R2_L15_ffn_gate
				GPT3_2B_S2_R2_L15_ffn_gate -> GPT3_2B_S2_R2_L15_ffn_down
				GPT3_2B_S2_R2_L15_ffn_down -> GPT3_2B_S2_R2_L15_ar2
				GPT3_2B_S2_R2_L15_ar2 -> GPT3_2B_S2_R2_L15_res2
				GPT3_2B_S2_R2_L16_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L16_norm1 [label="LayerNorm\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R2_L16_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R2_L16_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S2_R2_L16_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R2_L16_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L16_norm2 [label="LayerNorm 2\nDevice: GPU_4" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S2_R2_L16_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L16_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L16_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S2_R2_L16_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S2_R2_L16_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S2_R2_L16_split -> GPT3_2B_S2_R2_L16_norm1
				GPT3_2B_S2_R2_L16_norm1 -> GPT3_2B_S2_R2_L16_qkv
				GPT3_2B_S2_R2_L16_qkv -> GPT3_2B_S2_R2_L16_attn
				GPT3_2B_S2_R2_L16_attn -> GPT3_2B_S2_R2_L16_ar1
				GPT3_2B_S2_R2_L16_ar1 -> GPT3_2B_S2_R2_L16_res1
				GPT3_2B_S2_R2_L16_res1 -> GPT3_2B_S2_R2_L16_norm2
				GPT3_2B_S2_R2_L16_norm2 -> GPT3_2B_S2_R2_L16_ffn_up
				GPT3_2B_S2_R2_L16_ffn_up -> GPT3_2B_S2_R2_L16_ffn_gate
				GPT3_2B_S2_R2_L16_ffn_gate -> GPT3_2B_S2_R2_L16_ffn_down
				GPT3_2B_S2_R2_L16_ffn_down -> GPT3_2B_S2_R2_L16_ar2
				GPT3_2B_S2_R2_L16_ar2 -> GPT3_2B_S2_R2_L16_res2
			}
		}
		subgraph cluster_GPT3_2B_stage_3 {
			fillcolor=lightblue label="Stage 3\nLayers 17-24" style="rounded,filled"
			subgraph cluster_GPT3_2B_stage_3_rank_1 {
				fillcolor=lightgreen label="Rank 1\nGPU_5" style="rounded,filled"
				GPT3_2B_S3_R1_L17_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L17_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R1_L17_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R1_L17_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R1_L17_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R1_L17_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L17_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R1_L17_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L17_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L17_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L17_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R1_L17_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L17_split -> GPT3_2B_S3_R1_L17_norm1
				GPT3_2B_S3_R1_L17_norm1 -> GPT3_2B_S3_R1_L17_qkv
				GPT3_2B_S3_R1_L17_qkv -> GPT3_2B_S3_R1_L17_attn
				GPT3_2B_S3_R1_L17_attn -> GPT3_2B_S3_R1_L17_ar1
				GPT3_2B_S3_R1_L17_ar1 -> GPT3_2B_S3_R1_L17_res1
				GPT3_2B_S3_R1_L17_res1 -> GPT3_2B_S3_R1_L17_norm2
				GPT3_2B_S3_R1_L17_norm2 -> GPT3_2B_S3_R1_L17_ffn_up
				GPT3_2B_S3_R1_L17_ffn_up -> GPT3_2B_S3_R1_L17_ffn_gate
				GPT3_2B_S3_R1_L17_ffn_gate -> GPT3_2B_S3_R1_L17_ffn_down
				GPT3_2B_S3_R1_L17_ffn_down -> GPT3_2B_S3_R1_L17_ar2
				GPT3_2B_S3_R1_L17_ar2 -> GPT3_2B_S3_R1_L17_res2
				GPT3_2B_S3_R1_L18_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L18_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R1_L18_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R1_L18_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R1_L18_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R1_L18_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L18_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R1_L18_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L18_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L18_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L18_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R1_L18_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L18_split -> GPT3_2B_S3_R1_L18_norm1
				GPT3_2B_S3_R1_L18_norm1 -> GPT3_2B_S3_R1_L18_qkv
				GPT3_2B_S3_R1_L18_qkv -> GPT3_2B_S3_R1_L18_attn
				GPT3_2B_S3_R1_L18_attn -> GPT3_2B_S3_R1_L18_ar1
				GPT3_2B_S3_R1_L18_ar1 -> GPT3_2B_S3_R1_L18_res1
				GPT3_2B_S3_R1_L18_res1 -> GPT3_2B_S3_R1_L18_norm2
				GPT3_2B_S3_R1_L18_norm2 -> GPT3_2B_S3_R1_L18_ffn_up
				GPT3_2B_S3_R1_L18_ffn_up -> GPT3_2B_S3_R1_L18_ffn_gate
				GPT3_2B_S3_R1_L18_ffn_gate -> GPT3_2B_S3_R1_L18_ffn_down
				GPT3_2B_S3_R1_L18_ffn_down -> GPT3_2B_S3_R1_L18_ar2
				GPT3_2B_S3_R1_L18_ar2 -> GPT3_2B_S3_R1_L18_res2
				GPT3_2B_S3_R1_L19_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L19_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R1_L19_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R1_L19_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R1_L19_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R1_L19_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L19_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R1_L19_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L19_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L19_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L19_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R1_L19_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L19_split -> GPT3_2B_S3_R1_L19_norm1
				GPT3_2B_S3_R1_L19_norm1 -> GPT3_2B_S3_R1_L19_qkv
				GPT3_2B_S3_R1_L19_qkv -> GPT3_2B_S3_R1_L19_attn
				GPT3_2B_S3_R1_L19_attn -> GPT3_2B_S3_R1_L19_ar1
				GPT3_2B_S3_R1_L19_ar1 -> GPT3_2B_S3_R1_L19_res1
				GPT3_2B_S3_R1_L19_res1 -> GPT3_2B_S3_R1_L19_norm2
				GPT3_2B_S3_R1_L19_norm2 -> GPT3_2B_S3_R1_L19_ffn_up
				GPT3_2B_S3_R1_L19_ffn_up -> GPT3_2B_S3_R1_L19_ffn_gate
				GPT3_2B_S3_R1_L19_ffn_gate -> GPT3_2B_S3_R1_L19_ffn_down
				GPT3_2B_S3_R1_L19_ffn_down -> GPT3_2B_S3_R1_L19_ar2
				GPT3_2B_S3_R1_L19_ar2 -> GPT3_2B_S3_R1_L19_res2
				GPT3_2B_S3_R1_L20_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L20_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R1_L20_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R1_L20_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R1_L20_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R1_L20_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L20_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R1_L20_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L20_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L20_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L20_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R1_L20_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L20_split -> GPT3_2B_S3_R1_L20_norm1
				GPT3_2B_S3_R1_L20_norm1 -> GPT3_2B_S3_R1_L20_qkv
				GPT3_2B_S3_R1_L20_qkv -> GPT3_2B_S3_R1_L20_attn
				GPT3_2B_S3_R1_L20_attn -> GPT3_2B_S3_R1_L20_ar1
				GPT3_2B_S3_R1_L20_ar1 -> GPT3_2B_S3_R1_L20_res1
				GPT3_2B_S3_R1_L20_res1 -> GPT3_2B_S3_R1_L20_norm2
				GPT3_2B_S3_R1_L20_norm2 -> GPT3_2B_S3_R1_L20_ffn_up
				GPT3_2B_S3_R1_L20_ffn_up -> GPT3_2B_S3_R1_L20_ffn_gate
				GPT3_2B_S3_R1_L20_ffn_gate -> GPT3_2B_S3_R1_L20_ffn_down
				GPT3_2B_S3_R1_L20_ffn_down -> GPT3_2B_S3_R1_L20_ar2
				GPT3_2B_S3_R1_L20_ar2 -> GPT3_2B_S3_R1_L20_res2
				GPT3_2B_S3_R1_L21_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L21_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R1_L21_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R1_L21_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R1_L21_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R1_L21_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L21_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R1_L21_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L21_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L21_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L21_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R1_L21_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L21_split -> GPT3_2B_S3_R1_L21_norm1
				GPT3_2B_S3_R1_L21_norm1 -> GPT3_2B_S3_R1_L21_qkv
				GPT3_2B_S3_R1_L21_qkv -> GPT3_2B_S3_R1_L21_attn
				GPT3_2B_S3_R1_L21_attn -> GPT3_2B_S3_R1_L21_ar1
				GPT3_2B_S3_R1_L21_ar1 -> GPT3_2B_S3_R1_L21_res1
				GPT3_2B_S3_R1_L21_res1 -> GPT3_2B_S3_R1_L21_norm2
				GPT3_2B_S3_R1_L21_norm2 -> GPT3_2B_S3_R1_L21_ffn_up
				GPT3_2B_S3_R1_L21_ffn_up -> GPT3_2B_S3_R1_L21_ffn_gate
				GPT3_2B_S3_R1_L21_ffn_gate -> GPT3_2B_S3_R1_L21_ffn_down
				GPT3_2B_S3_R1_L21_ffn_down -> GPT3_2B_S3_R1_L21_ar2
				GPT3_2B_S3_R1_L21_ar2 -> GPT3_2B_S3_R1_L21_res2
				GPT3_2B_S3_R1_L22_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L22_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R1_L22_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R1_L22_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R1_L22_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R1_L22_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L22_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R1_L22_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L22_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L22_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L22_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R1_L22_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L22_split -> GPT3_2B_S3_R1_L22_norm1
				GPT3_2B_S3_R1_L22_norm1 -> GPT3_2B_S3_R1_L22_qkv
				GPT3_2B_S3_R1_L22_qkv -> GPT3_2B_S3_R1_L22_attn
				GPT3_2B_S3_R1_L22_attn -> GPT3_2B_S3_R1_L22_ar1
				GPT3_2B_S3_R1_L22_ar1 -> GPT3_2B_S3_R1_L22_res1
				GPT3_2B_S3_R1_L22_res1 -> GPT3_2B_S3_R1_L22_norm2
				GPT3_2B_S3_R1_L22_norm2 -> GPT3_2B_S3_R1_L22_ffn_up
				GPT3_2B_S3_R1_L22_ffn_up -> GPT3_2B_S3_R1_L22_ffn_gate
				GPT3_2B_S3_R1_L22_ffn_gate -> GPT3_2B_S3_R1_L22_ffn_down
				GPT3_2B_S3_R1_L22_ffn_down -> GPT3_2B_S3_R1_L22_ar2
				GPT3_2B_S3_R1_L22_ar2 -> GPT3_2B_S3_R1_L22_res2
				GPT3_2B_S3_R1_L23_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L23_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R1_L23_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R1_L23_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R1_L23_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R1_L23_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L23_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R1_L23_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L23_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L23_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L23_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R1_L23_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L23_split -> GPT3_2B_S3_R1_L23_norm1
				GPT3_2B_S3_R1_L23_norm1 -> GPT3_2B_S3_R1_L23_qkv
				GPT3_2B_S3_R1_L23_qkv -> GPT3_2B_S3_R1_L23_attn
				GPT3_2B_S3_R1_L23_attn -> GPT3_2B_S3_R1_L23_ar1
				GPT3_2B_S3_R1_L23_ar1 -> GPT3_2B_S3_R1_L23_res1
				GPT3_2B_S3_R1_L23_res1 -> GPT3_2B_S3_R1_L23_norm2
				GPT3_2B_S3_R1_L23_norm2 -> GPT3_2B_S3_R1_L23_ffn_up
				GPT3_2B_S3_R1_L23_ffn_up -> GPT3_2B_S3_R1_L23_ffn_gate
				GPT3_2B_S3_R1_L23_ffn_gate -> GPT3_2B_S3_R1_L23_ffn_down
				GPT3_2B_S3_R1_L23_ffn_down -> GPT3_2B_S3_R1_L23_ar2
				GPT3_2B_S3_R1_L23_ar2 -> GPT3_2B_S3_R1_L23_res2
				GPT3_2B_S3_R1_L24_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L24_norm1 [label="LayerNorm\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R1_L24_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R1_L24_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R1_L24_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R1_L24_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L24_norm2 [label="LayerNorm 2\nDevice: GPU_5" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R1_L24_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L24_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L24_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R1_L24_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R1_L24_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R1_L24_split -> GPT3_2B_S3_R1_L24_norm1
				GPT3_2B_S3_R1_L24_norm1 -> GPT3_2B_S3_R1_L24_qkv
				GPT3_2B_S3_R1_L24_qkv -> GPT3_2B_S3_R1_L24_attn
				GPT3_2B_S3_R1_L24_attn -> GPT3_2B_S3_R1_L24_ar1
				GPT3_2B_S3_R1_L24_ar1 -> GPT3_2B_S3_R1_L24_res1
				GPT3_2B_S3_R1_L24_res1 -> GPT3_2B_S3_R1_L24_norm2
				GPT3_2B_S3_R1_L24_norm2 -> GPT3_2B_S3_R1_L24_ffn_up
				GPT3_2B_S3_R1_L24_ffn_up -> GPT3_2B_S3_R1_L24_ffn_gate
				GPT3_2B_S3_R1_L24_ffn_gate -> GPT3_2B_S3_R1_L24_ffn_down
				GPT3_2B_S3_R1_L24_ffn_down -> GPT3_2B_S3_R1_L24_ar2
				GPT3_2B_S3_R1_L24_ar2 -> GPT3_2B_S3_R1_L24_res2
			}
			subgraph cluster_GPT3_2B_stage_3_rank_2 {
				fillcolor=lightgreen label="Rank 2\nGPU_6" style="rounded,filled"
				GPT3_2B_S3_R2_L17_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L17_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R2_L17_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R2_L17_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R2_L17_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R2_L17_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L17_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R2_L17_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L17_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L17_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L17_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R2_L17_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L17_split -> GPT3_2B_S3_R2_L17_norm1
				GPT3_2B_S3_R2_L17_norm1 -> GPT3_2B_S3_R2_L17_qkv
				GPT3_2B_S3_R2_L17_qkv -> GPT3_2B_S3_R2_L17_attn
				GPT3_2B_S3_R2_L17_attn -> GPT3_2B_S3_R2_L17_ar1
				GPT3_2B_S3_R2_L17_ar1 -> GPT3_2B_S3_R2_L17_res1
				GPT3_2B_S3_R2_L17_res1 -> GPT3_2B_S3_R2_L17_norm2
				GPT3_2B_S3_R2_L17_norm2 -> GPT3_2B_S3_R2_L17_ffn_up
				GPT3_2B_S3_R2_L17_ffn_up -> GPT3_2B_S3_R2_L17_ffn_gate
				GPT3_2B_S3_R2_L17_ffn_gate -> GPT3_2B_S3_R2_L17_ffn_down
				GPT3_2B_S3_R2_L17_ffn_down -> GPT3_2B_S3_R2_L17_ar2
				GPT3_2B_S3_R2_L17_ar2 -> GPT3_2B_S3_R2_L17_res2
				GPT3_2B_S3_R2_L18_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L18_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R2_L18_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R2_L18_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R2_L18_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R2_L18_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L18_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R2_L18_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L18_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L18_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L18_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R2_L18_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L18_split -> GPT3_2B_S3_R2_L18_norm1
				GPT3_2B_S3_R2_L18_norm1 -> GPT3_2B_S3_R2_L18_qkv
				GPT3_2B_S3_R2_L18_qkv -> GPT3_2B_S3_R2_L18_attn
				GPT3_2B_S3_R2_L18_attn -> GPT3_2B_S3_R2_L18_ar1
				GPT3_2B_S3_R2_L18_ar1 -> GPT3_2B_S3_R2_L18_res1
				GPT3_2B_S3_R2_L18_res1 -> GPT3_2B_S3_R2_L18_norm2
				GPT3_2B_S3_R2_L18_norm2 -> GPT3_2B_S3_R2_L18_ffn_up
				GPT3_2B_S3_R2_L18_ffn_up -> GPT3_2B_S3_R2_L18_ffn_gate
				GPT3_2B_S3_R2_L18_ffn_gate -> GPT3_2B_S3_R2_L18_ffn_down
				GPT3_2B_S3_R2_L18_ffn_down -> GPT3_2B_S3_R2_L18_ar2
				GPT3_2B_S3_R2_L18_ar2 -> GPT3_2B_S3_R2_L18_res2
				GPT3_2B_S3_R2_L19_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L19_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R2_L19_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R2_L19_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R2_L19_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R2_L19_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L19_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R2_L19_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L19_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L19_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L19_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R2_L19_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L19_split -> GPT3_2B_S3_R2_L19_norm1
				GPT3_2B_S3_R2_L19_norm1 -> GPT3_2B_S3_R2_L19_qkv
				GPT3_2B_S3_R2_L19_qkv -> GPT3_2B_S3_R2_L19_attn
				GPT3_2B_S3_R2_L19_attn -> GPT3_2B_S3_R2_L19_ar1
				GPT3_2B_S3_R2_L19_ar1 -> GPT3_2B_S3_R2_L19_res1
				GPT3_2B_S3_R2_L19_res1 -> GPT3_2B_S3_R2_L19_norm2
				GPT3_2B_S3_R2_L19_norm2 -> GPT3_2B_S3_R2_L19_ffn_up
				GPT3_2B_S3_R2_L19_ffn_up -> GPT3_2B_S3_R2_L19_ffn_gate
				GPT3_2B_S3_R2_L19_ffn_gate -> GPT3_2B_S3_R2_L19_ffn_down
				GPT3_2B_S3_R2_L19_ffn_down -> GPT3_2B_S3_R2_L19_ar2
				GPT3_2B_S3_R2_L19_ar2 -> GPT3_2B_S3_R2_L19_res2
				GPT3_2B_S3_R2_L20_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L20_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R2_L20_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R2_L20_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R2_L20_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R2_L20_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L20_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R2_L20_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L20_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L20_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L20_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R2_L20_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L20_split -> GPT3_2B_S3_R2_L20_norm1
				GPT3_2B_S3_R2_L20_norm1 -> GPT3_2B_S3_R2_L20_qkv
				GPT3_2B_S3_R2_L20_qkv -> GPT3_2B_S3_R2_L20_attn
				GPT3_2B_S3_R2_L20_attn -> GPT3_2B_S3_R2_L20_ar1
				GPT3_2B_S3_R2_L20_ar1 -> GPT3_2B_S3_R2_L20_res1
				GPT3_2B_S3_R2_L20_res1 -> GPT3_2B_S3_R2_L20_norm2
				GPT3_2B_S3_R2_L20_norm2 -> GPT3_2B_S3_R2_L20_ffn_up
				GPT3_2B_S3_R2_L20_ffn_up -> GPT3_2B_S3_R2_L20_ffn_gate
				GPT3_2B_S3_R2_L20_ffn_gate -> GPT3_2B_S3_R2_L20_ffn_down
				GPT3_2B_S3_R2_L20_ffn_down -> GPT3_2B_S3_R2_L20_ar2
				GPT3_2B_S3_R2_L20_ar2 -> GPT3_2B_S3_R2_L20_res2
				GPT3_2B_S3_R2_L21_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L21_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R2_L21_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R2_L21_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R2_L21_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R2_L21_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L21_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R2_L21_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L21_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L21_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L21_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R2_L21_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L21_split -> GPT3_2B_S3_R2_L21_norm1
				GPT3_2B_S3_R2_L21_norm1 -> GPT3_2B_S3_R2_L21_qkv
				GPT3_2B_S3_R2_L21_qkv -> GPT3_2B_S3_R2_L21_attn
				GPT3_2B_S3_R2_L21_attn -> GPT3_2B_S3_R2_L21_ar1
				GPT3_2B_S3_R2_L21_ar1 -> GPT3_2B_S3_R2_L21_res1
				GPT3_2B_S3_R2_L21_res1 -> GPT3_2B_S3_R2_L21_norm2
				GPT3_2B_S3_R2_L21_norm2 -> GPT3_2B_S3_R2_L21_ffn_up
				GPT3_2B_S3_R2_L21_ffn_up -> GPT3_2B_S3_R2_L21_ffn_gate
				GPT3_2B_S3_R2_L21_ffn_gate -> GPT3_2B_S3_R2_L21_ffn_down
				GPT3_2B_S3_R2_L21_ffn_down -> GPT3_2B_S3_R2_L21_ar2
				GPT3_2B_S3_R2_L21_ar2 -> GPT3_2B_S3_R2_L21_res2
				GPT3_2B_S3_R2_L22_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L22_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R2_L22_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R2_L22_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R2_L22_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R2_L22_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L22_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R2_L22_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L22_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L22_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L22_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R2_L22_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L22_split -> GPT3_2B_S3_R2_L22_norm1
				GPT3_2B_S3_R2_L22_norm1 -> GPT3_2B_S3_R2_L22_qkv
				GPT3_2B_S3_R2_L22_qkv -> GPT3_2B_S3_R2_L22_attn
				GPT3_2B_S3_R2_L22_attn -> GPT3_2B_S3_R2_L22_ar1
				GPT3_2B_S3_R2_L22_ar1 -> GPT3_2B_S3_R2_L22_res1
				GPT3_2B_S3_R2_L22_res1 -> GPT3_2B_S3_R2_L22_norm2
				GPT3_2B_S3_R2_L22_norm2 -> GPT3_2B_S3_R2_L22_ffn_up
				GPT3_2B_S3_R2_L22_ffn_up -> GPT3_2B_S3_R2_L22_ffn_gate
				GPT3_2B_S3_R2_L22_ffn_gate -> GPT3_2B_S3_R2_L22_ffn_down
				GPT3_2B_S3_R2_L22_ffn_down -> GPT3_2B_S3_R2_L22_ar2
				GPT3_2B_S3_R2_L22_ar2 -> GPT3_2B_S3_R2_L22_res2
				GPT3_2B_S3_R2_L23_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L23_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R2_L23_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R2_L23_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R2_L23_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R2_L23_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L23_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R2_L23_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L23_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L23_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L23_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R2_L23_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L23_split -> GPT3_2B_S3_R2_L23_norm1
				GPT3_2B_S3_R2_L23_norm1 -> GPT3_2B_S3_R2_L23_qkv
				GPT3_2B_S3_R2_L23_qkv -> GPT3_2B_S3_R2_L23_attn
				GPT3_2B_S3_R2_L23_attn -> GPT3_2B_S3_R2_L23_ar1
				GPT3_2B_S3_R2_L23_ar1 -> GPT3_2B_S3_R2_L23_res1
				GPT3_2B_S3_R2_L23_res1 -> GPT3_2B_S3_R2_L23_norm2
				GPT3_2B_S3_R2_L23_norm2 -> GPT3_2B_S3_R2_L23_ffn_up
				GPT3_2B_S3_R2_L23_ffn_up -> GPT3_2B_S3_R2_L23_ffn_gate
				GPT3_2B_S3_R2_L23_ffn_gate -> GPT3_2B_S3_R2_L23_ffn_down
				GPT3_2B_S3_R2_L23_ffn_down -> GPT3_2B_S3_R2_L23_ar2
				GPT3_2B_S3_R2_L23_ar2 -> GPT3_2B_S3_R2_L23_res2
				GPT3_2B_S3_R2_L24_split [label="Input Split\n[batch=12, seq=2048, hidden=2048]→[hidden=1024]" fillcolor=orange shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L24_norm1 [label="LayerNorm\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R2_L24_qkv [label="QKV Proj\n[hidden=1024]→[heads=8, dim=128]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R2_L24_attn [label="MHA\n[heads=8, dim=128]→[hidden=1024]" fillcolor=lightcoral shape=rectangle style=filled]
				GPT3_2B_S3_R2_L24_ar1 [label="All-Reduce\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R2_L24_res1 [label="Residual 1" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L24_norm2 [label="LayerNorm 2\nDevice: GPU_6" fillcolor=lightgray shape=ellipse style=filled]
				GPT3_2B_S3_R2_L24_ffn_up [label="FFN Up\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L24_ffn_gate [label="FFN Gate\n[hidden=1024]→[ffn=4096]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L24_ffn_down [label="FFN Down\n[ffn=4096]→[hidden=1024]" fillcolor=lightcyan shape=rectangle style=filled]
				GPT3_2B_S3_R2_L24_ar2 [label="All-Reduce 2\n[hidden=1024]" fillcolor=yellow shape=ellipse style="dashed,filled"]
				GPT3_2B_S3_R2_L24_res2 [label="Residual 2" fillcolor=lightyellow shape=parallelogram style=filled]
				GPT3_2B_S3_R2_L24_split -> GPT3_2B_S3_R2_L24_norm1
				GPT3_2B_S3_R2_L24_norm1 -> GPT3_2B_S3_R2_L24_qkv
				GPT3_2B_S3_R2_L24_qkv -> GPT3_2B_S3_R2_L24_attn
				GPT3_2B_S3_R2_L24_attn -> GPT3_2B_S3_R2_L24_ar1
				GPT3_2B_S3_R2_L24_ar1 -> GPT3_2B_S3_R2_L24_res1
				GPT3_2B_S3_R2_L24_res1 -> GPT3_2B_S3_R2_L24_norm2
				GPT3_2B_S3_R2_L24_norm2 -> GPT3_2B_S3_R2_L24_ffn_up
				GPT3_2B_S3_R2_L24_ffn_up -> GPT3_2B_S3_R2_L24_ffn_gate
				GPT3_2B_S3_R2_L24_ffn_gate -> GPT3_2B_S3_R2_L24_ffn_down
				GPT3_2B_S3_R2_L24_ffn_down -> GPT3_2B_S3_R2_L24_ar2
				GPT3_2B_S3_R2_L24_ar2 -> GPT3_2B_S3_R2_L24_res2
			}
		}
		GPT3_2B_comm_1_2 [label="Pipeline Comm\nStage 1 → 2\n[batch=12, seq=2048, hidden=2048]" fillcolor=lightyellow shape=ellipse style="dashed,filled"]
		GPT3_2B_S1_R1_L8_res2 -> GPT3_2B_comm_1_2
		GPT3_2B_comm_1_2 -> GPT3_2B_S2_R1_L9_split
		GPT3_2B_S1_R2_L8_res2 -> GPT3_2B_comm_1_2
		GPT3_2B_comm_1_2 -> GPT3_2B_S2_R2_L9_split
		GPT3_2B_comm_2_3 [label="Pipeline Comm\nStage 2 → 3\n[batch=12, seq=2048, hidden=2048]" fillcolor=lightyellow shape=ellipse style="dashed,filled"]
		GPT3_2B_S2_R1_L16_res2 -> GPT3_2B_comm_2_3
		GPT3_2B_comm_2_3 -> GPT3_2B_S3_R1_L17_split
		GPT3_2B_S2_R2_L16_res2 -> GPT3_2B_comm_2_3
		GPT3_2B_comm_2_3 -> GPT3_2B_S3_R2_L17_split
		GPT3_2B_input [label="Input\n[batch=12, seq=2048, vocab=50257]" fillcolor=lightgreen shape=ellipse style=filled]
		GPT3_2B_output [label="Output\n[batch=12, seq=2048, vocab=50257]" fillcolor=lightgreen shape=doubleoctagon style=filled]
		GPT3_2B_input -> GPT3_2B_S1_R1_L1_split
		GPT3_2B_input -> GPT3_2B_S1_R2_L1_split
		GPT3_2B_S3_R1_L24_res2 -> GPT3_2B_output
		GPT3_2B_S3_R2_L24_res2 -> GPT3_2B_output
	}
}
