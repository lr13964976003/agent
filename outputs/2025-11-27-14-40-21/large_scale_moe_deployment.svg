<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: LargeScaleMoEDeployment Pages: 1 -->
<svg width="17096pt" height="2643pt"
 viewBox="14.40 14.40 17081.40 2629.02" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(18.4 2625.02)">
<title>LargeScaleMoEDeployment</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2610.62 17063,-2610.62 17063,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_layer1_dense</title>
<polygon fill="white" stroke="blue" stroke-dasharray="5,2" points="8,-1467.62 8,-2527.62 17051,-2527.62 17051,-1467.62 8,-1467.62"/>
<text text-anchor="middle" x="8529.5" y="-2512.42" font-family="Times,serif" font-size="14.00">Layer 1 &#45; Dense (DP=4, TP=8)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_mla_dense1</title>
<polygon fill="white" stroke="green" stroke-dasharray="1,5" points="8,-2006.62 8,-2504.62 17051,-2504.62 17051,-2006.62 8,-2006.62"/>
<text text-anchor="middle" x="8529.5" y="-2489.42" font-family="Times,serif" font-size="14.00">MLA Attention &#45; Tensor Parallel</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_mlp_dense1</title>
<polygon fill="white" stroke="purple" stroke-dasharray="1,5" points="3683,-1467.62 3683,-1965.62 15169,-1965.62 15169,-1467.62 3683,-1467.62"/>
<text text-anchor="middle" x="9426" y="-1950.42" font-family="Times,serif" font-size="14.00">MLP &#45; Tensor Parallel</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_layer4_moe</title>
<polygon fill="white" stroke="red" stroke-dasharray="5,2" points="14473,-303 14473,-1440.62 15897,-1440.62 15897,-303 14473,-303"/>
<text text-anchor="middle" x="15185" y="-1425.42" font-family="Times,serif" font-size="14.00">Layer 4 &#45; MoE Layer (EP=16, TP=8, DP=4)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_mla_moe4</title>
<polygon fill="white" stroke="green" stroke-dasharray="1,5" points="15208,-1290.62 15208,-1417.62 15852,-1417.62 15852,-1290.62 15208,-1290.62"/>
<text text-anchor="middle" x="15530" y="-1402.42" font-family="Times,serif" font-size="14.00">MLA Attention &#45; Expert Parallel</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_experts_moe4</title>
<polygon fill="white" stroke="brown" stroke-dasharray="1,5" points="14473,-458 14473,-1108.62 15897,-1108.62 15897,-458 14473,-458"/>
<text text-anchor="middle" x="15185" y="-1093.42" font-family="Times,serif" font-size="14.00">Expert Computation &#45; One Expert per GPU</text>
</g>
<!-- input_node -->
<g id="node1" class="node">
<title>input_node</title>
<polygon fill="lightblue" stroke="black" points="14806.5,-2606.62 14489.5,-2606.62 14489.5,-2554.62 14806.5,-2554.62 14806.5,-2606.62"/>
<text text-anchor="middle" x="14648" y="-2594.62" font-family="Courier New" font-size="10.00">GPU: INPUT</text>
<text text-anchor="middle" x="14648" y="-2583.62" font-family="Courier New" font-size="10.00">Input Layer</text>
<text text-anchor="middle" x="14648" y="-2572.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="14648" y="-2561.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=7168]</text>
</g>
<!-- mla_q_dense1_0 -->
<g id="node2" class="node">
<title>mla_q_dense1_0</title>
<ellipse fill="lightyellow" stroke="black" cx="12573" cy="-2429.62" rx="245.23" ry="36.54"/>
<text text-anchor="middle" x="12573" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="12573" y="-2432.62" font-family="Courier New" font-size="10.00">Q Proj (1/8)</text>
<text text-anchor="middle" x="12573" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="12573" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
</g>
<!-- input_node&#45;&gt;mla_q_dense1_0 -->
<g id="edge1" class="edge">
<title>input_node&#45;&gt;mla_q_dense1_0</title>
<path fill="none" stroke="black" d="M14489.26,-2578.11C14076.09,-2573.77 12988.21,-2559.43 12828,-2527.62 12767.33,-2515.57 12702.21,-2490.57 12652.96,-2468.97"/>
<polygon fill="black" stroke="black" points="12654.2,-2465.7 12643.64,-2464.85 12651.36,-2472.1 12654.2,-2465.7"/>
</g>
<!-- mla_kv_dense1_0 -->
<g id="node10" class="node">
<title>mla_kv_dense1_0</title>
<ellipse fill="lightcoral" stroke="black" cx="16725" cy="-2429.62" rx="325.95" ry="36.54"/>
<text text-anchor="middle" x="16725" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="16725" y="-2432.62" font-family="Courier New" font-size="10.00">K/V Proj (1/8)</text>
<text text-anchor="middle" x="16725" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="16725" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56, kv_compressed=512]</text>
</g>
<!-- input_node&#45;&gt;mla_kv_dense1_0 -->
<g id="edge2" class="edge">
<title>input_node&#45;&gt;mla_kv_dense1_0</title>
<path fill="none" stroke="black" d="M14806.5,-2579.98C15176.35,-2580.01 16087.83,-2575.09 16390,-2527.62 16468.96,-2515.21 16555.56,-2489.81 16620.93,-2468.11"/>
<polygon fill="black" stroke="black" points="16622.05,-2471.43 16630.42,-2464.94 16619.83,-2464.79 16622.05,-2471.43"/>
</g>
<!-- attn_dense1_0 -->
<g id="node18" class="node">
<title>attn_dense1_0</title>
<polygon fill="lightgreen" stroke="black" points="15101.5,-2340.62 14754.5,-2340.62 14754.5,-2288.62 15101.5,-2288.62 15101.5,-2340.62"/>
<text text-anchor="middle" x="14928" y="-2328.62" font-family="Courier New" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="14928" y="-2317.62" font-family="Courier New" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="14928" y="-2306.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
<text text-anchor="middle" x="14928" y="-2295.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
</g>
<!-- mla_q_dense1_0&#45;&gt;attn_dense1_0 -->
<g id="edge3" class="edge">
<title>mla_q_dense1_0&#45;&gt;attn_dense1_0</title>
<path fill="none" stroke="black" d="M12702.39,-2398.37C12742.43,-2390.19 12786.84,-2382.31 12828,-2377.62 13196.22,-2335.66 14303.1,-2321.25 14743.92,-2317.09"/>
<polygon fill="black" stroke="black" points="14744.24,-2320.58 14754.21,-2316.99 14744.18,-2313.58 14744.24,-2320.58"/>
</g>
<!-- mla_q_dense1_1 -->
<g id="node3" class="node">
<title>mla_q_dense1_1</title>
<ellipse fill="lightyellow" stroke="black" cx="16136" cy="-2429.62" rx="245.23" ry="36.54"/>
<text text-anchor="middle" x="16136" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="16136" y="-2432.62" font-family="Courier New" font-size="10.00">Q Proj (2/8)</text>
<text text-anchor="middle" x="16136" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="16136" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
</g>
<!-- mla_q_dense1_2 -->
<g id="node4" class="node">
<title>mla_q_dense1_2</title>
<ellipse fill="lightyellow" stroke="black" cx="15627" cy="-2429.62" rx="245.23" ry="36.54"/>
<text text-anchor="middle" x="15627" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 2</text>
<text text-anchor="middle" x="15627" y="-2432.62" font-family="Courier New" font-size="10.00">Q Proj (3/8)</text>
<text text-anchor="middle" x="15627" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="15627" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
</g>
<!-- mla_q_dense1_3 -->
<g id="node5" class="node">
<title>mla_q_dense1_3</title>
<ellipse fill="lightyellow" stroke="black" cx="15118" cy="-2429.62" rx="245.23" ry="36.54"/>
<text text-anchor="middle" x="15118" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 3</text>
<text text-anchor="middle" x="15118" y="-2432.62" font-family="Courier New" font-size="10.00">Q Proj (4/8)</text>
<text text-anchor="middle" x="15118" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="15118" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
</g>
<!-- mla_q_dense1_4 -->
<g id="node6" class="node">
<title>mla_q_dense1_4</title>
<ellipse fill="lightyellow" stroke="black" cx="14609" cy="-2429.62" rx="245.23" ry="36.54"/>
<text text-anchor="middle" x="14609" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 4</text>
<text text-anchor="middle" x="14609" y="-2432.62" font-family="Courier New" font-size="10.00">Q Proj (5/8)</text>
<text text-anchor="middle" x="14609" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="14609" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
</g>
<!-- mla_q_dense1_5 -->
<g id="node7" class="node">
<title>mla_q_dense1_5</title>
<ellipse fill="lightyellow" stroke="black" cx="14100" cy="-2429.62" rx="245.23" ry="36.54"/>
<text text-anchor="middle" x="14100" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 5</text>
<text text-anchor="middle" x="14100" y="-2432.62" font-family="Courier New" font-size="10.00">Q Proj (6/8)</text>
<text text-anchor="middle" x="14100" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="14100" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
</g>
<!-- mla_q_dense1_6 -->
<g id="node8" class="node">
<title>mla_q_dense1_6</title>
<ellipse fill="lightyellow" stroke="black" cx="13591" cy="-2429.62" rx="245.23" ry="36.54"/>
<text text-anchor="middle" x="13591" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 6</text>
<text text-anchor="middle" x="13591" y="-2432.62" font-family="Courier New" font-size="10.00">Q Proj (7/8)</text>
<text text-anchor="middle" x="13591" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="13591" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
</g>
<!-- mla_q_dense1_7 -->
<g id="node9" class="node">
<title>mla_q_dense1_7</title>
<ellipse fill="lightyellow" stroke="black" cx="13082" cy="-2429.62" rx="245.23" ry="36.54"/>
<text text-anchor="middle" x="13082" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 7</text>
<text text-anchor="middle" x="13082" y="-2432.62" font-family="Courier New" font-size="10.00">Q Proj (8/8)</text>
<text text-anchor="middle" x="13082" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="13082" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
</g>
<!-- mla_kv_dense1_0&#45;&gt;attn_dense1_0 -->
<g id="edge4" class="edge">
<title>mla_kv_dense1_0&#45;&gt;attn_dense1_0</title>
<path fill="none" stroke="black" d="M16551.15,-2398.48C16499.43,-2390.51 16442.55,-2382.72 16390,-2377.62 15931.67,-2333.14 15389.43,-2320.57 15111.88,-2317.01"/>
<polygon fill="black" stroke="black" points="15111.76,-2313.51 15101.72,-2316.89 15111.67,-2320.51 15111.76,-2313.51"/>
</g>
<!-- mla_kv_dense1_1 -->
<g id="node11" class="node">
<title>mla_kv_dense1_1</title>
<ellipse fill="lightcoral" stroke="black" cx="11984" cy="-2429.62" rx="325.95" ry="36.54"/>
<text text-anchor="middle" x="11984" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="11984" y="-2432.62" font-family="Courier New" font-size="10.00">K/V Proj (2/8)</text>
<text text-anchor="middle" x="11984" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="11984" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56, kv_compressed=512]</text>
</g>
<!-- mla_kv_dense1_2 -->
<g id="node12" class="node">
<title>mla_kv_dense1_2</title>
<ellipse fill="lightcoral" stroke="black" cx="11314" cy="-2429.62" rx="325.95" ry="36.54"/>
<text text-anchor="middle" x="11314" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 2</text>
<text text-anchor="middle" x="11314" y="-2432.62" font-family="Courier New" font-size="10.00">K/V Proj (3/8)</text>
<text text-anchor="middle" x="11314" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="11314" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56, kv_compressed=512]</text>
</g>
<!-- mla_kv_dense1_3 -->
<g id="node13" class="node">
<title>mla_kv_dense1_3</title>
<ellipse fill="lightcoral" stroke="black" cx="10644" cy="-2429.62" rx="325.95" ry="36.54"/>
<text text-anchor="middle" x="10644" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 3</text>
<text text-anchor="middle" x="10644" y="-2432.62" font-family="Courier New" font-size="10.00">K/V Proj (4/8)</text>
<text text-anchor="middle" x="10644" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="10644" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56, kv_compressed=512]</text>
</g>
<!-- mla_kv_dense1_4 -->
<g id="node14" class="node">
<title>mla_kv_dense1_4</title>
<ellipse fill="lightcoral" stroke="black" cx="9974" cy="-2429.62" rx="325.95" ry="36.54"/>
<text text-anchor="middle" x="9974" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 4</text>
<text text-anchor="middle" x="9974" y="-2432.62" font-family="Courier New" font-size="10.00">K/V Proj (5/8)</text>
<text text-anchor="middle" x="9974" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="9974" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56, kv_compressed=512]</text>
</g>
<!-- mla_kv_dense1_5 -->
<g id="node15" class="node">
<title>mla_kv_dense1_5</title>
<ellipse fill="lightcoral" stroke="black" cx="9304" cy="-2429.62" rx="325.95" ry="36.54"/>
<text text-anchor="middle" x="9304" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 5</text>
<text text-anchor="middle" x="9304" y="-2432.62" font-family="Courier New" font-size="10.00">K/V Proj (6/8)</text>
<text text-anchor="middle" x="9304" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="9304" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56, kv_compressed=512]</text>
</g>
<!-- mla_kv_dense1_6 -->
<g id="node16" class="node">
<title>mla_kv_dense1_6</title>
<ellipse fill="lightcoral" stroke="black" cx="8634" cy="-2429.62" rx="325.95" ry="36.54"/>
<text text-anchor="middle" x="8634" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 6</text>
<text text-anchor="middle" x="8634" y="-2432.62" font-family="Courier New" font-size="10.00">K/V Proj (7/8)</text>
<text text-anchor="middle" x="8634" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="8634" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56, kv_compressed=512]</text>
</g>
<!-- mla_kv_dense1_7 -->
<g id="node17" class="node">
<title>mla_kv_dense1_7</title>
<ellipse fill="lightcoral" stroke="black" cx="7964" cy="-2429.62" rx="325.95" ry="36.54"/>
<text text-anchor="middle" x="7964" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 7</text>
<text text-anchor="middle" x="7964" y="-2432.62" font-family="Courier New" font-size="10.00">K/V Proj (8/8)</text>
<text text-anchor="middle" x="7964" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="7964" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56, kv_compressed=512]</text>
</g>
<!-- out_proj_dense1_0 -->
<g id="node26" class="node">
<title>out_proj_dense1_0</title>
<polygon fill="lightblue" stroke="black" points="15281.57,-2251.62 14719.12,-2251.62 14574.43,-2147.62 15136.88,-2147.62 15281.57,-2251.62"/>
<text text-anchor="middle" x="14928" y="-2213.62" font-family="Courier New" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="14928" y="-2202.62" font-family="Courier New" font-size="10.00">Output Proj (1/8)</text>
<text text-anchor="middle" x="14928" y="-2191.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
<text text-anchor="middle" x="14928" y="-2180.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=896]</text>
</g>
<!-- attn_dense1_0&#45;&gt;out_proj_dense1_0 -->
<g id="edge5" class="edge">
<title>attn_dense1_0&#45;&gt;out_proj_dense1_0</title>
<path fill="none" stroke="black" d="M14928,-2288.54C14928,-2280.61 14928,-2271.48 14928,-2262.16"/>
<polygon fill="black" stroke="black" points="14931.5,-2262.02 14928,-2252.02 14924.5,-2262.02 14931.5,-2262.02"/>
</g>
<!-- attn_dense1_1 -->
<g id="node19" class="node">
<title>attn_dense1_1</title>
<polygon fill="lightgreen" stroke="black" points="7620.5,-2455.62 7273.5,-2455.62 7273.5,-2403.62 7620.5,-2403.62 7620.5,-2455.62"/>
<text text-anchor="middle" x="7447" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="7447" y="-2432.62" font-family="Courier New" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="7447" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
<text text-anchor="middle" x="7447" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
</g>
<!-- attn_dense1_2 -->
<g id="node20" class="node">
<title>attn_dense1_2</title>
<polygon fill="lightgreen" stroke="black" points="7255.5,-2455.62 6908.5,-2455.62 6908.5,-2403.62 7255.5,-2403.62 7255.5,-2455.62"/>
<text text-anchor="middle" x="7082" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 2</text>
<text text-anchor="middle" x="7082" y="-2432.62" font-family="Courier New" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="7082" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
<text text-anchor="middle" x="7082" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
</g>
<!-- attn_dense1_3 -->
<g id="node21" class="node">
<title>attn_dense1_3</title>
<polygon fill="lightgreen" stroke="black" points="6890.5,-2455.62 6543.5,-2455.62 6543.5,-2403.62 6890.5,-2403.62 6890.5,-2455.62"/>
<text text-anchor="middle" x="6717" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 3</text>
<text text-anchor="middle" x="6717" y="-2432.62" font-family="Courier New" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="6717" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
<text text-anchor="middle" x="6717" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
</g>
<!-- attn_dense1_4 -->
<g id="node22" class="node">
<title>attn_dense1_4</title>
<polygon fill="lightgreen" stroke="black" points="6525.5,-2455.62 6178.5,-2455.62 6178.5,-2403.62 6525.5,-2403.62 6525.5,-2455.62"/>
<text text-anchor="middle" x="6352" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 4</text>
<text text-anchor="middle" x="6352" y="-2432.62" font-family="Courier New" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="6352" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
<text text-anchor="middle" x="6352" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
</g>
<!-- attn_dense1_5 -->
<g id="node23" class="node">
<title>attn_dense1_5</title>
<polygon fill="lightgreen" stroke="black" points="6160.5,-2455.62 5813.5,-2455.62 5813.5,-2403.62 6160.5,-2403.62 6160.5,-2455.62"/>
<text text-anchor="middle" x="5987" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 5</text>
<text text-anchor="middle" x="5987" y="-2432.62" font-family="Courier New" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="5987" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
<text text-anchor="middle" x="5987" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
</g>
<!-- attn_dense1_6 -->
<g id="node24" class="node">
<title>attn_dense1_6</title>
<polygon fill="lightgreen" stroke="black" points="5795.5,-2455.62 5448.5,-2455.62 5448.5,-2403.62 5795.5,-2403.62 5795.5,-2455.62"/>
<text text-anchor="middle" x="5622" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 6</text>
<text text-anchor="middle" x="5622" y="-2432.62" font-family="Courier New" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="5622" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
<text text-anchor="middle" x="5622" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
</g>
<!-- attn_dense1_7 -->
<g id="node25" class="node">
<title>attn_dense1_7</title>
<polygon fill="lightgreen" stroke="black" points="5430.5,-2455.62 5083.5,-2455.62 5083.5,-2403.62 5430.5,-2403.62 5430.5,-2455.62"/>
<text text-anchor="middle" x="5257" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 7</text>
<text text-anchor="middle" x="5257" y="-2432.62" font-family="Courier New" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="5257" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
<text text-anchor="middle" x="5257" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
</g>
<!-- attn_allreduce_dense1 -->
<g id="node34" class="node">
<title>attn_allreduce_dense1</title>
<polygon fill="orange" stroke="black" points="15256.8,-2110.62 14733.75,-2110.62 14599.2,-2006.62 15122.25,-2006.62 15256.8,-2110.62"/>
<text text-anchor="middle" x="14928" y="-2072.62" font-family="Courier New" font-size="10.00">GPU: ALL</text>
<text text-anchor="middle" x="14928" y="-2061.62" font-family="Courier New" font-size="10.00">All&#45;Reduce Attention</text>
<text text-anchor="middle" x="14928" y="-2050.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=896]</text>
<text text-anchor="middle" x="14928" y="-2039.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=7168]</text>
</g>
<!-- out_proj_dense1_0&#45;&gt;attn_allreduce_dense1 -->
<g id="edge6" class="edge">
<title>out_proj_dense1_0&#45;&gt;attn_allreduce_dense1</title>
<path fill="none" stroke="black" d="M14928,-2147.25C14928,-2138.69 14928,-2129.74 14928,-2120.96"/>
<polygon fill="black" stroke="black" points="14931.5,-2120.77 14928,-2110.77 14924.5,-2120.77 14931.5,-2120.77"/>
</g>
<!-- out_proj_dense1_1 -->
<g id="node27" class="node">
<title>out_proj_dense1_1</title>
<polygon fill="lightblue" stroke="black" points="5065.57,-2481.62 4503.12,-2481.62 4358.43,-2377.62 4920.88,-2377.62 5065.57,-2481.62"/>
<text text-anchor="middle" x="4712" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="4712" y="-2432.62" font-family="Courier New" font-size="10.00">Output Proj (2/8)</text>
<text text-anchor="middle" x="4712" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
<text text-anchor="middle" x="4712" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=896]</text>
</g>
<!-- out_proj_dense1_2 -->
<g id="node28" class="node">
<title>out_proj_dense1_2</title>
<polygon fill="lightblue" stroke="black" points="4340.57,-2481.62 3778.12,-2481.62 3633.43,-2377.62 4195.88,-2377.62 4340.57,-2481.62"/>
<text text-anchor="middle" x="3987" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 2</text>
<text text-anchor="middle" x="3987" y="-2432.62" font-family="Courier New" font-size="10.00">Output Proj (3/8)</text>
<text text-anchor="middle" x="3987" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
<text text-anchor="middle" x="3987" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=896]</text>
</g>
<!-- out_proj_dense1_3 -->
<g id="node29" class="node">
<title>out_proj_dense1_3</title>
<polygon fill="lightblue" stroke="black" points="3615.57,-2481.62 3053.12,-2481.62 2908.43,-2377.62 3470.88,-2377.62 3615.57,-2481.62"/>
<text text-anchor="middle" x="3262" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 3</text>
<text text-anchor="middle" x="3262" y="-2432.62" font-family="Courier New" font-size="10.00">Output Proj (4/8)</text>
<text text-anchor="middle" x="3262" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
<text text-anchor="middle" x="3262" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=896]</text>
</g>
<!-- out_proj_dense1_4 -->
<g id="node30" class="node">
<title>out_proj_dense1_4</title>
<polygon fill="lightblue" stroke="black" points="2890.57,-2481.62 2328.12,-2481.62 2183.43,-2377.62 2745.88,-2377.62 2890.57,-2481.62"/>
<text text-anchor="middle" x="2537" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 4</text>
<text text-anchor="middle" x="2537" y="-2432.62" font-family="Courier New" font-size="10.00">Output Proj (5/8)</text>
<text text-anchor="middle" x="2537" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
<text text-anchor="middle" x="2537" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=896]</text>
</g>
<!-- out_proj_dense1_5 -->
<g id="node31" class="node">
<title>out_proj_dense1_5</title>
<polygon fill="lightblue" stroke="black" points="2165.57,-2481.62 1603.12,-2481.62 1458.43,-2377.62 2020.88,-2377.62 2165.57,-2481.62"/>
<text text-anchor="middle" x="1812" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 5</text>
<text text-anchor="middle" x="1812" y="-2432.62" font-family="Courier New" font-size="10.00">Output Proj (6/8)</text>
<text text-anchor="middle" x="1812" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
<text text-anchor="middle" x="1812" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=896]</text>
</g>
<!-- out_proj_dense1_6 -->
<g id="node32" class="node">
<title>out_proj_dense1_6</title>
<polygon fill="lightblue" stroke="black" points="1440.57,-2481.62 878.12,-2481.62 733.43,-2377.62 1295.88,-2377.62 1440.57,-2481.62"/>
<text text-anchor="middle" x="1087" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 6</text>
<text text-anchor="middle" x="1087" y="-2432.62" font-family="Courier New" font-size="10.00">Output Proj (7/8)</text>
<text text-anchor="middle" x="1087" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
<text text-anchor="middle" x="1087" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=896]</text>
</g>
<!-- out_proj_dense1_7 -->
<g id="node33" class="node">
<title>out_proj_dense1_7</title>
<polygon fill="lightblue" stroke="black" points="715.57,-2481.62 153.12,-2481.62 8.43,-2377.62 570.88,-2377.62 715.57,-2481.62"/>
<text text-anchor="middle" x="362" y="-2443.62" font-family="Courier New" font-size="10.00">GPU: 7</text>
<text text-anchor="middle" x="362" y="-2432.62" font-family="Courier New" font-size="10.00">Output Proj (8/8)</text>
<text text-anchor="middle" x="362" y="-2421.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, heads=16, d_k=56]</text>
<text text-anchor="middle" x="362" y="-2410.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=896]</text>
</g>
<!-- mlp_linear1_dense1_0 -->
<g id="node35" class="node">
<title>mlp_linear1_dense1_0</title>
<ellipse fill="lightyellow" stroke="black" cx="14928" cy="-1890.62" rx="241.25" ry="36.54"/>
<text text-anchor="middle" x="14928" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="14928" y="-1893.62" font-family="Courier New" font-size="10.00">MLP Linear1 (1/8)</text>
<text text-anchor="middle" x="14928" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="14928" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
</g>
<!-- attn_allreduce_dense1&#45;&gt;mlp_linear1_dense1_0 -->
<g id="edge7" class="edge">
<title>attn_allreduce_dense1&#45;&gt;mlp_linear1_dense1_0</title>
<path fill="none" stroke="black" d="M14928,-2006.46C14928,-1984.52 14928,-1959.08 14928,-1937.73"/>
<polygon fill="black" stroke="black" points="14931.5,-1937.61 14928,-1927.61 14924.5,-1937.61 14931.5,-1937.61"/>
</g>
<!-- attn_allreduce_dense1&#45;&gt;mlp_linear1_dense1_0 -->
<g id="edge31" class="edge">
<title>attn_allreduce_dense1&#45;&gt;mlp_linear1_dense1_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14932.13,-2006.4C14932.49,-2000.41 14932.79,-1994.38 14933,-1988.62 14933.6,-1972.03 14933,-1953.86 14932.03,-1937.77"/>
<polygon fill="black" stroke="black" points="14935.51,-1937.28 14931.35,-1927.54 14928.52,-1937.75 14935.51,-1937.28"/>
<text text-anchor="middle" x="14964" y="-1977.42" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- mlp_gelu_dense1_0 -->
<g id="node43" class="node">
<title>mlp_gelu_dense1_0</title>
<polygon fill="lightgreen" stroke="black" points="15031.5,-1801.62 14690.5,-1801.62 14690.5,-1749.62 15031.5,-1749.62 15031.5,-1801.62"/>
<text text-anchor="middle" x="14861" y="-1789.62" font-family="Courier New" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="14861" y="-1778.62" font-family="Courier New" font-size="10.00">GELU</text>
<text text-anchor="middle" x="14861" y="-1767.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
<text text-anchor="middle" x="14861" y="-1756.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
</g>
<!-- mlp_linear1_dense1_0&#45;&gt;mlp_gelu_dense1_0 -->
<g id="edge8" class="edge">
<title>mlp_linear1_dense1_0&#45;&gt;mlp_gelu_dense1_0</title>
<path fill="none" stroke="black" d="M14906.8,-1853.86C14898.56,-1839.97 14889.17,-1824.13 14881.04,-1810.42"/>
<polygon fill="black" stroke="black" points="14884.02,-1808.58 14875.91,-1801.77 14878,-1812.15 14884.02,-1808.58"/>
</g>
<!-- mlp_linear1_dense1_1 -->
<g id="node36" class="node">
<title>mlp_linear1_dense1_1</title>
<ellipse fill="lightyellow" stroke="black" cx="14428" cy="-1890.62" rx="241.25" ry="36.54"/>
<text text-anchor="middle" x="14428" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="14428" y="-1893.62" font-family="Courier New" font-size="10.00">MLP Linear1 (2/8)</text>
<text text-anchor="middle" x="14428" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="14428" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
</g>
<!-- mlp_linear1_dense1_2 -->
<g id="node37" class="node">
<title>mlp_linear1_dense1_2</title>
<ellipse fill="lightyellow" stroke="black" cx="13928" cy="-1890.62" rx="241.25" ry="36.54"/>
<text text-anchor="middle" x="13928" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 2</text>
<text text-anchor="middle" x="13928" y="-1893.62" font-family="Courier New" font-size="10.00">MLP Linear1 (3/8)</text>
<text text-anchor="middle" x="13928" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="13928" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
</g>
<!-- mlp_linear1_dense1_3 -->
<g id="node38" class="node">
<title>mlp_linear1_dense1_3</title>
<ellipse fill="lightyellow" stroke="black" cx="13428" cy="-1890.62" rx="241.25" ry="36.54"/>
<text text-anchor="middle" x="13428" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 3</text>
<text text-anchor="middle" x="13428" y="-1893.62" font-family="Courier New" font-size="10.00">MLP Linear1 (4/8)</text>
<text text-anchor="middle" x="13428" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="13428" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
</g>
<!-- mlp_linear1_dense1_4 -->
<g id="node39" class="node">
<title>mlp_linear1_dense1_4</title>
<ellipse fill="lightyellow" stroke="black" cx="12928" cy="-1890.62" rx="241.25" ry="36.54"/>
<text text-anchor="middle" x="12928" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 4</text>
<text text-anchor="middle" x="12928" y="-1893.62" font-family="Courier New" font-size="10.00">MLP Linear1 (5/8)</text>
<text text-anchor="middle" x="12928" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="12928" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
</g>
<!-- mlp_linear1_dense1_5 -->
<g id="node40" class="node">
<title>mlp_linear1_dense1_5</title>
<ellipse fill="lightyellow" stroke="black" cx="12428" cy="-1890.62" rx="241.25" ry="36.54"/>
<text text-anchor="middle" x="12428" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 5</text>
<text text-anchor="middle" x="12428" y="-1893.62" font-family="Courier New" font-size="10.00">MLP Linear1 (6/8)</text>
<text text-anchor="middle" x="12428" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="12428" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
</g>
<!-- mlp_linear1_dense1_6 -->
<g id="node41" class="node">
<title>mlp_linear1_dense1_6</title>
<ellipse fill="lightyellow" stroke="black" cx="11928" cy="-1890.62" rx="241.25" ry="36.54"/>
<text text-anchor="middle" x="11928" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 6</text>
<text text-anchor="middle" x="11928" y="-1893.62" font-family="Courier New" font-size="10.00">MLP Linear1 (7/8)</text>
<text text-anchor="middle" x="11928" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="11928" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
</g>
<!-- mlp_linear1_dense1_7 -->
<g id="node42" class="node">
<title>mlp_linear1_dense1_7</title>
<ellipse fill="lightyellow" stroke="black" cx="11428" cy="-1890.62" rx="241.25" ry="36.54"/>
<text text-anchor="middle" x="11428" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 7</text>
<text text-anchor="middle" x="11428" y="-1893.62" font-family="Courier New" font-size="10.00">MLP Linear1 (8/8)</text>
<text text-anchor="middle" x="11428" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="11428" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
</g>
<!-- mlp_linear2_dense1_0 -->
<g id="node51" class="node">
<title>mlp_linear2_dense1_0</title>
<polygon fill="lightblue" stroke="black" points="15169.12,-1712.62 14616.93,-1712.62 14474.88,-1608.62 15027.07,-1608.62 15169.12,-1712.62"/>
<text text-anchor="middle" x="14822" y="-1674.62" font-family="Courier New" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="14822" y="-1663.62" font-family="Courier New" font-size="10.00">MLP Linear2 (1/8)</text>
<text text-anchor="middle" x="14822" y="-1652.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
<text text-anchor="middle" x="14822" y="-1641.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=896]</text>
</g>
<!-- mlp_gelu_dense1_0&#45;&gt;mlp_linear2_dense1_0 -->
<g id="edge9" class="edge">
<title>mlp_gelu_dense1_0&#45;&gt;mlp_linear2_dense1_0</title>
<path fill="none" stroke="black" d="M14852.34,-1749.54C14849.55,-1741.44 14846.32,-1732.09 14843.03,-1722.56"/>
<polygon fill="black" stroke="black" points="14846.31,-1721.33 14839.74,-1713.02 14839.69,-1723.61 14846.31,-1721.33"/>
</g>
<!-- mlp_gelu_dense1_1 -->
<g id="node44" class="node">
<title>mlp_gelu_dense1_1</title>
<polygon fill="lightgreen" stroke="black" points="11168.5,-1916.62 10827.5,-1916.62 10827.5,-1864.62 11168.5,-1864.62 11168.5,-1916.62"/>
<text text-anchor="middle" x="10998" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="10998" y="-1893.62" font-family="Courier New" font-size="10.00">GELU</text>
<text text-anchor="middle" x="10998" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
<text text-anchor="middle" x="10998" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
</g>
<!-- mlp_gelu_dense1_2 -->
<g id="node45" class="node">
<title>mlp_gelu_dense1_2</title>
<polygon fill="lightgreen" stroke="black" points="10809.5,-1916.62 10468.5,-1916.62 10468.5,-1864.62 10809.5,-1864.62 10809.5,-1916.62"/>
<text text-anchor="middle" x="10639" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 2</text>
<text text-anchor="middle" x="10639" y="-1893.62" font-family="Courier New" font-size="10.00">GELU</text>
<text text-anchor="middle" x="10639" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
<text text-anchor="middle" x="10639" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
</g>
<!-- mlp_gelu_dense1_3 -->
<g id="node46" class="node">
<title>mlp_gelu_dense1_3</title>
<polygon fill="lightgreen" stroke="black" points="10450.5,-1916.62 10109.5,-1916.62 10109.5,-1864.62 10450.5,-1864.62 10450.5,-1916.62"/>
<text text-anchor="middle" x="10280" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 3</text>
<text text-anchor="middle" x="10280" y="-1893.62" font-family="Courier New" font-size="10.00">GELU</text>
<text text-anchor="middle" x="10280" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
<text text-anchor="middle" x="10280" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
</g>
<!-- mlp_gelu_dense1_4 -->
<g id="node47" class="node">
<title>mlp_gelu_dense1_4</title>
<polygon fill="lightgreen" stroke="black" points="10091.5,-1916.62 9750.5,-1916.62 9750.5,-1864.62 10091.5,-1864.62 10091.5,-1916.62"/>
<text text-anchor="middle" x="9921" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 4</text>
<text text-anchor="middle" x="9921" y="-1893.62" font-family="Courier New" font-size="10.00">GELU</text>
<text text-anchor="middle" x="9921" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
<text text-anchor="middle" x="9921" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
</g>
<!-- mlp_gelu_dense1_5 -->
<g id="node48" class="node">
<title>mlp_gelu_dense1_5</title>
<polygon fill="lightgreen" stroke="black" points="9732.5,-1916.62 9391.5,-1916.62 9391.5,-1864.62 9732.5,-1864.62 9732.5,-1916.62"/>
<text text-anchor="middle" x="9562" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 5</text>
<text text-anchor="middle" x="9562" y="-1893.62" font-family="Courier New" font-size="10.00">GELU</text>
<text text-anchor="middle" x="9562" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
<text text-anchor="middle" x="9562" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
</g>
<!-- mlp_gelu_dense1_6 -->
<g id="node49" class="node">
<title>mlp_gelu_dense1_6</title>
<polygon fill="lightgreen" stroke="black" points="9373.5,-1916.62 9032.5,-1916.62 9032.5,-1864.62 9373.5,-1864.62 9373.5,-1916.62"/>
<text text-anchor="middle" x="9203" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 6</text>
<text text-anchor="middle" x="9203" y="-1893.62" font-family="Courier New" font-size="10.00">GELU</text>
<text text-anchor="middle" x="9203" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
<text text-anchor="middle" x="9203" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
</g>
<!-- mlp_gelu_dense1_7 -->
<g id="node50" class="node">
<title>mlp_gelu_dense1_7</title>
<polygon fill="lightgreen" stroke="black" points="9014.5,-1916.62 8673.5,-1916.62 8673.5,-1864.62 9014.5,-1864.62 9014.5,-1916.62"/>
<text text-anchor="middle" x="8844" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 7</text>
<text text-anchor="middle" x="8844" y="-1893.62" font-family="Courier New" font-size="10.00">GELU</text>
<text text-anchor="middle" x="8844" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
<text text-anchor="middle" x="8844" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
</g>
<!-- mlp_allreduce_dense1 -->
<g id="node59" class="node">
<title>mlp_allreduce_dense1</title>
<polygon fill="orange" stroke="black" points="15150.8,-1571.62 14627.75,-1571.62 14493.2,-1467.62 15016.25,-1467.62 15150.8,-1571.62"/>
<text text-anchor="middle" x="14822" y="-1533.62" font-family="Courier New" font-size="10.00">GPU: ALL</text>
<text text-anchor="middle" x="14822" y="-1522.62" font-family="Courier New" font-size="10.00">All&#45;Reduce MLP</text>
<text text-anchor="middle" x="14822" y="-1511.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=896]</text>
<text text-anchor="middle" x="14822" y="-1500.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=7168]</text>
</g>
<!-- mlp_linear2_dense1_0&#45;&gt;mlp_allreduce_dense1 -->
<g id="edge10" class="edge">
<title>mlp_linear2_dense1_0&#45;&gt;mlp_allreduce_dense1</title>
<path fill="none" stroke="black" d="M14822,-1608.25C14822,-1599.69 14822,-1590.74 14822,-1581.96"/>
<polygon fill="black" stroke="black" points="14825.5,-1581.77 14822,-1571.77 14818.5,-1581.77 14825.5,-1581.77"/>
</g>
<!-- mlp_linear2_dense1_1 -->
<g id="node52" class="node">
<title>mlp_linear2_dense1_1</title>
<polygon fill="lightblue" stroke="black" points="8655.12,-1942.62 8102.93,-1942.62 7960.88,-1838.62 8513.07,-1838.62 8655.12,-1942.62"/>
<text text-anchor="middle" x="8308" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="8308" y="-1893.62" font-family="Courier New" font-size="10.00">MLP Linear2 (2/8)</text>
<text text-anchor="middle" x="8308" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
<text text-anchor="middle" x="8308" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=896]</text>
</g>
<!-- mlp_linear2_dense1_2 -->
<g id="node53" class="node">
<title>mlp_linear2_dense1_2</title>
<polygon fill="lightblue" stroke="black" points="7942.12,-1942.62 7389.93,-1942.62 7247.88,-1838.62 7800.07,-1838.62 7942.12,-1942.62"/>
<text text-anchor="middle" x="7595" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 2</text>
<text text-anchor="middle" x="7595" y="-1893.62" font-family="Courier New" font-size="10.00">MLP Linear2 (3/8)</text>
<text text-anchor="middle" x="7595" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
<text text-anchor="middle" x="7595" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=896]</text>
</g>
<!-- mlp_linear2_dense1_3 -->
<g id="node54" class="node">
<title>mlp_linear2_dense1_3</title>
<polygon fill="lightblue" stroke="black" points="7229.12,-1942.62 6676.93,-1942.62 6534.88,-1838.62 7087.07,-1838.62 7229.12,-1942.62"/>
<text text-anchor="middle" x="6882" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 3</text>
<text text-anchor="middle" x="6882" y="-1893.62" font-family="Courier New" font-size="10.00">MLP Linear2 (4/8)</text>
<text text-anchor="middle" x="6882" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
<text text-anchor="middle" x="6882" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=896]</text>
</g>
<!-- mlp_linear2_dense1_4 -->
<g id="node55" class="node">
<title>mlp_linear2_dense1_4</title>
<polygon fill="lightblue" stroke="black" points="6516.12,-1942.62 5963.93,-1942.62 5821.88,-1838.62 6374.07,-1838.62 6516.12,-1942.62"/>
<text text-anchor="middle" x="6169" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 4</text>
<text text-anchor="middle" x="6169" y="-1893.62" font-family="Courier New" font-size="10.00">MLP Linear2 (5/8)</text>
<text text-anchor="middle" x="6169" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
<text text-anchor="middle" x="6169" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=896]</text>
</g>
<!-- mlp_linear2_dense1_5 -->
<g id="node56" class="node">
<title>mlp_linear2_dense1_5</title>
<polygon fill="lightblue" stroke="black" points="5803.12,-1942.62 5250.93,-1942.62 5108.88,-1838.62 5661.07,-1838.62 5803.12,-1942.62"/>
<text text-anchor="middle" x="5456" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 5</text>
<text text-anchor="middle" x="5456" y="-1893.62" font-family="Courier New" font-size="10.00">MLP Linear2 (6/8)</text>
<text text-anchor="middle" x="5456" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
<text text-anchor="middle" x="5456" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=896]</text>
</g>
<!-- mlp_linear2_dense1_6 -->
<g id="node57" class="node">
<title>mlp_linear2_dense1_6</title>
<polygon fill="lightblue" stroke="black" points="5090.12,-1942.62 4537.93,-1942.62 4395.88,-1838.62 4948.07,-1838.62 5090.12,-1942.62"/>
<text text-anchor="middle" x="4743" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 6</text>
<text text-anchor="middle" x="4743" y="-1893.62" font-family="Courier New" font-size="10.00">MLP Linear2 (7/8)</text>
<text text-anchor="middle" x="4743" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
<text text-anchor="middle" x="4743" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=896]</text>
</g>
<!-- mlp_linear2_dense1_7 -->
<g id="node58" class="node">
<title>mlp_linear2_dense1_7</title>
<polygon fill="lightblue" stroke="black" points="4377.12,-1942.62 3824.93,-1942.62 3682.88,-1838.62 4235.07,-1838.62 4377.12,-1942.62"/>
<text text-anchor="middle" x="4030" y="-1904.62" font-family="Courier New" font-size="10.00">GPU: 7</text>
<text text-anchor="middle" x="4030" y="-1893.62" font-family="Courier New" font-size="10.00">MLP Linear2 (8/8)</text>
<text text-anchor="middle" x="4030" y="-1882.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, ffn_hidden=2304]</text>
<text text-anchor="middle" x="4030" y="-1871.62" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=896]</text>
</g>
<!-- gating_moe4 -->
<g id="node61" class="node">
<title>gating_moe4</title>
<polygon fill="gold" stroke="black" points="15144.36,-1394.62 14631.56,-1394.62 14499.64,-1290.62 15012.44,-1290.62 15144.36,-1394.62"/>
<text text-anchor="middle" x="14822" y="-1356.62" font-family="Courier New" font-size="10.00">GPU: GATING</text>
<text text-anchor="middle" x="14822" y="-1345.62" font-family="Courier New" font-size="10.00">Expert Gating</text>
<text text-anchor="middle" x="14822" y="-1334.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="14822" y="-1323.62" font-family="Courier New" font-size="10.00">Output: [expert_id=128, tokens_per_expert=varies]</text>
</g>
<!-- mlp_allreduce_dense1&#45;&gt;gating_moe4 -->
<g id="edge11" class="edge">
<title>mlp_allreduce_dense1&#45;&gt;gating_moe4</title>
<path fill="none" stroke="black" d="M14822,-1467.53C14822,-1447.94 14822,-1425.38 14822,-1404.93"/>
<polygon fill="black" stroke="black" points="14825.5,-1404.77 14822,-1394.77 14818.5,-1404.77 14825.5,-1404.77"/>
</g>
<!-- attn_allreduce_moe4_ep0 -->
<g id="node60" class="node">
<title>attn_allreduce_moe4_ep0</title>
<polygon fill="orange" stroke="black" points="15852.36,-1394.62 15339.56,-1394.62 15207.64,-1290.62 15720.44,-1290.62 15852.36,-1394.62"/>
<text text-anchor="middle" x="15530" y="-1356.62" font-family="Courier New" font-size="10.00">GPU: EP0 Group</text>
<text text-anchor="middle" x="15530" y="-1345.62" font-family="Courier New" font-size="10.00">All&#45;Reduce Attention</text>
<text text-anchor="middle" x="15530" y="-1334.62" font-family="Courier New" font-size="10.00">Input: [batch_size=8, seq_len=2048, hidden=896]</text>
<text text-anchor="middle" x="15530" y="-1323.62" font-family="Courier New" font-size="10.00">Output: [batch_size=8, seq_len=2048, hidden=7168]</text>
</g>
<!-- token_routing_moe4 -->
<g id="node62" class="node">
<title>token_routing_moe4</title>
<polygon fill="lightcyan" stroke="black" points="15144.36,-1253.62 14631.56,-1253.62 14499.64,-1149.62 15012.44,-1149.62 15144.36,-1253.62"/>
<text text-anchor="middle" x="14822" y="-1215.62" font-family="Courier New" font-size="10.00">GPU: ROUTER</text>
<text text-anchor="middle" x="14822" y="-1204.62" font-family="Courier New" font-size="10.00">Token Router</text>
<text text-anchor="middle" x="14822" y="-1193.62" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="14822" y="-1182.62" font-family="Courier New" font-size="10.00">Output: [distributed to 128 experts]</text>
</g>
<!-- gating_moe4&#45;&gt;token_routing_moe4 -->
<g id="edge12" class="edge">
<title>gating_moe4&#45;&gt;token_routing_moe4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14822,-1290.25C14822,-1281.69 14822,-1272.74 14822,-1263.96"/>
<polygon fill="black" stroke="black" points="14825.5,-1263.77 14822,-1253.77 14818.5,-1263.77 14825.5,-1263.77"/>
</g>
<!-- expert0_moe4_gate -->
<g id="node63" class="node">
<title>expert0_moe4_gate</title>
<ellipse fill="pink" stroke="black" cx="14727" cy="-1048.85" rx="253.7" ry="36.54"/>
<text text-anchor="middle" x="14727" y="-1062.85" font-family="Courier New" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="14727" y="-1051.85" font-family="Courier New" font-size="10.00">Expert 0 Gate</text>
<text text-anchor="middle" x="14727" y="-1040.85" font-family="Courier New" font-size="10.00">Input: [tokens=varies, hidden=7168]</text>
<text text-anchor="middle" x="14727" y="-1029.85" font-family="Courier New" font-size="10.00">Output: [tokens=varies, hidden=7168, gate_weights=varies]</text>
</g>
<!-- token_routing_moe4&#45;&gt;expert0_moe4_gate -->
<g id="edge13" class="edge">
<title>token_routing_moe4&#45;&gt;expert0_moe4_gate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14789.84,-1149.57C14778.56,-1131.68 14765.99,-1111.73 14755.08,-1094.41"/>
<polygon fill="black" stroke="black" points="14757.83,-1092.21 14749.54,-1085.61 14751.91,-1095.94 14757.83,-1092.21"/>
<text text-anchor="middle" x="14827" y="-1120.42" font-family="Times,serif" font-size="14.00">Token routing</text>
</g>
<!-- expert1_moe4_gate -->
<g id="node69" class="node">
<title>expert1_moe4_gate</title>
<ellipse fill="lightpink" stroke="black" cx="15643" cy="-1048.85" rx="253.7" ry="36.54"/>
<text text-anchor="middle" x="15643" y="-1062.85" font-family="Courier New" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="15643" y="-1051.85" font-family="Courier New" font-size="10.00">Expert 1 Gate</text>
<text text-anchor="middle" x="15643" y="-1040.85" font-family="Courier New" font-size="10.00">Input: [tokens=varies, hidden=7168]</text>
<text text-anchor="middle" x="15643" y="-1029.85" font-family="Courier New" font-size="10.00">Output: [tokens=varies, hidden=7168, gate_weights=varies]</text>
</g>
<!-- token_routing_moe4&#45;&gt;expert1_moe4_gate -->
<g id="edge14" class="edge">
<title>token_routing_moe4&#45;&gt;expert1_moe4_gate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15036.14,-1168.21C15140.17,-1151.73 15266.87,-1130.57 15380,-1108.62 15420.01,-1100.85 15463.25,-1091.57 15502.88,-1082.7"/>
<polygon fill="black" stroke="black" points="15503.89,-1086.06 15512.88,-1080.45 15502.35,-1079.23 15503.89,-1086.06"/>
<text text-anchor="middle" x="15384" y="-1120.42" font-family="Times,serif" font-size="14.00">Token routing</text>
</g>
<!-- expert0_moe4_up_proj -->
<g id="node64" class="node">
<title>expert0_moe4_up_proj</title>
<ellipse fill="pink" stroke="black" cx="14924" cy="-846.77" rx="185.94" ry="36.54"/>
<text text-anchor="middle" x="14924" y="-860.77" font-family="Courier New" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="14924" y="-849.77" font-family="Courier New" font-size="10.00">Expert 0 Up&#45;Proj</text>
<text text-anchor="middle" x="14924" y="-838.77" font-family="Courier New" font-size="10.00">Input: [tokens=varies, hidden=7168]</text>
<text text-anchor="middle" x="14924" y="-827.77" font-family="Courier New" font-size="10.00">Output: [tokens=varies, ffn_hidden=18432]</text>
</g>
<!-- expert0_moe4_gate&#45;&gt;expert0_moe4_up_proj -->
<g id="edge15" class="edge">
<title>expert0_moe4_gate&#45;&gt;expert0_moe4_up_proj</title>
<path fill="none" stroke="black" d="M14861.75,-1017.57C14882.43,-1007.29 14901.38,-993.52 14915,-975.08 14931.96,-952.1 14934.13,-919.99 14932.09,-893.77"/>
<polygon fill="black" stroke="black" points="14935.56,-893.27 14931.09,-883.67 14928.6,-893.97 14935.56,-893.27"/>
</g>
<!-- expert0_moe4_gate_proj -->
<g id="node65" class="node">
<title>expert0_moe4_gate_proj</title>
<ellipse fill="pink" stroke="black" cx="14720" cy="-938.31" rx="185.94" ry="36.54"/>
<text text-anchor="middle" x="14720" y="-952.31" font-family="Courier New" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="14720" y="-941.31" font-family="Courier New" font-size="10.00">Expert 0 Gate&#45;Proj</text>
<text text-anchor="middle" x="14720" y="-930.31" font-family="Courier New" font-size="10.00">Input: [tokens=varies, hidden=7168]</text>
<text text-anchor="middle" x="14720" y="-919.31" font-family="Courier New" font-size="10.00">Output: [tokens=varies, ffn_hidden=18432]</text>
</g>
<!-- expert0_moe4_gate&#45;&gt;expert0_moe4_gate_proj -->
<g id="edge16" class="edge">
<title>expert0_moe4_gate&#45;&gt;expert0_moe4_gate_proj</title>
<path fill="none" stroke="black" d="M14724.69,-1012.01C14724.14,-1003.49 14723.55,-994.28 14722.97,-985.37"/>
<polygon fill="black" stroke="black" points="14726.45,-984.87 14722.31,-975.11 14719.46,-985.32 14726.45,-984.87"/>
</g>
<!-- expert0_moe4_mul -->
<g id="node67" class="node">
<title>expert0_moe4_mul</title>
<polygon fill="pink" stroke="black" points="14917.5,-677 14654.5,-677 14654.5,-625 14917.5,-625 14917.5,-677"/>
<text text-anchor="middle" x="14786" y="-665" font-family="Courier New" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="14786" y="-654" font-family="Courier New" font-size="10.00">Expert 0 Element&#45;wise Mul</text>
<text text-anchor="middle" x="14786" y="-643" font-family="Courier New" font-size="10.00">Input: [tokens=varies, ffn_hidden=18432]</text>
<text text-anchor="middle" x="14786" y="-632" font-family="Courier New" font-size="10.00">Output: [tokens=varies, ffn_hidden=18432]</text>
</g>
<!-- expert0_moe4_up_proj&#45;&gt;expert0_moe4_mul -->
<g id="edge17" class="edge">
<title>expert0_moe4_up_proj&#45;&gt;expert0_moe4_mul</title>
<path fill="none" stroke="black" d="M14920.63,-809.64C14917.26,-788.04 14910.51,-760.83 14897,-740 14882.18,-717.14 14859.39,-697.58 14838.32,-682.75"/>
<polygon fill="black" stroke="black" points="14840.27,-679.85 14830.04,-677.1 14836.32,-685.63 14840.27,-679.85"/>
</g>
<!-- expert0_moe4_silu -->
<g id="node66" class="node">
<title>expert0_moe4_silu</title>
<polygon fill="pink" stroke="black" points="14887.5,-792 14624.5,-792 14624.5,-740 14887.5,-740 14887.5,-792"/>
<text text-anchor="middle" x="14756" y="-780" font-family="Courier New" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="14756" y="-769" font-family="Courier New" font-size="10.00">Expert 0 SiLU</text>
<text text-anchor="middle" x="14756" y="-758" font-family="Courier New" font-size="10.00">Input: [tokens=varies, ffn_hidden=18432]</text>
<text text-anchor="middle" x="14756" y="-747" font-family="Courier New" font-size="10.00">Output: [tokens=varies, ffn_hidden=18432]</text>
</g>
<!-- expert0_moe4_gate_proj&#45;&gt;expert0_moe4_silu -->
<g id="edge18" class="edge">
<title>expert0_moe4_gate_proj&#45;&gt;expert0_moe4_silu</title>
<path fill="none" stroke="black" d="M14718.95,-901.37C14719.19,-875.41 14721.56,-839.82 14731,-810 14731.93,-807.05 14733.1,-804.08 14734.4,-801.16"/>
<polygon fill="black" stroke="black" points="14737.61,-802.57 14738.98,-792.06 14731.36,-799.42 14737.61,-802.57"/>
</g>
<!-- expert0_moe4_silu&#45;&gt;expert0_moe4_mul -->
<g id="edge19" class="edge">
<title>expert0_moe4_silu&#45;&gt;expert0_moe4_mul</title>
<path fill="none" stroke="black" d="M14762.66,-739.92C14766.81,-724.27 14772.22,-703.9 14776.79,-686.7"/>
<polygon fill="black" stroke="black" points="14780.18,-687.57 14779.36,-677.01 14773.41,-685.78 14780.18,-687.57"/>
</g>
<!-- expert0_moe4_down_proj -->
<g id="node68" class="node">
<title>expert0_moe4_down_proj</title>
<polygon fill="pink" stroke="black" points="15071.39,-562 14647.62,-562 14538.61,-458 14962.38,-458 15071.39,-562"/>
<text text-anchor="middle" x="14805" y="-524" font-family="Courier New" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="14805" y="-513" font-family="Courier New" font-size="10.00">Expert 0 Down&#45;Proj</text>
<text text-anchor="middle" x="14805" y="-502" font-family="Courier New" font-size="10.00">Input: [tokens=varies, ffn_hidden=18432]</text>
<text text-anchor="middle" x="14805" y="-491" font-family="Courier New" font-size="10.00">Output: [tokens=varies, hidden=7168]</text>
</g>
<!-- expert0_moe4_mul&#45;&gt;expert0_moe4_down_proj -->
<g id="edge20" class="edge">
<title>expert0_moe4_mul&#45;&gt;expert0_moe4_down_proj</title>
<path fill="none" stroke="black" d="M14789.44,-624.83C14791.45,-610.11 14794.09,-590.83 14796.62,-572.34"/>
<polygon fill="black" stroke="black" points="14800.12,-572.56 14798,-562.18 14793.18,-571.62 14800.12,-572.56"/>
</g>
<!-- expert_aggregation_moe4 -->
<g id="node75" class="node">
<title>expert_aggregation_moe4</title>
<polygon fill="gold" stroke="black" points="15250.8,-407 14727.75,-407 14593.2,-303 15116.25,-303 15250.8,-407"/>
<text text-anchor="middle" x="14922" y="-369" font-family="Courier New" font-size="10.00">GPU: AGGREGATOR</text>
<text text-anchor="middle" x="14922" y="-358" font-family="Courier New" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="14922" y="-347" font-family="Courier New" font-size="10.00">Input: [from 128 experts, hidden=7168]</text>
<text text-anchor="middle" x="14922" y="-336" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=7168]</text>
</g>
<!-- expert0_moe4_down_proj&#45;&gt;expert_aggregation_moe4 -->
<g id="edge26" class="edge">
<title>expert0_moe4_down_proj&#45;&gt;expert_aggregation_moe4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14844.28,-457.63C14854.66,-444.06 14865.95,-429.3 14876.62,-415.35"/>
<polygon fill="black" stroke="black" points="14879.52,-417.31 14882.82,-407.24 14873.96,-413.05 14879.52,-417.31"/>
<text text-anchor="middle" x="14915" y="-428.8" font-family="Times,serif" font-size="14.00">Expert result</text>
</g>
<!-- expert1_moe4_up_proj -->
<g id="node70" class="node">
<title>expert1_moe4_up_proj</title>
<ellipse fill="lightpink" stroke="black" cx="15586" cy="-938.31" rx="185.94" ry="36.54"/>
<text text-anchor="middle" x="15586" y="-952.31" font-family="Courier New" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="15586" y="-941.31" font-family="Courier New" font-size="10.00">Expert 1 Up&#45;Proj</text>
<text text-anchor="middle" x="15586" y="-930.31" font-family="Courier New" font-size="10.00">Input: [tokens=varies, hidden=7168]</text>
<text text-anchor="middle" x="15586" y="-919.31" font-family="Courier New" font-size="10.00">Output: [tokens=varies, ffn_hidden=18432]</text>
</g>
<!-- expert1_moe4_gate&#45;&gt;expert1_moe4_up_proj -->
<g id="edge21" class="edge">
<title>expert1_moe4_gate&#45;&gt;expert1_moe4_up_proj</title>
<path fill="none" stroke="black" d="M15624.18,-1012.01C15619.51,-1003.12 15614.45,-993.47 15609.58,-984.21"/>
<polygon fill="black" stroke="black" points="15612.55,-982.34 15604.8,-975.11 15606.35,-985.59 15612.55,-982.34"/>
</g>
<!-- expert1_moe4_mul -->
<g id="node73" class="node">
<title>expert1_moe4_mul</title>
<polygon fill="lightpink" stroke="black" points="15333.5,-792 15070.5,-792 15070.5,-740 15333.5,-740 15333.5,-792"/>
<text text-anchor="middle" x="15202" y="-780" font-family="Courier New" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="15202" y="-769" font-family="Courier New" font-size="10.00">Expert 1 Element&#45;wise Mul</text>
<text text-anchor="middle" x="15202" y="-758" font-family="Courier New" font-size="10.00">Input: [tokens=varies, ffn_hidden=18432]</text>
<text text-anchor="middle" x="15202" y="-747" font-family="Courier New" font-size="10.00">Output: [tokens=varies, ffn_hidden=18432]</text>
</g>
<!-- expert1_moe4_up_proj&#45;&gt;expert1_moe4_mul -->
<g id="edge22" class="edge">
<title>expert1_moe4_up_proj&#45;&gt;expert1_moe4_mul</title>
<path fill="none" stroke="black" d="M15511.96,-904.47C15441.29,-873.13 15335.82,-826.35 15267.96,-796.26"/>
<polygon fill="black" stroke="black" points="15269.21,-792.98 15258.65,-792.12 15266.37,-799.38 15269.21,-792.98"/>
</g>
<!-- expert1_moe4_gate_proj -->
<g id="node71" class="node">
<title>expert1_moe4_gate_proj</title>
<ellipse fill="lightpink" stroke="black" cx="15185" cy="-1048.85" rx="185.94" ry="36.54"/>
<text text-anchor="middle" x="15185" y="-1062.85" font-family="Courier New" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="15185" y="-1051.85" font-family="Courier New" font-size="10.00">Expert 1 Gate&#45;Proj</text>
<text text-anchor="middle" x="15185" y="-1040.85" font-family="Courier New" font-size="10.00">Input: [tokens=varies, hidden=7168]</text>
<text text-anchor="middle" x="15185" y="-1029.85" font-family="Courier New" font-size="10.00">Output: [tokens=varies, ffn_hidden=18432]</text>
</g>
<!-- expert1_moe4_silu -->
<g id="node72" class="node">
<title>expert1_moe4_silu</title>
<polygon fill="lightpink" stroke="black" points="15324.5,-964.31 15061.5,-964.31 15061.5,-912.31 15324.5,-912.31 15324.5,-964.31"/>
<text text-anchor="middle" x="15193" y="-952.31" font-family="Courier New" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="15193" y="-941.31" font-family="Courier New" font-size="10.00">Expert 1 SiLU</text>
<text text-anchor="middle" x="15193" y="-930.31" font-family="Courier New" font-size="10.00">Input: [tokens=varies, ffn_hidden=18432]</text>
<text text-anchor="middle" x="15193" y="-919.31" font-family="Courier New" font-size="10.00">Output: [tokens=varies, ffn_hidden=18432]</text>
</g>
<!-- expert1_moe4_gate_proj&#45;&gt;expert1_moe4_silu -->
<g id="edge23" class="edge">
<title>expert1_moe4_gate_proj&#45;&gt;expert1_moe4_silu</title>
<path fill="none" stroke="black" d="M15187.64,-1012.01C15188.53,-999.97 15189.52,-986.56 15190.4,-974.57"/>
<polygon fill="black" stroke="black" points="15193.9,-974.7 15191.15,-964.47 15186.92,-974.19 15193.9,-974.7"/>
</g>
<!-- expert1_moe4_silu&#45;&gt;expert1_moe4_mul -->
<g id="edge24" class="edge">
<title>expert1_moe4_silu&#45;&gt;expert1_moe4_mul</title>
<path fill="none" stroke="black" d="M15194.33,-912.18C15195.86,-883.12 15198.4,-835.1 15200.13,-802.3"/>
<polygon fill="black" stroke="black" points="15203.63,-802.4 15200.67,-792.23 15196.64,-802.03 15203.63,-802.4"/>
</g>
<!-- expert1_moe4_down_proj -->
<g id="node74" class="node">
<title>expert1_moe4_down_proj</title>
<polygon fill="lightpink" stroke="black" points="15468.39,-703 15044.62,-703 14935.61,-599 15359.38,-599 15468.39,-703"/>
<text text-anchor="middle" x="15202" y="-665" font-family="Courier New" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="15202" y="-654" font-family="Courier New" font-size="10.00">Expert 1 Down&#45;Proj</text>
<text text-anchor="middle" x="15202" y="-643" font-family="Courier New" font-size="10.00">Input: [tokens=varies, ffn_hidden=18432]</text>
<text text-anchor="middle" x="15202" y="-632" font-family="Courier New" font-size="10.00">Output: [tokens=varies, hidden=7168]</text>
</g>
<!-- expert1_moe4_mul&#45;&gt;expert1_moe4_down_proj -->
<g id="edge25" class="edge">
<title>expert1_moe4_mul&#45;&gt;expert1_moe4_down_proj</title>
<path fill="none" stroke="black" d="M15202,-739.92C15202,-732 15202,-722.86 15202,-713.54"/>
<polygon fill="black" stroke="black" points="15205.5,-713.4 15202,-703.4 15198.5,-713.4 15205.5,-713.4"/>
</g>
<!-- expert1_moe4_down_proj&#45;&gt;expert_aggregation_moe4 -->
<g id="edge27" class="edge">
<title>expert1_moe4_down_proj&#45;&gt;expert_aggregation_moe4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15177.39,-598.88C15155.75,-557.56 15121.32,-499.62 15080,-458 15063.6,-441.48 15044.07,-426.24 15024.43,-412.87"/>
<polygon fill="black" stroke="black" points="15026.28,-409.89 15016.02,-407.25 15022.39,-415.71 15026.28,-409.89"/>
<text text-anchor="middle" x="15203" y="-506.3" font-family="Times,serif" font-size="14.00">Expert result</text>
</g>
<!-- layer5_moe -->
<g id="node76" class="node">
<title>layer5_moe</title>
<polygon fill="lightgray" stroke="black" points="15080.5,-252 14763.5,-252 14763.5,-189 15080.5,-189 15080.5,-252"/>
<text text-anchor="middle" x="14922" y="-240" font-family="Courier New" font-size="10.00">Layer 5 &#45; MoE Layer</text>
<text text-anchor="middle" x="14922" y="-229" font-family="Courier New" font-size="10.00">GPU: 0&#45;127</text>
<text text-anchor="middle" x="14922" y="-218" font-family="Courier New" font-size="10.00">Parallel execution across all GPUs</text>
<text text-anchor="middle" x="14922" y="-207" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="14922" y="-196" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=7168]</text>
</g>
<!-- expert_aggregation_moe4&#45;&gt;layer5_moe -->
<g id="edge28" class="edge">
<title>expert_aggregation_moe4&#45;&gt;layer5_moe</title>
<path fill="none" stroke="black" d="M14922,-302.77C14922,-289.46 14922,-275.29 14922,-262.58"/>
<polygon fill="black" stroke="black" points="14925.5,-262.29 14922,-252.29 14918.5,-262.29 14925.5,-262.29"/>
</g>
<!-- expert_aggregation_moe4&#45;&gt;layer5_moe -->
<g id="edge32" class="edge">
<title>expert_aggregation_moe4&#45;&gt;layer5_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14932.66,-302.95C14933.81,-292.09 14934.19,-280.67 14933,-270 14932.71,-267.45 14932.35,-264.83 14931.92,-262.21"/>
<polygon fill="black" stroke="black" points="14935.31,-261.3 14930.03,-252.11 14928.43,-262.59 14935.31,-261.3"/>
<text text-anchor="middle" x="14964" y="-273.8" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- layer6_moe -->
<g id="node77" class="node">
<title>layer6_moe</title>
<polygon fill="lightgray" stroke="black" points="15080.5,-152 14763.5,-152 14763.5,-89 15080.5,-89 15080.5,-152"/>
<text text-anchor="middle" x="14922" y="-140" font-family="Courier New" font-size="10.00">Layer 6 &#45; MoE Layer</text>
<text text-anchor="middle" x="14922" y="-129" font-family="Courier New" font-size="10.00">GPU: 0&#45;127</text>
<text text-anchor="middle" x="14922" y="-118" font-family="Courier New" font-size="10.00">Parallel execution across all GPUs</text>
<text text-anchor="middle" x="14922" y="-107" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="14922" y="-96" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, hidden=7168]</text>
</g>
<!-- layer5_moe&#45;&gt;layer6_moe -->
<g id="edge29" class="edge">
<title>layer5_moe&#45;&gt;layer6_moe</title>
<path fill="none" stroke="black" d="M14922,-188.76C14922,-180.37 14922,-171.14 14922,-162.29"/>
<polygon fill="black" stroke="black" points="14925.5,-162.13 14922,-152.13 14918.5,-162.13 14925.5,-162.13"/>
</g>
<!-- output_node -->
<g id="node78" class="node">
<title>output_node</title>
<polygon fill="lightcoral" stroke="black" points="15077.5,-52 14766.5,-52 14766.5,0 15077.5,0 15077.5,-52"/>
<text text-anchor="middle" x="14922" y="-40" font-family="Courier New" font-size="10.00">GPU: OUTPUT</text>
<text text-anchor="middle" x="14922" y="-29" font-family="Courier New" font-size="10.00">Output Layer</text>
<text text-anchor="middle" x="14922" y="-18" font-family="Courier New" font-size="10.00">Input: [batch_size=32, seq_len=2048, hidden=7168]</text>
<text text-anchor="middle" x="14922" y="-7" font-family="Courier New" font-size="10.00">Output: [batch_size=32, seq_len=2048, vocab_size]</text>
</g>
<!-- layer6_moe&#45;&gt;output_node -->
<g id="edge30" class="edge">
<title>layer6_moe&#45;&gt;output_node</title>
<path fill="none" stroke="black" d="M14922,-88.96C14922,-80.5 14922,-71.25 14922,-62.54"/>
<polygon fill="black" stroke="black" points="14925.5,-62.27 14922,-52.27 14918.5,-62.27 14925.5,-62.27"/>
</g>
</g>
</svg>
