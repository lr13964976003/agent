<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Baseline_MoE_Complete Pages: 1 -->
<svg width="52820pt" height="1405pt"
 viewBox="0.00 0.00 52820.39 1405.25" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1401.25)">
<title>Baseline_MoE_Complete</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1401.25 52816.39,-1401.25 52816.39,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="lightblue" stroke="black" points="2447.7,-1352.25 2173.7,-1352.25 2173.7,-1316.25 2447.7,-1316.25 2447.7,-1352.25"/>
<text text-anchor="middle" x="2310.7" y="-1337.25" font-family="Arial" font-size="10.00">Model Input</text>
<text text-anchor="middle" x="2310.7" y="-1326.25" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer0_mha -->
<g id="node2" class="node">
<title>layer0_mha</title>
<polygon fill="lightcyan" stroke="black" points="2331.2,-1228.98 2050.2,-1228.98 2050.2,-1165.98 2331.2,-1165.98 2331.2,-1228.98"/>
<text text-anchor="middle" x="2190.7" y="-1216.98" font-family="Arial" font-size="10.00">MHA Layer 0</text>
<text text-anchor="middle" x="2190.7" y="-1205.98" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="2190.7" y="-1194.98" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="2190.7" y="-1183.98" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="2190.7" y="-1172.98" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- input&#45;&gt;layer0_mha -->
<g id="edge1" class="edge">
<title>input&#45;&gt;layer0_mha</title>
<path fill="none" stroke="black" d="M2252.45,-1316.09C2252.45,-1316.09 2252.45,-1239.1 2252.45,-1239.1"/>
<polygon fill="black" stroke="black" points="2255.95,-1239.1 2252.45,-1229.1 2248.95,-1239.1 2255.95,-1239.1"/>
</g>
<!-- layer0_add1 -->
<g id="node4" class="node">
<title>layer0_add1</title>
<polygon fill="yellow" stroke="black" points="2457.2,-1001.94 2176.2,-1001.94 2176.2,-949.94 2457.2,-949.94 2457.2,-1001.94"/>
<text text-anchor="middle" x="2316.7" y="-989.94" font-family="Arial" font-size="10.00">MHA Residual Add 0</text>
<text text-anchor="middle" x="2316.7" y="-978.94" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="2316.7" y="-967.94" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="2316.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- input&#45;&gt;layer0_add1 -->
<g id="edge4" class="edge">
<title>input&#45;&gt;layer0_add1</title>
<path fill="none" stroke="black" d="M2389.45,-1315.99C2389.45,-1315.99 2389.45,-1012.06 2389.45,-1012.06"/>
<polygon fill="black" stroke="black" points="2392.95,-1012.06 2389.45,-1002.06 2385.95,-1012.06 2392.95,-1012.06"/>
</g>
<!-- layer0_ln1 -->
<g id="node3" class="node">
<title>layer0_ln1</title>
<polygon fill="none" stroke="black" points="2331.2,-1118.21 2050.2,-1118.21 2050.2,-1055.21 2331.2,-1055.21 2331.2,-1118.21"/>
<text text-anchor="middle" x="2190.7" y="-1106.21" font-family="Arial" font-size="10.00">LayerNorm MHA 0</text>
<text text-anchor="middle" x="2190.7" y="-1095.21" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="2190.7" y="-1084.21" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="2190.7" y="-1073.21" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="2190.7" y="-1062.21" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer0_mha&#45;&gt;layer0_ln1 -->
<g id="edge2" class="edge">
<title>layer0_mha&#45;&gt;layer0_ln1</title>
<path fill="none" stroke="black" d="M2190.7,-1165.74C2190.7,-1165.74 2190.7,-1128.46 2190.7,-1128.46"/>
<polygon fill="black" stroke="black" points="2194.2,-1128.46 2190.7,-1118.46 2187.2,-1128.46 2194.2,-1128.46"/>
</g>
<!-- layer0_ln1&#45;&gt;layer0_add1 -->
<g id="edge3" class="edge">
<title>layer0_ln1&#45;&gt;layer0_add1</title>
<path fill="none" stroke="black" d="M2253.7,-1054.97C2253.7,-1054.97 2253.7,-1012.09 2253.7,-1012.09"/>
<polygon fill="black" stroke="black" points="2257.2,-1012.09 2253.7,-1002.09 2250.2,-1012.09 2257.2,-1012.09"/>
</g>
<!-- layer0_gate -->
<g id="node5" class="node">
<title>layer0_gate</title>
<polygon fill="lightgreen" stroke="black" points="2147.13,-902.17 1688.3,-902.17 1570.26,-776.17 2029.1,-776.17 2147.13,-902.17"/>
<text text-anchor="middle" x="1858.7" y="-858.67" font-family="Arial" font-size="10.00">Gate Layer 0</text>
<text text-anchor="middle" x="1858.7" y="-847.67" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="1858.7" y="-836.67" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="1858.7" y="-825.67" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="1858.7" y="-814.67" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, num_experts=16]</text>
</g>
<!-- layer0_add1&#45;&gt;layer0_gate -->
<g id="edge5" class="edge">
<title>layer0_add1&#45;&gt;layer0_gate</title>
<path fill="none" stroke="black" d="M2176.08,-975C2133.87,-975 2098.56,-975 2098.56,-975 2098.56,-975 2098.56,-912.32 2098.56,-912.32"/>
<polygon fill="black" stroke="black" points="2102.06,-912.32 2098.56,-902.32 2095.06,-912.32 2102.06,-912.32"/>
</g>
<!-- layer0_moe_output -->
<g id="node8" class="node">
<title>layer0_moe_output</title>
<polygon fill="yellow" stroke="black" points="3386.2,-152 3105.2,-152 3105.2,-100 3386.2,-100 3386.2,-152"/>
<text text-anchor="middle" x="3245.7" y="-140" font-family="Arial" font-size="10.00">MoE Residual Add 0</text>
<text text-anchor="middle" x="3245.7" y="-129" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="3245.7" y="-118" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="3245.7" y="-107" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer0_add1&#45;&gt;layer0_moe_output -->
<g id="edge40" class="edge">
<title>layer0_add1&#45;&gt;layer0_moe_output</title>
<path fill="none" stroke="black" d="M2316.7,-949.94C2316.7,-935.33 2316.7,-920 2316.7,-920 2316.7,-920 3344.3,-920 3344.3,-920 3344.3,-920 3344.3,-162.42 3344.3,-162.42"/>
<polygon fill="black" stroke="black" points="3347.8,-162.42 3344.3,-152.42 3340.8,-162.42 3347.8,-162.42"/>
</g>
<!-- layer0_route_gpu0 -->
<g id="node9" class="node">
<title>layer0_route_gpu0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="234.7" cy="-702.4" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="234.7" y="-716.4" font-family="Arial" font-size="10.00">Route to GPU 0</text>
<text text-anchor="middle" x="234.7" y="-705.4" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="234.7" y="-694.4" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="234.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_route_gpu0 -->
<g id="edge6" class="edge">
<title>layer0_gate&#45;&gt;layer0_route_gpu0</title>
<path fill="none" stroke="black" d="M1657.93,-870C1223.43,-870 234.7,-870 234.7,-870 234.7,-870 234.7,-749.18 234.7,-749.18"/>
<polygon fill="black" stroke="black" points="238.2,-749.18 234.7,-739.18 231.2,-749.18 238.2,-749.18"/>
</g>
<!-- layer0_route_gpu1 -->
<g id="node12" class="node">
<title>layer0_route_gpu1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="641.7" cy="-702.4" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="641.7" y="-716.4" font-family="Arial" font-size="10.00">Route to GPU 1</text>
<text text-anchor="middle" x="641.7" y="-705.4" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="641.7" y="-694.4" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="641.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_route_gpu1 -->
<g id="edge10" class="edge">
<title>layer0_gate&#45;&gt;layer0_route_gpu1</title>
<path fill="none" stroke="black" d="M1629.07,-839C1276.39,-839 641.7,-839 641.7,-839 641.7,-839 641.7,-749.37 641.7,-749.37"/>
<polygon fill="black" stroke="black" points="645.2,-749.37 641.7,-739.37 638.2,-749.37 645.2,-749.37"/>
</g>
<!-- layer0_route_gpu2 -->
<g id="node15" class="node">
<title>layer0_route_gpu2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1047.7" cy="-702.4" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="1047.7" y="-716.4" font-family="Arial" font-size="10.00">Route to GPU 2</text>
<text text-anchor="middle" x="1047.7" y="-705.4" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="1047.7" y="-694.4" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="1047.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_route_gpu2 -->
<g id="edge14" class="edge">
<title>layer0_gate&#45;&gt;layer0_route_gpu2</title>
<path fill="none" stroke="black" d="M1599.02,-807C1361.78,-807 1047.7,-807 1047.7,-807 1047.7,-807 1047.7,-749.28 1047.7,-749.28"/>
<polygon fill="black" stroke="black" points="1051.2,-749.28 1047.7,-739.28 1044.2,-749.28 1051.2,-749.28"/>
</g>
<!-- layer0_route_gpu3 -->
<g id="node18" class="node">
<title>layer0_route_gpu3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1453.7" cy="-702.4" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="1453.7" y="-716.4" font-family="Arial" font-size="10.00">Route to GPU 3</text>
<text text-anchor="middle" x="1453.7" y="-705.4" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="1453.7" y="-694.4" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="1453.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_route_gpu3 -->
<g id="edge18" class="edge">
<title>layer0_gate&#45;&gt;layer0_route_gpu3</title>
<path fill="none" stroke="black" d="M1608.96,-839.07C1608.96,-839.07 1608.96,-734.66 1608.96,-734.66"/>
<polygon fill="black" stroke="black" points="1612.46,-734.66 1608.96,-724.66 1605.46,-734.66 1612.46,-734.66"/>
</g>
<!-- layer0_route_gpu4 -->
<g id="node21" class="node">
<title>layer0_route_gpu4</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1858.7" cy="-702.4" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="1858.7" y="-716.4" font-family="Arial" font-size="10.00">Route to GPU 4</text>
<text text-anchor="middle" x="1858.7" y="-705.4" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="1858.7" y="-694.4" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="1858.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_route_gpu4 -->
<g id="edge22" class="edge">
<title>layer0_gate&#45;&gt;layer0_route_gpu4</title>
<path fill="none" stroke="black" d="M1858.7,-775.99C1858.7,-775.99 1858.7,-749.21 1858.7,-749.21"/>
<polygon fill="black" stroke="black" points="1862.2,-749.21 1858.7,-739.21 1855.2,-749.21 1862.2,-749.21"/>
</g>
<!-- layer0_route_gpu5 -->
<g id="node24" class="node">
<title>layer0_route_gpu5</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="2264.7" cy="-702.4" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="2264.7" y="-716.4" font-family="Arial" font-size="10.00">Route to GPU 5</text>
<text text-anchor="middle" x="2264.7" y="-705.4" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="2264.7" y="-694.4" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="2264.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_route_gpu5 -->
<g id="edge26" class="edge">
<title>layer0_gate&#45;&gt;layer0_route_gpu5</title>
<path fill="none" stroke="black" d="M2108.93,-839.07C2108.93,-839.07 2108.93,-734.36 2108.93,-734.36"/>
<polygon fill="black" stroke="black" points="2112.43,-734.36 2108.93,-724.36 2105.43,-734.36 2112.43,-734.36"/>
</g>
<!-- layer0_route_gpu6 -->
<g id="node27" class="node">
<title>layer0_route_gpu6</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="2672.7" cy="-702.4" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="2672.7" y="-716.4" font-family="Arial" font-size="10.00">Route to GPU 6</text>
<text text-anchor="middle" x="2672.7" y="-705.4" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="2672.7" y="-694.4" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="2672.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_route_gpu6 -->
<g id="edge30" class="edge">
<title>layer0_gate&#45;&gt;layer0_route_gpu6</title>
<path fill="none" stroke="black" d="M2034.57,-782C2273.89,-782 2672.7,-782 2672.7,-782 2672.7,-782 2672.7,-749.41 2672.7,-749.41"/>
<polygon fill="black" stroke="black" points="2676.2,-749.41 2672.7,-739.41 2669.2,-749.41 2676.2,-749.41"/>
</g>
<!-- layer0_route_gpu7 -->
<g id="node30" class="node">
<title>layer0_route_gpu7</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="3078.7" cy="-702.4" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="3078.7" y="-716.4" font-family="Arial" font-size="10.00">Route to GPU 7</text>
<text text-anchor="middle" x="3078.7" y="-705.4" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="3078.7" y="-694.4" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="3078.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_route_gpu7 -->
<g id="edge34" class="edge">
<title>layer0_gate&#45;&gt;layer0_route_gpu7</title>
<path fill="none" stroke="black" d="M2040.45,-788C2352.62,-788 2957.47,-788 2957.47,-788 2957.47,-788 2957.47,-741.38 2957.47,-741.38"/>
<polygon fill="black" stroke="black" points="2960.97,-741.38 2957.47,-731.38 2953.97,-741.38 2960.97,-741.38"/>
</g>
<!-- layer0_moe_agg -->
<g id="node6" class="node">
<title>layer0_moe_agg</title>
<ellipse fill="gold" stroke="black" cx="1858.7" cy="-333.55" rx="205.12" ry="44.6"/>
<text text-anchor="middle" x="1858.7" y="-353.05" font-family="Arial" font-size="10.00">MoE Final Aggregation 0</text>
<text text-anchor="middle" x="1858.7" y="-342.05" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="1858.7" y="-331.05" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="1858.7" y="-320.05" font-family="Arial" font-size="10.00">Input: 16Ã—[batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="1858.7" y="-309.05" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer0_ln2 -->
<g id="node7" class="node">
<title>layer0_ln2</title>
<polygon fill="none" stroke="black" points="2976.2,-252 2695.2,-252 2695.2,-189 2976.2,-189 2976.2,-252"/>
<text text-anchor="middle" x="2835.7" y="-240" font-family="Arial" font-size="10.00">LayerNorm MoE 0</text>
<text text-anchor="middle" x="2835.7" y="-229" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="2835.7" y="-218" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="2835.7" y="-207" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="2835.7" y="-196" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer0_moe_agg&#45;&gt;layer0_ln2 -->
<g id="edge38" class="edge">
<title>layer0_moe_agg&#45;&gt;layer0_ln2</title>
<path fill="none" stroke="black" d="M2020.08,-306C2287,-306 2791.3,-306 2791.3,-306 2791.3,-306 2791.3,-262.34 2791.3,-262.34"/>
<polygon fill="black" stroke="black" points="2794.8,-262.34 2791.3,-252.34 2787.8,-262.34 2794.8,-262.34"/>
</g>
<!-- layer0_ln2&#45;&gt;layer0_moe_output -->
<g id="edge39" class="edge">
<title>layer0_ln2&#45;&gt;layer0_moe_output</title>
<path fill="none" stroke="black" d="M2976.43,-220C3080.35,-220 3203.8,-220 3203.8,-220 3203.8,-220 3203.8,-162.18 3203.8,-162.18"/>
<polygon fill="black" stroke="black" points="3207.3,-162.18 3203.8,-152.18 3200.3,-162.18 3207.3,-162.18"/>
</g>
<!-- layer1_mha -->
<g id="node33" class="node">
<title>layer1_mha</title>
<polygon fill="lightcyan" stroke="black" points="3386.2,-63 3105.2,-63 3105.2,0 3386.2,0 3386.2,-63"/>
<text text-anchor="middle" x="3245.7" y="-51" font-family="Arial" font-size="10.00">MHA Layer 1</text>
<text text-anchor="middle" x="3245.7" y="-40" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="3245.7" y="-29" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="3245.7" y="-18" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="3245.7" y="-7" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer0_moe_output&#45;&gt;layer1_mha -->
<g id="edge566" class="edge">
<title>layer0_moe_output&#45;&gt;layer1_mha</title>
<path fill="none" stroke="black" d="M3245.7,-99.93C3245.7,-99.93 3245.7,-73.21 3245.7,-73.21"/>
<polygon fill="black" stroke="black" points="3249.2,-73.21 3245.7,-63.21 3242.2,-73.21 3249.2,-73.21"/>
</g>
<!-- layer0_experts_gpu0 -->
<g id="node10" class="node">
<title>layer0_experts_gpu0</title>
<polygon fill="lightcoral" stroke="black" points="318.2,-628.63 109.2,-628.63 109.2,-554.63 318.2,-554.63 318.2,-628.63"/>
<text text-anchor="middle" x="213.7" y="-616.63" font-family="Arial" font-size="10.00">8 Experts GPU 0</text>
<text text-anchor="middle" x="213.7" y="-605.63" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="213.7" y="-594.63" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="213.7" y="-583.63" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="213.7" y="-572.63" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="213.7" y="-561.63" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer0_route_gpu0&#45;&gt;layer0_experts_gpu0 -->
<g id="edge7" class="edge">
<title>layer0_route_gpu0&#45;&gt;layer0_experts_gpu0</title>
<path fill="none" stroke="black" d="M213.7,-665.83C213.7,-665.83 213.7,-638.93 213.7,-638.93"/>
<polygon fill="black" stroke="black" points="217.2,-638.93 213.7,-628.93 210.2,-638.93 217.2,-638.93"/>
</g>
<!-- layer0_agg_gpu0 -->
<g id="node11" class="node">
<title>layer0_agg_gpu0</title>
<ellipse fill="lightpink" stroke="black" cx="198.7" cy="-451.87" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="198.7" y="-465.87" font-family="Arial" font-size="10.00">Aggregate GPU 0</text>
<text text-anchor="middle" x="198.7" y="-454.87" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="198.7" y="-443.87" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="198.7" y="-432.87" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer0_experts_gpu0&#45;&gt;layer0_agg_gpu0 -->
<g id="edge8" class="edge">
<title>layer0_experts_gpu0&#45;&gt;layer0_agg_gpu0</title>
<path fill="none" stroke="black" d="M213.7,-554.55C213.7,-554.55 213.7,-498.64 213.7,-498.64"/>
<polygon fill="black" stroke="black" points="217.2,-498.64 213.7,-488.64 210.2,-498.64 217.2,-498.64"/>
</g>
<!-- layer0_agg_gpu0&#45;&gt;layer0_moe_agg -->
<g id="edge9" class="edge">
<title>layer0_agg_gpu0&#45;&gt;layer0_moe_agg</title>
<path fill="none" stroke="black" d="M198.7,-415.06C198.7,-371.85 198.7,-306 198.7,-306 198.7,-306 1687.26,-306 1687.26,-306"/>
<polygon fill="black" stroke="black" points="1687.26,-309.5 1697.26,-306 1687.26,-302.5 1687.26,-309.5"/>
</g>
<!-- layer0_experts_gpu1 -->
<g id="node13" class="node">
<title>layer0_experts_gpu1</title>
<polygon fill="lightcoral" stroke="black" points="736.2,-628.63 527.2,-628.63 527.2,-554.63 736.2,-554.63 736.2,-628.63"/>
<text text-anchor="middle" x="631.7" y="-616.63" font-family="Arial" font-size="10.00">8 Experts GPU 1</text>
<text text-anchor="middle" x="631.7" y="-605.63" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="631.7" y="-594.63" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="631.7" y="-583.63" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="631.7" y="-572.63" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="631.7" y="-561.63" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer0_route_gpu1&#45;&gt;layer0_experts_gpu1 -->
<g id="edge11" class="edge">
<title>layer0_route_gpu1&#45;&gt;layer0_experts_gpu1</title>
<path fill="none" stroke="black" d="M631.7,-665.52C631.7,-665.52 631.7,-638.74 631.7,-638.74"/>
<polygon fill="black" stroke="black" points="635.2,-638.74 631.7,-628.74 628.2,-638.74 635.2,-638.74"/>
</g>
<!-- layer0_agg_gpu1 -->
<g id="node14" class="node">
<title>layer0_agg_gpu1</title>
<ellipse fill="lightpink" stroke="black" cx="613.7" cy="-451.87" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="613.7" y="-465.87" font-family="Arial" font-size="10.00">Aggregate GPU 1</text>
<text text-anchor="middle" x="613.7" y="-454.87" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="613.7" y="-443.87" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="613.7" y="-432.87" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer0_experts_gpu1&#45;&gt;layer0_agg_gpu1 -->
<g id="edge12" class="edge">
<title>layer0_experts_gpu1&#45;&gt;layer0_agg_gpu1</title>
<path fill="none" stroke="black" d="M631.7,-554.55C631.7,-554.55 631.7,-498.64 631.7,-498.64"/>
<polygon fill="black" stroke="black" points="635.2,-498.64 631.7,-488.64 628.2,-498.64 635.2,-498.64"/>
</g>
<!-- layer0_agg_gpu1&#45;&gt;layer0_moe_agg -->
<g id="edge13" class="edge">
<title>layer0_agg_gpu1&#45;&gt;layer0_moe_agg</title>
<path fill="none" stroke="black" d="M613.7,-414.88C613.7,-377.12 613.7,-324 613.7,-324 613.7,-324 1648.32,-324 1648.32,-324"/>
<polygon fill="black" stroke="black" points="1648.32,-327.5 1658.32,-324 1648.32,-320.5 1648.32,-327.5"/>
</g>
<!-- layer0_experts_gpu2 -->
<g id="node16" class="node">
<title>layer0_experts_gpu2</title>
<polygon fill="lightcoral" stroke="black" points="1140.2,-628.63 931.2,-628.63 931.2,-554.63 1140.2,-554.63 1140.2,-628.63"/>
<text text-anchor="middle" x="1035.7" y="-616.63" font-family="Arial" font-size="10.00">8 Experts GPU 2</text>
<text text-anchor="middle" x="1035.7" y="-605.63" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="1035.7" y="-594.63" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="1035.7" y="-583.63" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="1035.7" y="-572.63" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="1035.7" y="-561.63" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer0_route_gpu2&#45;&gt;layer0_experts_gpu2 -->
<g id="edge15" class="edge">
<title>layer0_route_gpu2&#45;&gt;layer0_experts_gpu2</title>
<path fill="none" stroke="black" d="M1035.7,-665.52C1035.7,-665.52 1035.7,-638.74 1035.7,-638.74"/>
<polygon fill="black" stroke="black" points="1039.2,-638.74 1035.7,-628.74 1032.2,-638.74 1039.2,-638.74"/>
</g>
<!-- layer0_agg_gpu2 -->
<g id="node17" class="node">
<title>layer0_agg_gpu2</title>
<ellipse fill="lightpink" stroke="black" cx="1028.7" cy="-451.87" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="1028.7" y="-465.87" font-family="Arial" font-size="10.00">Aggregate GPU 2</text>
<text text-anchor="middle" x="1028.7" y="-454.87" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="1028.7" y="-443.87" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="1028.7" y="-432.87" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer0_experts_gpu2&#45;&gt;layer0_agg_gpu2 -->
<g id="edge16" class="edge">
<title>layer0_experts_gpu2&#45;&gt;layer0_agg_gpu2</title>
<path fill="none" stroke="black" d="M1035.7,-554.55C1035.7,-554.55 1035.7,-498.64 1035.7,-498.64"/>
<polygon fill="black" stroke="black" points="1039.2,-498.64 1035.7,-488.64 1032.2,-498.64 1039.2,-498.64"/>
</g>
<!-- layer0_agg_gpu2&#45;&gt;layer0_moe_agg -->
<g id="edge17" class="edge">
<title>layer0_agg_gpu2&#45;&gt;layer0_moe_agg</title>
<path fill="none" stroke="black" d="M1028.7,-414.98C1028.7,-383.06 1028.7,-342 1028.7,-342 1028.7,-342 1647.25,-342 1647.25,-342"/>
<polygon fill="black" stroke="black" points="1647.25,-345.5 1657.25,-342 1647.25,-338.5 1647.25,-345.5"/>
</g>
<!-- layer0_experts_gpu3 -->
<g id="node19" class="node">
<title>layer0_experts_gpu3</title>
<polygon fill="lightcoral" stroke="black" points="1555.2,-628.63 1346.2,-628.63 1346.2,-554.63 1555.2,-554.63 1555.2,-628.63"/>
<text text-anchor="middle" x="1450.7" y="-616.63" font-family="Arial" font-size="10.00">8 Experts GPU 3</text>
<text text-anchor="middle" x="1450.7" y="-605.63" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="1450.7" y="-594.63" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="1450.7" y="-583.63" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="1450.7" y="-572.63" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="1450.7" y="-561.63" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer0_route_gpu3&#45;&gt;layer0_experts_gpu3 -->
<g id="edge19" class="edge">
<title>layer0_route_gpu3&#45;&gt;layer0_experts_gpu3</title>
<path fill="none" stroke="black" d="M1450.7,-665.52C1450.7,-665.52 1450.7,-638.74 1450.7,-638.74"/>
<polygon fill="black" stroke="black" points="1454.2,-638.74 1450.7,-628.74 1447.2,-638.74 1454.2,-638.74"/>
</g>
<!-- layer0_agg_gpu3 -->
<g id="node20" class="node">
<title>layer0_agg_gpu3</title>
<ellipse fill="lightpink" stroke="black" cx="1443.7" cy="-451.87" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="1443.7" y="-465.87" font-family="Arial" font-size="10.00">Aggregate GPU 3</text>
<text text-anchor="middle" x="1443.7" y="-454.87" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="1443.7" y="-443.87" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="1443.7" y="-432.87" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer0_experts_gpu3&#45;&gt;layer0_agg_gpu3 -->
<g id="edge20" class="edge">
<title>layer0_experts_gpu3&#45;&gt;layer0_agg_gpu3</title>
<path fill="none" stroke="black" d="M1450.7,-554.55C1450.7,-554.55 1450.7,-498.64 1450.7,-498.64"/>
<polygon fill="black" stroke="black" points="1454.2,-498.64 1450.7,-488.64 1447.2,-498.64 1454.2,-498.64"/>
</g>
<!-- layer0_agg_gpu3&#45;&gt;layer0_moe_agg -->
<g id="edge21" class="edge">
<title>layer0_agg_gpu3&#45;&gt;layer0_moe_agg</title>
<path fill="none" stroke="black" d="M1443.7,-415.03C1443.7,-389.47 1443.7,-360 1443.7,-360 1443.7,-360 1683.49,-360 1683.49,-360"/>
<polygon fill="black" stroke="black" points="1683.49,-363.5 1693.49,-360 1683.49,-356.5 1683.49,-363.5"/>
</g>
<!-- layer0_experts_gpu4 -->
<g id="node22" class="node">
<title>layer0_experts_gpu4</title>
<polygon fill="lightcoral" stroke="black" points="1963.2,-628.63 1754.2,-628.63 1754.2,-554.63 1963.2,-554.63 1963.2,-628.63"/>
<text text-anchor="middle" x="1858.7" y="-616.63" font-family="Arial" font-size="10.00">8 Experts GPU 4</text>
<text text-anchor="middle" x="1858.7" y="-605.63" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="1858.7" y="-594.63" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="1858.7" y="-583.63" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="1858.7" y="-572.63" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="1858.7" y="-561.63" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer0_route_gpu4&#45;&gt;layer0_experts_gpu4 -->
<g id="edge23" class="edge">
<title>layer0_route_gpu4&#45;&gt;layer0_experts_gpu4</title>
<path fill="none" stroke="black" d="M1858.7,-665.52C1858.7,-665.52 1858.7,-638.74 1858.7,-638.74"/>
<polygon fill="black" stroke="black" points="1862.2,-638.74 1858.7,-628.74 1855.2,-638.74 1862.2,-638.74"/>
</g>
<!-- layer0_agg_gpu4 -->
<g id="node23" class="node">
<title>layer0_agg_gpu4</title>
<ellipse fill="lightpink" stroke="black" cx="1858.7" cy="-451.87" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="1858.7" y="-465.87" font-family="Arial" font-size="10.00">Aggregate GPU 4</text>
<text text-anchor="middle" x="1858.7" y="-454.87" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="1858.7" y="-443.87" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="1858.7" y="-432.87" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer0_experts_gpu4&#45;&gt;layer0_agg_gpu4 -->
<g id="edge24" class="edge">
<title>layer0_experts_gpu4&#45;&gt;layer0_agg_gpu4</title>
<path fill="none" stroke="black" d="M1858.7,-554.55C1858.7,-554.55 1858.7,-498.64 1858.7,-498.64"/>
<polygon fill="black" stroke="black" points="1862.2,-498.64 1858.7,-488.64 1855.2,-498.64 1862.2,-498.64"/>
</g>
<!-- layer0_agg_gpu4&#45;&gt;layer0_moe_agg -->
<g id="edge25" class="edge">
<title>layer0_agg_gpu4&#45;&gt;layer0_moe_agg</title>
<path fill="none" stroke="black" d="M1858.7,-415.08C1858.7,-415.08 1858.7,-388.22 1858.7,-388.22"/>
<polygon fill="black" stroke="black" points="1862.2,-388.22 1858.7,-378.22 1855.2,-388.22 1862.2,-388.22"/>
</g>
<!-- layer0_experts_gpu5 -->
<g id="node25" class="node">
<title>layer0_experts_gpu5</title>
<polygon fill="lightcoral" stroke="black" points="2372.2,-628.63 2163.2,-628.63 2163.2,-554.63 2372.2,-554.63 2372.2,-628.63"/>
<text text-anchor="middle" x="2267.7" y="-616.63" font-family="Arial" font-size="10.00">8 Experts GPU 5</text>
<text text-anchor="middle" x="2267.7" y="-605.63" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="2267.7" y="-594.63" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="2267.7" y="-583.63" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="2267.7" y="-572.63" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="2267.7" y="-561.63" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer0_route_gpu5&#45;&gt;layer0_experts_gpu5 -->
<g id="edge27" class="edge">
<title>layer0_route_gpu5&#45;&gt;layer0_experts_gpu5</title>
<path fill="none" stroke="black" d="M2267.7,-665.52C2267.7,-665.52 2267.7,-638.74 2267.7,-638.74"/>
<polygon fill="black" stroke="black" points="2271.2,-638.74 2267.7,-628.74 2264.2,-638.74 2271.2,-638.74"/>
</g>
<!-- layer0_agg_gpu5 -->
<g id="node26" class="node">
<title>layer0_agg_gpu5</title>
<ellipse fill="lightpink" stroke="black" cx="2273.7" cy="-451.87" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="2273.7" y="-465.87" font-family="Arial" font-size="10.00">Aggregate GPU 5</text>
<text text-anchor="middle" x="2273.7" y="-454.87" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="2273.7" y="-443.87" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="2273.7" y="-432.87" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer0_experts_gpu5&#45;&gt;layer0_agg_gpu5 -->
<g id="edge28" class="edge">
<title>layer0_experts_gpu5&#45;&gt;layer0_agg_gpu5</title>
<path fill="none" stroke="black" d="M2267.7,-554.55C2267.7,-554.55 2267.7,-498.64 2267.7,-498.64"/>
<polygon fill="black" stroke="black" points="2271.2,-498.64 2267.7,-488.64 2264.2,-498.64 2271.2,-498.64"/>
</g>
<!-- layer0_agg_gpu5&#45;&gt;layer0_moe_agg -->
<g id="edge29" class="edge">
<title>layer0_agg_gpu5&#45;&gt;layer0_moe_agg</title>
<path fill="none" stroke="black" d="M2273.7,-415.03C2273.7,-389.47 2273.7,-360 2273.7,-360 2273.7,-360 2033.91,-360 2033.91,-360"/>
<polygon fill="black" stroke="black" points="2033.91,-356.5 2023.91,-360 2033.91,-363.5 2033.91,-356.5"/>
</g>
<!-- layer0_experts_gpu6 -->
<g id="node28" class="node">
<title>layer0_experts_gpu6</title>
<polygon fill="lightcoral" stroke="black" points="2787.2,-628.63 2578.2,-628.63 2578.2,-554.63 2787.2,-554.63 2787.2,-628.63"/>
<text text-anchor="middle" x="2682.7" y="-616.63" font-family="Arial" font-size="10.00">8 Experts GPU 6</text>
<text text-anchor="middle" x="2682.7" y="-605.63" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="2682.7" y="-594.63" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="2682.7" y="-583.63" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="2682.7" y="-572.63" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="2682.7" y="-561.63" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer0_route_gpu6&#45;&gt;layer0_experts_gpu6 -->
<g id="edge31" class="edge">
<title>layer0_route_gpu6&#45;&gt;layer0_experts_gpu6</title>
<path fill="none" stroke="black" d="M2682.7,-665.52C2682.7,-665.52 2682.7,-638.74 2682.7,-638.74"/>
<polygon fill="black" stroke="black" points="2686.2,-638.74 2682.7,-628.74 2679.2,-638.74 2686.2,-638.74"/>
</g>
<!-- layer0_agg_gpu6 -->
<g id="node29" class="node">
<title>layer0_agg_gpu6</title>
<ellipse fill="lightpink" stroke="black" cx="2688.7" cy="-451.87" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="2688.7" y="-465.87" font-family="Arial" font-size="10.00">Aggregate GPU 6</text>
<text text-anchor="middle" x="2688.7" y="-454.87" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="2688.7" y="-443.87" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="2688.7" y="-432.87" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer0_experts_gpu6&#45;&gt;layer0_agg_gpu6 -->
<g id="edge32" class="edge">
<title>layer0_experts_gpu6&#45;&gt;layer0_agg_gpu6</title>
<path fill="none" stroke="black" d="M2682.7,-554.55C2682.7,-554.55 2682.7,-498.64 2682.7,-498.64"/>
<polygon fill="black" stroke="black" points="2686.2,-498.64 2682.7,-488.64 2679.2,-498.64 2686.2,-498.64"/>
</g>
<!-- layer0_agg_gpu6&#45;&gt;layer0_moe_agg -->
<g id="edge33" class="edge">
<title>layer0_agg_gpu6&#45;&gt;layer0_moe_agg</title>
<path fill="none" stroke="black" d="M2592.6,-419.5C2592.6,-387.09 2592.6,-342 2592.6,-342 2592.6,-342 2070.21,-342 2070.21,-342"/>
<polygon fill="black" stroke="black" points="2070.21,-338.5 2060.21,-342 2070.21,-345.5 2070.21,-338.5"/>
</g>
<!-- layer0_experts_gpu7 -->
<g id="node31" class="node">
<title>layer0_experts_gpu7</title>
<polygon fill="lightcoral" stroke="black" points="3191.2,-628.63 2982.2,-628.63 2982.2,-554.63 3191.2,-554.63 3191.2,-628.63"/>
<text text-anchor="middle" x="3086.7" y="-616.63" font-family="Arial" font-size="10.00">8 Experts GPU 7</text>
<text text-anchor="middle" x="3086.7" y="-605.63" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="3086.7" y="-594.63" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="3086.7" y="-583.63" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="3086.7" y="-572.63" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="3086.7" y="-561.63" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer0_route_gpu7&#45;&gt;layer0_experts_gpu7 -->
<g id="edge35" class="edge">
<title>layer0_route_gpu7&#45;&gt;layer0_experts_gpu7</title>
<path fill="none" stroke="black" d="M3086.7,-665.52C3086.7,-665.52 3086.7,-638.74 3086.7,-638.74"/>
<polygon fill="black" stroke="black" points="3090.2,-638.74 3086.7,-628.74 3083.2,-638.74 3090.2,-638.74"/>
</g>
<!-- layer0_agg_gpu7 -->
<g id="node32" class="node">
<title>layer0_agg_gpu7</title>
<ellipse fill="lightpink" stroke="black" cx="3103.7" cy="-451.87" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="3103.7" y="-465.87" font-family="Arial" font-size="10.00">Aggregate GPU 7</text>
<text text-anchor="middle" x="3103.7" y="-454.87" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="3103.7" y="-443.87" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="3103.7" y="-432.87" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer0_experts_gpu7&#45;&gt;layer0_agg_gpu7 -->
<g id="edge36" class="edge">
<title>layer0_experts_gpu7&#45;&gt;layer0_agg_gpu7</title>
<path fill="none" stroke="black" d="M3086.7,-554.55C3086.7,-554.55 3086.7,-498.64 3086.7,-498.64"/>
<polygon fill="black" stroke="black" points="3090.2,-498.64 3086.7,-488.64 3083.2,-498.64 3090.2,-498.64"/>
</g>
<!-- layer0_agg_gpu7&#45;&gt;layer0_moe_agg -->
<g id="edge37" class="edge">
<title>layer0_agg_gpu7&#45;&gt;layer0_moe_agg</title>
<path fill="none" stroke="black" d="M2940.6,-430.75C2940.6,-394.43 2940.6,-324 2940.6,-324 2940.6,-324 2069.03,-324 2069.03,-324"/>
<polygon fill="black" stroke="black" points="2069.03,-320.5 2059.03,-324 2069.03,-327.5 2069.03,-320.5"/>
</g>
<!-- layer1_ln1 -->
<g id="node34" class="node">
<title>layer1_ln1</title>
<polygon fill="none" stroke="black" points="3387.2,-1365.75 3106.2,-1365.75 3106.2,-1302.75 3387.2,-1302.75 3387.2,-1365.75"/>
<text text-anchor="middle" x="3246.7" y="-1353.75" font-family="Arial" font-size="10.00">LayerNorm MHA 1</text>
<text text-anchor="middle" x="3246.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="3246.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="3246.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="3246.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer1_add1 -->
<g id="node35" class="node">
<title>layer1_add1</title>
<polygon fill="yellow" stroke="black" points="4523.2,-728.4 4242.2,-728.4 4242.2,-676.4 4523.2,-676.4 4523.2,-728.4"/>
<text text-anchor="middle" x="4382.7" y="-716.4" font-family="Arial" font-size="10.00">MHA Residual Add 1</text>
<text text-anchor="middle" x="4382.7" y="-705.4" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="4382.7" y="-694.4" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="4382.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer1_moe_output -->
<g id="node39" class="node">
<title>layer1_moe_output</title>
<polygon fill="yellow" stroke="black" points="4604.2,-617.63 4323.2,-617.63 4323.2,-565.63 4604.2,-565.63 4604.2,-617.63"/>
<text text-anchor="middle" x="4463.7" y="-605.63" font-family="Arial" font-size="10.00">MoE Residual Add 1</text>
<text text-anchor="middle" x="4463.7" y="-594.63" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="4463.7" y="-583.63" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="4463.7" y="-572.63" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer1_add1&#45;&gt;layer1_moe_output -->
<g id="edge75" class="edge">
<title>layer1_add1&#45;&gt;layer1_moe_output</title>
<path fill="none" stroke="black" d="M4423.2,-676.15C4423.2,-676.15 4423.2,-627.7 4423.2,-627.7"/>
<polygon fill="black" stroke="black" points="4426.7,-627.7 4423.2,-617.7 4419.7,-627.7 4426.7,-627.7"/>
</g>
<!-- layer1_gate -->
<g id="node36" class="node">
<title>layer1_gate</title>
<polygon fill="lightgreen" stroke="black" points="4878.13,-1397.25 4419.3,-1397.25 4301.26,-1271.25 4760.1,-1271.25 4878.13,-1397.25"/>
<text text-anchor="middle" x="4589.7" y="-1353.75" font-family="Arial" font-size="10.00">Gate Layer 1</text>
<text text-anchor="middle" x="4589.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="4589.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="4589.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="4589.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, num_experts=16]</text>
</g>
<!-- layer1_route_gpu0 -->
<g id="node40" class="node">
<title>layer1_route_gpu0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="3230.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="3230.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 0</text>
<text text-anchor="middle" x="3230.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="3230.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="3230.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer1_gate&#45;&gt;layer1_route_gpu0 -->
<g id="edge41" class="edge">
<title>layer1_gate&#45;&gt;layer1_route_gpu0</title>
<path fill="none" stroke="black" d="M4322.54,-1294C3973.36,-1294 3405.82,-1294 3405.82,-1294 3405.82,-1294 3405.82,-1223.42 3405.82,-1223.42"/>
<polygon fill="black" stroke="black" points="3409.32,-1223.42 3405.82,-1213.42 3402.32,-1223.42 3409.32,-1223.42"/>
</g>
<!-- layer1_route_gpu1 -->
<g id="node43" class="node">
<title>layer1_route_gpu1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="3655.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="3655.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 1</text>
<text text-anchor="middle" x="3655.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="3655.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="3655.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer1_gate&#45;&gt;layer1_route_gpu1 -->
<g id="edge45" class="edge">
<title>layer1_gate&#45;&gt;layer1_route_gpu1</title>
<path fill="none" stroke="black" d="M4315.78,-1287C4040.18,-1287 3655.7,-1287 3655.7,-1287 3655.7,-1287 3655.7,-1244.41 3655.7,-1244.41"/>
<polygon fill="black" stroke="black" points="3659.2,-1244.41 3655.7,-1234.41 3652.2,-1244.41 3659.2,-1244.41"/>
</g>
<!-- layer1_route_gpu2 -->
<g id="node46" class="node">
<title>layer1_route_gpu2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="4070.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="4070.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 2</text>
<text text-anchor="middle" x="4070.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="4070.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="4070.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer1_gate&#45;&gt;layer1_route_gpu2 -->
<g id="edge49" class="edge">
<title>layer1_gate&#45;&gt;layer1_route_gpu2</title>
<path fill="none" stroke="black" d="M4308.17,-1279C4186.17,-1279 4070.7,-1279 4070.7,-1279 4070.7,-1279 4070.7,-1244.42 4070.7,-1244.42"/>
<polygon fill="black" stroke="black" points="4074.2,-1244.42 4070.7,-1234.42 4067.2,-1244.43 4074.2,-1244.42"/>
</g>
<!-- layer1_route_gpu3 -->
<g id="node49" class="node">
<title>layer1_route_gpu3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="4480.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="4480.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 3</text>
<text text-anchor="middle" x="4480.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="4480.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="4480.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer1_gate&#45;&gt;layer1_route_gpu3 -->
<g id="edge53" class="edge">
<title>layer1_gate&#45;&gt;layer1_route_gpu3</title>
<path fill="none" stroke="black" d="M4487.96,-1271.07C4487.96,-1271.07 4487.96,-1244.29 4487.96,-1244.29"/>
<polygon fill="black" stroke="black" points="4491.46,-1244.29 4487.96,-1234.29 4484.46,-1244.29 4491.46,-1244.29"/>
</g>
<!-- layer1_route_gpu4 -->
<g id="node52" class="node">
<title>layer1_route_gpu4</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="4887.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="4887.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 4</text>
<text text-anchor="middle" x="4887.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="4887.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="4887.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer1_gate&#45;&gt;layer1_route_gpu4 -->
<g id="edge57" class="edge">
<title>layer1_gate&#45;&gt;layer1_route_gpu4</title>
<path fill="none" stroke="black" d="M4785.93,-1298.67C4785.93,-1298.67 4785.93,-1239.15 4785.93,-1239.15"/>
<polygon fill="black" stroke="black" points="4789.43,-1239.15 4785.93,-1229.15 4782.43,-1239.15 4789.43,-1239.15"/>
</g>
<!-- layer1_route_gpu5 -->
<g id="node55" class="node">
<title>layer1_route_gpu5</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="5297.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="5297.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 5</text>
<text text-anchor="middle" x="5297.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="5297.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="5297.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer1_gate&#45;&gt;layer1_route_gpu5 -->
<g id="edge61" class="edge">
<title>layer1_gate&#45;&gt;layer1_route_gpu5</title>
<path fill="none" stroke="black" d="M4768.36,-1280C4978.09,-1280 5297.7,-1280 5297.7,-1280 5297.7,-1280 5297.7,-1244.4 5297.7,-1244.4"/>
<polygon fill="black" stroke="black" points="5301.2,-1244.4 5297.7,-1234.4 5294.2,-1244.4 5301.2,-1244.4"/>
</g>
<!-- layer1_route_gpu6 -->
<g id="node58" class="node">
<title>layer1_route_gpu6</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="5709.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="5709.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 6</text>
<text text-anchor="middle" x="5709.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="5709.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="5709.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer1_gate&#45;&gt;layer1_route_gpu6 -->
<g id="edge65" class="edge">
<title>layer1_gate&#45;&gt;layer1_route_gpu6</title>
<path fill="none" stroke="black" d="M4776.84,-1289C5095.59,-1289 5709.7,-1289 5709.7,-1289 5709.7,-1289 5709.7,-1244.44 5709.7,-1244.44"/>
<polygon fill="black" stroke="black" points="5713.2,-1244.44 5709.7,-1234.44 5706.2,-1244.44 5713.2,-1244.44"/>
</g>
<!-- layer1_route_gpu7 -->
<g id="node61" class="node">
<title>layer1_route_gpu7</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="6116.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="6116.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 7</text>
<text text-anchor="middle" x="6116.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="6116.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="6116.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer1_gate&#45;&gt;layer1_route_gpu7 -->
<g id="edge69" class="edge">
<title>layer1_gate&#45;&gt;layer1_route_gpu7</title>
<path fill="none" stroke="black" d="M4785.42,-1298C5197.46,-1298 6116.7,-1298 6116.7,-1298 6116.7,-1298 6116.7,-1244.34 6116.7,-1244.34"/>
<polygon fill="black" stroke="black" points="6120.2,-1244.34 6116.7,-1234.34 6113.2,-1244.34 6120.2,-1244.34"/>
</g>
<!-- layer1_moe_agg -->
<g id="node37" class="node">
<title>layer1_moe_agg</title>
<ellipse fill="gold" stroke="black" cx="4681.7" cy="-839.17" rx="205.12" ry="44.6"/>
<text text-anchor="middle" x="4681.7" y="-858.67" font-family="Arial" font-size="10.00">MoE Final Aggregation 1</text>
<text text-anchor="middle" x="4681.7" y="-847.67" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="4681.7" y="-836.67" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="4681.7" y="-825.67" font-family="Arial" font-size="10.00">Input: 16Ã—[batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="4681.7" y="-814.67" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer1_ln2 -->
<g id="node38" class="node">
<title>layer1_ln2</title>
<polygon fill="none" stroke="black" points="4822.2,-733.9 4541.2,-733.9 4541.2,-670.9 4822.2,-670.9 4822.2,-733.9"/>
<text text-anchor="middle" x="4681.7" y="-721.9" font-family="Arial" font-size="10.00">LayerNorm MoE 1</text>
<text text-anchor="middle" x="4681.7" y="-710.9" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="4681.7" y="-699.9" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="4681.7" y="-688.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="4681.7" y="-677.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer1_moe_agg&#45;&gt;layer1_ln2 -->
<g id="edge73" class="edge">
<title>layer1_moe_agg&#45;&gt;layer1_ln2</title>
<path fill="none" stroke="black" d="M4681.7,-794.39C4681.7,-794.39 4681.7,-744.29 4681.7,-744.29"/>
<polygon fill="black" stroke="black" points="4685.2,-744.29 4681.7,-734.29 4678.2,-744.29 4685.2,-744.29"/>
</g>
<!-- layer1_ln2&#45;&gt;layer1_moe_output -->
<g id="edge74" class="edge">
<title>layer1_ln2&#45;&gt;layer1_moe_output</title>
<path fill="none" stroke="black" d="M4572.7,-670.66C4572.7,-670.66 4572.7,-627.78 4572.7,-627.78"/>
<polygon fill="black" stroke="black" points="4576.2,-627.78 4572.7,-617.78 4569.2,-627.78 4576.2,-627.78"/>
</g>
<!-- layer2_mha -->
<g id="node64" class="node">
<title>layer2_mha</title>
<polygon fill="lightcyan" stroke="black" points="4604.2,-483.37 4323.2,-483.37 4323.2,-420.37 4604.2,-420.37 4604.2,-483.37"/>
<text text-anchor="middle" x="4463.7" y="-471.37" font-family="Arial" font-size="10.00">MHA Layer 2</text>
<text text-anchor="middle" x="4463.7" y="-460.37" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="4463.7" y="-449.37" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="4463.7" y="-438.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="4463.7" y="-427.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer1_moe_output&#45;&gt;layer2_mha -->
<g id="edge567" class="edge">
<title>layer1_moe_output&#45;&gt;layer2_mha</title>
<path fill="none" stroke="black" d="M4463.7,-565.34C4463.7,-565.34 4463.7,-493.42 4463.7,-493.42"/>
<polygon fill="black" stroke="black" points="4467.2,-493.42 4463.7,-483.42 4460.2,-493.42 4467.2,-493.42"/>
</g>
<!-- layer1_experts_gpu0 -->
<g id="node41" class="node">
<title>layer1_experts_gpu0</title>
<polygon fill="lightcoral" stroke="black" points="3333.2,-1123.71 3124.2,-1123.71 3124.2,-1049.71 3333.2,-1049.71 3333.2,-1123.71"/>
<text text-anchor="middle" x="3228.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 0</text>
<text text-anchor="middle" x="3228.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="3228.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="3228.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="3228.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="3228.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer1_route_gpu0&#45;&gt;layer1_experts_gpu0 -->
<g id="edge42" class="edge">
<title>layer1_route_gpu0&#45;&gt;layer1_experts_gpu0</title>
<path fill="none" stroke="black" d="M3228.7,-1160.6C3228.7,-1160.6 3228.7,-1133.81 3228.7,-1133.81"/>
<polygon fill="black" stroke="black" points="3232.2,-1133.81 3228.7,-1123.81 3225.2,-1133.81 3232.2,-1133.81"/>
</g>
<!-- layer1_agg_gpu0 -->
<g id="node42" class="node">
<title>layer1_agg_gpu0</title>
<ellipse fill="lightpink" stroke="black" cx="3228.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="3228.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 0</text>
<text text-anchor="middle" x="3228.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="3228.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="3228.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer1_experts_gpu0&#45;&gt;layer1_agg_gpu0 -->
<g id="edge43" class="edge">
<title>layer1_experts_gpu0&#45;&gt;layer1_agg_gpu0</title>
<path fill="none" stroke="black" d="M3228.7,-1049.52C3228.7,-1049.52 3228.7,-1022.85 3228.7,-1022.85"/>
<polygon fill="black" stroke="black" points="3232.2,-1022.85 3228.7,-1012.85 3225.2,-1022.85 3232.2,-1022.85"/>
</g>
<!-- layer1_agg_gpu0&#45;&gt;layer1_moe_agg -->
<g id="edge44" class="edge">
<title>layer1_agg_gpu0&#45;&gt;layer1_moe_agg</title>
<path fill="none" stroke="black" d="M3406.8,-959.43C3406.8,-918.56 3406.8,-816 3406.8,-816 3406.8,-816 4496.43,-816 4496.43,-816"/>
<polygon fill="black" stroke="black" points="4496.43,-819.5 4506.43,-816 4496.43,-812.5 4496.43,-819.5"/>
</g>
<!-- layer1_experts_gpu1 -->
<g id="node44" class="node">
<title>layer1_experts_gpu1</title>
<polygon fill="lightcoral" stroke="black" points="3756.2,-1123.71 3547.2,-1123.71 3547.2,-1049.71 3756.2,-1049.71 3756.2,-1123.71"/>
<text text-anchor="middle" x="3651.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 1</text>
<text text-anchor="middle" x="3651.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="3651.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="3651.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="3651.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="3651.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer1_route_gpu1&#45;&gt;layer1_experts_gpu1 -->
<g id="edge46" class="edge">
<title>layer1_route_gpu1&#45;&gt;layer1_experts_gpu1</title>
<path fill="none" stroke="black" d="M3651.7,-1160.6C3651.7,-1160.6 3651.7,-1133.81 3651.7,-1133.81"/>
<polygon fill="black" stroke="black" points="3655.2,-1133.81 3651.7,-1123.81 3648.2,-1133.81 3655.2,-1133.81"/>
</g>
<!-- layer1_agg_gpu1 -->
<g id="node45" class="node">
<title>layer1_agg_gpu1</title>
<ellipse fill="lightpink" stroke="black" cx="3643.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="3643.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 1</text>
<text text-anchor="middle" x="3643.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="3643.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="3643.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer1_experts_gpu1&#45;&gt;layer1_agg_gpu1 -->
<g id="edge47" class="edge">
<title>layer1_experts_gpu1&#45;&gt;layer1_agg_gpu1</title>
<path fill="none" stroke="black" d="M3651.7,-1049.52C3651.7,-1049.52 3651.7,-1022.85 3651.7,-1022.85"/>
<polygon fill="black" stroke="black" points="3655.2,-1022.85 3651.7,-1012.85 3648.2,-1022.85 3655.2,-1022.85"/>
</g>
<!-- layer1_agg_gpu1&#45;&gt;layer1_moe_agg -->
<g id="edge48" class="edge">
<title>layer1_agg_gpu1&#45;&gt;layer1_moe_agg</title>
<path fill="none" stroke="black" d="M3643.7,-938.88C3643.7,-898.33 3643.7,-839 3643.7,-839 3643.7,-839 4466.62,-839 4466.62,-839"/>
<polygon fill="black" stroke="black" points="4466.62,-842.5 4476.62,-839 4466.62,-835.5 4466.62,-842.5"/>
</g>
<!-- layer1_experts_gpu2 -->
<g id="node47" class="node">
<title>layer1_experts_gpu2</title>
<polygon fill="lightcoral" stroke="black" points="4171.2,-1123.71 3962.2,-1123.71 3962.2,-1049.71 4171.2,-1049.71 4171.2,-1123.71"/>
<text text-anchor="middle" x="4066.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 2</text>
<text text-anchor="middle" x="4066.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="4066.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="4066.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="4066.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="4066.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer1_route_gpu2&#45;&gt;layer1_experts_gpu2 -->
<g id="edge50" class="edge">
<title>layer1_route_gpu2&#45;&gt;layer1_experts_gpu2</title>
<path fill="none" stroke="black" d="M4066.7,-1160.6C4066.7,-1160.6 4066.7,-1133.81 4066.7,-1133.81"/>
<polygon fill="black" stroke="black" points="4070.2,-1133.81 4066.7,-1123.81 4063.2,-1133.81 4070.2,-1133.81"/>
</g>
<!-- layer1_agg_gpu2 -->
<g id="node48" class="node">
<title>layer1_agg_gpu2</title>
<ellipse fill="lightpink" stroke="black" cx="4058.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="4058.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 2</text>
<text text-anchor="middle" x="4058.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="4058.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="4058.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer1_experts_gpu2&#45;&gt;layer1_agg_gpu2 -->
<g id="edge51" class="edge">
<title>layer1_experts_gpu2&#45;&gt;layer1_agg_gpu2</title>
<path fill="none" stroke="black" d="M4066.7,-1049.52C4066.7,-1049.52 4066.7,-1022.85 4066.7,-1022.85"/>
<polygon fill="black" stroke="black" points="4070.2,-1022.85 4066.7,-1012.85 4063.2,-1022.85 4070.2,-1022.85"/>
</g>
<!-- layer1_agg_gpu2&#45;&gt;layer1_moe_agg -->
<g id="edge52" class="edge">
<title>layer1_agg_gpu2&#45;&gt;layer1_moe_agg</title>
<path fill="none" stroke="black" d="M4249.8,-965.74C4249.8,-937.61 4249.8,-861 4249.8,-861 4249.8,-861 4492.91,-861 4492.91,-861"/>
<polygon fill="black" stroke="black" points="4492.91,-864.5 4502.91,-861 4492.91,-857.5 4492.91,-864.5"/>
</g>
<!-- layer1_experts_gpu3 -->
<g id="node50" class="node">
<title>layer1_experts_gpu3</title>
<polygon fill="lightcoral" stroke="black" points="4583.2,-1123.71 4374.2,-1123.71 4374.2,-1049.71 4583.2,-1049.71 4583.2,-1123.71"/>
<text text-anchor="middle" x="4478.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 3</text>
<text text-anchor="middle" x="4478.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="4478.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="4478.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="4478.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="4478.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer1_route_gpu3&#45;&gt;layer1_experts_gpu3 -->
<g id="edge54" class="edge">
<title>layer1_route_gpu3&#45;&gt;layer1_experts_gpu3</title>
<path fill="none" stroke="black" d="M4478.7,-1160.6C4478.7,-1160.6 4478.7,-1133.81 4478.7,-1133.81"/>
<polygon fill="black" stroke="black" points="4482.2,-1133.81 4478.7,-1123.81 4475.2,-1133.81 4482.2,-1133.81"/>
</g>
<!-- layer1_agg_gpu3 -->
<g id="node51" class="node">
<title>layer1_agg_gpu3</title>
<ellipse fill="lightpink" stroke="black" cx="4473.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="4473.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 3</text>
<text text-anchor="middle" x="4473.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="4473.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="4473.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer1_experts_gpu3&#45;&gt;layer1_agg_gpu3 -->
<g id="edge55" class="edge">
<title>layer1_experts_gpu3&#45;&gt;layer1_agg_gpu3</title>
<path fill="none" stroke="black" d="M4478.7,-1049.52C4478.7,-1049.52 4478.7,-1022.85 4478.7,-1022.85"/>
<polygon fill="black" stroke="black" points="4482.2,-1022.85 4478.7,-1012.85 4475.2,-1022.85 4482.2,-1022.85"/>
</g>
<!-- layer1_agg_gpu3&#45;&gt;layer1_moe_agg -->
<g id="edge56" class="edge">
<title>layer1_agg_gpu3&#45;&gt;layer1_moe_agg</title>
<path fill="none" stroke="black" d="M4574.52,-944.22C4574.52,-944.22 4574.52,-887.54 4574.52,-887.54"/>
<polygon fill="black" stroke="black" points="4578.02,-887.54 4574.52,-877.54 4571.02,-887.54 4578.02,-887.54"/>
</g>
<!-- layer1_experts_gpu4 -->
<g id="node53" class="node">
<title>layer1_experts_gpu4</title>
<polygon fill="lightcoral" stroke="black" points="4993.2,-1123.71 4784.2,-1123.71 4784.2,-1049.71 4993.2,-1049.71 4993.2,-1123.71"/>
<text text-anchor="middle" x="4888.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 4</text>
<text text-anchor="middle" x="4888.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="4888.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="4888.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="4888.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="4888.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer1_route_gpu4&#45;&gt;layer1_experts_gpu4 -->
<g id="edge58" class="edge">
<title>layer1_route_gpu4&#45;&gt;layer1_experts_gpu4</title>
<path fill="none" stroke="black" d="M4888.7,-1160.6C4888.7,-1160.6 4888.7,-1133.81 4888.7,-1133.81"/>
<polygon fill="black" stroke="black" points="4892.2,-1133.81 4888.7,-1123.81 4885.2,-1133.81 4892.2,-1133.81"/>
</g>
<!-- layer1_agg_gpu4 -->
<g id="node54" class="node">
<title>layer1_agg_gpu4</title>
<ellipse fill="lightpink" stroke="black" cx="4888.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="4888.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 4</text>
<text text-anchor="middle" x="4888.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="4888.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="4888.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer1_experts_gpu4&#45;&gt;layer1_agg_gpu4 -->
<g id="edge59" class="edge">
<title>layer1_experts_gpu4&#45;&gt;layer1_agg_gpu4</title>
<path fill="none" stroke="black" d="M4888.7,-1049.52C4888.7,-1049.52 4888.7,-1022.85 4888.7,-1022.85"/>
<polygon fill="black" stroke="black" points="4892.2,-1022.85 4888.7,-1012.85 4885.2,-1022.85 4892.2,-1022.85"/>
</g>
<!-- layer1_agg_gpu4&#45;&gt;layer1_moe_agg -->
<g id="edge60" class="edge">
<title>layer1_agg_gpu4&#45;&gt;layer1_moe_agg</title>
<path fill="none" stroke="black" d="M4788.38,-943.88C4788.38,-943.88 4788.38,-887.36 4788.38,-887.36"/>
<polygon fill="black" stroke="black" points="4791.88,-887.36 4788.38,-877.36 4784.88,-887.36 4791.88,-887.36"/>
</g>
<!-- layer1_experts_gpu5 -->
<g id="node56" class="node">
<title>layer1_experts_gpu5</title>
<polygon fill="lightcoral" stroke="black" points="5406.2,-1123.71 5197.2,-1123.71 5197.2,-1049.71 5406.2,-1049.71 5406.2,-1123.71"/>
<text text-anchor="middle" x="5301.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 5</text>
<text text-anchor="middle" x="5301.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="5301.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="5301.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="5301.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="5301.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer1_route_gpu5&#45;&gt;layer1_experts_gpu5 -->
<g id="edge62" class="edge">
<title>layer1_route_gpu5&#45;&gt;layer1_experts_gpu5</title>
<path fill="none" stroke="black" d="M5301.7,-1160.6C5301.7,-1160.6 5301.7,-1133.81 5301.7,-1133.81"/>
<polygon fill="black" stroke="black" points="5305.2,-1133.81 5301.7,-1123.81 5298.2,-1133.81 5305.2,-1133.81"/>
</g>
<!-- layer1_agg_gpu5 -->
<g id="node57" class="node">
<title>layer1_agg_gpu5</title>
<ellipse fill="lightpink" stroke="black" cx="5303.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="5303.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 5</text>
<text text-anchor="middle" x="5303.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="5303.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="5303.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer1_experts_gpu5&#45;&gt;layer1_agg_gpu5 -->
<g id="edge63" class="edge">
<title>layer1_experts_gpu5&#45;&gt;layer1_agg_gpu5</title>
<path fill="none" stroke="black" d="M5301.7,-1049.52C5301.7,-1049.52 5301.7,-1022.85 5301.7,-1022.85"/>
<polygon fill="black" stroke="black" points="5305.2,-1022.85 5301.7,-1012.85 5298.2,-1022.85 5305.2,-1022.85"/>
</g>
<!-- layer1_agg_gpu5&#45;&gt;layer1_moe_agg -->
<g id="edge64" class="edge">
<title>layer1_agg_gpu5&#45;&gt;layer1_moe_agg</title>
<path fill="none" stroke="black" d="M5303.7,-938.87C5303.7,-896.22 5303.7,-832 5303.7,-832 5303.7,-832 4894.5,-832 4894.5,-832"/>
<polygon fill="black" stroke="black" points="4894.5,-828.5 4884.5,-832 4894.5,-835.5 4894.5,-828.5"/>
</g>
<!-- layer1_experts_gpu6 -->
<g id="node59" class="node">
<title>layer1_experts_gpu6</title>
<polygon fill="lightcoral" stroke="black" points="5820.2,-1123.71 5611.2,-1123.71 5611.2,-1049.71 5820.2,-1049.71 5820.2,-1123.71"/>
<text text-anchor="middle" x="5715.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 6</text>
<text text-anchor="middle" x="5715.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="5715.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="5715.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="5715.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="5715.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer1_route_gpu6&#45;&gt;layer1_experts_gpu6 -->
<g id="edge66" class="edge">
<title>layer1_route_gpu6&#45;&gt;layer1_experts_gpu6</title>
<path fill="none" stroke="black" d="M5715.7,-1160.6C5715.7,-1160.6 5715.7,-1133.81 5715.7,-1133.81"/>
<polygon fill="black" stroke="black" points="5719.2,-1133.81 5715.7,-1123.81 5712.2,-1133.81 5719.2,-1133.81"/>
</g>
<!-- layer1_agg_gpu6 -->
<g id="node60" class="node">
<title>layer1_agg_gpu6</title>
<ellipse fill="lightpink" stroke="black" cx="5718.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="5718.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 6</text>
<text text-anchor="middle" x="5718.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="5718.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="5718.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer1_experts_gpu6&#45;&gt;layer1_agg_gpu6 -->
<g id="edge67" class="edge">
<title>layer1_experts_gpu6&#45;&gt;layer1_agg_gpu6</title>
<path fill="none" stroke="black" d="M5715.7,-1049.52C5715.7,-1049.52 5715.7,-1022.85 5715.7,-1022.85"/>
<polygon fill="black" stroke="black" points="5719.2,-1022.85 5715.7,-1012.85 5712.2,-1022.85 5719.2,-1022.85"/>
</g>
<!-- layer1_agg_gpu6&#45;&gt;layer1_moe_agg -->
<g id="edge68" class="edge">
<title>layer1_agg_gpu6&#45;&gt;layer1_moe_agg</title>
<path fill="none" stroke="black" d="M5718.7,-938.99C5718.7,-892.87 5718.7,-820 5718.7,-820 5718.7,-820 4876.79,-820 4876.79,-820"/>
<polygon fill="black" stroke="black" points="4876.79,-816.5 4866.79,-820 4876.79,-823.5 4876.79,-816.5"/>
</g>
<!-- layer1_experts_gpu7 -->
<g id="node62" class="node">
<title>layer1_experts_gpu7</title>
<polygon fill="lightcoral" stroke="black" points="6232.2,-1123.71 6023.2,-1123.71 6023.2,-1049.71 6232.2,-1049.71 6232.2,-1123.71"/>
<text text-anchor="middle" x="6127.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 7</text>
<text text-anchor="middle" x="6127.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="6127.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="6127.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="6127.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="6127.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer1_route_gpu7&#45;&gt;layer1_experts_gpu7 -->
<g id="edge70" class="edge">
<title>layer1_route_gpu7&#45;&gt;layer1_experts_gpu7</title>
<path fill="none" stroke="black" d="M6127.7,-1160.6C6127.7,-1160.6 6127.7,-1133.81 6127.7,-1133.81"/>
<polygon fill="black" stroke="black" points="6131.2,-1133.81 6127.7,-1123.81 6124.2,-1133.81 6131.2,-1133.81"/>
</g>
<!-- layer1_agg_gpu7 -->
<g id="node63" class="node">
<title>layer1_agg_gpu7</title>
<ellipse fill="lightpink" stroke="black" cx="6133.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="6133.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 7</text>
<text text-anchor="middle" x="6133.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="6133.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="6133.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer1_experts_gpu7&#45;&gt;layer1_agg_gpu7 -->
<g id="edge71" class="edge">
<title>layer1_experts_gpu7&#45;&gt;layer1_agg_gpu7</title>
<path fill="none" stroke="black" d="M6127.7,-1049.52C6127.7,-1049.52 6127.7,-1022.85 6127.7,-1022.85"/>
<polygon fill="black" stroke="black" points="6131.2,-1022.85 6127.7,-1012.85 6124.2,-1022.85 6131.2,-1022.85"/>
</g>
<!-- layer1_agg_gpu7&#45;&gt;layer1_moe_agg -->
<g id="edge72" class="edge">
<title>layer1_agg_gpu7&#45;&gt;layer1_moe_agg</title>
<path fill="none" stroke="black" d="M6133.7,-938.87C6133.7,-889.14 6133.7,-807 6133.7,-807 6133.7,-807 4833.56,-807 4833.56,-807"/>
<polygon fill="black" stroke="black" points="4833.56,-803.5 4823.56,-807 4833.56,-810.5 4833.56,-803.5"/>
</g>
<!-- layer2_ln1 -->
<g id="node65" class="node">
<title>layer2_ln1</title>
<polygon fill="none" stroke="black" points="6684.2,-1365.75 6403.2,-1365.75 6403.2,-1302.75 6684.2,-1302.75 6684.2,-1365.75"/>
<text text-anchor="middle" x="6543.7" y="-1353.75" font-family="Arial" font-size="10.00">LayerNorm MHA 2</text>
<text text-anchor="middle" x="6543.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="6543.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="6543.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="6543.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer2_add1 -->
<g id="node66" class="node">
<title>layer2_add1</title>
<polygon fill="yellow" stroke="black" points="7842.2,-728.4 7561.2,-728.4 7561.2,-676.4 7842.2,-676.4 7842.2,-728.4"/>
<text text-anchor="middle" x="7701.7" y="-716.4" font-family="Arial" font-size="10.00">MHA Residual Add 2</text>
<text text-anchor="middle" x="7701.7" y="-705.4" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="7701.7" y="-694.4" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="7701.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer2_moe_output -->
<g id="node70" class="node">
<title>layer2_moe_output</title>
<polygon fill="yellow" stroke="black" points="7923.2,-617.63 7642.2,-617.63 7642.2,-565.63 7923.2,-565.63 7923.2,-617.63"/>
<text text-anchor="middle" x="7782.7" y="-605.63" font-family="Arial" font-size="10.00">MoE Residual Add 2</text>
<text text-anchor="middle" x="7782.7" y="-594.63" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="7782.7" y="-583.63" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="7782.7" y="-572.63" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer2_add1&#45;&gt;layer2_moe_output -->
<g id="edge110" class="edge">
<title>layer2_add1&#45;&gt;layer2_moe_output</title>
<path fill="none" stroke="black" d="M7742.2,-676.15C7742.2,-676.15 7742.2,-627.7 7742.2,-627.7"/>
<polygon fill="black" stroke="black" points="7745.7,-627.7 7742.2,-617.7 7738.7,-627.7 7745.7,-627.7"/>
</g>
<!-- layer2_gate -->
<g id="node67" class="node">
<title>layer2_gate</title>
<polygon fill="lightgreen" stroke="black" points="8287.13,-1397.25 7828.3,-1397.25 7710.26,-1271.25 8169.1,-1271.25 8287.13,-1397.25"/>
<text text-anchor="middle" x="7998.7" y="-1353.75" font-family="Arial" font-size="10.00">Gate Layer 2</text>
<text text-anchor="middle" x="7998.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="7998.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="7998.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="7998.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, num_experts=16]</text>
</g>
<!-- layer2_route_gpu0 -->
<g id="node71" class="node">
<title>layer2_route_gpu0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="6566.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="6566.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 0</text>
<text text-anchor="middle" x="6566.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="6566.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="6566.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer2_gate&#45;&gt;layer2_route_gpu0 -->
<g id="edge76" class="edge">
<title>layer2_gate&#45;&gt;layer2_route_gpu0</title>
<path fill="none" stroke="black" d="M7730.35,-1293C7355.97,-1293 6722.32,-1293 6722.32,-1293 6722.32,-1293 6722.32,-1229.64 6722.32,-1229.64"/>
<polygon fill="black" stroke="black" points="6725.82,-1229.64 6722.32,-1219.64 6718.82,-1229.64 6725.82,-1229.64"/>
</g>
<!-- layer2_route_gpu1 -->
<g id="node74" class="node">
<title>layer2_route_gpu1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="6972.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="6972.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 1</text>
<text text-anchor="middle" x="6972.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="6972.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="6972.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer2_gate&#45;&gt;layer2_route_gpu1 -->
<g id="edge80" class="edge">
<title>layer2_gate&#45;&gt;layer2_route_gpu1</title>
<path fill="none" stroke="black" d="M7722.06,-1284C7418.18,-1284 6972.7,-1284 6972.7,-1284 6972.7,-1284 6972.7,-1244.42 6972.7,-1244.42"/>
<polygon fill="black" stroke="black" points="6976.2,-1244.42 6972.7,-1234.42 6969.2,-1244.42 6976.2,-1244.42"/>
</g>
<!-- layer2_route_gpu2 -->
<g id="node77" class="node">
<title>layer2_route_gpu2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="7386.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="7386.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 2</text>
<text text-anchor="middle" x="7386.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="7386.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="7386.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer2_gate&#45;&gt;layer2_route_gpu2 -->
<g id="edge84" class="edge">
<title>layer2_gate&#45;&gt;layer2_route_gpu2</title>
<path fill="none" stroke="black" d="M7713.75,-1275C7554.06,-1275 7386.7,-1275 7386.7,-1275 7386.7,-1275 7386.7,-1244.42 7386.7,-1244.42"/>
<polygon fill="black" stroke="black" points="7390.2,-1244.42 7386.7,-1234.42 7383.2,-1244.42 7390.2,-1244.42"/>
</g>
<!-- layer2_route_gpu3 -->
<g id="node80" class="node">
<title>layer2_route_gpu3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="7795.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="7795.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 3</text>
<text text-anchor="middle" x="7795.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="7795.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="7795.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer2_gate&#45;&gt;layer2_route_gpu3 -->
<g id="edge88" class="edge">
<title>layer2_gate&#45;&gt;layer2_route_gpu3</title>
<path fill="none" stroke="black" d="M7849.96,-1271.07C7849.96,-1271.07 7849.96,-1242.78 7849.96,-1242.78"/>
<polygon fill="black" stroke="black" points="7853.46,-1242.78 7849.96,-1232.78 7846.46,-1242.78 7853.46,-1242.78"/>
</g>
<!-- layer2_route_gpu4 -->
<g id="node83" class="node">
<title>layer2_route_gpu4</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="8202.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="8202.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 4</text>
<text text-anchor="middle" x="8202.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="8202.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="8202.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer2_gate&#45;&gt;layer2_route_gpu4 -->
<g id="edge92" class="edge">
<title>layer2_gate&#45;&gt;layer2_route_gpu4</title>
<path fill="none" stroke="black" d="M8147.93,-1271.07C8147.93,-1271.07 8147.93,-1242.78 8147.93,-1242.78"/>
<polygon fill="black" stroke="black" points="8151.43,-1242.78 8147.93,-1232.78 8144.43,-1242.78 8151.43,-1242.78"/>
</g>
<!-- layer2_route_gpu5 -->
<g id="node86" class="node">
<title>layer2_route_gpu5</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="8609.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="8609.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 5</text>
<text text-anchor="middle" x="8609.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="8609.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="8609.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer2_gate&#45;&gt;layer2_route_gpu5 -->
<g id="edge96" class="edge">
<title>layer2_gate&#45;&gt;layer2_route_gpu5</title>
<path fill="none" stroke="black" d="M8172.97,-1275C8353.56,-1275 8609.7,-1275 8609.7,-1275 8609.7,-1275 8609.7,-1244.42 8609.7,-1244.42"/>
<polygon fill="black" stroke="black" points="8613.2,-1244.42 8609.7,-1234.42 8606.2,-1244.42 8613.2,-1244.42"/>
</g>
<!-- layer2_route_gpu6 -->
<g id="node89" class="node">
<title>layer2_route_gpu6</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="9022.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="9022.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 6</text>
<text text-anchor="middle" x="9022.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="9022.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="9022.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer2_gate&#45;&gt;layer2_route_gpu6 -->
<g id="edge100" class="edge">
<title>layer2_gate&#45;&gt;layer2_route_gpu6</title>
<path fill="none" stroke="black" d="M8181.18,-1284C8475.58,-1284 9022.7,-1284 9022.7,-1284 9022.7,-1284 9022.7,-1244.42 9022.7,-1244.42"/>
<polygon fill="black" stroke="black" points="9026.2,-1244.42 9022.7,-1234.42 9019.2,-1244.42 9026.2,-1244.42"/>
</g>
<!-- layer2_route_gpu7 -->
<g id="node92" class="node">
<title>layer2_route_gpu7</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="9436.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="9436.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 7</text>
<text text-anchor="middle" x="9436.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="9436.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="9436.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer2_gate&#45;&gt;layer2_route_gpu7 -->
<g id="edge104" class="edge">
<title>layer2_gate&#45;&gt;layer2_route_gpu7</title>
<path fill="none" stroke="black" d="M8189.72,-1293C8570.02,-1293 9385.57,-1293 9385.57,-1293 9385.57,-1293 9385.57,-1243.05 9385.57,-1243.05"/>
<polygon fill="black" stroke="black" points="9389.07,-1243.05 9385.57,-1233.05 9382.07,-1243.05 9389.07,-1243.05"/>
</g>
<!-- layer2_moe_agg -->
<g id="node68" class="node">
<title>layer2_moe_agg</title>
<ellipse fill="gold" stroke="black" cx="8000.7" cy="-839.17" rx="205.12" ry="44.6"/>
<text text-anchor="middle" x="8000.7" y="-858.67" font-family="Arial" font-size="10.00">MoE Final Aggregation 2</text>
<text text-anchor="middle" x="8000.7" y="-847.67" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="8000.7" y="-836.67" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="8000.7" y="-825.67" font-family="Arial" font-size="10.00">Input: 16Ã—[batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="8000.7" y="-814.67" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer2_ln2 -->
<g id="node69" class="node">
<title>layer2_ln2</title>
<polygon fill="none" stroke="black" points="8141.2,-733.9 7860.2,-733.9 7860.2,-670.9 8141.2,-670.9 8141.2,-733.9"/>
<text text-anchor="middle" x="8000.7" y="-721.9" font-family="Arial" font-size="10.00">LayerNorm MoE 2</text>
<text text-anchor="middle" x="8000.7" y="-710.9" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="8000.7" y="-699.9" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="8000.7" y="-688.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="8000.7" y="-677.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer2_moe_agg&#45;&gt;layer2_ln2 -->
<g id="edge108" class="edge">
<title>layer2_moe_agg&#45;&gt;layer2_ln2</title>
<path fill="none" stroke="black" d="M8000.7,-794.39C8000.7,-794.39 8000.7,-744.29 8000.7,-744.29"/>
<polygon fill="black" stroke="black" points="8004.2,-744.29 8000.7,-734.29 7997.2,-744.29 8004.2,-744.29"/>
</g>
<!-- layer2_ln2&#45;&gt;layer2_moe_output -->
<g id="edge109" class="edge">
<title>layer2_ln2&#45;&gt;layer2_moe_output</title>
<path fill="none" stroke="black" d="M7891.7,-670.66C7891.7,-670.66 7891.7,-627.78 7891.7,-627.78"/>
<polygon fill="black" stroke="black" points="7895.2,-627.78 7891.7,-617.78 7888.2,-627.78 7895.2,-627.78"/>
</g>
<!-- layer3_mha -->
<g id="node95" class="node">
<title>layer3_mha</title>
<polygon fill="lightcyan" stroke="black" points="7923.2,-483.37 7642.2,-483.37 7642.2,-420.37 7923.2,-420.37 7923.2,-483.37"/>
<text text-anchor="middle" x="7782.7" y="-471.37" font-family="Arial" font-size="10.00">MHA Layer 3</text>
<text text-anchor="middle" x="7782.7" y="-460.37" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="7782.7" y="-449.37" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="7782.7" y="-438.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="7782.7" y="-427.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer2_moe_output&#45;&gt;layer3_mha -->
<g id="edge568" class="edge">
<title>layer2_moe_output&#45;&gt;layer3_mha</title>
<path fill="none" stroke="black" d="M7782.7,-565.34C7782.7,-565.34 7782.7,-493.42 7782.7,-493.42"/>
<polygon fill="black" stroke="black" points="7786.2,-493.42 7782.7,-483.42 7779.2,-493.42 7786.2,-493.42"/>
</g>
<!-- layer2_experts_gpu0 -->
<g id="node72" class="node">
<title>layer2_experts_gpu0</title>
<polygon fill="lightcoral" stroke="black" points="6670.2,-1123.71 6461.2,-1123.71 6461.2,-1049.71 6670.2,-1049.71 6670.2,-1123.71"/>
<text text-anchor="middle" x="6565.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 0</text>
<text text-anchor="middle" x="6565.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="6565.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="6565.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="6565.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="6565.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer2_route_gpu0&#45;&gt;layer2_experts_gpu0 -->
<g id="edge77" class="edge">
<title>layer2_route_gpu0&#45;&gt;layer2_experts_gpu0</title>
<path fill="none" stroke="black" d="M6565.7,-1160.6C6565.7,-1160.6 6565.7,-1133.81 6565.7,-1133.81"/>
<polygon fill="black" stroke="black" points="6569.2,-1133.81 6565.7,-1123.81 6562.2,-1133.81 6569.2,-1133.81"/>
</g>
<!-- layer2_agg_gpu0 -->
<g id="node73" class="node">
<title>layer2_agg_gpu0</title>
<ellipse fill="lightpink" stroke="black" cx="6548.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="6548.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 0</text>
<text text-anchor="middle" x="6548.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="6548.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="6548.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer2_experts_gpu0&#45;&gt;layer2_agg_gpu0 -->
<g id="edge78" class="edge">
<title>layer2_experts_gpu0&#45;&gt;layer2_agg_gpu0</title>
<path fill="none" stroke="black" d="M6565.7,-1049.52C6565.7,-1049.52 6565.7,-1022.85 6565.7,-1022.85"/>
<polygon fill="black" stroke="black" points="6569.2,-1022.85 6565.7,-1012.85 6562.2,-1022.85 6569.2,-1022.85"/>
</g>
<!-- layer2_agg_gpu0&#45;&gt;layer2_moe_agg -->
<g id="edge79" class="edge">
<title>layer2_agg_gpu0&#45;&gt;layer2_moe_agg</title>
<path fill="none" stroke="black" d="M6548.7,-939.12C6548.7,-900.39 6548.7,-845 6548.7,-845 6548.7,-845 7787.27,-845 7787.27,-845"/>
<polygon fill="black" stroke="black" points="7787.27,-848.5 7797.27,-845 7787.27,-841.5 7787.27,-848.5"/>
</g>
<!-- layer2_experts_gpu1 -->
<g id="node75" class="node">
<title>layer2_experts_gpu1</title>
<polygon fill="lightcoral" stroke="black" points="7074.2,-1123.71 6865.2,-1123.71 6865.2,-1049.71 7074.2,-1049.71 7074.2,-1123.71"/>
<text text-anchor="middle" x="6969.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 1</text>
<text text-anchor="middle" x="6969.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="6969.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="6969.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="6969.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="6969.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer2_route_gpu1&#45;&gt;layer2_experts_gpu1 -->
<g id="edge81" class="edge">
<title>layer2_route_gpu1&#45;&gt;layer2_experts_gpu1</title>
<path fill="none" stroke="black" d="M6969.7,-1160.6C6969.7,-1160.6 6969.7,-1133.81 6969.7,-1133.81"/>
<polygon fill="black" stroke="black" points="6973.2,-1133.81 6969.7,-1123.81 6966.2,-1133.81 6973.2,-1133.81"/>
</g>
<!-- layer2_agg_gpu1 -->
<g id="node76" class="node">
<title>layer2_agg_gpu1</title>
<ellipse fill="lightpink" stroke="black" cx="6963.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="6963.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 1</text>
<text text-anchor="middle" x="6963.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="6963.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="6963.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer2_experts_gpu1&#45;&gt;layer2_agg_gpu1 -->
<g id="edge82" class="edge">
<title>layer2_experts_gpu1&#45;&gt;layer2_agg_gpu1</title>
<path fill="none" stroke="black" d="M6969.7,-1049.52C6969.7,-1049.52 6969.7,-1022.85 6969.7,-1022.85"/>
<polygon fill="black" stroke="black" points="6973.2,-1022.85 6969.7,-1012.85 6966.2,-1022.85 6973.2,-1022.85"/>
</g>
<!-- layer2_agg_gpu1&#45;&gt;layer2_moe_agg -->
<g id="edge83" class="edge">
<title>layer2_agg_gpu1&#45;&gt;layer2_moe_agg</title>
<path fill="none" stroke="black" d="M6963.7,-938.95C6963.7,-904.36 6963.7,-858 6963.7,-858 6963.7,-858 7804.7,-858 7804.7,-858"/>
<polygon fill="black" stroke="black" points="7804.7,-861.5 7814.7,-858 7804.7,-854.5 7804.7,-861.5"/>
</g>
<!-- layer2_experts_gpu2 -->
<g id="node78" class="node">
<title>layer2_experts_gpu2</title>
<polygon fill="lightcoral" stroke="black" points="7488.2,-1123.71 7279.2,-1123.71 7279.2,-1049.71 7488.2,-1049.71 7488.2,-1123.71"/>
<text text-anchor="middle" x="7383.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 2</text>
<text text-anchor="middle" x="7383.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="7383.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="7383.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="7383.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="7383.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer2_route_gpu2&#45;&gt;layer2_experts_gpu2 -->
<g id="edge85" class="edge">
<title>layer2_route_gpu2&#45;&gt;layer2_experts_gpu2</title>
<path fill="none" stroke="black" d="M7383.7,-1160.6C7383.7,-1160.6 7383.7,-1133.81 7383.7,-1133.81"/>
<polygon fill="black" stroke="black" points="7387.2,-1133.81 7383.7,-1123.81 7380.2,-1133.81 7387.2,-1133.81"/>
</g>
<!-- layer2_agg_gpu2 -->
<g id="node79" class="node">
<title>layer2_agg_gpu2</title>
<ellipse fill="lightpink" stroke="black" cx="7378.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="7378.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 2</text>
<text text-anchor="middle" x="7378.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="7378.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="7378.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer2_experts_gpu2&#45;&gt;layer2_agg_gpu2 -->
<g id="edge86" class="edge">
<title>layer2_experts_gpu2&#45;&gt;layer2_agg_gpu2</title>
<path fill="none" stroke="black" d="M7383.7,-1049.52C7383.7,-1049.52 7383.7,-1022.85 7383.7,-1022.85"/>
<polygon fill="black" stroke="black" points="7387.2,-1022.85 7383.7,-1012.85 7380.2,-1022.85 7387.2,-1022.85"/>
</g>
<!-- layer2_agg_gpu2&#45;&gt;layer2_moe_agg -->
<g id="edge87" class="edge">
<title>layer2_agg_gpu2&#45;&gt;layer2_moe_agg</title>
<path fill="none" stroke="black" d="M7569.3,-965.4C7569.3,-938.6 7569.3,-870 7569.3,-870 7569.3,-870 7842.53,-870 7842.53,-870"/>
<polygon fill="black" stroke="black" points="7842.53,-873.5 7852.53,-870 7842.53,-866.5 7842.53,-873.5"/>
</g>
<!-- layer2_experts_gpu3 -->
<g id="node81" class="node">
<title>layer2_experts_gpu3</title>
<polygon fill="lightcoral" stroke="black" points="7899.2,-1123.71 7690.2,-1123.71 7690.2,-1049.71 7899.2,-1049.71 7899.2,-1123.71"/>
<text text-anchor="middle" x="7794.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 3</text>
<text text-anchor="middle" x="7794.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="7794.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="7794.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="7794.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="7794.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer2_route_gpu3&#45;&gt;layer2_experts_gpu3 -->
<g id="edge89" class="edge">
<title>layer2_route_gpu3&#45;&gt;layer2_experts_gpu3</title>
<path fill="none" stroke="black" d="M7794.7,-1160.6C7794.7,-1160.6 7794.7,-1133.81 7794.7,-1133.81"/>
<polygon fill="black" stroke="black" points="7798.2,-1133.81 7794.7,-1123.81 7791.2,-1133.81 7798.2,-1133.81"/>
</g>
<!-- layer2_agg_gpu3 -->
<g id="node82" class="node">
<title>layer2_agg_gpu3</title>
<ellipse fill="lightpink" stroke="black" cx="7793.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="7793.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 3</text>
<text text-anchor="middle" x="7793.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="7793.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="7793.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer2_experts_gpu3&#45;&gt;layer2_agg_gpu3 -->
<g id="edge90" class="edge">
<title>layer2_experts_gpu3&#45;&gt;layer2_agg_gpu3</title>
<path fill="none" stroke="black" d="M7794.7,-1049.52C7794.7,-1049.52 7794.7,-1022.85 7794.7,-1022.85"/>
<polygon fill="black" stroke="black" points="7798.2,-1022.85 7794.7,-1012.85 7791.2,-1022.85 7798.2,-1022.85"/>
</g>
<!-- layer2_agg_gpu3&#45;&gt;layer2_moe_agg -->
<g id="edge91" class="edge">
<title>layer2_agg_gpu3&#45;&gt;layer2_moe_agg</title>
<path fill="none" stroke="black" d="M7894.02,-943.88C7894.02,-943.88 7894.02,-887.36 7894.02,-887.36"/>
<polygon fill="black" stroke="black" points="7897.52,-887.36 7894.02,-877.36 7890.52,-887.36 7897.52,-887.36"/>
</g>
<!-- layer2_experts_gpu4 -->
<g id="node84" class="node">
<title>layer2_experts_gpu4</title>
<polygon fill="lightcoral" stroke="black" points="8313.2,-1123.71 8104.2,-1123.71 8104.2,-1049.71 8313.2,-1049.71 8313.2,-1123.71"/>
<text text-anchor="middle" x="8208.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 4</text>
<text text-anchor="middle" x="8208.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="8208.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="8208.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="8208.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="8208.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer2_route_gpu4&#45;&gt;layer2_experts_gpu4 -->
<g id="edge93" class="edge">
<title>layer2_route_gpu4&#45;&gt;layer2_experts_gpu4</title>
<path fill="none" stroke="black" d="M8208.7,-1160.6C8208.7,-1160.6 8208.7,-1133.81 8208.7,-1133.81"/>
<polygon fill="black" stroke="black" points="8212.2,-1133.81 8208.7,-1123.81 8205.2,-1133.81 8212.2,-1133.81"/>
</g>
<!-- layer2_agg_gpu4 -->
<g id="node85" class="node">
<title>layer2_agg_gpu4</title>
<ellipse fill="lightpink" stroke="black" cx="8208.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="8208.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 4</text>
<text text-anchor="middle" x="8208.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="8208.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="8208.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer2_experts_gpu4&#45;&gt;layer2_agg_gpu4 -->
<g id="edge94" class="edge">
<title>layer2_experts_gpu4&#45;&gt;layer2_agg_gpu4</title>
<path fill="none" stroke="black" d="M8208.7,-1049.52C8208.7,-1049.52 8208.7,-1022.85 8208.7,-1022.85"/>
<polygon fill="black" stroke="black" points="8212.2,-1022.85 8208.7,-1012.85 8205.2,-1022.85 8212.2,-1022.85"/>
</g>
<!-- layer2_agg_gpu4&#45;&gt;layer2_moe_agg -->
<g id="edge95" class="edge">
<title>layer2_agg_gpu4&#45;&gt;layer2_moe_agg</title>
<path fill="none" stroke="black" d="M8107.88,-944.22C8107.88,-944.22 8107.88,-887.54 8107.88,-887.54"/>
<polygon fill="black" stroke="black" points="8111.38,-887.54 8107.88,-877.54 8104.38,-887.54 8111.38,-887.54"/>
</g>
<!-- layer2_experts_gpu5 -->
<g id="node87" class="node">
<title>layer2_experts_gpu5</title>
<polygon fill="lightcoral" stroke="black" points="8723.2,-1123.71 8514.2,-1123.71 8514.2,-1049.71 8723.2,-1049.71 8723.2,-1123.71"/>
<text text-anchor="middle" x="8618.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 5</text>
<text text-anchor="middle" x="8618.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="8618.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="8618.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="8618.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="8618.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer2_route_gpu5&#45;&gt;layer2_experts_gpu5 -->
<g id="edge97" class="edge">
<title>layer2_route_gpu5&#45;&gt;layer2_experts_gpu5</title>
<path fill="none" stroke="black" d="M8618.7,-1160.6C8618.7,-1160.6 8618.7,-1133.81 8618.7,-1133.81"/>
<polygon fill="black" stroke="black" points="8622.2,-1133.81 8618.7,-1123.81 8615.2,-1133.81 8622.2,-1133.81"/>
</g>
<!-- layer2_agg_gpu5 -->
<g id="node88" class="node">
<title>layer2_agg_gpu5</title>
<ellipse fill="lightpink" stroke="black" cx="8623.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="8623.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 5</text>
<text text-anchor="middle" x="8623.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="8623.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="8623.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer2_experts_gpu5&#45;&gt;layer2_agg_gpu5 -->
<g id="edge98" class="edge">
<title>layer2_experts_gpu5&#45;&gt;layer2_agg_gpu5</title>
<path fill="none" stroke="black" d="M8618.7,-1049.52C8618.7,-1049.52 8618.7,-1022.85 8618.7,-1022.85"/>
<polygon fill="black" stroke="black" points="8622.2,-1022.85 8618.7,-1012.85 8615.2,-1022.85 8622.2,-1022.85"/>
</g>
<!-- layer2_agg_gpu5&#45;&gt;layer2_moe_agg -->
<g id="edge99" class="edge">
<title>layer2_agg_gpu5&#45;&gt;layer2_moe_agg</title>
<path fill="none" stroke="black" d="M8623.7,-938.89C8623.7,-908.34 8623.7,-870 8623.7,-870 8623.7,-870 8158.73,-870 8158.73,-870"/>
<polygon fill="black" stroke="black" points="8158.73,-866.5 8148.73,-870 8158.73,-873.5 8158.73,-866.5"/>
</g>
<!-- layer2_experts_gpu6 -->
<g id="node90" class="node">
<title>layer2_experts_gpu6</title>
<polygon fill="lightcoral" stroke="black" points="9135.2,-1123.71 8926.2,-1123.71 8926.2,-1049.71 9135.2,-1049.71 9135.2,-1123.71"/>
<text text-anchor="middle" x="9030.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 6</text>
<text text-anchor="middle" x="9030.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="9030.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="9030.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="9030.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="9030.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer2_route_gpu6&#45;&gt;layer2_experts_gpu6 -->
<g id="edge101" class="edge">
<title>layer2_route_gpu6&#45;&gt;layer2_experts_gpu6</title>
<path fill="none" stroke="black" d="M9030.7,-1160.6C9030.7,-1160.6 9030.7,-1133.81 9030.7,-1133.81"/>
<polygon fill="black" stroke="black" points="9034.2,-1133.81 9030.7,-1123.81 9027.2,-1133.81 9034.2,-1133.81"/>
</g>
<!-- layer2_agg_gpu6 -->
<g id="node91" class="node">
<title>layer2_agg_gpu6</title>
<ellipse fill="lightpink" stroke="black" cx="9038.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="9038.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 6</text>
<text text-anchor="middle" x="9038.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="9038.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="9038.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer2_experts_gpu6&#45;&gt;layer2_agg_gpu6 -->
<g id="edge102" class="edge">
<title>layer2_experts_gpu6&#45;&gt;layer2_agg_gpu6</title>
<path fill="none" stroke="black" d="M9030.7,-1049.52C9030.7,-1049.52 9030.7,-1022.85 9030.7,-1022.85"/>
<polygon fill="black" stroke="black" points="9034.2,-1022.85 9030.7,-1012.85 9027.2,-1022.85 9034.2,-1022.85"/>
</g>
<!-- layer2_agg_gpu6&#45;&gt;layer2_moe_agg -->
<g id="edge103" class="edge">
<title>layer2_agg_gpu6&#45;&gt;layer2_moe_agg</title>
<path fill="none" stroke="black" d="M9038.7,-938.95C9038.7,-904.36 9038.7,-858 9038.7,-858 9038.7,-858 8196.57,-858 8196.57,-858"/>
<polygon fill="black" stroke="black" points="8196.57,-854.5 8186.57,-858 8196.57,-861.5 8196.57,-854.5"/>
</g>
<!-- layer2_experts_gpu7 -->
<g id="node93" class="node">
<title>layer2_experts_gpu7</title>
<polygon fill="lightcoral" stroke="black" points="9549.2,-1123.71 9340.2,-1123.71 9340.2,-1049.71 9549.2,-1049.71 9549.2,-1123.71"/>
<text text-anchor="middle" x="9444.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 7</text>
<text text-anchor="middle" x="9444.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="9444.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="9444.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="9444.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="9444.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer2_route_gpu7&#45;&gt;layer2_experts_gpu7 -->
<g id="edge105" class="edge">
<title>layer2_route_gpu7&#45;&gt;layer2_experts_gpu7</title>
<path fill="none" stroke="black" d="M9444.7,-1160.6C9444.7,-1160.6 9444.7,-1133.81 9444.7,-1133.81"/>
<polygon fill="black" stroke="black" points="9448.2,-1133.81 9444.7,-1123.81 9441.2,-1133.81 9448.2,-1133.81"/>
</g>
<!-- layer2_agg_gpu7 -->
<g id="node94" class="node">
<title>layer2_agg_gpu7</title>
<ellipse fill="lightpink" stroke="black" cx="9453.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="9453.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 7</text>
<text text-anchor="middle" x="9453.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="9453.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="9453.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer2_experts_gpu7&#45;&gt;layer2_agg_gpu7 -->
<g id="edge106" class="edge">
<title>layer2_experts_gpu7&#45;&gt;layer2_agg_gpu7</title>
<path fill="none" stroke="black" d="M9444.7,-1049.52C9444.7,-1049.52 9444.7,-1022.85 9444.7,-1022.85"/>
<polygon fill="black" stroke="black" points="9448.2,-1022.85 9444.7,-1012.85 9441.2,-1022.85 9448.2,-1022.85"/>
</g>
<!-- layer2_agg_gpu7&#45;&gt;layer2_moe_agg -->
<g id="edge107" class="edge">
<title>layer2_agg_gpu7&#45;&gt;layer2_moe_agg</title>
<path fill="none" stroke="black" d="M9453.7,-939.12C9453.7,-900.39 9453.7,-845 9453.7,-845 9453.7,-845 8214.26,-845 8214.26,-845"/>
<polygon fill="black" stroke="black" points="8214.26,-841.5 8204.26,-845 8214.26,-848.5 8214.26,-841.5"/>
</g>
<!-- layer3_ln1 -->
<g id="node96" class="node">
<title>layer3_ln1</title>
<polygon fill="none" stroke="black" points="9809.2,-1365.75 9528.2,-1365.75 9528.2,-1302.75 9809.2,-1302.75 9809.2,-1365.75"/>
<text text-anchor="middle" x="9668.7" y="-1353.75" font-family="Arial" font-size="10.00">LayerNorm MHA 3</text>
<text text-anchor="middle" x="9668.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="9668.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="9668.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="9668.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer3_add1 -->
<g id="node97" class="node">
<title>layer3_add1</title>
<polygon fill="yellow" stroke="black" points="11162.2,-728.4 10881.2,-728.4 10881.2,-676.4 11162.2,-676.4 11162.2,-728.4"/>
<text text-anchor="middle" x="11021.7" y="-716.4" font-family="Arial" font-size="10.00">MHA Residual Add 3</text>
<text text-anchor="middle" x="11021.7" y="-705.4" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="11021.7" y="-694.4" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="11021.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer3_moe_output -->
<g id="node101" class="node">
<title>layer3_moe_output</title>
<polygon fill="yellow" stroke="black" points="11243.2,-617.63 10962.2,-617.63 10962.2,-565.63 11243.2,-565.63 11243.2,-617.63"/>
<text text-anchor="middle" x="11102.7" y="-605.63" font-family="Arial" font-size="10.00">MoE Residual Add 3</text>
<text text-anchor="middle" x="11102.7" y="-594.63" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="11102.7" y="-583.63" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="11102.7" y="-572.63" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer3_add1&#45;&gt;layer3_moe_output -->
<g id="edge145" class="edge">
<title>layer3_add1&#45;&gt;layer3_moe_output</title>
<path fill="none" stroke="black" d="M11062.2,-676.15C11062.2,-676.15 11062.2,-627.7 11062.2,-627.7"/>
<polygon fill="black" stroke="black" points="11065.7,-627.7 11062.2,-617.7 11058.7,-627.7 11065.7,-627.7"/>
</g>
<!-- layer3_gate -->
<g id="node98" class="node">
<title>layer3_gate</title>
<polygon fill="lightgreen" stroke="black" points="11608.13,-1397.25 11149.3,-1397.25 11031.26,-1271.25 11490.1,-1271.25 11608.13,-1397.25"/>
<text text-anchor="middle" x="11319.7" y="-1353.75" font-family="Arial" font-size="10.00">Gate Layer 3</text>
<text text-anchor="middle" x="11319.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="11319.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="11319.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="11319.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, num_experts=16]</text>
</g>
<!-- layer3_route_gpu0 -->
<g id="node102" class="node">
<title>layer3_route_gpu0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="9873.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="9873.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 0</text>
<text text-anchor="middle" x="9873.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="9873.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="9873.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer3_gate&#45;&gt;layer3_route_gpu0 -->
<g id="edge111" class="edge">
<title>layer3_gate&#45;&gt;layer3_route_gpu0</title>
<path fill="none" stroke="black" d="M11056.21,-1298C10655.34,-1298 9938.32,-1298 9938.32,-1298 9938.32,-1298 9938.32,-1242.36 9938.32,-1242.36"/>
<polygon fill="black" stroke="black" points="9941.82,-1242.36 9938.32,-1232.36 9934.82,-1242.36 9941.82,-1242.36"/>
</g>
<!-- layer3_route_gpu1 -->
<g id="node105" class="node">
<title>layer3_route_gpu1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="10293.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="10293.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 1</text>
<text text-anchor="middle" x="10293.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="10293.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="10293.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer3_gate&#45;&gt;layer3_route_gpu1 -->
<g id="edge115" class="edge">
<title>layer3_gate&#45;&gt;layer3_route_gpu1</title>
<path fill="none" stroke="black" d="M11047.78,-1289C10743.82,-1289 10293.7,-1289 10293.7,-1289 10293.7,-1289 10293.7,-1244.44 10293.7,-1244.44"/>
<polygon fill="black" stroke="black" points="10297.2,-1244.44 10293.7,-1234.44 10290.2,-1244.44 10297.2,-1244.44"/>
</g>
<!-- layer3_route_gpu2 -->
<g id="node108" class="node">
<title>layer3_route_gpu2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="10706.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="10706.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 2</text>
<text text-anchor="middle" x="10706.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="10706.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="10706.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer3_gate&#45;&gt;layer3_route_gpu2 -->
<g id="edge119" class="edge">
<title>layer3_gate&#45;&gt;layer3_route_gpu2</title>
<path fill="none" stroke="black" d="M11039.21,-1280C10877.8,-1280 10706.7,-1280 10706.7,-1280 10706.7,-1280 10706.7,-1244.4 10706.7,-1244.4"/>
<polygon fill="black" stroke="black" points="10710.2,-1244.4 10706.7,-1234.4 10703.2,-1244.4 10710.2,-1244.4"/>
</g>
<!-- layer3_route_gpu3 -->
<g id="node111" class="node">
<title>layer3_route_gpu3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="11115.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="11115.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 3</text>
<text text-anchor="middle" x="11115.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="11115.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="11115.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer3_gate&#45;&gt;layer3_route_gpu3 -->
<g id="edge123" class="edge">
<title>layer3_gate&#45;&gt;layer3_route_gpu3</title>
<path fill="none" stroke="black" d="M11170.46,-1271.07C11170.46,-1271.07 11170.46,-1242.78 11170.46,-1242.78"/>
<polygon fill="black" stroke="black" points="11173.96,-1242.78 11170.46,-1232.78 11166.96,-1242.78 11173.96,-1242.78"/>
</g>
<!-- layer3_route_gpu4 -->
<g id="node114" class="node">
<title>layer3_route_gpu4</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="11522.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="11522.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 4</text>
<text text-anchor="middle" x="11522.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="11522.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="11522.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer3_gate&#45;&gt;layer3_route_gpu4 -->
<g id="edge127" class="edge">
<title>layer3_gate&#45;&gt;layer3_route_gpu4</title>
<path fill="none" stroke="black" d="M11468.43,-1271.07C11468.43,-1271.07 11468.43,-1242.78 11468.43,-1242.78"/>
<polygon fill="black" stroke="black" points="11471.93,-1242.78 11468.43,-1232.78 11464.93,-1242.78 11471.93,-1242.78"/>
</g>
<!-- layer3_route_gpu5 -->
<g id="node117" class="node">
<title>layer3_route_gpu5</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="11937.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="11937.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 5</text>
<text text-anchor="middle" x="11937.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="11937.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="11937.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer3_gate&#45;&gt;layer3_route_gpu5 -->
<g id="edge131" class="edge">
<title>layer3_gate&#45;&gt;layer3_route_gpu5</title>
<path fill="none" stroke="black" d="M11498.45,-1280C11680.97,-1280 11937.7,-1280 11937.7,-1280 11937.7,-1280 11937.7,-1244.4 11937.7,-1244.4"/>
<polygon fill="black" stroke="black" points="11941.2,-1244.4 11937.7,-1234.4 11934.2,-1244.4 11941.2,-1244.4"/>
</g>
<!-- layer3_route_gpu6 -->
<g id="node120" class="node">
<title>layer3_route_gpu6</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="12352.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="12352.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 6</text>
<text text-anchor="middle" x="12352.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="12352.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="12352.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer3_gate&#45;&gt;layer3_route_gpu6 -->
<g id="edge135" class="edge">
<title>layer3_gate&#45;&gt;layer3_route_gpu6</title>
<path fill="none" stroke="black" d="M11506.77,-1289C11804.45,-1289 12352.7,-1289 12352.7,-1289 12352.7,-1289 12352.7,-1244.44 12352.7,-1244.44"/>
<polygon fill="black" stroke="black" points="12356.2,-1244.44 12352.7,-1234.44 12349.2,-1244.44 12356.2,-1244.44"/>
</g>
<!-- layer3_route_gpu7 -->
<g id="node123" class="node">
<title>layer3_route_gpu7</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="12767.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="12767.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 7</text>
<text text-anchor="middle" x="12767.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="12767.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="12767.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer3_gate&#45;&gt;layer3_route_gpu7 -->
<g id="edge139" class="edge">
<title>layer3_gate&#45;&gt;layer3_route_gpu7</title>
<path fill="none" stroke="black" d="M11515.18,-1298C11896.92,-1298 12704.57,-1298 12704.57,-1298 12704.57,-1298 12704.57,-1242.36 12704.57,-1242.36"/>
<polygon fill="black" stroke="black" points="12708.07,-1242.36 12704.57,-1232.36 12701.07,-1242.36 12708.07,-1242.36"/>
</g>
<!-- layer3_moe_agg -->
<g id="node99" class="node">
<title>layer3_moe_agg</title>
<ellipse fill="gold" stroke="black" cx="11320.7" cy="-839.17" rx="205.12" ry="44.6"/>
<text text-anchor="middle" x="11320.7" y="-858.67" font-family="Arial" font-size="10.00">MoE Final Aggregation 3</text>
<text text-anchor="middle" x="11320.7" y="-847.67" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="11320.7" y="-836.67" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="11320.7" y="-825.67" font-family="Arial" font-size="10.00">Input: 16Ã—[batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="11320.7" y="-814.67" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer3_ln2 -->
<g id="node100" class="node">
<title>layer3_ln2</title>
<polygon fill="none" stroke="black" points="11461.2,-733.9 11180.2,-733.9 11180.2,-670.9 11461.2,-670.9 11461.2,-733.9"/>
<text text-anchor="middle" x="11320.7" y="-721.9" font-family="Arial" font-size="10.00">LayerNorm MoE 3</text>
<text text-anchor="middle" x="11320.7" y="-710.9" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="11320.7" y="-699.9" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="11320.7" y="-688.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="11320.7" y="-677.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer3_moe_agg&#45;&gt;layer3_ln2 -->
<g id="edge143" class="edge">
<title>layer3_moe_agg&#45;&gt;layer3_ln2</title>
<path fill="none" stroke="black" d="M11320.7,-794.39C11320.7,-794.39 11320.7,-744.29 11320.7,-744.29"/>
<polygon fill="black" stroke="black" points="11324.2,-744.29 11320.7,-734.29 11317.2,-744.29 11324.2,-744.29"/>
</g>
<!-- layer3_ln2&#45;&gt;layer3_moe_output -->
<g id="edge144" class="edge">
<title>layer3_ln2&#45;&gt;layer3_moe_output</title>
<path fill="none" stroke="black" d="M11211.7,-670.66C11211.7,-670.66 11211.7,-627.78 11211.7,-627.78"/>
<polygon fill="black" stroke="black" points="11215.2,-627.78 11211.7,-617.78 11208.2,-627.78 11215.2,-627.78"/>
</g>
<!-- layer4_mha -->
<g id="node126" class="node">
<title>layer4_mha</title>
<polygon fill="lightcyan" stroke="black" points="11243.2,-483.37 10962.2,-483.37 10962.2,-420.37 11243.2,-420.37 11243.2,-483.37"/>
<text text-anchor="middle" x="11102.7" y="-471.37" font-family="Arial" font-size="10.00">MHA Layer 4</text>
<text text-anchor="middle" x="11102.7" y="-460.37" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="11102.7" y="-449.37" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="11102.7" y="-438.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="11102.7" y="-427.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer3_moe_output&#45;&gt;layer4_mha -->
<g id="edge569" class="edge">
<title>layer3_moe_output&#45;&gt;layer4_mha</title>
<path fill="none" stroke="black" d="M11102.7,-565.34C11102.7,-565.34 11102.7,-493.42 11102.7,-493.42"/>
<polygon fill="black" stroke="black" points="11106.2,-493.42 11102.7,-483.42 11099.2,-493.42 11106.2,-493.42"/>
</g>
<!-- layer3_experts_gpu0 -->
<g id="node103" class="node">
<title>layer3_experts_gpu0</title>
<polygon fill="lightcoral" stroke="black" points="9976.2,-1123.71 9767.2,-1123.71 9767.2,-1049.71 9976.2,-1049.71 9976.2,-1123.71"/>
<text text-anchor="middle" x="9871.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 0</text>
<text text-anchor="middle" x="9871.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="9871.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="9871.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="9871.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="9871.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer3_route_gpu0&#45;&gt;layer3_experts_gpu0 -->
<g id="edge112" class="edge">
<title>layer3_route_gpu0&#45;&gt;layer3_experts_gpu0</title>
<path fill="none" stroke="black" d="M9871.7,-1160.6C9871.7,-1160.6 9871.7,-1133.81 9871.7,-1133.81"/>
<polygon fill="black" stroke="black" points="9875.2,-1133.81 9871.7,-1123.81 9868.2,-1133.81 9875.2,-1133.81"/>
</g>
<!-- layer3_agg_gpu0 -->
<g id="node104" class="node">
<title>layer3_agg_gpu0</title>
<ellipse fill="lightpink" stroke="black" cx="9868.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="9868.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 0</text>
<text text-anchor="middle" x="9868.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="9868.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="9868.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer3_experts_gpu0&#45;&gt;layer3_agg_gpu0 -->
<g id="edge113" class="edge">
<title>layer3_experts_gpu0&#45;&gt;layer3_agg_gpu0</title>
<path fill="none" stroke="black" d="M9871.7,-1049.52C9871.7,-1049.52 9871.7,-1022.85 9871.7,-1022.85"/>
<polygon fill="black" stroke="black" points="9875.2,-1022.85 9871.7,-1012.85 9868.2,-1022.85 9875.2,-1022.85"/>
</g>
<!-- layer3_agg_gpu0&#45;&gt;layer3_moe_agg -->
<g id="edge114" class="edge">
<title>layer3_agg_gpu0&#45;&gt;layer3_moe_agg</title>
<path fill="none" stroke="black" d="M9868.7,-938.87C9868.7,-889.14 9868.7,-807 9868.7,-807 9868.7,-807 11168.83,-807 11168.83,-807"/>
<polygon fill="black" stroke="black" points="11168.83,-810.5 11178.83,-807 11168.83,-803.5 11168.83,-810.5"/>
</g>
<!-- layer3_experts_gpu1 -->
<g id="node106" class="node">
<title>layer3_experts_gpu1</title>
<polygon fill="lightcoral" stroke="black" points="10391.2,-1123.71 10182.2,-1123.71 10182.2,-1049.71 10391.2,-1049.71 10391.2,-1123.71"/>
<text text-anchor="middle" x="10286.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 1</text>
<text text-anchor="middle" x="10286.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="10286.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="10286.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="10286.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="10286.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer3_route_gpu1&#45;&gt;layer3_experts_gpu1 -->
<g id="edge116" class="edge">
<title>layer3_route_gpu1&#45;&gt;layer3_experts_gpu1</title>
<path fill="none" stroke="black" d="M10286.7,-1160.6C10286.7,-1160.6 10286.7,-1133.81 10286.7,-1133.81"/>
<polygon fill="black" stroke="black" points="10290.2,-1133.81 10286.7,-1123.81 10283.2,-1133.81 10290.2,-1133.81"/>
</g>
<!-- layer3_agg_gpu1 -->
<g id="node107" class="node">
<title>layer3_agg_gpu1</title>
<ellipse fill="lightpink" stroke="black" cx="10283.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="10283.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 1</text>
<text text-anchor="middle" x="10283.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="10283.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="10283.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer3_experts_gpu1&#45;&gt;layer3_agg_gpu1 -->
<g id="edge117" class="edge">
<title>layer3_experts_gpu1&#45;&gt;layer3_agg_gpu1</title>
<path fill="none" stroke="black" d="M10286.7,-1049.52C10286.7,-1049.52 10286.7,-1022.85 10286.7,-1022.85"/>
<polygon fill="black" stroke="black" points="10290.2,-1022.85 10286.7,-1012.85 10283.2,-1022.85 10290.2,-1022.85"/>
</g>
<!-- layer3_agg_gpu1&#45;&gt;layer3_moe_agg -->
<g id="edge118" class="edge">
<title>layer3_agg_gpu1&#45;&gt;layer3_moe_agg</title>
<path fill="none" stroke="black" d="M10283.7,-938.99C10283.7,-892.87 10283.7,-820 10283.7,-820 10283.7,-820 11125.6,-820 11125.6,-820"/>
<polygon fill="black" stroke="black" points="11125.6,-823.5 11135.6,-820 11125.6,-816.5 11125.6,-823.5"/>
</g>
<!-- layer3_experts_gpu2 -->
<g id="node109" class="node">
<title>layer3_experts_gpu2</title>
<polygon fill="lightcoral" stroke="black" points="10808.2,-1123.71 10599.2,-1123.71 10599.2,-1049.71 10808.2,-1049.71 10808.2,-1123.71"/>
<text text-anchor="middle" x="10703.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 2</text>
<text text-anchor="middle" x="10703.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="10703.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="10703.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="10703.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="10703.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer3_route_gpu2&#45;&gt;layer3_experts_gpu2 -->
<g id="edge120" class="edge">
<title>layer3_route_gpu2&#45;&gt;layer3_experts_gpu2</title>
<path fill="none" stroke="black" d="M10703.7,-1160.6C10703.7,-1160.6 10703.7,-1133.81 10703.7,-1133.81"/>
<polygon fill="black" stroke="black" points="10707.2,-1133.81 10703.7,-1123.81 10700.2,-1133.81 10707.2,-1133.81"/>
</g>
<!-- layer3_agg_gpu2 -->
<g id="node110" class="node">
<title>layer3_agg_gpu2</title>
<ellipse fill="lightpink" stroke="black" cx="10698.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="10698.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 2</text>
<text text-anchor="middle" x="10698.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="10698.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="10698.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer3_experts_gpu2&#45;&gt;layer3_agg_gpu2 -->
<g id="edge121" class="edge">
<title>layer3_experts_gpu2&#45;&gt;layer3_agg_gpu2</title>
<path fill="none" stroke="black" d="M10703.7,-1049.52C10703.7,-1049.52 10703.7,-1022.85 10703.7,-1022.85"/>
<polygon fill="black" stroke="black" points="10707.2,-1022.85 10703.7,-1012.85 10700.2,-1022.85 10707.2,-1022.85"/>
</g>
<!-- layer3_agg_gpu2&#45;&gt;layer3_moe_agg -->
<g id="edge122" class="edge">
<title>layer3_agg_gpu2&#45;&gt;layer3_moe_agg</title>
<path fill="none" stroke="black" d="M10889.3,-965.12C10889.3,-931.65 10889.3,-832 10889.3,-832 10889.3,-832 11108.26,-832 11108.26,-832"/>
<polygon fill="black" stroke="black" points="11108.26,-835.5 11118.26,-832 11108.26,-828.5 11108.26,-835.5"/>
</g>
<!-- layer3_experts_gpu3 -->
<g id="node112" class="node">
<title>layer3_experts_gpu3</title>
<polygon fill="lightcoral" stroke="black" points="11219.2,-1123.71 11010.2,-1123.71 11010.2,-1049.71 11219.2,-1049.71 11219.2,-1123.71"/>
<text text-anchor="middle" x="11114.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 3</text>
<text text-anchor="middle" x="11114.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="11114.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="11114.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="11114.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="11114.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer3_route_gpu3&#45;&gt;layer3_experts_gpu3 -->
<g id="edge124" class="edge">
<title>layer3_route_gpu3&#45;&gt;layer3_experts_gpu3</title>
<path fill="none" stroke="black" d="M11114.7,-1160.6C11114.7,-1160.6 11114.7,-1133.81 11114.7,-1133.81"/>
<polygon fill="black" stroke="black" points="11118.2,-1133.81 11114.7,-1123.81 11111.2,-1133.81 11118.2,-1133.81"/>
</g>
<!-- layer3_agg_gpu3 -->
<g id="node113" class="node">
<title>layer3_agg_gpu3</title>
<ellipse fill="lightpink" stroke="black" cx="11113.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="11113.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 3</text>
<text text-anchor="middle" x="11113.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="11113.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="11113.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer3_experts_gpu3&#45;&gt;layer3_agg_gpu3 -->
<g id="edge125" class="edge">
<title>layer3_experts_gpu3&#45;&gt;layer3_agg_gpu3</title>
<path fill="none" stroke="black" d="M11114.7,-1049.52C11114.7,-1049.52 11114.7,-1022.85 11114.7,-1022.85"/>
<polygon fill="black" stroke="black" points="11118.2,-1022.85 11114.7,-1012.85 11111.2,-1022.85 11118.2,-1022.85"/>
</g>
<!-- layer3_agg_gpu3&#45;&gt;layer3_moe_agg -->
<g id="edge126" class="edge">
<title>layer3_agg_gpu3&#45;&gt;layer3_moe_agg</title>
<path fill="none" stroke="black" d="M11214.02,-943.88C11214.02,-943.88 11214.02,-887.36 11214.02,-887.36"/>
<polygon fill="black" stroke="black" points="11217.52,-887.36 11214.02,-877.36 11210.52,-887.36 11217.52,-887.36"/>
</g>
<!-- layer3_experts_gpu4 -->
<g id="node115" class="node">
<title>layer3_experts_gpu4</title>
<polygon fill="lightcoral" stroke="black" points="11629.2,-1123.71 11420.2,-1123.71 11420.2,-1049.71 11629.2,-1049.71 11629.2,-1123.71"/>
<text text-anchor="middle" x="11524.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 4</text>
<text text-anchor="middle" x="11524.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="11524.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="11524.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="11524.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="11524.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer3_route_gpu4&#45;&gt;layer3_experts_gpu4 -->
<g id="edge128" class="edge">
<title>layer3_route_gpu4&#45;&gt;layer3_experts_gpu4</title>
<path fill="none" stroke="black" d="M11524.7,-1160.6C11524.7,-1160.6 11524.7,-1133.81 11524.7,-1133.81"/>
<polygon fill="black" stroke="black" points="11528.2,-1133.81 11524.7,-1123.81 11521.2,-1133.81 11528.2,-1133.81"/>
</g>
<!-- layer3_agg_gpu4 -->
<g id="node116" class="node">
<title>layer3_agg_gpu4</title>
<ellipse fill="lightpink" stroke="black" cx="11528.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="11528.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 4</text>
<text text-anchor="middle" x="11528.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="11528.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="11528.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer3_experts_gpu4&#45;&gt;layer3_agg_gpu4 -->
<g id="edge129" class="edge">
<title>layer3_experts_gpu4&#45;&gt;layer3_agg_gpu4</title>
<path fill="none" stroke="black" d="M11524.7,-1049.52C11524.7,-1049.52 11524.7,-1022.85 11524.7,-1022.85"/>
<polygon fill="black" stroke="black" points="11528.2,-1022.85 11524.7,-1012.85 11521.2,-1022.85 11528.2,-1022.85"/>
</g>
<!-- layer3_agg_gpu4&#45;&gt;layer3_moe_agg -->
<g id="edge130" class="edge">
<title>layer3_agg_gpu4&#45;&gt;layer3_moe_agg</title>
<path fill="none" stroke="black" d="M11427.88,-944.22C11427.88,-944.22 11427.88,-887.54 11427.88,-887.54"/>
<polygon fill="black" stroke="black" points="11431.38,-887.54 11427.88,-877.54 11424.38,-887.54 11431.38,-887.54"/>
</g>
<!-- layer3_experts_gpu5 -->
<g id="node118" class="node">
<title>layer3_experts_gpu5</title>
<polygon fill="lightcoral" stroke="black" points="12047.2,-1123.71 11838.2,-1123.71 11838.2,-1049.71 12047.2,-1049.71 12047.2,-1123.71"/>
<text text-anchor="middle" x="11942.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 5</text>
<text text-anchor="middle" x="11942.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="11942.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="11942.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="11942.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="11942.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer3_route_gpu5&#45;&gt;layer3_experts_gpu5 -->
<g id="edge132" class="edge">
<title>layer3_route_gpu5&#45;&gt;layer3_experts_gpu5</title>
<path fill="none" stroke="black" d="M11942.7,-1160.6C11942.7,-1160.6 11942.7,-1133.81 11942.7,-1133.81"/>
<polygon fill="black" stroke="black" points="11946.2,-1133.81 11942.7,-1123.81 11939.2,-1133.81 11946.2,-1133.81"/>
</g>
<!-- layer3_agg_gpu5 -->
<g id="node119" class="node">
<title>layer3_agg_gpu5</title>
<ellipse fill="lightpink" stroke="black" cx="11943.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="11943.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 5</text>
<text text-anchor="middle" x="11943.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="11943.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="11943.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer3_experts_gpu5&#45;&gt;layer3_agg_gpu5 -->
<g id="edge133" class="edge">
<title>layer3_experts_gpu5&#45;&gt;layer3_agg_gpu5</title>
<path fill="none" stroke="black" d="M11942.7,-1049.52C11942.7,-1049.52 11942.7,-1022.85 11942.7,-1022.85"/>
<polygon fill="black" stroke="black" points="11946.2,-1022.85 11942.7,-1012.85 11939.2,-1022.85 11946.2,-1022.85"/>
</g>
<!-- layer3_agg_gpu5&#45;&gt;layer3_moe_agg -->
<g id="edge134" class="edge">
<title>layer3_agg_gpu5&#45;&gt;layer3_moe_agg</title>
<path fill="none" stroke="black" d="M11943.7,-938.89C11943.7,-908.34 11943.7,-870 11943.7,-870 11943.7,-870 11478.73,-870 11478.73,-870"/>
<polygon fill="black" stroke="black" points="11478.73,-866.5 11468.73,-870 11478.73,-873.5 11478.73,-866.5"/>
</g>
<!-- layer3_experts_gpu6 -->
<g id="node121" class="node">
<title>layer3_experts_gpu6</title>
<polygon fill="lightcoral" stroke="black" points="12461.2,-1123.71 12252.2,-1123.71 12252.2,-1049.71 12461.2,-1049.71 12461.2,-1123.71"/>
<text text-anchor="middle" x="12356.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 6</text>
<text text-anchor="middle" x="12356.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="12356.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="12356.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="12356.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="12356.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer3_route_gpu6&#45;&gt;layer3_experts_gpu6 -->
<g id="edge136" class="edge">
<title>layer3_route_gpu6&#45;&gt;layer3_experts_gpu6</title>
<path fill="none" stroke="black" d="M12356.7,-1160.6C12356.7,-1160.6 12356.7,-1133.81 12356.7,-1133.81"/>
<polygon fill="black" stroke="black" points="12360.2,-1133.81 12356.7,-1123.81 12353.2,-1133.81 12360.2,-1133.81"/>
</g>
<!-- layer3_agg_gpu6 -->
<g id="node122" class="node">
<title>layer3_agg_gpu6</title>
<ellipse fill="lightpink" stroke="black" cx="12358.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="12358.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 6</text>
<text text-anchor="middle" x="12358.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="12358.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="12358.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer3_experts_gpu6&#45;&gt;layer3_agg_gpu6 -->
<g id="edge137" class="edge">
<title>layer3_experts_gpu6&#45;&gt;layer3_agg_gpu6</title>
<path fill="none" stroke="black" d="M12356.7,-1049.52C12356.7,-1049.52 12356.7,-1022.85 12356.7,-1022.85"/>
<polygon fill="black" stroke="black" points="12360.2,-1022.85 12356.7,-1012.85 12353.2,-1022.85 12360.2,-1022.85"/>
</g>
<!-- layer3_agg_gpu6&#45;&gt;layer3_moe_agg -->
<g id="edge138" class="edge">
<title>layer3_agg_gpu6&#45;&gt;layer3_moe_agg</title>
<path fill="none" stroke="black" d="M12358.7,-938.95C12358.7,-904.36 12358.7,-858 12358.7,-858 12358.7,-858 11516.57,-858 11516.57,-858"/>
<polygon fill="black" stroke="black" points="11516.57,-854.5 11506.57,-858 11516.57,-861.5 11516.57,-854.5"/>
</g>
<!-- layer3_experts_gpu7 -->
<g id="node124" class="node">
<title>layer3_experts_gpu7</title>
<polygon fill="lightcoral" stroke="black" points="12874.2,-1123.71 12665.2,-1123.71 12665.2,-1049.71 12874.2,-1049.71 12874.2,-1123.71"/>
<text text-anchor="middle" x="12769.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 7</text>
<text text-anchor="middle" x="12769.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="12769.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="12769.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="12769.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="12769.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer3_route_gpu7&#45;&gt;layer3_experts_gpu7 -->
<g id="edge140" class="edge">
<title>layer3_route_gpu7&#45;&gt;layer3_experts_gpu7</title>
<path fill="none" stroke="black" d="M12769.7,-1160.6C12769.7,-1160.6 12769.7,-1133.81 12769.7,-1133.81"/>
<polygon fill="black" stroke="black" points="12773.2,-1133.81 12769.7,-1123.81 12766.2,-1133.81 12773.2,-1133.81"/>
</g>
<!-- layer3_agg_gpu7 -->
<g id="node125" class="node">
<title>layer3_agg_gpu7</title>
<ellipse fill="lightpink" stroke="black" cx="12773.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="12773.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 7</text>
<text text-anchor="middle" x="12773.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="12773.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="12773.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer3_experts_gpu7&#45;&gt;layer3_agg_gpu7 -->
<g id="edge141" class="edge">
<title>layer3_experts_gpu7&#45;&gt;layer3_agg_gpu7</title>
<path fill="none" stroke="black" d="M12769.7,-1049.52C12769.7,-1049.52 12769.7,-1022.85 12769.7,-1022.85"/>
<polygon fill="black" stroke="black" points="12773.2,-1022.85 12769.7,-1012.85 12766.2,-1022.85 12773.2,-1022.85"/>
</g>
<!-- layer3_agg_gpu7&#45;&gt;layer3_moe_agg -->
<g id="edge142" class="edge">
<title>layer3_agg_gpu7&#45;&gt;layer3_moe_agg</title>
<path fill="none" stroke="black" d="M12773.7,-939.12C12773.7,-900.39 12773.7,-845 12773.7,-845 12773.7,-845 11534.26,-845 11534.26,-845"/>
<polygon fill="black" stroke="black" points="11534.26,-841.5 11524.26,-845 11534.26,-848.5 11534.26,-841.5"/>
</g>
<!-- layer4_ln1 -->
<g id="node127" class="node">
<title>layer4_ln1</title>
<polygon fill="none" stroke="black" points="12835.2,-1365.75 12554.2,-1365.75 12554.2,-1302.75 12835.2,-1302.75 12835.2,-1365.75"/>
<text text-anchor="middle" x="12694.7" y="-1353.75" font-family="Arial" font-size="10.00">LayerNorm MHA 4</text>
<text text-anchor="middle" x="12694.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="12694.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="12694.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="12694.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer4_add1 -->
<g id="node128" class="node">
<title>layer4_add1</title>
<polygon fill="yellow" stroke="black" points="14434.2,-728.4 14153.2,-728.4 14153.2,-676.4 14434.2,-676.4 14434.2,-728.4"/>
<text text-anchor="middle" x="14293.7" y="-716.4" font-family="Arial" font-size="10.00">MHA Residual Add 4</text>
<text text-anchor="middle" x="14293.7" y="-705.4" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="14293.7" y="-694.4" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="14293.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer4_moe_output -->
<g id="node132" class="node">
<title>layer4_moe_output</title>
<polygon fill="yellow" stroke="black" points="14515.2,-617.63 14234.2,-617.63 14234.2,-565.63 14515.2,-565.63 14515.2,-617.63"/>
<text text-anchor="middle" x="14374.7" y="-605.63" font-family="Arial" font-size="10.00">MoE Residual Add 4</text>
<text text-anchor="middle" x="14374.7" y="-594.63" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="14374.7" y="-583.63" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="14374.7" y="-572.63" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer4_add1&#45;&gt;layer4_moe_output -->
<g id="edge180" class="edge">
<title>layer4_add1&#45;&gt;layer4_moe_output</title>
<path fill="none" stroke="black" d="M14334.2,-676.15C14334.2,-676.15 14334.2,-627.7 14334.2,-627.7"/>
<polygon fill="black" stroke="black" points="14337.7,-627.7 14334.2,-617.7 14330.7,-627.7 14337.7,-627.7"/>
</g>
<!-- layer4_gate -->
<g id="node129" class="node">
<title>layer4_gate</title>
<polygon fill="lightgreen" stroke="black" points="14833.13,-1397.25 14374.3,-1397.25 14256.26,-1271.25 14715.1,-1271.25 14833.13,-1397.25"/>
<text text-anchor="middle" x="14544.7" y="-1353.75" font-family="Arial" font-size="10.00">Gate Layer 4</text>
<text text-anchor="middle" x="14544.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="14544.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="14544.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="14544.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, num_experts=16]</text>
</g>
<!-- layer4_route_gpu0 -->
<g id="node133" class="node">
<title>layer4_route_gpu0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="13193.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="13193.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 0</text>
<text text-anchor="middle" x="13193.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="13193.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="13193.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer4_gate&#45;&gt;layer4_route_gpu0 -->
<g id="edge146" class="edge">
<title>layer4_gate&#45;&gt;layer4_route_gpu0</title>
<path fill="none" stroke="black" d="M14276.57,-1293C13882.65,-1293 13193.7,-1293 13193.7,-1293 13193.7,-1293 13193.7,-1244.41 13193.7,-1244.41"/>
<polygon fill="black" stroke="black" points="13197.2,-1244.41 13193.7,-1234.41 13190.2,-1244.41 13197.2,-1244.41"/>
</g>
<!-- layer4_route_gpu1 -->
<g id="node136" class="node">
<title>layer4_route_gpu1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="13613.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="13613.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 1</text>
<text text-anchor="middle" x="13613.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="13613.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="13613.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer4_gate&#45;&gt;layer4_route_gpu1 -->
<g id="edge150" class="edge">
<title>layer4_gate&#45;&gt;layer4_route_gpu1</title>
<path fill="none" stroke="black" d="M14268.2,-1284C13993.74,-1284 13613.7,-1284 13613.7,-1284 13613.7,-1284 13613.7,-1244.42 13613.7,-1244.42"/>
<polygon fill="black" stroke="black" points="13617.2,-1244.42 13613.7,-1234.42 13610.2,-1244.42 13617.2,-1244.42"/>
</g>
<!-- layer4_route_gpu2 -->
<g id="node139" class="node">
<title>layer4_route_gpu2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="14025.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="14025.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 2</text>
<text text-anchor="middle" x="14025.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="14025.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="14025.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer4_gate&#45;&gt;layer4_route_gpu2 -->
<g id="edge154" class="edge">
<title>layer4_gate&#45;&gt;layer4_route_gpu2</title>
<path fill="none" stroke="black" d="M14259.76,-1275C14139.02,-1275 14025.7,-1275 14025.7,-1275 14025.7,-1275 14025.7,-1244.42 14025.7,-1244.42"/>
<polygon fill="black" stroke="black" points="14029.2,-1244.42 14025.7,-1234.42 14022.2,-1244.42 14029.2,-1244.42"/>
</g>
<!-- layer4_route_gpu3 -->
<g id="node142" class="node">
<title>layer4_route_gpu3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="14434.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="14434.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 3</text>
<text text-anchor="middle" x="14434.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="14434.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="14434.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer4_gate&#45;&gt;layer4_route_gpu3 -->
<g id="edge158" class="edge">
<title>layer4_gate&#45;&gt;layer4_route_gpu3</title>
<path fill="none" stroke="black" d="M14442.46,-1271.07C14442.46,-1271.07 14442.46,-1244.29 14442.46,-1244.29"/>
<polygon fill="black" stroke="black" points="14445.96,-1244.29 14442.46,-1234.29 14438.96,-1244.29 14445.96,-1244.29"/>
</g>
<!-- layer4_route_gpu4 -->
<g id="node145" class="node">
<title>layer4_route_gpu4</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="14844.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="14844.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 4</text>
<text text-anchor="middle" x="14844.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="14844.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="14844.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer4_gate&#45;&gt;layer4_route_gpu4 -->
<g id="edge162" class="edge">
<title>layer4_gate&#45;&gt;layer4_route_gpu4</title>
<path fill="none" stroke="black" d="M14741.93,-1299.74C14741.93,-1299.74 14741.93,-1238.71 14741.93,-1238.71"/>
<polygon fill="black" stroke="black" points="14745.43,-1238.71 14741.93,-1228.71 14738.43,-1238.71 14745.43,-1238.71"/>
</g>
<!-- layer4_route_gpu5 -->
<g id="node148" class="node">
<title>layer4_route_gpu5</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="15256.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="15256.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 5</text>
<text text-anchor="middle" x="15256.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="15256.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="15256.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer4_gate&#45;&gt;layer4_route_gpu5 -->
<g id="edge166" class="edge">
<title>layer4_gate&#45;&gt;layer4_route_gpu5</title>
<path fill="none" stroke="black" d="M14723.45,-1280C14934.35,-1280 15256.7,-1280 15256.7,-1280 15256.7,-1280 15256.7,-1244.4 15256.7,-1244.4"/>
<polygon fill="black" stroke="black" points="15260.2,-1244.4 15256.7,-1234.4 15253.2,-1244.4 15260.2,-1244.4"/>
</g>
<!-- layer4_route_gpu6 -->
<g id="node151" class="node">
<title>layer4_route_gpu6</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="15670.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="15670.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 6</text>
<text text-anchor="middle" x="15670.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="15670.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="15670.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer4_gate&#45;&gt;layer4_route_gpu6 -->
<g id="edge170" class="edge">
<title>layer4_gate&#45;&gt;layer4_route_gpu6</title>
<path fill="none" stroke="black" d="M14731.9,-1289C15052.08,-1289 15670.7,-1289 15670.7,-1289 15670.7,-1289 15670.7,-1244.44 15670.7,-1244.44"/>
<polygon fill="black" stroke="black" points="15674.2,-1244.44 15670.7,-1234.44 15667.2,-1244.44 15674.2,-1244.44"/>
</g>
<!-- layer4_route_gpu7 -->
<g id="node154" class="node">
<title>layer4_route_gpu7</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="16084.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="16084.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 7</text>
<text text-anchor="middle" x="16084.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="16084.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="16084.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer4_gate&#45;&gt;layer4_route_gpu7 -->
<g id="edge174" class="edge">
<title>layer4_gate&#45;&gt;layer4_route_gpu7</title>
<path fill="none" stroke="black" d="M14740.49,-1298C15132.61,-1298 15977.07,-1298 15977.07,-1298 15977.07,-1298 15977.07,-1238.19 15977.07,-1238.19"/>
<polygon fill="black" stroke="black" points="15980.57,-1238.19 15977.07,-1228.19 15973.57,-1238.19 15980.57,-1238.19"/>
</g>
<!-- layer4_moe_agg -->
<g id="node130" class="node">
<title>layer4_moe_agg</title>
<ellipse fill="gold" stroke="black" cx="14592.7" cy="-839.17" rx="205.12" ry="44.6"/>
<text text-anchor="middle" x="14592.7" y="-858.67" font-family="Arial" font-size="10.00">MoE Final Aggregation 4</text>
<text text-anchor="middle" x="14592.7" y="-847.67" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="14592.7" y="-836.67" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="14592.7" y="-825.67" font-family="Arial" font-size="10.00">Input: 16Ã—[batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="14592.7" y="-814.67" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer4_ln2 -->
<g id="node131" class="node">
<title>layer4_ln2</title>
<polygon fill="none" stroke="black" points="14733.2,-733.9 14452.2,-733.9 14452.2,-670.9 14733.2,-670.9 14733.2,-733.9"/>
<text text-anchor="middle" x="14592.7" y="-721.9" font-family="Arial" font-size="10.00">LayerNorm MoE 4</text>
<text text-anchor="middle" x="14592.7" y="-710.9" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="14592.7" y="-699.9" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="14592.7" y="-688.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="14592.7" y="-677.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer4_moe_agg&#45;&gt;layer4_ln2 -->
<g id="edge178" class="edge">
<title>layer4_moe_agg&#45;&gt;layer4_ln2</title>
<path fill="none" stroke="black" d="M14592.7,-794.39C14592.7,-794.39 14592.7,-744.29 14592.7,-744.29"/>
<polygon fill="black" stroke="black" points="14596.2,-744.29 14592.7,-734.29 14589.2,-744.29 14596.2,-744.29"/>
</g>
<!-- layer4_ln2&#45;&gt;layer4_moe_output -->
<g id="edge179" class="edge">
<title>layer4_ln2&#45;&gt;layer4_moe_output</title>
<path fill="none" stroke="black" d="M14483.7,-670.66C14483.7,-670.66 14483.7,-627.78 14483.7,-627.78"/>
<polygon fill="black" stroke="black" points="14487.2,-627.78 14483.7,-617.78 14480.2,-627.78 14487.2,-627.78"/>
</g>
<!-- layer5_mha -->
<g id="node157" class="node">
<title>layer5_mha</title>
<polygon fill="lightcyan" stroke="black" points="14515.2,-483.37 14234.2,-483.37 14234.2,-420.37 14515.2,-420.37 14515.2,-483.37"/>
<text text-anchor="middle" x="14374.7" y="-471.37" font-family="Arial" font-size="10.00">MHA Layer 5</text>
<text text-anchor="middle" x="14374.7" y="-460.37" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="14374.7" y="-449.37" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="14374.7" y="-438.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="14374.7" y="-427.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer4_moe_output&#45;&gt;layer5_mha -->
<g id="edge570" class="edge">
<title>layer4_moe_output&#45;&gt;layer5_mha</title>
<path fill="none" stroke="black" d="M14374.7,-565.34C14374.7,-565.34 14374.7,-493.42 14374.7,-493.42"/>
<polygon fill="black" stroke="black" points="14378.2,-493.42 14374.7,-483.42 14371.2,-493.42 14378.2,-493.42"/>
</g>
<!-- layer4_experts_gpu0 -->
<g id="node134" class="node">
<title>layer4_experts_gpu0</title>
<polygon fill="lightcoral" stroke="black" points="13295.2,-1123.71 13086.2,-1123.71 13086.2,-1049.71 13295.2,-1049.71 13295.2,-1123.71"/>
<text text-anchor="middle" x="13190.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 0</text>
<text text-anchor="middle" x="13190.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="13190.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="13190.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="13190.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="13190.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer4_route_gpu0&#45;&gt;layer4_experts_gpu0 -->
<g id="edge147" class="edge">
<title>layer4_route_gpu0&#45;&gt;layer4_experts_gpu0</title>
<path fill="none" stroke="black" d="M13190.7,-1160.6C13190.7,-1160.6 13190.7,-1133.81 13190.7,-1133.81"/>
<polygon fill="black" stroke="black" points="13194.2,-1133.81 13190.7,-1123.81 13187.2,-1133.81 13194.2,-1133.81"/>
</g>
<!-- layer4_agg_gpu0 -->
<g id="node135" class="node">
<title>layer4_agg_gpu0</title>
<ellipse fill="lightpink" stroke="black" cx="13188.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="13188.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 0</text>
<text text-anchor="middle" x="13188.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="13188.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="13188.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer4_experts_gpu0&#45;&gt;layer4_agg_gpu0 -->
<g id="edge148" class="edge">
<title>layer4_experts_gpu0&#45;&gt;layer4_agg_gpu0</title>
<path fill="none" stroke="black" d="M13190.7,-1049.52C13190.7,-1049.52 13190.7,-1022.85 13190.7,-1022.85"/>
<polygon fill="black" stroke="black" points="13194.2,-1022.85 13190.7,-1012.85 13187.2,-1022.85 13194.2,-1022.85"/>
</g>
<!-- layer4_agg_gpu0&#45;&gt;layer4_moe_agg -->
<g id="edge149" class="edge">
<title>layer4_agg_gpu0&#45;&gt;layer4_moe_agg</title>
<path fill="none" stroke="black" d="M13188.7,-938.87C13188.7,-889.14 13188.7,-807 13188.7,-807 13188.7,-807 14440.67,-807 14440.67,-807"/>
<polygon fill="black" stroke="black" points="14440.67,-810.5 14450.67,-807 14440.67,-803.5 14440.67,-810.5"/>
</g>
<!-- layer4_experts_gpu1 -->
<g id="node137" class="node">
<title>layer4_experts_gpu1</title>
<polygon fill="lightcoral" stroke="black" points="13713.2,-1123.71 13504.2,-1123.71 13504.2,-1049.71 13713.2,-1049.71 13713.2,-1123.71"/>
<text text-anchor="middle" x="13608.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 1</text>
<text text-anchor="middle" x="13608.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="13608.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="13608.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="13608.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="13608.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer4_route_gpu1&#45;&gt;layer4_experts_gpu1 -->
<g id="edge151" class="edge">
<title>layer4_route_gpu1&#45;&gt;layer4_experts_gpu1</title>
<path fill="none" stroke="black" d="M13608.7,-1160.6C13608.7,-1160.6 13608.7,-1133.81 13608.7,-1133.81"/>
<polygon fill="black" stroke="black" points="13612.2,-1133.81 13608.7,-1123.81 13605.2,-1133.81 13612.2,-1133.81"/>
</g>
<!-- layer4_agg_gpu1 -->
<g id="node138" class="node">
<title>layer4_agg_gpu1</title>
<ellipse fill="lightpink" stroke="black" cx="13603.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="13603.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 1</text>
<text text-anchor="middle" x="13603.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="13603.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="13603.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer4_experts_gpu1&#45;&gt;layer4_agg_gpu1 -->
<g id="edge152" class="edge">
<title>layer4_experts_gpu1&#45;&gt;layer4_agg_gpu1</title>
<path fill="none" stroke="black" d="M13608.7,-1049.52C13608.7,-1049.52 13608.7,-1022.85 13608.7,-1022.85"/>
<polygon fill="black" stroke="black" points="13612.2,-1022.85 13608.7,-1012.85 13605.2,-1022.85 13612.2,-1022.85"/>
</g>
<!-- layer4_agg_gpu1&#45;&gt;layer4_moe_agg -->
<g id="edge153" class="edge">
<title>layer4_agg_gpu1&#45;&gt;layer4_moe_agg</title>
<path fill="none" stroke="black" d="M13603.7,-938.99C13603.7,-892.87 13603.7,-820 13603.7,-820 13603.7,-820 14397.54,-820 14397.54,-820"/>
<polygon fill="black" stroke="black" points="14397.54,-823.5 14407.54,-820 14397.54,-816.5 14397.54,-823.5"/>
</g>
<!-- layer4_experts_gpu2 -->
<g id="node140" class="node">
<title>layer4_experts_gpu2</title>
<polygon fill="lightcoral" stroke="black" points="14128.2,-1123.71 13919.2,-1123.71 13919.2,-1049.71 14128.2,-1049.71 14128.2,-1123.71"/>
<text text-anchor="middle" x="14023.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 2</text>
<text text-anchor="middle" x="14023.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="14023.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="14023.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="14023.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="14023.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer4_route_gpu2&#45;&gt;layer4_experts_gpu2 -->
<g id="edge155" class="edge">
<title>layer4_route_gpu2&#45;&gt;layer4_experts_gpu2</title>
<path fill="none" stroke="black" d="M14023.7,-1160.6C14023.7,-1160.6 14023.7,-1133.81 14023.7,-1133.81"/>
<polygon fill="black" stroke="black" points="14027.2,-1133.81 14023.7,-1123.81 14020.2,-1133.81 14027.2,-1133.81"/>
</g>
<!-- layer4_agg_gpu2 -->
<g id="node141" class="node">
<title>layer4_agg_gpu2</title>
<ellipse fill="lightpink" stroke="black" cx="14018.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="14018.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 2</text>
<text text-anchor="middle" x="14018.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="14018.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="14018.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer4_experts_gpu2&#45;&gt;layer4_agg_gpu2 -->
<g id="edge156" class="edge">
<title>layer4_experts_gpu2&#45;&gt;layer4_agg_gpu2</title>
<path fill="none" stroke="black" d="M14023.7,-1049.52C14023.7,-1049.52 14023.7,-1022.85 14023.7,-1022.85"/>
<polygon fill="black" stroke="black" points="14027.2,-1022.85 14023.7,-1012.85 14020.2,-1022.85 14027.2,-1022.85"/>
</g>
<!-- layer4_agg_gpu2&#45;&gt;layer4_moe_agg -->
<g id="edge157" class="edge">
<title>layer4_agg_gpu2&#45;&gt;layer4_moe_agg</title>
<path fill="none" stroke="black" d="M14185.3,-955.62C14185.3,-915.95 14185.3,-832 14185.3,-832 14185.3,-832 14380.19,-832 14380.19,-832"/>
<polygon fill="black" stroke="black" points="14380.19,-835.5 14390.19,-832 14380.19,-828.5 14380.19,-835.5"/>
</g>
<!-- layer4_experts_gpu3 -->
<g id="node143" class="node">
<title>layer4_experts_gpu3</title>
<polygon fill="lightcoral" stroke="black" points="14539.2,-1123.71 14330.2,-1123.71 14330.2,-1049.71 14539.2,-1049.71 14539.2,-1123.71"/>
<text text-anchor="middle" x="14434.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 3</text>
<text text-anchor="middle" x="14434.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="14434.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="14434.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="14434.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="14434.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer4_route_gpu3&#45;&gt;layer4_experts_gpu3 -->
<g id="edge159" class="edge">
<title>layer4_route_gpu3&#45;&gt;layer4_experts_gpu3</title>
<path fill="none" stroke="black" d="M14434.7,-1160.6C14434.7,-1160.6 14434.7,-1133.81 14434.7,-1133.81"/>
<polygon fill="black" stroke="black" points="14438.2,-1133.81 14434.7,-1123.81 14431.2,-1133.81 14438.2,-1133.81"/>
</g>
<!-- layer4_agg_gpu3 -->
<g id="node144" class="node">
<title>layer4_agg_gpu3</title>
<ellipse fill="lightpink" stroke="black" cx="14433.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="14433.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 3</text>
<text text-anchor="middle" x="14433.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="14433.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="14433.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer4_experts_gpu3&#45;&gt;layer4_agg_gpu3 -->
<g id="edge160" class="edge">
<title>layer4_experts_gpu3&#45;&gt;layer4_agg_gpu3</title>
<path fill="none" stroke="black" d="M14434.7,-1049.52C14434.7,-1049.52 14434.7,-1022.85 14434.7,-1022.85"/>
<polygon fill="black" stroke="black" points="14438.2,-1022.85 14434.7,-1012.85 14431.2,-1022.85 14438.2,-1022.85"/>
</g>
<!-- layer4_agg_gpu3&#45;&gt;layer4_moe_agg -->
<g id="edge161" class="edge">
<title>layer4_agg_gpu3&#45;&gt;layer4_moe_agg</title>
<path fill="none" stroke="black" d="M14510.02,-941.78C14510.02,-941.78 14510.02,-890.2 14510.02,-890.2"/>
<polygon fill="black" stroke="black" points="14513.52,-890.2 14510.02,-880.2 14506.52,-890.2 14513.52,-890.2"/>
</g>
<!-- layer4_experts_gpu4 -->
<g id="node146" class="node">
<title>layer4_experts_gpu4</title>
<polygon fill="lightcoral" stroke="black" points="14951.2,-1123.71 14742.2,-1123.71 14742.2,-1049.71 14951.2,-1049.71 14951.2,-1123.71"/>
<text text-anchor="middle" x="14846.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 4</text>
<text text-anchor="middle" x="14846.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="14846.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="14846.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="14846.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="14846.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer4_route_gpu4&#45;&gt;layer4_experts_gpu4 -->
<g id="edge163" class="edge">
<title>layer4_route_gpu4&#45;&gt;layer4_experts_gpu4</title>
<path fill="none" stroke="black" d="M14846.7,-1160.6C14846.7,-1160.6 14846.7,-1133.81 14846.7,-1133.81"/>
<polygon fill="black" stroke="black" points="14850.2,-1133.81 14846.7,-1123.81 14843.2,-1133.81 14850.2,-1133.81"/>
</g>
<!-- layer4_agg_gpu4 -->
<g id="node147" class="node">
<title>layer4_agg_gpu4</title>
<ellipse fill="lightpink" stroke="black" cx="14848.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="14848.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 4</text>
<text text-anchor="middle" x="14848.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="14848.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="14848.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer4_experts_gpu4&#45;&gt;layer4_agg_gpu4 -->
<g id="edge164" class="edge">
<title>layer4_experts_gpu4&#45;&gt;layer4_agg_gpu4</title>
<path fill="none" stroke="black" d="M14846.7,-1049.52C14846.7,-1049.52 14846.7,-1022.85 14846.7,-1022.85"/>
<polygon fill="black" stroke="black" points="14850.2,-1022.85 14846.7,-1012.85 14843.2,-1022.85 14850.2,-1022.85"/>
</g>
<!-- layer4_agg_gpu4&#45;&gt;layer4_moe_agg -->
<g id="edge165" class="edge">
<title>layer4_agg_gpu4&#45;&gt;layer4_moe_agg</title>
<path fill="none" stroke="black" d="M14723.88,-947.27C14723.88,-947.27 14723.88,-883.62 14723.88,-883.62"/>
<polygon fill="black" stroke="black" points="14727.38,-883.62 14723.88,-873.62 14720.38,-883.62 14727.38,-883.62"/>
</g>
<!-- layer4_experts_gpu5 -->
<g id="node149" class="node">
<title>layer4_experts_gpu5</title>
<polygon fill="lightcoral" stroke="black" points="15364.2,-1123.71 15155.2,-1123.71 15155.2,-1049.71 15364.2,-1049.71 15364.2,-1123.71"/>
<text text-anchor="middle" x="15259.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 5</text>
<text text-anchor="middle" x="15259.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="15259.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="15259.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="15259.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="15259.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer4_route_gpu5&#45;&gt;layer4_experts_gpu5 -->
<g id="edge167" class="edge">
<title>layer4_route_gpu5&#45;&gt;layer4_experts_gpu5</title>
<path fill="none" stroke="black" d="M15259.7,-1160.6C15259.7,-1160.6 15259.7,-1133.81 15259.7,-1133.81"/>
<polygon fill="black" stroke="black" points="15263.2,-1133.81 15259.7,-1123.81 15256.2,-1133.81 15263.2,-1133.81"/>
</g>
<!-- layer4_agg_gpu5 -->
<g id="node150" class="node">
<title>layer4_agg_gpu5</title>
<ellipse fill="lightpink" stroke="black" cx="15263.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="15263.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 5</text>
<text text-anchor="middle" x="15263.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="15263.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="15263.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer4_experts_gpu5&#45;&gt;layer4_agg_gpu5 -->
<g id="edge168" class="edge">
<title>layer4_experts_gpu5&#45;&gt;layer4_agg_gpu5</title>
<path fill="none" stroke="black" d="M15259.7,-1049.52C15259.7,-1049.52 15259.7,-1022.85 15259.7,-1022.85"/>
<polygon fill="black" stroke="black" points="15263.2,-1022.85 15259.7,-1012.85 15256.2,-1022.85 15263.2,-1022.85"/>
</g>
<!-- layer4_agg_gpu5&#45;&gt;layer4_moe_agg -->
<g id="edge169" class="edge">
<title>layer4_agg_gpu5&#45;&gt;layer4_moe_agg</title>
<path fill="none" stroke="black" d="M15263.7,-938.89C15263.7,-908.34 15263.7,-870 15263.7,-870 15263.7,-870 14750.78,-870 14750.78,-870"/>
<polygon fill="black" stroke="black" points="14750.78,-866.5 14740.78,-870 14750.78,-873.5 14750.78,-866.5"/>
</g>
<!-- layer4_experts_gpu6 -->
<g id="node152" class="node">
<title>layer4_experts_gpu6</title>
<polygon fill="lightcoral" stroke="black" points="15778.2,-1123.71 15569.2,-1123.71 15569.2,-1049.71 15778.2,-1049.71 15778.2,-1123.71"/>
<text text-anchor="middle" x="15673.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 6</text>
<text text-anchor="middle" x="15673.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="15673.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="15673.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="15673.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="15673.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer4_route_gpu6&#45;&gt;layer4_experts_gpu6 -->
<g id="edge171" class="edge">
<title>layer4_route_gpu6&#45;&gt;layer4_experts_gpu6</title>
<path fill="none" stroke="black" d="M15673.7,-1160.6C15673.7,-1160.6 15673.7,-1133.81 15673.7,-1133.81"/>
<polygon fill="black" stroke="black" points="15677.2,-1133.81 15673.7,-1123.81 15670.2,-1133.81 15677.2,-1133.81"/>
</g>
<!-- layer4_agg_gpu6 -->
<g id="node153" class="node">
<title>layer4_agg_gpu6</title>
<ellipse fill="lightpink" stroke="black" cx="15678.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="15678.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 6</text>
<text text-anchor="middle" x="15678.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="15678.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="15678.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer4_experts_gpu6&#45;&gt;layer4_agg_gpu6 -->
<g id="edge172" class="edge">
<title>layer4_experts_gpu6&#45;&gt;layer4_agg_gpu6</title>
<path fill="none" stroke="black" d="M15673.7,-1049.52C15673.7,-1049.52 15673.7,-1022.85 15673.7,-1022.85"/>
<polygon fill="black" stroke="black" points="15677.2,-1022.85 15673.7,-1012.85 15670.2,-1022.85 15677.2,-1022.85"/>
</g>
<!-- layer4_agg_gpu6&#45;&gt;layer4_moe_agg -->
<g id="edge173" class="edge">
<title>layer4_agg_gpu6&#45;&gt;layer4_moe_agg</title>
<path fill="none" stroke="black" d="M15678.7,-938.95C15678.7,-904.36 15678.7,-858 15678.7,-858 15678.7,-858 14788.77,-858 14788.77,-858"/>
<polygon fill="black" stroke="black" points="14788.77,-854.5 14778.77,-858 14788.77,-861.5 14788.77,-854.5"/>
</g>
<!-- layer4_experts_gpu7 -->
<g id="node155" class="node">
<title>layer4_experts_gpu7</title>
<polygon fill="lightcoral" stroke="black" points="16196.2,-1123.71 15987.2,-1123.71 15987.2,-1049.71 16196.2,-1049.71 16196.2,-1123.71"/>
<text text-anchor="middle" x="16091.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 7</text>
<text text-anchor="middle" x="16091.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="16091.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="16091.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="16091.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="16091.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer4_route_gpu7&#45;&gt;layer4_experts_gpu7 -->
<g id="edge175" class="edge">
<title>layer4_route_gpu7&#45;&gt;layer4_experts_gpu7</title>
<path fill="none" stroke="black" d="M16091.7,-1160.6C16091.7,-1160.6 16091.7,-1133.81 16091.7,-1133.81"/>
<polygon fill="black" stroke="black" points="16095.2,-1133.81 16091.7,-1123.81 16088.2,-1133.81 16095.2,-1133.81"/>
</g>
<!-- layer4_agg_gpu7 -->
<g id="node156" class="node">
<title>layer4_agg_gpu7</title>
<ellipse fill="lightpink" stroke="black" cx="16093.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="16093.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 7</text>
<text text-anchor="middle" x="16093.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="16093.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="16093.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer4_experts_gpu7&#45;&gt;layer4_agg_gpu7 -->
<g id="edge176" class="edge">
<title>layer4_experts_gpu7&#45;&gt;layer4_agg_gpu7</title>
<path fill="none" stroke="black" d="M16091.7,-1049.52C16091.7,-1049.52 16091.7,-1022.85 16091.7,-1022.85"/>
<polygon fill="black" stroke="black" points="16095.2,-1022.85 16091.7,-1012.85 16088.2,-1022.85 16095.2,-1022.85"/>
</g>
<!-- layer4_agg_gpu7&#45;&gt;layer4_moe_agg -->
<g id="edge177" class="edge">
<title>layer4_agg_gpu7&#45;&gt;layer4_moe_agg</title>
<path fill="none" stroke="black" d="M16093.7,-939.12C16093.7,-900.39 16093.7,-845 16093.7,-845 16093.7,-845 14806.3,-845 14806.3,-845"/>
<polygon fill="black" stroke="black" points="14806.3,-841.5 14796.3,-845 14806.3,-848.5 14806.3,-841.5"/>
</g>
<!-- layer5_ln1 -->
<g id="node158" class="node">
<title>layer5_ln1</title>
<polygon fill="none" stroke="black" points="16344.2,-1365.75 16063.2,-1365.75 16063.2,-1302.75 16344.2,-1302.75 16344.2,-1365.75"/>
<text text-anchor="middle" x="16203.7" y="-1353.75" font-family="Arial" font-size="10.00">LayerNorm MHA 5</text>
<text text-anchor="middle" x="16203.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="16203.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="16203.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="16203.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer5_add1 -->
<g id="node159" class="node">
<title>layer5_add1</title>
<polygon fill="yellow" stroke="black" points="17754.2,-728.4 17473.2,-728.4 17473.2,-676.4 17754.2,-676.4 17754.2,-728.4"/>
<text text-anchor="middle" x="17613.7" y="-716.4" font-family="Arial" font-size="10.00">MHA Residual Add 5</text>
<text text-anchor="middle" x="17613.7" y="-705.4" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="17613.7" y="-694.4" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="17613.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer5_moe_output -->
<g id="node163" class="node">
<title>layer5_moe_output</title>
<polygon fill="yellow" stroke="black" points="17835.2,-617.63 17554.2,-617.63 17554.2,-565.63 17835.2,-565.63 17835.2,-617.63"/>
<text text-anchor="middle" x="17694.7" y="-605.63" font-family="Arial" font-size="10.00">MoE Residual Add 5</text>
<text text-anchor="middle" x="17694.7" y="-594.63" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="17694.7" y="-583.63" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="17694.7" y="-572.63" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer5_add1&#45;&gt;layer5_moe_output -->
<g id="edge215" class="edge">
<title>layer5_add1&#45;&gt;layer5_moe_output</title>
<path fill="none" stroke="black" d="M17654.2,-676.15C17654.2,-676.15 17654.2,-627.7 17654.2,-627.7"/>
<polygon fill="black" stroke="black" points="17657.7,-627.7 17654.2,-617.7 17650.7,-627.7 17657.7,-627.7"/>
</g>
<!-- layer5_gate -->
<g id="node160" class="node">
<title>layer5_gate</title>
<polygon fill="lightgreen" stroke="black" points="18152.13,-1397.25 17693.3,-1397.25 17575.26,-1271.25 18034.1,-1271.25 18152.13,-1397.25"/>
<text text-anchor="middle" x="17863.7" y="-1353.75" font-family="Arial" font-size="10.00">Gate Layer 5</text>
<text text-anchor="middle" x="17863.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="17863.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="17863.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="17863.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, num_experts=16]</text>
</g>
<!-- layer5_route_gpu0 -->
<g id="node164" class="node">
<title>layer5_route_gpu0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="16523.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="16523.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 0</text>
<text text-anchor="middle" x="16523.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="16523.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="16523.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer5_gate&#45;&gt;layer5_route_gpu0 -->
<g id="edge181" class="edge">
<title>layer5_gate&#45;&gt;layer5_route_gpu0</title>
<path fill="none" stroke="black" d="M17595.57,-1293C17206.35,-1293 16530.82,-1293 16530.82,-1293 16530.82,-1293 16530.82,-1244.41 16530.82,-1244.41"/>
<polygon fill="black" stroke="black" points="16534.32,-1244.41 16530.82,-1234.41 16527.32,-1244.41 16534.32,-1244.41"/>
</g>
<!-- layer5_route_gpu1 -->
<g id="node167" class="node">
<title>layer5_route_gpu1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="16938.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="16938.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 1</text>
<text text-anchor="middle" x="16938.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="16938.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="16938.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer5_gate&#45;&gt;layer5_route_gpu1 -->
<g id="edge185" class="edge">
<title>layer5_gate&#45;&gt;layer5_route_gpu1</title>
<path fill="none" stroke="black" d="M17587.11,-1284C17314.57,-1284 16938.7,-1284 16938.7,-1284 16938.7,-1284 16938.7,-1244.42 16938.7,-1244.42"/>
<polygon fill="black" stroke="black" points="16942.2,-1244.42 16938.7,-1234.42 16935.2,-1244.42 16942.2,-1244.42"/>
</g>
<!-- layer5_route_gpu2 -->
<g id="node170" class="node">
<title>layer5_route_gpu2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="17344.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="17344.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 2</text>
<text text-anchor="middle" x="17344.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="17344.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="17344.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer5_gate&#45;&gt;layer5_route_gpu2 -->
<g id="edge189" class="edge">
<title>layer5_gate&#45;&gt;layer5_route_gpu2</title>
<path fill="none" stroke="black" d="M17578.76,-1275C17458.02,-1275 17344.7,-1275 17344.7,-1275 17344.7,-1275 17344.7,-1244.42 17344.7,-1244.42"/>
<polygon fill="black" stroke="black" points="17348.2,-1244.42 17344.7,-1234.42 17341.2,-1244.42 17348.2,-1244.42"/>
</g>
<!-- layer5_route_gpu3 -->
<g id="node173" class="node">
<title>layer5_route_gpu3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="17754.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="17754.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 3</text>
<text text-anchor="middle" x="17754.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="17754.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="17754.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer5_gate&#45;&gt;layer5_route_gpu3 -->
<g id="edge193" class="edge">
<title>layer5_gate&#45;&gt;layer5_route_gpu3</title>
<path fill="none" stroke="black" d="M17761.96,-1271.07C17761.96,-1271.07 17761.96,-1244.29 17761.96,-1244.29"/>
<polygon fill="black" stroke="black" points="17765.46,-1244.29 17761.96,-1234.29 17758.46,-1244.29 17765.46,-1244.29"/>
</g>
<!-- layer5_route_gpu4 -->
<g id="node176" class="node">
<title>layer5_route_gpu4</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="18161.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="18161.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 4</text>
<text text-anchor="middle" x="18161.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="18161.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="18161.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer5_gate&#45;&gt;layer5_route_gpu4 -->
<g id="edge197" class="edge">
<title>layer5_gate&#45;&gt;layer5_route_gpu4</title>
<path fill="none" stroke="black" d="M18059.93,-1298.67C18059.93,-1298.67 18059.93,-1239.15 18059.93,-1239.15"/>
<polygon fill="black" stroke="black" points="18063.43,-1239.15 18059.93,-1229.15 18056.43,-1239.15 18063.43,-1239.15"/>
</g>
<!-- layer5_route_gpu5 -->
<g id="node179" class="node">
<title>layer5_route_gpu5</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="18575.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="18575.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 5</text>
<text text-anchor="middle" x="18575.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="18575.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="18575.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer5_gate&#45;&gt;layer5_route_gpu5 -->
<g id="edge201" class="edge">
<title>layer5_gate&#45;&gt;layer5_route_gpu5</title>
<path fill="none" stroke="black" d="M18042.45,-1280C18253.35,-1280 18575.7,-1280 18575.7,-1280 18575.7,-1280 18575.7,-1244.4 18575.7,-1244.4"/>
<polygon fill="black" stroke="black" points="18579.2,-1244.4 18575.7,-1234.4 18572.2,-1244.4 18579.2,-1244.4"/>
</g>
<!-- layer5_route_gpu6 -->
<g id="node182" class="node">
<title>layer5_route_gpu6</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="18989.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="18989.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 6</text>
<text text-anchor="middle" x="18989.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="18989.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="18989.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer5_gate&#45;&gt;layer5_route_gpu6 -->
<g id="edge205" class="edge">
<title>layer5_gate&#45;&gt;layer5_route_gpu6</title>
<path fill="none" stroke="black" d="M18050.9,-1289C18371.08,-1289 18989.7,-1289 18989.7,-1289 18989.7,-1289 18989.7,-1244.44 18989.7,-1244.44"/>
<polygon fill="black" stroke="black" points="18993.2,-1244.44 18989.7,-1234.44 18986.2,-1244.44 18993.2,-1244.44"/>
</g>
<!-- layer5_route_gpu7 -->
<g id="node185" class="node">
<title>layer5_route_gpu7</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="19404.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="19404.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 7</text>
<text text-anchor="middle" x="19404.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="19404.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="19404.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer5_gate&#45;&gt;layer5_route_gpu7 -->
<g id="edge209" class="edge">
<title>layer5_gate&#45;&gt;layer5_route_gpu7</title>
<path fill="none" stroke="black" d="M18059.32,-1298C18451.69,-1298 19297.57,-1298 19297.57,-1298 19297.57,-1298 19297.57,-1238.19 19297.57,-1238.19"/>
<polygon fill="black" stroke="black" points="19301.07,-1238.19 19297.57,-1228.19 19294.07,-1238.19 19301.07,-1238.19"/>
</g>
<!-- layer5_moe_agg -->
<g id="node161" class="node">
<title>layer5_moe_agg</title>
<ellipse fill="gold" stroke="black" cx="17912.7" cy="-839.17" rx="205.12" ry="44.6"/>
<text text-anchor="middle" x="17912.7" y="-858.67" font-family="Arial" font-size="10.00">MoE Final Aggregation 5</text>
<text text-anchor="middle" x="17912.7" y="-847.67" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="17912.7" y="-836.67" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="17912.7" y="-825.67" font-family="Arial" font-size="10.00">Input: 16Ã—[batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="17912.7" y="-814.67" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer5_ln2 -->
<g id="node162" class="node">
<title>layer5_ln2</title>
<polygon fill="none" stroke="black" points="18053.2,-733.9 17772.2,-733.9 17772.2,-670.9 18053.2,-670.9 18053.2,-733.9"/>
<text text-anchor="middle" x="17912.7" y="-721.9" font-family="Arial" font-size="10.00">LayerNorm MoE 5</text>
<text text-anchor="middle" x="17912.7" y="-710.9" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="17912.7" y="-699.9" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="17912.7" y="-688.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="17912.7" y="-677.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer5_moe_agg&#45;&gt;layer5_ln2 -->
<g id="edge213" class="edge">
<title>layer5_moe_agg&#45;&gt;layer5_ln2</title>
<path fill="none" stroke="black" d="M17912.7,-794.39C17912.7,-794.39 17912.7,-744.29 17912.7,-744.29"/>
<polygon fill="black" stroke="black" points="17916.2,-744.29 17912.7,-734.29 17909.2,-744.29 17916.2,-744.29"/>
</g>
<!-- layer5_ln2&#45;&gt;layer5_moe_output -->
<g id="edge214" class="edge">
<title>layer5_ln2&#45;&gt;layer5_moe_output</title>
<path fill="none" stroke="black" d="M17803.7,-670.66C17803.7,-670.66 17803.7,-627.78 17803.7,-627.78"/>
<polygon fill="black" stroke="black" points="17807.2,-627.78 17803.7,-617.78 17800.2,-627.78 17807.2,-627.78"/>
</g>
<!-- layer6_mha -->
<g id="node188" class="node">
<title>layer6_mha</title>
<polygon fill="lightcyan" stroke="black" points="17835.2,-483.37 17554.2,-483.37 17554.2,-420.37 17835.2,-420.37 17835.2,-483.37"/>
<text text-anchor="middle" x="17694.7" y="-471.37" font-family="Arial" font-size="10.00">MHA Layer 6</text>
<text text-anchor="middle" x="17694.7" y="-460.37" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="17694.7" y="-449.37" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="17694.7" y="-438.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="17694.7" y="-427.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer5_moe_output&#45;&gt;layer6_mha -->
<g id="edge571" class="edge">
<title>layer5_moe_output&#45;&gt;layer6_mha</title>
<path fill="none" stroke="black" d="M17694.7,-565.34C17694.7,-565.34 17694.7,-493.42 17694.7,-493.42"/>
<polygon fill="black" stroke="black" points="17698.2,-493.42 17694.7,-483.42 17691.2,-493.42 17698.2,-493.42"/>
</g>
<!-- layer5_experts_gpu0 -->
<g id="node165" class="node">
<title>layer5_experts_gpu0</title>
<polygon fill="lightcoral" stroke="black" points="16620.2,-1123.71 16411.2,-1123.71 16411.2,-1049.71 16620.2,-1049.71 16620.2,-1123.71"/>
<text text-anchor="middle" x="16515.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 0</text>
<text text-anchor="middle" x="16515.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="16515.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="16515.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="16515.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="16515.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer5_route_gpu0&#45;&gt;layer5_experts_gpu0 -->
<g id="edge182" class="edge">
<title>layer5_route_gpu0&#45;&gt;layer5_experts_gpu0</title>
<path fill="none" stroke="black" d="M16515.7,-1160.6C16515.7,-1160.6 16515.7,-1133.81 16515.7,-1133.81"/>
<polygon fill="black" stroke="black" points="16519.2,-1133.81 16515.7,-1123.81 16512.2,-1133.81 16519.2,-1133.81"/>
</g>
<!-- layer5_agg_gpu0 -->
<g id="node166" class="node">
<title>layer5_agg_gpu0</title>
<ellipse fill="lightpink" stroke="black" cx="16508.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="16508.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 0</text>
<text text-anchor="middle" x="16508.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="16508.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="16508.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer5_experts_gpu0&#45;&gt;layer5_agg_gpu0 -->
<g id="edge183" class="edge">
<title>layer5_experts_gpu0&#45;&gt;layer5_agg_gpu0</title>
<path fill="none" stroke="black" d="M16515.7,-1049.52C16515.7,-1049.52 16515.7,-1022.85 16515.7,-1022.85"/>
<polygon fill="black" stroke="black" points="16519.2,-1022.85 16515.7,-1012.85 16512.2,-1022.85 16519.2,-1022.85"/>
</g>
<!-- layer5_agg_gpu0&#45;&gt;layer5_moe_agg -->
<g id="edge184" class="edge">
<title>layer5_agg_gpu0&#45;&gt;layer5_moe_agg</title>
<path fill="none" stroke="black" d="M16508.7,-938.87C16508.7,-889.14 16508.7,-807 16508.7,-807 16508.7,-807 17760.67,-807 17760.67,-807"/>
<polygon fill="black" stroke="black" points="17760.67,-810.5 17770.67,-807 17760.67,-803.5 17760.67,-810.5"/>
</g>
<!-- layer5_experts_gpu1 -->
<g id="node168" class="node">
<title>layer5_experts_gpu1</title>
<polygon fill="lightcoral" stroke="black" points="17037.2,-1123.71 16828.2,-1123.71 16828.2,-1049.71 17037.2,-1049.71 17037.2,-1123.71"/>
<text text-anchor="middle" x="16932.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 1</text>
<text text-anchor="middle" x="16932.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="16932.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="16932.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="16932.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="16932.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer5_route_gpu1&#45;&gt;layer5_experts_gpu1 -->
<g id="edge186" class="edge">
<title>layer5_route_gpu1&#45;&gt;layer5_experts_gpu1</title>
<path fill="none" stroke="black" d="M16932.7,-1160.6C16932.7,-1160.6 16932.7,-1133.81 16932.7,-1133.81"/>
<polygon fill="black" stroke="black" points="16936.2,-1133.81 16932.7,-1123.81 16929.2,-1133.81 16936.2,-1133.81"/>
</g>
<!-- layer5_agg_gpu1 -->
<g id="node169" class="node">
<title>layer5_agg_gpu1</title>
<ellipse fill="lightpink" stroke="black" cx="16923.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="16923.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 1</text>
<text text-anchor="middle" x="16923.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="16923.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="16923.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer5_experts_gpu1&#45;&gt;layer5_agg_gpu1 -->
<g id="edge187" class="edge">
<title>layer5_experts_gpu1&#45;&gt;layer5_agg_gpu1</title>
<path fill="none" stroke="black" d="M16932.7,-1049.52C16932.7,-1049.52 16932.7,-1022.85 16932.7,-1022.85"/>
<polygon fill="black" stroke="black" points="16936.2,-1022.85 16932.7,-1012.85 16929.2,-1022.85 16936.2,-1022.85"/>
</g>
<!-- layer5_agg_gpu1&#45;&gt;layer5_moe_agg -->
<g id="edge188" class="edge">
<title>layer5_agg_gpu1&#45;&gt;layer5_moe_agg</title>
<path fill="none" stroke="black" d="M16923.7,-938.99C16923.7,-892.87 16923.7,-820 16923.7,-820 16923.7,-820 17717.54,-820 17717.54,-820"/>
<polygon fill="black" stroke="black" points="17717.54,-823.5 17727.54,-820 17717.54,-816.5 17717.54,-823.5"/>
</g>
<!-- layer5_experts_gpu2 -->
<g id="node171" class="node">
<title>layer5_experts_gpu2</title>
<polygon fill="lightcoral" stroke="black" points="17446.2,-1123.71 17237.2,-1123.71 17237.2,-1049.71 17446.2,-1049.71 17446.2,-1123.71"/>
<text text-anchor="middle" x="17341.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 2</text>
<text text-anchor="middle" x="17341.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="17341.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="17341.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="17341.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="17341.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer5_route_gpu2&#45;&gt;layer5_experts_gpu2 -->
<g id="edge190" class="edge">
<title>layer5_route_gpu2&#45;&gt;layer5_experts_gpu2</title>
<path fill="none" stroke="black" d="M17341.7,-1160.6C17341.7,-1160.6 17341.7,-1133.81 17341.7,-1133.81"/>
<polygon fill="black" stroke="black" points="17345.2,-1133.81 17341.7,-1123.81 17338.2,-1133.81 17345.2,-1133.81"/>
</g>
<!-- layer5_agg_gpu2 -->
<g id="node172" class="node">
<title>layer5_agg_gpu2</title>
<ellipse fill="lightpink" stroke="black" cx="17338.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="17338.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 2</text>
<text text-anchor="middle" x="17338.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="17338.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="17338.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer5_experts_gpu2&#45;&gt;layer5_agg_gpu2 -->
<g id="edge191" class="edge">
<title>layer5_experts_gpu2&#45;&gt;layer5_agg_gpu2</title>
<path fill="none" stroke="black" d="M17341.7,-1049.52C17341.7,-1049.52 17341.7,-1022.85 17341.7,-1022.85"/>
<polygon fill="black" stroke="black" points="17345.2,-1022.85 17341.7,-1012.85 17338.2,-1022.85 17345.2,-1022.85"/>
</g>
<!-- layer5_agg_gpu2&#45;&gt;layer5_moe_agg -->
<g id="edge192" class="edge">
<title>layer5_agg_gpu2&#45;&gt;layer5_moe_agg</title>
<path fill="none" stroke="black" d="M17505.3,-955.62C17505.3,-915.95 17505.3,-832 17505.3,-832 17505.3,-832 17700.19,-832 17700.19,-832"/>
<polygon fill="black" stroke="black" points="17700.19,-835.5 17710.19,-832 17700.19,-828.5 17700.19,-835.5"/>
</g>
<!-- layer5_experts_gpu3 -->
<g id="node174" class="node">
<title>layer5_experts_gpu3</title>
<polygon fill="lightcoral" stroke="black" points="17859.2,-1123.71 17650.2,-1123.71 17650.2,-1049.71 17859.2,-1049.71 17859.2,-1123.71"/>
<text text-anchor="middle" x="17754.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 3</text>
<text text-anchor="middle" x="17754.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="17754.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="17754.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="17754.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="17754.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer5_route_gpu3&#45;&gt;layer5_experts_gpu3 -->
<g id="edge194" class="edge">
<title>layer5_route_gpu3&#45;&gt;layer5_experts_gpu3</title>
<path fill="none" stroke="black" d="M17754.7,-1160.6C17754.7,-1160.6 17754.7,-1133.81 17754.7,-1133.81"/>
<polygon fill="black" stroke="black" points="17758.2,-1133.81 17754.7,-1123.81 17751.2,-1133.81 17758.2,-1133.81"/>
</g>
<!-- layer5_agg_gpu3 -->
<g id="node175" class="node">
<title>layer5_agg_gpu3</title>
<ellipse fill="lightpink" stroke="black" cx="17753.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="17753.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 3</text>
<text text-anchor="middle" x="17753.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="17753.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="17753.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer5_experts_gpu3&#45;&gt;layer5_agg_gpu3 -->
<g id="edge195" class="edge">
<title>layer5_experts_gpu3&#45;&gt;layer5_agg_gpu3</title>
<path fill="none" stroke="black" d="M17754.7,-1049.52C17754.7,-1049.52 17754.7,-1022.85 17754.7,-1022.85"/>
<polygon fill="black" stroke="black" points="17758.2,-1022.85 17754.7,-1012.85 17751.2,-1022.85 17758.2,-1022.85"/>
</g>
<!-- layer5_agg_gpu3&#45;&gt;layer5_moe_agg -->
<g id="edge196" class="edge">
<title>layer5_agg_gpu3&#45;&gt;layer5_moe_agg</title>
<path fill="none" stroke="black" d="M17830.02,-941.78C17830.02,-941.78 17830.02,-890.2 17830.02,-890.2"/>
<polygon fill="black" stroke="black" points="17833.52,-890.2 17830.02,-880.2 17826.52,-890.2 17833.52,-890.2"/>
</g>
<!-- layer5_experts_gpu4 -->
<g id="node177" class="node">
<title>layer5_experts_gpu4</title>
<polygon fill="lightcoral" stroke="black" points="18267.2,-1123.71 18058.2,-1123.71 18058.2,-1049.71 18267.2,-1049.71 18267.2,-1123.71"/>
<text text-anchor="middle" x="18162.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 4</text>
<text text-anchor="middle" x="18162.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="18162.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="18162.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="18162.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="18162.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer5_route_gpu4&#45;&gt;layer5_experts_gpu4 -->
<g id="edge198" class="edge">
<title>layer5_route_gpu4&#45;&gt;layer5_experts_gpu4</title>
<path fill="none" stroke="black" d="M18162.7,-1160.6C18162.7,-1160.6 18162.7,-1133.81 18162.7,-1133.81"/>
<polygon fill="black" stroke="black" points="18166.2,-1133.81 18162.7,-1123.81 18159.2,-1133.81 18166.2,-1133.81"/>
</g>
<!-- layer5_agg_gpu4 -->
<g id="node178" class="node">
<title>layer5_agg_gpu4</title>
<ellipse fill="lightpink" stroke="black" cx="18168.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="18168.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 4</text>
<text text-anchor="middle" x="18168.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="18168.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="18168.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer5_experts_gpu4&#45;&gt;layer5_agg_gpu4 -->
<g id="edge199" class="edge">
<title>layer5_experts_gpu4&#45;&gt;layer5_agg_gpu4</title>
<path fill="none" stroke="black" d="M18162.7,-1049.52C18162.7,-1049.52 18162.7,-1022.85 18162.7,-1022.85"/>
<polygon fill="black" stroke="black" points="18166.2,-1022.85 18162.7,-1012.85 18159.2,-1022.85 18166.2,-1022.85"/>
</g>
<!-- layer5_agg_gpu4&#45;&gt;layer5_moe_agg -->
<g id="edge200" class="edge">
<title>layer5_agg_gpu4&#45;&gt;layer5_moe_agg</title>
<path fill="none" stroke="black" d="M18043.88,-947.27C18043.88,-947.27 18043.88,-883.62 18043.88,-883.62"/>
<polygon fill="black" stroke="black" points="18047.38,-883.62 18043.88,-873.62 18040.38,-883.62 18047.38,-883.62"/>
</g>
<!-- layer5_experts_gpu5 -->
<g id="node180" class="node">
<title>layer5_experts_gpu5</title>
<polygon fill="lightcoral" stroke="black" points="18685.2,-1123.71 18476.2,-1123.71 18476.2,-1049.71 18685.2,-1049.71 18685.2,-1123.71"/>
<text text-anchor="middle" x="18580.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 5</text>
<text text-anchor="middle" x="18580.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="18580.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="18580.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="18580.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="18580.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer5_route_gpu5&#45;&gt;layer5_experts_gpu5 -->
<g id="edge202" class="edge">
<title>layer5_route_gpu5&#45;&gt;layer5_experts_gpu5</title>
<path fill="none" stroke="black" d="M18580.7,-1160.6C18580.7,-1160.6 18580.7,-1133.81 18580.7,-1133.81"/>
<polygon fill="black" stroke="black" points="18584.2,-1133.81 18580.7,-1123.81 18577.2,-1133.81 18584.2,-1133.81"/>
</g>
<!-- layer5_agg_gpu5 -->
<g id="node181" class="node">
<title>layer5_agg_gpu5</title>
<ellipse fill="lightpink" stroke="black" cx="18583.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="18583.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 5</text>
<text text-anchor="middle" x="18583.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="18583.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="18583.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer5_experts_gpu5&#45;&gt;layer5_agg_gpu5 -->
<g id="edge203" class="edge">
<title>layer5_experts_gpu5&#45;&gt;layer5_agg_gpu5</title>
<path fill="none" stroke="black" d="M18580.7,-1049.52C18580.7,-1049.52 18580.7,-1022.85 18580.7,-1022.85"/>
<polygon fill="black" stroke="black" points="18584.2,-1022.85 18580.7,-1012.85 18577.2,-1022.85 18584.2,-1022.85"/>
</g>
<!-- layer5_agg_gpu5&#45;&gt;layer5_moe_agg -->
<g id="edge204" class="edge">
<title>layer5_agg_gpu5&#45;&gt;layer5_moe_agg</title>
<path fill="none" stroke="black" d="M18583.7,-938.89C18583.7,-908.34 18583.7,-870 18583.7,-870 18583.7,-870 18070.78,-870 18070.78,-870"/>
<polygon fill="black" stroke="black" points="18070.78,-866.5 18060.78,-870 18070.78,-873.5 18070.78,-866.5"/>
</g>
<!-- layer5_experts_gpu6 -->
<g id="node183" class="node">
<title>layer5_experts_gpu6</title>
<polygon fill="lightcoral" stroke="black" points="19100.2,-1123.71 18891.2,-1123.71 18891.2,-1049.71 19100.2,-1049.71 19100.2,-1123.71"/>
<text text-anchor="middle" x="18995.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 6</text>
<text text-anchor="middle" x="18995.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="18995.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="18995.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="18995.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="18995.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer5_route_gpu6&#45;&gt;layer5_experts_gpu6 -->
<g id="edge206" class="edge">
<title>layer5_route_gpu6&#45;&gt;layer5_experts_gpu6</title>
<path fill="none" stroke="black" d="M18995.7,-1160.6C18995.7,-1160.6 18995.7,-1133.81 18995.7,-1133.81"/>
<polygon fill="black" stroke="black" points="18999.2,-1133.81 18995.7,-1123.81 18992.2,-1133.81 18999.2,-1133.81"/>
</g>
<!-- layer5_agg_gpu6 -->
<g id="node184" class="node">
<title>layer5_agg_gpu6</title>
<ellipse fill="lightpink" stroke="black" cx="18998.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="18998.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 6</text>
<text text-anchor="middle" x="18998.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="18998.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="18998.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer5_experts_gpu6&#45;&gt;layer5_agg_gpu6 -->
<g id="edge207" class="edge">
<title>layer5_experts_gpu6&#45;&gt;layer5_agg_gpu6</title>
<path fill="none" stroke="black" d="M18995.7,-1049.52C18995.7,-1049.52 18995.7,-1022.85 18995.7,-1022.85"/>
<polygon fill="black" stroke="black" points="18999.2,-1022.85 18995.7,-1012.85 18992.2,-1022.85 18999.2,-1022.85"/>
</g>
<!-- layer5_agg_gpu6&#45;&gt;layer5_moe_agg -->
<g id="edge208" class="edge">
<title>layer5_agg_gpu6&#45;&gt;layer5_moe_agg</title>
<path fill="none" stroke="black" d="M18998.7,-938.95C18998.7,-904.36 18998.7,-858 18998.7,-858 18998.7,-858 18108.77,-858 18108.77,-858"/>
<polygon fill="black" stroke="black" points="18108.77,-854.5 18098.77,-858 18108.77,-861.5 18108.77,-854.5"/>
</g>
<!-- layer5_experts_gpu7 -->
<g id="node186" class="node">
<title>layer5_experts_gpu7</title>
<polygon fill="lightcoral" stroke="black" points="19515.2,-1123.71 19306.2,-1123.71 19306.2,-1049.71 19515.2,-1049.71 19515.2,-1123.71"/>
<text text-anchor="middle" x="19410.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 7</text>
<text text-anchor="middle" x="19410.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="19410.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="19410.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="19410.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="19410.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer5_route_gpu7&#45;&gt;layer5_experts_gpu7 -->
<g id="edge210" class="edge">
<title>layer5_route_gpu7&#45;&gt;layer5_experts_gpu7</title>
<path fill="none" stroke="black" d="M19410.7,-1160.6C19410.7,-1160.6 19410.7,-1133.81 19410.7,-1133.81"/>
<polygon fill="black" stroke="black" points="19414.2,-1133.81 19410.7,-1123.81 19407.2,-1133.81 19414.2,-1133.81"/>
</g>
<!-- layer5_agg_gpu7 -->
<g id="node187" class="node">
<title>layer5_agg_gpu7</title>
<ellipse fill="lightpink" stroke="black" cx="19413.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="19413.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 7</text>
<text text-anchor="middle" x="19413.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="19413.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="19413.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer5_experts_gpu7&#45;&gt;layer5_agg_gpu7 -->
<g id="edge211" class="edge">
<title>layer5_experts_gpu7&#45;&gt;layer5_agg_gpu7</title>
<path fill="none" stroke="black" d="M19410.7,-1049.52C19410.7,-1049.52 19410.7,-1022.85 19410.7,-1022.85"/>
<polygon fill="black" stroke="black" points="19414.2,-1022.85 19410.7,-1012.85 19407.2,-1022.85 19414.2,-1022.85"/>
</g>
<!-- layer5_agg_gpu7&#45;&gt;layer5_moe_agg -->
<g id="edge212" class="edge">
<title>layer5_agg_gpu7&#45;&gt;layer5_moe_agg</title>
<path fill="none" stroke="black" d="M19413.7,-939.12C19413.7,-900.39 19413.7,-845 19413.7,-845 19413.7,-845 18126.3,-845 18126.3,-845"/>
<polygon fill="black" stroke="black" points="18126.3,-841.5 18116.3,-845 18126.3,-848.5 18126.3,-841.5"/>
</g>
<!-- layer6_ln1 -->
<g id="node189" class="node">
<title>layer6_ln1</title>
<polygon fill="none" stroke="black" points="19665.2,-1365.75 19384.2,-1365.75 19384.2,-1302.75 19665.2,-1302.75 19665.2,-1365.75"/>
<text text-anchor="middle" x="19524.7" y="-1353.75" font-family="Arial" font-size="10.00">LayerNorm MHA 6</text>
<text text-anchor="middle" x="19524.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="19524.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="19524.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="19524.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer6_add1 -->
<g id="node190" class="node">
<title>layer6_add1</title>
<polygon fill="yellow" stroke="black" points="21122.2,-728.4 20841.2,-728.4 20841.2,-676.4 21122.2,-676.4 21122.2,-728.4"/>
<text text-anchor="middle" x="20981.7" y="-716.4" font-family="Arial" font-size="10.00">MHA Residual Add 6</text>
<text text-anchor="middle" x="20981.7" y="-705.4" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="20981.7" y="-694.4" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="20981.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer6_moe_output -->
<g id="node194" class="node">
<title>layer6_moe_output</title>
<polygon fill="yellow" stroke="black" points="21203.2,-617.63 20922.2,-617.63 20922.2,-565.63 21203.2,-565.63 21203.2,-617.63"/>
<text text-anchor="middle" x="21062.7" y="-605.63" font-family="Arial" font-size="10.00">MoE Residual Add 6</text>
<text text-anchor="middle" x="21062.7" y="-594.63" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="21062.7" y="-583.63" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="21062.7" y="-572.63" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer6_add1&#45;&gt;layer6_moe_output -->
<g id="edge250" class="edge">
<title>layer6_add1&#45;&gt;layer6_moe_output</title>
<path fill="none" stroke="black" d="M21022.2,-676.15C21022.2,-676.15 21022.2,-627.7 21022.2,-627.7"/>
<polygon fill="black" stroke="black" points="21025.7,-627.7 21022.2,-617.7 21018.7,-627.7 21025.7,-627.7"/>
</g>
<!-- layer6_gate -->
<g id="node191" class="node">
<title>layer6_gate</title>
<polygon fill="lightgreen" stroke="black" points="21473.13,-1397.25 21014.3,-1397.25 20896.26,-1271.25 21355.1,-1271.25 21473.13,-1397.25"/>
<text text-anchor="middle" x="21184.7" y="-1353.75" font-family="Arial" font-size="10.00">Gate Layer 6</text>
<text text-anchor="middle" x="21184.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="21184.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="21184.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="21184.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, num_experts=16]</text>
</g>
<!-- layer6_route_gpu0 -->
<g id="node195" class="node">
<title>layer6_route_gpu0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="19847.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="19847.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 0</text>
<text text-anchor="middle" x="19847.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="19847.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="19847.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer6_gate&#45;&gt;layer6_route_gpu0 -->
<g id="edge216" class="edge">
<title>layer6_gate&#45;&gt;layer6_route_gpu0</title>
<path fill="none" stroke="black" d="M20916.47,-1293C20527.63,-1293 19853.32,-1293 19853.32,-1293 19853.32,-1293 19853.32,-1244.41 19853.32,-1244.41"/>
<polygon fill="black" stroke="black" points="19856.82,-1244.41 19853.32,-1234.41 19849.82,-1244.41 19856.82,-1244.41"/>
</g>
<!-- layer6_route_gpu1 -->
<g id="node198" class="node">
<title>layer6_route_gpu1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="20257.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="20257.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 1</text>
<text text-anchor="middle" x="20257.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="20257.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="20257.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer6_gate&#45;&gt;layer6_route_gpu1 -->
<g id="edge220" class="edge">
<title>layer6_gate&#45;&gt;layer6_route_gpu1</title>
<path fill="none" stroke="black" d="M20908.14,-1284C20634.96,-1284 20257.7,-1284 20257.7,-1284 20257.7,-1284 20257.7,-1244.42 20257.7,-1244.42"/>
<polygon fill="black" stroke="black" points="20261.2,-1244.42 20257.7,-1234.42 20254.2,-1244.42 20261.2,-1244.42"/>
</g>
<!-- layer6_route_gpu2 -->
<g id="node201" class="node">
<title>layer6_route_gpu2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="20664.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="20664.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 2</text>
<text text-anchor="middle" x="20664.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="20664.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="20664.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer6_gate&#45;&gt;layer6_route_gpu2 -->
<g id="edge224" class="edge">
<title>layer6_gate&#45;&gt;layer6_route_gpu2</title>
<path fill="none" stroke="black" d="M20899.6,-1275C20778.48,-1275 20664.7,-1275 20664.7,-1275 20664.7,-1275 20664.7,-1244.42 20664.7,-1244.42"/>
<polygon fill="black" stroke="black" points="20668.2,-1244.42 20664.7,-1234.42 20661.2,-1244.42 20668.2,-1244.42"/>
</g>
<!-- layer6_route_gpu3 -->
<g id="node204" class="node">
<title>layer6_route_gpu3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="21074.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="21074.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 3</text>
<text text-anchor="middle" x="21074.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="21074.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="21074.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer6_gate&#45;&gt;layer6_route_gpu3 -->
<g id="edge228" class="edge">
<title>layer6_gate&#45;&gt;layer6_route_gpu3</title>
<path fill="none" stroke="black" d="M21082.46,-1271.07C21082.46,-1271.07 21082.46,-1244.29 21082.46,-1244.29"/>
<polygon fill="black" stroke="black" points="21085.96,-1244.29 21082.46,-1234.29 21078.96,-1244.29 21085.96,-1244.29"/>
</g>
<!-- layer6_route_gpu4 -->
<g id="node207" class="node">
<title>layer6_route_gpu4</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="21484.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="21484.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 4</text>
<text text-anchor="middle" x="21484.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="21484.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="21484.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer6_gate&#45;&gt;layer6_route_gpu4 -->
<g id="edge232" class="edge">
<title>layer6_gate&#45;&gt;layer6_route_gpu4</title>
<path fill="none" stroke="black" d="M21381.93,-1299.74C21381.93,-1299.74 21381.93,-1238.71 21381.93,-1238.71"/>
<polygon fill="black" stroke="black" points="21385.43,-1238.71 21381.93,-1228.71 21378.43,-1238.71 21385.43,-1238.71"/>
</g>
<!-- layer6_route_gpu5 -->
<g id="node210" class="node">
<title>layer6_route_gpu5</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="21894.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="21894.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 5</text>
<text text-anchor="middle" x="21894.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="21894.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="21894.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer6_gate&#45;&gt;layer6_route_gpu5 -->
<g id="edge236" class="edge">
<title>layer6_gate&#45;&gt;layer6_route_gpu5</title>
<path fill="none" stroke="black" d="M21363.4,-1280C21573.73,-1280 21894.7,-1280 21894.7,-1280 21894.7,-1280 21894.7,-1244.4 21894.7,-1244.4"/>
<polygon fill="black" stroke="black" points="21898.2,-1244.4 21894.7,-1234.4 21891.2,-1244.4 21898.2,-1244.4"/>
</g>
<!-- layer6_route_gpu6 -->
<g id="node213" class="node">
<title>layer6_route_gpu6</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="22301.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="22301.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 6</text>
<text text-anchor="middle" x="22301.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="22301.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="22301.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer6_gate&#45;&gt;layer6_route_gpu6 -->
<g id="edge240" class="edge">
<title>layer6_gate&#45;&gt;layer6_route_gpu6</title>
<path fill="none" stroke="black" d="M21371.97,-1289C21690.04,-1289 22301.7,-1289 22301.7,-1289 22301.7,-1289 22301.7,-1244.44 22301.7,-1244.44"/>
<polygon fill="black" stroke="black" points="22305.2,-1244.44 22301.7,-1234.44 22298.2,-1244.44 22305.2,-1244.44"/>
</g>
<!-- layer6_route_gpu7 -->
<g id="node216" class="node">
<title>layer6_route_gpu7</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="22720.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="22720.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 7</text>
<text text-anchor="middle" x="22720.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="22720.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="22720.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer6_gate&#45;&gt;layer6_route_gpu7 -->
<g id="edge244" class="edge">
<title>layer6_gate&#45;&gt;layer6_route_gpu7</title>
<path fill="none" stroke="black" d="M21380.4,-1298C21794.3,-1298 22720.7,-1298 22720.7,-1298 22720.7,-1298 22720.7,-1244.34 22720.7,-1244.34"/>
<polygon fill="black" stroke="black" points="22724.2,-1244.34 22720.7,-1234.34 22717.2,-1244.34 22724.2,-1244.34"/>
</g>
<!-- layer6_moe_agg -->
<g id="node192" class="node">
<title>layer6_moe_agg</title>
<ellipse fill="gold" stroke="black" cx="21280.7" cy="-839.17" rx="205.12" ry="44.6"/>
<text text-anchor="middle" x="21280.7" y="-858.67" font-family="Arial" font-size="10.00">MoE Final Aggregation 6</text>
<text text-anchor="middle" x="21280.7" y="-847.67" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="21280.7" y="-836.67" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="21280.7" y="-825.67" font-family="Arial" font-size="10.00">Input: 16Ã—[batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="21280.7" y="-814.67" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer6_ln2 -->
<g id="node193" class="node">
<title>layer6_ln2</title>
<polygon fill="none" stroke="black" points="21421.2,-733.9 21140.2,-733.9 21140.2,-670.9 21421.2,-670.9 21421.2,-733.9"/>
<text text-anchor="middle" x="21280.7" y="-721.9" font-family="Arial" font-size="10.00">LayerNorm MoE 6</text>
<text text-anchor="middle" x="21280.7" y="-710.9" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="21280.7" y="-699.9" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="21280.7" y="-688.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="21280.7" y="-677.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer6_moe_agg&#45;&gt;layer6_ln2 -->
<g id="edge248" class="edge">
<title>layer6_moe_agg&#45;&gt;layer6_ln2</title>
<path fill="none" stroke="black" d="M21280.7,-794.39C21280.7,-794.39 21280.7,-744.29 21280.7,-744.29"/>
<polygon fill="black" stroke="black" points="21284.2,-744.29 21280.7,-734.29 21277.2,-744.29 21284.2,-744.29"/>
</g>
<!-- layer6_ln2&#45;&gt;layer6_moe_output -->
<g id="edge249" class="edge">
<title>layer6_ln2&#45;&gt;layer6_moe_output</title>
<path fill="none" stroke="black" d="M21171.7,-670.66C21171.7,-670.66 21171.7,-627.78 21171.7,-627.78"/>
<polygon fill="black" stroke="black" points="21175.2,-627.78 21171.7,-617.78 21168.2,-627.78 21175.2,-627.78"/>
</g>
<!-- layer7_mha -->
<g id="node219" class="node">
<title>layer7_mha</title>
<polygon fill="lightcyan" stroke="black" points="21203.2,-483.37 20922.2,-483.37 20922.2,-420.37 21203.2,-420.37 21203.2,-483.37"/>
<text text-anchor="middle" x="21062.7" y="-471.37" font-family="Arial" font-size="10.00">MHA Layer 7</text>
<text text-anchor="middle" x="21062.7" y="-460.37" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="21062.7" y="-449.37" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="21062.7" y="-438.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="21062.7" y="-427.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer6_moe_output&#45;&gt;layer7_mha -->
<g id="edge572" class="edge">
<title>layer6_moe_output&#45;&gt;layer7_mha</title>
<path fill="none" stroke="black" d="M21062.7,-565.34C21062.7,-565.34 21062.7,-493.42 21062.7,-493.42"/>
<polygon fill="black" stroke="black" points="21066.2,-493.42 21062.7,-483.42 21059.2,-493.42 21066.2,-493.42"/>
</g>
<!-- layer6_experts_gpu0 -->
<g id="node196" class="node">
<title>layer6_experts_gpu0</title>
<polygon fill="lightcoral" stroke="black" points="19940.2,-1123.71 19731.2,-1123.71 19731.2,-1049.71 19940.2,-1049.71 19940.2,-1123.71"/>
<text text-anchor="middle" x="19835.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 0</text>
<text text-anchor="middle" x="19835.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="19835.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="19835.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="19835.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="19835.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer6_route_gpu0&#45;&gt;layer6_experts_gpu0 -->
<g id="edge217" class="edge">
<title>layer6_route_gpu0&#45;&gt;layer6_experts_gpu0</title>
<path fill="none" stroke="black" d="M19835.7,-1160.6C19835.7,-1160.6 19835.7,-1133.81 19835.7,-1133.81"/>
<polygon fill="black" stroke="black" points="19839.2,-1133.81 19835.7,-1123.81 19832.2,-1133.81 19839.2,-1133.81"/>
</g>
<!-- layer6_agg_gpu0 -->
<g id="node197" class="node">
<title>layer6_agg_gpu0</title>
<ellipse fill="lightpink" stroke="black" cx="19828.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="19828.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 0</text>
<text text-anchor="middle" x="19828.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="19828.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="19828.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer6_experts_gpu0&#45;&gt;layer6_agg_gpu0 -->
<g id="edge218" class="edge">
<title>layer6_experts_gpu0&#45;&gt;layer6_agg_gpu0</title>
<path fill="none" stroke="black" d="M19835.7,-1049.52C19835.7,-1049.52 19835.7,-1022.85 19835.7,-1022.85"/>
<polygon fill="black" stroke="black" points="19839.2,-1022.85 19835.7,-1012.85 19832.2,-1022.85 19839.2,-1022.85"/>
</g>
<!-- layer6_agg_gpu0&#45;&gt;layer6_moe_agg -->
<g id="edge219" class="edge">
<title>layer6_agg_gpu0&#45;&gt;layer6_moe_agg</title>
<path fill="none" stroke="black" d="M19828.7,-938.87C19828.7,-889.14 19828.7,-807 19828.7,-807 19828.7,-807 21128.83,-807 21128.83,-807"/>
<polygon fill="black" stroke="black" points="21128.83,-810.5 21138.83,-807 21128.83,-803.5 21128.83,-810.5"/>
</g>
<!-- layer6_experts_gpu1 -->
<g id="node199" class="node">
<title>layer6_experts_gpu1</title>
<polygon fill="lightcoral" stroke="black" points="20357.2,-1123.71 20148.2,-1123.71 20148.2,-1049.71 20357.2,-1049.71 20357.2,-1123.71"/>
<text text-anchor="middle" x="20252.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 1</text>
<text text-anchor="middle" x="20252.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="20252.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="20252.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="20252.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="20252.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer6_route_gpu1&#45;&gt;layer6_experts_gpu1 -->
<g id="edge221" class="edge">
<title>layer6_route_gpu1&#45;&gt;layer6_experts_gpu1</title>
<path fill="none" stroke="black" d="M20252.7,-1160.6C20252.7,-1160.6 20252.7,-1133.81 20252.7,-1133.81"/>
<polygon fill="black" stroke="black" points="20256.2,-1133.81 20252.7,-1123.81 20249.2,-1133.81 20256.2,-1133.81"/>
</g>
<!-- layer6_agg_gpu1 -->
<g id="node200" class="node">
<title>layer6_agg_gpu1</title>
<ellipse fill="lightpink" stroke="black" cx="20243.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="20243.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 1</text>
<text text-anchor="middle" x="20243.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="20243.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="20243.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer6_experts_gpu1&#45;&gt;layer6_agg_gpu1 -->
<g id="edge222" class="edge">
<title>layer6_experts_gpu1&#45;&gt;layer6_agg_gpu1</title>
<path fill="none" stroke="black" d="M20252.7,-1049.52C20252.7,-1049.52 20252.7,-1022.85 20252.7,-1022.85"/>
<polygon fill="black" stroke="black" points="20256.2,-1022.85 20252.7,-1012.85 20249.2,-1022.85 20256.2,-1022.85"/>
</g>
<!-- layer6_agg_gpu1&#45;&gt;layer6_moe_agg -->
<g id="edge223" class="edge">
<title>layer6_agg_gpu1&#45;&gt;layer6_moe_agg</title>
<path fill="none" stroke="black" d="M20243.7,-938.99C20243.7,-892.87 20243.7,-820 20243.7,-820 20243.7,-820 21085.6,-820 21085.6,-820"/>
<polygon fill="black" stroke="black" points="21085.6,-823.5 21095.6,-820 21085.6,-816.5 21085.6,-823.5"/>
</g>
<!-- layer6_experts_gpu2 -->
<g id="node202" class="node">
<title>layer6_experts_gpu2</title>
<polygon fill="lightcoral" stroke="black" points="20766.2,-1123.71 20557.2,-1123.71 20557.2,-1049.71 20766.2,-1049.71 20766.2,-1123.71"/>
<text text-anchor="middle" x="20661.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 2</text>
<text text-anchor="middle" x="20661.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="20661.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="20661.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="20661.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="20661.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer6_route_gpu2&#45;&gt;layer6_experts_gpu2 -->
<g id="edge225" class="edge">
<title>layer6_route_gpu2&#45;&gt;layer6_experts_gpu2</title>
<path fill="none" stroke="black" d="M20661.7,-1160.6C20661.7,-1160.6 20661.7,-1133.81 20661.7,-1133.81"/>
<polygon fill="black" stroke="black" points="20665.2,-1133.81 20661.7,-1123.81 20658.2,-1133.81 20665.2,-1133.81"/>
</g>
<!-- layer6_agg_gpu2 -->
<g id="node203" class="node">
<title>layer6_agg_gpu2</title>
<ellipse fill="lightpink" stroke="black" cx="20658.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="20658.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 2</text>
<text text-anchor="middle" x="20658.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="20658.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="20658.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer6_experts_gpu2&#45;&gt;layer6_agg_gpu2 -->
<g id="edge226" class="edge">
<title>layer6_experts_gpu2&#45;&gt;layer6_agg_gpu2</title>
<path fill="none" stroke="black" d="M20661.7,-1049.52C20661.7,-1049.52 20661.7,-1022.85 20661.7,-1022.85"/>
<polygon fill="black" stroke="black" points="20665.2,-1022.85 20661.7,-1012.85 20658.2,-1022.85 20665.2,-1022.85"/>
</g>
<!-- layer6_agg_gpu2&#45;&gt;layer6_moe_agg -->
<g id="edge227" class="edge">
<title>layer6_agg_gpu2&#45;&gt;layer6_moe_agg</title>
<path fill="none" stroke="black" d="M20849.3,-965.12C20849.3,-931.65 20849.3,-832 20849.3,-832 20849.3,-832 21068.26,-832 21068.26,-832"/>
<polygon fill="black" stroke="black" points="21068.26,-835.5 21078.26,-832 21068.26,-828.5 21068.26,-835.5"/>
</g>
<!-- layer6_experts_gpu3 -->
<g id="node205" class="node">
<title>layer6_experts_gpu3</title>
<polygon fill="lightcoral" stroke="black" points="21178.2,-1123.71 20969.2,-1123.71 20969.2,-1049.71 21178.2,-1049.71 21178.2,-1123.71"/>
<text text-anchor="middle" x="21073.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 3</text>
<text text-anchor="middle" x="21073.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="21073.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="21073.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="21073.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="21073.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer6_route_gpu3&#45;&gt;layer6_experts_gpu3 -->
<g id="edge229" class="edge">
<title>layer6_route_gpu3&#45;&gt;layer6_experts_gpu3</title>
<path fill="none" stroke="black" d="M21073.7,-1160.6C21073.7,-1160.6 21073.7,-1133.81 21073.7,-1133.81"/>
<polygon fill="black" stroke="black" points="21077.2,-1133.81 21073.7,-1123.81 21070.2,-1133.81 21077.2,-1133.81"/>
</g>
<!-- layer6_agg_gpu3 -->
<g id="node206" class="node">
<title>layer6_agg_gpu3</title>
<ellipse fill="lightpink" stroke="black" cx="21073.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="21073.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 3</text>
<text text-anchor="middle" x="21073.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="21073.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="21073.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer6_experts_gpu3&#45;&gt;layer6_agg_gpu3 -->
<g id="edge230" class="edge">
<title>layer6_experts_gpu3&#45;&gt;layer6_agg_gpu3</title>
<path fill="none" stroke="black" d="M21073.7,-1049.52C21073.7,-1049.52 21073.7,-1022.85 21073.7,-1022.85"/>
<polygon fill="black" stroke="black" points="21077.2,-1022.85 21073.7,-1012.85 21070.2,-1022.85 21077.2,-1022.85"/>
</g>
<!-- layer6_agg_gpu3&#45;&gt;layer6_moe_agg -->
<g id="edge231" class="edge">
<title>layer6_agg_gpu3&#45;&gt;layer6_moe_agg</title>
<path fill="none" stroke="black" d="M21174.02,-943.88C21174.02,-943.88 21174.02,-887.36 21174.02,-887.36"/>
<polygon fill="black" stroke="black" points="21177.52,-887.36 21174.02,-877.36 21170.52,-887.36 21177.52,-887.36"/>
</g>
<!-- layer6_experts_gpu4 -->
<g id="node208" class="node">
<title>layer6_experts_gpu4</title>
<polygon fill="lightcoral" stroke="black" points="21592.2,-1123.71 21383.2,-1123.71 21383.2,-1049.71 21592.2,-1049.71 21592.2,-1123.71"/>
<text text-anchor="middle" x="21487.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 4</text>
<text text-anchor="middle" x="21487.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="21487.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="21487.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="21487.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="21487.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer6_route_gpu4&#45;&gt;layer6_experts_gpu4 -->
<g id="edge233" class="edge">
<title>layer6_route_gpu4&#45;&gt;layer6_experts_gpu4</title>
<path fill="none" stroke="black" d="M21487.7,-1160.6C21487.7,-1160.6 21487.7,-1133.81 21487.7,-1133.81"/>
<polygon fill="black" stroke="black" points="21491.2,-1133.81 21487.7,-1123.81 21484.2,-1133.81 21491.2,-1133.81"/>
</g>
<!-- layer6_agg_gpu4 -->
<g id="node209" class="node">
<title>layer6_agg_gpu4</title>
<ellipse fill="lightpink" stroke="black" cx="21488.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="21488.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 4</text>
<text text-anchor="middle" x="21488.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="21488.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="21488.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer6_experts_gpu4&#45;&gt;layer6_agg_gpu4 -->
<g id="edge234" class="edge">
<title>layer6_experts_gpu4&#45;&gt;layer6_agg_gpu4</title>
<path fill="none" stroke="black" d="M21487.7,-1049.52C21487.7,-1049.52 21487.7,-1022.85 21487.7,-1022.85"/>
<polygon fill="black" stroke="black" points="21491.2,-1022.85 21487.7,-1012.85 21484.2,-1022.85 21491.2,-1022.85"/>
</g>
<!-- layer6_agg_gpu4&#45;&gt;layer6_moe_agg -->
<g id="edge235" class="edge">
<title>layer6_agg_gpu4&#45;&gt;layer6_moe_agg</title>
<path fill="none" stroke="black" d="M21387.88,-944.22C21387.88,-944.22 21387.88,-887.54 21387.88,-887.54"/>
<polygon fill="black" stroke="black" points="21391.38,-887.54 21387.88,-877.54 21384.38,-887.54 21391.38,-887.54"/>
</g>
<!-- layer6_experts_gpu5 -->
<g id="node211" class="node">
<title>layer6_experts_gpu5</title>
<polygon fill="lightcoral" stroke="black" points="22002.2,-1123.71 21793.2,-1123.71 21793.2,-1049.71 22002.2,-1049.71 22002.2,-1123.71"/>
<text text-anchor="middle" x="21897.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 5</text>
<text text-anchor="middle" x="21897.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="21897.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="21897.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="21897.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="21897.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer6_route_gpu5&#45;&gt;layer6_experts_gpu5 -->
<g id="edge237" class="edge">
<title>layer6_route_gpu5&#45;&gt;layer6_experts_gpu5</title>
<path fill="none" stroke="black" d="M21897.7,-1160.6C21897.7,-1160.6 21897.7,-1133.81 21897.7,-1133.81"/>
<polygon fill="black" stroke="black" points="21901.2,-1133.81 21897.7,-1123.81 21894.2,-1133.81 21901.2,-1133.81"/>
</g>
<!-- layer6_agg_gpu5 -->
<g id="node212" class="node">
<title>layer6_agg_gpu5</title>
<ellipse fill="lightpink" stroke="black" cx="21903.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="21903.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 5</text>
<text text-anchor="middle" x="21903.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="21903.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="21903.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer6_experts_gpu5&#45;&gt;layer6_agg_gpu5 -->
<g id="edge238" class="edge">
<title>layer6_experts_gpu5&#45;&gt;layer6_agg_gpu5</title>
<path fill="none" stroke="black" d="M21897.7,-1049.52C21897.7,-1049.52 21897.7,-1022.85 21897.7,-1022.85"/>
<polygon fill="black" stroke="black" points="21901.2,-1022.85 21897.7,-1012.85 21894.2,-1022.85 21901.2,-1022.85"/>
</g>
<!-- layer6_agg_gpu5&#45;&gt;layer6_moe_agg -->
<g id="edge239" class="edge">
<title>layer6_agg_gpu5&#45;&gt;layer6_moe_agg</title>
<path fill="none" stroke="black" d="M21903.7,-938.89C21903.7,-908.34 21903.7,-870 21903.7,-870 21903.7,-870 21438.73,-870 21438.73,-870"/>
<polygon fill="black" stroke="black" points="21438.73,-866.5 21428.73,-870 21438.73,-873.5 21438.73,-866.5"/>
</g>
<!-- layer6_experts_gpu6 -->
<g id="node214" class="node">
<title>layer6_experts_gpu6</title>
<polygon fill="lightcoral" stroke="black" points="22408.2,-1123.71 22199.2,-1123.71 22199.2,-1049.71 22408.2,-1049.71 22408.2,-1123.71"/>
<text text-anchor="middle" x="22303.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 6</text>
<text text-anchor="middle" x="22303.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="22303.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="22303.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="22303.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="22303.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer6_route_gpu6&#45;&gt;layer6_experts_gpu6 -->
<g id="edge241" class="edge">
<title>layer6_route_gpu6&#45;&gt;layer6_experts_gpu6</title>
<path fill="none" stroke="black" d="M22303.7,-1160.6C22303.7,-1160.6 22303.7,-1133.81 22303.7,-1133.81"/>
<polygon fill="black" stroke="black" points="22307.2,-1133.81 22303.7,-1123.81 22300.2,-1133.81 22307.2,-1133.81"/>
</g>
<!-- layer6_agg_gpu6 -->
<g id="node215" class="node">
<title>layer6_agg_gpu6</title>
<ellipse fill="lightpink" stroke="black" cx="22318.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="22318.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 6</text>
<text text-anchor="middle" x="22318.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="22318.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="22318.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer6_experts_gpu6&#45;&gt;layer6_agg_gpu6 -->
<g id="edge242" class="edge">
<title>layer6_experts_gpu6&#45;&gt;layer6_agg_gpu6</title>
<path fill="none" stroke="black" d="M22303.7,-1049.52C22303.7,-1049.52 22303.7,-1022.85 22303.7,-1022.85"/>
<polygon fill="black" stroke="black" points="22307.2,-1022.85 22303.7,-1012.85 22300.2,-1022.85 22307.2,-1022.85"/>
</g>
<!-- layer6_agg_gpu6&#45;&gt;layer6_moe_agg -->
<g id="edge243" class="edge">
<title>layer6_agg_gpu6&#45;&gt;layer6_moe_agg</title>
<path fill="none" stroke="black" d="M22318.7,-938.95C22318.7,-904.36 22318.7,-858 22318.7,-858 22318.7,-858 21476.57,-858 21476.57,-858"/>
<polygon fill="black" stroke="black" points="21476.57,-854.5 21466.57,-858 21476.57,-861.5 21476.57,-854.5"/>
</g>
<!-- layer6_experts_gpu7 -->
<g id="node217" class="node">
<title>layer6_experts_gpu7</title>
<polygon fill="lightcoral" stroke="black" points="22835.2,-1123.71 22626.2,-1123.71 22626.2,-1049.71 22835.2,-1049.71 22835.2,-1123.71"/>
<text text-anchor="middle" x="22730.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 7</text>
<text text-anchor="middle" x="22730.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="22730.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="22730.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="22730.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="22730.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer6_route_gpu7&#45;&gt;layer6_experts_gpu7 -->
<g id="edge245" class="edge">
<title>layer6_route_gpu7&#45;&gt;layer6_experts_gpu7</title>
<path fill="none" stroke="black" d="M22730.7,-1160.6C22730.7,-1160.6 22730.7,-1133.81 22730.7,-1133.81"/>
<polygon fill="black" stroke="black" points="22734.2,-1133.81 22730.7,-1123.81 22727.2,-1133.81 22734.2,-1133.81"/>
</g>
<!-- layer6_agg_gpu7 -->
<g id="node218" class="node">
<title>layer6_agg_gpu7</title>
<ellipse fill="lightpink" stroke="black" cx="22733.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="22733.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 7</text>
<text text-anchor="middle" x="22733.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="22733.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="22733.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer6_experts_gpu7&#45;&gt;layer6_agg_gpu7 -->
<g id="edge246" class="edge">
<title>layer6_experts_gpu7&#45;&gt;layer6_agg_gpu7</title>
<path fill="none" stroke="black" d="M22730.7,-1049.52C22730.7,-1049.52 22730.7,-1022.85 22730.7,-1022.85"/>
<polygon fill="black" stroke="black" points="22734.2,-1022.85 22730.7,-1012.85 22727.2,-1022.85 22734.2,-1022.85"/>
</g>
<!-- layer6_agg_gpu7&#45;&gt;layer6_moe_agg -->
<g id="edge247" class="edge">
<title>layer6_agg_gpu7&#45;&gt;layer6_moe_agg</title>
<path fill="none" stroke="black" d="M22733.7,-939.12C22733.7,-900.39 22733.7,-845 22733.7,-845 22733.7,-845 21494.26,-845 21494.26,-845"/>
<polygon fill="black" stroke="black" points="21494.26,-841.5 21484.26,-845 21494.26,-848.5 21494.26,-841.5"/>
</g>
<!-- layer7_ln1 -->
<g id="node220" class="node">
<title>layer7_ln1</title>
<polygon fill="none" stroke="black" points="23271.2,-1365.75 22990.2,-1365.75 22990.2,-1302.75 23271.2,-1302.75 23271.2,-1365.75"/>
<text text-anchor="middle" x="23130.7" y="-1353.75" font-family="Arial" font-size="10.00">LayerNorm MHA 7</text>
<text text-anchor="middle" x="23130.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="23130.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="23130.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="23130.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer7_add1 -->
<g id="node221" class="node">
<title>layer7_add1</title>
<polygon fill="yellow" stroke="black" points="24394.2,-728.4 24113.2,-728.4 24113.2,-676.4 24394.2,-676.4 24394.2,-728.4"/>
<text text-anchor="middle" x="24253.7" y="-716.4" font-family="Arial" font-size="10.00">MHA Residual Add 7</text>
<text text-anchor="middle" x="24253.7" y="-705.4" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="24253.7" y="-694.4" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="24253.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer7_moe_output -->
<g id="node225" class="node">
<title>layer7_moe_output</title>
<polygon fill="yellow" stroke="black" points="24475.2,-617.63 24194.2,-617.63 24194.2,-565.63 24475.2,-565.63 24475.2,-617.63"/>
<text text-anchor="middle" x="24334.7" y="-605.63" font-family="Arial" font-size="10.00">MoE Residual Add 7</text>
<text text-anchor="middle" x="24334.7" y="-594.63" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="24334.7" y="-583.63" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="24334.7" y="-572.63" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer7_add1&#45;&gt;layer7_moe_output -->
<g id="edge285" class="edge">
<title>layer7_add1&#45;&gt;layer7_moe_output</title>
<path fill="none" stroke="black" d="M24294.2,-676.15C24294.2,-676.15 24294.2,-627.7 24294.2,-627.7"/>
<polygon fill="black" stroke="black" points="24297.7,-627.7 24294.2,-617.7 24290.7,-627.7 24297.7,-627.7"/>
</g>
<!-- layer7_gate -->
<g id="node222" class="node">
<title>layer7_gate</title>
<polygon fill="lightgreen" stroke="black" points="24889.13,-1397.25 24430.3,-1397.25 24312.26,-1271.25 24771.1,-1271.25 24889.13,-1397.25"/>
<text text-anchor="middle" x="24600.7" y="-1353.75" font-family="Arial" font-size="10.00">Gate Layer 7</text>
<text text-anchor="middle" x="24600.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="24600.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="24600.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="24600.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, num_experts=16]</text>
</g>
<!-- layer7_route_gpu0 -->
<g id="node226" class="node">
<title>layer7_route_gpu0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="23156.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="23156.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 0</text>
<text text-anchor="middle" x="23156.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="23156.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="23156.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer7_gate&#45;&gt;layer7_route_gpu0 -->
<g id="edge251" class="edge">
<title>layer7_gate&#45;&gt;layer7_route_gpu0</title>
<path fill="none" stroke="black" d="M24332.26,-1293C23954.29,-1293 23310.82,-1293 23310.82,-1293 23310.82,-1293 23310.82,-1230.12 23310.82,-1230.12"/>
<polygon fill="black" stroke="black" points="23314.32,-1230.12 23310.82,-1220.12 23307.32,-1230.12 23314.32,-1230.12"/>
</g>
<!-- layer7_route_gpu1 -->
<g id="node229" class="node">
<title>layer7_route_gpu1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="23576.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="23576.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 1</text>
<text text-anchor="middle" x="23576.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="23576.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="23576.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer7_gate&#45;&gt;layer7_route_gpu1 -->
<g id="edge255" class="edge">
<title>layer7_gate&#45;&gt;layer7_route_gpu1</title>
<path fill="none" stroke="black" d="M24323.93,-1284C24020.66,-1284 23576.7,-1284 23576.7,-1284 23576.7,-1284 23576.7,-1244.42 23576.7,-1244.42"/>
<polygon fill="black" stroke="black" points="23580.2,-1244.42 23576.7,-1234.42 23573.2,-1244.42 23580.2,-1244.42"/>
</g>
<!-- layer7_route_gpu2 -->
<g id="node232" class="node">
<title>layer7_route_gpu2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="23988.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="23988.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 2</text>
<text text-anchor="middle" x="23988.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="23988.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="23988.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer7_gate&#45;&gt;layer7_route_gpu2 -->
<g id="edge259" class="edge">
<title>layer7_gate&#45;&gt;layer7_route_gpu2</title>
<path fill="none" stroke="black" d="M24315.75,-1275C24156.06,-1275 23988.7,-1275 23988.7,-1275 23988.7,-1275 23988.7,-1244.42 23988.7,-1244.42"/>
<polygon fill="black" stroke="black" points="23992.2,-1244.42 23988.7,-1234.42 23985.2,-1244.42 23992.2,-1244.42"/>
</g>
<!-- layer7_route_gpu3 -->
<g id="node235" class="node">
<title>layer7_route_gpu3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="24397.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="24397.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 3</text>
<text text-anchor="middle" x="24397.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="24397.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="24397.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer7_gate&#45;&gt;layer7_route_gpu3 -->
<g id="edge263" class="edge">
<title>layer7_gate&#45;&gt;layer7_route_gpu3</title>
<path fill="none" stroke="black" d="M24451.96,-1271.07C24451.96,-1271.07 24451.96,-1242.78 24451.96,-1242.78"/>
<polygon fill="black" stroke="black" points="24455.46,-1242.78 24451.96,-1232.78 24448.46,-1242.78 24455.46,-1242.78"/>
</g>
<!-- layer7_route_gpu4 -->
<g id="node238" class="node">
<title>layer7_route_gpu4</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="24802.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="24802.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 4</text>
<text text-anchor="middle" x="24802.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="24802.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="24802.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer7_gate&#45;&gt;layer7_route_gpu4 -->
<g id="edge267" class="edge">
<title>layer7_gate&#45;&gt;layer7_route_gpu4</title>
<path fill="none" stroke="black" d="M24748.93,-1271.07C24748.93,-1271.07 24748.93,-1243.16 24748.93,-1243.16"/>
<polygon fill="black" stroke="black" points="24752.43,-1243.16 24748.93,-1233.16 24745.43,-1243.16 24752.43,-1243.16"/>
</g>
<!-- layer7_route_gpu5 -->
<g id="node241" class="node">
<title>layer7_route_gpu5</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="25212.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="25212.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 5</text>
<text text-anchor="middle" x="25212.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="25212.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="25212.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer7_gate&#45;&gt;layer7_route_gpu5 -->
<g id="edge271" class="edge">
<title>layer7_gate&#45;&gt;layer7_route_gpu5</title>
<path fill="none" stroke="black" d="M24779.36,-1280C24960,-1280 25212.7,-1280 25212.7,-1280 25212.7,-1280 25212.7,-1244.4 25212.7,-1244.4"/>
<polygon fill="black" stroke="black" points="25216.2,-1244.4 25212.7,-1234.4 25209.2,-1244.4 25216.2,-1244.4"/>
</g>
<!-- layer7_route_gpu6 -->
<g id="node244" class="node">
<title>layer7_route_gpu6</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="25629.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="25629.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 6</text>
<text text-anchor="middle" x="25629.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="25629.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="25629.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer7_gate&#45;&gt;layer7_route_gpu6 -->
<g id="edge275" class="edge">
<title>layer7_gate&#45;&gt;layer7_route_gpu6</title>
<path fill="none" stroke="black" d="M24787.94,-1289C25084.67,-1289 25629.7,-1289 25629.7,-1289 25629.7,-1289 25629.7,-1244.44 25629.7,-1244.44"/>
<polygon fill="black" stroke="black" points="25633.2,-1244.44 25629.7,-1234.44 25626.2,-1244.44 25633.2,-1244.44"/>
</g>
<!-- layer7_route_gpu7 -->
<g id="node247" class="node">
<title>layer7_route_gpu7</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="26036.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="26036.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 7</text>
<text text-anchor="middle" x="26036.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="26036.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="26036.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer7_gate&#45;&gt;layer7_route_gpu7 -->
<g id="edge279" class="edge">
<title>layer7_gate&#45;&gt;layer7_route_gpu7</title>
<path fill="none" stroke="black" d="M24796.36,-1298C25176.75,-1298 25979.07,-1298 25979.07,-1298 25979.07,-1298 25979.07,-1242.64 25979.07,-1242.64"/>
<polygon fill="black" stroke="black" points="25982.57,-1242.64 25979.07,-1232.64 25975.57,-1242.64 25982.57,-1242.64"/>
</g>
<!-- layer7_moe_agg -->
<g id="node223" class="node">
<title>layer7_moe_agg</title>
<ellipse fill="gold" stroke="black" cx="24552.7" cy="-839.17" rx="205.12" ry="44.6"/>
<text text-anchor="middle" x="24552.7" y="-858.67" font-family="Arial" font-size="10.00">MoE Final Aggregation 7</text>
<text text-anchor="middle" x="24552.7" y="-847.67" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="24552.7" y="-836.67" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="24552.7" y="-825.67" font-family="Arial" font-size="10.00">Input: 16Ã—[batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="24552.7" y="-814.67" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer7_ln2 -->
<g id="node224" class="node">
<title>layer7_ln2</title>
<polygon fill="none" stroke="black" points="24693.2,-733.9 24412.2,-733.9 24412.2,-670.9 24693.2,-670.9 24693.2,-733.9"/>
<text text-anchor="middle" x="24552.7" y="-721.9" font-family="Arial" font-size="10.00">LayerNorm MoE 7</text>
<text text-anchor="middle" x="24552.7" y="-710.9" font-family="Arial" font-size="10.00">TP=8 across GPUs 0&#45;7</text>
<text text-anchor="middle" x="24552.7" y="-699.9" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="24552.7" y="-688.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="24552.7" y="-677.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer7_moe_agg&#45;&gt;layer7_ln2 -->
<g id="edge283" class="edge">
<title>layer7_moe_agg&#45;&gt;layer7_ln2</title>
<path fill="none" stroke="black" d="M24552.7,-794.39C24552.7,-794.39 24552.7,-744.29 24552.7,-744.29"/>
<polygon fill="black" stroke="black" points="24556.2,-744.29 24552.7,-734.29 24549.2,-744.29 24556.2,-744.29"/>
</g>
<!-- layer7_ln2&#45;&gt;layer7_moe_output -->
<g id="edge284" class="edge">
<title>layer7_ln2&#45;&gt;layer7_moe_output</title>
<path fill="none" stroke="black" d="M24443.7,-670.66C24443.7,-670.66 24443.7,-627.78 24443.7,-627.78"/>
<polygon fill="black" stroke="black" points="24447.2,-627.78 24443.7,-617.78 24440.2,-627.78 24447.2,-627.78"/>
</g>
<!-- layer8_mha -->
<g id="node250" class="node">
<title>layer8_mha</title>
<polygon fill="lightcyan" stroke="black" points="24475.2,-483.37 24194.2,-483.37 24194.2,-420.37 24475.2,-420.37 24475.2,-483.37"/>
<text text-anchor="middle" x="24334.7" y="-471.37" font-family="Arial" font-size="10.00">MHA Layer 8</text>
<text text-anchor="middle" x="24334.7" y="-460.37" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="24334.7" y="-449.37" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="24334.7" y="-438.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="24334.7" y="-427.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer7_moe_output&#45;&gt;layer8_mha -->
<g id="edge573" class="edge">
<title>layer7_moe_output&#45;&gt;layer8_mha</title>
<path fill="none" stroke="black" d="M24334.7,-565.34C24334.7,-565.34 24334.7,-493.42 24334.7,-493.42"/>
<polygon fill="black" stroke="black" points="24338.2,-493.42 24334.7,-483.42 24331.2,-493.42 24338.2,-493.42"/>
<text text-anchor="middle" x="24422.2" y="-525.43" font-family="Times,serif" font-size="14.00">Pipeline Communication</text>
<text text-anchor="middle" x="24422.2" y="-510.43" font-family="Times,serif" font-size="14.00">Stage 0 &#45;&gt; Stage 1</text>
</g>
<!-- layer7_experts_gpu0 -->
<g id="node227" class="node">
<title>layer7_experts_gpu0</title>
<polygon fill="lightcoral" stroke="black" points="23258.2,-1123.71 23049.2,-1123.71 23049.2,-1049.71 23258.2,-1049.71 23258.2,-1123.71"/>
<text text-anchor="middle" x="23153.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 0</text>
<text text-anchor="middle" x="23153.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="23153.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="23153.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="23153.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="23153.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer7_route_gpu0&#45;&gt;layer7_experts_gpu0 -->
<g id="edge252" class="edge">
<title>layer7_route_gpu0&#45;&gt;layer7_experts_gpu0</title>
<path fill="none" stroke="black" d="M23153.7,-1160.6C23153.7,-1160.6 23153.7,-1133.81 23153.7,-1133.81"/>
<polygon fill="black" stroke="black" points="23157.2,-1133.81 23153.7,-1123.81 23150.2,-1133.81 23157.2,-1133.81"/>
</g>
<!-- layer7_agg_gpu0 -->
<g id="node228" class="node">
<title>layer7_agg_gpu0</title>
<ellipse fill="lightpink" stroke="black" cx="23148.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="23148.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 0</text>
<text text-anchor="middle" x="23148.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="23148.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="23148.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer7_experts_gpu0&#45;&gt;layer7_agg_gpu0 -->
<g id="edge253" class="edge">
<title>layer7_experts_gpu0&#45;&gt;layer7_agg_gpu0</title>
<path fill="none" stroke="black" d="M23153.7,-1049.52C23153.7,-1049.52 23153.7,-1022.85 23153.7,-1022.85"/>
<polygon fill="black" stroke="black" points="23157.2,-1022.85 23153.7,-1012.85 23150.2,-1022.85 23157.2,-1022.85"/>
</g>
<!-- layer7_agg_gpu0&#45;&gt;layer7_moe_agg -->
<g id="edge254" class="edge">
<title>layer7_agg_gpu0&#45;&gt;layer7_moe_agg</title>
<path fill="none" stroke="black" d="M23148.7,-938.87C23148.7,-889.14 23148.7,-807 23148.7,-807 23148.7,-807 24400.67,-807 24400.67,-807"/>
<polygon fill="black" stroke="black" points="24400.67,-810.5 24410.67,-807 24400.67,-803.5 24400.67,-810.5"/>
</g>
<!-- layer7_experts_gpu1 -->
<g id="node230" class="node">
<title>layer7_experts_gpu1</title>
<polygon fill="lightcoral" stroke="black" points="23673.2,-1123.71 23464.2,-1123.71 23464.2,-1049.71 23673.2,-1049.71 23673.2,-1123.71"/>
<text text-anchor="middle" x="23568.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 1</text>
<text text-anchor="middle" x="23568.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="23568.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="23568.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="23568.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="23568.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer7_route_gpu1&#45;&gt;layer7_experts_gpu1 -->
<g id="edge256" class="edge">
<title>layer7_route_gpu1&#45;&gt;layer7_experts_gpu1</title>
<path fill="none" stroke="black" d="M23568.7,-1160.6C23568.7,-1160.6 23568.7,-1133.81 23568.7,-1133.81"/>
<polygon fill="black" stroke="black" points="23572.2,-1133.81 23568.7,-1123.81 23565.2,-1133.81 23572.2,-1133.81"/>
</g>
<!-- layer7_agg_gpu1 -->
<g id="node231" class="node">
<title>layer7_agg_gpu1</title>
<ellipse fill="lightpink" stroke="black" cx="23563.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="23563.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 1</text>
<text text-anchor="middle" x="23563.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="23563.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="23563.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer7_experts_gpu1&#45;&gt;layer7_agg_gpu1 -->
<g id="edge257" class="edge">
<title>layer7_experts_gpu1&#45;&gt;layer7_agg_gpu1</title>
<path fill="none" stroke="black" d="M23568.7,-1049.52C23568.7,-1049.52 23568.7,-1022.85 23568.7,-1022.85"/>
<polygon fill="black" stroke="black" points="23572.2,-1022.85 23568.7,-1012.85 23565.2,-1022.85 23572.2,-1022.85"/>
</g>
<!-- layer7_agg_gpu1&#45;&gt;layer7_moe_agg -->
<g id="edge258" class="edge">
<title>layer7_agg_gpu1&#45;&gt;layer7_moe_agg</title>
<path fill="none" stroke="black" d="M23563.7,-938.99C23563.7,-892.87 23563.7,-820 23563.7,-820 23563.7,-820 24357.54,-820 24357.54,-820"/>
<polygon fill="black" stroke="black" points="24357.54,-823.5 24367.54,-820 24357.54,-816.5 24357.54,-823.5"/>
</g>
<!-- layer7_experts_gpu2 -->
<g id="node233" class="node">
<title>layer7_experts_gpu2</title>
<polygon fill="lightcoral" stroke="black" points="24090.2,-1123.71 23881.2,-1123.71 23881.2,-1049.71 24090.2,-1049.71 24090.2,-1123.71"/>
<text text-anchor="middle" x="23985.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 2</text>
<text text-anchor="middle" x="23985.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="23985.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="23985.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="23985.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="23985.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer7_route_gpu2&#45;&gt;layer7_experts_gpu2 -->
<g id="edge260" class="edge">
<title>layer7_route_gpu2&#45;&gt;layer7_experts_gpu2</title>
<path fill="none" stroke="black" d="M23985.7,-1160.6C23985.7,-1160.6 23985.7,-1133.81 23985.7,-1133.81"/>
<polygon fill="black" stroke="black" points="23989.2,-1133.81 23985.7,-1123.81 23982.2,-1133.81 23989.2,-1133.81"/>
</g>
<!-- layer7_agg_gpu2 -->
<g id="node234" class="node">
<title>layer7_agg_gpu2</title>
<ellipse fill="lightpink" stroke="black" cx="23978.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="23978.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 2</text>
<text text-anchor="middle" x="23978.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="23978.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="23978.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer7_experts_gpu2&#45;&gt;layer7_agg_gpu2 -->
<g id="edge261" class="edge">
<title>layer7_experts_gpu2&#45;&gt;layer7_agg_gpu2</title>
<path fill="none" stroke="black" d="M23985.7,-1049.52C23985.7,-1049.52 23985.7,-1022.85 23985.7,-1022.85"/>
<polygon fill="black" stroke="black" points="23989.2,-1022.85 23985.7,-1012.85 23982.2,-1022.85 23989.2,-1022.85"/>
</g>
<!-- layer7_agg_gpu2&#45;&gt;layer7_moe_agg -->
<g id="edge262" class="edge">
<title>layer7_agg_gpu2&#45;&gt;layer7_moe_agg</title>
<path fill="none" stroke="black" d="M24145.3,-955.62C24145.3,-915.95 24145.3,-832 24145.3,-832 24145.3,-832 24340.19,-832 24340.19,-832"/>
<polygon fill="black" stroke="black" points="24340.19,-835.5 24350.19,-832 24340.19,-828.5 24340.19,-835.5"/>
</g>
<!-- layer7_experts_gpu3 -->
<g id="node236" class="node">
<title>layer7_experts_gpu3</title>
<polygon fill="lightcoral" stroke="black" points="24500.2,-1123.71 24291.2,-1123.71 24291.2,-1049.71 24500.2,-1049.71 24500.2,-1123.71"/>
<text text-anchor="middle" x="24395.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 3</text>
<text text-anchor="middle" x="24395.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="24395.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="24395.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="24395.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="24395.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer7_route_gpu3&#45;&gt;layer7_experts_gpu3 -->
<g id="edge264" class="edge">
<title>layer7_route_gpu3&#45;&gt;layer7_experts_gpu3</title>
<path fill="none" stroke="black" d="M24395.7,-1160.6C24395.7,-1160.6 24395.7,-1133.81 24395.7,-1133.81"/>
<polygon fill="black" stroke="black" points="24399.2,-1133.81 24395.7,-1123.81 24392.2,-1133.81 24399.2,-1133.81"/>
</g>
<!-- layer7_agg_gpu3 -->
<g id="node237" class="node">
<title>layer7_agg_gpu3</title>
<ellipse fill="lightpink" stroke="black" cx="24393.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="24393.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 3</text>
<text text-anchor="middle" x="24393.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="24393.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="24393.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer7_experts_gpu3&#45;&gt;layer7_agg_gpu3 -->
<g id="edge265" class="edge">
<title>layer7_experts_gpu3&#45;&gt;layer7_agg_gpu3</title>
<path fill="none" stroke="black" d="M24395.7,-1049.52C24395.7,-1049.52 24395.7,-1022.85 24395.7,-1022.85"/>
<polygon fill="black" stroke="black" points="24399.2,-1022.85 24395.7,-1012.85 24392.2,-1022.85 24399.2,-1022.85"/>
</g>
<!-- layer7_agg_gpu3&#45;&gt;layer7_moe_agg -->
<g id="edge266" class="edge">
<title>layer7_agg_gpu3&#45;&gt;layer7_moe_agg</title>
<path fill="none" stroke="black" d="M24470.02,-941.78C24470.02,-941.78 24470.02,-890.2 24470.02,-890.2"/>
<polygon fill="black" stroke="black" points="24473.52,-890.2 24470.02,-880.2 24466.52,-890.2 24473.52,-890.2"/>
</g>
<!-- layer7_experts_gpu4 -->
<g id="node239" class="node">
<title>layer7_experts_gpu4</title>
<polygon fill="lightcoral" stroke="black" points="24909.2,-1123.71 24700.2,-1123.71 24700.2,-1049.71 24909.2,-1049.71 24909.2,-1123.71"/>
<text text-anchor="middle" x="24804.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 4</text>
<text text-anchor="middle" x="24804.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="24804.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="24804.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="24804.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="24804.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer7_route_gpu4&#45;&gt;layer7_experts_gpu4 -->
<g id="edge268" class="edge">
<title>layer7_route_gpu4&#45;&gt;layer7_experts_gpu4</title>
<path fill="none" stroke="black" d="M24804.7,-1160.6C24804.7,-1160.6 24804.7,-1133.81 24804.7,-1133.81"/>
<polygon fill="black" stroke="black" points="24808.2,-1133.81 24804.7,-1123.81 24801.2,-1133.81 24808.2,-1133.81"/>
</g>
<!-- layer7_agg_gpu4 -->
<g id="node240" class="node">
<title>layer7_agg_gpu4</title>
<ellipse fill="lightpink" stroke="black" cx="24808.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="24808.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 4</text>
<text text-anchor="middle" x="24808.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="24808.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="24808.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer7_experts_gpu4&#45;&gt;layer7_agg_gpu4 -->
<g id="edge269" class="edge">
<title>layer7_experts_gpu4&#45;&gt;layer7_agg_gpu4</title>
<path fill="none" stroke="black" d="M24804.7,-1049.52C24804.7,-1049.52 24804.7,-1022.85 24804.7,-1022.85"/>
<polygon fill="black" stroke="black" points="24808.2,-1022.85 24804.7,-1012.85 24801.2,-1022.85 24808.2,-1022.85"/>
</g>
<!-- layer7_agg_gpu4&#45;&gt;layer7_moe_agg -->
<g id="edge270" class="edge">
<title>layer7_agg_gpu4&#45;&gt;layer7_moe_agg</title>
<path fill="none" stroke="black" d="M24683.88,-947.27C24683.88,-947.27 24683.88,-883.62 24683.88,-883.62"/>
<polygon fill="black" stroke="black" points="24687.38,-883.62 24683.88,-873.62 24680.38,-883.62 24687.38,-883.62"/>
</g>
<!-- layer7_experts_gpu5 -->
<g id="node242" class="node">
<title>layer7_experts_gpu5</title>
<polygon fill="lightcoral" stroke="black" points="25327.2,-1123.71 25118.2,-1123.71 25118.2,-1049.71 25327.2,-1049.71 25327.2,-1123.71"/>
<text text-anchor="middle" x="25222.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 5</text>
<text text-anchor="middle" x="25222.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="25222.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="25222.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="25222.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="25222.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer7_route_gpu5&#45;&gt;layer7_experts_gpu5 -->
<g id="edge272" class="edge">
<title>layer7_route_gpu5&#45;&gt;layer7_experts_gpu5</title>
<path fill="none" stroke="black" d="M25222.7,-1160.6C25222.7,-1160.6 25222.7,-1133.81 25222.7,-1133.81"/>
<polygon fill="black" stroke="black" points="25226.2,-1133.81 25222.7,-1123.81 25219.2,-1133.81 25226.2,-1133.81"/>
</g>
<!-- layer7_agg_gpu5 -->
<g id="node243" class="node">
<title>layer7_agg_gpu5</title>
<ellipse fill="lightpink" stroke="black" cx="25223.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="25223.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 5</text>
<text text-anchor="middle" x="25223.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="25223.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="25223.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer7_experts_gpu5&#45;&gt;layer7_agg_gpu5 -->
<g id="edge273" class="edge">
<title>layer7_experts_gpu5&#45;&gt;layer7_agg_gpu5</title>
<path fill="none" stroke="black" d="M25222.7,-1049.52C25222.7,-1049.52 25222.7,-1022.85 25222.7,-1022.85"/>
<polygon fill="black" stroke="black" points="25226.2,-1022.85 25222.7,-1012.85 25219.2,-1022.85 25226.2,-1022.85"/>
</g>
<!-- layer7_agg_gpu5&#45;&gt;layer7_moe_agg -->
<g id="edge274" class="edge">
<title>layer7_agg_gpu5&#45;&gt;layer7_moe_agg</title>
<path fill="none" stroke="black" d="M25223.7,-938.89C25223.7,-908.34 25223.7,-870 25223.7,-870 25223.7,-870 24710.78,-870 24710.78,-870"/>
<polygon fill="black" stroke="black" points="24710.78,-866.5 24700.78,-870 24710.78,-873.5 24710.78,-866.5"/>
</g>
<!-- layer7_experts_gpu6 -->
<g id="node245" class="node">
<title>layer7_experts_gpu6</title>
<polygon fill="lightcoral" stroke="black" points="25740.2,-1123.71 25531.2,-1123.71 25531.2,-1049.71 25740.2,-1049.71 25740.2,-1123.71"/>
<text text-anchor="middle" x="25635.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 6</text>
<text text-anchor="middle" x="25635.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="25635.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="25635.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="25635.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="25635.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer7_route_gpu6&#45;&gt;layer7_experts_gpu6 -->
<g id="edge276" class="edge">
<title>layer7_route_gpu6&#45;&gt;layer7_experts_gpu6</title>
<path fill="none" stroke="black" d="M25635.7,-1160.6C25635.7,-1160.6 25635.7,-1133.81 25635.7,-1133.81"/>
<polygon fill="black" stroke="black" points="25639.2,-1133.81 25635.7,-1123.81 25632.2,-1133.81 25639.2,-1133.81"/>
</g>
<!-- layer7_agg_gpu6 -->
<g id="node246" class="node">
<title>layer7_agg_gpu6</title>
<ellipse fill="lightpink" stroke="black" cx="25638.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="25638.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 6</text>
<text text-anchor="middle" x="25638.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="25638.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="25638.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer7_experts_gpu6&#45;&gt;layer7_agg_gpu6 -->
<g id="edge277" class="edge">
<title>layer7_experts_gpu6&#45;&gt;layer7_agg_gpu6</title>
<path fill="none" stroke="black" d="M25635.7,-1049.52C25635.7,-1049.52 25635.7,-1022.85 25635.7,-1022.85"/>
<polygon fill="black" stroke="black" points="25639.2,-1022.85 25635.7,-1012.85 25632.2,-1022.85 25639.2,-1022.85"/>
</g>
<!-- layer7_agg_gpu6&#45;&gt;layer7_moe_agg -->
<g id="edge278" class="edge">
<title>layer7_agg_gpu6&#45;&gt;layer7_moe_agg</title>
<path fill="none" stroke="black" d="M25638.7,-938.95C25638.7,-904.36 25638.7,-858 25638.7,-858 25638.7,-858 24748.77,-858 24748.77,-858"/>
<polygon fill="black" stroke="black" points="24748.77,-854.5 24738.77,-858 24748.77,-861.5 24748.77,-854.5"/>
</g>
<!-- layer7_experts_gpu7 -->
<g id="node248" class="node">
<title>layer7_experts_gpu7</title>
<polygon fill="lightcoral" stroke="black" points="26148.2,-1123.71 25939.2,-1123.71 25939.2,-1049.71 26148.2,-1049.71 26148.2,-1123.71"/>
<text text-anchor="middle" x="26043.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 7</text>
<text text-anchor="middle" x="26043.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="26043.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="26043.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="26043.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="26043.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer7_route_gpu7&#45;&gt;layer7_experts_gpu7 -->
<g id="edge280" class="edge">
<title>layer7_route_gpu7&#45;&gt;layer7_experts_gpu7</title>
<path fill="none" stroke="black" d="M26043.7,-1160.6C26043.7,-1160.6 26043.7,-1133.81 26043.7,-1133.81"/>
<polygon fill="black" stroke="black" points="26047.2,-1133.81 26043.7,-1123.81 26040.2,-1133.81 26047.2,-1133.81"/>
</g>
<!-- layer7_agg_gpu7 -->
<g id="node249" class="node">
<title>layer7_agg_gpu7</title>
<ellipse fill="lightpink" stroke="black" cx="26053.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="26053.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 7</text>
<text text-anchor="middle" x="26053.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 0</text>
<text text-anchor="middle" x="26053.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="26053.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer7_experts_gpu7&#45;&gt;layer7_agg_gpu7 -->
<g id="edge281" class="edge">
<title>layer7_experts_gpu7&#45;&gt;layer7_agg_gpu7</title>
<path fill="none" stroke="black" d="M26043.7,-1049.52C26043.7,-1049.52 26043.7,-1022.85 26043.7,-1022.85"/>
<polygon fill="black" stroke="black" points="26047.2,-1022.85 26043.7,-1012.85 26040.2,-1022.85 26047.2,-1022.85"/>
</g>
<!-- layer7_agg_gpu7&#45;&gt;layer7_moe_agg -->
<g id="edge282" class="edge">
<title>layer7_agg_gpu7&#45;&gt;layer7_moe_agg</title>
<path fill="none" stroke="black" d="M26053.7,-939.12C26053.7,-900.39 26053.7,-845 26053.7,-845 26053.7,-845 24766.3,-845 24766.3,-845"/>
<polygon fill="black" stroke="black" points="24766.3,-841.5 24756.3,-845 24766.3,-848.5 24766.3,-841.5"/>
</g>
<!-- layer8_ln1 -->
<g id="node251" class="node">
<title>layer8_ln1</title>
<polygon fill="none" stroke="black" points="26115.2,-1365.75 25834.2,-1365.75 25834.2,-1302.75 26115.2,-1302.75 26115.2,-1365.75"/>
<text text-anchor="middle" x="25974.7" y="-1353.75" font-family="Arial" font-size="10.00">LayerNorm MHA 8</text>
<text text-anchor="middle" x="25974.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="25974.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="25974.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="25974.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer8_add1 -->
<g id="node252" class="node">
<title>layer8_add1</title>
<polygon fill="yellow" stroke="black" points="27762.2,-728.4 27481.2,-728.4 27481.2,-676.4 27762.2,-676.4 27762.2,-728.4"/>
<text text-anchor="middle" x="27621.7" y="-716.4" font-family="Arial" font-size="10.00">MHA Residual Add 8</text>
<text text-anchor="middle" x="27621.7" y="-705.4" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="27621.7" y="-694.4" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="27621.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer8_moe_output -->
<g id="node256" class="node">
<title>layer8_moe_output</title>
<polygon fill="yellow" stroke="black" points="27843.2,-617.63 27562.2,-617.63 27562.2,-565.63 27843.2,-565.63 27843.2,-617.63"/>
<text text-anchor="middle" x="27702.7" y="-605.63" font-family="Arial" font-size="10.00">MoE Residual Add 8</text>
<text text-anchor="middle" x="27702.7" y="-594.63" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="27702.7" y="-583.63" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="27702.7" y="-572.63" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer8_add1&#45;&gt;layer8_moe_output -->
<g id="edge320" class="edge">
<title>layer8_add1&#45;&gt;layer8_moe_output</title>
<path fill="none" stroke="black" d="M27662.2,-676.15C27662.2,-676.15 27662.2,-627.7 27662.2,-627.7"/>
<polygon fill="black" stroke="black" points="27665.7,-627.7 27662.2,-617.7 27658.7,-627.7 27665.7,-627.7"/>
</g>
<!-- layer8_gate -->
<g id="node253" class="node">
<title>layer8_gate</title>
<polygon fill="lightgreen" stroke="black" points="28113.13,-1397.25 27654.3,-1397.25 27536.26,-1271.25 27995.1,-1271.25 28113.13,-1397.25"/>
<text text-anchor="middle" x="27824.7" y="-1353.75" font-family="Arial" font-size="10.00">Gate Layer 8</text>
<text text-anchor="middle" x="27824.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="27824.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="27824.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="27824.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, num_experts=16]</text>
</g>
<!-- layer8_route_gpu8 -->
<g id="node257" class="node">
<title>layer8_route_gpu8</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="26477.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="26477.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 8</text>
<text text-anchor="middle" x="26477.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="26477.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="26477.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer8_gate&#45;&gt;layer8_route_gpu8 -->
<g id="edge286" class="edge">
<title>layer8_gate&#45;&gt;layer8_route_gpu8</title>
<path fill="none" stroke="black" d="M27556.56,-1293C27163.67,-1293 26477.7,-1293 26477.7,-1293 26477.7,-1293 26477.7,-1244.41 26477.7,-1244.41"/>
<polygon fill="black" stroke="black" points="26481.2,-1244.41 26477.7,-1234.41 26474.2,-1244.41 26481.2,-1244.41"/>
</g>
<!-- layer8_route_gpu9 -->
<g id="node260" class="node">
<title>layer8_route_gpu9</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="26897.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="26897.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 9</text>
<text text-anchor="middle" x="26897.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="26897.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="26897.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer8_gate&#45;&gt;layer8_route_gpu9 -->
<g id="edge290" class="edge">
<title>layer8_gate&#45;&gt;layer8_route_gpu9</title>
<path fill="none" stroke="black" d="M27548.14,-1284C27274.96,-1284 26897.7,-1284 26897.7,-1284 26897.7,-1284 26897.7,-1244.42 26897.7,-1244.42"/>
<polygon fill="black" stroke="black" points="26901.2,-1244.42 26897.7,-1234.42 26894.2,-1244.42 26901.2,-1244.42"/>
</g>
<!-- layer8_route_gpu10 -->
<g id="node263" class="node">
<title>layer8_route_gpu10</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="27307.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="27307.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 10</text>
<text text-anchor="middle" x="27307.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="27307.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="27307.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer8_gate&#45;&gt;layer8_route_gpu10 -->
<g id="edge294" class="edge">
<title>layer8_gate&#45;&gt;layer8_route_gpu10</title>
<path fill="none" stroke="black" d="M27539.73,-1275C27419.88,-1275 27307.7,-1275 27307.7,-1275 27307.7,-1275 27307.7,-1244.42 27307.7,-1244.42"/>
<polygon fill="black" stroke="black" points="27311.2,-1244.42 27307.7,-1234.42 27304.2,-1244.42 27311.2,-1244.42"/>
</g>
<!-- layer8_route_gpu11 -->
<g id="node266" class="node">
<title>layer8_route_gpu11</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="27714.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="27714.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 11</text>
<text text-anchor="middle" x="27714.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="27714.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="27714.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer8_gate&#45;&gt;layer8_route_gpu11 -->
<g id="edge298" class="edge">
<title>layer8_gate&#45;&gt;layer8_route_gpu11</title>
<path fill="none" stroke="black" d="M27722.46,-1271.07C27722.46,-1271.07 27722.46,-1244.29 27722.46,-1244.29"/>
<polygon fill="black" stroke="black" points="27725.96,-1244.29 27722.46,-1234.29 27718.96,-1244.29 27725.96,-1244.29"/>
</g>
<!-- layer8_route_gpu12 -->
<g id="node269" class="node">
<title>layer8_route_gpu12</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="28124.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="28124.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 12</text>
<text text-anchor="middle" x="28124.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="28124.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="28124.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer8_gate&#45;&gt;layer8_route_gpu12 -->
<g id="edge302" class="edge">
<title>layer8_gate&#45;&gt;layer8_route_gpu12</title>
<path fill="none" stroke="black" d="M28021.93,-1299.74C28021.93,-1299.74 28021.93,-1238.71 28021.93,-1238.71"/>
<polygon fill="black" stroke="black" points="28025.43,-1238.71 28021.93,-1228.71 28018.43,-1238.71 28025.43,-1238.71"/>
</g>
<!-- layer8_route_gpu13 -->
<g id="node272" class="node">
<title>layer8_route_gpu13</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="28536.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="28536.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 13</text>
<text text-anchor="middle" x="28536.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="28536.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="28536.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer8_gate&#45;&gt;layer8_route_gpu13 -->
<g id="edge306" class="edge">
<title>layer8_gate&#45;&gt;layer8_route_gpu13</title>
<path fill="none" stroke="black" d="M28003.45,-1280C28214.35,-1280 28536.7,-1280 28536.7,-1280 28536.7,-1280 28536.7,-1244.4 28536.7,-1244.4"/>
<polygon fill="black" stroke="black" points="28540.2,-1244.4 28536.7,-1234.4 28533.2,-1244.4 28540.2,-1244.4"/>
</g>
<!-- layer8_route_gpu14 -->
<g id="node275" class="node">
<title>layer8_route_gpu14</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="28945.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="28945.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 14</text>
<text text-anchor="middle" x="28945.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="28945.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="28945.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer8_gate&#45;&gt;layer8_route_gpu14 -->
<g id="edge310" class="edge">
<title>layer8_gate&#45;&gt;layer8_route_gpu14</title>
<path fill="none" stroke="black" d="M28012.01,-1289C28331.04,-1289 28945.7,-1289 28945.7,-1289 28945.7,-1289 28945.7,-1244.44 28945.7,-1244.44"/>
<polygon fill="black" stroke="black" points="28949.2,-1244.44 28945.7,-1234.44 28942.2,-1244.44 28949.2,-1244.44"/>
</g>
<!-- layer8_route_gpu15 -->
<g id="node278" class="node">
<title>layer8_route_gpu15</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="29352.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="29352.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 15</text>
<text text-anchor="middle" x="29352.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="29352.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="29352.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer8_gate&#45;&gt;layer8_route_gpu15 -->
<g id="edge314" class="edge">
<title>layer8_gate&#45;&gt;layer8_route_gpu15</title>
<path fill="none" stroke="black" d="M28020.48,-1298C28411.43,-1298 29251.57,-1298 29251.57,-1298 29251.57,-1298 29251.57,-1239.01 29251.57,-1239.01"/>
<polygon fill="black" stroke="black" points="29255.07,-1239.01 29251.57,-1229.01 29248.07,-1239.01 29255.07,-1239.01"/>
</g>
<!-- layer8_moe_agg -->
<g id="node254" class="node">
<title>layer8_moe_agg</title>
<ellipse fill="gold" stroke="black" cx="27920.7" cy="-839.17" rx="205.12" ry="44.6"/>
<text text-anchor="middle" x="27920.7" y="-858.67" font-family="Arial" font-size="10.00">MoE Final Aggregation 8</text>
<text text-anchor="middle" x="27920.7" y="-847.67" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="27920.7" y="-836.67" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="27920.7" y="-825.67" font-family="Arial" font-size="10.00">Input: 16Ã—[batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="27920.7" y="-814.67" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer8_ln2 -->
<g id="node255" class="node">
<title>layer8_ln2</title>
<polygon fill="none" stroke="black" points="28061.2,-733.9 27780.2,-733.9 27780.2,-670.9 28061.2,-670.9 28061.2,-733.9"/>
<text text-anchor="middle" x="27920.7" y="-721.9" font-family="Arial" font-size="10.00">LayerNorm MoE 8</text>
<text text-anchor="middle" x="27920.7" y="-710.9" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="27920.7" y="-699.9" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="27920.7" y="-688.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="27920.7" y="-677.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer8_moe_agg&#45;&gt;layer8_ln2 -->
<g id="edge318" class="edge">
<title>layer8_moe_agg&#45;&gt;layer8_ln2</title>
<path fill="none" stroke="black" d="M27920.7,-794.39C27920.7,-794.39 27920.7,-744.29 27920.7,-744.29"/>
<polygon fill="black" stroke="black" points="27924.2,-744.29 27920.7,-734.29 27917.2,-744.29 27924.2,-744.29"/>
</g>
<!-- layer8_ln2&#45;&gt;layer8_moe_output -->
<g id="edge319" class="edge">
<title>layer8_ln2&#45;&gt;layer8_moe_output</title>
<path fill="none" stroke="black" d="M27811.7,-670.66C27811.7,-670.66 27811.7,-627.78 27811.7,-627.78"/>
<polygon fill="black" stroke="black" points="27815.2,-627.78 27811.7,-617.78 27808.2,-627.78 27815.2,-627.78"/>
</g>
<!-- layer9_mha -->
<g id="node281" class="node">
<title>layer9_mha</title>
<polygon fill="lightcyan" stroke="black" points="27843.2,-483.37 27562.2,-483.37 27562.2,-420.37 27843.2,-420.37 27843.2,-483.37"/>
<text text-anchor="middle" x="27702.7" y="-471.37" font-family="Arial" font-size="10.00">MHA Layer 9</text>
<text text-anchor="middle" x="27702.7" y="-460.37" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="27702.7" y="-449.37" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="27702.7" y="-438.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="27702.7" y="-427.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer8_moe_output&#45;&gt;layer9_mha -->
<g id="edge574" class="edge">
<title>layer8_moe_output&#45;&gt;layer9_mha</title>
<path fill="none" stroke="black" d="M27702.7,-565.34C27702.7,-565.34 27702.7,-493.42 27702.7,-493.42"/>
<polygon fill="black" stroke="black" points="27706.2,-493.42 27702.7,-483.42 27699.2,-493.42 27706.2,-493.42"/>
</g>
<!-- layer8_experts_gpu8 -->
<g id="node258" class="node">
<title>layer8_experts_gpu8</title>
<polygon fill="lightcoral" stroke="black" points="26579.2,-1123.71 26370.2,-1123.71 26370.2,-1049.71 26579.2,-1049.71 26579.2,-1123.71"/>
<text text-anchor="middle" x="26474.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 8</text>
<text text-anchor="middle" x="26474.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="26474.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="26474.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="26474.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="26474.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer8_route_gpu8&#45;&gt;layer8_experts_gpu8 -->
<g id="edge287" class="edge">
<title>layer8_route_gpu8&#45;&gt;layer8_experts_gpu8</title>
<path fill="none" stroke="black" d="M26474.7,-1160.6C26474.7,-1160.6 26474.7,-1133.81 26474.7,-1133.81"/>
<polygon fill="black" stroke="black" points="26478.2,-1133.81 26474.7,-1123.81 26471.2,-1133.81 26478.2,-1133.81"/>
</g>
<!-- layer8_agg_gpu8 -->
<g id="node259" class="node">
<title>layer8_agg_gpu8</title>
<ellipse fill="lightpink" stroke="black" cx="26468.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="26468.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 8</text>
<text text-anchor="middle" x="26468.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="26468.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="26468.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer8_experts_gpu8&#45;&gt;layer8_agg_gpu8 -->
<g id="edge288" class="edge">
<title>layer8_experts_gpu8&#45;&gt;layer8_agg_gpu8</title>
<path fill="none" stroke="black" d="M26474.7,-1049.52C26474.7,-1049.52 26474.7,-1022.85 26474.7,-1022.85"/>
<polygon fill="black" stroke="black" points="26478.2,-1022.85 26474.7,-1012.85 26471.2,-1022.85 26478.2,-1022.85"/>
</g>
<!-- layer8_agg_gpu8&#45;&gt;layer8_moe_agg -->
<g id="edge289" class="edge">
<title>layer8_agg_gpu8&#45;&gt;layer8_moe_agg</title>
<path fill="none" stroke="black" d="M26468.7,-938.87C26468.7,-889.14 26468.7,-807 26468.7,-807 26468.7,-807 27768.83,-807 27768.83,-807"/>
<polygon fill="black" stroke="black" points="27768.83,-810.5 27778.83,-807 27768.83,-803.5 27768.83,-810.5"/>
</g>
<!-- layer8_experts_gpu9 -->
<g id="node261" class="node">
<title>layer8_experts_gpu9</title>
<polygon fill="lightcoral" stroke="black" points="26999.2,-1123.71 26790.2,-1123.71 26790.2,-1049.71 26999.2,-1049.71 26999.2,-1123.71"/>
<text text-anchor="middle" x="26894.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 9</text>
<text text-anchor="middle" x="26894.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="26894.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="26894.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="26894.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="26894.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer8_route_gpu9&#45;&gt;layer8_experts_gpu9 -->
<g id="edge291" class="edge">
<title>layer8_route_gpu9&#45;&gt;layer8_experts_gpu9</title>
<path fill="none" stroke="black" d="M26894.7,-1160.6C26894.7,-1160.6 26894.7,-1133.81 26894.7,-1133.81"/>
<polygon fill="black" stroke="black" points="26898.2,-1133.81 26894.7,-1123.81 26891.2,-1133.81 26898.2,-1133.81"/>
</g>
<!-- layer8_agg_gpu9 -->
<g id="node262" class="node">
<title>layer8_agg_gpu9</title>
<ellipse fill="lightpink" stroke="black" cx="26883.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="26883.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 9</text>
<text text-anchor="middle" x="26883.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="26883.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="26883.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer8_experts_gpu9&#45;&gt;layer8_agg_gpu9 -->
<g id="edge292" class="edge">
<title>layer8_experts_gpu9&#45;&gt;layer8_agg_gpu9</title>
<path fill="none" stroke="black" d="M26894.7,-1049.52C26894.7,-1049.52 26894.7,-1022.85 26894.7,-1022.85"/>
<polygon fill="black" stroke="black" points="26898.2,-1022.85 26894.7,-1012.85 26891.2,-1022.85 26898.2,-1022.85"/>
</g>
<!-- layer8_agg_gpu9&#45;&gt;layer8_moe_agg -->
<g id="edge293" class="edge">
<title>layer8_agg_gpu9&#45;&gt;layer8_moe_agg</title>
<path fill="none" stroke="black" d="M26883.7,-938.99C26883.7,-892.87 26883.7,-820 26883.7,-820 26883.7,-820 27725.6,-820 27725.6,-820"/>
<polygon fill="black" stroke="black" points="27725.6,-823.5 27735.6,-820 27725.6,-816.5 27725.6,-823.5"/>
</g>
<!-- layer8_experts_gpu10 -->
<g id="node264" class="node">
<title>layer8_experts_gpu10</title>
<polygon fill="lightcoral" stroke="black" points="27409.2,-1123.71 27200.2,-1123.71 27200.2,-1049.71 27409.2,-1049.71 27409.2,-1123.71"/>
<text text-anchor="middle" x="27304.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 10</text>
<text text-anchor="middle" x="27304.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="27304.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="27304.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="27304.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="27304.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer8_route_gpu10&#45;&gt;layer8_experts_gpu10 -->
<g id="edge295" class="edge">
<title>layer8_route_gpu10&#45;&gt;layer8_experts_gpu10</title>
<path fill="none" stroke="black" d="M27304.7,-1160.6C27304.7,-1160.6 27304.7,-1133.81 27304.7,-1133.81"/>
<polygon fill="black" stroke="black" points="27308.2,-1133.81 27304.7,-1123.81 27301.2,-1133.81 27308.2,-1133.81"/>
</g>
<!-- layer8_agg_gpu10 -->
<g id="node265" class="node">
<title>layer8_agg_gpu10</title>
<ellipse fill="lightpink" stroke="black" cx="27298.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="27298.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 10</text>
<text text-anchor="middle" x="27298.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="27298.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="27298.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer8_experts_gpu10&#45;&gt;layer8_agg_gpu10 -->
<g id="edge296" class="edge">
<title>layer8_experts_gpu10&#45;&gt;layer8_agg_gpu10</title>
<path fill="none" stroke="black" d="M27304.7,-1049.52C27304.7,-1049.52 27304.7,-1022.85 27304.7,-1022.85"/>
<polygon fill="black" stroke="black" points="27308.2,-1022.85 27304.7,-1012.85 27301.2,-1022.85 27308.2,-1022.85"/>
</g>
<!-- layer8_agg_gpu10&#45;&gt;layer8_moe_agg -->
<g id="edge297" class="edge">
<title>layer8_agg_gpu10&#45;&gt;layer8_moe_agg</title>
<path fill="none" stroke="black" d="M27489.3,-965.12C27489.3,-931.65 27489.3,-832 27489.3,-832 27489.3,-832 27708.26,-832 27708.26,-832"/>
<polygon fill="black" stroke="black" points="27708.26,-835.5 27718.26,-832 27708.26,-828.5 27708.26,-835.5"/>
</g>
<!-- layer8_experts_gpu11 -->
<g id="node267" class="node">
<title>layer8_experts_gpu11</title>
<polygon fill="lightcoral" stroke="black" points="27818.2,-1123.71 27609.2,-1123.71 27609.2,-1049.71 27818.2,-1049.71 27818.2,-1123.71"/>
<text text-anchor="middle" x="27713.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 11</text>
<text text-anchor="middle" x="27713.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="27713.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="27713.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="27713.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="27713.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer8_route_gpu11&#45;&gt;layer8_experts_gpu11 -->
<g id="edge299" class="edge">
<title>layer8_route_gpu11&#45;&gt;layer8_experts_gpu11</title>
<path fill="none" stroke="black" d="M27713.7,-1160.6C27713.7,-1160.6 27713.7,-1133.81 27713.7,-1133.81"/>
<polygon fill="black" stroke="black" points="27717.2,-1133.81 27713.7,-1123.81 27710.2,-1133.81 27717.2,-1133.81"/>
</g>
<!-- layer8_agg_gpu11 -->
<g id="node268" class="node">
<title>layer8_agg_gpu11</title>
<ellipse fill="lightpink" stroke="black" cx="27713.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="27713.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 11</text>
<text text-anchor="middle" x="27713.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="27713.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="27713.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer8_experts_gpu11&#45;&gt;layer8_agg_gpu11 -->
<g id="edge300" class="edge">
<title>layer8_experts_gpu11&#45;&gt;layer8_agg_gpu11</title>
<path fill="none" stroke="black" d="M27713.7,-1049.52C27713.7,-1049.52 27713.7,-1022.85 27713.7,-1022.85"/>
<polygon fill="black" stroke="black" points="27717.2,-1022.85 27713.7,-1012.85 27710.2,-1022.85 27717.2,-1022.85"/>
</g>
<!-- layer8_agg_gpu11&#45;&gt;layer8_moe_agg -->
<g id="edge301" class="edge">
<title>layer8_agg_gpu11&#45;&gt;layer8_moe_agg</title>
<path fill="none" stroke="black" d="M27814.02,-943.88C27814.02,-943.88 27814.02,-887.36 27814.02,-887.36"/>
<polygon fill="black" stroke="black" points="27817.52,-887.36 27814.02,-877.36 27810.52,-887.36 27817.52,-887.36"/>
</g>
<!-- layer8_experts_gpu12 -->
<g id="node270" class="node">
<title>layer8_experts_gpu12</title>
<polygon fill="lightcoral" stroke="black" points="28231.2,-1123.71 28022.2,-1123.71 28022.2,-1049.71 28231.2,-1049.71 28231.2,-1123.71"/>
<text text-anchor="middle" x="28126.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 12</text>
<text text-anchor="middle" x="28126.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="28126.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="28126.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="28126.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="28126.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer8_route_gpu12&#45;&gt;layer8_experts_gpu12 -->
<g id="edge303" class="edge">
<title>layer8_route_gpu12&#45;&gt;layer8_experts_gpu12</title>
<path fill="none" stroke="black" d="M28126.7,-1160.6C28126.7,-1160.6 28126.7,-1133.81 28126.7,-1133.81"/>
<polygon fill="black" stroke="black" points="28130.2,-1133.81 28126.7,-1123.81 28123.2,-1133.81 28130.2,-1133.81"/>
</g>
<!-- layer8_agg_gpu12 -->
<g id="node271" class="node">
<title>layer8_agg_gpu12</title>
<ellipse fill="lightpink" stroke="black" cx="28128.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="28128.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 12</text>
<text text-anchor="middle" x="28128.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="28128.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="28128.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer8_experts_gpu12&#45;&gt;layer8_agg_gpu12 -->
<g id="edge304" class="edge">
<title>layer8_experts_gpu12&#45;&gt;layer8_agg_gpu12</title>
<path fill="none" stroke="black" d="M28126.7,-1049.52C28126.7,-1049.52 28126.7,-1022.85 28126.7,-1022.85"/>
<polygon fill="black" stroke="black" points="28130.2,-1022.85 28126.7,-1012.85 28123.2,-1022.85 28130.2,-1022.85"/>
</g>
<!-- layer8_agg_gpu12&#45;&gt;layer8_moe_agg -->
<g id="edge305" class="edge">
<title>layer8_agg_gpu12&#45;&gt;layer8_moe_agg</title>
<path fill="none" stroke="black" d="M28027.88,-944.22C28027.88,-944.22 28027.88,-887.54 28027.88,-887.54"/>
<polygon fill="black" stroke="black" points="28031.38,-887.54 28027.88,-877.54 28024.38,-887.54 28031.38,-887.54"/>
</g>
<!-- layer8_experts_gpu13 -->
<g id="node273" class="node">
<title>layer8_experts_gpu13</title>
<polygon fill="lightcoral" stroke="black" points="28646.2,-1123.71 28437.2,-1123.71 28437.2,-1049.71 28646.2,-1049.71 28646.2,-1123.71"/>
<text text-anchor="middle" x="28541.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 13</text>
<text text-anchor="middle" x="28541.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="28541.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="28541.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="28541.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="28541.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer8_route_gpu13&#45;&gt;layer8_experts_gpu13 -->
<g id="edge307" class="edge">
<title>layer8_route_gpu13&#45;&gt;layer8_experts_gpu13</title>
<path fill="none" stroke="black" d="M28541.7,-1160.6C28541.7,-1160.6 28541.7,-1133.81 28541.7,-1133.81"/>
<polygon fill="black" stroke="black" points="28545.2,-1133.81 28541.7,-1123.81 28538.2,-1133.81 28545.2,-1133.81"/>
</g>
<!-- layer8_agg_gpu13 -->
<g id="node274" class="node">
<title>layer8_agg_gpu13</title>
<ellipse fill="lightpink" stroke="black" cx="28543.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="28543.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 13</text>
<text text-anchor="middle" x="28543.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="28543.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="28543.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer8_experts_gpu13&#45;&gt;layer8_agg_gpu13 -->
<g id="edge308" class="edge">
<title>layer8_experts_gpu13&#45;&gt;layer8_agg_gpu13</title>
<path fill="none" stroke="black" d="M28541.7,-1049.52C28541.7,-1049.52 28541.7,-1022.85 28541.7,-1022.85"/>
<polygon fill="black" stroke="black" points="28545.2,-1022.85 28541.7,-1012.85 28538.2,-1022.85 28545.2,-1022.85"/>
</g>
<!-- layer8_agg_gpu13&#45;&gt;layer8_moe_agg -->
<g id="edge309" class="edge">
<title>layer8_agg_gpu13&#45;&gt;layer8_moe_agg</title>
<path fill="none" stroke="black" d="M28543.7,-938.89C28543.7,-908.34 28543.7,-870 28543.7,-870 28543.7,-870 28078.73,-870 28078.73,-870"/>
<polygon fill="black" stroke="black" points="28078.73,-866.5 28068.73,-870 28078.73,-873.5 28078.73,-866.5"/>
</g>
<!-- layer8_experts_gpu14 -->
<g id="node276" class="node">
<title>layer8_experts_gpu14</title>
<polygon fill="lightcoral" stroke="black" points="29059.2,-1123.71 28850.2,-1123.71 28850.2,-1049.71 29059.2,-1049.71 29059.2,-1123.71"/>
<text text-anchor="middle" x="28954.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 14</text>
<text text-anchor="middle" x="28954.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="28954.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="28954.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="28954.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="28954.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer8_route_gpu14&#45;&gt;layer8_experts_gpu14 -->
<g id="edge311" class="edge">
<title>layer8_route_gpu14&#45;&gt;layer8_experts_gpu14</title>
<path fill="none" stroke="black" d="M28954.7,-1160.6C28954.7,-1160.6 28954.7,-1133.81 28954.7,-1133.81"/>
<polygon fill="black" stroke="black" points="28958.2,-1133.81 28954.7,-1123.81 28951.2,-1133.81 28958.2,-1133.81"/>
</g>
<!-- layer8_agg_gpu14 -->
<g id="node277" class="node">
<title>layer8_agg_gpu14</title>
<ellipse fill="lightpink" stroke="black" cx="28958.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="28958.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 14</text>
<text text-anchor="middle" x="28958.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="28958.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="28958.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer8_experts_gpu14&#45;&gt;layer8_agg_gpu14 -->
<g id="edge312" class="edge">
<title>layer8_experts_gpu14&#45;&gt;layer8_agg_gpu14</title>
<path fill="none" stroke="black" d="M28954.7,-1049.52C28954.7,-1049.52 28954.7,-1022.85 28954.7,-1022.85"/>
<polygon fill="black" stroke="black" points="28958.2,-1022.85 28954.7,-1012.85 28951.2,-1022.85 28958.2,-1022.85"/>
</g>
<!-- layer8_agg_gpu14&#45;&gt;layer8_moe_agg -->
<g id="edge313" class="edge">
<title>layer8_agg_gpu14&#45;&gt;layer8_moe_agg</title>
<path fill="none" stroke="black" d="M28958.7,-938.95C28958.7,-904.36 28958.7,-858 28958.7,-858 28958.7,-858 28116.57,-858 28116.57,-858"/>
<polygon fill="black" stroke="black" points="28116.57,-854.5 28106.57,-858 28116.57,-861.5 28116.57,-854.5"/>
</g>
<!-- layer8_experts_gpu15 -->
<g id="node279" class="node">
<title>layer8_experts_gpu15</title>
<polygon fill="lightcoral" stroke="black" points="29458.2,-1123.71 29249.2,-1123.71 29249.2,-1049.71 29458.2,-1049.71 29458.2,-1123.71"/>
<text text-anchor="middle" x="29353.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 15</text>
<text text-anchor="middle" x="29353.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="29353.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="29353.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="29353.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="29353.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer8_route_gpu15&#45;&gt;layer8_experts_gpu15 -->
<g id="edge315" class="edge">
<title>layer8_route_gpu15&#45;&gt;layer8_experts_gpu15</title>
<path fill="none" stroke="black" d="M29353.7,-1160.6C29353.7,-1160.6 29353.7,-1133.81 29353.7,-1133.81"/>
<polygon fill="black" stroke="black" points="29357.2,-1133.81 29353.7,-1123.81 29350.2,-1133.81 29357.2,-1133.81"/>
</g>
<!-- layer8_agg_gpu15 -->
<g id="node280" class="node">
<title>layer8_agg_gpu15</title>
<ellipse fill="lightpink" stroke="black" cx="29373.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="29373.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 15</text>
<text text-anchor="middle" x="29373.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="29373.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="29373.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer8_experts_gpu15&#45;&gt;layer8_agg_gpu15 -->
<g id="edge316" class="edge">
<title>layer8_experts_gpu15&#45;&gt;layer8_agg_gpu15</title>
<path fill="none" stroke="black" d="M29353.7,-1049.52C29353.7,-1049.52 29353.7,-1022.85 29353.7,-1022.85"/>
<polygon fill="black" stroke="black" points="29357.2,-1022.85 29353.7,-1012.85 29350.2,-1022.85 29357.2,-1022.85"/>
</g>
<!-- layer8_agg_gpu15&#45;&gt;layer8_moe_agg -->
<g id="edge317" class="edge">
<title>layer8_agg_gpu15&#45;&gt;layer8_moe_agg</title>
<path fill="none" stroke="black" d="M29373.7,-939.12C29373.7,-900.39 29373.7,-845 29373.7,-845 29373.7,-845 28134.26,-845 28134.26,-845"/>
<polygon fill="black" stroke="black" points="28134.26,-841.5 28124.26,-845 28134.26,-848.5 28134.26,-841.5"/>
</g>
<!-- layer9_ln1 -->
<g id="node282" class="node">
<title>layer9_ln1</title>
<polygon fill="none" stroke="black" points="29625.2,-1365.75 29344.2,-1365.75 29344.2,-1302.75 29625.2,-1302.75 29625.2,-1365.75"/>
<text text-anchor="middle" x="29484.7" y="-1353.75" font-family="Arial" font-size="10.00">LayerNorm MHA 9</text>
<text text-anchor="middle" x="29484.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="29484.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="29484.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="29484.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer9_add1 -->
<g id="node283" class="node">
<title>layer9_add1</title>
<polygon fill="yellow" stroke="black" points="31034.2,-728.4 30753.2,-728.4 30753.2,-676.4 31034.2,-676.4 31034.2,-728.4"/>
<text text-anchor="middle" x="30893.7" y="-716.4" font-family="Arial" font-size="10.00">MHA Residual Add 9</text>
<text text-anchor="middle" x="30893.7" y="-705.4" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="30893.7" y="-694.4" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="30893.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer9_moe_output -->
<g id="node287" class="node">
<title>layer9_moe_output</title>
<polygon fill="yellow" stroke="black" points="31115.2,-617.63 30834.2,-617.63 30834.2,-565.63 31115.2,-565.63 31115.2,-617.63"/>
<text text-anchor="middle" x="30974.7" y="-605.63" font-family="Arial" font-size="10.00">MoE Residual Add 9</text>
<text text-anchor="middle" x="30974.7" y="-594.63" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="30974.7" y="-583.63" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="30974.7" y="-572.63" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer9_add1&#45;&gt;layer9_moe_output -->
<g id="edge355" class="edge">
<title>layer9_add1&#45;&gt;layer9_moe_output</title>
<path fill="none" stroke="black" d="M30934.2,-676.15C30934.2,-676.15 30934.2,-627.7 30934.2,-627.7"/>
<polygon fill="black" stroke="black" points="30937.7,-627.7 30934.2,-617.7 30930.7,-627.7 30937.7,-627.7"/>
</g>
<!-- layer9_gate -->
<g id="node284" class="node">
<title>layer9_gate</title>
<polygon fill="lightgreen" stroke="black" points="31434.13,-1397.25 30975.3,-1397.25 30857.26,-1271.25 31316.1,-1271.25 31434.13,-1397.25"/>
<text text-anchor="middle" x="31145.7" y="-1353.75" font-family="Arial" font-size="10.00">Gate Layer 9</text>
<text text-anchor="middle" x="31145.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="31145.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="31145.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="31145.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, num_experts=16]</text>
</g>
<!-- layer9_route_gpu8 -->
<g id="node288" class="node">
<title>layer9_route_gpu8</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="29794.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="29794.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 8</text>
<text text-anchor="middle" x="29794.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="29794.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="29794.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer9_gate&#45;&gt;layer9_route_gpu8 -->
<g id="edge321" class="edge">
<title>layer9_gate&#45;&gt;layer9_route_gpu8</title>
<path fill="none" stroke="black" d="M30877.57,-1293C30486.79,-1293 29806.82,-1293 29806.82,-1293 29806.82,-1293 29806.82,-1244.41 29806.82,-1244.41"/>
<polygon fill="black" stroke="black" points="29810.32,-1244.41 29806.82,-1234.41 29803.32,-1244.41 29810.32,-1244.41"/>
</g>
<!-- layer9_route_gpu9 -->
<g id="node291" class="node">
<title>layer9_route_gpu9</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="30214.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="30214.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 9</text>
<text text-anchor="middle" x="30214.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="30214.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="30214.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer9_gate&#45;&gt;layer9_route_gpu9 -->
<g id="edge325" class="edge">
<title>layer9_gate&#45;&gt;layer9_route_gpu9</title>
<path fill="none" stroke="black" d="M30869.2,-1284C30594.74,-1284 30214.7,-1284 30214.7,-1284 30214.7,-1284 30214.7,-1244.42 30214.7,-1244.42"/>
<polygon fill="black" stroke="black" points="30218.2,-1244.42 30214.7,-1234.42 30211.2,-1244.42 30218.2,-1244.42"/>
</g>
<!-- layer9_route_gpu10 -->
<g id="node294" class="node">
<title>layer9_route_gpu10</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="30626.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="30626.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 10</text>
<text text-anchor="middle" x="30626.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="30626.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="30626.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer9_gate&#45;&gt;layer9_route_gpu10 -->
<g id="edge329" class="edge">
<title>layer9_gate&#45;&gt;layer9_route_gpu10</title>
<path fill="none" stroke="black" d="M30860.76,-1275C30740.02,-1275 30626.7,-1275 30626.7,-1275 30626.7,-1275 30626.7,-1244.42 30626.7,-1244.42"/>
<polygon fill="black" stroke="black" points="30630.2,-1244.42 30626.7,-1234.42 30623.2,-1244.42 30630.2,-1244.42"/>
</g>
<!-- layer9_route_gpu11 -->
<g id="node297" class="node">
<title>layer9_route_gpu11</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="31035.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="31035.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 11</text>
<text text-anchor="middle" x="31035.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="31035.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="31035.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer9_gate&#45;&gt;layer9_route_gpu11 -->
<g id="edge333" class="edge">
<title>layer9_gate&#45;&gt;layer9_route_gpu11</title>
<path fill="none" stroke="black" d="M31043.46,-1271.07C31043.46,-1271.07 31043.46,-1244.29 31043.46,-1244.29"/>
<polygon fill="black" stroke="black" points="31046.96,-1244.29 31043.46,-1234.29 31039.96,-1244.29 31046.96,-1244.29"/>
</g>
<!-- layer9_route_gpu12 -->
<g id="node300" class="node">
<title>layer9_route_gpu12</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="31445.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="31445.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 12</text>
<text text-anchor="middle" x="31445.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="31445.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="31445.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer9_gate&#45;&gt;layer9_route_gpu12 -->
<g id="edge337" class="edge">
<title>layer9_gate&#45;&gt;layer9_route_gpu12</title>
<path fill="none" stroke="black" d="M31342.93,-1299.74C31342.93,-1299.74 31342.93,-1238.71 31342.93,-1238.71"/>
<polygon fill="black" stroke="black" points="31346.43,-1238.71 31342.93,-1228.71 31339.43,-1238.71 31346.43,-1238.71"/>
</g>
<!-- layer9_route_gpu13 -->
<g id="node303" class="node">
<title>layer9_route_gpu13</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="31857.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="31857.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 13</text>
<text text-anchor="middle" x="31857.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="31857.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="31857.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer9_gate&#45;&gt;layer9_route_gpu13 -->
<g id="edge341" class="edge">
<title>layer9_gate&#45;&gt;layer9_route_gpu13</title>
<path fill="none" stroke="black" d="M31324.45,-1280C31535.35,-1280 31857.7,-1280 31857.7,-1280 31857.7,-1280 31857.7,-1244.4 31857.7,-1244.4"/>
<polygon fill="black" stroke="black" points="31861.2,-1244.4 31857.7,-1234.4 31854.2,-1244.4 31861.2,-1244.4"/>
</g>
<!-- layer9_route_gpu14 -->
<g id="node306" class="node">
<title>layer9_route_gpu14</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="32271.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="32271.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 14</text>
<text text-anchor="middle" x="32271.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="32271.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="32271.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer9_gate&#45;&gt;layer9_route_gpu14 -->
<g id="edge345" class="edge">
<title>layer9_gate&#45;&gt;layer9_route_gpu14</title>
<path fill="none" stroke="black" d="M31332.9,-1289C31653.08,-1289 32271.7,-1289 32271.7,-1289 32271.7,-1289 32271.7,-1244.44 32271.7,-1244.44"/>
<polygon fill="black" stroke="black" points="32275.2,-1244.44 32271.7,-1234.44 32268.2,-1244.44 32275.2,-1244.44"/>
</g>
<!-- layer9_route_gpu15 -->
<g id="node309" class="node">
<title>layer9_route_gpu15</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="32685.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="32685.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 15</text>
<text text-anchor="middle" x="32685.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="32685.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="32685.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer9_gate&#45;&gt;layer9_route_gpu15 -->
<g id="edge349" class="edge">
<title>layer9_gate&#45;&gt;layer9_route_gpu15</title>
<path fill="none" stroke="black" d="M31341.52,-1298C31756.3,-1298 32685.7,-1298 32685.7,-1298 32685.7,-1298 32685.7,-1244.34 32685.7,-1244.34"/>
<polygon fill="black" stroke="black" points="32689.2,-1244.34 32685.7,-1234.34 32682.2,-1244.34 32689.2,-1244.34"/>
</g>
<!-- layer9_moe_agg -->
<g id="node285" class="node">
<title>layer9_moe_agg</title>
<ellipse fill="gold" stroke="black" cx="31192.7" cy="-839.17" rx="205.12" ry="44.6"/>
<text text-anchor="middle" x="31192.7" y="-858.67" font-family="Arial" font-size="10.00">MoE Final Aggregation 9</text>
<text text-anchor="middle" x="31192.7" y="-847.67" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="31192.7" y="-836.67" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="31192.7" y="-825.67" font-family="Arial" font-size="10.00">Input: 16Ã—[batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="31192.7" y="-814.67" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer9_ln2 -->
<g id="node286" class="node">
<title>layer9_ln2</title>
<polygon fill="none" stroke="black" points="31333.2,-733.9 31052.2,-733.9 31052.2,-670.9 31333.2,-670.9 31333.2,-733.9"/>
<text text-anchor="middle" x="31192.7" y="-721.9" font-family="Arial" font-size="10.00">LayerNorm MoE 9</text>
<text text-anchor="middle" x="31192.7" y="-710.9" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="31192.7" y="-699.9" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="31192.7" y="-688.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="31192.7" y="-677.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer9_moe_agg&#45;&gt;layer9_ln2 -->
<g id="edge353" class="edge">
<title>layer9_moe_agg&#45;&gt;layer9_ln2</title>
<path fill="none" stroke="black" d="M31192.7,-794.39C31192.7,-794.39 31192.7,-744.29 31192.7,-744.29"/>
<polygon fill="black" stroke="black" points="31196.2,-744.29 31192.7,-734.29 31189.2,-744.29 31196.2,-744.29"/>
</g>
<!-- layer9_ln2&#45;&gt;layer9_moe_output -->
<g id="edge354" class="edge">
<title>layer9_ln2&#45;&gt;layer9_moe_output</title>
<path fill="none" stroke="black" d="M31083.7,-670.66C31083.7,-670.66 31083.7,-627.78 31083.7,-627.78"/>
<polygon fill="black" stroke="black" points="31087.2,-627.78 31083.7,-617.78 31080.2,-627.78 31087.2,-627.78"/>
</g>
<!-- layer10_mha -->
<g id="node312" class="node">
<title>layer10_mha</title>
<polygon fill="lightcyan" stroke="black" points="31115.2,-483.37 30834.2,-483.37 30834.2,-420.37 31115.2,-420.37 31115.2,-483.37"/>
<text text-anchor="middle" x="30974.7" y="-471.37" font-family="Arial" font-size="10.00">MHA Layer 10</text>
<text text-anchor="middle" x="30974.7" y="-460.37" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="30974.7" y="-449.37" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="30974.7" y="-438.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="30974.7" y="-427.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer9_moe_output&#45;&gt;layer10_mha -->
<g id="edge575" class="edge">
<title>layer9_moe_output&#45;&gt;layer10_mha</title>
<path fill="none" stroke="black" d="M30974.7,-565.34C30974.7,-565.34 30974.7,-493.42 30974.7,-493.42"/>
<polygon fill="black" stroke="black" points="30978.2,-493.42 30974.7,-483.42 30971.2,-493.42 30978.2,-493.42"/>
</g>
<!-- layer9_experts_gpu8 -->
<g id="node289" class="node">
<title>layer9_experts_gpu8</title>
<polygon fill="lightcoral" stroke="black" points="29896.2,-1123.71 29687.2,-1123.71 29687.2,-1049.71 29896.2,-1049.71 29896.2,-1123.71"/>
<text text-anchor="middle" x="29791.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 8</text>
<text text-anchor="middle" x="29791.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="29791.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="29791.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="29791.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="29791.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer9_route_gpu8&#45;&gt;layer9_experts_gpu8 -->
<g id="edge322" class="edge">
<title>layer9_route_gpu8&#45;&gt;layer9_experts_gpu8</title>
<path fill="none" stroke="black" d="M29791.7,-1160.6C29791.7,-1160.6 29791.7,-1133.81 29791.7,-1133.81"/>
<polygon fill="black" stroke="black" points="29795.2,-1133.81 29791.7,-1123.81 29788.2,-1133.81 29795.2,-1133.81"/>
</g>
<!-- layer9_agg_gpu8 -->
<g id="node290" class="node">
<title>layer9_agg_gpu8</title>
<ellipse fill="lightpink" stroke="black" cx="29788.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="29788.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 8</text>
<text text-anchor="middle" x="29788.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="29788.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="29788.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer9_experts_gpu8&#45;&gt;layer9_agg_gpu8 -->
<g id="edge323" class="edge">
<title>layer9_experts_gpu8&#45;&gt;layer9_agg_gpu8</title>
<path fill="none" stroke="black" d="M29791.7,-1049.52C29791.7,-1049.52 29791.7,-1022.85 29791.7,-1022.85"/>
<polygon fill="black" stroke="black" points="29795.2,-1022.85 29791.7,-1012.85 29788.2,-1022.85 29795.2,-1022.85"/>
</g>
<!-- layer9_agg_gpu8&#45;&gt;layer9_moe_agg -->
<g id="edge324" class="edge">
<title>layer9_agg_gpu8&#45;&gt;layer9_moe_agg</title>
<path fill="none" stroke="black" d="M29788.7,-938.87C29788.7,-889.14 29788.7,-807 29788.7,-807 29788.7,-807 31040.67,-807 31040.67,-807"/>
<polygon fill="black" stroke="black" points="31040.67,-810.5 31050.67,-807 31040.67,-803.5 31040.67,-810.5"/>
</g>
<!-- layer9_experts_gpu9 -->
<g id="node292" class="node">
<title>layer9_experts_gpu9</title>
<polygon fill="lightcoral" stroke="black" points="30313.2,-1123.71 30104.2,-1123.71 30104.2,-1049.71 30313.2,-1049.71 30313.2,-1123.71"/>
<text text-anchor="middle" x="30208.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 9</text>
<text text-anchor="middle" x="30208.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="30208.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="30208.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="30208.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="30208.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer9_route_gpu9&#45;&gt;layer9_experts_gpu9 -->
<g id="edge326" class="edge">
<title>layer9_route_gpu9&#45;&gt;layer9_experts_gpu9</title>
<path fill="none" stroke="black" d="M30208.7,-1160.6C30208.7,-1160.6 30208.7,-1133.81 30208.7,-1133.81"/>
<polygon fill="black" stroke="black" points="30212.2,-1133.81 30208.7,-1123.81 30205.2,-1133.81 30212.2,-1133.81"/>
</g>
<!-- layer9_agg_gpu9 -->
<g id="node293" class="node">
<title>layer9_agg_gpu9</title>
<ellipse fill="lightpink" stroke="black" cx="30203.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="30203.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 9</text>
<text text-anchor="middle" x="30203.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="30203.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="30203.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer9_experts_gpu9&#45;&gt;layer9_agg_gpu9 -->
<g id="edge327" class="edge">
<title>layer9_experts_gpu9&#45;&gt;layer9_agg_gpu9</title>
<path fill="none" stroke="black" d="M30208.7,-1049.52C30208.7,-1049.52 30208.7,-1022.85 30208.7,-1022.85"/>
<polygon fill="black" stroke="black" points="30212.2,-1022.85 30208.7,-1012.85 30205.2,-1022.85 30212.2,-1022.85"/>
</g>
<!-- layer9_agg_gpu9&#45;&gt;layer9_moe_agg -->
<g id="edge328" class="edge">
<title>layer9_agg_gpu9&#45;&gt;layer9_moe_agg</title>
<path fill="none" stroke="black" d="M30203.7,-938.99C30203.7,-892.87 30203.7,-820 30203.7,-820 30203.7,-820 30997.54,-820 30997.54,-820"/>
<polygon fill="black" stroke="black" points="30997.54,-823.5 31007.54,-820 30997.54,-816.5 30997.54,-823.5"/>
</g>
<!-- layer9_experts_gpu10 -->
<g id="node295" class="node">
<title>layer9_experts_gpu10</title>
<polygon fill="lightcoral" stroke="black" points="30727.2,-1123.71 30518.2,-1123.71 30518.2,-1049.71 30727.2,-1049.71 30727.2,-1123.71"/>
<text text-anchor="middle" x="30622.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 10</text>
<text text-anchor="middle" x="30622.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="30622.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="30622.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="30622.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="30622.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer9_route_gpu10&#45;&gt;layer9_experts_gpu10 -->
<g id="edge330" class="edge">
<title>layer9_route_gpu10&#45;&gt;layer9_experts_gpu10</title>
<path fill="none" stroke="black" d="M30622.7,-1160.6C30622.7,-1160.6 30622.7,-1133.81 30622.7,-1133.81"/>
<polygon fill="black" stroke="black" points="30626.2,-1133.81 30622.7,-1123.81 30619.2,-1133.81 30626.2,-1133.81"/>
</g>
<!-- layer9_agg_gpu10 -->
<g id="node296" class="node">
<title>layer9_agg_gpu10</title>
<ellipse fill="lightpink" stroke="black" cx="30618.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="30618.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 10</text>
<text text-anchor="middle" x="30618.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="30618.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="30618.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer9_experts_gpu10&#45;&gt;layer9_agg_gpu10 -->
<g id="edge331" class="edge">
<title>layer9_experts_gpu10&#45;&gt;layer9_agg_gpu10</title>
<path fill="none" stroke="black" d="M30622.7,-1049.52C30622.7,-1049.52 30622.7,-1022.85 30622.7,-1022.85"/>
<polygon fill="black" stroke="black" points="30626.2,-1022.85 30622.7,-1012.85 30619.2,-1022.85 30626.2,-1022.85"/>
</g>
<!-- layer9_agg_gpu10&#45;&gt;layer9_moe_agg -->
<g id="edge332" class="edge">
<title>layer9_agg_gpu10&#45;&gt;layer9_moe_agg</title>
<path fill="none" stroke="black" d="M30785.3,-955.62C30785.3,-915.95 30785.3,-832 30785.3,-832 30785.3,-832 30980.19,-832 30980.19,-832"/>
<polygon fill="black" stroke="black" points="30980.19,-835.5 30990.19,-832 30980.19,-828.5 30980.19,-835.5"/>
</g>
<!-- layer9_experts_gpu11 -->
<g id="node298" class="node">
<title>layer9_experts_gpu11</title>
<polygon fill="lightcoral" stroke="black" points="31139.2,-1123.71 30930.2,-1123.71 30930.2,-1049.71 31139.2,-1049.71 31139.2,-1123.71"/>
<text text-anchor="middle" x="31034.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 11</text>
<text text-anchor="middle" x="31034.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="31034.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="31034.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="31034.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="31034.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer9_route_gpu11&#45;&gt;layer9_experts_gpu11 -->
<g id="edge334" class="edge">
<title>layer9_route_gpu11&#45;&gt;layer9_experts_gpu11</title>
<path fill="none" stroke="black" d="M31034.7,-1160.6C31034.7,-1160.6 31034.7,-1133.81 31034.7,-1133.81"/>
<polygon fill="black" stroke="black" points="31038.2,-1133.81 31034.7,-1123.81 31031.2,-1133.81 31038.2,-1133.81"/>
</g>
<!-- layer9_agg_gpu11 -->
<g id="node299" class="node">
<title>layer9_agg_gpu11</title>
<ellipse fill="lightpink" stroke="black" cx="31033.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="31033.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 11</text>
<text text-anchor="middle" x="31033.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="31033.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="31033.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer9_experts_gpu11&#45;&gt;layer9_agg_gpu11 -->
<g id="edge335" class="edge">
<title>layer9_experts_gpu11&#45;&gt;layer9_agg_gpu11</title>
<path fill="none" stroke="black" d="M31034.7,-1049.52C31034.7,-1049.52 31034.7,-1022.85 31034.7,-1022.85"/>
<polygon fill="black" stroke="black" points="31038.2,-1022.85 31034.7,-1012.85 31031.2,-1022.85 31038.2,-1022.85"/>
</g>
<!-- layer9_agg_gpu11&#45;&gt;layer9_moe_agg -->
<g id="edge336" class="edge">
<title>layer9_agg_gpu11&#45;&gt;layer9_moe_agg</title>
<path fill="none" stroke="black" d="M31110.02,-941.78C31110.02,-941.78 31110.02,-890.2 31110.02,-890.2"/>
<polygon fill="black" stroke="black" points="31113.52,-890.2 31110.02,-880.2 31106.52,-890.2 31113.52,-890.2"/>
</g>
<!-- layer9_experts_gpu12 -->
<g id="node301" class="node">
<title>layer9_experts_gpu12</title>
<polygon fill="lightcoral" stroke="black" points="31551.2,-1123.71 31342.2,-1123.71 31342.2,-1049.71 31551.2,-1049.71 31551.2,-1123.71"/>
<text text-anchor="middle" x="31446.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 12</text>
<text text-anchor="middle" x="31446.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="31446.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="31446.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="31446.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="31446.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer9_route_gpu12&#45;&gt;layer9_experts_gpu12 -->
<g id="edge338" class="edge">
<title>layer9_route_gpu12&#45;&gt;layer9_experts_gpu12</title>
<path fill="none" stroke="black" d="M31446.7,-1160.6C31446.7,-1160.6 31446.7,-1133.81 31446.7,-1133.81"/>
<polygon fill="black" stroke="black" points="31450.2,-1133.81 31446.7,-1123.81 31443.2,-1133.81 31450.2,-1133.81"/>
</g>
<!-- layer9_agg_gpu12 -->
<g id="node302" class="node">
<title>layer9_agg_gpu12</title>
<ellipse fill="lightpink" stroke="black" cx="31448.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="31448.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 12</text>
<text text-anchor="middle" x="31448.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="31448.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="31448.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer9_experts_gpu12&#45;&gt;layer9_agg_gpu12 -->
<g id="edge339" class="edge">
<title>layer9_experts_gpu12&#45;&gt;layer9_agg_gpu12</title>
<path fill="none" stroke="black" d="M31446.7,-1049.52C31446.7,-1049.52 31446.7,-1022.85 31446.7,-1022.85"/>
<polygon fill="black" stroke="black" points="31450.2,-1022.85 31446.7,-1012.85 31443.2,-1022.85 31450.2,-1022.85"/>
</g>
<!-- layer9_agg_gpu12&#45;&gt;layer9_moe_agg -->
<g id="edge340" class="edge">
<title>layer9_agg_gpu12&#45;&gt;layer9_moe_agg</title>
<path fill="none" stroke="black" d="M31323.88,-947.27C31323.88,-947.27 31323.88,-883.62 31323.88,-883.62"/>
<polygon fill="black" stroke="black" points="31327.38,-883.62 31323.88,-873.62 31320.38,-883.62 31327.38,-883.62"/>
</g>
<!-- layer9_experts_gpu13 -->
<g id="node304" class="node">
<title>layer9_experts_gpu13</title>
<polygon fill="lightcoral" stroke="black" points="31967.2,-1123.71 31758.2,-1123.71 31758.2,-1049.71 31967.2,-1049.71 31967.2,-1123.71"/>
<text text-anchor="middle" x="31862.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 13</text>
<text text-anchor="middle" x="31862.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="31862.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="31862.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="31862.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="31862.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer9_route_gpu13&#45;&gt;layer9_experts_gpu13 -->
<g id="edge342" class="edge">
<title>layer9_route_gpu13&#45;&gt;layer9_experts_gpu13</title>
<path fill="none" stroke="black" d="M31862.7,-1160.6C31862.7,-1160.6 31862.7,-1133.81 31862.7,-1133.81"/>
<polygon fill="black" stroke="black" points="31866.2,-1133.81 31862.7,-1123.81 31859.2,-1133.81 31866.2,-1133.81"/>
</g>
<!-- layer9_agg_gpu13 -->
<g id="node305" class="node">
<title>layer9_agg_gpu13</title>
<ellipse fill="lightpink" stroke="black" cx="31863.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="31863.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 13</text>
<text text-anchor="middle" x="31863.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="31863.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="31863.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer9_experts_gpu13&#45;&gt;layer9_agg_gpu13 -->
<g id="edge343" class="edge">
<title>layer9_experts_gpu13&#45;&gt;layer9_agg_gpu13</title>
<path fill="none" stroke="black" d="M31862.7,-1049.52C31862.7,-1049.52 31862.7,-1022.85 31862.7,-1022.85"/>
<polygon fill="black" stroke="black" points="31866.2,-1022.85 31862.7,-1012.85 31859.2,-1022.85 31866.2,-1022.85"/>
</g>
<!-- layer9_agg_gpu13&#45;&gt;layer9_moe_agg -->
<g id="edge344" class="edge">
<title>layer9_agg_gpu13&#45;&gt;layer9_moe_agg</title>
<path fill="none" stroke="black" d="M31863.7,-938.89C31863.7,-908.34 31863.7,-870 31863.7,-870 31863.7,-870 31350.78,-870 31350.78,-870"/>
<polygon fill="black" stroke="black" points="31350.78,-866.5 31340.78,-870 31350.78,-873.5 31350.78,-866.5"/>
</g>
<!-- layer9_experts_gpu14 -->
<g id="node307" class="node">
<title>layer9_experts_gpu14</title>
<polygon fill="lightcoral" stroke="black" points="32378.2,-1123.71 32169.2,-1123.71 32169.2,-1049.71 32378.2,-1049.71 32378.2,-1123.71"/>
<text text-anchor="middle" x="32273.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 14</text>
<text text-anchor="middle" x="32273.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="32273.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="32273.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="32273.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="32273.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer9_route_gpu14&#45;&gt;layer9_experts_gpu14 -->
<g id="edge346" class="edge">
<title>layer9_route_gpu14&#45;&gt;layer9_experts_gpu14</title>
<path fill="none" stroke="black" d="M32273.7,-1160.6C32273.7,-1160.6 32273.7,-1133.81 32273.7,-1133.81"/>
<polygon fill="black" stroke="black" points="32277.2,-1133.81 32273.7,-1123.81 32270.2,-1133.81 32277.2,-1133.81"/>
</g>
<!-- layer9_agg_gpu14 -->
<g id="node308" class="node">
<title>layer9_agg_gpu14</title>
<ellipse fill="lightpink" stroke="black" cx="32278.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="32278.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 14</text>
<text text-anchor="middle" x="32278.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="32278.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="32278.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer9_experts_gpu14&#45;&gt;layer9_agg_gpu14 -->
<g id="edge347" class="edge">
<title>layer9_experts_gpu14&#45;&gt;layer9_agg_gpu14</title>
<path fill="none" stroke="black" d="M32273.7,-1049.52C32273.7,-1049.52 32273.7,-1022.85 32273.7,-1022.85"/>
<polygon fill="black" stroke="black" points="32277.2,-1022.85 32273.7,-1012.85 32270.2,-1022.85 32277.2,-1022.85"/>
</g>
<!-- layer9_agg_gpu14&#45;&gt;layer9_moe_agg -->
<g id="edge348" class="edge">
<title>layer9_agg_gpu14&#45;&gt;layer9_moe_agg</title>
<path fill="none" stroke="black" d="M32278.7,-938.95C32278.7,-904.36 32278.7,-858 32278.7,-858 32278.7,-858 31388.77,-858 31388.77,-858"/>
<polygon fill="black" stroke="black" points="31388.77,-854.5 31378.77,-858 31388.77,-861.5 31388.77,-854.5"/>
</g>
<!-- layer9_experts_gpu15 -->
<g id="node310" class="node">
<title>layer9_experts_gpu15</title>
<polygon fill="lightcoral" stroke="black" points="32795.2,-1123.71 32586.2,-1123.71 32586.2,-1049.71 32795.2,-1049.71 32795.2,-1123.71"/>
<text text-anchor="middle" x="32690.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 15</text>
<text text-anchor="middle" x="32690.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="32690.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="32690.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="32690.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="32690.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer9_route_gpu15&#45;&gt;layer9_experts_gpu15 -->
<g id="edge350" class="edge">
<title>layer9_route_gpu15&#45;&gt;layer9_experts_gpu15</title>
<path fill="none" stroke="black" d="M32690.7,-1160.6C32690.7,-1160.6 32690.7,-1133.81 32690.7,-1133.81"/>
<polygon fill="black" stroke="black" points="32694.2,-1133.81 32690.7,-1123.81 32687.2,-1133.81 32694.2,-1133.81"/>
</g>
<!-- layer9_agg_gpu15 -->
<g id="node311" class="node">
<title>layer9_agg_gpu15</title>
<ellipse fill="lightpink" stroke="black" cx="32693.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="32693.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 15</text>
<text text-anchor="middle" x="32693.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="32693.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="32693.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer9_experts_gpu15&#45;&gt;layer9_agg_gpu15 -->
<g id="edge351" class="edge">
<title>layer9_experts_gpu15&#45;&gt;layer9_agg_gpu15</title>
<path fill="none" stroke="black" d="M32690.7,-1049.52C32690.7,-1049.52 32690.7,-1022.85 32690.7,-1022.85"/>
<polygon fill="black" stroke="black" points="32694.2,-1022.85 32690.7,-1012.85 32687.2,-1022.85 32694.2,-1022.85"/>
</g>
<!-- layer9_agg_gpu15&#45;&gt;layer9_moe_agg -->
<g id="edge352" class="edge">
<title>layer9_agg_gpu15&#45;&gt;layer9_moe_agg</title>
<path fill="none" stroke="black" d="M32693.7,-939.12C32693.7,-900.39 32693.7,-845 32693.7,-845 32693.7,-845 31406.3,-845 31406.3,-845"/>
<polygon fill="black" stroke="black" points="31406.3,-841.5 31396.3,-845 31406.3,-848.5 31406.3,-841.5"/>
</g>
<!-- layer10_ln1 -->
<g id="node313" class="node">
<title>layer10_ln1</title>
<polygon fill="none" stroke="black" points="33230.2,-1365.75 32949.2,-1365.75 32949.2,-1302.75 33230.2,-1302.75 33230.2,-1365.75"/>
<text text-anchor="middle" x="33089.7" y="-1353.75" font-family="Arial" font-size="10.00">LayerNorm MHA 10</text>
<text text-anchor="middle" x="33089.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="33089.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="33089.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="33089.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer10_add1 -->
<g id="node314" class="node">
<title>layer10_add1</title>
<polygon fill="yellow" stroke="black" points="34354.2,-728.4 34073.2,-728.4 34073.2,-676.4 34354.2,-676.4 34354.2,-728.4"/>
<text text-anchor="middle" x="34213.7" y="-716.4" font-family="Arial" font-size="10.00">MHA Residual Add 10</text>
<text text-anchor="middle" x="34213.7" y="-705.4" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="34213.7" y="-694.4" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="34213.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer10_moe_output -->
<g id="node318" class="node">
<title>layer10_moe_output</title>
<polygon fill="yellow" stroke="black" points="34435.2,-617.63 34154.2,-617.63 34154.2,-565.63 34435.2,-565.63 34435.2,-617.63"/>
<text text-anchor="middle" x="34294.7" y="-605.63" font-family="Arial" font-size="10.00">MoE Residual Add 10</text>
<text text-anchor="middle" x="34294.7" y="-594.63" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="34294.7" y="-583.63" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="34294.7" y="-572.63" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer10_add1&#45;&gt;layer10_moe_output -->
<g id="edge390" class="edge">
<title>layer10_add1&#45;&gt;layer10_moe_output</title>
<path fill="none" stroke="black" d="M34254.2,-676.15C34254.2,-676.15 34254.2,-627.7 34254.2,-627.7"/>
<polygon fill="black" stroke="black" points="34257.7,-627.7 34254.2,-617.7 34250.7,-627.7 34257.7,-627.7"/>
</g>
<!-- layer10_gate -->
<g id="node315" class="node">
<title>layer10_gate</title>
<polygon fill="lightgreen" stroke="black" points="34853.13,-1397.25 34394.3,-1397.25 34276.26,-1271.25 34735.1,-1271.25 34853.13,-1397.25"/>
<text text-anchor="middle" x="34564.7" y="-1353.75" font-family="Arial" font-size="10.00">Gate Layer 10</text>
<text text-anchor="middle" x="34564.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="34564.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="34564.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="34564.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, num_experts=16]</text>
</g>
<!-- layer10_route_gpu8 -->
<g id="node319" class="node">
<title>layer10_route_gpu8</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="33110.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="33110.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 8</text>
<text text-anchor="middle" x="33110.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="33110.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="33110.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer10_gate&#45;&gt;layer10_route_gpu8 -->
<g id="edge356" class="edge">
<title>layer10_gate&#45;&gt;layer10_route_gpu8</title>
<path fill="none" stroke="black" d="M34296.27,-1293C33916.32,-1293 33267.32,-1293 33267.32,-1293 33267.32,-1293 33267.32,-1229.16 33267.32,-1229.16"/>
<polygon fill="black" stroke="black" points="33270.82,-1229.16 33267.32,-1219.16 33263.82,-1229.16 33270.82,-1229.16"/>
</g>
<!-- layer10_route_gpu9 -->
<g id="node322" class="node">
<title>layer10_route_gpu9</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="33535.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="33535.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 9</text>
<text text-anchor="middle" x="33535.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="33535.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="33535.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer10_gate&#45;&gt;layer10_route_gpu9 -->
<g id="edge360" class="edge">
<title>layer10_gate&#45;&gt;layer10_route_gpu9</title>
<path fill="none" stroke="black" d="M34287.93,-1284C33983.15,-1284 33535.7,-1284 33535.7,-1284 33535.7,-1284 33535.7,-1244.42 33535.7,-1244.42"/>
<polygon fill="black" stroke="black" points="33539.2,-1244.42 33535.7,-1234.42 33532.2,-1244.42 33539.2,-1244.42"/>
</g>
<!-- layer10_route_gpu10 -->
<g id="node325" class="node">
<title>layer10_route_gpu10</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="33950.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="33950.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 10</text>
<text text-anchor="middle" x="33950.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="33950.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="33950.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer10_gate&#45;&gt;layer10_route_gpu10 -->
<g id="edge364" class="edge">
<title>layer10_gate&#45;&gt;layer10_route_gpu10</title>
<path fill="none" stroke="black" d="M34279.72,-1275C34119.24,-1275 33950.7,-1275 33950.7,-1275 33950.7,-1275 33950.7,-1244.42 33950.7,-1244.42"/>
<polygon fill="black" stroke="black" points="33954.2,-1244.42 33950.7,-1234.42 33947.2,-1244.42 33954.2,-1244.42"/>
</g>
<!-- layer10_route_gpu11 -->
<g id="node328" class="node">
<title>layer10_route_gpu11</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="34360.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="34360.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 11</text>
<text text-anchor="middle" x="34360.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="34360.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="34360.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer10_gate&#45;&gt;layer10_route_gpu11 -->
<g id="edge368" class="edge">
<title>layer10_gate&#45;&gt;layer10_route_gpu11</title>
<path fill="none" stroke="black" d="M34415.46,-1271.07C34415.46,-1271.07 34415.46,-1242.78 34415.46,-1242.78"/>
<polygon fill="black" stroke="black" points="34418.96,-1242.78 34415.46,-1232.78 34411.96,-1242.78 34418.96,-1242.78"/>
</g>
<!-- layer10_route_gpu12 -->
<g id="node331" class="node">
<title>layer10_route_gpu12</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="34767.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="34767.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 12</text>
<text text-anchor="middle" x="34767.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="34767.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="34767.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer10_gate&#45;&gt;layer10_route_gpu12 -->
<g id="edge372" class="edge">
<title>layer10_gate&#45;&gt;layer10_route_gpu12</title>
<path fill="none" stroke="black" d="M34713.43,-1271.07C34713.43,-1271.07 34713.43,-1242.78 34713.43,-1242.78"/>
<polygon fill="black" stroke="black" points="34716.93,-1242.78 34713.43,-1232.78 34709.93,-1242.78 34716.93,-1242.78"/>
</g>
<!-- layer10_route_gpu13 -->
<g id="node334" class="node">
<title>layer10_route_gpu13</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="35177.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="35177.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 13</text>
<text text-anchor="middle" x="35177.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="35177.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="35177.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer10_gate&#45;&gt;layer10_route_gpu13 -->
<g id="edge376" class="edge">
<title>layer10_gate&#45;&gt;layer10_route_gpu13</title>
<path fill="none" stroke="black" d="M34743.65,-1280C34924.59,-1280 35177.7,-1280 35177.7,-1280 35177.7,-1280 35177.7,-1244.4 35177.7,-1244.4"/>
<polygon fill="black" stroke="black" points="35181.2,-1244.4 35177.7,-1234.4 35174.2,-1244.4 35181.2,-1244.4"/>
</g>
<!-- layer10_route_gpu14 -->
<g id="node337" class="node">
<title>layer10_route_gpu14</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="35584.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="35584.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 14</text>
<text text-anchor="middle" x="35584.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="35584.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="35584.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer10_gate&#45;&gt;layer10_route_gpu14 -->
<g id="edge380" class="edge">
<title>layer10_gate&#45;&gt;layer10_route_gpu14</title>
<path fill="none" stroke="black" d="M34747.05,-1284C35040.44,-1284 35584.7,-1284 35584.7,-1284 35584.7,-1284 35584.7,-1244.42 35584.7,-1244.42"/>
<polygon fill="black" stroke="black" points="35588.2,-1244.42 35584.7,-1234.42 35581.2,-1244.42 35588.2,-1244.42"/>
</g>
<!-- layer10_route_gpu15 -->
<g id="node340" class="node">
<title>layer10_route_gpu15</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="36000.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="36000.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 15</text>
<text text-anchor="middle" x="36000.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="36000.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="36000.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer10_gate&#45;&gt;layer10_route_gpu15 -->
<g id="edge384" class="edge">
<title>layer10_gate&#45;&gt;layer10_route_gpu15</title>
<path fill="none" stroke="black" d="M34755.68,-1293C35134.79,-1293 35946.07,-1293 35946.07,-1293 35946.07,-1293 35946.07,-1242.78 35946.07,-1242.78"/>
<polygon fill="black" stroke="black" points="35949.57,-1242.78 35946.07,-1232.78 35942.57,-1242.78 35949.57,-1242.78"/>
</g>
<!-- layer10_moe_agg -->
<g id="node316" class="node">
<title>layer10_moe_agg</title>
<ellipse fill="gold" stroke="black" cx="34512.7" cy="-839.17" rx="205.12" ry="44.6"/>
<text text-anchor="middle" x="34512.7" y="-858.67" font-family="Arial" font-size="10.00">MoE Final Aggregation 10</text>
<text text-anchor="middle" x="34512.7" y="-847.67" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="34512.7" y="-836.67" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="34512.7" y="-825.67" font-family="Arial" font-size="10.00">Input: 16Ã—[batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="34512.7" y="-814.67" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer10_ln2 -->
<g id="node317" class="node">
<title>layer10_ln2</title>
<polygon fill="none" stroke="black" points="34653.2,-733.9 34372.2,-733.9 34372.2,-670.9 34653.2,-670.9 34653.2,-733.9"/>
<text text-anchor="middle" x="34512.7" y="-721.9" font-family="Arial" font-size="10.00">LayerNorm MoE 10</text>
<text text-anchor="middle" x="34512.7" y="-710.9" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="34512.7" y="-699.9" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="34512.7" y="-688.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="34512.7" y="-677.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer10_moe_agg&#45;&gt;layer10_ln2 -->
<g id="edge388" class="edge">
<title>layer10_moe_agg&#45;&gt;layer10_ln2</title>
<path fill="none" stroke="black" d="M34512.7,-794.39C34512.7,-794.39 34512.7,-744.29 34512.7,-744.29"/>
<polygon fill="black" stroke="black" points="34516.2,-744.29 34512.7,-734.29 34509.2,-744.29 34516.2,-744.29"/>
</g>
<!-- layer10_ln2&#45;&gt;layer10_moe_output -->
<g id="edge389" class="edge">
<title>layer10_ln2&#45;&gt;layer10_moe_output</title>
<path fill="none" stroke="black" d="M34403.7,-670.66C34403.7,-670.66 34403.7,-627.78 34403.7,-627.78"/>
<polygon fill="black" stroke="black" points="34407.2,-627.78 34403.7,-617.78 34400.2,-627.78 34407.2,-627.78"/>
</g>
<!-- layer11_mha -->
<g id="node343" class="node">
<title>layer11_mha</title>
<polygon fill="lightcyan" stroke="black" points="34435.2,-483.37 34154.2,-483.37 34154.2,-420.37 34435.2,-420.37 34435.2,-483.37"/>
<text text-anchor="middle" x="34294.7" y="-471.37" font-family="Arial" font-size="10.00">MHA Layer 11</text>
<text text-anchor="middle" x="34294.7" y="-460.37" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="34294.7" y="-449.37" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="34294.7" y="-438.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="34294.7" y="-427.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer10_moe_output&#45;&gt;layer11_mha -->
<g id="edge576" class="edge">
<title>layer10_moe_output&#45;&gt;layer11_mha</title>
<path fill="none" stroke="black" d="M34294.7,-565.34C34294.7,-565.34 34294.7,-493.42 34294.7,-493.42"/>
<polygon fill="black" stroke="black" points="34298.2,-493.42 34294.7,-483.42 34291.2,-493.42 34298.2,-493.42"/>
</g>
<!-- layer10_experts_gpu8 -->
<g id="node320" class="node">
<title>layer10_experts_gpu8</title>
<polygon fill="lightcoral" stroke="black" points="33214.2,-1123.71 33005.2,-1123.71 33005.2,-1049.71 33214.2,-1049.71 33214.2,-1123.71"/>
<text text-anchor="middle" x="33109.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 8</text>
<text text-anchor="middle" x="33109.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="33109.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="33109.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="33109.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="33109.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer10_route_gpu8&#45;&gt;layer10_experts_gpu8 -->
<g id="edge357" class="edge">
<title>layer10_route_gpu8&#45;&gt;layer10_experts_gpu8</title>
<path fill="none" stroke="black" d="M33109.7,-1160.6C33109.7,-1160.6 33109.7,-1133.81 33109.7,-1133.81"/>
<polygon fill="black" stroke="black" points="33113.2,-1133.81 33109.7,-1123.81 33106.2,-1133.81 33113.2,-1133.81"/>
</g>
<!-- layer10_agg_gpu8 -->
<g id="node321" class="node">
<title>layer10_agg_gpu8</title>
<ellipse fill="lightpink" stroke="black" cx="33108.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="33108.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 8</text>
<text text-anchor="middle" x="33108.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="33108.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="33108.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer10_experts_gpu8&#45;&gt;layer10_agg_gpu8 -->
<g id="edge358" class="edge">
<title>layer10_experts_gpu8&#45;&gt;layer10_agg_gpu8</title>
<path fill="none" stroke="black" d="M33109.7,-1049.52C33109.7,-1049.52 33109.7,-1022.85 33109.7,-1022.85"/>
<polygon fill="black" stroke="black" points="33113.2,-1022.85 33109.7,-1012.85 33106.2,-1022.85 33113.2,-1022.85"/>
</g>
<!-- layer10_agg_gpu8&#45;&gt;layer10_moe_agg -->
<g id="edge359" class="edge">
<title>layer10_agg_gpu8&#45;&gt;layer10_moe_agg</title>
<path fill="none" stroke="black" d="M33108.7,-938.87C33108.7,-889.14 33108.7,-807 33108.7,-807 33108.7,-807 34360.67,-807 34360.67,-807"/>
<polygon fill="black" stroke="black" points="34360.67,-810.5 34370.67,-807 34360.67,-803.5 34360.67,-810.5"/>
</g>
<!-- layer10_experts_gpu9 -->
<g id="node323" class="node">
<title>layer10_experts_gpu9</title>
<polygon fill="lightcoral" stroke="black" points="33635.2,-1123.71 33426.2,-1123.71 33426.2,-1049.71 33635.2,-1049.71 33635.2,-1123.71"/>
<text text-anchor="middle" x="33530.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 9</text>
<text text-anchor="middle" x="33530.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="33530.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="33530.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="33530.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="33530.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer10_route_gpu9&#45;&gt;layer10_experts_gpu9 -->
<g id="edge361" class="edge">
<title>layer10_route_gpu9&#45;&gt;layer10_experts_gpu9</title>
<path fill="none" stroke="black" d="M33530.7,-1160.6C33530.7,-1160.6 33530.7,-1133.81 33530.7,-1133.81"/>
<polygon fill="black" stroke="black" points="33534.2,-1133.81 33530.7,-1123.81 33527.2,-1133.81 33534.2,-1133.81"/>
</g>
<!-- layer10_agg_gpu9 -->
<g id="node324" class="node">
<title>layer10_agg_gpu9</title>
<ellipse fill="lightpink" stroke="black" cx="33523.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="33523.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 9</text>
<text text-anchor="middle" x="33523.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="33523.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="33523.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer10_experts_gpu9&#45;&gt;layer10_agg_gpu9 -->
<g id="edge362" class="edge">
<title>layer10_experts_gpu9&#45;&gt;layer10_agg_gpu9</title>
<path fill="none" stroke="black" d="M33530.7,-1049.52C33530.7,-1049.52 33530.7,-1022.85 33530.7,-1022.85"/>
<polygon fill="black" stroke="black" points="33534.2,-1022.85 33530.7,-1012.85 33527.2,-1022.85 33534.2,-1022.85"/>
</g>
<!-- layer10_agg_gpu9&#45;&gt;layer10_moe_agg -->
<g id="edge363" class="edge">
<title>layer10_agg_gpu9&#45;&gt;layer10_moe_agg</title>
<path fill="none" stroke="black" d="M33523.7,-938.99C33523.7,-892.87 33523.7,-820 33523.7,-820 33523.7,-820 34317.54,-820 34317.54,-820"/>
<polygon fill="black" stroke="black" points="34317.54,-823.5 34327.54,-820 34317.54,-816.5 34317.54,-823.5"/>
</g>
<!-- layer10_experts_gpu10 -->
<g id="node326" class="node">
<title>layer10_experts_gpu10</title>
<polygon fill="lightcoral" stroke="black" points="34050.2,-1123.71 33841.2,-1123.71 33841.2,-1049.71 34050.2,-1049.71 34050.2,-1123.71"/>
<text text-anchor="middle" x="33945.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 10</text>
<text text-anchor="middle" x="33945.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="33945.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="33945.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="33945.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="33945.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer10_route_gpu10&#45;&gt;layer10_experts_gpu10 -->
<g id="edge365" class="edge">
<title>layer10_route_gpu10&#45;&gt;layer10_experts_gpu10</title>
<path fill="none" stroke="black" d="M33945.7,-1160.6C33945.7,-1160.6 33945.7,-1133.81 33945.7,-1133.81"/>
<polygon fill="black" stroke="black" points="33949.2,-1133.81 33945.7,-1123.81 33942.2,-1133.81 33949.2,-1133.81"/>
</g>
<!-- layer10_agg_gpu10 -->
<g id="node327" class="node">
<title>layer10_agg_gpu10</title>
<ellipse fill="lightpink" stroke="black" cx="33938.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="33938.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 10</text>
<text text-anchor="middle" x="33938.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="33938.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="33938.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer10_experts_gpu10&#45;&gt;layer10_agg_gpu10 -->
<g id="edge366" class="edge">
<title>layer10_experts_gpu10&#45;&gt;layer10_agg_gpu10</title>
<path fill="none" stroke="black" d="M33945.7,-1049.52C33945.7,-1049.52 33945.7,-1022.85 33945.7,-1022.85"/>
<polygon fill="black" stroke="black" points="33949.2,-1022.85 33945.7,-1012.85 33942.2,-1022.85 33949.2,-1022.85"/>
</g>
<!-- layer10_agg_gpu10&#45;&gt;layer10_moe_agg -->
<g id="edge367" class="edge">
<title>layer10_agg_gpu10&#45;&gt;layer10_moe_agg</title>
<path fill="none" stroke="black" d="M34105.3,-955.62C34105.3,-915.95 34105.3,-832 34105.3,-832 34105.3,-832 34300.19,-832 34300.19,-832"/>
<polygon fill="black" stroke="black" points="34300.19,-835.5 34310.19,-832 34300.19,-828.5 34300.19,-835.5"/>
</g>
<!-- layer10_experts_gpu11 -->
<g id="node329" class="node">
<title>layer10_experts_gpu11</title>
<polygon fill="lightcoral" stroke="black" points="34461.2,-1123.71 34252.2,-1123.71 34252.2,-1049.71 34461.2,-1049.71 34461.2,-1123.71"/>
<text text-anchor="middle" x="34356.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 11</text>
<text text-anchor="middle" x="34356.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="34356.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="34356.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="34356.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="34356.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer10_route_gpu11&#45;&gt;layer10_experts_gpu11 -->
<g id="edge369" class="edge">
<title>layer10_route_gpu11&#45;&gt;layer10_experts_gpu11</title>
<path fill="none" stroke="black" d="M34356.7,-1160.6C34356.7,-1160.6 34356.7,-1133.81 34356.7,-1133.81"/>
<polygon fill="black" stroke="black" points="34360.2,-1133.81 34356.7,-1123.81 34353.2,-1133.81 34360.2,-1133.81"/>
</g>
<!-- layer10_agg_gpu11 -->
<g id="node330" class="node">
<title>layer10_agg_gpu11</title>
<ellipse fill="lightpink" stroke="black" cx="34353.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="34353.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 11</text>
<text text-anchor="middle" x="34353.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="34353.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="34353.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer10_experts_gpu11&#45;&gt;layer10_agg_gpu11 -->
<g id="edge370" class="edge">
<title>layer10_experts_gpu11&#45;&gt;layer10_agg_gpu11</title>
<path fill="none" stroke="black" d="M34356.7,-1049.52C34356.7,-1049.52 34356.7,-1022.85 34356.7,-1022.85"/>
<polygon fill="black" stroke="black" points="34360.2,-1022.85 34356.7,-1012.85 34353.2,-1022.85 34360.2,-1022.85"/>
</g>
<!-- layer10_agg_gpu11&#45;&gt;layer10_moe_agg -->
<g id="edge371" class="edge">
<title>layer10_agg_gpu11&#45;&gt;layer10_moe_agg</title>
<path fill="none" stroke="black" d="M34430.02,-941.78C34430.02,-941.78 34430.02,-890.2 34430.02,-890.2"/>
<polygon fill="black" stroke="black" points="34433.52,-890.2 34430.02,-880.2 34426.52,-890.2 34433.52,-890.2"/>
</g>
<!-- layer10_experts_gpu12 -->
<g id="node332" class="node">
<title>layer10_experts_gpu12</title>
<polygon fill="lightcoral" stroke="black" points="34872.2,-1123.71 34663.2,-1123.71 34663.2,-1049.71 34872.2,-1049.71 34872.2,-1123.71"/>
<text text-anchor="middle" x="34767.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 12</text>
<text text-anchor="middle" x="34767.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="34767.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="34767.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="34767.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="34767.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer10_route_gpu12&#45;&gt;layer10_experts_gpu12 -->
<g id="edge373" class="edge">
<title>layer10_route_gpu12&#45;&gt;layer10_experts_gpu12</title>
<path fill="none" stroke="black" d="M34767.7,-1160.6C34767.7,-1160.6 34767.7,-1133.81 34767.7,-1133.81"/>
<polygon fill="black" stroke="black" points="34771.2,-1133.81 34767.7,-1123.81 34764.2,-1133.81 34771.2,-1133.81"/>
</g>
<!-- layer10_agg_gpu12 -->
<g id="node333" class="node">
<title>layer10_agg_gpu12</title>
<ellipse fill="lightpink" stroke="black" cx="34768.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="34768.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 12</text>
<text text-anchor="middle" x="34768.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="34768.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="34768.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer10_experts_gpu12&#45;&gt;layer10_agg_gpu12 -->
<g id="edge374" class="edge">
<title>layer10_experts_gpu12&#45;&gt;layer10_agg_gpu12</title>
<path fill="none" stroke="black" d="M34767.7,-1049.52C34767.7,-1049.52 34767.7,-1022.85 34767.7,-1022.85"/>
<polygon fill="black" stroke="black" points="34771.2,-1022.85 34767.7,-1012.85 34764.2,-1022.85 34771.2,-1022.85"/>
</g>
<!-- layer10_agg_gpu12&#45;&gt;layer10_moe_agg -->
<g id="edge375" class="edge">
<title>layer10_agg_gpu12&#45;&gt;layer10_moe_agg</title>
<path fill="none" stroke="black" d="M34643.88,-947.27C34643.88,-947.27 34643.88,-883.62 34643.88,-883.62"/>
<polygon fill="black" stroke="black" points="34647.38,-883.62 34643.88,-873.62 34640.38,-883.62 34647.38,-883.62"/>
</g>
<!-- layer10_experts_gpu13 -->
<g id="node335" class="node">
<title>layer10_experts_gpu13</title>
<polygon fill="lightcoral" stroke="black" points="35286.2,-1123.71 35077.2,-1123.71 35077.2,-1049.71 35286.2,-1049.71 35286.2,-1123.71"/>
<text text-anchor="middle" x="35181.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 13</text>
<text text-anchor="middle" x="35181.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="35181.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="35181.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="35181.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="35181.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer10_route_gpu13&#45;&gt;layer10_experts_gpu13 -->
<g id="edge377" class="edge">
<title>layer10_route_gpu13&#45;&gt;layer10_experts_gpu13</title>
<path fill="none" stroke="black" d="M35181.7,-1160.6C35181.7,-1160.6 35181.7,-1133.81 35181.7,-1133.81"/>
<polygon fill="black" stroke="black" points="35185.2,-1133.81 35181.7,-1123.81 35178.2,-1133.81 35185.2,-1133.81"/>
</g>
<!-- layer10_agg_gpu13 -->
<g id="node336" class="node">
<title>layer10_agg_gpu13</title>
<ellipse fill="lightpink" stroke="black" cx="35183.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="35183.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 13</text>
<text text-anchor="middle" x="35183.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="35183.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="35183.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer10_experts_gpu13&#45;&gt;layer10_agg_gpu13 -->
<g id="edge378" class="edge">
<title>layer10_experts_gpu13&#45;&gt;layer10_agg_gpu13</title>
<path fill="none" stroke="black" d="M35181.7,-1049.52C35181.7,-1049.52 35181.7,-1022.85 35181.7,-1022.85"/>
<polygon fill="black" stroke="black" points="35185.2,-1022.85 35181.7,-1012.85 35178.2,-1022.85 35185.2,-1022.85"/>
</g>
<!-- layer10_agg_gpu13&#45;&gt;layer10_moe_agg -->
<g id="edge379" class="edge">
<title>layer10_agg_gpu13&#45;&gt;layer10_moe_agg</title>
<path fill="none" stroke="black" d="M35183.7,-938.89C35183.7,-908.34 35183.7,-870 35183.7,-870 35183.7,-870 34670.78,-870 34670.78,-870"/>
<polygon fill="black" stroke="black" points="34670.78,-866.5 34660.78,-870 34670.78,-873.5 34670.78,-866.5"/>
</g>
<!-- layer10_experts_gpu14 -->
<g id="node338" class="node">
<title>layer10_experts_gpu14</title>
<polygon fill="lightcoral" stroke="black" points="35692.2,-1123.71 35483.2,-1123.71 35483.2,-1049.71 35692.2,-1049.71 35692.2,-1123.71"/>
<text text-anchor="middle" x="35587.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 14</text>
<text text-anchor="middle" x="35587.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="35587.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="35587.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="35587.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="35587.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer10_route_gpu14&#45;&gt;layer10_experts_gpu14 -->
<g id="edge381" class="edge">
<title>layer10_route_gpu14&#45;&gt;layer10_experts_gpu14</title>
<path fill="none" stroke="black" d="M35587.7,-1160.6C35587.7,-1160.6 35587.7,-1133.81 35587.7,-1133.81"/>
<polygon fill="black" stroke="black" points="35591.2,-1133.81 35587.7,-1123.81 35584.2,-1133.81 35591.2,-1133.81"/>
</g>
<!-- layer10_agg_gpu14 -->
<g id="node339" class="node">
<title>layer10_agg_gpu14</title>
<ellipse fill="lightpink" stroke="black" cx="35598.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="35598.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 14</text>
<text text-anchor="middle" x="35598.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="35598.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="35598.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer10_experts_gpu14&#45;&gt;layer10_agg_gpu14 -->
<g id="edge382" class="edge">
<title>layer10_experts_gpu14&#45;&gt;layer10_agg_gpu14</title>
<path fill="none" stroke="black" d="M35587.7,-1049.52C35587.7,-1049.52 35587.7,-1022.85 35587.7,-1022.85"/>
<polygon fill="black" stroke="black" points="35591.2,-1022.85 35587.7,-1012.85 35584.2,-1022.85 35591.2,-1022.85"/>
</g>
<!-- layer10_agg_gpu14&#45;&gt;layer10_moe_agg -->
<g id="edge383" class="edge">
<title>layer10_agg_gpu14&#45;&gt;layer10_moe_agg</title>
<path fill="none" stroke="black" d="M35598.7,-938.95C35598.7,-904.36 35598.7,-858 35598.7,-858 35598.7,-858 34708.77,-858 34708.77,-858"/>
<polygon fill="black" stroke="black" points="34708.77,-854.5 34698.77,-858 34708.77,-861.5 34708.77,-854.5"/>
</g>
<!-- layer10_experts_gpu15 -->
<g id="node341" class="node">
<title>layer10_experts_gpu15</title>
<polygon fill="lightcoral" stroke="black" points="36113.2,-1123.71 35904.2,-1123.71 35904.2,-1049.71 36113.2,-1049.71 36113.2,-1123.71"/>
<text text-anchor="middle" x="36008.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 15</text>
<text text-anchor="middle" x="36008.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="36008.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="36008.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="36008.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="36008.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer10_route_gpu15&#45;&gt;layer10_experts_gpu15 -->
<g id="edge385" class="edge">
<title>layer10_route_gpu15&#45;&gt;layer10_experts_gpu15</title>
<path fill="none" stroke="black" d="M36008.7,-1160.6C36008.7,-1160.6 36008.7,-1133.81 36008.7,-1133.81"/>
<polygon fill="black" stroke="black" points="36012.2,-1133.81 36008.7,-1123.81 36005.2,-1133.81 36012.2,-1133.81"/>
</g>
<!-- layer10_agg_gpu15 -->
<g id="node342" class="node">
<title>layer10_agg_gpu15</title>
<ellipse fill="lightpink" stroke="black" cx="36013.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="36013.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 15</text>
<text text-anchor="middle" x="36013.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="36013.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="36013.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer10_experts_gpu15&#45;&gt;layer10_agg_gpu15 -->
<g id="edge386" class="edge">
<title>layer10_experts_gpu15&#45;&gt;layer10_agg_gpu15</title>
<path fill="none" stroke="black" d="M36008.7,-1049.52C36008.7,-1049.52 36008.7,-1022.85 36008.7,-1022.85"/>
<polygon fill="black" stroke="black" points="36012.2,-1022.85 36008.7,-1012.85 36005.2,-1022.85 36012.2,-1022.85"/>
</g>
<!-- layer10_agg_gpu15&#45;&gt;layer10_moe_agg -->
<g id="edge387" class="edge">
<title>layer10_agg_gpu15&#45;&gt;layer10_moe_agg</title>
<path fill="none" stroke="black" d="M36013.7,-939.12C36013.7,-900.39 36013.7,-845 36013.7,-845 36013.7,-845 34726.3,-845 34726.3,-845"/>
<polygon fill="black" stroke="black" points="34726.3,-841.5 34716.3,-845 34726.3,-848.5 34726.3,-841.5"/>
</g>
<!-- layer11_ln1 -->
<g id="node344" class="node">
<title>layer11_ln1</title>
<polygon fill="none" stroke="black" points="36366.2,-1365.75 36085.2,-1365.75 36085.2,-1302.75 36366.2,-1302.75 36366.2,-1365.75"/>
<text text-anchor="middle" x="36225.7" y="-1353.75" font-family="Arial" font-size="10.00">LayerNorm MHA 11</text>
<text text-anchor="middle" x="36225.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="36225.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="36225.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="36225.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer11_add1 -->
<g id="node345" class="node">
<title>layer11_add1</title>
<polygon fill="yellow" stroke="black" points="37722.2,-728.4 37441.2,-728.4 37441.2,-676.4 37722.2,-676.4 37722.2,-728.4"/>
<text text-anchor="middle" x="37581.7" y="-716.4" font-family="Arial" font-size="10.00">MHA Residual Add 11</text>
<text text-anchor="middle" x="37581.7" y="-705.4" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="37581.7" y="-694.4" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="37581.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer11_moe_output -->
<g id="node349" class="node">
<title>layer11_moe_output</title>
<polygon fill="yellow" stroke="black" points="37803.2,-617.63 37522.2,-617.63 37522.2,-565.63 37803.2,-565.63 37803.2,-617.63"/>
<text text-anchor="middle" x="37662.7" y="-605.63" font-family="Arial" font-size="10.00">MoE Residual Add 11</text>
<text text-anchor="middle" x="37662.7" y="-594.63" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="37662.7" y="-583.63" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="37662.7" y="-572.63" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer11_add1&#45;&gt;layer11_moe_output -->
<g id="edge425" class="edge">
<title>layer11_add1&#45;&gt;layer11_moe_output</title>
<path fill="none" stroke="black" d="M37622.2,-676.15C37622.2,-676.15 37622.2,-627.7 37622.2,-627.7"/>
<polygon fill="black" stroke="black" points="37625.7,-627.7 37622.2,-617.7 37618.7,-627.7 37625.7,-627.7"/>
</g>
<!-- layer11_gate -->
<g id="node346" class="node">
<title>layer11_gate</title>
<polygon fill="lightgreen" stroke="black" points="38169.13,-1397.25 37710.3,-1397.25 37592.26,-1271.25 38051.1,-1271.25 38169.13,-1397.25"/>
<text text-anchor="middle" x="37880.7" y="-1353.75" font-family="Arial" font-size="10.00">Gate Layer 11</text>
<text text-anchor="middle" x="37880.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="37880.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="37880.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="37880.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, num_experts=16]</text>
</g>
<!-- layer11_route_gpu8 -->
<g id="node350" class="node">
<title>layer11_route_gpu8</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="36444.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="36444.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 8</text>
<text text-anchor="middle" x="36444.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="36444.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="36444.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer11_gate&#45;&gt;layer11_route_gpu8 -->
<g id="edge391" class="edge">
<title>layer11_gate&#45;&gt;layer11_route_gpu8</title>
<path fill="none" stroke="black" d="M37616.97,-1298C37216.81,-1298 36502.32,-1298 36502.32,-1298 36502.32,-1298 36502.32,-1242.64 36502.32,-1242.64"/>
<polygon fill="black" stroke="black" points="36505.82,-1242.64 36502.32,-1232.64 36498.82,-1242.64 36505.82,-1242.64"/>
</g>
<!-- layer11_route_gpu9 -->
<g id="node353" class="node">
<title>layer11_route_gpu9</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="36859.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="36859.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 9</text>
<text text-anchor="middle" x="36859.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="36859.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="36859.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer11_gate&#45;&gt;layer11_route_gpu9 -->
<g id="edge395" class="edge">
<title>layer11_gate&#45;&gt;layer11_route_gpu9</title>
<path fill="none" stroke="black" d="M37608.76,-1289C37306.3,-1289 36859.7,-1289 36859.7,-1289 36859.7,-1289 36859.7,-1244.44 36859.7,-1244.44"/>
<polygon fill="black" stroke="black" points="36863.2,-1244.44 36859.7,-1234.44 36856.2,-1244.44 36863.2,-1244.44"/>
</g>
<!-- layer11_route_gpu10 -->
<g id="node356" class="node">
<title>layer11_route_gpu10</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="37269.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="37269.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 10</text>
<text text-anchor="middle" x="37269.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="37269.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="37269.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer11_gate&#45;&gt;layer11_route_gpu10 -->
<g id="edge399" class="edge">
<title>layer11_gate&#45;&gt;layer11_route_gpu10</title>
<path fill="none" stroke="black" d="M37595.77,-1275C37436.48,-1275 37269.7,-1275 37269.7,-1275 37269.7,-1275 37269.7,-1244.42 37269.7,-1244.42"/>
<polygon fill="black" stroke="black" points="37273.2,-1244.42 37269.7,-1234.42 37266.2,-1244.42 37273.2,-1244.42"/>
</g>
<!-- layer11_route_gpu11 -->
<g id="node359" class="node">
<title>layer11_route_gpu11</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="37675.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="37675.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 11</text>
<text text-anchor="middle" x="37675.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="37675.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="37675.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer11_gate&#45;&gt;layer11_route_gpu11 -->
<g id="edge403" class="edge">
<title>layer11_gate&#45;&gt;layer11_route_gpu11</title>
<path fill="none" stroke="black" d="M37730.96,-1271.07C37730.96,-1271.07 37730.96,-1242.78 37730.96,-1242.78"/>
<polygon fill="black" stroke="black" points="37734.46,-1242.78 37730.96,-1232.78 37727.46,-1242.78 37734.46,-1242.78"/>
</g>
<!-- layer11_route_gpu12 -->
<g id="node362" class="node">
<title>layer11_route_gpu12</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="38085.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="38085.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 12</text>
<text text-anchor="middle" x="38085.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="38085.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="38085.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer11_gate&#45;&gt;layer11_route_gpu12 -->
<g id="edge407" class="edge">
<title>layer11_gate&#45;&gt;layer11_route_gpu12</title>
<path fill="none" stroke="black" d="M38030.43,-1271.07C38030.43,-1271.07 38030.43,-1242.78 38030.43,-1242.78"/>
<polygon fill="black" stroke="black" points="38033.93,-1242.78 38030.43,-1232.78 38026.93,-1242.78 38033.93,-1242.78"/>
</g>
<!-- layer11_route_gpu13 -->
<g id="node365" class="node">
<title>layer11_route_gpu13</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="38493.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="38493.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 13</text>
<text text-anchor="middle" x="38493.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="38493.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="38493.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer11_gate&#45;&gt;layer11_route_gpu13 -->
<g id="edge411" class="edge">
<title>layer11_gate&#45;&gt;layer11_route_gpu13</title>
<path fill="none" stroke="black" d="M38054.72,-1275C38235.95,-1275 38493.7,-1275 38493.7,-1275 38493.7,-1275 38493.7,-1244.42 38493.7,-1244.42"/>
<polygon fill="black" stroke="black" points="38497.2,-1244.42 38493.7,-1234.42 38490.2,-1244.42 38497.2,-1244.42"/>
</g>
<!-- layer11_route_gpu14 -->
<g id="node368" class="node">
<title>layer11_route_gpu14</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="38899.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="38899.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 14</text>
<text text-anchor="middle" x="38899.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="38899.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="38899.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer11_gate&#45;&gt;layer11_route_gpu14 -->
<g id="edge415" class="edge">
<title>layer11_gate&#45;&gt;layer11_route_gpu14</title>
<path fill="none" stroke="black" d="M38063.17,-1284C38356.34,-1284 38899.7,-1284 38899.7,-1284 38899.7,-1284 38899.7,-1244.42 38899.7,-1244.42"/>
<polygon fill="black" stroke="black" points="38903.2,-1244.42 38899.7,-1234.42 38896.2,-1244.42 38903.2,-1244.42"/>
</g>
<!-- layer11_route_gpu15 -->
<g id="node371" class="node">
<title>layer11_route_gpu15</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="39310.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="39310.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 15</text>
<text text-anchor="middle" x="39310.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="39310.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="39310.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer11_gate&#45;&gt;layer11_route_gpu15 -->
<g id="edge419" class="edge">
<title>layer11_gate&#45;&gt;layer11_route_gpu15</title>
<path fill="none" stroke="black" d="M38071.65,-1293C38449.55,-1293 39256.57,-1293 39256.57,-1293 39256.57,-1293 39256.57,-1243.05 39256.57,-1243.05"/>
<polygon fill="black" stroke="black" points="39260.07,-1243.05 39256.57,-1233.05 39253.07,-1243.05 39260.07,-1243.05"/>
</g>
<!-- layer11_moe_agg -->
<g id="node347" class="node">
<title>layer11_moe_agg</title>
<ellipse fill="gold" stroke="black" cx="37880.7" cy="-839.17" rx="205.12" ry="44.6"/>
<text text-anchor="middle" x="37880.7" y="-858.67" font-family="Arial" font-size="10.00">MoE Final Aggregation 11</text>
<text text-anchor="middle" x="37880.7" y="-847.67" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="37880.7" y="-836.67" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="37880.7" y="-825.67" font-family="Arial" font-size="10.00">Input: 16Ã—[batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="37880.7" y="-814.67" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer11_ln2 -->
<g id="node348" class="node">
<title>layer11_ln2</title>
<polygon fill="none" stroke="black" points="38021.2,-733.9 37740.2,-733.9 37740.2,-670.9 38021.2,-670.9 38021.2,-733.9"/>
<text text-anchor="middle" x="37880.7" y="-721.9" font-family="Arial" font-size="10.00">LayerNorm MoE 11</text>
<text text-anchor="middle" x="37880.7" y="-710.9" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="37880.7" y="-699.9" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="37880.7" y="-688.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="37880.7" y="-677.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer11_moe_agg&#45;&gt;layer11_ln2 -->
<g id="edge423" class="edge">
<title>layer11_moe_agg&#45;&gt;layer11_ln2</title>
<path fill="none" stroke="black" d="M37880.7,-794.39C37880.7,-794.39 37880.7,-744.29 37880.7,-744.29"/>
<polygon fill="black" stroke="black" points="37884.2,-744.29 37880.7,-734.29 37877.2,-744.29 37884.2,-744.29"/>
</g>
<!-- layer11_ln2&#45;&gt;layer11_moe_output -->
<g id="edge424" class="edge">
<title>layer11_ln2&#45;&gt;layer11_moe_output</title>
<path fill="none" stroke="black" d="M37771.7,-670.66C37771.7,-670.66 37771.7,-627.78 37771.7,-627.78"/>
<polygon fill="black" stroke="black" points="37775.2,-627.78 37771.7,-617.78 37768.2,-627.78 37775.2,-627.78"/>
</g>
<!-- layer12_mha -->
<g id="node374" class="node">
<title>layer12_mha</title>
<polygon fill="lightcyan" stroke="black" points="37803.2,-483.37 37522.2,-483.37 37522.2,-420.37 37803.2,-420.37 37803.2,-483.37"/>
<text text-anchor="middle" x="37662.7" y="-471.37" font-family="Arial" font-size="10.00">MHA Layer 12</text>
<text text-anchor="middle" x="37662.7" y="-460.37" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="37662.7" y="-449.37" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="37662.7" y="-438.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="37662.7" y="-427.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer11_moe_output&#45;&gt;layer12_mha -->
<g id="edge577" class="edge">
<title>layer11_moe_output&#45;&gt;layer12_mha</title>
<path fill="none" stroke="black" d="M37662.7,-565.34C37662.7,-565.34 37662.7,-493.42 37662.7,-493.42"/>
<polygon fill="black" stroke="black" points="37666.2,-493.42 37662.7,-483.42 37659.2,-493.42 37666.2,-493.42"/>
</g>
<!-- layer11_experts_gpu8 -->
<g id="node351" class="node">
<title>layer11_experts_gpu8</title>
<polygon fill="lightcoral" stroke="black" points="36542.2,-1123.71 36333.2,-1123.71 36333.2,-1049.71 36542.2,-1049.71 36542.2,-1123.71"/>
<text text-anchor="middle" x="36437.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 8</text>
<text text-anchor="middle" x="36437.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="36437.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="36437.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="36437.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="36437.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer11_route_gpu8&#45;&gt;layer11_experts_gpu8 -->
<g id="edge392" class="edge">
<title>layer11_route_gpu8&#45;&gt;layer11_experts_gpu8</title>
<path fill="none" stroke="black" d="M36437.7,-1160.6C36437.7,-1160.6 36437.7,-1133.81 36437.7,-1133.81"/>
<polygon fill="black" stroke="black" points="36441.2,-1133.81 36437.7,-1123.81 36434.2,-1133.81 36441.2,-1133.81"/>
</g>
<!-- layer11_agg_gpu8 -->
<g id="node352" class="node">
<title>layer11_agg_gpu8</title>
<ellipse fill="lightpink" stroke="black" cx="36428.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="36428.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 8</text>
<text text-anchor="middle" x="36428.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="36428.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="36428.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer11_experts_gpu8&#45;&gt;layer11_agg_gpu8 -->
<g id="edge393" class="edge">
<title>layer11_experts_gpu8&#45;&gt;layer11_agg_gpu8</title>
<path fill="none" stroke="black" d="M36437.7,-1049.52C36437.7,-1049.52 36437.7,-1022.85 36437.7,-1022.85"/>
<polygon fill="black" stroke="black" points="36441.2,-1022.85 36437.7,-1012.85 36434.2,-1022.85 36441.2,-1022.85"/>
</g>
<!-- layer11_agg_gpu8&#45;&gt;layer11_moe_agg -->
<g id="edge394" class="edge">
<title>layer11_agg_gpu8&#45;&gt;layer11_moe_agg</title>
<path fill="none" stroke="black" d="M36428.7,-938.87C36428.7,-889.14 36428.7,-807 36428.7,-807 36428.7,-807 37728.83,-807 37728.83,-807"/>
<polygon fill="black" stroke="black" points="37728.83,-810.5 37738.83,-807 37728.83,-803.5 37728.83,-810.5"/>
</g>
<!-- layer11_experts_gpu9 -->
<g id="node354" class="node">
<title>layer11_experts_gpu9</title>
<polygon fill="lightcoral" stroke="black" points="36956.2,-1123.71 36747.2,-1123.71 36747.2,-1049.71 36956.2,-1049.71 36956.2,-1123.71"/>
<text text-anchor="middle" x="36851.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 9</text>
<text text-anchor="middle" x="36851.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="36851.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="36851.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="36851.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="36851.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer11_route_gpu9&#45;&gt;layer11_experts_gpu9 -->
<g id="edge396" class="edge">
<title>layer11_route_gpu9&#45;&gt;layer11_experts_gpu9</title>
<path fill="none" stroke="black" d="M36851.7,-1160.6C36851.7,-1160.6 36851.7,-1133.81 36851.7,-1133.81"/>
<polygon fill="black" stroke="black" points="36855.2,-1133.81 36851.7,-1123.81 36848.2,-1133.81 36855.2,-1133.81"/>
</g>
<!-- layer11_agg_gpu9 -->
<g id="node355" class="node">
<title>layer11_agg_gpu9</title>
<ellipse fill="lightpink" stroke="black" cx="36843.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="36843.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 9</text>
<text text-anchor="middle" x="36843.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="36843.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="36843.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer11_experts_gpu9&#45;&gt;layer11_agg_gpu9 -->
<g id="edge397" class="edge">
<title>layer11_experts_gpu9&#45;&gt;layer11_agg_gpu9</title>
<path fill="none" stroke="black" d="M36851.7,-1049.52C36851.7,-1049.52 36851.7,-1022.85 36851.7,-1022.85"/>
<polygon fill="black" stroke="black" points="36855.2,-1022.85 36851.7,-1012.85 36848.2,-1022.85 36855.2,-1022.85"/>
</g>
<!-- layer11_agg_gpu9&#45;&gt;layer11_moe_agg -->
<g id="edge398" class="edge">
<title>layer11_agg_gpu9&#45;&gt;layer11_moe_agg</title>
<path fill="none" stroke="black" d="M36843.7,-938.99C36843.7,-892.87 36843.7,-820 36843.7,-820 36843.7,-820 37685.6,-820 37685.6,-820"/>
<polygon fill="black" stroke="black" points="37685.6,-823.5 37695.6,-820 37685.6,-816.5 37685.6,-823.5"/>
</g>
<!-- layer11_experts_gpu10 -->
<g id="node357" class="node">
<title>layer11_experts_gpu10</title>
<polygon fill="lightcoral" stroke="black" points="37367.2,-1123.71 37158.2,-1123.71 37158.2,-1049.71 37367.2,-1049.71 37367.2,-1123.71"/>
<text text-anchor="middle" x="37262.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 10</text>
<text text-anchor="middle" x="37262.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="37262.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="37262.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="37262.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="37262.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer11_route_gpu10&#45;&gt;layer11_experts_gpu10 -->
<g id="edge400" class="edge">
<title>layer11_route_gpu10&#45;&gt;layer11_experts_gpu10</title>
<path fill="none" stroke="black" d="M37262.7,-1160.6C37262.7,-1160.6 37262.7,-1133.81 37262.7,-1133.81"/>
<polygon fill="black" stroke="black" points="37266.2,-1133.81 37262.7,-1123.81 37259.2,-1133.81 37266.2,-1133.81"/>
</g>
<!-- layer11_agg_gpu10 -->
<g id="node358" class="node">
<title>layer11_agg_gpu10</title>
<ellipse fill="lightpink" stroke="black" cx="37258.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="37258.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 10</text>
<text text-anchor="middle" x="37258.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="37258.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="37258.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer11_experts_gpu10&#45;&gt;layer11_agg_gpu10 -->
<g id="edge401" class="edge">
<title>layer11_experts_gpu10&#45;&gt;layer11_agg_gpu10</title>
<path fill="none" stroke="black" d="M37262.7,-1049.52C37262.7,-1049.52 37262.7,-1022.85 37262.7,-1022.85"/>
<polygon fill="black" stroke="black" points="37266.2,-1022.85 37262.7,-1012.85 37259.2,-1022.85 37266.2,-1022.85"/>
</g>
<!-- layer11_agg_gpu10&#45;&gt;layer11_moe_agg -->
<g id="edge402" class="edge">
<title>layer11_agg_gpu10&#45;&gt;layer11_moe_agg</title>
<path fill="none" stroke="black" d="M37449.3,-965.12C37449.3,-931.65 37449.3,-832 37449.3,-832 37449.3,-832 37668.26,-832 37668.26,-832"/>
<polygon fill="black" stroke="black" points="37668.26,-835.5 37678.26,-832 37668.26,-828.5 37668.26,-835.5"/>
</g>
<!-- layer11_experts_gpu11 -->
<g id="node360" class="node">
<title>layer11_experts_gpu11</title>
<polygon fill="lightcoral" stroke="black" points="37779.2,-1123.71 37570.2,-1123.71 37570.2,-1049.71 37779.2,-1049.71 37779.2,-1123.71"/>
<text text-anchor="middle" x="37674.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 11</text>
<text text-anchor="middle" x="37674.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="37674.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="37674.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="37674.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="37674.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer11_route_gpu11&#45;&gt;layer11_experts_gpu11 -->
<g id="edge404" class="edge">
<title>layer11_route_gpu11&#45;&gt;layer11_experts_gpu11</title>
<path fill="none" stroke="black" d="M37674.7,-1160.6C37674.7,-1160.6 37674.7,-1133.81 37674.7,-1133.81"/>
<polygon fill="black" stroke="black" points="37678.2,-1133.81 37674.7,-1123.81 37671.2,-1133.81 37678.2,-1133.81"/>
</g>
<!-- layer11_agg_gpu11 -->
<g id="node361" class="node">
<title>layer11_agg_gpu11</title>
<ellipse fill="lightpink" stroke="black" cx="37673.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="37673.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 11</text>
<text text-anchor="middle" x="37673.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="37673.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="37673.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer11_experts_gpu11&#45;&gt;layer11_agg_gpu11 -->
<g id="edge405" class="edge">
<title>layer11_experts_gpu11&#45;&gt;layer11_agg_gpu11</title>
<path fill="none" stroke="black" d="M37674.7,-1049.52C37674.7,-1049.52 37674.7,-1022.85 37674.7,-1022.85"/>
<polygon fill="black" stroke="black" points="37678.2,-1022.85 37674.7,-1012.85 37671.2,-1022.85 37678.2,-1022.85"/>
</g>
<!-- layer11_agg_gpu11&#45;&gt;layer11_moe_agg -->
<g id="edge406" class="edge">
<title>layer11_agg_gpu11&#45;&gt;layer11_moe_agg</title>
<path fill="none" stroke="black" d="M37774.02,-943.88C37774.02,-943.88 37774.02,-887.36 37774.02,-887.36"/>
<polygon fill="black" stroke="black" points="37777.52,-887.36 37774.02,-877.36 37770.52,-887.36 37777.52,-887.36"/>
</g>
<!-- layer11_experts_gpu12 -->
<g id="node363" class="node">
<title>layer11_experts_gpu12</title>
<polygon fill="lightcoral" stroke="black" points="38192.2,-1123.71 37983.2,-1123.71 37983.2,-1049.71 38192.2,-1049.71 38192.2,-1123.71"/>
<text text-anchor="middle" x="38087.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 12</text>
<text text-anchor="middle" x="38087.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="38087.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="38087.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="38087.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="38087.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer11_route_gpu12&#45;&gt;layer11_experts_gpu12 -->
<g id="edge408" class="edge">
<title>layer11_route_gpu12&#45;&gt;layer11_experts_gpu12</title>
<path fill="none" stroke="black" d="M38087.7,-1160.6C38087.7,-1160.6 38087.7,-1133.81 38087.7,-1133.81"/>
<polygon fill="black" stroke="black" points="38091.2,-1133.81 38087.7,-1123.81 38084.2,-1133.81 38091.2,-1133.81"/>
</g>
<!-- layer11_agg_gpu12 -->
<g id="node364" class="node">
<title>layer11_agg_gpu12</title>
<ellipse fill="lightpink" stroke="black" cx="38088.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="38088.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 12</text>
<text text-anchor="middle" x="38088.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="38088.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="38088.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer11_experts_gpu12&#45;&gt;layer11_agg_gpu12 -->
<g id="edge409" class="edge">
<title>layer11_experts_gpu12&#45;&gt;layer11_agg_gpu12</title>
<path fill="none" stroke="black" d="M38087.7,-1049.52C38087.7,-1049.52 38087.7,-1022.85 38087.7,-1022.85"/>
<polygon fill="black" stroke="black" points="38091.2,-1022.85 38087.7,-1012.85 38084.2,-1022.85 38091.2,-1022.85"/>
</g>
<!-- layer11_agg_gpu12&#45;&gt;layer11_moe_agg -->
<g id="edge410" class="edge">
<title>layer11_agg_gpu12&#45;&gt;layer11_moe_agg</title>
<path fill="none" stroke="black" d="M37987.88,-944.22C37987.88,-944.22 37987.88,-887.54 37987.88,-887.54"/>
<polygon fill="black" stroke="black" points="37991.38,-887.54 37987.88,-877.54 37984.38,-887.54 37991.38,-887.54"/>
</g>
<!-- layer11_experts_gpu13 -->
<g id="node366" class="node">
<title>layer11_experts_gpu13</title>
<polygon fill="lightcoral" stroke="black" points="38600.2,-1123.71 38391.2,-1123.71 38391.2,-1049.71 38600.2,-1049.71 38600.2,-1123.71"/>
<text text-anchor="middle" x="38495.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 13</text>
<text text-anchor="middle" x="38495.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="38495.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="38495.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="38495.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="38495.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer11_route_gpu13&#45;&gt;layer11_experts_gpu13 -->
<g id="edge412" class="edge">
<title>layer11_route_gpu13&#45;&gt;layer11_experts_gpu13</title>
<path fill="none" stroke="black" d="M38495.7,-1160.6C38495.7,-1160.6 38495.7,-1133.81 38495.7,-1133.81"/>
<polygon fill="black" stroke="black" points="38499.2,-1133.81 38495.7,-1123.81 38492.2,-1133.81 38499.2,-1133.81"/>
</g>
<!-- layer11_agg_gpu13 -->
<g id="node367" class="node">
<title>layer11_agg_gpu13</title>
<ellipse fill="lightpink" stroke="black" cx="38503.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="38503.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 13</text>
<text text-anchor="middle" x="38503.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="38503.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="38503.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer11_experts_gpu13&#45;&gt;layer11_agg_gpu13 -->
<g id="edge413" class="edge">
<title>layer11_experts_gpu13&#45;&gt;layer11_agg_gpu13</title>
<path fill="none" stroke="black" d="M38495.7,-1049.52C38495.7,-1049.52 38495.7,-1022.85 38495.7,-1022.85"/>
<polygon fill="black" stroke="black" points="38499.2,-1022.85 38495.7,-1012.85 38492.2,-1022.85 38499.2,-1022.85"/>
</g>
<!-- layer11_agg_gpu13&#45;&gt;layer11_moe_agg -->
<g id="edge414" class="edge">
<title>layer11_agg_gpu13&#45;&gt;layer11_moe_agg</title>
<path fill="none" stroke="black" d="M38503.7,-938.87C38503.7,-896.22 38503.7,-832 38503.7,-832 38503.7,-832 38093.4,-832 38093.4,-832"/>
<polygon fill="black" stroke="black" points="38093.4,-828.5 38083.4,-832 38093.4,-835.5 38093.4,-828.5"/>
</g>
<!-- layer11_experts_gpu14 -->
<g id="node369" class="node">
<title>layer11_experts_gpu14</title>
<polygon fill="lightcoral" stroke="black" points="39010.2,-1123.71 38801.2,-1123.71 38801.2,-1049.71 39010.2,-1049.71 39010.2,-1123.71"/>
<text text-anchor="middle" x="38905.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 14</text>
<text text-anchor="middle" x="38905.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="38905.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="38905.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="38905.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="38905.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer11_route_gpu14&#45;&gt;layer11_experts_gpu14 -->
<g id="edge416" class="edge">
<title>layer11_route_gpu14&#45;&gt;layer11_experts_gpu14</title>
<path fill="none" stroke="black" d="M38905.7,-1160.6C38905.7,-1160.6 38905.7,-1133.81 38905.7,-1133.81"/>
<polygon fill="black" stroke="black" points="38909.2,-1133.81 38905.7,-1123.81 38902.2,-1133.81 38909.2,-1133.81"/>
</g>
<!-- layer11_agg_gpu14 -->
<g id="node370" class="node">
<title>layer11_agg_gpu14</title>
<ellipse fill="lightpink" stroke="black" cx="38918.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="38918.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 14</text>
<text text-anchor="middle" x="38918.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="38918.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="38918.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer11_experts_gpu14&#45;&gt;layer11_agg_gpu14 -->
<g id="edge417" class="edge">
<title>layer11_experts_gpu14&#45;&gt;layer11_agg_gpu14</title>
<path fill="none" stroke="black" d="M38905.7,-1049.52C38905.7,-1049.52 38905.7,-1022.85 38905.7,-1022.85"/>
<polygon fill="black" stroke="black" points="38909.2,-1022.85 38905.7,-1012.85 38902.2,-1022.85 38909.2,-1022.85"/>
</g>
<!-- layer11_agg_gpu14&#45;&gt;layer11_moe_agg -->
<g id="edge418" class="edge">
<title>layer11_agg_gpu14&#45;&gt;layer11_moe_agg</title>
<path fill="none" stroke="black" d="M38918.7,-938.99C38918.7,-892.87 38918.7,-820 38918.7,-820 38918.7,-820 38075.97,-820 38075.97,-820"/>
<polygon fill="black" stroke="black" points="38075.97,-816.5 38065.97,-820 38075.97,-823.5 38075.97,-816.5"/>
</g>
<!-- layer11_experts_gpu15 -->
<g id="node372" class="node">
<title>layer11_experts_gpu15</title>
<polygon fill="lightcoral" stroke="black" points="39428.2,-1123.71 39219.2,-1123.71 39219.2,-1049.71 39428.2,-1049.71 39428.2,-1123.71"/>
<text text-anchor="middle" x="39323.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 15</text>
<text text-anchor="middle" x="39323.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="39323.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="39323.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="39323.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="39323.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer11_route_gpu15&#45;&gt;layer11_experts_gpu15 -->
<g id="edge420" class="edge">
<title>layer11_route_gpu15&#45;&gt;layer11_experts_gpu15</title>
<path fill="none" stroke="black" d="M39323.7,-1160.6C39323.7,-1160.6 39323.7,-1133.81 39323.7,-1133.81"/>
<polygon fill="black" stroke="black" points="39327.2,-1133.81 39323.7,-1123.81 39320.2,-1133.81 39327.2,-1133.81"/>
</g>
<!-- layer11_agg_gpu15 -->
<g id="node373" class="node">
<title>layer11_agg_gpu15</title>
<ellipse fill="lightpink" stroke="black" cx="39333.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="39333.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 15</text>
<text text-anchor="middle" x="39333.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="39333.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="39333.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer11_experts_gpu15&#45;&gt;layer11_agg_gpu15 -->
<g id="edge421" class="edge">
<title>layer11_experts_gpu15&#45;&gt;layer11_agg_gpu15</title>
<path fill="none" stroke="black" d="M39323.7,-1049.52C39323.7,-1049.52 39323.7,-1022.85 39323.7,-1022.85"/>
<polygon fill="black" stroke="black" points="39327.2,-1022.85 39323.7,-1012.85 39320.2,-1022.85 39327.2,-1022.85"/>
</g>
<!-- layer11_agg_gpu15&#45;&gt;layer11_moe_agg -->
<g id="edge422" class="edge">
<title>layer11_agg_gpu15&#45;&gt;layer11_moe_agg</title>
<path fill="none" stroke="black" d="M39333.7,-938.87C39333.7,-889.14 39333.7,-807 39333.7,-807 39333.7,-807 38032.66,-807 38032.66,-807"/>
<polygon fill="black" stroke="black" points="38032.66,-803.5 38022.66,-807 38032.66,-810.5 38032.66,-803.5"/>
</g>
<!-- layer12_ln1 -->
<g id="node375" class="node">
<title>layer12_ln1</title>
<polygon fill="none" stroke="black" points="39677.2,-1365.75 39396.2,-1365.75 39396.2,-1302.75 39677.2,-1302.75 39677.2,-1365.75"/>
<text text-anchor="middle" x="39536.7" y="-1353.75" font-family="Arial" font-size="10.00">LayerNorm MHA 12</text>
<text text-anchor="middle" x="39536.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="39536.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="39536.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="39536.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer12_add1 -->
<g id="node376" class="node">
<title>layer12_add1</title>
<polygon fill="yellow" stroke="black" points="41043.2,-728.4 40762.2,-728.4 40762.2,-676.4 41043.2,-676.4 41043.2,-728.4"/>
<text text-anchor="middle" x="40902.7" y="-716.4" font-family="Arial" font-size="10.00">MHA Residual Add 12</text>
<text text-anchor="middle" x="40902.7" y="-705.4" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="40902.7" y="-694.4" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="40902.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer12_moe_output -->
<g id="node380" class="node">
<title>layer12_moe_output</title>
<polygon fill="yellow" stroke="black" points="41124.2,-617.63 40843.2,-617.63 40843.2,-565.63 41124.2,-565.63 41124.2,-617.63"/>
<text text-anchor="middle" x="40983.7" y="-605.63" font-family="Arial" font-size="10.00">MoE Residual Add 12</text>
<text text-anchor="middle" x="40983.7" y="-594.63" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="40983.7" y="-583.63" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="40983.7" y="-572.63" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer12_add1&#45;&gt;layer12_moe_output -->
<g id="edge460" class="edge">
<title>layer12_add1&#45;&gt;layer12_moe_output</title>
<path fill="none" stroke="black" d="M40943.2,-676.15C40943.2,-676.15 40943.2,-627.7 40943.2,-627.7"/>
<polygon fill="black" stroke="black" points="40946.7,-627.7 40943.2,-617.7 40939.7,-627.7 40946.7,-627.7"/>
</g>
<!-- layer12_gate -->
<g id="node377" class="node">
<title>layer12_gate</title>
<polygon fill="lightgreen" stroke="black" points="41490.13,-1397.25 41031.3,-1397.25 40913.26,-1271.25 41372.1,-1271.25 41490.13,-1397.25"/>
<text text-anchor="middle" x="41201.7" y="-1353.75" font-family="Arial" font-size="10.00">Gate Layer 12</text>
<text text-anchor="middle" x="41201.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="41201.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="41201.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="41201.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, num_experts=16]</text>
</g>
<!-- layer12_route_gpu8 -->
<g id="node381" class="node">
<title>layer12_route_gpu8</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="39750.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="39750.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 8</text>
<text text-anchor="middle" x="39750.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="39750.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="39750.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer12_gate&#45;&gt;layer12_route_gpu8 -->
<g id="edge426" class="edge">
<title>layer12_gate&#45;&gt;layer12_route_gpu8</title>
<path fill="none" stroke="black" d="M40938.04,-1298C40534.73,-1298 39810.82,-1298 39810.82,-1298 39810.82,-1298 39810.82,-1242.64 39810.82,-1242.64"/>
<polygon fill="black" stroke="black" points="39814.32,-1242.64 39810.82,-1232.64 39807.32,-1242.64 39814.32,-1242.64"/>
</g>
<!-- layer12_route_gpu9 -->
<g id="node384" class="node">
<title>layer12_route_gpu9</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="40175.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="40175.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 9</text>
<text text-anchor="middle" x="40175.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="40175.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="40175.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer12_gate&#45;&gt;layer12_route_gpu9 -->
<g id="edge430" class="edge">
<title>layer12_gate&#45;&gt;layer12_route_gpu9</title>
<path fill="none" stroke="black" d="M40929.78,-1289C40625.82,-1289 40175.7,-1289 40175.7,-1289 40175.7,-1289 40175.7,-1244.44 40175.7,-1244.44"/>
<polygon fill="black" stroke="black" points="40179.2,-1244.44 40175.7,-1234.44 40172.2,-1244.44 40179.2,-1244.44"/>
</g>
<!-- layer12_route_gpu10 -->
<g id="node387" class="node">
<title>layer12_route_gpu10</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="40581.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="40581.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 10</text>
<text text-anchor="middle" x="40581.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="40581.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="40581.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer12_gate&#45;&gt;layer12_route_gpu10 -->
<g id="edge434" class="edge">
<title>layer12_gate&#45;&gt;layer12_route_gpu10</title>
<path fill="none" stroke="black" d="M40921.17,-1280C40757,-1280 40581.7,-1280 40581.7,-1280 40581.7,-1280 40581.7,-1244.4 40581.7,-1244.4"/>
<polygon fill="black" stroke="black" points="40585.2,-1244.4 40581.7,-1234.4 40578.2,-1244.4 40585.2,-1244.4"/>
</g>
<!-- layer12_route_gpu11 -->
<g id="node390" class="node">
<title>layer12_route_gpu11</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="40996.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="40996.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 11</text>
<text text-anchor="middle" x="40996.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="40996.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="40996.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer12_gate&#45;&gt;layer12_route_gpu11 -->
<g id="edge438" class="edge">
<title>layer12_gate&#45;&gt;layer12_route_gpu11</title>
<path fill="none" stroke="black" d="M41051.96,-1271.07C41051.96,-1271.07 41051.96,-1242.78 41051.96,-1242.78"/>
<polygon fill="black" stroke="black" points="41055.46,-1242.78 41051.96,-1232.78 41048.46,-1242.78 41055.46,-1242.78"/>
</g>
<!-- layer12_route_gpu12 -->
<g id="node393" class="node">
<title>layer12_route_gpu12</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="41406.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="41406.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 12</text>
<text text-anchor="middle" x="41406.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="41406.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="41406.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer12_gate&#45;&gt;layer12_route_gpu12 -->
<g id="edge442" class="edge">
<title>layer12_gate&#45;&gt;layer12_route_gpu12</title>
<path fill="none" stroke="black" d="M41351.43,-1271.07C41351.43,-1271.07 41351.43,-1242.78 41351.43,-1242.78"/>
<polygon fill="black" stroke="black" points="41354.93,-1242.78 41351.43,-1232.78 41347.93,-1242.78 41354.93,-1242.78"/>
</g>
<!-- layer12_route_gpu13 -->
<g id="node396" class="node">
<title>layer12_route_gpu13</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="41813.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="41813.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 13</text>
<text text-anchor="middle" x="41813.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="41813.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="41813.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer12_gate&#45;&gt;layer12_route_gpu13 -->
<g id="edge446" class="edge">
<title>layer12_gate&#45;&gt;layer12_route_gpu13</title>
<path fill="none" stroke="black" d="M41380.36,-1280C41561,-1280 41813.7,-1280 41813.7,-1280 41813.7,-1280 41813.7,-1244.4 41813.7,-1244.4"/>
<polygon fill="black" stroke="black" points="41817.2,-1244.4 41813.7,-1234.4 41810.2,-1244.4 41817.2,-1244.4"/>
</g>
<!-- layer12_route_gpu14 -->
<g id="node399" class="node">
<title>layer12_route_gpu14</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="42222.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="42222.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 14</text>
<text text-anchor="middle" x="42222.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="42222.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="42222.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer12_gate&#45;&gt;layer12_route_gpu14 -->
<g id="edge450" class="edge">
<title>layer12_gate&#45;&gt;layer12_route_gpu14</title>
<path fill="none" stroke="black" d="M41388.96,-1289C41683.72,-1289 42222.7,-1289 42222.7,-1289 42222.7,-1289 42222.7,-1244.44 42222.7,-1244.44"/>
<polygon fill="black" stroke="black" points="42226.2,-1244.44 42222.7,-1234.44 42219.2,-1244.44 42226.2,-1244.44"/>
</g>
<!-- layer12_route_gpu15 -->
<g id="node402" class="node">
<title>layer12_route_gpu15</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="42629.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="42629.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 15</text>
<text text-anchor="middle" x="42629.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="42629.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="42629.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer12_gate&#45;&gt;layer12_route_gpu15 -->
<g id="edge454" class="edge">
<title>layer12_gate&#45;&gt;layer12_route_gpu15</title>
<path fill="none" stroke="black" d="M41397.44,-1298C41778.01,-1298 42580.7,-1298 42580.7,-1298 42580.7,-1298 42580.7,-1243.2 42580.7,-1243.2"/>
<polygon fill="black" stroke="black" points="42584.2,-1243.2 42580.7,-1233.2 42577.2,-1243.2 42584.2,-1243.2"/>
</g>
<!-- layer12_moe_agg -->
<g id="node378" class="node">
<title>layer12_moe_agg</title>
<ellipse fill="gold" stroke="black" cx="41201.7" cy="-839.17" rx="205.12" ry="44.6"/>
<text text-anchor="middle" x="41201.7" y="-858.67" font-family="Arial" font-size="10.00">MoE Final Aggregation 12</text>
<text text-anchor="middle" x="41201.7" y="-847.67" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="41201.7" y="-836.67" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="41201.7" y="-825.67" font-family="Arial" font-size="10.00">Input: 16Ã—[batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="41201.7" y="-814.67" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer12_ln2 -->
<g id="node379" class="node">
<title>layer12_ln2</title>
<polygon fill="none" stroke="black" points="41342.2,-733.9 41061.2,-733.9 41061.2,-670.9 41342.2,-670.9 41342.2,-733.9"/>
<text text-anchor="middle" x="41201.7" y="-721.9" font-family="Arial" font-size="10.00">LayerNorm MoE 12</text>
<text text-anchor="middle" x="41201.7" y="-710.9" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="41201.7" y="-699.9" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="41201.7" y="-688.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="41201.7" y="-677.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer12_moe_agg&#45;&gt;layer12_ln2 -->
<g id="edge458" class="edge">
<title>layer12_moe_agg&#45;&gt;layer12_ln2</title>
<path fill="none" stroke="black" d="M41201.7,-794.39C41201.7,-794.39 41201.7,-744.29 41201.7,-744.29"/>
<polygon fill="black" stroke="black" points="41205.2,-744.29 41201.7,-734.29 41198.2,-744.29 41205.2,-744.29"/>
</g>
<!-- layer12_ln2&#45;&gt;layer12_moe_output -->
<g id="edge459" class="edge">
<title>layer12_ln2&#45;&gt;layer12_moe_output</title>
<path fill="none" stroke="black" d="M41092.7,-670.66C41092.7,-670.66 41092.7,-627.78 41092.7,-627.78"/>
<polygon fill="black" stroke="black" points="41096.2,-627.78 41092.7,-617.78 41089.2,-627.78 41096.2,-627.78"/>
</g>
<!-- layer13_mha -->
<g id="node405" class="node">
<title>layer13_mha</title>
<polygon fill="lightcyan" stroke="black" points="41124.2,-483.37 40843.2,-483.37 40843.2,-420.37 41124.2,-420.37 41124.2,-483.37"/>
<text text-anchor="middle" x="40983.7" y="-471.37" font-family="Arial" font-size="10.00">MHA Layer 13</text>
<text text-anchor="middle" x="40983.7" y="-460.37" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="40983.7" y="-449.37" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="40983.7" y="-438.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="40983.7" y="-427.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer12_moe_output&#45;&gt;layer13_mha -->
<g id="edge578" class="edge">
<title>layer12_moe_output&#45;&gt;layer13_mha</title>
<path fill="none" stroke="black" d="M40983.7,-565.34C40983.7,-565.34 40983.7,-493.42 40983.7,-493.42"/>
<polygon fill="black" stroke="black" points="40987.2,-493.42 40983.7,-483.42 40980.2,-493.42 40987.2,-493.42"/>
</g>
<!-- layer12_experts_gpu8 -->
<g id="node382" class="node">
<title>layer12_experts_gpu8</title>
<polygon fill="lightcoral" stroke="black" points="39854.2,-1123.71 39645.2,-1123.71 39645.2,-1049.71 39854.2,-1049.71 39854.2,-1123.71"/>
<text text-anchor="middle" x="39749.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 8</text>
<text text-anchor="middle" x="39749.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="39749.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="39749.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="39749.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="39749.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer12_route_gpu8&#45;&gt;layer12_experts_gpu8 -->
<g id="edge427" class="edge">
<title>layer12_route_gpu8&#45;&gt;layer12_experts_gpu8</title>
<path fill="none" stroke="black" d="M39749.7,-1160.6C39749.7,-1160.6 39749.7,-1133.81 39749.7,-1133.81"/>
<polygon fill="black" stroke="black" points="39753.2,-1133.81 39749.7,-1123.81 39746.2,-1133.81 39753.2,-1133.81"/>
</g>
<!-- layer12_agg_gpu8 -->
<g id="node383" class="node">
<title>layer12_agg_gpu8</title>
<ellipse fill="lightpink" stroke="black" cx="39748.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="39748.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 8</text>
<text text-anchor="middle" x="39748.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="39748.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="39748.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer12_experts_gpu8&#45;&gt;layer12_agg_gpu8 -->
<g id="edge428" class="edge">
<title>layer12_experts_gpu8&#45;&gt;layer12_agg_gpu8</title>
<path fill="none" stroke="black" d="M39749.7,-1049.52C39749.7,-1049.52 39749.7,-1022.85 39749.7,-1022.85"/>
<polygon fill="black" stroke="black" points="39753.2,-1022.85 39749.7,-1012.85 39746.2,-1022.85 39753.2,-1022.85"/>
</g>
<!-- layer12_agg_gpu8&#45;&gt;layer12_moe_agg -->
<g id="edge429" class="edge">
<title>layer12_agg_gpu8&#45;&gt;layer12_moe_agg</title>
<path fill="none" stroke="black" d="M39748.7,-939.12C39748.7,-900.39 39748.7,-845 39748.7,-845 39748.7,-845 40988.13,-845 40988.13,-845"/>
<polygon fill="black" stroke="black" points="40988.13,-848.5 40998.13,-845 40988.13,-841.5 40988.13,-848.5"/>
</g>
<!-- layer12_experts_gpu9 -->
<g id="node385" class="node">
<title>layer12_experts_gpu9</title>
<polygon fill="lightcoral" stroke="black" points="40271.2,-1123.71 40062.2,-1123.71 40062.2,-1049.71 40271.2,-1049.71 40271.2,-1123.71"/>
<text text-anchor="middle" x="40166.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 9</text>
<text text-anchor="middle" x="40166.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="40166.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="40166.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="40166.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="40166.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer12_route_gpu9&#45;&gt;layer12_experts_gpu9 -->
<g id="edge431" class="edge">
<title>layer12_route_gpu9&#45;&gt;layer12_experts_gpu9</title>
<path fill="none" stroke="black" d="M40166.7,-1160.6C40166.7,-1160.6 40166.7,-1133.81 40166.7,-1133.81"/>
<polygon fill="black" stroke="black" points="40170.2,-1133.81 40166.7,-1123.81 40163.2,-1133.81 40170.2,-1133.81"/>
</g>
<!-- layer12_agg_gpu9 -->
<g id="node386" class="node">
<title>layer12_agg_gpu9</title>
<ellipse fill="lightpink" stroke="black" cx="40163.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="40163.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 9</text>
<text text-anchor="middle" x="40163.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="40163.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="40163.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer12_experts_gpu9&#45;&gt;layer12_agg_gpu9 -->
<g id="edge432" class="edge">
<title>layer12_experts_gpu9&#45;&gt;layer12_agg_gpu9</title>
<path fill="none" stroke="black" d="M40166.7,-1049.52C40166.7,-1049.52 40166.7,-1022.85 40166.7,-1022.85"/>
<polygon fill="black" stroke="black" points="40170.2,-1022.85 40166.7,-1012.85 40163.2,-1022.85 40170.2,-1022.85"/>
</g>
<!-- layer12_agg_gpu9&#45;&gt;layer12_moe_agg -->
<g id="edge433" class="edge">
<title>layer12_agg_gpu9&#45;&gt;layer12_moe_agg</title>
<path fill="none" stroke="black" d="M40163.7,-938.95C40163.7,-904.36 40163.7,-858 40163.7,-858 40163.7,-858 41005.82,-858 41005.82,-858"/>
<polygon fill="black" stroke="black" points="41005.82,-861.5 41015.82,-858 41005.82,-854.5 41005.82,-861.5"/>
</g>
<!-- layer12_experts_gpu10 -->
<g id="node388" class="node">
<title>layer12_experts_gpu10</title>
<polygon fill="lightcoral" stroke="black" points="40683.2,-1123.71 40474.2,-1123.71 40474.2,-1049.71 40683.2,-1049.71 40683.2,-1123.71"/>
<text text-anchor="middle" x="40578.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 10</text>
<text text-anchor="middle" x="40578.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="40578.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="40578.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="40578.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="40578.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer12_route_gpu10&#45;&gt;layer12_experts_gpu10 -->
<g id="edge435" class="edge">
<title>layer12_route_gpu10&#45;&gt;layer12_experts_gpu10</title>
<path fill="none" stroke="black" d="M40578.7,-1160.6C40578.7,-1160.6 40578.7,-1133.81 40578.7,-1133.81"/>
<polygon fill="black" stroke="black" points="40582.2,-1133.81 40578.7,-1123.81 40575.2,-1133.81 40582.2,-1133.81"/>
</g>
<!-- layer12_agg_gpu10 -->
<g id="node389" class="node">
<title>layer12_agg_gpu10</title>
<ellipse fill="lightpink" stroke="black" cx="40578.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="40578.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 10</text>
<text text-anchor="middle" x="40578.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="40578.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="40578.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer12_experts_gpu10&#45;&gt;layer12_agg_gpu10 -->
<g id="edge436" class="edge">
<title>layer12_experts_gpu10&#45;&gt;layer12_agg_gpu10</title>
<path fill="none" stroke="black" d="M40578.7,-1049.52C40578.7,-1049.52 40578.7,-1022.85 40578.7,-1022.85"/>
<polygon fill="black" stroke="black" points="40582.2,-1022.85 40578.7,-1012.85 40575.2,-1022.85 40582.2,-1022.85"/>
</g>
<!-- layer12_agg_gpu10&#45;&gt;layer12_moe_agg -->
<g id="edge437" class="edge">
<title>layer12_agg_gpu10&#45;&gt;layer12_moe_agg</title>
<path fill="none" stroke="black" d="M40769.8,-965.78C40769.8,-939.27 40769.8,-870 40769.8,-870 40769.8,-870 41043.36,-870 41043.36,-870"/>
<polygon fill="black" stroke="black" points="41043.36,-873.5 41053.36,-870 41043.36,-866.5 41043.36,-873.5"/>
</g>
<!-- layer12_experts_gpu11 -->
<g id="node391" class="node">
<title>layer12_experts_gpu11</title>
<polygon fill="lightcoral" stroke="black" points="41099.2,-1123.71 40890.2,-1123.71 40890.2,-1049.71 41099.2,-1049.71 41099.2,-1123.71"/>
<text text-anchor="middle" x="40994.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 11</text>
<text text-anchor="middle" x="40994.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="40994.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="40994.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="40994.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="40994.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer12_route_gpu11&#45;&gt;layer12_experts_gpu11 -->
<g id="edge439" class="edge">
<title>layer12_route_gpu11&#45;&gt;layer12_experts_gpu11</title>
<path fill="none" stroke="black" d="M40994.7,-1160.6C40994.7,-1160.6 40994.7,-1133.81 40994.7,-1133.81"/>
<polygon fill="black" stroke="black" points="40998.2,-1133.81 40994.7,-1123.81 40991.2,-1133.81 40998.2,-1133.81"/>
</g>
<!-- layer12_agg_gpu11 -->
<g id="node392" class="node">
<title>layer12_agg_gpu11</title>
<ellipse fill="lightpink" stroke="black" cx="40993.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="40993.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 11</text>
<text text-anchor="middle" x="40993.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="40993.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="40993.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer12_experts_gpu11&#45;&gt;layer12_agg_gpu11 -->
<g id="edge440" class="edge">
<title>layer12_experts_gpu11&#45;&gt;layer12_agg_gpu11</title>
<path fill="none" stroke="black" d="M40994.7,-1049.52C40994.7,-1049.52 40994.7,-1022.85 40994.7,-1022.85"/>
<polygon fill="black" stroke="black" points="40998.2,-1022.85 40994.7,-1012.85 40991.2,-1022.85 40998.2,-1022.85"/>
</g>
<!-- layer12_agg_gpu11&#45;&gt;layer12_moe_agg -->
<g id="edge441" class="edge">
<title>layer12_agg_gpu11&#45;&gt;layer12_moe_agg</title>
<path fill="none" stroke="black" d="M41094.52,-944.22C41094.52,-944.22 41094.52,-887.54 41094.52,-887.54"/>
<polygon fill="black" stroke="black" points="41098.02,-887.54 41094.52,-877.54 41091.02,-887.54 41098.02,-887.54"/>
</g>
<!-- layer12_experts_gpu12 -->
<g id="node394" class="node">
<title>layer12_experts_gpu12</title>
<polygon fill="lightcoral" stroke="black" points="41512.2,-1123.71 41303.2,-1123.71 41303.2,-1049.71 41512.2,-1049.71 41512.2,-1123.71"/>
<text text-anchor="middle" x="41407.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 12</text>
<text text-anchor="middle" x="41407.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="41407.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="41407.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="41407.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="41407.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer12_route_gpu12&#45;&gt;layer12_experts_gpu12 -->
<g id="edge443" class="edge">
<title>layer12_route_gpu12&#45;&gt;layer12_experts_gpu12</title>
<path fill="none" stroke="black" d="M41407.7,-1160.6C41407.7,-1160.6 41407.7,-1133.81 41407.7,-1133.81"/>
<polygon fill="black" stroke="black" points="41411.2,-1133.81 41407.7,-1123.81 41404.2,-1133.81 41411.2,-1133.81"/>
</g>
<!-- layer12_agg_gpu12 -->
<g id="node395" class="node">
<title>layer12_agg_gpu12</title>
<ellipse fill="lightpink" stroke="black" cx="41408.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="41408.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 12</text>
<text text-anchor="middle" x="41408.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="41408.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="41408.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer12_experts_gpu12&#45;&gt;layer12_agg_gpu12 -->
<g id="edge444" class="edge">
<title>layer12_experts_gpu12&#45;&gt;layer12_agg_gpu12</title>
<path fill="none" stroke="black" d="M41407.7,-1049.52C41407.7,-1049.52 41407.7,-1022.85 41407.7,-1022.85"/>
<polygon fill="black" stroke="black" points="41411.2,-1022.85 41407.7,-1012.85 41404.2,-1022.85 41411.2,-1022.85"/>
</g>
<!-- layer12_agg_gpu12&#45;&gt;layer12_moe_agg -->
<g id="edge445" class="edge">
<title>layer12_agg_gpu12&#45;&gt;layer12_moe_agg</title>
<path fill="none" stroke="black" d="M41308.38,-943.88C41308.38,-943.88 41308.38,-887.36 41308.38,-887.36"/>
<polygon fill="black" stroke="black" points="41311.88,-887.36 41308.38,-877.36 41304.88,-887.36 41311.88,-887.36"/>
</g>
<!-- layer12_experts_gpu13 -->
<g id="node397" class="node">
<title>layer12_experts_gpu13</title>
<polygon fill="lightcoral" stroke="black" points="41921.2,-1123.71 41712.2,-1123.71 41712.2,-1049.71 41921.2,-1049.71 41921.2,-1123.71"/>
<text text-anchor="middle" x="41816.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 13</text>
<text text-anchor="middle" x="41816.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="41816.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="41816.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="41816.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="41816.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer12_route_gpu13&#45;&gt;layer12_experts_gpu13 -->
<g id="edge447" class="edge">
<title>layer12_route_gpu13&#45;&gt;layer12_experts_gpu13</title>
<path fill="none" stroke="black" d="M41816.7,-1160.6C41816.7,-1160.6 41816.7,-1133.81 41816.7,-1133.81"/>
<polygon fill="black" stroke="black" points="41820.2,-1133.81 41816.7,-1123.81 41813.2,-1133.81 41820.2,-1133.81"/>
</g>
<!-- layer12_agg_gpu13 -->
<g id="node398" class="node">
<title>layer12_agg_gpu13</title>
<ellipse fill="lightpink" stroke="black" cx="41823.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="41823.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 13</text>
<text text-anchor="middle" x="41823.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="41823.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="41823.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer12_experts_gpu13&#45;&gt;layer12_agg_gpu13 -->
<g id="edge448" class="edge">
<title>layer12_experts_gpu13&#45;&gt;layer12_agg_gpu13</title>
<path fill="none" stroke="black" d="M41816.7,-1049.52C41816.7,-1049.52 41816.7,-1022.85 41816.7,-1022.85"/>
<polygon fill="black" stroke="black" points="41820.2,-1022.85 41816.7,-1012.85 41813.2,-1022.85 41820.2,-1022.85"/>
</g>
<!-- layer12_agg_gpu13&#45;&gt;layer12_moe_agg -->
<g id="edge449" class="edge">
<title>layer12_agg_gpu13&#45;&gt;layer12_moe_agg</title>
<path fill="none" stroke="black" d="M41823.7,-938.87C41823.7,-896.22 41823.7,-832 41823.7,-832 41823.7,-832 41414.5,-832 41414.5,-832"/>
<polygon fill="black" stroke="black" points="41414.5,-828.5 41404.5,-832 41414.5,-835.5 41414.5,-828.5"/>
</g>
<!-- layer12_experts_gpu14 -->
<g id="node400" class="node">
<title>layer12_experts_gpu14</title>
<polygon fill="lightcoral" stroke="black" points="42331.2,-1123.71 42122.2,-1123.71 42122.2,-1049.71 42331.2,-1049.71 42331.2,-1123.71"/>
<text text-anchor="middle" x="42226.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 14</text>
<text text-anchor="middle" x="42226.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="42226.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="42226.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="42226.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="42226.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer12_route_gpu14&#45;&gt;layer12_experts_gpu14 -->
<g id="edge451" class="edge">
<title>layer12_route_gpu14&#45;&gt;layer12_experts_gpu14</title>
<path fill="none" stroke="black" d="M42226.7,-1160.6C42226.7,-1160.6 42226.7,-1133.81 42226.7,-1133.81"/>
<polygon fill="black" stroke="black" points="42230.2,-1133.81 42226.7,-1123.81 42223.2,-1133.81 42230.2,-1133.81"/>
</g>
<!-- layer12_agg_gpu14 -->
<g id="node401" class="node">
<title>layer12_agg_gpu14</title>
<ellipse fill="lightpink" stroke="black" cx="42238.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="42238.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 14</text>
<text text-anchor="middle" x="42238.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="42238.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="42238.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer12_experts_gpu14&#45;&gt;layer12_agg_gpu14 -->
<g id="edge452" class="edge">
<title>layer12_experts_gpu14&#45;&gt;layer12_agg_gpu14</title>
<path fill="none" stroke="black" d="M42226.7,-1049.52C42226.7,-1049.52 42226.7,-1022.85 42226.7,-1022.85"/>
<polygon fill="black" stroke="black" points="42230.2,-1022.85 42226.7,-1012.85 42223.2,-1022.85 42230.2,-1022.85"/>
</g>
<!-- layer12_agg_gpu14&#45;&gt;layer12_moe_agg -->
<g id="edge453" class="edge">
<title>layer12_agg_gpu14&#45;&gt;layer12_moe_agg</title>
<path fill="none" stroke="black" d="M42238.7,-938.99C42238.7,-892.87 42238.7,-820 42238.7,-820 42238.7,-820 41396.79,-820 41396.79,-820"/>
<polygon fill="black" stroke="black" points="41396.79,-816.5 41386.79,-820 41396.79,-823.5 41396.79,-816.5"/>
</g>
<!-- layer12_experts_gpu15 -->
<g id="node403" class="node">
<title>layer12_experts_gpu15</title>
<polygon fill="lightcoral" stroke="black" points="42744.2,-1123.71 42535.2,-1123.71 42535.2,-1049.71 42744.2,-1049.71 42744.2,-1123.71"/>
<text text-anchor="middle" x="42639.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 15</text>
<text text-anchor="middle" x="42639.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="42639.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="42639.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="42639.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="42639.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer12_route_gpu15&#45;&gt;layer12_experts_gpu15 -->
<g id="edge455" class="edge">
<title>layer12_route_gpu15&#45;&gt;layer12_experts_gpu15</title>
<path fill="none" stroke="black" d="M42639.7,-1160.6C42639.7,-1160.6 42639.7,-1133.81 42639.7,-1133.81"/>
<polygon fill="black" stroke="black" points="42643.2,-1133.81 42639.7,-1123.81 42636.2,-1133.81 42643.2,-1133.81"/>
</g>
<!-- layer12_agg_gpu15 -->
<g id="node404" class="node">
<title>layer12_agg_gpu15</title>
<ellipse fill="lightpink" stroke="black" cx="42653.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="42653.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 15</text>
<text text-anchor="middle" x="42653.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="42653.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="42653.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer12_experts_gpu15&#45;&gt;layer12_agg_gpu15 -->
<g id="edge456" class="edge">
<title>layer12_experts_gpu15&#45;&gt;layer12_agg_gpu15</title>
<path fill="none" stroke="black" d="M42639.7,-1049.52C42639.7,-1049.52 42639.7,-1022.85 42639.7,-1022.85"/>
<polygon fill="black" stroke="black" points="42643.2,-1022.85 42639.7,-1012.85 42636.2,-1022.85 42643.2,-1022.85"/>
</g>
<!-- layer12_agg_gpu15&#45;&gt;layer12_moe_agg -->
<g id="edge457" class="edge">
<title>layer12_agg_gpu15&#45;&gt;layer12_moe_agg</title>
<path fill="none" stroke="black" d="M42653.7,-938.87C42653.7,-889.14 42653.7,-807 42653.7,-807 42653.7,-807 41353.56,-807 41353.56,-807"/>
<polygon fill="black" stroke="black" points="41353.56,-803.5 41343.56,-807 41353.56,-810.5 41353.56,-803.5"/>
</g>
<!-- layer13_ln1 -->
<g id="node406" class="node">
<title>layer13_ln1</title>
<polygon fill="none" stroke="black" points="42721.2,-1365.75 42440.2,-1365.75 42440.2,-1302.75 42721.2,-1302.75 42721.2,-1365.75"/>
<text text-anchor="middle" x="42580.7" y="-1353.75" font-family="Arial" font-size="10.00">LayerNorm MHA 13</text>
<text text-anchor="middle" x="42580.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="42580.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="42580.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="42580.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer13_add1 -->
<g id="node407" class="node">
<title>layer13_add1</title>
<polygon fill="yellow" stroke="black" points="44362.2,-728.4 44081.2,-728.4 44081.2,-676.4 44362.2,-676.4 44362.2,-728.4"/>
<text text-anchor="middle" x="44221.7" y="-716.4" font-family="Arial" font-size="10.00">MHA Residual Add 13</text>
<text text-anchor="middle" x="44221.7" y="-705.4" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="44221.7" y="-694.4" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="44221.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer13_moe_output -->
<g id="node411" class="node">
<title>layer13_moe_output</title>
<polygon fill="yellow" stroke="black" points="44437.2,-617.63 44156.2,-617.63 44156.2,-565.63 44437.2,-565.63 44437.2,-617.63"/>
<text text-anchor="middle" x="44296.7" y="-605.63" font-family="Arial" font-size="10.00">MoE Residual Add 13</text>
<text text-anchor="middle" x="44296.7" y="-594.63" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="44296.7" y="-583.63" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="44296.7" y="-572.63" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer13_add1&#45;&gt;layer13_moe_output -->
<g id="edge495" class="edge">
<title>layer13_add1&#45;&gt;layer13_moe_output</title>
<path fill="none" stroke="black" d="M44259.2,-676.15C44259.2,-676.15 44259.2,-627.7 44259.2,-627.7"/>
<polygon fill="black" stroke="black" points="44262.7,-627.7 44259.2,-617.7 44255.7,-627.7 44262.7,-627.7"/>
</g>
<!-- layer13_gate -->
<g id="node408" class="node">
<title>layer13_gate</title>
<polygon fill="lightgreen" stroke="black" points="44714.13,-1397.25 44255.3,-1397.25 44137.26,-1271.25 44596.1,-1271.25 44714.13,-1397.25"/>
<text text-anchor="middle" x="44425.7" y="-1353.75" font-family="Arial" font-size="10.00">Gate Layer 13</text>
<text text-anchor="middle" x="44425.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="44425.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="44425.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="44425.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, num_experts=16]</text>
</g>
<!-- layer13_route_gpu8 -->
<g id="node412" class="node">
<title>layer13_route_gpu8</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="43087.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="43087.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 8</text>
<text text-anchor="middle" x="43087.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="43087.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="43087.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer13_gate&#45;&gt;layer13_route_gpu8 -->
<g id="edge461" class="edge">
<title>layer13_gate&#45;&gt;layer13_route_gpu8</title>
<path fill="none" stroke="black" d="M44157.35,-1293C43766.75,-1293 43087.7,-1293 43087.7,-1293 43087.7,-1293 43087.7,-1244.41 43087.7,-1244.41"/>
<polygon fill="black" stroke="black" points="43091.2,-1244.41 43087.7,-1234.41 43084.2,-1244.41 43091.2,-1244.41"/>
</g>
<!-- layer13_route_gpu9 -->
<g id="node415" class="node">
<title>layer13_route_gpu9</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="43498.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="43498.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 9</text>
<text text-anchor="middle" x="43498.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="43498.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="43498.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer13_gate&#45;&gt;layer13_route_gpu9 -->
<g id="edge465" class="edge">
<title>layer13_gate&#45;&gt;layer13_route_gpu9</title>
<path fill="none" stroke="black" d="M44149.14,-1284C43875.96,-1284 43498.7,-1284 43498.7,-1284 43498.7,-1284 43498.7,-1244.42 43498.7,-1244.42"/>
<polygon fill="black" stroke="black" points="43502.2,-1244.42 43498.7,-1234.42 43495.2,-1244.42 43502.2,-1244.42"/>
</g>
<!-- layer13_route_gpu10 -->
<g id="node418" class="node">
<title>layer13_route_gpu10</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="43905.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="43905.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 10</text>
<text text-anchor="middle" x="43905.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="43905.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="43905.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer13_gate&#45;&gt;layer13_route_gpu10 -->
<g id="edge469" class="edge">
<title>layer13_gate&#45;&gt;layer13_route_gpu10</title>
<path fill="none" stroke="black" d="M44140.6,-1275C44019.48,-1275 43905.7,-1275 43905.7,-1275 43905.7,-1275 43905.7,-1244.42 43905.7,-1244.42"/>
<polygon fill="black" stroke="black" points="43909.2,-1244.42 43905.7,-1234.42 43902.2,-1244.42 43909.2,-1244.42"/>
</g>
<!-- layer13_route_gpu11 -->
<g id="node421" class="node">
<title>layer13_route_gpu11</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="44315.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="44315.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 11</text>
<text text-anchor="middle" x="44315.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="44315.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="44315.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer13_gate&#45;&gt;layer13_route_gpu11 -->
<g id="edge473" class="edge">
<title>layer13_gate&#45;&gt;layer13_route_gpu11</title>
<path fill="none" stroke="black" d="M44323.46,-1271.07C44323.46,-1271.07 44323.46,-1244.29 44323.46,-1244.29"/>
<polygon fill="black" stroke="black" points="44326.96,-1244.29 44323.46,-1234.29 44319.96,-1244.29 44326.96,-1244.29"/>
</g>
<!-- layer13_route_gpu12 -->
<g id="node424" class="node">
<title>layer13_route_gpu12</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="44725.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="44725.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 12</text>
<text text-anchor="middle" x="44725.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="44725.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="44725.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer13_gate&#45;&gt;layer13_route_gpu12 -->
<g id="edge477" class="edge">
<title>layer13_gate&#45;&gt;layer13_route_gpu12</title>
<path fill="none" stroke="black" d="M44622.93,-1299.74C44622.93,-1299.74 44622.93,-1238.71 44622.93,-1238.71"/>
<polygon fill="black" stroke="black" points="44626.43,-1238.71 44622.93,-1228.71 44619.43,-1238.71 44626.43,-1238.71"/>
</g>
<!-- layer13_route_gpu13 -->
<g id="node427" class="node">
<title>layer13_route_gpu13</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="45137.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="45137.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 13</text>
<text text-anchor="middle" x="45137.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="45137.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="45137.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer13_gate&#45;&gt;layer13_route_gpu13 -->
<g id="edge481" class="edge">
<title>layer13_gate&#45;&gt;layer13_route_gpu13</title>
<path fill="none" stroke="black" d="M44604.45,-1280C44815.35,-1280 45137.7,-1280 45137.7,-1280 45137.7,-1280 45137.7,-1244.4 45137.7,-1244.4"/>
<polygon fill="black" stroke="black" points="45141.2,-1244.4 45137.7,-1234.4 45134.2,-1244.4 45141.2,-1244.4"/>
</g>
<!-- layer13_route_gpu14 -->
<g id="node430" class="node">
<title>layer13_route_gpu14</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="45551.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="45551.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 14</text>
<text text-anchor="middle" x="45551.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="45551.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="45551.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer13_gate&#45;&gt;layer13_route_gpu14 -->
<g id="edge485" class="edge">
<title>layer13_gate&#45;&gt;layer13_route_gpu14</title>
<path fill="none" stroke="black" d="M44612.9,-1289C44933.08,-1289 45551.7,-1289 45551.7,-1289 45551.7,-1289 45551.7,-1244.44 45551.7,-1244.44"/>
<polygon fill="black" stroke="black" points="45555.2,-1244.44 45551.7,-1234.44 45548.2,-1244.44 45555.2,-1244.44"/>
</g>
<!-- layer13_route_gpu15 -->
<g id="node433" class="node">
<title>layer13_route_gpu15</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="45957.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="45957.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 15</text>
<text text-anchor="middle" x="45957.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="45957.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="45957.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer13_gate&#45;&gt;layer13_route_gpu15 -->
<g id="edge489" class="edge">
<title>layer13_gate&#45;&gt;layer13_route_gpu15</title>
<path fill="none" stroke="black" d="M44621.31,-1298C45012.51,-1298 45854.07,-1298 45854.07,-1298 45854.07,-1298 45854.07,-1238.74 45854.07,-1238.74"/>
<polygon fill="black" stroke="black" points="45857.57,-1238.74 45854.07,-1228.74 45850.57,-1238.74 45857.57,-1238.74"/>
</g>
<!-- layer13_moe_agg -->
<g id="node409" class="node">
<title>layer13_moe_agg</title>
<ellipse fill="gold" stroke="black" cx="44520.7" cy="-839.17" rx="205.12" ry="44.6"/>
<text text-anchor="middle" x="44520.7" y="-858.67" font-family="Arial" font-size="10.00">MoE Final Aggregation 13</text>
<text text-anchor="middle" x="44520.7" y="-847.67" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="44520.7" y="-836.67" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="44520.7" y="-825.67" font-family="Arial" font-size="10.00">Input: 16Ã—[batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="44520.7" y="-814.67" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer13_ln2 -->
<g id="node410" class="node">
<title>layer13_ln2</title>
<polygon fill="none" stroke="black" points="44661.2,-733.9 44380.2,-733.9 44380.2,-670.9 44661.2,-670.9 44661.2,-733.9"/>
<text text-anchor="middle" x="44520.7" y="-721.9" font-family="Arial" font-size="10.00">LayerNorm MoE 13</text>
<text text-anchor="middle" x="44520.7" y="-710.9" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="44520.7" y="-699.9" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="44520.7" y="-688.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="44520.7" y="-677.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer13_moe_agg&#45;&gt;layer13_ln2 -->
<g id="edge493" class="edge">
<title>layer13_moe_agg&#45;&gt;layer13_ln2</title>
<path fill="none" stroke="black" d="M44520.7,-794.39C44520.7,-794.39 44520.7,-744.29 44520.7,-744.29"/>
<polygon fill="black" stroke="black" points="44524.2,-744.29 44520.7,-734.29 44517.2,-744.29 44524.2,-744.29"/>
</g>
<!-- layer13_ln2&#45;&gt;layer13_moe_output -->
<g id="edge494" class="edge">
<title>layer13_ln2&#45;&gt;layer13_moe_output</title>
<path fill="none" stroke="black" d="M44408.7,-670.66C44408.7,-670.66 44408.7,-627.78 44408.7,-627.78"/>
<polygon fill="black" stroke="black" points="44412.2,-627.78 44408.7,-617.78 44405.2,-627.78 44412.2,-627.78"/>
</g>
<!-- layer14_mha -->
<g id="node436" class="node">
<title>layer14_mha</title>
<polygon fill="lightcyan" stroke="black" points="44437.2,-483.37 44156.2,-483.37 44156.2,-420.37 44437.2,-420.37 44437.2,-483.37"/>
<text text-anchor="middle" x="44296.7" y="-471.37" font-family="Arial" font-size="10.00">MHA Layer 14</text>
<text text-anchor="middle" x="44296.7" y="-460.37" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="44296.7" y="-449.37" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="44296.7" y="-438.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="44296.7" y="-427.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer13_moe_output&#45;&gt;layer14_mha -->
<g id="edge579" class="edge">
<title>layer13_moe_output&#45;&gt;layer14_mha</title>
<path fill="none" stroke="black" d="M44296.7,-565.34C44296.7,-565.34 44296.7,-493.42 44296.7,-493.42"/>
<polygon fill="black" stroke="black" points="44300.2,-493.42 44296.7,-483.42 44293.2,-493.42 44300.2,-493.42"/>
</g>
<!-- layer13_experts_gpu8 -->
<g id="node413" class="node">
<title>layer13_experts_gpu8</title>
<polygon fill="lightcoral" stroke="black" points="43185.2,-1123.71 42976.2,-1123.71 42976.2,-1049.71 43185.2,-1049.71 43185.2,-1123.71"/>
<text text-anchor="middle" x="43080.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 8</text>
<text text-anchor="middle" x="43080.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="43080.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="43080.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="43080.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="43080.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer13_route_gpu8&#45;&gt;layer13_experts_gpu8 -->
<g id="edge462" class="edge">
<title>layer13_route_gpu8&#45;&gt;layer13_experts_gpu8</title>
<path fill="none" stroke="black" d="M43080.7,-1160.6C43080.7,-1160.6 43080.7,-1133.81 43080.7,-1133.81"/>
<polygon fill="black" stroke="black" points="43084.2,-1133.81 43080.7,-1123.81 43077.2,-1133.81 43084.2,-1133.81"/>
</g>
<!-- layer13_agg_gpu8 -->
<g id="node414" class="node">
<title>layer13_agg_gpu8</title>
<ellipse fill="lightpink" stroke="black" cx="43068.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="43068.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 8</text>
<text text-anchor="middle" x="43068.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="43068.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="43068.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer13_experts_gpu8&#45;&gt;layer13_agg_gpu8 -->
<g id="edge463" class="edge">
<title>layer13_experts_gpu8&#45;&gt;layer13_agg_gpu8</title>
<path fill="none" stroke="black" d="M43080.7,-1049.52C43080.7,-1049.52 43080.7,-1022.85 43080.7,-1022.85"/>
<polygon fill="black" stroke="black" points="43084.2,-1022.85 43080.7,-1012.85 43077.2,-1022.85 43084.2,-1022.85"/>
</g>
<!-- layer13_agg_gpu8&#45;&gt;layer13_moe_agg -->
<g id="edge464" class="edge">
<title>layer13_agg_gpu8&#45;&gt;layer13_moe_agg</title>
<path fill="none" stroke="black" d="M43068.7,-939.12C43068.7,-900.39 43068.7,-845 43068.7,-845 43068.7,-845 44307.27,-845 44307.27,-845"/>
<polygon fill="black" stroke="black" points="44307.27,-848.5 44317.27,-845 44307.27,-841.5 44307.27,-848.5"/>
</g>
<!-- layer13_experts_gpu9 -->
<g id="node416" class="node">
<title>layer13_experts_gpu9</title>
<polygon fill="lightcoral" stroke="black" points="43597.2,-1123.71 43388.2,-1123.71 43388.2,-1049.71 43597.2,-1049.71 43597.2,-1123.71"/>
<text text-anchor="middle" x="43492.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 9</text>
<text text-anchor="middle" x="43492.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="43492.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="43492.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="43492.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="43492.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer13_route_gpu9&#45;&gt;layer13_experts_gpu9 -->
<g id="edge466" class="edge">
<title>layer13_route_gpu9&#45;&gt;layer13_experts_gpu9</title>
<path fill="none" stroke="black" d="M43492.7,-1160.6C43492.7,-1160.6 43492.7,-1133.81 43492.7,-1133.81"/>
<polygon fill="black" stroke="black" points="43496.2,-1133.81 43492.7,-1123.81 43489.2,-1133.81 43496.2,-1133.81"/>
</g>
<!-- layer13_agg_gpu9 -->
<g id="node417" class="node">
<title>layer13_agg_gpu9</title>
<ellipse fill="lightpink" stroke="black" cx="43483.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="43483.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 9</text>
<text text-anchor="middle" x="43483.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="43483.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="43483.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer13_experts_gpu9&#45;&gt;layer13_agg_gpu9 -->
<g id="edge467" class="edge">
<title>layer13_experts_gpu9&#45;&gt;layer13_agg_gpu9</title>
<path fill="none" stroke="black" d="M43492.7,-1049.52C43492.7,-1049.52 43492.7,-1022.85 43492.7,-1022.85"/>
<polygon fill="black" stroke="black" points="43496.2,-1022.85 43492.7,-1012.85 43489.2,-1022.85 43496.2,-1022.85"/>
</g>
<!-- layer13_agg_gpu9&#45;&gt;layer13_moe_agg -->
<g id="edge468" class="edge">
<title>layer13_agg_gpu9&#45;&gt;layer13_moe_agg</title>
<path fill="none" stroke="black" d="M43483.7,-938.95C43483.7,-904.36 43483.7,-858 43483.7,-858 43483.7,-858 44324.7,-858 44324.7,-858"/>
<polygon fill="black" stroke="black" points="44324.7,-861.5 44334.7,-858 44324.7,-854.5 44324.7,-861.5"/>
</g>
<!-- layer13_experts_gpu10 -->
<g id="node419" class="node">
<title>layer13_experts_gpu10</title>
<polygon fill="lightcoral" stroke="black" points="44006.2,-1123.71 43797.2,-1123.71 43797.2,-1049.71 44006.2,-1049.71 44006.2,-1123.71"/>
<text text-anchor="middle" x="43901.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 10</text>
<text text-anchor="middle" x="43901.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="43901.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="43901.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="43901.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="43901.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer13_route_gpu10&#45;&gt;layer13_experts_gpu10 -->
<g id="edge470" class="edge">
<title>layer13_route_gpu10&#45;&gt;layer13_experts_gpu10</title>
<path fill="none" stroke="black" d="M43901.7,-1160.6C43901.7,-1160.6 43901.7,-1133.81 43901.7,-1133.81"/>
<polygon fill="black" stroke="black" points="43905.2,-1133.81 43901.7,-1123.81 43898.2,-1133.81 43905.2,-1133.81"/>
</g>
<!-- layer13_agg_gpu10 -->
<g id="node420" class="node">
<title>layer13_agg_gpu10</title>
<ellipse fill="lightpink" stroke="black" cx="43898.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="43898.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 10</text>
<text text-anchor="middle" x="43898.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="43898.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="43898.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer13_experts_gpu10&#45;&gt;layer13_agg_gpu10 -->
<g id="edge471" class="edge">
<title>layer13_experts_gpu10&#45;&gt;layer13_agg_gpu10</title>
<path fill="none" stroke="black" d="M43901.7,-1049.52C43901.7,-1049.52 43901.7,-1022.85 43901.7,-1022.85"/>
<polygon fill="black" stroke="black" points="43905.2,-1022.85 43901.7,-1012.85 43898.2,-1022.85 43905.2,-1022.85"/>
</g>
<!-- layer13_agg_gpu10&#45;&gt;layer13_moe_agg -->
<g id="edge472" class="edge">
<title>layer13_agg_gpu10&#45;&gt;layer13_moe_agg</title>
<path fill="none" stroke="black" d="M44089.3,-965.4C44089.3,-938.6 44089.3,-870 44089.3,-870 44089.3,-870 44362.53,-870 44362.53,-870"/>
<polygon fill="black" stroke="black" points="44362.53,-873.5 44372.53,-870 44362.53,-866.5 44362.53,-873.5"/>
</g>
<!-- layer13_experts_gpu11 -->
<g id="node422" class="node">
<title>layer13_experts_gpu11</title>
<polygon fill="lightcoral" stroke="black" points="44419.2,-1123.71 44210.2,-1123.71 44210.2,-1049.71 44419.2,-1049.71 44419.2,-1123.71"/>
<text text-anchor="middle" x="44314.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 11</text>
<text text-anchor="middle" x="44314.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="44314.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="44314.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="44314.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="44314.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer13_route_gpu11&#45;&gt;layer13_experts_gpu11 -->
<g id="edge474" class="edge">
<title>layer13_route_gpu11&#45;&gt;layer13_experts_gpu11</title>
<path fill="none" stroke="black" d="M44314.7,-1160.6C44314.7,-1160.6 44314.7,-1133.81 44314.7,-1133.81"/>
<polygon fill="black" stroke="black" points="44318.2,-1133.81 44314.7,-1123.81 44311.2,-1133.81 44318.2,-1133.81"/>
</g>
<!-- layer13_agg_gpu11 -->
<g id="node423" class="node">
<title>layer13_agg_gpu11</title>
<ellipse fill="lightpink" stroke="black" cx="44313.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="44313.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 11</text>
<text text-anchor="middle" x="44313.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="44313.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="44313.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer13_experts_gpu11&#45;&gt;layer13_agg_gpu11 -->
<g id="edge475" class="edge">
<title>layer13_experts_gpu11&#45;&gt;layer13_agg_gpu11</title>
<path fill="none" stroke="black" d="M44314.7,-1049.52C44314.7,-1049.52 44314.7,-1022.85 44314.7,-1022.85"/>
<polygon fill="black" stroke="black" points="44318.2,-1022.85 44314.7,-1012.85 44311.2,-1022.85 44318.2,-1022.85"/>
</g>
<!-- layer13_agg_gpu11&#45;&gt;layer13_moe_agg -->
<g id="edge476" class="edge">
<title>layer13_agg_gpu11&#45;&gt;layer13_moe_agg</title>
<path fill="none" stroke="black" d="M44414.02,-943.88C44414.02,-943.88 44414.02,-887.36 44414.02,-887.36"/>
<polygon fill="black" stroke="black" points="44417.52,-887.36 44414.02,-877.36 44410.52,-887.36 44417.52,-887.36"/>
</g>
<!-- layer13_experts_gpu12 -->
<g id="node425" class="node">
<title>layer13_experts_gpu12</title>
<polygon fill="lightcoral" stroke="black" points="44832.2,-1123.71 44623.2,-1123.71 44623.2,-1049.71 44832.2,-1049.71 44832.2,-1123.71"/>
<text text-anchor="middle" x="44727.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 12</text>
<text text-anchor="middle" x="44727.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="44727.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="44727.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="44727.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="44727.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer13_route_gpu12&#45;&gt;layer13_experts_gpu12 -->
<g id="edge478" class="edge">
<title>layer13_route_gpu12&#45;&gt;layer13_experts_gpu12</title>
<path fill="none" stroke="black" d="M44727.7,-1160.6C44727.7,-1160.6 44727.7,-1133.81 44727.7,-1133.81"/>
<polygon fill="black" stroke="black" points="44731.2,-1133.81 44727.7,-1123.81 44724.2,-1133.81 44731.2,-1133.81"/>
</g>
<!-- layer13_agg_gpu12 -->
<g id="node426" class="node">
<title>layer13_agg_gpu12</title>
<ellipse fill="lightpink" stroke="black" cx="44728.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="44728.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 12</text>
<text text-anchor="middle" x="44728.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="44728.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="44728.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer13_experts_gpu12&#45;&gt;layer13_agg_gpu12 -->
<g id="edge479" class="edge">
<title>layer13_experts_gpu12&#45;&gt;layer13_agg_gpu12</title>
<path fill="none" stroke="black" d="M44727.7,-1049.52C44727.7,-1049.52 44727.7,-1022.85 44727.7,-1022.85"/>
<polygon fill="black" stroke="black" points="44731.2,-1022.85 44727.7,-1012.85 44724.2,-1022.85 44731.2,-1022.85"/>
</g>
<!-- layer13_agg_gpu12&#45;&gt;layer13_moe_agg -->
<g id="edge480" class="edge">
<title>layer13_agg_gpu12&#45;&gt;layer13_moe_agg</title>
<path fill="none" stroke="black" d="M44627.88,-944.22C44627.88,-944.22 44627.88,-887.54 44627.88,-887.54"/>
<polygon fill="black" stroke="black" points="44631.38,-887.54 44627.88,-877.54 44624.38,-887.54 44631.38,-887.54"/>
</g>
<!-- layer13_experts_gpu13 -->
<g id="node428" class="node">
<title>layer13_experts_gpu13</title>
<polygon fill="lightcoral" stroke="black" points="45247.2,-1123.71 45038.2,-1123.71 45038.2,-1049.71 45247.2,-1049.71 45247.2,-1123.71"/>
<text text-anchor="middle" x="45142.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 13</text>
<text text-anchor="middle" x="45142.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="45142.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="45142.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="45142.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="45142.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer13_route_gpu13&#45;&gt;layer13_experts_gpu13 -->
<g id="edge482" class="edge">
<title>layer13_route_gpu13&#45;&gt;layer13_experts_gpu13</title>
<path fill="none" stroke="black" d="M45142.7,-1160.6C45142.7,-1160.6 45142.7,-1133.81 45142.7,-1133.81"/>
<polygon fill="black" stroke="black" points="45146.2,-1133.81 45142.7,-1123.81 45139.2,-1133.81 45146.2,-1133.81"/>
</g>
<!-- layer13_agg_gpu13 -->
<g id="node429" class="node">
<title>layer13_agg_gpu13</title>
<ellipse fill="lightpink" stroke="black" cx="45143.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="45143.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 13</text>
<text text-anchor="middle" x="45143.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="45143.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="45143.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer13_experts_gpu13&#45;&gt;layer13_agg_gpu13 -->
<g id="edge483" class="edge">
<title>layer13_experts_gpu13&#45;&gt;layer13_agg_gpu13</title>
<path fill="none" stroke="black" d="M45142.7,-1049.52C45142.7,-1049.52 45142.7,-1022.85 45142.7,-1022.85"/>
<polygon fill="black" stroke="black" points="45146.2,-1022.85 45142.7,-1012.85 45139.2,-1022.85 45146.2,-1022.85"/>
</g>
<!-- layer13_agg_gpu13&#45;&gt;layer13_moe_agg -->
<g id="edge484" class="edge">
<title>layer13_agg_gpu13&#45;&gt;layer13_moe_agg</title>
<path fill="none" stroke="black" d="M45143.7,-938.89C45143.7,-908.34 45143.7,-870 45143.7,-870 45143.7,-870 44678.73,-870 44678.73,-870"/>
<polygon fill="black" stroke="black" points="44678.73,-866.5 44668.73,-870 44678.73,-873.5 44678.73,-866.5"/>
</g>
<!-- layer13_experts_gpu14 -->
<g id="node431" class="node">
<title>layer13_experts_gpu14</title>
<polygon fill="lightcoral" stroke="black" points="45661.2,-1123.71 45452.2,-1123.71 45452.2,-1049.71 45661.2,-1049.71 45661.2,-1123.71"/>
<text text-anchor="middle" x="45556.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 14</text>
<text text-anchor="middle" x="45556.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="45556.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="45556.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="45556.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="45556.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer13_route_gpu14&#45;&gt;layer13_experts_gpu14 -->
<g id="edge486" class="edge">
<title>layer13_route_gpu14&#45;&gt;layer13_experts_gpu14</title>
<path fill="none" stroke="black" d="M45556.7,-1160.6C45556.7,-1160.6 45556.7,-1133.81 45556.7,-1133.81"/>
<polygon fill="black" stroke="black" points="45560.2,-1133.81 45556.7,-1123.81 45553.2,-1133.81 45560.2,-1133.81"/>
</g>
<!-- layer13_agg_gpu14 -->
<g id="node432" class="node">
<title>layer13_agg_gpu14</title>
<ellipse fill="lightpink" stroke="black" cx="45558.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="45558.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 14</text>
<text text-anchor="middle" x="45558.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="45558.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="45558.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer13_experts_gpu14&#45;&gt;layer13_agg_gpu14 -->
<g id="edge487" class="edge">
<title>layer13_experts_gpu14&#45;&gt;layer13_agg_gpu14</title>
<path fill="none" stroke="black" d="M45556.7,-1049.52C45556.7,-1049.52 45556.7,-1022.85 45556.7,-1022.85"/>
<polygon fill="black" stroke="black" points="45560.2,-1022.85 45556.7,-1012.85 45553.2,-1022.85 45560.2,-1022.85"/>
</g>
<!-- layer13_agg_gpu14&#45;&gt;layer13_moe_agg -->
<g id="edge488" class="edge">
<title>layer13_agg_gpu14&#45;&gt;layer13_moe_agg</title>
<path fill="none" stroke="black" d="M45558.7,-938.95C45558.7,-904.36 45558.7,-858 45558.7,-858 45558.7,-858 44716.57,-858 44716.57,-858"/>
<polygon fill="black" stroke="black" points="44716.57,-854.5 44706.57,-858 44716.57,-861.5 44716.57,-854.5"/>
</g>
<!-- layer13_experts_gpu15 -->
<g id="node434" class="node">
<title>layer13_experts_gpu15</title>
<polygon fill="lightcoral" stroke="black" points="46073.2,-1123.71 45864.2,-1123.71 45864.2,-1049.71 46073.2,-1049.71 46073.2,-1123.71"/>
<text text-anchor="middle" x="45968.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 15</text>
<text text-anchor="middle" x="45968.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="45968.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="45968.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="45968.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="45968.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer13_route_gpu15&#45;&gt;layer13_experts_gpu15 -->
<g id="edge490" class="edge">
<title>layer13_route_gpu15&#45;&gt;layer13_experts_gpu15</title>
<path fill="none" stroke="black" d="M45968.7,-1160.6C45968.7,-1160.6 45968.7,-1133.81 45968.7,-1133.81"/>
<polygon fill="black" stroke="black" points="45972.2,-1133.81 45968.7,-1123.81 45965.2,-1133.81 45972.2,-1133.81"/>
</g>
<!-- layer13_agg_gpu15 -->
<g id="node435" class="node">
<title>layer13_agg_gpu15</title>
<ellipse fill="lightpink" stroke="black" cx="45973.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="45973.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 15</text>
<text text-anchor="middle" x="45973.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="45973.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="45973.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer13_experts_gpu15&#45;&gt;layer13_agg_gpu15 -->
<g id="edge491" class="edge">
<title>layer13_experts_gpu15&#45;&gt;layer13_agg_gpu15</title>
<path fill="none" stroke="black" d="M45968.7,-1049.52C45968.7,-1049.52 45968.7,-1022.85 45968.7,-1022.85"/>
<polygon fill="black" stroke="black" points="45972.2,-1022.85 45968.7,-1012.85 45965.2,-1022.85 45972.2,-1022.85"/>
</g>
<!-- layer13_agg_gpu15&#45;&gt;layer13_moe_agg -->
<g id="edge492" class="edge">
<title>layer13_agg_gpu15&#45;&gt;layer13_moe_agg</title>
<path fill="none" stroke="black" d="M45973.7,-939.12C45973.7,-900.39 45973.7,-845 45973.7,-845 45973.7,-845 44734.26,-845 44734.26,-845"/>
<polygon fill="black" stroke="black" points="44734.26,-841.5 44724.26,-845 44734.26,-848.5 44734.26,-841.5"/>
</g>
<!-- layer14_ln1 -->
<g id="node437" class="node">
<title>layer14_ln1</title>
<polygon fill="none" stroke="black" points="46225.2,-1365.75 45944.2,-1365.75 45944.2,-1302.75 46225.2,-1302.75 46225.2,-1365.75"/>
<text text-anchor="middle" x="46084.7" y="-1353.75" font-family="Arial" font-size="10.00">LayerNorm MHA 14</text>
<text text-anchor="middle" x="46084.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="46084.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="46084.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="46084.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer14_add1 -->
<g id="node438" class="node">
<title>layer14_add1</title>
<polygon fill="yellow" stroke="black" points="47682.2,-728.4 47401.2,-728.4 47401.2,-676.4 47682.2,-676.4 47682.2,-728.4"/>
<text text-anchor="middle" x="47541.7" y="-716.4" font-family="Arial" font-size="10.00">MHA Residual Add 14</text>
<text text-anchor="middle" x="47541.7" y="-705.4" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="47541.7" y="-694.4" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="47541.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer14_moe_output -->
<g id="node442" class="node">
<title>layer14_moe_output</title>
<polygon fill="yellow" stroke="black" points="47763.2,-617.63 47482.2,-617.63 47482.2,-565.63 47763.2,-565.63 47763.2,-617.63"/>
<text text-anchor="middle" x="47622.7" y="-605.63" font-family="Arial" font-size="10.00">MoE Residual Add 14</text>
<text text-anchor="middle" x="47622.7" y="-594.63" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="47622.7" y="-583.63" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="47622.7" y="-572.63" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer14_add1&#45;&gt;layer14_moe_output -->
<g id="edge530" class="edge">
<title>layer14_add1&#45;&gt;layer14_moe_output</title>
<path fill="none" stroke="black" d="M47582.2,-676.15C47582.2,-676.15 47582.2,-627.7 47582.2,-627.7"/>
<polygon fill="black" stroke="black" points="47585.7,-627.7 47582.2,-617.7 47578.7,-627.7 47585.7,-627.7"/>
</g>
<!-- layer14_gate -->
<g id="node439" class="node">
<title>layer14_gate</title>
<polygon fill="lightgreen" stroke="black" points="48033.13,-1397.25 47574.3,-1397.25 47456.26,-1271.25 47915.1,-1271.25 48033.13,-1397.25"/>
<text text-anchor="middle" x="47744.7" y="-1353.75" font-family="Arial" font-size="10.00">Gate Layer 14</text>
<text text-anchor="middle" x="47744.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="47744.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="47744.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="47744.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, num_experts=16]</text>
</g>
<!-- layer14_route_gpu8 -->
<g id="node443" class="node">
<title>layer14_route_gpu8</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="46393.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="46393.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 8</text>
<text text-anchor="middle" x="46393.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="46393.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="46393.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer14_gate&#45;&gt;layer14_route_gpu8 -->
<g id="edge496" class="edge">
<title>layer14_gate&#45;&gt;layer14_route_gpu8</title>
<path fill="none" stroke="black" d="M47476.27,-1293C47085.57,-1293 46406.32,-1293 46406.32,-1293 46406.32,-1293 46406.32,-1244.41 46406.32,-1244.41"/>
<polygon fill="black" stroke="black" points="46409.82,-1244.41 46406.32,-1234.41 46402.82,-1244.41 46409.82,-1244.41"/>
</g>
<!-- layer14_route_gpu9 -->
<g id="node446" class="node">
<title>layer14_route_gpu9</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="46813.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="46813.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 9</text>
<text text-anchor="middle" x="46813.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="46813.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="46813.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer14_gate&#45;&gt;layer14_route_gpu9 -->
<g id="edge500" class="edge">
<title>layer14_gate&#45;&gt;layer14_route_gpu9</title>
<path fill="none" stroke="black" d="M47468.2,-1284C47193.74,-1284 46813.7,-1284 46813.7,-1284 46813.7,-1284 46813.7,-1244.42 46813.7,-1244.42"/>
<polygon fill="black" stroke="black" points="46817.2,-1244.42 46813.7,-1234.42 46810.2,-1244.42 46817.2,-1244.42"/>
</g>
<!-- layer14_route_gpu10 -->
<g id="node449" class="node">
<title>layer14_route_gpu10</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="47225.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="47225.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 10</text>
<text text-anchor="middle" x="47225.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="47225.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="47225.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer14_gate&#45;&gt;layer14_route_gpu10 -->
<g id="edge504" class="edge">
<title>layer14_gate&#45;&gt;layer14_route_gpu10</title>
<path fill="none" stroke="black" d="M47459.76,-1275C47339.02,-1275 47225.7,-1275 47225.7,-1275 47225.7,-1275 47225.7,-1244.42 47225.7,-1244.42"/>
<polygon fill="black" stroke="black" points="47229.2,-1244.42 47225.7,-1234.42 47222.2,-1244.42 47229.2,-1244.42"/>
</g>
<!-- layer14_route_gpu11 -->
<g id="node452" class="node">
<title>layer14_route_gpu11</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="47634.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="47634.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 11</text>
<text text-anchor="middle" x="47634.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="47634.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="47634.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer14_gate&#45;&gt;layer14_route_gpu11 -->
<g id="edge508" class="edge">
<title>layer14_gate&#45;&gt;layer14_route_gpu11</title>
<path fill="none" stroke="black" d="M47642.46,-1271.07C47642.46,-1271.07 47642.46,-1244.29 47642.46,-1244.29"/>
<polygon fill="black" stroke="black" points="47645.96,-1244.29 47642.46,-1234.29 47638.96,-1244.29 47645.96,-1244.29"/>
</g>
<!-- layer14_route_gpu12 -->
<g id="node455" class="node">
<title>layer14_route_gpu12</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="48044.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="48044.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 12</text>
<text text-anchor="middle" x="48044.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="48044.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="48044.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer14_gate&#45;&gt;layer14_route_gpu12 -->
<g id="edge512" class="edge">
<title>layer14_gate&#45;&gt;layer14_route_gpu12</title>
<path fill="none" stroke="black" d="M47941.93,-1299.74C47941.93,-1299.74 47941.93,-1238.71 47941.93,-1238.71"/>
<polygon fill="black" stroke="black" points="47945.43,-1238.71 47941.93,-1228.71 47938.43,-1238.71 47945.43,-1238.71"/>
</g>
<!-- layer14_route_gpu13 -->
<g id="node458" class="node">
<title>layer14_route_gpu13</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="48456.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="48456.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 13</text>
<text text-anchor="middle" x="48456.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="48456.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="48456.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer14_gate&#45;&gt;layer14_route_gpu13 -->
<g id="edge516" class="edge">
<title>layer14_gate&#45;&gt;layer14_route_gpu13</title>
<path fill="none" stroke="black" d="M47923.45,-1280C48134.35,-1280 48456.7,-1280 48456.7,-1280 48456.7,-1280 48456.7,-1244.4 48456.7,-1244.4"/>
<polygon fill="black" stroke="black" points="48460.2,-1244.4 48456.7,-1234.4 48453.2,-1244.4 48460.2,-1244.4"/>
</g>
<!-- layer14_route_gpu14 -->
<g id="node461" class="node">
<title>layer14_route_gpu14</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="48870.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="48870.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 14</text>
<text text-anchor="middle" x="48870.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="48870.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="48870.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer14_gate&#45;&gt;layer14_route_gpu14 -->
<g id="edge520" class="edge">
<title>layer14_gate&#45;&gt;layer14_route_gpu14</title>
<path fill="none" stroke="black" d="M47931.9,-1289C48252.08,-1289 48870.7,-1289 48870.7,-1289 48870.7,-1289 48870.7,-1244.44 48870.7,-1244.44"/>
<polygon fill="black" stroke="black" points="48874.2,-1244.44 48870.7,-1234.44 48867.2,-1244.44 48874.2,-1244.44"/>
</g>
<!-- layer14_route_gpu15 -->
<g id="node464" class="node">
<title>layer14_route_gpu15</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="49284.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="49284.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 15</text>
<text text-anchor="middle" x="49284.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="49284.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="49284.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer14_gate&#45;&gt;layer14_route_gpu15 -->
<g id="edge524" class="edge">
<title>layer14_gate&#45;&gt;layer14_route_gpu15</title>
<path fill="none" stroke="black" d="M47940.52,-1298C48355.3,-1298 49284.7,-1298 49284.7,-1298 49284.7,-1298 49284.7,-1244.34 49284.7,-1244.34"/>
<polygon fill="black" stroke="black" points="49288.2,-1244.34 49284.7,-1234.34 49281.2,-1244.34 49288.2,-1244.34"/>
</g>
<!-- layer14_moe_agg -->
<g id="node440" class="node">
<title>layer14_moe_agg</title>
<ellipse fill="gold" stroke="black" cx="47840.7" cy="-839.17" rx="205.12" ry="44.6"/>
<text text-anchor="middle" x="47840.7" y="-858.67" font-family="Arial" font-size="10.00">MoE Final Aggregation 14</text>
<text text-anchor="middle" x="47840.7" y="-847.67" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="47840.7" y="-836.67" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="47840.7" y="-825.67" font-family="Arial" font-size="10.00">Input: 16Ã—[batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="47840.7" y="-814.67" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer14_ln2 -->
<g id="node441" class="node">
<title>layer14_ln2</title>
<polygon fill="none" stroke="black" points="47981.2,-733.9 47700.2,-733.9 47700.2,-670.9 47981.2,-670.9 47981.2,-733.9"/>
<text text-anchor="middle" x="47840.7" y="-721.9" font-family="Arial" font-size="10.00">LayerNorm MoE 14</text>
<text text-anchor="middle" x="47840.7" y="-710.9" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="47840.7" y="-699.9" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="47840.7" y="-688.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="47840.7" y="-677.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer14_moe_agg&#45;&gt;layer14_ln2 -->
<g id="edge528" class="edge">
<title>layer14_moe_agg&#45;&gt;layer14_ln2</title>
<path fill="none" stroke="black" d="M47840.7,-794.39C47840.7,-794.39 47840.7,-744.29 47840.7,-744.29"/>
<polygon fill="black" stroke="black" points="47844.2,-744.29 47840.7,-734.29 47837.2,-744.29 47844.2,-744.29"/>
</g>
<!-- layer14_ln2&#45;&gt;layer14_moe_output -->
<g id="edge529" class="edge">
<title>layer14_ln2&#45;&gt;layer14_moe_output</title>
<path fill="none" stroke="black" d="M47731.7,-670.66C47731.7,-670.66 47731.7,-627.78 47731.7,-627.78"/>
<polygon fill="black" stroke="black" points="47735.2,-627.78 47731.7,-617.78 47728.2,-627.78 47735.2,-627.78"/>
</g>
<!-- layer15_mha -->
<g id="node467" class="node">
<title>layer15_mha</title>
<polygon fill="lightcyan" stroke="black" points="47763.2,-483.37 47482.2,-483.37 47482.2,-420.37 47763.2,-420.37 47763.2,-483.37"/>
<text text-anchor="middle" x="47622.7" y="-471.37" font-family="Arial" font-size="10.00">MHA Layer 15</text>
<text text-anchor="middle" x="47622.7" y="-460.37" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="47622.7" y="-449.37" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="47622.7" y="-438.37" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="47622.7" y="-427.37" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer14_moe_output&#45;&gt;layer15_mha -->
<g id="edge580" class="edge">
<title>layer14_moe_output&#45;&gt;layer15_mha</title>
<path fill="none" stroke="black" d="M47622.7,-565.34C47622.7,-565.34 47622.7,-493.42 47622.7,-493.42"/>
<polygon fill="black" stroke="black" points="47626.2,-493.42 47622.7,-483.42 47619.2,-493.42 47626.2,-493.42"/>
</g>
<!-- layer14_experts_gpu8 -->
<g id="node444" class="node">
<title>layer14_experts_gpu8</title>
<polygon fill="lightcoral" stroke="black" points="46495.2,-1123.71 46286.2,-1123.71 46286.2,-1049.71 46495.2,-1049.71 46495.2,-1123.71"/>
<text text-anchor="middle" x="46390.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 8</text>
<text text-anchor="middle" x="46390.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="46390.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="46390.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="46390.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="46390.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer14_route_gpu8&#45;&gt;layer14_experts_gpu8 -->
<g id="edge497" class="edge">
<title>layer14_route_gpu8&#45;&gt;layer14_experts_gpu8</title>
<path fill="none" stroke="black" d="M46390.7,-1160.6C46390.7,-1160.6 46390.7,-1133.81 46390.7,-1133.81"/>
<polygon fill="black" stroke="black" points="46394.2,-1133.81 46390.7,-1123.81 46387.2,-1133.81 46394.2,-1133.81"/>
</g>
<!-- layer14_agg_gpu8 -->
<g id="node445" class="node">
<title>layer14_agg_gpu8</title>
<ellipse fill="lightpink" stroke="black" cx="46388.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="46388.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 8</text>
<text text-anchor="middle" x="46388.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="46388.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="46388.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer14_experts_gpu8&#45;&gt;layer14_agg_gpu8 -->
<g id="edge498" class="edge">
<title>layer14_experts_gpu8&#45;&gt;layer14_agg_gpu8</title>
<path fill="none" stroke="black" d="M46390.7,-1049.52C46390.7,-1049.52 46390.7,-1022.85 46390.7,-1022.85"/>
<polygon fill="black" stroke="black" points="46394.2,-1022.85 46390.7,-1012.85 46387.2,-1022.85 46394.2,-1022.85"/>
</g>
<!-- layer14_agg_gpu8&#45;&gt;layer14_moe_agg -->
<g id="edge499" class="edge">
<title>layer14_agg_gpu8&#45;&gt;layer14_moe_agg</title>
<path fill="none" stroke="black" d="M46388.7,-938.87C46388.7,-889.14 46388.7,-807 46388.7,-807 46388.7,-807 47688.83,-807 47688.83,-807"/>
<polygon fill="black" stroke="black" points="47688.83,-810.5 47698.83,-807 47688.83,-803.5 47688.83,-810.5"/>
</g>
<!-- layer14_experts_gpu9 -->
<g id="node447" class="node">
<title>layer14_experts_gpu9</title>
<polygon fill="lightcoral" stroke="black" points="46915.2,-1123.71 46706.2,-1123.71 46706.2,-1049.71 46915.2,-1049.71 46915.2,-1123.71"/>
<text text-anchor="middle" x="46810.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 9</text>
<text text-anchor="middle" x="46810.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="46810.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="46810.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="46810.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="46810.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer14_route_gpu9&#45;&gt;layer14_experts_gpu9 -->
<g id="edge501" class="edge">
<title>layer14_route_gpu9&#45;&gt;layer14_experts_gpu9</title>
<path fill="none" stroke="black" d="M46810.7,-1160.6C46810.7,-1160.6 46810.7,-1133.81 46810.7,-1133.81"/>
<polygon fill="black" stroke="black" points="46814.2,-1133.81 46810.7,-1123.81 46807.2,-1133.81 46814.2,-1133.81"/>
</g>
<!-- layer14_agg_gpu9 -->
<g id="node448" class="node">
<title>layer14_agg_gpu9</title>
<ellipse fill="lightpink" stroke="black" cx="46803.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="46803.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 9</text>
<text text-anchor="middle" x="46803.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="46803.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="46803.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer14_experts_gpu9&#45;&gt;layer14_agg_gpu9 -->
<g id="edge502" class="edge">
<title>layer14_experts_gpu9&#45;&gt;layer14_agg_gpu9</title>
<path fill="none" stroke="black" d="M46810.7,-1049.52C46810.7,-1049.52 46810.7,-1022.85 46810.7,-1022.85"/>
<polygon fill="black" stroke="black" points="46814.2,-1022.85 46810.7,-1012.85 46807.2,-1022.85 46814.2,-1022.85"/>
</g>
<!-- layer14_agg_gpu9&#45;&gt;layer14_moe_agg -->
<g id="edge503" class="edge">
<title>layer14_agg_gpu9&#45;&gt;layer14_moe_agg</title>
<path fill="none" stroke="black" d="M46803.7,-938.99C46803.7,-892.87 46803.7,-820 46803.7,-820 46803.7,-820 47645.6,-820 47645.6,-820"/>
<polygon fill="black" stroke="black" points="47645.6,-823.5 47655.6,-820 47645.6,-816.5 47645.6,-823.5"/>
</g>
<!-- layer14_experts_gpu10 -->
<g id="node450" class="node">
<title>layer14_experts_gpu10</title>
<polygon fill="lightcoral" stroke="black" points="47328.2,-1123.71 47119.2,-1123.71 47119.2,-1049.71 47328.2,-1049.71 47328.2,-1123.71"/>
<text text-anchor="middle" x="47223.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 10</text>
<text text-anchor="middle" x="47223.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="47223.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="47223.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="47223.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="47223.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer14_route_gpu10&#45;&gt;layer14_experts_gpu10 -->
<g id="edge505" class="edge">
<title>layer14_route_gpu10&#45;&gt;layer14_experts_gpu10</title>
<path fill="none" stroke="black" d="M47223.7,-1160.6C47223.7,-1160.6 47223.7,-1133.81 47223.7,-1133.81"/>
<polygon fill="black" stroke="black" points="47227.2,-1133.81 47223.7,-1123.81 47220.2,-1133.81 47227.2,-1133.81"/>
</g>
<!-- layer14_agg_gpu10 -->
<g id="node451" class="node">
<title>layer14_agg_gpu10</title>
<ellipse fill="lightpink" stroke="black" cx="47218.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="47218.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 10</text>
<text text-anchor="middle" x="47218.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="47218.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="47218.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer14_experts_gpu10&#45;&gt;layer14_agg_gpu10 -->
<g id="edge506" class="edge">
<title>layer14_experts_gpu10&#45;&gt;layer14_agg_gpu10</title>
<path fill="none" stroke="black" d="M47223.7,-1049.52C47223.7,-1049.52 47223.7,-1022.85 47223.7,-1022.85"/>
<polygon fill="black" stroke="black" points="47227.2,-1022.85 47223.7,-1012.85 47220.2,-1022.85 47227.2,-1022.85"/>
</g>
<!-- layer14_agg_gpu10&#45;&gt;layer14_moe_agg -->
<g id="edge507" class="edge">
<title>layer14_agg_gpu10&#45;&gt;layer14_moe_agg</title>
<path fill="none" stroke="black" d="M47409.3,-965.12C47409.3,-931.65 47409.3,-832 47409.3,-832 47409.3,-832 47628.26,-832 47628.26,-832"/>
<polygon fill="black" stroke="black" points="47628.26,-835.5 47638.26,-832 47628.26,-828.5 47628.26,-835.5"/>
</g>
<!-- layer14_experts_gpu11 -->
<g id="node453" class="node">
<title>layer14_experts_gpu11</title>
<polygon fill="lightcoral" stroke="black" points="47738.2,-1123.71 47529.2,-1123.71 47529.2,-1049.71 47738.2,-1049.71 47738.2,-1123.71"/>
<text text-anchor="middle" x="47633.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 11</text>
<text text-anchor="middle" x="47633.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="47633.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="47633.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="47633.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="47633.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer14_route_gpu11&#45;&gt;layer14_experts_gpu11 -->
<g id="edge509" class="edge">
<title>layer14_route_gpu11&#45;&gt;layer14_experts_gpu11</title>
<path fill="none" stroke="black" d="M47633.7,-1160.6C47633.7,-1160.6 47633.7,-1133.81 47633.7,-1133.81"/>
<polygon fill="black" stroke="black" points="47637.2,-1133.81 47633.7,-1123.81 47630.2,-1133.81 47637.2,-1133.81"/>
</g>
<!-- layer14_agg_gpu11 -->
<g id="node454" class="node">
<title>layer14_agg_gpu11</title>
<ellipse fill="lightpink" stroke="black" cx="47633.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="47633.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 11</text>
<text text-anchor="middle" x="47633.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="47633.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="47633.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer14_experts_gpu11&#45;&gt;layer14_agg_gpu11 -->
<g id="edge510" class="edge">
<title>layer14_experts_gpu11&#45;&gt;layer14_agg_gpu11</title>
<path fill="none" stroke="black" d="M47633.7,-1049.52C47633.7,-1049.52 47633.7,-1022.85 47633.7,-1022.85"/>
<polygon fill="black" stroke="black" points="47637.2,-1022.85 47633.7,-1012.85 47630.2,-1022.85 47637.2,-1022.85"/>
</g>
<!-- layer14_agg_gpu11&#45;&gt;layer14_moe_agg -->
<g id="edge511" class="edge">
<title>layer14_agg_gpu11&#45;&gt;layer14_moe_agg</title>
<path fill="none" stroke="black" d="M47734.02,-943.88C47734.02,-943.88 47734.02,-887.36 47734.02,-887.36"/>
<polygon fill="black" stroke="black" points="47737.52,-887.36 47734.02,-877.36 47730.52,-887.36 47737.52,-887.36"/>
</g>
<!-- layer14_experts_gpu12 -->
<g id="node456" class="node">
<title>layer14_experts_gpu12</title>
<polygon fill="lightcoral" stroke="black" points="48152.2,-1123.71 47943.2,-1123.71 47943.2,-1049.71 48152.2,-1049.71 48152.2,-1123.71"/>
<text text-anchor="middle" x="48047.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 12</text>
<text text-anchor="middle" x="48047.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="48047.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="48047.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="48047.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="48047.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer14_route_gpu12&#45;&gt;layer14_experts_gpu12 -->
<g id="edge513" class="edge">
<title>layer14_route_gpu12&#45;&gt;layer14_experts_gpu12</title>
<path fill="none" stroke="black" d="M48047.7,-1160.6C48047.7,-1160.6 48047.7,-1133.81 48047.7,-1133.81"/>
<polygon fill="black" stroke="black" points="48051.2,-1133.81 48047.7,-1123.81 48044.2,-1133.81 48051.2,-1133.81"/>
</g>
<!-- layer14_agg_gpu12 -->
<g id="node457" class="node">
<title>layer14_agg_gpu12</title>
<ellipse fill="lightpink" stroke="black" cx="48048.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="48048.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 12</text>
<text text-anchor="middle" x="48048.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="48048.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="48048.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer14_experts_gpu12&#45;&gt;layer14_agg_gpu12 -->
<g id="edge514" class="edge">
<title>layer14_experts_gpu12&#45;&gt;layer14_agg_gpu12</title>
<path fill="none" stroke="black" d="M48047.7,-1049.52C48047.7,-1049.52 48047.7,-1022.85 48047.7,-1022.85"/>
<polygon fill="black" stroke="black" points="48051.2,-1022.85 48047.7,-1012.85 48044.2,-1022.85 48051.2,-1022.85"/>
</g>
<!-- layer14_agg_gpu12&#45;&gt;layer14_moe_agg -->
<g id="edge515" class="edge">
<title>layer14_agg_gpu12&#45;&gt;layer14_moe_agg</title>
<path fill="none" stroke="black" d="M47947.88,-944.22C47947.88,-944.22 47947.88,-887.54 47947.88,-887.54"/>
<polygon fill="black" stroke="black" points="47951.38,-887.54 47947.88,-877.54 47944.38,-887.54 47951.38,-887.54"/>
</g>
<!-- layer14_experts_gpu13 -->
<g id="node459" class="node">
<title>layer14_experts_gpu13</title>
<polygon fill="lightcoral" stroke="black" points="48564.2,-1123.71 48355.2,-1123.71 48355.2,-1049.71 48564.2,-1049.71 48564.2,-1123.71"/>
<text text-anchor="middle" x="48459.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 13</text>
<text text-anchor="middle" x="48459.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="48459.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="48459.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="48459.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="48459.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer14_route_gpu13&#45;&gt;layer14_experts_gpu13 -->
<g id="edge517" class="edge">
<title>layer14_route_gpu13&#45;&gt;layer14_experts_gpu13</title>
<path fill="none" stroke="black" d="M48459.7,-1160.6C48459.7,-1160.6 48459.7,-1133.81 48459.7,-1133.81"/>
<polygon fill="black" stroke="black" points="48463.2,-1133.81 48459.7,-1123.81 48456.2,-1133.81 48463.2,-1133.81"/>
</g>
<!-- layer14_agg_gpu13 -->
<g id="node460" class="node">
<title>layer14_agg_gpu13</title>
<ellipse fill="lightpink" stroke="black" cx="48463.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="48463.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 13</text>
<text text-anchor="middle" x="48463.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="48463.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="48463.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer14_experts_gpu13&#45;&gt;layer14_agg_gpu13 -->
<g id="edge518" class="edge">
<title>layer14_experts_gpu13&#45;&gt;layer14_agg_gpu13</title>
<path fill="none" stroke="black" d="M48459.7,-1049.52C48459.7,-1049.52 48459.7,-1022.85 48459.7,-1022.85"/>
<polygon fill="black" stroke="black" points="48463.2,-1022.85 48459.7,-1012.85 48456.2,-1022.85 48463.2,-1022.85"/>
</g>
<!-- layer14_agg_gpu13&#45;&gt;layer14_moe_agg -->
<g id="edge519" class="edge">
<title>layer14_agg_gpu13&#45;&gt;layer14_moe_agg</title>
<path fill="none" stroke="black" d="M48463.7,-938.89C48463.7,-908.34 48463.7,-870 48463.7,-870 48463.7,-870 47998.73,-870 47998.73,-870"/>
<polygon fill="black" stroke="black" points="47998.73,-866.5 47988.73,-870 47998.73,-873.5 47998.73,-866.5"/>
</g>
<!-- layer14_experts_gpu14 -->
<g id="node462" class="node">
<title>layer14_experts_gpu14</title>
<polygon fill="lightcoral" stroke="black" points="48978.2,-1123.71 48769.2,-1123.71 48769.2,-1049.71 48978.2,-1049.71 48978.2,-1123.71"/>
<text text-anchor="middle" x="48873.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 14</text>
<text text-anchor="middle" x="48873.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="48873.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="48873.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="48873.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="48873.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer14_route_gpu14&#45;&gt;layer14_experts_gpu14 -->
<g id="edge521" class="edge">
<title>layer14_route_gpu14&#45;&gt;layer14_experts_gpu14</title>
<path fill="none" stroke="black" d="M48873.7,-1160.6C48873.7,-1160.6 48873.7,-1133.81 48873.7,-1133.81"/>
<polygon fill="black" stroke="black" points="48877.2,-1133.81 48873.7,-1123.81 48870.2,-1133.81 48877.2,-1133.81"/>
</g>
<!-- layer14_agg_gpu14 -->
<g id="node463" class="node">
<title>layer14_agg_gpu14</title>
<ellipse fill="lightpink" stroke="black" cx="48878.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="48878.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 14</text>
<text text-anchor="middle" x="48878.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="48878.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="48878.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer14_experts_gpu14&#45;&gt;layer14_agg_gpu14 -->
<g id="edge522" class="edge">
<title>layer14_experts_gpu14&#45;&gt;layer14_agg_gpu14</title>
<path fill="none" stroke="black" d="M48873.7,-1049.52C48873.7,-1049.52 48873.7,-1022.85 48873.7,-1022.85"/>
<polygon fill="black" stroke="black" points="48877.2,-1022.85 48873.7,-1012.85 48870.2,-1022.85 48877.2,-1022.85"/>
</g>
<!-- layer14_agg_gpu14&#45;&gt;layer14_moe_agg -->
<g id="edge523" class="edge">
<title>layer14_agg_gpu14&#45;&gt;layer14_moe_agg</title>
<path fill="none" stroke="black" d="M48878.7,-938.95C48878.7,-904.36 48878.7,-858 48878.7,-858 48878.7,-858 48036.57,-858 48036.57,-858"/>
<polygon fill="black" stroke="black" points="48036.57,-854.5 48026.57,-858 48036.57,-861.5 48036.57,-854.5"/>
</g>
<!-- layer14_experts_gpu15 -->
<g id="node465" class="node">
<title>layer14_experts_gpu15</title>
<polygon fill="lightcoral" stroke="black" points="49395.2,-1123.71 49186.2,-1123.71 49186.2,-1049.71 49395.2,-1049.71 49395.2,-1123.71"/>
<text text-anchor="middle" x="49290.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 15</text>
<text text-anchor="middle" x="49290.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="49290.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="49290.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="49290.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="49290.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer14_route_gpu15&#45;&gt;layer14_experts_gpu15 -->
<g id="edge525" class="edge">
<title>layer14_route_gpu15&#45;&gt;layer14_experts_gpu15</title>
<path fill="none" stroke="black" d="M49290.7,-1160.6C49290.7,-1160.6 49290.7,-1133.81 49290.7,-1133.81"/>
<polygon fill="black" stroke="black" points="49294.2,-1133.81 49290.7,-1123.81 49287.2,-1133.81 49294.2,-1133.81"/>
</g>
<!-- layer14_agg_gpu15 -->
<g id="node466" class="node">
<title>layer14_agg_gpu15</title>
<ellipse fill="lightpink" stroke="black" cx="49293.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="49293.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 15</text>
<text text-anchor="middle" x="49293.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="49293.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="49293.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer14_experts_gpu15&#45;&gt;layer14_agg_gpu15 -->
<g id="edge526" class="edge">
<title>layer14_experts_gpu15&#45;&gt;layer14_agg_gpu15</title>
<path fill="none" stroke="black" d="M49290.7,-1049.52C49290.7,-1049.52 49290.7,-1022.85 49290.7,-1022.85"/>
<polygon fill="black" stroke="black" points="49294.2,-1022.85 49290.7,-1012.85 49287.2,-1022.85 49294.2,-1022.85"/>
</g>
<!-- layer14_agg_gpu15&#45;&gt;layer14_moe_agg -->
<g id="edge527" class="edge">
<title>layer14_agg_gpu15&#45;&gt;layer14_moe_agg</title>
<path fill="none" stroke="black" d="M49293.7,-939.12C49293.7,-900.39 49293.7,-845 49293.7,-845 49293.7,-845 48054.26,-845 48054.26,-845"/>
<polygon fill="black" stroke="black" points="48054.26,-841.5 48044.26,-845 48054.26,-848.5 48054.26,-841.5"/>
</g>
<!-- layer15_ln1 -->
<g id="node468" class="node">
<title>layer15_ln1</title>
<polygon fill="none" stroke="black" points="49843.2,-1365.75 49562.2,-1365.75 49562.2,-1302.75 49843.2,-1302.75 49843.2,-1365.75"/>
<text text-anchor="middle" x="49702.7" y="-1353.75" font-family="Arial" font-size="10.00">LayerNorm MHA 15</text>
<text text-anchor="middle" x="49702.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="49702.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="49702.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="49702.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer15_add1 -->
<g id="node469" class="node">
<title>layer15_add1</title>
<polygon fill="yellow" stroke="black" points="51002.2,-728.4 50721.2,-728.4 50721.2,-676.4 51002.2,-676.4 51002.2,-728.4"/>
<text text-anchor="middle" x="50861.7" y="-716.4" font-family="Arial" font-size="10.00">MHA Residual Add 15</text>
<text text-anchor="middle" x="50861.7" y="-705.4" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="50861.7" y="-694.4" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="50861.7" y="-683.4" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer15_moe_output -->
<g id="node473" class="node">
<title>layer15_moe_output</title>
<polygon fill="yellow" stroke="black" points="51083.2,-617.63 50802.2,-617.63 50802.2,-565.63 51083.2,-565.63 51083.2,-617.63"/>
<text text-anchor="middle" x="50942.7" y="-605.63" font-family="Arial" font-size="10.00">MoE Residual Add 15</text>
<text text-anchor="middle" x="50942.7" y="-594.63" font-family="Arial" font-size="10.00">Input1: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="50942.7" y="-583.63" font-family="Arial" font-size="10.00">Input2: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="50942.7" y="-572.63" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer15_add1&#45;&gt;layer15_moe_output -->
<g id="edge565" class="edge">
<title>layer15_add1&#45;&gt;layer15_moe_output</title>
<path fill="none" stroke="black" d="M50902.2,-676.15C50902.2,-676.15 50902.2,-627.7 50902.2,-627.7"/>
<polygon fill="black" stroke="black" points="50905.7,-627.7 50902.2,-617.7 50898.7,-627.7 50905.7,-627.7"/>
</g>
<!-- layer15_gate -->
<g id="node470" class="node">
<title>layer15_gate</title>
<polygon fill="lightgreen" stroke="black" points="51448.13,-1397.25 50989.3,-1397.25 50871.26,-1271.25 51330.1,-1271.25 51448.13,-1397.25"/>
<text text-anchor="middle" x="51159.7" y="-1353.75" font-family="Arial" font-size="10.00">Gate Layer 15</text>
<text text-anchor="middle" x="51159.7" y="-1342.75" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="51159.7" y="-1331.75" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="51159.7" y="-1320.75" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="51159.7" y="-1309.75" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, num_experts=16]</text>
</g>
<!-- layer15_route_gpu8 -->
<g id="node474" class="node">
<title>layer15_route_gpu8</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="49714.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="49714.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 8</text>
<text text-anchor="middle" x="49714.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="49714.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="49714.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer15_gate&#45;&gt;layer15_route_gpu8 -->
<g id="edge531" class="edge">
<title>layer15_gate&#45;&gt;layer15_route_gpu8</title>
<path fill="none" stroke="black" d="M50891.34,-1293C50514.97,-1293 49875.82,-1293 49875.82,-1293 49875.82,-1293 49875.82,-1228.21 49875.82,-1228.21"/>
<polygon fill="black" stroke="black" points="49879.32,-1228.21 49875.82,-1218.21 49872.32,-1228.21 49879.32,-1228.21"/>
</g>
<!-- layer15_route_gpu9 -->
<g id="node477" class="node">
<title>layer15_route_gpu9</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="50134.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="50134.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 9</text>
<text text-anchor="middle" x="50134.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="50134.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="50134.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer15_gate&#45;&gt;layer15_route_gpu9 -->
<g id="edge535" class="edge">
<title>layer15_gate&#45;&gt;layer15_route_gpu9</title>
<path fill="none" stroke="black" d="M50882.99,-1284C50579.42,-1284 50134.7,-1284 50134.7,-1284 50134.7,-1284 50134.7,-1244.42 50134.7,-1244.42"/>
<polygon fill="black" stroke="black" points="50138.2,-1244.42 50134.7,-1234.42 50131.2,-1244.42 50138.2,-1244.42"/>
</g>
<!-- layer15_route_gpu10 -->
<g id="node480" class="node">
<title>layer15_route_gpu10</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="50546.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="50546.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 10</text>
<text text-anchor="middle" x="50546.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="50546.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="50546.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer15_gate&#45;&gt;layer15_route_gpu10 -->
<g id="edge539" class="edge">
<title>layer15_gate&#45;&gt;layer15_route_gpu10</title>
<path fill="none" stroke="black" d="M50874.73,-1275C50714.65,-1275 50546.7,-1275 50546.7,-1275 50546.7,-1275 50546.7,-1244.42 50546.7,-1244.42"/>
<polygon fill="black" stroke="black" points="50550.2,-1244.42 50546.7,-1234.42 50543.2,-1244.42 50550.2,-1244.42"/>
</g>
<!-- layer15_route_gpu11 -->
<g id="node483" class="node">
<title>layer15_route_gpu11</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="50955.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="50955.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 11</text>
<text text-anchor="middle" x="50955.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="50955.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="50955.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer15_gate&#45;&gt;layer15_route_gpu11 -->
<g id="edge543" class="edge">
<title>layer15_gate&#45;&gt;layer15_route_gpu11</title>
<path fill="none" stroke="black" d="M51010.46,-1271.07C51010.46,-1271.07 51010.46,-1242.78 51010.46,-1242.78"/>
<polygon fill="black" stroke="black" points="51013.96,-1242.78 51010.46,-1232.78 51006.96,-1242.78 51013.96,-1242.78"/>
</g>
<!-- layer15_route_gpu12 -->
<g id="node486" class="node">
<title>layer15_route_gpu12</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="51365.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="51365.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 12</text>
<text text-anchor="middle" x="51365.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="51365.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="51365.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer15_gate&#45;&gt;layer15_route_gpu12 -->
<g id="edge547" class="edge">
<title>layer15_gate&#45;&gt;layer15_route_gpu12</title>
<path fill="none" stroke="black" d="M51309.93,-1271.07C51309.93,-1271.07 51309.93,-1242.78 51309.93,-1242.78"/>
<polygon fill="black" stroke="black" points="51313.43,-1242.78 51309.93,-1232.78 51306.43,-1242.78 51313.43,-1242.78"/>
</g>
<!-- layer15_route_gpu13 -->
<g id="node489" class="node">
<title>layer15_route_gpu13</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="51777.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="51777.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 13</text>
<text text-anchor="middle" x="51777.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="51777.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="51777.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer15_gate&#45;&gt;layer15_route_gpu13 -->
<g id="edge551" class="edge">
<title>layer15_gate&#45;&gt;layer15_route_gpu13</title>
<path fill="none" stroke="black" d="M51359.06,-1302C51539.67,-1302 51777.7,-1302 51777.7,-1302 51777.7,-1302 51777.7,-1244.33 51777.7,-1244.33"/>
<polygon fill="black" stroke="black" points="51781.2,-1244.33 51777.7,-1234.33 51774.2,-1244.33 51781.2,-1244.33"/>
</g>
<!-- layer15_route_gpu14 -->
<g id="node492" class="node">
<title>layer15_route_gpu14</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="52191.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="52191.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 14</text>
<text text-anchor="middle" x="52191.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="52191.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="52191.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer15_gate&#45;&gt;layer15_route_gpu14 -->
<g id="edge555" class="edge">
<title>layer15_gate&#45;&gt;layer15_route_gpu14</title>
<path fill="none" stroke="black" d="M51389.05,-1334C51693.12,-1334 52191.7,-1334 52191.7,-1334 52191.7,-1334 52191.7,-1244.43 52191.7,-1244.43"/>
<polygon fill="black" stroke="black" points="52195.2,-1244.43 52191.7,-1234.43 52188.2,-1244.43 52195.2,-1244.43"/>
</g>
<!-- layer15_route_gpu15 -->
<g id="node495" class="node">
<title>layer15_route_gpu15</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="52605.7" cy="-1197.48" rx="193.99" ry="36.54"/>
<text text-anchor="middle" x="52605.7" y="-1211.48" font-family="Arial" font-size="10.00">Route to GPU 15</text>
<text text-anchor="middle" x="52605.7" y="-1200.48" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="52605.7" y="-1189.48" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="52605.7" y="-1178.48" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
</g>
<!-- layer15_gate&#45;&gt;layer15_route_gpu15 -->
<g id="edge559" class="edge">
<title>layer15_gate&#45;&gt;layer15_route_gpu15</title>
<path fill="none" stroke="black" d="M51418.21,-1365C51834.13,-1365 52605.7,-1365 52605.7,-1365 52605.7,-1365 52605.7,-1244.66 52605.7,-1244.66"/>
<polygon fill="black" stroke="black" points="52609.2,-1244.66 52605.7,-1234.66 52602.2,-1244.66 52609.2,-1244.66"/>
</g>
<!-- layer15_moe_agg -->
<g id="node471" class="node">
<title>layer15_moe_agg</title>
<ellipse fill="gold" stroke="black" cx="51160.7" cy="-839.17" rx="205.12" ry="44.6"/>
<text text-anchor="middle" x="51160.7" y="-858.67" font-family="Arial" font-size="10.00">MoE Final Aggregation 15</text>
<text text-anchor="middle" x="51160.7" y="-847.67" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="51160.7" y="-836.67" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="51160.7" y="-825.67" font-family="Arial" font-size="10.00">Input: 16Ã—[batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="51160.7" y="-814.67" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer15_ln2 -->
<g id="node472" class="node">
<title>layer15_ln2</title>
<polygon fill="none" stroke="black" points="51301.2,-733.9 51020.2,-733.9 51020.2,-670.9 51301.2,-670.9 51301.2,-733.9"/>
<text text-anchor="middle" x="51160.7" y="-721.9" font-family="Arial" font-size="10.00">LayerNorm MoE 15</text>
<text text-anchor="middle" x="51160.7" y="-710.9" font-family="Arial" font-size="10.00">TP=8 across GPUs 8&#45;15</text>
<text text-anchor="middle" x="51160.7" y="-699.9" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="51160.7" y="-688.9" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="middle" x="51160.7" y="-677.9" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer15_moe_agg&#45;&gt;layer15_ln2 -->
<g id="edge563" class="edge">
<title>layer15_moe_agg&#45;&gt;layer15_ln2</title>
<path fill="none" stroke="black" d="M51160.7,-794.39C51160.7,-794.39 51160.7,-744.29 51160.7,-744.29"/>
<polygon fill="black" stroke="black" points="51164.2,-744.29 51160.7,-734.29 51157.2,-744.29 51164.2,-744.29"/>
</g>
<!-- layer15_ln2&#45;&gt;layer15_moe_output -->
<g id="edge564" class="edge">
<title>layer15_ln2&#45;&gt;layer15_moe_output</title>
<path fill="none" stroke="black" d="M51051.7,-670.66C51051.7,-670.66 51051.7,-627.78 51051.7,-627.78"/>
<polygon fill="black" stroke="black" points="51055.2,-627.78 51051.7,-617.78 51048.2,-627.78 51055.2,-627.78"/>
</g>
<!-- output -->
<g id="node498" class="node">
<title>output</title>
<polygon fill="lightblue" stroke="black" points="51079.7,-469.87 50805.7,-469.87 50805.7,-433.87 51079.7,-433.87 51079.7,-469.87"/>
<text text-anchor="middle" x="50942.7" y="-454.87" font-family="Arial" font-size="10.00">Model Output</text>
<text text-anchor="middle" x="50942.7" y="-443.87" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer15_moe_output&#45;&gt;output -->
<g id="edge581" class="edge">
<title>layer15_moe_output&#45;&gt;output</title>
<path fill="none" stroke="black" d="M50942.7,-565.34C50942.7,-565.34 50942.7,-480.03 50942.7,-480.03"/>
<polygon fill="black" stroke="black" points="50946.2,-480.03 50942.7,-470.03 50939.2,-480.03 50946.2,-480.03"/>
</g>
<!-- layer15_experts_gpu8 -->
<g id="node475" class="node">
<title>layer15_experts_gpu8</title>
<polygon fill="lightcoral" stroke="black" points="49817.2,-1123.71 49608.2,-1123.71 49608.2,-1049.71 49817.2,-1049.71 49817.2,-1123.71"/>
<text text-anchor="middle" x="49712.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 8</text>
<text text-anchor="middle" x="49712.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="49712.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="49712.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="49712.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="49712.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer15_route_gpu8&#45;&gt;layer15_experts_gpu8 -->
<g id="edge532" class="edge">
<title>layer15_route_gpu8&#45;&gt;layer15_experts_gpu8</title>
<path fill="none" stroke="black" d="M49712.7,-1160.6C49712.7,-1160.6 49712.7,-1133.81 49712.7,-1133.81"/>
<polygon fill="black" stroke="black" points="49716.2,-1133.81 49712.7,-1123.81 49709.2,-1133.81 49716.2,-1133.81"/>
</g>
<!-- layer15_agg_gpu8 -->
<g id="node476" class="node">
<title>layer15_agg_gpu8</title>
<ellipse fill="lightpink" stroke="black" cx="49708.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="49708.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 8</text>
<text text-anchor="middle" x="49708.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="49708.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="49708.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer15_experts_gpu8&#45;&gt;layer15_agg_gpu8 -->
<g id="edge533" class="edge">
<title>layer15_experts_gpu8&#45;&gt;layer15_agg_gpu8</title>
<path fill="none" stroke="black" d="M49712.7,-1049.52C49712.7,-1049.52 49712.7,-1022.85 49712.7,-1022.85"/>
<polygon fill="black" stroke="black" points="49716.2,-1022.85 49712.7,-1012.85 49709.2,-1022.85 49716.2,-1022.85"/>
</g>
<!-- layer15_agg_gpu8&#45;&gt;layer15_moe_agg -->
<g id="edge534" class="edge">
<title>layer15_agg_gpu8&#45;&gt;layer15_moe_agg</title>
<path fill="none" stroke="black" d="M49708.7,-938.87C49708.7,-889.14 49708.7,-807 49708.7,-807 49708.7,-807 51008.83,-807 51008.83,-807"/>
<polygon fill="black" stroke="black" points="51008.83,-810.5 51018.83,-807 51008.83,-803.5 51008.83,-810.5"/>
</g>
<!-- layer15_experts_gpu9 -->
<g id="node478" class="node">
<title>layer15_experts_gpu9</title>
<polygon fill="lightcoral" stroke="black" points="50234.2,-1123.71 50025.2,-1123.71 50025.2,-1049.71 50234.2,-1049.71 50234.2,-1123.71"/>
<text text-anchor="middle" x="50129.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 9</text>
<text text-anchor="middle" x="50129.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="50129.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="50129.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="50129.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="50129.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer15_route_gpu9&#45;&gt;layer15_experts_gpu9 -->
<g id="edge536" class="edge">
<title>layer15_route_gpu9&#45;&gt;layer15_experts_gpu9</title>
<path fill="none" stroke="black" d="M50129.7,-1160.6C50129.7,-1160.6 50129.7,-1133.81 50129.7,-1133.81"/>
<polygon fill="black" stroke="black" points="50133.2,-1133.81 50129.7,-1123.81 50126.2,-1133.81 50133.2,-1133.81"/>
</g>
<!-- layer15_agg_gpu9 -->
<g id="node479" class="node">
<title>layer15_agg_gpu9</title>
<ellipse fill="lightpink" stroke="black" cx="50123.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="50123.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 9</text>
<text text-anchor="middle" x="50123.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="50123.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="50123.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer15_experts_gpu9&#45;&gt;layer15_agg_gpu9 -->
<g id="edge537" class="edge">
<title>layer15_experts_gpu9&#45;&gt;layer15_agg_gpu9</title>
<path fill="none" stroke="black" d="M50129.7,-1049.52C50129.7,-1049.52 50129.7,-1022.85 50129.7,-1022.85"/>
<polygon fill="black" stroke="black" points="50133.2,-1022.85 50129.7,-1012.85 50126.2,-1022.85 50133.2,-1022.85"/>
</g>
<!-- layer15_agg_gpu9&#45;&gt;layer15_moe_agg -->
<g id="edge538" class="edge">
<title>layer15_agg_gpu9&#45;&gt;layer15_moe_agg</title>
<path fill="none" stroke="black" d="M50123.7,-938.99C50123.7,-892.87 50123.7,-820 50123.7,-820 50123.7,-820 50965.6,-820 50965.6,-820"/>
<polygon fill="black" stroke="black" points="50965.6,-823.5 50975.6,-820 50965.6,-816.5 50965.6,-823.5"/>
</g>
<!-- layer15_experts_gpu10 -->
<g id="node481" class="node">
<title>layer15_experts_gpu10</title>
<polygon fill="lightcoral" stroke="black" points="50647.2,-1123.71 50438.2,-1123.71 50438.2,-1049.71 50647.2,-1049.71 50647.2,-1123.71"/>
<text text-anchor="middle" x="50542.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 10</text>
<text text-anchor="middle" x="50542.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="50542.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="50542.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="50542.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="50542.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer15_route_gpu10&#45;&gt;layer15_experts_gpu10 -->
<g id="edge540" class="edge">
<title>layer15_route_gpu10&#45;&gt;layer15_experts_gpu10</title>
<path fill="none" stroke="black" d="M50542.7,-1160.6C50542.7,-1160.6 50542.7,-1133.81 50542.7,-1133.81"/>
<polygon fill="black" stroke="black" points="50546.2,-1133.81 50542.7,-1123.81 50539.2,-1133.81 50546.2,-1133.81"/>
</g>
<!-- layer15_agg_gpu10 -->
<g id="node482" class="node">
<title>layer15_agg_gpu10</title>
<ellipse fill="lightpink" stroke="black" cx="50538.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="50538.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 10</text>
<text text-anchor="middle" x="50538.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="50538.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="50538.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer15_experts_gpu10&#45;&gt;layer15_agg_gpu10 -->
<g id="edge541" class="edge">
<title>layer15_experts_gpu10&#45;&gt;layer15_agg_gpu10</title>
<path fill="none" stroke="black" d="M50542.7,-1049.52C50542.7,-1049.52 50542.7,-1022.85 50542.7,-1022.85"/>
<polygon fill="black" stroke="black" points="50546.2,-1022.85 50542.7,-1012.85 50539.2,-1022.85 50546.2,-1022.85"/>
</g>
<!-- layer15_agg_gpu10&#45;&gt;layer15_moe_agg -->
<g id="edge542" class="edge">
<title>layer15_agg_gpu10&#45;&gt;layer15_moe_agg</title>
<path fill="none" stroke="black" d="M50729.3,-965.12C50729.3,-931.65 50729.3,-832 50729.3,-832 50729.3,-832 50948.26,-832 50948.26,-832"/>
<polygon fill="black" stroke="black" points="50948.26,-835.5 50958.26,-832 50948.26,-828.5 50948.26,-835.5"/>
</g>
<!-- layer15_experts_gpu11 -->
<g id="node484" class="node">
<title>layer15_experts_gpu11</title>
<polygon fill="lightcoral" stroke="black" points="51059.2,-1123.71 50850.2,-1123.71 50850.2,-1049.71 51059.2,-1049.71 51059.2,-1123.71"/>
<text text-anchor="middle" x="50954.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 11</text>
<text text-anchor="middle" x="50954.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="50954.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="50954.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="50954.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="50954.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer15_route_gpu11&#45;&gt;layer15_experts_gpu11 -->
<g id="edge544" class="edge">
<title>layer15_route_gpu11&#45;&gt;layer15_experts_gpu11</title>
<path fill="none" stroke="black" d="M50954.7,-1160.6C50954.7,-1160.6 50954.7,-1133.81 50954.7,-1133.81"/>
<polygon fill="black" stroke="black" points="50958.2,-1133.81 50954.7,-1123.81 50951.2,-1133.81 50958.2,-1133.81"/>
</g>
<!-- layer15_agg_gpu11 -->
<g id="node485" class="node">
<title>layer15_agg_gpu11</title>
<ellipse fill="lightpink" stroke="black" cx="50953.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="50953.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 11</text>
<text text-anchor="middle" x="50953.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="50953.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="50953.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer15_experts_gpu11&#45;&gt;layer15_agg_gpu11 -->
<g id="edge545" class="edge">
<title>layer15_experts_gpu11&#45;&gt;layer15_agg_gpu11</title>
<path fill="none" stroke="black" d="M50954.7,-1049.52C50954.7,-1049.52 50954.7,-1022.85 50954.7,-1022.85"/>
<polygon fill="black" stroke="black" points="50958.2,-1022.85 50954.7,-1012.85 50951.2,-1022.85 50958.2,-1022.85"/>
</g>
<!-- layer15_agg_gpu11&#45;&gt;layer15_moe_agg -->
<g id="edge546" class="edge">
<title>layer15_agg_gpu11&#45;&gt;layer15_moe_agg</title>
<path fill="none" stroke="black" d="M51054.02,-943.88C51054.02,-943.88 51054.02,-887.36 51054.02,-887.36"/>
<polygon fill="black" stroke="black" points="51057.52,-887.36 51054.02,-877.36 51050.52,-887.36 51057.52,-887.36"/>
</g>
<!-- layer15_experts_gpu12 -->
<g id="node487" class="node">
<title>layer15_experts_gpu12</title>
<polygon fill="lightcoral" stroke="black" points="51473.2,-1123.71 51264.2,-1123.71 51264.2,-1049.71 51473.2,-1049.71 51473.2,-1123.71"/>
<text text-anchor="middle" x="51368.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 12</text>
<text text-anchor="middle" x="51368.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="51368.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="51368.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="51368.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="51368.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer15_route_gpu12&#45;&gt;layer15_experts_gpu12 -->
<g id="edge548" class="edge">
<title>layer15_route_gpu12&#45;&gt;layer15_experts_gpu12</title>
<path fill="none" stroke="black" d="M51368.7,-1160.6C51368.7,-1160.6 51368.7,-1133.81 51368.7,-1133.81"/>
<polygon fill="black" stroke="black" points="51372.2,-1133.81 51368.7,-1123.81 51365.2,-1133.81 51372.2,-1133.81"/>
</g>
<!-- layer15_agg_gpu12 -->
<g id="node488" class="node">
<title>layer15_agg_gpu12</title>
<ellipse fill="lightpink" stroke="black" cx="51368.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="51368.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 12</text>
<text text-anchor="middle" x="51368.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="51368.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="51368.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer15_experts_gpu12&#45;&gt;layer15_agg_gpu12 -->
<g id="edge549" class="edge">
<title>layer15_experts_gpu12&#45;&gt;layer15_agg_gpu12</title>
<path fill="none" stroke="black" d="M51368.7,-1049.52C51368.7,-1049.52 51368.7,-1022.85 51368.7,-1022.85"/>
<polygon fill="black" stroke="black" points="51372.2,-1022.85 51368.7,-1012.85 51365.2,-1022.85 51372.2,-1022.85"/>
</g>
<!-- layer15_agg_gpu12&#45;&gt;layer15_moe_agg -->
<g id="edge550" class="edge">
<title>layer15_agg_gpu12&#45;&gt;layer15_moe_agg</title>
<path fill="none" stroke="black" d="M51267.88,-944.22C51267.88,-944.22 51267.88,-887.54 51267.88,-887.54"/>
<polygon fill="black" stroke="black" points="51271.38,-887.54 51267.88,-877.54 51264.38,-887.54 51271.38,-887.54"/>
</g>
<!-- layer15_experts_gpu13 -->
<g id="node490" class="node">
<title>layer15_experts_gpu13</title>
<polygon fill="lightcoral" stroke="black" points="51887.2,-1123.71 51678.2,-1123.71 51678.2,-1049.71 51887.2,-1049.71 51887.2,-1123.71"/>
<text text-anchor="middle" x="51782.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 13</text>
<text text-anchor="middle" x="51782.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="51782.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="51782.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="51782.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="51782.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer15_route_gpu13&#45;&gt;layer15_experts_gpu13 -->
<g id="edge552" class="edge">
<title>layer15_route_gpu13&#45;&gt;layer15_experts_gpu13</title>
<path fill="none" stroke="black" d="M51782.7,-1160.6C51782.7,-1160.6 51782.7,-1133.81 51782.7,-1133.81"/>
<polygon fill="black" stroke="black" points="51786.2,-1133.81 51782.7,-1123.81 51779.2,-1133.81 51786.2,-1133.81"/>
</g>
<!-- layer15_agg_gpu13 -->
<g id="node491" class="node">
<title>layer15_agg_gpu13</title>
<ellipse fill="lightpink" stroke="black" cx="51783.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="51783.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 13</text>
<text text-anchor="middle" x="51783.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="51783.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="51783.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer15_experts_gpu13&#45;&gt;layer15_agg_gpu13 -->
<g id="edge553" class="edge">
<title>layer15_experts_gpu13&#45;&gt;layer15_agg_gpu13</title>
<path fill="none" stroke="black" d="M51782.7,-1049.52C51782.7,-1049.52 51782.7,-1022.85 51782.7,-1022.85"/>
<polygon fill="black" stroke="black" points="51786.2,-1022.85 51782.7,-1012.85 51779.2,-1022.85 51786.2,-1022.85"/>
</g>
<!-- layer15_agg_gpu13&#45;&gt;layer15_moe_agg -->
<g id="edge554" class="edge">
<title>layer15_agg_gpu13&#45;&gt;layer15_moe_agg</title>
<path fill="none" stroke="black" d="M51783.7,-938.94C51783.7,-905.34 51783.7,-861 51783.7,-861 51783.7,-861 51349.64,-861 51349.64,-861"/>
<polygon fill="black" stroke="black" points="51349.64,-857.5 51339.64,-861 51349.64,-864.5 51349.64,-857.5"/>
</g>
<!-- layer15_experts_gpu14 -->
<g id="node493" class="node">
<title>layer15_experts_gpu14</title>
<polygon fill="lightcoral" stroke="black" points="52301.2,-1123.71 52092.2,-1123.71 52092.2,-1049.71 52301.2,-1049.71 52301.2,-1123.71"/>
<text text-anchor="middle" x="52196.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 14</text>
<text text-anchor="middle" x="52196.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="52196.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="52196.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="52196.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="52196.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer15_route_gpu14&#45;&gt;layer15_experts_gpu14 -->
<g id="edge556" class="edge">
<title>layer15_route_gpu14&#45;&gt;layer15_experts_gpu14</title>
<path fill="none" stroke="black" d="M52196.7,-1160.6C52196.7,-1160.6 52196.7,-1133.81 52196.7,-1133.81"/>
<polygon fill="black" stroke="black" points="52200.2,-1133.81 52196.7,-1123.81 52193.2,-1133.81 52200.2,-1133.81"/>
</g>
<!-- layer15_agg_gpu14 -->
<g id="node494" class="node">
<title>layer15_agg_gpu14</title>
<ellipse fill="lightpink" stroke="black" cx="52198.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="52198.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 14</text>
<text text-anchor="middle" x="52198.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="52198.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="52198.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer15_experts_gpu14&#45;&gt;layer15_agg_gpu14 -->
<g id="edge557" class="edge">
<title>layer15_experts_gpu14&#45;&gt;layer15_agg_gpu14</title>
<path fill="none" stroke="black" d="M52196.7,-1049.52C52196.7,-1049.52 52196.7,-1022.85 52196.7,-1022.85"/>
<polygon fill="black" stroke="black" points="52200.2,-1022.85 52196.7,-1012.85 52193.2,-1022.85 52200.2,-1022.85"/>
</g>
<!-- layer15_agg_gpu14&#45;&gt;layer15_moe_agg -->
<g id="edge558" class="edge">
<title>layer15_agg_gpu14&#45;&gt;layer15_moe_agg</title>
<path fill="none" stroke="black" d="M52198.7,-938.88C52198.7,-898.33 52198.7,-839 52198.7,-839 52198.7,-839 51375.77,-839 51375.77,-839"/>
<polygon fill="black" stroke="black" points="51375.77,-835.5 51365.77,-839 51375.77,-842.5 51375.77,-835.5"/>
</g>
<!-- layer15_experts_gpu15 -->
<g id="node496" class="node">
<title>layer15_experts_gpu15</title>
<polygon fill="lightcoral" stroke="black" points="52716.2,-1123.71 52507.2,-1123.71 52507.2,-1049.71 52716.2,-1049.71 52716.2,-1123.71"/>
<text text-anchor="middle" x="52611.7" y="-1111.71" font-family="Arial" font-size="10.00">8 Experts GPU 15</text>
<text text-anchor="middle" x="52611.7" y="-1100.71" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="52611.7" y="-1089.71" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="52611.7" y="-1078.71" font-family="Arial" font-size="10.00">Output: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="52611.7" y="-1067.71" font-family="Arial" font-size="10.00">(Sequential processing)</text>
<text text-anchor="middle" x="52611.7" y="-1056.71" font-family="Arial" font-size="10.00">Hidden: [tokens_per_gpu, 16384]</text>
</g>
<!-- layer15_route_gpu15&#45;&gt;layer15_experts_gpu15 -->
<g id="edge560" class="edge">
<title>layer15_route_gpu15&#45;&gt;layer15_experts_gpu15</title>
<path fill="none" stroke="black" d="M52611.7,-1160.6C52611.7,-1160.6 52611.7,-1133.81 52611.7,-1133.81"/>
<polygon fill="black" stroke="black" points="52615.2,-1133.81 52611.7,-1123.81 52608.2,-1133.81 52615.2,-1133.81"/>
</g>
<!-- layer15_agg_gpu15 -->
<g id="node497" class="node">
<title>layer15_agg_gpu15</title>
<ellipse fill="lightpink" stroke="black" cx="52613.7" cy="-975.94" rx="198.89" ry="36.54"/>
<text text-anchor="middle" x="52613.7" y="-989.94" font-family="Arial" font-size="10.00">Aggregate GPU 15</text>
<text text-anchor="middle" x="52613.7" y="-978.94" font-family="Arial" font-size="10.00">Stage 1</text>
<text text-anchor="middle" x="52613.7" y="-967.94" font-family="Arial" font-size="10.00">Input: [tokens_per_gpu, hidden_dim=4096]</text>
<text text-anchor="middle" x="52613.7" y="-956.94" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layer15_experts_gpu15&#45;&gt;layer15_agg_gpu15 -->
<g id="edge561" class="edge">
<title>layer15_experts_gpu15&#45;&gt;layer15_agg_gpu15</title>
<path fill="none" stroke="black" d="M52611.7,-1049.52C52611.7,-1049.52 52611.7,-1022.85 52611.7,-1022.85"/>
<polygon fill="black" stroke="black" points="52615.2,-1022.85 52611.7,-1012.85 52608.2,-1022.85 52615.2,-1022.85"/>
</g>
<!-- layer15_agg_gpu15&#45;&gt;layer15_moe_agg -->
<g id="edge562" class="edge">
<title>layer15_agg_gpu15&#45;&gt;layer15_moe_agg</title>
<path fill="none" stroke="black" d="M52613.7,-938.85C52613.7,-891.6 52613.7,-816 52613.7,-816 52613.7,-816 51345.96,-816 51345.96,-816"/>
<polygon fill="black" stroke="black" points="51345.96,-812.5 51335.96,-816 51345.96,-819.5 51345.96,-812.5"/>
</g>
</g>
</svg>
