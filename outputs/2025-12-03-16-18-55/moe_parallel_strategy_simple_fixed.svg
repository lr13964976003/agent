<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1651pt" height="1948pt"
 viewBox="0.00 0.00 1650.53 1947.91" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1943.91)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1943.91 1646.53,-1943.91 1646.53,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="lightgray" stroke="black" points="1323,-1939.91 1020,-1939.91 1020,-1898.91 1323,-1898.91 1323,-1939.91"/>
<text text-anchor="middle" x="1171.5" y="-1927.91" font-family="Times,serif" font-size="10.00">Total Input</text>
<text text-anchor="middle" x="1171.5" y="-1916.91" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, hidden=1024]</text>
<text text-anchor="middle" x="1171.5" y="-1905.91" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, hidden=1024]</text>
</g>
<!-- embed -->
<g id="node2" class="node">
<title>embed</title>
<polygon fill="lightgreen" stroke="black" points="1323,-1862.91 1020,-1862.91 1020,-1810.91 1323,-1810.91 1323,-1862.91"/>
<text text-anchor="middle" x="1171.5" y="-1850.91" font-family="Times,serif" font-size="10.00">Token Embedding</text>
<text text-anchor="middle" x="1171.5" y="-1839.91" font-family="Times,serif" font-size="10.00">GPU: PP0&#45;TP0&#45;TP3</text>
<text text-anchor="middle" x="1171.5" y="-1828.91" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240]</text>
<text text-anchor="middle" x="1171.5" y="-1817.91" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, hidden=1024]</text>
</g>
<!-- input&#45;&gt;embed -->
<g id="edge2" class="edge">
<title>input&#45;&gt;embed</title>
<path fill="none" stroke="black" d="M1171.5,-1898.51C1171.5,-1890.9 1171.5,-1881.97 1171.5,-1873.34"/>
<polygon fill="black" stroke="black" points="1175,-1873.07 1171.5,-1863.07 1168,-1873.07 1175,-1873.07"/>
</g>
<!-- qkv_tp -->
<g id="node3" class="node">
<title>qkv_tp</title>
<polygon fill="lightgreen" stroke="black" points="1205,-1774.91 908,-1774.91 908,-1722.91 1205,-1722.91 1205,-1774.91"/>
<text text-anchor="middle" x="1056.5" y="-1762.91" font-family="Times,serif" font-size="10.00">QKV Projection TP4</text>
<text text-anchor="middle" x="1056.5" y="-1751.91" font-family="Times,serif" font-size="10.00">GPU: PP0&#45;TP0&#45;TP3</text>
<text text-anchor="middle" x="1056.5" y="-1740.91" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, hidden=1024]</text>
<text text-anchor="middle" x="1056.5" y="-1729.91" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, hidden=256]</text>
</g>
<!-- embed&#45;&gt;qkv_tp -->
<g id="edge3" class="edge">
<title>embed&#45;&gt;qkv_tp</title>
<path fill="none" stroke="black" d="M1137.93,-1810.81C1125.64,-1801.62 1111.57,-1791.1 1098.63,-1781.42"/>
<polygon fill="black" stroke="black" points="1100.42,-1778.39 1090.31,-1775.2 1096.22,-1783.99 1100.42,-1778.39"/>
</g>
<!-- attn_resres -->
<g id="node26" class="node">
<title>attn_resres</title>
<polygon fill="lightyellow" stroke="black" points="1350.24,-1766.91 1248.85,-1766.91 1222.76,-1730.91 1324.15,-1730.91 1350.24,-1766.91"/>
<text text-anchor="middle" x="1286.5" y="-1746.41" font-family="Times,serif" font-size="10.00">attn_resres</text>
</g>
<!-- embed&#45;&gt;attn_resres -->
<g id="edge11" class="edge">
<title>embed&#45;&gt;attn_resres</title>
<path fill="none" stroke="black" d="M1205.07,-1810.81C1220.96,-1798.93 1239.81,-1784.83 1255.37,-1773.19"/>
<polygon fill="black" stroke="black" points="1257.73,-1775.8 1263.64,-1767.01 1253.54,-1770.2 1257.73,-1775.8"/>
</g>
<!-- qkv_comm -->
<g id="node4" class="node">
<title>qkv_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1056.5" cy="-1657.92" rx="214.01" ry="28.98"/>
<text text-anchor="middle" x="1056.5" y="-1666.42" font-family="Times,serif" font-size="10.00">QKV All&#45;Gather</text>
<text text-anchor="middle" x="1056.5" y="-1655.42" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, hidden=256]</text>
<text text-anchor="middle" x="1056.5" y="-1644.42" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, hidden=1024]</text>
</g>
<!-- qkv_tp&#45;&gt;qkv_comm -->
<g id="edge4" class="edge">
<title>qkv_tp&#45;&gt;qkv_comm</title>
<path fill="none" stroke="black" d="M1056.5,-1722.65C1056.5,-1714.76 1056.5,-1705.87 1056.5,-1697.29"/>
<polygon fill="black" stroke="black" points="1060,-1697.06 1056.5,-1687.06 1053,-1697.06 1060,-1697.06"/>
</g>
<!-- attn_score -->
<g id="node5" class="node">
<title>attn_score</title>
<polygon fill="lightgreen" stroke="black" points="1212.5,-1592.93 900.5,-1592.93 900.5,-1551.93 1212.5,-1551.93 1212.5,-1592.93"/>
<text text-anchor="middle" x="1056.5" y="-1580.93" font-family="Times,serif" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="1056.5" y="-1569.93" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, hidden=1024]</text>
<text text-anchor="middle" x="1056.5" y="-1558.93" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, seq_len=10240]</text>
</g>
<!-- qkv_comm&#45;&gt;attn_score -->
<g id="edge5" class="edge">
<title>qkv_comm&#45;&gt;attn_score</title>
<path fill="none" stroke="black" d="M1056.5,-1628.66C1056.5,-1620.41 1056.5,-1611.37 1056.5,-1603.04"/>
<polygon fill="black" stroke="black" points="1060,-1602.98 1056.5,-1592.98 1053,-1602.98 1060,-1602.98"/>
</g>
<!-- attn_softmax -->
<g id="node6" class="node">
<title>attn_softmax</title>
<polygon fill="lightgreen" stroke="black" points="1212.5,-1515.93 900.5,-1515.93 900.5,-1474.93 1212.5,-1474.93 1212.5,-1515.93"/>
<text text-anchor="middle" x="1056.5" y="-1503.93" font-family="Times,serif" font-size="10.00">Attention Softmax</text>
<text text-anchor="middle" x="1056.5" y="-1492.93" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, seq_len=10240]</text>
<text text-anchor="middle" x="1056.5" y="-1481.93" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, seq_len=10240]</text>
</g>
<!-- attn_score&#45;&gt;attn_softmax -->
<g id="edge6" class="edge">
<title>attn_score&#45;&gt;attn_softmax</title>
<path fill="none" stroke="black" d="M1056.5,-1551.73C1056.5,-1543.89 1056.5,-1534.7 1056.5,-1526.09"/>
<polygon fill="black" stroke="black" points="1060,-1526 1056.5,-1516 1053,-1526 1060,-1526"/>
</g>
<!-- attn_weight -->
<g id="node7" class="node">
<title>attn_weight</title>
<polygon fill="lightgreen" stroke="black" points="1208.5,-1438.93 904.5,-1438.93 904.5,-1397.93 1208.5,-1397.93 1208.5,-1438.93"/>
<text text-anchor="middle" x="1056.5" y="-1426.93" font-family="Times,serif" font-size="10.00">Attention Weight</text>
<text text-anchor="middle" x="1056.5" y="-1415.93" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, seq_len=10240]</text>
<text text-anchor="middle" x="1056.5" y="-1404.93" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, hidden=1024]</text>
</g>
<!-- attn_softmax&#45;&gt;attn_weight -->
<g id="edge7" class="edge">
<title>attn_softmax&#45;&gt;attn_weight</title>
<path fill="none" stroke="black" d="M1056.5,-1474.73C1056.5,-1466.89 1056.5,-1457.7 1056.5,-1449.09"/>
<polygon fill="black" stroke="black" points="1060,-1449 1056.5,-1439 1053,-1449 1060,-1449"/>
</g>
<!-- attn_out_tp -->
<g id="node8" class="node">
<title>attn_out_tp</title>
<polygon fill="lightgreen" stroke="black" points="1205,-1361.93 908,-1361.93 908,-1320.93 1205,-1320.93 1205,-1361.93"/>
<text text-anchor="middle" x="1056.5" y="-1349.93" font-family="Times,serif" font-size="10.00">Attention Output TP4</text>
<text text-anchor="middle" x="1056.5" y="-1338.93" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, hidden=1024]</text>
<text text-anchor="middle" x="1056.5" y="-1327.93" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, hidden=256]</text>
</g>
<!-- attn_weight&#45;&gt;attn_out_tp -->
<g id="edge8" class="edge">
<title>attn_weight&#45;&gt;attn_out_tp</title>
<path fill="none" stroke="black" d="M1056.5,-1397.73C1056.5,-1389.89 1056.5,-1380.7 1056.5,-1372.09"/>
<polygon fill="black" stroke="black" points="1060,-1372 1056.5,-1362 1053,-1372 1060,-1372"/>
</g>
<!-- attn_out_comm -->
<g id="node9" class="node">
<title>attn_out_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1056.5" cy="-1255.94" rx="214.01" ry="28.98"/>
<text text-anchor="middle" x="1056.5" y="-1264.44" font-family="Times,serif" font-size="10.00">Attention Out All&#45;Reduce</text>
<text text-anchor="middle" x="1056.5" y="-1253.44" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, hidden=256]</text>
<text text-anchor="middle" x="1056.5" y="-1242.44" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, hidden=1024]</text>
</g>
<!-- attn_out_tp&#45;&gt;attn_out_comm -->
<g id="edge9" class="edge">
<title>attn_out_tp&#45;&gt;attn_out_comm</title>
<path fill="none" stroke="black" d="M1056.5,-1320.64C1056.5,-1313.02 1056.5,-1304.03 1056.5,-1295.24"/>
<polygon fill="black" stroke="black" points="1060,-1295.12 1056.5,-1285.12 1053,-1295.12 1060,-1295.12"/>
</g>
<!-- attn_res -->
<g id="node10" class="node">
<title>attn_res</title>
<polygon fill="lightyellow" stroke="black" points="1621.56,-1190.95 722.68,-1190.95 491.44,-1108.95 1390.32,-1108.95 1621.56,-1190.95"/>
<text text-anchor="middle" x="1056.5" y="-1158.45" font-family="Times,serif" font-size="10.00">Attention Residual Add</text>
<text text-anchor="middle" x="1056.5" y="-1147.45" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, hidden=1024], [batch_size=128, seq_len=10240, hidden=1024]</text>
<text text-anchor="middle" x="1056.5" y="-1136.45" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, hidden=1024]</text>
</g>
<!-- attn_out_comm&#45;&gt;attn_res -->
<g id="edge10" class="edge">
<title>attn_out_comm&#45;&gt;attn_res</title>
<path fill="none" stroke="black" d="M1056.5,-1226.8C1056.5,-1218.93 1056.5,-1210.13 1056.5,-1201.39"/>
<polygon fill="black" stroke="black" points="1060,-1201.22 1056.5,-1191.22 1053,-1201.22 1060,-1201.22"/>
</g>
<!-- ln1 -->
<g id="node11" class="node">
<title>ln1</title>
<polygon fill="lightgreen" stroke="black" points="1208,-1072.95 905,-1072.95 905,-1031.95 1208,-1031.95 1208,-1072.95"/>
<text text-anchor="middle" x="1056.5" y="-1060.95" font-family="Times,serif" font-size="10.00">Layer Norm 1</text>
<text text-anchor="middle" x="1056.5" y="-1049.95" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, hidden=1024]</text>
<text text-anchor="middle" x="1056.5" y="-1038.95" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, hidden=1024]</text>
</g>
<!-- attn_res&#45;&gt;ln1 -->
<g id="edge12" class="edge">
<title>attn_res&#45;&gt;ln1</title>
<path fill="none" stroke="black" d="M1056.5,-1108.72C1056.5,-1100.15 1056.5,-1091.24 1056.5,-1083.14"/>
<polygon fill="black" stroke="black" points="1060,-1083.06 1056.5,-1073.06 1053,-1083.06 1060,-1083.06"/>
</g>
<!-- gate -->
<g id="node12" class="node">
<title>gate</title>
<polygon fill="lightgreen" stroke="black" points="881,-995.95 586,-995.95 586,-954.95 881,-954.95 881,-995.95"/>
<text text-anchor="middle" x="733.5" y="-983.95" font-family="Times,serif" font-size="10.00">MoE Gate</text>
<text text-anchor="middle" x="733.5" y="-972.95" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, hidden=1024]</text>
<text text-anchor="middle" x="733.5" y="-961.95" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, experts=64]</text>
</g>
<!-- ln1&#45;&gt;gate -->
<g id="edge13" class="edge">
<title>ln1&#45;&gt;gate</title>
<path fill="none" stroke="black" d="M972.48,-1031.94C928.07,-1021.63 873.42,-1008.94 827.6,-998.3"/>
<polygon fill="black" stroke="black" points="828.19,-994.84 817.66,-995.99 826.61,-1001.66 828.19,-994.84"/>
</g>
<!-- dispatch -->
<g id="node14" class="node">
<title>dispatch</title>
<ellipse fill="lightblue" stroke="black" cx="733.5" cy="-771.96" rx="214.01" ry="28.98"/>
<text text-anchor="middle" x="733.5" y="-780.46" font-family="Times,serif" font-size="10.00">Expert Dispatch All&#45;to&#45;All</text>
<text text-anchor="middle" x="733.5" y="-769.46" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, hidden=1024]</text>
<text text-anchor="middle" x="733.5" y="-758.46" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, hidden=1024]</text>
</g>
<!-- ln1&#45;&gt;dispatch -->
<g id="edge16" class="edge">
<title>ln1&#45;&gt;dispatch</title>
<path fill="none" stroke="black" d="M1061.58,-1031.93C1071.13,-990.35 1086.63,-892.31 1037.5,-836.95 1019.09,-816.21 966.43,-801.81 909.99,-791.99"/>
<polygon fill="black" stroke="black" points="910.24,-788.49 899.8,-790.28 909.08,-795.39 910.24,-788.49"/>
</g>
<!-- moe_res -->
<g id="node22" class="node">
<title>moe_res</title>
<polygon fill="lightyellow" stroke="black" points="1642.56,-329.98 743.68,-329.98 512.44,-247.98 1411.32,-247.98 1642.56,-329.98"/>
<text text-anchor="middle" x="1077.5" y="-297.48" font-family="Times,serif" font-size="10.00">MoE Residual Add</text>
<text text-anchor="middle" x="1077.5" y="-286.48" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, hidden=1024], [batch_size=128, seq_len=10240, hidden=1024]</text>
<text text-anchor="middle" x="1077.5" y="-275.48" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, hidden=1024]</text>
</g>
<!-- ln1&#45;&gt;moe_res -->
<g id="edge28" class="edge">
<title>ln1&#45;&gt;moe_res</title>
<path fill="none" stroke="black" d="M1088.72,-1031.92C1130.62,-1003.79 1198.5,-947.61 1198.5,-878.95 1198.5,-878.95 1198.5,-878.95 1198.5,-470.97 1198.5,-419.32 1164.02,-371.23 1131.87,-337.63"/>
<polygon fill="black" stroke="black" points="1134.13,-334.94 1124.63,-330.26 1129.14,-339.85 1134.13,-334.94"/>
</g>
<!-- route -->
<g id="node13" class="node">
<title>route</title>
<polygon fill="lightyellow" stroke="black" points="1028.95,-918.95 558.96,-918.95 438.05,-836.95 908.04,-836.95 1028.95,-918.95"/>
<text text-anchor="middle" x="733.5" y="-886.45" font-family="Times,serif" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="733.5" y="-875.45" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, experts=64]</text>
<text text-anchor="middle" x="733.5" y="-864.45" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, top_k=2]</text>
</g>
<!-- gate&#45;&gt;route -->
<g id="edge1" class="edge">
<title>gate&#45;&gt;route</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M727.91,-954.66C727.2,-947.2 726.82,-938.33 726.76,-929.33"/>
<polygon fill="black" stroke="black" points="730.26,-929.22 726.82,-919.19 723.26,-929.17 730.26,-929.22"/>
</g>
<!-- gate&#45;&gt;route -->
<g id="edge14" class="edge">
<title>gate&#45;&gt;route</title>
<path fill="none" stroke="black" d="M739.09,-954.66C739.8,-947.2 740.18,-938.33 740.24,-929.33"/>
<polygon fill="black" stroke="black" points="743.74,-929.17 740.18,-919.19 736.74,-929.22 743.74,-929.17"/>
</g>
<!-- route&#45;&gt;dispatch -->
<g id="edge15" class="edge">
<title>route&#45;&gt;dispatch</title>
<path fill="none" stroke="black" d="M733.5,-836.74C733.5,-828.38 733.5,-819.6 733.5,-811.31"/>
<polygon fill="black" stroke="black" points="737,-811.14 733.5,-801.14 730,-811.14 737,-811.14"/>
</g>
<!-- expert_0 -->
<g id="node15" class="node">
<title>expert_0</title>
<polygon fill="lightgreen" stroke="black" points="279,-706.97 0,-706.97 0,-654.97 279,-654.97 279,-706.97"/>
<text text-anchor="middle" x="139.5" y="-694.97" font-family="Times,serif" font-size="10.00">Expert 0</text>
<text text-anchor="middle" x="139.5" y="-683.97" font-family="Times,serif" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="139.5" y="-672.97" font-family="Times,serif" font-size="10.00">Input: [batch_size=8, seq_len=640, hidden=1024]</text>
<text text-anchor="middle" x="139.5" y="-661.97" font-family="Times,serif" font-size="10.00">Output: [batch_size=8, seq_len=640, hidden=1024]</text>
</g>
<!-- dispatch&#45;&gt;expert_0 -->
<g id="edge17" class="edge">
<title>dispatch&#45;&gt;expert_0</title>
<path fill="none" stroke="black" d="M586.72,-750.83C502.39,-739.04 394.2,-723.54 289.44,-707.26"/>
<polygon fill="black" stroke="black" points="289.73,-703.76 279.32,-705.68 288.66,-710.68 289.73,-703.76"/>
</g>
<!-- expert_1 -->
<g id="node16" class="node">
<title>expert_1</title>
<polygon fill="lightgreen" stroke="black" points="576,-706.97 297,-706.97 297,-654.97 576,-654.97 576,-706.97"/>
<text text-anchor="middle" x="436.5" y="-694.97" font-family="Times,serif" font-size="10.00">Expert 1</text>
<text text-anchor="middle" x="436.5" y="-683.97" font-family="Times,serif" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="436.5" y="-672.97" font-family="Times,serif" font-size="10.00">Input: [batch_size=8, seq_len=640, hidden=1024]</text>
<text text-anchor="middle" x="436.5" y="-661.97" font-family="Times,serif" font-size="10.00">Output: [batch_size=8, seq_len=640, hidden=1024]</text>
</g>
<!-- dispatch&#45;&gt;expert_1 -->
<g id="edge18" class="edge">
<title>dispatch&#45;&gt;expert_1</title>
<path fill="none" stroke="black" d="M647.99,-745.34C611.1,-734.28 567.85,-721.32 530.1,-710.01"/>
<polygon fill="black" stroke="black" points="530.71,-706.54 520.12,-707.02 528.7,-713.24 530.71,-706.54"/>
</g>
<!-- expert_2 -->
<g id="node17" class="node">
<title>expert_2</title>
<polygon fill="lightgreen" stroke="black" points="873,-706.97 594,-706.97 594,-654.97 873,-654.97 873,-706.97"/>
<text text-anchor="middle" x="733.5" y="-694.97" font-family="Times,serif" font-size="10.00">Expert 2</text>
<text text-anchor="middle" x="733.5" y="-683.97" font-family="Times,serif" font-size="10.00">GPU: 2</text>
<text text-anchor="middle" x="733.5" y="-672.97" font-family="Times,serif" font-size="10.00">Input: [batch_size=8, seq_len=640, hidden=1024]</text>
<text text-anchor="middle" x="733.5" y="-661.97" font-family="Times,serif" font-size="10.00">Output: [batch_size=8, seq_len=640, hidden=1024]</text>
</g>
<!-- dispatch&#45;&gt;expert_2 -->
<g id="edge19" class="edge">
<title>dispatch&#45;&gt;expert_2</title>
<path fill="none" stroke="black" d="M733.5,-742.8C733.5,-734.69 733.5,-725.74 733.5,-717.26"/>
<polygon fill="black" stroke="black" points="737,-717.23 733.5,-707.23 730,-717.23 737,-717.23"/>
</g>
<!-- expert_3 -->
<g id="node18" class="node">
<title>expert_3</title>
<polygon fill="lightgreen" stroke="black" points="1170,-706.97 891,-706.97 891,-654.97 1170,-654.97 1170,-706.97"/>
<text text-anchor="middle" x="1030.5" y="-694.97" font-family="Times,serif" font-size="10.00">Expert 3</text>
<text text-anchor="middle" x="1030.5" y="-683.97" font-family="Times,serif" font-size="10.00">GPU: 3</text>
<text text-anchor="middle" x="1030.5" y="-672.97" font-family="Times,serif" font-size="10.00">Input: [batch_size=8, seq_len=640, hidden=1024]</text>
<text text-anchor="middle" x="1030.5" y="-661.97" font-family="Times,serif" font-size="10.00">Output: [batch_size=8, seq_len=640, hidden=1024]</text>
</g>
<!-- dispatch&#45;&gt;expert_3 -->
<g id="edge20" class="edge">
<title>dispatch&#45;&gt;expert_3</title>
<path fill="none" stroke="black" d="M819.01,-745.34C855.9,-734.28 899.15,-721.32 936.9,-710.01"/>
<polygon fill="black" stroke="black" points="938.3,-713.24 946.88,-707.02 936.29,-706.54 938.3,-713.24"/>
</g>
<!-- expert_agg -->
<g id="node19" class="node">
<title>expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="1047.77,-618.97 547.84,-618.97 419.23,-536.97 919.16,-536.97 1047.77,-618.97"/>
<text text-anchor="middle" x="733.5" y="-586.47" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="733.5" y="-575.47" font-family="Times,serif" font-size="10.00">Input: [batch_size=8, seq_len=640, hidden=1024] Ã— 4</text>
<text text-anchor="middle" x="733.5" y="-564.47" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, hidden=1024]</text>
</g>
<!-- expert_0&#45;&gt;expert_agg -->
<g id="edge21" class="edge">
<title>expert_0&#45;&gt;expert_agg</title>
<path fill="none" stroke="black" d="M279.14,-656.22C353.04,-643.66 445.22,-627.98 527.2,-614.04"/>
<polygon fill="black" stroke="black" points="527.88,-617.48 537.15,-612.35 526.7,-610.58 527.88,-617.48"/>
</g>
<!-- expert_1&#45;&gt;expert_agg -->
<g id="edge22" class="edge">
<title>expert_1&#45;&gt;expert_agg</title>
<path fill="none" stroke="black" d="M510.3,-654.87C539.3,-645.01 573.45,-633.39 606.19,-622.26"/>
<polygon fill="black" stroke="black" points="607.5,-625.51 615.84,-618.98 605.25,-618.88 607.5,-625.51"/>
</g>
<!-- expert_2&#45;&gt;expert_agg -->
<g id="edge23" class="edge">
<title>expert_2&#45;&gt;expert_agg</title>
<path fill="none" stroke="black" d="M733.5,-654.74C733.5,-647.01 733.5,-638.22 733.5,-629.43"/>
<polygon fill="black" stroke="black" points="737,-629.18 733.5,-619.18 730,-629.18 737,-629.18"/>
</g>
<!-- expert_3&#45;&gt;expert_agg -->
<g id="edge24" class="edge">
<title>expert_3&#45;&gt;expert_agg</title>
<path fill="none" stroke="black" d="M956.7,-654.87C927.7,-645.01 893.55,-633.39 860.81,-622.26"/>
<polygon fill="black" stroke="black" points="861.75,-618.88 851.16,-618.98 859.5,-625.51 861.75,-618.88"/>
</g>
<!-- combine -->
<g id="node20" class="node">
<title>combine</title>
<ellipse fill="lightblue" stroke="black" cx="845.5" cy="-471.97" rx="214.01" ry="28.98"/>
<text text-anchor="middle" x="845.5" y="-480.47" font-family="Times,serif" font-size="10.00">Expert Combine All&#45;to&#45;All</text>
<text text-anchor="middle" x="845.5" y="-469.47" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, hidden=1024]</text>
<text text-anchor="middle" x="845.5" y="-458.47" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, hidden=1024]</text>
</g>
<!-- expert_agg&#45;&gt;combine -->
<g id="edge25" class="edge">
<title>expert_agg&#45;&gt;combine</title>
<path fill="none" stroke="black" d="M776.8,-536.76C787.1,-527.2 798.01,-517.07 808.02,-507.77"/>
<polygon fill="black" stroke="black" points="810.54,-510.21 815.48,-500.84 805.78,-505.08 810.54,-510.21"/>
</g>
<!-- moe_out -->
<g id="node21" class="node">
<title>moe_out</title>
<polygon fill="lightgreen" stroke="black" points="1139,-406.98 836,-406.98 836,-365.98 1139,-365.98 1139,-406.98"/>
<text text-anchor="middle" x="987.5" y="-394.98" font-family="Times,serif" font-size="10.00">MoE Output Projection</text>
<text text-anchor="middle" x="987.5" y="-383.98" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, hidden=1024]</text>
<text text-anchor="middle" x="987.5" y="-372.98" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, hidden=1024]</text>
</g>
<!-- combine&#45;&gt;moe_out -->
<g id="edge26" class="edge">
<title>combine&#45;&gt;moe_out</title>
<path fill="none" stroke="black" d="M892,-443.64C909.06,-433.6 928.27,-422.31 944.97,-412.49"/>
<polygon fill="black" stroke="black" points="947.11,-415.29 953.95,-407.21 943.56,-409.26 947.11,-415.29"/>
</g>
<!-- moe_out&#45;&gt;moe_res -->
<g id="edge27" class="edge">
<title>moe_out&#45;&gt;moe_res</title>
<path fill="none" stroke="black" d="M1006.15,-365.7C1013.86,-357.51 1023.17,-347.63 1032.48,-337.75"/>
<polygon fill="black" stroke="black" points="1035.26,-339.91 1039.57,-330.23 1030.17,-335.11 1035.26,-339.91"/>
</g>
<!-- ln2 -->
<g id="node23" class="node">
<title>ln2</title>
<polygon fill="lightgreen" stroke="black" points="1229,-211.98 926,-211.98 926,-170.98 1229,-170.98 1229,-211.98"/>
<text text-anchor="middle" x="1077.5" y="-199.98" font-family="Times,serif" font-size="10.00">Layer Norm 2</text>
<text text-anchor="middle" x="1077.5" y="-188.98" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, hidden=1024]</text>
<text text-anchor="middle" x="1077.5" y="-177.98" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, hidden=1024]</text>
</g>
<!-- moe_res&#45;&gt;ln2 -->
<g id="edge29" class="edge">
<title>moe_res&#45;&gt;ln2</title>
<path fill="none" stroke="black" d="M1077.5,-247.76C1077.5,-239.18 1077.5,-230.27 1077.5,-222.17"/>
<polygon fill="black" stroke="black" points="1081,-222.09 1077.5,-212.09 1074,-222.09 1081,-222.09"/>
</g>
<!-- pp_transition -->
<g id="node24" class="node">
<title>pp_transition</title>
<ellipse fill="lightblue" stroke="black" cx="1077.5" cy="-105.99" rx="214.01" ry="28.98"/>
<text text-anchor="middle" x="1077.5" y="-114.49" font-family="Times,serif" font-size="10.00">Pipeline Stage Transition</text>
<text text-anchor="middle" x="1077.5" y="-103.49" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, hidden=1024]</text>
<text text-anchor="middle" x="1077.5" y="-92.49" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, hidden=1024]</text>
</g>
<!-- ln2&#45;&gt;pp_transition -->
<g id="edge30" class="edge">
<title>ln2&#45;&gt;pp_transition</title>
<path fill="none" stroke="black" d="M1077.5,-170.7C1077.5,-163.07 1077.5,-154.08 1077.5,-145.29"/>
<polygon fill="black" stroke="black" points="1081,-145.17 1077.5,-135.17 1074,-145.17 1081,-145.17"/>
</g>
<!-- output -->
<g id="node25" class="node">
<title>output</title>
<polygon fill="lightgray" stroke="black" points="1229,-41 926,-41 926,0 1229,0 1229,-41"/>
<text text-anchor="middle" x="1077.5" y="-29" font-family="Times,serif" font-size="10.00">Total Output</text>
<text text-anchor="middle" x="1077.5" y="-18" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=10240, hidden=1024]</text>
<text text-anchor="middle" x="1077.5" y="-7" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=10240, hidden=1024]</text>
</g>
<!-- pp_transition&#45;&gt;output -->
<g id="edge31" class="edge">
<title>pp_transition&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1077.5,-76.73C1077.5,-68.48 1077.5,-59.44 1077.5,-51.11"/>
<polygon fill="black" stroke="black" points="1081,-51.05 1077.5,-41.05 1074,-51.05 1081,-51.05"/>
</g>
</g>
</svg>
