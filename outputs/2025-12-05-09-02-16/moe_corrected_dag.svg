<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="2456pt" height="6053pt"
 viewBox="0.00 0.00 2456.00 6052.66" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 6048.66)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-6048.66 2452,-6048.66 2452,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_input</title>
<path fill="white" stroke="black" d="M1040,-5929.66C1040,-5929.66 1448,-5929.66 1448,-5929.66 1454,-5929.66 1460,-5935.66 1460,-5941.66 1460,-5941.66 1460,-6024.66 1460,-6024.66 1460,-6030.66 1454,-6036.66 1448,-6036.66 1448,-6036.66 1040,-6036.66 1040,-6036.66 1034,-6036.66 1028,-6030.66 1028,-6024.66 1028,-6024.66 1028,-5941.66 1028,-5941.66 1028,-5935.66 1034,-5929.66 1040,-5929.66"/>
<text text-anchor="middle" x="1244" y="-6021.46" font-family="Times,serif" font-size="14.00">Input Layer</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_pp0</title>
<path fill="white" stroke="black" d="M62,-4398C62,-4398 2428,-4398 2428,-4398 2434,-4398 2440,-4404 2440,-4410 2440,-4410 2440,-5745.66 2440,-5745.66 2440,-5751.66 2434,-5757.66 2428,-5757.66 2428,-5757.66 62,-5757.66 62,-5757.66 56,-5757.66 50,-5751.66 50,-5745.66 50,-5745.66 50,-4410 50,-4410 50,-4404 56,-4398 62,-4398"/>
<text text-anchor="middle" x="1245" y="-5742.46" font-family="Times,serif" font-size="14.00">Pipeline Stage 0: Layers 0&#45;3 (GPUs 0&#45;127)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_pp1</title>
<path fill="white" stroke="black" d="M20,-3030.33C20,-3030.33 2386,-3030.33 2386,-3030.33 2392,-3030.33 2398,-3036.33 2398,-3042.33 2398,-3042.33 2398,-4378 2398,-4378 2398,-4384 2392,-4390 2386,-4390 2386,-4390 20,-4390 20,-4390 14,-4390 8,-4384 8,-4378 8,-4378 8,-3042.33 8,-3042.33 8,-3036.33 14,-3030.33 20,-3030.33"/>
<text text-anchor="middle" x="1203" y="-4374.8" font-family="Times,serif" font-size="14.00">Pipeline Stage 1: Layers 4&#45;7 (GPUs 128&#45;255)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_pp2</title>
<path fill="white" stroke="black" d="M20,-1662.67C20,-1662.67 2386,-1662.67 2386,-1662.67 2392,-1662.67 2398,-1668.67 2398,-1674.67 2398,-1674.67 2398,-3010.33 2398,-3010.33 2398,-3016.33 2392,-3022.33 2386,-3022.33 2386,-3022.33 20,-3022.33 20,-3022.33 14,-3022.33 8,-3016.33 8,-3010.33 8,-3010.33 8,-1674.67 8,-1674.67 8,-1668.67 14,-1662.67 20,-1662.67"/>
<text text-anchor="middle" x="1203" y="-3007.13" font-family="Times,serif" font-size="14.00">Pipeline Stage 2: Layers 8&#45;11 (GPUs 256&#45;383)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_pp3</title>
<path fill="white" stroke="black" d="M41,-295C41,-295 2407,-295 2407,-295 2413,-295 2419,-301 2419,-307 2419,-307 2419,-1642.67 2419,-1642.67 2419,-1648.67 2413,-1654.67 2407,-1654.67 2407,-1654.67 41,-1654.67 41,-1654.67 35,-1654.67 29,-1648.67 29,-1642.67 29,-1642.67 29,-307 29,-307 29,-301 35,-295 41,-295"/>
<text text-anchor="middle" x="1224" y="-1639.47" font-family="Times,serif" font-size="14.00">Pipeline Stage 3: Layers 12&#45;15 (GPUs 384&#45;511)</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_output</title>
<path fill="white" stroke="black" d="M759,-8C759,-8 1689,-8 1689,-8 1695,-8 1701,-14 1701,-20 1701,-20 1701,-275 1701,-275 1701,-281 1695,-287 1689,-287 1689,-287 759,-287 759,-287 753,-287 747,-281 747,-275 747,-275 747,-20 747,-20 747,-14 753,-8 759,-8"/>
<text text-anchor="middle" x="1224" y="-271.8" font-family="Times,serif" font-size="14.00">Output Layer</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="lightblue" stroke="black" points="1452,-6005.66 1036,-6005.66 1036,-5937.66 1452,-5937.66 1452,-6005.66"/>
<text text-anchor="middle" x="1244" y="-5990.46" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="1244" y="-5975.46" font-family="Times,serif" font-size="14.00">GPU: [0&#45;511]</text>
<text text-anchor="middle" x="1244" y="-5960.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1244" y="-5945.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- dp_split -->
<g id="node2" class="node">
<title>dp_split</title>
<polygon fill="lightyellow" stroke="black" points="1665.92,-5901.66 994.74,-5901.66 822.08,-5765.66 1493.26,-5765.66 1665.92,-5901.66"/>
<text text-anchor="middle" x="1244" y="-5852.46" font-family="Times,serif" font-size="14.00">DP Split</text>
<text text-anchor="middle" x="1244" y="-5837.46" font-family="Times,serif" font-size="14.00">GPU: [0&#45;511]</text>
<text text-anchor="middle" x="1244" y="-5822.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1244" y="-5807.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- input&#45;&gt;dp_split -->
<g id="edge1" class="edge">
<title>input&#45;&gt;dp_split</title>
<path fill="none" stroke="black" d="M1244,-5937.55C1244,-5937.55 1244,-5911.89 1244,-5911.89"/>
<polygon fill="black" stroke="black" points="1247.5,-5911.89 1244,-5901.89 1240.5,-5911.89 1247.5,-5911.89"/>
</g>
<!-- pp0_layer0_attn -->
<g id="node3" class="node">
<title>pp0_layer0_attn</title>
<polygon fill="lightblue" stroke="black" points="1447.5,-5726.66 1040.5,-5726.66 1040.5,-5658.66 1447.5,-5658.66 1447.5,-5726.66"/>
<text text-anchor="middle" x="1244" y="-5711.46" font-family="Times,serif" font-size="14.00">Layer 0: Attention</text>
<text text-anchor="middle" x="1244" y="-5696.46" font-family="Times,serif" font-size="14.00">GPU: [0&#45;31]</text>
<text text-anchor="middle" x="1244" y="-5681.46" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1244" y="-5666.46" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- dp_split&#45;&gt;pp0_layer0_attn -->
<g id="edge2" class="edge">
<title>dp_split&#45;&gt;pp0_layer0_attn</title>
<path fill="none" stroke="black" d="M1244,-5765.64C1244,-5765.64 1244,-5736.71 1244,-5736.71"/>
<polygon fill="black" stroke="black" points="1247.5,-5736.71 1244,-5726.71 1240.5,-5736.71 1247.5,-5736.71"/>
</g>
<!-- pp0_layer0_tp_comm -->
<g id="node4" class="node">
<title>pp0_layer0_tp_comm</title>
<ellipse fill="lightgreen" stroke="black" cx="1244" cy="-5574.58" rx="287.59" ry="48.17"/>
<text text-anchor="middle" x="1244" y="-5593.38" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1244" y="-5578.38" font-family="Times,serif" font-size="14.00">GPU: [0&#45;7], [8&#45;15], [16&#45;23], [24&#45;31]</text>
<text text-anchor="middle" x="1244" y="-5563.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=128]</text>
<text text-anchor="middle" x="1244" y="-5548.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp0_layer0_attn&#45;&gt;pp0_layer0_tp_comm -->
<g id="edge3" class="edge">
<title>pp0_layer0_attn&#45;&gt;pp0_layer0_tp_comm</title>
<path fill="none" stroke="black" d="M1244,-5658.51C1244,-5658.51 1244,-5632.71 1244,-5632.71"/>
<polygon fill="black" stroke="black" points="1247.5,-5632.71 1244,-5622.71 1240.5,-5632.71 1247.5,-5632.71"/>
</g>
<!-- pp0_layer0_moe -->
<g id="node5" class="node">
<title>pp0_layer0_moe</title>
<polygon fill="lightyellow" stroke="black" points="1665.92,-5490.5 994.74,-5490.5 822.08,-5354.5 1493.26,-5354.5 1665.92,-5490.5"/>
<text text-anchor="middle" x="1244" y="-5441.3" font-family="Times,serif" font-size="14.00">Layer 0: MoE Routing</text>
<text text-anchor="middle" x="1244" y="-5426.3" font-family="Times,serif" font-size="14.00">GPU: [0&#45;31]</text>
<text text-anchor="middle" x="1244" y="-5411.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1244" y="-5396.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp0_layer0_tp_comm&#45;&gt;pp0_layer0_moe -->
<g id="edge4" class="edge">
<title>pp0_layer0_tp_comm&#45;&gt;pp0_layer0_moe</title>
<path fill="none" stroke="black" d="M1244,-5526.46C1244,-5526.46 1244,-5500.59 1244,-5500.59"/>
<polygon fill="black" stroke="black" points="1247.5,-5500.59 1244,-5490.59 1240.5,-5500.59 1247.5,-5500.59"/>
</g>
<!-- pp0_layer0_gate -->
<g id="node6" class="node">
<title>pp0_layer0_gate</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1653.53,-5318.5 1002.06,-5318.5 834.47,-5182.5 1485.94,-5182.5 1653.53,-5318.5"/>
<text text-anchor="middle" x="1244" y="-5269.3" font-family="Times,serif" font-size="14.00">Expert Gate Selection</text>
<text text-anchor="middle" x="1244" y="-5254.3" font-family="Times,serif" font-size="14.00">GPU: [0&#45;31]</text>
<text text-anchor="middle" x="1244" y="-5239.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1244" y="-5224.3" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
</g>
<!-- pp0_layer0_moe&#45;&gt;pp0_layer0_gate -->
<g id="edge5" class="edge">
<title>pp0_layer0_moe&#45;&gt;pp0_layer0_gate</title>
<path fill="none" stroke="black" d="M1244,-5354.02C1244,-5354.02 1244,-5328.74 1244,-5328.74"/>
<polygon fill="black" stroke="black" points="1247.5,-5328.74 1244,-5318.74 1240.5,-5328.74 1247.5,-5328.74"/>
</g>
<!-- pp0_layer0_expert0 -->
<g id="node7" class="node">
<title>pp0_layer0_expert0</title>
<polygon fill="lightblue" stroke="black" points="680,-5146.5 270,-5146.5 270,-5078.5 680,-5078.5 680,-5146.5"/>
<text text-anchor="middle" x="475" y="-5131.3" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="475" y="-5116.3" font-family="Times,serif" font-size="14.00">GPU: [0&#45;7]</text>
<text text-anchor="middle" x="475" y="-5101.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="475" y="-5086.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp0_layer0_gate&#45;&gt;pp0_layer0_expert0 -->
<g id="edge6" class="edge">
<title>pp0_layer0_gate&#45;&gt;pp0_layer0_expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M917.6,-5250C708.08,-5250 475,-5250 475,-5250 475,-5250 475,-5156.84 475,-5156.84"/>
<polygon fill="black" stroke="black" points="478.5,-5156.84 475,-5146.84 471.5,-5156.84 478.5,-5156.84"/>
</g>
<!-- pp0_layer0_expert1 -->
<g id="node9" class="node">
<title>pp0_layer0_expert1</title>
<polygon fill="lightblue" stroke="black" points="1193,-5146.5 783,-5146.5 783,-5078.5 1193,-5078.5 1193,-5146.5"/>
<text text-anchor="middle" x="988" y="-5131.3" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="988" y="-5116.3" font-family="Times,serif" font-size="14.00">GPU: [8&#45;15]</text>
<text text-anchor="middle" x="988" y="-5101.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="988" y="-5086.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp0_layer0_gate&#45;&gt;pp0_layer0_expert1 -->
<g id="edge7" class="edge">
<title>pp0_layer0_gate&#45;&gt;pp0_layer0_expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1013.74,-5182.31C1013.74,-5182.31 1013.74,-5156.71 1013.74,-5156.71"/>
<polygon fill="black" stroke="black" points="1017.24,-5156.71 1013.74,-5146.71 1010.24,-5156.71 1017.24,-5156.71"/>
</g>
<!-- pp0_layer0_expert2 -->
<g id="node11" class="node">
<title>pp0_layer0_expert2</title>
<polygon fill="lightblue" stroke="black" points="1706,-5146.5 1296,-5146.5 1296,-5078.5 1706,-5078.5 1706,-5146.5"/>
<text text-anchor="middle" x="1501" y="-5131.3" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1501" y="-5116.3" font-family="Times,serif" font-size="14.00">GPU: [16&#45;23]</text>
<text text-anchor="middle" x="1501" y="-5101.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1501" y="-5086.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp0_layer0_gate&#45;&gt;pp0_layer0_expert2 -->
<g id="edge8" class="edge">
<title>pp0_layer0_gate&#45;&gt;pp0_layer0_expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1474.76,-5182.31C1474.76,-5182.31 1474.76,-5156.71 1474.76,-5156.71"/>
<polygon fill="black" stroke="black" points="1478.26,-5156.71 1474.76,-5146.71 1471.26,-5156.71 1478.26,-5156.71"/>
</g>
<!-- pp0_layer0_expert3 -->
<g id="node13" class="node">
<title>pp0_layer0_expert3</title>
<polygon fill="lightblue" stroke="black" points="2261,-5146.5 1851,-5146.5 1851,-5078.5 2261,-5078.5 2261,-5146.5"/>
<text text-anchor="middle" x="2056" y="-5131.3" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2056" y="-5116.3" font-family="Times,serif" font-size="14.00">GPU: [24&#45;31]</text>
<text text-anchor="middle" x="2056" y="-5101.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="2056" y="-5086.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp0_layer0_gate&#45;&gt;pp0_layer0_expert3 -->
<g id="edge9" class="edge">
<title>pp0_layer0_gate&#45;&gt;pp0_layer0_expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1569.3,-5250C1795.27,-5250 2056,-5250 2056,-5250 2056,-5250 2056,-5156.84 2056,-5156.84"/>
<polygon fill="black" stroke="black" points="2059.5,-5156.84 2056,-5146.84 2052.5,-5156.84 2059.5,-5156.84"/>
</g>
<!-- pp0_layer0_expert0_tp -->
<g id="node8" class="node">
<title>pp0_layer0_expert0_tp</title>
<ellipse fill="lightgreen" stroke="black" cx="348" cy="-4994.41" rx="289.83" ry="48.17"/>
<text text-anchor="middle" x="348" y="-5013.21" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="348" y="-4998.21" font-family="Times,serif" font-size="14.00">GPU: [0&#45;7]</text>
<text text-anchor="middle" x="348" y="-4983.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=256]</text>
<text text-anchor="middle" x="348" y="-4968.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp0_layer0_expert0&#45;&gt;pp0_layer0_expert0_tp -->
<g id="edge10" class="edge">
<title>pp0_layer0_expert0&#45;&gt;pp0_layer0_expert0_tp</title>
<path fill="none" stroke="black" d="M453.96,-5078.34C453.96,-5078.34 453.96,-5049.49 453.96,-5049.49"/>
<polygon fill="black" stroke="black" points="457.46,-5049.49 453.96,-5039.49 450.46,-5049.49 457.46,-5049.49"/>
</g>
<!-- pp0_layer0_agg -->
<g id="node15" class="node">
<title>pp0_layer0_agg</title>
<polygon fill="lightyellow" stroke="black" points="1421.96,-4910.33 715.72,-4910.33 534.04,-4774.33 1240.28,-4774.33 1421.96,-4910.33"/>
<text text-anchor="middle" x="978" y="-4861.13" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="978" y="-4846.13" font-family="Times,serif" font-size="14.00">GPU: [0&#45;31]</text>
<text text-anchor="middle" x="978" y="-4831.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024] × 4</text>
<text text-anchor="middle" x="978" y="-4816.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp0_layer0_expert0_tp&#45;&gt;pp0_layer0_agg -->
<g id="edge14" class="edge">
<title>pp0_layer0_expert0_tp&#45;&gt;pp0_layer0_agg</title>
<path fill="none" stroke="black" d="M586.09,-4966.87C586.09,-4966.87 586.09,-4852.39 586.09,-4852.39"/>
<polygon fill="black" stroke="black" points="589.59,-4852.39 586.09,-4842.39 582.59,-4852.39 589.59,-4852.39"/>
</g>
<!-- pp0_layer0_expert1_tp -->
<g id="node10" class="node">
<title>pp0_layer0_expert1_tp</title>
<ellipse fill="lightgreen" stroke="black" cx="946" cy="-4994.41" rx="289.83" ry="48.17"/>
<text text-anchor="middle" x="946" y="-5013.21" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="946" y="-4998.21" font-family="Times,serif" font-size="14.00">GPU: [8&#45;15]</text>
<text text-anchor="middle" x="946" y="-4983.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=256]</text>
<text text-anchor="middle" x="946" y="-4968.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp0_layer0_expert1&#45;&gt;pp0_layer0_expert1_tp -->
<g id="edge11" class="edge">
<title>pp0_layer0_expert1&#45;&gt;pp0_layer0_expert1_tp</title>
<path fill="none" stroke="black" d="M988,-5078.34C988,-5078.34 988,-5052.11 988,-5052.11"/>
<polygon fill="black" stroke="black" points="991.5,-5052.11 988,-5042.11 984.5,-5052.11 991.5,-5052.11"/>
</g>
<!-- pp0_layer0_expert1_tp&#45;&gt;pp0_layer0_agg -->
<g id="edge15" class="edge">
<title>pp0_layer0_expert1_tp&#45;&gt;pp0_layer0_agg</title>
<path fill="none" stroke="black" d="M946,-4946.29C946,-4946.29 946,-4920.42 946,-4920.42"/>
<polygon fill="black" stroke="black" points="949.5,-4920.42 946,-4910.42 942.5,-4920.42 949.5,-4920.42"/>
</g>
<!-- pp0_layer0_expert2_tp -->
<g id="node12" class="node">
<title>pp0_layer0_expert2_tp</title>
<ellipse fill="lightgreen" stroke="black" cx="1544" cy="-4994.41" rx="289.83" ry="48.17"/>
<text text-anchor="middle" x="1544" y="-5013.21" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1544" y="-4998.21" font-family="Times,serif" font-size="14.00">GPU: [16&#45;23]</text>
<text text-anchor="middle" x="1544" y="-4983.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=256]</text>
<text text-anchor="middle" x="1544" y="-4968.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp0_layer0_expert2&#45;&gt;pp0_layer0_expert2_tp -->
<g id="edge12" class="edge">
<title>pp0_layer0_expert2&#45;&gt;pp0_layer0_expert2_tp</title>
<path fill="none" stroke="black" d="M1501,-5078.34C1501,-5078.34 1501,-5052.11 1501,-5052.11"/>
<polygon fill="black" stroke="black" points="1504.5,-5052.11 1501,-5042.11 1497.5,-5052.11 1504.5,-5052.11"/>
</g>
<!-- pp0_layer0_expert2_tp&#45;&gt;pp0_layer0_agg -->
<g id="edge16" class="edge">
<title>pp0_layer0_expert2_tp&#45;&gt;pp0_layer0_agg</title>
<path fill="none" stroke="black" d="M1337.91,-4960.28C1337.91,-4960.28 1337.91,-4920.59 1337.91,-4920.59"/>
<polygon fill="black" stroke="black" points="1341.41,-4920.59 1337.91,-4910.59 1334.41,-4920.59 1341.41,-4920.59"/>
</g>
<!-- pp0_layer0_expert3_tp -->
<g id="node14" class="node">
<title>pp0_layer0_expert3_tp</title>
<ellipse fill="lightgreen" stroke="black" cx="2142" cy="-4994.41" rx="289.83" ry="48.17"/>
<text text-anchor="middle" x="2142" y="-5013.21" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="2142" y="-4998.21" font-family="Times,serif" font-size="14.00">GPU: [24&#45;31]</text>
<text text-anchor="middle" x="2142" y="-4983.21" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=256]</text>
<text text-anchor="middle" x="2142" y="-4968.21" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp0_layer0_expert3&#45;&gt;pp0_layer0_expert3_tp -->
<g id="edge13" class="edge">
<title>pp0_layer0_expert3&#45;&gt;pp0_layer0_expert3_tp</title>
<path fill="none" stroke="black" d="M2056.54,-5078.34C2056.54,-5078.34 2056.54,-5050.79 2056.54,-5050.79"/>
<polygon fill="black" stroke="black" points="2060.04,-5050.79 2056.54,-5040.79 2053.04,-5050.79 2060.04,-5050.79"/>
</g>
<!-- pp0_layer0_expert3_tp&#45;&gt;pp0_layer0_agg -->
<g id="edge17" class="edge">
<title>pp0_layer0_expert3_tp&#45;&gt;pp0_layer0_agg</title>
<path fill="none" stroke="black" d="M2041.04,-4949.1C2041.04,-4904.17 2041.04,-4842 2041.04,-4842 2041.04,-4842 1340.87,-4842 1340.87,-4842"/>
<polygon fill="black" stroke="black" points="1340.87,-4838.5 1330.87,-4842 1340.87,-4845.5 1340.87,-4838.5"/>
</g>
<!-- pp0_layer0_ep_comm -->
<g id="node16" class="node">
<title>pp0_layer0_ep_comm</title>
<ellipse fill="lightgreen" stroke="black" cx="978" cy="-4690.25" rx="287.59" ry="48.17"/>
<text text-anchor="middle" x="978" y="-4709.05" font-family="Times,serif" font-size="14.00">EP All&#45;to&#45;All</text>
<text text-anchor="middle" x="978" y="-4694.05" font-family="Times,serif" font-size="14.00">GPU: [0&#45;31]</text>
<text text-anchor="middle" x="978" y="-4679.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="978" y="-4664.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp0_layer0_agg&#45;&gt;pp0_layer0_ep_comm -->
<g id="edge18" class="edge">
<title>pp0_layer0_agg&#45;&gt;pp0_layer0_ep_comm</title>
<path fill="none" stroke="black" d="M978,-4774.3C978,-4774.3 978,-4748.64 978,-4748.64"/>
<polygon fill="black" stroke="black" points="981.5,-4748.64 978,-4738.64 974.5,-4748.64 981.5,-4748.64"/>
</g>
<!-- pp0_layer3_final -->
<g id="node17" class="node">
<title>pp0_layer3_final</title>
<polygon fill="lightblue" stroke="black" points="1181.5,-4606.16 774.5,-4606.16 774.5,-4538.16 1181.5,-4538.16 1181.5,-4606.16"/>
<text text-anchor="middle" x="978" y="-4590.96" font-family="Times,serif" font-size="14.00">Layer 3: Final</text>
<text text-anchor="middle" x="978" y="-4575.96" font-family="Times,serif" font-size="14.00">GPU: [0&#45;31]</text>
<text text-anchor="middle" x="978" y="-4560.96" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="978" y="-4545.96" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp0_layer0_ep_comm&#45;&gt;pp0_layer3_final -->
<g id="edge19" class="edge">
<title>pp0_layer0_ep_comm&#45;&gt;pp0_layer3_final</title>
<path fill="none" stroke="black" d="M978,-4641.88C978,-4641.88 978,-4616.2 978,-4616.2"/>
<polygon fill="black" stroke="black" points="981.5,-4616.2 978,-4606.2 974.5,-4616.2 981.5,-4616.2"/>
</g>
<!-- pp0_layer3_ep_comm -->
<g id="node18" class="node">
<title>pp0_layer3_ep_comm</title>
<ellipse fill="lightgreen" stroke="black" cx="978" cy="-4454.08" rx="287.59" ry="48.17"/>
<text text-anchor="middle" x="978" y="-4472.88" font-family="Times,serif" font-size="14.00">EP All&#45;to&#45;All</text>
<text text-anchor="middle" x="978" y="-4457.88" font-family="Times,serif" font-size="14.00">GPU: [0&#45;31]</text>
<text text-anchor="middle" x="978" y="-4442.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="978" y="-4427.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp0_layer3_final&#45;&gt;pp0_layer3_ep_comm -->
<g id="edge20" class="edge">
<title>pp0_layer3_final&#45;&gt;pp0_layer3_ep_comm</title>
<path fill="none" stroke="black" d="M978,-4538.01C978,-4538.01 978,-4512.21 978,-4512.21"/>
<polygon fill="black" stroke="black" points="981.5,-4512.21 978,-4502.21 974.5,-4512.21 981.5,-4512.21"/>
</g>
<!-- pp1_layer4_attn -->
<g id="node19" class="node">
<title>pp1_layer4_attn</title>
<polygon fill="lightblue" stroke="black" points="1181.5,-4359 774.5,-4359 774.5,-4291 1181.5,-4291 1181.5,-4359"/>
<text text-anchor="middle" x="978" y="-4343.8" font-family="Times,serif" font-size="14.00">Layer 4: Attention</text>
<text text-anchor="middle" x="978" y="-4328.8" font-family="Times,serif" font-size="14.00">GPU: [128&#45;159]</text>
<text text-anchor="middle" x="978" y="-4313.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="978" y="-4298.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp0_layer3_ep_comm&#45;&gt;pp1_layer4_attn -->
<g id="edge21" class="edge">
<title>pp0_layer3_ep_comm&#45;&gt;pp1_layer4_attn</title>
<path fill="none" stroke="black" d="M978,-4405.65C978,-4405.65 978,-4369.2 978,-4369.2"/>
<polygon fill="black" stroke="black" points="981.5,-4369.2 978,-4359.2 974.5,-4369.2 981.5,-4369.2"/>
</g>
<!-- pp1_layer4_tp_comm -->
<g id="node20" class="node">
<title>pp1_layer4_tp_comm</title>
<ellipse fill="lightgreen" stroke="black" cx="978" cy="-4206.92" rx="287.59" ry="48.17"/>
<text text-anchor="middle" x="978" y="-4225.72" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="978" y="-4210.72" font-family="Times,serif" font-size="14.00">GPU: [128&#45;135], [136&#45;143], [144&#45;151], [152&#45;159]</text>
<text text-anchor="middle" x="978" y="-4195.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=128]</text>
<text text-anchor="middle" x="978" y="-4180.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp1_layer4_attn&#45;&gt;pp1_layer4_tp_comm -->
<g id="edge22" class="edge">
<title>pp1_layer4_attn&#45;&gt;pp1_layer4_tp_comm</title>
<path fill="none" stroke="black" d="M978,-4290.84C978,-4290.84 978,-4265.05 978,-4265.05"/>
<polygon fill="black" stroke="black" points="981.5,-4265.05 978,-4255.05 974.5,-4265.05 981.5,-4265.05"/>
</g>
<!-- pp1_layer4_moe -->
<g id="node21" class="node">
<title>pp1_layer4_moe</title>
<polygon fill="lightyellow" stroke="black" points="1399.92,-4122.83 728.74,-4122.83 556.08,-3986.83 1227.26,-3986.83 1399.92,-4122.83"/>
<text text-anchor="middle" x="978" y="-4073.63" font-family="Times,serif" font-size="14.00">Layer 4: MoE Routing</text>
<text text-anchor="middle" x="978" y="-4058.63" font-family="Times,serif" font-size="14.00">GPU: [128&#45;159]</text>
<text text-anchor="middle" x="978" y="-4043.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="978" y="-4028.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp1_layer4_tp_comm&#45;&gt;pp1_layer4_moe -->
<g id="edge23" class="edge">
<title>pp1_layer4_tp_comm&#45;&gt;pp1_layer4_moe</title>
<path fill="none" stroke="black" d="M978,-4158.79C978,-4158.79 978,-4132.92 978,-4132.92"/>
<polygon fill="black" stroke="black" points="981.5,-4132.92 978,-4122.92 974.5,-4132.92 981.5,-4132.92"/>
</g>
<!-- pp1_layer4_gate -->
<g id="node22" class="node">
<title>pp1_layer4_gate</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1387.53,-3950.83 736.06,-3950.83 568.47,-3814.83 1219.94,-3814.83 1387.53,-3950.83"/>
<text text-anchor="middle" x="978" y="-3901.63" font-family="Times,serif" font-size="14.00">Expert Gate Selection</text>
<text text-anchor="middle" x="978" y="-3886.63" font-family="Times,serif" font-size="14.00">GPU: [128&#45;159]</text>
<text text-anchor="middle" x="978" y="-3871.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="978" y="-3856.63" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
</g>
<!-- pp1_layer4_moe&#45;&gt;pp1_layer4_gate -->
<g id="edge24" class="edge">
<title>pp1_layer4_moe&#45;&gt;pp1_layer4_gate</title>
<path fill="none" stroke="black" d="M978,-3986.36C978,-3986.36 978,-3961.07 978,-3961.07"/>
<polygon fill="black" stroke="black" points="981.5,-3961.07 978,-3951.07 974.5,-3961.07 981.5,-3961.07"/>
</g>
<!-- pp1_layer4_expert0 -->
<g id="node23" class="node">
<title>pp1_layer4_expert0</title>
<polygon fill="lightblue" stroke="black" points="649,-3778.83 239,-3778.83 239,-3710.83 649,-3710.83 649,-3778.83"/>
<text text-anchor="middle" x="444" y="-3763.63" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="444" y="-3748.63" font-family="Times,serif" font-size="14.00">GPU: [128&#45;135]</text>
<text text-anchor="middle" x="444" y="-3733.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="444" y="-3718.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp1_layer4_gate&#45;&gt;pp1_layer4_expert0 -->
<g id="edge25" class="edge">
<title>pp1_layer4_gate&#45;&gt;pp1_layer4_expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M608.74,-3882.73C608.74,-3882.73 608.74,-3789.07 608.74,-3789.07"/>
<polygon fill="black" stroke="black" points="612.24,-3789.07 608.74,-3779.07 605.24,-3789.07 612.24,-3789.07"/>
</g>
<!-- pp1_layer4_expert1 -->
<g id="node25" class="node">
<title>pp1_layer4_expert1</title>
<polygon fill="lightblue" stroke="black" points="1162,-3778.83 752,-3778.83 752,-3710.83 1162,-3710.83 1162,-3778.83"/>
<text text-anchor="middle" x="957" y="-3763.63" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="957" y="-3748.63" font-family="Times,serif" font-size="14.00">GPU: [136&#45;143]</text>
<text text-anchor="middle" x="957" y="-3733.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="957" y="-3718.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp1_layer4_gate&#45;&gt;pp1_layer4_expert1 -->
<g id="edge26" class="edge">
<title>pp1_layer4_gate&#45;&gt;pp1_layer4_expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M957,-3814.64C957,-3814.64 957,-3789.05 957,-3789.05"/>
<polygon fill="black" stroke="black" points="960.5,-3789.05 957,-3779.05 953.5,-3789.05 960.5,-3789.05"/>
</g>
<!-- pp1_layer4_expert2 -->
<g id="node27" class="node">
<title>pp1_layer4_expert2</title>
<polygon fill="lightblue" stroke="black" points="1675,-3778.83 1265,-3778.83 1265,-3710.83 1675,-3710.83 1675,-3778.83"/>
<text text-anchor="middle" x="1470" y="-3763.63" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1470" y="-3748.63" font-family="Times,serif" font-size="14.00">GPU: [144&#45;151]</text>
<text text-anchor="middle" x="1470" y="-3733.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1470" y="-3718.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp1_layer4_gate&#45;&gt;pp1_layer4_expert2 -->
<g id="edge27" class="edge">
<title>pp1_layer4_gate&#45;&gt;pp1_layer4_expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1326.26,-3882.73C1326.26,-3882.73 1326.26,-3789.07 1326.26,-3789.07"/>
<polygon fill="black" stroke="black" points="1329.76,-3789.07 1326.26,-3779.07 1322.76,-3789.07 1329.76,-3789.07"/>
</g>
<!-- pp1_layer4_expert3 -->
<g id="node29" class="node">
<title>pp1_layer4_expert3</title>
<polygon fill="lightblue" stroke="black" points="2230,-3778.83 1820,-3778.83 1820,-3710.83 2230,-3710.83 2230,-3778.83"/>
<text text-anchor="middle" x="2025" y="-3763.63" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2025" y="-3748.63" font-family="Times,serif" font-size="14.00">GPU: [152&#45;159]</text>
<text text-anchor="middle" x="2025" y="-3733.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="2025" y="-3718.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp1_layer4_gate&#45;&gt;pp1_layer4_expert3 -->
<g id="edge28" class="edge">
<title>pp1_layer4_gate&#45;&gt;pp1_layer4_expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1302.89,-3882C1542.49,-3882 1826.96,-3882 1826.96,-3882 1826.96,-3882 1826.96,-3789.09 1826.96,-3789.09"/>
<polygon fill="black" stroke="black" points="1830.46,-3789.09 1826.96,-3779.09 1823.46,-3789.09 1830.46,-3789.09"/>
</g>
<!-- pp1_layer4_expert0_tp -->
<g id="node24" class="node">
<title>pp1_layer4_expert0_tp</title>
<ellipse fill="lightgreen" stroke="black" cx="306" cy="-3626.75" rx="289.83" ry="48.17"/>
<text text-anchor="middle" x="306" y="-3645.55" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="306" y="-3630.55" font-family="Times,serif" font-size="14.00">GPU: [128&#45;135]</text>
<text text-anchor="middle" x="306" y="-3615.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=256]</text>
<text text-anchor="middle" x="306" y="-3600.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp1_layer4_expert0&#45;&gt;pp1_layer4_expert0_tp -->
<g id="edge29" class="edge">
<title>pp1_layer4_expert0&#45;&gt;pp1_layer4_expert0_tp</title>
<path fill="none" stroke="black" d="M417.46,-3710.68C417.46,-3710.68 417.46,-3681.39 417.46,-3681.39"/>
<polygon fill="black" stroke="black" points="420.96,-3681.39 417.46,-3671.39 413.96,-3681.39 420.96,-3681.39"/>
</g>
<!-- pp1_layer4_agg -->
<g id="node31" class="node">
<title>pp1_layer4_agg</title>
<polygon fill="lightyellow" stroke="black" points="1389.96,-3542.67 683.72,-3542.67 502.04,-3406.67 1208.28,-3406.67 1389.96,-3542.67"/>
<text text-anchor="middle" x="946" y="-3493.47" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="946" y="-3478.47" font-family="Times,serif" font-size="14.00">GPU: [128&#45;159]</text>
<text text-anchor="middle" x="946" y="-3463.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024] × 4</text>
<text text-anchor="middle" x="946" y="-3448.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp1_layer4_expert0_tp&#45;&gt;pp1_layer4_agg -->
<g id="edge33" class="edge">
<title>pp1_layer4_expert0_tp&#45;&gt;pp1_layer4_agg</title>
<path fill="none" stroke="black" d="M549.09,-3600.26C549.09,-3600.26 549.09,-3484.72 549.09,-3484.72"/>
<polygon fill="black" stroke="black" points="552.59,-3484.72 549.09,-3474.72 545.59,-3484.72 552.59,-3484.72"/>
</g>
<!-- pp1_layer4_expert1_tp -->
<g id="node26" class="node">
<title>pp1_layer4_expert1_tp</title>
<ellipse fill="lightgreen" stroke="black" cx="904" cy="-3626.75" rx="289.83" ry="48.17"/>
<text text-anchor="middle" x="904" y="-3645.55" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="904" y="-3630.55" font-family="Times,serif" font-size="14.00">GPU: [136&#45;143]</text>
<text text-anchor="middle" x="904" y="-3615.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=256]</text>
<text text-anchor="middle" x="904" y="-3600.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp1_layer4_expert1&#45;&gt;pp1_layer4_expert1_tp -->
<g id="edge30" class="edge">
<title>pp1_layer4_expert1&#45;&gt;pp1_layer4_expert1_tp</title>
<path fill="none" stroke="black" d="M957,-3710.68C957,-3710.68 957,-3684.44 957,-3684.44"/>
<polygon fill="black" stroke="black" points="960.5,-3684.44 957,-3674.44 953.5,-3684.44 960.5,-3684.44"/>
</g>
<!-- pp1_layer4_expert1_tp&#45;&gt;pp1_layer4_agg -->
<g id="edge34" class="edge">
<title>pp1_layer4_expert1_tp&#45;&gt;pp1_layer4_agg</title>
<path fill="none" stroke="black" d="M904,-3578.63C904,-3578.63 904,-3552.76 904,-3552.76"/>
<polygon fill="black" stroke="black" points="907.5,-3552.76 904,-3542.76 900.5,-3552.76 907.5,-3552.76"/>
</g>
<!-- pp1_layer4_expert2_tp -->
<g id="node28" class="node">
<title>pp1_layer4_expert2_tp</title>
<ellipse fill="lightgreen" stroke="black" cx="1502" cy="-3626.75" rx="289.83" ry="48.17"/>
<text text-anchor="middle" x="1502" y="-3645.55" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1502" y="-3630.55" font-family="Times,serif" font-size="14.00">GPU: [144&#45;151]</text>
<text text-anchor="middle" x="1502" y="-3615.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=256]</text>
<text text-anchor="middle" x="1502" y="-3600.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp1_layer4_expert2&#45;&gt;pp1_layer4_expert2_tp -->
<g id="edge31" class="edge">
<title>pp1_layer4_expert2&#45;&gt;pp1_layer4_expert2_tp</title>
<path fill="none" stroke="black" d="M1470,-3710.68C1470,-3710.68 1470,-3684.88 1470,-3684.88"/>
<polygon fill="black" stroke="black" points="1473.5,-3684.88 1470,-3674.88 1466.5,-3684.88 1473.5,-3684.88"/>
</g>
<!-- pp1_layer4_expert2_tp&#45;&gt;pp1_layer4_agg -->
<g id="edge35" class="edge">
<title>pp1_layer4_expert2_tp&#45;&gt;pp1_layer4_agg</title>
<path fill="none" stroke="black" d="M1300.91,-3591.86C1300.91,-3591.86 1300.91,-3552.94 1300.91,-3552.94"/>
<polygon fill="black" stroke="black" points="1304.41,-3552.94 1300.91,-3542.94 1297.41,-3552.94 1304.41,-3552.94"/>
</g>
<!-- pp1_layer4_expert3_tp -->
<g id="node30" class="node">
<title>pp1_layer4_expert3_tp</title>
<ellipse fill="lightgreen" stroke="black" cx="2100" cy="-3626.75" rx="289.83" ry="48.17"/>
<text text-anchor="middle" x="2100" y="-3645.55" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="2100" y="-3630.55" font-family="Times,serif" font-size="14.00">GPU: [152&#45;159]</text>
<text text-anchor="middle" x="2100" y="-3615.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=256]</text>
<text text-anchor="middle" x="2100" y="-3600.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp1_layer4_expert3&#45;&gt;pp1_layer4_expert3_tp -->
<g id="edge32" class="edge">
<title>pp1_layer4_expert3&#45;&gt;pp1_layer4_expert3_tp</title>
<path fill="none" stroke="black" d="M2025,-3710.68C2025,-3710.68 2025,-3683.56 2025,-3683.56"/>
<polygon fill="black" stroke="black" points="2028.5,-3683.56 2025,-3673.56 2021.5,-3683.56 2028.5,-3683.56"/>
</g>
<!-- pp1_layer4_expert3_tp&#45;&gt;pp1_layer4_agg -->
<g id="edge36" class="edge">
<title>pp1_layer4_expert3_tp&#45;&gt;pp1_layer4_agg</title>
<path fill="none" stroke="black" d="M1946.39,-3585.81C1946.39,-3540.57 1946.39,-3474 1946.39,-3474 1946.39,-3474 1308.35,-3474 1308.35,-3474"/>
<polygon fill="black" stroke="black" points="1308.35,-3470.5 1298.35,-3474 1308.35,-3477.5 1308.35,-3470.5"/>
</g>
<!-- pp1_layer4_ep_comm -->
<g id="node32" class="node">
<title>pp1_layer4_ep_comm</title>
<ellipse fill="lightgreen" stroke="black" cx="946" cy="-3322.58" rx="287.59" ry="48.17"/>
<text text-anchor="middle" x="946" y="-3341.38" font-family="Times,serif" font-size="14.00">EP All&#45;to&#45;All</text>
<text text-anchor="middle" x="946" y="-3326.38" font-family="Times,serif" font-size="14.00">GPU: [128&#45;159]</text>
<text text-anchor="middle" x="946" y="-3311.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="946" y="-3296.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp1_layer4_agg&#45;&gt;pp1_layer4_ep_comm -->
<g id="edge37" class="edge">
<title>pp1_layer4_agg&#45;&gt;pp1_layer4_ep_comm</title>
<path fill="none" stroke="black" d="M946,-3406.63C946,-3406.63 946,-3380.98 946,-3380.98"/>
<polygon fill="black" stroke="black" points="949.5,-3380.98 946,-3370.98 942.5,-3380.98 949.5,-3380.98"/>
</g>
<!-- pp1_layer7_final -->
<g id="node33" class="node">
<title>pp1_layer7_final</title>
<polygon fill="lightblue" stroke="black" points="1149.5,-3238.5 742.5,-3238.5 742.5,-3170.5 1149.5,-3170.5 1149.5,-3238.5"/>
<text text-anchor="middle" x="946" y="-3223.3" font-family="Times,serif" font-size="14.00">Layer 7: Final</text>
<text text-anchor="middle" x="946" y="-3208.3" font-family="Times,serif" font-size="14.00">GPU: [128&#45;159]</text>
<text text-anchor="middle" x="946" y="-3193.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="946" y="-3178.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp1_layer4_ep_comm&#45;&gt;pp1_layer7_final -->
<g id="edge38" class="edge">
<title>pp1_layer4_ep_comm&#45;&gt;pp1_layer7_final</title>
<path fill="none" stroke="black" d="M946,-3274.21C946,-3274.21 946,-3248.53 946,-3248.53"/>
<polygon fill="black" stroke="black" points="949.5,-3248.53 946,-3238.53 942.5,-3248.53 949.5,-3248.53"/>
</g>
<!-- pp1_layer7_ep_comm -->
<g id="node34" class="node">
<title>pp1_layer7_ep_comm</title>
<ellipse fill="lightgreen" stroke="black" cx="946" cy="-3086.42" rx="287.59" ry="48.17"/>
<text text-anchor="middle" x="946" y="-3105.22" font-family="Times,serif" font-size="14.00">EP All&#45;to&#45;All</text>
<text text-anchor="middle" x="946" y="-3090.22" font-family="Times,serif" font-size="14.00">GPU: [128&#45;159]</text>
<text text-anchor="middle" x="946" y="-3075.22" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="946" y="-3060.22" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp1_layer7_final&#45;&gt;pp1_layer7_ep_comm -->
<g id="edge39" class="edge">
<title>pp1_layer7_final&#45;&gt;pp1_layer7_ep_comm</title>
<path fill="none" stroke="black" d="M946,-3170.34C946,-3170.34 946,-3144.55 946,-3144.55"/>
<polygon fill="black" stroke="black" points="949.5,-3144.55 946,-3134.55 942.5,-3144.55 949.5,-3144.55"/>
</g>
<!-- pp2_layer8_attn -->
<g id="node35" class="node">
<title>pp2_layer8_attn</title>
<polygon fill="lightblue" stroke="black" points="1149.5,-2991.33 742.5,-2991.33 742.5,-2923.33 1149.5,-2923.33 1149.5,-2991.33"/>
<text text-anchor="middle" x="946" y="-2976.13" font-family="Times,serif" font-size="14.00">Layer 8: Attention</text>
<text text-anchor="middle" x="946" y="-2961.13" font-family="Times,serif" font-size="14.00">GPU: [256&#45;287]</text>
<text text-anchor="middle" x="946" y="-2946.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="946" y="-2931.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp1_layer7_ep_comm&#45;&gt;pp2_layer8_attn -->
<g id="edge40" class="edge">
<title>pp1_layer7_ep_comm&#45;&gt;pp2_layer8_attn</title>
<path fill="none" stroke="black" d="M946,-3037.98C946,-3037.98 946,-3001.54 946,-3001.54"/>
<polygon fill="black" stroke="black" points="949.5,-3001.54 946,-2991.54 942.5,-3001.54 949.5,-3001.54"/>
</g>
<!-- pp2_layer8_tp_comm -->
<g id="node36" class="node">
<title>pp2_layer8_tp_comm</title>
<ellipse fill="lightgreen" stroke="black" cx="946" cy="-2839.25" rx="287.59" ry="48.17"/>
<text text-anchor="middle" x="946" y="-2858.05" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="946" y="-2843.05" font-family="Times,serif" font-size="14.00">GPU: [256&#45;263], [264&#45;271], [272&#45;279], [280&#45;287]</text>
<text text-anchor="middle" x="946" y="-2828.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=128]</text>
<text text-anchor="middle" x="946" y="-2813.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp2_layer8_attn&#45;&gt;pp2_layer8_tp_comm -->
<g id="edge41" class="edge">
<title>pp2_layer8_attn&#45;&gt;pp2_layer8_tp_comm</title>
<path fill="none" stroke="black" d="M946,-2923.18C946,-2923.18 946,-2897.38 946,-2897.38"/>
<polygon fill="black" stroke="black" points="949.5,-2897.38 946,-2887.38 942.5,-2897.38 949.5,-2897.38"/>
</g>
<!-- pp2_layer8_moe -->
<g id="node37" class="node">
<title>pp2_layer8_moe</title>
<polygon fill="lightyellow" stroke="black" points="1367.92,-2755.17 696.74,-2755.17 524.08,-2619.17 1195.26,-2619.17 1367.92,-2755.17"/>
<text text-anchor="middle" x="946" y="-2705.97" font-family="Times,serif" font-size="14.00">Layer 8: MoE Routing</text>
<text text-anchor="middle" x="946" y="-2690.97" font-family="Times,serif" font-size="14.00">GPU: [256&#45;287]</text>
<text text-anchor="middle" x="946" y="-2675.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="946" y="-2660.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp2_layer8_tp_comm&#45;&gt;pp2_layer8_moe -->
<g id="edge42" class="edge">
<title>pp2_layer8_tp_comm&#45;&gt;pp2_layer8_moe</title>
<path fill="none" stroke="black" d="M946,-2791.13C946,-2791.13 946,-2765.26 946,-2765.26"/>
<polygon fill="black" stroke="black" points="949.5,-2765.26 946,-2755.26 942.5,-2765.26 949.5,-2765.26"/>
</g>
<!-- pp2_layer8_gate -->
<g id="node38" class="node">
<title>pp2_layer8_gate</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1355.53,-2583.17 704.06,-2583.17 536.47,-2447.17 1187.94,-2447.17 1355.53,-2583.17"/>
<text text-anchor="middle" x="946" y="-2533.97" font-family="Times,serif" font-size="14.00">Expert Gate Selection</text>
<text text-anchor="middle" x="946" y="-2518.97" font-family="Times,serif" font-size="14.00">GPU: [256&#45;287]</text>
<text text-anchor="middle" x="946" y="-2503.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="946" y="-2488.97" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
</g>
<!-- pp2_layer8_moe&#45;&gt;pp2_layer8_gate -->
<g id="edge43" class="edge">
<title>pp2_layer8_moe&#45;&gt;pp2_layer8_gate</title>
<path fill="none" stroke="black" d="M946,-2618.69C946,-2618.69 946,-2593.4 946,-2593.4"/>
<polygon fill="black" stroke="black" points="949.5,-2593.4 946,-2583.4 942.5,-2593.4 949.5,-2593.4"/>
</g>
<!-- pp2_layer8_expert0 -->
<g id="node39" class="node">
<title>pp2_layer8_expert0</title>
<polygon fill="lightblue" stroke="black" points="596,-2411.17 186,-2411.17 186,-2343.17 596,-2343.17 596,-2411.17"/>
<text text-anchor="middle" x="391" y="-2395.97" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="391" y="-2380.97" font-family="Times,serif" font-size="14.00">GPU: [256&#45;263]</text>
<text text-anchor="middle" x="391" y="-2365.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="391" y="-2350.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp2_layer8_gate&#45;&gt;pp2_layer8_expert0 -->
<g id="edge44" class="edge">
<title>pp2_layer8_gate&#45;&gt;pp2_layer8_expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M566.24,-2515.07C566.24,-2515.07 566.24,-2421.41 566.24,-2421.41"/>
<polygon fill="black" stroke="black" points="569.74,-2421.41 566.24,-2411.41 562.74,-2421.41 569.74,-2421.41"/>
</g>
<!-- pp2_layer8_expert1 -->
<g id="node41" class="node">
<title>pp2_layer8_expert1</title>
<polygon fill="lightblue" stroke="black" points="1151,-2411.17 741,-2411.17 741,-2343.17 1151,-2343.17 1151,-2411.17"/>
<text text-anchor="middle" x="946" y="-2395.97" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="946" y="-2380.97" font-family="Times,serif" font-size="14.00">GPU: [264&#45;271]</text>
<text text-anchor="middle" x="946" y="-2365.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="946" y="-2350.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp2_layer8_gate&#45;&gt;pp2_layer8_expert1 -->
<g id="edge45" class="edge">
<title>pp2_layer8_gate&#45;&gt;pp2_layer8_expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M946,-2446.97C946,-2446.97 946,-2421.38 946,-2421.38"/>
<polygon fill="black" stroke="black" points="949.5,-2421.38 946,-2411.38 942.5,-2421.38 949.5,-2421.38"/>
</g>
<!-- pp2_layer8_expert2 -->
<g id="node43" class="node">
<title>pp2_layer8_expert2</title>
<polygon fill="lightblue" stroke="black" points="1664,-2411.17 1254,-2411.17 1254,-2343.17 1664,-2343.17 1664,-2411.17"/>
<text text-anchor="middle" x="1459" y="-2395.97" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1459" y="-2380.97" font-family="Times,serif" font-size="14.00">GPU: [272&#45;279]</text>
<text text-anchor="middle" x="1459" y="-2365.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1459" y="-2350.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp2_layer8_gate&#45;&gt;pp2_layer8_expert2 -->
<g id="edge46" class="edge">
<title>pp2_layer8_gate&#45;&gt;pp2_layer8_expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1304.76,-2515.07C1304.76,-2515.07 1304.76,-2421.41 1304.76,-2421.41"/>
<polygon fill="black" stroke="black" points="1308.26,-2421.41 1304.76,-2411.41 1301.26,-2421.41 1308.26,-2421.41"/>
</g>
<!-- pp2_layer8_expert3 -->
<g id="node45" class="node">
<title>pp2_layer8_expert3</title>
<polygon fill="lightblue" stroke="black" points="2219,-2411.17 1809,-2411.17 1809,-2343.17 2219,-2343.17 2219,-2411.17"/>
<text text-anchor="middle" x="2014" y="-2395.97" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2014" y="-2380.97" font-family="Times,serif" font-size="14.00">GPU: [280&#45;287]</text>
<text text-anchor="middle" x="2014" y="-2365.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="2014" y="-2350.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp2_layer8_gate&#45;&gt;pp2_layer8_expert3 -->
<g id="edge47" class="edge">
<title>pp2_layer8_gate&#45;&gt;pp2_layer8_expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1271.73,-2515C1607.62,-2515 2082.7,-2515 2082.7,-2515 2082.7,-2515 2082.7,-2421.24 2082.7,-2421.24"/>
<polygon fill="black" stroke="black" points="2086.2,-2421.24 2082.7,-2411.24 2079.2,-2421.24 2086.2,-2421.24"/>
</g>
<!-- pp2_layer8_expert0_tp -->
<g id="node40" class="node">
<title>pp2_layer8_expert0_tp</title>
<ellipse fill="lightgreen" stroke="black" cx="306" cy="-2259.08" rx="289.83" ry="48.17"/>
<text text-anchor="middle" x="306" y="-2277.88" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="306" y="-2262.88" font-family="Times,serif" font-size="14.00">GPU: [256&#45;263]</text>
<text text-anchor="middle" x="306" y="-2247.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=256]</text>
<text text-anchor="middle" x="306" y="-2232.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp2_layer8_expert0&#45;&gt;pp2_layer8_expert0_tp -->
<g id="edge48" class="edge">
<title>pp2_layer8_expert0&#45;&gt;pp2_layer8_expert0_tp</title>
<path fill="none" stroke="black" d="M390.96,-2343.01C390.96,-2343.01 390.96,-2315.46 390.96,-2315.46"/>
<polygon fill="black" stroke="black" points="394.46,-2315.46 390.96,-2305.46 387.46,-2315.46 394.46,-2315.46"/>
</g>
<!-- pp2_layer8_agg -->
<g id="node47" class="node">
<title>pp2_layer8_agg</title>
<polygon fill="lightyellow" stroke="black" points="1368.96,-2175 662.72,-2175 481.04,-2039 1187.28,-2039 1368.96,-2175"/>
<text text-anchor="middle" x="925" y="-2125.8" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="925" y="-2110.8" font-family="Times,serif" font-size="14.00">GPU: [256&#45;287]</text>
<text text-anchor="middle" x="925" y="-2095.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024] × 4</text>
<text text-anchor="middle" x="925" y="-2080.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp2_layer8_expert0_tp&#45;&gt;pp2_layer8_agg -->
<g id="edge52" class="edge">
<title>pp2_layer8_expert0_tp&#45;&gt;pp2_layer8_agg</title>
<path fill="none" stroke="black" d="M538.59,-2230.12C538.59,-2230.12 538.59,-2117.06 538.59,-2117.06"/>
<polygon fill="black" stroke="black" points="542.09,-2117.06 538.59,-2107.06 535.09,-2117.06 542.09,-2117.06"/>
</g>
<!-- pp2_layer8_expert1_tp -->
<g id="node42" class="node">
<title>pp2_layer8_expert1_tp</title>
<ellipse fill="lightgreen" stroke="black" cx="904" cy="-2259.08" rx="289.83" ry="48.17"/>
<text text-anchor="middle" x="904" y="-2277.88" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="904" y="-2262.88" font-family="Times,serif" font-size="14.00">GPU: [264&#45;271]</text>
<text text-anchor="middle" x="904" y="-2247.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=256]</text>
<text text-anchor="middle" x="904" y="-2232.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp2_layer8_expert1&#45;&gt;pp2_layer8_expert1_tp -->
<g id="edge49" class="edge">
<title>pp2_layer8_expert1&#45;&gt;pp2_layer8_expert1_tp</title>
<path fill="none" stroke="black" d="M946,-2343.01C946,-2343.01 946,-2316.77 946,-2316.77"/>
<polygon fill="black" stroke="black" points="949.5,-2316.77 946,-2306.77 942.5,-2316.77 949.5,-2316.77"/>
</g>
<!-- pp2_layer8_expert1_tp&#45;&gt;pp2_layer8_agg -->
<g id="edge53" class="edge">
<title>pp2_layer8_expert1_tp&#45;&gt;pp2_layer8_agg</title>
<path fill="none" stroke="black" d="M904,-2210.96C904,-2210.96 904,-2185.09 904,-2185.09"/>
<polygon fill="black" stroke="black" points="907.5,-2185.09 904,-2175.09 900.5,-2185.09 907.5,-2185.09"/>
</g>
<!-- pp2_layer8_expert2_tp -->
<g id="node44" class="node">
<title>pp2_layer8_expert2_tp</title>
<ellipse fill="lightgreen" stroke="black" cx="1502" cy="-2259.08" rx="289.83" ry="48.17"/>
<text text-anchor="middle" x="1502" y="-2277.88" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1502" y="-2262.88" font-family="Times,serif" font-size="14.00">GPU: [272&#45;279]</text>
<text text-anchor="middle" x="1502" y="-2247.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=256]</text>
<text text-anchor="middle" x="1502" y="-2232.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp2_layer8_expert2&#45;&gt;pp2_layer8_expert2_tp -->
<g id="edge50" class="edge">
<title>pp2_layer8_expert2&#45;&gt;pp2_layer8_expert2_tp</title>
<path fill="none" stroke="black" d="M1459,-2343.01C1459,-2343.01 1459,-2316.77 1459,-2316.77"/>
<polygon fill="black" stroke="black" points="1462.5,-2316.77 1459,-2306.77 1455.5,-2316.77 1462.5,-2316.77"/>
</g>
<!-- pp2_layer8_expert2_tp&#45;&gt;pp2_layer8_agg -->
<g id="edge54" class="edge">
<title>pp2_layer8_expert2_tp&#45;&gt;pp2_layer8_agg</title>
<path fill="none" stroke="black" d="M1290.41,-2226.08C1290.41,-2226.08 1290.41,-2185.23 1290.41,-2185.23"/>
<polygon fill="black" stroke="black" points="1293.91,-2185.23 1290.41,-2175.23 1286.91,-2185.23 1293.91,-2185.23"/>
</g>
<!-- pp2_layer8_expert3_tp -->
<g id="node46" class="node">
<title>pp2_layer8_expert3_tp</title>
<ellipse fill="lightgreen" stroke="black" cx="2100" cy="-2259.08" rx="289.83" ry="48.17"/>
<text text-anchor="middle" x="2100" y="-2277.88" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="2100" y="-2262.88" font-family="Times,serif" font-size="14.00">GPU: [280&#45;287]</text>
<text text-anchor="middle" x="2100" y="-2247.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=256]</text>
<text text-anchor="middle" x="2100" y="-2232.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp2_layer8_expert3&#45;&gt;pp2_layer8_expert3_tp -->
<g id="edge51" class="edge">
<title>pp2_layer8_expert3&#45;&gt;pp2_layer8_expert3_tp</title>
<path fill="none" stroke="black" d="M2014.54,-2343.01C2014.54,-2343.01 2014.54,-2315.46 2014.54,-2315.46"/>
<polygon fill="black" stroke="black" points="2018.04,-2315.46 2014.54,-2305.46 2011.04,-2315.46 2018.04,-2315.46"/>
</g>
<!-- pp2_layer8_expert3_tp&#45;&gt;pp2_layer8_agg -->
<g id="edge55" class="edge">
<title>pp2_layer8_expert3_tp&#45;&gt;pp2_layer8_agg</title>
<path fill="none" stroke="black" d="M2004.04,-2213.57C2004.04,-2168.44 2004.04,-2106 2004.04,-2106 2004.04,-2106 1286.83,-2106 1286.83,-2106"/>
<polygon fill="black" stroke="black" points="1286.83,-2102.5 1276.83,-2106 1286.83,-2109.5 1286.83,-2102.5"/>
</g>
<!-- pp2_layer8_ep_comm -->
<g id="node48" class="node">
<title>pp2_layer8_ep_comm</title>
<ellipse fill="lightgreen" stroke="black" cx="925" cy="-1954.92" rx="287.59" ry="48.17"/>
<text text-anchor="middle" x="925" y="-1973.72" font-family="Times,serif" font-size="14.00">EP All&#45;to&#45;All</text>
<text text-anchor="middle" x="925" y="-1958.72" font-family="Times,serif" font-size="14.00">GPU: [256&#45;287]</text>
<text text-anchor="middle" x="925" y="-1943.72" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="925" y="-1928.72" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp2_layer8_agg&#45;&gt;pp2_layer8_ep_comm -->
<g id="edge56" class="edge">
<title>pp2_layer8_agg&#45;&gt;pp2_layer8_ep_comm</title>
<path fill="none" stroke="black" d="M925,-2038.96C925,-2038.96 925,-2013.31 925,-2013.31"/>
<polygon fill="black" stroke="black" points="928.5,-2013.31 925,-2003.31 921.5,-2013.31 928.5,-2013.31"/>
</g>
<!-- pp2_layer11_final -->
<g id="node49" class="node">
<title>pp2_layer11_final</title>
<polygon fill="lightblue" stroke="black" points="1128.5,-1870.83 721.5,-1870.83 721.5,-1802.83 1128.5,-1802.83 1128.5,-1870.83"/>
<text text-anchor="middle" x="925" y="-1855.63" font-family="Times,serif" font-size="14.00">Layer 11: Final</text>
<text text-anchor="middle" x="925" y="-1840.63" font-family="Times,serif" font-size="14.00">GPU: [256&#45;287]</text>
<text text-anchor="middle" x="925" y="-1825.63" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="925" y="-1810.63" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp2_layer8_ep_comm&#45;&gt;pp2_layer11_final -->
<g id="edge57" class="edge">
<title>pp2_layer8_ep_comm&#45;&gt;pp2_layer11_final</title>
<path fill="none" stroke="black" d="M925,-1906.55C925,-1906.55 925,-1880.87 925,-1880.87"/>
<polygon fill="black" stroke="black" points="928.5,-1880.87 925,-1870.87 921.5,-1880.87 928.5,-1880.87"/>
</g>
<!-- pp2_layer11_ep_comm -->
<g id="node50" class="node">
<title>pp2_layer11_ep_comm</title>
<ellipse fill="lightgreen" stroke="black" cx="925" cy="-1718.75" rx="287.59" ry="48.17"/>
<text text-anchor="middle" x="925" y="-1737.55" font-family="Times,serif" font-size="14.00">EP All&#45;to&#45;All</text>
<text text-anchor="middle" x="925" y="-1722.55" font-family="Times,serif" font-size="14.00">GPU: [256&#45;287]</text>
<text text-anchor="middle" x="925" y="-1707.55" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="925" y="-1692.55" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp2_layer11_final&#45;&gt;pp2_layer11_ep_comm -->
<g id="edge58" class="edge">
<title>pp2_layer11_final&#45;&gt;pp2_layer11_ep_comm</title>
<path fill="none" stroke="black" d="M925,-1802.68C925,-1802.68 925,-1776.88 925,-1776.88"/>
<polygon fill="black" stroke="black" points="928.5,-1776.88 925,-1766.88 921.5,-1776.88 928.5,-1776.88"/>
</g>
<!-- pp3_layer12_attn -->
<g id="node51" class="node">
<title>pp3_layer12_attn</title>
<polygon fill="lightblue" stroke="black" points="1128.5,-1623.67 721.5,-1623.67 721.5,-1555.67 1128.5,-1555.67 1128.5,-1623.67"/>
<text text-anchor="middle" x="925" y="-1608.47" font-family="Times,serif" font-size="14.00">Layer 12: Attention</text>
<text text-anchor="middle" x="925" y="-1593.47" font-family="Times,serif" font-size="14.00">GPU: [384&#45;415]</text>
<text text-anchor="middle" x="925" y="-1578.47" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="925" y="-1563.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp2_layer11_ep_comm&#45;&gt;pp3_layer12_attn -->
<g id="edge59" class="edge">
<title>pp2_layer11_ep_comm&#45;&gt;pp3_layer12_attn</title>
<path fill="none" stroke="black" d="M925,-1670.32C925,-1670.32 925,-1633.87 925,-1633.87"/>
<polygon fill="black" stroke="black" points="928.5,-1633.87 925,-1623.87 921.5,-1633.87 928.5,-1633.87"/>
</g>
<!-- pp3_layer12_tp_comm -->
<g id="node52" class="node">
<title>pp3_layer12_tp_comm</title>
<ellipse fill="lightgreen" stroke="black" cx="925" cy="-1471.58" rx="287.59" ry="48.17"/>
<text text-anchor="middle" x="925" y="-1490.38" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="925" y="-1475.38" font-family="Times,serif" font-size="14.00">GPU: [384&#45;391], [392&#45;399], [400&#45;407], [408&#45;415]</text>
<text text-anchor="middle" x="925" y="-1460.38" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=128]</text>
<text text-anchor="middle" x="925" y="-1445.38" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp3_layer12_attn&#45;&gt;pp3_layer12_tp_comm -->
<g id="edge60" class="edge">
<title>pp3_layer12_attn&#45;&gt;pp3_layer12_tp_comm</title>
<path fill="none" stroke="black" d="M925,-1555.51C925,-1555.51 925,-1529.71 925,-1529.71"/>
<polygon fill="black" stroke="black" points="928.5,-1529.71 925,-1519.71 921.5,-1529.71 928.5,-1529.71"/>
</g>
<!-- pp3_layer12_moe -->
<g id="node53" class="node">
<title>pp3_layer12_moe</title>
<polygon fill="lightyellow" stroke="black" points="1346.92,-1387.5 675.74,-1387.5 503.08,-1251.5 1174.26,-1251.5 1346.92,-1387.5"/>
<text text-anchor="middle" x="925" y="-1338.3" font-family="Times,serif" font-size="14.00">Layer 12: MoE Routing</text>
<text text-anchor="middle" x="925" y="-1323.3" font-family="Times,serif" font-size="14.00">GPU: [384&#45;415]</text>
<text text-anchor="middle" x="925" y="-1308.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="925" y="-1293.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp3_layer12_tp_comm&#45;&gt;pp3_layer12_moe -->
<g id="edge61" class="edge">
<title>pp3_layer12_tp_comm&#45;&gt;pp3_layer12_moe</title>
<path fill="none" stroke="black" d="M925,-1423.46C925,-1423.46 925,-1397.59 925,-1397.59"/>
<polygon fill="black" stroke="black" points="928.5,-1397.59 925,-1387.59 921.5,-1397.59 928.5,-1397.59"/>
</g>
<!-- pp3_layer12_gate -->
<g id="node54" class="node">
<title>pp3_layer12_gate</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1334.53,-1215.5 683.06,-1215.5 515.47,-1079.5 1166.94,-1079.5 1334.53,-1215.5"/>
<text text-anchor="middle" x="925" y="-1166.3" font-family="Times,serif" font-size="14.00">Expert Gate Selection</text>
<text text-anchor="middle" x="925" y="-1151.3" font-family="Times,serif" font-size="14.00">GPU: [384&#45;415]</text>
<text text-anchor="middle" x="925" y="-1136.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="925" y="-1121.3" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
</g>
<!-- pp3_layer12_moe&#45;&gt;pp3_layer12_gate -->
<g id="edge62" class="edge">
<title>pp3_layer12_moe&#45;&gt;pp3_layer12_gate</title>
<path fill="none" stroke="black" d="M925,-1251.03C925,-1251.03 925,-1225.74 925,-1225.74"/>
<polygon fill="black" stroke="black" points="928.5,-1225.74 925,-1215.74 921.5,-1225.74 928.5,-1225.74"/>
</g>
<!-- pp3_layer12_expert0 -->
<g id="node55" class="node">
<title>pp3_layer12_expert0</title>
<polygon fill="lightblue" stroke="black" points="617,-1043.5 207,-1043.5 207,-975.5 617,-975.5 617,-1043.5"/>
<text text-anchor="middle" x="412" y="-1028.3" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="412" y="-1013.3" font-family="Times,serif" font-size="14.00">GPU: [384&#45;391]</text>
<text text-anchor="middle" x="412" y="-998.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="412" y="-983.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp3_layer12_gate&#45;&gt;pp3_layer12_expert0 -->
<g id="edge63" class="edge">
<title>pp3_layer12_gate&#45;&gt;pp3_layer12_expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M566.24,-1147.4C566.24,-1147.4 566.24,-1053.74 566.24,-1053.74"/>
<polygon fill="black" stroke="black" points="569.74,-1053.74 566.24,-1043.74 562.74,-1053.74 569.74,-1053.74"/>
</g>
<!-- pp3_layer12_expert1 -->
<g id="node57" class="node">
<title>pp3_layer12_expert1</title>
<polygon fill="lightblue" stroke="black" points="1130,-1043.5 720,-1043.5 720,-975.5 1130,-975.5 1130,-1043.5"/>
<text text-anchor="middle" x="925" y="-1028.3" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="925" y="-1013.3" font-family="Times,serif" font-size="14.00">GPU: [392&#45;399]</text>
<text text-anchor="middle" x="925" y="-998.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="925" y="-983.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp3_layer12_gate&#45;&gt;pp3_layer12_expert1 -->
<g id="edge64" class="edge">
<title>pp3_layer12_gate&#45;&gt;pp3_layer12_expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M925,-1079.31C925,-1079.31 925,-1053.71 925,-1053.71"/>
<polygon fill="black" stroke="black" points="928.5,-1053.71 925,-1043.71 921.5,-1053.71 928.5,-1053.71"/>
</g>
<!-- pp3_layer12_expert2 -->
<g id="node59" class="node">
<title>pp3_layer12_expert2</title>
<polygon fill="lightblue" stroke="black" points="1643,-1043.5 1233,-1043.5 1233,-975.5 1643,-975.5 1643,-1043.5"/>
<text text-anchor="middle" x="1438" y="-1028.3" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1438" y="-1013.3" font-family="Times,serif" font-size="14.00">GPU: [400&#45;407]</text>
<text text-anchor="middle" x="1438" y="-998.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1438" y="-983.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp3_layer12_gate&#45;&gt;pp3_layer12_expert2 -->
<g id="edge65" class="edge">
<title>pp3_layer12_gate&#45;&gt;pp3_layer12_expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1283.76,-1147.4C1283.76,-1147.4 1283.76,-1053.74 1283.76,-1053.74"/>
<polygon fill="black" stroke="black" points="1287.26,-1053.74 1283.76,-1043.74 1280.26,-1053.74 1287.26,-1053.74"/>
</g>
<!-- pp3_layer12_expert3 -->
<g id="node61" class="node">
<title>pp3_layer12_expert3</title>
<polygon fill="lightblue" stroke="black" points="2198,-1043.5 1788,-1043.5 1788,-975.5 2198,-975.5 2198,-1043.5"/>
<text text-anchor="middle" x="1993" y="-1028.3" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1993" y="-1013.3" font-family="Times,serif" font-size="14.00">GPU: [408&#45;415]</text>
<text text-anchor="middle" x="1993" y="-998.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1993" y="-983.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp3_layer12_gate&#45;&gt;pp3_layer12_expert3 -->
<g id="edge66" class="edge">
<title>pp3_layer12_gate&#45;&gt;pp3_layer12_expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1250.37,-1147C1499.39,-1147 1800.46,-1147 1800.46,-1147 1800.46,-1147 1800.46,-1053.84 1800.46,-1053.84"/>
<polygon fill="black" stroke="black" points="1803.96,-1053.84 1800.46,-1043.84 1796.96,-1053.84 1803.96,-1053.84"/>
</g>
<!-- pp3_layer12_expert0_tp -->
<g id="node56" class="node">
<title>pp3_layer12_expert0_tp</title>
<ellipse fill="lightgreen" stroke="black" cx="327" cy="-891.42" rx="289.83" ry="48.17"/>
<text text-anchor="middle" x="327" y="-910.22" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="327" y="-895.22" font-family="Times,serif" font-size="14.00">GPU: [384&#45;391]</text>
<text text-anchor="middle" x="327" y="-880.22" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=256]</text>
<text text-anchor="middle" x="327" y="-865.22" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp3_layer12_expert0&#45;&gt;pp3_layer12_expert0_tp -->
<g id="edge67" class="edge">
<title>pp3_layer12_expert0&#45;&gt;pp3_layer12_expert0_tp</title>
<path fill="none" stroke="black" d="M411.96,-975.34C411.96,-975.34 411.96,-947.79 411.96,-947.79"/>
<polygon fill="black" stroke="black" points="415.46,-947.79 411.96,-937.79 408.46,-947.79 415.46,-947.79"/>
</g>
<!-- pp3_layer12_agg -->
<g id="node63" class="node">
<title>pp3_layer12_agg</title>
<polygon fill="lightyellow" stroke="black" points="1667.96,-807.33 961.72,-807.33 780.04,-671.33 1486.28,-671.33 1667.96,-807.33"/>
<text text-anchor="middle" x="1224" y="-758.13" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1224" y="-743.13" font-family="Times,serif" font-size="14.00">GPU: [384&#45;415]</text>
<text text-anchor="middle" x="1224" y="-728.13" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=1024] × 4</text>
<text text-anchor="middle" x="1224" y="-713.13" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp3_layer12_expert0_tp&#45;&gt;pp3_layer12_agg -->
<g id="edge71" class="edge">
<title>pp3_layer12_expert0_tp&#45;&gt;pp3_layer12_agg</title>
<path fill="none" stroke="black" d="M327,-843.19C327,-798.54 327,-739 327,-739 327,-739 860.13,-739 860.13,-739"/>
<polygon fill="black" stroke="black" points="860.13,-742.5 870.13,-739 860.13,-735.5 860.13,-742.5"/>
</g>
<!-- pp3_layer12_expert1_tp -->
<g id="node58" class="node">
<title>pp3_layer12_expert1_tp</title>
<ellipse fill="lightgreen" stroke="black" cx="925" cy="-891.42" rx="289.83" ry="48.17"/>
<text text-anchor="middle" x="925" y="-910.22" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="925" y="-895.22" font-family="Times,serif" font-size="14.00">GPU: [392&#45;399]</text>
<text text-anchor="middle" x="925" y="-880.22" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=256]</text>
<text text-anchor="middle" x="925" y="-865.22" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp3_layer12_expert1&#45;&gt;pp3_layer12_expert1_tp -->
<g id="edge68" class="edge">
<title>pp3_layer12_expert1&#45;&gt;pp3_layer12_expert1_tp</title>
<path fill="none" stroke="black" d="M925,-975.34C925,-975.34 925,-949.55 925,-949.55"/>
<polygon fill="black" stroke="black" points="928.5,-949.55 925,-939.55 921.5,-949.55 928.5,-949.55"/>
</g>
<!-- pp3_layer12_expert1_tp&#45;&gt;pp3_layer12_agg -->
<g id="edge72" class="edge">
<title>pp3_layer12_expert1_tp&#45;&gt;pp3_layer12_agg</title>
<path fill="none" stroke="black" d="M997.59,-844.55C997.59,-844.55 997.59,-817.57 997.59,-817.57"/>
<polygon fill="black" stroke="black" points="1001.09,-817.57 997.59,-807.57 994.09,-817.57 1001.09,-817.57"/>
</g>
<!-- pp3_layer12_expert2_tp -->
<g id="node60" class="node">
<title>pp3_layer12_expert2_tp</title>
<ellipse fill="lightgreen" stroke="black" cx="1523" cy="-891.42" rx="289.83" ry="48.17"/>
<text text-anchor="middle" x="1523" y="-910.22" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1523" y="-895.22" font-family="Times,serif" font-size="14.00">GPU: [400&#45;407]</text>
<text text-anchor="middle" x="1523" y="-880.22" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=256]</text>
<text text-anchor="middle" x="1523" y="-865.22" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp3_layer12_expert2&#45;&gt;pp3_layer12_expert2_tp -->
<g id="edge69" class="edge">
<title>pp3_layer12_expert2&#45;&gt;pp3_layer12_expert2_tp</title>
<path fill="none" stroke="black" d="M1438.04,-975.34C1438.04,-975.34 1438.04,-947.79 1438.04,-947.79"/>
<polygon fill="black" stroke="black" points="1441.54,-947.79 1438.04,-937.79 1434.54,-947.79 1441.54,-947.79"/>
</g>
<!-- pp3_layer12_expert2_tp&#45;&gt;pp3_layer12_agg -->
<g id="edge73" class="edge">
<title>pp3_layer12_expert2_tp&#45;&gt;pp3_layer12_agg</title>
<path fill="none" stroke="black" d="M1450.41,-844.55C1450.41,-844.55 1450.41,-817.57 1450.41,-817.57"/>
<polygon fill="black" stroke="black" points="1453.91,-817.57 1450.41,-807.57 1446.91,-817.57 1453.91,-817.57"/>
</g>
<!-- pp3_layer12_expert3_tp -->
<g id="node62" class="node">
<title>pp3_layer12_expert3_tp</title>
<ellipse fill="lightgreen" stroke="black" cx="2121" cy="-891.42" rx="289.83" ry="48.17"/>
<text text-anchor="middle" x="2121" y="-910.22" font-family="Times,serif" font-size="14.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="2121" y="-895.22" font-family="Times,serif" font-size="14.00">GPU: [408&#45;415]</text>
<text text-anchor="middle" x="2121" y="-880.22" font-family="Times,serif" font-size="14.00">Input: [batch_size=~2, seq_len=1024, hidden=256]</text>
<text text-anchor="middle" x="2121" y="-865.22" font-family="Times,serif" font-size="14.00">Output: [batch_size=~2, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp3_layer12_expert3&#45;&gt;pp3_layer12_expert3_tp -->
<g id="edge70" class="edge">
<title>pp3_layer12_expert3&#45;&gt;pp3_layer12_expert3_tp</title>
<path fill="none" stroke="black" d="M2014.54,-975.34C2014.54,-975.34 2014.54,-946.49 2014.54,-946.49"/>
<polygon fill="black" stroke="black" points="2018.04,-946.49 2014.54,-936.49 2011.04,-946.49 2018.04,-946.49"/>
</g>
<!-- pp3_layer12_expert3_tp&#45;&gt;pp3_layer12_agg -->
<g id="edge74" class="edge">
<title>pp3_layer12_expert3_tp&#45;&gt;pp3_layer12_agg</title>
<path fill="none" stroke="black" d="M2121,-843.19C2121,-798.54 2121,-739 2121,-739 2121,-739 1586.91,-739 1586.91,-739"/>
<polygon fill="black" stroke="black" points="1586.91,-735.5 1576.91,-739 1586.91,-742.5 1586.91,-735.5"/>
</g>
<!-- pp3_layer12_ep_comm -->
<g id="node64" class="node">
<title>pp3_layer12_ep_comm</title>
<ellipse fill="lightgreen" stroke="black" cx="1224" cy="-587.25" rx="287.59" ry="48.17"/>
<text text-anchor="middle" x="1224" y="-606.05" font-family="Times,serif" font-size="14.00">EP All&#45;to&#45;All</text>
<text text-anchor="middle" x="1224" y="-591.05" font-family="Times,serif" font-size="14.00">GPU: [384&#45;415]</text>
<text text-anchor="middle" x="1224" y="-576.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1224" y="-561.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp3_layer12_agg&#45;&gt;pp3_layer12_ep_comm -->
<g id="edge75" class="edge">
<title>pp3_layer12_agg&#45;&gt;pp3_layer12_ep_comm</title>
<path fill="none" stroke="black" d="M1224,-671.3C1224,-671.3 1224,-645.64 1224,-645.64"/>
<polygon fill="black" stroke="black" points="1227.5,-645.64 1224,-635.64 1220.5,-645.64 1227.5,-645.64"/>
</g>
<!-- pp3_layer15_final -->
<g id="node65" class="node">
<title>pp3_layer15_final</title>
<polygon fill="lightblue" stroke="black" points="1427.5,-503.17 1020.5,-503.17 1020.5,-435.17 1427.5,-435.17 1427.5,-503.17"/>
<text text-anchor="middle" x="1224" y="-487.97" font-family="Times,serif" font-size="14.00">Layer 15: Final</text>
<text text-anchor="middle" x="1224" y="-472.97" font-family="Times,serif" font-size="14.00">GPU: [384&#45;415]</text>
<text text-anchor="middle" x="1224" y="-457.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1224" y="-442.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp3_layer12_ep_comm&#45;&gt;pp3_layer15_final -->
<g id="edge76" class="edge">
<title>pp3_layer12_ep_comm&#45;&gt;pp3_layer15_final</title>
<path fill="none" stroke="black" d="M1224,-538.88C1224,-538.88 1224,-513.2 1224,-513.2"/>
<polygon fill="black" stroke="black" points="1227.5,-513.2 1224,-503.2 1220.5,-513.2 1227.5,-513.2"/>
</g>
<!-- pp3_layer15_ep_comm -->
<g id="node66" class="node">
<title>pp3_layer15_ep_comm</title>
<ellipse fill="lightgreen" stroke="black" cx="1224" cy="-351.08" rx="287.59" ry="48.17"/>
<text text-anchor="middle" x="1224" y="-369.88" font-family="Times,serif" font-size="14.00">EP All&#45;to&#45;All</text>
<text text-anchor="middle" x="1224" y="-354.88" font-family="Times,serif" font-size="14.00">GPU: [384&#45;415]</text>
<text text-anchor="middle" x="1224" y="-339.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1224" y="-324.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden=1024]</text>
</g>
<!-- pp3_layer15_final&#45;&gt;pp3_layer15_ep_comm -->
<g id="edge77" class="edge">
<title>pp3_layer15_final&#45;&gt;pp3_layer15_ep_comm</title>
<path fill="none" stroke="black" d="M1224,-435.01C1224,-435.01 1224,-409.21 1224,-409.21"/>
<polygon fill="black" stroke="black" points="1227.5,-409.21 1224,-399.21 1220.5,-409.21 1227.5,-409.21"/>
</g>
<!-- output -->
<g id="node67" class="node">
<title>output</title>
<polygon fill="lightblue" stroke="black" points="1445.5,-256 1002.5,-256 1002.5,-188 1445.5,-188 1445.5,-256"/>
<text text-anchor="middle" x="1224" y="-240.8" font-family="Times,serif" font-size="14.00">Output Layer</text>
<text text-anchor="middle" x="1224" y="-225.8" font-family="Times,serif" font-size="14.00">GPU: [384&#45;415]</text>
<text text-anchor="middle" x="1224" y="-210.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="1224" y="-195.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=32, seq_len=1024, vocab_size=32000]</text>
</g>
<!-- pp3_layer15_ep_comm&#45;&gt;output -->
<g id="edge78" class="edge">
<title>pp3_layer15_ep_comm&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1224,-302.65C1224,-302.65 1224,-266.21 1224,-266.21"/>
<polygon fill="black" stroke="black" points="1227.5,-266.21 1224,-256.21 1220.5,-266.21 1227.5,-266.21"/>
</g>
<!-- dp_agg -->
<g id="node68" class="node">
<title>dp_agg</title>
<polygon fill="lightyellow" stroke="black" points="1692.72,-152 947.09,-152 755.28,-16 1500.91,-16 1692.72,-152"/>
<text text-anchor="middle" x="1224" y="-102.8" font-family="Times,serif" font-size="14.00">DP Aggregation</text>
<text text-anchor="middle" x="1224" y="-87.8" font-family="Times,serif" font-size="14.00">GPU: [0&#45;511]</text>
<text text-anchor="middle" x="1224" y="-72.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=32, seq_len=1024, vocab_size=32000]</text>
<text text-anchor="middle" x="1224" y="-57.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=128, seq_len=1024, vocab_size=32000]</text>
</g>
<!-- output&#45;&gt;dp_agg -->
<g id="edge79" class="edge">
<title>output&#45;&gt;dp_agg</title>
<path fill="none" stroke="black" d="M1224,-187.89C1224,-187.89 1224,-162.23 1224,-162.23"/>
<polygon fill="black" stroke="black" points="1227.5,-162.23 1224,-152.23 1220.5,-162.23 1227.5,-162.23"/>
</g>
</g>
</svg>
