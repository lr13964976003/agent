<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: new_deployment_dag Pages: 1 -->
<svg width="1518pt" height="2916pt"
 viewBox="0.00 0.00 1518.00 2915.63" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2911.63)">
<title>new_deployment_dag</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2911.63 1514,-2911.63 1514,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightblue" stroke="black" cx="748" cy="-2870.15" rx="267.99" ry="37.45"/>
<text text-anchor="middle" x="748" y="-2881.45" font-family="Arial" font-size="14.00">Input</text>
<text text-anchor="middle" x="748" y="-2866.45" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="748" y="-2851.45" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- embed -->
<g id="node2" class="node">
<title>embed</title>
<polygon fill="lightgreen" stroke="black" points="933.5,-2796.67 562.5,-2796.67 562.5,-2728.67 933.5,-2728.67 933.5,-2796.67"/>
<text text-anchor="middle" x="748" y="-2781.47" font-family="Arial" font-size="14.00">Embedding Layer</text>
<text text-anchor="middle" x="748" y="-2766.47" font-family="Arial" font-size="14.00">GPU: TP0&#45;TP15</text>
<text text-anchor="middle" x="748" y="-2751.47" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="748" y="-2736.47" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, hidden_size=256]</text>
</g>
<!-- input&#45;&gt;embed -->
<g id="edge1" class="edge">
<title>input&#45;&gt;embed</title>
<path fill="none" stroke="black" d="M748,-2832.56C748,-2824.26 748,-2815.38 748,-2806.85"/>
<polygon fill="black" stroke="black" points="751.5,-2806.67 748,-2796.67 744.5,-2806.67 751.5,-2806.67"/>
</g>
<!-- pp0_start -->
<g id="node3" class="node">
<title>pp0_start</title>
<polygon fill="yellow" stroke="black" points="836.25,-2692.67 695.87,-2692.67 659.75,-2586.67 800.13,-2586.67 836.25,-2692.67"/>
<text text-anchor="middle" x="748" y="-2650.97" font-family="Arial" font-size="14.00">PP Stage 0</text>
<text text-anchor="middle" x="748" y="-2635.97" font-family="Arial" font-size="14.00">GPU: PP0</text>
<text text-anchor="middle" x="748" y="-2620.97" font-family="Arial" font-size="14.00">Layers 0&#45;3</text>
</g>
<!-- embed&#45;&gt;pp0_start -->
<g id="edge2" class="edge">
<title>embed&#45;&gt;pp0_start</title>
<path fill="none" stroke="black" d="M748,-2728.61C748,-2720.58 748,-2711.73 748,-2702.83"/>
<polygon fill="black" stroke="black" points="751.5,-2702.8 748,-2692.8 744.5,-2702.8 751.5,-2702.8"/>
</g>
<!-- layer0_attn_q -->
<g id="node4" class="node">
<title>layer0_attn_q</title>
<polygon fill="lightcoral" stroke="black" points="539.5,-2550.67 158.5,-2550.67 158.5,-2482.67 539.5,-2482.67 539.5,-2550.67"/>
<text text-anchor="middle" x="349" y="-2535.47" font-family="Arial" font-size="14.00">Layer 0: Q Projection</text>
<text text-anchor="middle" x="349" y="-2520.47" font-family="Arial" font-size="14.00">GPU: TP0&#45;TP15</text>
<text text-anchor="middle" x="349" y="-2505.47" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="349" y="-2490.47" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=32]</text>
</g>
<!-- pp0_start&#45;&gt;layer0_attn_q -->
<g id="edge3" class="edge">
<title>pp0_start&#45;&gt;layer0_attn_q</title>
<path fill="none" stroke="black" d="M669.17,-2614.77C611.71,-2597.34 532.85,-2573.43 467.78,-2553.69"/>
<polygon fill="black" stroke="black" points="468.46,-2550.24 457.87,-2550.69 466.43,-2556.94 468.46,-2550.24"/>
</g>
<!-- layer0_attn_k -->
<g id="node5" class="node">
<title>layer0_attn_k</title>
<polygon fill="lightcoral" stroke="black" points="938.5,-2550.67 557.5,-2550.67 557.5,-2482.67 938.5,-2482.67 938.5,-2550.67"/>
<text text-anchor="middle" x="748" y="-2535.47" font-family="Arial" font-size="14.00">Layer 0: K Projection</text>
<text text-anchor="middle" x="748" y="-2520.47" font-family="Arial" font-size="14.00">GPU: TP0&#45;TP15</text>
<text text-anchor="middle" x="748" y="-2505.47" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="748" y="-2490.47" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=32]</text>
</g>
<!-- pp0_start&#45;&gt;layer0_attn_k -->
<g id="edge4" class="edge">
<title>pp0_start&#45;&gt;layer0_attn_k</title>
<path fill="none" stroke="black" d="M748,-2586.66C748,-2578.1 748,-2569.31 748,-2561"/>
<polygon fill="black" stroke="black" points="751.5,-2560.77 748,-2550.77 744.5,-2560.77 751.5,-2560.77"/>
</g>
<!-- layer0_attn_v -->
<g id="node6" class="node">
<title>layer0_attn_v</title>
<polygon fill="lightcoral" stroke="black" points="1156.5,-2446.67 775.5,-2446.67 775.5,-2378.67 1156.5,-2378.67 1156.5,-2446.67"/>
<text text-anchor="middle" x="966" y="-2431.47" font-family="Arial" font-size="14.00">Layer 0: V Projection</text>
<text text-anchor="middle" x="966" y="-2416.47" font-family="Arial" font-size="14.00">GPU: TP0&#45;TP15</text>
<text text-anchor="middle" x="966" y="-2401.47" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="966" y="-2386.47" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=32]</text>
</g>
<!-- pp0_start&#45;&gt;layer0_attn_v -->
<g id="edge5" class="edge">
<title>pp0_start&#45;&gt;layer0_attn_v</title>
<path fill="none" stroke="black" d="M813.93,-2626.85C858.63,-2615.26 915.16,-2592.9 947,-2550.67 966.96,-2524.21 970.92,-2486.45 970.33,-2457.27"/>
<polygon fill="black" stroke="black" points="973.81,-2456.8 969.93,-2446.94 966.82,-2457.07 973.81,-2456.8"/>
</g>
<!-- layer0_attn_score -->
<g id="node7" class="node">
<title>layer0_attn_score</title>
<polygon fill="lightcoral" stroke="black" points="757,-2446.67 335,-2446.67 335,-2378.67 757,-2378.67 757,-2446.67"/>
<text text-anchor="middle" x="546" y="-2431.47" font-family="Arial" font-size="14.00">Layer 0: Attention Score</text>
<text text-anchor="middle" x="546" y="-2416.47" font-family="Arial" font-size="14.00">GPU: TP0&#45;TP15</text>
<text text-anchor="middle" x="546" y="-2401.47" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=32]</text>
<text text-anchor="middle" x="546" y="-2386.47" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_attn_q&#45;&gt;layer0_attn_score -->
<g id="edge6" class="edge">
<title>layer0_attn_q&#45;&gt;layer0_attn_score</title>
<path fill="none" stroke="black" d="M412.96,-2482.56C432.15,-2472.62 453.35,-2461.64 473.08,-2451.43"/>
<polygon fill="black" stroke="black" points="474.75,-2454.5 482.02,-2446.8 471.53,-2448.29 474.75,-2454.5"/>
</g>
<!-- layer0_attn_k&#45;&gt;layer0_attn_score -->
<g id="edge7" class="edge">
<title>layer0_attn_k&#45;&gt;layer0_attn_score</title>
<path fill="none" stroke="black" d="M682.42,-2482.56C662.74,-2472.62 641,-2461.64 620.77,-2451.43"/>
<polygon fill="black" stroke="black" points="622.1,-2448.18 611.6,-2446.8 618.95,-2454.43 622.1,-2448.18"/>
</g>
<!-- layer0_attn_out -->
<g id="node9" class="node">
<title>layer0_attn_out</title>
<polygon fill="lightcoral" stroke="black" points="940.5,-2238.67 569.5,-2238.67 569.5,-2170.67 940.5,-2170.67 940.5,-2238.67"/>
<text text-anchor="middle" x="755" y="-2223.47" font-family="Arial" font-size="14.00">Layer 0: Attention Output</text>
<text text-anchor="middle" x="755" y="-2208.47" font-family="Arial" font-size="14.00">GPU: TP0&#45;TP15</text>
<text text-anchor="middle" x="755" y="-2193.47" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=32]</text>
<text text-anchor="middle" x="755" y="-2178.47" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, hidden_size=256]</text>
</g>
<!-- layer0_attn_v&#45;&gt;layer0_attn_out -->
<g id="edge8" class="edge">
<title>layer0_attn_v&#45;&gt;layer0_attn_out</title>
<path fill="none" stroke="black" d="M943.74,-2378.67C923.06,-2349.4 890.36,-2306.48 856,-2274.67 844.49,-2264.02 831.22,-2253.78 818.17,-2244.59"/>
<polygon fill="black" stroke="black" points="819.86,-2241.5 809.64,-2238.71 815.88,-2247.27 819.86,-2241.5"/>
</g>
<!-- layer0_attn_softmax -->
<g id="node8" class="node">
<title>layer0_attn_softmax</title>
<polygon fill="lightcoral" stroke="black" points="847,-2342.67 425,-2342.67 425,-2274.67 847,-2274.67 847,-2342.67"/>
<text text-anchor="middle" x="636" y="-2327.47" font-family="Arial" font-size="14.00">Layer 0: Softmax</text>
<text text-anchor="middle" x="636" y="-2312.47" font-family="Arial" font-size="14.00">GPU: TP0&#45;TP15</text>
<text text-anchor="middle" x="636" y="-2297.47" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="636" y="-2282.47" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_attn_score&#45;&gt;layer0_attn_softmax -->
<g id="edge9" class="edge">
<title>layer0_attn_score&#45;&gt;layer0_attn_softmax</title>
<path fill="none" stroke="black" d="M575.22,-2378.56C583.08,-2369.65 591.67,-2359.91 599.86,-2350.63"/>
<polygon fill="black" stroke="black" points="602.63,-2352.79 606.62,-2342.97 597.38,-2348.16 602.63,-2352.79"/>
</g>
<!-- layer0_attn_softmax&#45;&gt;layer0_attn_out -->
<g id="edge10" class="edge">
<title>layer0_attn_softmax&#45;&gt;layer0_attn_out</title>
<path fill="none" stroke="black" d="M674.64,-2274.56C685.44,-2265.29 697.3,-2255.13 708.51,-2245.52"/>
<polygon fill="black" stroke="black" points="710.84,-2248.14 716.15,-2238.97 706.28,-2242.82 710.84,-2248.14"/>
</g>
<!-- layer0_attn_proj -->
<g id="node10" class="node">
<title>layer0_attn_proj</title>
<polygon fill="lightcoral" stroke="black" points="940.5,-2134.67 569.5,-2134.67 569.5,-2066.67 940.5,-2066.67 940.5,-2134.67"/>
<text text-anchor="middle" x="755" y="-2119.47" font-family="Arial" font-size="14.00">Layer 0: Output Projection</text>
<text text-anchor="middle" x="755" y="-2104.47" font-family="Arial" font-size="14.00">GPU: TP0&#45;TP15</text>
<text text-anchor="middle" x="755" y="-2089.47" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="755" y="-2074.47" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, hidden_size=256]</text>
</g>
<!-- layer0_attn_out&#45;&gt;layer0_attn_proj -->
<g id="edge11" class="edge">
<title>layer0_attn_out&#45;&gt;layer0_attn_proj</title>
<path fill="none" stroke="black" d="M755,-2170.56C755,-2162.45 755,-2153.66 755,-2145.15"/>
<polygon fill="black" stroke="black" points="758.5,-2144.97 755,-2134.97 751.5,-2144.97 758.5,-2144.97"/>
</g>
<!-- layer0_attn_ar -->
<g id="node11" class="node">
<title>layer0_attn_ar</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="755" cy="-1993.2" rx="251.96" ry="37.45"/>
<text text-anchor="middle" x="755" y="-2004.5" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="755" y="-1989.5" font-family="Arial" font-size="14.00">TP Group: TP0&#45;TP15</text>
<text text-anchor="middle" x="755" y="-1974.5" font-family="Arial" font-size="14.00">Size: [batch_size=128, seq_len=1024, hidden_size=256]</text>
</g>
<!-- layer0_attn_proj&#45;&gt;layer0_attn_ar -->
<g id="edge12" class="edge">
<title>layer0_attn_proj&#45;&gt;layer0_attn_ar</title>
<path fill="none" stroke="black" d="M755,-2066.59C755,-2058.43 755,-2049.53 755,-2040.85"/>
<polygon fill="black" stroke="black" points="758.5,-2040.83 755,-2030.83 751.5,-2040.83 758.5,-2040.83"/>
</g>
<!-- layer0_gate -->
<g id="node12" class="node">
<title>layer0_gate</title>
<polygon fill="lightyellow" stroke="black" points="1139.77,-1919.72 527.69,-1919.72 370.23,-1783.72 982.31,-1783.72 1139.77,-1919.72"/>
<text text-anchor="middle" x="755" y="-1870.52" font-family="Arial" font-size="14.00">Layer 0: MoE Gate</text>
<text text-anchor="middle" x="755" y="-1855.52" font-family="Arial" font-size="14.00">GPU: EP0&#45;EP31</text>
<text text-anchor="middle" x="755" y="-1840.52" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="755" y="-1825.52" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, num_experts=64]</text>
</g>
<!-- layer0_attn_ar&#45;&gt;layer0_gate -->
<g id="edge13" class="edge">
<title>layer0_attn_ar&#45;&gt;layer0_gate</title>
<path fill="none" stroke="black" d="M755,-1955.55C755,-1947.58 755,-1938.85 755,-1929.96"/>
<polygon fill="black" stroke="black" points="758.5,-1929.88 755,-1919.88 751.5,-1929.88 758.5,-1929.88"/>
</g>
<!-- layer0_route -->
<g id="node13" class="node">
<title>layer0_route</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="755" cy="-1710.24" rx="122.16" ry="37.45"/>
<text text-anchor="middle" x="755" y="-1721.54" font-family="Arial" font-size="14.00">Token Routing</text>
<text text-anchor="middle" x="755" y="-1706.54" font-family="Arial" font-size="14.00">GPU: EP0&#45;EP31</text>
<text text-anchor="middle" x="755" y="-1691.54" font-family="Arial" font-size="14.00">Select 2 experts per token</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_route -->
<g id="edge14" class="edge">
<title>layer0_gate&#45;&gt;layer0_route</title>
<path fill="none" stroke="black" d="M755,-1783.43C755,-1774.81 755,-1766.14 755,-1757.95"/>
<polygon fill="black" stroke="black" points="758.5,-1757.87 755,-1747.87 751.5,-1757.87 758.5,-1757.87"/>
</g>
<!-- layer0_expert0_up -->
<g id="node14" class="node">
<title>layer0_expert0_up</title>
<polygon fill="lightsteelblue" stroke="black" points="364,-1636.77 0,-1636.77 0,-1568.77 364,-1568.77 364,-1636.77"/>
<text text-anchor="middle" x="182" y="-1621.57" font-family="Arial" font-size="14.00">Layer 0: Expert 0 Up&#45;proj</text>
<text text-anchor="middle" x="182" y="-1606.57" font-family="Arial" font-size="14.00">GPU: EP0</text>
<text text-anchor="middle" x="182" y="-1591.57" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=512, hidden_size=256]</text>
<text text-anchor="middle" x="182" y="-1576.57" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=512, hidden_size=1024]</text>
</g>
<!-- layer0_route&#45;&gt;layer0_expert0_up -->
<g id="edge15" class="edge">
<title>layer0_route&#45;&gt;layer0_expert0_up</title>
<path fill="none" stroke="black" d="M651.57,-1690.2C573.65,-1675.86 464.66,-1655.8 371.29,-1638.61"/>
<polygon fill="black" stroke="black" points="371.91,-1635.17 361.44,-1636.8 370.64,-1642.05 371.91,-1635.17"/>
</g>
<!-- layer0_expert1_up -->
<g id="node17" class="node">
<title>layer0_expert1_up</title>
<polygon fill="lightsteelblue" stroke="black" points="746,-1636.77 382,-1636.77 382,-1568.77 746,-1568.77 746,-1636.77"/>
<text text-anchor="middle" x="564" y="-1621.57" font-family="Arial" font-size="14.00">Layer 0: Expert 1 Up&#45;proj</text>
<text text-anchor="middle" x="564" y="-1606.57" font-family="Arial" font-size="14.00">GPU: EP0</text>
<text text-anchor="middle" x="564" y="-1591.57" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=512, hidden_size=256]</text>
<text text-anchor="middle" x="564" y="-1576.57" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=512, hidden_size=1024]</text>
</g>
<!-- layer0_route&#45;&gt;layer0_expert1_up -->
<g id="edge18" class="edge">
<title>layer0_route&#45;&gt;layer0_expert1_up</title>
<path fill="none" stroke="black" d="M696.92,-1677.17C676.65,-1665.98 653.72,-1653.31 632.68,-1641.69"/>
<polygon fill="black" stroke="black" points="634.24,-1638.55 623.79,-1636.78 630.85,-1644.68 634.24,-1638.55"/>
</g>
<!-- layer0_expert2_up -->
<g id="node20" class="node">
<title>layer0_expert2_up</title>
<polygon fill="lightsteelblue" stroke="black" points="1128,-1636.77 764,-1636.77 764,-1568.77 1128,-1568.77 1128,-1636.77"/>
<text text-anchor="middle" x="946" y="-1621.57" font-family="Arial" font-size="14.00">Layer 0: Expert 2 Up&#45;proj</text>
<text text-anchor="middle" x="946" y="-1606.57" font-family="Arial" font-size="14.00">GPU: EP1</text>
<text text-anchor="middle" x="946" y="-1591.57" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=512, hidden_size=256]</text>
<text text-anchor="middle" x="946" y="-1576.57" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=512, hidden_size=1024]</text>
</g>
<!-- layer0_route&#45;&gt;layer0_expert2_up -->
<g id="edge21" class="edge">
<title>layer0_route&#45;&gt;layer0_expert2_up</title>
<path fill="none" stroke="black" d="M813.08,-1677.17C833.35,-1665.98 856.28,-1653.31 877.32,-1641.69"/>
<polygon fill="black" stroke="black" points="879.15,-1644.68 886.21,-1636.78 875.76,-1638.55 879.15,-1644.68"/>
</g>
<!-- layer0_expert3_up -->
<g id="node23" class="node">
<title>layer0_expert3_up</title>
<polygon fill="lightsteelblue" stroke="black" points="1510,-1636.77 1146,-1636.77 1146,-1568.77 1510,-1568.77 1510,-1636.77"/>
<text text-anchor="middle" x="1328" y="-1621.57" font-family="Arial" font-size="14.00">Layer 0: Expert 3 Up&#45;proj</text>
<text text-anchor="middle" x="1328" y="-1606.57" font-family="Arial" font-size="14.00">GPU: EP1</text>
<text text-anchor="middle" x="1328" y="-1591.57" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=512, hidden_size=256]</text>
<text text-anchor="middle" x="1328" y="-1576.57" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=512, hidden_size=1024]</text>
</g>
<!-- layer0_route&#45;&gt;layer0_expert3_up -->
<g id="edge24" class="edge">
<title>layer0_route&#45;&gt;layer0_expert3_up</title>
<path fill="none" stroke="black" d="M858.43,-1690.2C936.35,-1675.86 1045.34,-1655.8 1138.71,-1638.61"/>
<polygon fill="black" stroke="black" points="1139.36,-1642.05 1148.56,-1636.8 1138.09,-1635.17 1139.36,-1642.05"/>
</g>
<!-- layer0_expert0_act -->
<g id="node15" class="node">
<title>layer0_expert0_act</title>
<polygon fill="lightsteelblue" stroke="black" points="364,-1532.77 0,-1532.77 0,-1464.77 364,-1464.77 364,-1532.77"/>
<text text-anchor="middle" x="182" y="-1517.57" font-family="Arial" font-size="14.00">Layer 0: Expert 0 Activation</text>
<text text-anchor="middle" x="182" y="-1502.57" font-family="Arial" font-size="14.00">GPU: EP0</text>
<text text-anchor="middle" x="182" y="-1487.57" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=512, hidden_size=1024]</text>
<text text-anchor="middle" x="182" y="-1472.57" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=512, hidden_size=1024]</text>
</g>
<!-- layer0_expert0_up&#45;&gt;layer0_expert0_act -->
<g id="edge16" class="edge">
<title>layer0_expert0_up&#45;&gt;layer0_expert0_act</title>
<path fill="none" stroke="black" d="M182,-1568.65C182,-1560.54 182,-1551.75 182,-1543.24"/>
<polygon fill="black" stroke="black" points="185.5,-1543.07 182,-1533.07 178.5,-1543.07 185.5,-1543.07"/>
</g>
<!-- layer0_expert0_down -->
<g id="node16" class="node">
<title>layer0_expert0_down</title>
<polygon fill="lightsteelblue" stroke="black" points="366,-1428.77 10,-1428.77 10,-1360.77 366,-1360.77 366,-1428.77"/>
<text text-anchor="middle" x="188" y="-1413.57" font-family="Arial" font-size="14.00">Layer 0: Expert 0 Down&#45;proj</text>
<text text-anchor="middle" x="188" y="-1398.57" font-family="Arial" font-size="14.00">GPU: EP0</text>
<text text-anchor="middle" x="188" y="-1383.57" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=512, hidden_size=1024]</text>
<text text-anchor="middle" x="188" y="-1368.57" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=512, hidden_size=256]</text>
</g>
<!-- layer0_expert0_act&#45;&gt;layer0_expert0_down -->
<g id="edge17" class="edge">
<title>layer0_expert0_act&#45;&gt;layer0_expert0_down</title>
<path fill="none" stroke="black" d="M183.95,-1464.65C184.42,-1456.54 184.94,-1447.75 185.44,-1439.24"/>
<polygon fill="black" stroke="black" points="188.95,-1439.25 186.04,-1429.07 181.96,-1438.84 188.95,-1439.25"/>
</g>
<!-- layer0_ep_a2a -->
<g id="node26" class="node">
<title>layer0_ep_a2a</title>
<ellipse fill="orange" stroke="black" cx="753" cy="-1287.29" rx="114.6" ry="37.45"/>
<text text-anchor="middle" x="753" y="-1298.59" font-family="Arial" font-size="14.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="753" y="-1283.59" font-family="Arial" font-size="14.00">EP Group: EP0&#45;EP31</text>
<text text-anchor="middle" x="753" y="-1268.59" font-family="Arial" font-size="14.00">Token dispatch/combine</text>
</g>
<!-- layer0_expert0_down&#45;&gt;layer0_ep_a2a -->
<g id="edge27" class="edge">
<title>layer0_expert0_down&#45;&gt;layer0_ep_a2a</title>
<path fill="none" stroke="black" d="M364.83,-1360.75C456.56,-1343.63 565.66,-1323.26 644.8,-1308.49"/>
<polygon fill="black" stroke="black" points="645.6,-1311.9 654.79,-1306.62 644.32,-1305.02 645.6,-1311.9"/>
</g>
<!-- layer0_expert1_act -->
<g id="node18" class="node">
<title>layer0_expert1_act</title>
<polygon fill="lightsteelblue" stroke="black" points="746,-1532.77 382,-1532.77 382,-1464.77 746,-1464.77 746,-1532.77"/>
<text text-anchor="middle" x="564" y="-1517.57" font-family="Arial" font-size="14.00">Layer 0: Expert 1 Activation</text>
<text text-anchor="middle" x="564" y="-1502.57" font-family="Arial" font-size="14.00">GPU: EP0</text>
<text text-anchor="middle" x="564" y="-1487.57" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=512, hidden_size=1024]</text>
<text text-anchor="middle" x="564" y="-1472.57" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=512, hidden_size=1024]</text>
</g>
<!-- layer0_expert1_up&#45;&gt;layer0_expert1_act -->
<g id="edge19" class="edge">
<title>layer0_expert1_up&#45;&gt;layer0_expert1_act</title>
<path fill="none" stroke="black" d="M564,-1568.65C564,-1560.54 564,-1551.75 564,-1543.24"/>
<polygon fill="black" stroke="black" points="567.5,-1543.07 564,-1533.07 560.5,-1543.07 567.5,-1543.07"/>
</g>
<!-- layer0_expert1_down -->
<g id="node19" class="node">
<title>layer0_expert1_down</title>
<polygon fill="lightsteelblue" stroke="black" points="744,-1428.77 388,-1428.77 388,-1360.77 744,-1360.77 744,-1428.77"/>
<text text-anchor="middle" x="566" y="-1413.57" font-family="Arial" font-size="14.00">Layer 0: Expert 1 Down&#45;proj</text>
<text text-anchor="middle" x="566" y="-1398.57" font-family="Arial" font-size="14.00">GPU: EP0</text>
<text text-anchor="middle" x="566" y="-1383.57" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=512, hidden_size=1024]</text>
<text text-anchor="middle" x="566" y="-1368.57" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=512, hidden_size=256]</text>
</g>
<!-- layer0_expert1_act&#45;&gt;layer0_expert1_down -->
<g id="edge20" class="edge">
<title>layer0_expert1_act&#45;&gt;layer0_expert1_down</title>
<path fill="none" stroke="black" d="M564.65,-1464.65C564.81,-1456.54 564.98,-1447.75 565.15,-1439.24"/>
<polygon fill="black" stroke="black" points="568.65,-1439.13 565.35,-1429.07 561.65,-1439 568.65,-1439.13"/>
</g>
<!-- layer0_expert1_down&#45;&gt;layer0_ep_a2a -->
<g id="edge28" class="edge">
<title>layer0_expert1_down&#45;&gt;layer0_ep_a2a</title>
<path fill="none" stroke="black" d="M624.65,-1360.68C644.72,-1349.37 667.27,-1336.64 687.82,-1325.06"/>
<polygon fill="black" stroke="black" points="689.8,-1327.96 696.79,-1320 686.36,-1321.86 689.8,-1327.96"/>
</g>
<!-- layer0_expert2_act -->
<g id="node21" class="node">
<title>layer0_expert2_act</title>
<polygon fill="lightsteelblue" stroke="black" points="1128,-1532.77 764,-1532.77 764,-1464.77 1128,-1464.77 1128,-1532.77"/>
<text text-anchor="middle" x="946" y="-1517.57" font-family="Arial" font-size="14.00">Layer 0: Expert 2 Activation</text>
<text text-anchor="middle" x="946" y="-1502.57" font-family="Arial" font-size="14.00">GPU: EP1</text>
<text text-anchor="middle" x="946" y="-1487.57" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=512, hidden_size=1024]</text>
<text text-anchor="middle" x="946" y="-1472.57" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=512, hidden_size=1024]</text>
</g>
<!-- layer0_expert2_up&#45;&gt;layer0_expert2_act -->
<g id="edge22" class="edge">
<title>layer0_expert2_up&#45;&gt;layer0_expert2_act</title>
<path fill="none" stroke="black" d="M946,-1568.65C946,-1560.54 946,-1551.75 946,-1543.24"/>
<polygon fill="black" stroke="black" points="949.5,-1543.07 946,-1533.07 942.5,-1543.07 949.5,-1543.07"/>
</g>
<!-- layer0_expert2_down -->
<g id="node22" class="node">
<title>layer0_expert2_down</title>
<polygon fill="lightsteelblue" stroke="black" points="1122,-1428.77 766,-1428.77 766,-1360.77 1122,-1360.77 1122,-1428.77"/>
<text text-anchor="middle" x="944" y="-1413.57" font-family="Arial" font-size="14.00">Layer 0: Expert 2 Down&#45;proj</text>
<text text-anchor="middle" x="944" y="-1398.57" font-family="Arial" font-size="14.00">GPU: EP1</text>
<text text-anchor="middle" x="944" y="-1383.57" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=512, hidden_size=1024]</text>
<text text-anchor="middle" x="944" y="-1368.57" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=512, hidden_size=256]</text>
</g>
<!-- layer0_expert2_act&#45;&gt;layer0_expert2_down -->
<g id="edge23" class="edge">
<title>layer0_expert2_act&#45;&gt;layer0_expert2_down</title>
<path fill="none" stroke="black" d="M945.35,-1464.65C945.19,-1456.54 945.02,-1447.75 944.85,-1439.24"/>
<polygon fill="black" stroke="black" points="948.35,-1439 944.65,-1429.07 941.35,-1439.13 948.35,-1439"/>
</g>
<!-- layer0_expert2_down&#45;&gt;layer0_ep_a2a -->
<g id="edge29" class="edge">
<title>layer0_expert2_down&#45;&gt;layer0_ep_a2a</title>
<path fill="none" stroke="black" d="M884.09,-1360.68C863.41,-1349.26 840.14,-1336.41 819,-1324.74"/>
<polygon fill="black" stroke="black" points="820.53,-1321.59 810.09,-1319.82 817.15,-1327.71 820.53,-1321.59"/>
</g>
<!-- layer0_expert3_act -->
<g id="node24" class="node">
<title>layer0_expert3_act</title>
<polygon fill="lightsteelblue" stroke="black" points="1510,-1532.77 1146,-1532.77 1146,-1464.77 1510,-1464.77 1510,-1532.77"/>
<text text-anchor="middle" x="1328" y="-1517.57" font-family="Arial" font-size="14.00">Layer 0: Expert 3 Activation</text>
<text text-anchor="middle" x="1328" y="-1502.57" font-family="Arial" font-size="14.00">GPU: EP1</text>
<text text-anchor="middle" x="1328" y="-1487.57" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=512, hidden_size=1024]</text>
<text text-anchor="middle" x="1328" y="-1472.57" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=512, hidden_size=1024]</text>
</g>
<!-- layer0_expert3_up&#45;&gt;layer0_expert3_act -->
<g id="edge25" class="edge">
<title>layer0_expert3_up&#45;&gt;layer0_expert3_act</title>
<path fill="none" stroke="black" d="M1328,-1568.65C1328,-1560.54 1328,-1551.75 1328,-1543.24"/>
<polygon fill="black" stroke="black" points="1331.5,-1543.07 1328,-1533.07 1324.5,-1543.07 1331.5,-1543.07"/>
</g>
<!-- layer0_expert3_down -->
<g id="node25" class="node">
<title>layer0_expert3_down</title>
<polygon fill="lightsteelblue" stroke="black" points="1502,-1428.77 1146,-1428.77 1146,-1360.77 1502,-1360.77 1502,-1428.77"/>
<text text-anchor="middle" x="1324" y="-1413.57" font-family="Arial" font-size="14.00">Layer 0: Expert 3 Down&#45;proj</text>
<text text-anchor="middle" x="1324" y="-1398.57" font-family="Arial" font-size="14.00">GPU: EP1</text>
<text text-anchor="middle" x="1324" y="-1383.57" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=512, hidden_size=1024]</text>
<text text-anchor="middle" x="1324" y="-1368.57" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=512, hidden_size=256]</text>
</g>
<!-- layer0_expert3_act&#45;&gt;layer0_expert3_down -->
<g id="edge26" class="edge">
<title>layer0_expert3_act&#45;&gt;layer0_expert3_down</title>
<path fill="none" stroke="black" d="M1326.7,-1464.65C1326.38,-1456.54 1326.04,-1447.75 1325.7,-1439.24"/>
<polygon fill="black" stroke="black" points="1329.2,-1438.92 1325.31,-1429.07 1322.2,-1439.2 1329.2,-1438.92"/>
</g>
<!-- layer0_expert3_down&#45;&gt;layer0_ep_a2a -->
<g id="edge30" class="edge">
<title>layer0_expert3_down&#45;&gt;layer0_ep_a2a</title>
<path fill="none" stroke="black" d="M1145.68,-1360.83C1052.64,-1343.64 941.83,-1323.17 861.68,-1308.37"/>
<polygon fill="black" stroke="black" points="862.04,-1304.87 851.57,-1306.5 860.77,-1311.76 862.04,-1304.87"/>
</g>
<!-- layer0_expert_combine -->
<g id="node27" class="node">
<title>layer0_expert_combine</title>
<polygon fill="lightyellow" stroke="black" points="1137.77,-1213.81 525.69,-1213.81 368.23,-1077.81 980.31,-1077.81 1137.77,-1213.81"/>
<text text-anchor="middle" x="753" y="-1164.61" font-family="Arial" font-size="14.00">Expert Combine</text>
<text text-anchor="middle" x="753" y="-1149.61" font-family="Arial" font-size="14.00">GPU: EP0&#45;EP31</text>
<text text-anchor="middle" x="753" y="-1134.61" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="753" y="-1119.61" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, hidden_size=256]</text>
</g>
<!-- layer0_ep_a2a&#45;&gt;layer0_expert_combine -->
<g id="edge31" class="edge">
<title>layer0_ep_a2a&#45;&gt;layer0_expert_combine</title>
<path fill="none" stroke="black" d="M753,-1249.64C753,-1241.67 753,-1232.94 753,-1224.05"/>
<polygon fill="black" stroke="black" points="756.5,-1223.97 753,-1213.97 749.5,-1223.97 756.5,-1223.97"/>
</g>
<!-- pp0_to_pp1 -->
<g id="node28" class="node">
<title>pp0_to_pp1</title>
<ellipse fill="orange" stroke="black" cx="753" cy="-1004.34" rx="92.76" ry="37.45"/>
<text text-anchor="middle" x="753" y="-1015.64" font-family="Arial" font-size="14.00">Pipeline Transfer</text>
<text text-anchor="middle" x="753" y="-1000.64" font-family="Arial" font-size="14.00">PP0 → PP1</text>
<text text-anchor="middle" x="753" y="-985.64" font-family="Arial" font-size="14.00">Activations transfer</text>
</g>
<!-- layer0_expert_combine&#45;&gt;pp0_to_pp1 -->
<g id="edge32" class="edge">
<title>layer0_expert_combine&#45;&gt;pp0_to_pp1</title>
<path fill="none" stroke="black" d="M753,-1077.53C753,-1068.91 753,-1060.23 753,-1052.04"/>
<polygon fill="black" stroke="black" points="756.5,-1051.96 753,-1041.96 749.5,-1051.96 756.5,-1051.96"/>
</g>
<!-- pp1_start -->
<g id="node31" class="node">
<title>pp1_start</title>
<polygon fill="yellow" stroke="black" points="841.25,-930.86 700.87,-930.86 664.75,-824.86 805.13,-824.86 841.25,-930.86"/>
<text text-anchor="middle" x="753" y="-889.16" font-family="Arial" font-size="14.00">PP Stage 1</text>
<text text-anchor="middle" x="753" y="-874.16" font-family="Arial" font-size="14.00">GPU: PP1</text>
<text text-anchor="middle" x="753" y="-859.16" font-family="Arial" font-size="14.00">Layers 4&#45;7</text>
</g>
<!-- pp0_to_pp1&#45;&gt;pp1_start -->
<g id="edge33" class="edge">
<title>pp0_to_pp1&#45;&gt;pp1_start</title>
<path fill="none" stroke="black" d="M753,-966.66C753,-958.62 753,-949.89 753,-941.16"/>
<polygon fill="black" stroke="black" points="756.5,-940.95 753,-930.95 749.5,-940.95 756.5,-940.95"/>
</g>
<!-- pp1_to_pp2 -->
<g id="node29" class="node">
<title>pp1_to_pp2</title>
<ellipse fill="orange" stroke="black" cx="753" cy="-751.38" rx="92.76" ry="37.45"/>
<text text-anchor="middle" x="753" y="-762.68" font-family="Arial" font-size="14.00">Pipeline Transfer</text>
<text text-anchor="middle" x="753" y="-747.68" font-family="Arial" font-size="14.00">PP1 → PP2</text>
<text text-anchor="middle" x="753" y="-732.68" font-family="Arial" font-size="14.00">Activations transfer</text>
</g>
<!-- pp2_start -->
<g id="node32" class="node">
<title>pp2_start</title>
<polygon fill="yellow" stroke="black" points="844.47,-677.91 698.96,-677.91 661.53,-571.91 807.04,-571.91 844.47,-677.91"/>
<text text-anchor="middle" x="753" y="-636.21" font-family="Arial" font-size="14.00">PP Stage 2</text>
<text text-anchor="middle" x="753" y="-621.21" font-family="Arial" font-size="14.00">GPU: PP2</text>
<text text-anchor="middle" x="753" y="-606.21" font-family="Arial" font-size="14.00">Layers 8&#45;11</text>
</g>
<!-- pp1_to_pp2&#45;&gt;pp2_start -->
<g id="edge35" class="edge">
<title>pp1_to_pp2&#45;&gt;pp2_start</title>
<path fill="none" stroke="black" d="M753,-713.71C753,-705.67 753,-696.94 753,-688.21"/>
<polygon fill="black" stroke="black" points="756.5,-688 753,-678 749.5,-688 756.5,-688"/>
</g>
<!-- pp2_to_pp3 -->
<g id="node30" class="node">
<title>pp2_to_pp3</title>
<ellipse fill="orange" stroke="black" cx="753" cy="-498.43" rx="92.76" ry="37.45"/>
<text text-anchor="middle" x="753" y="-509.73" font-family="Arial" font-size="14.00">Pipeline Transfer</text>
<text text-anchor="middle" x="753" y="-494.73" font-family="Arial" font-size="14.00">PP2 → PP3</text>
<text text-anchor="middle" x="753" y="-479.73" font-family="Arial" font-size="14.00">Activations transfer</text>
</g>
<!-- pp3_start -->
<g id="node33" class="node">
<title>pp3_start</title>
<polygon fill="yellow" stroke="black" points="851.48,-424.95 694.82,-424.95 654.52,-318.95 811.18,-318.95 851.48,-424.95"/>
<text text-anchor="middle" x="753" y="-383.25" font-family="Arial" font-size="14.00">PP Stage 3</text>
<text text-anchor="middle" x="753" y="-368.25" font-family="Arial" font-size="14.00">GPU: PP3</text>
<text text-anchor="middle" x="753" y="-353.25" font-family="Arial" font-size="14.00">Layers 12&#45;15</text>
</g>
<!-- pp2_to_pp3&#45;&gt;pp3_start -->
<g id="edge37" class="edge">
<title>pp2_to_pp3&#45;&gt;pp3_start</title>
<path fill="none" stroke="black" d="M753,-460.76C753,-452.72 753,-443.99 753,-435.25"/>
<polygon fill="black" stroke="black" points="756.5,-435.04 753,-425.04 749.5,-435.04 756.5,-435.04"/>
</g>
<!-- pp1_start&#45;&gt;pp1_to_pp2 -->
<g id="edge34" class="edge">
<title>pp1_start&#45;&gt;pp1_to_pp2</title>
<path fill="none" stroke="black" d="M753,-824.79C753,-816.36 753,-807.67 753,-799.37"/>
<polygon fill="black" stroke="black" points="756.5,-799.11 753,-789.11 749.5,-799.11 756.5,-799.11"/>
</g>
<!-- pp2_start&#45;&gt;pp2_to_pp3 -->
<g id="edge36" class="edge">
<title>pp2_start&#45;&gt;pp2_to_pp3</title>
<path fill="none" stroke="black" d="M753,-571.84C753,-563.41 753,-554.72 753,-546.42"/>
<polygon fill="black" stroke="black" points="756.5,-546.16 753,-536.16 749.5,-546.16 756.5,-546.16"/>
</g>
<!-- layer15_attn -->
<g id="node34" class="node">
<title>layer15_attn</title>
<polygon fill="lightcoral" stroke="black" points="938.5,-282.95 567.5,-282.95 567.5,-214.95 938.5,-214.95 938.5,-282.95"/>
<text text-anchor="middle" x="753" y="-267.75" font-family="Arial" font-size="14.00">Layer 15: Attention</text>
<text text-anchor="middle" x="753" y="-252.75" font-family="Arial" font-size="14.00">GPU: TP0&#45;TP15, PP3</text>
<text text-anchor="middle" x="753" y="-237.75" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="753" y="-222.75" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, hidden_size=256]</text>
</g>
<!-- pp3_start&#45;&gt;layer15_attn -->
<g id="edge38" class="edge">
<title>pp3_start&#45;&gt;layer15_attn</title>
<path fill="none" stroke="black" d="M753,-318.94C753,-310.38 753,-301.59 753,-293.28"/>
<polygon fill="black" stroke="black" points="756.5,-293.05 753,-283.05 749.5,-293.05 756.5,-293.05"/>
</g>
<!-- layer15_moe -->
<g id="node35" class="node">
<title>layer15_moe</title>
<polygon fill="lightsteelblue" stroke="black" points="938.5,-178.95 567.5,-178.95 567.5,-110.95 938.5,-110.95 938.5,-178.95"/>
<text text-anchor="middle" x="753" y="-163.75" font-family="Arial" font-size="14.00">Layer 15: MoE</text>
<text text-anchor="middle" x="753" y="-148.75" font-family="Arial" font-size="14.00">GPU: EP0&#45;EP31, PP3</text>
<text text-anchor="middle" x="753" y="-133.75" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="753" y="-118.75" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, hidden_size=256]</text>
</g>
<!-- layer15_attn&#45;&gt;layer15_moe -->
<g id="edge39" class="edge">
<title>layer15_attn&#45;&gt;layer15_moe</title>
<path fill="none" stroke="black" d="M753,-214.84C753,-206.73 753,-197.94 753,-189.43"/>
<polygon fill="black" stroke="black" points="756.5,-189.25 753,-179.25 749.5,-189.25 756.5,-189.25"/>
</g>
<!-- output -->
<g id="node36" class="node">
<title>output</title>
<ellipse fill="lightblue" stroke="black" cx="753" cy="-37.48" rx="270.23" ry="37.45"/>
<text text-anchor="middle" x="753" y="-48.78" font-family="Arial" font-size="14.00">Output</text>
<text text-anchor="middle" x="753" y="-33.78" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="753" y="-18.78" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- layer15_moe&#45;&gt;output -->
<g id="edge40" class="edge">
<title>layer15_moe&#45;&gt;output</title>
<path fill="none" stroke="black" d="M753,-110.87C753,-102.71 753,-93.81 753,-85.13"/>
<polygon fill="black" stroke="black" points="756.5,-85.11 753,-75.11 749.5,-85.11 756.5,-85.11"/>
</g>
</g>
</svg>
