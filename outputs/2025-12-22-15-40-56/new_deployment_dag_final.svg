<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: new_deployment_dag Pages: 1 -->
<svg width="3633pt" height="4410pt"
 viewBox="0.00 0.00 3632.96 4409.79" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 4405.79)">
<title>new_deployment_dag</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-4405.79 3628.96,-4405.79 3628.96,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightblue" stroke="black" cx="1908" cy="-4353.7" rx="262.17" ry="48.17"/>
<text text-anchor="middle" x="1908" y="-4372.5" font-family="Arial" font-size="14.00">Input</text>
<text text-anchor="middle" x="1908" y="-4357.5" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1908" y="-4342.5" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1908" y="-4327.5" font-family="Arial" font-size="14.00">DP=4: Split batch into 4 groups of 32 sequences each</text>
</g>
<!-- dp_split -->
<g id="node2" class="node">
<title>dp_split</title>
<polygon fill="lightgreen" stroke="black" points="2179.76,-4269.62 1747.45,-4269.62 1636.24,-4133.62 2068.55,-4133.62 2179.76,-4269.62"/>
<text text-anchor="middle" x="1908" y="-4220.42" font-family="Arial" font-size="14.00">Data Parallelism Split</text>
<text text-anchor="middle" x="1908" y="-4205.42" font-family="Arial" font-size="14.00">GPU: DP0&#45;DP3</text>
<text text-anchor="middle" x="1908" y="-4190.42" font-family="Arial" font-size="14.00">Split batch_size=128 → 4×32</text>
<text text-anchor="middle" x="1908" y="-4175.42" font-family="Arial" font-size="14.00">No communication required for inference</text>
</g>
<!-- input&#45;&gt;dp_split -->
<g id="edge1" class="edge">
<title>input&#45;&gt;dp_split</title>
<path fill="none" stroke="black" d="M1908,-4305.21C1908,-4297.13 1908,-4288.55 1908,-4279.93"/>
<polygon fill="black" stroke="black" points="1911.5,-4279.81 1908,-4269.81 1904.5,-4279.81 1911.5,-4279.81"/>
</g>
<!-- embed_dp0 -->
<g id="node3" class="node">
<title>embed_dp0</title>
<polygon fill="lightgreen" stroke="black" points="1483,-4097.62 1119,-4097.62 1119,-4014.62 1483,-4014.62 1483,-4097.62"/>
<text text-anchor="middle" x="1301" y="-4082.42" font-family="Arial" font-size="14.00">Embedding Layer DP0</text>
<text text-anchor="middle" x="1301" y="-4067.42" font-family="Arial" font-size="14.00">GPU: DP0_TP0&#45;DP0_TP15</text>
<text text-anchor="middle" x="1301" y="-4052.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1301" y="-4037.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="1301" y="-4022.42" font-family="Arial" font-size="14.00">TP=16: hidden_size=4096 → 256 per TP rank</text>
</g>
<!-- dp_split&#45;&gt;embed_dp0 -->
<g id="edge2" class="edge">
<title>dp_split&#45;&gt;embed_dp0</title>
<path fill="none" stroke="black" d="M1638.67,-4136.95C1585.79,-4124.45 1531.51,-4111.61 1482.36,-4099.99"/>
<polygon fill="black" stroke="black" points="1483.14,-4096.58 1472.6,-4097.69 1481.53,-4103.39 1483.14,-4096.58"/>
</g>
<!-- embed_dp1 -->
<g id="node4" class="node">
<title>embed_dp1</title>
<polygon fill="lightgreen" stroke="black" points="1899,-4097.62 1535,-4097.62 1535,-4014.62 1899,-4014.62 1899,-4097.62"/>
<text text-anchor="middle" x="1717" y="-4082.42" font-family="Arial" font-size="14.00">Embedding Layer DP1</text>
<text text-anchor="middle" x="1717" y="-4067.42" font-family="Arial" font-size="14.00">GPU: DP1_TP0&#45;DP1_TP15</text>
<text text-anchor="middle" x="1717" y="-4052.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1717" y="-4037.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="1717" y="-4022.42" font-family="Arial" font-size="14.00">TP=16: hidden_size=4096 → 256 per TP rank</text>
</g>
<!-- dp_split&#45;&gt;embed_dp1 -->
<g id="edge43" class="edge">
<title>dp_split&#45;&gt;embed_dp1</title>
<path fill="none" stroke="black" d="M1818.65,-4133.49C1805.27,-4123.44 1791.73,-4113.26 1779.08,-4103.76"/>
<polygon fill="black" stroke="black" points="1781.01,-4100.83 1770.91,-4097.62 1776.8,-4106.43 1781.01,-4100.83"/>
</g>
<!-- embed_dp2 -->
<g id="node5" class="node">
<title>embed_dp2</title>
<polygon fill="lightgreen" stroke="black" points="2284,-4097.62 1920,-4097.62 1920,-4014.62 2284,-4014.62 2284,-4097.62"/>
<text text-anchor="middle" x="2102" y="-4082.42" font-family="Arial" font-size="14.00">Embedding Layer DP2</text>
<text text-anchor="middle" x="2102" y="-4067.42" font-family="Arial" font-size="14.00">GPU: DP2_TP0&#45;DP2_TP15</text>
<text text-anchor="middle" x="2102" y="-4052.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="2102" y="-4037.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="2102" y="-4022.42" font-family="Arial" font-size="14.00">TP=16: hidden_size=4096 → 256 per TP rank</text>
</g>
<!-- dp_split&#45;&gt;embed_dp2 -->
<g id="edge56" class="edge">
<title>dp_split&#45;&gt;embed_dp2</title>
<path fill="none" stroke="black" d="M1998.75,-4133.49C2012.34,-4123.44 2026.1,-4113.26 2038.94,-4103.76"/>
<polygon fill="black" stroke="black" points="2041.28,-4106.38 2047.24,-4097.62 2037.12,-4100.76 2041.28,-4106.38"/>
</g>
<!-- embed_dp3 -->
<g id="node6" class="node">
<title>embed_dp3</title>
<polygon fill="lightgreen" stroke="black" points="2671,-4097.62 2307,-4097.62 2307,-4014.62 2671,-4014.62 2671,-4097.62"/>
<text text-anchor="middle" x="2489" y="-4082.42" font-family="Arial" font-size="14.00">Embedding Layer DP3</text>
<text text-anchor="middle" x="2489" y="-4067.42" font-family="Arial" font-size="14.00">GPU: DP3_TP0&#45;DP3_TP15</text>
<text text-anchor="middle" x="2489" y="-4052.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="2489" y="-4037.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="2489" y="-4022.42" font-family="Arial" font-size="14.00">TP=16: hidden_size=4096 → 256 per TP rank</text>
</g>
<!-- dp_split&#45;&gt;embed_dp3 -->
<g id="edge69" class="edge">
<title>dp_split&#45;&gt;embed_dp3</title>
<path fill="none" stroke="black" d="M2087.46,-4156.29C2159.73,-4138.45 2242.79,-4117.93 2314.55,-4100.21"/>
<polygon fill="black" stroke="black" points="2315.73,-4103.52 2324.6,-4097.72 2314.05,-4096.72 2315.73,-4103.52"/>
</g>
<!-- hidden_up_dp0 -->
<g id="node7" class="node">
<title>hidden_up_dp0</title>
<polygon fill="lightgreen" stroke="black" points="1214.5,-3978.62 843.5,-3978.62 843.5,-3895.62 1214.5,-3895.62 1214.5,-3978.62"/>
<text text-anchor="middle" x="1029" y="-3963.42" font-family="Arial" font-size="14.00">Hidden Upscaling DP0</text>
<text text-anchor="middle" x="1029" y="-3948.42" font-family="Arial" font-size="14.00">GPU: DP0_TP0&#45;DP0_TP15</text>
<text text-anchor="middle" x="1029" y="-3933.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="1029" y="-3918.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1029" y="-3903.42" font-family="Arial" font-size="14.00">TP=16: All&#45;Gather operation</text>
</g>
<!-- embed_dp0&#45;&gt;hidden_up_dp0 -->
<g id="edge3" class="edge">
<title>embed_dp0&#45;&gt;hidden_up_dp0</title>
<path fill="none" stroke="black" d="M1206.63,-4014.53C1182.69,-4004.23 1156.83,-3993.11 1132.46,-3982.62"/>
<polygon fill="black" stroke="black" points="1133.77,-3979.38 1123.2,-3978.64 1131.01,-3985.81 1133.77,-3979.38"/>
</g>
<!-- hidden_up_dp1 -->
<g id="node8" class="node">
<title>hidden_up_dp1</title>
<polygon fill="lightgreen" stroke="black" points="1782.5,-3978.62 1411.5,-3978.62 1411.5,-3895.62 1782.5,-3895.62 1782.5,-3978.62"/>
<text text-anchor="middle" x="1597" y="-3963.42" font-family="Arial" font-size="14.00">Hidden Upscaling DP1</text>
<text text-anchor="middle" x="1597" y="-3948.42" font-family="Arial" font-size="14.00">GPU: DP1_TP0&#45;DP1_TP15</text>
<text text-anchor="middle" x="1597" y="-3933.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="1597" y="-3918.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1597" y="-3903.42" font-family="Arial" font-size="14.00">TP=16: All&#45;Gather operation</text>
</g>
<!-- embed_dp1&#45;&gt;hidden_up_dp1 -->
<g id="edge44" class="edge">
<title>embed_dp1&#45;&gt;hidden_up_dp1</title>
<path fill="none" stroke="black" d="M1675.37,-4014.53C1665.87,-4005.27 1655.7,-3995.35 1645.93,-3985.83"/>
<polygon fill="black" stroke="black" points="1648.16,-3983.11 1638.56,-3978.64 1643.28,-3988.13 1648.16,-3983.11"/>
</g>
<!-- hidden_up_dp2 -->
<g id="node9" class="node">
<title>hidden_up_dp2</title>
<polygon fill="lightgreen" stroke="black" points="2407.5,-3978.62 2036.5,-3978.62 2036.5,-3895.62 2407.5,-3895.62 2407.5,-3978.62"/>
<text text-anchor="middle" x="2222" y="-3963.42" font-family="Arial" font-size="14.00">Hidden Upscaling DP2</text>
<text text-anchor="middle" x="2222" y="-3948.42" font-family="Arial" font-size="14.00">GPU: DP2_TP0&#45;DP2_TP15</text>
<text text-anchor="middle" x="2222" y="-3933.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="2222" y="-3918.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="2222" y="-3903.42" font-family="Arial" font-size="14.00">TP=16: All&#45;Gather operation</text>
</g>
<!-- embed_dp2&#45;&gt;hidden_up_dp2 -->
<g id="edge57" class="edge">
<title>embed_dp2&#45;&gt;hidden_up_dp2</title>
<path fill="none" stroke="black" d="M2143.63,-4014.53C2153.13,-4005.27 2163.3,-3995.35 2173.07,-3985.83"/>
<polygon fill="black" stroke="black" points="2175.72,-3988.13 2180.44,-3978.64 2170.84,-3983.11 2175.72,-3988.13"/>
</g>
<!-- hidden_up_dp3 -->
<g id="node10" class="node">
<title>hidden_up_dp3</title>
<polygon fill="lightgreen" stroke="black" points="3151.5,-3978.62 2780.5,-3978.62 2780.5,-3895.62 3151.5,-3895.62 3151.5,-3978.62"/>
<text text-anchor="middle" x="2966" y="-3963.42" font-family="Arial" font-size="14.00">Hidden Upscaling DP3</text>
<text text-anchor="middle" x="2966" y="-3948.42" font-family="Arial" font-size="14.00">GPU: DP3_TP0&#45;DP3_TP15</text>
<text text-anchor="middle" x="2966" y="-3933.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="2966" y="-3918.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="2966" y="-3903.42" font-family="Arial" font-size="14.00">TP=16: All&#45;Gather operation</text>
</g>
<!-- embed_dp3&#45;&gt;hidden_up_dp3 -->
<g id="edge70" class="edge">
<title>embed_dp3&#45;&gt;hidden_up_dp3</title>
<path fill="none" stroke="black" d="M2654.16,-4014.61C2698.3,-4003.78 2746.15,-3992.04 2790.8,-3981.09"/>
<polygon fill="black" stroke="black" points="2791.7,-3984.47 2800.58,-3978.69 2790.03,-3977.68 2791.7,-3984.47"/>
</g>
<!-- pp0_dp0_start -->
<g id="node11" class="node">
<title>pp0_dp0_start</title>
<polygon fill="yellow" stroke="black" points="1000.92,-3859.62 329.74,-3859.62 157.08,-3723.62 828.26,-3723.62 1000.92,-3859.62"/>
<text text-anchor="middle" x="579" y="-3810.42" font-family="Arial" font-size="14.00">PP Stage 0 DP0</text>
<text text-anchor="middle" x="579" y="-3795.42" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="579" y="-3780.42" font-family="Arial" font-size="14.00">Layers 0&#45;3 (4 layers)</text>
<text text-anchor="middle" x="579" y="-3765.42" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- hidden_up_dp0&#45;&gt;pp0_dp0_start -->
<g id="edge4" class="edge">
<title>hidden_up_dp0&#45;&gt;pp0_dp0_start</title>
<path fill="none" stroke="black" d="M901.85,-3895.57C869.78,-3885.35 834.42,-3874.07 799.21,-3862.84"/>
<polygon fill="black" stroke="black" points="799.87,-3859.38 789.28,-3859.68 797.75,-3866.05 799.87,-3859.38"/>
</g>
<!-- layer0_attn_residual_dp0 -->
<g id="node24" class="node">
<title>layer0_attn_residual_dp0</title>
<polygon fill="lightcoral" stroke="black" points="1218,-2671.12 840,-2671.12 840,-2603.12 1218,-2603.12 1218,-2671.12"/>
<text text-anchor="middle" x="1029" y="-2655.92" font-family="Arial" font-size="14.00">Layer 0: Attention Residual DP0</text>
<text text-anchor="middle" x="1029" y="-2640.92" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="1029" y="-2625.92" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096] x2</text>
<text text-anchor="middle" x="1029" y="-2610.92" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- hidden_up_dp0&#45;&gt;layer0_attn_residual_dp0 -->
<g id="edge17" class="edge">
<title>hidden_up_dp0&#45;&gt;layer0_attn_residual_dp0</title>
<path fill="none" stroke="black" d="M1029,-3895.56C1029,-3840.86 1029,-3740.39 1029,-3654.62 1029,-3654.62 1029,-3654.62 1029,-2926.2 1029,-2839.51 1029,-2738.15 1029,-2681.72"/>
<polygon fill="black" stroke="black" points="1032.5,-2681.39 1029,-2671.39 1025.5,-2681.39 1032.5,-2681.39"/>
</g>
<!-- pp0_dp1_start -->
<g id="node12" class="node">
<title>pp0_dp1_start</title>
<polygon fill="yellow" stroke="black" points="1900.92,-3859.62 1229.74,-3859.62 1057.08,-3723.62 1728.26,-3723.62 1900.92,-3859.62"/>
<text text-anchor="middle" x="1479" y="-3810.42" font-family="Arial" font-size="14.00">PP Stage 0 DP1</text>
<text text-anchor="middle" x="1479" y="-3795.42" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP15</text>
<text text-anchor="middle" x="1479" y="-3780.42" font-family="Arial" font-size="14.00">Layers 0&#45;3 (4 layers)</text>
<text text-anchor="middle" x="1479" y="-3765.42" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- hidden_up_dp1&#45;&gt;pp0_dp1_start -->
<g id="edge45" class="edge">
<title>hidden_up_dp1&#45;&gt;pp0_dp1_start</title>
<path fill="none" stroke="black" d="M1563.5,-3895.38C1556.37,-3886.71 1548.62,-3877.28 1540.81,-3867.78"/>
<polygon fill="black" stroke="black" points="1543.29,-3865.29 1534.24,-3859.79 1537.89,-3869.74 1543.29,-3865.29"/>
</g>
<!-- pp0_dp2_start -->
<g id="node13" class="node">
<title>pp0_dp2_start</title>
<polygon fill="yellow" stroke="black" points="2762.92,-3859.62 2091.74,-3859.62 1919.08,-3723.62 2590.26,-3723.62 2762.92,-3859.62"/>
<text text-anchor="middle" x="2341" y="-3810.42" font-family="Arial" font-size="14.00">PP Stage 0 DP2</text>
<text text-anchor="middle" x="2341" y="-3795.42" font-family="Arial" font-size="14.00">GPU: DP2_PP0_TP0&#45;DP2_PP0_TP15</text>
<text text-anchor="middle" x="2341" y="-3780.42" font-family="Arial" font-size="14.00">Layers 0&#45;3 (4 layers)</text>
<text text-anchor="middle" x="2341" y="-3765.42" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- hidden_up_dp2&#45;&gt;pp0_dp2_start -->
<g id="edge58" class="edge">
<title>hidden_up_dp2&#45;&gt;pp0_dp2_start</title>
<path fill="none" stroke="black" d="M2255.78,-3895.38C2263.05,-3886.62 2270.95,-3877.09 2278.91,-3867.49"/>
<polygon fill="black" stroke="black" points="2281.61,-3869.72 2285.29,-3859.79 2276.22,-3865.26 2281.61,-3869.72"/>
</g>
<!-- pp0_dp3_start -->
<g id="node14" class="node">
<title>pp0_dp3_start</title>
<polygon fill="yellow" stroke="black" points="3624.92,-3859.62 2953.74,-3859.62 2781.08,-3723.62 3452.26,-3723.62 3624.92,-3859.62"/>
<text text-anchor="middle" x="3203" y="-3810.42" font-family="Arial" font-size="14.00">PP Stage 0 DP3</text>
<text text-anchor="middle" x="3203" y="-3795.42" font-family="Arial" font-size="14.00">GPU: DP3_PP0_TP0&#45;DP3_PP0_TP15</text>
<text text-anchor="middle" x="3203" y="-3780.42" font-family="Arial" font-size="14.00">Layers 0&#45;3 (4 layers)</text>
<text text-anchor="middle" x="3203" y="-3765.42" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- hidden_up_dp3&#45;&gt;pp0_dp3_start -->
<g id="edge71" class="edge">
<title>hidden_up_dp3&#45;&gt;pp0_dp3_start</title>
<path fill="none" stroke="black" d="M3032.96,-3895.57C3048.84,-3885.96 3066.26,-3875.41 3083.7,-3864.86"/>
<polygon fill="black" stroke="black" points="3085.51,-3867.85 3092.25,-3859.68 3081.88,-3861.86 3085.51,-3867.85"/>
</g>
<!-- layer0_norm_dp0 -->
<g id="node15" class="node">
<title>layer0_norm_dp0</title>
<polygon fill="lightcoral" stroke="black" points="764.5,-3687.62 393.5,-3687.62 393.5,-3619.62 764.5,-3619.62 764.5,-3687.62"/>
<text text-anchor="middle" x="579" y="-3672.42" font-family="Arial" font-size="14.00">Layer 0: RMSNorm DP0</text>
<text text-anchor="middle" x="579" y="-3657.42" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="579" y="-3642.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="579" y="-3627.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp0_dp0_start&#45;&gt;layer0_norm_dp0 -->
<g id="edge5" class="edge">
<title>pp0_dp0_start&#45;&gt;layer0_norm_dp0</title>
<path fill="none" stroke="black" d="M579,-3723.42C579,-3714.66 579,-3705.89 579,-3697.69"/>
<polygon fill="black" stroke="black" points="582.5,-3697.64 579,-3687.64 575.5,-3697.64 582.5,-3697.64"/>
</g>
<!-- layers1to3_dp1 -->
<g id="node37" class="node">
<title>layers1to3_dp1</title>
<polygon fill="lightgray" stroke="black" points="1583,-3687.62 1375,-3687.62 1375,-3619.62 1583,-3619.62 1583,-3687.62"/>
<text text-anchor="middle" x="1479" y="-3672.42" font-family="Arial" font-size="14.00">Layers 1&#45;3 DP1</text>
<text text-anchor="middle" x="1479" y="-3657.42" font-family="Arial" font-size="14.00">Same structure as Layer 0</text>
<text text-anchor="middle" x="1479" y="-3642.42" font-family="Arial" font-size="14.00">4 layers per stage</text>
<text text-anchor="middle" x="1479" y="-3627.42" font-family="Arial" font-size="14.00">TP=16, EP=32 (2 experts/GPU)</text>
</g>
<!-- pp0_dp1_start&#45;&gt;layers1to3_dp1 -->
<g id="edge46" class="edge">
<title>pp0_dp1_start&#45;&gt;layers1to3_dp1</title>
<path fill="none" stroke="black" d="M1479,-3723.42C1479,-3714.66 1479,-3705.89 1479,-3697.69"/>
<polygon fill="black" stroke="black" points="1482.5,-3697.64 1479,-3687.64 1475.5,-3697.64 1482.5,-3697.64"/>
</g>
<!-- layers1to3_dp2 -->
<g id="node38" class="node">
<title>layers1to3_dp2</title>
<polygon fill="lightgray" stroke="black" points="2445,-3687.62 2237,-3687.62 2237,-3619.62 2445,-3619.62 2445,-3687.62"/>
<text text-anchor="middle" x="2341" y="-3672.42" font-family="Arial" font-size="14.00">Layers 1&#45;3 DP2</text>
<text text-anchor="middle" x="2341" y="-3657.42" font-family="Arial" font-size="14.00">Same structure as Layer 0</text>
<text text-anchor="middle" x="2341" y="-3642.42" font-family="Arial" font-size="14.00">4 layers per stage</text>
<text text-anchor="middle" x="2341" y="-3627.42" font-family="Arial" font-size="14.00">TP=16, EP=32 (2 experts/GPU)</text>
</g>
<!-- pp0_dp2_start&#45;&gt;layers1to3_dp2 -->
<g id="edge59" class="edge">
<title>pp0_dp2_start&#45;&gt;layers1to3_dp2</title>
<path fill="none" stroke="black" d="M2341,-3723.42C2341,-3714.66 2341,-3705.89 2341,-3697.69"/>
<polygon fill="black" stroke="black" points="2344.5,-3697.64 2341,-3687.64 2337.5,-3697.64 2344.5,-3697.64"/>
</g>
<!-- layers1to3_dp3 -->
<g id="node39" class="node">
<title>layers1to3_dp3</title>
<polygon fill="lightgray" stroke="black" points="3307,-3687.62 3099,-3687.62 3099,-3619.62 3307,-3619.62 3307,-3687.62"/>
<text text-anchor="middle" x="3203" y="-3672.42" font-family="Arial" font-size="14.00">Layers 1&#45;3 DP3</text>
<text text-anchor="middle" x="3203" y="-3657.42" font-family="Arial" font-size="14.00">Same structure as Layer 0</text>
<text text-anchor="middle" x="3203" y="-3642.42" font-family="Arial" font-size="14.00">4 layers per stage</text>
<text text-anchor="middle" x="3203" y="-3627.42" font-family="Arial" font-size="14.00">TP=16, EP=32 (2 experts/GPU)</text>
</g>
<!-- pp0_dp3_start&#45;&gt;layers1to3_dp3 -->
<g id="edge72" class="edge">
<title>pp0_dp3_start&#45;&gt;layers1to3_dp3</title>
<path fill="none" stroke="black" d="M3203,-3723.42C3203,-3714.66 3203,-3705.89 3203,-3697.69"/>
<polygon fill="black" stroke="black" points="3206.5,-3697.64 3203,-3687.64 3199.5,-3697.64 3206.5,-3697.64"/>
</g>
<!-- layer0_q_proj_dp0 -->
<g id="node16" class="node">
<title>layer0_q_proj_dp0</title>
<polygon fill="lightcoral" stroke="black" points="374,-3569.54 0,-3569.54 0,-3501.54 374,-3501.54 374,-3569.54"/>
<text text-anchor="middle" x="187" y="-3554.34" font-family="Arial" font-size="14.00">Layer 0: Q Projection DP0</text>
<text text-anchor="middle" x="187" y="-3539.34" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="187" y="-3524.34" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="187" y="-3509.34" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=32, d_k=64]</text>
</g>
<!-- layer0_norm_dp0&#45;&gt;layer0_q_proj_dp0 -->
<g id="edge6" class="edge">
<title>layer0_norm_dp0&#45;&gt;layer0_q_proj_dp0</title>
<path fill="none" stroke="black" d="M467.46,-3619.59C417.81,-3604.88 359.22,-3587.54 308.47,-3572.51"/>
<polygon fill="black" stroke="black" points="309.34,-3569.11 298.76,-3569.63 307.35,-3575.83 309.34,-3569.11"/>
</g>
<!-- layer0_k_proj_dp0 -->
<g id="node17" class="node">
<title>layer0_k_proj_dp0</title>
<polygon fill="lightcoral" stroke="black" points="766,-3569.54 392,-3569.54 392,-3501.54 766,-3501.54 766,-3569.54"/>
<text text-anchor="middle" x="579" y="-3554.34" font-family="Arial" font-size="14.00">Layer 0: K Projection DP0</text>
<text text-anchor="middle" x="579" y="-3539.34" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="579" y="-3524.34" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="579" y="-3509.34" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=32, d_k=64]</text>
</g>
<!-- layer0_norm_dp0&#45;&gt;layer0_k_proj_dp0 -->
<g id="edge7" class="edge">
<title>layer0_norm_dp0&#45;&gt;layer0_k_proj_dp0</title>
<path fill="none" stroke="black" d="M579,-3619.35C579,-3607.09 579,-3593.01 579,-3579.98"/>
<polygon fill="black" stroke="black" points="582.5,-3579.8 579,-3569.8 575.5,-3579.8 582.5,-3579.8"/>
</g>
<!-- layer0_v_proj_dp0 -->
<g id="node18" class="node">
<title>layer0_v_proj_dp0</title>
<polygon fill="lightcoral" stroke="black" points="981,-3417.45 607,-3417.45 607,-3349.45 981,-3349.45 981,-3417.45"/>
<text text-anchor="middle" x="794" y="-3402.25" font-family="Arial" font-size="14.00">Layer 0: V Projection DP0</text>
<text text-anchor="middle" x="794" y="-3387.25" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="794" y="-3372.25" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="794" y="-3357.25" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=32, d_k=64]</text>
</g>
<!-- layer0_norm_dp0&#45;&gt;layer0_v_proj_dp0 -->
<g id="edge8" class="edge">
<title>layer0_norm_dp0&#45;&gt;layer0_v_proj_dp0</title>
<path fill="none" stroke="black" d="M731.53,-3619.42C748.21,-3610.24 763.33,-3598.54 775,-3583.62 809.57,-3539.42 808.07,-3471.69 802.27,-3427.73"/>
<polygon fill="black" stroke="black" points="805.7,-3427.03 800.8,-3417.64 798.77,-3428.04 805.7,-3427.03"/>
</g>
<!-- layer0_qk_matmul_dp0 -->
<g id="node19" class="node">
<title>layer0_qk_matmul_dp0</title>
<polygon fill="lightcoral" stroke="black" points="589,-3417.45 175,-3417.45 175,-3349.45 589,-3349.45 589,-3417.45"/>
<text text-anchor="middle" x="382" y="-3402.25" font-family="Arial" font-size="14.00">Layer 0: QK^T MatMul DP0</text>
<text text-anchor="middle" x="382" y="-3387.25" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="382" y="-3372.25" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, heads=32, d_k=64] x2</text>
<text text-anchor="middle" x="382" y="-3357.25" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_q_proj_dp0&#45;&gt;layer0_qk_matmul_dp0 -->
<g id="edge9" class="edge">
<title>layer0_q_proj_dp0&#45;&gt;layer0_qk_matmul_dp0</title>
<path fill="none" stroke="black" d="M230.28,-3501.23C259.94,-3478.4 299.42,-3448.01 330.68,-3423.95"/>
<polygon fill="black" stroke="black" points="333.05,-3426.54 338.84,-3417.67 328.78,-3420.99 333.05,-3426.54"/>
</g>
<!-- layer0_k_proj_dp0&#45;&gt;layer0_qk_matmul_dp0 -->
<g id="edge10" class="edge">
<title>layer0_k_proj_dp0&#45;&gt;layer0_qk_matmul_dp0</title>
<path fill="none" stroke="black" d="M535.28,-3501.23C505.31,-3478.4 465.42,-3448.01 433.85,-3423.95"/>
<polygon fill="black" stroke="black" points="435.67,-3420.94 425.6,-3417.67 431.43,-3426.51 435.67,-3420.94"/>
</g>
<!-- layer0_attn_v_matmul_dp0 -->
<g id="node22" class="node">
<title>layer0_attn_v_matmul_dp0</title>
<polygon fill="lightcoral" stroke="black" points="1000.5,-2961.2 275.5,-2961.2 275.5,-2893.2 1000.5,-2893.2 1000.5,-2961.2"/>
<text text-anchor="middle" x="638" y="-2946" font-family="Arial" font-size="14.00">Layer 0: Attention V MatMul DP0</text>
<text text-anchor="middle" x="638" y="-2931" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="638" y="-2916" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, seq_len=1024, heads=32] x [batch_size=32, seq_len=1024, heads=32, d_k=64]</text>
<text text-anchor="middle" x="638" y="-2901" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=32, d_k=64]</text>
</g>
<!-- layer0_v_proj_dp0&#45;&gt;layer0_attn_v_matmul_dp0 -->
<g id="edge14" class="edge">
<title>layer0_v_proj_dp0&#45;&gt;layer0_attn_v_matmul_dp0</title>
<path fill="none" stroke="black" d="M784,-3349.41C764.1,-3284.25 717.49,-3134.76 672,-3011.29 667.15,-2998.12 661.5,-2983.93 656.22,-2971.08"/>
<polygon fill="black" stroke="black" points="659.33,-2969.44 652.28,-2961.54 652.87,-2972.12 659.33,-2969.44"/>
</g>
<!-- layer0_attn_scale_dp0 -->
<g id="node20" class="node">
<title>layer0_attn_scale_dp0</title>
<polygon fill="lightcoral" stroke="black" points="614,-3265.37 200,-3265.37 200,-3197.37 614,-3197.37 614,-3265.37"/>
<text text-anchor="middle" x="407" y="-3250.17" font-family="Arial" font-size="14.00">Layer 0: Attention Scale DP0</text>
<text text-anchor="middle" x="407" y="-3235.17" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="407" y="-3220.17" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="407" y="-3205.17" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_qk_matmul_dp0&#45;&gt;layer0_attn_scale_dp0 -->
<g id="edge11" class="edge">
<title>layer0_qk_matmul_dp0&#45;&gt;layer0_attn_scale_dp0</title>
<path fill="none" stroke="black" d="M387.55,-3349.14C391.16,-3327.48 395.9,-3299.01 399.8,-3275.6"/>
<polygon fill="black" stroke="black" points="403.28,-3276.02 401.47,-3265.58 396.37,-3274.87 403.28,-3276.02"/>
</g>
<!-- layer0_attn_softmax_dp0 -->
<g id="node21" class="node">
<title>layer0_attn_softmax_dp0</title>
<polygon fill="lightcoral" stroke="black" points="663,-3113.29 249,-3113.29 249,-3045.29 663,-3045.29 663,-3113.29"/>
<text text-anchor="middle" x="456" y="-3098.09" font-family="Arial" font-size="14.00">Layer 0: Softmax DP0</text>
<text text-anchor="middle" x="456" y="-3083.09" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="456" y="-3068.09" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="456" y="-3053.09" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_attn_scale_dp0&#45;&gt;layer0_attn_softmax_dp0 -->
<g id="edge12" class="edge">
<title>layer0_attn_scale_dp0&#45;&gt;layer0_attn_softmax_dp0</title>
<path fill="none" stroke="black" d="M417.87,-3197.06C424.98,-3175.3 434.33,-3146.67 441.99,-3123.21"/>
<polygon fill="black" stroke="black" points="445.38,-3124.09 445.16,-3113.5 438.72,-3121.92 445.38,-3124.09"/>
</g>
<!-- layer0_attn_softmax_dp0&#45;&gt;layer0_attn_v_matmul_dp0 -->
<g id="edge13" class="edge">
<title>layer0_attn_softmax_dp0&#45;&gt;layer0_attn_v_matmul_dp0</title>
<path fill="none" stroke="black" d="M496.39,-3044.98C523.96,-3022.24 560.62,-2992.02 589.72,-2968.01"/>
<polygon fill="black" stroke="black" points="592.23,-2970.48 597.72,-2961.42 587.78,-2965.08 592.23,-2970.48"/>
</g>
<!-- layer0_attn_out_proj_dp0 -->
<g id="node23" class="node">
<title>layer0_attn_out_proj_dp0</title>
<polygon fill="lightcoral" stroke="black" points="912.5,-2809.12 541.5,-2809.12 541.5,-2741.12 912.5,-2741.12 912.5,-2809.12"/>
<text text-anchor="middle" x="727" y="-2793.92" font-family="Arial" font-size="14.00">Layer 0: Attention Output Projection DP0</text>
<text text-anchor="middle" x="727" y="-2778.92" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="727" y="-2763.92" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, heads=32, d_k=64]</text>
<text text-anchor="middle" x="727" y="-2748.92" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_v_matmul_dp0&#45;&gt;layer0_attn_out_proj_dp0 -->
<g id="edge15" class="edge">
<title>layer0_attn_v_matmul_dp0&#45;&gt;layer0_attn_out_proj_dp0</title>
<path fill="none" stroke="black" d="M657.75,-2892.89C670.83,-2870.84 688.09,-2841.73 702.11,-2818.1"/>
<polygon fill="black" stroke="black" points="705.21,-2819.72 707.3,-2809.33 699.19,-2816.15 705.21,-2819.72"/>
</g>
<!-- layer0_attn_out_proj_dp0&#45;&gt;layer0_attn_residual_dp0 -->
<g id="edge16" class="edge">
<title>layer0_attn_out_proj_dp0&#45;&gt;layer0_attn_residual_dp0</title>
<path fill="none" stroke="black" d="M800.49,-2741.02C844.59,-2721.16 900.8,-2695.85 946.43,-2675.3"/>
<polygon fill="black" stroke="black" points="948.02,-2678.42 955.7,-2671.13 945.15,-2672.04 948.02,-2678.42"/>
</g>
<!-- layer0_attn_ar_dp0 -->
<g id="node25" class="node">
<title>layer0_attn_ar_dp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1067" cy="-2529.64" rx="251.96" ry="37.45"/>
<text text-anchor="middle" x="1067" y="-2540.94" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1067" y="-2525.94" font-family="Arial" font-size="14.00">TP Group: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="1067" y="-2510.94" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_residual_dp0&#45;&gt;layer0_attn_ar_dp0 -->
<g id="edge18" class="edge">
<title>layer0_attn_residual_dp0&#45;&gt;layer0_attn_ar_dp0</title>
<path fill="none" stroke="black" d="M1040.92,-2603.03C1043.92,-2594.69 1047.21,-2585.59 1050.39,-2576.73"/>
<polygon fill="black" stroke="black" points="1053.71,-2577.87 1053.8,-2567.28 1047.12,-2575.5 1053.71,-2577.87"/>
</g>
<!-- layer0_norm2_dp0 -->
<g id="node26" class="node">
<title>layer0_norm2_dp0</title>
<polygon fill="lightyellow" stroke="black" points="1451.77,-2456.17 839.69,-2456.17 682.23,-2320.17 1294.31,-2320.17 1451.77,-2456.17"/>
<text text-anchor="middle" x="1067" y="-2406.97" font-family="Arial" font-size="14.00">Layer 0: RMSNorm 2 DP0</text>
<text text-anchor="middle" x="1067" y="-2391.97" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="1067" y="-2376.97" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1067" y="-2361.97" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_ar_dp0&#45;&gt;layer0_norm2_dp0 -->
<g id="edge19" class="edge">
<title>layer0_attn_ar_dp0&#45;&gt;layer0_norm2_dp0</title>
<path fill="none" stroke="black" d="M1067,-2492C1067,-2484.02 1067,-2475.29 1067,-2466.4"/>
<polygon fill="black" stroke="black" points="1070.5,-2466.33 1067,-2456.33 1063.5,-2466.33 1070.5,-2466.33"/>
</g>
<!-- layer0_moe_residual_dp0 -->
<g id="node35" class="node">
<title>layer0_moe_residual_dp0</title>
<polygon fill="lightcoral" stroke="black" points="1826,-1535.62 1448,-1535.62 1448,-1467.62 1826,-1467.62 1826,-1535.62"/>
<text text-anchor="middle" x="1637" y="-1520.42" font-family="Arial" font-size="14.00">Layer 0: MoE Residual DP0</text>
<text text-anchor="middle" x="1637" y="-1505.42" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="1637" y="-1490.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096] x2</text>
<text text-anchor="middle" x="1637" y="-1475.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_ar_dp0&#45;&gt;layer0_moe_residual_dp0 -->
<g id="edge32" class="edge">
<title>layer0_attn_ar_dp0&#45;&gt;layer0_moe_residual_dp0</title>
<path fill="none" stroke="black" d="M1263.32,-2506.16C1344.32,-2494.12 1427.13,-2477.35 1461,-2456.17 1572.84,-2386.21 1637,-2349.08 1637,-2217.17 1637,-2217.17 1637,-2217.17 1637,-1790.7 1637,-1704.01 1637,-1602.65 1637,-1546.22"/>
<polygon fill="black" stroke="black" points="1640.5,-1545.89 1637,-1535.89 1633.5,-1545.89 1640.5,-1545.89"/>
</g>
<!-- layer0_gate_dp0 -->
<g id="node27" class="node">
<title>layer0_gate_dp0</title>
<polygon fill="lightyellow" stroke="black" points="1443.18,-2284.17 844.76,-2284.17 690.82,-2148.17 1289.24,-2148.17 1443.18,-2284.17"/>
<text text-anchor="middle" x="1067" y="-2234.97" font-family="Arial" font-size="14.00">Layer 0: MoE Gate DP0</text>
<text text-anchor="middle" x="1067" y="-2219.97" font-family="Arial" font-size="14.00">GPU: DP0_EP0&#45;DP0_EP31</text>
<text text-anchor="middle" x="1067" y="-2204.97" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1067" y="-2189.97" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, num_experts=64]</text>
</g>
<!-- layer0_norm2_dp0&#45;&gt;layer0_gate_dp0 -->
<g id="edge20" class="edge">
<title>layer0_norm2_dp0&#45;&gt;layer0_gate_dp0</title>
<path fill="none" stroke="black" d="M1067,-2319.98C1067,-2311.66 1067,-2303.11 1067,-2294.66"/>
<polygon fill="black" stroke="black" points="1070.5,-2294.42 1067,-2284.42 1063.5,-2294.42 1070.5,-2294.42"/>
</g>
<!-- layer0_route_dp0 -->
<g id="node28" class="node">
<title>layer0_route_dp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1067" cy="-2053.48" rx="147.16" ry="58.88"/>
<text text-anchor="middle" x="1067" y="-2079.78" font-family="Arial" font-size="14.00">Token Routing DP0</text>
<text text-anchor="middle" x="1067" y="-2064.78" font-family="Arial" font-size="14.00">GPU: DP0_EP0&#45;DP0_EP31</text>
<text text-anchor="middle" x="1067" y="-2049.78" font-family="Arial" font-size="14.00">Select 2 experts per token</text>
<text text-anchor="middle" x="1067" y="-2034.78" font-family="Arial" font-size="14.00">Load balance across 64 experts</text>
<text text-anchor="middle" x="1067" y="-2019.78" font-family="Arial" font-size="14.00">EP32: 2 experts per GPU</text>
</g>
<!-- layer0_gate_dp0&#45;&gt;layer0_route_dp0 -->
<g id="edge21" class="edge">
<title>layer0_gate_dp0&#45;&gt;layer0_route_dp0</title>
<path fill="none" stroke="black" d="M1067,-2147.95C1067,-2139.51 1067,-2130.88 1067,-2122.43"/>
<polygon fill="black" stroke="black" points="1070.5,-2122.24 1067,-2112.24 1063.5,-2122.24 1070.5,-2122.24"/>
</g>
<!-- layer0_expert0_dp0 -->
<g id="node29" class="node">
<title>layer0_expert0_dp0</title>
<polygon fill="lightsteelblue" stroke="black" points="507.5,-1958.79 158.5,-1958.79 158.5,-1875.79 507.5,-1875.79 507.5,-1958.79"/>
<text text-anchor="middle" x="333" y="-1943.59" font-family="Arial" font-size="14.00">Layer 0: Expert 0 DP0</text>
<text text-anchor="middle" x="333" y="-1928.59" font-family="Arial" font-size="14.00">GPU: DP0_EP0</text>
<text text-anchor="middle" x="333" y="-1913.59" font-family="Arial" font-size="14.00">Input: [batch_size=2, seq_len=32, hidden_size=4096]</text>
<text text-anchor="middle" x="333" y="-1898.59" font-family="Arial" font-size="14.00">Output: [batch_size=2, seq_len=32, hidden_size=4096]</text>
<text text-anchor="middle" x="333" y="-1883.59" font-family="Arial" font-size="14.00">Up&#45;proj → Activation → Down&#45;proj</text>
</g>
<!-- layer0_route_dp0&#45;&gt;layer0_expert0_dp0 -->
<g id="edge22" class="edge">
<title>layer0_route_dp0&#45;&gt;layer0_expert0_dp0</title>
<path fill="none" stroke="black" d="M930.8,-2031.24C821.59,-2013.76 664.2,-1987.56 517.87,-1959.13"/>
<polygon fill="black" stroke="black" points="518.28,-1955.64 507.8,-1957.17 516.94,-1962.52 518.28,-1955.64"/>
</g>
<!-- layer0_expert1_dp0 -->
<g id="node30" class="node">
<title>layer0_expert1_dp0</title>
<polygon fill="lightsteelblue" stroke="black" points="874.5,-1958.79 525.5,-1958.79 525.5,-1875.79 874.5,-1875.79 874.5,-1958.79"/>
<text text-anchor="middle" x="700" y="-1943.59" font-family="Arial" font-size="14.00">Layer 0: Expert 1 DP0</text>
<text text-anchor="middle" x="700" y="-1928.59" font-family="Arial" font-size="14.00">GPU: DP0_EP0</text>
<text text-anchor="middle" x="700" y="-1913.59" font-family="Arial" font-size="14.00">Input: [batch_size=2, seq_len=32, hidden_size=4096]</text>
<text text-anchor="middle" x="700" y="-1898.59" font-family="Arial" font-size="14.00">Output: [batch_size=2, seq_len=32, hidden_size=4096]</text>
<text text-anchor="middle" x="700" y="-1883.59" font-family="Arial" font-size="14.00">Up&#45;proj → Activation → Down&#45;proj</text>
</g>
<!-- layer0_route_dp0&#45;&gt;layer0_expert1_dp0 -->
<g id="edge23" class="edge">
<title>layer0_route_dp0&#45;&gt;layer0_expert1_dp0</title>
<path fill="none" stroke="black" d="M959.37,-2013.12C915.73,-1997.16 865.14,-1978.67 820.29,-1962.27"/>
<polygon fill="black" stroke="black" points="821.41,-1958.95 810.82,-1958.8 819.01,-1965.53 821.41,-1958.95"/>
</g>
<!-- layer0_expert2_dp0 -->
<g id="node31" class="node">
<title>layer0_expert2_dp0</title>
<polygon fill="lightsteelblue" stroke="black" points="1241.5,-1958.79 892.5,-1958.79 892.5,-1875.79 1241.5,-1875.79 1241.5,-1958.79"/>
<text text-anchor="middle" x="1067" y="-1943.59" font-family="Arial" font-size="14.00">Layer 0: Expert 2 DP0</text>
<text text-anchor="middle" x="1067" y="-1928.59" font-family="Arial" font-size="14.00">GPU: DP0_EP1</text>
<text text-anchor="middle" x="1067" y="-1913.59" font-family="Arial" font-size="14.00">Input: [batch_size=2, seq_len=32, hidden_size=4096]</text>
<text text-anchor="middle" x="1067" y="-1898.59" font-family="Arial" font-size="14.00">Output: [batch_size=2, seq_len=32, hidden_size=4096]</text>
<text text-anchor="middle" x="1067" y="-1883.59" font-family="Arial" font-size="14.00">Up&#45;proj → Activation → Down&#45;proj</text>
</g>
<!-- layer0_route_dp0&#45;&gt;layer0_expert2_dp0 -->
<g id="edge24" class="edge">
<title>layer0_route_dp0&#45;&gt;layer0_expert2_dp0</title>
<path fill="none" stroke="black" d="M1067,-1994.4C1067,-1986.03 1067,-1977.47 1067,-1969.26"/>
<polygon fill="black" stroke="black" points="1070.5,-1969.08 1067,-1959.08 1063.5,-1969.08 1070.5,-1969.08"/>
</g>
<!-- layer0_expert3_dp0 -->
<g id="node32" class="node">
<title>layer0_expert3_dp0</title>
<polygon fill="lightsteelblue" stroke="black" points="1608.5,-1958.79 1259.5,-1958.79 1259.5,-1875.79 1608.5,-1875.79 1608.5,-1958.79"/>
<text text-anchor="middle" x="1434" y="-1943.59" font-family="Arial" font-size="14.00">Layer 0: Expert 3 DP0</text>
<text text-anchor="middle" x="1434" y="-1928.59" font-family="Arial" font-size="14.00">GPU: DP0_EP1</text>
<text text-anchor="middle" x="1434" y="-1913.59" font-family="Arial" font-size="14.00">Input: [batch_size=2, seq_len=32, hidden_size=4096]</text>
<text text-anchor="middle" x="1434" y="-1898.59" font-family="Arial" font-size="14.00">Output: [batch_size=2, seq_len=32, hidden_size=4096]</text>
<text text-anchor="middle" x="1434" y="-1883.59" font-family="Arial" font-size="14.00">Up&#45;proj → Activation → Down&#45;proj</text>
</g>
<!-- layer0_route_dp0&#45;&gt;layer0_expert3_dp0 -->
<g id="edge25" class="edge">
<title>layer0_route_dp0&#45;&gt;layer0_expert3_dp0</title>
<path fill="none" stroke="black" d="M1174.63,-2013.12C1218.27,-1997.16 1268.86,-1978.67 1313.71,-1962.27"/>
<polygon fill="black" stroke="black" points="1314.99,-1965.53 1323.18,-1958.8 1312.59,-1958.95 1314.99,-1965.53"/>
</g>
<!-- layer0_ep_a2a_dp0 -->
<g id="node33" class="node">
<title>layer0_ep_a2a_dp0</title>
<ellipse fill="orange" stroke="black" cx="1067" cy="-1791.7" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1067" y="-1810.5" font-family="Arial" font-size="14.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="1067" y="-1795.5" font-family="Arial" font-size="14.00">EP Group: DP0_EP0&#45;DP0_EP31</text>
<text text-anchor="middle" x="1067" y="-1780.5" font-family="Arial" font-size="14.00">Token dispatch/combine</text>
<text text-anchor="middle" x="1067" y="-1765.5" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_expert0_dp0&#45;&gt;layer0_ep_a2a_dp0 -->
<g id="edge26" class="edge">
<title>layer0_expert0_dp0&#45;&gt;layer0_ep_a2a_dp0</title>
<path fill="none" stroke="black" d="M507.78,-1877.33C510.54,-1876.81 513.28,-1876.29 516,-1875.79 626.8,-1855.2 750.86,-1836.14 853.17,-1821.49"/>
<polygon fill="black" stroke="black" points="853.91,-1824.92 863.32,-1820.04 852.92,-1817.99 853.91,-1824.92"/>
</g>
<!-- layer0_expert1_dp0&#45;&gt;layer0_ep_a2a_dp0 -->
<g id="edge27" class="edge">
<title>layer0_expert1_dp0&#45;&gt;layer0_ep_a2a_dp0</title>
<path fill="none" stroke="black" d="M820.42,-1875.73C857.07,-1863.4 897.53,-1849.77 934.9,-1837.19"/>
<polygon fill="black" stroke="black" points="936.47,-1840.35 944.83,-1833.84 934.24,-1833.71 936.47,-1840.35"/>
</g>
<!-- layer0_expert2_dp0&#45;&gt;layer0_ep_a2a_dp0 -->
<g id="edge28" class="edge">
<title>layer0_expert2_dp0&#45;&gt;layer0_ep_a2a_dp0</title>
<path fill="none" stroke="black" d="M1067,-1875.48C1067,-1867.29 1067,-1858.55 1067,-1849.92"/>
<polygon fill="black" stroke="black" points="1070.5,-1849.89 1067,-1839.89 1063.5,-1849.89 1070.5,-1849.89"/>
</g>
<!-- layer0_expert3_dp0&#45;&gt;layer0_ep_a2a_dp0 -->
<g id="edge29" class="edge">
<title>layer0_expert3_dp0&#45;&gt;layer0_ep_a2a_dp0</title>
<path fill="none" stroke="black" d="M1313.58,-1875.73C1276.93,-1863.4 1236.47,-1849.77 1199.1,-1837.19"/>
<polygon fill="black" stroke="black" points="1199.76,-1833.71 1189.17,-1833.84 1197.53,-1840.35 1199.76,-1833.71"/>
</g>
<!-- layer0_expert_combine_dp0 -->
<g id="node34" class="node">
<title>layer0_expert_combine_dp0</title>
<polygon fill="lightyellow" stroke="black" points="1530.77,-1707.62 918.69,-1707.62 761.23,-1571.62 1373.31,-1571.62 1530.77,-1707.62"/>
<text text-anchor="middle" x="1146" y="-1658.42" font-family="Arial" font-size="14.00">Expert Combine DP0</text>
<text text-anchor="middle" x="1146" y="-1643.42" font-family="Arial" font-size="14.00">GPU: DP0_EP0&#45;DP0_EP31</text>
<text text-anchor="middle" x="1146" y="-1628.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1146" y="-1613.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_ep_a2a_dp0&#45;&gt;layer0_expert_combine_dp0 -->
<g id="edge30" class="edge">
<title>layer0_ep_a2a_dp0&#45;&gt;layer0_expert_combine_dp0</title>
<path fill="none" stroke="black" d="M1091.78,-1743.63C1096.26,-1735.12 1101.03,-1726.05 1105.82,-1716.95"/>
<polygon fill="black" stroke="black" points="1109.04,-1718.34 1110.6,-1707.87 1102.85,-1715.08 1109.04,-1718.34"/>
</g>
<!-- layer0_expert_combine_dp0&#45;&gt;layer0_moe_residual_dp0 -->
<g id="edge31" class="edge">
<title>layer0_expert_combine_dp0&#45;&gt;layer0_moe_residual_dp0</title>
<path fill="none" stroke="black" d="M1377.12,-1574.6C1422.05,-1562.16 1467.61,-1549.54 1507.78,-1538.41"/>
<polygon fill="black" stroke="black" points="1508.9,-1541.73 1517.6,-1535.69 1507.03,-1534.99 1508.9,-1541.73"/>
</g>
<!-- layers1to3_dp0 -->
<g id="node36" class="node">
<title>layers1to3_dp0</title>
<polygon fill="lightgray" stroke="black" points="1760,-1431.62 1552,-1431.62 1552,-1363.62 1760,-1363.62 1760,-1431.62"/>
<text text-anchor="middle" x="1656" y="-1416.42" font-family="Arial" font-size="14.00">Layers 1&#45;3 DP0</text>
<text text-anchor="middle" x="1656" y="-1401.42" font-family="Arial" font-size="14.00">Same structure as Layer 0</text>
<text text-anchor="middle" x="1656" y="-1386.42" font-family="Arial" font-size="14.00">4 layers per stage</text>
<text text-anchor="middle" x="1656" y="-1371.42" font-family="Arial" font-size="14.00">TP=16, EP=32 (2 experts/GPU)</text>
</g>
<!-- layer0_moe_residual_dp0&#45;&gt;layers1to3_dp0 -->
<g id="edge33" class="edge">
<title>layer0_moe_residual_dp0&#45;&gt;layers1to3_dp0</title>
<path fill="none" stroke="black" d="M1643.17,-1467.5C1644.7,-1459.31 1646.35,-1450.41 1647.95,-1441.81"/>
<polygon fill="black" stroke="black" points="1651.41,-1442.39 1649.8,-1431.92 1644.53,-1441.11 1651.41,-1442.39"/>
</g>
<!-- pp0_to_pp1_dp0 -->
<g id="node40" class="node">
<title>pp0_to_pp1_dp0</title>
<ellipse fill="orange" stroke="black" cx="1666" cy="-1279.54" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1666" y="-1298.34" font-family="Arial" font-size="14.00">Pipeline Transfer DP0</text>
<text text-anchor="middle" x="1666" y="-1283.34" font-family="Arial" font-size="14.00">PP0 → PP1</text>
<text text-anchor="middle" x="1666" y="-1268.34" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="1666" y="-1253.34" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layers1to3_dp0&#45;&gt;pp0_to_pp1_dp0 -->
<g id="edge34" class="edge">
<title>layers1to3_dp0&#45;&gt;pp0_to_pp1_dp0</title>
<path fill="none" stroke="black" d="M1658.87,-1363.35C1659.55,-1355.36 1660.31,-1346.6 1661.06,-1337.85"/>
<polygon fill="black" stroke="black" points="1664.57,-1337.91 1661.94,-1327.65 1657.6,-1337.31 1664.57,-1337.91"/>
</g>
<!-- pp0_to_pp1_dp1 -->
<g id="node43" class="node">
<title>pp0_to_pp1_dp1</title>
<ellipse fill="orange" stroke="black" cx="1479" cy="-3535.54" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1479" y="-3554.34" font-family="Arial" font-size="14.00">Pipeline Transfer DP1</text>
<text text-anchor="middle" x="1479" y="-3539.34" font-family="Arial" font-size="14.00">PP0 → PP1</text>
<text text-anchor="middle" x="1479" y="-3524.34" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="1479" y="-3509.34" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layers1to3_dp1&#45;&gt;pp0_to_pp1_dp1 -->
<g id="edge47" class="edge">
<title>layers1to3_dp1&#45;&gt;pp0_to_pp1_dp1</title>
<path fill="none" stroke="black" d="M1479,-3619.35C1479,-3611.36 1479,-3602.59 1479,-3593.85"/>
<polygon fill="black" stroke="black" points="1482.5,-3593.64 1479,-3583.64 1475.5,-3593.64 1482.5,-3593.64"/>
</g>
<!-- pp0_to_pp1_dp2 -->
<g id="node46" class="node">
<title>pp0_to_pp1_dp2</title>
<ellipse fill="orange" stroke="black" cx="2341" cy="-3535.54" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="2341" y="-3554.34" font-family="Arial" font-size="14.00">Pipeline Transfer DP2</text>
<text text-anchor="middle" x="2341" y="-3539.34" font-family="Arial" font-size="14.00">PP0 → PP1</text>
<text text-anchor="middle" x="2341" y="-3524.34" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="2341" y="-3509.34" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layers1to3_dp2&#45;&gt;pp0_to_pp1_dp2 -->
<g id="edge60" class="edge">
<title>layers1to3_dp2&#45;&gt;pp0_to_pp1_dp2</title>
<path fill="none" stroke="black" d="M2341,-3619.35C2341,-3611.36 2341,-3602.59 2341,-3593.85"/>
<polygon fill="black" stroke="black" points="2344.5,-3593.64 2341,-3583.64 2337.5,-3593.64 2344.5,-3593.64"/>
</g>
<!-- pp0_to_pp1_dp3 -->
<g id="node49" class="node">
<title>pp0_to_pp1_dp3</title>
<ellipse fill="orange" stroke="black" cx="3203" cy="-3535.54" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="3203" y="-3554.34" font-family="Arial" font-size="14.00">Pipeline Transfer DP3</text>
<text text-anchor="middle" x="3203" y="-3539.34" font-family="Arial" font-size="14.00">PP0 → PP1</text>
<text text-anchor="middle" x="3203" y="-3524.34" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="3203" y="-3509.34" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layers1to3_dp3&#45;&gt;pp0_to_pp1_dp3 -->
<g id="edge73" class="edge">
<title>layers1to3_dp3&#45;&gt;pp0_to_pp1_dp3</title>
<path fill="none" stroke="black" d="M3203,-3619.35C3203,-3611.36 3203,-3602.59 3203,-3593.85"/>
<polygon fill="black" stroke="black" points="3206.5,-3593.64 3203,-3583.64 3199.5,-3593.64 3206.5,-3593.64"/>
</g>
<!-- pp1_dp0_start -->
<g id="node52" class="node">
<title>pp1_dp0_start</title>
<polygon fill="yellow" stroke="black" points="2092.92,-1195.45 1421.74,-1195.45 1249.08,-1059.45 1920.26,-1059.45 2092.92,-1195.45"/>
<text text-anchor="middle" x="1671" y="-1146.25" font-family="Arial" font-size="14.00">PP Stage 1 DP0</text>
<text text-anchor="middle" x="1671" y="-1131.25" font-family="Arial" font-size="14.00">GPU: DP0_PP1_TP0&#45;DP0_PP1_TP15</text>
<text text-anchor="middle" x="1671" y="-1116.25" font-family="Arial" font-size="14.00">Layers 4&#45;7 (4 layers)</text>
<text text-anchor="middle" x="1671" y="-1101.25" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp0_to_pp1_dp0&#45;&gt;pp1_dp0_start -->
<g id="edge35" class="edge">
<title>pp0_to_pp1_dp0&#45;&gt;pp1_dp0_start</title>
<path fill="none" stroke="black" d="M1667.58,-1231.05C1667.85,-1222.96 1668.14,-1214.38 1668.42,-1205.76"/>
<polygon fill="black" stroke="black" points="1671.93,-1205.76 1668.76,-1195.65 1664.93,-1205.53 1671.93,-1205.76"/>
</g>
<!-- pp1_to_pp2_dp0 -->
<g id="node41" class="node">
<title>pp1_to_pp2_dp0</title>
<ellipse fill="orange" stroke="black" cx="1673" cy="-975.37" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1673" y="-994.17" font-family="Arial" font-size="14.00">Pipeline Transfer DP0</text>
<text text-anchor="middle" x="1673" y="-979.17" font-family="Arial" font-size="14.00">PP1 → PP2</text>
<text text-anchor="middle" x="1673" y="-964.17" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="1673" y="-949.17" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp2_dp0_start -->
<g id="node53" class="node">
<title>pp2_dp0_start</title>
<polygon fill="yellow" stroke="black" points="2095.92,-891.29 1424.74,-891.29 1252.08,-755.29 1923.26,-755.29 2095.92,-891.29"/>
<text text-anchor="middle" x="1674" y="-842.09" font-family="Arial" font-size="14.00">PP Stage 2 DP0</text>
<text text-anchor="middle" x="1674" y="-827.09" font-family="Arial" font-size="14.00">GPU: DP0_PP2_TP0&#45;DP0_PP2_TP15</text>
<text text-anchor="middle" x="1674" y="-812.09" font-family="Arial" font-size="14.00">Layers 8&#45;11 (4 layers)</text>
<text text-anchor="middle" x="1674" y="-797.09" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp1_to_pp2_dp0&#45;&gt;pp2_dp0_start -->
<g id="edge37" class="edge">
<title>pp1_to_pp2_dp0&#45;&gt;pp2_dp0_start</title>
<path fill="none" stroke="black" d="M1673.32,-926.88C1673.37,-918.8 1673.43,-910.21 1673.48,-901.59"/>
<polygon fill="black" stroke="black" points="1676.99,-901.5 1673.55,-891.48 1669.99,-901.46 1676.99,-901.5"/>
</g>
<!-- pp2_to_pp3_dp0 -->
<g id="node42" class="node">
<title>pp2_to_pp3_dp0</title>
<ellipse fill="orange" stroke="black" cx="1675" cy="-671.2" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1675" y="-690" font-family="Arial" font-size="14.00">Pipeline Transfer DP0</text>
<text text-anchor="middle" x="1675" y="-675" font-family="Arial" font-size="14.00">PP2 → PP3</text>
<text text-anchor="middle" x="1675" y="-660" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="1675" y="-645" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp3_dp0_start -->
<g id="node54" class="node">
<title>pp3_dp0_start</title>
<polygon fill="yellow" stroke="black" points="2096.92,-587.12 1425.74,-587.12 1253.08,-451.12 1924.26,-451.12 2096.92,-587.12"/>
<text text-anchor="middle" x="1675" y="-537.92" font-family="Arial" font-size="14.00">PP Stage 3 DP0</text>
<text text-anchor="middle" x="1675" y="-522.92" font-family="Arial" font-size="14.00">GPU: DP0_PP3_TP0&#45;DP0_PP3_TP15</text>
<text text-anchor="middle" x="1675" y="-507.92" font-family="Arial" font-size="14.00">Layers 12&#45;15 (4 layers)</text>
<text text-anchor="middle" x="1675" y="-492.92" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp2_to_pp3_dp0&#45;&gt;pp3_dp0_start -->
<g id="edge39" class="edge">
<title>pp2_to_pp3_dp0&#45;&gt;pp3_dp0_start</title>
<path fill="none" stroke="black" d="M1675,-622.72C1675,-614.63 1675,-606.05 1675,-597.43"/>
<polygon fill="black" stroke="black" points="1678.5,-597.31 1675,-587.31 1671.5,-597.31 1678.5,-597.31"/>
</g>
<!-- pp1_dp1_start -->
<g id="node55" class="node">
<title>pp1_dp1_start</title>
<polygon fill="yellow" stroke="black" points="1900.92,-3451.45 1229.74,-3451.45 1057.08,-3315.45 1728.26,-3315.45 1900.92,-3451.45"/>
<text text-anchor="middle" x="1479" y="-3402.25" font-family="Arial" font-size="14.00">PP Stage 1 DP1</text>
<text text-anchor="middle" x="1479" y="-3387.25" font-family="Arial" font-size="14.00">GPU: DP1_PP1_TP0&#45;DP1_PP1_TP15</text>
<text text-anchor="middle" x="1479" y="-3372.25" font-family="Arial" font-size="14.00">Layers 4&#45;7 (4 layers)</text>
<text text-anchor="middle" x="1479" y="-3357.25" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp0_to_pp1_dp1&#45;&gt;pp1_dp1_start -->
<g id="edge48" class="edge">
<title>pp0_to_pp1_dp1&#45;&gt;pp1_dp1_start</title>
<path fill="none" stroke="black" d="M1479,-3487.05C1479,-3478.96 1479,-3470.38 1479,-3461.76"/>
<polygon fill="black" stroke="black" points="1482.5,-3461.65 1479,-3451.65 1475.5,-3461.65 1482.5,-3461.65"/>
</g>
<!-- pp1_to_pp2_dp1 -->
<g id="node44" class="node">
<title>pp1_to_pp2_dp1</title>
<ellipse fill="orange" stroke="black" cx="1479" cy="-3231.37" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1479" y="-3250.17" font-family="Arial" font-size="14.00">Pipeline Transfer DP1</text>
<text text-anchor="middle" x="1479" y="-3235.17" font-family="Arial" font-size="14.00">PP1 → PP2</text>
<text text-anchor="middle" x="1479" y="-3220.17" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="1479" y="-3205.17" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp2_dp1_start -->
<g id="node56" class="node">
<title>pp2_dp1_start</title>
<polygon fill="yellow" stroke="black" points="1900.92,-3147.29 1229.74,-3147.29 1057.08,-3011.29 1728.26,-3011.29 1900.92,-3147.29"/>
<text text-anchor="middle" x="1479" y="-3098.09" font-family="Arial" font-size="14.00">PP Stage 2 DP1</text>
<text text-anchor="middle" x="1479" y="-3083.09" font-family="Arial" font-size="14.00">GPU: DP1_PP2_TP0&#45;DP1_PP2_TP15</text>
<text text-anchor="middle" x="1479" y="-3068.09" font-family="Arial" font-size="14.00">Layers 8&#45;11 (4 layers)</text>
<text text-anchor="middle" x="1479" y="-3053.09" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp1_to_pp2_dp1&#45;&gt;pp2_dp1_start -->
<g id="edge50" class="edge">
<title>pp1_to_pp2_dp1&#45;&gt;pp2_dp1_start</title>
<path fill="none" stroke="black" d="M1479,-3182.88C1479,-3174.8 1479,-3166.21 1479,-3157.59"/>
<polygon fill="black" stroke="black" points="1482.5,-3157.48 1479,-3147.48 1475.5,-3157.48 1482.5,-3157.48"/>
</g>
<!-- pp2_to_pp3_dp1 -->
<g id="node45" class="node">
<title>pp2_to_pp3_dp1</title>
<ellipse fill="orange" stroke="black" cx="1479" cy="-2927.2" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1479" y="-2946" font-family="Arial" font-size="14.00">Pipeline Transfer DP1</text>
<text text-anchor="middle" x="1479" y="-2931" font-family="Arial" font-size="14.00">PP2 → PP3</text>
<text text-anchor="middle" x="1479" y="-2916" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="1479" y="-2901" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp3_dp1_start -->
<g id="node57" class="node">
<title>pp3_dp1_start</title>
<polygon fill="yellow" stroke="black" points="1900.92,-2843.12 1229.74,-2843.12 1057.08,-2707.12 1728.26,-2707.12 1900.92,-2843.12"/>
<text text-anchor="middle" x="1479" y="-2793.92" font-family="Arial" font-size="14.00">PP Stage 3 DP1</text>
<text text-anchor="middle" x="1479" y="-2778.92" font-family="Arial" font-size="14.00">GPU: DP1_PP3_TP0&#45;DP1_PP3_TP15</text>
<text text-anchor="middle" x="1479" y="-2763.92" font-family="Arial" font-size="14.00">Layers 12&#45;15 (4 layers)</text>
<text text-anchor="middle" x="1479" y="-2748.92" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp2_to_pp3_dp1&#45;&gt;pp3_dp1_start -->
<g id="edge52" class="edge">
<title>pp2_to_pp3_dp1&#45;&gt;pp3_dp1_start</title>
<path fill="none" stroke="black" d="M1479,-2878.71C1479,-2870.63 1479,-2862.05 1479,-2853.43"/>
<polygon fill="black" stroke="black" points="1482.5,-2853.31 1479,-2843.31 1475.5,-2853.31 1482.5,-2853.31"/>
</g>
<!-- pp1_dp2_start -->
<g id="node58" class="node">
<title>pp1_dp2_start</title>
<polygon fill="yellow" stroke="black" points="2762.92,-3451.45 2091.74,-3451.45 1919.08,-3315.45 2590.26,-3315.45 2762.92,-3451.45"/>
<text text-anchor="middle" x="2341" y="-3402.25" font-family="Arial" font-size="14.00">PP Stage 1 DP2</text>
<text text-anchor="middle" x="2341" y="-3387.25" font-family="Arial" font-size="14.00">GPU: DP2_PP1_TP0&#45;DP2_PP1_TP15</text>
<text text-anchor="middle" x="2341" y="-3372.25" font-family="Arial" font-size="14.00">Layers 4&#45;7 (4 layers)</text>
<text text-anchor="middle" x="2341" y="-3357.25" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp0_to_pp1_dp2&#45;&gt;pp1_dp2_start -->
<g id="edge61" class="edge">
<title>pp0_to_pp1_dp2&#45;&gt;pp1_dp2_start</title>
<path fill="none" stroke="black" d="M2341,-3487.05C2341,-3478.96 2341,-3470.38 2341,-3461.76"/>
<polygon fill="black" stroke="black" points="2344.5,-3461.65 2341,-3451.65 2337.5,-3461.65 2344.5,-3461.65"/>
</g>
<!-- pp1_to_pp2_dp2 -->
<g id="node47" class="node">
<title>pp1_to_pp2_dp2</title>
<ellipse fill="orange" stroke="black" cx="2341" cy="-3231.37" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="2341" y="-3250.17" font-family="Arial" font-size="14.00">Pipeline Transfer DP2</text>
<text text-anchor="middle" x="2341" y="-3235.17" font-family="Arial" font-size="14.00">PP1 → PP2</text>
<text text-anchor="middle" x="2341" y="-3220.17" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="2341" y="-3205.17" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp2_dp2_start -->
<g id="node59" class="node">
<title>pp2_dp2_start</title>
<polygon fill="yellow" stroke="black" points="2762.92,-3147.29 2091.74,-3147.29 1919.08,-3011.29 2590.26,-3011.29 2762.92,-3147.29"/>
<text text-anchor="middle" x="2341" y="-3098.09" font-family="Arial" font-size="14.00">PP Stage 2 DP2</text>
<text text-anchor="middle" x="2341" y="-3083.09" font-family="Arial" font-size="14.00">GPU: DP2_PP2_TP0&#45;DP2_PP2_TP15</text>
<text text-anchor="middle" x="2341" y="-3068.09" font-family="Arial" font-size="14.00">Layers 8&#45;11 (4 layers)</text>
<text text-anchor="middle" x="2341" y="-3053.09" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp1_to_pp2_dp2&#45;&gt;pp2_dp2_start -->
<g id="edge63" class="edge">
<title>pp1_to_pp2_dp2&#45;&gt;pp2_dp2_start</title>
<path fill="none" stroke="black" d="M2341,-3182.88C2341,-3174.8 2341,-3166.21 2341,-3157.59"/>
<polygon fill="black" stroke="black" points="2344.5,-3157.48 2341,-3147.48 2337.5,-3157.48 2344.5,-3157.48"/>
</g>
<!-- pp2_to_pp3_dp2 -->
<g id="node48" class="node">
<title>pp2_to_pp3_dp2</title>
<ellipse fill="orange" stroke="black" cx="2341" cy="-2927.2" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="2341" y="-2946" font-family="Arial" font-size="14.00">Pipeline Transfer DP2</text>
<text text-anchor="middle" x="2341" y="-2931" font-family="Arial" font-size="14.00">PP2 → PP3</text>
<text text-anchor="middle" x="2341" y="-2916" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="2341" y="-2901" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp3_dp2_start -->
<g id="node60" class="node">
<title>pp3_dp2_start</title>
<polygon fill="yellow" stroke="black" points="2762.92,-2843.12 2091.74,-2843.12 1919.08,-2707.12 2590.26,-2707.12 2762.92,-2843.12"/>
<text text-anchor="middle" x="2341" y="-2793.92" font-family="Arial" font-size="14.00">PP Stage 3 DP2</text>
<text text-anchor="middle" x="2341" y="-2778.92" font-family="Arial" font-size="14.00">GPU: DP2_PP3_TP0&#45;DP2_PP3_TP15</text>
<text text-anchor="middle" x="2341" y="-2763.92" font-family="Arial" font-size="14.00">Layers 12&#45;15 (4 layers)</text>
<text text-anchor="middle" x="2341" y="-2748.92" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp2_to_pp3_dp2&#45;&gt;pp3_dp2_start -->
<g id="edge65" class="edge">
<title>pp2_to_pp3_dp2&#45;&gt;pp3_dp2_start</title>
<path fill="none" stroke="black" d="M2341,-2878.71C2341,-2870.63 2341,-2862.05 2341,-2853.43"/>
<polygon fill="black" stroke="black" points="2344.5,-2853.31 2341,-2843.31 2337.5,-2853.31 2344.5,-2853.31"/>
</g>
<!-- pp1_dp3_start -->
<g id="node61" class="node">
<title>pp1_dp3_start</title>
<polygon fill="yellow" stroke="black" points="3624.92,-3451.45 2953.74,-3451.45 2781.08,-3315.45 3452.26,-3315.45 3624.92,-3451.45"/>
<text text-anchor="middle" x="3203" y="-3402.25" font-family="Arial" font-size="14.00">PP Stage 1 DP3</text>
<text text-anchor="middle" x="3203" y="-3387.25" font-family="Arial" font-size="14.00">GPU: DP3_PP1_TP0&#45;DP3_PP1_TP15</text>
<text text-anchor="middle" x="3203" y="-3372.25" font-family="Arial" font-size="14.00">Layers 4&#45;7 (4 layers)</text>
<text text-anchor="middle" x="3203" y="-3357.25" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp0_to_pp1_dp3&#45;&gt;pp1_dp3_start -->
<g id="edge74" class="edge">
<title>pp0_to_pp1_dp3&#45;&gt;pp1_dp3_start</title>
<path fill="none" stroke="black" d="M3203,-3487.05C3203,-3478.96 3203,-3470.38 3203,-3461.76"/>
<polygon fill="black" stroke="black" points="3206.5,-3461.65 3203,-3451.65 3199.5,-3461.65 3206.5,-3461.65"/>
</g>
<!-- pp1_to_pp2_dp3 -->
<g id="node50" class="node">
<title>pp1_to_pp2_dp3</title>
<ellipse fill="orange" stroke="black" cx="3203" cy="-3231.37" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="3203" y="-3250.17" font-family="Arial" font-size="14.00">Pipeline Transfer DP3</text>
<text text-anchor="middle" x="3203" y="-3235.17" font-family="Arial" font-size="14.00">PP1 → PP2</text>
<text text-anchor="middle" x="3203" y="-3220.17" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="3203" y="-3205.17" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp2_dp3_start -->
<g id="node62" class="node">
<title>pp2_dp3_start</title>
<polygon fill="yellow" stroke="black" points="3624.92,-3147.29 2953.74,-3147.29 2781.08,-3011.29 3452.26,-3011.29 3624.92,-3147.29"/>
<text text-anchor="middle" x="3203" y="-3098.09" font-family="Arial" font-size="14.00">PP Stage 2 DP3</text>
<text text-anchor="middle" x="3203" y="-3083.09" font-family="Arial" font-size="14.00">GPU: DP3_PP2_TP0&#45;DP3_PP2_TP15</text>
<text text-anchor="middle" x="3203" y="-3068.09" font-family="Arial" font-size="14.00">Layers 8&#45;11 (4 layers)</text>
<text text-anchor="middle" x="3203" y="-3053.09" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp1_to_pp2_dp3&#45;&gt;pp2_dp3_start -->
<g id="edge76" class="edge">
<title>pp1_to_pp2_dp3&#45;&gt;pp2_dp3_start</title>
<path fill="none" stroke="black" d="M3203,-3182.88C3203,-3174.8 3203,-3166.21 3203,-3157.59"/>
<polygon fill="black" stroke="black" points="3206.5,-3157.48 3203,-3147.48 3199.5,-3157.48 3206.5,-3157.48"/>
</g>
<!-- pp2_to_pp3_dp3 -->
<g id="node51" class="node">
<title>pp2_to_pp3_dp3</title>
<ellipse fill="orange" stroke="black" cx="3203" cy="-2927.2" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="3203" y="-2946" font-family="Arial" font-size="14.00">Pipeline Transfer DP3</text>
<text text-anchor="middle" x="3203" y="-2931" font-family="Arial" font-size="14.00">PP2 → PP3</text>
<text text-anchor="middle" x="3203" y="-2916" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="3203" y="-2901" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp3_dp3_start -->
<g id="node63" class="node">
<title>pp3_dp3_start</title>
<polygon fill="yellow" stroke="black" points="3624.92,-2843.12 2953.74,-2843.12 2781.08,-2707.12 3452.26,-2707.12 3624.92,-2843.12"/>
<text text-anchor="middle" x="3203" y="-2793.92" font-family="Arial" font-size="14.00">PP Stage 3 DP3</text>
<text text-anchor="middle" x="3203" y="-2778.92" font-family="Arial" font-size="14.00">GPU: DP3_PP3_TP0&#45;DP3_PP3_TP15</text>
<text text-anchor="middle" x="3203" y="-2763.92" font-family="Arial" font-size="14.00">Layers 12&#45;15 (4 layers)</text>
<text text-anchor="middle" x="3203" y="-2748.92" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp2_to_pp3_dp3&#45;&gt;pp3_dp3_start -->
<g id="edge78" class="edge">
<title>pp2_to_pp3_dp3&#45;&gt;pp3_dp3_start</title>
<path fill="none" stroke="black" d="M3203,-2878.71C3203,-2870.63 3203,-2862.05 3203,-2853.43"/>
<polygon fill="black" stroke="black" points="3206.5,-2853.31 3203,-2843.31 3199.5,-2853.31 3206.5,-2853.31"/>
</g>
<!-- pp1_dp0_start&#45;&gt;pp1_to_pp2_dp0 -->
<g id="edge36" class="edge">
<title>pp1_dp0_start&#45;&gt;pp1_to_pp2_dp0</title>
<path fill="none" stroke="black" d="M1671.89,-1059.31C1672.01,-1050.77 1672.12,-1042.08 1672.24,-1033.71"/>
<polygon fill="black" stroke="black" points="1675.74,-1033.73 1672.37,-1023.69 1668.74,-1033.64 1675.74,-1033.73"/>
</g>
<!-- pp2_dp0_start&#45;&gt;pp2_to_pp3_dp0 -->
<g id="edge38" class="edge">
<title>pp2_dp0_start&#45;&gt;pp2_to_pp3_dp0</title>
<path fill="none" stroke="black" d="M1674.45,-755.15C1674.5,-746.6 1674.56,-737.92 1674.62,-729.55"/>
<polygon fill="black" stroke="black" points="1678.12,-729.54 1674.68,-719.52 1671.12,-729.5 1678.12,-729.54"/>
</g>
<!-- final_norm_dp0 -->
<g id="node64" class="node">
<title>final_norm_dp0</title>
<polygon fill="lightgreen" stroke="black" points="1919.5,-415.12 1548.5,-415.12 1548.5,-347.12 1919.5,-347.12 1919.5,-415.12"/>
<text text-anchor="middle" x="1734" y="-399.92" font-family="Arial" font-size="14.00">Final RMSNorm DP0</text>
<text text-anchor="middle" x="1734" y="-384.92" font-family="Arial" font-size="14.00">GPU: DP0_PP3_TP0&#45;DP0_PP3_TP15</text>
<text text-anchor="middle" x="1734" y="-369.92" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1734" y="-354.92" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp3_dp0_start&#45;&gt;final_norm_dp0 -->
<g id="edge40" class="edge">
<title>pp3_dp0_start&#45;&gt;final_norm_dp0</title>
<path fill="none" stroke="black" d="M1704.15,-450.92C1708.08,-441.87 1712.01,-432.81 1715.67,-424.37"/>
<polygon fill="black" stroke="black" points="1718.91,-425.7 1719.68,-415.14 1712.49,-422.92 1718.91,-425.7"/>
</g>
<!-- pp1_dp1_start&#45;&gt;pp1_to_pp2_dp1 -->
<g id="edge49" class="edge">
<title>pp1_dp1_start&#45;&gt;pp1_to_pp2_dp1</title>
<path fill="none" stroke="black" d="M1479,-3315.31C1479,-3306.77 1479,-3298.08 1479,-3289.71"/>
<polygon fill="black" stroke="black" points="1482.5,-3289.69 1479,-3279.69 1475.5,-3289.69 1482.5,-3289.69"/>
</g>
<!-- pp2_dp1_start&#45;&gt;pp2_to_pp3_dp1 -->
<g id="edge51" class="edge">
<title>pp2_dp1_start&#45;&gt;pp2_to_pp3_dp1</title>
<path fill="none" stroke="black" d="M1479,-3011.15C1479,-3002.6 1479,-2993.92 1479,-2985.55"/>
<polygon fill="black" stroke="black" points="1482.5,-2985.52 1479,-2975.52 1475.5,-2985.52 1482.5,-2985.52"/>
</g>
<!-- final_norm_dp1 -->
<g id="node66" class="node">
<title>final_norm_dp1</title>
<polygon fill="lightgreen" stroke="black" points="1825.5,-2671.12 1454.5,-2671.12 1454.5,-2603.12 1825.5,-2603.12 1825.5,-2671.12"/>
<text text-anchor="middle" x="1640" y="-2655.92" font-family="Arial" font-size="14.00">Final RMSNorm DP1</text>
<text text-anchor="middle" x="1640" y="-2640.92" font-family="Arial" font-size="14.00">GPU: DP1_PP3_TP0&#45;DP1_PP3_TP15</text>
<text text-anchor="middle" x="1640" y="-2625.92" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1640" y="-2610.92" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp3_dp1_start&#45;&gt;final_norm_dp1 -->
<g id="edge53" class="edge">
<title>pp3_dp1_start&#45;&gt;final_norm_dp1</title>
<path fill="none" stroke="black" d="M1558.56,-2706.92C1570.41,-2696.9 1582.3,-2686.86 1593.18,-2677.67"/>
<polygon fill="black" stroke="black" points="1595.53,-2680.26 1600.91,-2671.14 1591.02,-2674.92 1595.53,-2680.26"/>
</g>
<!-- pp1_dp2_start&#45;&gt;pp1_to_pp2_dp2 -->
<g id="edge62" class="edge">
<title>pp1_dp2_start&#45;&gt;pp1_to_pp2_dp2</title>
<path fill="none" stroke="black" d="M2341,-3315.31C2341,-3306.77 2341,-3298.08 2341,-3289.71"/>
<polygon fill="black" stroke="black" points="2344.5,-3289.69 2341,-3279.69 2337.5,-3289.69 2344.5,-3289.69"/>
</g>
<!-- pp2_dp2_start&#45;&gt;pp2_to_pp3_dp2 -->
<g id="edge64" class="edge">
<title>pp2_dp2_start&#45;&gt;pp2_to_pp3_dp2</title>
<path fill="none" stroke="black" d="M2341,-3011.15C2341,-3002.6 2341,-2993.92 2341,-2985.55"/>
<polygon fill="black" stroke="black" points="2344.5,-2985.52 2341,-2975.52 2337.5,-2985.52 2344.5,-2985.52"/>
</g>
<!-- final_norm_dp2 -->
<g id="node68" class="node">
<title>final_norm_dp2</title>
<polygon fill="lightgreen" stroke="black" points="2525.5,-2671.12 2154.5,-2671.12 2154.5,-2603.12 2525.5,-2603.12 2525.5,-2671.12"/>
<text text-anchor="middle" x="2340" y="-2655.92" font-family="Arial" font-size="14.00">Final RMSNorm DP2</text>
<text text-anchor="middle" x="2340" y="-2640.92" font-family="Arial" font-size="14.00">GPU: DP2_PP3_TP0&#45;DP2_PP3_TP15</text>
<text text-anchor="middle" x="2340" y="-2625.92" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="2340" y="-2610.92" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp3_dp2_start&#45;&gt;final_norm_dp2 -->
<g id="edge66" class="edge">
<title>pp3_dp2_start&#45;&gt;final_norm_dp2</title>
<path fill="none" stroke="black" d="M2340.51,-2706.92C2340.44,-2698.16 2340.38,-2689.39 2340.32,-2681.19"/>
<polygon fill="black" stroke="black" points="2343.82,-2681.11 2340.24,-2671.14 2336.82,-2681.16 2343.82,-2681.11"/>
</g>
<!-- pp1_dp3_start&#45;&gt;pp1_to_pp2_dp3 -->
<g id="edge75" class="edge">
<title>pp1_dp3_start&#45;&gt;pp1_to_pp2_dp3</title>
<path fill="none" stroke="black" d="M3203,-3315.31C3203,-3306.77 3203,-3298.08 3203,-3289.71"/>
<polygon fill="black" stroke="black" points="3206.5,-3289.69 3203,-3279.69 3199.5,-3289.69 3206.5,-3289.69"/>
</g>
<!-- pp2_dp3_start&#45;&gt;pp2_to_pp3_dp3 -->
<g id="edge77" class="edge">
<title>pp2_dp3_start&#45;&gt;pp2_to_pp3_dp3</title>
<path fill="none" stroke="black" d="M3203,-3011.15C3203,-3002.6 3203,-2993.92 3203,-2985.55"/>
<polygon fill="black" stroke="black" points="3206.5,-2985.52 3203,-2975.52 3199.5,-2985.52 3206.5,-2985.52"/>
</g>
<!-- final_norm_dp3 -->
<g id="node70" class="node">
<title>final_norm_dp3</title>
<polygon fill="lightgreen" stroke="black" points="3151.5,-2671.12 2780.5,-2671.12 2780.5,-2603.12 3151.5,-2603.12 3151.5,-2671.12"/>
<text text-anchor="middle" x="2966" y="-2655.92" font-family="Arial" font-size="14.00">Final RMSNorm DP3</text>
<text text-anchor="middle" x="2966" y="-2640.92" font-family="Arial" font-size="14.00">GPU: DP3_PP3_TP0&#45;DP3_PP3_TP15</text>
<text text-anchor="middle" x="2966" y="-2625.92" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="2966" y="-2610.92" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp3_dp3_start&#45;&gt;final_norm_dp3 -->
<g id="edge79" class="edge">
<title>pp3_dp3_start&#45;&gt;final_norm_dp3</title>
<path fill="none" stroke="black" d="M3086.24,-2707.12C3067.9,-2696.59 3049.51,-2686.04 3032.82,-2676.46"/>
<polygon fill="black" stroke="black" points="3034.14,-2673.19 3023.73,-2671.25 3030.66,-2679.26 3034.14,-2673.19"/>
</g>
<!-- output_proj_dp0 -->
<g id="node65" class="node">
<title>output_proj_dp0</title>
<polygon fill="lightgreen" stroke="black" points="2038,-311.12 1664,-311.12 1664,-243.12 2038,-243.12 2038,-311.12"/>
<text text-anchor="middle" x="1851" y="-295.92" font-family="Arial" font-size="14.00">Output Projection DP0</text>
<text text-anchor="middle" x="1851" y="-280.92" font-family="Arial" font-size="14.00">GPU: DP0_PP3_TP0&#45;DP0_PP3_TP15</text>
<text text-anchor="middle" x="1851" y="-265.92" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1851" y="-250.92" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- final_norm_dp0&#45;&gt;output_proj_dp0 -->
<g id="edge41" class="edge">
<title>final_norm_dp0&#45;&gt;output_proj_dp0</title>
<path fill="none" stroke="black" d="M1771.99,-347C1782.51,-337.83 1794.05,-327.77 1804.98,-318.24"/>
<polygon fill="black" stroke="black" points="1807.57,-320.63 1812.8,-311.42 1802.97,-315.35 1807.57,-320.63"/>
</g>
<!-- dp_combine -->
<g id="node72" class="node">
<title>dp_combine</title>
<ellipse fill="orange" stroke="black" cx="2144" cy="-159.04" rx="270.23" ry="48.17"/>
<text text-anchor="middle" x="2144" y="-177.84" font-family="Arial" font-size="14.00">Data Parallelism Combine</text>
<text text-anchor="middle" x="2144" y="-162.84" font-family="Arial" font-size="14.00">GPU: Output aggregation</text>
<text text-anchor="middle" x="2144" y="-147.84" font-family="Arial" font-size="14.00">Input: 4×[batch_size=32, seq_len=1024, vocab_size=51200]</text>
<text text-anchor="middle" x="2144" y="-132.84" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- output_proj_dp0&#45;&gt;dp_combine -->
<g id="edge42" class="edge">
<title>output_proj_dp0&#45;&gt;dp_combine</title>
<path fill="none" stroke="black" d="M1934.57,-243.01C1962.93,-231.78 1995.17,-219 2025.71,-206.9"/>
<polygon fill="black" stroke="black" points="2027.12,-210.11 2035.13,-203.17 2024.54,-203.6 2027.12,-210.11"/>
</g>
<!-- output_proj_dp1 -->
<g id="node67" class="node">
<title>output_proj_dp1</title>
<polygon fill="lightgreen" stroke="black" points="2312,-2422.17 1938,-2422.17 1938,-2354.17 2312,-2354.17 2312,-2422.17"/>
<text text-anchor="middle" x="2125" y="-2406.97" font-family="Arial" font-size="14.00">Output Projection DP1</text>
<text text-anchor="middle" x="2125" y="-2391.97" font-family="Arial" font-size="14.00">GPU: DP1_PP3_TP0&#45;DP1_PP3_TP15</text>
<text text-anchor="middle" x="2125" y="-2376.97" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="2125" y="-2361.97" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- final_norm_dp1&#45;&gt;output_proj_dp1 -->
<g id="edge54" class="edge">
<title>final_norm_dp1&#45;&gt;output_proj_dp1</title>
<path fill="none" stroke="black" d="M1704.91,-2603.07C1794.8,-2557.3 1956.77,-2474.82 2051.17,-2426.76"/>
<polygon fill="black" stroke="black" points="2052.77,-2429.87 2060.09,-2422.22 2049.59,-2423.63 2052.77,-2429.87"/>
</g>
<!-- output_proj_dp1&#45;&gt;dp_combine -->
<g id="edge55" class="edge">
<title>output_proj_dp1&#45;&gt;dp_combine</title>
<path fill="none" stroke="black" d="M2125,-2354.11C2125,-2294.32 2125,-2164.22 2125,-2054.48 2125,-2054.48 2125,-2054.48 2125,-380.12 2125,-324.62 2131.07,-261.53 2136.35,-217.17"/>
<polygon fill="black" stroke="black" points="2139.84,-217.51 2137.57,-207.16 2132.89,-216.66 2139.84,-217.51"/>
</g>
<!-- output_proj_dp2 -->
<g id="node69" class="node">
<title>output_proj_dp2</title>
<polygon fill="lightgreen" stroke="black" points="2527,-2250.17 2153,-2250.17 2153,-2182.17 2527,-2182.17 2527,-2250.17"/>
<text text-anchor="middle" x="2340" y="-2234.97" font-family="Arial" font-size="14.00">Output Projection DP2</text>
<text text-anchor="middle" x="2340" y="-2219.97" font-family="Arial" font-size="14.00">GPU: DP2_PP3_TP0&#45;DP2_PP3_TP15</text>
<text text-anchor="middle" x="2340" y="-2204.97" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="2340" y="-2189.97" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- final_norm_dp2&#45;&gt;output_proj_dp2 -->
<g id="edge67" class="edge">
<title>final_norm_dp2&#45;&gt;output_proj_dp2</title>
<path fill="none" stroke="black" d="M2340,-2602.89C2340,-2527.73 2340,-2344.64 2340,-2260.62"/>
<polygon fill="black" stroke="black" points="2343.5,-2260.39 2340,-2250.39 2336.5,-2260.39 2343.5,-2260.39"/>
</g>
<!-- output_proj_dp2&#45;&gt;dp_combine -->
<g id="edge68" class="edge">
<title>output_proj_dp2&#45;&gt;dp_combine</title>
<path fill="none" stroke="black" d="M2323.05,-2181.86C2297.23,-2127.94 2251,-2017.56 2251,-1918.29 2251,-1918.29 2251,-1918.29 2251,-380.12 2251,-319.18 2217.41,-257.44 2187.87,-214.92"/>
<polygon fill="black" stroke="black" points="2190.66,-212.81 2182.03,-206.68 2184.95,-216.86 2190.66,-212.81"/>
</g>
<!-- output_proj_dp3 -->
<g id="node71" class="node">
<title>output_proj_dp3</title>
<polygon fill="lightgreen" stroke="black" points="2697,-2087.48 2323,-2087.48 2323,-2019.48 2697,-2019.48 2697,-2087.48"/>
<text text-anchor="middle" x="2510" y="-2072.28" font-family="Arial" font-size="14.00">Output Projection DP3</text>
<text text-anchor="middle" x="2510" y="-2057.28" font-family="Arial" font-size="14.00">GPU: DP3_PP3_TP0&#45;DP3_PP3_TP15</text>
<text text-anchor="middle" x="2510" y="-2042.28" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="2510" y="-2027.28" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- final_norm_dp3&#45;&gt;output_proj_dp3 -->
<g id="edge80" class="edge">
<title>final_norm_dp3&#45;&gt;output_proj_dp3</title>
<path fill="none" stroke="black" d="M2939.85,-2602.76C2861.46,-2502.77 2628.57,-2205.72 2542.47,-2095.9"/>
<polygon fill="black" stroke="black" points="2544.97,-2093.41 2536.05,-2087.7 2539.46,-2097.73 2544.97,-2093.41"/>
</g>
<!-- output_proj_dp3&#45;&gt;dp_combine -->
<g id="edge81" class="edge">
<title>output_proj_dp3&#45;&gt;dp_combine</title>
<path fill="none" stroke="black" d="M2479.82,-2019.15C2440.58,-1972.23 2377,-1882.38 2377,-1792.7 2377,-1792.7 2377,-1792.7 2377,-380.12 2377,-303.99 2310.45,-246.37 2248.48,-209.23"/>
<polygon fill="black" stroke="black" points="2250.18,-206.16 2239.78,-204.12 2246.63,-212.2 2250.18,-206.16"/>
</g>
<!-- output -->
<g id="node73" class="node">
<title>output</title>
<ellipse fill="lightblue" stroke="black" cx="2144" cy="-37.48" rx="270.23" ry="37.45"/>
<text text-anchor="middle" x="2144" y="-48.78" font-family="Arial" font-size="14.00">Output</text>
<text text-anchor="middle" x="2144" y="-33.78" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="2144" y="-18.78" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- dp_combine&#45;&gt;output -->
<g id="edge82" class="edge">
<title>dp_combine&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2144,-110.78C2144,-102.34 2144,-93.54 2144,-85.11"/>
<polygon fill="black" stroke="black" points="2147.5,-85.06 2144,-75.06 2140.5,-85.06 2147.5,-85.06"/>
</g>
</g>
</svg>
