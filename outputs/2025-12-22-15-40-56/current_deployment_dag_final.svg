<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: current_deployment_dag Pages: 1 -->
<svg width="2124pt" height="3985pt"
 viewBox="0.00 0.00 2123.91 3984.91" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 3980.91)">
<title>current_deployment_dag</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-3980.91 2119.91,-3980.91 2119.91,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightblue" stroke="black" cx="1318.5" cy="-3928.82" rx="262.17" ry="48.17"/>
<text text-anchor="middle" x="1318.5" y="-3947.62" font-family="Arial" font-size="14.00">Input</text>
<text text-anchor="middle" x="1318.5" y="-3932.62" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1318.5" y="-3917.62" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1318.5" y="-3902.62" font-family="Arial" font-size="14.00">DP=2: Split batch into 2 groups of 64 sequences each</text>
</g>
<!-- dp_split -->
<g id="node2" class="node">
<title>dp_split</title>
<polygon fill="lightgreen" stroke="black" points="1590.26,-3844.74 1157.95,-3844.74 1046.74,-3708.74 1479.05,-3708.74 1590.26,-3844.74"/>
<text text-anchor="middle" x="1318.5" y="-3795.54" font-family="Arial" font-size="14.00">Data Parallelism Split</text>
<text text-anchor="middle" x="1318.5" y="-3780.54" font-family="Arial" font-size="14.00">GPU: DP0&#45;DP1</text>
<text text-anchor="middle" x="1318.5" y="-3765.54" font-family="Arial" font-size="14.00">Split batch_size=128 → 2×64</text>
<text text-anchor="middle" x="1318.5" y="-3750.54" font-family="Arial" font-size="14.00">No communication required for inference</text>
</g>
<!-- input&#45;&gt;dp_split -->
<g id="edge1" class="edge">
<title>input&#45;&gt;dp_split</title>
<path fill="none" stroke="black" d="M1318.5,-3880.34C1318.5,-3872.25 1318.5,-3863.67 1318.5,-3855.05"/>
<polygon fill="black" stroke="black" points="1322,-3854.93 1318.5,-3844.93 1315,-3854.93 1322,-3854.93"/>
</g>
<!-- embed_dp0 -->
<g id="node3" class="node">
<title>embed_dp0</title>
<polygon fill="lightgreen" stroke="black" points="1309.5,-3672.74 945.5,-3672.74 945.5,-3589.74 1309.5,-3589.74 1309.5,-3672.74"/>
<text text-anchor="middle" x="1127.5" y="-3657.54" font-family="Arial" font-size="14.00">Embedding Layer DP0</text>
<text text-anchor="middle" x="1127.5" y="-3642.54" font-family="Arial" font-size="14.00">GPU: DP0_TP0&#45;DP0_TP7</text>
<text text-anchor="middle" x="1127.5" y="-3627.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1127.5" y="-3612.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=512]</text>
<text text-anchor="middle" x="1127.5" y="-3597.54" font-family="Arial" font-size="14.00">TP=8: hidden_size=4096 → 512 per TP rank</text>
</g>
<!-- dp_split&#45;&gt;embed_dp0 -->
<g id="edge2" class="edge">
<title>dp_split&#45;&gt;embed_dp0</title>
<path fill="none" stroke="black" d="M1229.15,-3708.61C1215.77,-3698.56 1202.23,-3688.38 1189.58,-3678.88"/>
<polygon fill="black" stroke="black" points="1191.51,-3675.95 1181.41,-3672.74 1187.3,-3681.55 1191.51,-3675.95"/>
</g>
<!-- embed_dp1 -->
<g id="node4" class="node">
<title>embed_dp1</title>
<polygon fill="lightgreen" stroke="black" points="1750.5,-3672.74 1386.5,-3672.74 1386.5,-3589.74 1750.5,-3589.74 1750.5,-3672.74"/>
<text text-anchor="middle" x="1568.5" y="-3657.54" font-family="Arial" font-size="14.00">Embedding Layer DP1</text>
<text text-anchor="middle" x="1568.5" y="-3642.54" font-family="Arial" font-size="14.00">GPU: DP1_TP0&#45;DP1_TP7</text>
<text text-anchor="middle" x="1568.5" y="-3627.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1568.5" y="-3612.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=512]</text>
<text text-anchor="middle" x="1568.5" y="-3597.54" font-family="Arial" font-size="14.00">TP=8: hidden_size=4096 → 512 per TP rank</text>
</g>
<!-- dp_split&#45;&gt;embed_dp1 -->
<g id="edge37" class="edge">
<title>dp_split&#45;&gt;embed_dp1</title>
<path fill="none" stroke="black" d="M1435.45,-3708.61C1453.63,-3698.18 1472.04,-3687.61 1489.13,-3677.8"/>
<polygon fill="black" stroke="black" points="1491,-3680.76 1497.94,-3672.74 1487.52,-3674.69 1491,-3680.76"/>
</g>
<!-- hidden_up_dp0 -->
<g id="node5" class="node">
<title>hidden_up_dp0</title>
<polygon fill="lightgreen" stroke="black" points="1196,-3553.74 825,-3553.74 825,-3470.74 1196,-3470.74 1196,-3553.74"/>
<text text-anchor="middle" x="1010.5" y="-3538.54" font-family="Arial" font-size="14.00">Hidden Upscaling DP0</text>
<text text-anchor="middle" x="1010.5" y="-3523.54" font-family="Arial" font-size="14.00">GPU: DP0_TP0&#45;DP0_TP7</text>
<text text-anchor="middle" x="1010.5" y="-3508.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=512]</text>
<text text-anchor="middle" x="1010.5" y="-3493.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1010.5" y="-3478.54" font-family="Arial" font-size="14.00">TP=8: All&#45;Gather operation</text>
</g>
<!-- embed_dp0&#45;&gt;hidden_up_dp0 -->
<g id="edge3" class="edge">
<title>embed_dp0&#45;&gt;hidden_up_dp0</title>
<path fill="none" stroke="black" d="M1086.91,-3589.65C1077.65,-3580.39 1067.73,-3570.47 1058.21,-3560.95"/>
<polygon fill="black" stroke="black" points="1060.57,-3558.36 1051.02,-3553.76 1055.62,-3563.31 1060.57,-3558.36"/>
</g>
<!-- hidden_up_dp1 -->
<g id="node6" class="node">
<title>hidden_up_dp1</title>
<polygon fill="lightgreen" stroke="black" points="1813,-3553.74 1442,-3553.74 1442,-3470.74 1813,-3470.74 1813,-3553.74"/>
<text text-anchor="middle" x="1627.5" y="-3538.54" font-family="Arial" font-size="14.00">Hidden Upscaling DP1</text>
<text text-anchor="middle" x="1627.5" y="-3523.54" font-family="Arial" font-size="14.00">GPU: DP1_TP0&#45;DP1_TP7</text>
<text text-anchor="middle" x="1627.5" y="-3508.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=512]</text>
<text text-anchor="middle" x="1627.5" y="-3493.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1627.5" y="-3478.54" font-family="Arial" font-size="14.00">TP=8: All&#45;Gather operation</text>
</g>
<!-- embed_dp1&#45;&gt;hidden_up_dp1 -->
<g id="edge38" class="edge">
<title>embed_dp1&#45;&gt;hidden_up_dp1</title>
<path fill="none" stroke="black" d="M1588.97,-3589.65C1593.32,-3581.03 1597.95,-3571.83 1602.45,-3562.91"/>
<polygon fill="black" stroke="black" points="1605.69,-3564.26 1607.07,-3553.76 1599.44,-3561.11 1605.69,-3564.26"/>
</g>
<!-- pp0_dp0_start -->
<g id="node7" class="node">
<title>pp0_dp0_start</title>
<polygon fill="yellow" stroke="black" points="953.8,-3434.74 487.22,-3434.74 367.2,-3298.74 833.78,-3298.74 953.8,-3434.74"/>
<text text-anchor="middle" x="660.5" y="-3385.54" font-family="Arial" font-size="14.00">PP Stage 0 DP0</text>
<text text-anchor="middle" x="660.5" y="-3370.54" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="660.5" y="-3355.54" font-family="Arial" font-size="14.00">Layers 0&#45;7 (8 layers)</text>
<text text-anchor="middle" x="660.5" y="-3340.54" font-family="Arial" font-size="14.00">8 layers × 64 experts = 512 expert instances</text>
</g>
<!-- hidden_up_dp0&#45;&gt;pp0_dp0_start -->
<g id="edge4" class="edge">
<title>hidden_up_dp0&#45;&gt;pp0_dp0_start</title>
<path fill="none" stroke="black" d="M911.61,-3470.69C887.2,-3460.68 860.33,-3449.67 833.53,-3438.68"/>
<polygon fill="black" stroke="black" points="834.63,-3435.35 824.05,-3434.8 831.98,-3441.83 834.63,-3435.35"/>
</g>
<!-- layer0_attn_residual_dp0 -->
<g id="node19" class="node">
<title>layer0_attn_residual_dp0</title>
<polygon fill="lightcoral" stroke="black" points="1030.5,-2389.79 652.5,-2389.79 652.5,-2321.79 1030.5,-2321.79 1030.5,-2389.79"/>
<text text-anchor="middle" x="841.5" y="-2374.59" font-family="Arial" font-size="14.00">Layer 0: Attention Residual DP0</text>
<text text-anchor="middle" x="841.5" y="-2359.59" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="841.5" y="-2344.59" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096] x2</text>
<text text-anchor="middle" x="841.5" y="-2329.59" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- hidden_up_dp0&#45;&gt;layer0_attn_residual_dp0 -->
<g id="edge18" class="edge">
<title>hidden_up_dp0&#45;&gt;layer0_attn_residual_dp0</title>
<path fill="none" stroke="black" d="M1010.5,-3470.68C1010.5,-3415.98 1010.5,-3315.51 1010.5,-3229.74 1010.5,-3229.74 1010.5,-3229.74 1010.5,-2603.74 1010.5,-2518.5 941.08,-2441.08 891.22,-2396.47"/>
<polygon fill="black" stroke="black" points="893.53,-2393.84 883.71,-2389.86 888.91,-2399.1 893.53,-2393.84"/>
</g>
<!-- pp0_dp1_start -->
<g id="node8" class="node">
<title>pp0_dp1_start</title>
<polygon fill="yellow" stroke="black" points="1920.8,-3434.74 1454.22,-3434.74 1334.2,-3298.74 1800.78,-3298.74 1920.8,-3434.74"/>
<text text-anchor="middle" x="1627.5" y="-3385.54" font-family="Arial" font-size="14.00">PP Stage 0 DP1</text>
<text text-anchor="middle" x="1627.5" y="-3370.54" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1627.5" y="-3355.54" font-family="Arial" font-size="14.00">Layers 0&#45;7 (8 layers)</text>
<text text-anchor="middle" x="1627.5" y="-3340.54" font-family="Arial" font-size="14.00">8 layers × 64 experts = 512 expert instances</text>
</g>
<!-- hidden_up_dp1&#45;&gt;pp0_dp1_start -->
<g id="edge39" class="edge">
<title>hidden_up_dp1&#45;&gt;pp0_dp1_start</title>
<path fill="none" stroke="black" d="M1627.5,-3470.5C1627.5,-3462.52 1627.5,-3453.91 1627.5,-3445.18"/>
<polygon fill="black" stroke="black" points="1631,-3444.91 1627.5,-3434.91 1624,-3444.91 1631,-3444.91"/>
</g>
<!-- layer0_attn_residual_dp1 -->
<g id="node37" class="node">
<title>layer0_attn_residual_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1918.5,-2638.74 1540.5,-2638.74 1540.5,-2570.74 1918.5,-2570.74 1918.5,-2638.74"/>
<text text-anchor="middle" x="1729.5" y="-2623.54" font-family="Arial" font-size="14.00">Layer 0: Attention Residual DP1</text>
<text text-anchor="middle" x="1729.5" y="-2608.54" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1729.5" y="-2593.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096] x2</text>
<text text-anchor="middle" x="1729.5" y="-2578.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- hidden_up_dp1&#45;&gt;layer0_attn_residual_dp1 -->
<g id="edge51" class="edge">
<title>hidden_up_dp1&#45;&gt;layer0_attn_residual_dp1</title>
<path fill="none" stroke="black" d="M1813.19,-3479.19C1864.16,-3467.18 1910.61,-3452.16 1929.5,-3434.74 2000.28,-3369.47 1999.5,-3326.02 1999.5,-3229.74 1999.5,-3229.74 1999.5,-3229.74 1999.5,-2811.74 1999.5,-2728.62 1917.63,-2674.58 1844.05,-2642.79"/>
<polygon fill="black" stroke="black" points="1845.24,-2639.49 1834.66,-2638.84 1842.52,-2645.95 1845.24,-2639.49"/>
</g>
<!-- layer0_norm_dp0 -->
<g id="node9" class="node">
<title>layer0_norm_dp0</title>
<polygon fill="lightcoral" stroke="black" points="789,-3262.74 418,-3262.74 418,-3194.74 789,-3194.74 789,-3262.74"/>
<text text-anchor="middle" x="603.5" y="-3247.54" font-family="Arial" font-size="14.00">Layer 0: RMSNorm DP0</text>
<text text-anchor="middle" x="603.5" y="-3232.54" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="603.5" y="-3217.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="603.5" y="-3202.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp0_dp0_start&#45;&gt;layer0_norm_dp0 -->
<g id="edge5" class="edge">
<title>pp0_dp0_start&#45;&gt;layer0_norm_dp0</title>
<path fill="none" stroke="black" d="M632.33,-3298.54C628.54,-3289.49 624.75,-3280.43 621.21,-3271.99"/>
<polygon fill="black" stroke="black" points="624.43,-3270.63 617.34,-3262.76 617.98,-3273.33 624.43,-3270.63"/>
</g>
<!-- layer0_norm_dp1 -->
<g id="node29" class="node">
<title>layer0_norm_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1813,-3262.74 1442,-3262.74 1442,-3194.74 1813,-3194.74 1813,-3262.74"/>
<text text-anchor="middle" x="1627.5" y="-3247.54" font-family="Arial" font-size="14.00">Layer 0: RMSNorm DP1</text>
<text text-anchor="middle" x="1627.5" y="-3232.54" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1627.5" y="-3217.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1627.5" y="-3202.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp0_dp1_start&#45;&gt;layer0_norm_dp1 -->
<g id="edge40" class="edge">
<title>pp0_dp1_start&#45;&gt;layer0_norm_dp1</title>
<path fill="none" stroke="black" d="M1627.5,-3298.54C1627.5,-3289.78 1627.5,-3281.01 1627.5,-3272.81"/>
<polygon fill="black" stroke="black" points="1631,-3272.76 1627.5,-3262.76 1624,-3272.76 1631,-3272.76"/>
</g>
<!-- layer0_q_proj_dp0 -->
<g id="node10" class="node">
<title>layer0_q_proj_dp0</title>
<polygon fill="lightcoral" stroke="black" points="381,-3158.74 0,-3158.74 0,-3090.74 381,-3090.74 381,-3158.74"/>
<text text-anchor="middle" x="190.5" y="-3143.54" font-family="Arial" font-size="14.00">Layer 0: Q Projection DP0</text>
<text text-anchor="middle" x="190.5" y="-3128.54" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="190.5" y="-3113.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="190.5" y="-3098.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp0&#45;&gt;layer0_q_proj_dp0 -->
<g id="edge6" class="edge">
<title>layer0_norm_dp0&#45;&gt;layer0_q_proj_dp0</title>
<path fill="none" stroke="black" d="M469.7,-3194.69C426.44,-3184.01 378.3,-3172.12 334.34,-3161.26"/>
<polygon fill="black" stroke="black" points="334.99,-3157.82 324.44,-3158.82 333.31,-3164.62 334.99,-3157.82"/>
</g>
<!-- layer0_k_proj_dp0 -->
<g id="node11" class="node">
<title>layer0_k_proj_dp0</title>
<polygon fill="lightcoral" stroke="black" points="780,-3158.74 399,-3158.74 399,-3090.74 780,-3090.74 780,-3158.74"/>
<text text-anchor="middle" x="589.5" y="-3143.54" font-family="Arial" font-size="14.00">Layer 0: K Projection DP0</text>
<text text-anchor="middle" x="589.5" y="-3128.54" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="589.5" y="-3113.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="589.5" y="-3098.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp0&#45;&gt;layer0_k_proj_dp0 -->
<g id="edge7" class="edge">
<title>layer0_norm_dp0&#45;&gt;layer0_k_proj_dp0</title>
<path fill="none" stroke="black" d="M598.95,-3194.62C597.84,-3186.52 596.63,-3177.72 595.47,-3169.21"/>
<polygon fill="black" stroke="black" points="598.9,-3168.47 594.07,-3159.04 591.96,-3169.42 598.9,-3168.47"/>
</g>
<!-- layer0_v_proj_dp0 -->
<g id="node12" class="node">
<title>layer0_v_proj_dp0</title>
<polygon fill="lightcoral" stroke="black" points="983,-2950.74 602,-2950.74 602,-2882.74 983,-2882.74 983,-2950.74"/>
<text text-anchor="middle" x="792.5" y="-2935.54" font-family="Arial" font-size="14.00">Layer 0: V Projection DP0</text>
<text text-anchor="middle" x="792.5" y="-2920.54" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="792.5" y="-2905.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="792.5" y="-2890.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp0&#45;&gt;layer0_v_proj_dp0 -->
<g id="edge8" class="edge">
<title>layer0_norm_dp0&#45;&gt;layer0_v_proj_dp0</title>
<path fill="none" stroke="black" d="M747.77,-3194.63C763.68,-3185.45 777.92,-3173.72 788.5,-3158.74 829.71,-3100.43 817.76,-3012.79 805.21,-2960.82"/>
<polygon fill="black" stroke="black" points="808.55,-2959.76 802.71,-2950.92 801.77,-2961.47 808.55,-2959.76"/>
</g>
<!-- layer0_qk_matmul_dp0 -->
<g id="node13" class="node">
<title>layer0_qk_matmul_dp0</title>
<polygon fill="lightcoral" stroke="black" points="583.5,-3054.74 169.5,-3054.74 169.5,-2986.74 583.5,-2986.74 583.5,-3054.74"/>
<text text-anchor="middle" x="376.5" y="-3039.54" font-family="Arial" font-size="14.00">Layer 0: QK^T MatMul DP0</text>
<text text-anchor="middle" x="376.5" y="-3024.54" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="376.5" y="-3009.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, heads=32, d_k=128] x2</text>
<text text-anchor="middle" x="376.5" y="-2994.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_q_proj_dp0&#45;&gt;layer0_qk_matmul_dp0 -->
<g id="edge9" class="edge">
<title>layer0_q_proj_dp0&#45;&gt;layer0_qk_matmul_dp0</title>
<path fill="none" stroke="black" d="M250.89,-3090.62C268.85,-3080.77 288.66,-3069.91 307.14,-3059.77"/>
<polygon fill="black" stroke="black" points="309.01,-3062.74 316.1,-3054.86 305.65,-3056.6 309.01,-3062.74"/>
</g>
<!-- layer0_k_proj_dp0&#45;&gt;layer0_qk_matmul_dp0 -->
<g id="edge10" class="edge">
<title>layer0_k_proj_dp0&#45;&gt;layer0_qk_matmul_dp0</title>
<path fill="none" stroke="black" d="M520.35,-3090.62C499.41,-3080.6 476.26,-3069.51 454.77,-3059.22"/>
<polygon fill="black" stroke="black" points="456.2,-3056.03 445.67,-3054.86 453.18,-3062.34 456.2,-3056.03"/>
</g>
<!-- layer0_attn_v_matmul_dp0 -->
<g id="node17" class="node">
<title>layer0_attn_v_matmul_dp0</title>
<polygon fill="lightcoral" stroke="black" points="982,-2638.74 249,-2638.74 249,-2570.74 982,-2570.74 982,-2638.74"/>
<text text-anchor="middle" x="615.5" y="-2623.54" font-family="Arial" font-size="14.00">Layer 0: Attention V MatMul DP0</text>
<text text-anchor="middle" x="615.5" y="-2608.54" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="615.5" y="-2593.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, seq_len=1024, heads=32] x [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="615.5" y="-2578.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_v_proj_dp0&#45;&gt;layer0_attn_v_matmul_dp0 -->
<g id="edge15" class="edge">
<title>layer0_v_proj_dp0&#45;&gt;layer0_attn_v_matmul_dp0</title>
<path fill="none" stroke="black" d="M775.89,-2882.39C752.14,-2835.31 706.46,-2747.04 662.5,-2674.74 657.02,-2665.73 650.86,-2656.27 644.85,-2647.34"/>
<polygon fill="black" stroke="black" points="647.68,-2645.27 639.16,-2638.97 641.89,-2649.21 647.68,-2645.27"/>
</g>
<!-- layer0_attn_scale_dp0 -->
<g id="node14" class="node">
<title>layer0_attn_scale_dp0</title>
<polygon fill="lightcoral" stroke="black" points="583.5,-2950.74 169.5,-2950.74 169.5,-2882.74 583.5,-2882.74 583.5,-2950.74"/>
<text text-anchor="middle" x="376.5" y="-2935.54" font-family="Arial" font-size="14.00">Layer 0: Attention Scale DP0</text>
<text text-anchor="middle" x="376.5" y="-2920.54" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="376.5" y="-2905.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="376.5" y="-2890.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_qk_matmul_dp0&#45;&gt;layer0_attn_scale_dp0 -->
<g id="edge11" class="edge">
<title>layer0_qk_matmul_dp0&#45;&gt;layer0_attn_scale_dp0</title>
<path fill="none" stroke="black" d="M376.5,-2986.62C376.5,-2978.52 376.5,-2969.72 376.5,-2961.21"/>
<polygon fill="black" stroke="black" points="380,-2961.04 376.5,-2951.04 373,-2961.04 380,-2961.04"/>
</g>
<!-- layer0_attn_mask_dp0 -->
<g id="node15" class="node">
<title>layer0_attn_mask_dp0</title>
<polygon fill="lightcoral" stroke="black" points="607.5,-2846.74 193.5,-2846.74 193.5,-2778.74 607.5,-2778.74 607.5,-2846.74"/>
<text text-anchor="middle" x="400.5" y="-2831.54" font-family="Arial" font-size="14.00">Layer 0: Attention Mask DP0</text>
<text text-anchor="middle" x="400.5" y="-2816.54" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="400.5" y="-2801.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="400.5" y="-2786.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_attn_scale_dp0&#45;&gt;layer0_attn_mask_dp0 -->
<g id="edge12" class="edge">
<title>layer0_attn_scale_dp0&#45;&gt;layer0_attn_mask_dp0</title>
<path fill="none" stroke="black" d="M384.29,-2882.62C386.22,-2874.43 388.31,-2865.53 390.34,-2856.93"/>
<polygon fill="black" stroke="black" points="393.78,-2857.57 392.66,-2847.04 386.97,-2855.97 393.78,-2857.57"/>
</g>
<!-- layer0_attn_softmax_dp0 -->
<g id="node16" class="node">
<title>layer0_attn_softmax_dp0</title>
<polygon fill="lightcoral" stroke="black" points="653.5,-2742.74 239.5,-2742.74 239.5,-2674.74 653.5,-2674.74 653.5,-2742.74"/>
<text text-anchor="middle" x="446.5" y="-2727.54" font-family="Arial" font-size="14.00">Layer 0: Softmax DP0</text>
<text text-anchor="middle" x="446.5" y="-2712.54" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="446.5" y="-2697.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="446.5" y="-2682.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_attn_mask_dp0&#45;&gt;layer0_attn_softmax_dp0 -->
<g id="edge13" class="edge">
<title>layer0_attn_mask_dp0&#45;&gt;layer0_attn_softmax_dp0</title>
<path fill="none" stroke="black" d="M415.43,-2778.62C419.21,-2770.25 423.32,-2761.14 427.27,-2752.37"/>
<polygon fill="black" stroke="black" points="430.56,-2753.59 431.48,-2743.04 424.18,-2750.72 430.56,-2753.59"/>
</g>
<!-- layer0_attn_softmax_dp0&#45;&gt;layer0_attn_v_matmul_dp0 -->
<g id="edge14" class="edge">
<title>layer0_attn_softmax_dp0&#45;&gt;layer0_attn_v_matmul_dp0</title>
<path fill="none" stroke="black" d="M501.37,-2674.62C517.54,-2664.86 535.36,-2654.11 552.03,-2644.05"/>
<polygon fill="black" stroke="black" points="553.86,-2647.03 560.62,-2638.86 550.25,-2641.03 553.86,-2647.03"/>
</g>
<!-- layer0_attn_out_proj_dp0 -->
<g id="node18" class="node">
<title>layer0_attn_out_proj_dp0</title>
<polygon fill="lightcoral" stroke="black" points="892,-2531.26 521,-2531.26 521,-2463.26 892,-2463.26 892,-2531.26"/>
<text text-anchor="middle" x="706.5" y="-2516.06" font-family="Arial" font-size="14.00">Layer 0: Attention Output Projection DP0</text>
<text text-anchor="middle" x="706.5" y="-2501.06" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="706.5" y="-2486.06" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="706.5" y="-2471.06" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_v_matmul_dp0&#45;&gt;layer0_attn_out_proj_dp0 -->
<g id="edge16" class="edge">
<title>layer0_attn_v_matmul_dp0&#45;&gt;layer0_attn_out_proj_dp0</title>
<path fill="none" stroke="black" d="M644.04,-2570.66C652.6,-2560.74 662.09,-2549.74 671.04,-2539.37"/>
<polygon fill="black" stroke="black" points="673.86,-2541.45 677.75,-2531.59 668.56,-2536.88 673.86,-2541.45"/>
</g>
<!-- layer0_attn_out_proj_dp0&#45;&gt;layer0_attn_residual_dp0 -->
<g id="edge17" class="edge">
<title>layer0_attn_out_proj_dp0&#45;&gt;layer0_attn_residual_dp0</title>
<path fill="none" stroke="black" d="M738.49,-2463.21C757.6,-2443.46 782.02,-2418.23 802.29,-2397.3"/>
<polygon fill="black" stroke="black" points="804.83,-2399.71 809.27,-2390.09 799.8,-2394.84 804.83,-2399.71"/>
</g>
<!-- layer0_attn_ar_dp0 -->
<g id="node20" class="node">
<title>layer0_attn_ar_dp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="841.5" cy="-2183.79" rx="251.96" ry="37.45"/>
<text text-anchor="middle" x="841.5" y="-2195.09" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="841.5" y="-2180.09" font-family="Arial" font-size="14.00">TP Group: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="841.5" y="-2165.09" font-family="Arial" font-size="14.00">Size: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_residual_dp0&#45;&gt;layer0_attn_ar_dp0 -->
<g id="edge19" class="edge">
<title>layer0_attn_residual_dp0&#45;&gt;layer0_attn_ar_dp0</title>
<path fill="none" stroke="black" d="M841.5,-2321.6C841.5,-2295.96 841.5,-2260.14 841.5,-2231.58"/>
<polygon fill="black" stroke="black" points="845,-2231.42 841.5,-2221.42 838,-2231.42 845,-2231.42"/>
</g>
<!-- layer0_norm2_dp0 -->
<g id="node21" class="node">
<title>layer0_norm2_dp0</title>
<polygon fill="lightyellow" stroke="black" points="1201.27,-2079.79 589.19,-2079.79 431.73,-1943.79 1043.81,-1943.79 1201.27,-2079.79"/>
<text text-anchor="middle" x="816.5" y="-2030.59" font-family="Arial" font-size="14.00">Layer 0: RMSNorm 2 DP0</text>
<text text-anchor="middle" x="816.5" y="-2015.59" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="816.5" y="-2000.59" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="816.5" y="-1985.59" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_ar_dp0&#45;&gt;layer0_norm2_dp0 -->
<g id="edge20" class="edge">
<title>layer0_attn_ar_dp0&#45;&gt;layer0_norm2_dp0</title>
<path fill="none" stroke="black" d="M836.14,-2146.32C833.72,-2129.87 830.76,-2109.77 827.89,-2090.21"/>
<polygon fill="black" stroke="black" points="831.31,-2089.44 826.39,-2080.06 824.38,-2090.46 831.31,-2089.44"/>
</g>
<!-- layer0_moe_residual_dp0 -->
<g id="node28" class="node">
<title>layer0_moe_residual_dp0</title>
<polygon fill="lightcoral" stroke="black" points="1397.5,-1113.37 1019.5,-1113.37 1019.5,-1045.37 1397.5,-1045.37 1397.5,-1113.37"/>
<text text-anchor="middle" x="1208.5" y="-1098.17" font-family="Arial" font-size="14.00">Layer 0: MoE Residual DP0</text>
<text text-anchor="middle" x="1208.5" y="-1083.17" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="1208.5" y="-1068.17" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096] x2</text>
<text text-anchor="middle" x="1208.5" y="-1053.17" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_ar_dp0&#45;&gt;layer0_moe_residual_dp0 -->
<g id="edge29" class="edge">
<title>layer0_attn_ar_dp0&#45;&gt;layer0_moe_residual_dp0</title>
<path fill="none" stroke="black" d="M1007.46,-2155.57C1092.45,-2138.04 1183.62,-2112.42 1210.5,-2079.79 1278.24,-1997.53 1229.5,-1947.34 1229.5,-1840.79 1229.5,-1840.79 1229.5,-1840.79 1229.5,-1382.54 1229.5,-1290.02 1219.58,-1181.95 1213.38,-1123.4"/>
<polygon fill="black" stroke="black" points="1216.85,-1122.97 1212.3,-1113.4 1209.89,-1123.72 1216.85,-1122.97"/>
</g>
<!-- layer0_gate_dp0 -->
<g id="node22" class="node">
<title>layer0_gate_dp0</title>
<polygon fill="lightyellow" stroke="black" points="1192.68,-1907.79 594.26,-1907.79 440.32,-1771.79 1038.74,-1771.79 1192.68,-1907.79"/>
<text text-anchor="middle" x="816.5" y="-1858.59" font-family="Arial" font-size="14.00">Layer 0: MoE Gate DP0</text>
<text text-anchor="middle" x="816.5" y="-1843.59" font-family="Arial" font-size="14.00">GPU: DP0_EP0&#45;DP0_EP63</text>
<text text-anchor="middle" x="816.5" y="-1828.59" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="816.5" y="-1813.59" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, num_experts=64]</text>
</g>
<!-- layer0_norm2_dp0&#45;&gt;layer0_gate_dp0 -->
<g id="edge21" class="edge">
<title>layer0_norm2_dp0&#45;&gt;layer0_gate_dp0</title>
<path fill="none" stroke="black" d="M816.5,-1943.6C816.5,-1935.28 816.5,-1926.73 816.5,-1918.28"/>
<polygon fill="black" stroke="black" points="820,-1918.04 816.5,-1908.04 813,-1918.04 820,-1918.04"/>
</g>
<!-- layer0_route_dp0 -->
<g id="node23" class="node">
<title>layer0_route_dp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="816.5" cy="-1687.7" rx="147.16" ry="48.17"/>
<text text-anchor="middle" x="816.5" y="-1706.5" font-family="Arial" font-size="14.00">Token Routing DP0</text>
<text text-anchor="middle" x="816.5" y="-1691.5" font-family="Arial" font-size="14.00">GPU: DP0_EP0&#45;DP0_EP63</text>
<text text-anchor="middle" x="816.5" y="-1676.5" font-family="Arial" font-size="14.00">Select 2 experts per token</text>
<text text-anchor="middle" x="816.5" y="-1661.5" font-family="Arial" font-size="14.00">Load balance across 64 experts</text>
</g>
<!-- layer0_gate_dp0&#45;&gt;layer0_route_dp0 -->
<g id="edge22" class="edge">
<title>layer0_gate_dp0&#45;&gt;layer0_route_dp0</title>
<path fill="none" stroke="black" d="M816.5,-1771.65C816.5,-1763.1 816.5,-1754.42 816.5,-1746.05"/>
<polygon fill="black" stroke="black" points="820,-1746.02 816.5,-1736.02 813,-1746.02 820,-1746.02"/>
</g>
<!-- layer0_expert0_dp0 -->
<g id="node24" class="node">
<title>layer0_expert0_dp0</title>
<polygon fill="lightsteelblue" stroke="black" points="729,-1577.12 380,-1577.12 380,-1494.12 729,-1494.12 729,-1577.12"/>
<text text-anchor="middle" x="554.5" y="-1561.92" font-family="Arial" font-size="14.00">Layer 0: Expert 0 DP0</text>
<text text-anchor="middle" x="554.5" y="-1546.92" font-family="Arial" font-size="14.00">GPU: DP0_EP0</text>
<text text-anchor="middle" x="554.5" y="-1531.92" font-family="Arial" font-size="14.00">Input: [batch_size=1, seq_len=16, hidden_size=4096]</text>
<text text-anchor="middle" x="554.5" y="-1516.92" font-family="Arial" font-size="14.00">Output: [batch_size=1, seq_len=16, hidden_size=4096]</text>
<text text-anchor="middle" x="554.5" y="-1501.92" font-family="Arial" font-size="14.00">Up&#45;proj → Activation → Down&#45;proj</text>
</g>
<!-- layer0_route_dp0&#45;&gt;layer0_expert0_dp0 -->
<g id="edge23" class="edge">
<title>layer0_route_dp0&#45;&gt;layer0_expert0_dp0</title>
<path fill="none" stroke="black" d="M744.91,-1645.69C710.69,-1626.09 669.61,-1602.56 634.38,-1582.37"/>
<polygon fill="black" stroke="black" points="635.97,-1579.25 625.55,-1577.32 632.49,-1585.33 635.97,-1579.25"/>
</g>
<!-- layer0_expert1_dp0 -->
<g id="node25" class="node">
<title>layer0_expert1_dp0</title>
<polygon fill="lightsteelblue" stroke="black" points="1096,-1577.12 747,-1577.12 747,-1494.12 1096,-1494.12 1096,-1577.12"/>
<text text-anchor="middle" x="921.5" y="-1561.92" font-family="Arial" font-size="14.00">Layer 0: Expert 1 DP0</text>
<text text-anchor="middle" x="921.5" y="-1546.92" font-family="Arial" font-size="14.00">GPU: DP0_EP1</text>
<text text-anchor="middle" x="921.5" y="-1531.92" font-family="Arial" font-size="14.00">Input: [batch_size=1, seq_len=16, hidden_size=4096]</text>
<text text-anchor="middle" x="921.5" y="-1516.92" font-family="Arial" font-size="14.00">Output: [batch_size=1, seq_len=16, hidden_size=4096]</text>
<text text-anchor="middle" x="921.5" y="-1501.92" font-family="Arial" font-size="14.00">Up&#45;proj → Activation → Down&#45;proj</text>
</g>
<!-- layer0_route_dp0&#45;&gt;layer0_expert1_dp0 -->
<g id="edge24" class="edge">
<title>layer0_route_dp0&#45;&gt;layer0_expert1_dp0</title>
<path fill="none" stroke="black" d="M848.86,-1640.45C860.98,-1623.13 874.78,-1603.4 887.08,-1585.82"/>
<polygon fill="black" stroke="black" points="890.12,-1587.58 892.98,-1577.38 884.38,-1583.57 890.12,-1587.58"/>
</g>
<!-- layer0_ep_a2a_dp0 -->
<g id="node26" class="node">
<title>layer0_ep_a2a_dp0</title>
<ellipse fill="orange" stroke="black" cx="816.5" cy="-1383.54" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="816.5" y="-1402.34" font-family="Arial" font-size="14.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="816.5" y="-1387.34" font-family="Arial" font-size="14.00">EP Group: DP0_EP0&#45;DP0_EP63</text>
<text text-anchor="middle" x="816.5" y="-1372.34" font-family="Arial" font-size="14.00">Token dispatch/combine</text>
<text text-anchor="middle" x="816.5" y="-1357.34" font-family="Arial" font-size="14.00">Size: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_expert0_dp0&#45;&gt;layer0_ep_a2a_dp0 -->
<g id="edge25" class="edge">
<title>layer0_expert0_dp0&#45;&gt;layer0_ep_a2a_dp0</title>
<path fill="none" stroke="black" d="M625.4,-1494C657.4,-1475.68 695.5,-1453.85 729.23,-1434.52"/>
<polygon fill="black" stroke="black" points="731.23,-1437.42 738.17,-1429.41 727.75,-1431.34 731.23,-1437.42"/>
</g>
<!-- layer0_expert1_dp0&#45;&gt;layer0_ep_a2a_dp0 -->
<g id="edge26" class="edge">
<title>layer0_expert1_dp0&#45;&gt;layer0_ep_a2a_dp0</title>
<path fill="none" stroke="black" d="M893.09,-1494C881.45,-1477.37 867.79,-1457.85 855.26,-1439.94"/>
<polygon fill="black" stroke="black" points="857.81,-1437.48 849.21,-1431.29 852.08,-1441.49 857.81,-1437.48"/>
</g>
<!-- layer0_expert_combine_dp0 -->
<g id="node27" class="node">
<title>layer0_expert_combine_dp0</title>
<polygon fill="lightyellow" stroke="black" points="1201.27,-1299.45 589.19,-1299.45 431.73,-1163.45 1043.81,-1163.45 1201.27,-1299.45"/>
<text text-anchor="middle" x="816.5" y="-1250.25" font-family="Arial" font-size="14.00">Expert Combine DP0</text>
<text text-anchor="middle" x="816.5" y="-1235.25" font-family="Arial" font-size="14.00">GPU: DP0_EP0&#45;DP0_EP63</text>
<text text-anchor="middle" x="816.5" y="-1220.25" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="816.5" y="-1205.25" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_ep_a2a_dp0&#45;&gt;layer0_expert_combine_dp0 -->
<g id="edge27" class="edge">
<title>layer0_ep_a2a_dp0&#45;&gt;layer0_expert_combine_dp0</title>
<path fill="none" stroke="black" d="M816.5,-1335.05C816.5,-1326.96 816.5,-1318.38 816.5,-1309.76"/>
<polygon fill="black" stroke="black" points="820,-1309.65 816.5,-1299.65 813,-1309.65 820,-1309.65"/>
</g>
<!-- layer0_expert_combine_dp0&#45;&gt;layer0_moe_residual_dp0 -->
<g id="edge28" class="edge">
<title>layer0_expert_combine_dp0&#45;&gt;layer0_moe_residual_dp0</title>
<path fill="none" stroke="black" d="M991.58,-1163.42C1033.15,-1147.5 1076,-1131.1 1112.51,-1117.12"/>
<polygon fill="black" stroke="black" points="1114.06,-1120.28 1122.15,-1113.43 1111.56,-1113.74 1114.06,-1120.28"/>
</g>
<!-- layers1to7_dp0 -->
<g id="node47" class="node">
<title>layers1to7_dp0</title>
<polygon fill="lightgray" stroke="black" points="1296.5,-961.29 1120.5,-961.29 1120.5,-893.29 1296.5,-893.29 1296.5,-961.29"/>
<text text-anchor="middle" x="1208.5" y="-946.09" font-family="Arial" font-size="14.00">Layers 1&#45;7 DP0</text>
<text text-anchor="middle" x="1208.5" y="-931.09" font-family="Arial" font-size="14.00">Same structure as Layer 0</text>
<text text-anchor="middle" x="1208.5" y="-916.09" font-family="Arial" font-size="14.00">8 layers per stage</text>
<text text-anchor="middle" x="1208.5" y="-901.09" font-family="Arial" font-size="14.00">TP=8, EP=64 distribution</text>
</g>
<!-- layer0_moe_residual_dp0&#45;&gt;layers1to7_dp0 -->
<g id="edge30" class="edge">
<title>layer0_moe_residual_dp0&#45;&gt;layers1to7_dp0</title>
<path fill="none" stroke="black" d="M1208.5,-1045.06C1208.5,-1023.4 1208.5,-994.93 1208.5,-971.52"/>
<polygon fill="black" stroke="black" points="1212,-971.5 1208.5,-961.5 1205,-971.5 1212,-971.5"/>
</g>
<!-- layer0_q_proj_dp1 -->
<g id="node30" class="node">
<title>layer0_q_proj_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1419,-3158.74 1038,-3158.74 1038,-3090.74 1419,-3090.74 1419,-3158.74"/>
<text text-anchor="middle" x="1228.5" y="-3143.54" font-family="Arial" font-size="14.00">Layer 0: Q Projection DP1</text>
<text text-anchor="middle" x="1228.5" y="-3128.54" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1228.5" y="-3113.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1228.5" y="-3098.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp1&#45;&gt;layer0_q_proj_dp1 -->
<g id="edge41" class="edge">
<title>layer0_norm_dp1&#45;&gt;layer0_q_proj_dp1</title>
<path fill="none" stroke="black" d="M1498.23,-3194.69C1456.53,-3184.03 1410.13,-3172.17 1367.73,-3161.33"/>
<polygon fill="black" stroke="black" points="1368.46,-3157.91 1357.9,-3158.82 1366.73,-3164.69 1368.46,-3157.91"/>
</g>
<!-- layer0_k_proj_dp1 -->
<g id="node31" class="node">
<title>layer0_k_proj_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1818,-3158.74 1437,-3158.74 1437,-3090.74 1818,-3090.74 1818,-3158.74"/>
<text text-anchor="middle" x="1627.5" y="-3143.54" font-family="Arial" font-size="14.00">Layer 0: K Projection DP1</text>
<text text-anchor="middle" x="1627.5" y="-3128.54" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1627.5" y="-3113.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1627.5" y="-3098.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp1&#45;&gt;layer0_k_proj_dp1 -->
<g id="edge42" class="edge">
<title>layer0_norm_dp1&#45;&gt;layer0_k_proj_dp1</title>
<path fill="none" stroke="black" d="M1627.5,-3194.62C1627.5,-3186.52 1627.5,-3177.72 1627.5,-3169.21"/>
<polygon fill="black" stroke="black" points="1631,-3169.04 1627.5,-3159.04 1624,-3169.04 1631,-3169.04"/>
</g>
<!-- layer0_v_proj_dp1 -->
<g id="node32" class="node">
<title>layer0_v_proj_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1972,-3054.74 1591,-3054.74 1591,-2986.74 1972,-2986.74 1972,-3054.74"/>
<text text-anchor="middle" x="1781.5" y="-3039.54" font-family="Arial" font-size="14.00">Layer 0: V Projection DP1</text>
<text text-anchor="middle" x="1781.5" y="-3024.54" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1781.5" y="-3009.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1781.5" y="-2994.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp1&#45;&gt;layer0_v_proj_dp1 -->
<g id="edge43" class="edge">
<title>layer0_norm_dp1&#45;&gt;layer0_v_proj_dp1</title>
<path fill="none" stroke="black" d="M1786.88,-3194.66C1802.71,-3185.44 1816.84,-3173.69 1827.5,-3158.74 1847.76,-3130.32 1832.42,-3092.33 1814.18,-3063.57"/>
<polygon fill="black" stroke="black" points="1816.92,-3061.35 1808.47,-3054.96 1811.08,-3065.23 1816.92,-3061.35"/>
</g>
<!-- layer0_qk_matmul_dp1 -->
<g id="node33" class="node">
<title>layer0_qk_matmul_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1572.5,-3054.74 1158.5,-3054.74 1158.5,-2986.74 1572.5,-2986.74 1572.5,-3054.74"/>
<text text-anchor="middle" x="1365.5" y="-3039.54" font-family="Arial" font-size="14.00">Layer 0: QK^T MatMul DP1</text>
<text text-anchor="middle" x="1365.5" y="-3024.54" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1365.5" y="-3009.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, heads=32, d_k=128] x2</text>
<text text-anchor="middle" x="1365.5" y="-2994.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_q_proj_dp1&#45;&gt;layer0_qk_matmul_dp1 -->
<g id="edge44" class="edge">
<title>layer0_q_proj_dp1&#45;&gt;layer0_qk_matmul_dp1</title>
<path fill="none" stroke="black" d="M1272.98,-3090.62C1285.66,-3081.18 1299.6,-3070.8 1312.73,-3061.03"/>
<polygon fill="black" stroke="black" points="1314.84,-3063.82 1320.77,-3055.04 1310.66,-3058.2 1314.84,-3063.82"/>
</g>
<!-- layer0_k_proj_dp1&#45;&gt;layer0_qk_matmul_dp1 -->
<g id="edge45" class="edge">
<title>layer0_k_proj_dp1&#45;&gt;layer0_qk_matmul_dp1</title>
<path fill="none" stroke="black" d="M1542.44,-3090.62C1516.11,-3080.37 1486.94,-3069.02 1460.01,-3058.53"/>
<polygon fill="black" stroke="black" points="1461.17,-3055.23 1450.59,-3054.86 1458.63,-3061.75 1461.17,-3055.23"/>
</g>
<!-- layer0_attn_v_matmul_dp1 -->
<g id="node35" class="node">
<title>layer0_attn_v_matmul_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1971,-2846.74 1238,-2846.74 1238,-2778.74 1971,-2778.74 1971,-2846.74"/>
<text text-anchor="middle" x="1604.5" y="-2831.54" font-family="Arial" font-size="14.00">Layer 0: Attention V MatMul DP1</text>
<text text-anchor="middle" x="1604.5" y="-2816.54" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1604.5" y="-2801.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, seq_len=1024, heads=32] x [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="1604.5" y="-2786.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_v_proj_dp1&#45;&gt;layer0_attn_v_matmul_dp1 -->
<g id="edge48" class="edge">
<title>layer0_v_proj_dp1&#45;&gt;layer0_attn_v_matmul_dp1</title>
<path fill="none" stroke="black" d="M1753.06,-2986.64C1722.23,-2950.75 1672.97,-2893.43 1639.71,-2854.72"/>
<polygon fill="black" stroke="black" points="1642.04,-2852.06 1632.87,-2846.75 1636.73,-2856.62 1642.04,-2852.06"/>
</g>
<!-- layer0_attn_softmax_dp1 -->
<g id="node34" class="node">
<title>layer0_attn_softmax_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1618.5,-2950.74 1204.5,-2950.74 1204.5,-2882.74 1618.5,-2882.74 1618.5,-2950.74"/>
<text text-anchor="middle" x="1411.5" y="-2935.54" font-family="Arial" font-size="14.00">Layer 0: Softmax DP1</text>
<text text-anchor="middle" x="1411.5" y="-2920.54" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1411.5" y="-2905.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="1411.5" y="-2890.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_qk_matmul_dp1&#45;&gt;layer0_attn_softmax_dp1 -->
<g id="edge46" class="edge">
<title>layer0_qk_matmul_dp1&#45;&gt;layer0_attn_softmax_dp1</title>
<path fill="none" stroke="black" d="M1380.43,-2986.62C1384.21,-2978.25 1388.32,-2969.14 1392.27,-2960.37"/>
<polygon fill="black" stroke="black" points="1395.56,-2961.59 1396.48,-2951.04 1389.18,-2958.72 1395.56,-2961.59"/>
</g>
<!-- layer0_attn_softmax_dp1&#45;&gt;layer0_attn_v_matmul_dp1 -->
<g id="edge47" class="edge">
<title>layer0_attn_softmax_dp1&#45;&gt;layer0_attn_v_matmul_dp1</title>
<path fill="none" stroke="black" d="M1474.16,-2882.62C1492.88,-2872.73 1513.54,-2861.81 1532.8,-2851.63"/>
<polygon fill="black" stroke="black" points="1534.62,-2854.63 1541.82,-2846.86 1531.35,-2848.44 1534.62,-2854.63"/>
</g>
<!-- layer0_attn_out_proj_dp1 -->
<g id="node36" class="node">
<title>layer0_attn_out_proj_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1881,-2742.74 1510,-2742.74 1510,-2674.74 1881,-2674.74 1881,-2742.74"/>
<text text-anchor="middle" x="1695.5" y="-2727.54" font-family="Arial" font-size="14.00">Layer 0: Attention Output Projection DP1</text>
<text text-anchor="middle" x="1695.5" y="-2712.54" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1695.5" y="-2697.54" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="1695.5" y="-2682.54" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_v_matmul_dp1&#45;&gt;layer0_attn_out_proj_dp1 -->
<g id="edge49" class="edge">
<title>layer0_attn_v_matmul_dp1&#45;&gt;layer0_attn_out_proj_dp1</title>
<path fill="none" stroke="black" d="M1634.05,-2778.62C1641.99,-2769.72 1650.68,-2759.97 1658.96,-2750.7"/>
<polygon fill="black" stroke="black" points="1661.75,-2752.83 1665.79,-2743.04 1656.52,-2748.17 1661.75,-2752.83"/>
</g>
<!-- layer0_attn_out_proj_dp1&#45;&gt;layer0_attn_residual_dp1 -->
<g id="edge50" class="edge">
<title>layer0_attn_out_proj_dp1&#45;&gt;layer0_attn_residual_dp1</title>
<path fill="none" stroke="black" d="M1706.54,-2674.62C1709.3,-2666.34 1712.3,-2657.33 1715.2,-2648.65"/>
<polygon fill="black" stroke="black" points="1718.56,-2649.63 1718.4,-2639.04 1711.92,-2647.42 1718.56,-2649.63"/>
</g>
<!-- layer0_attn_ar_dp1 -->
<g id="node38" class="node">
<title>layer0_attn_ar_dp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1729.5" cy="-2497.26" rx="251.96" ry="37.45"/>
<text text-anchor="middle" x="1729.5" y="-2508.56" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1729.5" y="-2493.56" font-family="Arial" font-size="14.00">TP Group: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1729.5" y="-2478.56" font-family="Arial" font-size="14.00">Size: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_residual_dp1&#45;&gt;layer0_attn_ar_dp1 -->
<g id="edge52" class="edge">
<title>layer0_attn_residual_dp1&#45;&gt;layer0_attn_ar_dp1</title>
<path fill="none" stroke="black" d="M1729.5,-2570.66C1729.5,-2562.49 1729.5,-2553.59 1729.5,-2544.92"/>
<polygon fill="black" stroke="black" points="1733,-2544.9 1729.5,-2534.9 1726,-2544.9 1733,-2544.9"/>
</g>
<!-- layer0_norm2_dp1 -->
<g id="node39" class="node">
<title>layer0_norm2_dp1</title>
<polygon fill="lightyellow" stroke="black" points="2069.27,-2423.79 1457.19,-2423.79 1299.73,-2287.79 1911.81,-2287.79 2069.27,-2423.79"/>
<text text-anchor="middle" x="1684.5" y="-2374.59" font-family="Arial" font-size="14.00">Layer 0: RMSNorm 2 DP1</text>
<text text-anchor="middle" x="1684.5" y="-2359.59" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1684.5" y="-2344.59" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1684.5" y="-2329.59" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_ar_dp1&#45;&gt;layer0_norm2_dp1 -->
<g id="edge53" class="edge">
<title>layer0_attn_ar_dp1&#45;&gt;layer0_norm2_dp1</title>
<path fill="none" stroke="black" d="M1717.68,-2459.62C1715.08,-2451.56 1712.23,-2442.73 1709.33,-2433.74"/>
<polygon fill="black" stroke="black" points="1712.57,-2432.39 1706.17,-2423.95 1705.91,-2434.54 1712.57,-2432.39"/>
</g>
<!-- layer0_moe_residual_dp1 -->
<g id="node46" class="node">
<title>layer0_moe_residual_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1894.5,-1417.54 1516.5,-1417.54 1516.5,-1349.54 1894.5,-1349.54 1894.5,-1417.54"/>
<text text-anchor="middle" x="1705.5" y="-1402.34" font-family="Arial" font-size="14.00">Layer 0: MoE Residual DP1</text>
<text text-anchor="middle" x="1705.5" y="-1387.34" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1705.5" y="-1372.34" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096] x2</text>
<text text-anchor="middle" x="1705.5" y="-1357.34" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_ar_dp1&#45;&gt;layer0_moe_residual_dp1 -->
<g id="edge62" class="edge">
<title>layer0_attn_ar_dp1&#45;&gt;layer0_moe_residual_dp1</title>
<path fill="none" stroke="black" d="M1932.83,-2475C1997.4,-2463.93 2057.52,-2447.57 2078.5,-2423.79 2148.98,-2343.86 2097.5,-2291.34 2097.5,-2184.79 2097.5,-2184.79 2097.5,-2184.79 2097.5,-1686.7 2097.5,-1588.97 2142.88,-1541.16 2078.5,-1467.62 2054.16,-1439.82 1980.4,-1420.49 1904.83,-1407.51"/>
<polygon fill="black" stroke="black" points="1905.09,-1404 1894.64,-1405.8 1903.93,-1410.91 1905.09,-1404"/>
</g>
<!-- layer0_gate_dp1 -->
<g id="node40" class="node">
<title>layer0_gate_dp1</title>
<polygon fill="lightyellow" stroke="black" points="2060.68,-2251.79 1462.26,-2251.79 1308.32,-2115.79 1906.74,-2115.79 2060.68,-2251.79"/>
<text text-anchor="middle" x="1684.5" y="-2202.59" font-family="Arial" font-size="14.00">Layer 0: MoE Gate DP1</text>
<text text-anchor="middle" x="1684.5" y="-2187.59" font-family="Arial" font-size="14.00">GPU: DP1_EP0&#45;DP1_EP63</text>
<text text-anchor="middle" x="1684.5" y="-2172.59" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1684.5" y="-2157.59" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, num_experts=64]</text>
</g>
<!-- layer0_norm2_dp1&#45;&gt;layer0_gate_dp1 -->
<g id="edge54" class="edge">
<title>layer0_norm2_dp1&#45;&gt;layer0_gate_dp1</title>
<path fill="none" stroke="black" d="M1684.5,-2287.6C1684.5,-2279.28 1684.5,-2270.73 1684.5,-2262.28"/>
<polygon fill="black" stroke="black" points="1688,-2262.04 1684.5,-2252.04 1681,-2262.04 1688,-2262.04"/>
</g>
<!-- layer0_route_dp1 -->
<g id="node41" class="node">
<title>layer0_route_dp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1684.5" cy="-2011.79" rx="147.16" ry="48.17"/>
<text text-anchor="middle" x="1684.5" y="-2030.59" font-family="Arial" font-size="14.00">Token Routing DP1</text>
<text text-anchor="middle" x="1684.5" y="-2015.59" font-family="Arial" font-size="14.00">GPU: DP1_EP0&#45;DP1_EP63</text>
<text text-anchor="middle" x="1684.5" y="-2000.59" font-family="Arial" font-size="14.00">Select 2 experts per token</text>
<text text-anchor="middle" x="1684.5" y="-1985.59" font-family="Arial" font-size="14.00">Load balance across 64 experts</text>
</g>
<!-- layer0_gate_dp1&#45;&gt;layer0_route_dp1 -->
<g id="edge55" class="edge">
<title>layer0_gate_dp1&#45;&gt;layer0_route_dp1</title>
<path fill="none" stroke="black" d="M1684.5,-2115.6C1684.5,-2100.66 1684.5,-2084.96 1684.5,-2070.44"/>
<polygon fill="black" stroke="black" points="1688,-2070.11 1684.5,-2060.11 1681,-2070.11 1688,-2070.11"/>
</g>
<!-- layer0_expert0_dp1 -->
<g id="node42" class="node">
<title>layer0_expert0_dp1</title>
<polygon fill="lightsteelblue" stroke="black" points="1655,-1881.29 1306,-1881.29 1306,-1798.29 1655,-1798.29 1655,-1881.29"/>
<text text-anchor="middle" x="1480.5" y="-1866.09" font-family="Arial" font-size="14.00">Layer 0: Expert 0 DP1</text>
<text text-anchor="middle" x="1480.5" y="-1851.09" font-family="Arial" font-size="14.00">GPU: DP1_EP0</text>
<text text-anchor="middle" x="1480.5" y="-1836.09" font-family="Arial" font-size="14.00">Input: [batch_size=1, seq_len=16, hidden_size=4096]</text>
<text text-anchor="middle" x="1480.5" y="-1821.09" font-family="Arial" font-size="14.00">Output: [batch_size=1, seq_len=16, hidden_size=4096]</text>
<text text-anchor="middle" x="1480.5" y="-1806.09" font-family="Arial" font-size="14.00">Up&#45;proj → Activation → Down&#45;proj</text>
</g>
<!-- layer0_route_dp1&#45;&gt;layer0_expert0_dp1 -->
<g id="edge56" class="edge">
<title>layer0_route_dp1&#45;&gt;layer0_expert0_dp1</title>
<path fill="none" stroke="black" d="M1631.7,-1966.79C1602.66,-1942.58 1566.61,-1912.55 1537.01,-1887.87"/>
<polygon fill="black" stroke="black" points="1539.15,-1885.11 1529.23,-1881.4 1534.67,-1890.49 1539.15,-1885.11"/>
</g>
<!-- layer0_expert1_dp1 -->
<g id="node43" class="node">
<title>layer0_expert1_dp1</title>
<polygon fill="lightsteelblue" stroke="black" points="2022,-1881.29 1673,-1881.29 1673,-1798.29 2022,-1798.29 2022,-1881.29"/>
<text text-anchor="middle" x="1847.5" y="-1866.09" font-family="Arial" font-size="14.00">Layer 0: Expert 1 DP1</text>
<text text-anchor="middle" x="1847.5" y="-1851.09" font-family="Arial" font-size="14.00">GPU: DP1_EP1</text>
<text text-anchor="middle" x="1847.5" y="-1836.09" font-family="Arial" font-size="14.00">Input: [batch_size=1, seq_len=16, hidden_size=4096]</text>
<text text-anchor="middle" x="1847.5" y="-1821.09" font-family="Arial" font-size="14.00">Output: [batch_size=1, seq_len=16, hidden_size=4096]</text>
<text text-anchor="middle" x="1847.5" y="-1806.09" font-family="Arial" font-size="14.00">Up&#45;proj → Activation → Down&#45;proj</text>
</g>
<!-- layer0_route_dp1&#45;&gt;layer0_expert1_dp1 -->
<g id="edge57" class="edge">
<title>layer0_route_dp1&#45;&gt;layer0_expert1_dp1</title>
<path fill="none" stroke="black" d="M1727.75,-1965.68C1750.49,-1941.96 1778.36,-1912.89 1801.49,-1888.77"/>
<polygon fill="black" stroke="black" points="1804.11,-1891.09 1808.51,-1881.45 1799.06,-1886.25 1804.11,-1891.09"/>
</g>
<!-- layer0_ep_a2a_dp1 -->
<g id="node44" class="node">
<title>layer0_ep_a2a_dp1</title>
<ellipse fill="orange" stroke="black" cx="1684.5" cy="-1687.7" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1684.5" y="-1706.5" font-family="Arial" font-size="14.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="1684.5" y="-1691.5" font-family="Arial" font-size="14.00">EP Group: DP1_EP0&#45;DP1_EP63</text>
<text text-anchor="middle" x="1684.5" y="-1676.5" font-family="Arial" font-size="14.00">Token dispatch/combine</text>
<text text-anchor="middle" x="1684.5" y="-1661.5" font-family="Arial" font-size="14.00">Size: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_expert0_dp1&#45;&gt;layer0_ep_a2a_dp1 -->
<g id="edge58" class="edge">
<title>layer0_expert0_dp1&#45;&gt;layer0_ep_a2a_dp1</title>
<path fill="none" stroke="black" d="M1535.71,-1798.17C1559.88,-1780.39 1588.52,-1759.31 1614.19,-1740.43"/>
<polygon fill="black" stroke="black" points="1616.43,-1743.13 1622.41,-1734.38 1612.28,-1737.49 1616.43,-1743.13"/>
</g>
<!-- layer0_expert1_dp1&#45;&gt;layer0_ep_a2a_dp1 -->
<g id="edge59" class="edge">
<title>layer0_expert1_dp1&#45;&gt;layer0_ep_a2a_dp1</title>
<path fill="none" stroke="black" d="M1803.39,-1798.17C1784.58,-1780.85 1762.38,-1760.41 1742.28,-1741.9"/>
<polygon fill="black" stroke="black" points="1744.42,-1739.12 1734.69,-1734.92 1739.68,-1744.27 1744.42,-1739.12"/>
</g>
<!-- layer0_expert_combine_dp1 -->
<g id="node45" class="node">
<title>layer0_expert_combine_dp1</title>
<polygon fill="lightyellow" stroke="black" points="2069.27,-1603.62 1457.19,-1603.62 1299.73,-1467.62 1911.81,-1467.62 2069.27,-1603.62"/>
<text text-anchor="middle" x="1684.5" y="-1554.42" font-family="Arial" font-size="14.00">Expert Combine DP1</text>
<text text-anchor="middle" x="1684.5" y="-1539.42" font-family="Arial" font-size="14.00">GPU: DP1_EP0&#45;DP1_EP63</text>
<text text-anchor="middle" x="1684.5" y="-1524.42" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1684.5" y="-1509.42" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_ep_a2a_dp1&#45;&gt;layer0_expert_combine_dp1 -->
<g id="edge60" class="edge">
<title>layer0_ep_a2a_dp1&#45;&gt;layer0_expert_combine_dp1</title>
<path fill="none" stroke="black" d="M1684.5,-1639.22C1684.5,-1631.13 1684.5,-1622.55 1684.5,-1613.93"/>
<polygon fill="black" stroke="black" points="1688,-1613.81 1684.5,-1603.81 1681,-1613.81 1688,-1613.81"/>
</g>
<!-- layer0_expert_combine_dp1&#45;&gt;layer0_moe_residual_dp1 -->
<g id="edge61" class="edge">
<title>layer0_expert_combine_dp1&#45;&gt;layer0_moe_residual_dp1</title>
<path fill="none" stroke="black" d="M1693.89,-1467.48C1695.79,-1453.94 1697.73,-1440.06 1699.47,-1427.62"/>
<polygon fill="black" stroke="black" points="1702.96,-1427.93 1700.88,-1417.55 1696.03,-1426.96 1702.96,-1427.93"/>
</g>
<!-- layers1to7_dp1 -->
<g id="node48" class="node">
<title>layers1to7_dp1</title>
<polygon fill="lightgray" stroke="black" points="1793.5,-1265.45 1617.5,-1265.45 1617.5,-1197.45 1793.5,-1197.45 1793.5,-1265.45"/>
<text text-anchor="middle" x="1705.5" y="-1250.25" font-family="Arial" font-size="14.00">Layers 1&#45;7 DP1</text>
<text text-anchor="middle" x="1705.5" y="-1235.25" font-family="Arial" font-size="14.00">Same structure as Layer 0</text>
<text text-anchor="middle" x="1705.5" y="-1220.25" font-family="Arial" font-size="14.00">8 layers per stage</text>
<text text-anchor="middle" x="1705.5" y="-1205.25" font-family="Arial" font-size="14.00">TP=8, EP=64 distribution</text>
</g>
<!-- layer0_moe_residual_dp1&#45;&gt;layers1to7_dp1 -->
<g id="edge63" class="edge">
<title>layer0_moe_residual_dp1&#45;&gt;layers1to7_dp1</title>
<path fill="none" stroke="black" d="M1705.5,-1349.23C1705.5,-1327.56 1705.5,-1299.09 1705.5,-1275.69"/>
<polygon fill="black" stroke="black" points="1709,-1275.67 1705.5,-1265.67 1702,-1275.67 1709,-1275.67"/>
</g>
<!-- pp0_to_pp1_dp0 -->
<g id="node49" class="node">
<title>pp0_to_pp1_dp0</title>
<ellipse fill="orange" stroke="black" cx="1208.5" cy="-775.2" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1208.5" y="-794" font-family="Arial" font-size="14.00">Pipeline Transfer DP0</text>
<text text-anchor="middle" x="1208.5" y="-779" font-family="Arial" font-size="14.00">PP0 → PP1</text>
<text text-anchor="middle" x="1208.5" y="-764" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="1208.5" y="-749" font-family="Arial" font-size="14.00">Size: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layers1to7_dp0&#45;&gt;pp0_to_pp1_dp0 -->
<g id="edge31" class="edge">
<title>layers1to7_dp0&#45;&gt;pp0_to_pp1_dp0</title>
<path fill="none" stroke="black" d="M1208.5,-892.98C1208.5,-875.47 1208.5,-853.52 1208.5,-833.38"/>
<polygon fill="black" stroke="black" points="1212,-833.37 1208.5,-823.37 1205,-833.37 1212,-833.37"/>
</g>
<!-- pp0_to_pp1_dp1 -->
<g id="node50" class="node">
<title>pp0_to_pp1_dp1</title>
<ellipse fill="orange" stroke="black" cx="1705.5" cy="-1079.37" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1705.5" y="-1098.17" font-family="Arial" font-size="14.00">Pipeline Transfer DP1</text>
<text text-anchor="middle" x="1705.5" y="-1083.17" font-family="Arial" font-size="14.00">PP0 → PP1</text>
<text text-anchor="middle" x="1705.5" y="-1068.17" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="1705.5" y="-1053.17" font-family="Arial" font-size="14.00">Size: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layers1to7_dp1&#45;&gt;pp0_to_pp1_dp1 -->
<g id="edge64" class="edge">
<title>layers1to7_dp1&#45;&gt;pp0_to_pp1_dp1</title>
<path fill="none" stroke="black" d="M1705.5,-1197.14C1705.5,-1179.64 1705.5,-1157.68 1705.5,-1137.55"/>
<polygon fill="black" stroke="black" points="1709,-1137.53 1705.5,-1127.53 1702,-1137.53 1709,-1137.53"/>
</g>
<!-- pp1_dp0_start -->
<g id="node51" class="node">
<title>pp1_dp0_start</title>
<polygon fill="yellow" stroke="black" points="1501.8,-691.12 1035.22,-691.12 915.2,-555.12 1381.78,-555.12 1501.8,-691.12"/>
<text text-anchor="middle" x="1208.5" y="-641.92" font-family="Arial" font-size="14.00">PP Stage 1 DP0</text>
<text text-anchor="middle" x="1208.5" y="-626.92" font-family="Arial" font-size="14.00">GPU: DP0_PP1_TP0&#45;DP0_PP1_TP7</text>
<text text-anchor="middle" x="1208.5" y="-611.92" font-family="Arial" font-size="14.00">Layers 8&#45;15 (8 layers)</text>
<text text-anchor="middle" x="1208.5" y="-596.92" font-family="Arial" font-size="14.00">8 layers × 64 experts = 512 expert instances</text>
</g>
<!-- pp0_to_pp1_dp0&#45;&gt;pp1_dp0_start -->
<g id="edge32" class="edge">
<title>pp0_to_pp1_dp0&#45;&gt;pp1_dp0_start</title>
<path fill="none" stroke="black" d="M1208.5,-726.72C1208.5,-718.63 1208.5,-710.05 1208.5,-701.43"/>
<polygon fill="black" stroke="black" points="1212,-701.31 1208.5,-691.31 1205,-701.31 1212,-701.31"/>
</g>
<!-- pp1_dp1_start -->
<g id="node52" class="node">
<title>pp1_dp1_start</title>
<polygon fill="yellow" stroke="black" points="1998.8,-995.29 1532.22,-995.29 1412.2,-859.29 1878.78,-859.29 1998.8,-995.29"/>
<text text-anchor="middle" x="1705.5" y="-946.09" font-family="Arial" font-size="14.00">PP Stage 1 DP1</text>
<text text-anchor="middle" x="1705.5" y="-931.09" font-family="Arial" font-size="14.00">GPU: DP1_PP1_TP0&#45;DP1_PP1_TP7</text>
<text text-anchor="middle" x="1705.5" y="-916.09" font-family="Arial" font-size="14.00">Layers 8&#45;15 (8 layers)</text>
<text text-anchor="middle" x="1705.5" y="-901.09" font-family="Arial" font-size="14.00">8 layers × 64 experts = 512 expert instances</text>
</g>
<!-- pp0_to_pp1_dp1&#45;&gt;pp1_dp1_start -->
<g id="edge65" class="edge">
<title>pp0_to_pp1_dp1&#45;&gt;pp1_dp1_start</title>
<path fill="none" stroke="black" d="M1705.5,-1030.88C1705.5,-1022.8 1705.5,-1014.21 1705.5,-1005.59"/>
<polygon fill="black" stroke="black" points="1709,-1005.48 1705.5,-995.48 1702,-1005.48 1709,-1005.48"/>
</g>
<!-- layers8to15_dp0 -->
<g id="node53" class="node">
<title>layers8to15_dp0</title>
<polygon fill="lightgray" stroke="black" points="1349.5,-519.12 1173.5,-519.12 1173.5,-451.12 1349.5,-451.12 1349.5,-519.12"/>
<text text-anchor="middle" x="1261.5" y="-503.92" font-family="Arial" font-size="14.00">Layers 8&#45;15 DP0</text>
<text text-anchor="middle" x="1261.5" y="-488.92" font-family="Arial" font-size="14.00">Same structure as Layer 0</text>
<text text-anchor="middle" x="1261.5" y="-473.92" font-family="Arial" font-size="14.00">8 layers per stage</text>
<text text-anchor="middle" x="1261.5" y="-458.92" font-family="Arial" font-size="14.00">TP=8, EP=64 distribution</text>
</g>
<!-- pp1_dp0_start&#45;&gt;layers8to15_dp0 -->
<g id="edge33" class="edge">
<title>pp1_dp0_start&#45;&gt;layers8to15_dp0</title>
<path fill="none" stroke="black" d="M1234.69,-554.92C1238.18,-545.97 1241.67,-537.01 1244.93,-528.64"/>
<polygon fill="black" stroke="black" points="1248.26,-529.72 1248.63,-519.14 1241.74,-527.18 1248.26,-529.72"/>
</g>
<!-- layers8to15_dp1 -->
<g id="node54" class="node">
<title>layers8to15_dp1</title>
<polygon fill="lightgray" stroke="black" points="1793.5,-809.2 1617.5,-809.2 1617.5,-741.2 1793.5,-741.2 1793.5,-809.2"/>
<text text-anchor="middle" x="1705.5" y="-794" font-family="Arial" font-size="14.00">Layers 8&#45;15 DP1</text>
<text text-anchor="middle" x="1705.5" y="-779" font-family="Arial" font-size="14.00">Same structure as Layer 0</text>
<text text-anchor="middle" x="1705.5" y="-764" font-family="Arial" font-size="14.00">8 layers per stage</text>
<text text-anchor="middle" x="1705.5" y="-749" font-family="Arial" font-size="14.00">TP=8, EP=64 distribution</text>
</g>
<!-- pp1_dp1_start&#45;&gt;layers8to15_dp1 -->
<g id="edge66" class="edge">
<title>pp1_dp1_start&#45;&gt;layers8to15_dp1</title>
<path fill="none" stroke="black" d="M1705.5,-859.15C1705.5,-845.61 1705.5,-831.73 1705.5,-819.28"/>
<polygon fill="black" stroke="black" points="1709,-819.21 1705.5,-809.21 1702,-819.21 1709,-819.21"/>
</g>
<!-- final_norm_dp0 -->
<g id="node55" class="node">
<title>final_norm_dp0</title>
<polygon fill="lightgreen" stroke="black" points="1473,-415.12 1102,-415.12 1102,-347.12 1473,-347.12 1473,-415.12"/>
<text text-anchor="middle" x="1287.5" y="-399.92" font-family="Arial" font-size="14.00">Final RMSNorm DP0</text>
<text text-anchor="middle" x="1287.5" y="-384.92" font-family="Arial" font-size="14.00">GPU: DP0_PP1_TP0&#45;DP0_PP1_TP7</text>
<text text-anchor="middle" x="1287.5" y="-369.92" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1287.5" y="-354.92" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layers8to15_dp0&#45;&gt;final_norm_dp0 -->
<g id="edge34" class="edge">
<title>layers8to15_dp0&#45;&gt;final_norm_dp0</title>
<path fill="none" stroke="black" d="M1269.94,-451C1272.03,-442.81 1274.3,-433.91 1276.49,-425.31"/>
<polygon fill="black" stroke="black" points="1279.93,-425.97 1279.01,-415.42 1273.15,-424.24 1279.93,-425.97"/>
</g>
<!-- final_norm_dp1 -->
<g id="node56" class="node">
<title>final_norm_dp1</title>
<polygon fill="lightgreen" stroke="black" points="1891,-657.12 1520,-657.12 1520,-589.12 1891,-589.12 1891,-657.12"/>
<text text-anchor="middle" x="1705.5" y="-641.92" font-family="Arial" font-size="14.00">Final RMSNorm DP1</text>
<text text-anchor="middle" x="1705.5" y="-626.92" font-family="Arial" font-size="14.00">GPU: DP1_PP1_TP0&#45;DP1_PP1_TP7</text>
<text text-anchor="middle" x="1705.5" y="-611.92" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1705.5" y="-596.92" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layers8to15_dp1&#45;&gt;final_norm_dp1 -->
<g id="edge67" class="edge">
<title>layers8to15_dp1&#45;&gt;final_norm_dp1</title>
<path fill="none" stroke="black" d="M1705.5,-740.89C1705.5,-719.23 1705.5,-690.76 1705.5,-667.35"/>
<polygon fill="black" stroke="black" points="1709,-667.34 1705.5,-657.34 1702,-667.34 1709,-667.34"/>
</g>
<!-- output_proj_dp0 -->
<g id="node57" class="node">
<title>output_proj_dp0</title>
<polygon fill="lightgreen" stroke="black" points="1562.5,-311.12 1188.5,-311.12 1188.5,-243.12 1562.5,-243.12 1562.5,-311.12"/>
<text text-anchor="middle" x="1375.5" y="-295.92" font-family="Arial" font-size="14.00">Output Projection DP0</text>
<text text-anchor="middle" x="1375.5" y="-280.92" font-family="Arial" font-size="14.00">GPU: DP0_PP1_TP0&#45;DP0_PP1_TP7</text>
<text text-anchor="middle" x="1375.5" y="-265.92" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1375.5" y="-250.92" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- final_norm_dp0&#45;&gt;output_proj_dp0 -->
<g id="edge35" class="edge">
<title>final_norm_dp0&#45;&gt;output_proj_dp0</title>
<path fill="none" stroke="black" d="M1316.07,-347C1323.76,-338.1 1332.16,-328.36 1340.16,-319.08"/>
<polygon fill="black" stroke="black" points="1342.89,-321.28 1346.77,-311.42 1337.59,-316.7 1342.89,-321.28"/>
</g>
<!-- output_proj_dp1 -->
<g id="node58" class="node">
<title>output_proj_dp1</title>
<polygon fill="lightgreen" stroke="black" points="1878.5,-415.12 1504.5,-415.12 1504.5,-347.12 1878.5,-347.12 1878.5,-415.12"/>
<text text-anchor="middle" x="1691.5" y="-399.92" font-family="Arial" font-size="14.00">Output Projection DP1</text>
<text text-anchor="middle" x="1691.5" y="-384.92" font-family="Arial" font-size="14.00">GPU: DP1_PP1_TP0&#45;DP1_PP1_TP7</text>
<text text-anchor="middle" x="1691.5" y="-369.92" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1691.5" y="-354.92" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- final_norm_dp1&#45;&gt;output_proj_dp1 -->
<g id="edge68" class="edge">
<title>final_norm_dp1&#45;&gt;output_proj_dp1</title>
<path fill="none" stroke="black" d="M1703.57,-589C1701.09,-546.44 1696.77,-472.46 1694.03,-425.46"/>
<polygon fill="black" stroke="black" points="1697.51,-425.06 1693.43,-415.28 1690.52,-425.47 1697.51,-425.06"/>
</g>
<!-- dp_combine -->
<g id="node59" class="node">
<title>dp_combine</title>
<ellipse fill="orange" stroke="black" cx="1482.5" cy="-159.04" rx="270.23" ry="48.17"/>
<text text-anchor="middle" x="1482.5" y="-177.84" font-family="Arial" font-size="14.00">Data Parallelism Combine</text>
<text text-anchor="middle" x="1482.5" y="-162.84" font-family="Arial" font-size="14.00">GPU: Output aggregation</text>
<text text-anchor="middle" x="1482.5" y="-147.84" font-family="Arial" font-size="14.00">Input: 2×[batch_size=64, seq_len=1024, vocab_size=51200]</text>
<text text-anchor="middle" x="1482.5" y="-132.84" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- output_proj_dp0&#45;&gt;dp_combine -->
<g id="edge36" class="edge">
<title>output_proj_dp0&#45;&gt;dp_combine</title>
<path fill="none" stroke="black" d="M1406.16,-242.86C1414.43,-233.89 1423.59,-223.94 1432.62,-214.15"/>
<polygon fill="black" stroke="black" points="1435.27,-216.44 1439.48,-206.71 1430.12,-211.69 1435.27,-216.44"/>
</g>
<!-- output_proj_dp1&#45;&gt;dp_combine -->
<g id="edge69" class="edge">
<title>output_proj_dp1&#45;&gt;dp_combine</title>
<path fill="none" stroke="black" d="M1664.03,-346.91C1640.26,-318.64 1604.61,-277.3 1571.5,-243.12 1562.03,-233.35 1551.7,-223.24 1541.53,-213.57"/>
<polygon fill="black" stroke="black" points="1543.85,-210.95 1534.17,-206.63 1539.04,-216.04 1543.85,-210.95"/>
</g>
<!-- output -->
<g id="node60" class="node">
<title>output</title>
<ellipse fill="lightblue" stroke="black" cx="1482.5" cy="-37.48" rx="270.23" ry="37.45"/>
<text text-anchor="middle" x="1482.5" y="-48.78" font-family="Arial" font-size="14.00">Output</text>
<text text-anchor="middle" x="1482.5" y="-33.78" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1482.5" y="-18.78" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- dp_combine&#45;&gt;output -->
<g id="edge70" class="edge">
<title>dp_combine&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1482.5,-110.78C1482.5,-102.34 1482.5,-93.54 1482.5,-85.11"/>
<polygon fill="black" stroke="black" points="1486,-85.06 1482.5,-75.06 1479,-85.06 1486,-85.06"/>
</g>
</g>
</svg>
