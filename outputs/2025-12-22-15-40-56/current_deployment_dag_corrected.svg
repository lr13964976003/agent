<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="2216pt" height="3700pt"
 viewBox="0.00 0.00 2215.89 3699.74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 3695.74)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-3695.74 2211.89,-3695.74 2211.89,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightblue" stroke="black" cx="1318.5" cy="-3643.66" rx="262.17" ry="48.17"/>
<text text-anchor="middle" x="1318.5" y="-3662.46" font-family="Arial" font-size="14.00">Input</text>
<text text-anchor="middle" x="1318.5" y="-3647.46" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1318.5" y="-3632.46" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1318.5" y="-3617.46" font-family="Arial" font-size="14.00">DP=2: Split batch into 2 groups of 64 sequences each</text>
</g>
<!-- dp_split -->
<g id="node2" class="node">
<title>dp_split</title>
<polygon fill="lightgreen" stroke="black" points="1590.26,-3559.57 1157.95,-3559.57 1046.74,-3423.57 1479.05,-3423.57 1590.26,-3559.57"/>
<text text-anchor="middle" x="1318.5" y="-3510.37" font-family="Arial" font-size="14.00">Data Parallelism Split</text>
<text text-anchor="middle" x="1318.5" y="-3495.37" font-family="Arial" font-size="14.00">GPU: DP0&#45;DP1</text>
<text text-anchor="middle" x="1318.5" y="-3480.37" font-family="Arial" font-size="14.00">Split batch_size=128 → 2×64</text>
<text text-anchor="middle" x="1318.5" y="-3465.37" font-family="Arial" font-size="14.00">No communication required for inference</text>
</g>
<!-- input&#45;&gt;dp_split -->
<g id="edge1" class="edge">
<title>input&#45;&gt;dp_split</title>
<path fill="none" stroke="black" d="M1318.5,-3595.17C1318.5,-3587.08 1318.5,-3578.5 1318.5,-3569.88"/>
<polygon fill="black" stroke="black" points="1322,-3569.77 1318.5,-3559.77 1315,-3569.77 1322,-3569.77"/>
</g>
<!-- embed_dp0 -->
<g id="node3" class="node">
<title>embed_dp0</title>
<polygon fill="lightgreen" stroke="black" points="1309.5,-3387.57 945.5,-3387.57 945.5,-3304.57 1309.5,-3304.57 1309.5,-3387.57"/>
<text text-anchor="middle" x="1127.5" y="-3372.37" font-family="Arial" font-size="14.00">Embedding Layer DP0</text>
<text text-anchor="middle" x="1127.5" y="-3357.37" font-family="Arial" font-size="14.00">GPU: DP0_TP0&#45;DP0_TP7</text>
<text text-anchor="middle" x="1127.5" y="-3342.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1127.5" y="-3327.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=512]</text>
<text text-anchor="middle" x="1127.5" y="-3312.37" font-family="Arial" font-size="14.00">TP=8: hidden_size=4096 → 512 per TP rank</text>
</g>
<!-- dp_split&#45;&gt;embed_dp0 -->
<g id="edge2" class="edge">
<title>dp_split&#45;&gt;embed_dp0</title>
<path fill="none" stroke="black" d="M1229.15,-3423.44C1215.77,-3413.39 1202.23,-3403.22 1189.58,-3393.72"/>
<polygon fill="black" stroke="black" points="1191.51,-3390.79 1181.41,-3387.58 1187.3,-3396.38 1191.51,-3390.79"/>
</g>
<!-- embed_dp1 -->
<g id="node26" class="node">
<title>embed_dp1</title>
<polygon fill="lightgreen" stroke="black" points="1750.5,-3387.57 1386.5,-3387.57 1386.5,-3304.57 1750.5,-3304.57 1750.5,-3387.57"/>
<text text-anchor="middle" x="1568.5" y="-3372.37" font-family="Arial" font-size="14.00">Embedding Layer DP1</text>
<text text-anchor="middle" x="1568.5" y="-3357.37" font-family="Arial" font-size="14.00">GPU: DP1_TP0&#45;DP1_TP7</text>
<text text-anchor="middle" x="1568.5" y="-3342.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1568.5" y="-3327.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=512]</text>
<text text-anchor="middle" x="1568.5" y="-3312.37" font-family="Arial" font-size="14.00">TP=8: hidden_size=4096 → 512 per TP rank</text>
</g>
<!-- dp_split&#45;&gt;embed_dp1 -->
<g id="edge37" class="edge">
<title>dp_split&#45;&gt;embed_dp1</title>
<path fill="none" stroke="black" d="M1435.45,-3423.44C1453.63,-3413.01 1472.04,-3402.44 1489.13,-3392.63"/>
<polygon fill="black" stroke="black" points="1491,-3395.59 1497.94,-3387.58 1487.52,-3389.52 1491,-3395.59"/>
</g>
<!-- hidden_up_dp0 -->
<g id="node4" class="node">
<title>hidden_up_dp0</title>
<polygon fill="lightgreen" stroke="black" points="1196,-3268.57 825,-3268.57 825,-3185.57 1196,-3185.57 1196,-3268.57"/>
<text text-anchor="middle" x="1010.5" y="-3253.37" font-family="Arial" font-size="14.00">Hidden Upscaling DP0</text>
<text text-anchor="middle" x="1010.5" y="-3238.37" font-family="Arial" font-size="14.00">GPU: DP0_TP0&#45;DP0_TP7</text>
<text text-anchor="middle" x="1010.5" y="-3223.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=512]</text>
<text text-anchor="middle" x="1010.5" y="-3208.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1010.5" y="-3193.37" font-family="Arial" font-size="14.00">TP=8: All&#45;Gather operation</text>
</g>
<!-- embed_dp0&#45;&gt;hidden_up_dp0 -->
<g id="edge3" class="edge">
<title>embed_dp0&#45;&gt;hidden_up_dp0</title>
<path fill="none" stroke="black" d="M1086.91,-3304.48C1077.65,-3295.22 1067.73,-3285.3 1058.21,-3275.78"/>
<polygon fill="black" stroke="black" points="1060.57,-3273.19 1051.02,-3268.59 1055.62,-3278.14 1060.57,-3273.19"/>
</g>
<!-- pp0_dp0_start -->
<g id="node5" class="node">
<title>pp0_dp0_start</title>
<polygon fill="yellow" stroke="black" points="953.8,-3149.57 487.22,-3149.57 367.2,-3013.57 833.78,-3013.57 953.8,-3149.57"/>
<text text-anchor="middle" x="660.5" y="-3100.37" font-family="Arial" font-size="14.00">PP Stage 0 DP0</text>
<text text-anchor="middle" x="660.5" y="-3085.37" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="660.5" y="-3070.37" font-family="Arial" font-size="14.00">Layers 0&#45;7 (8 layers)</text>
<text text-anchor="middle" x="660.5" y="-3055.37" font-family="Arial" font-size="14.00">8 layers × 64 experts = 512 expert instances</text>
</g>
<!-- hidden_up_dp0&#45;&gt;pp0_dp0_start -->
<g id="edge4" class="edge">
<title>hidden_up_dp0&#45;&gt;pp0_dp0_start</title>
<path fill="none" stroke="black" d="M911.61,-3185.53C887.2,-3175.52 860.33,-3164.5 833.53,-3153.51"/>
<polygon fill="black" stroke="black" points="834.63,-3150.18 824.05,-3149.63 831.98,-3156.66 834.63,-3150.18"/>
</g>
<!-- layer0_attn_residual_dp0 -->
<g id="node16" class="node">
<title>layer0_attn_residual_dp0</title>
<polygon fill="lightcoral" stroke="black" points="1070.5,-2145.57 692.5,-2145.57 692.5,-2077.57 1070.5,-2077.57 1070.5,-2145.57"/>
<text text-anchor="middle" x="881.5" y="-2130.37" font-family="Arial" font-size="14.00">Layer 0: Attention Residual DP0</text>
<text text-anchor="middle" x="881.5" y="-2115.37" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="881.5" y="-2100.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096] x2</text>
<text text-anchor="middle" x="881.5" y="-2085.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- hidden_up_dp0&#45;&gt;layer0_attn_residual_dp0 -->
<g id="edge18" class="edge">
<title>hidden_up_dp0&#45;&gt;layer0_attn_residual_dp0</title>
<path fill="none" stroke="black" d="M1010.5,-3185.52C1010.5,-3130.81 1010.5,-3030.34 1010.5,-2944.57 1010.5,-2944.57 1010.5,-2944.57 1010.5,-2318.57 1010.5,-2253.3 963.4,-2191.69 926.12,-2153.16"/>
<polygon fill="black" stroke="black" points="928.33,-2150.42 918.81,-2145.76 923.35,-2155.34 928.33,-2150.42"/>
</g>
<!-- layer0_norm_dp0 -->
<g id="node6" class="node">
<title>layer0_norm_dp0</title>
<polygon fill="lightcoral" stroke="black" points="789,-2977.57 418,-2977.57 418,-2909.57 789,-2909.57 789,-2977.57"/>
<text text-anchor="middle" x="603.5" y="-2962.37" font-family="Arial" font-size="14.00">Layer 0: RMSNorm DP0</text>
<text text-anchor="middle" x="603.5" y="-2947.37" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="603.5" y="-2932.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="603.5" y="-2917.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp0_dp0_start&#45;&gt;layer0_norm_dp0 -->
<g id="edge5" class="edge">
<title>pp0_dp0_start&#45;&gt;layer0_norm_dp0</title>
<path fill="none" stroke="black" d="M632.33,-3013.37C628.54,-3004.33 624.75,-2995.26 621.21,-2986.82"/>
<polygon fill="black" stroke="black" points="624.43,-2985.46 617.34,-2977.59 617.98,-2988.17 624.43,-2985.46"/>
</g>
<!-- layer0_q_proj_dp0 -->
<g id="node7" class="node">
<title>layer0_q_proj_dp0</title>
<polygon fill="lightcoral" stroke="black" points="381,-2873.57 0,-2873.57 0,-2805.57 381,-2805.57 381,-2873.57"/>
<text text-anchor="middle" x="190.5" y="-2858.37" font-family="Arial" font-size="14.00">Layer 0: Q Projection DP0</text>
<text text-anchor="middle" x="190.5" y="-2843.37" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="190.5" y="-2828.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="190.5" y="-2813.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp0&#45;&gt;layer0_q_proj_dp0 -->
<g id="edge6" class="edge">
<title>layer0_norm_dp0&#45;&gt;layer0_q_proj_dp0</title>
<path fill="none" stroke="black" d="M469.7,-2909.53C426.44,-2898.84 378.3,-2886.95 334.34,-2876.1"/>
<polygon fill="black" stroke="black" points="334.99,-2872.65 324.44,-2873.65 333.31,-2879.45 334.99,-2872.65"/>
</g>
<!-- layer0_k_proj_dp0 -->
<g id="node8" class="node">
<title>layer0_k_proj_dp0</title>
<polygon fill="lightcoral" stroke="black" points="780,-2873.57 399,-2873.57 399,-2805.57 780,-2805.57 780,-2873.57"/>
<text text-anchor="middle" x="589.5" y="-2858.37" font-family="Arial" font-size="14.00">Layer 0: K Projection DP0</text>
<text text-anchor="middle" x="589.5" y="-2843.37" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="589.5" y="-2828.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="589.5" y="-2813.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp0&#45;&gt;layer0_k_proj_dp0 -->
<g id="edge7" class="edge">
<title>layer0_norm_dp0&#45;&gt;layer0_k_proj_dp0</title>
<path fill="none" stroke="black" d="M598.95,-2909.46C597.84,-2901.35 596.63,-2892.55 595.47,-2884.04"/>
<polygon fill="black" stroke="black" points="598.9,-2883.3 594.07,-2873.87 591.96,-2884.26 598.9,-2883.3"/>
</g>
<!-- layer0_v_proj_dp0 -->
<g id="node9" class="node">
<title>layer0_v_proj_dp0</title>
<polygon fill="lightcoral" stroke="black" points="983,-2665.57 602,-2665.57 602,-2597.57 983,-2597.57 983,-2665.57"/>
<text text-anchor="middle" x="792.5" y="-2650.37" font-family="Arial" font-size="14.00">Layer 0: V Projection DP0</text>
<text text-anchor="middle" x="792.5" y="-2635.37" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="792.5" y="-2620.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="792.5" y="-2605.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp0&#45;&gt;layer0_v_proj_dp0 -->
<g id="edge8" class="edge">
<title>layer0_norm_dp0&#45;&gt;layer0_v_proj_dp0</title>
<path fill="none" stroke="black" d="M747.77,-2909.47C763.68,-2900.28 777.92,-2888.55 788.5,-2873.57 829.71,-2815.26 817.76,-2727.62 805.21,-2675.65"/>
<polygon fill="black" stroke="black" points="808.55,-2674.59 802.71,-2665.75 801.77,-2676.3 808.55,-2674.59"/>
</g>
<!-- layer0_qk_matmul_dp0 -->
<g id="node10" class="node">
<title>layer0_qk_matmul_dp0</title>
<polygon fill="lightcoral" stroke="black" points="583.5,-2769.57 169.5,-2769.57 169.5,-2701.57 583.5,-2701.57 583.5,-2769.57"/>
<text text-anchor="middle" x="376.5" y="-2754.37" font-family="Arial" font-size="14.00">Layer 0: QK^T MatMul DP0</text>
<text text-anchor="middle" x="376.5" y="-2739.37" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="376.5" y="-2724.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, heads=32, d_k=128] x2</text>
<text text-anchor="middle" x="376.5" y="-2709.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_q_proj_dp0&#45;&gt;layer0_qk_matmul_dp0 -->
<g id="edge9" class="edge">
<title>layer0_q_proj_dp0&#45;&gt;layer0_qk_matmul_dp0</title>
<path fill="none" stroke="black" d="M250.89,-2805.46C268.85,-2795.61 288.66,-2784.74 307.14,-2774.61"/>
<polygon fill="black" stroke="black" points="309.01,-2777.57 316.1,-2769.7 305.65,-2771.44 309.01,-2777.57"/>
</g>
<!-- layer0_k_proj_dp0&#45;&gt;layer0_qk_matmul_dp0 -->
<g id="edge10" class="edge">
<title>layer0_k_proj_dp0&#45;&gt;layer0_qk_matmul_dp0</title>
<path fill="none" stroke="black" d="M520.35,-2805.46C499.41,-2795.43 476.26,-2784.35 454.77,-2774.05"/>
<polygon fill="black" stroke="black" points="456.2,-2770.86 445.67,-2769.7 453.18,-2777.17 456.2,-2770.86"/>
</g>
<!-- layer0_attn_v_matmul_dp0 -->
<g id="node14" class="node">
<title>layer0_attn_v_matmul_dp0</title>
<polygon fill="lightcoral" stroke="black" points="982,-2353.57 249,-2353.57 249,-2285.57 982,-2285.57 982,-2353.57"/>
<text text-anchor="middle" x="615.5" y="-2338.37" font-family="Arial" font-size="14.00">Layer 0: Attention V MatMul DP0</text>
<text text-anchor="middle" x="615.5" y="-2323.37" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="615.5" y="-2308.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, seq_len=1024, heads=32] x [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="615.5" y="-2293.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_v_proj_dp0&#45;&gt;layer0_attn_v_matmul_dp0 -->
<g id="edge15" class="edge">
<title>layer0_v_proj_dp0&#45;&gt;layer0_attn_v_matmul_dp0</title>
<path fill="none" stroke="black" d="M773.56,-2597.4C741.17,-2540.68 675.22,-2425.16 639.6,-2362.78"/>
<polygon fill="black" stroke="black" points="642.57,-2360.93 634.57,-2353.98 636.49,-2364.4 642.57,-2360.93"/>
</g>
<!-- layer0_attn_scale_dp0 -->
<g id="node11" class="node">
<title>layer0_attn_scale_dp0</title>
<polygon fill="lightcoral" stroke="black" points="583.5,-2665.57 169.5,-2665.57 169.5,-2597.57 583.5,-2597.57 583.5,-2665.57"/>
<text text-anchor="middle" x="376.5" y="-2650.37" font-family="Arial" font-size="14.00">Layer 0: Attention Scale DP0</text>
<text text-anchor="middle" x="376.5" y="-2635.37" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="376.5" y="-2620.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="376.5" y="-2605.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_qk_matmul_dp0&#45;&gt;layer0_attn_scale_dp0 -->
<g id="edge11" class="edge">
<title>layer0_qk_matmul_dp0&#45;&gt;layer0_attn_scale_dp0</title>
<path fill="none" stroke="black" d="M376.5,-2701.46C376.5,-2693.35 376.5,-2684.55 376.5,-2676.04"/>
<polygon fill="black" stroke="black" points="380,-2675.87 376.5,-2665.87 373,-2675.87 380,-2675.87"/>
</g>
<!-- layer0_attn_mask_dp0 -->
<g id="node12" class="node">
<title>layer0_attn_mask_dp0</title>
<polygon fill="lightcoral" stroke="black" points="606.5,-2561.57 192.5,-2561.57 192.5,-2493.57 606.5,-2493.57 606.5,-2561.57"/>
<text text-anchor="middle" x="399.5" y="-2546.37" font-family="Arial" font-size="14.00">Layer 0: Attention Mask DP0</text>
<text text-anchor="middle" x="399.5" y="-2531.37" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="399.5" y="-2516.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="399.5" y="-2501.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_attn_scale_dp0&#45;&gt;layer0_attn_mask_dp0 -->
<g id="edge12" class="edge">
<title>layer0_attn_scale_dp0&#45;&gt;layer0_attn_mask_dp0</title>
<path fill="none" stroke="black" d="M383.97,-2597.46C385.82,-2589.26 387.82,-2580.36 389.76,-2571.76"/>
<polygon fill="black" stroke="black" points="393.21,-2572.4 391.99,-2561.87 386.38,-2570.86 393.21,-2572.4"/>
</g>
<!-- layer0_attn_softmax_dp0 -->
<g id="node13" class="node">
<title>layer0_attn_softmax_dp0</title>
<polygon fill="lightcoral" stroke="black" points="629.5,-2457.57 215.5,-2457.57 215.5,-2389.57 629.5,-2389.57 629.5,-2457.57"/>
<text text-anchor="middle" x="422.5" y="-2442.37" font-family="Arial" font-size="14.00">Layer 0: Softmax DP0</text>
<text text-anchor="middle" x="422.5" y="-2427.37" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="422.5" y="-2412.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="422.5" y="-2397.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_attn_mask_dp0&#45;&gt;layer0_attn_softmax_dp0 -->
<g id="edge13" class="edge">
<title>layer0_attn_mask_dp0&#45;&gt;layer0_attn_softmax_dp0</title>
<path fill="none" stroke="black" d="M406.97,-2493.46C408.82,-2485.26 410.82,-2476.36 412.76,-2467.76"/>
<polygon fill="black" stroke="black" points="416.21,-2468.4 414.99,-2457.87 409.38,-2466.86 416.21,-2468.4"/>
</g>
<!-- layer0_attn_softmax_dp0&#45;&gt;layer0_attn_v_matmul_dp0 -->
<g id="edge14" class="edge">
<title>layer0_attn_softmax_dp0&#45;&gt;layer0_attn_v_matmul_dp0</title>
<path fill="none" stroke="black" d="M485.16,-2389.46C503.88,-2379.56 524.54,-2368.64 543.8,-2358.47"/>
<polygon fill="black" stroke="black" points="545.62,-2361.46 552.82,-2353.7 542.35,-2355.28 545.62,-2361.46"/>
</g>
<!-- layer0_attn_out_proj_dp0 -->
<g id="node15" class="node">
<title>layer0_attn_out_proj_dp0</title>
<polygon fill="lightcoral" stroke="black" points="892,-2249.57 521,-2249.57 521,-2181.57 892,-2181.57 892,-2249.57"/>
<text text-anchor="middle" x="706.5" y="-2234.37" font-family="Arial" font-size="14.00">Layer 0: Attention Output Projection DP0</text>
<text text-anchor="middle" x="706.5" y="-2219.37" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="706.5" y="-2204.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="706.5" y="-2189.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_v_matmul_dp0&#45;&gt;layer0_attn_out_proj_dp0 -->
<g id="edge16" class="edge">
<title>layer0_attn_v_matmul_dp0&#45;&gt;layer0_attn_out_proj_dp0</title>
<path fill="none" stroke="black" d="M645.05,-2285.46C652.99,-2276.55 661.68,-2266.81 669.96,-2257.53"/>
<polygon fill="black" stroke="black" points="672.75,-2259.66 676.79,-2249.87 667.52,-2255 672.75,-2259.66"/>
</g>
<!-- layer0_attn_out_proj_dp0&#45;&gt;layer0_attn_residual_dp0 -->
<g id="edge17" class="edge">
<title>layer0_attn_out_proj_dp0&#45;&gt;layer0_attn_residual_dp0</title>
<path fill="none" stroke="black" d="M763.32,-2181.46C780.06,-2171.7 798.52,-2160.94 815.77,-2150.88"/>
<polygon fill="black" stroke="black" points="817.79,-2153.76 824.67,-2145.7 814.27,-2147.71 817.79,-2153.76"/>
</g>
<!-- layer0_attn_ar_dp0 -->
<g id="node17" class="node">
<title>layer0_attn_ar_dp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="881.5" cy="-2004.1" rx="251.96" ry="37.45"/>
<text text-anchor="middle" x="881.5" y="-2015.4" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="881.5" y="-2000.4" font-family="Arial" font-size="14.00">TP Group: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="881.5" y="-1985.4" font-family="Arial" font-size="14.00">Size: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_residual_dp0&#45;&gt;layer0_attn_ar_dp0 -->
<g id="edge19" class="edge">
<title>layer0_attn_residual_dp0&#45;&gt;layer0_attn_ar_dp0</title>
<path fill="none" stroke="black" d="M881.5,-2077.49C881.5,-2069.32 881.5,-2060.43 881.5,-2051.75"/>
<polygon fill="black" stroke="black" points="885,-2051.73 881.5,-2041.73 878,-2051.73 885,-2051.73"/>
</g>
<!-- layer0_norm2_dp0 -->
<g id="node18" class="node">
<title>layer0_norm2_dp0</title>
<polygon fill="lightyellow" stroke="black" points="1241.27,-1930.62 629.19,-1930.62 471.73,-1794.62 1083.81,-1794.62 1241.27,-1930.62"/>
<text text-anchor="middle" x="856.5" y="-1881.42" font-family="Arial" font-size="14.00">Layer 0: RMSNorm 2 DP0</text>
<text text-anchor="middle" x="856.5" y="-1866.42" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="856.5" y="-1851.42" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="856.5" y="-1836.42" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_ar_dp0&#45;&gt;layer0_norm2_dp0 -->
<g id="edge20" class="edge">
<title>layer0_attn_ar_dp0&#45;&gt;layer0_norm2_dp0</title>
<path fill="none" stroke="black" d="M874.93,-1966.45C873.5,-1958.47 871.94,-1949.75 870.34,-1940.86"/>
<polygon fill="black" stroke="black" points="873.75,-1940 868.54,-1930.78 866.86,-1941.24 873.75,-1940"/>
</g>
<!-- layer0_moe_residual_dp0 -->
<g id="node25" class="node">
<title>layer0_moe_residual_dp0</title>
<polygon fill="lightcoral" stroke="black" points="1409.5,-1031.29 1031.5,-1031.29 1031.5,-963.29 1409.5,-963.29 1409.5,-1031.29"/>
<text text-anchor="middle" x="1220.5" y="-1016.09" font-family="Arial" font-size="14.00">Layer 0: MoE Residual DP0</text>
<text text-anchor="middle" x="1220.5" y="-1001.09" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP7</text>
<text text-anchor="middle" x="1220.5" y="-986.09" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096] x2</text>
<text text-anchor="middle" x="1220.5" y="-971.09" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_ar_dp0&#45;&gt;layer0_moe_residual_dp0 -->
<g id="edge29" class="edge">
<title>layer0_attn_ar_dp0&#45;&gt;layer0_moe_residual_dp0</title>
<path fill="none" stroke="black" d="M1092.89,-1983.66C1162.46,-1972.75 1227.85,-1956.02 1250.5,-1930.62 1321.41,-1851.08 1269.5,-1798.18 1269.5,-1691.62 1269.5,-1691.62 1269.5,-1691.62 1269.5,-1286.37 1269.5,-1188.63 1274.52,-1162.02 1250.5,-1067.29 1248.28,-1058.55 1245.08,-1049.5 1241.59,-1040.96"/>
<polygon fill="black" stroke="black" points="1244.71,-1039.37 1237.55,-1031.56 1238.28,-1042.13 1244.71,-1039.37"/>
</g>
<!-- layer0_gate_dp0 -->
<g id="node19" class="node">
<title>layer0_gate_dp0</title>
<polygon fill="lightyellow" stroke="black" points="1232.68,-1758.62 634.26,-1758.62 480.32,-1622.62 1078.74,-1622.62 1232.68,-1758.62"/>
<text text-anchor="middle" x="856.5" y="-1709.42" font-family="Arial" font-size="14.00">Layer 0: MoE Gate DP0</text>
<text text-anchor="middle" x="856.5" y="-1694.42" font-family="Arial" font-size="14.00">GPU: DP0_EP0&#45;DP0_EP63</text>
<text text-anchor="middle" x="856.5" y="-1679.42" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="856.5" y="-1664.42" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, num_experts=64]</text>
</g>
<!-- layer0_norm2_dp0&#45;&gt;layer0_gate_dp0 -->
<g id="edge21" class="edge">
<title>layer0_norm2_dp0&#45;&gt;layer0_gate_dp0</title>
<path fill="none" stroke="black" d="M856.5,-1794.43C856.5,-1786.12 856.5,-1777.57 856.5,-1769.11"/>
<polygon fill="black" stroke="black" points="860,-1768.88 856.5,-1758.88 853,-1768.88 860,-1768.88"/>
</g>
<!-- layer0_route_dp0 -->
<g id="node20" class="node">
<title>layer0_route_dp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="856.5" cy="-1538.54" rx="147.16" ry="48.17"/>
<text text-anchor="middle" x="856.5" y="-1557.34" font-family="Arial" font-size="14.00">Token Routing DP0</text>
<text text-anchor="middle" x="856.5" y="-1542.34" font-family="Arial" font-size="14.00">GPU: DP0_EP0&#45;DP0_EP63</text>
<text text-anchor="middle" x="856.5" y="-1527.34" font-family="Arial" font-size="14.00">Select 2 experts per token</text>
<text text-anchor="middle" x="856.5" y="-1512.34" font-family="Arial" font-size="14.00">Load balance across 64 experts</text>
</g>
<!-- layer0_gate_dp0&#45;&gt;layer0_route_dp0 -->
<g id="edge22" class="edge">
<title>layer0_gate_dp0&#45;&gt;layer0_route_dp0</title>
<path fill="none" stroke="black" d="M856.5,-1622.48C856.5,-1613.93 856.5,-1605.25 856.5,-1596.88"/>
<polygon fill="black" stroke="black" points="860,-1596.85 856.5,-1586.85 853,-1596.85 860,-1596.85"/>
</g>
<!-- layer0_expert0_dp0 -->
<g id="node21" class="node">
<title>layer0_expert0_dp0</title>
<polygon fill="lightsteelblue" stroke="black" points="769,-1454.45 420,-1454.45 420,-1371.45 769,-1371.45 769,-1454.45"/>
<text text-anchor="middle" x="594.5" y="-1439.25" font-family="Arial" font-size="14.00">Layer 0: Expert 0 DP0</text>
<text text-anchor="middle" x="594.5" y="-1424.25" font-family="Arial" font-size="14.00">GPU: DP0_EP0</text>
<text text-anchor="middle" x="594.5" y="-1409.25" font-family="Arial" font-size="14.00">Input: [batch_size=1, seq_len=16, hidden_size=4096]</text>
<text text-anchor="middle" x="594.5" y="-1394.25" font-family="Arial" font-size="14.00">Output: [batch_size=1, seq_len=16, hidden_size=4096]</text>
<text text-anchor="middle" x="594.5" y="-1379.25" font-family="Arial" font-size="14.00">Up&#45;proj → Activation → Down&#45;proj</text>
</g>
<!-- layer0_route_dp0&#45;&gt;layer0_expert0_dp0 -->
<g id="edge23" class="edge">
<title>layer0_route_dp0&#45;&gt;layer0_expert0_dp0</title>
<path fill="none" stroke="black" d="M773.96,-1498.6C747.28,-1486.02 717.47,-1471.96 689.94,-1458.97"/>
<polygon fill="black" stroke="black" points="691.23,-1455.71 680.69,-1454.61 688.24,-1462.04 691.23,-1455.71"/>
</g>
<!-- layer0_expert1_dp0 -->
<g id="node22" class="node">
<title>layer0_expert1_dp0</title>
<polygon fill="lightsteelblue" stroke="black" points="1136,-1454.45 787,-1454.45 787,-1371.45 1136,-1371.45 1136,-1454.45"/>
<text text-anchor="middle" x="961.5" y="-1439.25" font-family="Arial" font-size="14.00">Layer 0: Expert 1 DP0</text>
<text text-anchor="middle" x="961.5" y="-1424.25" font-family="Arial" font-size="14.00">GPU: DP0_EP1</text>
<text text-anchor="middle" x="961.5" y="-1409.25" font-family="Arial" font-size="14.00">Input: [batch_size=1, seq_len=16, hidden_size=4096]</text>
<text text-anchor="middle" x="961.5" y="-1394.25" font-family="Arial" font-size="14.00">Output: [batch_size=1, seq_len=16, hidden_size=4096]</text>
<text text-anchor="middle" x="961.5" y="-1379.25" font-family="Arial" font-size="14.00">Up&#45;proj → Activation → Down&#45;proj</text>
</g>
<!-- layer0_route_dp0&#45;&gt;layer0_expert1_dp0 -->
<g id="edge24" class="edge">
<title>layer0_route_dp0&#45;&gt;layer0_expert1_dp0</title>
<path fill="none" stroke="black" d="M895.3,-1491.87C903.5,-1482.21 912.19,-1471.99 920.47,-1462.24"/>
<polygon fill="black" stroke="black" points="923.21,-1464.43 927.02,-1454.54 917.87,-1459.89 923.21,-1464.43"/>
</g>
<!-- layer0_ep_a2a_dp0 -->
<g id="node23" class="node">
<title>layer0_ep_a2a_dp0</title>
<ellipse fill="orange" stroke="black" cx="856.5" cy="-1287.37" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="856.5" y="-1306.17" font-family="Arial" font-size="14.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="856.5" y="-1291.17" font-family="Arial" font-size="14.00">EP Group: DP0_EP0&#45;DP0_EP63</text>
<text text-anchor="middle" x="856.5" y="-1276.17" font-family="Arial" font-size="14.00">Token dispatch/combine</text>
<text text-anchor="middle" x="856.5" y="-1261.17" font-family="Arial" font-size="14.00">Size: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_expert0_dp0&#45;&gt;layer0_ep_a2a_dp0 -->
<g id="edge25" class="edge">
<title>layer0_expert0_dp0&#45;&gt;layer0_ep_a2a_dp0</title>
<path fill="none" stroke="black" d="M680.65,-1371.32C704.19,-1360.21 729.93,-1348.07 754.27,-1336.59"/>
<polygon fill="black" stroke="black" points="755.98,-1339.66 763.53,-1332.22 752.99,-1333.32 755.98,-1339.66"/>
</g>
<!-- layer0_expert1_dp0&#45;&gt;layer0_ep_a2a_dp0 -->
<g id="edge26" class="edge">
<title>layer0_expert1_dp0&#45;&gt;layer0_ep_a2a_dp0</title>
<path fill="none" stroke="black" d="M926.83,-1371.14C919.17,-1362.14 910.95,-1352.45 902.91,-1343"/>
<polygon fill="black" stroke="black" points="905.37,-1340.48 896.23,-1335.13 900.03,-1345.01 905.37,-1340.48"/>
</g>
<!-- layer0_expert_combine_dp0 -->
<g id="node24" class="node">
<title>layer0_expert_combine_dp0</title>
<polygon fill="lightyellow" stroke="black" points="1241.27,-1203.29 629.19,-1203.29 471.73,-1067.29 1083.81,-1067.29 1241.27,-1203.29"/>
<text text-anchor="middle" x="856.5" y="-1154.09" font-family="Arial" font-size="14.00">Expert Combine DP0</text>
<text text-anchor="middle" x="856.5" y="-1139.09" font-family="Arial" font-size="14.00">GPU: DP0_EP0&#45;DP0_EP63</text>
<text text-anchor="middle" x="856.5" y="-1124.09" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="856.5" y="-1109.09" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_ep_a2a_dp0&#45;&gt;layer0_expert_combine_dp0 -->
<g id="edge27" class="edge">
<title>layer0_ep_a2a_dp0&#45;&gt;layer0_expert_combine_dp0</title>
<path fill="none" stroke="black" d="M856.5,-1238.88C856.5,-1230.8 856.5,-1222.21 856.5,-1213.59"/>
<polygon fill="black" stroke="black" points="860,-1213.48 856.5,-1203.48 853,-1213.48 860,-1213.48"/>
</g>
<!-- layer0_expert_combine_dp0&#45;&gt;layer0_moe_residual_dp0 -->
<g id="edge28" class="edge">
<title>layer0_expert_combine_dp0&#45;&gt;layer0_moe_residual_dp0</title>
<path fill="none" stroke="black" d="M1035.83,-1067.28C1065.56,-1056.18 1095.38,-1045.03 1122.13,-1035.04"/>
<polygon fill="black" stroke="black" points="1123.69,-1038.19 1131.84,-1031.41 1121.24,-1031.64 1123.69,-1038.19"/>
</g>
<!-- layers1to7_dp0 -->
<g id="node49" class="node">
<title>layers1to7_dp0</title>
<polygon fill="lightgray" stroke="black" points="1308.5,-927.29 1132.5,-927.29 1132.5,-859.29 1308.5,-859.29 1308.5,-927.29"/>
<text text-anchor="middle" x="1220.5" y="-912.09" font-family="Arial" font-size="14.00">Layers 1&#45;7 DP0</text>
<text text-anchor="middle" x="1220.5" y="-897.09" font-family="Arial" font-size="14.00">Same structure as Layer 0</text>
<text text-anchor="middle" x="1220.5" y="-882.09" font-family="Arial" font-size="14.00">8 layers per stage</text>
<text text-anchor="middle" x="1220.5" y="-867.09" font-family="Arial" font-size="14.00">TP=8, EP=64 distribution</text>
</g>
<!-- layer0_moe_residual_dp0&#45;&gt;layers1to7_dp0 -->
<g id="edge30" class="edge">
<title>layer0_moe_residual_dp0&#45;&gt;layers1to7_dp0</title>
<path fill="none" stroke="black" d="M1220.5,-963.17C1220.5,-955.06 1220.5,-946.27 1220.5,-937.76"/>
<polygon fill="black" stroke="black" points="1224,-937.59 1220.5,-927.59 1217,-937.59 1224,-937.59"/>
</g>
<!-- hidden_up_dp1 -->
<g id="node27" class="node">
<title>hidden_up_dp1</title>
<polygon fill="lightgreen" stroke="black" points="1813,-3268.57 1442,-3268.57 1442,-3185.57 1813,-3185.57 1813,-3268.57"/>
<text text-anchor="middle" x="1627.5" y="-3253.37" font-family="Arial" font-size="14.00">Hidden Upscaling DP1</text>
<text text-anchor="middle" x="1627.5" y="-3238.37" font-family="Arial" font-size="14.00">GPU: DP1_TP0&#45;DP1_TP7</text>
<text text-anchor="middle" x="1627.5" y="-3223.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=512]</text>
<text text-anchor="middle" x="1627.5" y="-3208.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1627.5" y="-3193.37" font-family="Arial" font-size="14.00">TP=8: All&#45;Gather operation</text>
</g>
<!-- embed_dp1&#45;&gt;hidden_up_dp1 -->
<g id="edge38" class="edge">
<title>embed_dp1&#45;&gt;hidden_up_dp1</title>
<path fill="none" stroke="black" d="M1588.97,-3304.48C1593.32,-3295.86 1597.95,-3286.66 1602.45,-3277.75"/>
<polygon fill="black" stroke="black" points="1605.69,-3279.1 1607.07,-3268.59 1599.44,-3275.95 1605.69,-3279.1"/>
</g>
<!-- pp0_dp1_start -->
<g id="node28" class="node">
<title>pp0_dp1_start</title>
<polygon fill="yellow" stroke="black" points="1920.8,-3149.57 1454.22,-3149.57 1334.2,-3013.57 1800.78,-3013.57 1920.8,-3149.57"/>
<text text-anchor="middle" x="1627.5" y="-3100.37" font-family="Arial" font-size="14.00">PP Stage 0 DP1</text>
<text text-anchor="middle" x="1627.5" y="-3085.37" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1627.5" y="-3070.37" font-family="Arial" font-size="14.00">Layers 0&#45;7 (8 layers)</text>
<text text-anchor="middle" x="1627.5" y="-3055.37" font-family="Arial" font-size="14.00">8 layers × 64 experts = 512 expert instances</text>
</g>
<!-- hidden_up_dp1&#45;&gt;pp0_dp1_start -->
<g id="edge39" class="edge">
<title>hidden_up_dp1&#45;&gt;pp0_dp1_start</title>
<path fill="none" stroke="black" d="M1627.5,-3185.34C1627.5,-3177.35 1627.5,-3168.74 1627.5,-3160.01"/>
<polygon fill="black" stroke="black" points="1631,-3159.75 1627.5,-3149.75 1624,-3159.75 1631,-3159.75"/>
</g>
<!-- layer0_attn_residual_dp1 -->
<g id="node39" class="node">
<title>layer0_attn_residual_dp1</title>
<polygon fill="lightcoral" stroke="black" points="2012.5,-2145.57 1634.5,-2145.57 1634.5,-2077.57 2012.5,-2077.57 2012.5,-2145.57"/>
<text text-anchor="middle" x="1823.5" y="-2130.37" font-family="Arial" font-size="14.00">Layer 0: Attention Residual DP1</text>
<text text-anchor="middle" x="1823.5" y="-2115.37" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1823.5" y="-2100.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096] x2</text>
<text text-anchor="middle" x="1823.5" y="-2085.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- hidden_up_dp1&#45;&gt;layer0_attn_residual_dp1 -->
<g id="edge53" class="edge">
<title>hidden_up_dp1&#45;&gt;layer0_attn_residual_dp1</title>
<path fill="none" stroke="black" d="M1813.19,-3194.02C1864.16,-3182.01 1910.61,-3166.99 1929.5,-3149.57 2000.28,-3084.31 1999.5,-3040.85 1999.5,-2944.57 1999.5,-2944.57 1999.5,-2944.57 1999.5,-2318.57 1999.5,-2247.06 1937.42,-2187.83 1887,-2151.52"/>
<polygon fill="black" stroke="black" points="1888.89,-2148.57 1878.7,-2145.67 1884.86,-2154.29 1888.89,-2148.57"/>
</g>
<!-- layer0_norm_dp1 -->
<g id="node29" class="node">
<title>layer0_norm_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1813,-2977.57 1442,-2977.57 1442,-2909.57 1813,-2909.57 1813,-2977.57"/>
<text text-anchor="middle" x="1627.5" y="-2962.37" font-family="Arial" font-size="14.00">Layer 0: RMSNorm DP1</text>
<text text-anchor="middle" x="1627.5" y="-2947.37" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1627.5" y="-2932.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1627.5" y="-2917.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp0_dp1_start&#45;&gt;layer0_norm_dp1 -->
<g id="edge40" class="edge">
<title>pp0_dp1_start&#45;&gt;layer0_norm_dp1</title>
<path fill="none" stroke="black" d="M1627.5,-3013.37C1627.5,-3004.62 1627.5,-2995.85 1627.5,-2987.64"/>
<polygon fill="black" stroke="black" points="1631,-2987.59 1627.5,-2977.59 1624,-2987.59 1631,-2987.59"/>
</g>
<!-- layer0_q_proj_dp1 -->
<g id="node30" class="node">
<title>layer0_q_proj_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1419,-2873.57 1038,-2873.57 1038,-2805.57 1419,-2805.57 1419,-2873.57"/>
<text text-anchor="middle" x="1228.5" y="-2858.37" font-family="Arial" font-size="14.00">Layer 0: Q Projection DP1</text>
<text text-anchor="middle" x="1228.5" y="-2843.37" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1228.5" y="-2828.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1228.5" y="-2813.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp1&#45;&gt;layer0_q_proj_dp1 -->
<g id="edge41" class="edge">
<title>layer0_norm_dp1&#45;&gt;layer0_q_proj_dp1</title>
<path fill="none" stroke="black" d="M1498.23,-2909.53C1456.53,-2898.87 1410.13,-2887 1367.73,-2876.17"/>
<polygon fill="black" stroke="black" points="1368.46,-2872.74 1357.9,-2873.65 1366.73,-2879.52 1368.46,-2872.74"/>
</g>
<!-- layer0_k_proj_dp1 -->
<g id="node31" class="node">
<title>layer0_k_proj_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1818,-2873.57 1437,-2873.57 1437,-2805.57 1818,-2805.57 1818,-2873.57"/>
<text text-anchor="middle" x="1627.5" y="-2858.37" font-family="Arial" font-size="14.00">Layer 0: K Projection DP1</text>
<text text-anchor="middle" x="1627.5" y="-2843.37" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1627.5" y="-2828.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1627.5" y="-2813.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp1&#45;&gt;layer0_k_proj_dp1 -->
<g id="edge42" class="edge">
<title>layer0_norm_dp1&#45;&gt;layer0_k_proj_dp1</title>
<path fill="none" stroke="black" d="M1627.5,-2909.46C1627.5,-2901.35 1627.5,-2892.55 1627.5,-2884.04"/>
<polygon fill="black" stroke="black" points="1631,-2883.87 1627.5,-2873.87 1624,-2883.87 1631,-2883.87"/>
</g>
<!-- layer0_v_proj_dp1 -->
<g id="node32" class="node">
<title>layer0_v_proj_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1972,-2769.57 1591,-2769.57 1591,-2701.57 1972,-2701.57 1972,-2769.57"/>
<text text-anchor="middle" x="1781.5" y="-2754.37" font-family="Arial" font-size="14.00">Layer 0: V Projection DP1</text>
<text text-anchor="middle" x="1781.5" y="-2739.37" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1781.5" y="-2724.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1781.5" y="-2709.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp1&#45;&gt;layer0_v_proj_dp1 -->
<g id="edge43" class="edge">
<title>layer0_norm_dp1&#45;&gt;layer0_v_proj_dp1</title>
<path fill="none" stroke="black" d="M1786.88,-2909.49C1802.71,-2900.27 1816.84,-2888.53 1827.5,-2873.57 1847.76,-2845.15 1832.42,-2807.17 1814.18,-2778.4"/>
<polygon fill="black" stroke="black" points="1816.92,-2776.19 1808.47,-2769.79 1811.08,-2780.06 1816.92,-2776.19"/>
</g>
<!-- layer0_qk_matmul_dp1 -->
<g id="node33" class="node">
<title>layer0_qk_matmul_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1572.5,-2769.57 1158.5,-2769.57 1158.5,-2701.57 1572.5,-2701.57 1572.5,-2769.57"/>
<text text-anchor="middle" x="1365.5" y="-2754.37" font-family="Arial" font-size="14.00">Layer 0: QK^T MatMul DP1</text>
<text text-anchor="middle" x="1365.5" y="-2739.37" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1365.5" y="-2724.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, heads=32, d_k=128] x2</text>
<text text-anchor="middle" x="1365.5" y="-2709.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_q_proj_dp1&#45;&gt;layer0_qk_matmul_dp1 -->
<g id="edge44" class="edge">
<title>layer0_q_proj_dp1&#45;&gt;layer0_qk_matmul_dp1</title>
<path fill="none" stroke="black" d="M1272.98,-2805.46C1285.66,-2796.01 1299.6,-2785.64 1312.73,-2775.86"/>
<polygon fill="black" stroke="black" points="1314.84,-2778.65 1320.77,-2769.87 1310.66,-2773.04 1314.84,-2778.65"/>
</g>
<!-- layer0_k_proj_dp1&#45;&gt;layer0_qk_matmul_dp1 -->
<g id="edge45" class="edge">
<title>layer0_k_proj_dp1&#45;&gt;layer0_qk_matmul_dp1</title>
<path fill="none" stroke="black" d="M1542.44,-2805.46C1516.11,-2795.21 1486.94,-2783.85 1460.01,-2773.37"/>
<polygon fill="black" stroke="black" points="1461.17,-2770.06 1450.59,-2769.7 1458.63,-2776.59 1461.17,-2770.06"/>
</g>
<!-- layer0_attn_v_matmul_dp1 -->
<g id="node37" class="node">
<title>layer0_attn_v_matmul_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1971,-2353.57 1238,-2353.57 1238,-2285.57 1971,-2285.57 1971,-2353.57"/>
<text text-anchor="middle" x="1604.5" y="-2338.37" font-family="Arial" font-size="14.00">Layer 0: Attention V MatMul DP1</text>
<text text-anchor="middle" x="1604.5" y="-2323.37" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1604.5" y="-2308.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, seq_len=1024, heads=32] x [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="1604.5" y="-2293.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_v_proj_dp1&#45;&gt;layer0_attn_v_matmul_dp1 -->
<g id="edge50" class="edge">
<title>layer0_v_proj_dp1&#45;&gt;layer0_attn_v_matmul_dp1</title>
<path fill="none" stroke="black" d="M1783.82,-2701.56C1786.73,-2635.99 1784.78,-2487.29 1717.5,-2389.57 1709.53,-2377.99 1698.92,-2368.01 1687.38,-2359.52"/>
<polygon fill="black" stroke="black" points="1689.05,-2356.42 1678.84,-2353.6 1685.06,-2362.17 1689.05,-2356.42"/>
</g>
<!-- layer0_attn_scale_dp1 -->
<g id="node34" class="node">
<title>layer0_attn_scale_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1618.5,-2665.57 1204.5,-2665.57 1204.5,-2597.57 1618.5,-2597.57 1618.5,-2665.57"/>
<text text-anchor="middle" x="1411.5" y="-2650.37" font-family="Arial" font-size="14.00">Layer 0: Attention Scale DP1</text>
<text text-anchor="middle" x="1411.5" y="-2635.37" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1411.5" y="-2620.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="1411.5" y="-2605.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_qk_matmul_dp1&#45;&gt;layer0_attn_scale_dp1 -->
<g id="edge46" class="edge">
<title>layer0_qk_matmul_dp1&#45;&gt;layer0_attn_scale_dp1</title>
<path fill="none" stroke="black" d="M1380.43,-2701.46C1384.21,-2693.08 1388.32,-2683.97 1392.27,-2675.2"/>
<polygon fill="black" stroke="black" points="1395.56,-2676.43 1396.48,-2665.87 1389.18,-2673.55 1395.56,-2676.43"/>
</g>
<!-- layer0_attn_mask_dp1 -->
<g id="node35" class="node">
<title>layer0_attn_mask_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1663.5,-2561.57 1249.5,-2561.57 1249.5,-2493.57 1663.5,-2493.57 1663.5,-2561.57"/>
<text text-anchor="middle" x="1456.5" y="-2546.37" font-family="Arial" font-size="14.00">Layer 0: Attention Mask DP1</text>
<text text-anchor="middle" x="1456.5" y="-2531.37" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1456.5" y="-2516.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="1456.5" y="-2501.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_attn_scale_dp1&#45;&gt;layer0_attn_mask_dp1 -->
<g id="edge47" class="edge">
<title>layer0_attn_scale_dp1&#45;&gt;layer0_attn_mask_dp1</title>
<path fill="none" stroke="black" d="M1426.11,-2597.46C1429.8,-2589.08 1433.82,-2579.97 1437.69,-2571.2"/>
<polygon fill="black" stroke="black" points="1440.97,-2572.43 1441.81,-2561.87 1434.57,-2569.61 1440.97,-2572.43"/>
</g>
<!-- layer0_attn_softmax_dp1 -->
<g id="node36" class="node">
<title>layer0_attn_softmax_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1708.5,-2457.57 1294.5,-2457.57 1294.5,-2389.57 1708.5,-2389.57 1708.5,-2457.57"/>
<text text-anchor="middle" x="1501.5" y="-2442.37" font-family="Arial" font-size="14.00">Layer 0: Softmax DP1</text>
<text text-anchor="middle" x="1501.5" y="-2427.37" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1501.5" y="-2412.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="1501.5" y="-2397.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_attn_mask_dp1&#45;&gt;layer0_attn_softmax_dp1 -->
<g id="edge48" class="edge">
<title>layer0_attn_mask_dp1&#45;&gt;layer0_attn_softmax_dp1</title>
<path fill="none" stroke="black" d="M1471.11,-2493.46C1474.8,-2485.08 1478.82,-2475.97 1482.69,-2467.2"/>
<polygon fill="black" stroke="black" points="1485.97,-2468.43 1486.81,-2457.87 1479.57,-2465.61 1485.97,-2468.43"/>
</g>
<!-- layer0_attn_softmax_dp1&#45;&gt;layer0_attn_v_matmul_dp1 -->
<g id="edge49" class="edge">
<title>layer0_attn_softmax_dp1&#45;&gt;layer0_attn_v_matmul_dp1</title>
<path fill="none" stroke="black" d="M1534.94,-2389.46C1544.12,-2380.37 1554.17,-2370.42 1563.7,-2360.97"/>
<polygon fill="black" stroke="black" points="1566.23,-2363.4 1570.87,-2353.87 1561.31,-2358.42 1566.23,-2363.4"/>
</g>
<!-- layer0_attn_out_proj_dp1 -->
<g id="node38" class="node">
<title>layer0_attn_out_proj_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1881,-2249.57 1510,-2249.57 1510,-2181.57 1881,-2181.57 1881,-2249.57"/>
<text text-anchor="middle" x="1695.5" y="-2234.37" font-family="Arial" font-size="14.00">Layer 0: Attention Output Projection DP1</text>
<text text-anchor="middle" x="1695.5" y="-2219.37" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1695.5" y="-2204.37" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="1695.5" y="-2189.37" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_v_matmul_dp1&#45;&gt;layer0_attn_out_proj_dp1 -->
<g id="edge51" class="edge">
<title>layer0_attn_v_matmul_dp1&#45;&gt;layer0_attn_out_proj_dp1</title>
<path fill="none" stroke="black" d="M1634.05,-2285.46C1641.99,-2276.55 1650.68,-2266.81 1658.96,-2257.53"/>
<polygon fill="black" stroke="black" points="1661.75,-2259.66 1665.79,-2249.87 1656.52,-2255 1661.75,-2259.66"/>
</g>
<!-- layer0_attn_out_proj_dp1&#45;&gt;layer0_attn_residual_dp1 -->
<g id="edge52" class="edge">
<title>layer0_attn_out_proj_dp1&#45;&gt;layer0_attn_residual_dp1</title>
<path fill="none" stroke="black" d="M1737.06,-2181.46C1748.79,-2172.1 1761.68,-2161.83 1773.85,-2152.14"/>
<polygon fill="black" stroke="black" points="1776.07,-2154.84 1781.71,-2145.87 1771.71,-2149.37 1776.07,-2154.84"/>
</g>
<!-- layer0_attn_ar_dp1 -->
<g id="node40" class="node">
<title>layer0_attn_ar_dp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1823.5" cy="-2004.1" rx="251.96" ry="37.45"/>
<text text-anchor="middle" x="1823.5" y="-2015.4" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1823.5" y="-2000.4" font-family="Arial" font-size="14.00">TP Group: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1823.5" y="-1985.4" font-family="Arial" font-size="14.00">Size: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_residual_dp1&#45;&gt;layer0_attn_ar_dp1 -->
<g id="edge54" class="edge">
<title>layer0_attn_residual_dp1&#45;&gt;layer0_attn_ar_dp1</title>
<path fill="none" stroke="black" d="M1823.5,-2077.49C1823.5,-2069.32 1823.5,-2060.43 1823.5,-2051.75"/>
<polygon fill="black" stroke="black" points="1827,-2051.73 1823.5,-2041.73 1820,-2051.73 1827,-2051.73"/>
</g>
<!-- layer0_norm2_dp1 -->
<g id="node41" class="node">
<title>layer0_norm2_dp1</title>
<polygon fill="lightyellow" stroke="black" points="2161.27,-1930.62 1549.19,-1930.62 1391.73,-1794.62 2003.81,-1794.62 2161.27,-1930.62"/>
<text text-anchor="middle" x="1776.5" y="-1881.42" font-family="Arial" font-size="14.00">Layer 0: RMSNorm 2 DP1</text>
<text text-anchor="middle" x="1776.5" y="-1866.42" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1776.5" y="-1851.42" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1776.5" y="-1836.42" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_ar_dp1&#45;&gt;layer0_norm2_dp1 -->
<g id="edge55" class="edge">
<title>layer0_attn_ar_dp1&#45;&gt;layer0_norm2_dp1</title>
<path fill="none" stroke="black" d="M1811.15,-1966.45C1808.41,-1958.3 1805.4,-1949.37 1802.33,-1940.28"/>
<polygon fill="black" stroke="black" points="1805.64,-1939.14 1799.13,-1930.78 1799.01,-1941.37 1805.64,-1939.14"/>
</g>
<!-- layer0_moe_residual_dp1 -->
<g id="node48" class="node">
<title>layer0_moe_residual_dp1</title>
<polygon fill="lightcoral" stroke="black" points="2014.5,-1031.29 1636.5,-1031.29 1636.5,-963.29 2014.5,-963.29 2014.5,-1031.29"/>
<text text-anchor="middle" x="1825.5" y="-1016.09" font-family="Arial" font-size="14.00">Layer 0: MoE Residual DP1</text>
<text text-anchor="middle" x="1825.5" y="-1001.09" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP7</text>
<text text-anchor="middle" x="1825.5" y="-986.09" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096] x2</text>
<text text-anchor="middle" x="1825.5" y="-971.09" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_ar_dp1&#45;&gt;layer0_moe_residual_dp1 -->
<g id="edge64" class="edge">
<title>layer0_attn_ar_dp1&#45;&gt;layer0_moe_residual_dp1</title>
<path fill="none" stroke="black" d="M2025.67,-1981.7C2089.87,-1970.62 2149.65,-1954.29 2170.5,-1930.62 2240.93,-1850.66 2189.5,-1798.18 2189.5,-1691.62 2189.5,-1691.62 2189.5,-1691.62 2189.5,-1286.37 2189.5,-1188.63 2235.67,-1140.12 2170.5,-1067.29 2149.43,-1043.74 2089.06,-1027.96 2024.59,-1017.51"/>
<polygon fill="black" stroke="black" points="2025.06,-1014.04 2014.64,-1015.94 2023.97,-1020.96 2025.06,-1014.04"/>
</g>
<!-- layer0_gate_dp1 -->
<g id="node42" class="node">
<title>layer0_gate_dp1</title>
<polygon fill="lightyellow" stroke="black" points="2152.68,-1758.62 1554.26,-1758.62 1400.32,-1622.62 1998.74,-1622.62 2152.68,-1758.62"/>
<text text-anchor="middle" x="1776.5" y="-1709.42" font-family="Arial" font-size="14.00">Layer 0: MoE Gate DP1</text>
<text text-anchor="middle" x="1776.5" y="-1694.42" font-family="Arial" font-size="14.00">GPU: DP1_EP0&#45;DP1_EP63</text>
<text text-anchor="middle" x="1776.5" y="-1679.42" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1776.5" y="-1664.42" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, num_experts=64]</text>
</g>
<!-- layer0_norm2_dp1&#45;&gt;layer0_gate_dp1 -->
<g id="edge56" class="edge">
<title>layer0_norm2_dp1&#45;&gt;layer0_gate_dp1</title>
<path fill="none" stroke="black" d="M1776.5,-1794.43C1776.5,-1786.12 1776.5,-1777.57 1776.5,-1769.11"/>
<polygon fill="black" stroke="black" points="1780,-1768.88 1776.5,-1758.88 1773,-1768.88 1780,-1768.88"/>
</g>
<!-- layer0_route_dp1 -->
<g id="node43" class="node">
<title>layer0_route_dp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1776.5" cy="-1538.54" rx="147.16" ry="48.17"/>
<text text-anchor="middle" x="1776.5" y="-1557.34" font-family="Arial" font-size="14.00">Token Routing DP1</text>
<text text-anchor="middle" x="1776.5" y="-1542.34" font-family="Arial" font-size="14.00">GPU: DP1_EP0&#45;DP1_EP63</text>
<text text-anchor="middle" x="1776.5" y="-1527.34" font-family="Arial" font-size="14.00">Select 2 experts per token</text>
<text text-anchor="middle" x="1776.5" y="-1512.34" font-family="Arial" font-size="14.00">Load balance across 64 experts</text>
</g>
<!-- layer0_gate_dp1&#45;&gt;layer0_route_dp1 -->
<g id="edge57" class="edge">
<title>layer0_gate_dp1&#45;&gt;layer0_route_dp1</title>
<path fill="none" stroke="black" d="M1776.5,-1622.48C1776.5,-1613.93 1776.5,-1605.25 1776.5,-1596.88"/>
<polygon fill="black" stroke="black" points="1780,-1596.85 1776.5,-1586.85 1773,-1596.85 1780,-1596.85"/>
</g>
<!-- layer0_expert0_dp1 -->
<g id="node44" class="node">
<title>layer0_expert0_dp1</title>
<polygon fill="lightsteelblue" stroke="black" points="1721,-1454.45 1372,-1454.45 1372,-1371.45 1721,-1371.45 1721,-1454.45"/>
<text text-anchor="middle" x="1546.5" y="-1439.25" font-family="Arial" font-size="14.00">Layer 0: Expert 0 DP1</text>
<text text-anchor="middle" x="1546.5" y="-1424.25" font-family="Arial" font-size="14.00">GPU: DP1_EP0</text>
<text text-anchor="middle" x="1546.5" y="-1409.25" font-family="Arial" font-size="14.00">Input: [batch_size=1, seq_len=16, hidden_size=4096]</text>
<text text-anchor="middle" x="1546.5" y="-1394.25" font-family="Arial" font-size="14.00">Output: [batch_size=1, seq_len=16, hidden_size=4096]</text>
<text text-anchor="middle" x="1546.5" y="-1379.25" font-family="Arial" font-size="14.00">Up&#45;proj → Activation → Down&#45;proj</text>
</g>
<!-- layer0_route_dp1&#45;&gt;layer0_expert0_dp1 -->
<g id="edge58" class="edge">
<title>layer0_route_dp1&#45;&gt;layer0_expert0_dp1</title>
<path fill="none" stroke="black" d="M1701.19,-1497.07C1678.75,-1485.01 1654.02,-1471.72 1631.03,-1459.37"/>
<polygon fill="black" stroke="black" points="1632.45,-1456.16 1621.98,-1454.51 1629.13,-1462.33 1632.45,-1456.16"/>
</g>
<!-- layer0_expert1_dp1 -->
<g id="node45" class="node">
<title>layer0_expert1_dp1</title>
<polygon fill="lightsteelblue" stroke="black" points="2088,-1454.45 1739,-1454.45 1739,-1371.45 2088,-1371.45 2088,-1454.45"/>
<text text-anchor="middle" x="1913.5" y="-1439.25" font-family="Arial" font-size="14.00">Layer 0: Expert 1 DP1</text>
<text text-anchor="middle" x="1913.5" y="-1424.25" font-family="Arial" font-size="14.00">GPU: DP1_EP1</text>
<text text-anchor="middle" x="1913.5" y="-1409.25" font-family="Arial" font-size="14.00">Input: [batch_size=1, seq_len=16, hidden_size=4096]</text>
<text text-anchor="middle" x="1913.5" y="-1394.25" font-family="Arial" font-size="14.00">Output: [batch_size=1, seq_len=16, hidden_size=4096]</text>
<text text-anchor="middle" x="1913.5" y="-1379.25" font-family="Arial" font-size="14.00">Up&#45;proj → Activation → Down&#45;proj</text>
</g>
<!-- layer0_route_dp1&#45;&gt;layer0_expert1_dp1 -->
<g id="edge59" class="edge">
<title>layer0_route_dp1&#45;&gt;layer0_expert1_dp1</title>
<path fill="none" stroke="black" d="M1825.96,-1492.92C1837.17,-1482.81 1849.12,-1472.03 1860.47,-1461.79"/>
<polygon fill="black" stroke="black" points="1863.13,-1464.1 1868.21,-1454.8 1858.44,-1458.9 1863.13,-1464.1"/>
</g>
<!-- layer0_ep_a2a_dp1 -->
<g id="node46" class="node">
<title>layer0_ep_a2a_dp1</title>
<ellipse fill="orange" stroke="black" cx="1776.5" cy="-1287.37" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1776.5" y="-1306.17" font-family="Arial" font-size="14.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="1776.5" y="-1291.17" font-family="Arial" font-size="14.00">EP Group: DP1_EP0&#45;DP1_EP63</text>
<text text-anchor="middle" x="1776.5" y="-1276.17" font-family="Arial" font-size="14.00">Token dispatch/combine</text>
<text text-anchor="middle" x="1776.5" y="-1261.17" font-family="Arial" font-size="14.00">Size: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_expert0_dp1&#45;&gt;layer0_ep_a2a_dp1 -->
<g id="edge60" class="edge">
<title>layer0_expert0_dp1&#45;&gt;layer0_ep_a2a_dp1</title>
<path fill="none" stroke="black" d="M1622.13,-1371.32C1642.18,-1360.54 1664.04,-1348.8 1684.84,-1337.62"/>
<polygon fill="black" stroke="black" points="1686.53,-1340.68 1693.68,-1332.87 1683.22,-1334.52 1686.53,-1340.68"/>
</g>
<!-- layer0_expert1_dp1&#45;&gt;layer0_ep_a2a_dp1 -->
<g id="edge61" class="edge">
<title>layer0_expert1_dp1&#45;&gt;layer0_ep_a2a_dp1</title>
<path fill="none" stroke="black" d="M1868.26,-1371.14C1857.75,-1361.66 1846.41,-1351.43 1835.4,-1341.5"/>
<polygon fill="black" stroke="black" points="1837.62,-1338.79 1827.85,-1334.69 1832.93,-1343.99 1837.62,-1338.79"/>
</g>
<!-- layer0_expert_combine_dp1 -->
<g id="node47" class="node">
<title>layer0_expert_combine_dp1</title>
<polygon fill="lightyellow" stroke="black" points="2161.27,-1203.29 1549.19,-1203.29 1391.73,-1067.29 2003.81,-1067.29 2161.27,-1203.29"/>
<text text-anchor="middle" x="1776.5" y="-1154.09" font-family="Arial" font-size="14.00">Expert Combine DP1</text>
<text text-anchor="middle" x="1776.5" y="-1139.09" font-family="Arial" font-size="14.00">GPU: DP1_EP0&#45;DP1_EP63</text>
<text text-anchor="middle" x="1776.5" y="-1124.09" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1776.5" y="-1109.09" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_ep_a2a_dp1&#45;&gt;layer0_expert_combine_dp1 -->
<g id="edge62" class="edge">
<title>layer0_ep_a2a_dp1&#45;&gt;layer0_expert_combine_dp1</title>
<path fill="none" stroke="black" d="M1776.5,-1238.88C1776.5,-1230.8 1776.5,-1222.21 1776.5,-1213.59"/>
<polygon fill="black" stroke="black" points="1780,-1213.48 1776.5,-1203.48 1773,-1213.48 1780,-1213.48"/>
</g>
<!-- layer0_expert_combine_dp1&#45;&gt;layer0_moe_residual_dp1 -->
<g id="edge63" class="edge">
<title>layer0_expert_combine_dp1&#45;&gt;layer0_moe_residual_dp1</title>
<path fill="none" stroke="black" d="M1800.71,-1067.08C1803.94,-1058.14 1807.17,-1049.17 1810.18,-1040.81"/>
<polygon fill="black" stroke="black" points="1813.51,-1041.9 1813.6,-1031.3 1806.92,-1039.52 1813.51,-1041.9"/>
</g>
<!-- layers1to7_dp1 -->
<g id="node50" class="node">
<title>layers1to7_dp1</title>
<polygon fill="lightgray" stroke="black" points="1913.5,-927.29 1737.5,-927.29 1737.5,-859.29 1913.5,-859.29 1913.5,-927.29"/>
<text text-anchor="middle" x="1825.5" y="-912.09" font-family="Arial" font-size="14.00">Layers 1&#45;7 DP1</text>
<text text-anchor="middle" x="1825.5" y="-897.09" font-family="Arial" font-size="14.00">Same structure as Layer 0</text>
<text text-anchor="middle" x="1825.5" y="-882.09" font-family="Arial" font-size="14.00">8 layers per stage</text>
<text text-anchor="middle" x="1825.5" y="-867.09" font-family="Arial" font-size="14.00">TP=8, EP=64 distribution</text>
</g>
<!-- layer0_moe_residual_dp1&#45;&gt;layers1to7_dp1 -->
<g id="edge65" class="edge">
<title>layer0_moe_residual_dp1&#45;&gt;layers1to7_dp1</title>
<path fill="none" stroke="black" d="M1825.5,-963.17C1825.5,-955.06 1825.5,-946.27 1825.5,-937.76"/>
<polygon fill="black" stroke="black" points="1829,-937.59 1825.5,-927.59 1822,-937.59 1829,-937.59"/>
</g>
<!-- pp0_to_pp1_dp0 -->
<g id="node51" class="node">
<title>pp0_to_pp1_dp0</title>
<ellipse fill="orange" stroke="black" cx="1220.5" cy="-775.2" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1220.5" y="-794" font-family="Arial" font-size="14.00">Pipeline Transfer DP0</text>
<text text-anchor="middle" x="1220.5" y="-779" font-family="Arial" font-size="14.00">PP0 → PP1</text>
<text text-anchor="middle" x="1220.5" y="-764" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="1220.5" y="-749" font-family="Arial" font-size="14.00">Size: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layers1to7_dp0&#45;&gt;pp0_to_pp1_dp0 -->
<g id="edge31" class="edge">
<title>layers1to7_dp0&#45;&gt;pp0_to_pp1_dp0</title>
<path fill="none" stroke="black" d="M1220.5,-859.02C1220.5,-851.03 1220.5,-842.26 1220.5,-833.52"/>
<polygon fill="black" stroke="black" points="1224,-833.31 1220.5,-823.31 1217,-833.31 1224,-833.31"/>
</g>
<!-- pp0_to_pp1_dp1 -->
<g id="node52" class="node">
<title>pp0_to_pp1_dp1</title>
<ellipse fill="orange" stroke="black" cx="1825.5" cy="-775.2" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1825.5" y="-794" font-family="Arial" font-size="14.00">Pipeline Transfer DP1</text>
<text text-anchor="middle" x="1825.5" y="-779" font-family="Arial" font-size="14.00">PP0 → PP1</text>
<text text-anchor="middle" x="1825.5" y="-764" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="1825.5" y="-749" font-family="Arial" font-size="14.00">Size: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layers1to7_dp1&#45;&gt;pp0_to_pp1_dp1 -->
<g id="edge66" class="edge">
<title>layers1to7_dp1&#45;&gt;pp0_to_pp1_dp1</title>
<path fill="none" stroke="black" d="M1825.5,-859.02C1825.5,-851.03 1825.5,-842.26 1825.5,-833.52"/>
<polygon fill="black" stroke="black" points="1829,-833.31 1825.5,-823.31 1822,-833.31 1829,-833.31"/>
</g>
<!-- pp1_dp0_start -->
<g id="node53" class="node">
<title>pp1_dp0_start</title>
<polygon fill="yellow" stroke="black" points="1513.8,-691.12 1047.22,-691.12 927.2,-555.12 1393.78,-555.12 1513.8,-691.12"/>
<text text-anchor="middle" x="1220.5" y="-641.92" font-family="Arial" font-size="14.00">PP Stage 1 DP0</text>
<text text-anchor="middle" x="1220.5" y="-626.92" font-family="Arial" font-size="14.00">GPU: DP0_PP1_TP0&#45;DP0_PP1_TP7</text>
<text text-anchor="middle" x="1220.5" y="-611.92" font-family="Arial" font-size="14.00">Layers 8&#45;15 (8 layers)</text>
<text text-anchor="middle" x="1220.5" y="-596.92" font-family="Arial" font-size="14.00">8 layers × 64 experts = 512 expert instances</text>
</g>
<!-- pp0_to_pp1_dp0&#45;&gt;pp1_dp0_start -->
<g id="edge32" class="edge">
<title>pp0_to_pp1_dp0&#45;&gt;pp1_dp0_start</title>
<path fill="none" stroke="black" d="M1220.5,-726.72C1220.5,-718.63 1220.5,-710.05 1220.5,-701.43"/>
<polygon fill="black" stroke="black" points="1224,-701.31 1220.5,-691.31 1217,-701.31 1224,-701.31"/>
</g>
<!-- pp1_dp1_start -->
<g id="node54" class="node">
<title>pp1_dp1_start</title>
<polygon fill="yellow" stroke="black" points="2118.8,-691.12 1652.22,-691.12 1532.2,-555.12 1998.78,-555.12 2118.8,-691.12"/>
<text text-anchor="middle" x="1825.5" y="-641.92" font-family="Arial" font-size="14.00">PP Stage 1 DP1</text>
<text text-anchor="middle" x="1825.5" y="-626.92" font-family="Arial" font-size="14.00">GPU: DP1_PP1_TP0&#45;DP1_PP1_TP7</text>
<text text-anchor="middle" x="1825.5" y="-611.92" font-family="Arial" font-size="14.00">Layers 8&#45;15 (8 layers)</text>
<text text-anchor="middle" x="1825.5" y="-596.92" font-family="Arial" font-size="14.00">8 layers × 64 experts = 512 expert instances</text>
</g>
<!-- pp0_to_pp1_dp1&#45;&gt;pp1_dp1_start -->
<g id="edge67" class="edge">
<title>pp0_to_pp1_dp1&#45;&gt;pp1_dp1_start</title>
<path fill="none" stroke="black" d="M1825.5,-726.72C1825.5,-718.63 1825.5,-710.05 1825.5,-701.43"/>
<polygon fill="black" stroke="black" points="1829,-701.31 1825.5,-691.31 1822,-701.31 1829,-701.31"/>
</g>
<!-- layers8to15_dp0 -->
<g id="node55" class="node">
<title>layers8to15_dp0</title>
<polygon fill="lightgray" stroke="black" points="1414.5,-519.12 1238.5,-519.12 1238.5,-451.12 1414.5,-451.12 1414.5,-519.12"/>
<text text-anchor="middle" x="1326.5" y="-503.92" font-family="Arial" font-size="14.00">Layers 8&#45;15 DP0</text>
<text text-anchor="middle" x="1326.5" y="-488.92" font-family="Arial" font-size="14.00">Same structure as Layer 0</text>
<text text-anchor="middle" x="1326.5" y="-473.92" font-family="Arial" font-size="14.00">8 layers per stage</text>
<text text-anchor="middle" x="1326.5" y="-458.92" font-family="Arial" font-size="14.00">TP=8, EP=64 distribution</text>
</g>
<!-- pp1_dp0_start&#45;&gt;layers8to15_dp0 -->
<g id="edge33" class="edge">
<title>pp1_dp0_start&#45;&gt;layers8to15_dp0</title>
<path fill="none" stroke="black" d="M1272.88,-554.92C1280.23,-545.48 1287.6,-536.03 1294.42,-527.28"/>
<polygon fill="black" stroke="black" points="1297.38,-529.18 1300.77,-519.14 1291.86,-524.87 1297.38,-529.18"/>
</g>
<!-- layers8to15_dp1 -->
<g id="node56" class="node">
<title>layers8to15_dp1</title>
<polygon fill="lightgray" stroke="black" points="1909.5,-519.12 1733.5,-519.12 1733.5,-451.12 1909.5,-451.12 1909.5,-519.12"/>
<text text-anchor="middle" x="1821.5" y="-503.92" font-family="Arial" font-size="14.00">Layers 8&#45;15 DP1</text>
<text text-anchor="middle" x="1821.5" y="-488.92" font-family="Arial" font-size="14.00">Same structure as Layer 0</text>
<text text-anchor="middle" x="1821.5" y="-473.92" font-family="Arial" font-size="14.00">8 layers per stage</text>
<text text-anchor="middle" x="1821.5" y="-458.92" font-family="Arial" font-size="14.00">TP=8, EP=64 distribution</text>
</g>
<!-- pp1_dp1_start&#45;&gt;layers8to15_dp1 -->
<g id="edge68" class="edge">
<title>pp1_dp1_start&#45;&gt;layers8to15_dp1</title>
<path fill="none" stroke="black" d="M1823.52,-554.92C1823.27,-546.16 1823.01,-537.4 1822.77,-529.19"/>
<polygon fill="black" stroke="black" points="1826.26,-529.03 1822.47,-519.14 1819.27,-529.24 1826.26,-529.03"/>
</g>
<!-- final_norm_dp0 -->
<g id="node57" class="node">
<title>final_norm_dp0</title>
<polygon fill="lightgreen" stroke="black" points="1565,-415.12 1194,-415.12 1194,-347.12 1565,-347.12 1565,-415.12"/>
<text text-anchor="middle" x="1379.5" y="-399.92" font-family="Arial" font-size="14.00">Final RMSNorm DP0</text>
<text text-anchor="middle" x="1379.5" y="-384.92" font-family="Arial" font-size="14.00">GPU: DP0_PP1_TP0&#45;DP0_PP1_TP7</text>
<text text-anchor="middle" x="1379.5" y="-369.92" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1379.5" y="-354.92" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layers8to15_dp0&#45;&gt;final_norm_dp0 -->
<g id="edge34" class="edge">
<title>layers8to15_dp0&#45;&gt;final_norm_dp0</title>
<path fill="none" stroke="black" d="M1343.71,-451C1348.1,-442.54 1352.89,-433.33 1357.49,-424.47"/>
<polygon fill="black" stroke="black" points="1360.69,-425.91 1362.2,-415.42 1354.48,-422.68 1360.69,-425.91"/>
</g>
<!-- final_norm_dp1 -->
<g id="node58" class="node">
<title>final_norm_dp1</title>
<polygon fill="lightgreen" stroke="black" points="2004,-415.12 1633,-415.12 1633,-347.12 2004,-347.12 2004,-415.12"/>
<text text-anchor="middle" x="1818.5" y="-399.92" font-family="Arial" font-size="14.00">Final RMSNorm DP1</text>
<text text-anchor="middle" x="1818.5" y="-384.92" font-family="Arial" font-size="14.00">GPU: DP1_PP1_TP0&#45;DP1_PP1_TP7</text>
<text text-anchor="middle" x="1818.5" y="-369.92" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1818.5" y="-354.92" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layers8to15_dp1&#45;&gt;final_norm_dp1 -->
<g id="edge69" class="edge">
<title>layers8to15_dp1&#45;&gt;final_norm_dp1</title>
<path fill="none" stroke="black" d="M1820.53,-451C1820.29,-442.9 1820.03,-434.1 1819.78,-425.59"/>
<polygon fill="black" stroke="black" points="1823.27,-425.31 1819.48,-415.42 1816.27,-425.52 1823.27,-425.31"/>
</g>
<!-- output_proj_dp0 -->
<g id="node59" class="node">
<title>output_proj_dp0</title>
<polygon fill="lightgreen" stroke="black" points="1593.5,-311.12 1219.5,-311.12 1219.5,-243.12 1593.5,-243.12 1593.5,-311.12"/>
<text text-anchor="middle" x="1406.5" y="-295.92" font-family="Arial" font-size="14.00">Output Projection DP0</text>
<text text-anchor="middle" x="1406.5" y="-280.92" font-family="Arial" font-size="14.00">GPU: DP0_PP1_TP0&#45;DP0_PP1_TP7</text>
<text text-anchor="middle" x="1406.5" y="-265.92" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1406.5" y="-250.92" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- final_norm_dp0&#45;&gt;output_proj_dp0 -->
<g id="edge35" class="edge">
<title>final_norm_dp0&#45;&gt;output_proj_dp0</title>
<path fill="none" stroke="black" d="M1388.27,-347C1390.44,-338.81 1392.79,-329.91 1395.07,-321.31"/>
<polygon fill="black" stroke="black" points="1398.51,-321.98 1397.69,-311.42 1391.74,-320.19 1398.51,-321.98"/>
</g>
<!-- output_proj_dp1 -->
<g id="node60" class="node">
<title>output_proj_dp1</title>
<polygon fill="lightgreen" stroke="black" points="1998.5,-311.12 1624.5,-311.12 1624.5,-243.12 1998.5,-243.12 1998.5,-311.12"/>
<text text-anchor="middle" x="1811.5" y="-295.92" font-family="Arial" font-size="14.00">Output Projection DP1</text>
<text text-anchor="middle" x="1811.5" y="-280.92" font-family="Arial" font-size="14.00">GPU: DP1_PP1_TP0&#45;DP1_PP1_TP7</text>
<text text-anchor="middle" x="1811.5" y="-265.92" font-family="Arial" font-size="14.00">Input: [batch_size=64, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1811.5" y="-250.92" font-family="Arial" font-size="14.00">Output: [batch_size=64, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- final_norm_dp1&#45;&gt;output_proj_dp1 -->
<g id="edge70" class="edge">
<title>final_norm_dp1&#45;&gt;output_proj_dp1</title>
<path fill="none" stroke="black" d="M1816.23,-347C1815.67,-338.9 1815.07,-330.1 1814.48,-321.59"/>
<polygon fill="black" stroke="black" points="1817.96,-321.16 1813.79,-311.42 1810.98,-321.64 1817.96,-321.16"/>
</g>
<!-- dp_combine -->
<g id="node61" class="node">
<title>dp_combine</title>
<ellipse fill="orange" stroke="black" cx="1602.5" cy="-159.04" rx="270.23" ry="48.17"/>
<text text-anchor="middle" x="1602.5" y="-177.84" font-family="Arial" font-size="14.00">Data Parallelism Combine</text>
<text text-anchor="middle" x="1602.5" y="-162.84" font-family="Arial" font-size="14.00">GPU: Output aggregation</text>
<text text-anchor="middle" x="1602.5" y="-147.84" font-family="Arial" font-size="14.00">Input: 2×[batch_size=64, seq_len=1024, vocab_size=51200]</text>
<text text-anchor="middle" x="1602.5" y="-132.84" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- output_proj_dp0&#45;&gt;dp_combine -->
<g id="edge36" class="edge">
<title>output_proj_dp0&#45;&gt;dp_combine</title>
<path fill="none" stroke="black" d="M1462.4,-243.01C1479.5,-232.89 1498.7,-221.51 1517.28,-210.51"/>
<polygon fill="black" stroke="black" points="1519.23,-213.42 1526.05,-205.31 1515.66,-207.4 1519.23,-213.42"/>
</g>
<!-- output_proj_dp1&#45;&gt;dp_combine -->
<g id="edge71" class="edge">
<title>output_proj_dp1&#45;&gt;dp_combine</title>
<path fill="none" stroke="black" d="M1751.89,-243.01C1733.39,-232.74 1712.58,-221.18 1692.49,-210.02"/>
<polygon fill="black" stroke="black" points="1694.07,-206.89 1683.63,-205.1 1690.67,-213.01 1694.07,-206.89"/>
</g>
<!-- output -->
<g id="node62" class="node">
<title>output</title>
<ellipse fill="lightblue" stroke="black" cx="1602.5" cy="-37.48" rx="270.23" ry="37.45"/>
<text text-anchor="middle" x="1602.5" y="-48.78" font-family="Arial" font-size="14.00">Output</text>
<text text-anchor="middle" x="1602.5" y="-33.78" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1602.5" y="-18.78" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- dp_combine&#45;&gt;output -->
<g id="edge72" class="edge">
<title>dp_combine&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1602.5,-110.78C1602.5,-102.34 1602.5,-93.54 1602.5,-85.11"/>
<polygon fill="black" stroke="black" points="1606,-85.06 1602.5,-75.06 1599,-85.06 1606,-85.06"/>
</g>
</g>
</svg>
