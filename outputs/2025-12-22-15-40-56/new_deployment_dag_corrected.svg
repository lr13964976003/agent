<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="3757pt" height="4514pt"
 viewBox="0.00 0.00 3757.46 4513.79" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 4509.79)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-4509.79 3753.46,-4509.79 3753.46,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightblue" stroke="black" cx="2188.5" cy="-4457.7" rx="262.17" ry="48.17"/>
<text text-anchor="middle" x="2188.5" y="-4476.5" font-family="Arial" font-size="14.00">Input</text>
<text text-anchor="middle" x="2188.5" y="-4461.5" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="2188.5" y="-4446.5" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="2188.5" y="-4431.5" font-family="Arial" font-size="14.00">DP=4: Split batch into 4 groups of 32 sequences each</text>
</g>
<!-- dp_split -->
<g id="node2" class="node">
<title>dp_split</title>
<polygon fill="lightgreen" stroke="black" points="2460.26,-4373.62 2027.95,-4373.62 1916.74,-4237.62 2349.05,-4237.62 2460.26,-4373.62"/>
<text text-anchor="middle" x="2188.5" y="-4324.42" font-family="Arial" font-size="14.00">Data Parallelism Split</text>
<text text-anchor="middle" x="2188.5" y="-4309.42" font-family="Arial" font-size="14.00">GPU: DP0&#45;DP3</text>
<text text-anchor="middle" x="2188.5" y="-4294.42" font-family="Arial" font-size="14.00">Split batch_size=128 → 4×32</text>
<text text-anchor="middle" x="2188.5" y="-4279.42" font-family="Arial" font-size="14.00">No communication required for inference</text>
</g>
<!-- input&#45;&gt;dp_split -->
<g id="edge1" class="edge">
<title>input&#45;&gt;dp_split</title>
<path fill="none" stroke="black" d="M2188.5,-4409.21C2188.5,-4401.13 2188.5,-4392.55 2188.5,-4383.93"/>
<polygon fill="black" stroke="black" points="2192,-4383.81 2188.5,-4373.81 2185,-4383.81 2192,-4383.81"/>
</g>
<!-- embed_dp0 -->
<g id="node3" class="node">
<title>embed_dp0</title>
<polygon fill="lightgreen" stroke="black" points="1607.5,-4201.62 1243.5,-4201.62 1243.5,-4118.62 1607.5,-4118.62 1607.5,-4201.62"/>
<text text-anchor="middle" x="1425.5" y="-4186.42" font-family="Arial" font-size="14.00">Embedding Layer DP0</text>
<text text-anchor="middle" x="1425.5" y="-4171.42" font-family="Arial" font-size="14.00">GPU: DP0_TP0&#45;DP0_TP15</text>
<text text-anchor="middle" x="1425.5" y="-4156.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1425.5" y="-4141.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="1425.5" y="-4126.42" font-family="Arial" font-size="14.00">TP=16: hidden_size=4096 → 256 per TP rank</text>
</g>
<!-- dp_split&#45;&gt;embed_dp0 -->
<g id="edge2" class="edge">
<title>dp_split&#45;&gt;embed_dp0</title>
<path fill="none" stroke="black" d="M1932.04,-4256.39C1829.31,-4237.06 1712.96,-4215.18 1617.71,-4197.27"/>
<polygon fill="black" stroke="black" points="1618.15,-4193.79 1607.68,-4195.38 1616.86,-4200.67 1618.15,-4193.79"/>
</g>
<!-- embed_dp1 -->
<g id="node37" class="node">
<title>embed_dp1</title>
<polygon fill="lightgreen" stroke="black" points="2248.5,-4201.62 1884.5,-4201.62 1884.5,-4118.62 2248.5,-4118.62 2248.5,-4201.62"/>
<text text-anchor="middle" x="2066.5" y="-4186.42" font-family="Arial" font-size="14.00">Embedding Layer DP1</text>
<text text-anchor="middle" x="2066.5" y="-4171.42" font-family="Arial" font-size="14.00">GPU: DP1_TP0&#45;DP1_TP15</text>
<text text-anchor="middle" x="2066.5" y="-4156.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="2066.5" y="-4141.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="2066.5" y="-4126.42" font-family="Arial" font-size="14.00">TP=16: hidden_size=4096 → 256 per TP rank</text>
</g>
<!-- dp_split&#45;&gt;embed_dp1 -->
<g id="edge44" class="edge">
<title>dp_split&#45;&gt;embed_dp1</title>
<path fill="none" stroke="black" d="M2131.43,-4237.49C2123.37,-4228.01 2115.22,-4218.43 2107.55,-4209.4"/>
<polygon fill="black" stroke="black" points="2110.08,-4206.97 2100.94,-4201.62 2104.75,-4211.51 2110.08,-4206.97"/>
</g>
<!-- embed_dp2 -->
<g id="node85" class="node">
<title>embed_dp2</title>
<polygon fill="lightgrey" stroke="black" points="2363,-4178.12 2274,-4178.12 2274,-4142.12 2363,-4142.12 2363,-4178.12"/>
<text text-anchor="middle" x="2318.5" y="-4156.42" font-family="Arial" font-size="14.00">embed_dp2</text>
</g>
<!-- dp_split&#45;&gt;embed_dp2 -->
<g id="edge82" class="edge">
<title>dp_split&#45;&gt;embed_dp2</title>
<path fill="none" stroke="black" d="M2249.31,-4237.49C2266.04,-4219.03 2283.14,-4200.15 2296.15,-4185.79"/>
<polygon fill="black" stroke="black" points="2298.81,-4188.06 2302.93,-4178.3 2293.63,-4183.36 2298.81,-4188.06"/>
</g>
<!-- embed_dp3 -->
<g id="node90" class="node">
<title>embed_dp3</title>
<polygon fill="lightgrey" stroke="black" points="2484,-4178.12 2395,-4178.12 2395,-4142.12 2484,-4142.12 2484,-4178.12"/>
<text text-anchor="middle" x="2439.5" y="-4156.42" font-family="Arial" font-size="14.00">embed_dp3</text>
</g>
<!-- dp_split&#45;&gt;embed_dp3 -->
<g id="edge95" class="edge">
<title>dp_split&#45;&gt;embed_dp3</title>
<path fill="none" stroke="black" d="M2309.58,-4237.6C2330.62,-4225.73 2352.25,-4213.4 2372.5,-4201.62 2382.39,-4195.86 2393.03,-4189.51 2402.85,-4183.58"/>
<polygon fill="black" stroke="black" points="2404.85,-4186.45 2411.59,-4178.27 2401.22,-4180.47 2404.85,-4186.45"/>
</g>
<!-- hidden_up_dp0 -->
<g id="node4" class="node">
<title>hidden_up_dp0</title>
<polygon fill="lightgreen" stroke="black" points="1225,-4082.62 854,-4082.62 854,-3999.62 1225,-3999.62 1225,-4082.62"/>
<text text-anchor="middle" x="1039.5" y="-4067.42" font-family="Arial" font-size="14.00">Hidden Upscaling DP0</text>
<text text-anchor="middle" x="1039.5" y="-4052.42" font-family="Arial" font-size="14.00">GPU: DP0_TP0&#45;DP0_TP15</text>
<text text-anchor="middle" x="1039.5" y="-4037.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="1039.5" y="-4022.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1039.5" y="-4007.42" font-family="Arial" font-size="14.00">TP=16: All&#45;Gather operation</text>
</g>
<!-- embed_dp0&#45;&gt;hidden_up_dp0 -->
<g id="edge3" class="edge">
<title>embed_dp0&#45;&gt;hidden_up_dp0</title>
<path fill="none" stroke="black" d="M1291.85,-4118.61C1256.81,-4107.99 1218.87,-4096.49 1183.32,-4085.71"/>
<polygon fill="black" stroke="black" points="1183.95,-4082.24 1173.36,-4082.69 1181.92,-4088.94 1183.95,-4082.24"/>
</g>
<!-- pp0_dp0_start -->
<g id="node5" class="node">
<title>pp0_dp0_start</title>
<polygon fill="yellow" stroke="black" points="1011.42,-3963.62 340.24,-3963.62 167.58,-3827.62 838.76,-3827.62 1011.42,-3963.62"/>
<text text-anchor="middle" x="589.5" y="-3914.42" font-family="Arial" font-size="14.00">PP Stage 0 DP0</text>
<text text-anchor="middle" x="589.5" y="-3899.42" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="589.5" y="-3884.42" font-family="Arial" font-size="14.00">Layers 0&#45;3 (4 layers)</text>
<text text-anchor="middle" x="589.5" y="-3869.42" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- hidden_up_dp0&#45;&gt;pp0_dp0_start -->
<g id="edge4" class="edge">
<title>hidden_up_dp0&#45;&gt;pp0_dp0_start</title>
<path fill="none" stroke="black" d="M912.35,-3999.57C880.28,-3989.35 844.92,-3978.07 809.71,-3966.84"/>
<polygon fill="black" stroke="black" points="810.37,-3963.38 799.78,-3963.68 808.25,-3970.05 810.37,-3963.38"/>
</g>
<!-- layer0_attn_residual_dp0 -->
<g id="node16" class="node">
<title>layer0_attn_residual_dp0</title>
<polygon fill="lightcoral" stroke="black" points="1228.5,-2671.12 850.5,-2671.12 850.5,-2603.12 1228.5,-2603.12 1228.5,-2671.12"/>
<text text-anchor="middle" x="1039.5" y="-2655.92" font-family="Arial" font-size="14.00">Layer 0: Attention Residual DP0</text>
<text text-anchor="middle" x="1039.5" y="-2640.92" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="1039.5" y="-2625.92" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096] x2</text>
<text text-anchor="middle" x="1039.5" y="-2610.92" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- hidden_up_dp0&#45;&gt;layer0_attn_residual_dp0 -->
<g id="edge18" class="edge">
<title>hidden_up_dp0&#45;&gt;layer0_attn_residual_dp0</title>
<path fill="none" stroke="black" d="M1039.5,-3999.56C1039.5,-3944.86 1039.5,-3844.39 1039.5,-3758.62 1039.5,-3758.62 1039.5,-3758.62 1039.5,-2878.12 1039.5,-2809.41 1039.5,-2729.64 1039.5,-2681.56"/>
<polygon fill="black" stroke="black" points="1043,-2681.51 1039.5,-2671.51 1036,-2681.51 1043,-2681.51"/>
</g>
<!-- layer0_norm_dp0 -->
<g id="node6" class="node">
<title>layer0_norm_dp0</title>
<polygon fill="lightcoral" stroke="black" points="775,-3791.62 404,-3791.62 404,-3723.62 775,-3723.62 775,-3791.62"/>
<text text-anchor="middle" x="589.5" y="-3776.42" font-family="Arial" font-size="14.00">Layer 0: RMSNorm DP0</text>
<text text-anchor="middle" x="589.5" y="-3761.42" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="589.5" y="-3746.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="589.5" y="-3731.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp0_dp0_start&#45;&gt;layer0_norm_dp0 -->
<g id="edge5" class="edge">
<title>pp0_dp0_start&#45;&gt;layer0_norm_dp0</title>
<path fill="none" stroke="black" d="M589.5,-3827.42C589.5,-3818.66 589.5,-3809.89 589.5,-3801.69"/>
<polygon fill="black" stroke="black" points="593,-3801.64 589.5,-3791.64 586,-3801.64 593,-3801.64"/>
</g>
<!-- layer0_q_proj_dp0 -->
<g id="node7" class="node">
<title>layer0_q_proj_dp0</title>
<polygon fill="lightcoral" stroke="black" points="381,-3673.54 0,-3673.54 0,-3605.54 381,-3605.54 381,-3673.54"/>
<text text-anchor="middle" x="190.5" y="-3658.34" font-family="Arial" font-size="14.00">Layer 0: Q Projection DP0</text>
<text text-anchor="middle" x="190.5" y="-3643.34" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="190.5" y="-3628.34" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="190.5" y="-3613.34" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp0&#45;&gt;layer0_q_proj_dp0 -->
<g id="edge6" class="edge">
<title>layer0_norm_dp0&#45;&gt;layer0_q_proj_dp0</title>
<path fill="none" stroke="black" d="M475.96,-3723.59C425.43,-3708.88 365.8,-3691.54 314.14,-3676.51"/>
<polygon fill="black" stroke="black" points="314.83,-3673.06 304.25,-3673.63 312.88,-3679.78 314.83,-3673.06"/>
</g>
<!-- layer0_k_proj_dp0 -->
<g id="node8" class="node">
<title>layer0_k_proj_dp0</title>
<polygon fill="lightcoral" stroke="black" points="780,-3673.54 399,-3673.54 399,-3605.54 780,-3605.54 780,-3673.54"/>
<text text-anchor="middle" x="589.5" y="-3658.34" font-family="Arial" font-size="14.00">Layer 0: K Projection DP0</text>
<text text-anchor="middle" x="589.5" y="-3643.34" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="589.5" y="-3628.34" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="589.5" y="-3613.34" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp0&#45;&gt;layer0_k_proj_dp0 -->
<g id="edge7" class="edge">
<title>layer0_norm_dp0&#45;&gt;layer0_k_proj_dp0</title>
<path fill="none" stroke="black" d="M589.5,-3723.35C589.5,-3711.09 589.5,-3697.01 589.5,-3683.98"/>
<polygon fill="black" stroke="black" points="593,-3683.8 589.5,-3673.8 586,-3683.8 593,-3683.8"/>
</g>
<!-- layer0_v_proj_dp0 -->
<g id="node9" class="node">
<title>layer0_v_proj_dp0</title>
<polygon fill="lightcoral" stroke="black" points="998,-3369.37 617,-3369.37 617,-3301.37 998,-3301.37 998,-3369.37"/>
<text text-anchor="middle" x="807.5" y="-3354.17" font-family="Arial" font-size="14.00">Layer 0: V Projection DP0</text>
<text text-anchor="middle" x="807.5" y="-3339.17" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="807.5" y="-3324.17" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="807.5" y="-3309.17" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp0&#45;&gt;layer0_v_proj_dp0 -->
<g id="edge8" class="edge">
<title>layer0_norm_dp0&#45;&gt;layer0_v_proj_dp0</title>
<path fill="none" stroke="black" d="M746.37,-3723.4C762.63,-3714.21 777.28,-3702.51 788.5,-3687.62 857.14,-3596.49 835.72,-3451.31 819.13,-3379.5"/>
<polygon fill="black" stroke="black" points="822.45,-3378.36 816.73,-3369.45 815.65,-3379.99 822.45,-3378.36"/>
</g>
<!-- layer0_qk_matmul_dp0 -->
<g id="node10" class="node">
<title>layer0_qk_matmul_dp0</title>
<polygon fill="lightcoral" stroke="black" points="598.5,-3521.45 184.5,-3521.45 184.5,-3453.45 598.5,-3453.45 598.5,-3521.45"/>
<text text-anchor="middle" x="391.5" y="-3506.25" font-family="Arial" font-size="14.00">Layer 0: QK^T MatMul DP0</text>
<text text-anchor="middle" x="391.5" y="-3491.25" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="391.5" y="-3476.25" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, heads=32, d_k=128] x2</text>
<text text-anchor="middle" x="391.5" y="-3461.25" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_q_proj_dp0&#45;&gt;layer0_qk_matmul_dp0 -->
<g id="edge9" class="edge">
<title>layer0_q_proj_dp0&#45;&gt;layer0_qk_matmul_dp0</title>
<path fill="none" stroke="black" d="M235.11,-3605.23C265.69,-3582.4 306.38,-3552.01 338.6,-3527.95"/>
<polygon fill="black" stroke="black" points="341.1,-3530.45 347.02,-3521.67 336.91,-3524.85 341.1,-3530.45"/>
</g>
<!-- layer0_k_proj_dp0&#45;&gt;layer0_qk_matmul_dp0 -->
<g id="edge10" class="edge">
<title>layer0_k_proj_dp0&#45;&gt;layer0_qk_matmul_dp0</title>
<path fill="none" stroke="black" d="M545.56,-3605.23C515.44,-3582.4 475.35,-3552.01 443.61,-3527.95"/>
<polygon fill="black" stroke="black" points="445.4,-3524.92 435.32,-3521.67 441.17,-3530.5 445.4,-3524.92"/>
</g>
<!-- layer0_attn_v_matmul_dp0 -->
<g id="node14" class="node">
<title>layer0_attn_v_matmul_dp0</title>
<polygon fill="lightcoral" stroke="black" points="1011,-2913.12 278,-2913.12 278,-2845.12 1011,-2845.12 1011,-2913.12"/>
<text text-anchor="middle" x="644.5" y="-2897.92" font-family="Arial" font-size="14.00">Layer 0: Attention V MatMul DP0</text>
<text text-anchor="middle" x="644.5" y="-2882.92" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="644.5" y="-2867.92" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, seq_len=1024, heads=32] x [batch_size=32, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="644.5" y="-2852.92" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_v_proj_dp0&#45;&gt;layer0_attn_v_matmul_dp0 -->
<g id="edge15" class="edge">
<title>layer0_v_proj_dp0&#45;&gt;layer0_attn_v_matmul_dp0</title>
<path fill="none" stroke="black" d="M803.65,-3300.96C795.33,-3236.77 772.06,-3092.86 720.5,-2983.12 710.17,-2961.14 694.82,-2939.16 680.61,-2921.18"/>
<polygon fill="black" stroke="black" points="683.18,-2918.8 674.18,-2913.22 677.74,-2923.2 683.18,-2918.8"/>
</g>
<!-- layer0_attn_scale_dp0 -->
<g id="node11" class="node">
<title>layer0_attn_scale_dp0</title>
<polygon fill="lightcoral" stroke="black" points="598.5,-3369.37 184.5,-3369.37 184.5,-3301.37 598.5,-3301.37 598.5,-3369.37"/>
<text text-anchor="middle" x="391.5" y="-3354.17" font-family="Arial" font-size="14.00">Layer 0: Attention Scale DP0</text>
<text text-anchor="middle" x="391.5" y="-3339.17" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="391.5" y="-3324.17" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="391.5" y="-3309.17" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_qk_matmul_dp0&#45;&gt;layer0_attn_scale_dp0 -->
<g id="edge11" class="edge">
<title>layer0_qk_matmul_dp0&#45;&gt;layer0_attn_scale_dp0</title>
<path fill="none" stroke="black" d="M391.5,-3453.14C391.5,-3431.48 391.5,-3403.01 391.5,-3379.6"/>
<polygon fill="black" stroke="black" points="395,-3379.58 391.5,-3369.58 388,-3379.58 395,-3379.58"/>
</g>
<!-- layer0_attn_mask_dp0 -->
<g id="node12" class="node">
<title>layer0_attn_mask_dp0</title>
<polygon fill="lightcoral" stroke="black" points="621.5,-3217.29 207.5,-3217.29 207.5,-3149.29 621.5,-3149.29 621.5,-3217.29"/>
<text text-anchor="middle" x="414.5" y="-3202.09" font-family="Arial" font-size="14.00">Layer 0: Attention Mask DP0</text>
<text text-anchor="middle" x="414.5" y="-3187.09" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="414.5" y="-3172.09" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="414.5" y="-3157.09" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_attn_scale_dp0&#45;&gt;layer0_attn_mask_dp0 -->
<g id="edge12" class="edge">
<title>layer0_attn_scale_dp0&#45;&gt;layer0_attn_mask_dp0</title>
<path fill="none" stroke="black" d="M396.6,-3301.06C399.92,-3279.4 404.29,-3250.92 407.87,-3227.52"/>
<polygon fill="black" stroke="black" points="411.35,-3227.92 409.41,-3217.5 404.44,-3226.86 411.35,-3227.92"/>
</g>
<!-- layer0_attn_softmax_dp0 -->
<g id="node13" class="node">
<title>layer0_attn_softmax_dp0</title>
<polygon fill="lightcoral" stroke="black" points="711.5,-3065.2 297.5,-3065.2 297.5,-2997.2 711.5,-2997.2 711.5,-3065.2"/>
<text text-anchor="middle" x="504.5" y="-3050" font-family="Arial" font-size="14.00">Layer 0: Softmax DP0</text>
<text text-anchor="middle" x="504.5" y="-3035" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="504.5" y="-3020" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="504.5" y="-3005" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_attn_mask_dp0&#45;&gt;layer0_attn_softmax_dp0 -->
<g id="edge13" class="edge">
<title>layer0_attn_mask_dp0&#45;&gt;layer0_attn_softmax_dp0</title>
<path fill="none" stroke="black" d="M434.47,-3148.98C447.7,-3126.92 465.15,-3097.82 479.33,-3074.18"/>
<polygon fill="black" stroke="black" points="482.44,-3075.79 484.58,-3065.42 476.44,-3072.19 482.44,-3075.79"/>
</g>
<!-- layer0_attn_softmax_dp0&#45;&gt;layer0_attn_v_matmul_dp0 -->
<g id="edge14" class="edge">
<title>layer0_attn_softmax_dp0&#45;&gt;layer0_attn_v_matmul_dp0</title>
<path fill="none" stroke="black" d="M535.57,-2996.89C556.51,-2974.45 584.25,-2944.71 606.5,-2920.85"/>
<polygon fill="black" stroke="black" points="609.25,-2923.03 613.52,-2913.33 604.14,-2918.26 609.25,-2923.03"/>
</g>
<!-- layer0_attn_out_proj_dp0 -->
<g id="node15" class="node">
<title>layer0_attn_out_proj_dp0</title>
<polygon fill="lightcoral" stroke="black" points="921,-2775.12 550,-2775.12 550,-2707.12 921,-2707.12 921,-2775.12"/>
<text text-anchor="middle" x="735.5" y="-2759.92" font-family="Arial" font-size="14.00">Layer 0: Attention Output Projection DP0</text>
<text text-anchor="middle" x="735.5" y="-2744.92" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="735.5" y="-2729.92" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="735.5" y="-2714.92" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_v_matmul_dp0&#45;&gt;layer0_attn_out_proj_dp0 -->
<g id="edge16" class="edge">
<title>layer0_attn_v_matmul_dp0&#45;&gt;layer0_attn_out_proj_dp0</title>
<path fill="none" stroke="black" d="M666.76,-2844.85C679.04,-2826.49 694.42,-2803.52 707.51,-2783.95"/>
<polygon fill="black" stroke="black" points="710.5,-2785.77 713.15,-2775.52 704.68,-2781.88 710.5,-2785.77"/>
</g>
<!-- layer0_attn_out_proj_dp0&#45;&gt;layer0_attn_residual_dp0 -->
<g id="edge17" class="edge">
<title>layer0_attn_out_proj_dp0&#45;&gt;layer0_attn_residual_dp0</title>
<path fill="none" stroke="black" d="M834.2,-2707C865.23,-2696.59 899.65,-2685.04 931.31,-2674.42"/>
<polygon fill="black" stroke="black" points="932.67,-2677.66 941.04,-2671.16 930.44,-2671.02 932.67,-2677.66"/>
</g>
<!-- layer0_attn_ar_dp0 -->
<g id="node17" class="node">
<title>layer0_attn_ar_dp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1040.5" cy="-2529.64" rx="251.96" ry="37.45"/>
<text text-anchor="middle" x="1040.5" y="-2540.94" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1040.5" y="-2525.94" font-family="Arial" font-size="14.00">TP Group: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="1040.5" y="-2510.94" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_residual_dp0&#45;&gt;layer0_attn_ar_dp0 -->
<g id="edge19" class="edge">
<title>layer0_attn_residual_dp0&#45;&gt;layer0_attn_ar_dp0</title>
<path fill="none" stroke="black" d="M1039.81,-2603.03C1039.89,-2594.87 1039.98,-2585.97 1040.06,-2577.3"/>
<polygon fill="black" stroke="black" points="1043.56,-2577.31 1040.15,-2567.28 1036.56,-2577.24 1043.56,-2577.31"/>
</g>
<!-- layer0_norm2_dp0 -->
<g id="node18" class="node">
<title>layer0_norm2_dp0</title>
<polygon fill="lightyellow" stroke="black" points="1425.27,-2456.17 813.19,-2456.17 655.73,-2320.17 1267.81,-2320.17 1425.27,-2456.17"/>
<text text-anchor="middle" x="1040.5" y="-2406.97" font-family="Arial" font-size="14.00">Layer 0: RMSNorm 2 DP0</text>
<text text-anchor="middle" x="1040.5" y="-2391.97" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="1040.5" y="-2376.97" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1040.5" y="-2361.97" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_ar_dp0&#45;&gt;layer0_norm2_dp0 -->
<g id="edge20" class="edge">
<title>layer0_attn_ar_dp0&#45;&gt;layer0_norm2_dp0</title>
<path fill="none" stroke="black" d="M1040.5,-2492C1040.5,-2484.02 1040.5,-2475.29 1040.5,-2466.4"/>
<polygon fill="black" stroke="black" points="1044,-2466.33 1040.5,-2456.33 1037,-2466.33 1044,-2466.33"/>
</g>
<!-- layer0_moe_residual_dp0 -->
<g id="node27" class="node">
<title>layer0_moe_residual_dp0</title>
<polygon fill="lightcoral" stroke="black" points="1799.5,-1535.62 1421.5,-1535.62 1421.5,-1467.62 1799.5,-1467.62 1799.5,-1535.62"/>
<text text-anchor="middle" x="1610.5" y="-1520.42" font-family="Arial" font-size="14.00">Layer 0: MoE Residual DP0</text>
<text text-anchor="middle" x="1610.5" y="-1505.42" font-family="Arial" font-size="14.00">GPU: DP0_PP0_TP0&#45;DP0_PP0_TP15</text>
<text text-anchor="middle" x="1610.5" y="-1490.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096] x2</text>
<text text-anchor="middle" x="1610.5" y="-1475.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_ar_dp0&#45;&gt;layer0_moe_residual_dp0 -->
<g id="edge33" class="edge">
<title>layer0_attn_ar_dp0&#45;&gt;layer0_moe_residual_dp0</title>
<path fill="none" stroke="black" d="M1236.82,-2506.16C1317.82,-2494.12 1400.63,-2477.35 1434.5,-2456.17 1546.34,-2386.21 1610.5,-2349.08 1610.5,-2217.17 1610.5,-2217.17 1610.5,-2217.17 1610.5,-1790.7 1610.5,-1704.01 1610.5,-1602.65 1610.5,-1546.22"/>
<polygon fill="black" stroke="black" points="1614,-1545.89 1610.5,-1535.89 1607,-1545.89 1614,-1545.89"/>
</g>
<!-- layer0_gate_dp0 -->
<g id="node19" class="node">
<title>layer0_gate_dp0</title>
<polygon fill="lightyellow" stroke="black" points="1416.68,-2284.17 818.26,-2284.17 664.32,-2148.17 1262.74,-2148.17 1416.68,-2284.17"/>
<text text-anchor="middle" x="1040.5" y="-2234.97" font-family="Arial" font-size="14.00">Layer 0: MoE Gate DP0</text>
<text text-anchor="middle" x="1040.5" y="-2219.97" font-family="Arial" font-size="14.00">GPU: DP0_EP0&#45;DP0_EP31</text>
<text text-anchor="middle" x="1040.5" y="-2204.97" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1040.5" y="-2189.97" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, num_experts=64]</text>
</g>
<!-- layer0_norm2_dp0&#45;&gt;layer0_gate_dp0 -->
<g id="edge21" class="edge">
<title>layer0_norm2_dp0&#45;&gt;layer0_gate_dp0</title>
<path fill="none" stroke="black" d="M1040.5,-2319.98C1040.5,-2311.66 1040.5,-2303.11 1040.5,-2294.66"/>
<polygon fill="black" stroke="black" points="1044,-2294.42 1040.5,-2284.42 1037,-2294.42 1044,-2294.42"/>
</g>
<!-- layer0_route_dp0 -->
<g id="node20" class="node">
<title>layer0_route_dp0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1040.5" cy="-2053.48" rx="147.16" ry="58.88"/>
<text text-anchor="middle" x="1040.5" y="-2079.78" font-family="Arial" font-size="14.00">Token Routing DP0</text>
<text text-anchor="middle" x="1040.5" y="-2064.78" font-family="Arial" font-size="14.00">GPU: DP0_EP0&#45;DP0_EP31</text>
<text text-anchor="middle" x="1040.5" y="-2049.78" font-family="Arial" font-size="14.00">Select 2 experts per token</text>
<text text-anchor="middle" x="1040.5" y="-2034.78" font-family="Arial" font-size="14.00">Load balance across 64 experts</text>
<text text-anchor="middle" x="1040.5" y="-2019.78" font-family="Arial" font-size="14.00">EP32: 2 experts per GPU</text>
</g>
<!-- layer0_gate_dp0&#45;&gt;layer0_route_dp0 -->
<g id="edge22" class="edge">
<title>layer0_gate_dp0&#45;&gt;layer0_route_dp0</title>
<path fill="none" stroke="black" d="M1040.5,-2147.95C1040.5,-2139.51 1040.5,-2130.88 1040.5,-2122.43"/>
<polygon fill="black" stroke="black" points="1044,-2122.24 1040.5,-2112.24 1037,-2122.24 1044,-2122.24"/>
</g>
<!-- layer0_expert0_dp0 -->
<g id="node21" class="node">
<title>layer0_expert0_dp0</title>
<polygon fill="lightsteelblue" stroke="black" points="481,-1958.79 132,-1958.79 132,-1875.79 481,-1875.79 481,-1958.79"/>
<text text-anchor="middle" x="306.5" y="-1943.59" font-family="Arial" font-size="14.00">Layer 0: Expert 0 DP0</text>
<text text-anchor="middle" x="306.5" y="-1928.59" font-family="Arial" font-size="14.00">GPU: DP0_EP0</text>
<text text-anchor="middle" x="306.5" y="-1913.59" font-family="Arial" font-size="14.00">Input: [batch_size=2, seq_len=64, hidden_size=4096]</text>
<text text-anchor="middle" x="306.5" y="-1898.59" font-family="Arial" font-size="14.00">Output: [batch_size=2, seq_len=64, hidden_size=4096]</text>
<text text-anchor="middle" x="306.5" y="-1883.59" font-family="Arial" font-size="14.00">Up&#45;proj → Activation → Down&#45;proj</text>
</g>
<!-- layer0_route_dp0&#45;&gt;layer0_expert0_dp0 -->
<g id="edge23" class="edge">
<title>layer0_route_dp0&#45;&gt;layer0_expert0_dp0</title>
<path fill="none" stroke="black" d="M904.3,-2031.24C795.09,-2013.76 637.7,-1987.56 491.37,-1959.13"/>
<polygon fill="black" stroke="black" points="491.78,-1955.64 481.3,-1957.17 490.44,-1962.52 491.78,-1955.64"/>
</g>
<!-- layer0_expert1_dp0 -->
<g id="node22" class="node">
<title>layer0_expert1_dp0</title>
<polygon fill="lightsteelblue" stroke="black" points="848,-1958.79 499,-1958.79 499,-1875.79 848,-1875.79 848,-1958.79"/>
<text text-anchor="middle" x="673.5" y="-1943.59" font-family="Arial" font-size="14.00">Layer 0: Expert 1 DP0</text>
<text text-anchor="middle" x="673.5" y="-1928.59" font-family="Arial" font-size="14.00">GPU: DP0_EP0</text>
<text text-anchor="middle" x="673.5" y="-1913.59" font-family="Arial" font-size="14.00">Input: [batch_size=2, seq_len=64, hidden_size=4096]</text>
<text text-anchor="middle" x="673.5" y="-1898.59" font-family="Arial" font-size="14.00">Output: [batch_size=2, seq_len=64, hidden_size=4096]</text>
<text text-anchor="middle" x="673.5" y="-1883.59" font-family="Arial" font-size="14.00">Up&#45;proj → Activation → Down&#45;proj</text>
</g>
<!-- layer0_route_dp0&#45;&gt;layer0_expert1_dp0 -->
<g id="edge24" class="edge">
<title>layer0_route_dp0&#45;&gt;layer0_expert1_dp0</title>
<path fill="none" stroke="black" d="M932.87,-2013.12C889.23,-1997.16 838.64,-1978.67 793.79,-1962.27"/>
<polygon fill="black" stroke="black" points="794.91,-1958.95 784.32,-1958.8 792.51,-1965.53 794.91,-1958.95"/>
</g>
<!-- layer0_expert2_dp0 -->
<g id="node23" class="node">
<title>layer0_expert2_dp0</title>
<polygon fill="lightsteelblue" stroke="black" points="1215,-1958.79 866,-1958.79 866,-1875.79 1215,-1875.79 1215,-1958.79"/>
<text text-anchor="middle" x="1040.5" y="-1943.59" font-family="Arial" font-size="14.00">Layer 0: Expert 2 DP0</text>
<text text-anchor="middle" x="1040.5" y="-1928.59" font-family="Arial" font-size="14.00">GPU: DP0_EP1</text>
<text text-anchor="middle" x="1040.5" y="-1913.59" font-family="Arial" font-size="14.00">Input: [batch_size=2, seq_len=64, hidden_size=4096]</text>
<text text-anchor="middle" x="1040.5" y="-1898.59" font-family="Arial" font-size="14.00">Output: [batch_size=2, seq_len=64, hidden_size=4096]</text>
<text text-anchor="middle" x="1040.5" y="-1883.59" font-family="Arial" font-size="14.00">Up&#45;proj → Activation → Down&#45;proj</text>
</g>
<!-- layer0_route_dp0&#45;&gt;layer0_expert2_dp0 -->
<g id="edge25" class="edge">
<title>layer0_route_dp0&#45;&gt;layer0_expert2_dp0</title>
<path fill="none" stroke="black" d="M1040.5,-1994.4C1040.5,-1986.03 1040.5,-1977.47 1040.5,-1969.26"/>
<polygon fill="black" stroke="black" points="1044,-1969.08 1040.5,-1959.08 1037,-1969.08 1044,-1969.08"/>
</g>
<!-- layer0_expert3_dp0 -->
<g id="node24" class="node">
<title>layer0_expert3_dp0</title>
<polygon fill="lightsteelblue" stroke="black" points="1582,-1958.79 1233,-1958.79 1233,-1875.79 1582,-1875.79 1582,-1958.79"/>
<text text-anchor="middle" x="1407.5" y="-1943.59" font-family="Arial" font-size="14.00">Layer 0: Expert 3 DP0</text>
<text text-anchor="middle" x="1407.5" y="-1928.59" font-family="Arial" font-size="14.00">GPU: DP0_EP1</text>
<text text-anchor="middle" x="1407.5" y="-1913.59" font-family="Arial" font-size="14.00">Input: [batch_size=2, seq_len=64, hidden_size=4096]</text>
<text text-anchor="middle" x="1407.5" y="-1898.59" font-family="Arial" font-size="14.00">Output: [batch_size=2, seq_len=64, hidden_size=4096]</text>
<text text-anchor="middle" x="1407.5" y="-1883.59" font-family="Arial" font-size="14.00">Up&#45;proj → Activation → Down&#45;proj</text>
</g>
<!-- layer0_route_dp0&#45;&gt;layer0_expert3_dp0 -->
<g id="edge26" class="edge">
<title>layer0_route_dp0&#45;&gt;layer0_expert3_dp0</title>
<path fill="none" stroke="black" d="M1148.13,-2013.12C1191.77,-1997.16 1242.36,-1978.67 1287.21,-1962.27"/>
<polygon fill="black" stroke="black" points="1288.49,-1965.53 1296.68,-1958.8 1286.09,-1958.95 1288.49,-1965.53"/>
</g>
<!-- layer0_ep_a2a_dp0 -->
<g id="node25" class="node">
<title>layer0_ep_a2a_dp0</title>
<ellipse fill="orange" stroke="black" cx="1040.5" cy="-1791.7" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1040.5" y="-1810.5" font-family="Arial" font-size="14.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="1040.5" y="-1795.5" font-family="Arial" font-size="14.00">EP Group: DP0_EP0&#45;DP0_EP31</text>
<text text-anchor="middle" x="1040.5" y="-1780.5" font-family="Arial" font-size="14.00">Token dispatch/combine</text>
<text text-anchor="middle" x="1040.5" y="-1765.5" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_expert0_dp0&#45;&gt;layer0_ep_a2a_dp0 -->
<g id="edge27" class="edge">
<title>layer0_expert0_dp0&#45;&gt;layer0_ep_a2a_dp0</title>
<path fill="none" stroke="black" d="M481.28,-1877.33C484.04,-1876.81 486.78,-1876.29 489.5,-1875.79 600.3,-1855.2 724.36,-1836.14 826.67,-1821.49"/>
<polygon fill="black" stroke="black" points="827.41,-1824.92 836.82,-1820.04 826.42,-1817.99 827.41,-1824.92"/>
</g>
<!-- layer0_expert1_dp0&#45;&gt;layer0_ep_a2a_dp0 -->
<g id="edge28" class="edge">
<title>layer0_expert1_dp0&#45;&gt;layer0_ep_a2a_dp0</title>
<path fill="none" stroke="black" d="M793.92,-1875.73C830.57,-1863.4 871.03,-1849.77 908.4,-1837.19"/>
<polygon fill="black" stroke="black" points="909.97,-1840.35 918.33,-1833.84 907.74,-1833.71 909.97,-1840.35"/>
</g>
<!-- layer0_expert2_dp0&#45;&gt;layer0_ep_a2a_dp0 -->
<g id="edge29" class="edge">
<title>layer0_expert2_dp0&#45;&gt;layer0_ep_a2a_dp0</title>
<path fill="none" stroke="black" d="M1040.5,-1875.48C1040.5,-1867.29 1040.5,-1858.55 1040.5,-1849.92"/>
<polygon fill="black" stroke="black" points="1044,-1849.89 1040.5,-1839.89 1037,-1849.89 1044,-1849.89"/>
</g>
<!-- layer0_expert3_dp0&#45;&gt;layer0_ep_a2a_dp0 -->
<g id="edge30" class="edge">
<title>layer0_expert3_dp0&#45;&gt;layer0_ep_a2a_dp0</title>
<path fill="none" stroke="black" d="M1287.08,-1875.73C1250.43,-1863.4 1209.97,-1849.77 1172.6,-1837.19"/>
<polygon fill="black" stroke="black" points="1173.26,-1833.71 1162.67,-1833.84 1171.03,-1840.35 1173.26,-1833.71"/>
</g>
<!-- layer0_expert_combine_dp0 -->
<g id="node26" class="node">
<title>layer0_expert_combine_dp0</title>
<polygon fill="lightyellow" stroke="black" points="1504.27,-1707.62 892.19,-1707.62 734.73,-1571.62 1346.81,-1571.62 1504.27,-1707.62"/>
<text text-anchor="middle" x="1119.5" y="-1658.42" font-family="Arial" font-size="14.00">Expert Combine DP0</text>
<text text-anchor="middle" x="1119.5" y="-1643.42" font-family="Arial" font-size="14.00">GPU: DP0_EP0&#45;DP0_EP31</text>
<text text-anchor="middle" x="1119.5" y="-1628.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1119.5" y="-1613.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_ep_a2a_dp0&#45;&gt;layer0_expert_combine_dp0 -->
<g id="edge31" class="edge">
<title>layer0_ep_a2a_dp0&#45;&gt;layer0_expert_combine_dp0</title>
<path fill="none" stroke="black" d="M1065.28,-1743.63C1069.76,-1735.12 1074.53,-1726.05 1079.32,-1716.95"/>
<polygon fill="black" stroke="black" points="1082.54,-1718.34 1084.1,-1707.87 1076.35,-1715.08 1082.54,-1718.34"/>
</g>
<!-- layer0_expert_combine_dp0&#45;&gt;layer0_moe_residual_dp0 -->
<g id="edge32" class="edge">
<title>layer0_expert_combine_dp0&#45;&gt;layer0_moe_residual_dp0</title>
<path fill="none" stroke="black" d="M1350.62,-1574.6C1395.55,-1562.16 1441.11,-1549.54 1481.28,-1538.41"/>
<polygon fill="black" stroke="black" points="1482.4,-1541.73 1491.1,-1535.69 1480.53,-1534.99 1482.4,-1541.73"/>
</g>
<!-- layers1to3_dp0 -->
<g id="node28" class="node">
<title>layers1to3_dp0</title>
<polygon fill="lightgray" stroke="black" points="1770,-1431.62 1539,-1431.62 1539,-1363.62 1770,-1363.62 1770,-1431.62"/>
<text text-anchor="middle" x="1654.5" y="-1416.42" font-family="Arial" font-size="14.00">Layers 1&#45;3 DP0</text>
<text text-anchor="middle" x="1654.5" y="-1401.42" font-family="Arial" font-size="14.00">Complete attention + MoE structure</text>
<text text-anchor="middle" x="1654.5" y="-1386.42" font-family="Arial" font-size="14.00">4 layers per stage</text>
<text text-anchor="middle" x="1654.5" y="-1371.42" font-family="Arial" font-size="14.00">TP=16, EP=32 (2 experts/GPU)</text>
</g>
<!-- layer0_moe_residual_dp0&#45;&gt;layers1to3_dp0 -->
<g id="edge34" class="edge">
<title>layer0_moe_residual_dp0&#45;&gt;layers1to3_dp0</title>
<path fill="none" stroke="black" d="M1624.79,-1467.5C1628.4,-1459.13 1632.33,-1450.02 1636.11,-1441.25"/>
<polygon fill="black" stroke="black" points="1639.39,-1442.49 1640.14,-1431.92 1632.96,-1439.71 1639.39,-1442.49"/>
</g>
<!-- pp0_to_pp1_dp0 -->
<g id="node29" class="node">
<title>pp0_to_pp1_dp0</title>
<ellipse fill="orange" stroke="black" cx="1676.5" cy="-1279.54" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1676.5" y="-1298.34" font-family="Arial" font-size="14.00">Pipeline Transfer DP0</text>
<text text-anchor="middle" x="1676.5" y="-1283.34" font-family="Arial" font-size="14.00">PP0 → PP1</text>
<text text-anchor="middle" x="1676.5" y="-1268.34" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="1676.5" y="-1253.34" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layers1to3_dp0&#45;&gt;pp0_to_pp1_dp0 -->
<g id="edge35" class="edge">
<title>layers1to3_dp0&#45;&gt;pp0_to_pp1_dp0</title>
<path fill="none" stroke="black" d="M1660.8,-1363.35C1662.34,-1355.27 1664.02,-1346.4 1665.69,-1337.57"/>
<polygon fill="black" stroke="black" points="1669.15,-1338.12 1667.57,-1327.65 1662.27,-1336.82 1669.15,-1338.12"/>
</g>
<!-- pp1_dp0_start -->
<g id="node32" class="node">
<title>pp1_dp0_start</title>
<polygon fill="yellow" stroke="black" points="2109.42,-1195.45 1438.24,-1195.45 1265.58,-1059.45 1936.76,-1059.45 2109.42,-1195.45"/>
<text text-anchor="middle" x="1687.5" y="-1146.25" font-family="Arial" font-size="14.00">PP Stage 1 DP0</text>
<text text-anchor="middle" x="1687.5" y="-1131.25" font-family="Arial" font-size="14.00">GPU: DP0_PP1_TP0&#45;DP0_PP1_TP15</text>
<text text-anchor="middle" x="1687.5" y="-1116.25" font-family="Arial" font-size="14.00">Layers 4&#45;7 (4 layers)</text>
<text text-anchor="middle" x="1687.5" y="-1101.25" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp0_to_pp1_dp0&#45;&gt;pp1_dp0_start -->
<g id="edge36" class="edge">
<title>pp0_to_pp1_dp0&#45;&gt;pp1_dp0_start</title>
<path fill="none" stroke="black" d="M1679.98,-1231.05C1680.57,-1222.96 1681.2,-1214.38 1681.83,-1205.76"/>
<polygon fill="black" stroke="black" points="1685.33,-1205.88 1682.58,-1195.65 1678.35,-1205.37 1685.33,-1205.88"/>
</g>
<!-- pp1_to_pp2_dp0 -->
<g id="node30" class="node">
<title>pp1_to_pp2_dp0</title>
<ellipse fill="orange" stroke="black" cx="1693.5" cy="-975.37" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1693.5" y="-994.17" font-family="Arial" font-size="14.00">Pipeline Transfer DP0</text>
<text text-anchor="middle" x="1693.5" y="-979.17" font-family="Arial" font-size="14.00">PP1 → PP2</text>
<text text-anchor="middle" x="1693.5" y="-964.17" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="1693.5" y="-949.17" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp2_dp0_start -->
<g id="node33" class="node">
<title>pp2_dp0_start</title>
<polygon fill="yellow" stroke="black" points="2118.42,-891.29 1447.24,-891.29 1274.58,-755.29 1945.76,-755.29 2118.42,-891.29"/>
<text text-anchor="middle" x="1696.5" y="-842.09" font-family="Arial" font-size="14.00">PP Stage 2 DP0</text>
<text text-anchor="middle" x="1696.5" y="-827.09" font-family="Arial" font-size="14.00">GPU: DP0_PP2_TP0&#45;DP0_PP2_TP15</text>
<text text-anchor="middle" x="1696.5" y="-812.09" font-family="Arial" font-size="14.00">Layers 8&#45;11 (4 layers)</text>
<text text-anchor="middle" x="1696.5" y="-797.09" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp1_to_pp2_dp0&#45;&gt;pp2_dp0_start -->
<g id="edge38" class="edge">
<title>pp1_to_pp2_dp0&#45;&gt;pp2_dp0_start</title>
<path fill="none" stroke="black" d="M1694.45,-926.88C1694.61,-918.8 1694.78,-910.21 1694.95,-901.59"/>
<polygon fill="black" stroke="black" points="1698.46,-901.55 1695.16,-891.48 1691.46,-901.41 1698.46,-901.55"/>
</g>
<!-- pp2_to_pp3_dp0 -->
<g id="node31" class="node">
<title>pp2_to_pp3_dp0</title>
<ellipse fill="orange" stroke="black" cx="1697.5" cy="-671.2" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="1697.5" y="-690" font-family="Arial" font-size="14.00">Pipeline Transfer DP0</text>
<text text-anchor="middle" x="1697.5" y="-675" font-family="Arial" font-size="14.00">PP2 → PP3</text>
<text text-anchor="middle" x="1697.5" y="-660" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="1697.5" y="-645" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp3_dp0_start -->
<g id="node34" class="node">
<title>pp3_dp0_start</title>
<polygon fill="yellow" stroke="black" points="2120.42,-587.12 1449.24,-587.12 1276.58,-451.12 1947.76,-451.12 2120.42,-587.12"/>
<text text-anchor="middle" x="1698.5" y="-537.92" font-family="Arial" font-size="14.00">PP Stage 3 DP0</text>
<text text-anchor="middle" x="1698.5" y="-522.92" font-family="Arial" font-size="14.00">GPU: DP0_PP3_TP0&#45;DP0_PP3_TP15</text>
<text text-anchor="middle" x="1698.5" y="-507.92" font-family="Arial" font-size="14.00">Layers 12&#45;15 (4 layers)</text>
<text text-anchor="middle" x="1698.5" y="-492.92" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp2_to_pp3_dp0&#45;&gt;pp3_dp0_start -->
<g id="edge40" class="edge">
<title>pp2_to_pp3_dp0&#45;&gt;pp3_dp0_start</title>
<path fill="none" stroke="black" d="M1697.82,-622.72C1697.87,-614.63 1697.93,-606.05 1697.98,-597.43"/>
<polygon fill="black" stroke="black" points="1701.49,-597.34 1698.05,-587.31 1694.49,-597.29 1701.49,-597.34"/>
</g>
<!-- pp1_dp0_start&#45;&gt;pp1_to_pp2_dp0 -->
<g id="edge37" class="edge">
<title>pp1_dp0_start&#45;&gt;pp1_to_pp2_dp0</title>
<path fill="none" stroke="black" d="M1690.18,-1059.31C1690.53,-1050.77 1690.87,-1042.08 1691.21,-1033.71"/>
<polygon fill="black" stroke="black" points="1694.71,-1033.82 1691.61,-1023.69 1687.71,-1033.54 1694.71,-1033.82"/>
</g>
<!-- pp2_dp0_start&#45;&gt;pp2_to_pp3_dp0 -->
<g id="edge39" class="edge">
<title>pp2_dp0_start&#45;&gt;pp2_to_pp3_dp0</title>
<path fill="none" stroke="black" d="M1696.95,-755.15C1697,-746.6 1697.06,-737.92 1697.12,-729.55"/>
<polygon fill="black" stroke="black" points="1700.62,-729.54 1697.18,-719.52 1693.62,-729.5 1700.62,-729.54"/>
</g>
<!-- final_norm_dp0 -->
<g id="node35" class="node">
<title>final_norm_dp0</title>
<polygon fill="lightgreen" stroke="black" points="1909,-415.12 1538,-415.12 1538,-347.12 1909,-347.12 1909,-415.12"/>
<text text-anchor="middle" x="1723.5" y="-399.92" font-family="Arial" font-size="14.00">Final RMSNorm DP0</text>
<text text-anchor="middle" x="1723.5" y="-384.92" font-family="Arial" font-size="14.00">GPU: DP0_PP3_TP0&#45;DP0_PP3_TP15</text>
<text text-anchor="middle" x="1723.5" y="-369.92" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1723.5" y="-354.92" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp3_dp0_start&#45;&gt;final_norm_dp0 -->
<g id="edge41" class="edge">
<title>pp3_dp0_start&#45;&gt;final_norm_dp0</title>
<path fill="none" stroke="black" d="M1710.85,-450.92C1712.46,-442.16 1714.07,-433.4 1715.58,-425.19"/>
<polygon fill="black" stroke="black" points="1719.07,-425.6 1717.43,-415.14 1712.18,-424.34 1719.07,-425.6"/>
</g>
<!-- output_proj_dp0 -->
<g id="node36" class="node">
<title>output_proj_dp0</title>
<polygon fill="lightgreen" stroke="black" points="1959.5,-311.12 1585.5,-311.12 1585.5,-243.12 1959.5,-243.12 1959.5,-311.12"/>
<text text-anchor="middle" x="1772.5" y="-295.92" font-family="Arial" font-size="14.00">Output Projection DP0</text>
<text text-anchor="middle" x="1772.5" y="-280.92" font-family="Arial" font-size="14.00">GPU: DP0_PP3_TP0&#45;DP0_PP3_TP15</text>
<text text-anchor="middle" x="1772.5" y="-265.92" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1772.5" y="-250.92" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- final_norm_dp0&#45;&gt;output_proj_dp0 -->
<g id="edge42" class="edge">
<title>final_norm_dp0&#45;&gt;output_proj_dp0</title>
<path fill="none" stroke="black" d="M1739.41,-347C1743.47,-338.54 1747.9,-329.33 1752.15,-320.47"/>
<polygon fill="black" stroke="black" points="1755.33,-321.95 1756.5,-311.42 1749.02,-318.92 1755.33,-321.95"/>
</g>
<!-- dp_combine -->
<g id="node68" class="node">
<title>dp_combine</title>
<ellipse fill="orange" stroke="black" cx="2296.5" cy="-159.04" rx="270.23" ry="48.17"/>
<text text-anchor="middle" x="2296.5" y="-177.84" font-family="Arial" font-size="14.00">Data Parallelism Combine</text>
<text text-anchor="middle" x="2296.5" y="-162.84" font-family="Arial" font-size="14.00">GPU: Output aggregation</text>
<text text-anchor="middle" x="2296.5" y="-147.84" font-family="Arial" font-size="14.00">Input: 4×[batch_size=32, seq_len=1024, vocab_size=51200]</text>
<text text-anchor="middle" x="2296.5" y="-132.84" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- output_proj_dp0&#45;&gt;dp_combine -->
<g id="edge43" class="edge">
<title>output_proj_dp0&#45;&gt;dp_combine</title>
<path fill="none" stroke="black" d="M1921.61,-243.09C1983.33,-229.41 2055.39,-213.45 2119.75,-199.19"/>
<polygon fill="black" stroke="black" points="2120.6,-202.59 2129.6,-197.01 2119.08,-195.76 2120.6,-202.59"/>
</g>
<!-- hidden_up_dp1 -->
<g id="node38" class="node">
<title>hidden_up_dp1</title>
<polygon fill="lightgreen" stroke="black" points="2201,-4082.62 1830,-4082.62 1830,-3999.62 2201,-3999.62 2201,-4082.62"/>
<text text-anchor="middle" x="2015.5" y="-4067.42" font-family="Arial" font-size="14.00">Hidden Upscaling DP1</text>
<text text-anchor="middle" x="2015.5" y="-4052.42" font-family="Arial" font-size="14.00">GPU: DP1_TP0&#45;DP1_TP15</text>
<text text-anchor="middle" x="2015.5" y="-4037.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=256]</text>
<text text-anchor="middle" x="2015.5" y="-4022.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="2015.5" y="-4007.42" font-family="Arial" font-size="14.00">TP=16: All&#45;Gather operation</text>
</g>
<!-- embed_dp1&#45;&gt;hidden_up_dp1 -->
<g id="edge45" class="edge">
<title>embed_dp1&#45;&gt;hidden_up_dp1</title>
<path fill="none" stroke="black" d="M2048.81,-4118.53C2045.09,-4110 2041.12,-4100.9 2037.28,-4092.07"/>
<polygon fill="black" stroke="black" points="2040.37,-4090.41 2033.16,-4082.64 2033.95,-4093.2 2040.37,-4090.41"/>
</g>
<!-- pp0_dp1_start -->
<g id="node39" class="node">
<title>pp0_dp1_start</title>
<polygon fill="yellow" stroke="black" points="1987.42,-3963.62 1316.24,-3963.62 1143.58,-3827.62 1814.76,-3827.62 1987.42,-3963.62"/>
<text text-anchor="middle" x="1565.5" y="-3914.42" font-family="Arial" font-size="14.00">PP Stage 0 DP1</text>
<text text-anchor="middle" x="1565.5" y="-3899.42" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP15</text>
<text text-anchor="middle" x="1565.5" y="-3884.42" font-family="Arial" font-size="14.00">Layers 0&#45;3 (4 layers)</text>
<text text-anchor="middle" x="1565.5" y="-3869.42" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- hidden_up_dp1&#45;&gt;pp0_dp1_start -->
<g id="edge46" class="edge">
<title>hidden_up_dp1&#45;&gt;pp0_dp1_start</title>
<path fill="none" stroke="black" d="M1888.35,-3999.57C1856.28,-3989.35 1820.92,-3978.07 1785.71,-3966.84"/>
<polygon fill="black" stroke="black" points="1786.37,-3963.38 1775.78,-3963.68 1784.25,-3970.05 1786.37,-3963.38"/>
</g>
<!-- layer0_attn_residual_dp1 -->
<g id="node50" class="node">
<title>layer0_attn_residual_dp1</title>
<polygon fill="lightcoral" stroke="black" points="2204.5,-2671.12 1826.5,-2671.12 1826.5,-2603.12 2204.5,-2603.12 2204.5,-2671.12"/>
<text text-anchor="middle" x="2015.5" y="-2655.92" font-family="Arial" font-size="14.00">Layer 0: Attention Residual DP1</text>
<text text-anchor="middle" x="2015.5" y="-2640.92" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP15</text>
<text text-anchor="middle" x="2015.5" y="-2625.92" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096] x2</text>
<text text-anchor="middle" x="2015.5" y="-2610.92" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- hidden_up_dp1&#45;&gt;layer0_attn_residual_dp1 -->
<g id="edge60" class="edge">
<title>hidden_up_dp1&#45;&gt;layer0_attn_residual_dp1</title>
<path fill="none" stroke="black" d="M2015.5,-3999.56C2015.5,-3944.86 2015.5,-3844.39 2015.5,-3758.62 2015.5,-3758.62 2015.5,-3758.62 2015.5,-2878.12 2015.5,-2809.41 2015.5,-2729.64 2015.5,-2681.56"/>
<polygon fill="black" stroke="black" points="2019,-2681.51 2015.5,-2671.51 2012,-2681.51 2019,-2681.51"/>
</g>
<!-- layer0_norm_dp1 -->
<g id="node40" class="node">
<title>layer0_norm_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1797,-3791.62 1426,-3791.62 1426,-3723.62 1797,-3723.62 1797,-3791.62"/>
<text text-anchor="middle" x="1611.5" y="-3776.42" font-family="Arial" font-size="14.00">Layer 0: RMSNorm DP1</text>
<text text-anchor="middle" x="1611.5" y="-3761.42" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP15</text>
<text text-anchor="middle" x="1611.5" y="-3746.42" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1611.5" y="-3731.42" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp0_dp1_start&#45;&gt;layer0_norm_dp1 -->
<g id="edge47" class="edge">
<title>pp0_dp1_start&#45;&gt;layer0_norm_dp1</title>
<path fill="none" stroke="black" d="M1588.23,-3827.42C1591.26,-3818.47 1594.29,-3809.5 1597.12,-3801.14"/>
<polygon fill="black" stroke="black" points="1600.44,-3802.23 1600.33,-3791.64 1593.81,-3799.99 1600.44,-3802.23"/>
</g>
<!-- layer0_q_proj_dp1 -->
<g id="node41" class="node">
<title>layer0_q_proj_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1448,-3673.54 1067,-3673.54 1067,-3605.54 1448,-3605.54 1448,-3673.54"/>
<text text-anchor="middle" x="1257.5" y="-3658.34" font-family="Arial" font-size="14.00">Layer 0: Q Projection DP1</text>
<text text-anchor="middle" x="1257.5" y="-3643.34" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP15</text>
<text text-anchor="middle" x="1257.5" y="-3628.34" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1257.5" y="-3613.34" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp1&#45;&gt;layer0_q_proj_dp1 -->
<g id="edge48" class="edge">
<title>layer0_norm_dp1&#45;&gt;layer0_q_proj_dp1</title>
<path fill="none" stroke="black" d="M1510.53,-3723.51C1465.98,-3708.9 1413.5,-3691.69 1367.91,-3676.74"/>
<polygon fill="black" stroke="black" points="1368.89,-3673.38 1358.3,-3673.59 1366.71,-3680.03 1368.89,-3673.38"/>
</g>
<!-- layer0_k_proj_dp1 -->
<g id="node42" class="node">
<title>layer0_k_proj_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1847,-3673.54 1466,-3673.54 1466,-3605.54 1847,-3605.54 1847,-3673.54"/>
<text text-anchor="middle" x="1656.5" y="-3658.34" font-family="Arial" font-size="14.00">Layer 0: K Projection DP1</text>
<text text-anchor="middle" x="1656.5" y="-3643.34" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP15</text>
<text text-anchor="middle" x="1656.5" y="-3628.34" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1656.5" y="-3613.34" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp1&#45;&gt;layer0_k_proj_dp1 -->
<g id="edge49" class="edge">
<title>layer0_norm_dp1&#45;&gt;layer0_k_proj_dp1</title>
<path fill="none" stroke="black" d="M1624.4,-3723.35C1629.24,-3710.85 1634.82,-3696.45 1639.96,-3683.2"/>
<polygon fill="black" stroke="black" points="1643.25,-3684.39 1643.6,-3673.8 1636.73,-3681.86 1643.25,-3684.39"/>
</g>
<!-- layer0_v_proj_dp1 -->
<g id="node43" class="node">
<title>layer0_v_proj_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1988,-3521.45 1607,-3521.45 1607,-3453.45 1988,-3453.45 1988,-3521.45"/>
<text text-anchor="middle" x="1797.5" y="-3506.25" font-family="Arial" font-size="14.00">Layer 0: V Projection DP1</text>
<text text-anchor="middle" x="1797.5" y="-3491.25" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP15</text>
<text text-anchor="middle" x="1797.5" y="-3476.25" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="1797.5" y="-3461.25" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_norm_dp1&#45;&gt;layer0_v_proj_dp1 -->
<g id="edge50" class="edge">
<title>layer0_norm_dp1&#45;&gt;layer0_v_proj_dp1</title>
<path fill="none" stroke="black" d="M1784.55,-3723.6C1817.9,-3713.73 1845.83,-3701.71 1856.5,-3687.62 1891.91,-3640.86 1858.51,-3573.11 1829.44,-3529.93"/>
<polygon fill="black" stroke="black" points="1832.27,-3527.87 1823.7,-3521.63 1826.51,-3531.85 1832.27,-3527.87"/>
</g>
<!-- layer0_qk_matmul_dp1 -->
<g id="node44" class="node">
<title>layer0_qk_matmul_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1588.5,-3521.45 1174.5,-3521.45 1174.5,-3453.45 1588.5,-3453.45 1588.5,-3521.45"/>
<text text-anchor="middle" x="1381.5" y="-3506.25" font-family="Arial" font-size="14.00">Layer 0: QK^T MatMul DP1</text>
<text text-anchor="middle" x="1381.5" y="-3491.25" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP15</text>
<text text-anchor="middle" x="1381.5" y="-3476.25" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, heads=32, d_k=128] x2</text>
<text text-anchor="middle" x="1381.5" y="-3461.25" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_q_proj_dp1&#45;&gt;layer0_qk_matmul_dp1 -->
<g id="edge51" class="edge">
<title>layer0_q_proj_dp1&#45;&gt;layer0_qk_matmul_dp1</title>
<path fill="none" stroke="black" d="M1285.02,-3605.23C1303.48,-3582.88 1327.92,-3553.3 1347.59,-3529.5"/>
<polygon fill="black" stroke="black" points="1350.39,-3531.61 1354.06,-3521.67 1344.99,-3527.15 1350.39,-3531.61"/>
</g>
<!-- layer0_k_proj_dp1&#45;&gt;layer0_qk_matmul_dp1 -->
<g id="edge52" class="edge">
<title>layer0_k_proj_dp1&#45;&gt;layer0_qk_matmul_dp1</title>
<path fill="none" stroke="black" d="M1595.81,-3605.41C1553.04,-3582.07 1495.68,-3550.77 1451.07,-3526.42"/>
<polygon fill="black" stroke="black" points="1452.49,-3523.21 1442.04,-3521.49 1449.14,-3529.35 1452.49,-3523.21"/>
</g>
<!-- layer0_attn_v_matmul_dp1 -->
<g id="node48" class="node">
<title>layer0_attn_v_matmul_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1987,-2913.12 1254,-2913.12 1254,-2845.12 1987,-2845.12 1987,-2913.12"/>
<text text-anchor="middle" x="1620.5" y="-2897.92" font-family="Arial" font-size="14.00">Layer 0: Attention V MatMul DP1</text>
<text text-anchor="middle" x="1620.5" y="-2882.92" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP15</text>
<text text-anchor="middle" x="1620.5" y="-2867.92" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, seq_len=1024, heads=32] x [batch_size=32, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="1620.5" y="-2852.92" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- layer0_v_proj_dp1&#45;&gt;layer0_attn_v_matmul_dp1 -->
<g id="edge57" class="edge">
<title>layer0_v_proj_dp1&#45;&gt;layer0_attn_v_matmul_dp1</title>
<path fill="none" stroke="black" d="M1792.81,-3453.44C1780.52,-3371.62 1743.64,-3153.78 1677.5,-2983.12 1669.38,-2962.16 1657.71,-2940.19 1647.04,-2921.96"/>
<polygon fill="black" stroke="black" points="1650.03,-2920.13 1641.91,-2913.32 1644.01,-2923.71 1650.03,-2920.13"/>
</g>
<!-- layer0_attn_scale_dp1 -->
<g id="node45" class="node">
<title>layer0_attn_scale_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1611.5,-3369.37 1197.5,-3369.37 1197.5,-3301.37 1611.5,-3301.37 1611.5,-3369.37"/>
<text text-anchor="middle" x="1404.5" y="-3354.17" font-family="Arial" font-size="14.00">Layer 0: Attention Scale DP1</text>
<text text-anchor="middle" x="1404.5" y="-3339.17" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP15</text>
<text text-anchor="middle" x="1404.5" y="-3324.17" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="1404.5" y="-3309.17" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_qk_matmul_dp1&#45;&gt;layer0_attn_scale_dp1 -->
<g id="edge53" class="edge">
<title>layer0_qk_matmul_dp1&#45;&gt;layer0_attn_scale_dp1</title>
<path fill="none" stroke="black" d="M1386.6,-3453.14C1389.92,-3431.48 1394.29,-3403.01 1397.87,-3379.6"/>
<polygon fill="black" stroke="black" points="1401.35,-3380 1399.41,-3369.58 1394.44,-3378.94 1401.35,-3380"/>
</g>
<!-- layer0_attn_mask_dp1 -->
<g id="node46" class="node">
<title>layer0_attn_mask_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1622.5,-3217.29 1208.5,-3217.29 1208.5,-3149.29 1622.5,-3149.29 1622.5,-3217.29"/>
<text text-anchor="middle" x="1415.5" y="-3202.09" font-family="Arial" font-size="14.00">Layer 0: Attention Mask DP1</text>
<text text-anchor="middle" x="1415.5" y="-3187.09" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP15</text>
<text text-anchor="middle" x="1415.5" y="-3172.09" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="1415.5" y="-3157.09" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_attn_scale_dp1&#45;&gt;layer0_attn_mask_dp1 -->
<g id="edge54" class="edge">
<title>layer0_attn_scale_dp1&#45;&gt;layer0_attn_mask_dp1</title>
<path fill="none" stroke="black" d="M1406.94,-3301.06C1408.53,-3279.4 1410.62,-3250.92 1412.33,-3227.52"/>
<polygon fill="black" stroke="black" points="1415.83,-3227.73 1413.07,-3217.5 1408.84,-3227.22 1415.83,-3227.73"/>
</g>
<!-- layer0_attn_softmax_dp1 -->
<g id="node47" class="node">
<title>layer0_attn_softmax_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1668.5,-3065.2 1254.5,-3065.2 1254.5,-2997.2 1668.5,-2997.2 1668.5,-3065.2"/>
<text text-anchor="middle" x="1461.5" y="-3050" font-family="Arial" font-size="14.00">Layer 0: Softmax DP1</text>
<text text-anchor="middle" x="1461.5" y="-3035" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP15</text>
<text text-anchor="middle" x="1461.5" y="-3020" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
<text text-anchor="middle" x="1461.5" y="-3005" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, seq_len=1024, heads=32]</text>
</g>
<!-- layer0_attn_mask_dp1&#45;&gt;layer0_attn_softmax_dp1 -->
<g id="edge55" class="edge">
<title>layer0_attn_mask_dp1&#45;&gt;layer0_attn_softmax_dp1</title>
<path fill="none" stroke="black" d="M1425.71,-3148.98C1432.38,-3127.21 1441.15,-3098.59 1448.35,-3075.12"/>
<polygon fill="black" stroke="black" points="1451.74,-3076 1451.32,-3065.42 1445.04,-3073.95 1451.74,-3076"/>
</g>
<!-- layer0_attn_softmax_dp1&#45;&gt;layer0_attn_v_matmul_dp1 -->
<g id="edge56" class="edge">
<title>layer0_attn_softmax_dp1&#45;&gt;layer0_attn_v_matmul_dp1</title>
<path fill="none" stroke="black" d="M1496.79,-2996.89C1520.77,-2974.26 1552.62,-2944.19 1578,-2920.24"/>
<polygon fill="black" stroke="black" points="1580.44,-2922.74 1585.31,-2913.33 1575.64,-2917.65 1580.44,-2922.74"/>
</g>
<!-- layer0_attn_out_proj_dp1 -->
<g id="node49" class="node">
<title>layer0_attn_out_proj_dp1</title>
<polygon fill="lightcoral" stroke="black" points="1897,-2775.12 1526,-2775.12 1526,-2707.12 1897,-2707.12 1897,-2775.12"/>
<text text-anchor="middle" x="1711.5" y="-2759.92" font-family="Arial" font-size="14.00">Layer 0: Attention Output Projection DP1</text>
<text text-anchor="middle" x="1711.5" y="-2744.92" font-family="Arial" font-size="14.00">GPU: DP1_PP0_TP0&#45;DP1_PP0_TP15</text>
<text text-anchor="middle" x="1711.5" y="-2729.92" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="1711.5" y="-2714.92" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_v_matmul_dp1&#45;&gt;layer0_attn_out_proj_dp1 -->
<g id="edge58" class="edge">
<title>layer0_attn_v_matmul_dp1&#45;&gt;layer0_attn_out_proj_dp1</title>
<path fill="none" stroke="black" d="M1642.76,-2844.85C1655.04,-2826.49 1670.42,-2803.52 1683.51,-2783.95"/>
<polygon fill="black" stroke="black" points="1686.5,-2785.77 1689.15,-2775.52 1680.68,-2781.88 1686.5,-2785.77"/>
</g>
<!-- layer0_attn_out_proj_dp1&#45;&gt;layer0_attn_residual_dp1 -->
<g id="edge59" class="edge">
<title>layer0_attn_out_proj_dp1&#45;&gt;layer0_attn_residual_dp1</title>
<path fill="none" stroke="black" d="M1810.2,-2707C1841.23,-2696.59 1875.65,-2685.04 1907.31,-2674.42"/>
<polygon fill="black" stroke="black" points="1908.67,-2677.66 1917.04,-2671.16 1906.44,-2671.02 1908.67,-2677.66"/>
</g>
<!-- layer0_attn_ar_dp1 -->
<g id="node51" class="node">
<title>layer0_attn_ar_dp1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="2021.5" cy="-2529.64" rx="251.96" ry="37.45"/>
<text text-anchor="middle" x="2021.5" y="-2540.94" font-family="Arial" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="2021.5" y="-2525.94" font-family="Arial" font-size="14.00">TP Group: DP1_PP0_TP0&#45;DP1_PP0_TP15</text>
<text text-anchor="middle" x="2021.5" y="-2510.94" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layer0_attn_residual_dp1&#45;&gt;layer0_attn_ar_dp1 -->
<g id="edge61" class="edge">
<title>layer0_attn_residual_dp1&#45;&gt;layer0_attn_ar_dp1</title>
<path fill="none" stroke="black" d="M2017.38,-2603.03C2017.85,-2594.87 2018.35,-2585.97 2018.85,-2577.3"/>
<polygon fill="black" stroke="black" points="2022.34,-2577.46 2019.42,-2567.28 2015.35,-2577.06 2022.34,-2577.46"/>
</g>
<!-- layer0_norm2_dp1 -->
<g id="node70" class="node">
<title>layer0_norm2_dp1</title>
<polygon fill="lightgrey" stroke="black" points="2086.5,-2406.17 1956.5,-2406.17 1956.5,-2370.17 2086.5,-2370.17 2086.5,-2406.17"/>
<text text-anchor="middle" x="2021.5" y="-2384.47" font-family="Arial" font-size="14.00">layer0_norm2_dp1</text>
</g>
<!-- layer0_attn_ar_dp1&#45;&gt;layer0_norm2_dp1 -->
<g id="edge62" class="edge">
<title>layer0_attn_ar_dp1&#45;&gt;layer0_norm2_dp1</title>
<path fill="none" stroke="black" d="M2021.5,-2492C2021.5,-2468.38 2021.5,-2438.18 2021.5,-2416.63"/>
<polygon fill="black" stroke="black" points="2025,-2416.52 2021.5,-2406.52 2018,-2416.52 2025,-2416.52"/>
</g>
<!-- layer0_moe_residual_dp1 -->
<g id="node77" class="node">
<title>layer0_moe_residual_dp1</title>
<polygon fill="lightgrey" stroke="black" points="2219,-1519.62 2046,-1519.62 2046,-1483.62 2219,-1483.62 2219,-1519.62"/>
<text text-anchor="middle" x="2132.5" y="-1497.92" font-family="Arial" font-size="14.00">layer0_moe_residual_dp1</text>
</g>
<!-- layer0_attn_ar_dp1&#45;&gt;layer0_moe_residual_dp1 -->
<g id="edge71" class="edge">
<title>layer0_attn_ar_dp1&#45;&gt;layer0_moe_residual_dp1</title>
<path fill="none" stroke="black" d="M2067.48,-2492.65C2078.26,-2482.02 2088.6,-2469.6 2095.5,-2456.17 2144.63,-2360.56 2132.5,-2324.65 2132.5,-2217.17 2132.5,-2217.17 2132.5,-2217.17 2132.5,-1790.7 2132.5,-1694.95 2132.5,-1581.29 2132.5,-1530.07"/>
<polygon fill="black" stroke="black" points="2136,-1529.83 2132.5,-1519.83 2129,-1529.83 2136,-1529.83"/>
</g>
<!-- final_norm_dp1 -->
<g id="node52" class="node">
<title>final_norm_dp1</title>
<polygon fill="lightgreen" stroke="black" points="2375,-415.12 2004,-415.12 2004,-347.12 2375,-347.12 2375,-415.12"/>
<text text-anchor="middle" x="2189.5" y="-399.92" font-family="Arial" font-size="14.00">Final RMSNorm DP1</text>
<text text-anchor="middle" x="2189.5" y="-384.92" font-family="Arial" font-size="14.00">GPU: DP1_PP3_TP0&#45;DP1_PP3_TP15</text>
<text text-anchor="middle" x="2189.5" y="-369.92" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="2189.5" y="-354.92" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- output_proj_dp1 -->
<g id="node53" class="node">
<title>output_proj_dp1</title>
<polygon fill="lightgreen" stroke="black" points="2376.5,-311.12 2002.5,-311.12 2002.5,-243.12 2376.5,-243.12 2376.5,-311.12"/>
<text text-anchor="middle" x="2189.5" y="-295.92" font-family="Arial" font-size="14.00">Output Projection DP1</text>
<text text-anchor="middle" x="2189.5" y="-280.92" font-family="Arial" font-size="14.00">GPU: DP1_PP3_TP0&#45;DP1_PP3_TP15</text>
<text text-anchor="middle" x="2189.5" y="-265.92" font-family="Arial" font-size="14.00">Input: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="2189.5" y="-250.92" font-family="Arial" font-size="14.00">Output: [batch_size=32, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- final_norm_dp1&#45;&gt;output_proj_dp1 -->
<g id="edge80" class="edge">
<title>final_norm_dp1&#45;&gt;output_proj_dp1</title>
<path fill="none" stroke="black" d="M2189.5,-347C2189.5,-338.9 2189.5,-330.1 2189.5,-321.59"/>
<polygon fill="black" stroke="black" points="2193,-321.42 2189.5,-311.42 2186,-321.42 2193,-321.42"/>
</g>
<!-- output_proj_dp1&#45;&gt;dp_combine -->
<g id="edge81" class="edge">
<title>output_proj_dp1&#45;&gt;dp_combine</title>
<path fill="none" stroke="black" d="M2220.16,-242.86C2228.43,-233.89 2237.59,-223.94 2246.62,-214.15"/>
<polygon fill="black" stroke="black" points="2249.27,-216.44 2253.48,-206.71 2244.12,-211.69 2249.27,-216.44"/>
</g>
<!-- layers1to3_dp2 -->
<g id="node54" class="node">
<title>layers1to3_dp2</title>
<polygon fill="lightgray" stroke="black" points="2534,-3791.62 2303,-3791.62 2303,-3723.62 2534,-3723.62 2534,-3791.62"/>
<text text-anchor="middle" x="2418.5" y="-3776.42" font-family="Arial" font-size="14.00">Layers 1&#45;3 DP2</text>
<text text-anchor="middle" x="2418.5" y="-3761.42" font-family="Arial" font-size="14.00">Complete attention + MoE structure</text>
<text text-anchor="middle" x="2418.5" y="-3746.42" font-family="Arial" font-size="14.00">4 layers per stage</text>
<text text-anchor="middle" x="2418.5" y="-3731.42" font-family="Arial" font-size="14.00">TP=16, EP=32 (2 experts/GPU)</text>
</g>
<!-- pp0_to_pp1_dp2 -->
<g id="node56" class="node">
<title>pp0_to_pp1_dp2</title>
<ellipse fill="orange" stroke="black" cx="2434.5" cy="-3639.54" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="2434.5" y="-3658.34" font-family="Arial" font-size="14.00">Pipeline Transfer DP2</text>
<text text-anchor="middle" x="2434.5" y="-3643.34" font-family="Arial" font-size="14.00">PP0 → PP1</text>
<text text-anchor="middle" x="2434.5" y="-3628.34" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="2434.5" y="-3613.34" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layers1to3_dp2&#45;&gt;pp0_to_pp1_dp2 -->
<g id="edge86" class="edge">
<title>layers1to3_dp2&#45;&gt;pp0_to_pp1_dp2</title>
<path fill="none" stroke="black" d="M2423.08,-3723.35C2424.2,-3715.27 2425.42,-3706.4 2426.64,-3697.57"/>
<polygon fill="black" stroke="black" points="2430.11,-3698.03 2428.01,-3687.64 2423.17,-3697.07 2430.11,-3698.03"/>
</g>
<!-- layers1to3_dp3 -->
<g id="node55" class="node">
<title>layers1to3_dp3</title>
<polygon fill="lightgray" stroke="black" points="2950,-3791.62 2719,-3791.62 2719,-3723.62 2950,-3723.62 2950,-3791.62"/>
<text text-anchor="middle" x="2834.5" y="-3776.42" font-family="Arial" font-size="14.00">Layers 1&#45;3 DP3</text>
<text text-anchor="middle" x="2834.5" y="-3761.42" font-family="Arial" font-size="14.00">Complete attention + MoE structure</text>
<text text-anchor="middle" x="2834.5" y="-3746.42" font-family="Arial" font-size="14.00">4 layers per stage</text>
<text text-anchor="middle" x="2834.5" y="-3731.42" font-family="Arial" font-size="14.00">TP=16, EP=32 (2 experts/GPU)</text>
</g>
<!-- pp0_to_pp1_dp3 -->
<g id="node59" class="node">
<title>pp0_to_pp1_dp3</title>
<ellipse fill="orange" stroke="black" cx="3125.5" cy="-3639.54" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="3125.5" y="-3658.34" font-family="Arial" font-size="14.00">Pipeline Transfer DP3</text>
<text text-anchor="middle" x="3125.5" y="-3643.34" font-family="Arial" font-size="14.00">PP0 → PP1</text>
<text text-anchor="middle" x="3125.5" y="-3628.34" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="3125.5" y="-3613.34" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- layers1to3_dp3&#45;&gt;pp0_to_pp1_dp3 -->
<g id="edge99" class="edge">
<title>layers1to3_dp3&#45;&gt;pp0_to_pp1_dp3</title>
<path fill="none" stroke="black" d="M2917.5,-3723.51C2946.04,-3712.12 2978.55,-3699.15 3009.25,-3686.91"/>
<polygon fill="black" stroke="black" points="3010.72,-3690.09 3018.71,-3683.13 3008.13,-3683.59 3010.72,-3690.09"/>
</g>
<!-- pp1_dp2_start -->
<g id="node62" class="node">
<title>pp1_dp2_start</title>
<polygon fill="yellow" stroke="black" points="2887.42,-3555.45 2216.24,-3555.45 2043.58,-3419.45 2714.76,-3419.45 2887.42,-3555.45"/>
<text text-anchor="middle" x="2465.5" y="-3506.25" font-family="Arial" font-size="14.00">PP Stage 1 DP2</text>
<text text-anchor="middle" x="2465.5" y="-3491.25" font-family="Arial" font-size="14.00">GPU: DP2_PP1_TP0&#45;DP2_PP1_TP15</text>
<text text-anchor="middle" x="2465.5" y="-3476.25" font-family="Arial" font-size="14.00">Layers 4&#45;7 (4 layers)</text>
<text text-anchor="middle" x="2465.5" y="-3461.25" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp0_to_pp1_dp2&#45;&gt;pp1_dp2_start -->
<g id="edge87" class="edge">
<title>pp0_to_pp1_dp2&#45;&gt;pp1_dp2_start</title>
<path fill="none" stroke="black" d="M2444.22,-3591.46C2445.93,-3583.22 2447.74,-3574.44 2449.56,-3565.64"/>
<polygon fill="black" stroke="black" points="2453.01,-3566.2 2451.61,-3555.7 2446.16,-3564.78 2453.01,-3566.2"/>
</g>
<!-- pp1_to_pp2_dp2 -->
<g id="node57" class="node">
<title>pp1_to_pp2_dp2</title>
<ellipse fill="orange" stroke="black" cx="2465.5" cy="-3335.37" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="2465.5" y="-3354.17" font-family="Arial" font-size="14.00">Pipeline Transfer DP2</text>
<text text-anchor="middle" x="2465.5" y="-3339.17" font-family="Arial" font-size="14.00">PP1 → PP2</text>
<text text-anchor="middle" x="2465.5" y="-3324.17" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="2465.5" y="-3309.17" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp2_dp2_start -->
<g id="node63" class="node">
<title>pp2_dp2_start</title>
<polygon fill="yellow" stroke="black" points="2887.42,-3251.29 2216.24,-3251.29 2043.58,-3115.29 2714.76,-3115.29 2887.42,-3251.29"/>
<text text-anchor="middle" x="2465.5" y="-3202.09" font-family="Arial" font-size="14.00">PP Stage 2 DP2</text>
<text text-anchor="middle" x="2465.5" y="-3187.09" font-family="Arial" font-size="14.00">GPU: DP2_PP2_TP0&#45;DP2_PP2_TP15</text>
<text text-anchor="middle" x="2465.5" y="-3172.09" font-family="Arial" font-size="14.00">Layers 8&#45;11 (4 layers)</text>
<text text-anchor="middle" x="2465.5" y="-3157.09" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp1_to_pp2_dp2&#45;&gt;pp2_dp2_start -->
<g id="edge89" class="edge">
<title>pp1_to_pp2_dp2&#45;&gt;pp2_dp2_start</title>
<path fill="none" stroke="black" d="M2465.5,-3286.88C2465.5,-3278.8 2465.5,-3270.21 2465.5,-3261.59"/>
<polygon fill="black" stroke="black" points="2469,-3261.48 2465.5,-3251.48 2462,-3261.48 2469,-3261.48"/>
</g>
<!-- pp2_to_pp3_dp2 -->
<g id="node58" class="node">
<title>pp2_to_pp3_dp2</title>
<ellipse fill="orange" stroke="black" cx="2465.5" cy="-3031.2" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="2465.5" y="-3050" font-family="Arial" font-size="14.00">Pipeline Transfer DP2</text>
<text text-anchor="middle" x="2465.5" y="-3035" font-family="Arial" font-size="14.00">PP2 → PP3</text>
<text text-anchor="middle" x="2465.5" y="-3020" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="2465.5" y="-3005" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp3_dp2_start -->
<g id="node64" class="node">
<title>pp3_dp2_start</title>
<polygon fill="yellow" stroke="black" points="2887.42,-2947.12 2216.24,-2947.12 2043.58,-2811.12 2714.76,-2811.12 2887.42,-2947.12"/>
<text text-anchor="middle" x="2465.5" y="-2897.92" font-family="Arial" font-size="14.00">PP Stage 3 DP2</text>
<text text-anchor="middle" x="2465.5" y="-2882.92" font-family="Arial" font-size="14.00">GPU: DP2_PP3_TP0&#45;DP2_PP3_TP15</text>
<text text-anchor="middle" x="2465.5" y="-2867.92" font-family="Arial" font-size="14.00">Layers 12&#45;15 (4 layers)</text>
<text text-anchor="middle" x="2465.5" y="-2852.92" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp2_to_pp3_dp2&#45;&gt;pp3_dp2_start -->
<g id="edge91" class="edge">
<title>pp2_to_pp3_dp2&#45;&gt;pp3_dp2_start</title>
<path fill="none" stroke="black" d="M2465.5,-2982.71C2465.5,-2974.63 2465.5,-2966.05 2465.5,-2957.43"/>
<polygon fill="black" stroke="black" points="2469,-2957.31 2465.5,-2947.31 2462,-2957.31 2469,-2957.31"/>
</g>
<!-- pp1_dp3_start -->
<g id="node65" class="node">
<title>pp1_dp3_start</title>
<polygon fill="yellow" stroke="black" points="3749.42,-3555.45 3078.24,-3555.45 2905.58,-3419.45 3576.76,-3419.45 3749.42,-3555.45"/>
<text text-anchor="middle" x="3327.5" y="-3506.25" font-family="Arial" font-size="14.00">PP Stage 1 DP3</text>
<text text-anchor="middle" x="3327.5" y="-3491.25" font-family="Arial" font-size="14.00">GPU: DP3_PP1_TP0&#45;DP3_PP1_TP15</text>
<text text-anchor="middle" x="3327.5" y="-3476.25" font-family="Arial" font-size="14.00">Layers 4&#45;7 (4 layers)</text>
<text text-anchor="middle" x="3327.5" y="-3461.25" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp0_to_pp1_dp3&#45;&gt;pp1_dp3_start -->
<g id="edge100" class="edge">
<title>pp0_to_pp1_dp3&#45;&gt;pp1_dp3_start</title>
<path fill="none" stroke="black" d="M3186.93,-3592.89C3200.13,-3583.09 3214.39,-3572.49 3228.6,-3561.93"/>
<polygon fill="black" stroke="black" points="3231.02,-3564.5 3236.96,-3555.73 3226.84,-3558.88 3231.02,-3564.5"/>
</g>
<!-- pp1_to_pp2_dp3 -->
<g id="node60" class="node">
<title>pp1_to_pp2_dp3</title>
<ellipse fill="orange" stroke="black" cx="3327.5" cy="-3335.37" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="3327.5" y="-3354.17" font-family="Arial" font-size="14.00">Pipeline Transfer DP3</text>
<text text-anchor="middle" x="3327.5" y="-3339.17" font-family="Arial" font-size="14.00">PP1 → PP2</text>
<text text-anchor="middle" x="3327.5" y="-3324.17" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="3327.5" y="-3309.17" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp2_dp3_start -->
<g id="node66" class="node">
<title>pp2_dp3_start</title>
<polygon fill="yellow" stroke="black" points="3749.42,-3251.29 3078.24,-3251.29 2905.58,-3115.29 3576.76,-3115.29 3749.42,-3251.29"/>
<text text-anchor="middle" x="3327.5" y="-3202.09" font-family="Arial" font-size="14.00">PP Stage 2 DP3</text>
<text text-anchor="middle" x="3327.5" y="-3187.09" font-family="Arial" font-size="14.00">GPU: DP3_PP2_TP0&#45;DP3_PP2_TP15</text>
<text text-anchor="middle" x="3327.5" y="-3172.09" font-family="Arial" font-size="14.00">Layers 8&#45;11 (4 layers)</text>
<text text-anchor="middle" x="3327.5" y="-3157.09" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp1_to_pp2_dp3&#45;&gt;pp2_dp3_start -->
<g id="edge102" class="edge">
<title>pp1_to_pp2_dp3&#45;&gt;pp2_dp3_start</title>
<path fill="none" stroke="black" d="M3327.5,-3286.88C3327.5,-3278.8 3327.5,-3270.21 3327.5,-3261.59"/>
<polygon fill="black" stroke="black" points="3331,-3261.48 3327.5,-3251.48 3324,-3261.48 3331,-3261.48"/>
</g>
<!-- pp2_to_pp3_dp3 -->
<g id="node61" class="node">
<title>pp2_to_pp3_dp3</title>
<ellipse fill="orange" stroke="black" cx="3327.5" cy="-3031.2" rx="251.96" ry="48.17"/>
<text text-anchor="middle" x="3327.5" y="-3050" font-family="Arial" font-size="14.00">Pipeline Transfer DP3</text>
<text text-anchor="middle" x="3327.5" y="-3035" font-family="Arial" font-size="14.00">PP2 → PP3</text>
<text text-anchor="middle" x="3327.5" y="-3020" font-family="Arial" font-size="14.00">Activations transfer</text>
<text text-anchor="middle" x="3327.5" y="-3005" font-family="Arial" font-size="14.00">Size: [batch_size=32, seq_len=1024, hidden_size=4096]</text>
</g>
<!-- pp3_dp3_start -->
<g id="node67" class="node">
<title>pp3_dp3_start</title>
<polygon fill="yellow" stroke="black" points="3749.42,-2947.12 3078.24,-2947.12 2905.58,-2811.12 3576.76,-2811.12 3749.42,-2947.12"/>
<text text-anchor="middle" x="3327.5" y="-2897.92" font-family="Arial" font-size="14.00">PP Stage 3 DP3</text>
<text text-anchor="middle" x="3327.5" y="-2882.92" font-family="Arial" font-size="14.00">GPU: DP3_PP3_TP0&#45;DP3_PP3_TP15</text>
<text text-anchor="middle" x="3327.5" y="-2867.92" font-family="Arial" font-size="14.00">Layers 12&#45;15 (4 layers)</text>
<text text-anchor="middle" x="3327.5" y="-2852.92" font-family="Arial" font-size="14.00">4 layers × 32 EP groups × 2 experts/GPU = 256 expert instances</text>
</g>
<!-- pp2_to_pp3_dp3&#45;&gt;pp3_dp3_start -->
<g id="edge104" class="edge">
<title>pp2_to_pp3_dp3&#45;&gt;pp3_dp3_start</title>
<path fill="none" stroke="black" d="M3327.5,-2982.71C3327.5,-2974.63 3327.5,-2966.05 3327.5,-2957.43"/>
<polygon fill="black" stroke="black" points="3331,-2957.31 3327.5,-2947.31 3324,-2957.31 3331,-2957.31"/>
</g>
<!-- pp1_dp2_start&#45;&gt;pp1_to_pp2_dp2 -->
<g id="edge88" class="edge">
<title>pp1_dp2_start&#45;&gt;pp1_to_pp2_dp2</title>
<path fill="none" stroke="black" d="M2465.5,-3419.31C2465.5,-3410.77 2465.5,-3402.08 2465.5,-3393.71"/>
<polygon fill="black" stroke="black" points="2469,-3393.69 2465.5,-3383.69 2462,-3393.69 2469,-3393.69"/>
</g>
<!-- pp2_dp2_start&#45;&gt;pp2_to_pp3_dp2 -->
<g id="edge90" class="edge">
<title>pp2_dp2_start&#45;&gt;pp2_to_pp3_dp2</title>
<path fill="none" stroke="black" d="M2465.5,-3115.15C2465.5,-3106.6 2465.5,-3097.92 2465.5,-3089.55"/>
<polygon fill="black" stroke="black" points="2469,-3089.52 2465.5,-3079.52 2462,-3089.52 2469,-3089.52"/>
</g>
<!-- final_norm_dp2 -->
<g id="node88" class="node">
<title>final_norm_dp2</title>
<polygon fill="lightgrey" stroke="black" points="2520.5,-2759.12 2410.5,-2759.12 2410.5,-2723.12 2520.5,-2723.12 2520.5,-2759.12"/>
<text text-anchor="middle" x="2465.5" y="-2737.42" font-family="Arial" font-size="14.00">final_norm_dp2</text>
</g>
<!-- pp3_dp2_start&#45;&gt;final_norm_dp2 -->
<g id="edge92" class="edge">
<title>pp3_dp2_start&#45;&gt;final_norm_dp2</title>
<path fill="none" stroke="black" d="M2465.5,-2810.92C2465.5,-2796.26 2465.5,-2781.56 2465.5,-2769.53"/>
<polygon fill="black" stroke="black" points="2469,-2769.31 2465.5,-2759.31 2462,-2769.31 2469,-2769.31"/>
</g>
<!-- pp1_dp3_start&#45;&gt;pp1_to_pp2_dp3 -->
<g id="edge101" class="edge">
<title>pp1_dp3_start&#45;&gt;pp1_to_pp2_dp3</title>
<path fill="none" stroke="black" d="M3327.5,-3419.31C3327.5,-3410.77 3327.5,-3402.08 3327.5,-3393.71"/>
<polygon fill="black" stroke="black" points="3331,-3393.69 3327.5,-3383.69 3324,-3393.69 3331,-3393.69"/>
</g>
<!-- pp2_dp3_start&#45;&gt;pp2_to_pp3_dp3 -->
<g id="edge103" class="edge">
<title>pp2_dp3_start&#45;&gt;pp2_to_pp3_dp3</title>
<path fill="none" stroke="black" d="M3327.5,-3115.15C3327.5,-3106.6 3327.5,-3097.92 3327.5,-3089.55"/>
<polygon fill="black" stroke="black" points="3331,-3089.52 3327.5,-3079.52 3324,-3089.52 3331,-3089.52"/>
</g>
<!-- final_norm_dp3 -->
<g id="node93" class="node">
<title>final_norm_dp3</title>
<polygon fill="lightgrey" stroke="black" points="3015.5,-2759.12 2905.5,-2759.12 2905.5,-2723.12 3015.5,-2723.12 3015.5,-2759.12"/>
<text text-anchor="middle" x="2960.5" y="-2737.42" font-family="Arial" font-size="14.00">final_norm_dp3</text>
</g>
<!-- pp3_dp3_start&#45;&gt;final_norm_dp3 -->
<g id="edge105" class="edge">
<title>pp3_dp3_start&#45;&gt;final_norm_dp3</title>
<path fill="none" stroke="black" d="M3146.69,-2811.12C3099.22,-2793.53 3051.52,-2775.85 3016.28,-2762.79"/>
<polygon fill="black" stroke="black" points="3017.28,-2759.43 3006.68,-2759.23 3014.84,-2765.99 3017.28,-2759.43"/>
</g>
<!-- output -->
<g id="node69" class="node">
<title>output</title>
<ellipse fill="lightblue" stroke="black" cx="2296.5" cy="-37.48" rx="270.23" ry="37.45"/>
<text text-anchor="middle" x="2296.5" y="-48.78" font-family="Arial" font-size="14.00">Output</text>
<text text-anchor="middle" x="2296.5" y="-33.78" font-family="Arial" font-size="14.00">Input: [batch_size=128, seq_len=1024, hidden_size=4096]</text>
<text text-anchor="middle" x="2296.5" y="-18.78" font-family="Arial" font-size="14.00">Output: [batch_size=128, seq_len=1024, vocab_size=51200]</text>
</g>
<!-- dp_combine&#45;&gt;output -->
<g id="edge108" class="edge">
<title>dp_combine&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2296.5,-110.78C2296.5,-102.34 2296.5,-93.54 2296.5,-85.11"/>
<polygon fill="black" stroke="black" points="2300,-85.06 2296.5,-75.06 2293,-85.06 2300,-85.06"/>
</g>
<!-- layer0_gate_dp1 -->
<g id="node71" class="node">
<title>layer0_gate_dp1</title>
<polygon fill="lightgrey" stroke="black" points="2080,-2234.17 1963,-2234.17 1963,-2198.17 2080,-2198.17 2080,-2234.17"/>
<text text-anchor="middle" x="2021.5" y="-2212.47" font-family="Arial" font-size="14.00">layer0_gate_dp1</text>
</g>
<!-- layer0_norm2_dp1&#45;&gt;layer0_gate_dp1 -->
<g id="edge63" class="edge">
<title>layer0_norm2_dp1&#45;&gt;layer0_gate_dp1</title>
<path fill="none" stroke="black" d="M2021.5,-2369.93C2021.5,-2340.32 2021.5,-2279.6 2021.5,-2244.28"/>
<polygon fill="black" stroke="black" points="2025,-2244.19 2021.5,-2234.19 2018,-2244.19 2025,-2244.19"/>
</g>
<!-- layer0_route_dp1 -->
<g id="node72" class="node">
<title>layer0_route_dp1</title>
<polygon fill="lightgrey" stroke="black" points="2082.5,-2071.48 1960.5,-2071.48 1960.5,-2035.48 2082.5,-2035.48 2082.5,-2071.48"/>
<text text-anchor="middle" x="2021.5" y="-2049.78" font-family="Arial" font-size="14.00">layer0_route_dp1</text>
</g>
<!-- layer0_gate_dp1&#45;&gt;layer0_route_dp1 -->
<g id="edge64" class="edge">
<title>layer0_gate_dp1&#45;&gt;layer0_route_dp1</title>
<path fill="none" stroke="black" d="M2021.5,-2197.97C2021.5,-2170.18 2021.5,-2115.17 2021.5,-2081.92"/>
<polygon fill="black" stroke="black" points="2025,-2081.55 2021.5,-2071.55 2018,-2081.55 2025,-2081.55"/>
</g>
<!-- layer0_expert0_dp1 -->
<g id="node73" class="node">
<title>layer0_expert0_dp1</title>
<polygon fill="lightgrey" stroke="black" points="1937.5,-1935.29 1801.5,-1935.29 1801.5,-1899.29 1937.5,-1899.29 1937.5,-1935.29"/>
<text text-anchor="middle" x="1869.5" y="-1913.59" font-family="Arial" font-size="14.00">layer0_expert0_dp1</text>
</g>
<!-- layer0_route_dp1&#45;&gt;layer0_expert0_dp1 -->
<g id="edge65" class="edge">
<title>layer0_route_dp1&#45;&gt;layer0_expert0_dp1</title>
<path fill="none" stroke="black" d="M2001.94,-2035.21C1975.15,-2011.55 1926.92,-1968.98 1896.64,-1942.25"/>
<polygon fill="black" stroke="black" points="1898.8,-1939.48 1888.99,-1935.49 1894.17,-1944.73 1898.8,-1939.48"/>
</g>
<!-- layer0_expert1_dp1 -->
<g id="node74" class="node">
<title>layer0_expert1_dp1</title>
<polygon fill="lightgrey" stroke="black" points="2091.5,-1935.29 1955.5,-1935.29 1955.5,-1899.29 2091.5,-1899.29 2091.5,-1935.29"/>
<text text-anchor="middle" x="2023.5" y="-1913.59" font-family="Arial" font-size="14.00">layer0_expert1_dp1</text>
</g>
<!-- layer0_route_dp1&#45;&gt;layer0_expert1_dp1 -->
<g id="edge66" class="edge">
<title>layer0_route_dp1&#45;&gt;layer0_expert1_dp1</title>
<path fill="none" stroke="black" d="M2021.76,-2035.21C2022.09,-2012.56 2022.69,-1972.57 2023.09,-1945.74"/>
<polygon fill="black" stroke="black" points="2026.59,-1945.54 2023.24,-1935.49 2019.59,-1945.43 2026.59,-1945.54"/>
</g>
<!-- layer0_ep_a2a_dp1 -->
<g id="node75" class="node">
<title>layer0_ep_a2a_dp1</title>
<polygon fill="lightgrey" stroke="black" points="2078.5,-1809.7 1942.5,-1809.7 1942.5,-1773.7 2078.5,-1773.7 2078.5,-1809.7"/>
<text text-anchor="middle" x="2010.5" y="-1788" font-family="Arial" font-size="14.00">layer0_ep_a2a_dp1</text>
</g>
<!-- layer0_expert0_dp1&#45;&gt;layer0_ep_a2a_dp1 -->
<g id="edge67" class="edge">
<title>layer0_expert0_dp1&#45;&gt;layer0_ep_a2a_dp1</title>
<path fill="none" stroke="black" d="M1889.11,-1899.1C1913.62,-1877.61 1955.73,-1840.71 1983.34,-1816.51"/>
<polygon fill="black" stroke="black" points="1985.85,-1818.96 1991.06,-1809.74 1981.23,-1813.7 1985.85,-1818.96"/>
</g>
<!-- layer0_expert1_dp1&#45;&gt;layer0_ep_a2a_dp1 -->
<g id="edge68" class="edge">
<title>layer0_expert1_dp1&#45;&gt;layer0_ep_a2a_dp1</title>
<path fill="none" stroke="black" d="M2021.69,-1899.1C2019.53,-1878.53 2015.88,-1843.85 2013.34,-1819.69"/>
<polygon fill="black" stroke="black" points="2016.82,-1819.32 2012.29,-1809.74 2009.86,-1820.05 2016.82,-1819.32"/>
</g>
<!-- layer0_expert_combine_dp1 -->
<g id="node76" class="node">
<title>layer0_expert_combine_dp1</title>
<polygon fill="lightgrey" stroke="black" points="2104.5,-1657.62 1916.5,-1657.62 1916.5,-1621.62 2104.5,-1621.62 2104.5,-1657.62"/>
<text text-anchor="middle" x="2010.5" y="-1635.92" font-family="Arial" font-size="14.00">layer0_expert_combine_dp1</text>
</g>
<!-- layer0_ep_a2a_dp1&#45;&gt;layer0_expert_combine_dp1 -->
<g id="edge69" class="edge">
<title>layer0_ep_a2a_dp1&#45;&gt;layer0_expert_combine_dp1</title>
<path fill="none" stroke="black" d="M2010.5,-1773.49C2010.5,-1747.59 2010.5,-1698.38 2010.5,-1667.66"/>
<polygon fill="black" stroke="black" points="2014,-1667.64 2010.5,-1657.64 2007,-1667.64 2014,-1667.64"/>
</g>
<!-- layer0_expert_combine_dp1&#45;&gt;layer0_moe_residual_dp1 -->
<g id="edge70" class="edge">
<title>layer0_expert_combine_dp1&#45;&gt;layer0_moe_residual_dp1</title>
<path fill="none" stroke="black" d="M2025.95,-1621.39C2047.31,-1597.59 2085.98,-1554.48 2110.39,-1527.26"/>
<polygon fill="black" stroke="black" points="2113.1,-1529.49 2117.17,-1519.7 2107.89,-1524.81 2113.1,-1529.49"/>
</g>
<!-- layers1to3_dp1 -->
<g id="node78" class="node">
<title>layers1to3_dp1</title>
<polygon fill="lightgrey" stroke="black" points="2189,-1415.62 2080,-1415.62 2080,-1379.62 2189,-1379.62 2189,-1415.62"/>
<text text-anchor="middle" x="2134.5" y="-1393.92" font-family="Arial" font-size="14.00">layers1to3_dp1</text>
</g>
<!-- layer0_moe_residual_dp1&#45;&gt;layers1to3_dp1 -->
<g id="edge72" class="edge">
<title>layer0_moe_residual_dp1&#45;&gt;layers1to3_dp1</title>
<path fill="none" stroke="black" d="M2132.84,-1483.32C2133.15,-1467.54 2133.61,-1443.98 2133.97,-1425.71"/>
<polygon fill="black" stroke="black" points="2137.47,-1425.73 2134.17,-1415.67 2130.47,-1425.6 2137.47,-1425.73"/>
</g>
<!-- pp0_to_pp1_dp1 -->
<g id="node79" class="node">
<title>pp0_to_pp1_dp1</title>
<polygon fill="lightgrey" stroke="black" points="2229.5,-1297.54 2111.5,-1297.54 2111.5,-1261.54 2229.5,-1261.54 2229.5,-1297.54"/>
<text text-anchor="middle" x="2170.5" y="-1275.84" font-family="Arial" font-size="14.00">pp0_to_pp1_dp1</text>
</g>
<!-- layers1to3_dp1&#45;&gt;pp0_to_pp1_dp1 -->
<g id="edge73" class="edge">
<title>layers1to3_dp1&#45;&gt;pp0_to_pp1_dp1</title>
<path fill="none" stroke="black" d="M2139.81,-1379.49C2145.69,-1360.54 2155.23,-1329.76 2162.12,-1307.56"/>
<polygon fill="black" stroke="black" points="2165.55,-1308.32 2165.17,-1297.73 2158.86,-1306.25 2165.55,-1308.32"/>
</g>
<!-- pp1_dp1_start -->
<g id="node80" class="node">
<title>pp1_dp1_start</title>
<polygon fill="lightgrey" stroke="black" points="2233,-1145.45 2130,-1145.45 2130,-1109.45 2233,-1109.45 2233,-1145.45"/>
<text text-anchor="middle" x="2181.5" y="-1123.75" font-family="Arial" font-size="14.00">pp1_dp1_start</text>
</g>
<!-- pp0_to_pp1_dp1&#45;&gt;pp1_dp1_start -->
<g id="edge74" class="edge">
<title>pp0_to_pp1_dp1&#45;&gt;pp1_dp1_start</title>
<path fill="none" stroke="black" d="M2171.76,-1261.32C2173.66,-1235.42 2177.27,-1186.21 2179.52,-1155.49"/>
<polygon fill="black" stroke="black" points="2183.01,-1155.7 2180.25,-1145.47 2176.03,-1155.19 2183.01,-1155.7"/>
</g>
<!-- pp1_to_pp2_dp1 -->
<g id="node81" class="node">
<title>pp1_to_pp2_dp1</title>
<polygon fill="lightgrey" stroke="black" points="2245.5,-993.37 2127.5,-993.37 2127.5,-957.37 2245.5,-957.37 2245.5,-993.37"/>
<text text-anchor="middle" x="2186.5" y="-971.67" font-family="Arial" font-size="14.00">pp1_to_pp2_dp1</text>
</g>
<!-- pp1_dp1_start&#45;&gt;pp1_to_pp2_dp1 -->
<g id="edge75" class="edge">
<title>pp1_dp1_start&#45;&gt;pp1_to_pp2_dp1</title>
<path fill="none" stroke="black" d="M2182.07,-1109.24C2182.94,-1083.34 2184.58,-1034.13 2185.6,-1003.41"/>
<polygon fill="black" stroke="black" points="2189.1,-1003.5 2185.93,-993.39 2182.1,-1003.26 2189.1,-1003.5"/>
</g>
<!-- pp2_dp1_start -->
<g id="node82" class="node">
<title>pp2_dp1_start</title>
<polygon fill="lightgrey" stroke="black" points="2240,-841.29 2137,-841.29 2137,-805.29 2240,-805.29 2240,-841.29"/>
<text text-anchor="middle" x="2188.5" y="-819.59" font-family="Arial" font-size="14.00">pp2_dp1_start</text>
</g>
<!-- pp1_to_pp2_dp1&#45;&gt;pp2_dp1_start -->
<g id="edge76" class="edge">
<title>pp1_to_pp2_dp1&#45;&gt;pp2_dp1_start</title>
<path fill="none" stroke="black" d="M2186.73,-957.15C2187.07,-931.26 2187.73,-882.05 2188.14,-851.33"/>
<polygon fill="black" stroke="black" points="2191.64,-851.35 2188.27,-841.3 2184.64,-851.25 2191.64,-851.35"/>
</g>
<!-- pp2_to_pp3_dp1 -->
<g id="node83" class="node">
<title>pp2_to_pp3_dp1</title>
<polygon fill="lightgrey" stroke="black" points="2247.5,-689.2 2129.5,-689.2 2129.5,-653.2 2247.5,-653.2 2247.5,-689.2"/>
<text text-anchor="middle" x="2188.5" y="-667.5" font-family="Arial" font-size="14.00">pp2_to_pp3_dp1</text>
</g>
<!-- pp2_dp1_start&#45;&gt;pp2_to_pp3_dp1 -->
<g id="edge77" class="edge">
<title>pp2_dp1_start&#45;&gt;pp2_to_pp3_dp1</title>
<path fill="none" stroke="black" d="M2188.5,-805.07C2188.5,-779.17 2188.5,-729.96 2188.5,-699.24"/>
<polygon fill="black" stroke="black" points="2192,-699.22 2188.5,-689.22 2185,-699.22 2192,-699.22"/>
</g>
<!-- pp3_dp1_start -->
<g id="node84" class="node">
<title>pp3_dp1_start</title>
<polygon fill="lightgrey" stroke="black" points="2241,-537.12 2138,-537.12 2138,-501.12 2241,-501.12 2241,-537.12"/>
<text text-anchor="middle" x="2189.5" y="-515.42" font-family="Arial" font-size="14.00">pp3_dp1_start</text>
</g>
<!-- pp2_to_pp3_dp1&#45;&gt;pp3_dp1_start -->
<g id="edge78" class="edge">
<title>pp2_to_pp3_dp1&#45;&gt;pp3_dp1_start</title>
<path fill="none" stroke="black" d="M2188.61,-652.99C2188.79,-627.09 2189.12,-577.88 2189.32,-547.16"/>
<polygon fill="black" stroke="black" points="2192.82,-547.16 2189.39,-537.14 2185.82,-547.11 2192.82,-547.16"/>
</g>
<!-- pp3_dp1_start&#45;&gt;final_norm_dp1 -->
<g id="edge79" class="edge">
<title>pp3_dp1_start&#45;&gt;final_norm_dp1</title>
<path fill="none" stroke="black" d="M2189.5,-500.9C2189.5,-482.05 2189.5,-451.11 2189.5,-425.54"/>
<polygon fill="black" stroke="black" points="2193,-425.32 2189.5,-415.32 2186,-425.32 2193,-425.32"/>
</g>
<!-- hidden_up_dp2 -->
<g id="node86" class="node">
<title>hidden_up_dp2</title>
<polygon fill="lightgrey" stroke="black" points="2424.5,-4059.12 2314.5,-4059.12 2314.5,-4023.12 2424.5,-4023.12 2424.5,-4059.12"/>
<text text-anchor="middle" x="2369.5" y="-4037.42" font-family="Arial" font-size="14.00">hidden_up_dp2</text>
</g>
<!-- embed_dp2&#45;&gt;hidden_up_dp2 -->
<g id="edge83" class="edge">
<title>embed_dp2&#45;&gt;hidden_up_dp2</title>
<path fill="none" stroke="black" d="M2325.92,-4142.11C2334.34,-4122.78 2348.18,-4091.02 2358.01,-4068.48"/>
<polygon fill="black" stroke="black" points="2361.29,-4069.72 2362.08,-4059.15 2354.87,-4066.92 2361.29,-4069.72"/>
</g>
<!-- pp0_dp2_start -->
<g id="node87" class="node">
<title>pp0_dp2_start</title>
<polygon fill="lightgrey" stroke="black" points="2454,-3913.62 2351,-3913.62 2351,-3877.62 2454,-3877.62 2454,-3913.62"/>
<text text-anchor="middle" x="2402.5" y="-3891.92" font-family="Arial" font-size="14.00">pp0_dp2_start</text>
</g>
<!-- hidden_up_dp2&#45;&gt;pp0_dp2_start -->
<g id="edge84" class="edge">
<title>hidden_up_dp2&#45;&gt;pp0_dp2_start</title>
<path fill="none" stroke="black" d="M2373.42,-4023.09C2379.07,-3998.5 2389.59,-3952.77 2396.3,-3923.57"/>
<polygon fill="black" stroke="black" points="2399.76,-3924.15 2398.59,-3913.62 2392.94,-3922.58 2399.76,-3924.15"/>
</g>
<!-- pp0_dp2_start&#45;&gt;layers1to3_dp2 -->
<g id="edge85" class="edge">
<title>pp0_dp2_start&#45;&gt;layers1to3_dp2</title>
<path fill="none" stroke="black" d="M2404.53,-3877.39C2406.74,-3858.55 2410.38,-3827.61 2413.39,-3802.04"/>
<polygon fill="black" stroke="black" points="2416.9,-3802.16 2414.59,-3791.82 2409.95,-3801.34 2416.9,-3802.16"/>
</g>
<!-- output_proj_dp2 -->
<g id="node89" class="node">
<title>output_proj_dp2</title>
<polygon fill="lightgrey" stroke="black" points="2461.5,-2547.64 2347.5,-2547.64 2347.5,-2511.64 2461.5,-2511.64 2461.5,-2547.64"/>
<text text-anchor="middle" x="2404.5" y="-2525.94" font-family="Arial" font-size="14.00">output_proj_dp2</text>
</g>
<!-- final_norm_dp2&#45;&gt;output_proj_dp2 -->
<g id="edge93" class="edge">
<title>final_norm_dp2&#45;&gt;output_proj_dp2</title>
<path fill="none" stroke="black" d="M2460.51,-2722.98C2449.89,-2686.52 2425.01,-2601.07 2412.29,-2557.38"/>
<polygon fill="black" stroke="black" points="2415.63,-2556.35 2409.48,-2547.73 2408.91,-2558.31 2415.63,-2556.35"/>
</g>
<!-- output_proj_dp2&#45;&gt;dp_combine -->
<g id="edge94" class="edge">
<title>output_proj_dp2&#45;&gt;dp_combine</title>
<path fill="none" stroke="black" d="M2404.5,-2511.42C2404.5,-2464.32 2404.5,-2329.37 2404.5,-2217.17 2404.5,-2217.17 2404.5,-2217.17 2404.5,-380.12 2404.5,-318.65 2413.82,-297.68 2385.5,-243.12 2380.02,-232.57 2372.65,-222.64 2364.49,-213.57"/>
<polygon fill="black" stroke="black" points="2366.89,-211.02 2357.47,-206.17 2361.81,-215.83 2366.89,-211.02"/>
</g>
<!-- hidden_up_dp3 -->
<g id="node91" class="node">
<title>hidden_up_dp3</title>
<polygon fill="lightgrey" stroke="black" points="2612.5,-4059.12 2502.5,-4059.12 2502.5,-4023.12 2612.5,-4023.12 2612.5,-4059.12"/>
<text text-anchor="middle" x="2557.5" y="-4037.42" font-family="Arial" font-size="14.00">hidden_up_dp3</text>
</g>
<!-- embed_dp3&#45;&gt;hidden_up_dp3 -->
<g id="edge96" class="edge">
<title>embed_dp3&#45;&gt;hidden_up_dp3</title>
<path fill="none" stroke="black" d="M2456.66,-4142.11C2476.76,-4122.18 2510.21,-4089.01 2533.02,-4066.39"/>
<polygon fill="black" stroke="black" points="2535.68,-4068.68 2540.32,-4059.15 2530.76,-4063.71 2535.68,-4068.68"/>
</g>
<!-- pp0_dp3_start -->
<g id="node92" class="node">
<title>pp0_dp3_start</title>
<polygon fill="lightgrey" stroke="black" points="2739,-3913.62 2636,-3913.62 2636,-3877.62 2739,-3877.62 2739,-3913.62"/>
<text text-anchor="middle" x="2687.5" y="-3891.92" font-family="Arial" font-size="14.00">pp0_dp3_start</text>
</g>
<!-- hidden_up_dp3&#45;&gt;pp0_dp3_start -->
<g id="edge97" class="edge">
<title>hidden_up_dp3&#45;&gt;pp0_dp3_start</title>
<path fill="none" stroke="black" d="M2572.92,-4023.09C2595.79,-3997.85 2638.82,-3950.35 2665.15,-3921.29"/>
<polygon fill="black" stroke="black" points="2667.98,-3923.38 2672.1,-3913.62 2662.79,-3918.68 2667.98,-3923.38"/>
</g>
<!-- pp0_dp3_start&#45;&gt;layers1to3_dp3 -->
<g id="edge98" class="edge">
<title>pp0_dp3_start&#45;&gt;layers1to3_dp3</title>
<path fill="none" stroke="black" d="M2706.12,-3877.39C2727.39,-3857.71 2762.92,-3824.84 2791.22,-3798.66"/>
<polygon fill="black" stroke="black" points="2793.65,-3801.18 2798.62,-3791.82 2788.9,-3796.04 2793.65,-3801.18"/>
</g>
<!-- output_proj_dp3 -->
<g id="node94" class="node">
<title>output_proj_dp3</title>
<polygon fill="lightgrey" stroke="black" points="2572.5,-2406.17 2458.5,-2406.17 2458.5,-2370.17 2572.5,-2370.17 2572.5,-2406.17"/>
<text text-anchor="middle" x="2515.5" y="-2384.47" font-family="Arial" font-size="14.00">output_proj_dp3</text>
</g>
<!-- final_norm_dp3&#45;&gt;output_proj_dp3 -->
<g id="edge106" class="edge">
<title>final_norm_dp3&#45;&gt;output_proj_dp3</title>
<path fill="none" stroke="black" d="M2938.74,-2722.95C2865.69,-2665.34 2629.15,-2478.8 2545.31,-2412.67"/>
<polygon fill="black" stroke="black" points="2547.24,-2409.74 2537.22,-2406.3 2542.91,-2415.24 2547.24,-2409.74"/>
</g>
<!-- output_proj_dp3&#45;&gt;dp_combine -->
<g id="edge107" class="edge">
<title>output_proj_dp3&#45;&gt;dp_combine</title>
<path fill="none" stroke="black" d="M2511.06,-2369.99C2498.83,-2321.04 2465.5,-2176.55 2465.5,-2054.48 2465.5,-2054.48 2465.5,-2054.48 2465.5,-380.12 2465.5,-315.75 2457.54,-294.3 2418.5,-243.12 2409.6,-231.45 2398.57,-220.84 2386.82,-211.41"/>
<polygon fill="black" stroke="black" points="2388.64,-208.39 2378.58,-205.06 2384.36,-213.94 2388.64,-208.39"/>
</g>
</g>
</svg>
