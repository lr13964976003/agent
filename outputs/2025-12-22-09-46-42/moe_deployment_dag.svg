<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="7333pt" height="9046pt"
 viewBox="0.00 0.00 1760.00 2170.99" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(4.17 4.17) rotate(0) translate(4 2166.99)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2166.99 1756,-2166.99 1756,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_pipeline_stage_0</title>
<path fill="lightgray" stroke="black" d="M20,-307.97C20,-307.97 1424,-307.97 1424,-307.97 1430,-307.97 1436,-313.97 1436,-319.97 1436,-319.97 1436,-2142.99 1436,-2142.99 1436,-2148.99 1430,-2154.99 1424,-2154.99 1424,-2154.99 20,-2154.99 20,-2154.99 14,-2154.99 8,-2148.99 8,-2142.99 8,-2142.99 8,-319.97 8,-319.97 8,-313.97 14,-307.97 20,-307.97"/>
<text text-anchor="middle" x="722" y="-2139.79" font-family="Times,serif" font-size="14.00">Pipeline Stage 0 (Layers 0&#45;7)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_layer0_attention</title>
<path fill="none" stroke="black" d="M385,-1008.58C385,-1008.58 1325,-1008.58 1325,-1008.58 1331,-1008.58 1337,-1014.58 1337,-1020.58 1337,-1020.58 1337,-2007.57 1337,-2007.57 1337,-2013.57 1331,-2019.57 1325,-2019.57 1325,-2019.57 385,-2019.57 385,-2019.57 379,-2019.57 373,-2013.57 373,-2007.57 373,-2007.57 373,-1020.58 373,-1020.58 373,-1014.58 379,-1008.58 385,-1008.58"/>
<text text-anchor="middle" x="855" y="-2005.97" font-family="Times,serif" font-size="12.00">Layer 0 &#45; Multi&#45;Head Attention (TP=8)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_layer0_moe</title>
<path fill="none" stroke="black" d="M28,-507.5C28,-507.5 1416,-507.5 1416,-507.5 1422,-507.5 1428,-513.5 1428,-519.5 1428,-519.5 1428,-977.58 1428,-977.58 1428,-983.58 1422,-989.58 1416,-989.58 1416,-989.58 28,-989.58 28,-989.58 22,-989.58 16,-983.58 16,-977.58 16,-977.58 16,-519.5 16,-519.5 16,-513.5 22,-507.5 28,-507.5"/>
<text text-anchor="middle" x="722" y="-975.98" font-family="Times,serif" font-size="12.00">Layer 0 &#45; MoE (EP=64)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_pipeline_stage_1</title>
<path fill="lightgray" stroke="black" d="M509,-8C509,-8 1145,-8 1145,-8 1151,-8 1157,-14 1157,-20 1157,-20 1157,-276.97 1157,-276.97 1157,-282.97 1151,-288.97 1145,-288.97 1145,-288.97 509,-288.97 509,-288.97 503,-288.97 497,-282.97 497,-276.97 497,-276.97 497,-20 497,-20 497,-14 503,-8 509,-8"/>
<text text-anchor="middle" x="827" y="-273.77" font-family="Times,serif" font-size="14.00">Pipeline Stage 1 (Layers 8&#45;15)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_data_parallel</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1456,-1904.57C1456,-1904.57 1732,-1904.57 1732,-1904.57 1738,-1904.57 1744,-1910.57 1744,-1916.57 1744,-1916.57 1744,-2033.57 1744,-2033.57 1744,-2039.57 1738,-2045.57 1732,-2045.57 1732,-2045.57 1456,-2045.57 1456,-2045.57 1450,-2045.57 1444,-2039.57 1444,-2033.57 1444,-2033.57 1444,-1916.57 1444,-1916.57 1444,-1910.57 1450,-1904.57 1456,-1904.57"/>
<text text-anchor="middle" x="1594" y="-2031.97" font-family="Times,serif" font-size="12.00">Data Parallelism (DP=2)</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightblue" stroke="black" stroke-dasharray="5,2" cx="1176" cy="-2102.78" rx="252.37" ry="21.43"/>
<text text-anchor="middle" x="1176" y="-2105.78" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="1176" y="-2094.78" font-family="Arial" font-size="10.00">INPUT DIMENSION: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
</g>
<!-- layer0_qkv_tp0 -->
<g id="node2" class="node">
<title>layer0_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1328.5,-1990.57 1023.5,-1990.57 1023.5,-1938.57 1328.5,-1938.57 1328.5,-1990.57"/>
<text text-anchor="middle" x="1176" y="-1978.57" font-family="Arial" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="1176" y="-1967.57" font-family="Arial" font-size="10.00">GPU: PP0_TP0_GPU</text>
<text text-anchor="middle" x="1176" y="-1956.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="1176" y="-1945.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- input&#45;&gt;layer0_qkv_tp0 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;layer0_qkv_tp0</title>
<path fill="none" stroke="black" d="M1176,-2081.39C1176,-2060.12 1176,-2026.39 1176,-2000.8"/>
<polygon fill="black" stroke="black" points="1179.5,-2000.74 1176,-1990.74 1172.5,-2000.74 1179.5,-2000.74"/>
</g>
<!-- dp_replica -->
<g id="node40" class="node">
<title>dp_replica</title>
<polygon fill="lightsteelblue" stroke="black" stroke-dasharray="5,2" points="1736.07,-2016.57 1510.07,-2016.57 1451.93,-1912.57 1677.93,-1912.57 1736.07,-2016.57"/>
<text text-anchor="middle" x="1594" y="-1978.57" font-family="Arial" font-size="10.00">Data Parallel Replica</text>
<text text-anchor="middle" x="1594" y="-1967.57" font-family="Arial" font-size="10.00">Batch 64 sequences</text>
<text text-anchor="middle" x="1594" y="-1956.57" font-family="Arial" font-size="10.00">Identical computation graph</text>
<text text-anchor="middle" x="1594" y="-1945.57" font-family="Arial" font-size="10.00">Gradient sync in training</text>
</g>
<!-- input&#45;&gt;dp_replica -->
<g id="edge43" class="edge">
<title>input&#45;&gt;dp_replica</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M1236.33,-2082.12C1302.27,-2060.63 1409.14,-2025.81 1488.92,-1999.81"/>
<polygon fill="black" stroke="black" points="1490.08,-2003.11 1498.51,-1996.68 1487.91,-1996.45 1490.08,-2003.11"/>
<text text-anchor="middle" x="1344.5" y="-2056.37" font-family="Arial" font-size="9.00">DP replica</text>
</g>
<!-- layer0_attn_tp0 -->
<g id="node10" class="node">
<title>layer0_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1328.5,-1875.57 1023.5,-1875.57 1023.5,-1823.57 1328.5,-1823.57 1328.5,-1875.57"/>
<text text-anchor="middle" x="1176" y="-1863.57" font-family="Arial" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="1176" y="-1852.57" font-family="Arial" font-size="10.00">GPU: PP0_TP0_GPU</text>
<text text-anchor="middle" x="1176" y="-1841.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="1176" y="-1830.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_qkv_tp0&#45;&gt;layer0_attn_tp0 -->
<g id="edge2" class="edge">
<title>layer0_qkv_tp0&#45;&gt;layer0_attn_tp0</title>
<path fill="none" stroke="black" d="M1176,-1938.49C1176,-1922.98 1176,-1902.84 1176,-1885.75"/>
<polygon fill="black" stroke="black" points="1179.5,-1885.57 1176,-1875.57 1172.5,-1885.57 1179.5,-1885.57"/>
</g>
<!-- layer0_qkv_tp1 -->
<g id="node3" class="node">
<title>layer0_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1005.5,-1875.57 700.5,-1875.57 700.5,-1823.57 1005.5,-1823.57 1005.5,-1875.57"/>
<text text-anchor="middle" x="853" y="-1863.57" font-family="Arial" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="853" y="-1852.57" font-family="Arial" font-size="10.00">GPU: PP0_TP1_GPU</text>
<text text-anchor="middle" x="853" y="-1841.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="853" y="-1830.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_attn_tp1 -->
<g id="node11" class="node">
<title>layer0_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1009.5,-1786.57 704.5,-1786.57 704.5,-1734.57 1009.5,-1734.57 1009.5,-1786.57"/>
<text text-anchor="middle" x="857" y="-1774.57" font-family="Arial" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="857" y="-1763.57" font-family="Arial" font-size="10.00">GPU: PP0_TP1_GPU</text>
<text text-anchor="middle" x="857" y="-1752.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="857" y="-1741.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_qkv_tp1&#45;&gt;layer0_attn_tp1 -->
<g id="edge4" class="edge">
<title>layer0_qkv_tp1&#45;&gt;layer0_attn_tp1</title>
<path fill="none" stroke="black" d="M854.16,-1823.4C854.54,-1815.11 854.97,-1805.72 855.38,-1796.81"/>
<polygon fill="black" stroke="black" points="858.88,-1796.82 855.85,-1786.67 851.89,-1796.5 858.88,-1796.82"/>
</g>
<!-- layer0_qkv_tp2 -->
<g id="node4" class="node">
<title>layer0_qkv_tp2</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="686.5,-1786.57 381.5,-1786.57 381.5,-1734.57 686.5,-1734.57 686.5,-1786.57"/>
<text text-anchor="middle" x="534" y="-1774.57" font-family="Arial" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="534" y="-1763.57" font-family="Arial" font-size="10.00">GPU: PP0_TP2_GPU</text>
<text text-anchor="middle" x="534" y="-1752.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="534" y="-1741.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_attn_tp2 -->
<g id="node12" class="node">
<title>layer0_attn_tp2</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1009.5,-1697.57 704.5,-1697.57 704.5,-1645.57 1009.5,-1645.57 1009.5,-1697.57"/>
<text text-anchor="middle" x="857" y="-1685.57" font-family="Arial" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="857" y="-1674.57" font-family="Arial" font-size="10.00">GPU: PP0_TP2_GPU</text>
<text text-anchor="middle" x="857" y="-1663.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="857" y="-1652.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_qkv_tp2&#45;&gt;layer0_attn_tp2 -->
<g id="edge7" class="edge">
<title>layer0_qkv_tp2&#45;&gt;layer0_attn_tp2</title>
<path fill="none" stroke="black" d="M626.99,-1734.52C666.85,-1723.78 713.54,-1711.21 754.4,-1700.2"/>
<polygon fill="black" stroke="black" points="755.36,-1703.57 764.11,-1697.59 753.54,-1696.81 755.36,-1703.57"/>
</g>
<!-- layer0_qkv_tp3 -->
<g id="node5" class="node">
<title>layer0_qkv_tp3</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="686.5,-1697.57 381.5,-1697.57 381.5,-1645.57 686.5,-1645.57 686.5,-1697.57"/>
<text text-anchor="middle" x="534" y="-1685.57" font-family="Arial" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="534" y="-1674.57" font-family="Arial" font-size="10.00">GPU: PP0_TP3_GPU</text>
<text text-anchor="middle" x="534" y="-1663.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="534" y="-1652.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_attn_tp3 -->
<g id="node13" class="node">
<title>layer0_attn_tp3</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1009.5,-1608.57 704.5,-1608.57 704.5,-1556.57 1009.5,-1556.57 1009.5,-1608.57"/>
<text text-anchor="middle" x="857" y="-1596.57" font-family="Arial" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="857" y="-1585.57" font-family="Arial" font-size="10.00">GPU: PP0_TP3_GPU</text>
<text text-anchor="middle" x="857" y="-1574.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="857" y="-1563.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_qkv_tp3&#45;&gt;layer0_attn_tp3 -->
<g id="edge10" class="edge">
<title>layer0_qkv_tp3&#45;&gt;layer0_attn_tp3</title>
<path fill="none" stroke="black" d="M626.99,-1645.52C666.85,-1634.78 713.54,-1622.21 754.4,-1611.2"/>
<polygon fill="black" stroke="black" points="755.36,-1614.57 764.11,-1608.59 753.54,-1607.81 755.36,-1614.57"/>
</g>
<!-- layer0_qkv_tp4 -->
<g id="node6" class="node">
<title>layer0_qkv_tp4</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="686.5,-1608.57 381.5,-1608.57 381.5,-1556.57 686.5,-1556.57 686.5,-1608.57"/>
<text text-anchor="middle" x="534" y="-1596.57" font-family="Arial" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="534" y="-1585.57" font-family="Arial" font-size="10.00">GPU: PP0_TP4_GPU</text>
<text text-anchor="middle" x="534" y="-1574.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="534" y="-1563.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_attn_tp4 -->
<g id="node14" class="node">
<title>layer0_attn_tp4</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1009.5,-1519.57 704.5,-1519.57 704.5,-1467.57 1009.5,-1467.57 1009.5,-1519.57"/>
<text text-anchor="middle" x="857" y="-1507.57" font-family="Arial" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="857" y="-1496.57" font-family="Arial" font-size="10.00">GPU: PP0_TP4_GPU</text>
<text text-anchor="middle" x="857" y="-1485.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="857" y="-1474.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_qkv_tp4&#45;&gt;layer0_attn_tp4 -->
<g id="edge13" class="edge">
<title>layer0_qkv_tp4&#45;&gt;layer0_attn_tp4</title>
<path fill="none" stroke="black" d="M626.99,-1556.52C666.85,-1545.78 713.54,-1533.21 754.4,-1522.2"/>
<polygon fill="black" stroke="black" points="755.36,-1525.57 764.11,-1519.59 753.54,-1518.81 755.36,-1525.57"/>
</g>
<!-- layer0_qkv_tp5 -->
<g id="node7" class="node">
<title>layer0_qkv_tp5</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="686.5,-1519.57 381.5,-1519.57 381.5,-1467.57 686.5,-1467.57 686.5,-1519.57"/>
<text text-anchor="middle" x="534" y="-1507.57" font-family="Arial" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="534" y="-1496.57" font-family="Arial" font-size="10.00">GPU: PP0_TP5_GPU</text>
<text text-anchor="middle" x="534" y="-1485.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="534" y="-1474.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_attn_tp5 -->
<g id="node15" class="node">
<title>layer0_attn_tp5</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1009.5,-1430.57 704.5,-1430.57 704.5,-1378.57 1009.5,-1378.57 1009.5,-1430.57"/>
<text text-anchor="middle" x="857" y="-1418.57" font-family="Arial" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="857" y="-1407.57" font-family="Arial" font-size="10.00">GPU: PP0_TP5_GPU</text>
<text text-anchor="middle" x="857" y="-1396.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="857" y="-1385.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_qkv_tp5&#45;&gt;layer0_attn_tp5 -->
<g id="edge16" class="edge">
<title>layer0_qkv_tp5&#45;&gt;layer0_attn_tp5</title>
<path fill="none" stroke="black" d="M626.99,-1467.52C666.85,-1456.78 713.54,-1444.21 754.4,-1433.2"/>
<polygon fill="black" stroke="black" points="755.36,-1436.57 764.11,-1430.59 753.54,-1429.81 755.36,-1436.57"/>
</g>
<!-- layer0_qkv_tp6 -->
<g id="node8" class="node">
<title>layer0_qkv_tp6</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="686.5,-1430.57 381.5,-1430.57 381.5,-1378.57 686.5,-1378.57 686.5,-1430.57"/>
<text text-anchor="middle" x="534" y="-1418.57" font-family="Arial" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="534" y="-1407.57" font-family="Arial" font-size="10.00">GPU: PP0_TP6_GPU</text>
<text text-anchor="middle" x="534" y="-1396.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="534" y="-1385.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_attn_tp6 -->
<g id="node16" class="node">
<title>layer0_attn_tp6</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1009.5,-1341.57 704.5,-1341.57 704.5,-1289.57 1009.5,-1289.57 1009.5,-1341.57"/>
<text text-anchor="middle" x="857" y="-1329.57" font-family="Arial" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="857" y="-1318.57" font-family="Arial" font-size="10.00">GPU: PP0_TP6_GPU</text>
<text text-anchor="middle" x="857" y="-1307.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="857" y="-1296.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_qkv_tp6&#45;&gt;layer0_attn_tp6 -->
<g id="edge19" class="edge">
<title>layer0_qkv_tp6&#45;&gt;layer0_attn_tp6</title>
<path fill="none" stroke="black" d="M626.99,-1378.52C666.85,-1367.78 713.54,-1355.21 754.4,-1344.2"/>
<polygon fill="black" stroke="black" points="755.36,-1347.57 764.11,-1341.59 753.54,-1340.81 755.36,-1347.57"/>
</g>
<!-- layer0_qkv_tp7 -->
<g id="node9" class="node">
<title>layer0_qkv_tp7</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="686.5,-1341.57 381.5,-1341.57 381.5,-1289.57 686.5,-1289.57 686.5,-1341.57"/>
<text text-anchor="middle" x="534" y="-1329.57" font-family="Arial" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="534" y="-1318.57" font-family="Arial" font-size="10.00">GPU: PP0_TP7_GPU</text>
<text text-anchor="middle" x="534" y="-1307.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="534" y="-1296.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_attn_tp7 -->
<g id="node17" class="node">
<title>layer0_attn_tp7</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="687.5,-1252.57 382.5,-1252.57 382.5,-1200.57 687.5,-1200.57 687.5,-1252.57"/>
<text text-anchor="middle" x="535" y="-1240.57" font-family="Arial" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="535" y="-1229.57" font-family="Arial" font-size="10.00">GPU: PP0_TP7_GPU</text>
<text text-anchor="middle" x="535" y="-1218.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="535" y="-1207.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_qkv_tp7&#45;&gt;layer0_attn_tp7 -->
<g id="edge22" class="edge">
<title>layer0_qkv_tp7&#45;&gt;layer0_attn_tp7</title>
<path fill="none" stroke="black" d="M534.29,-1289.4C534.38,-1281.11 534.49,-1271.72 534.59,-1262.81"/>
<polygon fill="black" stroke="black" points="538.1,-1262.71 534.71,-1252.67 531.1,-1262.63 538.1,-1262.71"/>
</g>
<!-- layer0_out_tp0 -->
<g id="node18" class="node">
<title>layer0_out_tp0</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1328.5,-1786.57 1027.5,-1786.57 1027.5,-1734.57 1328.5,-1734.57 1328.5,-1786.57"/>
<text text-anchor="middle" x="1178" y="-1774.57" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="1178" y="-1763.57" font-family="Arial" font-size="10.00">GPU: PP0_TP0_GPU</text>
<text text-anchor="middle" x="1178" y="-1752.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="1178" y="-1741.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=128]</text>
</g>
<!-- layer0_attn_tp0&#45;&gt;layer0_out_tp0 -->
<g id="edge3" class="edge">
<title>layer0_attn_tp0&#45;&gt;layer0_out_tp0</title>
<path fill="none" stroke="black" d="M1176.58,-1823.4C1176.77,-1815.11 1176.98,-1805.72 1177.19,-1796.81"/>
<polygon fill="black" stroke="black" points="1180.69,-1796.75 1177.42,-1786.67 1173.69,-1796.59 1180.69,-1796.75"/>
</g>
<!-- layer0_out_tp1 -->
<g id="node19" class="node">
<title>layer0_out_tp1</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1328.5,-1697.57 1027.5,-1697.57 1027.5,-1645.57 1328.5,-1645.57 1328.5,-1697.57"/>
<text text-anchor="middle" x="1178" y="-1685.57" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="1178" y="-1674.57" font-family="Arial" font-size="10.00">GPU: PP0_TP1_GPU</text>
<text text-anchor="middle" x="1178" y="-1663.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="1178" y="-1652.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=128]</text>
</g>
<!-- layer0_attn_tp1&#45;&gt;layer0_out_tp1 -->
<g id="edge5" class="edge">
<title>layer0_attn_tp1&#45;&gt;layer0_out_tp1</title>
<path fill="none" stroke="black" d="M949.42,-1734.52C988.94,-1723.81 1035.23,-1711.26 1075.78,-1700.27"/>
<polygon fill="black" stroke="black" points="1076.94,-1703.58 1085.68,-1697.59 1075.11,-1696.82 1076.94,-1703.58"/>
</g>
<!-- layer0_out_tp2 -->
<g id="node20" class="node">
<title>layer0_out_tp2</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1328.5,-1608.57 1027.5,-1608.57 1027.5,-1556.57 1328.5,-1556.57 1328.5,-1608.57"/>
<text text-anchor="middle" x="1178" y="-1596.57" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="1178" y="-1585.57" font-family="Arial" font-size="10.00">GPU: PP0_TP2_GPU</text>
<text text-anchor="middle" x="1178" y="-1574.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="1178" y="-1563.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=128]</text>
</g>
<!-- layer0_attn_tp2&#45;&gt;layer0_out_tp2 -->
<g id="edge8" class="edge">
<title>layer0_attn_tp2&#45;&gt;layer0_out_tp2</title>
<path fill="none" stroke="black" d="M949.42,-1645.52C988.94,-1634.81 1035.23,-1622.26 1075.78,-1611.27"/>
<polygon fill="black" stroke="black" points="1076.94,-1614.58 1085.68,-1608.59 1075.11,-1607.82 1076.94,-1614.58"/>
</g>
<!-- layer0_out_tp3 -->
<g id="node21" class="node">
<title>layer0_out_tp3</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1328.5,-1519.57 1027.5,-1519.57 1027.5,-1467.57 1328.5,-1467.57 1328.5,-1519.57"/>
<text text-anchor="middle" x="1178" y="-1507.57" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="1178" y="-1496.57" font-family="Arial" font-size="10.00">GPU: PP0_TP3_GPU</text>
<text text-anchor="middle" x="1178" y="-1485.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="1178" y="-1474.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=128]</text>
</g>
<!-- layer0_attn_tp3&#45;&gt;layer0_out_tp3 -->
<g id="edge11" class="edge">
<title>layer0_attn_tp3&#45;&gt;layer0_out_tp3</title>
<path fill="none" stroke="black" d="M949.42,-1556.52C988.94,-1545.81 1035.23,-1533.26 1075.78,-1522.27"/>
<polygon fill="black" stroke="black" points="1076.94,-1525.58 1085.68,-1519.59 1075.11,-1518.82 1076.94,-1525.58"/>
</g>
<!-- layer0_out_tp4 -->
<g id="node22" class="node">
<title>layer0_out_tp4</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1328.5,-1430.57 1027.5,-1430.57 1027.5,-1378.57 1328.5,-1378.57 1328.5,-1430.57"/>
<text text-anchor="middle" x="1178" y="-1418.57" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="1178" y="-1407.57" font-family="Arial" font-size="10.00">GPU: PP0_TP4_GPU</text>
<text text-anchor="middle" x="1178" y="-1396.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="1178" y="-1385.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=128]</text>
</g>
<!-- layer0_attn_tp4&#45;&gt;layer0_out_tp4 -->
<g id="edge14" class="edge">
<title>layer0_attn_tp4&#45;&gt;layer0_out_tp4</title>
<path fill="none" stroke="black" d="M949.42,-1467.52C988.94,-1456.81 1035.23,-1444.26 1075.78,-1433.27"/>
<polygon fill="black" stroke="black" points="1076.94,-1436.58 1085.68,-1430.59 1075.11,-1429.82 1076.94,-1436.58"/>
</g>
<!-- layer0_out_tp5 -->
<g id="node23" class="node">
<title>layer0_out_tp5</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1328.5,-1341.57 1027.5,-1341.57 1027.5,-1289.57 1328.5,-1289.57 1328.5,-1341.57"/>
<text text-anchor="middle" x="1178" y="-1329.57" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="1178" y="-1318.57" font-family="Arial" font-size="10.00">GPU: PP0_TP5_GPU</text>
<text text-anchor="middle" x="1178" y="-1307.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="1178" y="-1296.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=128]</text>
</g>
<!-- layer0_attn_tp5&#45;&gt;layer0_out_tp5 -->
<g id="edge17" class="edge">
<title>layer0_attn_tp5&#45;&gt;layer0_out_tp5</title>
<path fill="none" stroke="black" d="M949.42,-1378.52C988.94,-1367.81 1035.23,-1355.26 1075.78,-1344.27"/>
<polygon fill="black" stroke="black" points="1076.94,-1347.58 1085.68,-1341.59 1075.11,-1340.82 1076.94,-1347.58"/>
</g>
<!-- layer0_out_tp6 -->
<g id="node24" class="node">
<title>layer0_out_tp6</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1007.5,-1252.57 706.5,-1252.57 706.5,-1200.57 1007.5,-1200.57 1007.5,-1252.57"/>
<text text-anchor="middle" x="857" y="-1240.57" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="857" y="-1229.57" font-family="Arial" font-size="10.00">GPU: PP0_TP6_GPU</text>
<text text-anchor="middle" x="857" y="-1218.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="857" y="-1207.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=128]</text>
</g>
<!-- layer0_attn_tp6&#45;&gt;layer0_out_tp6 -->
<g id="edge20" class="edge">
<title>layer0_attn_tp6&#45;&gt;layer0_out_tp6</title>
<path fill="none" stroke="black" d="M857,-1289.4C857,-1281.11 857,-1271.72 857,-1262.81"/>
<polygon fill="black" stroke="black" points="860.5,-1262.67 857,-1252.67 853.5,-1262.67 860.5,-1262.67"/>
</g>
<!-- layer0_out_tp7 -->
<g id="node25" class="node">
<title>layer0_out_tp7</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="977.5,-1163.57 676.5,-1163.57 676.5,-1111.57 977.5,-1111.57 977.5,-1163.57"/>
<text text-anchor="middle" x="827" y="-1151.57" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="827" y="-1140.57" font-family="Arial" font-size="10.00">GPU: PP0_TP7_GPU</text>
<text text-anchor="middle" x="827" y="-1129.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="827" y="-1118.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=128]</text>
</g>
<!-- layer0_attn_tp7&#45;&gt;layer0_out_tp7 -->
<g id="edge23" class="edge">
<title>layer0_attn_tp7&#45;&gt;layer0_out_tp7</title>
<path fill="none" stroke="black" d="M619.07,-1200.52C654.79,-1189.87 696.59,-1177.42 733.31,-1166.48"/>
<polygon fill="black" stroke="black" points="734.44,-1169.8 743.02,-1163.59 732.44,-1163.09 734.44,-1169.8"/>
</g>
<!-- layer0_out_tp0&#45;&gt;layer0_out_tp1 -->
<g id="edge6" class="edge">
<title>layer0_out_tp0&#45;&gt;layer0_out_tp1</title>
<path fill="none" stroke="black" d="M1178,-1734.4C1178,-1726.11 1178,-1716.72 1178,-1707.81"/>
<polygon fill="black" stroke="black" points="1181.5,-1707.67 1178,-1697.67 1174.5,-1707.67 1181.5,-1707.67"/>
</g>
<!-- layer0_out_tp1&#45;&gt;layer0_out_tp2 -->
<g id="edge9" class="edge">
<title>layer0_out_tp1&#45;&gt;layer0_out_tp2</title>
<path fill="none" stroke="black" d="M1178,-1645.4C1178,-1637.11 1178,-1627.72 1178,-1618.81"/>
<polygon fill="black" stroke="black" points="1181.5,-1618.67 1178,-1608.67 1174.5,-1618.67 1181.5,-1618.67"/>
</g>
<!-- layer0_out_tp2&#45;&gt;layer0_out_tp3 -->
<g id="edge12" class="edge">
<title>layer0_out_tp2&#45;&gt;layer0_out_tp3</title>
<path fill="none" stroke="black" d="M1178,-1556.4C1178,-1548.11 1178,-1538.72 1178,-1529.81"/>
<polygon fill="black" stroke="black" points="1181.5,-1529.67 1178,-1519.67 1174.5,-1529.67 1181.5,-1529.67"/>
</g>
<!-- layer0_out_tp3&#45;&gt;layer0_out_tp4 -->
<g id="edge15" class="edge">
<title>layer0_out_tp3&#45;&gt;layer0_out_tp4</title>
<path fill="none" stroke="black" d="M1178,-1467.4C1178,-1459.11 1178,-1449.72 1178,-1440.81"/>
<polygon fill="black" stroke="black" points="1181.5,-1440.67 1178,-1430.67 1174.5,-1440.67 1181.5,-1440.67"/>
</g>
<!-- layer0_out_tp4&#45;&gt;layer0_out_tp5 -->
<g id="edge18" class="edge">
<title>layer0_out_tp4&#45;&gt;layer0_out_tp5</title>
<path fill="none" stroke="black" d="M1178,-1378.4C1178,-1370.11 1178,-1360.72 1178,-1351.81"/>
<polygon fill="black" stroke="black" points="1181.5,-1351.67 1178,-1341.67 1174.5,-1351.67 1181.5,-1351.67"/>
</g>
<!-- layer0_out_tp5&#45;&gt;layer0_out_tp6 -->
<g id="edge21" class="edge">
<title>layer0_out_tp5&#45;&gt;layer0_out_tp6</title>
<path fill="none" stroke="black" d="M1085.58,-1289.52C1046.06,-1278.81 999.77,-1266.26 959.22,-1255.27"/>
<polygon fill="black" stroke="black" points="959.89,-1251.82 949.32,-1252.59 958.06,-1258.58 959.89,-1251.82"/>
</g>
<!-- layer0_out_tp6&#45;&gt;layer0_out_tp7 -->
<g id="edge24" class="edge">
<title>layer0_out_tp6&#45;&gt;layer0_out_tp7</title>
<path fill="none" stroke="black" d="M848.32,-1200.4C845.4,-1191.93 842.08,-1182.31 838.95,-1173.23"/>
<polygon fill="black" stroke="black" points="842.23,-1171.99 835.66,-1163.67 835.61,-1174.27 842.23,-1171.99"/>
</g>
<!-- layer0_allreduce -->
<g id="node26" class="node">
<title>layer0_allreduce</title>
<ellipse fill="pink" stroke="black" stroke-dasharray="5,2" cx="827" cy="-1045.57" rx="77.15" ry="28.98"/>
<text text-anchor="middle" x="827" y="-1054.07" font-family="Arial" font-size="10.00">All&#45;Reduce Attention</text>
<text text-anchor="middle" x="827" y="-1043.07" font-family="Arial" font-size="10.00">TP Group All&#45;Reduce</text>
<text text-anchor="middle" x="827" y="-1032.07" font-family="Arial" font-size="10.00">8 GPUs</text>
</g>
<!-- layer0_out_tp7&#45;&gt;layer0_allreduce -->
<g id="edge25" class="edge">
<title>layer0_out_tp7&#45;&gt;layer0_allreduce</title>
<path fill="none" stroke="black" d="M827,-1111.5C827,-1103.27 827,-1093.94 827,-1084.96"/>
<polygon fill="black" stroke="black" points="830.5,-1084.67 827,-1074.67 823.5,-1084.67 830.5,-1084.67"/>
</g>
<!-- layer0_router -->
<g id="node27" class="node">
<title>layer0_router</title>
<polygon fill="lightyellow" stroke="black" stroke-dasharray="5,2" points="1133.76,-960.58 645.77,-960.58 520.24,-834.58 1008.23,-834.58 1133.76,-960.58"/>
<text text-anchor="middle" x="827" y="-917.08" font-family="Arial" font-size="10.00">Router</text>
<text text-anchor="middle" x="827" y="-906.08" font-family="Arial" font-size="10.00">Top&#45;K Expert Selection</text>
<text text-anchor="middle" x="827" y="-895.08" font-family="Arial" font-size="10.00">GPU: PP0_TP0_GPU</text>
<text text-anchor="middle" x="827" y="-884.08" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="827" y="-873.08" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, top_k=2]</text>
</g>
<!-- layer0_allreduce&#45;&gt;layer0_router -->
<g id="edge26" class="edge">
<title>layer0_allreduce&#45;&gt;layer0_router</title>
<path fill="none" stroke="black" d="M827,-1016.43C827,-1003.32 827,-987.06 827,-970.86"/>
<polygon fill="black" stroke="black" points="830.5,-970.8 827,-960.8 823.5,-970.8 830.5,-970.8"/>
</g>
<!-- layer0_dispatch -->
<g id="node28" class="node">
<title>layer0_dispatch</title>
<ellipse fill="pink" stroke="black" stroke-dasharray="5,2" cx="827" cy="-751.81" rx="104.8" ry="36.54"/>
<text text-anchor="middle" x="827" y="-765.81" font-family="Arial" font-size="10.00">Expert Dispatch</text>
<text text-anchor="middle" x="827" y="-754.81" font-family="Arial" font-size="10.00">Dispatch tokens to 64 experts</text>
<text text-anchor="middle" x="827" y="-743.81" font-family="Arial" font-size="10.00">All&#45;to&#45;All communication</text>
<text text-anchor="middle" x="827" y="-732.81" font-family="Arial" font-size="10.00">64 GPUs involved</text>
</g>
<!-- layer0_router&#45;&gt;layer0_dispatch -->
<g id="edge27" class="edge">
<title>layer0_router&#45;&gt;layer0_dispatch</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M827,-834.36C827,-822.39 827,-810.06 827,-798.72"/>
<polygon fill="black" stroke="black" points="830.5,-798.63 827,-788.63 823.5,-798.63 830.5,-798.63"/>
<text text-anchor="middle" x="859.5" y="-809.38" font-family="Arial" font-size="9.00">expert selection</text>
</g>
<!-- layer0_expert0 -->
<g id="node29" class="node">
<title>layer0_expert0</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="330.5,-678.04 23.5,-678.04 23.5,-626.04 330.5,-626.04 330.5,-678.04"/>
<text text-anchor="middle" x="177" y="-666.04" font-family="Arial" font-size="10.00">Expert 0</text>
<text text-anchor="middle" x="177" y="-655.04" font-family="Arial" font-size="10.00">GPU: PP0_EP0_GPU</text>
<text text-anchor="middle" x="177" y="-644.04" font-family="Arial" font-size="10.00">INPUT: [batch_size=~1, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="177" y="-633.04" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=~1, seq_len=128&#45;10240, hidden_dim=1024]</text>
</g>
<!-- layer0_dispatch&#45;&gt;layer0_expert0 -->
<g id="edge28" class="edge">
<title>layer0_dispatch&#45;&gt;layer0_expert0</title>
<path fill="none" stroke="black" d="M731.34,-736.63C635.43,-722.39 483.21,-699.71 340.8,-678.16"/>
<polygon fill="black" stroke="black" points="340.98,-674.65 330.57,-676.61 339.93,-681.57 340.98,-674.65"/>
</g>
<!-- layer0_expert1 -->
<g id="node30" class="node">
<title>layer0_expert1</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="655.5,-678.04 348.5,-678.04 348.5,-626.04 655.5,-626.04 655.5,-678.04"/>
<text text-anchor="middle" x="502" y="-666.04" font-family="Arial" font-size="10.00">Expert 1</text>
<text text-anchor="middle" x="502" y="-655.04" font-family="Arial" font-size="10.00">GPU: PP0_EP1_GPU</text>
<text text-anchor="middle" x="502" y="-644.04" font-family="Arial" font-size="10.00">INPUT: [batch_size=~1, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="502" y="-633.04" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=~1, seq_len=128&#45;10240, hidden_dim=1024]</text>
</g>
<!-- layer0_dispatch&#45;&gt;layer0_expert1 -->
<g id="edge29" class="edge">
<title>layer0_dispatch&#45;&gt;layer0_expert1</title>
<path fill="none" stroke="black" d="M748.74,-727.27C702.43,-713.34 643.5,-695.61 594.85,-680.98"/>
<polygon fill="black" stroke="black" points="595.85,-677.62 585.26,-678.09 593.83,-684.32 595.85,-677.62"/>
</g>
<!-- layer0_expert2 -->
<g id="node31" class="node">
<title>layer0_expert2</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="980.5,-678.04 673.5,-678.04 673.5,-626.04 980.5,-626.04 980.5,-678.04"/>
<text text-anchor="middle" x="827" y="-666.04" font-family="Arial" font-size="10.00">Expert 2</text>
<text text-anchor="middle" x="827" y="-655.04" font-family="Arial" font-size="10.00">GPU: PP0_EP2_GPU</text>
<text text-anchor="middle" x="827" y="-644.04" font-family="Arial" font-size="10.00">INPUT: [batch_size=~1, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="827" y="-633.04" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=~1, seq_len=128&#45;10240, hidden_dim=1024]</text>
</g>
<!-- layer0_dispatch&#45;&gt;layer0_expert2 -->
<g id="edge30" class="edge">
<title>layer0_dispatch&#45;&gt;layer0_expert2</title>
<path fill="none" stroke="black" d="M827,-714.96C827,-706.28 827,-697.01 827,-688.36"/>
<polygon fill="black" stroke="black" points="830.5,-688.19 827,-678.19 823.5,-688.19 830.5,-688.19"/>
</g>
<!-- layer0_expert3 -->
<g id="node32" class="node">
<title>layer0_expert3</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1305.5,-678.04 998.5,-678.04 998.5,-626.04 1305.5,-626.04 1305.5,-678.04"/>
<text text-anchor="middle" x="1152" y="-666.04" font-family="Arial" font-size="10.00">Expert 3</text>
<text text-anchor="middle" x="1152" y="-655.04" font-family="Arial" font-size="10.00">GPU: PP0_EP3_GPU</text>
<text text-anchor="middle" x="1152" y="-644.04" font-family="Arial" font-size="10.00">INPUT: [batch_size=~1, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="1152" y="-633.04" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=~1, seq_len=128&#45;10240, hidden_dim=1024]</text>
</g>
<!-- layer0_dispatch&#45;&gt;layer0_expert3 -->
<g id="edge31" class="edge">
<title>layer0_dispatch&#45;&gt;layer0_expert3</title>
<path fill="none" stroke="black" d="M905.26,-727.27C951.57,-713.34 1010.5,-695.61 1059.15,-680.98"/>
<polygon fill="black" stroke="black" points="1060.17,-684.32 1068.74,-678.09 1058.15,-677.62 1060.17,-684.32"/>
</g>
<!-- layer0_experts_ellipsis -->
<g id="node33" class="node">
<title>layer0_experts_ellipsis</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1420.5,-678.04 1323.5,-678.04 1323.5,-626.04 1420.5,-626.04 1420.5,-678.04"/>
<text text-anchor="middle" x="1372" y="-666.04" font-family="Arial" font-size="10.00">...</text>
<text text-anchor="middle" x="1372" y="-655.04" font-family="Arial" font-size="10.00">60 more experts</text>
<text text-anchor="middle" x="1372" y="-644.04" font-family="Arial" font-size="10.00"> distributed across</text>
<text text-anchor="middle" x="1372" y="-633.04" font-family="Arial" font-size="10.00">60 GPUs</text>
</g>
<!-- layer0_dispatch&#45;&gt;layer0_experts_ellipsis -->
<g id="edge32" class="edge">
<title>layer0_dispatch&#45;&gt;layer0_experts_ellipsis</title>
<path fill="none" stroke="black" d="M929.14,-743.51C1026.71,-734.74 1177.48,-716.48 1313.72,-678.12"/>
<polygon fill="black" stroke="black" points="1314.85,-681.44 1323.5,-675.33 1312.92,-674.71 1314.85,-681.44"/>
</g>
<!-- layer0_combine -->
<g id="node34" class="node">
<title>layer0_combine</title>
<ellipse fill="pink" stroke="black" stroke-dasharray="5,2" cx="827" cy="-552.27" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="827" y="-566.27" font-family="Arial" font-size="10.00">Expert Combine</text>
<text text-anchor="middle" x="827" y="-555.27" font-family="Arial" font-size="10.00">Combine expert outputs</text>
<text text-anchor="middle" x="827" y="-544.27" font-family="Arial" font-size="10.00">All&#45;to&#45;All communication</text>
<text text-anchor="middle" x="827" y="-533.27" font-family="Arial" font-size="10.00">64 GPUs involved</text>
</g>
<!-- layer0_expert0&#45;&gt;layer0_combine -->
<g id="edge33" class="edge">
<title>layer0_expert0&#45;&gt;layer0_combine</title>
<path fill="none" stroke="black" d="M330.57,-627.47C333.74,-626.99 336.89,-626.52 340,-626.04 477.96,-605.16 637.98,-581.32 735.83,-566.79"/>
<polygon fill="black" stroke="black" points="736.61,-570.21 745.99,-565.28 735.58,-563.29 736.61,-570.21"/>
</g>
<!-- layer0_expert1&#45;&gt;layer0_combine -->
<g id="edge34" class="edge">
<title>layer0_expert1&#45;&gt;layer0_combine</title>
<path fill="none" stroke="black" d="M585.27,-625.99C635.26,-610.96 698.49,-591.93 747.74,-577.12"/>
<polygon fill="black" stroke="black" points="748.83,-580.45 757.4,-574.21 746.81,-573.74 748.83,-580.45"/>
</g>
<!-- layer0_expert2&#45;&gt;layer0_combine -->
<g id="edge35" class="edge">
<title>layer0_expert2&#45;&gt;layer0_combine</title>
<path fill="none" stroke="black" d="M827,-625.87C827,-617.73 827,-608.43 827,-599.27"/>
<polygon fill="black" stroke="black" points="830.5,-599.05 827,-589.05 823.5,-599.05 830.5,-599.05"/>
</g>
<!-- layer0_expert3&#45;&gt;layer0_combine -->
<g id="edge36" class="edge">
<title>layer0_expert3&#45;&gt;layer0_combine</title>
<path fill="none" stroke="black" d="M1068.73,-625.99C1018.74,-610.96 955.51,-591.93 906.26,-577.12"/>
<polygon fill="black" stroke="black" points="907.19,-573.74 896.6,-574.21 905.17,-580.45 907.19,-573.74"/>
</g>
<!-- layer0_experts_ellipsis&#45;&gt;layer0_combine -->
<g id="edge37" class="edge">
<title>layer0_experts_ellipsis&#45;&gt;layer0_combine</title>
<path fill="none" stroke="black" d="M1323.5,-628.76C1320.65,-627.77 1317.8,-626.85 1315,-626.04 1181.71,-587.62 1021.78,-568.69 922.25,-559.96"/>
<polygon fill="black" stroke="black" points="922.47,-556.47 912.21,-559.1 921.87,-563.45 922.47,-556.47"/>
</g>
<!-- layer0_norm -->
<g id="node35" class="node">
<title>layer0_norm</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="980,-478.5 674,-478.5 674,-426.5 980,-426.5 980,-478.5"/>
<text text-anchor="middle" x="827" y="-466.5" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="827" y="-455.5" font-family="Arial" font-size="10.00">GPU: PP0_TP0_GPU</text>
<text text-anchor="middle" x="827" y="-444.5" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="827" y="-433.5" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
</g>
<!-- layer0_combine&#45;&gt;layer0_norm -->
<g id="edge38" class="edge">
<title>layer0_combine&#45;&gt;layer0_norm</title>
<path fill="none" stroke="black" d="M827,-515.42C827,-506.74 827,-497.47 827,-488.82"/>
<polygon fill="black" stroke="black" points="830.5,-488.65 827,-478.65 823.5,-488.65 830.5,-488.65"/>
</g>
<!-- pipeline_send -->
<g id="node36" class="node">
<title>pipeline_send</title>
<ellipse fill="orange" stroke="black" stroke-dasharray="5,2" cx="827" cy="-352.74" rx="96.75" ry="36.54"/>
<text text-anchor="middle" x="827" y="-366.74" font-family="Arial" font-size="10.00">Pipeline Send</text>
<text text-anchor="middle" x="827" y="-355.74" font-family="Arial" font-size="10.00">Send activations to Stage 1</text>
<text text-anchor="middle" x="827" y="-344.74" font-family="Arial" font-size="10.00">Pipeline communication</text>
<text text-anchor="middle" x="827" y="-333.74" font-family="Arial" font-size="10.00">GPU&#45;to&#45;GPU transfer</text>
</g>
<!-- layer0_norm&#45;&gt;pipeline_send -->
<g id="edge39" class="edge">
<title>layer0_norm&#45;&gt;pipeline_send</title>
<path fill="none" stroke="black" d="M827,-426.33C827,-418.19 827,-408.89 827,-399.73"/>
<polygon fill="black" stroke="black" points="830.5,-399.51 827,-389.51 823.5,-399.51 830.5,-399.51"/>
</g>
<!-- pipeline_receive -->
<g id="node37" class="node">
<title>pipeline_receive</title>
<ellipse fill="orange" stroke="black" stroke-dasharray="5,2" cx="827" cy="-221.2" rx="114.6" ry="36.54"/>
<text text-anchor="middle" x="827" y="-235.2" font-family="Arial" font-size="10.00">Pipeline Receive</text>
<text text-anchor="middle" x="827" y="-224.2" font-family="Arial" font-size="10.00">Receive activations from Stage 0</text>
<text text-anchor="middle" x="827" y="-213.2" font-family="Arial" font-size="10.00">Pipeline communication</text>
<text text-anchor="middle" x="827" y="-202.2" font-family="Arial" font-size="10.00">GPU&#45;to&#45;GPU transfer</text>
</g>
<!-- pipeline_send&#45;&gt;pipeline_receive -->
<g id="edge40" class="edge">
<title>pipeline_send&#45;&gt;pipeline_receive</title>
<path fill="none" stroke="black" d="M827,-315.65C827,-301.05 827,-284.02 827,-268.52"/>
<polygon fill="black" stroke="black" points="830.5,-268.09 827,-258.09 823.5,-268.09 830.5,-268.09"/>
</g>
<!-- stage1_processing -->
<g id="node38" class="node">
<title>stage1_processing</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="895,-147.43 759,-147.43 759,-95.43 895,-95.43 895,-147.43"/>
<text text-anchor="middle" x="827" y="-135.43" font-family="Arial" font-size="10.00">Stage 1 Processing</text>
<text text-anchor="middle" x="827" y="-124.43" font-family="Arial" font-size="10.00">Layers 8&#45;15</text>
<text text-anchor="middle" x="827" y="-113.43" font-family="Arial" font-size="10.00">Similar TP+EP pattern</text>
<text text-anchor="middle" x="827" y="-102.43" font-family="Arial" font-size="10.00">8 TP GPUs + 64 EP GPUs</text>
</g>
<!-- pipeline_receive&#45;&gt;stage1_processing -->
<g id="edge41" class="edge">
<title>pipeline_receive&#45;&gt;stage1_processing</title>
<path fill="none" stroke="black" d="M827,-184.35C827,-175.67 827,-166.4 827,-157.74"/>
<polygon fill="black" stroke="black" points="830.5,-157.57 827,-147.57 823.5,-157.57 830.5,-157.57"/>
</g>
<!-- output -->
<g id="node39" class="node">
<title>output</title>
<ellipse fill="lightcoral" stroke="black" stroke-dasharray="5,2" cx="827" cy="-37.21" rx="321.97" ry="21.43"/>
<text text-anchor="middle" x="827" y="-40.21" font-family="Arial" font-size="10.00">Final Output</text>
<text text-anchor="middle" x="827" y="-29.21" font-family="Arial" font-size="10.00">OUTPUT DIMENSION: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024, vocab_size=32000]</text>
</g>
<!-- stage1_processing&#45;&gt;output -->
<g id="edge42" class="edge">
<title>stage1_processing&#45;&gt;output</title>
<path fill="none" stroke="black" d="M827,-95.31C827,-86.92 827,-77.47 827,-68.72"/>
<polygon fill="black" stroke="black" points="830.5,-68.49 827,-58.49 823.5,-68.49 830.5,-68.49"/>
</g>
</g>
</svg>
