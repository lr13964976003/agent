<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="7333pt" height="9578pt"
 viewBox="0.00 0.00 1760.00 2298.76" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(4.17 4.17) rotate(0) translate(4 2294.76)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2294.76 1756,-2294.76 1756,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_pipeline_stage_0</title>
<path fill="lightgray" stroke="black" d="M20,-307.97C20,-307.97 1424,-307.97 1424,-307.97 1430,-307.97 1436,-313.97 1436,-319.97 1436,-319.97 1436,-2270.76 1436,-2270.76 1436,-2276.76 1430,-2282.76 1424,-2282.76 1424,-2282.76 20,-2282.76 20,-2282.76 14,-2282.76 8,-2276.76 8,-2270.76 8,-2270.76 8,-319.97 8,-319.97 8,-313.97 14,-307.97 20,-307.97"/>
<text text-anchor="middle" x="722" y="-2267.56" font-family="Times,serif" font-size="14.00">Pipeline Stage 0 (Layers 0&#45;7)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_layer0_attention</title>
<path fill="none" stroke="black" d="M273,-1008.58C273,-1008.58 1213,-1008.58 1213,-1008.58 1219,-1008.58 1225,-1014.58 1225,-1020.58 1225,-1020.58 1225,-1992.34 1225,-1992.34 1225,-1998.34 1219,-2004.34 1213,-2004.34 1213,-2004.34 273,-2004.34 273,-2004.34 267,-2004.34 261,-1998.34 261,-1992.34 261,-1992.34 261,-1020.58 261,-1020.58 261,-1014.58 267,-1008.58 273,-1008.58"/>
<text text-anchor="middle" x="743" y="-1990.74" font-family="Times,serif" font-size="12.00">Layer 0 &#45; Multi&#45;Head Attention (TP=8)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_layer0_moe</title>
<path fill="none" stroke="black" d="M28,-507.5C28,-507.5 1416,-507.5 1416,-507.5 1422,-507.5 1428,-513.5 1428,-519.5 1428,-519.5 1428,-977.58 1428,-977.58 1428,-983.58 1422,-989.58 1416,-989.58 1416,-989.58 28,-989.58 28,-989.58 22,-989.58 16,-983.58 16,-977.58 16,-977.58 16,-519.5 16,-519.5 16,-513.5 22,-507.5 28,-507.5"/>
<text text-anchor="middle" x="722" y="-975.98" font-family="Times,serif" font-size="12.00">Layer 0 &#45; MoE (EP=64)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_pipeline_stage_1</title>
<path fill="lightgray" stroke="black" d="M509,-8C509,-8 1145,-8 1145,-8 1151,-8 1157,-14 1157,-20 1157,-20 1157,-276.97 1157,-276.97 1157,-282.97 1151,-288.97 1145,-288.97 1145,-288.97 509,-288.97 509,-288.97 503,-288.97 497,-282.97 497,-276.97 497,-276.97 497,-20 497,-20 497,-14 503,-8 509,-8"/>
<text text-anchor="middle" x="827" y="-273.77" font-family="Times,serif" font-size="14.00">Pipeline Stage 1 (Layers 8&#45;15)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_data_parallel</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1456,-1904.57C1456,-1904.57 1732,-1904.57 1732,-1904.57 1738,-1904.57 1744,-1910.57 1744,-1916.57 1744,-1916.57 1744,-2161.34 1744,-2161.34 1744,-2167.34 1738,-2173.34 1732,-2173.34 1732,-2173.34 1456,-2173.34 1456,-2173.34 1450,-2173.34 1444,-2167.34 1444,-2161.34 1444,-2161.34 1444,-1916.57 1444,-1916.57 1444,-1910.57 1450,-1904.57 1456,-1904.57"/>
<text text-anchor="middle" x="1594" y="-2159.74" font-family="Times,serif" font-size="12.00">Data Parallelism (DP=2)</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightblue" stroke="black" stroke-dasharray="5,2" cx="1176" cy="-2230.55" rx="252.37" ry="21.43"/>
<text text-anchor="middle" x="1176" y="-2233.55" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="1176" y="-2222.55" font-family="Arial" font-size="10.00">INPUT DIMENSION: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
</g>
<!-- input_broadcast -->
<g id="node2" class="node">
<title>input_broadcast</title>
<polygon fill="lightyellow" stroke="black" stroke-dasharray="5,2" points="1403.67,-2133.34 1152.85,-2133.34 1088.33,-2051.34 1339.15,-2051.34 1403.67,-2133.34"/>
<text text-anchor="middle" x="1246" y="-2100.84" font-family="Arial" font-size="10.00">Input Broadcast</text>
<text text-anchor="middle" x="1246" y="-2089.84" font-family="Arial" font-size="10.00">Distribute input to TP=8 blocks</text>
<text text-anchor="middle" x="1246" y="-2078.84" font-family="Arial" font-size="10.00">GPU: PP0_TP0_GPU</text>
</g>
<!-- input&#45;&gt;input_broadcast -->
<g id="edge1" class="edge">
<title>input&#45;&gt;input_broadcast</title>
<path fill="none" stroke="black" d="M1186.48,-2209.16C1195.54,-2191.53 1209,-2165.34 1220.83,-2142.32"/>
<polygon fill="black" stroke="black" points="1223.98,-2143.84 1225.44,-2133.35 1217.75,-2140.64 1223.98,-2143.84"/>
</g>
<!-- dp_replica -->
<g id="node41" class="node">
<title>dp_replica</title>
<polygon fill="lightsteelblue" stroke="black" stroke-dasharray="5,2" points="1736.07,-2144.34 1510.07,-2144.34 1451.93,-2040.34 1677.93,-2040.34 1736.07,-2144.34"/>
<text text-anchor="middle" x="1594" y="-2106.34" font-family="Arial" font-size="10.00">Data Parallel Replica</text>
<text text-anchor="middle" x="1594" y="-2095.34" font-family="Arial" font-size="10.00">Batch 64 sequences</text>
<text text-anchor="middle" x="1594" y="-2084.34" font-family="Arial" font-size="10.00">Identical computation graph</text>
<text text-anchor="middle" x="1594" y="-2073.34" font-family="Arial" font-size="10.00">Gradient sync in training</text>
</g>
<!-- input&#45;&gt;dp_replica -->
<g id="edge51" class="edge">
<title>input&#45;&gt;dp_replica</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M1292.56,-2211.73C1339.19,-2202.81 1392.91,-2190.23 1440,-2173.34 1459.95,-2166.18 1480.57,-2156.91 1499.98,-2147.24"/>
<polygon fill="black" stroke="black" points="1501.76,-2150.26 1509.1,-2142.62 1498.6,-2144.01 1501.76,-2150.26"/>
<text text-anchor="middle" x="1433.5" y="-2184.14" font-family="Arial" font-size="9.00">DP replica</text>
</g>
<!-- layer0_qkv_tp0 -->
<g id="node3" class="node">
<title>layer0_qkv_tp0</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="873.5,-1975.34 568.5,-1975.34 568.5,-1923.34 873.5,-1923.34 873.5,-1975.34"/>
<text text-anchor="middle" x="721" y="-1963.34" font-family="Arial" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="721" y="-1952.34" font-family="Arial" font-size="10.00">GPU: PP0_TP0_GPU</text>
<text text-anchor="middle" x="721" y="-1941.34" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="721" y="-1930.34" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- input_broadcast&#45;&gt;layer0_qkv_tp0 -->
<g id="edge2" class="edge">
<title>input_broadcast&#45;&gt;layer0_qkv_tp0</title>
<path fill="none" stroke="black" d="M1094.27,-2059.02C1027.54,-2043.9 948.47,-2024.73 878,-2004.34 851.85,-1996.77 823.63,-1987.44 798.43,-1978.67"/>
<polygon fill="black" stroke="black" points="799.52,-1975.34 788.92,-1975.34 797.2,-1981.95 799.52,-1975.34"/>
</g>
<!-- layer0_qkv_tp1 -->
<g id="node4" class="node">
<title>layer0_qkv_tp1</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1064.5,-1875.57 759.5,-1875.57 759.5,-1823.57 1064.5,-1823.57 1064.5,-1875.57"/>
<text text-anchor="middle" x="912" y="-1863.57" font-family="Arial" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="912" y="-1852.57" font-family="Arial" font-size="10.00">GPU: PP0_TP1_GPU</text>
<text text-anchor="middle" x="912" y="-1841.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="912" y="-1830.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- input_broadcast&#45;&gt;layer0_qkv_tp1 -->
<g id="edge3" class="edge">
<title>input_broadcast&#45;&gt;layer0_qkv_tp1</title>
<path fill="none" stroke="black" d="M1178.97,-2051.17C1164.3,-2041.97 1148.99,-2032.03 1135,-2022.34 1068.27,-1976.07 994.22,-1917.5 950.46,-1882.09"/>
<polygon fill="black" stroke="black" points="952.62,-1879.34 942.65,-1875.75 948.21,-1884.77 952.62,-1879.34"/>
</g>
<!-- layer0_qkv_tp2 -->
<g id="node5" class="node">
<title>layer0_qkv_tp2</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1216.5,-1786.57 911.5,-1786.57 911.5,-1734.57 1216.5,-1734.57 1216.5,-1786.57"/>
<text text-anchor="middle" x="1064" y="-1774.57" font-family="Arial" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="1064" y="-1763.57" font-family="Arial" font-size="10.00">GPU: PP0_TP2_GPU</text>
<text text-anchor="middle" x="1064" y="-1752.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="1064" y="-1741.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- input_broadcast&#45;&gt;layer0_qkv_tp2 -->
<g id="edge4" class="edge">
<title>input_broadcast&#45;&gt;layer0_qkv_tp2</title>
<path fill="none" stroke="black" d="M1223.87,-2051.23C1187.73,-1985.76 1116.71,-1857.08 1082.84,-1795.7"/>
<polygon fill="black" stroke="black" points="1085.82,-1793.86 1077.93,-1786.8 1079.69,-1797.25 1085.82,-1793.86"/>
</g>
<!-- layer0_qkv_tp3 -->
<g id="node6" class="node">
<title>layer0_qkv_tp3</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1216.5,-1697.57 911.5,-1697.57 911.5,-1645.57 1216.5,-1645.57 1216.5,-1697.57"/>
<text text-anchor="middle" x="1064" y="-1685.57" font-family="Arial" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="1064" y="-1674.57" font-family="Arial" font-size="10.00">GPU: PP0_TP3_GPU</text>
<text text-anchor="middle" x="1064" y="-1663.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="1064" y="-1652.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- input_broadcast&#45;&gt;layer0_qkv_tp3 -->
<g id="edge5" class="edge">
<title>input_broadcast&#45;&gt;layer0_qkv_tp3</title>
<path fill="none" stroke="black" d="M1241.64,-2051.28C1238.95,-2023.08 1236,-1984.45 1236,-1950.34 1236,-1950.34 1236,-1950.34 1236,-1759.57 1236,-1733.57 1220.16,-1715.34 1198.09,-1702.55"/>
<polygon fill="black" stroke="black" points="1199.48,-1699.33 1189,-1697.75 1196.2,-1705.51 1199.48,-1699.33"/>
</g>
<!-- layer0_qkv_tp4 -->
<g id="node7" class="node">
<title>layer0_qkv_tp4</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1216.5,-1608.57 911.5,-1608.57 911.5,-1556.57 1216.5,-1556.57 1216.5,-1608.57"/>
<text text-anchor="middle" x="1064" y="-1596.57" font-family="Arial" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="1064" y="-1585.57" font-family="Arial" font-size="10.00">GPU: PP0_TP4_GPU</text>
<text text-anchor="middle" x="1064" y="-1574.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="1064" y="-1563.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- input_broadcast&#45;&gt;layer0_qkv_tp4 -->
<g id="edge6" class="edge">
<title>input_broadcast&#45;&gt;layer0_qkv_tp4</title>
<path fill="none" stroke="black" d="M1250.36,-2051.28C1253.05,-2023.08 1256,-1984.45 1256,-1950.34 1256,-1950.34 1256,-1950.34 1256,-1670.57 1256,-1644.56 1241.2,-1626.29 1219.83,-1613.46"/>
<polygon fill="black" stroke="black" points="1221.44,-1610.35 1210.98,-1608.63 1218.09,-1616.5 1221.44,-1610.35"/>
</g>
<!-- layer0_qkv_tp5 -->
<g id="node8" class="node">
<title>layer0_qkv_tp5</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1216.5,-1519.57 911.5,-1519.57 911.5,-1467.57 1216.5,-1467.57 1216.5,-1519.57"/>
<text text-anchor="middle" x="1064" y="-1507.57" font-family="Arial" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="1064" y="-1496.57" font-family="Arial" font-size="10.00">GPU: PP0_TP5_GPU</text>
<text text-anchor="middle" x="1064" y="-1485.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="1064" y="-1474.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- input_broadcast&#45;&gt;layer0_qkv_tp5 -->
<g id="edge7" class="edge">
<title>input_broadcast&#45;&gt;layer0_qkv_tp5</title>
<path fill="none" stroke="black" d="M1259.25,-2051.09C1267.28,-2023.15 1276,-1984.87 1276,-1950.34 1276,-1950.34 1276,-1950.34 1276,-1581.57 1276,-1558.02 1230.68,-1537.65 1181.95,-1522.55"/>
<polygon fill="black" stroke="black" points="1182.76,-1519.14 1172.17,-1519.6 1180.74,-1525.84 1182.76,-1519.14"/>
</g>
<!-- layer0_qkv_tp6 -->
<g id="node9" class="node">
<title>layer0_qkv_tp6</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1216.5,-1430.57 911.5,-1430.57 911.5,-1378.57 1216.5,-1378.57 1216.5,-1430.57"/>
<text text-anchor="middle" x="1064" y="-1418.57" font-family="Arial" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="1064" y="-1407.57" font-family="Arial" font-size="10.00">GPU: PP0_TP6_GPU</text>
<text text-anchor="middle" x="1064" y="-1396.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="1064" y="-1385.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- input_broadcast&#45;&gt;layer0_qkv_tp6 -->
<g id="edge8" class="edge">
<title>input_broadcast&#45;&gt;layer0_qkv_tp6</title>
<path fill="none" stroke="black" d="M1268.37,-2051.32C1281.68,-2023.8 1296,-1985.92 1296,-1950.34 1296,-1950.34 1296,-1950.34 1296,-1492.57 1296,-1467.96 1249.69,-1447.98 1198.45,-1433.4"/>
<polygon fill="black" stroke="black" points="1199.06,-1429.93 1188.49,-1430.64 1197.2,-1436.68 1199.06,-1429.93"/>
</g>
<!-- layer0_qkv_tp7 -->
<g id="node10" class="node">
<title>layer0_qkv_tp7</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1216.5,-1341.57 911.5,-1341.57 911.5,-1289.57 1216.5,-1289.57 1216.5,-1341.57"/>
<text text-anchor="middle" x="1064" y="-1329.57" font-family="Arial" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="1064" y="-1318.57" font-family="Arial" font-size="10.00">GPU: PP0_TP7_GPU</text>
<text text-anchor="middle" x="1064" y="-1307.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="1064" y="-1296.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- input_broadcast&#45;&gt;layer0_qkv_tp7 -->
<g id="edge9" class="edge">
<title>input_broadcast&#45;&gt;layer0_qkv_tp7</title>
<path fill="none" stroke="black" d="M1278.34,-2051.04C1296.68,-2024.15 1316,-1987.09 1316,-1950.34 1316,-1950.34 1316,-1950.34 1316,-1403.57 1316,-1378.02 1269.15,-1358.33 1215.85,-1344.2"/>
<polygon fill="black" stroke="black" points="1216.39,-1340.72 1205.84,-1341.62 1214.65,-1347.5 1216.39,-1340.72"/>
</g>
<!-- layer0_attn_tp0 -->
<g id="node11" class="node">
<title>layer0_attn_tp0</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="630.5,-1875.57 325.5,-1875.57 325.5,-1823.57 630.5,-1823.57 630.5,-1875.57"/>
<text text-anchor="middle" x="478" y="-1863.57" font-family="Arial" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="478" y="-1852.57" font-family="Arial" font-size="10.00">GPU: PP0_TP0_GPU</text>
<text text-anchor="middle" x="478" y="-1841.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="478" y="-1830.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_qkv_tp0&#45;&gt;layer0_attn_tp0 -->
<g id="edge10" class="edge">
<title>layer0_qkv_tp0&#45;&gt;layer0_attn_tp0</title>
<path fill="none" stroke="black" d="M658.74,-1923.28C625.57,-1909.94 584.62,-1893.46 550.08,-1879.57"/>
<polygon fill="black" stroke="black" points="551.11,-1876.21 540.52,-1875.72 548.49,-1882.7 551.11,-1876.21"/>
</g>
<!-- layer0_attn_tp1 -->
<g id="node12" class="node">
<title>layer0_attn_tp1</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="893.5,-1786.57 588.5,-1786.57 588.5,-1734.57 893.5,-1734.57 893.5,-1786.57"/>
<text text-anchor="middle" x="741" y="-1774.57" font-family="Arial" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="741" y="-1763.57" font-family="Arial" font-size="10.00">GPU: PP0_TP1_GPU</text>
<text text-anchor="middle" x="741" y="-1752.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="741" y="-1741.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_qkv_tp1&#45;&gt;layer0_attn_tp1 -->
<g id="edge11" class="edge">
<title>layer0_qkv_tp1&#45;&gt;layer0_attn_tp1</title>
<path fill="none" stroke="black" d="M862.54,-1823.4C842.78,-1813.35 819.87,-1801.69 799.31,-1791.23"/>
<polygon fill="black" stroke="black" points="800.85,-1788.09 790.35,-1786.67 797.67,-1794.33 800.85,-1788.09"/>
</g>
<!-- layer0_attn_tp2 -->
<g id="node13" class="node">
<title>layer0_attn_tp2</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="893.5,-1697.57 588.5,-1697.57 588.5,-1645.57 893.5,-1645.57 893.5,-1697.57"/>
<text text-anchor="middle" x="741" y="-1685.57" font-family="Arial" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="741" y="-1674.57" font-family="Arial" font-size="10.00">GPU: PP0_TP2_GPU</text>
<text text-anchor="middle" x="741" y="-1663.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="741" y="-1652.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_qkv_tp2&#45;&gt;layer0_attn_tp2 -->
<g id="edge12" class="edge">
<title>layer0_qkv_tp2&#45;&gt;layer0_attn_tp2</title>
<path fill="none" stroke="black" d="M911.45,-1735.62C875.75,-1729.19 843.14,-1722.4 826,-1716.57 814.93,-1712.8 803.52,-1707.77 792.8,-1702.47"/>
<polygon fill="black" stroke="black" points="794.07,-1699.19 783.58,-1697.76 790.89,-1705.43 794.07,-1699.19"/>
</g>
<!-- layer0_attn_tp3 -->
<g id="node14" class="node">
<title>layer0_attn_tp3</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="893.5,-1608.57 588.5,-1608.57 588.5,-1556.57 893.5,-1556.57 893.5,-1608.57"/>
<text text-anchor="middle" x="741" y="-1596.57" font-family="Arial" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="741" y="-1585.57" font-family="Arial" font-size="10.00">GPU: PP0_TP3_GPU</text>
<text text-anchor="middle" x="741" y="-1574.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="741" y="-1563.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_qkv_tp3&#45;&gt;layer0_attn_tp3 -->
<g id="edge13" class="edge">
<title>layer0_qkv_tp3&#45;&gt;layer0_attn_tp3</title>
<path fill="none" stroke="black" d="M971.01,-1645.52C931.15,-1634.78 884.46,-1622.21 843.6,-1611.2"/>
<polygon fill="black" stroke="black" points="844.46,-1607.81 833.89,-1608.59 842.64,-1614.57 844.46,-1607.81"/>
</g>
<!-- layer0_attn_tp4 -->
<g id="node15" class="node">
<title>layer0_attn_tp4</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="893.5,-1519.57 588.5,-1519.57 588.5,-1467.57 893.5,-1467.57 893.5,-1519.57"/>
<text text-anchor="middle" x="741" y="-1507.57" font-family="Arial" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="741" y="-1496.57" font-family="Arial" font-size="10.00">GPU: PP0_TP4_GPU</text>
<text text-anchor="middle" x="741" y="-1485.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="741" y="-1474.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_qkv_tp4&#45;&gt;layer0_attn_tp4 -->
<g id="edge14" class="edge">
<title>layer0_qkv_tp4&#45;&gt;layer0_attn_tp4</title>
<path fill="none" stroke="black" d="M971.01,-1556.52C931.15,-1545.78 884.46,-1533.21 843.6,-1522.2"/>
<polygon fill="black" stroke="black" points="844.46,-1518.81 833.89,-1519.59 842.64,-1525.57 844.46,-1518.81"/>
</g>
<!-- layer0_attn_tp5 -->
<g id="node16" class="node">
<title>layer0_attn_tp5</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="893.5,-1430.57 588.5,-1430.57 588.5,-1378.57 893.5,-1378.57 893.5,-1430.57"/>
<text text-anchor="middle" x="741" y="-1418.57" font-family="Arial" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="741" y="-1407.57" font-family="Arial" font-size="10.00">GPU: PP0_TP5_GPU</text>
<text text-anchor="middle" x="741" y="-1396.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="741" y="-1385.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_qkv_tp5&#45;&gt;layer0_attn_tp5 -->
<g id="edge15" class="edge">
<title>layer0_qkv_tp5&#45;&gt;layer0_attn_tp5</title>
<path fill="none" stroke="black" d="M971.01,-1467.52C931.15,-1456.78 884.46,-1444.21 843.6,-1433.2"/>
<polygon fill="black" stroke="black" points="844.46,-1429.81 833.89,-1430.59 842.64,-1436.57 844.46,-1429.81"/>
</g>
<!-- layer0_attn_tp6 -->
<g id="node17" class="node">
<title>layer0_attn_tp6</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="893.5,-1341.57 588.5,-1341.57 588.5,-1289.57 893.5,-1289.57 893.5,-1341.57"/>
<text text-anchor="middle" x="741" y="-1329.57" font-family="Arial" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="741" y="-1318.57" font-family="Arial" font-size="10.00">GPU: PP0_TP6_GPU</text>
<text text-anchor="middle" x="741" y="-1307.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="741" y="-1296.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_qkv_tp6&#45;&gt;layer0_attn_tp6 -->
<g id="edge16" class="edge">
<title>layer0_qkv_tp6&#45;&gt;layer0_attn_tp6</title>
<path fill="none" stroke="black" d="M911.45,-1379.62C875.75,-1373.19 843.14,-1366.4 826,-1360.57 814.93,-1356.8 803.52,-1351.77 792.8,-1346.47"/>
<polygon fill="black" stroke="black" points="794.07,-1343.19 783.58,-1341.76 790.89,-1349.43 794.07,-1343.19"/>
</g>
<!-- layer0_attn_tp7 -->
<g id="node18" class="node">
<title>layer0_attn_tp7</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1215.5,-1252.57 910.5,-1252.57 910.5,-1200.57 1215.5,-1200.57 1215.5,-1252.57"/>
<text text-anchor="middle" x="1063" y="-1240.57" font-family="Arial" font-size="10.00">Attention Score</text>
<text text-anchor="middle" x="1063" y="-1229.57" font-family="Arial" font-size="10.00">GPU: PP0_TP7_GPU</text>
<text text-anchor="middle" x="1063" y="-1218.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="1063" y="-1207.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
</g>
<!-- layer0_qkv_tp7&#45;&gt;layer0_attn_tp7 -->
<g id="edge17" class="edge">
<title>layer0_qkv_tp7&#45;&gt;layer0_attn_tp7</title>
<path fill="none" stroke="black" d="M1063.71,-1289.4C1063.62,-1281.11 1063.51,-1271.72 1063.41,-1262.81"/>
<polygon fill="black" stroke="black" points="1066.9,-1262.63 1063.29,-1252.67 1059.9,-1262.71 1066.9,-1262.63"/>
</g>
<!-- layer0_out_tp0 -->
<g id="node19" class="node">
<title>layer0_out_tp0</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="570.5,-1786.57 269.5,-1786.57 269.5,-1734.57 570.5,-1734.57 570.5,-1786.57"/>
<text text-anchor="middle" x="420" y="-1774.57" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="420" y="-1763.57" font-family="Arial" font-size="10.00">GPU: PP0_TP0_GPU</text>
<text text-anchor="middle" x="420" y="-1752.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="420" y="-1741.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=128]</text>
</g>
<!-- layer0_attn_tp0&#45;&gt;layer0_out_tp0 -->
<g id="edge18" class="edge">
<title>layer0_attn_tp0&#45;&gt;layer0_out_tp0</title>
<path fill="none" stroke="black" d="M461.22,-1823.4C455.33,-1814.56 448.62,-1804.49 442.34,-1795.08"/>
<polygon fill="black" stroke="black" points="445.2,-1793.05 436.74,-1786.67 439.37,-1796.94 445.2,-1793.05"/>
</g>
<!-- layer0_out_tp1 -->
<g id="node20" class="node">
<title>layer0_out_tp1</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="570.5,-1697.57 269.5,-1697.57 269.5,-1645.57 570.5,-1645.57 570.5,-1697.57"/>
<text text-anchor="middle" x="420" y="-1685.57" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="420" y="-1674.57" font-family="Arial" font-size="10.00">GPU: PP0_TP1_GPU</text>
<text text-anchor="middle" x="420" y="-1663.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="420" y="-1652.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=128]</text>
</g>
<!-- layer0_attn_tp1&#45;&gt;layer0_out_tp1 -->
<g id="edge19" class="edge">
<title>layer0_attn_tp1&#45;&gt;layer0_out_tp1</title>
<path fill="none" stroke="black" d="M648.58,-1734.52C609.06,-1723.81 562.77,-1711.26 522.22,-1700.27"/>
<polygon fill="black" stroke="black" points="522.89,-1696.82 512.32,-1697.59 521.06,-1703.58 522.89,-1696.82"/>
</g>
<!-- layer0_out_tp2 -->
<g id="node21" class="node">
<title>layer0_out_tp2</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="570.5,-1608.57 269.5,-1608.57 269.5,-1556.57 570.5,-1556.57 570.5,-1608.57"/>
<text text-anchor="middle" x="420" y="-1596.57" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="420" y="-1585.57" font-family="Arial" font-size="10.00">GPU: PP0_TP2_GPU</text>
<text text-anchor="middle" x="420" y="-1574.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="420" y="-1563.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=128]</text>
</g>
<!-- layer0_attn_tp2&#45;&gt;layer0_out_tp2 -->
<g id="edge20" class="edge">
<title>layer0_attn_tp2&#45;&gt;layer0_out_tp2</title>
<path fill="none" stroke="black" d="M648.58,-1645.52C609.06,-1634.81 562.77,-1622.26 522.22,-1611.27"/>
<polygon fill="black" stroke="black" points="522.89,-1607.82 512.32,-1608.59 521.06,-1614.58 522.89,-1607.82"/>
</g>
<!-- layer0_out_tp3 -->
<g id="node22" class="node">
<title>layer0_out_tp3</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="570.5,-1519.57 269.5,-1519.57 269.5,-1467.57 570.5,-1467.57 570.5,-1519.57"/>
<text text-anchor="middle" x="420" y="-1507.57" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="420" y="-1496.57" font-family="Arial" font-size="10.00">GPU: PP0_TP3_GPU</text>
<text text-anchor="middle" x="420" y="-1485.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="420" y="-1474.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=128]</text>
</g>
<!-- layer0_attn_tp3&#45;&gt;layer0_out_tp3 -->
<g id="edge21" class="edge">
<title>layer0_attn_tp3&#45;&gt;layer0_out_tp3</title>
<path fill="none" stroke="black" d="M648.58,-1556.52C609.06,-1545.81 562.77,-1533.26 522.22,-1522.27"/>
<polygon fill="black" stroke="black" points="522.89,-1518.82 512.32,-1519.59 521.06,-1525.58 522.89,-1518.82"/>
</g>
<!-- layer0_out_tp4 -->
<g id="node23" class="node">
<title>layer0_out_tp4</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="570.5,-1430.57 269.5,-1430.57 269.5,-1378.57 570.5,-1378.57 570.5,-1430.57"/>
<text text-anchor="middle" x="420" y="-1418.57" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="420" y="-1407.57" font-family="Arial" font-size="10.00">GPU: PP0_TP4_GPU</text>
<text text-anchor="middle" x="420" y="-1396.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="420" y="-1385.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=128]</text>
</g>
<!-- layer0_attn_tp4&#45;&gt;layer0_out_tp4 -->
<g id="edge22" class="edge">
<title>layer0_attn_tp4&#45;&gt;layer0_out_tp4</title>
<path fill="none" stroke="black" d="M648.58,-1467.52C609.06,-1456.81 562.77,-1444.26 522.22,-1433.27"/>
<polygon fill="black" stroke="black" points="522.89,-1429.82 512.32,-1430.59 521.06,-1436.58 522.89,-1429.82"/>
</g>
<!-- layer0_out_tp5 -->
<g id="node24" class="node">
<title>layer0_out_tp5</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="570.5,-1341.57 269.5,-1341.57 269.5,-1289.57 570.5,-1289.57 570.5,-1341.57"/>
<text text-anchor="middle" x="420" y="-1329.57" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="420" y="-1318.57" font-family="Arial" font-size="10.00">GPU: PP0_TP5_GPU</text>
<text text-anchor="middle" x="420" y="-1307.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="420" y="-1296.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=128]</text>
</g>
<!-- layer0_attn_tp5&#45;&gt;layer0_out_tp5 -->
<g id="edge23" class="edge">
<title>layer0_attn_tp5&#45;&gt;layer0_out_tp5</title>
<path fill="none" stroke="black" d="M648.58,-1378.52C609.06,-1367.81 562.77,-1355.26 522.22,-1344.27"/>
<polygon fill="black" stroke="black" points="522.89,-1340.82 512.32,-1341.59 521.06,-1347.58 522.89,-1340.82"/>
</g>
<!-- layer0_out_tp6 -->
<g id="node25" class="node">
<title>layer0_out_tp6</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="891.5,-1252.57 590.5,-1252.57 590.5,-1200.57 891.5,-1200.57 891.5,-1252.57"/>
<text text-anchor="middle" x="741" y="-1240.57" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="741" y="-1229.57" font-family="Arial" font-size="10.00">GPU: PP0_TP6_GPU</text>
<text text-anchor="middle" x="741" y="-1218.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="741" y="-1207.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=128]</text>
</g>
<!-- layer0_attn_tp6&#45;&gt;layer0_out_tp6 -->
<g id="edge24" class="edge">
<title>layer0_attn_tp6&#45;&gt;layer0_out_tp6</title>
<path fill="none" stroke="black" d="M741,-1289.4C741,-1281.11 741,-1271.72 741,-1262.81"/>
<polygon fill="black" stroke="black" points="744.5,-1262.67 741,-1252.67 737.5,-1262.67 744.5,-1262.67"/>
</g>
<!-- layer0_out_tp7 -->
<g id="node26" class="node">
<title>layer0_out_tp7</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="977.5,-1163.57 676.5,-1163.57 676.5,-1111.57 977.5,-1111.57 977.5,-1163.57"/>
<text text-anchor="middle" x="827" y="-1151.57" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="827" y="-1140.57" font-family="Arial" font-size="10.00">GPU: PP0_TP7_GPU</text>
<text text-anchor="middle" x="827" y="-1129.57" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, heads=2, d_k=64]</text>
<text text-anchor="middle" x="827" y="-1118.57" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=128]</text>
</g>
<!-- layer0_attn_tp7&#45;&gt;layer0_out_tp7 -->
<g id="edge25" class="edge">
<title>layer0_attn_tp7&#45;&gt;layer0_out_tp7</title>
<path fill="none" stroke="black" d="M995.06,-1200.52C966.8,-1190.1 933.83,-1177.95 904.62,-1167.18"/>
<polygon fill="black" stroke="black" points="905.47,-1163.76 894.87,-1163.59 903.05,-1170.33 905.47,-1163.76"/>
</g>
<!-- layer0_out_tp0&#45;&gt;layer0_out_tp1 -->
<g id="edge26" class="edge">
<title>layer0_out_tp0&#45;&gt;layer0_out_tp1</title>
<path fill="none" stroke="black" d="M420,-1734.4C420,-1726.11 420,-1716.72 420,-1707.81"/>
<polygon fill="black" stroke="black" points="423.5,-1707.67 420,-1697.67 416.5,-1707.67 423.5,-1707.67"/>
</g>
<!-- layer0_out_tp1&#45;&gt;layer0_out_tp2 -->
<g id="edge27" class="edge">
<title>layer0_out_tp1&#45;&gt;layer0_out_tp2</title>
<path fill="none" stroke="black" d="M420,-1645.4C420,-1637.11 420,-1627.72 420,-1618.81"/>
<polygon fill="black" stroke="black" points="423.5,-1618.67 420,-1608.67 416.5,-1618.67 423.5,-1618.67"/>
</g>
<!-- layer0_out_tp2&#45;&gt;layer0_out_tp3 -->
<g id="edge28" class="edge">
<title>layer0_out_tp2&#45;&gt;layer0_out_tp3</title>
<path fill="none" stroke="black" d="M420,-1556.4C420,-1548.11 420,-1538.72 420,-1529.81"/>
<polygon fill="black" stroke="black" points="423.5,-1529.67 420,-1519.67 416.5,-1529.67 423.5,-1529.67"/>
</g>
<!-- layer0_out_tp3&#45;&gt;layer0_out_tp4 -->
<g id="edge29" class="edge">
<title>layer0_out_tp3&#45;&gt;layer0_out_tp4</title>
<path fill="none" stroke="black" d="M420,-1467.4C420,-1459.11 420,-1449.72 420,-1440.81"/>
<polygon fill="black" stroke="black" points="423.5,-1440.67 420,-1430.67 416.5,-1440.67 423.5,-1440.67"/>
</g>
<!-- layer0_out_tp4&#45;&gt;layer0_out_tp5 -->
<g id="edge30" class="edge">
<title>layer0_out_tp4&#45;&gt;layer0_out_tp5</title>
<path fill="none" stroke="black" d="M420,-1378.4C420,-1370.11 420,-1360.72 420,-1351.81"/>
<polygon fill="black" stroke="black" points="423.5,-1351.67 420,-1341.67 416.5,-1351.67 423.5,-1351.67"/>
</g>
<!-- layer0_out_tp5&#45;&gt;layer0_out_tp6 -->
<g id="edge31" class="edge">
<title>layer0_out_tp5&#45;&gt;layer0_out_tp6</title>
<path fill="none" stroke="black" d="M512.42,-1289.52C551.94,-1278.81 598.23,-1266.26 638.78,-1255.27"/>
<polygon fill="black" stroke="black" points="639.94,-1258.58 648.68,-1252.59 638.11,-1251.82 639.94,-1258.58"/>
</g>
<!-- layer0_out_tp6&#45;&gt;layer0_out_tp7 -->
<g id="edge32" class="edge">
<title>layer0_out_tp6&#45;&gt;layer0_out_tp7</title>
<path fill="none" stroke="black" d="M765.87,-1200.4C774.97,-1191.2 785.38,-1180.67 795.01,-1170.93"/>
<polygon fill="black" stroke="black" points="797.64,-1173.25 802.18,-1163.67 792.66,-1168.32 797.64,-1173.25"/>
</g>
<!-- layer0_allreduce -->
<g id="node27" class="node">
<title>layer0_allreduce</title>
<ellipse fill="pink" stroke="black" stroke-dasharray="5,2" cx="827" cy="-1045.57" rx="77.15" ry="28.98"/>
<text text-anchor="middle" x="827" y="-1054.07" font-family="Arial" font-size="10.00">All&#45;Reduce Attention</text>
<text text-anchor="middle" x="827" y="-1043.07" font-family="Arial" font-size="10.00">TP Group All&#45;Reduce</text>
<text text-anchor="middle" x="827" y="-1032.07" font-family="Arial" font-size="10.00">8 GPUs</text>
</g>
<!-- layer0_out_tp7&#45;&gt;layer0_allreduce -->
<g id="edge33" class="edge">
<title>layer0_out_tp7&#45;&gt;layer0_allreduce</title>
<path fill="none" stroke="black" d="M827,-1111.5C827,-1103.27 827,-1093.94 827,-1084.96"/>
<polygon fill="black" stroke="black" points="830.5,-1084.67 827,-1074.67 823.5,-1084.67 830.5,-1084.67"/>
</g>
<!-- layer0_router -->
<g id="node28" class="node">
<title>layer0_router</title>
<polygon fill="lightyellow" stroke="black" stroke-dasharray="5,2" points="1133.76,-960.58 645.77,-960.58 520.24,-834.58 1008.23,-834.58 1133.76,-960.58"/>
<text text-anchor="middle" x="827" y="-917.08" font-family="Arial" font-size="10.00">Router</text>
<text text-anchor="middle" x="827" y="-906.08" font-family="Arial" font-size="10.00">Top&#45;K Expert Selection</text>
<text text-anchor="middle" x="827" y="-895.08" font-family="Arial" font-size="10.00">GPU: PP0_TP0_GPU</text>
<text text-anchor="middle" x="827" y="-884.08" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="827" y="-873.08" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, top_k=2]</text>
</g>
<!-- layer0_allreduce&#45;&gt;layer0_router -->
<g id="edge34" class="edge">
<title>layer0_allreduce&#45;&gt;layer0_router</title>
<path fill="none" stroke="black" d="M827,-1016.43C827,-1003.32 827,-987.06 827,-970.86"/>
<polygon fill="black" stroke="black" points="830.5,-970.8 827,-960.8 823.5,-970.8 830.5,-970.8"/>
</g>
<!-- layer0_dispatch -->
<g id="node29" class="node">
<title>layer0_dispatch</title>
<ellipse fill="pink" stroke="black" stroke-dasharray="5,2" cx="827" cy="-751.81" rx="104.8" ry="36.54"/>
<text text-anchor="middle" x="827" y="-765.81" font-family="Arial" font-size="10.00">Expert Dispatch</text>
<text text-anchor="middle" x="827" y="-754.81" font-family="Arial" font-size="10.00">Dispatch tokens to 64 experts</text>
<text text-anchor="middle" x="827" y="-743.81" font-family="Arial" font-size="10.00">All&#45;to&#45;All communication</text>
<text text-anchor="middle" x="827" y="-732.81" font-family="Arial" font-size="10.00">64 GPUs involved</text>
</g>
<!-- layer0_router&#45;&gt;layer0_dispatch -->
<g id="edge35" class="edge">
<title>layer0_router&#45;&gt;layer0_dispatch</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M827,-834.36C827,-822.39 827,-810.06 827,-798.72"/>
<polygon fill="black" stroke="black" points="830.5,-798.63 827,-788.63 823.5,-798.63 830.5,-798.63"/>
<text text-anchor="middle" x="859.5" y="-809.38" font-family="Arial" font-size="9.00">expert selection</text>
</g>
<!-- layer0_expert0 -->
<g id="node30" class="node">
<title>layer0_expert0</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="330.5,-678.04 23.5,-678.04 23.5,-626.04 330.5,-626.04 330.5,-678.04"/>
<text text-anchor="middle" x="177" y="-666.04" font-family="Arial" font-size="10.00">Expert 0</text>
<text text-anchor="middle" x="177" y="-655.04" font-family="Arial" font-size="10.00">GPU: PP0_EP0_GPU</text>
<text text-anchor="middle" x="177" y="-644.04" font-family="Arial" font-size="10.00">INPUT: [batch_size=~1, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="177" y="-633.04" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=~1, seq_len=128&#45;10240, hidden_dim=1024]</text>
</g>
<!-- layer0_dispatch&#45;&gt;layer0_expert0 -->
<g id="edge36" class="edge">
<title>layer0_dispatch&#45;&gt;layer0_expert0</title>
<path fill="none" stroke="black" d="M731.34,-736.63C635.43,-722.39 483.21,-699.71 340.8,-678.16"/>
<polygon fill="black" stroke="black" points="340.98,-674.65 330.57,-676.61 339.93,-681.57 340.98,-674.65"/>
</g>
<!-- layer0_expert1 -->
<g id="node31" class="node">
<title>layer0_expert1</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="655.5,-678.04 348.5,-678.04 348.5,-626.04 655.5,-626.04 655.5,-678.04"/>
<text text-anchor="middle" x="502" y="-666.04" font-family="Arial" font-size="10.00">Expert 1</text>
<text text-anchor="middle" x="502" y="-655.04" font-family="Arial" font-size="10.00">GPU: PP0_EP1_GPU</text>
<text text-anchor="middle" x="502" y="-644.04" font-family="Arial" font-size="10.00">INPUT: [batch_size=~1, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="502" y="-633.04" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=~1, seq_len=128&#45;10240, hidden_dim=1024]</text>
</g>
<!-- layer0_dispatch&#45;&gt;layer0_expert1 -->
<g id="edge37" class="edge">
<title>layer0_dispatch&#45;&gt;layer0_expert1</title>
<path fill="none" stroke="black" d="M748.74,-727.27C702.43,-713.34 643.5,-695.61 594.85,-680.98"/>
<polygon fill="black" stroke="black" points="595.85,-677.62 585.26,-678.09 593.83,-684.32 595.85,-677.62"/>
</g>
<!-- layer0_expert2 -->
<g id="node32" class="node">
<title>layer0_expert2</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="980.5,-678.04 673.5,-678.04 673.5,-626.04 980.5,-626.04 980.5,-678.04"/>
<text text-anchor="middle" x="827" y="-666.04" font-family="Arial" font-size="10.00">Expert 2</text>
<text text-anchor="middle" x="827" y="-655.04" font-family="Arial" font-size="10.00">GPU: PP0_EP2_GPU</text>
<text text-anchor="middle" x="827" y="-644.04" font-family="Arial" font-size="10.00">INPUT: [batch_size=~1, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="827" y="-633.04" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=~1, seq_len=128&#45;10240, hidden_dim=1024]</text>
</g>
<!-- layer0_dispatch&#45;&gt;layer0_expert2 -->
<g id="edge38" class="edge">
<title>layer0_dispatch&#45;&gt;layer0_expert2</title>
<path fill="none" stroke="black" d="M827,-714.96C827,-706.28 827,-697.01 827,-688.36"/>
<polygon fill="black" stroke="black" points="830.5,-688.19 827,-678.19 823.5,-688.19 830.5,-688.19"/>
</g>
<!-- layer0_expert3 -->
<g id="node33" class="node">
<title>layer0_expert3</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="1305.5,-678.04 998.5,-678.04 998.5,-626.04 1305.5,-626.04 1305.5,-678.04"/>
<text text-anchor="middle" x="1152" y="-666.04" font-family="Arial" font-size="10.00">Expert 3</text>
<text text-anchor="middle" x="1152" y="-655.04" font-family="Arial" font-size="10.00">GPU: PP0_EP3_GPU</text>
<text text-anchor="middle" x="1152" y="-644.04" font-family="Arial" font-size="10.00">INPUT: [batch_size=~1, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="1152" y="-633.04" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=~1, seq_len=128&#45;10240, hidden_dim=1024]</text>
</g>
<!-- layer0_dispatch&#45;&gt;layer0_expert3 -->
<g id="edge39" class="edge">
<title>layer0_dispatch&#45;&gt;layer0_expert3</title>
<path fill="none" stroke="black" d="M905.26,-727.27C951.57,-713.34 1010.5,-695.61 1059.15,-680.98"/>
<polygon fill="black" stroke="black" points="1060.17,-684.32 1068.74,-678.09 1058.15,-677.62 1060.17,-684.32"/>
</g>
<!-- layer0_experts_ellipsis -->
<g id="node34" class="node">
<title>layer0_experts_ellipsis</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1420.5,-678.04 1323.5,-678.04 1323.5,-626.04 1420.5,-626.04 1420.5,-678.04"/>
<text text-anchor="middle" x="1372" y="-666.04" font-family="Arial" font-size="10.00">...</text>
<text text-anchor="middle" x="1372" y="-655.04" font-family="Arial" font-size="10.00">60 more experts</text>
<text text-anchor="middle" x="1372" y="-644.04" font-family="Arial" font-size="10.00"> distributed across</text>
<text text-anchor="middle" x="1372" y="-633.04" font-family="Arial" font-size="10.00">60 GPUs</text>
</g>
<!-- layer0_dispatch&#45;&gt;layer0_experts_ellipsis -->
<g id="edge40" class="edge">
<title>layer0_dispatch&#45;&gt;layer0_experts_ellipsis</title>
<path fill="none" stroke="black" d="M929.14,-743.51C1026.71,-734.74 1177.48,-716.48 1313.72,-678.12"/>
<polygon fill="black" stroke="black" points="1314.85,-681.44 1323.5,-675.33 1312.92,-674.71 1314.85,-681.44"/>
</g>
<!-- layer0_combine -->
<g id="node35" class="node">
<title>layer0_combine</title>
<ellipse fill="pink" stroke="black" stroke-dasharray="5,2" cx="827" cy="-552.27" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="827" y="-566.27" font-family="Arial" font-size="10.00">Expert Combine</text>
<text text-anchor="middle" x="827" y="-555.27" font-family="Arial" font-size="10.00">Combine expert outputs</text>
<text text-anchor="middle" x="827" y="-544.27" font-family="Arial" font-size="10.00">All&#45;to&#45;All communication</text>
<text text-anchor="middle" x="827" y="-533.27" font-family="Arial" font-size="10.00">64 GPUs involved</text>
</g>
<!-- layer0_expert0&#45;&gt;layer0_combine -->
<g id="edge41" class="edge">
<title>layer0_expert0&#45;&gt;layer0_combine</title>
<path fill="none" stroke="black" d="M330.57,-627.47C333.74,-626.99 336.89,-626.52 340,-626.04 477.96,-605.16 637.98,-581.32 735.83,-566.79"/>
<polygon fill="black" stroke="black" points="736.61,-570.21 745.99,-565.28 735.58,-563.29 736.61,-570.21"/>
</g>
<!-- layer0_expert1&#45;&gt;layer0_combine -->
<g id="edge42" class="edge">
<title>layer0_expert1&#45;&gt;layer0_combine</title>
<path fill="none" stroke="black" d="M585.27,-625.99C635.26,-610.96 698.49,-591.93 747.74,-577.12"/>
<polygon fill="black" stroke="black" points="748.83,-580.45 757.4,-574.21 746.81,-573.74 748.83,-580.45"/>
</g>
<!-- layer0_expert2&#45;&gt;layer0_combine -->
<g id="edge43" class="edge">
<title>layer0_expert2&#45;&gt;layer0_combine</title>
<path fill="none" stroke="black" d="M827,-625.87C827,-617.73 827,-608.43 827,-599.27"/>
<polygon fill="black" stroke="black" points="830.5,-599.05 827,-589.05 823.5,-599.05 830.5,-599.05"/>
</g>
<!-- layer0_expert3&#45;&gt;layer0_combine -->
<g id="edge44" class="edge">
<title>layer0_expert3&#45;&gt;layer0_combine</title>
<path fill="none" stroke="black" d="M1068.73,-625.99C1018.74,-610.96 955.51,-591.93 906.26,-577.12"/>
<polygon fill="black" stroke="black" points="907.19,-573.74 896.6,-574.21 905.17,-580.45 907.19,-573.74"/>
</g>
<!-- layer0_experts_ellipsis&#45;&gt;layer0_combine -->
<g id="edge45" class="edge">
<title>layer0_experts_ellipsis&#45;&gt;layer0_combine</title>
<path fill="none" stroke="black" d="M1323.5,-628.76C1320.65,-627.77 1317.8,-626.85 1315,-626.04 1181.71,-587.62 1021.78,-568.69 922.25,-559.96"/>
<polygon fill="black" stroke="black" points="922.47,-556.47 912.21,-559.1 921.87,-563.45 922.47,-556.47"/>
</g>
<!-- layer0_norm -->
<g id="node36" class="node">
<title>layer0_norm</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="980,-478.5 674,-478.5 674,-426.5 980,-426.5 980,-478.5"/>
<text text-anchor="middle" x="827" y="-466.5" font-family="Arial" font-size="10.00">Layer Normalization</text>
<text text-anchor="middle" x="827" y="-455.5" font-family="Arial" font-size="10.00">GPU: PP0_TP0_GPU</text>
<text text-anchor="middle" x="827" y="-444.5" font-family="Arial" font-size="10.00">INPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
<text text-anchor="middle" x="827" y="-433.5" font-family="Arial" font-size="10.00">OUTPUT: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024]</text>
</g>
<!-- layer0_combine&#45;&gt;layer0_norm -->
<g id="edge46" class="edge">
<title>layer0_combine&#45;&gt;layer0_norm</title>
<path fill="none" stroke="black" d="M827,-515.42C827,-506.74 827,-497.47 827,-488.82"/>
<polygon fill="black" stroke="black" points="830.5,-488.65 827,-478.65 823.5,-488.65 830.5,-488.65"/>
</g>
<!-- pipeline_send -->
<g id="node37" class="node">
<title>pipeline_send</title>
<ellipse fill="orange" stroke="black" stroke-dasharray="5,2" cx="827" cy="-352.74" rx="96.75" ry="36.54"/>
<text text-anchor="middle" x="827" y="-366.74" font-family="Arial" font-size="10.00">Pipeline Send</text>
<text text-anchor="middle" x="827" y="-355.74" font-family="Arial" font-size="10.00">Send activations to Stage 1</text>
<text text-anchor="middle" x="827" y="-344.74" font-family="Arial" font-size="10.00">Pipeline communication</text>
<text text-anchor="middle" x="827" y="-333.74" font-family="Arial" font-size="10.00">GPU&#45;to&#45;GPU transfer</text>
</g>
<!-- layer0_norm&#45;&gt;pipeline_send -->
<g id="edge47" class="edge">
<title>layer0_norm&#45;&gt;pipeline_send</title>
<path fill="none" stroke="black" d="M827,-426.33C827,-418.19 827,-408.89 827,-399.73"/>
<polygon fill="black" stroke="black" points="830.5,-399.51 827,-389.51 823.5,-399.51 830.5,-399.51"/>
</g>
<!-- pipeline_receive -->
<g id="node38" class="node">
<title>pipeline_receive</title>
<ellipse fill="orange" stroke="black" stroke-dasharray="5,2" cx="827" cy="-221.2" rx="114.6" ry="36.54"/>
<text text-anchor="middle" x="827" y="-235.2" font-family="Arial" font-size="10.00">Pipeline Receive</text>
<text text-anchor="middle" x="827" y="-224.2" font-family="Arial" font-size="10.00">Receive activations from Stage 0</text>
<text text-anchor="middle" x="827" y="-213.2" font-family="Arial" font-size="10.00">Pipeline communication</text>
<text text-anchor="middle" x="827" y="-202.2" font-family="Arial" font-size="10.00">GPU&#45;to&#45;GPU transfer</text>
</g>
<!-- pipeline_send&#45;&gt;pipeline_receive -->
<g id="edge48" class="edge">
<title>pipeline_send&#45;&gt;pipeline_receive</title>
<path fill="none" stroke="black" d="M827,-315.65C827,-301.05 827,-284.02 827,-268.52"/>
<polygon fill="black" stroke="black" points="830.5,-268.09 827,-258.09 823.5,-268.09 830.5,-268.09"/>
</g>
<!-- stage1_processing -->
<g id="node39" class="node">
<title>stage1_processing</title>
<polygon fill="lightgreen" stroke="black" stroke-dasharray="5,2" points="895,-147.43 759,-147.43 759,-95.43 895,-95.43 895,-147.43"/>
<text text-anchor="middle" x="827" y="-135.43" font-family="Arial" font-size="10.00">Stage 1 Processing</text>
<text text-anchor="middle" x="827" y="-124.43" font-family="Arial" font-size="10.00">Layers 8&#45;15</text>
<text text-anchor="middle" x="827" y="-113.43" font-family="Arial" font-size="10.00">Similar TP+EP pattern</text>
<text text-anchor="middle" x="827" y="-102.43" font-family="Arial" font-size="10.00">8 TP GPUs + 64 EP GPUs</text>
</g>
<!-- pipeline_receive&#45;&gt;stage1_processing -->
<g id="edge49" class="edge">
<title>pipeline_receive&#45;&gt;stage1_processing</title>
<path fill="none" stroke="black" d="M827,-184.35C827,-175.67 827,-166.4 827,-157.74"/>
<polygon fill="black" stroke="black" points="830.5,-157.57 827,-147.57 823.5,-157.57 830.5,-157.57"/>
</g>
<!-- output -->
<g id="node40" class="node">
<title>output</title>
<ellipse fill="lightcoral" stroke="black" stroke-dasharray="5,2" cx="827" cy="-37.21" rx="321.97" ry="21.43"/>
<text text-anchor="middle" x="827" y="-40.21" font-family="Arial" font-size="10.00">Final Output</text>
<text text-anchor="middle" x="827" y="-29.21" font-family="Arial" font-size="10.00">OUTPUT DIMENSION: [batch_size=64, seq_len=128&#45;10240, hidden_dim=1024, vocab_size=32000]</text>
</g>
<!-- stage1_processing&#45;&gt;output -->
<g id="edge50" class="edge">
<title>stage1_processing&#45;&gt;output</title>
<path fill="none" stroke="black" d="M827,-95.31C827,-86.92 827,-77.47 827,-68.72"/>
<polygon fill="black" stroke="black" points="830.5,-68.49 827,-58.49 823.5,-68.49 830.5,-68.49"/>
</g>
<!-- dp_sync -->
<g id="node42" class="node">
<title>dp_sync</title>
<ellipse fill="pink" stroke="black" stroke-dasharray="5,2" cx="1570" cy="-1949.34" rx="94.51" ry="36.54"/>
<text text-anchor="middle" x="1570" y="-1963.34" font-family="Arial" font-size="10.00">DP Sync</text>
<text text-anchor="middle" x="1570" y="-1952.34" font-family="Arial" font-size="10.00">Gradient synchronization</text>
<text text-anchor="middle" x="1570" y="-1941.34" font-family="Arial" font-size="10.00">All&#45;Reduce communication</text>
<text text-anchor="middle" x="1570" y="-1930.34" font-family="Arial" font-size="10.00">2 DP replicas</text>
</g>
<!-- dp_replica&#45;&gt;dp_sync -->
<g id="edge52" class="edge">
<title>dp_replica&#45;&gt;dp_sync</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M1585.27,-2040.03C1582.83,-2025.71 1580.2,-2010.25 1577.82,-1996.26"/>
<polygon fill="black" stroke="black" points="1581.26,-1995.64 1576.13,-1986.37 1574.36,-1996.82 1581.26,-1995.64"/>
<text text-anchor="middle" x="1601.5" y="-2015.14" font-family="Arial" font-size="9.00">gradients</text>
</g>
<!-- dp_sync&#45;&gt;input_broadcast -->
<g id="edge53" class="edge">
<title>dp_sync&#45;&gt;input_broadcast</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M1508.06,-1977.29C1462.65,-1997.05 1400.01,-2024.31 1347.35,-2047.23"/>
<polygon fill="black" stroke="black" points="1345.75,-2044.11 1337.98,-2051.31 1348.54,-2050.53 1345.75,-2044.11"/>
<text text-anchor="middle" x="1458.5" y="-2015.14" font-family="Arial" font-size="9.00">synced params</text>
</g>
</g>
</svg>
