digraph mha_layer_1_partitioned {
	rankdir=TB size="20,30"
	node [fillcolor=lightblue shape=ellipse style=filled]
	input [label="Input\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nGPU: all GPUs" fillcolor=lightgreen shape=parallelogram]
	ln [label="LayerNorm\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nGPU: all GPUs" fillcolor=lightyellow shape=rectangle]
	q_hg0_ds0 [label="Q Linear\nHead Group 0, Dim Seg 0\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 0" fillcolor=lightcoral shape=rectangle]
	k_hg0_ds0 [label="K Linear\nHead Group 0, Dim Seg 0\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 0" fillcolor=lightcoral shape=rectangle]
	v_hg0_ds0 [label="V Linear\nHead Group 0, Dim Seg 0\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 0" fillcolor=lightcoral shape=rectangle]
	attn_hg0_ds0 [label="Scaled Dot-Product Attention\nHead Group 0, Dim Seg 0\nQ: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nK: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nV: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 0" fillcolor=lightpink shape=rectangle]
	q_hg0_ds1 [label="Q Linear\nHead Group 0, Dim Seg 1\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 1" fillcolor=lightcoral shape=rectangle]
	k_hg0_ds1 [label="K Linear\nHead Group 0, Dim Seg 1\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 1" fillcolor=lightcoral shape=rectangle]
	v_hg0_ds1 [label="V Linear\nHead Group 0, Dim Seg 1\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 1" fillcolor=lightcoral shape=rectangle]
	attn_hg0_ds1 [label="Scaled Dot-Product Attention\nHead Group 0, Dim Seg 1\nQ: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nK: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nV: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 1" fillcolor=lightpink shape=rectangle]
	q_hg0_ds2 [label="Q Linear\nHead Group 0, Dim Seg 2\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 2" fillcolor=lightcoral shape=rectangle]
	k_hg0_ds2 [label="K Linear\nHead Group 0, Dim Seg 2\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 2" fillcolor=lightcoral shape=rectangle]
	v_hg0_ds2 [label="V Linear\nHead Group 0, Dim Seg 2\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 2" fillcolor=lightcoral shape=rectangle]
	attn_hg0_ds2 [label="Scaled Dot-Product Attention\nHead Group 0, Dim Seg 2\nQ: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nK: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nV: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 2" fillcolor=lightpink shape=rectangle]
	q_hg0_ds3 [label="Q Linear\nHead Group 0, Dim Seg 3\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 3" fillcolor=lightcoral shape=rectangle]
	k_hg0_ds3 [label="K Linear\nHead Group 0, Dim Seg 3\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 3" fillcolor=lightcoral shape=rectangle]
	v_hg0_ds3 [label="V Linear\nHead Group 0, Dim Seg 3\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 3" fillcolor=lightcoral shape=rectangle]
	attn_hg0_ds3 [label="Scaled Dot-Product Attention\nHead Group 0, Dim Seg 3\nQ: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nK: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nV: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 3" fillcolor=lightpink shape=rectangle]
	q_hg1_ds0 [label="Q Linear\nHead Group 1, Dim Seg 0\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 4" fillcolor=lightcoral shape=rectangle]
	k_hg1_ds0 [label="K Linear\nHead Group 1, Dim Seg 0\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 4" fillcolor=lightcoral shape=rectangle]
	v_hg1_ds0 [label="V Linear\nHead Group 1, Dim Seg 0\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 4" fillcolor=lightcoral shape=rectangle]
	attn_hg1_ds0 [label="Scaled Dot-Product Attention\nHead Group 1, Dim Seg 0\nQ: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nK: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nV: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 4" fillcolor=lightpink shape=rectangle]
	q_hg1_ds1 [label="Q Linear\nHead Group 1, Dim Seg 1\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 5" fillcolor=lightcoral shape=rectangle]
	k_hg1_ds1 [label="K Linear\nHead Group 1, Dim Seg 1\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 5" fillcolor=lightcoral shape=rectangle]
	v_hg1_ds1 [label="V Linear\nHead Group 1, Dim Seg 1\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 5" fillcolor=lightcoral shape=rectangle]
	attn_hg1_ds1 [label="Scaled Dot-Product Attention\nHead Group 1, Dim Seg 1\nQ: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nK: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nV: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 5" fillcolor=lightpink shape=rectangle]
	q_hg1_ds2 [label="Q Linear\nHead Group 1, Dim Seg 2\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 6" fillcolor=lightcoral shape=rectangle]
	k_hg1_ds2 [label="K Linear\nHead Group 1, Dim Seg 2\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 6" fillcolor=lightcoral shape=rectangle]
	v_hg1_ds2 [label="V Linear\nHead Group 1, Dim Seg 2\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 6" fillcolor=lightcoral shape=rectangle]
	attn_hg1_ds2 [label="Scaled Dot-Product Attention\nHead Group 1, Dim Seg 2\nQ: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nK: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nV: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 6" fillcolor=lightpink shape=rectangle]
	q_hg1_ds3 [label="Q Linear\nHead Group 1, Dim Seg 3\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 7" fillcolor=lightcoral shape=rectangle]
	k_hg1_ds3 [label="K Linear\nHead Group 1, Dim Seg 3\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 7" fillcolor=lightcoral shape=rectangle]
	v_hg1_ds3 [label="V Linear\nHead Group 1, Dim Seg 3\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 7" fillcolor=lightcoral shape=rectangle]
	attn_hg1_ds3 [label="Scaled Dot-Product Attention\nHead Group 1, Dim Seg 3\nQ: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nK: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nV: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 7" fillcolor=lightpink shape=rectangle]
	q_hg2_ds0 [label="Q Linear\nHead Group 2, Dim Seg 0\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 8" fillcolor=lightcoral shape=rectangle]
	k_hg2_ds0 [label="K Linear\nHead Group 2, Dim Seg 0\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 8" fillcolor=lightcoral shape=rectangle]
	v_hg2_ds0 [label="V Linear\nHead Group 2, Dim Seg 0\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 8" fillcolor=lightcoral shape=rectangle]
	attn_hg2_ds0 [label="Scaled Dot-Product Attention\nHead Group 2, Dim Seg 0\nQ: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nK: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nV: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 8" fillcolor=lightpink shape=rectangle]
	q_hg2_ds1 [label="Q Linear\nHead Group 2, Dim Seg 1\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 9" fillcolor=lightcoral shape=rectangle]
	k_hg2_ds1 [label="K Linear\nHead Group 2, Dim Seg 1\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 9" fillcolor=lightcoral shape=rectangle]
	v_hg2_ds1 [label="V Linear\nHead Group 2, Dim Seg 1\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 9" fillcolor=lightcoral shape=rectangle]
	attn_hg2_ds1 [label="Scaled Dot-Product Attention\nHead Group 2, Dim Seg 1\nQ: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nK: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nV: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 9" fillcolor=lightpink shape=rectangle]
	q_hg2_ds2 [label="Q Linear\nHead Group 2, Dim Seg 2\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 10" fillcolor=lightcoral shape=rectangle]
	k_hg2_ds2 [label="K Linear\nHead Group 2, Dim Seg 2\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 10" fillcolor=lightcoral shape=rectangle]
	v_hg2_ds2 [label="V Linear\nHead Group 2, Dim Seg 2\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 10" fillcolor=lightcoral shape=rectangle]
	attn_hg2_ds2 [label="Scaled Dot-Product Attention\nHead Group 2, Dim Seg 2\nQ: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nK: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nV: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 10" fillcolor=lightpink shape=rectangle]
	q_hg2_ds3 [label="Q Linear\nHead Group 2, Dim Seg 3\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 11" fillcolor=lightcoral shape=rectangle]
	k_hg2_ds3 [label="K Linear\nHead Group 2, Dim Seg 3\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 11" fillcolor=lightcoral shape=rectangle]
	v_hg2_ds3 [label="V Linear\nHead Group 2, Dim Seg 3\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 11" fillcolor=lightcoral shape=rectangle]
	attn_hg2_ds3 [label="Scaled Dot-Product Attention\nHead Group 2, Dim Seg 3\nQ: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nK: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nV: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 11" fillcolor=lightpink shape=rectangle]
	q_hg3_ds0 [label="Q Linear\nHead Group 3, Dim Seg 0\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 12" fillcolor=lightcoral shape=rectangle]
	k_hg3_ds0 [label="K Linear\nHead Group 3, Dim Seg 0\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 12" fillcolor=lightcoral shape=rectangle]
	v_hg3_ds0 [label="V Linear\nHead Group 3, Dim Seg 0\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 12" fillcolor=lightcoral shape=rectangle]
	attn_hg3_ds0 [label="Scaled Dot-Product Attention\nHead Group 3, Dim Seg 0\nQ: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nK: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nV: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 12" fillcolor=lightpink shape=rectangle]
	q_hg3_ds1 [label="Q Linear\nHead Group 3, Dim Seg 1\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 13" fillcolor=lightcoral shape=rectangle]
	k_hg3_ds1 [label="K Linear\nHead Group 3, Dim Seg 1\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 13" fillcolor=lightcoral shape=rectangle]
	v_hg3_ds1 [label="V Linear\nHead Group 3, Dim Seg 1\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 13" fillcolor=lightcoral shape=rectangle]
	attn_hg3_ds1 [label="Scaled Dot-Product Attention\nHead Group 3, Dim Seg 1\nQ: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nK: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nV: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 13" fillcolor=lightpink shape=rectangle]
	q_hg3_ds2 [label="Q Linear\nHead Group 3, Dim Seg 2\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 14" fillcolor=lightcoral shape=rectangle]
	k_hg3_ds2 [label="K Linear\nHead Group 3, Dim Seg 2\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 14" fillcolor=lightcoral shape=rectangle]
	v_hg3_ds2 [label="V Linear\nHead Group 3, Dim Seg 2\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 14" fillcolor=lightcoral shape=rectangle]
	attn_hg3_ds2 [label="Scaled Dot-Product Attention\nHead Group 3, Dim Seg 2\nQ: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nK: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nV: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 14" fillcolor=lightpink shape=rectangle]
	q_hg3_ds3 [label="Q Linear\nHead Group 3, Dim Seg 3\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 15" fillcolor=lightcoral shape=rectangle]
	k_hg3_ds3 [label="K Linear\nHead Group 3, Dim Seg 3\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nGPU: 15" fillcolor=lightcoral shape=rectangle]
	v_hg3_ds3 [label="V Linear\nHead Group 3, Dim Seg 3\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 15" fillcolor=lightcoral shape=rectangle]
	attn_hg3_ds3 [label="Scaled Dot-Product Attention\nHead Group 3, Dim Seg 3\nQ: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nK: [batch_size=1024, seq_len=10000, heads=4, d_k=128]\nV: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]\nGPU: 15" fillcolor=lightpink shape=rectangle]
	concat_group_0 [label="Concatenate Dimension Segments\nHead Group 0\nInput: 4×[batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=512]\nGPU: 0-3" fillcolor=lightsteelblue shape=parallelogram]
	concat_group_1 [label="Concatenate Dimension Segments\nHead Group 1\nInput: 4×[batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=512]\nGPU: 4-7" fillcolor=lightsteelblue shape=parallelogram]
	concat_group_2 [label="Concatenate Dimension Segments\nHead Group 2\nInput: 4×[batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=512]\nGPU: 8-11" fillcolor=lightsteelblue shape=parallelogram]
	concat_group_3 [label="Concatenate Dimension Segments\nHead Group 3\nInput: 4×[batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=512]\nGPU: 12-15" fillcolor=lightsteelblue shape=parallelogram]
	final_concat [label="Concatenate Head Groups\nInput: 4×[batch_size=1024, seq_len=10000, heads=4, d_v=512]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nGPU: all GPUs" fillcolor=lightsteelblue shape=parallelogram]
	output_proj [label="Output Linear Projection\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nGPU: all GPUs (tensor parallel)" fillcolor=lightcoral shape=rectangle]
	residual [label="Residual Add\nInput 1: [batch_size=1024, seq_len=10000, embed_dim=8192]\nInput 2: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nGPU: all GPUs" fillcolor=lightgray shape=rectangle]
	input -> ln
	ln -> q_hg0_ds0
	ln -> k_hg0_ds0
	ln -> v_hg0_ds0
	q_hg0_ds0 -> attn_hg0_ds0
	k_hg0_ds0 -> attn_hg0_ds0
	v_hg0_ds0 -> attn_hg0_ds0
	ln -> q_hg0_ds1
	ln -> k_hg0_ds1
	ln -> v_hg0_ds1
	q_hg0_ds1 -> attn_hg0_ds1
	k_hg0_ds1 -> attn_hg0_ds1
	v_hg0_ds1 -> attn_hg0_ds1
	ln -> q_hg0_ds2
	ln -> k_hg0_ds2
	ln -> v_hg0_ds2
	q_hg0_ds2 -> attn_hg0_ds2
	k_hg0_ds2 -> attn_hg0_ds2
	v_hg0_ds2 -> attn_hg0_ds2
	ln -> q_hg0_ds3
	ln -> k_hg0_ds3
	ln -> v_hg0_ds3
	q_hg0_ds3 -> attn_hg0_ds3
	k_hg0_ds3 -> attn_hg0_ds3
	v_hg0_ds3 -> attn_hg0_ds3
	ln -> q_hg1_ds0
	ln -> k_hg1_ds0
	ln -> v_hg1_ds0
	q_hg1_ds0 -> attn_hg1_ds0
	k_hg1_ds0 -> attn_hg1_ds0
	v_hg1_ds0 -> attn_hg1_ds0
	ln -> q_hg1_ds1
	ln -> k_hg1_ds1
	ln -> v_hg1_ds1
	q_hg1_ds1 -> attn_hg1_ds1
	k_hg1_ds1 -> attn_hg1_ds1
	v_hg1_ds1 -> attn_hg1_ds1
	ln -> q_hg1_ds2
	ln -> k_hg1_ds2
	ln -> v_hg1_ds2
	q_hg1_ds2 -> attn_hg1_ds2
	k_hg1_ds2 -> attn_hg1_ds2
	v_hg1_ds2 -> attn_hg1_ds2
	ln -> q_hg1_ds3
	ln -> k_hg1_ds3
	ln -> v_hg1_ds3
	q_hg1_ds3 -> attn_hg1_ds3
	k_hg1_ds3 -> attn_hg1_ds3
	v_hg1_ds3 -> attn_hg1_ds3
	ln -> q_hg2_ds0
	ln -> k_hg2_ds0
	ln -> v_hg2_ds0
	q_hg2_ds0 -> attn_hg2_ds0
	k_hg2_ds0 -> attn_hg2_ds0
	v_hg2_ds0 -> attn_hg2_ds0
	ln -> q_hg2_ds1
	ln -> k_hg2_ds1
	ln -> v_hg2_ds1
	q_hg2_ds1 -> attn_hg2_ds1
	k_hg2_ds1 -> attn_hg2_ds1
	v_hg2_ds1 -> attn_hg2_ds1
	ln -> q_hg2_ds2
	ln -> k_hg2_ds2
	ln -> v_hg2_ds2
	q_hg2_ds2 -> attn_hg2_ds2
	k_hg2_ds2 -> attn_hg2_ds2
	v_hg2_ds2 -> attn_hg2_ds2
	ln -> q_hg2_ds3
	ln -> k_hg2_ds3
	ln -> v_hg2_ds3
	q_hg2_ds3 -> attn_hg2_ds3
	k_hg2_ds3 -> attn_hg2_ds3
	v_hg2_ds3 -> attn_hg2_ds3
	ln -> q_hg3_ds0
	ln -> k_hg3_ds0
	ln -> v_hg3_ds0
	q_hg3_ds0 -> attn_hg3_ds0
	k_hg3_ds0 -> attn_hg3_ds0
	v_hg3_ds0 -> attn_hg3_ds0
	ln -> q_hg3_ds1
	ln -> k_hg3_ds1
	ln -> v_hg3_ds1
	q_hg3_ds1 -> attn_hg3_ds1
	k_hg3_ds1 -> attn_hg3_ds1
	v_hg3_ds1 -> attn_hg3_ds1
	ln -> q_hg3_ds2
	ln -> k_hg3_ds2
	ln -> v_hg3_ds2
	q_hg3_ds2 -> attn_hg3_ds2
	k_hg3_ds2 -> attn_hg3_ds2
	v_hg3_ds2 -> attn_hg3_ds2
	ln -> q_hg3_ds3
	ln -> k_hg3_ds3
	ln -> v_hg3_ds3
	q_hg3_ds3 -> attn_hg3_ds3
	k_hg3_ds3 -> attn_hg3_ds3
	v_hg3_ds3 -> attn_hg3_ds3
	attn_hg0_ds0 -> concat_group_0
	attn_hg0_ds1 -> concat_group_0
	attn_hg0_ds2 -> concat_group_0
	attn_hg0_ds3 -> concat_group_0
	attn_hg1_ds0 -> concat_group_1
	attn_hg1_ds1 -> concat_group_1
	attn_hg1_ds2 -> concat_group_1
	attn_hg1_ds3 -> concat_group_1
	attn_hg2_ds0 -> concat_group_2
	attn_hg2_ds1 -> concat_group_2
	attn_hg2_ds2 -> concat_group_2
	attn_hg2_ds3 -> concat_group_2
	attn_hg3_ds0 -> concat_group_3
	attn_hg3_ds1 -> concat_group_3
	attn_hg3_ds2 -> concat_group_3
	attn_hg3_ds3 -> concat_group_3
	concat_group_0 -> final_concat
	concat_group_1 -> final_concat
	concat_group_2 -> final_concat
	concat_group_3 -> final_concat
	final_concat -> output_proj
	output_proj -> residual
	input -> residual
}
