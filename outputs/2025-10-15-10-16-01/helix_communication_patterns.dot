digraph helix_communication_patterns {
	rankdir=LR size="30,20"
	node [fillcolor=lightblue shape=ellipse style=filled]
	subgraph cluster_device_0 {
		color=blue label="Device 0" style=dashed
		mha_part_0 [label="MHA Partition\nHead Group 0, Dim Seg 0\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]" fillcolor=lightcoral shape=rectangle]
		mlp_part_0 [label="MLP Partition\nTensor Parallel Slice 0\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightgreen shape=rectangle]
	}
	subgraph cluster_device_1 {
		color=blue label="Device 1" style=dashed
		mha_part_1 [label="MHA Partition\nHead Group 0, Dim Seg 1\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]" fillcolor=lightcoral shape=rectangle]
		mlp_part_1 [label="MLP Partition\nTensor Parallel Slice 1\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightgreen shape=rectangle]
	}
	subgraph cluster_device_2 {
		color=blue label="Device 2" style=dashed
		mha_part_2 [label="MHA Partition\nHead Group 0, Dim Seg 2\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]" fillcolor=lightcoral shape=rectangle]
		mlp_part_2 [label="MLP Partition\nTensor Parallel Slice 2\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightgreen shape=rectangle]
	}
	subgraph cluster_device_3 {
		color=blue label="Device 3" style=dashed
		mha_part_3 [label="MHA Partition\nHead Group 0, Dim Seg 3\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]" fillcolor=lightcoral shape=rectangle]
		mlp_part_3 [label="MLP Partition\nTensor Parallel Slice 3\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightgreen shape=rectangle]
	}
	subgraph cluster_device_4 {
		color=blue label="Device 4" style=dashed
		mha_part_4 [label="MHA Partition\nHead Group 1, Dim Seg 0\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]" fillcolor=lightcoral shape=rectangle]
		mlp_part_4 [label="MLP Partition\nTensor Parallel Slice 4\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightgreen shape=rectangle]
	}
	subgraph cluster_device_5 {
		color=blue label="Device 5" style=dashed
		mha_part_5 [label="MHA Partition\nHead Group 1, Dim Seg 1\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]" fillcolor=lightcoral shape=rectangle]
		mlp_part_5 [label="MLP Partition\nTensor Parallel Slice 5\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightgreen shape=rectangle]
	}
	subgraph cluster_device_6 {
		color=blue label="Device 6" style=dashed
		mha_part_6 [label="MHA Partition\nHead Group 1, Dim Seg 2\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]" fillcolor=lightcoral shape=rectangle]
		mlp_part_6 [label="MLP Partition\nTensor Parallel Slice 6\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightgreen shape=rectangle]
	}
	subgraph cluster_device_7 {
		color=blue label="Device 7" style=dashed
		mha_part_7 [label="MHA Partition\nHead Group 1, Dim Seg 3\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]" fillcolor=lightcoral shape=rectangle]
		mlp_part_7 [label="MLP Partition\nTensor Parallel Slice 7\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightgreen shape=rectangle]
	}
	subgraph cluster_device_8 {
		color=blue label="Device 8" style=dashed
		mha_part_8 [label="MHA Partition\nHead Group 2, Dim Seg 0\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]" fillcolor=lightcoral shape=rectangle]
		mlp_part_8 [label="MLP Partition\nTensor Parallel Slice 8\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightgreen shape=rectangle]
	}
	subgraph cluster_device_9 {
		color=blue label="Device 9" style=dashed
		mha_part_9 [label="MHA Partition\nHead Group 2, Dim Seg 1\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]" fillcolor=lightcoral shape=rectangle]
		mlp_part_9 [label="MLP Partition\nTensor Parallel Slice 9\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightgreen shape=rectangle]
	}
	subgraph cluster_device_10 {
		color=blue label="Device 10" style=dashed
		mha_part_10 [label="MHA Partition\nHead Group 2, Dim Seg 2\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]" fillcolor=lightcoral shape=rectangle]
		mlp_part_10 [label="MLP Partition\nTensor Parallel Slice 10\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightgreen shape=rectangle]
	}
	subgraph cluster_device_11 {
		color=blue label="Device 11" style=dashed
		mha_part_11 [label="MHA Partition\nHead Group 2, Dim Seg 3\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]" fillcolor=lightcoral shape=rectangle]
		mlp_part_11 [label="MLP Partition\nTensor Parallel Slice 11\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightgreen shape=rectangle]
	}
	subgraph cluster_device_12 {
		color=blue label="Device 12" style=dashed
		mha_part_12 [label="MHA Partition\nHead Group 3, Dim Seg 0\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]" fillcolor=lightcoral shape=rectangle]
		mlp_part_12 [label="MLP Partition\nTensor Parallel Slice 12\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightgreen shape=rectangle]
	}
	subgraph cluster_device_13 {
		color=blue label="Device 13" style=dashed
		mha_part_13 [label="MHA Partition\nHead Group 3, Dim Seg 1\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]" fillcolor=lightcoral shape=rectangle]
		mlp_part_13 [label="MLP Partition\nTensor Parallel Slice 13\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightgreen shape=rectangle]
	}
	subgraph cluster_device_14 {
		color=blue label="Device 14" style=dashed
		mha_part_14 [label="MHA Partition\nHead Group 3, Dim Seg 2\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]" fillcolor=lightcoral shape=rectangle]
		mlp_part_14 [label="MLP Partition\nTensor Parallel Slice 14\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightgreen shape=rectangle]
	}
	subgraph cluster_device_15 {
		color=blue label="Device 15" style=dashed
		mha_part_15 [label="MHA Partition\nHead Group 3, Dim Seg 3\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=128]" fillcolor=lightcoral shape=rectangle]
		mlp_part_15 [label="MLP Partition\nTensor Parallel Slice 15\nInput: [batch_size=1024, seq_len=10000, embed_dim=8192]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightgreen shape=rectangle]
	}
	group_concat_0 [label="Concatenate Group 0\n4 devices → 1\nInput: 4×[batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=512]" fillcolor=lightsteelblue shape=parallelogram]
	group_concat_1 [label="Concatenate Group 1\n4 devices → 1\nInput: 4×[batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=512]" fillcolor=lightsteelblue shape=parallelogram]
	group_concat_2 [label="Concatenate Group 2\n4 devices → 1\nInput: 4×[batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=512]" fillcolor=lightsteelblue shape=parallelogram]
	group_concat_3 [label="Concatenate Group 3\n4 devices → 1\nInput: 4×[batch_size=1024, seq_len=10000, heads=4, d_v=128]\nOutput: [batch_size=1024, seq_len=10000, heads=4, d_v=512]" fillcolor=lightsteelblue shape=parallelogram]
	final_concat_all [label="Final Concatenation\n4 groups → 1\nInput: 4×[batch_size=1024, seq_len=10000, heads=4, d_v=512]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightsteelblue shape=parallelogram]
	all_reduce_mlp [label="All-Reduce Sum\n16 devices → 1\nInput: 16×[batch_size=1024, seq_len=10000, embed_dim=2048]\nOutput: [batch_size=1024, seq_len=10000, embed_dim=8192]" fillcolor=lightsteelblue shape=parallelogram]
	mha_part_0 -> group_concat_0
	mlp_part_0 -> all_reduce_mlp
	mha_part_1 -> group_concat_0
	mlp_part_1 -> all_reduce_mlp
	mha_part_2 -> group_concat_0
	mlp_part_2 -> all_reduce_mlp
	mha_part_3 -> group_concat_0
	mlp_part_3 -> all_reduce_mlp
	mha_part_4 -> group_concat_1
	mlp_part_4 -> all_reduce_mlp
	mha_part_5 -> group_concat_1
	mlp_part_5 -> all_reduce_mlp
	mha_part_6 -> group_concat_1
	mlp_part_6 -> all_reduce_mlp
	mha_part_7 -> group_concat_1
	mlp_part_7 -> all_reduce_mlp
	mha_part_8 -> group_concat_2
	mlp_part_8 -> all_reduce_mlp
	mha_part_9 -> group_concat_2
	mlp_part_9 -> all_reduce_mlp
	mha_part_10 -> group_concat_2
	mlp_part_10 -> all_reduce_mlp
	mha_part_11 -> group_concat_2
	mlp_part_11 -> all_reduce_mlp
	mha_part_12 -> group_concat_3
	mlp_part_12 -> all_reduce_mlp
	mha_part_13 -> group_concat_3
	mlp_part_13 -> all_reduce_mlp
	mha_part_14 -> group_concat_3
	mlp_part_14 -> all_reduce_mlp
	mha_part_15 -> group_concat_3
	mlp_part_15 -> all_reduce_mlp
	group_concat_0 -> final_concat_all
	group_concat_1 -> final_concat_all
	group_concat_2 -> final_concat_all
	group_concat_3 -> final_concat_all
}
