// Standalone Tensor Parallelism 8 Configuration
digraph TP8_Standalone {
	rankdir=TB size="25,20"
	node [fillcolor=lightblue shape=ellipse style=filled]
	node [fillcolor=lightgreen shape=rectangle style=filled]
	node [fillcolor=yellow shape=parallelogram style=filled]
	node [fillcolor=lightcoral shape=diamond style=filled]
	label="Standalone Tensor Parallelism 8
8 GPUs total
Model Parallel across all layers"
	fontsize=20
	input [label="INPUT
Input: [batch_size=1024, seq_len=2048, hidden=4096]
GPU: 0-7" fillcolor=lightblue shape=ellipse]
	layer0_qkv_gpu0 [label="L0_QKV_Projection_GPU0
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 0-3
TP Slice: 0
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_attn_gpu0 [label="L0_Multi-Head_Attention_GPU0
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_attn_proj_gpu0 [label="L0_Attn_Projection_GPU0
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_qkv_gpu1 [label="L0_QKV_Projection_GPU1
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 4-7
TP Slice: 1
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_attn_gpu1 [label="L0_Multi-Head_Attention_GPU1
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_attn_proj_gpu1 [label="L0_Attn_Projection_GPU1
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_qkv_gpu2 [label="L0_QKV_Projection_GPU2
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 8-11
TP Slice: 2
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_attn_gpu2 [label="L0_Multi-Head_Attention_GPU2
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_attn_proj_gpu2 [label="L0_Attn_Projection_GPU2
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_qkv_gpu3 [label="L0_QKV_Projection_GPU3
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 12-15
TP Slice: 3
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_attn_gpu3 [label="L0_Multi-Head_Attention_GPU3
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_attn_proj_gpu3 [label="L0_Attn_Projection_GPU3
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_qkv_gpu4 [label="L0_QKV_Projection_GPU4
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 16-19
TP Slice: 4
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_attn_gpu4 [label="L0_Multi-Head_Attention_GPU4
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_attn_proj_gpu4 [label="L0_Attn_Projection_GPU4
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_qkv_gpu5 [label="L0_QKV_Projection_GPU5
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 20-23
TP Slice: 5
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_attn_gpu5 [label="L0_Multi-Head_Attention_GPU5
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_attn_proj_gpu5 [label="L0_Attn_Projection_GPU5
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_qkv_gpu6 [label="L0_QKV_Projection_GPU6
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 24-27
TP Slice: 6
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_attn_gpu6 [label="L0_Multi-Head_Attention_GPU6
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_attn_proj_gpu6 [label="L0_Attn_Projection_GPU6
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_qkv_gpu7 [label="L0_QKV_Projection_GPU7
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 28-31
TP Slice: 7
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_attn_gpu7 [label="L0_Multi-Head_Attention_GPU7
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_attn_proj_gpu7 [label="L0_Attn_Projection_GPU7
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_attn_allreduce [label="L0_Attention_All-Reduce
Input: 8×[1024,2048,512]
Output: [1024,2048,4096]
TP All-Reduce across GPUs 0-7" fillcolor=lightcoral shape=diamond]
	layer0_attn_norm_gpu0 [label="L0_Residual+LayerNorm_GPU0
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer0_attn_norm_gpu1 [label="L0_Residual+LayerNorm_GPU1
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer0_attn_norm_gpu2 [label="L0_Residual+LayerNorm_GPU2
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer0_attn_norm_gpu3 [label="L0_Residual+LayerNorm_GPU3
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer0_attn_norm_gpu4 [label="L0_Residual+LayerNorm_GPU4
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer0_attn_norm_gpu5 [label="L0_Residual+LayerNorm_GPU5
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer0_attn_norm_gpu6 [label="L0_Residual+LayerNorm_GPU6
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer0_attn_norm_gpu7 [label="L0_Residual+LayerNorm_GPU7
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer0_gate_gpu0 [label="L0_Gate_GPU0
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_0 [label="L0_Expert0_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_1 [label="L0_Expert1_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_2 [label="L0_Expert2_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_3 [label="L0_Expert3_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_4 [label="L0_Expert4_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_5 [label="L0_Expert5_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_6 [label="L0_Expert6_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_7 [label="L0_Expert7_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_8 [label="L0_Expert8_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_9 [label="L0_Expert9_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_10 [label="L0_Expert10_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_11 [label="L0_Expert11_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_12 [label="L0_Expert12_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_13 [label="L0_Expert13_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_14 [label="L0_Expert14_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_15 [label="L0_Expert15_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_moe_agg_gpu0 [label="L0_MoE_Aggregate_GPU0
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_output_gpu0 [label="L0_Residual+LayerNorm_GPU0
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_gate_gpu1 [label="L0_Gate_GPU1
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_0 [label="L0_Expert0_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_1 [label="L0_Expert1_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_2 [label="L0_Expert2_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_3 [label="L0_Expert3_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_4 [label="L0_Expert4_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_5 [label="L0_Expert5_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_6 [label="L0_Expert6_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_7 [label="L0_Expert7_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_8 [label="L0_Expert8_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_9 [label="L0_Expert9_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_10 [label="L0_Expert10_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_11 [label="L0_Expert11_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_12 [label="L0_Expert12_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_13 [label="L0_Expert13_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_14 [label="L0_Expert14_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_15 [label="L0_Expert15_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_moe_agg_gpu1 [label="L0_MoE_Aggregate_GPU1
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_output_gpu1 [label="L0_Residual+LayerNorm_GPU1
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_gate_gpu2 [label="L0_Gate_GPU2
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_0 [label="L0_Expert0_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_1 [label="L0_Expert1_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_2 [label="L0_Expert2_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_3 [label="L0_Expert3_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_4 [label="L0_Expert4_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_5 [label="L0_Expert5_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_6 [label="L0_Expert6_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_7 [label="L0_Expert7_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_8 [label="L0_Expert8_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_9 [label="L0_Expert9_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_10 [label="L0_Expert10_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_11 [label="L0_Expert11_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_12 [label="L0_Expert12_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_13 [label="L0_Expert13_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_14 [label="L0_Expert14_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_15 [label="L0_Expert15_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_moe_agg_gpu2 [label="L0_MoE_Aggregate_GPU2
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_output_gpu2 [label="L0_Residual+LayerNorm_GPU2
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_gate_gpu3 [label="L0_Gate_GPU3
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_0 [label="L0_Expert0_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_1 [label="L0_Expert1_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_2 [label="L0_Expert2_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_3 [label="L0_Expert3_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_4 [label="L0_Expert4_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_5 [label="L0_Expert5_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_6 [label="L0_Expert6_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_7 [label="L0_Expert7_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_8 [label="L0_Expert8_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_9 [label="L0_Expert9_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_10 [label="L0_Expert10_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_11 [label="L0_Expert11_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_12 [label="L0_Expert12_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_13 [label="L0_Expert13_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_14 [label="L0_Expert14_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_15 [label="L0_Expert15_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_moe_agg_gpu3 [label="L0_MoE_Aggregate_GPU3
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_output_gpu3 [label="L0_Residual+LayerNorm_GPU3
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_gate_gpu4 [label="L0_Gate_GPU4
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_0 [label="L0_Expert0_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_1 [label="L0_Expert1_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_2 [label="L0_Expert2_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_3 [label="L0_Expert3_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_4 [label="L0_Expert4_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_5 [label="L0_Expert5_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_6 [label="L0_Expert6_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_7 [label="L0_Expert7_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_8 [label="L0_Expert8_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_9 [label="L0_Expert9_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_10 [label="L0_Expert10_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_11 [label="L0_Expert11_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_12 [label="L0_Expert12_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_13 [label="L0_Expert13_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_14 [label="L0_Expert14_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_15 [label="L0_Expert15_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_moe_agg_gpu4 [label="L0_MoE_Aggregate_GPU4
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_output_gpu4 [label="L0_Residual+LayerNorm_GPU4
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_gate_gpu5 [label="L0_Gate_GPU5
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_0 [label="L0_Expert0_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_1 [label="L0_Expert1_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_2 [label="L0_Expert2_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_3 [label="L0_Expert3_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_4 [label="L0_Expert4_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_5 [label="L0_Expert5_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_6 [label="L0_Expert6_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_7 [label="L0_Expert7_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_8 [label="L0_Expert8_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_9 [label="L0_Expert9_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_10 [label="L0_Expert10_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_11 [label="L0_Expert11_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_12 [label="L0_Expert12_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_13 [label="L0_Expert13_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_14 [label="L0_Expert14_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_15 [label="L0_Expert15_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_moe_agg_gpu5 [label="L0_MoE_Aggregate_GPU5
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_output_gpu5 [label="L0_Residual+LayerNorm_GPU5
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_gate_gpu6 [label="L0_Gate_GPU6
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_0 [label="L0_Expert0_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_1 [label="L0_Expert1_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_2 [label="L0_Expert2_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_3 [label="L0_Expert3_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_4 [label="L0_Expert4_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_5 [label="L0_Expert5_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_6 [label="L0_Expert6_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_7 [label="L0_Expert7_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_8 [label="L0_Expert8_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_9 [label="L0_Expert9_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_10 [label="L0_Expert10_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_11 [label="L0_Expert11_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_12 [label="L0_Expert12_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_13 [label="L0_Expert13_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_14 [label="L0_Expert14_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_15 [label="L0_Expert15_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_moe_agg_gpu6 [label="L0_MoE_Aggregate_GPU6
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_output_gpu6 [label="L0_Residual+LayerNorm_GPU6
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_gate_gpu7 [label="L0_Gate_GPU7
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_0 [label="L0_Expert0_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_1 [label="L0_Expert1_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_2 [label="L0_Expert2_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_3 [label="L0_Expert3_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_4 [label="L0_Expert4_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_5 [label="L0_Expert5_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_6 [label="L0_Expert6_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_7 [label="L0_Expert7_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_8 [label="L0_Expert8_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_9 [label="L0_Expert9_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_10 [label="L0_Expert10_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_11 [label="L0_Expert11_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_12 [label="L0_Expert12_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_13 [label="L0_Expert13_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_14 [label="L0_Expert14_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_15 [label="L0_Expert15_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_moe_agg_gpu7 [label="L0_MoE_Aggregate_GPU7
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_output_gpu7 [label="L0_Residual+LayerNorm_GPU7
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_moe_allreduce [label="L0_MoE_All-Reduce
Input: 8×[1024,2048,4096]
Output: [1024,2048,4096]
TP All-Reduce across GPUs 0-7" fillcolor=lightcoral shape=diamond]
	layer1_qkv_gpu0 [label="L1_QKV_Projection_GPU0
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 0-3
TP Slice: 0
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_attn_gpu0 [label="L1_Multi-Head_Attention_GPU0
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_attn_proj_gpu0 [label="L1_Attn_Projection_GPU0
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_qkv_gpu1 [label="L1_QKV_Projection_GPU1
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 4-7
TP Slice: 1
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_attn_gpu1 [label="L1_Multi-Head_Attention_GPU1
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_attn_proj_gpu1 [label="L1_Attn_Projection_GPU1
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_qkv_gpu2 [label="L1_QKV_Projection_GPU2
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 8-11
TP Slice: 2
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_attn_gpu2 [label="L1_Multi-Head_Attention_GPU2
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_attn_proj_gpu2 [label="L1_Attn_Projection_GPU2
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_qkv_gpu3 [label="L1_QKV_Projection_GPU3
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 12-15
TP Slice: 3
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_attn_gpu3 [label="L1_Multi-Head_Attention_GPU3
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_attn_proj_gpu3 [label="L1_Attn_Projection_GPU3
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_qkv_gpu4 [label="L1_QKV_Projection_GPU4
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 16-19
TP Slice: 4
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_attn_gpu4 [label="L1_Multi-Head_Attention_GPU4
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_attn_proj_gpu4 [label="L1_Attn_Projection_GPU4
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_qkv_gpu5 [label="L1_QKV_Projection_GPU5
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 20-23
TP Slice: 5
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_attn_gpu5 [label="L1_Multi-Head_Attention_GPU5
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_attn_proj_gpu5 [label="L1_Attn_Projection_GPU5
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_qkv_gpu6 [label="L1_QKV_Projection_GPU6
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 24-27
TP Slice: 6
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_attn_gpu6 [label="L1_Multi-Head_Attention_GPU6
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_attn_proj_gpu6 [label="L1_Attn_Projection_GPU6
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_qkv_gpu7 [label="L1_QKV_Projection_GPU7
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 28-31
TP Slice: 7
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_attn_gpu7 [label="L1_Multi-Head_Attention_GPU7
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_attn_proj_gpu7 [label="L1_Attn_Projection_GPU7
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_attn_allreduce [label="L1_Attention_All-Reduce
Input: 8×[1024,2048,512]
Output: [1024,2048,4096]
TP All-Reduce across GPUs 0-7" fillcolor=lightcoral shape=diamond]
	layer1_attn_norm_gpu0 [label="L1_Residual+LayerNorm_GPU0
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer1_attn_norm_gpu1 [label="L1_Residual+LayerNorm_GPU1
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer1_attn_norm_gpu2 [label="L1_Residual+LayerNorm_GPU2
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer1_attn_norm_gpu3 [label="L1_Residual+LayerNorm_GPU3
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer1_attn_norm_gpu4 [label="L1_Residual+LayerNorm_GPU4
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer1_attn_norm_gpu5 [label="L1_Residual+LayerNorm_GPU5
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer1_attn_norm_gpu6 [label="L1_Residual+LayerNorm_GPU6
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer1_attn_norm_gpu7 [label="L1_Residual+LayerNorm_GPU7
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer1_gate_gpu0 [label="L1_Gate_GPU0
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_0 [label="L1_Expert0_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_1 [label="L1_Expert1_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_2 [label="L1_Expert2_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_3 [label="L1_Expert3_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_4 [label="L1_Expert4_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_5 [label="L1_Expert5_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_6 [label="L1_Expert6_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_7 [label="L1_Expert7_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_8 [label="L1_Expert8_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_9 [label="L1_Expert9_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_10 [label="L1_Expert10_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_11 [label="L1_Expert11_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_12 [label="L1_Expert12_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_13 [label="L1_Expert13_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_14 [label="L1_Expert14_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_15 [label="L1_Expert15_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_moe_agg_gpu0 [label="L1_MoE_Aggregate_GPU0
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_output_gpu0 [label="L1_Residual+LayerNorm_GPU0
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_gate_gpu1 [label="L1_Gate_GPU1
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_0 [label="L1_Expert0_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_1 [label="L1_Expert1_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_2 [label="L1_Expert2_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_3 [label="L1_Expert3_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_4 [label="L1_Expert4_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_5 [label="L1_Expert5_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_6 [label="L1_Expert6_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_7 [label="L1_Expert7_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_8 [label="L1_Expert8_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_9 [label="L1_Expert9_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_10 [label="L1_Expert10_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_11 [label="L1_Expert11_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_12 [label="L1_Expert12_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_13 [label="L1_Expert13_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_14 [label="L1_Expert14_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_15 [label="L1_Expert15_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_moe_agg_gpu1 [label="L1_MoE_Aggregate_GPU1
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_output_gpu1 [label="L1_Residual+LayerNorm_GPU1
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_gate_gpu2 [label="L1_Gate_GPU2
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_0 [label="L1_Expert0_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_1 [label="L1_Expert1_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_2 [label="L1_Expert2_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_3 [label="L1_Expert3_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_4 [label="L1_Expert4_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_5 [label="L1_Expert5_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_6 [label="L1_Expert6_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_7 [label="L1_Expert7_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_8 [label="L1_Expert8_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_9 [label="L1_Expert9_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_10 [label="L1_Expert10_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_11 [label="L1_Expert11_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_12 [label="L1_Expert12_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_13 [label="L1_Expert13_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_14 [label="L1_Expert14_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_15 [label="L1_Expert15_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_moe_agg_gpu2 [label="L1_MoE_Aggregate_GPU2
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_output_gpu2 [label="L1_Residual+LayerNorm_GPU2
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_gate_gpu3 [label="L1_Gate_GPU3
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_0 [label="L1_Expert0_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_1 [label="L1_Expert1_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_2 [label="L1_Expert2_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_3 [label="L1_Expert3_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_4 [label="L1_Expert4_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_5 [label="L1_Expert5_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_6 [label="L1_Expert6_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_7 [label="L1_Expert7_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_8 [label="L1_Expert8_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_9 [label="L1_Expert9_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_10 [label="L1_Expert10_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_11 [label="L1_Expert11_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_12 [label="L1_Expert12_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_13 [label="L1_Expert13_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_14 [label="L1_Expert14_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_15 [label="L1_Expert15_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_moe_agg_gpu3 [label="L1_MoE_Aggregate_GPU3
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_output_gpu3 [label="L1_Residual+LayerNorm_GPU3
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_gate_gpu4 [label="L1_Gate_GPU4
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_0 [label="L1_Expert0_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_1 [label="L1_Expert1_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_2 [label="L1_Expert2_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_3 [label="L1_Expert3_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_4 [label="L1_Expert4_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_5 [label="L1_Expert5_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_6 [label="L1_Expert6_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_7 [label="L1_Expert7_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_8 [label="L1_Expert8_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_9 [label="L1_Expert9_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_10 [label="L1_Expert10_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_11 [label="L1_Expert11_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_12 [label="L1_Expert12_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_13 [label="L1_Expert13_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_14 [label="L1_Expert14_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_15 [label="L1_Expert15_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_moe_agg_gpu4 [label="L1_MoE_Aggregate_GPU4
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_output_gpu4 [label="L1_Residual+LayerNorm_GPU4
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_gate_gpu5 [label="L1_Gate_GPU5
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_0 [label="L1_Expert0_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_1 [label="L1_Expert1_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_2 [label="L1_Expert2_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_3 [label="L1_Expert3_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_4 [label="L1_Expert4_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_5 [label="L1_Expert5_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_6 [label="L1_Expert6_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_7 [label="L1_Expert7_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_8 [label="L1_Expert8_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_9 [label="L1_Expert9_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_10 [label="L1_Expert10_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_11 [label="L1_Expert11_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_12 [label="L1_Expert12_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_13 [label="L1_Expert13_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_14 [label="L1_Expert14_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_15 [label="L1_Expert15_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_moe_agg_gpu5 [label="L1_MoE_Aggregate_GPU5
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_output_gpu5 [label="L1_Residual+LayerNorm_GPU5
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_gate_gpu6 [label="L1_Gate_GPU6
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_0 [label="L1_Expert0_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_1 [label="L1_Expert1_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_2 [label="L1_Expert2_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_3 [label="L1_Expert3_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_4 [label="L1_Expert4_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_5 [label="L1_Expert5_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_6 [label="L1_Expert6_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_7 [label="L1_Expert7_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_8 [label="L1_Expert8_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_9 [label="L1_Expert9_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_10 [label="L1_Expert10_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_11 [label="L1_Expert11_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_12 [label="L1_Expert12_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_13 [label="L1_Expert13_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_14 [label="L1_Expert14_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_15 [label="L1_Expert15_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_moe_agg_gpu6 [label="L1_MoE_Aggregate_GPU6
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_output_gpu6 [label="L1_Residual+LayerNorm_GPU6
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_gate_gpu7 [label="L1_Gate_GPU7
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_0 [label="L1_Expert0_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_1 [label="L1_Expert1_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_2 [label="L1_Expert2_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_3 [label="L1_Expert3_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_4 [label="L1_Expert4_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_5 [label="L1_Expert5_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_6 [label="L1_Expert6_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_7 [label="L1_Expert7_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_8 [label="L1_Expert8_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_9 [label="L1_Expert9_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_10 [label="L1_Expert10_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_11 [label="L1_Expert11_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_12 [label="L1_Expert12_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_13 [label="L1_Expert13_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_14 [label="L1_Expert14_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_15 [label="L1_Expert15_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_moe_agg_gpu7 [label="L1_MoE_Aggregate_GPU7
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_output_gpu7 [label="L1_Residual+LayerNorm_GPU7
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_moe_allreduce [label="L1_MoE_All-Reduce
Input: 8×[1024,2048,4096]
Output: [1024,2048,4096]
TP All-Reduce across GPUs 0-7" fillcolor=lightcoral shape=diamond]
	layer2_qkv_gpu0 [label="L2_QKV_Projection_GPU0
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 0-3
TP Slice: 0
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_attn_gpu0 [label="L2_Multi-Head_Attention_GPU0
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_attn_proj_gpu0 [label="L2_Attn_Projection_GPU0
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_qkv_gpu1 [label="L2_QKV_Projection_GPU1
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 4-7
TP Slice: 1
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_attn_gpu1 [label="L2_Multi-Head_Attention_GPU1
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_attn_proj_gpu1 [label="L2_Attn_Projection_GPU1
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_qkv_gpu2 [label="L2_QKV_Projection_GPU2
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 8-11
TP Slice: 2
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_attn_gpu2 [label="L2_Multi-Head_Attention_GPU2
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_attn_proj_gpu2 [label="L2_Attn_Projection_GPU2
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_qkv_gpu3 [label="L2_QKV_Projection_GPU3
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 12-15
TP Slice: 3
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_attn_gpu3 [label="L2_Multi-Head_Attention_GPU3
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_attn_proj_gpu3 [label="L2_Attn_Projection_GPU3
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_qkv_gpu4 [label="L2_QKV_Projection_GPU4
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 16-19
TP Slice: 4
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_attn_gpu4 [label="L2_Multi-Head_Attention_GPU4
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_attn_proj_gpu4 [label="L2_Attn_Projection_GPU4
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_qkv_gpu5 [label="L2_QKV_Projection_GPU5
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 20-23
TP Slice: 5
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_attn_gpu5 [label="L2_Multi-Head_Attention_GPU5
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_attn_proj_gpu5 [label="L2_Attn_Projection_GPU5
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_qkv_gpu6 [label="L2_QKV_Projection_GPU6
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 24-27
TP Slice: 6
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_attn_gpu6 [label="L2_Multi-Head_Attention_GPU6
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_attn_proj_gpu6 [label="L2_Attn_Projection_GPU6
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_qkv_gpu7 [label="L2_QKV_Projection_GPU7
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 28-31
TP Slice: 7
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_attn_gpu7 [label="L2_Multi-Head_Attention_GPU7
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_attn_proj_gpu7 [label="L2_Attn_Projection_GPU7
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_attn_allreduce [label="L2_Attention_All-Reduce
Input: 8×[1024,2048,512]
Output: [1024,2048,4096]
TP All-Reduce across GPUs 0-7" fillcolor=lightcoral shape=diamond]
	layer2_attn_norm_gpu0 [label="L2_Residual+LayerNorm_GPU0
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer2_attn_norm_gpu1 [label="L2_Residual+LayerNorm_GPU1
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer2_attn_norm_gpu2 [label="L2_Residual+LayerNorm_GPU2
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer2_attn_norm_gpu3 [label="L2_Residual+LayerNorm_GPU3
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer2_attn_norm_gpu4 [label="L2_Residual+LayerNorm_GPU4
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer2_attn_norm_gpu5 [label="L2_Residual+LayerNorm_GPU5
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer2_attn_norm_gpu6 [label="L2_Residual+LayerNorm_GPU6
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer2_attn_norm_gpu7 [label="L2_Residual+LayerNorm_GPU7
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer2_gate_gpu0 [label="L2_Gate_GPU0
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_expert0_0 [label="L2_Expert0_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_expert0_1 [label="L2_Expert1_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_expert0_2 [label="L2_Expert2_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_expert0_3 [label="L2_Expert3_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_expert0_4 [label="L2_Expert4_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_expert0_5 [label="L2_Expert5_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_expert0_6 [label="L2_Expert6_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_expert0_7 [label="L2_Expert7_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_expert0_8 [label="L2_Expert8_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_expert0_9 [label="L2_Expert9_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_expert0_10 [label="L2_Expert10_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_expert0_11 [label="L2_Expert11_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_expert0_12 [label="L2_Expert12_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_expert0_13 [label="L2_Expert13_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_expert0_14 [label="L2_Expert14_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_expert0_15 [label="L2_Expert15_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_moe_agg_gpu0 [label="L2_MoE_Aggregate_GPU0
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_output_gpu0 [label="L2_Residual+LayerNorm_GPU0
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer2_gate_gpu1 [label="L2_Gate_GPU1
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_expert1_0 [label="L2_Expert0_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_expert1_1 [label="L2_Expert1_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_expert1_2 [label="L2_Expert2_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_expert1_3 [label="L2_Expert3_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_expert1_4 [label="L2_Expert4_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_expert1_5 [label="L2_Expert5_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_expert1_6 [label="L2_Expert6_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_expert1_7 [label="L2_Expert7_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_expert1_8 [label="L2_Expert8_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_expert1_9 [label="L2_Expert9_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_expert1_10 [label="L2_Expert10_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_expert1_11 [label="L2_Expert11_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_expert1_12 [label="L2_Expert12_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_expert1_13 [label="L2_Expert13_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_expert1_14 [label="L2_Expert14_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_expert1_15 [label="L2_Expert15_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_moe_agg_gpu1 [label="L2_MoE_Aggregate_GPU1
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_output_gpu1 [label="L2_Residual+LayerNorm_GPU1
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer2_gate_gpu2 [label="L2_Gate_GPU2
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_expert2_0 [label="L2_Expert0_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_expert2_1 [label="L2_Expert1_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_expert2_2 [label="L2_Expert2_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_expert2_3 [label="L2_Expert3_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_expert2_4 [label="L2_Expert4_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_expert2_5 [label="L2_Expert5_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_expert2_6 [label="L2_Expert6_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_expert2_7 [label="L2_Expert7_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_expert2_8 [label="L2_Expert8_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_expert2_9 [label="L2_Expert9_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_expert2_10 [label="L2_Expert10_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_expert2_11 [label="L2_Expert11_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_expert2_12 [label="L2_Expert12_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_expert2_13 [label="L2_Expert13_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_expert2_14 [label="L2_Expert14_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_expert2_15 [label="L2_Expert15_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_moe_agg_gpu2 [label="L2_MoE_Aggregate_GPU2
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_output_gpu2 [label="L2_Residual+LayerNorm_GPU2
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer2_gate_gpu3 [label="L2_Gate_GPU3
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_expert3_0 [label="L2_Expert0_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_expert3_1 [label="L2_Expert1_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_expert3_2 [label="L2_Expert2_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_expert3_3 [label="L2_Expert3_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_expert3_4 [label="L2_Expert4_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_expert3_5 [label="L2_Expert5_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_expert3_6 [label="L2_Expert6_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_expert3_7 [label="L2_Expert7_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_expert3_8 [label="L2_Expert8_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_expert3_9 [label="L2_Expert9_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_expert3_10 [label="L2_Expert10_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_expert3_11 [label="L2_Expert11_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_expert3_12 [label="L2_Expert12_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_expert3_13 [label="L2_Expert13_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_expert3_14 [label="L2_Expert14_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_expert3_15 [label="L2_Expert15_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_moe_agg_gpu3 [label="L2_MoE_Aggregate_GPU3
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_output_gpu3 [label="L2_Residual+LayerNorm_GPU3
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer2_gate_gpu4 [label="L2_Gate_GPU4
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_expert4_0 [label="L2_Expert0_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_expert4_1 [label="L2_Expert1_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_expert4_2 [label="L2_Expert2_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_expert4_3 [label="L2_Expert3_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_expert4_4 [label="L2_Expert4_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_expert4_5 [label="L2_Expert5_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_expert4_6 [label="L2_Expert6_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_expert4_7 [label="L2_Expert7_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_expert4_8 [label="L2_Expert8_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_expert4_9 [label="L2_Expert9_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_expert4_10 [label="L2_Expert10_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_expert4_11 [label="L2_Expert11_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_expert4_12 [label="L2_Expert12_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_expert4_13 [label="L2_Expert13_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_expert4_14 [label="L2_Expert14_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_expert4_15 [label="L2_Expert15_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_moe_agg_gpu4 [label="L2_MoE_Aggregate_GPU4
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_output_gpu4 [label="L2_Residual+LayerNorm_GPU4
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer2_gate_gpu5 [label="L2_Gate_GPU5
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_expert5_0 [label="L2_Expert0_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_expert5_1 [label="L2_Expert1_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_expert5_2 [label="L2_Expert2_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_expert5_3 [label="L2_Expert3_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_expert5_4 [label="L2_Expert4_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_expert5_5 [label="L2_Expert5_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_expert5_6 [label="L2_Expert6_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_expert5_7 [label="L2_Expert7_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_expert5_8 [label="L2_Expert8_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_expert5_9 [label="L2_Expert9_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_expert5_10 [label="L2_Expert10_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_expert5_11 [label="L2_Expert11_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_expert5_12 [label="L2_Expert12_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_expert5_13 [label="L2_Expert13_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_expert5_14 [label="L2_Expert14_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_expert5_15 [label="L2_Expert15_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_moe_agg_gpu5 [label="L2_MoE_Aggregate_GPU5
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_output_gpu5 [label="L2_Residual+LayerNorm_GPU5
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer2_gate_gpu6 [label="L2_Gate_GPU6
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_expert6_0 [label="L2_Expert0_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_expert6_1 [label="L2_Expert1_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_expert6_2 [label="L2_Expert2_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_expert6_3 [label="L2_Expert3_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_expert6_4 [label="L2_Expert4_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_expert6_5 [label="L2_Expert5_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_expert6_6 [label="L2_Expert6_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_expert6_7 [label="L2_Expert7_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_expert6_8 [label="L2_Expert8_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_expert6_9 [label="L2_Expert9_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_expert6_10 [label="L2_Expert10_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_expert6_11 [label="L2_Expert11_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_expert6_12 [label="L2_Expert12_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_expert6_13 [label="L2_Expert13_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_expert6_14 [label="L2_Expert14_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_expert6_15 [label="L2_Expert15_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_moe_agg_gpu6 [label="L2_MoE_Aggregate_GPU6
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_output_gpu6 [label="L2_Residual+LayerNorm_GPU6
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer2_gate_gpu7 [label="L2_Gate_GPU7
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_expert7_0 [label="L2_Expert0_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_expert7_1 [label="L2_Expert1_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_expert7_2 [label="L2_Expert2_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_expert7_3 [label="L2_Expert3_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_expert7_4 [label="L2_Expert4_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_expert7_5 [label="L2_Expert5_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_expert7_6 [label="L2_Expert6_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_expert7_7 [label="L2_Expert7_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_expert7_8 [label="L2_Expert8_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_expert7_9 [label="L2_Expert9_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_expert7_10 [label="L2_Expert10_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_expert7_11 [label="L2_Expert11_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_expert7_12 [label="L2_Expert12_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_expert7_13 [label="L2_Expert13_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_expert7_14 [label="L2_Expert14_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_expert7_15 [label="L2_Expert15_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_moe_agg_gpu7 [label="L2_MoE_Aggregate_GPU7
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_output_gpu7 [label="L2_Residual+LayerNorm_GPU7
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer2_moe_allreduce [label="L2_MoE_All-Reduce
Input: 8×[1024,2048,4096]
Output: [1024,2048,4096]
TP All-Reduce across GPUs 0-7" fillcolor=lightcoral shape=diamond]
	layer3_qkv_gpu0 [label="L3_QKV_Projection_GPU0
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 0-3
TP Slice: 0
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_attn_gpu0 [label="L3_Multi-Head_Attention_GPU0
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_attn_proj_gpu0 [label="L3_Attn_Projection_GPU0
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_qkv_gpu1 [label="L3_QKV_Projection_GPU1
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 4-7
TP Slice: 1
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_attn_gpu1 [label="L3_Multi-Head_Attention_GPU1
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_attn_proj_gpu1 [label="L3_Attn_Projection_GPU1
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_qkv_gpu2 [label="L3_QKV_Projection_GPU2
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 8-11
TP Slice: 2
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_attn_gpu2 [label="L3_Multi-Head_Attention_GPU2
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_attn_proj_gpu2 [label="L3_Attn_Projection_GPU2
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_qkv_gpu3 [label="L3_QKV_Projection_GPU3
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 12-15
TP Slice: 3
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_attn_gpu3 [label="L3_Multi-Head_Attention_GPU3
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_attn_proj_gpu3 [label="L3_Attn_Projection_GPU3
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_qkv_gpu4 [label="L3_QKV_Projection_GPU4
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 16-19
TP Slice: 4
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_attn_gpu4 [label="L3_Multi-Head_Attention_GPU4
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_attn_proj_gpu4 [label="L3_Attn_Projection_GPU4
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_qkv_gpu5 [label="L3_QKV_Projection_GPU5
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 20-23
TP Slice: 5
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_attn_gpu5 [label="L3_Multi-Head_Attention_GPU5
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_attn_proj_gpu5 [label="L3_Attn_Projection_GPU5
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_qkv_gpu6 [label="L3_QKV_Projection_GPU6
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 24-27
TP Slice: 6
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_attn_gpu6 [label="L3_Multi-Head_Attention_GPU6
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_attn_proj_gpu6 [label="L3_Attn_Projection_GPU6
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_qkv_gpu7 [label="L3_QKV_Projection_GPU7
Input: [1024,2048,4096]
Output: [1024,2048,512]
Heads: 28-31
TP Slice: 7
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_attn_gpu7 [label="L3_Multi-Head_Attention_GPU7
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_attn_proj_gpu7 [label="L3_Attn_Projection_GPU7
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_attn_allreduce [label="L3_Attention_All-Reduce
Input: 8×[1024,2048,512]
Output: [1024,2048,4096]
TP All-Reduce across GPUs 0-7" fillcolor=lightcoral shape=diamond]
	layer3_attn_norm_gpu0 [label="L3_Residual+LayerNorm_GPU0
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer3_attn_norm_gpu1 [label="L3_Residual+LayerNorm_GPU1
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer3_attn_norm_gpu2 [label="L3_Residual+LayerNorm_GPU2
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer3_attn_norm_gpu3 [label="L3_Residual+LayerNorm_GPU3
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer3_attn_norm_gpu4 [label="L3_Residual+LayerNorm_GPU4
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer3_attn_norm_gpu5 [label="L3_Residual+LayerNorm_GPU5
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer3_attn_norm_gpu6 [label="L3_Residual+LayerNorm_GPU6
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer3_attn_norm_gpu7 [label="L3_Residual+LayerNorm_GPU7
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Replicated across GPUs 0-7" fillcolor=lightgreen shape=rectangle]
	layer3_gate_gpu0 [label="L3_Gate_GPU0
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_expert0_0 [label="L3_Expert0_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_expert0_1 [label="L3_Expert1_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_expert0_2 [label="L3_Expert2_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_expert0_3 [label="L3_Expert3_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_expert0_4 [label="L3_Expert4_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_expert0_5 [label="L3_Expert5_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_expert0_6 [label="L3_Expert6_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_expert0_7 [label="L3_Expert7_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_expert0_8 [label="L3_Expert8_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_expert0_9 [label="L3_Expert9_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_expert0_10 [label="L3_Expert10_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_expert0_11 [label="L3_Expert11_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_expert0_12 [label="L3_Expert12_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_expert0_13 [label="L3_Expert13_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_expert0_14 [label="L3_Expert14_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_expert0_15 [label="L3_Expert15_GPU0
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_moe_agg_gpu0 [label="L3_MoE_Aggregate_GPU0
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_output_gpu0 [label="L3_Residual+LayerNorm_GPU0
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer3_gate_gpu1 [label="L3_Gate_GPU1
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_expert1_0 [label="L3_Expert0_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_expert1_1 [label="L3_Expert1_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_expert1_2 [label="L3_Expert2_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_expert1_3 [label="L3_Expert3_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_expert1_4 [label="L3_Expert4_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_expert1_5 [label="L3_Expert5_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_expert1_6 [label="L3_Expert6_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_expert1_7 [label="L3_Expert7_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_expert1_8 [label="L3_Expert8_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_expert1_9 [label="L3_Expert9_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_expert1_10 [label="L3_Expert10_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_expert1_11 [label="L3_Expert11_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_expert1_12 [label="L3_Expert12_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_expert1_13 [label="L3_Expert13_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_expert1_14 [label="L3_Expert14_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_expert1_15 [label="L3_Expert15_GPU1
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_moe_agg_gpu1 [label="L3_MoE_Aggregate_GPU1
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_output_gpu1 [label="L3_Residual+LayerNorm_GPU1
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer3_gate_gpu2 [label="L3_Gate_GPU2
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_expert2_0 [label="L3_Expert0_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_expert2_1 [label="L3_Expert1_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_expert2_2 [label="L3_Expert2_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_expert2_3 [label="L3_Expert3_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_expert2_4 [label="L3_Expert4_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_expert2_5 [label="L3_Expert5_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_expert2_6 [label="L3_Expert6_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_expert2_7 [label="L3_Expert7_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_expert2_8 [label="L3_Expert8_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_expert2_9 [label="L3_Expert9_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_expert2_10 [label="L3_Expert10_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_expert2_11 [label="L3_Expert11_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_expert2_12 [label="L3_Expert12_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_expert2_13 [label="L3_Expert13_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_expert2_14 [label="L3_Expert14_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_expert2_15 [label="L3_Expert15_GPU2
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_moe_agg_gpu2 [label="L3_MoE_Aggregate_GPU2
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_output_gpu2 [label="L3_Residual+LayerNorm_GPU2
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer3_gate_gpu3 [label="L3_Gate_GPU3
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_expert3_0 [label="L3_Expert0_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_expert3_1 [label="L3_Expert1_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_expert3_2 [label="L3_Expert2_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_expert3_3 [label="L3_Expert3_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_expert3_4 [label="L3_Expert4_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_expert3_5 [label="L3_Expert5_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_expert3_6 [label="L3_Expert6_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_expert3_7 [label="L3_Expert7_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_expert3_8 [label="L3_Expert8_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_expert3_9 [label="L3_Expert9_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_expert3_10 [label="L3_Expert10_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_expert3_11 [label="L3_Expert11_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_expert3_12 [label="L3_Expert12_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_expert3_13 [label="L3_Expert13_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_expert3_14 [label="L3_Expert14_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_expert3_15 [label="L3_Expert15_GPU3
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_moe_agg_gpu3 [label="L3_MoE_Aggregate_GPU3
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_output_gpu3 [label="L3_Residual+LayerNorm_GPU3
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer3_gate_gpu4 [label="L3_Gate_GPU4
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_expert4_0 [label="L3_Expert0_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_expert4_1 [label="L3_Expert1_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_expert4_2 [label="L3_Expert2_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_expert4_3 [label="L3_Expert3_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_expert4_4 [label="L3_Expert4_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_expert4_5 [label="L3_Expert5_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_expert4_6 [label="L3_Expert6_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_expert4_7 [label="L3_Expert7_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_expert4_8 [label="L3_Expert8_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_expert4_9 [label="L3_Expert9_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_expert4_10 [label="L3_Expert10_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_expert4_11 [label="L3_Expert11_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_expert4_12 [label="L3_Expert12_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_expert4_13 [label="L3_Expert13_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_expert4_14 [label="L3_Expert14_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_expert4_15 [label="L3_Expert15_GPU4
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_moe_agg_gpu4 [label="L3_MoE_Aggregate_GPU4
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_output_gpu4 [label="L3_Residual+LayerNorm_GPU4
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer3_gate_gpu5 [label="L3_Gate_GPU5
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_expert5_0 [label="L3_Expert0_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_expert5_1 [label="L3_Expert1_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_expert5_2 [label="L3_Expert2_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_expert5_3 [label="L3_Expert3_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_expert5_4 [label="L3_Expert4_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_expert5_5 [label="L3_Expert5_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_expert5_6 [label="L3_Expert6_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_expert5_7 [label="L3_Expert7_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_expert5_8 [label="L3_Expert8_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_expert5_9 [label="L3_Expert9_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_expert5_10 [label="L3_Expert10_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_expert5_11 [label="L3_Expert11_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_expert5_12 [label="L3_Expert12_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_expert5_13 [label="L3_Expert13_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_expert5_14 [label="L3_Expert14_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_expert5_15 [label="L3_Expert15_GPU5
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_moe_agg_gpu5 [label="L3_MoE_Aggregate_GPU5
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_output_gpu5 [label="L3_Residual+LayerNorm_GPU5
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer3_gate_gpu6 [label="L3_Gate_GPU6
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_expert6_0 [label="L3_Expert0_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_expert6_1 [label="L3_Expert1_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_expert6_2 [label="L3_Expert2_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_expert6_3 [label="L3_Expert3_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_expert6_4 [label="L3_Expert4_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_expert6_5 [label="L3_Expert5_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_expert6_6 [label="L3_Expert6_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_expert6_7 [label="L3_Expert7_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_expert6_8 [label="L3_Expert8_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_expert6_9 [label="L3_Expert9_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_expert6_10 [label="L3_Expert10_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_expert6_11 [label="L3_Expert11_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_expert6_12 [label="L3_Expert12_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_expert6_13 [label="L3_Expert13_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_expert6_14 [label="L3_Expert14_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_expert6_15 [label="L3_Expert15_GPU6
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_moe_agg_gpu6 [label="L3_MoE_Aggregate_GPU6
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_output_gpu6 [label="L3_Residual+LayerNorm_GPU6
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer3_gate_gpu7 [label="L3_Gate_GPU7
Input: [1024,2048,4096]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_expert7_0 [label="L3_Expert0_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_expert7_1 [label="L3_Expert1_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_expert7_2 [label="L3_Expert2_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_expert7_3 [label="L3_Expert3_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_expert7_4 [label="L3_Expert4_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_expert7_5 [label="L3_Expert5_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_expert7_6 [label="L3_Expert6_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_expert7_7 [label="L3_Expert7_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_expert7_8 [label="L3_Expert8_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_expert7_9 [label="L3_Expert9_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_expert7_10 [label="L3_Expert10_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_expert7_11 [label="L3_Expert11_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_expert7_12 [label="L3_Expert12_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_expert7_13 [label="L3_Expert13_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_expert7_14 [label="L3_Expert14_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_expert7_15 [label="L3_Expert15_GPU7
Input: [tokens,4096]
Output: [tokens,4096]
Expert hidden: 16384
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_moe_agg_gpu7 [label="L3_MoE_Aggregate_GPU7
Input: 16×[tokens,4096]
Output: [1024,2048,4096]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_output_gpu7 [label="L3_Residual+LayerNorm_GPU7
Input: [1024,2048,4096]x2
Output: [1024,2048,4096]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer3_moe_allreduce [label="L3_MoE_All-Reduce
Input: 8×[1024,2048,4096]
Output: [1024,2048,4096]
TP All-Reduce across GPUs 0-7" fillcolor=lightcoral shape=diamond]
	output [label="OUTPUT
Input: [batch_size=1024, seq_len=2048, hidden=4096]
GPU: 0-7" fillcolor=lightblue shape=ellipse]
	input -> layer0_qkv_gpu0
	input -> layer0_qkv_gpu1
	input -> layer0_qkv_gpu2
	input -> layer0_qkv_gpu3
	input -> layer0_qkv_gpu4
	input -> layer0_qkv_gpu5
	input -> layer0_qkv_gpu6
	input -> layer0_qkv_gpu7
	layer0_qkv_gpu0 -> layer0_attn_gpu0
	layer0_attn_gpu0 -> layer0_attn_proj_gpu0
	layer0_attn_proj_gpu0 -> layer0_attn_allreduce
	layer0_attn_allreduce -> layer0_attn_norm_gpu0
	layer0_attn_norm_gpu0 -> layer0_gate_gpu0
	layer0_gate_gpu0 -> layer0_expert0_0 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_1 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_2 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_3 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_4 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_5 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_6 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_7 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_8 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_9 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_10 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_11 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_12 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_13 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_14 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_15 [style=dashed]
	layer0_expert0_0 -> layer0_moe_agg_gpu0
	layer0_expert0_1 -> layer0_moe_agg_gpu0
	layer0_expert0_2 -> layer0_moe_agg_gpu0
	layer0_expert0_3 -> layer0_moe_agg_gpu0
	layer0_expert0_4 -> layer0_moe_agg_gpu0
	layer0_expert0_5 -> layer0_moe_agg_gpu0
	layer0_expert0_6 -> layer0_moe_agg_gpu0
	layer0_expert0_7 -> layer0_moe_agg_gpu0
	layer0_expert0_8 -> layer0_moe_agg_gpu0
	layer0_expert0_9 -> layer0_moe_agg_gpu0
	layer0_expert0_10 -> layer0_moe_agg_gpu0
	layer0_expert0_11 -> layer0_moe_agg_gpu0
	layer0_expert0_12 -> layer0_moe_agg_gpu0
	layer0_expert0_13 -> layer0_moe_agg_gpu0
	layer0_expert0_14 -> layer0_moe_agg_gpu0
	layer0_expert0_15 -> layer0_moe_agg_gpu0
	layer0_moe_agg_gpu0 -> layer0_moe_allreduce
	layer0_moe_allreduce -> layer0_output_gpu0
	layer0_qkv_gpu1 -> layer0_attn_gpu1
	layer0_attn_gpu1 -> layer0_attn_proj_gpu1
	layer0_attn_proj_gpu1 -> layer0_attn_allreduce
	layer0_attn_allreduce -> layer0_attn_norm_gpu1
	layer0_attn_norm_gpu1 -> layer0_gate_gpu1
	layer0_gate_gpu1 -> layer0_expert1_0 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_1 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_2 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_3 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_4 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_5 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_6 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_7 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_8 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_9 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_10 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_11 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_12 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_13 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_14 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_15 [style=dashed]
	layer0_expert1_0 -> layer0_moe_agg_gpu1
	layer0_expert1_1 -> layer0_moe_agg_gpu1
	layer0_expert1_2 -> layer0_moe_agg_gpu1
	layer0_expert1_3 -> layer0_moe_agg_gpu1
	layer0_expert1_4 -> layer0_moe_agg_gpu1
	layer0_expert1_5 -> layer0_moe_agg_gpu1
	layer0_expert1_6 -> layer0_moe_agg_gpu1
	layer0_expert1_7 -> layer0_moe_agg_gpu1
	layer0_expert1_8 -> layer0_moe_agg_gpu1
	layer0_expert1_9 -> layer0_moe_agg_gpu1
	layer0_expert1_10 -> layer0_moe_agg_gpu1
	layer0_expert1_11 -> layer0_moe_agg_gpu1
	layer0_expert1_12 -> layer0_moe_agg_gpu1
	layer0_expert1_13 -> layer0_moe_agg_gpu1
	layer0_expert1_14 -> layer0_moe_agg_gpu1
	layer0_expert1_15 -> layer0_moe_agg_gpu1
	layer0_moe_agg_gpu1 -> layer0_moe_allreduce
	layer0_moe_allreduce -> layer0_output_gpu1
	layer0_qkv_gpu2 -> layer0_attn_gpu2
	layer0_attn_gpu2 -> layer0_attn_proj_gpu2
	layer0_attn_proj_gpu2 -> layer0_attn_allreduce
	layer0_attn_allreduce -> layer0_attn_norm_gpu2
	layer0_attn_norm_gpu2 -> layer0_gate_gpu2
	layer0_gate_gpu2 -> layer0_expert2_0 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_1 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_2 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_3 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_4 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_5 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_6 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_7 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_8 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_9 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_10 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_11 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_12 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_13 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_14 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_15 [style=dashed]
	layer0_expert2_0 -> layer0_moe_agg_gpu2
	layer0_expert2_1 -> layer0_moe_agg_gpu2
	layer0_expert2_2 -> layer0_moe_agg_gpu2
	layer0_expert2_3 -> layer0_moe_agg_gpu2
	layer0_expert2_4 -> layer0_moe_agg_gpu2
	layer0_expert2_5 -> layer0_moe_agg_gpu2
	layer0_expert2_6 -> layer0_moe_agg_gpu2
	layer0_expert2_7 -> layer0_moe_agg_gpu2
	layer0_expert2_8 -> layer0_moe_agg_gpu2
	layer0_expert2_9 -> layer0_moe_agg_gpu2
	layer0_expert2_10 -> layer0_moe_agg_gpu2
	layer0_expert2_11 -> layer0_moe_agg_gpu2
	layer0_expert2_12 -> layer0_moe_agg_gpu2
	layer0_expert2_13 -> layer0_moe_agg_gpu2
	layer0_expert2_14 -> layer0_moe_agg_gpu2
	layer0_expert2_15 -> layer0_moe_agg_gpu2
	layer0_moe_agg_gpu2 -> layer0_moe_allreduce
	layer0_moe_allreduce -> layer0_output_gpu2
	layer0_qkv_gpu3 -> layer0_attn_gpu3
	layer0_attn_gpu3 -> layer0_attn_proj_gpu3
	layer0_attn_proj_gpu3 -> layer0_attn_allreduce
	layer0_attn_allreduce -> layer0_attn_norm_gpu3
	layer0_attn_norm_gpu3 -> layer0_gate_gpu3
	layer0_gate_gpu3 -> layer0_expert3_0 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_1 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_2 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_3 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_4 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_5 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_6 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_7 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_8 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_9 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_10 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_11 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_12 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_13 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_14 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_15 [style=dashed]
	layer0_expert3_0 -> layer0_moe_agg_gpu3
	layer0_expert3_1 -> layer0_moe_agg_gpu3
	layer0_expert3_2 -> layer0_moe_agg_gpu3
	layer0_expert3_3 -> layer0_moe_agg_gpu3
	layer0_expert3_4 -> layer0_moe_agg_gpu3
	layer0_expert3_5 -> layer0_moe_agg_gpu3
	layer0_expert3_6 -> layer0_moe_agg_gpu3
	layer0_expert3_7 -> layer0_moe_agg_gpu3
	layer0_expert3_8 -> layer0_moe_agg_gpu3
	layer0_expert3_9 -> layer0_moe_agg_gpu3
	layer0_expert3_10 -> layer0_moe_agg_gpu3
	layer0_expert3_11 -> layer0_moe_agg_gpu3
	layer0_expert3_12 -> layer0_moe_agg_gpu3
	layer0_expert3_13 -> layer0_moe_agg_gpu3
	layer0_expert3_14 -> layer0_moe_agg_gpu3
	layer0_expert3_15 -> layer0_moe_agg_gpu3
	layer0_moe_agg_gpu3 -> layer0_moe_allreduce
	layer0_moe_allreduce -> layer0_output_gpu3
	layer0_qkv_gpu4 -> layer0_attn_gpu4
	layer0_attn_gpu4 -> layer0_attn_proj_gpu4
	layer0_attn_proj_gpu4 -> layer0_attn_allreduce
	layer0_attn_allreduce -> layer0_attn_norm_gpu4
	layer0_attn_norm_gpu4 -> layer0_gate_gpu4
	layer0_gate_gpu4 -> layer0_expert4_0 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_1 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_2 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_3 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_4 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_5 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_6 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_7 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_8 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_9 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_10 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_11 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_12 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_13 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_14 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_15 [style=dashed]
	layer0_expert4_0 -> layer0_moe_agg_gpu4
	layer0_expert4_1 -> layer0_moe_agg_gpu4
	layer0_expert4_2 -> layer0_moe_agg_gpu4
	layer0_expert4_3 -> layer0_moe_agg_gpu4
	layer0_expert4_4 -> layer0_moe_agg_gpu4
	layer0_expert4_5 -> layer0_moe_agg_gpu4
	layer0_expert4_6 -> layer0_moe_agg_gpu4
	layer0_expert4_7 -> layer0_moe_agg_gpu4
	layer0_expert4_8 -> layer0_moe_agg_gpu4
	layer0_expert4_9 -> layer0_moe_agg_gpu4
	layer0_expert4_10 -> layer0_moe_agg_gpu4
	layer0_expert4_11 -> layer0_moe_agg_gpu4
	layer0_expert4_12 -> layer0_moe_agg_gpu4
	layer0_expert4_13 -> layer0_moe_agg_gpu4
	layer0_expert4_14 -> layer0_moe_agg_gpu4
	layer0_expert4_15 -> layer0_moe_agg_gpu4
	layer0_moe_agg_gpu4 -> layer0_moe_allreduce
	layer0_moe_allreduce -> layer0_output_gpu4
	layer0_qkv_gpu5 -> layer0_attn_gpu5
	layer0_attn_gpu5 -> layer0_attn_proj_gpu5
	layer0_attn_proj_gpu5 -> layer0_attn_allreduce
	layer0_attn_allreduce -> layer0_attn_norm_gpu5
	layer0_attn_norm_gpu5 -> layer0_gate_gpu5
	layer0_gate_gpu5 -> layer0_expert5_0 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_1 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_2 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_3 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_4 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_5 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_6 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_7 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_8 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_9 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_10 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_11 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_12 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_13 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_14 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_15 [style=dashed]
	layer0_expert5_0 -> layer0_moe_agg_gpu5
	layer0_expert5_1 -> layer0_moe_agg_gpu5
	layer0_expert5_2 -> layer0_moe_agg_gpu5
	layer0_expert5_3 -> layer0_moe_agg_gpu5
	layer0_expert5_4 -> layer0_moe_agg_gpu5
	layer0_expert5_5 -> layer0_moe_agg_gpu5
	layer0_expert5_6 -> layer0_moe_agg_gpu5
	layer0_expert5_7 -> layer0_moe_agg_gpu5
	layer0_expert5_8 -> layer0_moe_agg_gpu5
	layer0_expert5_9 -> layer0_moe_agg_gpu5
	layer0_expert5_10 -> layer0_moe_agg_gpu5
	layer0_expert5_11 -> layer0_moe_agg_gpu5
	layer0_expert5_12 -> layer0_moe_agg_gpu5
	layer0_expert5_13 -> layer0_moe_agg_gpu5
	layer0_expert5_14 -> layer0_moe_agg_gpu5
	layer0_expert5_15 -> layer0_moe_agg_gpu5
	layer0_moe_agg_gpu5 -> layer0_moe_allreduce
	layer0_moe_allreduce -> layer0_output_gpu5
	layer0_qkv_gpu6 -> layer0_attn_gpu6
	layer0_attn_gpu6 -> layer0_attn_proj_gpu6
	layer0_attn_proj_gpu6 -> layer0_attn_allreduce
	layer0_attn_allreduce -> layer0_attn_norm_gpu6
	layer0_attn_norm_gpu6 -> layer0_gate_gpu6
	layer0_gate_gpu6 -> layer0_expert6_0 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_1 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_2 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_3 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_4 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_5 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_6 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_7 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_8 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_9 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_10 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_11 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_12 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_13 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_14 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_15 [style=dashed]
	layer0_expert6_0 -> layer0_moe_agg_gpu6
	layer0_expert6_1 -> layer0_moe_agg_gpu6
	layer0_expert6_2 -> layer0_moe_agg_gpu6
	layer0_expert6_3 -> layer0_moe_agg_gpu6
	layer0_expert6_4 -> layer0_moe_agg_gpu6
	layer0_expert6_5 -> layer0_moe_agg_gpu6
	layer0_expert6_6 -> layer0_moe_agg_gpu6
	layer0_expert6_7 -> layer0_moe_agg_gpu6
	layer0_expert6_8 -> layer0_moe_agg_gpu6
	layer0_expert6_9 -> layer0_moe_agg_gpu6
	layer0_expert6_10 -> layer0_moe_agg_gpu6
	layer0_expert6_11 -> layer0_moe_agg_gpu6
	layer0_expert6_12 -> layer0_moe_agg_gpu6
	layer0_expert6_13 -> layer0_moe_agg_gpu6
	layer0_expert6_14 -> layer0_moe_agg_gpu6
	layer0_expert6_15 -> layer0_moe_agg_gpu6
	layer0_moe_agg_gpu6 -> layer0_moe_allreduce
	layer0_moe_allreduce -> layer0_output_gpu6
	layer0_qkv_gpu7 -> layer0_attn_gpu7
	layer0_attn_gpu7 -> layer0_attn_proj_gpu7
	layer0_attn_proj_gpu7 -> layer0_attn_allreduce
	layer0_attn_allreduce -> layer0_attn_norm_gpu7
	layer0_attn_norm_gpu7 -> layer0_gate_gpu7
	layer0_gate_gpu7 -> layer0_expert7_0 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_1 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_2 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_3 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_4 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_5 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_6 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_7 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_8 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_9 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_10 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_11 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_12 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_13 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_14 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_15 [style=dashed]
	layer0_expert7_0 -> layer0_moe_agg_gpu7
	layer0_expert7_1 -> layer0_moe_agg_gpu7
	layer0_expert7_2 -> layer0_moe_agg_gpu7
	layer0_expert7_3 -> layer0_moe_agg_gpu7
	layer0_expert7_4 -> layer0_moe_agg_gpu7
	layer0_expert7_5 -> layer0_moe_agg_gpu7
	layer0_expert7_6 -> layer0_moe_agg_gpu7
	layer0_expert7_7 -> layer0_moe_agg_gpu7
	layer0_expert7_8 -> layer0_moe_agg_gpu7
	layer0_expert7_9 -> layer0_moe_agg_gpu7
	layer0_expert7_10 -> layer0_moe_agg_gpu7
	layer0_expert7_11 -> layer0_moe_agg_gpu7
	layer0_expert7_12 -> layer0_moe_agg_gpu7
	layer0_expert7_13 -> layer0_moe_agg_gpu7
	layer0_expert7_14 -> layer0_moe_agg_gpu7
	layer0_expert7_15 -> layer0_moe_agg_gpu7
	layer0_moe_agg_gpu7 -> layer0_moe_allreduce
	layer0_moe_allreduce -> layer0_output_gpu7
	layer0_output_gpu0 -> layer1_qkv_gpu0
	layer0_output_gpu1 -> layer1_qkv_gpu1
	layer0_output_gpu2 -> layer1_qkv_gpu2
	layer0_output_gpu3 -> layer1_qkv_gpu3
	layer0_output_gpu4 -> layer1_qkv_gpu4
	layer0_output_gpu5 -> layer1_qkv_gpu5
	layer0_output_gpu6 -> layer1_qkv_gpu6
	layer0_output_gpu7 -> layer1_qkv_gpu7
	layer1_qkv_gpu0 -> layer1_attn_gpu0
	layer1_attn_gpu0 -> layer1_attn_proj_gpu0
	layer1_attn_proj_gpu0 -> layer1_attn_allreduce
	layer1_attn_allreduce -> layer1_attn_norm_gpu0
	layer1_attn_norm_gpu0 -> layer1_gate_gpu0
	layer1_gate_gpu0 -> layer1_expert0_0 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_1 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_2 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_3 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_4 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_5 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_6 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_7 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_8 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_9 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_10 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_11 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_12 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_13 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_14 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_15 [style=dashed]
	layer1_expert0_0 -> layer1_moe_agg_gpu0
	layer1_expert0_1 -> layer1_moe_agg_gpu0
	layer1_expert0_2 -> layer1_moe_agg_gpu0
	layer1_expert0_3 -> layer1_moe_agg_gpu0
	layer1_expert0_4 -> layer1_moe_agg_gpu0
	layer1_expert0_5 -> layer1_moe_agg_gpu0
	layer1_expert0_6 -> layer1_moe_agg_gpu0
	layer1_expert0_7 -> layer1_moe_agg_gpu0
	layer1_expert0_8 -> layer1_moe_agg_gpu0
	layer1_expert0_9 -> layer1_moe_agg_gpu0
	layer1_expert0_10 -> layer1_moe_agg_gpu0
	layer1_expert0_11 -> layer1_moe_agg_gpu0
	layer1_expert0_12 -> layer1_moe_agg_gpu0
	layer1_expert0_13 -> layer1_moe_agg_gpu0
	layer1_expert0_14 -> layer1_moe_agg_gpu0
	layer1_expert0_15 -> layer1_moe_agg_gpu0
	layer1_moe_agg_gpu0 -> layer1_moe_allreduce
	layer1_moe_allreduce -> layer1_output_gpu0
	layer1_qkv_gpu1 -> layer1_attn_gpu1
	layer1_attn_gpu1 -> layer1_attn_proj_gpu1
	layer1_attn_proj_gpu1 -> layer1_attn_allreduce
	layer1_attn_allreduce -> layer1_attn_norm_gpu1
	layer1_attn_norm_gpu1 -> layer1_gate_gpu1
	layer1_gate_gpu1 -> layer1_expert1_0 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_1 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_2 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_3 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_4 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_5 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_6 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_7 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_8 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_9 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_10 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_11 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_12 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_13 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_14 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_15 [style=dashed]
	layer1_expert1_0 -> layer1_moe_agg_gpu1
	layer1_expert1_1 -> layer1_moe_agg_gpu1
	layer1_expert1_2 -> layer1_moe_agg_gpu1
	layer1_expert1_3 -> layer1_moe_agg_gpu1
	layer1_expert1_4 -> layer1_moe_agg_gpu1
	layer1_expert1_5 -> layer1_moe_agg_gpu1
	layer1_expert1_6 -> layer1_moe_agg_gpu1
	layer1_expert1_7 -> layer1_moe_agg_gpu1
	layer1_expert1_8 -> layer1_moe_agg_gpu1
	layer1_expert1_9 -> layer1_moe_agg_gpu1
	layer1_expert1_10 -> layer1_moe_agg_gpu1
	layer1_expert1_11 -> layer1_moe_agg_gpu1
	layer1_expert1_12 -> layer1_moe_agg_gpu1
	layer1_expert1_13 -> layer1_moe_agg_gpu1
	layer1_expert1_14 -> layer1_moe_agg_gpu1
	layer1_expert1_15 -> layer1_moe_agg_gpu1
	layer1_moe_agg_gpu1 -> layer1_moe_allreduce
	layer1_moe_allreduce -> layer1_output_gpu1
	layer1_qkv_gpu2 -> layer1_attn_gpu2
	layer1_attn_gpu2 -> layer1_attn_proj_gpu2
	layer1_attn_proj_gpu2 -> layer1_attn_allreduce
	layer1_attn_allreduce -> layer1_attn_norm_gpu2
	layer1_attn_norm_gpu2 -> layer1_gate_gpu2
	layer1_gate_gpu2 -> layer1_expert2_0 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_1 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_2 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_3 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_4 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_5 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_6 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_7 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_8 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_9 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_10 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_11 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_12 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_13 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_14 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_15 [style=dashed]
	layer1_expert2_0 -> layer1_moe_agg_gpu2
	layer1_expert2_1 -> layer1_moe_agg_gpu2
	layer1_expert2_2 -> layer1_moe_agg_gpu2
	layer1_expert2_3 -> layer1_moe_agg_gpu2
	layer1_expert2_4 -> layer1_moe_agg_gpu2
	layer1_expert2_5 -> layer1_moe_agg_gpu2
	layer1_expert2_6 -> layer1_moe_agg_gpu2
	layer1_expert2_7 -> layer1_moe_agg_gpu2
	layer1_expert2_8 -> layer1_moe_agg_gpu2
	layer1_expert2_9 -> layer1_moe_agg_gpu2
	layer1_expert2_10 -> layer1_moe_agg_gpu2
	layer1_expert2_11 -> layer1_moe_agg_gpu2
	layer1_expert2_12 -> layer1_moe_agg_gpu2
	layer1_expert2_13 -> layer1_moe_agg_gpu2
	layer1_expert2_14 -> layer1_moe_agg_gpu2
	layer1_expert2_15 -> layer1_moe_agg_gpu2
	layer1_moe_agg_gpu2 -> layer1_moe_allreduce
	layer1_moe_allreduce -> layer1_output_gpu2
	layer1_qkv_gpu3 -> layer1_attn_gpu3
	layer1_attn_gpu3 -> layer1_attn_proj_gpu3
	layer1_attn_proj_gpu3 -> layer1_attn_allreduce
	layer1_attn_allreduce -> layer1_attn_norm_gpu3
	layer1_attn_norm_gpu3 -> layer1_gate_gpu3
	layer1_gate_gpu3 -> layer1_expert3_0 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_1 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_2 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_3 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_4 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_5 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_6 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_7 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_8 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_9 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_10 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_11 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_12 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_13 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_14 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_15 [style=dashed]
	layer1_expert3_0 -> layer1_moe_agg_gpu3
	layer1_expert3_1 -> layer1_moe_agg_gpu3
	layer1_expert3_2 -> layer1_moe_agg_gpu3
	layer1_expert3_3 -> layer1_moe_agg_gpu3
	layer1_expert3_4 -> layer1_moe_agg_gpu3
	layer1_expert3_5 -> layer1_moe_agg_gpu3
	layer1_expert3_6 -> layer1_moe_agg_gpu3
	layer1_expert3_7 -> layer1_moe_agg_gpu3
	layer1_expert3_8 -> layer1_moe_agg_gpu3
	layer1_expert3_9 -> layer1_moe_agg_gpu3
	layer1_expert3_10 -> layer1_moe_agg_gpu3
	layer1_expert3_11 -> layer1_moe_agg_gpu3
	layer1_expert3_12 -> layer1_moe_agg_gpu3
	layer1_expert3_13 -> layer1_moe_agg_gpu3
	layer1_expert3_14 -> layer1_moe_agg_gpu3
	layer1_expert3_15 -> layer1_moe_agg_gpu3
	layer1_moe_agg_gpu3 -> layer1_moe_allreduce
	layer1_moe_allreduce -> layer1_output_gpu3
	layer1_qkv_gpu4 -> layer1_attn_gpu4
	layer1_attn_gpu4 -> layer1_attn_proj_gpu4
	layer1_attn_proj_gpu4 -> layer1_attn_allreduce
	layer1_attn_allreduce -> layer1_attn_norm_gpu4
	layer1_attn_norm_gpu4 -> layer1_gate_gpu4
	layer1_gate_gpu4 -> layer1_expert4_0 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_1 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_2 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_3 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_4 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_5 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_6 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_7 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_8 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_9 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_10 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_11 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_12 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_13 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_14 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_15 [style=dashed]
	layer1_expert4_0 -> layer1_moe_agg_gpu4
	layer1_expert4_1 -> layer1_moe_agg_gpu4
	layer1_expert4_2 -> layer1_moe_agg_gpu4
	layer1_expert4_3 -> layer1_moe_agg_gpu4
	layer1_expert4_4 -> layer1_moe_agg_gpu4
	layer1_expert4_5 -> layer1_moe_agg_gpu4
	layer1_expert4_6 -> layer1_moe_agg_gpu4
	layer1_expert4_7 -> layer1_moe_agg_gpu4
	layer1_expert4_8 -> layer1_moe_agg_gpu4
	layer1_expert4_9 -> layer1_moe_agg_gpu4
	layer1_expert4_10 -> layer1_moe_agg_gpu4
	layer1_expert4_11 -> layer1_moe_agg_gpu4
	layer1_expert4_12 -> layer1_moe_agg_gpu4
	layer1_expert4_13 -> layer1_moe_agg_gpu4
	layer1_expert4_14 -> layer1_moe_agg_gpu4
	layer1_expert4_15 -> layer1_moe_agg_gpu4
	layer1_moe_agg_gpu4 -> layer1_moe_allreduce
	layer1_moe_allreduce -> layer1_output_gpu4
	layer1_qkv_gpu5 -> layer1_attn_gpu5
	layer1_attn_gpu5 -> layer1_attn_proj_gpu5
	layer1_attn_proj_gpu5 -> layer1_attn_allreduce
	layer1_attn_allreduce -> layer1_attn_norm_gpu5
	layer1_attn_norm_gpu5 -> layer1_gate_gpu5
	layer1_gate_gpu5 -> layer1_expert5_0 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_1 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_2 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_3 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_4 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_5 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_6 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_7 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_8 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_9 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_10 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_11 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_12 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_13 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_14 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_15 [style=dashed]
	layer1_expert5_0 -> layer1_moe_agg_gpu5
	layer1_expert5_1 -> layer1_moe_agg_gpu5
	layer1_expert5_2 -> layer1_moe_agg_gpu5
	layer1_expert5_3 -> layer1_moe_agg_gpu5
	layer1_expert5_4 -> layer1_moe_agg_gpu5
	layer1_expert5_5 -> layer1_moe_agg_gpu5
	layer1_expert5_6 -> layer1_moe_agg_gpu5
	layer1_expert5_7 -> layer1_moe_agg_gpu5
	layer1_expert5_8 -> layer1_moe_agg_gpu5
	layer1_expert5_9 -> layer1_moe_agg_gpu5
	layer1_expert5_10 -> layer1_moe_agg_gpu5
	layer1_expert5_11 -> layer1_moe_agg_gpu5
	layer1_expert5_12 -> layer1_moe_agg_gpu5
	layer1_expert5_13 -> layer1_moe_agg_gpu5
	layer1_expert5_14 -> layer1_moe_agg_gpu5
	layer1_expert5_15 -> layer1_moe_agg_gpu5
	layer1_moe_agg_gpu5 -> layer1_moe_allreduce
	layer1_moe_allreduce -> layer1_output_gpu5
	layer1_qkv_gpu6 -> layer1_attn_gpu6
	layer1_attn_gpu6 -> layer1_attn_proj_gpu6
	layer1_attn_proj_gpu6 -> layer1_attn_allreduce
	layer1_attn_allreduce -> layer1_attn_norm_gpu6
	layer1_attn_norm_gpu6 -> layer1_gate_gpu6
	layer1_gate_gpu6 -> layer1_expert6_0 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_1 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_2 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_3 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_4 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_5 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_6 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_7 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_8 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_9 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_10 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_11 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_12 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_13 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_14 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_15 [style=dashed]
	layer1_expert6_0 -> layer1_moe_agg_gpu6
	layer1_expert6_1 -> layer1_moe_agg_gpu6
	layer1_expert6_2 -> layer1_moe_agg_gpu6
	layer1_expert6_3 -> layer1_moe_agg_gpu6
	layer1_expert6_4 -> layer1_moe_agg_gpu6
	layer1_expert6_5 -> layer1_moe_agg_gpu6
	layer1_expert6_6 -> layer1_moe_agg_gpu6
	layer1_expert6_7 -> layer1_moe_agg_gpu6
	layer1_expert6_8 -> layer1_moe_agg_gpu6
	layer1_expert6_9 -> layer1_moe_agg_gpu6
	layer1_expert6_10 -> layer1_moe_agg_gpu6
	layer1_expert6_11 -> layer1_moe_agg_gpu6
	layer1_expert6_12 -> layer1_moe_agg_gpu6
	layer1_expert6_13 -> layer1_moe_agg_gpu6
	layer1_expert6_14 -> layer1_moe_agg_gpu6
	layer1_expert6_15 -> layer1_moe_agg_gpu6
	layer1_moe_agg_gpu6 -> layer1_moe_allreduce
	layer1_moe_allreduce -> layer1_output_gpu6
	layer1_qkv_gpu7 -> layer1_attn_gpu7
	layer1_attn_gpu7 -> layer1_attn_proj_gpu7
	layer1_attn_proj_gpu7 -> layer1_attn_allreduce
	layer1_attn_allreduce -> layer1_attn_norm_gpu7
	layer1_attn_norm_gpu7 -> layer1_gate_gpu7
	layer1_gate_gpu7 -> layer1_expert7_0 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_1 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_2 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_3 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_4 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_5 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_6 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_7 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_8 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_9 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_10 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_11 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_12 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_13 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_14 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_15 [style=dashed]
	layer1_expert7_0 -> layer1_moe_agg_gpu7
	layer1_expert7_1 -> layer1_moe_agg_gpu7
	layer1_expert7_2 -> layer1_moe_agg_gpu7
	layer1_expert7_3 -> layer1_moe_agg_gpu7
	layer1_expert7_4 -> layer1_moe_agg_gpu7
	layer1_expert7_5 -> layer1_moe_agg_gpu7
	layer1_expert7_6 -> layer1_moe_agg_gpu7
	layer1_expert7_7 -> layer1_moe_agg_gpu7
	layer1_expert7_8 -> layer1_moe_agg_gpu7
	layer1_expert7_9 -> layer1_moe_agg_gpu7
	layer1_expert7_10 -> layer1_moe_agg_gpu7
	layer1_expert7_11 -> layer1_moe_agg_gpu7
	layer1_expert7_12 -> layer1_moe_agg_gpu7
	layer1_expert7_13 -> layer1_moe_agg_gpu7
	layer1_expert7_14 -> layer1_moe_agg_gpu7
	layer1_expert7_15 -> layer1_moe_agg_gpu7
	layer1_moe_agg_gpu7 -> layer1_moe_allreduce
	layer1_moe_allreduce -> layer1_output_gpu7
	layer1_output_gpu0 -> layer2_qkv_gpu0
	layer1_output_gpu1 -> layer2_qkv_gpu1
	layer1_output_gpu2 -> layer2_qkv_gpu2
	layer1_output_gpu3 -> layer2_qkv_gpu3
	layer1_output_gpu4 -> layer2_qkv_gpu4
	layer1_output_gpu5 -> layer2_qkv_gpu5
	layer1_output_gpu6 -> layer2_qkv_gpu6
	layer1_output_gpu7 -> layer2_qkv_gpu7
	layer2_qkv_gpu0 -> layer2_attn_gpu0
	layer2_attn_gpu0 -> layer2_attn_proj_gpu0
	layer2_attn_proj_gpu0 -> layer2_attn_allreduce
	layer2_attn_allreduce -> layer2_attn_norm_gpu0
	layer2_attn_norm_gpu0 -> layer2_gate_gpu0
	layer2_gate_gpu0 -> layer2_expert0_0 [style=dashed]
	layer2_gate_gpu0 -> layer2_expert0_1 [style=dashed]
	layer2_gate_gpu0 -> layer2_expert0_2 [style=dashed]
	layer2_gate_gpu0 -> layer2_expert0_3 [style=dashed]
	layer2_gate_gpu0 -> layer2_expert0_4 [style=dashed]
	layer2_gate_gpu0 -> layer2_expert0_5 [style=dashed]
	layer2_gate_gpu0 -> layer2_expert0_6 [style=dashed]
	layer2_gate_gpu0 -> layer2_expert0_7 [style=dashed]
	layer2_gate_gpu0 -> layer2_expert0_8 [style=dashed]
	layer2_gate_gpu0 -> layer2_expert0_9 [style=dashed]
	layer2_gate_gpu0 -> layer2_expert0_10 [style=dashed]
	layer2_gate_gpu0 -> layer2_expert0_11 [style=dashed]
	layer2_gate_gpu0 -> layer2_expert0_12 [style=dashed]
	layer2_gate_gpu0 -> layer2_expert0_13 [style=dashed]
	layer2_gate_gpu0 -> layer2_expert0_14 [style=dashed]
	layer2_gate_gpu0 -> layer2_expert0_15 [style=dashed]
	layer2_expert0_0 -> layer2_moe_agg_gpu0
	layer2_expert0_1 -> layer2_moe_agg_gpu0
	layer2_expert0_2 -> layer2_moe_agg_gpu0
	layer2_expert0_3 -> layer2_moe_agg_gpu0
	layer2_expert0_4 -> layer2_moe_agg_gpu0
	layer2_expert0_5 -> layer2_moe_agg_gpu0
	layer2_expert0_6 -> layer2_moe_agg_gpu0
	layer2_expert0_7 -> layer2_moe_agg_gpu0
	layer2_expert0_8 -> layer2_moe_agg_gpu0
	layer2_expert0_9 -> layer2_moe_agg_gpu0
	layer2_expert0_10 -> layer2_moe_agg_gpu0
	layer2_expert0_11 -> layer2_moe_agg_gpu0
	layer2_expert0_12 -> layer2_moe_agg_gpu0
	layer2_expert0_13 -> layer2_moe_agg_gpu0
	layer2_expert0_14 -> layer2_moe_agg_gpu0
	layer2_expert0_15 -> layer2_moe_agg_gpu0
	layer2_moe_agg_gpu0 -> layer2_moe_allreduce
	layer2_moe_allreduce -> layer2_output_gpu0
	layer2_qkv_gpu1 -> layer2_attn_gpu1
	layer2_attn_gpu1 -> layer2_attn_proj_gpu1
	layer2_attn_proj_gpu1 -> layer2_attn_allreduce
	layer2_attn_allreduce -> layer2_attn_norm_gpu1
	layer2_attn_norm_gpu1 -> layer2_gate_gpu1
	layer2_gate_gpu1 -> layer2_expert1_0 [style=dashed]
	layer2_gate_gpu1 -> layer2_expert1_1 [style=dashed]
	layer2_gate_gpu1 -> layer2_expert1_2 [style=dashed]
	layer2_gate_gpu1 -> layer2_expert1_3 [style=dashed]
	layer2_gate_gpu1 -> layer2_expert1_4 [style=dashed]
	layer2_gate_gpu1 -> layer2_expert1_5 [style=dashed]
	layer2_gate_gpu1 -> layer2_expert1_6 [style=dashed]
	layer2_gate_gpu1 -> layer2_expert1_7 [style=dashed]
	layer2_gate_gpu1 -> layer2_expert1_8 [style=dashed]
	layer2_gate_gpu1 -> layer2_expert1_9 [style=dashed]
	layer2_gate_gpu1 -> layer2_expert1_10 [style=dashed]
	layer2_gate_gpu1 -> layer2_expert1_11 [style=dashed]
	layer2_gate_gpu1 -> layer2_expert1_12 [style=dashed]
	layer2_gate_gpu1 -> layer2_expert1_13 [style=dashed]
	layer2_gate_gpu1 -> layer2_expert1_14 [style=dashed]
	layer2_gate_gpu1 -> layer2_expert1_15 [style=dashed]
	layer2_expert1_0 -> layer2_moe_agg_gpu1
	layer2_expert1_1 -> layer2_moe_agg_gpu1
	layer2_expert1_2 -> layer2_moe_agg_gpu1
	layer2_expert1_3 -> layer2_moe_agg_gpu1
	layer2_expert1_4 -> layer2_moe_agg_gpu1
	layer2_expert1_5 -> layer2_moe_agg_gpu1
	layer2_expert1_6 -> layer2_moe_agg_gpu1
	layer2_expert1_7 -> layer2_moe_agg_gpu1
	layer2_expert1_8 -> layer2_moe_agg_gpu1
	layer2_expert1_9 -> layer2_moe_agg_gpu1
	layer2_expert1_10 -> layer2_moe_agg_gpu1
	layer2_expert1_11 -> layer2_moe_agg_gpu1
	layer2_expert1_12 -> layer2_moe_agg_gpu1
	layer2_expert1_13 -> layer2_moe_agg_gpu1
	layer2_expert1_14 -> layer2_moe_agg_gpu1
	layer2_expert1_15 -> layer2_moe_agg_gpu1
	layer2_moe_agg_gpu1 -> layer2_moe_allreduce
	layer2_moe_allreduce -> layer2_output_gpu1
	layer2_qkv_gpu2 -> layer2_attn_gpu2
	layer2_attn_gpu2 -> layer2_attn_proj_gpu2
	layer2_attn_proj_gpu2 -> layer2_attn_allreduce
	layer2_attn_allreduce -> layer2_attn_norm_gpu2
	layer2_attn_norm_gpu2 -> layer2_gate_gpu2
	layer2_gate_gpu2 -> layer2_expert2_0 [style=dashed]
	layer2_gate_gpu2 -> layer2_expert2_1 [style=dashed]
	layer2_gate_gpu2 -> layer2_expert2_2 [style=dashed]
	layer2_gate_gpu2 -> layer2_expert2_3 [style=dashed]
	layer2_gate_gpu2 -> layer2_expert2_4 [style=dashed]
	layer2_gate_gpu2 -> layer2_expert2_5 [style=dashed]
	layer2_gate_gpu2 -> layer2_expert2_6 [style=dashed]
	layer2_gate_gpu2 -> layer2_expert2_7 [style=dashed]
	layer2_gate_gpu2 -> layer2_expert2_8 [style=dashed]
	layer2_gate_gpu2 -> layer2_expert2_9 [style=dashed]
	layer2_gate_gpu2 -> layer2_expert2_10 [style=dashed]
	layer2_gate_gpu2 -> layer2_expert2_11 [style=dashed]
	layer2_gate_gpu2 -> layer2_expert2_12 [style=dashed]
	layer2_gate_gpu2 -> layer2_expert2_13 [style=dashed]
	layer2_gate_gpu2 -> layer2_expert2_14 [style=dashed]
	layer2_gate_gpu2 -> layer2_expert2_15 [style=dashed]
	layer2_expert2_0 -> layer2_moe_agg_gpu2
	layer2_expert2_1 -> layer2_moe_agg_gpu2
	layer2_expert2_2 -> layer2_moe_agg_gpu2
	layer2_expert2_3 -> layer2_moe_agg_gpu2
	layer2_expert2_4 -> layer2_moe_agg_gpu2
	layer2_expert2_5 -> layer2_moe_agg_gpu2
	layer2_expert2_6 -> layer2_moe_agg_gpu2
	layer2_expert2_7 -> layer2_moe_agg_gpu2
	layer2_expert2_8 -> layer2_moe_agg_gpu2
	layer2_expert2_9 -> layer2_moe_agg_gpu2
	layer2_expert2_10 -> layer2_moe_agg_gpu2
	layer2_expert2_11 -> layer2_moe_agg_gpu2
	layer2_expert2_12 -> layer2_moe_agg_gpu2
	layer2_expert2_13 -> layer2_moe_agg_gpu2
	layer2_expert2_14 -> layer2_moe_agg_gpu2
	layer2_expert2_15 -> layer2_moe_agg_gpu2
	layer2_moe_agg_gpu2 -> layer2_moe_allreduce
	layer2_moe_allreduce -> layer2_output_gpu2
	layer2_qkv_gpu3 -> layer2_attn_gpu3
	layer2_attn_gpu3 -> layer2_attn_proj_gpu3
	layer2_attn_proj_gpu3 -> layer2_attn_allreduce
	layer2_attn_allreduce -> layer2_attn_norm_gpu3
	layer2_attn_norm_gpu3 -> layer2_gate_gpu3
	layer2_gate_gpu3 -> layer2_expert3_0 [style=dashed]
	layer2_gate_gpu3 -> layer2_expert3_1 [style=dashed]
	layer2_gate_gpu3 -> layer2_expert3_2 [style=dashed]
	layer2_gate_gpu3 -> layer2_expert3_3 [style=dashed]
	layer2_gate_gpu3 -> layer2_expert3_4 [style=dashed]
	layer2_gate_gpu3 -> layer2_expert3_5 [style=dashed]
	layer2_gate_gpu3 -> layer2_expert3_6 [style=dashed]
	layer2_gate_gpu3 -> layer2_expert3_7 [style=dashed]
	layer2_gate_gpu3 -> layer2_expert3_8 [style=dashed]
	layer2_gate_gpu3 -> layer2_expert3_9 [style=dashed]
	layer2_gate_gpu3 -> layer2_expert3_10 [style=dashed]
	layer2_gate_gpu3 -> layer2_expert3_11 [style=dashed]
	layer2_gate_gpu3 -> layer2_expert3_12 [style=dashed]
	layer2_gate_gpu3 -> layer2_expert3_13 [style=dashed]
	layer2_gate_gpu3 -> layer2_expert3_14 [style=dashed]
	layer2_gate_gpu3 -> layer2_expert3_15 [style=dashed]
	layer2_expert3_0 -> layer2_moe_agg_gpu3
	layer2_expert3_1 -> layer2_moe_agg_gpu3
	layer2_expert3_2 -> layer2_moe_agg_gpu3
	layer2_expert3_3 -> layer2_moe_agg_gpu3
	layer2_expert3_4 -> layer2_moe_agg_gpu3
	layer2_expert3_5 -> layer2_moe_agg_gpu3
	layer2_expert3_6 -> layer2_moe_agg_gpu3
	layer2_expert3_7 -> layer2_moe_agg_gpu3
	layer2_expert3_8 -> layer2_moe_agg_gpu3
	layer2_expert3_9 -> layer2_moe_agg_gpu3
	layer2_expert3_10 -> layer2_moe_agg_gpu3
	layer2_expert3_11 -> layer2_moe_agg_gpu3
	layer2_expert3_12 -> layer2_moe_agg_gpu3
	layer2_expert3_13 -> layer2_moe_agg_gpu3
	layer2_expert3_14 -> layer2_moe_agg_gpu3
	layer2_expert3_15 -> layer2_moe_agg_gpu3
	layer2_moe_agg_gpu3 -> layer2_moe_allreduce
	layer2_moe_allreduce -> layer2_output_gpu3
	layer2_qkv_gpu4 -> layer2_attn_gpu4
	layer2_attn_gpu4 -> layer2_attn_proj_gpu4
	layer2_attn_proj_gpu4 -> layer2_attn_allreduce
	layer2_attn_allreduce -> layer2_attn_norm_gpu4
	layer2_attn_norm_gpu4 -> layer2_gate_gpu4
	layer2_gate_gpu4 -> layer2_expert4_0 [style=dashed]
	layer2_gate_gpu4 -> layer2_expert4_1 [style=dashed]
	layer2_gate_gpu4 -> layer2_expert4_2 [style=dashed]
	layer2_gate_gpu4 -> layer2_expert4_3 [style=dashed]
	layer2_gate_gpu4 -> layer2_expert4_4 [style=dashed]
	layer2_gate_gpu4 -> layer2_expert4_5 [style=dashed]
	layer2_gate_gpu4 -> layer2_expert4_6 [style=dashed]
	layer2_gate_gpu4 -> layer2_expert4_7 [style=dashed]
	layer2_gate_gpu4 -> layer2_expert4_8 [style=dashed]
	layer2_gate_gpu4 -> layer2_expert4_9 [style=dashed]
	layer2_gate_gpu4 -> layer2_expert4_10 [style=dashed]
	layer2_gate_gpu4 -> layer2_expert4_11 [style=dashed]
	layer2_gate_gpu4 -> layer2_expert4_12 [style=dashed]
	layer2_gate_gpu4 -> layer2_expert4_13 [style=dashed]
	layer2_gate_gpu4 -> layer2_expert4_14 [style=dashed]
	layer2_gate_gpu4 -> layer2_expert4_15 [style=dashed]
	layer2_expert4_0 -> layer2_moe_agg_gpu4
	layer2_expert4_1 -> layer2_moe_agg_gpu4
	layer2_expert4_2 -> layer2_moe_agg_gpu4
	layer2_expert4_3 -> layer2_moe_agg_gpu4
	layer2_expert4_4 -> layer2_moe_agg_gpu4
	layer2_expert4_5 -> layer2_moe_agg_gpu4
	layer2_expert4_6 -> layer2_moe_agg_gpu4
	layer2_expert4_7 -> layer2_moe_agg_gpu4
	layer2_expert4_8 -> layer2_moe_agg_gpu4
	layer2_expert4_9 -> layer2_moe_agg_gpu4
	layer2_expert4_10 -> layer2_moe_agg_gpu4
	layer2_expert4_11 -> layer2_moe_agg_gpu4
	layer2_expert4_12 -> layer2_moe_agg_gpu4
	layer2_expert4_13 -> layer2_moe_agg_gpu4
	layer2_expert4_14 -> layer2_moe_agg_gpu4
	layer2_expert4_15 -> layer2_moe_agg_gpu4
	layer2_moe_agg_gpu4 -> layer2_moe_allreduce
	layer2_moe_allreduce -> layer2_output_gpu4
	layer2_qkv_gpu5 -> layer2_attn_gpu5
	layer2_attn_gpu5 -> layer2_attn_proj_gpu5
	layer2_attn_proj_gpu5 -> layer2_attn_allreduce
	layer2_attn_allreduce -> layer2_attn_norm_gpu5
	layer2_attn_norm_gpu5 -> layer2_gate_gpu5
	layer2_gate_gpu5 -> layer2_expert5_0 [style=dashed]
	layer2_gate_gpu5 -> layer2_expert5_1 [style=dashed]
	layer2_gate_gpu5 -> layer2_expert5_2 [style=dashed]
	layer2_gate_gpu5 -> layer2_expert5_3 [style=dashed]
	layer2_gate_gpu5 -> layer2_expert5_4 [style=dashed]
	layer2_gate_gpu5 -> layer2_expert5_5 [style=dashed]
	layer2_gate_gpu5 -> layer2_expert5_6 [style=dashed]
	layer2_gate_gpu5 -> layer2_expert5_7 [style=dashed]
	layer2_gate_gpu5 -> layer2_expert5_8 [style=dashed]
	layer2_gate_gpu5 -> layer2_expert5_9 [style=dashed]
	layer2_gate_gpu5 -> layer2_expert5_10 [style=dashed]
	layer2_gate_gpu5 -> layer2_expert5_11 [style=dashed]
	layer2_gate_gpu5 -> layer2_expert5_12 [style=dashed]
	layer2_gate_gpu5 -> layer2_expert5_13 [style=dashed]
	layer2_gate_gpu5 -> layer2_expert5_14 [style=dashed]
	layer2_gate_gpu5 -> layer2_expert5_15 [style=dashed]
	layer2_expert5_0 -> layer2_moe_agg_gpu5
	layer2_expert5_1 -> layer2_moe_agg_gpu5
	layer2_expert5_2 -> layer2_moe_agg_gpu5
	layer2_expert5_3 -> layer2_moe_agg_gpu5
	layer2_expert5_4 -> layer2_moe_agg_gpu5
	layer2_expert5_5 -> layer2_moe_agg_gpu5
	layer2_expert5_6 -> layer2_moe_agg_gpu5
	layer2_expert5_7 -> layer2_moe_agg_gpu5
	layer2_expert5_8 -> layer2_moe_agg_gpu5
	layer2_expert5_9 -> layer2_moe_agg_gpu5
	layer2_expert5_10 -> layer2_moe_agg_gpu5
	layer2_expert5_11 -> layer2_moe_agg_gpu5
	layer2_expert5_12 -> layer2_moe_agg_gpu5
	layer2_expert5_13 -> layer2_moe_agg_gpu5
	layer2_expert5_14 -> layer2_moe_agg_gpu5
	layer2_expert5_15 -> layer2_moe_agg_gpu5
	layer2_moe_agg_gpu5 -> layer2_moe_allreduce
	layer2_moe_allreduce -> layer2_output_gpu5
	layer2_qkv_gpu6 -> layer2_attn_gpu6
	layer2_attn_gpu6 -> layer2_attn_proj_gpu6
	layer2_attn_proj_gpu6 -> layer2_attn_allreduce
	layer2_attn_allreduce -> layer2_attn_norm_gpu6
	layer2_attn_norm_gpu6 -> layer2_gate_gpu6
	layer2_gate_gpu6 -> layer2_expert6_0 [style=dashed]
	layer2_gate_gpu6 -> layer2_expert6_1 [style=dashed]
	layer2_gate_gpu6 -> layer2_expert6_2 [style=dashed]
	layer2_gate_gpu6 -> layer2_expert6_3 [style=dashed]
	layer2_gate_gpu6 -> layer2_expert6_4 [style=dashed]
	layer2_gate_gpu6 -> layer2_expert6_5 [style=dashed]
	layer2_gate_gpu6 -> layer2_expert6_6 [style=dashed]
	layer2_gate_gpu6 -> layer2_expert6_7 [style=dashed]
	layer2_gate_gpu6 -> layer2_expert6_8 [style=dashed]
	layer2_gate_gpu6 -> layer2_expert6_9 [style=dashed]
	layer2_gate_gpu6 -> layer2_expert6_10 [style=dashed]
	layer2_gate_gpu6 -> layer2_expert6_11 [style=dashed]
	layer2_gate_gpu6 -> layer2_expert6_12 [style=dashed]
	layer2_gate_gpu6 -> layer2_expert6_13 [style=dashed]
	layer2_gate_gpu6 -> layer2_expert6_14 [style=dashed]
	layer2_gate_gpu6 -> layer2_expert6_15 [style=dashed]
	layer2_expert6_0 -> layer2_moe_agg_gpu6
	layer2_expert6_1 -> layer2_moe_agg_gpu6
	layer2_expert6_2 -> layer2_moe_agg_gpu6
	layer2_expert6_3 -> layer2_moe_agg_gpu6
	layer2_expert6_4 -> layer2_moe_agg_gpu6
	layer2_expert6_5 -> layer2_moe_agg_gpu6
	layer2_expert6_6 -> layer2_moe_agg_gpu6
	layer2_expert6_7 -> layer2_moe_agg_gpu6
	layer2_expert6_8 -> layer2_moe_agg_gpu6
	layer2_expert6_9 -> layer2_moe_agg_gpu6
	layer2_expert6_10 -> layer2_moe_agg_gpu6
	layer2_expert6_11 -> layer2_moe_agg_gpu6
	layer2_expert6_12 -> layer2_moe_agg_gpu6
	layer2_expert6_13 -> layer2_moe_agg_gpu6
	layer2_expert6_14 -> layer2_moe_agg_gpu6
	layer2_expert6_15 -> layer2_moe_agg_gpu6
	layer2_moe_agg_gpu6 -> layer2_moe_allreduce
	layer2_moe_allreduce -> layer2_output_gpu6
	layer2_qkv_gpu7 -> layer2_attn_gpu7
	layer2_attn_gpu7 -> layer2_attn_proj_gpu7
	layer2_attn_proj_gpu7 -> layer2_attn_allreduce
	layer2_attn_allreduce -> layer2_attn_norm_gpu7
	layer2_attn_norm_gpu7 -> layer2_gate_gpu7
	layer2_gate_gpu7 -> layer2_expert7_0 [style=dashed]
	layer2_gate_gpu7 -> layer2_expert7_1 [style=dashed]
	layer2_gate_gpu7 -> layer2_expert7_2 [style=dashed]
	layer2_gate_gpu7 -> layer2_expert7_3 [style=dashed]
	layer2_gate_gpu7 -> layer2_expert7_4 [style=dashed]
	layer2_gate_gpu7 -> layer2_expert7_5 [style=dashed]
	layer2_gate_gpu7 -> layer2_expert7_6 [style=dashed]
	layer2_gate_gpu7 -> layer2_expert7_7 [style=dashed]
	layer2_gate_gpu7 -> layer2_expert7_8 [style=dashed]
	layer2_gate_gpu7 -> layer2_expert7_9 [style=dashed]
	layer2_gate_gpu7 -> layer2_expert7_10 [style=dashed]
	layer2_gate_gpu7 -> layer2_expert7_11 [style=dashed]
	layer2_gate_gpu7 -> layer2_expert7_12 [style=dashed]
	layer2_gate_gpu7 -> layer2_expert7_13 [style=dashed]
	layer2_gate_gpu7 -> layer2_expert7_14 [style=dashed]
	layer2_gate_gpu7 -> layer2_expert7_15 [style=dashed]
	layer2_expert7_0 -> layer2_moe_agg_gpu7
	layer2_expert7_1 -> layer2_moe_agg_gpu7
	layer2_expert7_2 -> layer2_moe_agg_gpu7
	layer2_expert7_3 -> layer2_moe_agg_gpu7
	layer2_expert7_4 -> layer2_moe_agg_gpu7
	layer2_expert7_5 -> layer2_moe_agg_gpu7
	layer2_expert7_6 -> layer2_moe_agg_gpu7
	layer2_expert7_7 -> layer2_moe_agg_gpu7
	layer2_expert7_8 -> layer2_moe_agg_gpu7
	layer2_expert7_9 -> layer2_moe_agg_gpu7
	layer2_expert7_10 -> layer2_moe_agg_gpu7
	layer2_expert7_11 -> layer2_moe_agg_gpu7
	layer2_expert7_12 -> layer2_moe_agg_gpu7
	layer2_expert7_13 -> layer2_moe_agg_gpu7
	layer2_expert7_14 -> layer2_moe_agg_gpu7
	layer2_expert7_15 -> layer2_moe_agg_gpu7
	layer2_moe_agg_gpu7 -> layer2_moe_allreduce
	layer2_moe_allreduce -> layer2_output_gpu7
	layer2_output_gpu0 -> layer3_qkv_gpu0
	layer2_output_gpu1 -> layer3_qkv_gpu1
	layer2_output_gpu2 -> layer3_qkv_gpu2
	layer2_output_gpu3 -> layer3_qkv_gpu3
	layer2_output_gpu4 -> layer3_qkv_gpu4
	layer2_output_gpu5 -> layer3_qkv_gpu5
	layer2_output_gpu6 -> layer3_qkv_gpu6
	layer2_output_gpu7 -> layer3_qkv_gpu7
	layer3_qkv_gpu0 -> layer3_attn_gpu0
	layer3_attn_gpu0 -> layer3_attn_proj_gpu0
	layer3_attn_proj_gpu0 -> layer3_attn_allreduce
	layer3_attn_allreduce -> layer3_attn_norm_gpu0
	layer3_attn_norm_gpu0 -> layer3_gate_gpu0
	layer3_gate_gpu0 -> layer3_expert0_0 [style=dashed]
	layer3_gate_gpu0 -> layer3_expert0_1 [style=dashed]
	layer3_gate_gpu0 -> layer3_expert0_2 [style=dashed]
	layer3_gate_gpu0 -> layer3_expert0_3 [style=dashed]
	layer3_gate_gpu0 -> layer3_expert0_4 [style=dashed]
	layer3_gate_gpu0 -> layer3_expert0_5 [style=dashed]
	layer3_gate_gpu0 -> layer3_expert0_6 [style=dashed]
	layer3_gate_gpu0 -> layer3_expert0_7 [style=dashed]
	layer3_gate_gpu0 -> layer3_expert0_8 [style=dashed]
	layer3_gate_gpu0 -> layer3_expert0_9 [style=dashed]
	layer3_gate_gpu0 -> layer3_expert0_10 [style=dashed]
	layer3_gate_gpu0 -> layer3_expert0_11 [style=dashed]
	layer3_gate_gpu0 -> layer3_expert0_12 [style=dashed]
	layer3_gate_gpu0 -> layer3_expert0_13 [style=dashed]
	layer3_gate_gpu0 -> layer3_expert0_14 [style=dashed]
	layer3_gate_gpu0 -> layer3_expert0_15 [style=dashed]
	layer3_expert0_0 -> layer3_moe_agg_gpu0
	layer3_expert0_1 -> layer3_moe_agg_gpu0
	layer3_expert0_2 -> layer3_moe_agg_gpu0
	layer3_expert0_3 -> layer3_moe_agg_gpu0
	layer3_expert0_4 -> layer3_moe_agg_gpu0
	layer3_expert0_5 -> layer3_moe_agg_gpu0
	layer3_expert0_6 -> layer3_moe_agg_gpu0
	layer3_expert0_7 -> layer3_moe_agg_gpu0
	layer3_expert0_8 -> layer3_moe_agg_gpu0
	layer3_expert0_9 -> layer3_moe_agg_gpu0
	layer3_expert0_10 -> layer3_moe_agg_gpu0
	layer3_expert0_11 -> layer3_moe_agg_gpu0
	layer3_expert0_12 -> layer3_moe_agg_gpu0
	layer3_expert0_13 -> layer3_moe_agg_gpu0
	layer3_expert0_14 -> layer3_moe_agg_gpu0
	layer3_expert0_15 -> layer3_moe_agg_gpu0
	layer3_moe_agg_gpu0 -> layer3_moe_allreduce
	layer3_moe_allreduce -> layer3_output_gpu0
	layer3_qkv_gpu1 -> layer3_attn_gpu1
	layer3_attn_gpu1 -> layer3_attn_proj_gpu1
	layer3_attn_proj_gpu1 -> layer3_attn_allreduce
	layer3_attn_allreduce -> layer3_attn_norm_gpu1
	layer3_attn_norm_gpu1 -> layer3_gate_gpu1
	layer3_gate_gpu1 -> layer3_expert1_0 [style=dashed]
	layer3_gate_gpu1 -> layer3_expert1_1 [style=dashed]
	layer3_gate_gpu1 -> layer3_expert1_2 [style=dashed]
	layer3_gate_gpu1 -> layer3_expert1_3 [style=dashed]
	layer3_gate_gpu1 -> layer3_expert1_4 [style=dashed]
	layer3_gate_gpu1 -> layer3_expert1_5 [style=dashed]
	layer3_gate_gpu1 -> layer3_expert1_6 [style=dashed]
	layer3_gate_gpu1 -> layer3_expert1_7 [style=dashed]
	layer3_gate_gpu1 -> layer3_expert1_8 [style=dashed]
	layer3_gate_gpu1 -> layer3_expert1_9 [style=dashed]
	layer3_gate_gpu1 -> layer3_expert1_10 [style=dashed]
	layer3_gate_gpu1 -> layer3_expert1_11 [style=dashed]
	layer3_gate_gpu1 -> layer3_expert1_12 [style=dashed]
	layer3_gate_gpu1 -> layer3_expert1_13 [style=dashed]
	layer3_gate_gpu1 -> layer3_expert1_14 [style=dashed]
	layer3_gate_gpu1 -> layer3_expert1_15 [style=dashed]
	layer3_expert1_0 -> layer3_moe_agg_gpu1
	layer3_expert1_1 -> layer3_moe_agg_gpu1
	layer3_expert1_2 -> layer3_moe_agg_gpu1
	layer3_expert1_3 -> layer3_moe_agg_gpu1
	layer3_expert1_4 -> layer3_moe_agg_gpu1
	layer3_expert1_5 -> layer3_moe_agg_gpu1
	layer3_expert1_6 -> layer3_moe_agg_gpu1
	layer3_expert1_7 -> layer3_moe_agg_gpu1
	layer3_expert1_8 -> layer3_moe_agg_gpu1
	layer3_expert1_9 -> layer3_moe_agg_gpu1
	layer3_expert1_10 -> layer3_moe_agg_gpu1
	layer3_expert1_11 -> layer3_moe_agg_gpu1
	layer3_expert1_12 -> layer3_moe_agg_gpu1
	layer3_expert1_13 -> layer3_moe_agg_gpu1
	layer3_expert1_14 -> layer3_moe_agg_gpu1
	layer3_expert1_15 -> layer3_moe_agg_gpu1
	layer3_moe_agg_gpu1 -> layer3_moe_allreduce
	layer3_moe_allreduce -> layer3_output_gpu1
	layer3_qkv_gpu2 -> layer3_attn_gpu2
	layer3_attn_gpu2 -> layer3_attn_proj_gpu2
	layer3_attn_proj_gpu2 -> layer3_attn_allreduce
	layer3_attn_allreduce -> layer3_attn_norm_gpu2
	layer3_attn_norm_gpu2 -> layer3_gate_gpu2
	layer3_gate_gpu2 -> layer3_expert2_0 [style=dashed]
	layer3_gate_gpu2 -> layer3_expert2_1 [style=dashed]
	layer3_gate_gpu2 -> layer3_expert2_2 [style=dashed]
	layer3_gate_gpu2 -> layer3_expert2_3 [style=dashed]
	layer3_gate_gpu2 -> layer3_expert2_4 [style=dashed]
	layer3_gate_gpu2 -> layer3_expert2_5 [style=dashed]
	layer3_gate_gpu2 -> layer3_expert2_6 [style=dashed]
	layer3_gate_gpu2 -> layer3_expert2_7 [style=dashed]
	layer3_gate_gpu2 -> layer3_expert2_8 [style=dashed]
	layer3_gate_gpu2 -> layer3_expert2_9 [style=dashed]
	layer3_gate_gpu2 -> layer3_expert2_10 [style=dashed]
	layer3_gate_gpu2 -> layer3_expert2_11 [style=dashed]
	layer3_gate_gpu2 -> layer3_expert2_12 [style=dashed]
	layer3_gate_gpu2 -> layer3_expert2_13 [style=dashed]
	layer3_gate_gpu2 -> layer3_expert2_14 [style=dashed]
	layer3_gate_gpu2 -> layer3_expert2_15 [style=dashed]
	layer3_expert2_0 -> layer3_moe_agg_gpu2
	layer3_expert2_1 -> layer3_moe_agg_gpu2
	layer3_expert2_2 -> layer3_moe_agg_gpu2
	layer3_expert2_3 -> layer3_moe_agg_gpu2
	layer3_expert2_4 -> layer3_moe_agg_gpu2
	layer3_expert2_5 -> layer3_moe_agg_gpu2
	layer3_expert2_6 -> layer3_moe_agg_gpu2
	layer3_expert2_7 -> layer3_moe_agg_gpu2
	layer3_expert2_8 -> layer3_moe_agg_gpu2
	layer3_expert2_9 -> layer3_moe_agg_gpu2
	layer3_expert2_10 -> layer3_moe_agg_gpu2
	layer3_expert2_11 -> layer3_moe_agg_gpu2
	layer3_expert2_12 -> layer3_moe_agg_gpu2
	layer3_expert2_13 -> layer3_moe_agg_gpu2
	layer3_expert2_14 -> layer3_moe_agg_gpu2
	layer3_expert2_15 -> layer3_moe_agg_gpu2
	layer3_moe_agg_gpu2 -> layer3_moe_allreduce
	layer3_moe_allreduce -> layer3_output_gpu2
	layer3_qkv_gpu3 -> layer3_attn_gpu3
	layer3_attn_gpu3 -> layer3_attn_proj_gpu3
	layer3_attn_proj_gpu3 -> layer3_attn_allreduce
	layer3_attn_allreduce -> layer3_attn_norm_gpu3
	layer3_attn_norm_gpu3 -> layer3_gate_gpu3
	layer3_gate_gpu3 -> layer3_expert3_0 [style=dashed]
	layer3_gate_gpu3 -> layer3_expert3_1 [style=dashed]
	layer3_gate_gpu3 -> layer3_expert3_2 [style=dashed]
	layer3_gate_gpu3 -> layer3_expert3_3 [style=dashed]
	layer3_gate_gpu3 -> layer3_expert3_4 [style=dashed]
	layer3_gate_gpu3 -> layer3_expert3_5 [style=dashed]
	layer3_gate_gpu3 -> layer3_expert3_6 [style=dashed]
	layer3_gate_gpu3 -> layer3_expert3_7 [style=dashed]
	layer3_gate_gpu3 -> layer3_expert3_8 [style=dashed]
	layer3_gate_gpu3 -> layer3_expert3_9 [style=dashed]
	layer3_gate_gpu3 -> layer3_expert3_10 [style=dashed]
	layer3_gate_gpu3 -> layer3_expert3_11 [style=dashed]
	layer3_gate_gpu3 -> layer3_expert3_12 [style=dashed]
	layer3_gate_gpu3 -> layer3_expert3_13 [style=dashed]
	layer3_gate_gpu3 -> layer3_expert3_14 [style=dashed]
	layer3_gate_gpu3 -> layer3_expert3_15 [style=dashed]
	layer3_expert3_0 -> layer3_moe_agg_gpu3
	layer3_expert3_1 -> layer3_moe_agg_gpu3
	layer3_expert3_2 -> layer3_moe_agg_gpu3
	layer3_expert3_3 -> layer3_moe_agg_gpu3
	layer3_expert3_4 -> layer3_moe_agg_gpu3
	layer3_expert3_5 -> layer3_moe_agg_gpu3
	layer3_expert3_6 -> layer3_moe_agg_gpu3
	layer3_expert3_7 -> layer3_moe_agg_gpu3
	layer3_expert3_8 -> layer3_moe_agg_gpu3
	layer3_expert3_9 -> layer3_moe_agg_gpu3
	layer3_expert3_10 -> layer3_moe_agg_gpu3
	layer3_expert3_11 -> layer3_moe_agg_gpu3
	layer3_expert3_12 -> layer3_moe_agg_gpu3
	layer3_expert3_13 -> layer3_moe_agg_gpu3
	layer3_expert3_14 -> layer3_moe_agg_gpu3
	layer3_expert3_15 -> layer3_moe_agg_gpu3
	layer3_moe_agg_gpu3 -> layer3_moe_allreduce
	layer3_moe_allreduce -> layer3_output_gpu3
	layer3_qkv_gpu4 -> layer3_attn_gpu4
	layer3_attn_gpu4 -> layer3_attn_proj_gpu4
	layer3_attn_proj_gpu4 -> layer3_attn_allreduce
	layer3_attn_allreduce -> layer3_attn_norm_gpu4
	layer3_attn_norm_gpu4 -> layer3_gate_gpu4
	layer3_gate_gpu4 -> layer3_expert4_0 [style=dashed]
	layer3_gate_gpu4 -> layer3_expert4_1 [style=dashed]
	layer3_gate_gpu4 -> layer3_expert4_2 [style=dashed]
	layer3_gate_gpu4 -> layer3_expert4_3 [style=dashed]
	layer3_gate_gpu4 -> layer3_expert4_4 [style=dashed]
	layer3_gate_gpu4 -> layer3_expert4_5 [style=dashed]
	layer3_gate_gpu4 -> layer3_expert4_6 [style=dashed]
	layer3_gate_gpu4 -> layer3_expert4_7 [style=dashed]
	layer3_gate_gpu4 -> layer3_expert4_8 [style=dashed]
	layer3_gate_gpu4 -> layer3_expert4_9 [style=dashed]
	layer3_gate_gpu4 -> layer3_expert4_10 [style=dashed]
	layer3_gate_gpu4 -> layer3_expert4_11 [style=dashed]
	layer3_gate_gpu4 -> layer3_expert4_12 [style=dashed]
	layer3_gate_gpu4 -> layer3_expert4_13 [style=dashed]
	layer3_gate_gpu4 -> layer3_expert4_14 [style=dashed]
	layer3_gate_gpu4 -> layer3_expert4_15 [style=dashed]
	layer3_expert4_0 -> layer3_moe_agg_gpu4
	layer3_expert4_1 -> layer3_moe_agg_gpu4
	layer3_expert4_2 -> layer3_moe_agg_gpu4
	layer3_expert4_3 -> layer3_moe_agg_gpu4
	layer3_expert4_4 -> layer3_moe_agg_gpu4
	layer3_expert4_5 -> layer3_moe_agg_gpu4
	layer3_expert4_6 -> layer3_moe_agg_gpu4
	layer3_expert4_7 -> layer3_moe_agg_gpu4
	layer3_expert4_8 -> layer3_moe_agg_gpu4
	layer3_expert4_9 -> layer3_moe_agg_gpu4
	layer3_expert4_10 -> layer3_moe_agg_gpu4
	layer3_expert4_11 -> layer3_moe_agg_gpu4
	layer3_expert4_12 -> layer3_moe_agg_gpu4
	layer3_expert4_13 -> layer3_moe_agg_gpu4
	layer3_expert4_14 -> layer3_moe_agg_gpu4
	layer3_expert4_15 -> layer3_moe_agg_gpu4
	layer3_moe_agg_gpu4 -> layer3_moe_allreduce
	layer3_moe_allreduce -> layer3_output_gpu4
	layer3_qkv_gpu5 -> layer3_attn_gpu5
	layer3_attn_gpu5 -> layer3_attn_proj_gpu5
	layer3_attn_proj_gpu5 -> layer3_attn_allreduce
	layer3_attn_allreduce -> layer3_attn_norm_gpu5
	layer3_attn_norm_gpu5 -> layer3_gate_gpu5
	layer3_gate_gpu5 -> layer3_expert5_0 [style=dashed]
	layer3_gate_gpu5 -> layer3_expert5_1 [style=dashed]
	layer3_gate_gpu5 -> layer3_expert5_2 [style=dashed]
	layer3_gate_gpu5 -> layer3_expert5_3 [style=dashed]
	layer3_gate_gpu5 -> layer3_expert5_4 [style=dashed]
	layer3_gate_gpu5 -> layer3_expert5_5 [style=dashed]
	layer3_gate_gpu5 -> layer3_expert5_6 [style=dashed]
	layer3_gate_gpu5 -> layer3_expert5_7 [style=dashed]
	layer3_gate_gpu5 -> layer3_expert5_8 [style=dashed]
	layer3_gate_gpu5 -> layer3_expert5_9 [style=dashed]
	layer3_gate_gpu5 -> layer3_expert5_10 [style=dashed]
	layer3_gate_gpu5 -> layer3_expert5_11 [style=dashed]
	layer3_gate_gpu5 -> layer3_expert5_12 [style=dashed]
	layer3_gate_gpu5 -> layer3_expert5_13 [style=dashed]
	layer3_gate_gpu5 -> layer3_expert5_14 [style=dashed]
	layer3_gate_gpu5 -> layer3_expert5_15 [style=dashed]
	layer3_expert5_0 -> layer3_moe_agg_gpu5
	layer3_expert5_1 -> layer3_moe_agg_gpu5
	layer3_expert5_2 -> layer3_moe_agg_gpu5
	layer3_expert5_3 -> layer3_moe_agg_gpu5
	layer3_expert5_4 -> layer3_moe_agg_gpu5
	layer3_expert5_5 -> layer3_moe_agg_gpu5
	layer3_expert5_6 -> layer3_moe_agg_gpu5
	layer3_expert5_7 -> layer3_moe_agg_gpu5
	layer3_expert5_8 -> layer3_moe_agg_gpu5
	layer3_expert5_9 -> layer3_moe_agg_gpu5
	layer3_expert5_10 -> layer3_moe_agg_gpu5
	layer3_expert5_11 -> layer3_moe_agg_gpu5
	layer3_expert5_12 -> layer3_moe_agg_gpu5
	layer3_expert5_13 -> layer3_moe_agg_gpu5
	layer3_expert5_14 -> layer3_moe_agg_gpu5
	layer3_expert5_15 -> layer3_moe_agg_gpu5
	layer3_moe_agg_gpu5 -> layer3_moe_allreduce
	layer3_moe_allreduce -> layer3_output_gpu5
	layer3_qkv_gpu6 -> layer3_attn_gpu6
	layer3_attn_gpu6 -> layer3_attn_proj_gpu6
	layer3_attn_proj_gpu6 -> layer3_attn_allreduce
	layer3_attn_allreduce -> layer3_attn_norm_gpu6
	layer3_attn_norm_gpu6 -> layer3_gate_gpu6
	layer3_gate_gpu6 -> layer3_expert6_0 [style=dashed]
	layer3_gate_gpu6 -> layer3_expert6_1 [style=dashed]
	layer3_gate_gpu6 -> layer3_expert6_2 [style=dashed]
	layer3_gate_gpu6 -> layer3_expert6_3 [style=dashed]
	layer3_gate_gpu6 -> layer3_expert6_4 [style=dashed]
	layer3_gate_gpu6 -> layer3_expert6_5 [style=dashed]
	layer3_gate_gpu6 -> layer3_expert6_6 [style=dashed]
	layer3_gate_gpu6 -> layer3_expert6_7 [style=dashed]
	layer3_gate_gpu6 -> layer3_expert6_8 [style=dashed]
	layer3_gate_gpu6 -> layer3_expert6_9 [style=dashed]
	layer3_gate_gpu6 -> layer3_expert6_10 [style=dashed]
	layer3_gate_gpu6 -> layer3_expert6_11 [style=dashed]
	layer3_gate_gpu6 -> layer3_expert6_12 [style=dashed]
	layer3_gate_gpu6 -> layer3_expert6_13 [style=dashed]
	layer3_gate_gpu6 -> layer3_expert6_14 [style=dashed]
	layer3_gate_gpu6 -> layer3_expert6_15 [style=dashed]
	layer3_expert6_0 -> layer3_moe_agg_gpu6
	layer3_expert6_1 -> layer3_moe_agg_gpu6
	layer3_expert6_2 -> layer3_moe_agg_gpu6
	layer3_expert6_3 -> layer3_moe_agg_gpu6
	layer3_expert6_4 -> layer3_moe_agg_gpu6
	layer3_expert6_5 -> layer3_moe_agg_gpu6
	layer3_expert6_6 -> layer3_moe_agg_gpu6
	layer3_expert6_7 -> layer3_moe_agg_gpu6
	layer3_expert6_8 -> layer3_moe_agg_gpu6
	layer3_expert6_9 -> layer3_moe_agg_gpu6
	layer3_expert6_10 -> layer3_moe_agg_gpu6
	layer3_expert6_11 -> layer3_moe_agg_gpu6
	layer3_expert6_12 -> layer3_moe_agg_gpu6
	layer3_expert6_13 -> layer3_moe_agg_gpu6
	layer3_expert6_14 -> layer3_moe_agg_gpu6
	layer3_expert6_15 -> layer3_moe_agg_gpu6
	layer3_moe_agg_gpu6 -> layer3_moe_allreduce
	layer3_moe_allreduce -> layer3_output_gpu6
	layer3_qkv_gpu7 -> layer3_attn_gpu7
	layer3_attn_gpu7 -> layer3_attn_proj_gpu7
	layer3_attn_proj_gpu7 -> layer3_attn_allreduce
	layer3_attn_allreduce -> layer3_attn_norm_gpu7
	layer3_attn_norm_gpu7 -> layer3_gate_gpu7
	layer3_gate_gpu7 -> layer3_expert7_0 [style=dashed]
	layer3_gate_gpu7 -> layer3_expert7_1 [style=dashed]
	layer3_gate_gpu7 -> layer3_expert7_2 [style=dashed]
	layer3_gate_gpu7 -> layer3_expert7_3 [style=dashed]
	layer3_gate_gpu7 -> layer3_expert7_4 [style=dashed]
	layer3_gate_gpu7 -> layer3_expert7_5 [style=dashed]
	layer3_gate_gpu7 -> layer3_expert7_6 [style=dashed]
	layer3_gate_gpu7 -> layer3_expert7_7 [style=dashed]
	layer3_gate_gpu7 -> layer3_expert7_8 [style=dashed]
	layer3_gate_gpu7 -> layer3_expert7_9 [style=dashed]
	layer3_gate_gpu7 -> layer3_expert7_10 [style=dashed]
	layer3_gate_gpu7 -> layer3_expert7_11 [style=dashed]
	layer3_gate_gpu7 -> layer3_expert7_12 [style=dashed]
	layer3_gate_gpu7 -> layer3_expert7_13 [style=dashed]
	layer3_gate_gpu7 -> layer3_expert7_14 [style=dashed]
	layer3_gate_gpu7 -> layer3_expert7_15 [style=dashed]
	layer3_expert7_0 -> layer3_moe_agg_gpu7
	layer3_expert7_1 -> layer3_moe_agg_gpu7
	layer3_expert7_2 -> layer3_moe_agg_gpu7
	layer3_expert7_3 -> layer3_moe_agg_gpu7
	layer3_expert7_4 -> layer3_moe_agg_gpu7
	layer3_expert7_5 -> layer3_moe_agg_gpu7
	layer3_expert7_6 -> layer3_moe_agg_gpu7
	layer3_expert7_7 -> layer3_moe_agg_gpu7
	layer3_expert7_8 -> layer3_moe_agg_gpu7
	layer3_expert7_9 -> layer3_moe_agg_gpu7
	layer3_expert7_10 -> layer3_moe_agg_gpu7
	layer3_expert7_11 -> layer3_moe_agg_gpu7
	layer3_expert7_12 -> layer3_moe_agg_gpu7
	layer3_expert7_13 -> layer3_moe_agg_gpu7
	layer3_expert7_14 -> layer3_moe_agg_gpu7
	layer3_expert7_15 -> layer3_moe_agg_gpu7
	layer3_moe_agg_gpu7 -> layer3_moe_allreduce
	layer3_moe_allreduce -> layer3_output_gpu7
	layer3_output_gpu0 -> output
	layer3_output_gpu1 -> output
	layer3_output_gpu2 -> output
	layer3_output_gpu3 -> output
	layer3_output_gpu4 -> output
	layer3_output_gpu5 -> output
	layer3_output_gpu6 -> output
	layer3_output_gpu7 -> output
}
