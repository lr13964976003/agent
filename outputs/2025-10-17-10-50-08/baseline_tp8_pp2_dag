// Baseline: Tensor Parallelism 8 + Pipeline Parallelism 2
digraph TP8_PP2_Baseline {
	rankdir=TB size="30,20"
	node [fillcolor=lightblue shape=ellipse style=filled]
	node [fillcolor=lightgreen shape=rectangle style=filled]
	node [fillcolor=yellow shape=parallelogram style=filled]
	node [fillcolor=lightcoral shape=diamond style=filled]
	label="Baseline: TP=8, PP=2 Hybrid
16 GPUs total
Tensor Parallelism 8 per stage, Pipeline 2 stages"
	fontsize=20
	input [label="INPUT
Input: [batch_size=1024, seq_len=2048, hidden=4096]
GPU: 0-7" fillcolor=lightblue shape=ellipse]
	stage0_header [label="Stage 0 (GPUs 0-7)
Layers 0-1" fillcolor=lightblue peripheries=2 shape=ellipse]
	layer0_qkv_gpu0 [label="L0_QKV_Projection_GPU0
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 0-3
TP Slice: 0
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_attn_gpu0 [label="L0_Multi-Head_Attention_GPU0
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_attn_proj_gpu0 [label="L0_Attn_Projection_GPU0
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_attn_norm_gpu0 [label="L0_Residual+LayerNorm_GPU0
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_gate_gpu0 [label="L0_Gate_GPU0
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_0 [label="L0_Expert0_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_1 [label="L0_Expert1_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_2 [label="L0_Expert2_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_3 [label="L0_Expert3_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_4 [label="L0_Expert4_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_5 [label="L0_Expert5_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_6 [label="L0_Expert6_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_7 [label="L0_Expert7_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_8 [label="L0_Expert8_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_9 [label="L0_Expert9_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_10 [label="L0_Expert10_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_11 [label="L0_Expert11_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_12 [label="L0_Expert12_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_13 [label="L0_Expert13_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_14 [label="L0_Expert14_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_expert0_15 [label="L0_Expert15_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_moe_agg_gpu0 [label="L0_MoE_Aggregate_GPU0
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_output_gpu0 [label="L0_Residual+LayerNorm_GPU0
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer0_qkv_gpu1 [label="L0_QKV_Projection_GPU1
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 4-7
TP Slice: 1
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_attn_gpu1 [label="L0_Multi-Head_Attention_GPU1
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_attn_proj_gpu1 [label="L0_Attn_Projection_GPU1
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_attn_norm_gpu1 [label="L0_Residual+LayerNorm_GPU1
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_gate_gpu1 [label="L0_Gate_GPU1
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_0 [label="L0_Expert0_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_1 [label="L0_Expert1_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_2 [label="L0_Expert2_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_3 [label="L0_Expert3_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_4 [label="L0_Expert4_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_5 [label="L0_Expert5_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_6 [label="L0_Expert6_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_7 [label="L0_Expert7_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_8 [label="L0_Expert8_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_9 [label="L0_Expert9_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_10 [label="L0_Expert10_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_11 [label="L0_Expert11_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_12 [label="L0_Expert12_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_13 [label="L0_Expert13_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_14 [label="L0_Expert14_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_expert1_15 [label="L0_Expert15_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_moe_agg_gpu1 [label="L0_MoE_Aggregate_GPU1
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_output_gpu1 [label="L0_Residual+LayerNorm_GPU1
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer0_qkv_gpu2 [label="L0_QKV_Projection_GPU2
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 8-11
TP Slice: 2
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_attn_gpu2 [label="L0_Multi-Head_Attention_GPU2
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_attn_proj_gpu2 [label="L0_Attn_Projection_GPU2
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_attn_norm_gpu2 [label="L0_Residual+LayerNorm_GPU2
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_gate_gpu2 [label="L0_Gate_GPU2
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_0 [label="L0_Expert0_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_1 [label="L0_Expert1_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_2 [label="L0_Expert2_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_3 [label="L0_Expert3_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_4 [label="L0_Expert4_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_5 [label="L0_Expert5_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_6 [label="L0_Expert6_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_7 [label="L0_Expert7_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_8 [label="L0_Expert8_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_9 [label="L0_Expert9_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_10 [label="L0_Expert10_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_11 [label="L0_Expert11_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_12 [label="L0_Expert12_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_13 [label="L0_Expert13_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_14 [label="L0_Expert14_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_expert2_15 [label="L0_Expert15_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_moe_agg_gpu2 [label="L0_MoE_Aggregate_GPU2
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_output_gpu2 [label="L0_Residual+LayerNorm_GPU2
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer0_qkv_gpu3 [label="L0_QKV_Projection_GPU3
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 12-15
TP Slice: 3
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_attn_gpu3 [label="L0_Multi-Head_Attention_GPU3
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_attn_proj_gpu3 [label="L0_Attn_Projection_GPU3
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_attn_norm_gpu3 [label="L0_Residual+LayerNorm_GPU3
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_gate_gpu3 [label="L0_Gate_GPU3
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_0 [label="L0_Expert0_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_1 [label="L0_Expert1_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_2 [label="L0_Expert2_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_3 [label="L0_Expert3_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_4 [label="L0_Expert4_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_5 [label="L0_Expert5_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_6 [label="L0_Expert6_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_7 [label="L0_Expert7_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_8 [label="L0_Expert8_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_9 [label="L0_Expert9_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_10 [label="L0_Expert10_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_11 [label="L0_Expert11_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_12 [label="L0_Expert12_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_13 [label="L0_Expert13_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_14 [label="L0_Expert14_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_expert3_15 [label="L0_Expert15_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_moe_agg_gpu3 [label="L0_MoE_Aggregate_GPU3
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_output_gpu3 [label="L0_Residual+LayerNorm_GPU3
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer0_qkv_gpu4 [label="L0_QKV_Projection_GPU4
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 16-19
TP Slice: 4
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_attn_gpu4 [label="L0_Multi-Head_Attention_GPU4
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_attn_proj_gpu4 [label="L0_Attn_Projection_GPU4
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_attn_norm_gpu4 [label="L0_Residual+LayerNorm_GPU4
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_gate_gpu4 [label="L0_Gate_GPU4
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_0 [label="L0_Expert0_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_1 [label="L0_Expert1_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_2 [label="L0_Expert2_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_3 [label="L0_Expert3_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_4 [label="L0_Expert4_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_5 [label="L0_Expert5_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_6 [label="L0_Expert6_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_7 [label="L0_Expert7_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_8 [label="L0_Expert8_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_9 [label="L0_Expert9_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_10 [label="L0_Expert10_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_11 [label="L0_Expert11_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_12 [label="L0_Expert12_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_13 [label="L0_Expert13_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_14 [label="L0_Expert14_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_expert4_15 [label="L0_Expert15_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_moe_agg_gpu4 [label="L0_MoE_Aggregate_GPU4
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_output_gpu4 [label="L0_Residual+LayerNorm_GPU4
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer0_qkv_gpu5 [label="L0_QKV_Projection_GPU5
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 20-23
TP Slice: 5
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_attn_gpu5 [label="L0_Multi-Head_Attention_GPU5
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_attn_proj_gpu5 [label="L0_Attn_Projection_GPU5
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_attn_norm_gpu5 [label="L0_Residual+LayerNorm_GPU5
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_gate_gpu5 [label="L0_Gate_GPU5
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_0 [label="L0_Expert0_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_1 [label="L0_Expert1_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_2 [label="L0_Expert2_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_3 [label="L0_Expert3_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_4 [label="L0_Expert4_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_5 [label="L0_Expert5_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_6 [label="L0_Expert6_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_7 [label="L0_Expert7_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_8 [label="L0_Expert8_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_9 [label="L0_Expert9_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_10 [label="L0_Expert10_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_11 [label="L0_Expert11_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_12 [label="L0_Expert12_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_13 [label="L0_Expert13_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_14 [label="L0_Expert14_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_expert5_15 [label="L0_Expert15_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_moe_agg_gpu5 [label="L0_MoE_Aggregate_GPU5
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_output_gpu5 [label="L0_Residual+LayerNorm_GPU5
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer0_qkv_gpu6 [label="L0_QKV_Projection_GPU6
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 24-27
TP Slice: 6
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_attn_gpu6 [label="L0_Multi-Head_Attention_GPU6
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_attn_proj_gpu6 [label="L0_Attn_Projection_GPU6
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_attn_norm_gpu6 [label="L0_Residual+LayerNorm_GPU6
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_gate_gpu6 [label="L0_Gate_GPU6
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_0 [label="L0_Expert0_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_1 [label="L0_Expert1_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_2 [label="L0_Expert2_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_3 [label="L0_Expert3_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_4 [label="L0_Expert4_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_5 [label="L0_Expert5_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_6 [label="L0_Expert6_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_7 [label="L0_Expert7_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_8 [label="L0_Expert8_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_9 [label="L0_Expert9_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_10 [label="L0_Expert10_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_11 [label="L0_Expert11_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_12 [label="L0_Expert12_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_13 [label="L0_Expert13_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_14 [label="L0_Expert14_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_expert6_15 [label="L0_Expert15_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_moe_agg_gpu6 [label="L0_MoE_Aggregate_GPU6
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_output_gpu6 [label="L0_Residual+LayerNorm_GPU6
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer0_qkv_gpu7 [label="L0_QKV_Projection_GPU7
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 28-31
TP Slice: 7
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_attn_gpu7 [label="L0_Multi-Head_Attention_GPU7
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_attn_proj_gpu7 [label="L0_Attn_Projection_GPU7
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_attn_norm_gpu7 [label="L0_Residual+LayerNorm_GPU7
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_gate_gpu7 [label="L0_Gate_GPU7
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_0 [label="L0_Expert0_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_1 [label="L0_Expert1_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_2 [label="L0_Expert2_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_3 [label="L0_Expert3_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_4 [label="L0_Expert4_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_5 [label="L0_Expert5_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_6 [label="L0_Expert6_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_7 [label="L0_Expert7_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_8 [label="L0_Expert8_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_9 [label="L0_Expert9_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_10 [label="L0_Expert10_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_11 [label="L0_Expert11_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_12 [label="L0_Expert12_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_13 [label="L0_Expert13_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_14 [label="L0_Expert14_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_expert7_15 [label="L0_Expert15_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_moe_agg_gpu7 [label="L0_MoE_Aggregate_GPU7
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_output_gpu7 [label="L0_Residual+LayerNorm_GPU7
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer0_allreduce_attn [label="L0_All-Reduce_Attention
Input: 8×[1024,2048,512]
Output: [1024,2048,4096]
TP All-Reduce" fillcolor=lightcoral shape=diamond]
	layer0_allreduce_moe [label="L0_All-Reduce_MoE
Input: 8×[1024,2048,512]
Output: [1024,2048,4096]
TP All-Reduce" fillcolor=lightcoral shape=diamond]
	layer1_qkv_gpu0 [label="L1_QKV_Projection_GPU0
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 0-3
TP Slice: 0
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_attn_gpu0 [label="L1_Multi-Head_Attention_GPU0
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_attn_proj_gpu0 [label="L1_Attn_Projection_GPU0
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_attn_norm_gpu0 [label="L1_Residual+LayerNorm_GPU0
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_gate_gpu0 [label="L1_Gate_GPU0
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_0 [label="L1_Expert0_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_1 [label="L1_Expert1_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_2 [label="L1_Expert2_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_3 [label="L1_Expert3_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_4 [label="L1_Expert4_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_5 [label="L1_Expert5_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_6 [label="L1_Expert6_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_7 [label="L1_Expert7_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_8 [label="L1_Expert8_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_9 [label="L1_Expert9_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_10 [label="L1_Expert10_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_11 [label="L1_Expert11_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_12 [label="L1_Expert12_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_13 [label="L1_Expert13_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_14 [label="L1_Expert14_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_expert0_15 [label="L1_Expert15_GPU0
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_moe_agg_gpu0 [label="L1_MoE_Aggregate_GPU0
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_output_gpu0 [label="L1_Residual+LayerNorm_GPU0
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 0" fillcolor=lightgreen shape=rectangle]
	layer1_qkv_gpu1 [label="L1_QKV_Projection_GPU1
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 4-7
TP Slice: 1
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_attn_gpu1 [label="L1_Multi-Head_Attention_GPU1
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_attn_proj_gpu1 [label="L1_Attn_Projection_GPU1
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_attn_norm_gpu1 [label="L1_Residual+LayerNorm_GPU1
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_gate_gpu1 [label="L1_Gate_GPU1
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_0 [label="L1_Expert0_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_1 [label="L1_Expert1_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_2 [label="L1_Expert2_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_3 [label="L1_Expert3_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_4 [label="L1_Expert4_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_5 [label="L1_Expert5_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_6 [label="L1_Expert6_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_7 [label="L1_Expert7_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_8 [label="L1_Expert8_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_9 [label="L1_Expert9_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_10 [label="L1_Expert10_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_11 [label="L1_Expert11_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_12 [label="L1_Expert12_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_13 [label="L1_Expert13_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_14 [label="L1_Expert14_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_expert1_15 [label="L1_Expert15_GPU1
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_moe_agg_gpu1 [label="L1_MoE_Aggregate_GPU1
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_output_gpu1 [label="L1_Residual+LayerNorm_GPU1
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 1" fillcolor=lightgreen shape=rectangle]
	layer1_qkv_gpu2 [label="L1_QKV_Projection_GPU2
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 8-11
TP Slice: 2
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_attn_gpu2 [label="L1_Multi-Head_Attention_GPU2
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_attn_proj_gpu2 [label="L1_Attn_Projection_GPU2
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_attn_norm_gpu2 [label="L1_Residual+LayerNorm_GPU2
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_gate_gpu2 [label="L1_Gate_GPU2
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_0 [label="L1_Expert0_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_1 [label="L1_Expert1_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_2 [label="L1_Expert2_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_3 [label="L1_Expert3_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_4 [label="L1_Expert4_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_5 [label="L1_Expert5_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_6 [label="L1_Expert6_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_7 [label="L1_Expert7_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_8 [label="L1_Expert8_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_9 [label="L1_Expert9_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_10 [label="L1_Expert10_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_11 [label="L1_Expert11_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_12 [label="L1_Expert12_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_13 [label="L1_Expert13_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_14 [label="L1_Expert14_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_expert2_15 [label="L1_Expert15_GPU2
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_moe_agg_gpu2 [label="L1_MoE_Aggregate_GPU2
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_output_gpu2 [label="L1_Residual+LayerNorm_GPU2
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 2" fillcolor=lightgreen shape=rectangle]
	layer1_qkv_gpu3 [label="L1_QKV_Projection_GPU3
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 12-15
TP Slice: 3
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_attn_gpu3 [label="L1_Multi-Head_Attention_GPU3
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_attn_proj_gpu3 [label="L1_Attn_Projection_GPU3
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_attn_norm_gpu3 [label="L1_Residual+LayerNorm_GPU3
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_gate_gpu3 [label="L1_Gate_GPU3
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_0 [label="L1_Expert0_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_1 [label="L1_Expert1_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_2 [label="L1_Expert2_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_3 [label="L1_Expert3_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_4 [label="L1_Expert4_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_5 [label="L1_Expert5_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_6 [label="L1_Expert6_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_7 [label="L1_Expert7_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_8 [label="L1_Expert8_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_9 [label="L1_Expert9_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_10 [label="L1_Expert10_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_11 [label="L1_Expert11_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_12 [label="L1_Expert12_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_13 [label="L1_Expert13_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_14 [label="L1_Expert14_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_expert3_15 [label="L1_Expert15_GPU3
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_moe_agg_gpu3 [label="L1_MoE_Aggregate_GPU3
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_output_gpu3 [label="L1_Residual+LayerNorm_GPU3
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 3" fillcolor=lightgreen shape=rectangle]
	layer1_qkv_gpu4 [label="L1_QKV_Projection_GPU4
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 16-19
TP Slice: 4
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_attn_gpu4 [label="L1_Multi-Head_Attention_GPU4
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_attn_proj_gpu4 [label="L1_Attn_Projection_GPU4
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_attn_norm_gpu4 [label="L1_Residual+LayerNorm_GPU4
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_gate_gpu4 [label="L1_Gate_GPU4
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_0 [label="L1_Expert0_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_1 [label="L1_Expert1_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_2 [label="L1_Expert2_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_3 [label="L1_Expert3_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_4 [label="L1_Expert4_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_5 [label="L1_Expert5_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_6 [label="L1_Expert6_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_7 [label="L1_Expert7_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_8 [label="L1_Expert8_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_9 [label="L1_Expert9_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_10 [label="L1_Expert10_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_11 [label="L1_Expert11_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_12 [label="L1_Expert12_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_13 [label="L1_Expert13_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_14 [label="L1_Expert14_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_expert4_15 [label="L1_Expert15_GPU4
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_moe_agg_gpu4 [label="L1_MoE_Aggregate_GPU4
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_output_gpu4 [label="L1_Residual+LayerNorm_GPU4
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 4" fillcolor=lightgreen shape=rectangle]
	layer1_qkv_gpu5 [label="L1_QKV_Projection_GPU5
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 20-23
TP Slice: 5
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_attn_gpu5 [label="L1_Multi-Head_Attention_GPU5
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_attn_proj_gpu5 [label="L1_Attn_Projection_GPU5
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_attn_norm_gpu5 [label="L1_Residual+LayerNorm_GPU5
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_gate_gpu5 [label="L1_Gate_GPU5
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_0 [label="L1_Expert0_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_1 [label="L1_Expert1_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_2 [label="L1_Expert2_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_3 [label="L1_Expert3_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_4 [label="L1_Expert4_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_5 [label="L1_Expert5_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_6 [label="L1_Expert6_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_7 [label="L1_Expert7_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_8 [label="L1_Expert8_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_9 [label="L1_Expert9_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_10 [label="L1_Expert10_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_11 [label="L1_Expert11_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_12 [label="L1_Expert12_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_13 [label="L1_Expert13_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_14 [label="L1_Expert14_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_expert5_15 [label="L1_Expert15_GPU5
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_moe_agg_gpu5 [label="L1_MoE_Aggregate_GPU5
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_output_gpu5 [label="L1_Residual+LayerNorm_GPU5
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 5" fillcolor=lightgreen shape=rectangle]
	layer1_qkv_gpu6 [label="L1_QKV_Projection_GPU6
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 24-27
TP Slice: 6
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_attn_gpu6 [label="L1_Multi-Head_Attention_GPU6
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_attn_proj_gpu6 [label="L1_Attn_Projection_GPU6
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_attn_norm_gpu6 [label="L1_Residual+LayerNorm_GPU6
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_gate_gpu6 [label="L1_Gate_GPU6
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_0 [label="L1_Expert0_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_1 [label="L1_Expert1_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_2 [label="L1_Expert2_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_3 [label="L1_Expert3_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_4 [label="L1_Expert4_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_5 [label="L1_Expert5_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_6 [label="L1_Expert6_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_7 [label="L1_Expert7_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_8 [label="L1_Expert8_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_9 [label="L1_Expert9_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_10 [label="L1_Expert10_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_11 [label="L1_Expert11_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_12 [label="L1_Expert12_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_13 [label="L1_Expert13_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_14 [label="L1_Expert14_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_expert6_15 [label="L1_Expert15_GPU6
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_moe_agg_gpu6 [label="L1_MoE_Aggregate_GPU6
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_output_gpu6 [label="L1_Residual+LayerNorm_GPU6
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 6" fillcolor=lightgreen shape=rectangle]
	layer1_qkv_gpu7 [label="L1_QKV_Projection_GPU7
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 28-31
TP Slice: 7
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_attn_gpu7 [label="L1_Multi-Head_Attention_GPU7
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_attn_proj_gpu7 [label="L1_Attn_Projection_GPU7
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_attn_norm_gpu7 [label="L1_Residual+LayerNorm_GPU7
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_gate_gpu7 [label="L1_Gate_GPU7
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_0 [label="L1_Expert0_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_1 [label="L1_Expert1_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_2 [label="L1_Expert2_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_3 [label="L1_Expert3_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_4 [label="L1_Expert4_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_5 [label="L1_Expert5_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_6 [label="L1_Expert6_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_7 [label="L1_Expert7_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_8 [label="L1_Expert8_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_9 [label="L1_Expert9_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_10 [label="L1_Expert10_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_11 [label="L1_Expert11_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_12 [label="L1_Expert12_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_13 [label="L1_Expert13_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_14 [label="L1_Expert14_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_expert7_15 [label="L1_Expert15_GPU7
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_moe_agg_gpu7 [label="L1_MoE_Aggregate_GPU7
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_output_gpu7 [label="L1_Residual+LayerNorm_GPU7
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 7" fillcolor=lightgreen shape=rectangle]
	layer1_allreduce_attn [label="L1_All-Reduce_Attention
Input: 8×[1024,2048,512]
Output: [1024,2048,4096]
TP All-Reduce" fillcolor=lightcoral shape=diamond]
	layer1_allreduce_moe [label="L1_All-Reduce_MoE
Input: 8×[1024,2048,512]
Output: [1024,2048,4096]
TP All-Reduce" fillcolor=lightcoral shape=diamond]
	stage1_header [label="Stage 1 (GPUs 8-15)
Layers 2-3" fillcolor=lightblue peripheries=2 shape=ellipse]
	layer2_qkv_gpu8 [label="L2_QKV_Projection_GPU8
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 0-3
TP Slice: 0
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_attn_gpu8 [label="L2_Multi-Head_Attention_GPU8
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_attn_proj_gpu8 [label="L2_Attn_Projection_GPU8
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_attn_norm_gpu8 [label="L2_Residual+LayerNorm_GPU8
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_gate_gpu8 [label="L2_Gate_GPU8
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_expert8_0 [label="L2_Expert0_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_expert8_1 [label="L2_Expert1_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_expert8_2 [label="L2_Expert2_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_expert8_3 [label="L2_Expert3_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_expert8_4 [label="L2_Expert4_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_expert8_5 [label="L2_Expert5_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_expert8_6 [label="L2_Expert6_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_expert8_7 [label="L2_Expert7_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_expert8_8 [label="L2_Expert8_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_expert8_9 [label="L2_Expert9_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_expert8_10 [label="L2_Expert10_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_expert8_11 [label="L2_Expert11_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_expert8_12 [label="L2_Expert12_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_expert8_13 [label="L2_Expert13_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_expert8_14 [label="L2_Expert14_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_expert8_15 [label="L2_Expert15_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_moe_agg_gpu8 [label="L2_MoE_Aggregate_GPU8
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_output_gpu8 [label="L2_Residual+LayerNorm_GPU8
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer2_qkv_gpu9 [label="L2_QKV_Projection_GPU9
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 4-7
TP Slice: 1
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_attn_gpu9 [label="L2_Multi-Head_Attention_GPU9
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_attn_proj_gpu9 [label="L2_Attn_Projection_GPU9
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_attn_norm_gpu9 [label="L2_Residual+LayerNorm_GPU9
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_gate_gpu9 [label="L2_Gate_GPU9
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_expert9_0 [label="L2_Expert0_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_expert9_1 [label="L2_Expert1_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_expert9_2 [label="L2_Expert2_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_expert9_3 [label="L2_Expert3_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_expert9_4 [label="L2_Expert4_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_expert9_5 [label="L2_Expert5_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_expert9_6 [label="L2_Expert6_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_expert9_7 [label="L2_Expert7_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_expert9_8 [label="L2_Expert8_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_expert9_9 [label="L2_Expert9_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_expert9_10 [label="L2_Expert10_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_expert9_11 [label="L2_Expert11_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_expert9_12 [label="L2_Expert12_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_expert9_13 [label="L2_Expert13_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_expert9_14 [label="L2_Expert14_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_expert9_15 [label="L2_Expert15_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_moe_agg_gpu9 [label="L2_MoE_Aggregate_GPU9
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_output_gpu9 [label="L2_Residual+LayerNorm_GPU9
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer2_qkv_gpu10 [label="L2_QKV_Projection_GPU10
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 8-11
TP Slice: 2
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_attn_gpu10 [label="L2_Multi-Head_Attention_GPU10
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_attn_proj_gpu10 [label="L2_Attn_Projection_GPU10
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_attn_norm_gpu10 [label="L2_Residual+LayerNorm_GPU10
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_gate_gpu10 [label="L2_Gate_GPU10
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_expert10_0 [label="L2_Expert0_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_expert10_1 [label="L2_Expert1_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_expert10_2 [label="L2_Expert2_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_expert10_3 [label="L2_Expert3_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_expert10_4 [label="L2_Expert4_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_expert10_5 [label="L2_Expert5_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_expert10_6 [label="L2_Expert6_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_expert10_7 [label="L2_Expert7_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_expert10_8 [label="L2_Expert8_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_expert10_9 [label="L2_Expert9_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_expert10_10 [label="L2_Expert10_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_expert10_11 [label="L2_Expert11_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_expert10_12 [label="L2_Expert12_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_expert10_13 [label="L2_Expert13_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_expert10_14 [label="L2_Expert14_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_expert10_15 [label="L2_Expert15_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_moe_agg_gpu10 [label="L2_MoE_Aggregate_GPU10
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_output_gpu10 [label="L2_Residual+LayerNorm_GPU10
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer2_qkv_gpu11 [label="L2_QKV_Projection_GPU11
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 12-15
TP Slice: 3
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_attn_gpu11 [label="L2_Multi-Head_Attention_GPU11
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_attn_proj_gpu11 [label="L2_Attn_Projection_GPU11
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_attn_norm_gpu11 [label="L2_Residual+LayerNorm_GPU11
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_gate_gpu11 [label="L2_Gate_GPU11
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_expert11_0 [label="L2_Expert0_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_expert11_1 [label="L2_Expert1_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_expert11_2 [label="L2_Expert2_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_expert11_3 [label="L2_Expert3_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_expert11_4 [label="L2_Expert4_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_expert11_5 [label="L2_Expert5_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_expert11_6 [label="L2_Expert6_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_expert11_7 [label="L2_Expert7_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_expert11_8 [label="L2_Expert8_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_expert11_9 [label="L2_Expert9_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_expert11_10 [label="L2_Expert10_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_expert11_11 [label="L2_Expert11_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_expert11_12 [label="L2_Expert12_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_expert11_13 [label="L2_Expert13_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_expert11_14 [label="L2_Expert14_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_expert11_15 [label="L2_Expert15_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_moe_agg_gpu11 [label="L2_MoE_Aggregate_GPU11
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_output_gpu11 [label="L2_Residual+LayerNorm_GPU11
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer2_qkv_gpu12 [label="L2_QKV_Projection_GPU12
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 16-19
TP Slice: 4
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_attn_gpu12 [label="L2_Multi-Head_Attention_GPU12
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_attn_proj_gpu12 [label="L2_Attn_Projection_GPU12
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_attn_norm_gpu12 [label="L2_Residual+LayerNorm_GPU12
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_gate_gpu12 [label="L2_Gate_GPU12
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_expert12_0 [label="L2_Expert0_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_expert12_1 [label="L2_Expert1_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_expert12_2 [label="L2_Expert2_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_expert12_3 [label="L2_Expert3_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_expert12_4 [label="L2_Expert4_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_expert12_5 [label="L2_Expert5_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_expert12_6 [label="L2_Expert6_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_expert12_7 [label="L2_Expert7_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_expert12_8 [label="L2_Expert8_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_expert12_9 [label="L2_Expert9_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_expert12_10 [label="L2_Expert10_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_expert12_11 [label="L2_Expert11_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_expert12_12 [label="L2_Expert12_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_expert12_13 [label="L2_Expert13_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_expert12_14 [label="L2_Expert14_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_expert12_15 [label="L2_Expert15_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_moe_agg_gpu12 [label="L2_MoE_Aggregate_GPU12
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_output_gpu12 [label="L2_Residual+LayerNorm_GPU12
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer2_qkv_gpu13 [label="L2_QKV_Projection_GPU13
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 20-23
TP Slice: 5
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_attn_gpu13 [label="L2_Multi-Head_Attention_GPU13
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_attn_proj_gpu13 [label="L2_Attn_Projection_GPU13
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_attn_norm_gpu13 [label="L2_Residual+LayerNorm_GPU13
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_gate_gpu13 [label="L2_Gate_GPU13
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_expert13_0 [label="L2_Expert0_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_expert13_1 [label="L2_Expert1_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_expert13_2 [label="L2_Expert2_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_expert13_3 [label="L2_Expert3_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_expert13_4 [label="L2_Expert4_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_expert13_5 [label="L2_Expert5_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_expert13_6 [label="L2_Expert6_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_expert13_7 [label="L2_Expert7_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_expert13_8 [label="L2_Expert8_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_expert13_9 [label="L2_Expert9_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_expert13_10 [label="L2_Expert10_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_expert13_11 [label="L2_Expert11_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_expert13_12 [label="L2_Expert12_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_expert13_13 [label="L2_Expert13_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_expert13_14 [label="L2_Expert14_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_expert13_15 [label="L2_Expert15_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_moe_agg_gpu13 [label="L2_MoE_Aggregate_GPU13
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_output_gpu13 [label="L2_Residual+LayerNorm_GPU13
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer2_qkv_gpu14 [label="L2_QKV_Projection_GPU14
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 24-27
TP Slice: 6
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_attn_gpu14 [label="L2_Multi-Head_Attention_GPU14
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_attn_proj_gpu14 [label="L2_Attn_Projection_GPU14
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_attn_norm_gpu14 [label="L2_Residual+LayerNorm_GPU14
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_gate_gpu14 [label="L2_Gate_GPU14
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_expert14_0 [label="L2_Expert0_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_expert14_1 [label="L2_Expert1_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_expert14_2 [label="L2_Expert2_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_expert14_3 [label="L2_Expert3_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_expert14_4 [label="L2_Expert4_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_expert14_5 [label="L2_Expert5_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_expert14_6 [label="L2_Expert6_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_expert14_7 [label="L2_Expert7_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_expert14_8 [label="L2_Expert8_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_expert14_9 [label="L2_Expert9_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_expert14_10 [label="L2_Expert10_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_expert14_11 [label="L2_Expert11_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_expert14_12 [label="L2_Expert12_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_expert14_13 [label="L2_Expert13_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_expert14_14 [label="L2_Expert14_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_expert14_15 [label="L2_Expert15_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_moe_agg_gpu14 [label="L2_MoE_Aggregate_GPU14
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_output_gpu14 [label="L2_Residual+LayerNorm_GPU14
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer2_qkv_gpu15 [label="L2_QKV_Projection_GPU15
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 28-31
TP Slice: 7
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_attn_gpu15 [label="L2_Multi-Head_Attention_GPU15
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_attn_proj_gpu15 [label="L2_Attn_Projection_GPU15
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_attn_norm_gpu15 [label="L2_Residual+LayerNorm_GPU15
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_gate_gpu15 [label="L2_Gate_GPU15
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_expert15_0 [label="L2_Expert0_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_expert15_1 [label="L2_Expert1_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_expert15_2 [label="L2_Expert2_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_expert15_3 [label="L2_Expert3_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_expert15_4 [label="L2_Expert4_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_expert15_5 [label="L2_Expert5_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_expert15_6 [label="L2_Expert6_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_expert15_7 [label="L2_Expert7_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_expert15_8 [label="L2_Expert8_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_expert15_9 [label="L2_Expert9_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_expert15_10 [label="L2_Expert10_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_expert15_11 [label="L2_Expert11_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_expert15_12 [label="L2_Expert12_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_expert15_13 [label="L2_Expert13_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_expert15_14 [label="L2_Expert14_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_expert15_15 [label="L2_Expert15_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_moe_agg_gpu15 [label="L2_MoE_Aggregate_GPU15
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_output_gpu15 [label="L2_Residual+LayerNorm_GPU15
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer2_allreduce_attn [label="L2_All-Reduce_Attention
Input: 8×[1024,2048,512]
Output: [1024,2048,4096]
TP All-Reduce" fillcolor=lightcoral shape=diamond]
	layer2_allreduce_moe [label="L2_All-Reduce_MoE
Input: 8×[1024,2048,512]
Output: [1024,2048,4096]
TP All-Reduce" fillcolor=lightcoral shape=diamond]
	layer3_qkv_gpu8 [label="L3_QKV_Projection_GPU8
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 0-3
TP Slice: 0
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_attn_gpu8 [label="L3_Multi-Head_Attention_GPU8
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_attn_proj_gpu8 [label="L3_Attn_Projection_GPU8
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_attn_norm_gpu8 [label="L3_Residual+LayerNorm_GPU8
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_gate_gpu8 [label="L3_Gate_GPU8
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_expert8_0 [label="L3_Expert0_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_expert8_1 [label="L3_Expert1_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_expert8_2 [label="L3_Expert2_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_expert8_3 [label="L3_Expert3_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_expert8_4 [label="L3_Expert4_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_expert8_5 [label="L3_Expert5_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_expert8_6 [label="L3_Expert6_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_expert8_7 [label="L3_Expert7_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_expert8_8 [label="L3_Expert8_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_expert8_9 [label="L3_Expert9_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_expert8_10 [label="L3_Expert10_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_expert8_11 [label="L3_Expert11_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_expert8_12 [label="L3_Expert12_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_expert8_13 [label="L3_Expert13_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_expert8_14 [label="L3_Expert14_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_expert8_15 [label="L3_Expert15_GPU8
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_moe_agg_gpu8 [label="L3_MoE_Aggregate_GPU8
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_output_gpu8 [label="L3_Residual+LayerNorm_GPU8
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 8" fillcolor=lightgreen shape=rectangle]
	layer3_qkv_gpu9 [label="L3_QKV_Projection_GPU9
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 4-7
TP Slice: 1
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_attn_gpu9 [label="L3_Multi-Head_Attention_GPU9
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_attn_proj_gpu9 [label="L3_Attn_Projection_GPU9
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_attn_norm_gpu9 [label="L3_Residual+LayerNorm_GPU9
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_gate_gpu9 [label="L3_Gate_GPU9
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_expert9_0 [label="L3_Expert0_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_expert9_1 [label="L3_Expert1_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_expert9_2 [label="L3_Expert2_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_expert9_3 [label="L3_Expert3_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_expert9_4 [label="L3_Expert4_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_expert9_5 [label="L3_Expert5_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_expert9_6 [label="L3_Expert6_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_expert9_7 [label="L3_Expert7_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_expert9_8 [label="L3_Expert8_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_expert9_9 [label="L3_Expert9_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_expert9_10 [label="L3_Expert10_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_expert9_11 [label="L3_Expert11_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_expert9_12 [label="L3_Expert12_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_expert9_13 [label="L3_Expert13_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_expert9_14 [label="L3_Expert14_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_expert9_15 [label="L3_Expert15_GPU9
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_moe_agg_gpu9 [label="L3_MoE_Aggregate_GPU9
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_output_gpu9 [label="L3_Residual+LayerNorm_GPU9
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 9" fillcolor=lightgreen shape=rectangle]
	layer3_qkv_gpu10 [label="L3_QKV_Projection_GPU10
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 8-11
TP Slice: 2
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_attn_gpu10 [label="L3_Multi-Head_Attention_GPU10
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_attn_proj_gpu10 [label="L3_Attn_Projection_GPU10
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_attn_norm_gpu10 [label="L3_Residual+LayerNorm_GPU10
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_gate_gpu10 [label="L3_Gate_GPU10
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_expert10_0 [label="L3_Expert0_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_expert10_1 [label="L3_Expert1_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_expert10_2 [label="L3_Expert2_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_expert10_3 [label="L3_Expert3_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_expert10_4 [label="L3_Expert4_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_expert10_5 [label="L3_Expert5_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_expert10_6 [label="L3_Expert6_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_expert10_7 [label="L3_Expert7_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_expert10_8 [label="L3_Expert8_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_expert10_9 [label="L3_Expert9_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_expert10_10 [label="L3_Expert10_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_expert10_11 [label="L3_Expert11_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_expert10_12 [label="L3_Expert12_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_expert10_13 [label="L3_Expert13_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_expert10_14 [label="L3_Expert14_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_expert10_15 [label="L3_Expert15_GPU10
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_moe_agg_gpu10 [label="L3_MoE_Aggregate_GPU10
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_output_gpu10 [label="L3_Residual+LayerNorm_GPU10
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 10" fillcolor=lightgreen shape=rectangle]
	layer3_qkv_gpu11 [label="L3_QKV_Projection_GPU11
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 12-15
TP Slice: 3
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_attn_gpu11 [label="L3_Multi-Head_Attention_GPU11
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_attn_proj_gpu11 [label="L3_Attn_Projection_GPU11
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_attn_norm_gpu11 [label="L3_Residual+LayerNorm_GPU11
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_gate_gpu11 [label="L3_Gate_GPU11
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_expert11_0 [label="L3_Expert0_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_expert11_1 [label="L3_Expert1_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_expert11_2 [label="L3_Expert2_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_expert11_3 [label="L3_Expert3_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_expert11_4 [label="L3_Expert4_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_expert11_5 [label="L3_Expert5_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_expert11_6 [label="L3_Expert6_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_expert11_7 [label="L3_Expert7_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_expert11_8 [label="L3_Expert8_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_expert11_9 [label="L3_Expert9_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_expert11_10 [label="L3_Expert10_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_expert11_11 [label="L3_Expert11_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_expert11_12 [label="L3_Expert12_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_expert11_13 [label="L3_Expert13_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_expert11_14 [label="L3_Expert14_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_expert11_15 [label="L3_Expert15_GPU11
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_moe_agg_gpu11 [label="L3_MoE_Aggregate_GPU11
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_output_gpu11 [label="L3_Residual+LayerNorm_GPU11
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 11" fillcolor=lightgreen shape=rectangle]
	layer3_qkv_gpu12 [label="L3_QKV_Projection_GPU12
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 16-19
TP Slice: 4
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_attn_gpu12 [label="L3_Multi-Head_Attention_GPU12
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_attn_proj_gpu12 [label="L3_Attn_Projection_GPU12
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_attn_norm_gpu12 [label="L3_Residual+LayerNorm_GPU12
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_gate_gpu12 [label="L3_Gate_GPU12
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_expert12_0 [label="L3_Expert0_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_expert12_1 [label="L3_Expert1_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_expert12_2 [label="L3_Expert2_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_expert12_3 [label="L3_Expert3_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_expert12_4 [label="L3_Expert4_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_expert12_5 [label="L3_Expert5_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_expert12_6 [label="L3_Expert6_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_expert12_7 [label="L3_Expert7_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_expert12_8 [label="L3_Expert8_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_expert12_9 [label="L3_Expert9_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_expert12_10 [label="L3_Expert10_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_expert12_11 [label="L3_Expert11_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_expert12_12 [label="L3_Expert12_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_expert12_13 [label="L3_Expert13_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_expert12_14 [label="L3_Expert14_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_expert12_15 [label="L3_Expert15_GPU12
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_moe_agg_gpu12 [label="L3_MoE_Aggregate_GPU12
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_output_gpu12 [label="L3_Residual+LayerNorm_GPU12
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 12" fillcolor=lightgreen shape=rectangle]
	layer3_qkv_gpu13 [label="L3_QKV_Projection_GPU13
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 20-23
TP Slice: 5
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_attn_gpu13 [label="L3_Multi-Head_Attention_GPU13
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_attn_proj_gpu13 [label="L3_Attn_Projection_GPU13
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_attn_norm_gpu13 [label="L3_Residual+LayerNorm_GPU13
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_gate_gpu13 [label="L3_Gate_GPU13
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_expert13_0 [label="L3_Expert0_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_expert13_1 [label="L3_Expert1_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_expert13_2 [label="L3_Expert2_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_expert13_3 [label="L3_Expert3_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_expert13_4 [label="L3_Expert4_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_expert13_5 [label="L3_Expert5_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_expert13_6 [label="L3_Expert6_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_expert13_7 [label="L3_Expert7_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_expert13_8 [label="L3_Expert8_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_expert13_9 [label="L3_Expert9_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_expert13_10 [label="L3_Expert10_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_expert13_11 [label="L3_Expert11_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_expert13_12 [label="L3_Expert12_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_expert13_13 [label="L3_Expert13_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_expert13_14 [label="L3_Expert14_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_expert13_15 [label="L3_Expert15_GPU13
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_moe_agg_gpu13 [label="L3_MoE_Aggregate_GPU13
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_output_gpu13 [label="L3_Residual+LayerNorm_GPU13
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 13" fillcolor=lightgreen shape=rectangle]
	layer3_qkv_gpu14 [label="L3_QKV_Projection_GPU14
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 24-27
TP Slice: 6
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_attn_gpu14 [label="L3_Multi-Head_Attention_GPU14
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_attn_proj_gpu14 [label="L3_Attn_Projection_GPU14
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_attn_norm_gpu14 [label="L3_Residual+LayerNorm_GPU14
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_gate_gpu14 [label="L3_Gate_GPU14
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_expert14_0 [label="L3_Expert0_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_expert14_1 [label="L3_Expert1_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_expert14_2 [label="L3_Expert2_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_expert14_3 [label="L3_Expert3_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_expert14_4 [label="L3_Expert4_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_expert14_5 [label="L3_Expert5_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_expert14_6 [label="L3_Expert6_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_expert14_7 [label="L3_Expert7_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_expert14_8 [label="L3_Expert8_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_expert14_9 [label="L3_Expert9_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_expert14_10 [label="L3_Expert10_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_expert14_11 [label="L3_Expert11_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_expert14_12 [label="L3_Expert12_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_expert14_13 [label="L3_Expert13_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_expert14_14 [label="L3_Expert14_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_expert14_15 [label="L3_Expert15_GPU14
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_moe_agg_gpu14 [label="L3_MoE_Aggregate_GPU14
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_output_gpu14 [label="L3_Residual+LayerNorm_GPU14
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 14" fillcolor=lightgreen shape=rectangle]
	layer3_qkv_gpu15 [label="L3_QKV_Projection_GPU15
Input: [1024,2048,4096]
Output: [1024,2048,3*512]
Heads: 28-31
TP Slice: 7
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_attn_gpu15 [label="L3_Multi-Head_Attention_GPU15
Input: [1024,2048,512]x8
Output: [1024,2048,512]
TP Reduction
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_attn_proj_gpu15 [label="L3_Attn_Projection_GPU15
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_attn_norm_gpu15 [label="L3_Residual+LayerNorm_GPU15
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_gate_gpu15 [label="L3_Gate_GPU15
Input: [1024,2048,512]
Output: [1024,2048,16 experts]
TP: expert routing
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_expert15_0 [label="L3_Expert0_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_expert15_1 [label="L3_Expert1_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_expert15_2 [label="L3_Expert2_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_expert15_3 [label="L3_Expert3_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_expert15_4 [label="L3_Expert4_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_expert15_5 [label="L3_Expert5_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_expert15_6 [label="L3_Expert6_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_expert15_7 [label="L3_Expert7_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_expert15_8 [label="L3_Expert8_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_expert15_9 [label="L3_Expert9_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_expert15_10 [label="L3_Expert10_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_expert15_11 [label="L3_Expert11_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_expert15_12 [label="L3_Expert12_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_expert15_13 [label="L3_Expert13_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_expert15_14 [label="L3_Expert14_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_expert15_15 [label="L3_Expert15_GPU15
Input: [tokens,512]
Output: [tokens,512]
TP slice
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_moe_agg_gpu15 [label="L3_MoE_Aggregate_GPU15
Input: 16×[tokens,512]
Output: [1024,2048,512]
TP Reduction
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_output_gpu15 [label="L3_Residual+LayerNorm_GPU15
Input: [1024,2048,512]x2
Output: [1024,2048,512]
GPU: 15" fillcolor=lightgreen shape=rectangle]
	layer3_allreduce_attn [label="L3_All-Reduce_Attention
Input: 8×[1024,2048,512]
Output: [1024,2048,4096]
TP All-Reduce" fillcolor=lightcoral shape=diamond]
	layer3_allreduce_moe [label="L3_All-Reduce_MoE
Input: 8×[1024,2048,512]
Output: [1024,2048,4096]
TP All-Reduce" fillcolor=lightcoral shape=diamond]
	pipeline_stage0_1 [label="Pipeline_Stage0_to_1
Input: [1024,2048,4096]
Output: [1024,2048,4096]
Cross-stage communication" fillcolor=yellow shape=parallelogram]
	output [label="OUTPUT
Input: [batch_size=1024, seq_len=2048, hidden=4096]
GPU: 8-15" fillcolor=lightblue shape=ellipse]
	input -> layer0_qkv_gpu0
	input -> layer0_qkv_gpu1
	input -> layer0_qkv_gpu2
	input -> layer0_qkv_gpu3
	input -> layer0_qkv_gpu4
	input -> layer0_qkv_gpu5
	input -> layer0_qkv_gpu6
	input -> layer0_qkv_gpu7
	layer0_qkv_gpu0 -> layer0_attn_gpu0
	layer0_attn_gpu0 -> layer0_attn_proj_gpu0
	layer0_attn_proj_gpu0 -> layer0_attn_norm_gpu0
	layer0_attn_norm_gpu0 -> layer0_gate_gpu0
	layer0_gate_gpu0 -> layer0_expert0_0 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_1 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_2 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_3 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_4 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_5 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_6 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_7 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_8 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_9 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_10 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_11 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_12 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_13 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_14 [style=dashed]
	layer0_gate_gpu0 -> layer0_expert0_15 [style=dashed]
	layer0_expert0_0 -> layer0_moe_agg_gpu0
	layer0_expert0_1 -> layer0_moe_agg_gpu0
	layer0_expert0_2 -> layer0_moe_agg_gpu0
	layer0_expert0_3 -> layer0_moe_agg_gpu0
	layer0_expert0_4 -> layer0_moe_agg_gpu0
	layer0_expert0_5 -> layer0_moe_agg_gpu0
	layer0_expert0_6 -> layer0_moe_agg_gpu0
	layer0_expert0_7 -> layer0_moe_agg_gpu0
	layer0_expert0_8 -> layer0_moe_agg_gpu0
	layer0_expert0_9 -> layer0_moe_agg_gpu0
	layer0_expert0_10 -> layer0_moe_agg_gpu0
	layer0_expert0_11 -> layer0_moe_agg_gpu0
	layer0_expert0_12 -> layer0_moe_agg_gpu0
	layer0_expert0_13 -> layer0_moe_agg_gpu0
	layer0_expert0_14 -> layer0_moe_agg_gpu0
	layer0_expert0_15 -> layer0_moe_agg_gpu0
	layer0_moe_agg_gpu0 -> layer0_output_gpu0
	layer0_qkv_gpu1 -> layer0_attn_gpu1
	layer0_attn_gpu1 -> layer0_attn_proj_gpu1
	layer0_attn_proj_gpu1 -> layer0_attn_norm_gpu1
	layer0_attn_norm_gpu1 -> layer0_gate_gpu1
	layer0_gate_gpu1 -> layer0_expert1_0 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_1 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_2 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_3 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_4 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_5 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_6 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_7 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_8 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_9 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_10 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_11 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_12 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_13 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_14 [style=dashed]
	layer0_gate_gpu1 -> layer0_expert1_15 [style=dashed]
	layer0_expert1_0 -> layer0_moe_agg_gpu1
	layer0_expert1_1 -> layer0_moe_agg_gpu1
	layer0_expert1_2 -> layer0_moe_agg_gpu1
	layer0_expert1_3 -> layer0_moe_agg_gpu1
	layer0_expert1_4 -> layer0_moe_agg_gpu1
	layer0_expert1_5 -> layer0_moe_agg_gpu1
	layer0_expert1_6 -> layer0_moe_agg_gpu1
	layer0_expert1_7 -> layer0_moe_agg_gpu1
	layer0_expert1_8 -> layer0_moe_agg_gpu1
	layer0_expert1_9 -> layer0_moe_agg_gpu1
	layer0_expert1_10 -> layer0_moe_agg_gpu1
	layer0_expert1_11 -> layer0_moe_agg_gpu1
	layer0_expert1_12 -> layer0_moe_agg_gpu1
	layer0_expert1_13 -> layer0_moe_agg_gpu1
	layer0_expert1_14 -> layer0_moe_agg_gpu1
	layer0_expert1_15 -> layer0_moe_agg_gpu1
	layer0_moe_agg_gpu1 -> layer0_output_gpu1
	layer0_qkv_gpu2 -> layer0_attn_gpu2
	layer0_attn_gpu2 -> layer0_attn_proj_gpu2
	layer0_attn_proj_gpu2 -> layer0_attn_norm_gpu2
	layer0_attn_norm_gpu2 -> layer0_gate_gpu2
	layer0_gate_gpu2 -> layer0_expert2_0 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_1 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_2 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_3 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_4 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_5 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_6 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_7 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_8 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_9 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_10 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_11 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_12 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_13 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_14 [style=dashed]
	layer0_gate_gpu2 -> layer0_expert2_15 [style=dashed]
	layer0_expert2_0 -> layer0_moe_agg_gpu2
	layer0_expert2_1 -> layer0_moe_agg_gpu2
	layer0_expert2_2 -> layer0_moe_agg_gpu2
	layer0_expert2_3 -> layer0_moe_agg_gpu2
	layer0_expert2_4 -> layer0_moe_agg_gpu2
	layer0_expert2_5 -> layer0_moe_agg_gpu2
	layer0_expert2_6 -> layer0_moe_agg_gpu2
	layer0_expert2_7 -> layer0_moe_agg_gpu2
	layer0_expert2_8 -> layer0_moe_agg_gpu2
	layer0_expert2_9 -> layer0_moe_agg_gpu2
	layer0_expert2_10 -> layer0_moe_agg_gpu2
	layer0_expert2_11 -> layer0_moe_agg_gpu2
	layer0_expert2_12 -> layer0_moe_agg_gpu2
	layer0_expert2_13 -> layer0_moe_agg_gpu2
	layer0_expert2_14 -> layer0_moe_agg_gpu2
	layer0_expert2_15 -> layer0_moe_agg_gpu2
	layer0_moe_agg_gpu2 -> layer0_output_gpu2
	layer0_qkv_gpu3 -> layer0_attn_gpu3
	layer0_attn_gpu3 -> layer0_attn_proj_gpu3
	layer0_attn_proj_gpu3 -> layer0_attn_norm_gpu3
	layer0_attn_norm_gpu3 -> layer0_gate_gpu3
	layer0_gate_gpu3 -> layer0_expert3_0 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_1 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_2 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_3 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_4 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_5 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_6 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_7 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_8 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_9 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_10 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_11 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_12 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_13 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_14 [style=dashed]
	layer0_gate_gpu3 -> layer0_expert3_15 [style=dashed]
	layer0_expert3_0 -> layer0_moe_agg_gpu3
	layer0_expert3_1 -> layer0_moe_agg_gpu3
	layer0_expert3_2 -> layer0_moe_agg_gpu3
	layer0_expert3_3 -> layer0_moe_agg_gpu3
	layer0_expert3_4 -> layer0_moe_agg_gpu3
	layer0_expert3_5 -> layer0_moe_agg_gpu3
	layer0_expert3_6 -> layer0_moe_agg_gpu3
	layer0_expert3_7 -> layer0_moe_agg_gpu3
	layer0_expert3_8 -> layer0_moe_agg_gpu3
	layer0_expert3_9 -> layer0_moe_agg_gpu3
	layer0_expert3_10 -> layer0_moe_agg_gpu3
	layer0_expert3_11 -> layer0_moe_agg_gpu3
	layer0_expert3_12 -> layer0_moe_agg_gpu3
	layer0_expert3_13 -> layer0_moe_agg_gpu3
	layer0_expert3_14 -> layer0_moe_agg_gpu3
	layer0_expert3_15 -> layer0_moe_agg_gpu3
	layer0_moe_agg_gpu3 -> layer0_output_gpu3
	layer0_qkv_gpu4 -> layer0_attn_gpu4
	layer0_attn_gpu4 -> layer0_attn_proj_gpu4
	layer0_attn_proj_gpu4 -> layer0_attn_norm_gpu4
	layer0_attn_norm_gpu4 -> layer0_gate_gpu4
	layer0_gate_gpu4 -> layer0_expert4_0 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_1 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_2 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_3 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_4 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_5 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_6 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_7 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_8 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_9 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_10 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_11 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_12 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_13 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_14 [style=dashed]
	layer0_gate_gpu4 -> layer0_expert4_15 [style=dashed]
	layer0_expert4_0 -> layer0_moe_agg_gpu4
	layer0_expert4_1 -> layer0_moe_agg_gpu4
	layer0_expert4_2 -> layer0_moe_agg_gpu4
	layer0_expert4_3 -> layer0_moe_agg_gpu4
	layer0_expert4_4 -> layer0_moe_agg_gpu4
	layer0_expert4_5 -> layer0_moe_agg_gpu4
	layer0_expert4_6 -> layer0_moe_agg_gpu4
	layer0_expert4_7 -> layer0_moe_agg_gpu4
	layer0_expert4_8 -> layer0_moe_agg_gpu4
	layer0_expert4_9 -> layer0_moe_agg_gpu4
	layer0_expert4_10 -> layer0_moe_agg_gpu4
	layer0_expert4_11 -> layer0_moe_agg_gpu4
	layer0_expert4_12 -> layer0_moe_agg_gpu4
	layer0_expert4_13 -> layer0_moe_agg_gpu4
	layer0_expert4_14 -> layer0_moe_agg_gpu4
	layer0_expert4_15 -> layer0_moe_agg_gpu4
	layer0_moe_agg_gpu4 -> layer0_output_gpu4
	layer0_qkv_gpu5 -> layer0_attn_gpu5
	layer0_attn_gpu5 -> layer0_attn_proj_gpu5
	layer0_attn_proj_gpu5 -> layer0_attn_norm_gpu5
	layer0_attn_norm_gpu5 -> layer0_gate_gpu5
	layer0_gate_gpu5 -> layer0_expert5_0 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_1 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_2 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_3 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_4 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_5 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_6 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_7 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_8 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_9 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_10 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_11 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_12 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_13 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_14 [style=dashed]
	layer0_gate_gpu5 -> layer0_expert5_15 [style=dashed]
	layer0_expert5_0 -> layer0_moe_agg_gpu5
	layer0_expert5_1 -> layer0_moe_agg_gpu5
	layer0_expert5_2 -> layer0_moe_agg_gpu5
	layer0_expert5_3 -> layer0_moe_agg_gpu5
	layer0_expert5_4 -> layer0_moe_agg_gpu5
	layer0_expert5_5 -> layer0_moe_agg_gpu5
	layer0_expert5_6 -> layer0_moe_agg_gpu5
	layer0_expert5_7 -> layer0_moe_agg_gpu5
	layer0_expert5_8 -> layer0_moe_agg_gpu5
	layer0_expert5_9 -> layer0_moe_agg_gpu5
	layer0_expert5_10 -> layer0_moe_agg_gpu5
	layer0_expert5_11 -> layer0_moe_agg_gpu5
	layer0_expert5_12 -> layer0_moe_agg_gpu5
	layer0_expert5_13 -> layer0_moe_agg_gpu5
	layer0_expert5_14 -> layer0_moe_agg_gpu5
	layer0_expert5_15 -> layer0_moe_agg_gpu5
	layer0_moe_agg_gpu5 -> layer0_output_gpu5
	layer0_qkv_gpu6 -> layer0_attn_gpu6
	layer0_attn_gpu6 -> layer0_attn_proj_gpu6
	layer0_attn_proj_gpu6 -> layer0_attn_norm_gpu6
	layer0_attn_norm_gpu6 -> layer0_gate_gpu6
	layer0_gate_gpu6 -> layer0_expert6_0 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_1 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_2 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_3 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_4 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_5 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_6 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_7 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_8 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_9 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_10 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_11 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_12 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_13 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_14 [style=dashed]
	layer0_gate_gpu6 -> layer0_expert6_15 [style=dashed]
	layer0_expert6_0 -> layer0_moe_agg_gpu6
	layer0_expert6_1 -> layer0_moe_agg_gpu6
	layer0_expert6_2 -> layer0_moe_agg_gpu6
	layer0_expert6_3 -> layer0_moe_agg_gpu6
	layer0_expert6_4 -> layer0_moe_agg_gpu6
	layer0_expert6_5 -> layer0_moe_agg_gpu6
	layer0_expert6_6 -> layer0_moe_agg_gpu6
	layer0_expert6_7 -> layer0_moe_agg_gpu6
	layer0_expert6_8 -> layer0_moe_agg_gpu6
	layer0_expert6_9 -> layer0_moe_agg_gpu6
	layer0_expert6_10 -> layer0_moe_agg_gpu6
	layer0_expert6_11 -> layer0_moe_agg_gpu6
	layer0_expert6_12 -> layer0_moe_agg_gpu6
	layer0_expert6_13 -> layer0_moe_agg_gpu6
	layer0_expert6_14 -> layer0_moe_agg_gpu6
	layer0_expert6_15 -> layer0_moe_agg_gpu6
	layer0_moe_agg_gpu6 -> layer0_output_gpu6
	layer0_qkv_gpu7 -> layer0_attn_gpu7
	layer0_attn_gpu7 -> layer0_attn_proj_gpu7
	layer0_attn_proj_gpu7 -> layer0_attn_norm_gpu7
	layer0_attn_norm_gpu7 -> layer0_gate_gpu7
	layer0_gate_gpu7 -> layer0_expert7_0 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_1 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_2 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_3 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_4 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_5 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_6 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_7 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_8 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_9 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_10 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_11 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_12 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_13 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_14 [style=dashed]
	layer0_gate_gpu7 -> layer0_expert7_15 [style=dashed]
	layer0_expert7_0 -> layer0_moe_agg_gpu7
	layer0_expert7_1 -> layer0_moe_agg_gpu7
	layer0_expert7_2 -> layer0_moe_agg_gpu7
	layer0_expert7_3 -> layer0_moe_agg_gpu7
	layer0_expert7_4 -> layer0_moe_agg_gpu7
	layer0_expert7_5 -> layer0_moe_agg_gpu7
	layer0_expert7_6 -> layer0_moe_agg_gpu7
	layer0_expert7_7 -> layer0_moe_agg_gpu7
	layer0_expert7_8 -> layer0_moe_agg_gpu7
	layer0_expert7_9 -> layer0_moe_agg_gpu7
	layer0_expert7_10 -> layer0_moe_agg_gpu7
	layer0_expert7_11 -> layer0_moe_agg_gpu7
	layer0_expert7_12 -> layer0_moe_agg_gpu7
	layer0_expert7_13 -> layer0_moe_agg_gpu7
	layer0_expert7_14 -> layer0_moe_agg_gpu7
	layer0_expert7_15 -> layer0_moe_agg_gpu7
	layer0_moe_agg_gpu7 -> layer0_output_gpu7
	layer0_attn_proj_gpu0 -> layer0_allreduce_attn
	layer0_allreduce_attn -> layer0_attn_norm_gpu0
	layer0_moe_agg_gpu0 -> layer0_allreduce_moe
	layer0_allreduce_moe -> layer0_output_gpu0
	layer0_attn_proj_gpu1 -> layer0_allreduce_attn
	layer0_allreduce_attn -> layer0_attn_norm_gpu1
	layer0_moe_agg_gpu1 -> layer0_allreduce_moe
	layer0_allreduce_moe -> layer0_output_gpu1
	layer0_attn_proj_gpu2 -> layer0_allreduce_attn
	layer0_allreduce_attn -> layer0_attn_norm_gpu2
	layer0_moe_agg_gpu2 -> layer0_allreduce_moe
	layer0_allreduce_moe -> layer0_output_gpu2
	layer0_attn_proj_gpu3 -> layer0_allreduce_attn
	layer0_allreduce_attn -> layer0_attn_norm_gpu3
	layer0_moe_agg_gpu3 -> layer0_allreduce_moe
	layer0_allreduce_moe -> layer0_output_gpu3
	layer0_attn_proj_gpu4 -> layer0_allreduce_attn
	layer0_allreduce_attn -> layer0_attn_norm_gpu4
	layer0_moe_agg_gpu4 -> layer0_allreduce_moe
	layer0_allreduce_moe -> layer0_output_gpu4
	layer0_attn_proj_gpu5 -> layer0_allreduce_attn
	layer0_allreduce_attn -> layer0_attn_norm_gpu5
	layer0_moe_agg_gpu5 -> layer0_allreduce_moe
	layer0_allreduce_moe -> layer0_output_gpu5
	layer0_attn_proj_gpu6 -> layer0_allreduce_attn
	layer0_allreduce_attn -> layer0_attn_norm_gpu6
	layer0_moe_agg_gpu6 -> layer0_allreduce_moe
	layer0_allreduce_moe -> layer0_output_gpu6
	layer0_attn_proj_gpu7 -> layer0_allreduce_attn
	layer0_allreduce_attn -> layer0_attn_norm_gpu7
	layer0_moe_agg_gpu7 -> layer0_allreduce_moe
	layer0_allreduce_moe -> layer0_output_gpu7
	layer1_qkv_gpu0 -> layer1_attn_gpu0
	layer1_attn_gpu0 -> layer1_attn_proj_gpu0
	layer1_attn_proj_gpu0 -> layer1_attn_norm_gpu0
	layer1_attn_norm_gpu0 -> layer1_gate_gpu0
	layer1_gate_gpu0 -> layer1_expert0_0 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_1 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_2 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_3 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_4 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_5 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_6 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_7 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_8 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_9 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_10 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_11 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_12 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_13 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_14 [style=dashed]
	layer1_gate_gpu0 -> layer1_expert0_15 [style=dashed]
	layer1_expert0_0 -> layer1_moe_agg_gpu0
	layer1_expert0_1 -> layer1_moe_agg_gpu0
	layer1_expert0_2 -> layer1_moe_agg_gpu0
	layer1_expert0_3 -> layer1_moe_agg_gpu0
	layer1_expert0_4 -> layer1_moe_agg_gpu0
	layer1_expert0_5 -> layer1_moe_agg_gpu0
	layer1_expert0_6 -> layer1_moe_agg_gpu0
	layer1_expert0_7 -> layer1_moe_agg_gpu0
	layer1_expert0_8 -> layer1_moe_agg_gpu0
	layer1_expert0_9 -> layer1_moe_agg_gpu0
	layer1_expert0_10 -> layer1_moe_agg_gpu0
	layer1_expert0_11 -> layer1_moe_agg_gpu0
	layer1_expert0_12 -> layer1_moe_agg_gpu0
	layer1_expert0_13 -> layer1_moe_agg_gpu0
	layer1_expert0_14 -> layer1_moe_agg_gpu0
	layer1_expert0_15 -> layer1_moe_agg_gpu0
	layer1_moe_agg_gpu0 -> layer1_output_gpu0
	layer1_qkv_gpu1 -> layer1_attn_gpu1
	layer1_attn_gpu1 -> layer1_attn_proj_gpu1
	layer1_attn_proj_gpu1 -> layer1_attn_norm_gpu1
	layer1_attn_norm_gpu1 -> layer1_gate_gpu1
	layer1_gate_gpu1 -> layer1_expert1_0 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_1 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_2 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_3 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_4 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_5 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_6 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_7 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_8 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_9 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_10 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_11 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_12 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_13 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_14 [style=dashed]
	layer1_gate_gpu1 -> layer1_expert1_15 [style=dashed]
	layer1_expert1_0 -> layer1_moe_agg_gpu1
	layer1_expert1_1 -> layer1_moe_agg_gpu1
	layer1_expert1_2 -> layer1_moe_agg_gpu1
	layer1_expert1_3 -> layer1_moe_agg_gpu1
	layer1_expert1_4 -> layer1_moe_agg_gpu1
	layer1_expert1_5 -> layer1_moe_agg_gpu1
	layer1_expert1_6 -> layer1_moe_agg_gpu1
	layer1_expert1_7 -> layer1_moe_agg_gpu1
	layer1_expert1_8 -> layer1_moe_agg_gpu1
	layer1_expert1_9 -> layer1_moe_agg_gpu1
	layer1_expert1_10 -> layer1_moe_agg_gpu1
	layer1_expert1_11 -> layer1_moe_agg_gpu1
	layer1_expert1_12 -> layer1_moe_agg_gpu1
	layer1_expert1_13 -> layer1_moe_agg_gpu1
	layer1_expert1_14 -> layer1_moe_agg_gpu1
	layer1_expert1_15 -> layer1_moe_agg_gpu1
	layer1_moe_agg_gpu1 -> layer1_output_gpu1
	layer1_qkv_gpu2 -> layer1_attn_gpu2
	layer1_attn_gpu2 -> layer1_attn_proj_gpu2
	layer1_attn_proj_gpu2 -> layer1_attn_norm_gpu2
	layer1_attn_norm_gpu2 -> layer1_gate_gpu2
	layer1_gate_gpu2 -> layer1_expert2_0 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_1 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_2 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_3 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_4 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_5 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_6 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_7 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_8 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_9 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_10 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_11 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_12 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_13 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_14 [style=dashed]
	layer1_gate_gpu2 -> layer1_expert2_15 [style=dashed]
	layer1_expert2_0 -> layer1_moe_agg_gpu2
	layer1_expert2_1 -> layer1_moe_agg_gpu2
	layer1_expert2_2 -> layer1_moe_agg_gpu2
	layer1_expert2_3 -> layer1_moe_agg_gpu2
	layer1_expert2_4 -> layer1_moe_agg_gpu2
	layer1_expert2_5 -> layer1_moe_agg_gpu2
	layer1_expert2_6 -> layer1_moe_agg_gpu2
	layer1_expert2_7 -> layer1_moe_agg_gpu2
	layer1_expert2_8 -> layer1_moe_agg_gpu2
	layer1_expert2_9 -> layer1_moe_agg_gpu2
	layer1_expert2_10 -> layer1_moe_agg_gpu2
	layer1_expert2_11 -> layer1_moe_agg_gpu2
	layer1_expert2_12 -> layer1_moe_agg_gpu2
	layer1_expert2_13 -> layer1_moe_agg_gpu2
	layer1_expert2_14 -> layer1_moe_agg_gpu2
	layer1_expert2_15 -> layer1_moe_agg_gpu2
	layer1_moe_agg_gpu2 -> layer1_output_gpu2
	layer1_qkv_gpu3 -> layer1_attn_gpu3
	layer1_attn_gpu3 -> layer1_attn_proj_gpu3
	layer1_attn_proj_gpu3 -> layer1_attn_norm_gpu3
	layer1_attn_norm_gpu3 -> layer1_gate_gpu3
	layer1_gate_gpu3 -> layer1_expert3_0 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_1 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_2 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_3 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_4 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_5 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_6 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_7 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_8 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_9 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_10 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_11 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_12 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_13 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_14 [style=dashed]
	layer1_gate_gpu3 -> layer1_expert3_15 [style=dashed]
	layer1_expert3_0 -> layer1_moe_agg_gpu3
	layer1_expert3_1 -> layer1_moe_agg_gpu3
	layer1_expert3_2 -> layer1_moe_agg_gpu3
	layer1_expert3_3 -> layer1_moe_agg_gpu3
	layer1_expert3_4 -> layer1_moe_agg_gpu3
	layer1_expert3_5 -> layer1_moe_agg_gpu3
	layer1_expert3_6 -> layer1_moe_agg_gpu3
	layer1_expert3_7 -> layer1_moe_agg_gpu3
	layer1_expert3_8 -> layer1_moe_agg_gpu3
	layer1_expert3_9 -> layer1_moe_agg_gpu3
	layer1_expert3_10 -> layer1_moe_agg_gpu3
	layer1_expert3_11 -> layer1_moe_agg_gpu3
	layer1_expert3_12 -> layer1_moe_agg_gpu3
	layer1_expert3_13 -> layer1_moe_agg_gpu3
	layer1_expert3_14 -> layer1_moe_agg_gpu3
	layer1_expert3_15 -> layer1_moe_agg_gpu3
	layer1_moe_agg_gpu3 -> layer1_output_gpu3
	layer1_qkv_gpu4 -> layer1_attn_gpu4
	layer1_attn_gpu4 -> layer1_attn_proj_gpu4
	layer1_attn_proj_gpu4 -> layer1_attn_norm_gpu4
	layer1_attn_norm_gpu4 -> layer1_gate_gpu4
	layer1_gate_gpu4 -> layer1_expert4_0 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_1 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_2 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_3 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_4 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_5 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_6 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_7 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_8 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_9 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_10 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_11 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_12 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_13 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_14 [style=dashed]
	layer1_gate_gpu4 -> layer1_expert4_15 [style=dashed]
	layer1_expert4_0 -> layer1_moe_agg_gpu4
	layer1_expert4_1 -> layer1_moe_agg_gpu4
	layer1_expert4_2 -> layer1_moe_agg_gpu4
	layer1_expert4_3 -> layer1_moe_agg_gpu4
	layer1_expert4_4 -> layer1_moe_agg_gpu4
	layer1_expert4_5 -> layer1_moe_agg_gpu4
	layer1_expert4_6 -> layer1_moe_agg_gpu4
	layer1_expert4_7 -> layer1_moe_agg_gpu4
	layer1_expert4_8 -> layer1_moe_agg_gpu4
	layer1_expert4_9 -> layer1_moe_agg_gpu4
	layer1_expert4_10 -> layer1_moe_agg_gpu4
	layer1_expert4_11 -> layer1_moe_agg_gpu4
	layer1_expert4_12 -> layer1_moe_agg_gpu4
	layer1_expert4_13 -> layer1_moe_agg_gpu4
	layer1_expert4_14 -> layer1_moe_agg_gpu4
	layer1_expert4_15 -> layer1_moe_agg_gpu4
	layer1_moe_agg_gpu4 -> layer1_output_gpu4
	layer1_qkv_gpu5 -> layer1_attn_gpu5
	layer1_attn_gpu5 -> layer1_attn_proj_gpu5
	layer1_attn_proj_gpu5 -> layer1_attn_norm_gpu5
	layer1_attn_norm_gpu5 -> layer1_gate_gpu5
	layer1_gate_gpu5 -> layer1_expert5_0 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_1 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_2 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_3 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_4 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_5 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_6 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_7 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_8 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_9 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_10 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_11 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_12 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_13 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_14 [style=dashed]
	layer1_gate_gpu5 -> layer1_expert5_15 [style=dashed]
	layer1_expert5_0 -> layer1_moe_agg_gpu5
	layer1_expert5_1 -> layer1_moe_agg_gpu5
	layer1_expert5_2 -> layer1_moe_agg_gpu5
	layer1_expert5_3 -> layer1_moe_agg_gpu5
	layer1_expert5_4 -> layer1_moe_agg_gpu5
	layer1_expert5_5 -> layer1_moe_agg_gpu5
	layer1_expert5_6 -> layer1_moe_agg_gpu5
	layer1_expert5_7 -> layer1_moe_agg_gpu5
	layer1_expert5_8 -> layer1_moe_agg_gpu5
	layer1_expert5_9 -> layer1_moe_agg_gpu5
	layer1_expert5_10 -> layer1_moe_agg_gpu5
	layer1_expert5_11 -> layer1_moe_agg_gpu5
	layer1_expert5_12 -> layer1_moe_agg_gpu5
	layer1_expert5_13 -> layer1_moe_agg_gpu5
	layer1_expert5_14 -> layer1_moe_agg_gpu5
	layer1_expert5_15 -> layer1_moe_agg_gpu5
	layer1_moe_agg_gpu5 -> layer1_output_gpu5
	layer1_qkv_gpu6 -> layer1_attn_gpu6
	layer1_attn_gpu6 -> layer1_attn_proj_gpu6
	layer1_attn_proj_gpu6 -> layer1_attn_norm_gpu6
	layer1_attn_norm_gpu6 -> layer1_gate_gpu6
	layer1_gate_gpu6 -> layer1_expert6_0 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_1 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_2 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_3 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_4 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_5 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_6 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_7 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_8 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_9 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_10 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_11 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_12 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_13 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_14 [style=dashed]
	layer1_gate_gpu6 -> layer1_expert6_15 [style=dashed]
	layer1_expert6_0 -> layer1_moe_agg_gpu6
	layer1_expert6_1 -> layer1_moe_agg_gpu6
	layer1_expert6_2 -> layer1_moe_agg_gpu6
	layer1_expert6_3 -> layer1_moe_agg_gpu6
	layer1_expert6_4 -> layer1_moe_agg_gpu6
	layer1_expert6_5 -> layer1_moe_agg_gpu6
	layer1_expert6_6 -> layer1_moe_agg_gpu6
	layer1_expert6_7 -> layer1_moe_agg_gpu6
	layer1_expert6_8 -> layer1_moe_agg_gpu6
	layer1_expert6_9 -> layer1_moe_agg_gpu6
	layer1_expert6_10 -> layer1_moe_agg_gpu6
	layer1_expert6_11 -> layer1_moe_agg_gpu6
	layer1_expert6_12 -> layer1_moe_agg_gpu6
	layer1_expert6_13 -> layer1_moe_agg_gpu6
	layer1_expert6_14 -> layer1_moe_agg_gpu6
	layer1_expert6_15 -> layer1_moe_agg_gpu6
	layer1_moe_agg_gpu6 -> layer1_output_gpu6
	layer1_qkv_gpu7 -> layer1_attn_gpu7
	layer1_attn_gpu7 -> layer1_attn_proj_gpu7
	layer1_attn_proj_gpu7 -> layer1_attn_norm_gpu7
	layer1_attn_norm_gpu7 -> layer1_gate_gpu7
	layer1_gate_gpu7 -> layer1_expert7_0 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_1 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_2 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_3 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_4 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_5 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_6 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_7 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_8 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_9 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_10 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_11 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_12 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_13 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_14 [style=dashed]
	layer1_gate_gpu7 -> layer1_expert7_15 [style=dashed]
	layer1_expert7_0 -> layer1_moe_agg_gpu7
	layer1_expert7_1 -> layer1_moe_agg_gpu7
	layer1_expert7_2 -> layer1_moe_agg_gpu7
	layer1_expert7_3 -> layer1_moe_agg_gpu7
	layer1_expert7_4 -> layer1_moe_agg_gpu7
	layer1_expert7_5 -> layer1_moe_agg_gpu7
	layer1_expert7_6 -> layer1_moe_agg_gpu7
	layer1_expert7_7 -> layer1_moe_agg_gpu7
	layer1_expert7_8 -> layer1_moe_agg_gpu7
	layer1_expert7_9 -> layer1_moe_agg_gpu7
	layer1_expert7_10 -> layer1_moe_agg_gpu7
	layer1_expert7_11 -> layer1_moe_agg_gpu7
	layer1_expert7_12 -> layer1_moe_agg_gpu7
	layer1_expert7_13 -> layer1_moe_agg_gpu7
	layer1_expert7_14 -> layer1_moe_agg_gpu7
	layer1_expert7_15 -> layer1_moe_agg_gpu7
	layer1_moe_agg_gpu7 -> layer1_output_gpu7
	layer1_attn_proj_gpu0 -> layer1_allreduce_attn
	layer1_allreduce_attn -> layer1_attn_norm_gpu0
	layer1_moe_agg_gpu0 -> layer1_allreduce_moe
	layer1_allreduce_moe -> layer1_output_gpu0
	layer1_attn_proj_gpu1 -> layer1_allreduce_attn
	layer1_allreduce_attn -> layer1_attn_norm_gpu1
	layer1_moe_agg_gpu1 -> layer1_allreduce_moe
	layer1_allreduce_moe -> layer1_output_gpu1
	layer1_attn_proj_gpu2 -> layer1_allreduce_attn
	layer1_allreduce_attn -> layer1_attn_norm_gpu2
	layer1_moe_agg_gpu2 -> layer1_allreduce_moe
	layer1_allreduce_moe -> layer1_output_gpu2
	layer1_attn_proj_gpu3 -> layer1_allreduce_attn
	layer1_allreduce_attn -> layer1_attn_norm_gpu3
	layer1_moe_agg_gpu3 -> layer1_allreduce_moe
	layer1_allreduce_moe -> layer1_output_gpu3
	layer1_attn_proj_gpu4 -> layer1_allreduce_attn
	layer1_allreduce_attn -> layer1_attn_norm_gpu4
	layer1_moe_agg_gpu4 -> layer1_allreduce_moe
	layer1_allreduce_moe -> layer1_output_gpu4
	layer1_attn_proj_gpu5 -> layer1_allreduce_attn
	layer1_allreduce_attn -> layer1_attn_norm_gpu5
	layer1_moe_agg_gpu5 -> layer1_allreduce_moe
	layer1_allreduce_moe -> layer1_output_gpu5
	layer1_attn_proj_gpu6 -> layer1_allreduce_attn
	layer1_allreduce_attn -> layer1_attn_norm_gpu6
	layer1_moe_agg_gpu6 -> layer1_allreduce_moe
	layer1_allreduce_moe -> layer1_output_gpu6
	layer1_attn_proj_gpu7 -> layer1_allreduce_attn
	layer1_allreduce_attn -> layer1_attn_norm_gpu7
	layer1_moe_agg_gpu7 -> layer1_allreduce_moe
	layer1_allreduce_moe -> layer1_output_gpu7
	layer1_output_gpu0 -> pipeline_stage0_1
	layer1_output_gpu1 -> pipeline_stage0_1
	layer1_output_gpu2 -> pipeline_stage0_1
	layer1_output_gpu3 -> pipeline_stage0_1
	layer1_output_gpu4 -> pipeline_stage0_1
	layer1_output_gpu5 -> pipeline_stage0_1
	layer1_output_gpu6 -> pipeline_stage0_1
	layer1_output_gpu7 -> pipeline_stage0_1
	pipeline_stage0_1 -> layer2_qkv_gpu8
	pipeline_stage0_1 -> layer2_qkv_gpu9
	pipeline_stage0_1 -> layer2_qkv_gpu10
	pipeline_stage0_1 -> layer2_qkv_gpu11
	pipeline_stage0_1 -> layer2_qkv_gpu12
	pipeline_stage0_1 -> layer2_qkv_gpu13
	pipeline_stage0_1 -> layer2_qkv_gpu14
	pipeline_stage0_1 -> layer2_qkv_gpu15
	layer2_qkv_gpu8 -> layer2_attn_gpu8
	layer2_attn_gpu8 -> layer2_attn_proj_gpu8
	layer2_attn_proj_gpu8 -> layer2_attn_norm_gpu8
	layer2_attn_norm_gpu8 -> layer2_gate_gpu8
	layer2_gate_gpu8 -> layer2_expert8_0 [style=dashed]
	layer2_gate_gpu8 -> layer2_expert8_1 [style=dashed]
	layer2_gate_gpu8 -> layer2_expert8_2 [style=dashed]
	layer2_gate_gpu8 -> layer2_expert8_3 [style=dashed]
	layer2_gate_gpu8 -> layer2_expert8_4 [style=dashed]
	layer2_gate_gpu8 -> layer2_expert8_5 [style=dashed]
	layer2_gate_gpu8 -> layer2_expert8_6 [style=dashed]
	layer2_gate_gpu8 -> layer2_expert8_7 [style=dashed]
	layer2_gate_gpu8 -> layer2_expert8_8 [style=dashed]
	layer2_gate_gpu8 -> layer2_expert8_9 [style=dashed]
	layer2_gate_gpu8 -> layer2_expert8_10 [style=dashed]
	layer2_gate_gpu8 -> layer2_expert8_11 [style=dashed]
	layer2_gate_gpu8 -> layer2_expert8_12 [style=dashed]
	layer2_gate_gpu8 -> layer2_expert8_13 [style=dashed]
	layer2_gate_gpu8 -> layer2_expert8_14 [style=dashed]
	layer2_gate_gpu8 -> layer2_expert8_15 [style=dashed]
	layer2_expert8_0 -> layer2_moe_agg_gpu8
	layer2_expert8_1 -> layer2_moe_agg_gpu8
	layer2_expert8_2 -> layer2_moe_agg_gpu8
	layer2_expert8_3 -> layer2_moe_agg_gpu8
	layer2_expert8_4 -> layer2_moe_agg_gpu8
	layer2_expert8_5 -> layer2_moe_agg_gpu8
	layer2_expert8_6 -> layer2_moe_agg_gpu8
	layer2_expert8_7 -> layer2_moe_agg_gpu8
	layer2_expert8_8 -> layer2_moe_agg_gpu8
	layer2_expert8_9 -> layer2_moe_agg_gpu8
	layer2_expert8_10 -> layer2_moe_agg_gpu8
	layer2_expert8_11 -> layer2_moe_agg_gpu8
	layer2_expert8_12 -> layer2_moe_agg_gpu8
	layer2_expert8_13 -> layer2_moe_agg_gpu8
	layer2_expert8_14 -> layer2_moe_agg_gpu8
	layer2_expert8_15 -> layer2_moe_agg_gpu8
	layer2_moe_agg_gpu8 -> layer2_output_gpu8
	layer2_qkv_gpu9 -> layer2_attn_gpu9
	layer2_attn_gpu9 -> layer2_attn_proj_gpu9
	layer2_attn_proj_gpu9 -> layer2_attn_norm_gpu9
	layer2_attn_norm_gpu9 -> layer2_gate_gpu9
	layer2_gate_gpu9 -> layer2_expert9_0 [style=dashed]
	layer2_gate_gpu9 -> layer2_expert9_1 [style=dashed]
	layer2_gate_gpu9 -> layer2_expert9_2 [style=dashed]
	layer2_gate_gpu9 -> layer2_expert9_3 [style=dashed]
	layer2_gate_gpu9 -> layer2_expert9_4 [style=dashed]
	layer2_gate_gpu9 -> layer2_expert9_5 [style=dashed]
	layer2_gate_gpu9 -> layer2_expert9_6 [style=dashed]
	layer2_gate_gpu9 -> layer2_expert9_7 [style=dashed]
	layer2_gate_gpu9 -> layer2_expert9_8 [style=dashed]
	layer2_gate_gpu9 -> layer2_expert9_9 [style=dashed]
	layer2_gate_gpu9 -> layer2_expert9_10 [style=dashed]
	layer2_gate_gpu9 -> layer2_expert9_11 [style=dashed]
	layer2_gate_gpu9 -> layer2_expert9_12 [style=dashed]
	layer2_gate_gpu9 -> layer2_expert9_13 [style=dashed]
	layer2_gate_gpu9 -> layer2_expert9_14 [style=dashed]
	layer2_gate_gpu9 -> layer2_expert9_15 [style=dashed]
	layer2_expert9_0 -> layer2_moe_agg_gpu9
	layer2_expert9_1 -> layer2_moe_agg_gpu9
	layer2_expert9_2 -> layer2_moe_agg_gpu9
	layer2_expert9_3 -> layer2_moe_agg_gpu9
	layer2_expert9_4 -> layer2_moe_agg_gpu9
	layer2_expert9_5 -> layer2_moe_agg_gpu9
	layer2_expert9_6 -> layer2_moe_agg_gpu9
	layer2_expert9_7 -> layer2_moe_agg_gpu9
	layer2_expert9_8 -> layer2_moe_agg_gpu9
	layer2_expert9_9 -> layer2_moe_agg_gpu9
	layer2_expert9_10 -> layer2_moe_agg_gpu9
	layer2_expert9_11 -> layer2_moe_agg_gpu9
	layer2_expert9_12 -> layer2_moe_agg_gpu9
	layer2_expert9_13 -> layer2_moe_agg_gpu9
	layer2_expert9_14 -> layer2_moe_agg_gpu9
	layer2_expert9_15 -> layer2_moe_agg_gpu9
	layer2_moe_agg_gpu9 -> layer2_output_gpu9
	layer2_qkv_gpu10 -> layer2_attn_gpu10
	layer2_attn_gpu10 -> layer2_attn_proj_gpu10
	layer2_attn_proj_gpu10 -> layer2_attn_norm_gpu10
	layer2_attn_norm_gpu10 -> layer2_gate_gpu10
	layer2_gate_gpu10 -> layer2_expert10_0 [style=dashed]
	layer2_gate_gpu10 -> layer2_expert10_1 [style=dashed]
	layer2_gate_gpu10 -> layer2_expert10_2 [style=dashed]
	layer2_gate_gpu10 -> layer2_expert10_3 [style=dashed]
	layer2_gate_gpu10 -> layer2_expert10_4 [style=dashed]
	layer2_gate_gpu10 -> layer2_expert10_5 [style=dashed]
	layer2_gate_gpu10 -> layer2_expert10_6 [style=dashed]
	layer2_gate_gpu10 -> layer2_expert10_7 [style=dashed]
	layer2_gate_gpu10 -> layer2_expert10_8 [style=dashed]
	layer2_gate_gpu10 -> layer2_expert10_9 [style=dashed]
	layer2_gate_gpu10 -> layer2_expert10_10 [style=dashed]
	layer2_gate_gpu10 -> layer2_expert10_11 [style=dashed]
	layer2_gate_gpu10 -> layer2_expert10_12 [style=dashed]
	layer2_gate_gpu10 -> layer2_expert10_13 [style=dashed]
	layer2_gate_gpu10 -> layer2_expert10_14 [style=dashed]
	layer2_gate_gpu10 -> layer2_expert10_15 [style=dashed]
	layer2_expert10_0 -> layer2_moe_agg_gpu10
	layer2_expert10_1 -> layer2_moe_agg_gpu10
	layer2_expert10_2 -> layer2_moe_agg_gpu10
	layer2_expert10_3 -> layer2_moe_agg_gpu10
	layer2_expert10_4 -> layer2_moe_agg_gpu10
	layer2_expert10_5 -> layer2_moe_agg_gpu10
	layer2_expert10_6 -> layer2_moe_agg_gpu10
	layer2_expert10_7 -> layer2_moe_agg_gpu10
	layer2_expert10_8 -> layer2_moe_agg_gpu10
	layer2_expert10_9 -> layer2_moe_agg_gpu10
	layer2_expert10_10 -> layer2_moe_agg_gpu10
	layer2_expert10_11 -> layer2_moe_agg_gpu10
	layer2_expert10_12 -> layer2_moe_agg_gpu10
	layer2_expert10_13 -> layer2_moe_agg_gpu10
	layer2_expert10_14 -> layer2_moe_agg_gpu10
	layer2_expert10_15 -> layer2_moe_agg_gpu10
	layer2_moe_agg_gpu10 -> layer2_output_gpu10
	layer2_qkv_gpu11 -> layer2_attn_gpu11
	layer2_attn_gpu11 -> layer2_attn_proj_gpu11
	layer2_attn_proj_gpu11 -> layer2_attn_norm_gpu11
	layer2_attn_norm_gpu11 -> layer2_gate_gpu11
	layer2_gate_gpu11 -> layer2_expert11_0 [style=dashed]
	layer2_gate_gpu11 -> layer2_expert11_1 [style=dashed]
	layer2_gate_gpu11 -> layer2_expert11_2 [style=dashed]
	layer2_gate_gpu11 -> layer2_expert11_3 [style=dashed]
	layer2_gate_gpu11 -> layer2_expert11_4 [style=dashed]
	layer2_gate_gpu11 -> layer2_expert11_5 [style=dashed]
	layer2_gate_gpu11 -> layer2_expert11_6 [style=dashed]
	layer2_gate_gpu11 -> layer2_expert11_7 [style=dashed]
	layer2_gate_gpu11 -> layer2_expert11_8 [style=dashed]
	layer2_gate_gpu11 -> layer2_expert11_9 [style=dashed]
	layer2_gate_gpu11 -> layer2_expert11_10 [style=dashed]
	layer2_gate_gpu11 -> layer2_expert11_11 [style=dashed]
	layer2_gate_gpu11 -> layer2_expert11_12 [style=dashed]
	layer2_gate_gpu11 -> layer2_expert11_13 [style=dashed]
	layer2_gate_gpu11 -> layer2_expert11_14 [style=dashed]
	layer2_gate_gpu11 -> layer2_expert11_15 [style=dashed]
	layer2_expert11_0 -> layer2_moe_agg_gpu11
	layer2_expert11_1 -> layer2_moe_agg_gpu11
	layer2_expert11_2 -> layer2_moe_agg_gpu11
	layer2_expert11_3 -> layer2_moe_agg_gpu11
	layer2_expert11_4 -> layer2_moe_agg_gpu11
	layer2_expert11_5 -> layer2_moe_agg_gpu11
	layer2_expert11_6 -> layer2_moe_agg_gpu11
	layer2_expert11_7 -> layer2_moe_agg_gpu11
	layer2_expert11_8 -> layer2_moe_agg_gpu11
	layer2_expert11_9 -> layer2_moe_agg_gpu11
	layer2_expert11_10 -> layer2_moe_agg_gpu11
	layer2_expert11_11 -> layer2_moe_agg_gpu11
	layer2_expert11_12 -> layer2_moe_agg_gpu11
	layer2_expert11_13 -> layer2_moe_agg_gpu11
	layer2_expert11_14 -> layer2_moe_agg_gpu11
	layer2_expert11_15 -> layer2_moe_agg_gpu11
	layer2_moe_agg_gpu11 -> layer2_output_gpu11
	layer2_qkv_gpu12 -> layer2_attn_gpu12
	layer2_attn_gpu12 -> layer2_attn_proj_gpu12
	layer2_attn_proj_gpu12 -> layer2_attn_norm_gpu12
	layer2_attn_norm_gpu12 -> layer2_gate_gpu12
	layer2_gate_gpu12 -> layer2_expert12_0 [style=dashed]
	layer2_gate_gpu12 -> layer2_expert12_1 [style=dashed]
	layer2_gate_gpu12 -> layer2_expert12_2 [style=dashed]
	layer2_gate_gpu12 -> layer2_expert12_3 [style=dashed]
	layer2_gate_gpu12 -> layer2_expert12_4 [style=dashed]
	layer2_gate_gpu12 -> layer2_expert12_5 [style=dashed]
	layer2_gate_gpu12 -> layer2_expert12_6 [style=dashed]
	layer2_gate_gpu12 -> layer2_expert12_7 [style=dashed]
	layer2_gate_gpu12 -> layer2_expert12_8 [style=dashed]
	layer2_gate_gpu12 -> layer2_expert12_9 [style=dashed]
	layer2_gate_gpu12 -> layer2_expert12_10 [style=dashed]
	layer2_gate_gpu12 -> layer2_expert12_11 [style=dashed]
	layer2_gate_gpu12 -> layer2_expert12_12 [style=dashed]
	layer2_gate_gpu12 -> layer2_expert12_13 [style=dashed]
	layer2_gate_gpu12 -> layer2_expert12_14 [style=dashed]
	layer2_gate_gpu12 -> layer2_expert12_15 [style=dashed]
	layer2_expert12_0 -> layer2_moe_agg_gpu12
	layer2_expert12_1 -> layer2_moe_agg_gpu12
	layer2_expert12_2 -> layer2_moe_agg_gpu12
	layer2_expert12_3 -> layer2_moe_agg_gpu12
	layer2_expert12_4 -> layer2_moe_agg_gpu12
	layer2_expert12_5 -> layer2_moe_agg_gpu12
	layer2_expert12_6 -> layer2_moe_agg_gpu12
	layer2_expert12_7 -> layer2_moe_agg_gpu12
	layer2_expert12_8 -> layer2_moe_agg_gpu12
	layer2_expert12_9 -> layer2_moe_agg_gpu12
	layer2_expert12_10 -> layer2_moe_agg_gpu12
	layer2_expert12_11 -> layer2_moe_agg_gpu12
	layer2_expert12_12 -> layer2_moe_agg_gpu12
	layer2_expert12_13 -> layer2_moe_agg_gpu12
	layer2_expert12_14 -> layer2_moe_agg_gpu12
	layer2_expert12_15 -> layer2_moe_agg_gpu12
	layer2_moe_agg_gpu12 -> layer2_output_gpu12
	layer2_qkv_gpu13 -> layer2_attn_gpu13
	layer2_attn_gpu13 -> layer2_attn_proj_gpu13
	layer2_attn_proj_gpu13 -> layer2_attn_norm_gpu13
	layer2_attn_norm_gpu13 -> layer2_gate_gpu13
	layer2_gate_gpu13 -> layer2_expert13_0 [style=dashed]
	layer2_gate_gpu13 -> layer2_expert13_1 [style=dashed]
	layer2_gate_gpu13 -> layer2_expert13_2 [style=dashed]
	layer2_gate_gpu13 -> layer2_expert13_3 [style=dashed]
	layer2_gate_gpu13 -> layer2_expert13_4 [style=dashed]
	layer2_gate_gpu13 -> layer2_expert13_5 [style=dashed]
	layer2_gate_gpu13 -> layer2_expert13_6 [style=dashed]
	layer2_gate_gpu13 -> layer2_expert13_7 [style=dashed]
	layer2_gate_gpu13 -> layer2_expert13_8 [style=dashed]
	layer2_gate_gpu13 -> layer2_expert13_9 [style=dashed]
	layer2_gate_gpu13 -> layer2_expert13_10 [style=dashed]
	layer2_gate_gpu13 -> layer2_expert13_11 [style=dashed]
	layer2_gate_gpu13 -> layer2_expert13_12 [style=dashed]
	layer2_gate_gpu13 -> layer2_expert13_13 [style=dashed]
	layer2_gate_gpu13 -> layer2_expert13_14 [style=dashed]
	layer2_gate_gpu13 -> layer2_expert13_15 [style=dashed]
	layer2_expert13_0 -> layer2_moe_agg_gpu13
	layer2_expert13_1 -> layer2_moe_agg_gpu13
	layer2_expert13_2 -> layer2_moe_agg_gpu13
	layer2_expert13_3 -> layer2_moe_agg_gpu13
	layer2_expert13_4 -> layer2_moe_agg_gpu13
	layer2_expert13_5 -> layer2_moe_agg_gpu13
	layer2_expert13_6 -> layer2_moe_agg_gpu13
	layer2_expert13_7 -> layer2_moe_agg_gpu13
	layer2_expert13_8 -> layer2_moe_agg_gpu13
	layer2_expert13_9 -> layer2_moe_agg_gpu13
	layer2_expert13_10 -> layer2_moe_agg_gpu13
	layer2_expert13_11 -> layer2_moe_agg_gpu13
	layer2_expert13_12 -> layer2_moe_agg_gpu13
	layer2_expert13_13 -> layer2_moe_agg_gpu13
	layer2_expert13_14 -> layer2_moe_agg_gpu13
	layer2_expert13_15 -> layer2_moe_agg_gpu13
	layer2_moe_agg_gpu13 -> layer2_output_gpu13
	layer2_qkv_gpu14 -> layer2_attn_gpu14
	layer2_attn_gpu14 -> layer2_attn_proj_gpu14
	layer2_attn_proj_gpu14 -> layer2_attn_norm_gpu14
	layer2_attn_norm_gpu14 -> layer2_gate_gpu14
	layer2_gate_gpu14 -> layer2_expert14_0 [style=dashed]
	layer2_gate_gpu14 -> layer2_expert14_1 [style=dashed]
	layer2_gate_gpu14 -> layer2_expert14_2 [style=dashed]
	layer2_gate_gpu14 -> layer2_expert14_3 [style=dashed]
	layer2_gate_gpu14 -> layer2_expert14_4 [style=dashed]
	layer2_gate_gpu14 -> layer2_expert14_5 [style=dashed]
	layer2_gate_gpu14 -> layer2_expert14_6 [style=dashed]
	layer2_gate_gpu14 -> layer2_expert14_7 [style=dashed]
	layer2_gate_gpu14 -> layer2_expert14_8 [style=dashed]
	layer2_gate_gpu14 -> layer2_expert14_9 [style=dashed]
	layer2_gate_gpu14 -> layer2_expert14_10 [style=dashed]
	layer2_gate_gpu14 -> layer2_expert14_11 [style=dashed]
	layer2_gate_gpu14 -> layer2_expert14_12 [style=dashed]
	layer2_gate_gpu14 -> layer2_expert14_13 [style=dashed]
	layer2_gate_gpu14 -> layer2_expert14_14 [style=dashed]
	layer2_gate_gpu14 -> layer2_expert14_15 [style=dashed]
	layer2_expert14_0 -> layer2_moe_agg_gpu14
	layer2_expert14_1 -> layer2_moe_agg_gpu14
	layer2_expert14_2 -> layer2_moe_agg_gpu14
	layer2_expert14_3 -> layer2_moe_agg_gpu14
	layer2_expert14_4 -> layer2_moe_agg_gpu14
	layer2_expert14_5 -> layer2_moe_agg_gpu14
	layer2_expert14_6 -> layer2_moe_agg_gpu14
	layer2_expert14_7 -> layer2_moe_agg_gpu14
	layer2_expert14_8 -> layer2_moe_agg_gpu14
	layer2_expert14_9 -> layer2_moe_agg_gpu14
	layer2_expert14_10 -> layer2_moe_agg_gpu14
	layer2_expert14_11 -> layer2_moe_agg_gpu14
	layer2_expert14_12 -> layer2_moe_agg_gpu14
	layer2_expert14_13 -> layer2_moe_agg_gpu14
	layer2_expert14_14 -> layer2_moe_agg_gpu14
	layer2_expert14_15 -> layer2_moe_agg_gpu14
	layer2_moe_agg_gpu14 -> layer2_output_gpu14
	layer2_qkv_gpu15 -> layer2_attn_gpu15
	layer2_attn_gpu15 -> layer2_attn_proj_gpu15
	layer2_attn_proj_gpu15 -> layer2_attn_norm_gpu15
	layer2_attn_norm_gpu15 -> layer2_gate_gpu15
	layer2_gate_gpu15 -> layer2_expert15_0 [style=dashed]
	layer2_gate_gpu15 -> layer2_expert15_1 [style=dashed]
	layer2_gate_gpu15 -> layer2_expert15_2 [style=dashed]
	layer2_gate_gpu15 -> layer2_expert15_3 [style=dashed]
	layer2_gate_gpu15 -> layer2_expert15_4 [style=dashed]
	layer2_gate_gpu15 -> layer2_expert15_5 [style=dashed]
	layer2_gate_gpu15 -> layer2_expert15_6 [style=dashed]
	layer2_gate_gpu15 -> layer2_expert15_7 [style=dashed]
	layer2_gate_gpu15 -> layer2_expert15_8 [style=dashed]
	layer2_gate_gpu15 -> layer2_expert15_9 [style=dashed]
	layer2_gate_gpu15 -> layer2_expert15_10 [style=dashed]
	layer2_gate_gpu15 -> layer2_expert15_11 [style=dashed]
	layer2_gate_gpu15 -> layer2_expert15_12 [style=dashed]
	layer2_gate_gpu15 -> layer2_expert15_13 [style=dashed]
	layer2_gate_gpu15 -> layer2_expert15_14 [style=dashed]
	layer2_gate_gpu15 -> layer2_expert15_15 [style=dashed]
	layer2_expert15_0 -> layer2_moe_agg_gpu15
	layer2_expert15_1 -> layer2_moe_agg_gpu15
	layer2_expert15_2 -> layer2_moe_agg_gpu15
	layer2_expert15_3 -> layer2_moe_agg_gpu15
	layer2_expert15_4 -> layer2_moe_agg_gpu15
	layer2_expert15_5 -> layer2_moe_agg_gpu15
	layer2_expert15_6 -> layer2_moe_agg_gpu15
	layer2_expert15_7 -> layer2_moe_agg_gpu15
	layer2_expert15_8 -> layer2_moe_agg_gpu15
	layer2_expert15_9 -> layer2_moe_agg_gpu15
	layer2_expert15_10 -> layer2_moe_agg_gpu15
	layer2_expert15_11 -> layer2_moe_agg_gpu15
	layer2_expert15_12 -> layer2_moe_agg_gpu15
	layer2_expert15_13 -> layer2_moe_agg_gpu15
	layer2_expert15_14 -> layer2_moe_agg_gpu15
	layer2_expert15_15 -> layer2_moe_agg_gpu15
	layer2_moe_agg_gpu15 -> layer2_output_gpu15
	layer2_attn_proj_gpu8 -> layer2_allreduce_attn
	layer2_allreduce_attn -> layer2_attn_norm_gpu8
	layer2_moe_agg_gpu8 -> layer2_allreduce_moe
	layer2_allreduce_moe -> layer2_output_gpu8
	layer2_attn_proj_gpu9 -> layer2_allreduce_attn
	layer2_allreduce_attn -> layer2_attn_norm_gpu9
	layer2_moe_agg_gpu9 -> layer2_allreduce_moe
	layer2_allreduce_moe -> layer2_output_gpu9
	layer2_attn_proj_gpu10 -> layer2_allreduce_attn
	layer2_allreduce_attn -> layer2_attn_norm_gpu10
	layer2_moe_agg_gpu10 -> layer2_allreduce_moe
	layer2_allreduce_moe -> layer2_output_gpu10
	layer2_attn_proj_gpu11 -> layer2_allreduce_attn
	layer2_allreduce_attn -> layer2_attn_norm_gpu11
	layer2_moe_agg_gpu11 -> layer2_allreduce_moe
	layer2_allreduce_moe -> layer2_output_gpu11
	layer2_attn_proj_gpu12 -> layer2_allreduce_attn
	layer2_allreduce_attn -> layer2_attn_norm_gpu12
	layer2_moe_agg_gpu12 -> layer2_allreduce_moe
	layer2_allreduce_moe -> layer2_output_gpu12
	layer2_attn_proj_gpu13 -> layer2_allreduce_attn
	layer2_allreduce_attn -> layer2_attn_norm_gpu13
	layer2_moe_agg_gpu13 -> layer2_allreduce_moe
	layer2_allreduce_moe -> layer2_output_gpu13
	layer2_attn_proj_gpu14 -> layer2_allreduce_attn
	layer2_allreduce_attn -> layer2_attn_norm_gpu14
	layer2_moe_agg_gpu14 -> layer2_allreduce_moe
	layer2_allreduce_moe -> layer2_output_gpu14
	layer2_attn_proj_gpu15 -> layer2_allreduce_attn
	layer2_allreduce_attn -> layer2_attn_norm_gpu15
	layer2_moe_agg_gpu15 -> layer2_allreduce_moe
	layer2_allreduce_moe -> layer2_output_gpu15
	layer3_qkv_gpu8 -> layer3_attn_gpu8
	layer3_attn_gpu8 -> layer3_attn_proj_gpu8
	layer3_attn_proj_gpu8 -> layer3_attn_norm_gpu8
	layer3_attn_norm_gpu8 -> layer3_gate_gpu8
	layer3_gate_gpu8 -> layer3_expert8_0 [style=dashed]
	layer3_gate_gpu8 -> layer3_expert8_1 [style=dashed]
	layer3_gate_gpu8 -> layer3_expert8_2 [style=dashed]
	layer3_gate_gpu8 -> layer3_expert8_3 [style=dashed]
	layer3_gate_gpu8 -> layer3_expert8_4 [style=dashed]
	layer3_gate_gpu8 -> layer3_expert8_5 [style=dashed]
	layer3_gate_gpu8 -> layer3_expert8_6 [style=dashed]
	layer3_gate_gpu8 -> layer3_expert8_7 [style=dashed]
	layer3_gate_gpu8 -> layer3_expert8_8 [style=dashed]
	layer3_gate_gpu8 -> layer3_expert8_9 [style=dashed]
	layer3_gate_gpu8 -> layer3_expert8_10 [style=dashed]
	layer3_gate_gpu8 -> layer3_expert8_11 [style=dashed]
	layer3_gate_gpu8 -> layer3_expert8_12 [style=dashed]
	layer3_gate_gpu8 -> layer3_expert8_13 [style=dashed]
	layer3_gate_gpu8 -> layer3_expert8_14 [style=dashed]
	layer3_gate_gpu8 -> layer3_expert8_15 [style=dashed]
	layer3_expert8_0 -> layer3_moe_agg_gpu8
	layer3_expert8_1 -> layer3_moe_agg_gpu8
	layer3_expert8_2 -> layer3_moe_agg_gpu8
	layer3_expert8_3 -> layer3_moe_agg_gpu8
	layer3_expert8_4 -> layer3_moe_agg_gpu8
	layer3_expert8_5 -> layer3_moe_agg_gpu8
	layer3_expert8_6 -> layer3_moe_agg_gpu8
	layer3_expert8_7 -> layer3_moe_agg_gpu8
	layer3_expert8_8 -> layer3_moe_agg_gpu8
	layer3_expert8_9 -> layer3_moe_agg_gpu8
	layer3_expert8_10 -> layer3_moe_agg_gpu8
	layer3_expert8_11 -> layer3_moe_agg_gpu8
	layer3_expert8_12 -> layer3_moe_agg_gpu8
	layer3_expert8_13 -> layer3_moe_agg_gpu8
	layer3_expert8_14 -> layer3_moe_agg_gpu8
	layer3_expert8_15 -> layer3_moe_agg_gpu8
	layer3_moe_agg_gpu8 -> layer3_output_gpu8
	layer3_qkv_gpu9 -> layer3_attn_gpu9
	layer3_attn_gpu9 -> layer3_attn_proj_gpu9
	layer3_attn_proj_gpu9 -> layer3_attn_norm_gpu9
	layer3_attn_norm_gpu9 -> layer3_gate_gpu9
	layer3_gate_gpu9 -> layer3_expert9_0 [style=dashed]
	layer3_gate_gpu9 -> layer3_expert9_1 [style=dashed]
	layer3_gate_gpu9 -> layer3_expert9_2 [style=dashed]
	layer3_gate_gpu9 -> layer3_expert9_3 [style=dashed]
	layer3_gate_gpu9 -> layer3_expert9_4 [style=dashed]
	layer3_gate_gpu9 -> layer3_expert9_5 [style=dashed]
	layer3_gate_gpu9 -> layer3_expert9_6 [style=dashed]
	layer3_gate_gpu9 -> layer3_expert9_7 [style=dashed]
	layer3_gate_gpu9 -> layer3_expert9_8 [style=dashed]
	layer3_gate_gpu9 -> layer3_expert9_9 [style=dashed]
	layer3_gate_gpu9 -> layer3_expert9_10 [style=dashed]
	layer3_gate_gpu9 -> layer3_expert9_11 [style=dashed]
	layer3_gate_gpu9 -> layer3_expert9_12 [style=dashed]
	layer3_gate_gpu9 -> layer3_expert9_13 [style=dashed]
	layer3_gate_gpu9 -> layer3_expert9_14 [style=dashed]
	layer3_gate_gpu9 -> layer3_expert9_15 [style=dashed]
	layer3_expert9_0 -> layer3_moe_agg_gpu9
	layer3_expert9_1 -> layer3_moe_agg_gpu9
	layer3_expert9_2 -> layer3_moe_agg_gpu9
	layer3_expert9_3 -> layer3_moe_agg_gpu9
	layer3_expert9_4 -> layer3_moe_agg_gpu9
	layer3_expert9_5 -> layer3_moe_agg_gpu9
	layer3_expert9_6 -> layer3_moe_agg_gpu9
	layer3_expert9_7 -> layer3_moe_agg_gpu9
	layer3_expert9_8 -> layer3_moe_agg_gpu9
	layer3_expert9_9 -> layer3_moe_agg_gpu9
	layer3_expert9_10 -> layer3_moe_agg_gpu9
	layer3_expert9_11 -> layer3_moe_agg_gpu9
	layer3_expert9_12 -> layer3_moe_agg_gpu9
	layer3_expert9_13 -> layer3_moe_agg_gpu9
	layer3_expert9_14 -> layer3_moe_agg_gpu9
	layer3_expert9_15 -> layer3_moe_agg_gpu9
	layer3_moe_agg_gpu9 -> layer3_output_gpu9
	layer3_qkv_gpu10 -> layer3_attn_gpu10
	layer3_attn_gpu10 -> layer3_attn_proj_gpu10
	layer3_attn_proj_gpu10 -> layer3_attn_norm_gpu10
	layer3_attn_norm_gpu10 -> layer3_gate_gpu10
	layer3_gate_gpu10 -> layer3_expert10_0 [style=dashed]
	layer3_gate_gpu10 -> layer3_expert10_1 [style=dashed]
	layer3_gate_gpu10 -> layer3_expert10_2 [style=dashed]
	layer3_gate_gpu10 -> layer3_expert10_3 [style=dashed]
	layer3_gate_gpu10 -> layer3_expert10_4 [style=dashed]
	layer3_gate_gpu10 -> layer3_expert10_5 [style=dashed]
	layer3_gate_gpu10 -> layer3_expert10_6 [style=dashed]
	layer3_gate_gpu10 -> layer3_expert10_7 [style=dashed]
	layer3_gate_gpu10 -> layer3_expert10_8 [style=dashed]
	layer3_gate_gpu10 -> layer3_expert10_9 [style=dashed]
	layer3_gate_gpu10 -> layer3_expert10_10 [style=dashed]
	layer3_gate_gpu10 -> layer3_expert10_11 [style=dashed]
	layer3_gate_gpu10 -> layer3_expert10_12 [style=dashed]
	layer3_gate_gpu10 -> layer3_expert10_13 [style=dashed]
	layer3_gate_gpu10 -> layer3_expert10_14 [style=dashed]
	layer3_gate_gpu10 -> layer3_expert10_15 [style=dashed]
	layer3_expert10_0 -> layer3_moe_agg_gpu10
	layer3_expert10_1 -> layer3_moe_agg_gpu10
	layer3_expert10_2 -> layer3_moe_agg_gpu10
	layer3_expert10_3 -> layer3_moe_agg_gpu10
	layer3_expert10_4 -> layer3_moe_agg_gpu10
	layer3_expert10_5 -> layer3_moe_agg_gpu10
	layer3_expert10_6 -> layer3_moe_agg_gpu10
	layer3_expert10_7 -> layer3_moe_agg_gpu10
	layer3_expert10_8 -> layer3_moe_agg_gpu10
	layer3_expert10_9 -> layer3_moe_agg_gpu10
	layer3_expert10_10 -> layer3_moe_agg_gpu10
	layer3_expert10_11 -> layer3_moe_agg_gpu10
	layer3_expert10_12 -> layer3_moe_agg_gpu10
	layer3_expert10_13 -> layer3_moe_agg_gpu10
	layer3_expert10_14 -> layer3_moe_agg_gpu10
	layer3_expert10_15 -> layer3_moe_agg_gpu10
	layer3_moe_agg_gpu10 -> layer3_output_gpu10
	layer3_qkv_gpu11 -> layer3_attn_gpu11
	layer3_attn_gpu11 -> layer3_attn_proj_gpu11
	layer3_attn_proj_gpu11 -> layer3_attn_norm_gpu11
	layer3_attn_norm_gpu11 -> layer3_gate_gpu11
	layer3_gate_gpu11 -> layer3_expert11_0 [style=dashed]
	layer3_gate_gpu11 -> layer3_expert11_1 [style=dashed]
	layer3_gate_gpu11 -> layer3_expert11_2 [style=dashed]
	layer3_gate_gpu11 -> layer3_expert11_3 [style=dashed]
	layer3_gate_gpu11 -> layer3_expert11_4 [style=dashed]
	layer3_gate_gpu11 -> layer3_expert11_5 [style=dashed]
	layer3_gate_gpu11 -> layer3_expert11_6 [style=dashed]
	layer3_gate_gpu11 -> layer3_expert11_7 [style=dashed]
	layer3_gate_gpu11 -> layer3_expert11_8 [style=dashed]
	layer3_gate_gpu11 -> layer3_expert11_9 [style=dashed]
	layer3_gate_gpu11 -> layer3_expert11_10 [style=dashed]
	layer3_gate_gpu11 -> layer3_expert11_11 [style=dashed]
	layer3_gate_gpu11 -> layer3_expert11_12 [style=dashed]
	layer3_gate_gpu11 -> layer3_expert11_13 [style=dashed]
	layer3_gate_gpu11 -> layer3_expert11_14 [style=dashed]
	layer3_gate_gpu11 -> layer3_expert11_15 [style=dashed]
	layer3_expert11_0 -> layer3_moe_agg_gpu11
	layer3_expert11_1 -> layer3_moe_agg_gpu11
	layer3_expert11_2 -> layer3_moe_agg_gpu11
	layer3_expert11_3 -> layer3_moe_agg_gpu11
	layer3_expert11_4 -> layer3_moe_agg_gpu11
	layer3_expert11_5 -> layer3_moe_agg_gpu11
	layer3_expert11_6 -> layer3_moe_agg_gpu11
	layer3_expert11_7 -> layer3_moe_agg_gpu11
	layer3_expert11_8 -> layer3_moe_agg_gpu11
	layer3_expert11_9 -> layer3_moe_agg_gpu11
	layer3_expert11_10 -> layer3_moe_agg_gpu11
	layer3_expert11_11 -> layer3_moe_agg_gpu11
	layer3_expert11_12 -> layer3_moe_agg_gpu11
	layer3_expert11_13 -> layer3_moe_agg_gpu11
	layer3_expert11_14 -> layer3_moe_agg_gpu11
	layer3_expert11_15 -> layer3_moe_agg_gpu11
	layer3_moe_agg_gpu11 -> layer3_output_gpu11
	layer3_qkv_gpu12 -> layer3_attn_gpu12
	layer3_attn_gpu12 -> layer3_attn_proj_gpu12
	layer3_attn_proj_gpu12 -> layer3_attn_norm_gpu12
	layer3_attn_norm_gpu12 -> layer3_gate_gpu12
	layer3_gate_gpu12 -> layer3_expert12_0 [style=dashed]
	layer3_gate_gpu12 -> layer3_expert12_1 [style=dashed]
	layer3_gate_gpu12 -> layer3_expert12_2 [style=dashed]
	layer3_gate_gpu12 -> layer3_expert12_3 [style=dashed]
	layer3_gate_gpu12 -> layer3_expert12_4 [style=dashed]
	layer3_gate_gpu12 -> layer3_expert12_5 [style=dashed]
	layer3_gate_gpu12 -> layer3_expert12_6 [style=dashed]
	layer3_gate_gpu12 -> layer3_expert12_7 [style=dashed]
	layer3_gate_gpu12 -> layer3_expert12_8 [style=dashed]
	layer3_gate_gpu12 -> layer3_expert12_9 [style=dashed]
	layer3_gate_gpu12 -> layer3_expert12_10 [style=dashed]
	layer3_gate_gpu12 -> layer3_expert12_11 [style=dashed]
	layer3_gate_gpu12 -> layer3_expert12_12 [style=dashed]
	layer3_gate_gpu12 -> layer3_expert12_13 [style=dashed]
	layer3_gate_gpu12 -> layer3_expert12_14 [style=dashed]
	layer3_gate_gpu12 -> layer3_expert12_15 [style=dashed]
	layer3_expert12_0 -> layer3_moe_agg_gpu12
	layer3_expert12_1 -> layer3_moe_agg_gpu12
	layer3_expert12_2 -> layer3_moe_agg_gpu12
	layer3_expert12_3 -> layer3_moe_agg_gpu12
	layer3_expert12_4 -> layer3_moe_agg_gpu12
	layer3_expert12_5 -> layer3_moe_agg_gpu12
	layer3_expert12_6 -> layer3_moe_agg_gpu12
	layer3_expert12_7 -> layer3_moe_agg_gpu12
	layer3_expert12_8 -> layer3_moe_agg_gpu12
	layer3_expert12_9 -> layer3_moe_agg_gpu12
	layer3_expert12_10 -> layer3_moe_agg_gpu12
	layer3_expert12_11 -> layer3_moe_agg_gpu12
	layer3_expert12_12 -> layer3_moe_agg_gpu12
	layer3_expert12_13 -> layer3_moe_agg_gpu12
	layer3_expert12_14 -> layer3_moe_agg_gpu12
	layer3_expert12_15 -> layer3_moe_agg_gpu12
	layer3_moe_agg_gpu12 -> layer3_output_gpu12
	layer3_qkv_gpu13 -> layer3_attn_gpu13
	layer3_attn_gpu13 -> layer3_attn_proj_gpu13
	layer3_attn_proj_gpu13 -> layer3_attn_norm_gpu13
	layer3_attn_norm_gpu13 -> layer3_gate_gpu13
	layer3_gate_gpu13 -> layer3_expert13_0 [style=dashed]
	layer3_gate_gpu13 -> layer3_expert13_1 [style=dashed]
	layer3_gate_gpu13 -> layer3_expert13_2 [style=dashed]
	layer3_gate_gpu13 -> layer3_expert13_3 [style=dashed]
	layer3_gate_gpu13 -> layer3_expert13_4 [style=dashed]
	layer3_gate_gpu13 -> layer3_expert13_5 [style=dashed]
	layer3_gate_gpu13 -> layer3_expert13_6 [style=dashed]
	layer3_gate_gpu13 -> layer3_expert13_7 [style=dashed]
	layer3_gate_gpu13 -> layer3_expert13_8 [style=dashed]
	layer3_gate_gpu13 -> layer3_expert13_9 [style=dashed]
	layer3_gate_gpu13 -> layer3_expert13_10 [style=dashed]
	layer3_gate_gpu13 -> layer3_expert13_11 [style=dashed]
	layer3_gate_gpu13 -> layer3_expert13_12 [style=dashed]
	layer3_gate_gpu13 -> layer3_expert13_13 [style=dashed]
	layer3_gate_gpu13 -> layer3_expert13_14 [style=dashed]
	layer3_gate_gpu13 -> layer3_expert13_15 [style=dashed]
	layer3_expert13_0 -> layer3_moe_agg_gpu13
	layer3_expert13_1 -> layer3_moe_agg_gpu13
	layer3_expert13_2 -> layer3_moe_agg_gpu13
	layer3_expert13_3 -> layer3_moe_agg_gpu13
	layer3_expert13_4 -> layer3_moe_agg_gpu13
	layer3_expert13_5 -> layer3_moe_agg_gpu13
	layer3_expert13_6 -> layer3_moe_agg_gpu13
	layer3_expert13_7 -> layer3_moe_agg_gpu13
	layer3_expert13_8 -> layer3_moe_agg_gpu13
	layer3_expert13_9 -> layer3_moe_agg_gpu13
	layer3_expert13_10 -> layer3_moe_agg_gpu13
	layer3_expert13_11 -> layer3_moe_agg_gpu13
	layer3_expert13_12 -> layer3_moe_agg_gpu13
	layer3_expert13_13 -> layer3_moe_agg_gpu13
	layer3_expert13_14 -> layer3_moe_agg_gpu13
	layer3_expert13_15 -> layer3_moe_agg_gpu13
	layer3_moe_agg_gpu13 -> layer3_output_gpu13
	layer3_qkv_gpu14 -> layer3_attn_gpu14
	layer3_attn_gpu14 -> layer3_attn_proj_gpu14
	layer3_attn_proj_gpu14 -> layer3_attn_norm_gpu14
	layer3_attn_norm_gpu14 -> layer3_gate_gpu14
	layer3_gate_gpu14 -> layer3_expert14_0 [style=dashed]
	layer3_gate_gpu14 -> layer3_expert14_1 [style=dashed]
	layer3_gate_gpu14 -> layer3_expert14_2 [style=dashed]
	layer3_gate_gpu14 -> layer3_expert14_3 [style=dashed]
	layer3_gate_gpu14 -> layer3_expert14_4 [style=dashed]
	layer3_gate_gpu14 -> layer3_expert14_5 [style=dashed]
	layer3_gate_gpu14 -> layer3_expert14_6 [style=dashed]
	layer3_gate_gpu14 -> layer3_expert14_7 [style=dashed]
	layer3_gate_gpu14 -> layer3_expert14_8 [style=dashed]
	layer3_gate_gpu14 -> layer3_expert14_9 [style=dashed]
	layer3_gate_gpu14 -> layer3_expert14_10 [style=dashed]
	layer3_gate_gpu14 -> layer3_expert14_11 [style=dashed]
	layer3_gate_gpu14 -> layer3_expert14_12 [style=dashed]
	layer3_gate_gpu14 -> layer3_expert14_13 [style=dashed]
	layer3_gate_gpu14 -> layer3_expert14_14 [style=dashed]
	layer3_gate_gpu14 -> layer3_expert14_15 [style=dashed]
	layer3_expert14_0 -> layer3_moe_agg_gpu14
	layer3_expert14_1 -> layer3_moe_agg_gpu14
	layer3_expert14_2 -> layer3_moe_agg_gpu14
	layer3_expert14_3 -> layer3_moe_agg_gpu14
	layer3_expert14_4 -> layer3_moe_agg_gpu14
	layer3_expert14_5 -> layer3_moe_agg_gpu14
	layer3_expert14_6 -> layer3_moe_agg_gpu14
	layer3_expert14_7 -> layer3_moe_agg_gpu14
	layer3_expert14_8 -> layer3_moe_agg_gpu14
	layer3_expert14_9 -> layer3_moe_agg_gpu14
	layer3_expert14_10 -> layer3_moe_agg_gpu14
	layer3_expert14_11 -> layer3_moe_agg_gpu14
	layer3_expert14_12 -> layer3_moe_agg_gpu14
	layer3_expert14_13 -> layer3_moe_agg_gpu14
	layer3_expert14_14 -> layer3_moe_agg_gpu14
	layer3_expert14_15 -> layer3_moe_agg_gpu14
	layer3_moe_agg_gpu14 -> layer3_output_gpu14
	layer3_qkv_gpu15 -> layer3_attn_gpu15
	layer3_attn_gpu15 -> layer3_attn_proj_gpu15
	layer3_attn_proj_gpu15 -> layer3_attn_norm_gpu15
	layer3_attn_norm_gpu15 -> layer3_gate_gpu15
	layer3_gate_gpu15 -> layer3_expert15_0 [style=dashed]
	layer3_gate_gpu15 -> layer3_expert15_1 [style=dashed]
	layer3_gate_gpu15 -> layer3_expert15_2 [style=dashed]
	layer3_gate_gpu15 -> layer3_expert15_3 [style=dashed]
	layer3_gate_gpu15 -> layer3_expert15_4 [style=dashed]
	layer3_gate_gpu15 -> layer3_expert15_5 [style=dashed]
	layer3_gate_gpu15 -> layer3_expert15_6 [style=dashed]
	layer3_gate_gpu15 -> layer3_expert15_7 [style=dashed]
	layer3_gate_gpu15 -> layer3_expert15_8 [style=dashed]
	layer3_gate_gpu15 -> layer3_expert15_9 [style=dashed]
	layer3_gate_gpu15 -> layer3_expert15_10 [style=dashed]
	layer3_gate_gpu15 -> layer3_expert15_11 [style=dashed]
	layer3_gate_gpu15 -> layer3_expert15_12 [style=dashed]
	layer3_gate_gpu15 -> layer3_expert15_13 [style=dashed]
	layer3_gate_gpu15 -> layer3_expert15_14 [style=dashed]
	layer3_gate_gpu15 -> layer3_expert15_15 [style=dashed]
	layer3_expert15_0 -> layer3_moe_agg_gpu15
	layer3_expert15_1 -> layer3_moe_agg_gpu15
	layer3_expert15_2 -> layer3_moe_agg_gpu15
	layer3_expert15_3 -> layer3_moe_agg_gpu15
	layer3_expert15_4 -> layer3_moe_agg_gpu15
	layer3_expert15_5 -> layer3_moe_agg_gpu15
	layer3_expert15_6 -> layer3_moe_agg_gpu15
	layer3_expert15_7 -> layer3_moe_agg_gpu15
	layer3_expert15_8 -> layer3_moe_agg_gpu15
	layer3_expert15_9 -> layer3_moe_agg_gpu15
	layer3_expert15_10 -> layer3_moe_agg_gpu15
	layer3_expert15_11 -> layer3_moe_agg_gpu15
	layer3_expert15_12 -> layer3_moe_agg_gpu15
	layer3_expert15_13 -> layer3_moe_agg_gpu15
	layer3_expert15_14 -> layer3_moe_agg_gpu15
	layer3_expert15_15 -> layer3_moe_agg_gpu15
	layer3_moe_agg_gpu15 -> layer3_output_gpu15
	layer3_attn_proj_gpu8 -> layer3_allreduce_attn
	layer3_allreduce_attn -> layer3_attn_norm_gpu8
	layer3_moe_agg_gpu8 -> layer3_allreduce_moe
	layer3_allreduce_moe -> layer3_output_gpu8
	layer3_attn_proj_gpu9 -> layer3_allreduce_attn
	layer3_allreduce_attn -> layer3_attn_norm_gpu9
	layer3_moe_agg_gpu9 -> layer3_allreduce_moe
	layer3_allreduce_moe -> layer3_output_gpu9
	layer3_attn_proj_gpu10 -> layer3_allreduce_attn
	layer3_allreduce_attn -> layer3_attn_norm_gpu10
	layer3_moe_agg_gpu10 -> layer3_allreduce_moe
	layer3_allreduce_moe -> layer3_output_gpu10
	layer3_attn_proj_gpu11 -> layer3_allreduce_attn
	layer3_allreduce_attn -> layer3_attn_norm_gpu11
	layer3_moe_agg_gpu11 -> layer3_allreduce_moe
	layer3_allreduce_moe -> layer3_output_gpu11
	layer3_attn_proj_gpu12 -> layer3_allreduce_attn
	layer3_allreduce_attn -> layer3_attn_norm_gpu12
	layer3_moe_agg_gpu12 -> layer3_allreduce_moe
	layer3_allreduce_moe -> layer3_output_gpu12
	layer3_attn_proj_gpu13 -> layer3_allreduce_attn
	layer3_allreduce_attn -> layer3_attn_norm_gpu13
	layer3_moe_agg_gpu13 -> layer3_allreduce_moe
	layer3_allreduce_moe -> layer3_output_gpu13
	layer3_attn_proj_gpu14 -> layer3_allreduce_attn
	layer3_allreduce_attn -> layer3_attn_norm_gpu14
	layer3_moe_agg_gpu14 -> layer3_allreduce_moe
	layer3_allreduce_moe -> layer3_output_gpu14
	layer3_attn_proj_gpu15 -> layer3_allreduce_attn
	layer3_allreduce_attn -> layer3_attn_norm_gpu15
	layer3_moe_agg_gpu15 -> layer3_allreduce_moe
	layer3_allreduce_moe -> layer3_output_gpu15
	layer3_output_gpu8 -> output
	layer3_output_gpu9 -> output
	layer3_output_gpu10 -> output
	layer3_output_gpu11 -> output
	layer3_output_gpu12 -> output
	layer3_output_gpu13 -> output
	layer3_output_gpu14 -> output
	layer3_output_gpu15 -> output
}
