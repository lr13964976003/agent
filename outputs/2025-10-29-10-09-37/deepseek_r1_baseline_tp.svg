<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: DeepSeek_R1_Baseline_TP Pages: 1 -->
<svg width="1435pt" height="1440pt"
 viewBox="0.00 0.00 1434.63 1440.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.62 0.62) rotate(0) translate(4 2328.09)">
<title>DeepSeek_R1_Baseline_TP</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2328.09 2319.4,-2328.09 2319.4,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightgreen" stroke="black" cx="1216" cy="-2276.01" rx="306.77" ry="48.17"/>
<text text-anchor="middle" x="1216" y="-2294.81" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="1216" y="-2279.81" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1216" y="-2264.81" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1216" y="-2249.81" font-family="Times,serif" font-size="14.00">Device: CPU</text>
</g>
<!-- split_all_gpus -->
<g id="node2" class="node">
<title>split_all_gpus</title>
<polygon fill="yellow" stroke="black" points="1665.9,-2191.93 950.21,-2191.93 766.1,-2055.93 1481.79,-2055.93 1665.9,-2191.93"/>
<text text-anchor="middle" x="1216" y="-2142.73" font-family="Times,serif" font-size="14.00">Split Input</text>
<text text-anchor="middle" x="1216" y="-2127.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1216" y="-2112.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1216" y="-2097.73" font-family="Times,serif" font-size="14.00">Device: all GPUs</text>
</g>
<!-- input&#45;&gt;split_all_gpus -->
<g id="edge1" class="edge">
<title>input&#45;&gt;split_all_gpus</title>
<path fill="none" stroke="black" d="M1216,-2227.52C1216,-2219.44 1216,-2210.85 1216,-2202.23"/>
<polygon fill="black" stroke="black" points="1219.5,-2202.12 1216,-2192.12 1212.5,-2202.12 1219.5,-2202.12"/>
</g>
<!-- qkv_proj_gpu_0 -->
<g id="node3" class="node">
<title>qkv_proj_gpu_0</title>
<polygon fill="lightcoral" stroke="black" points="472,-2019.93 0,-2019.93 0,-1936.93 472,-1936.93 472,-2019.93"/>
<text text-anchor="middle" x="236" y="-2004.73" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="236" y="-1989.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="236" y="-1974.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=128, d_k=32]</text>
<text text-anchor="middle" x="236" y="-1959.73" font-family="Times,serif" font-size="14.00">Device: gpu_0</text>
<text text-anchor="middle" x="236" y="-1944.73" font-family="Times,serif" font-size="14.00">Columns: 0&#45;4095</text>
</g>
<!-- split_all_gpus&#45;&gt;qkv_proj_gpu_0 -->
<g id="edge2" class="edge">
<title>split_all_gpus&#45;&gt;qkv_proj_gpu_0</title>
<path fill="none" stroke="black" d="M775.58,-2063.01C681.62,-2049.74 582.8,-2035.42 482.36,-2020.12"/>
<polygon fill="black" stroke="black" points="482.73,-2016.64 472.32,-2018.59 481.67,-2023.56 482.73,-2016.64"/>
</g>
<!-- qkv_proj_gpu_1 -->
<g id="node4" class="node">
<title>qkv_proj_gpu_1</title>
<polygon fill="lightcoral" stroke="black" points="962,-2019.93 490,-2019.93 490,-1936.93 962,-1936.93 962,-2019.93"/>
<text text-anchor="middle" x="726" y="-2004.73" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="726" y="-1989.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="726" y="-1974.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=128, d_k=32]</text>
<text text-anchor="middle" x="726" y="-1959.73" font-family="Times,serif" font-size="14.00">Device: gpu_1</text>
<text text-anchor="middle" x="726" y="-1944.73" font-family="Times,serif" font-size="14.00">Columns: 4096&#45;8191</text>
</g>
<!-- split_all_gpus&#45;&gt;qkv_proj_gpu_1 -->
<g id="edge5" class="edge">
<title>split_all_gpus&#45;&gt;qkv_proj_gpu_1</title>
<path fill="none" stroke="black" d="M987.14,-2055.9C948.86,-2044.69 910.05,-2033.33 874.47,-2022.91"/>
<polygon fill="black" stroke="black" points="875.11,-2019.45 864.53,-2019.99 873.14,-2026.16 875.11,-2019.45"/>
</g>
<!-- qkv_proj_gpu_2 -->
<g id="node5" class="node">
<title>qkv_proj_gpu_2</title>
<polygon fill="lightcoral" stroke="black" points="1452,-2019.93 980,-2019.93 980,-1936.93 1452,-1936.93 1452,-2019.93"/>
<text text-anchor="middle" x="1216" y="-2004.73" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1216" y="-1989.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1216" y="-1974.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=128, d_k=32]</text>
<text text-anchor="middle" x="1216" y="-1959.73" font-family="Times,serif" font-size="14.00">Device: gpu_2</text>
<text text-anchor="middle" x="1216" y="-1944.73" font-family="Times,serif" font-size="14.00">Columns: 8192&#45;12287</text>
</g>
<!-- split_all_gpus&#45;&gt;qkv_proj_gpu_2 -->
<g id="edge8" class="edge">
<title>split_all_gpus&#45;&gt;qkv_proj_gpu_2</title>
<path fill="none" stroke="black" d="M1216,-2055.8C1216,-2047.18 1216,-2038.48 1216,-2030.18"/>
<polygon fill="black" stroke="black" points="1219.5,-2029.93 1216,-2019.93 1212.5,-2029.93 1219.5,-2029.93"/>
</g>
<!-- qkv_proj_gpu_3 -->
<g id="node6" class="node">
<title>qkv_proj_gpu_3</title>
<polygon fill="lightcoral" stroke="black" points="1942,-2019.93 1470,-2019.93 1470,-1936.93 1942,-1936.93 1942,-2019.93"/>
<text text-anchor="middle" x="1706" y="-2004.73" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1706" y="-1989.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1706" y="-1974.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=128, d_k=32]</text>
<text text-anchor="middle" x="1706" y="-1959.73" font-family="Times,serif" font-size="14.00">Device: gpu_3</text>
<text text-anchor="middle" x="1706" y="-1944.73" font-family="Times,serif" font-size="14.00">Columns: 12288&#45;16383</text>
</g>
<!-- split_all_gpus&#45;&gt;qkv_proj_gpu_3 -->
<g id="edge11" class="edge">
<title>split_all_gpus&#45;&gt;qkv_proj_gpu_3</title>
<path fill="none" stroke="black" d="M1444.86,-2055.9C1483.14,-2044.69 1521.95,-2033.33 1557.53,-2022.91"/>
<polygon fill="black" stroke="black" points="1558.86,-2026.16 1567.47,-2019.99 1556.89,-2019.45 1558.86,-2026.16"/>
</g>
<!-- residual_attn -->
<g id="node21" class="node">
<title>residual_attn</title>
<ellipse fill="lightgreen" stroke="black" cx="1628" cy="-1096.24" rx="306.77" ry="58.88"/>
<text text-anchor="middle" x="1628" y="-1122.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="1628" y="-1107.54" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="1628" y="-1092.54" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1628" y="-1077.54" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1628" y="-1062.54" font-family="Times,serif" font-size="14.00">Device: all GPUs</text>
</g>
<!-- split_all_gpus&#45;&gt;residual_attn -->
<g id="edge27" class="edge">
<title>split_all_gpus&#45;&gt;residual_attn</title>
<path fill="none" stroke="black" d="M1561.12,-2114.18C1724.41,-2102.42 1895.66,-2076.42 1951,-2019.93 2000.96,-1968.93 1970,-1931.82 1970,-1860.43 1970,-1860.43 1970,-1860.43 1970,-1433.43 1970,-1306.74 1849.18,-1211.88 1751.16,-1155.78"/>
<polygon fill="black" stroke="black" points="1752.79,-1152.67 1742.36,-1150.8 1749.34,-1158.77 1752.79,-1152.67"/>
</g>
<!-- kv_cache_gpu_0 -->
<g id="node7" class="node">
<title>kv_cache_gpu_0</title>
<polygon fill="lightpink" stroke="black" points="467.5,-1900.93 4.5,-1900.93 4.5,-1817.93 467.5,-1817.93 467.5,-1900.93"/>
<text text-anchor="middle" x="236" y="-1885.73" font-family="Times,serif" font-size="14.00">KV Cache</text>
<text text-anchor="middle" x="236" y="-1870.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="236" y="-1855.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="236" y="-1840.73" font-family="Times,serif" font-size="14.00">Device: gpu_0</text>
<text text-anchor="middle" x="236" y="-1825.73" font-family="Times,serif" font-size="14.00">DUPLICATED &#45; Limitation</text>
</g>
<!-- qkv_proj_gpu_0&#45;&gt;kv_cache_gpu_0 -->
<g id="edge3" class="edge">
<title>qkv_proj_gpu_0&#45;&gt;kv_cache_gpu_0</title>
<path fill="none" stroke="black" d="M236,-1936.83C236,-1928.58 236,-1919.79 236,-1911.23"/>
<polygon fill="black" stroke="black" points="239.5,-1910.95 236,-1900.95 232.5,-1910.95 239.5,-1910.95"/>
</g>
<!-- kv_cache_gpu_1 -->
<g id="node8" class="node">
<title>kv_cache_gpu_1</title>
<polygon fill="lightpink" stroke="black" points="957.5,-1900.93 494.5,-1900.93 494.5,-1817.93 957.5,-1817.93 957.5,-1900.93"/>
<text text-anchor="middle" x="726" y="-1885.73" font-family="Times,serif" font-size="14.00">KV Cache</text>
<text text-anchor="middle" x="726" y="-1870.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="726" y="-1855.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="726" y="-1840.73" font-family="Times,serif" font-size="14.00">Device: gpu_1</text>
<text text-anchor="middle" x="726" y="-1825.73" font-family="Times,serif" font-size="14.00">DUPLICATED &#45; Limitation</text>
</g>
<!-- qkv_proj_gpu_1&#45;&gt;kv_cache_gpu_1 -->
<g id="edge6" class="edge">
<title>qkv_proj_gpu_1&#45;&gt;kv_cache_gpu_1</title>
<path fill="none" stroke="black" d="M726,-1936.83C726,-1928.58 726,-1919.79 726,-1911.23"/>
<polygon fill="black" stroke="black" points="729.5,-1910.95 726,-1900.95 722.5,-1910.95 729.5,-1910.95"/>
</g>
<!-- kv_cache_gpu_2 -->
<g id="node9" class="node">
<title>kv_cache_gpu_2</title>
<polygon fill="lightpink" stroke="black" points="1447.5,-1900.93 984.5,-1900.93 984.5,-1817.93 1447.5,-1817.93 1447.5,-1900.93"/>
<text text-anchor="middle" x="1216" y="-1885.73" font-family="Times,serif" font-size="14.00">KV Cache</text>
<text text-anchor="middle" x="1216" y="-1870.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="1216" y="-1855.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="1216" y="-1840.73" font-family="Times,serif" font-size="14.00">Device: gpu_2</text>
<text text-anchor="middle" x="1216" y="-1825.73" font-family="Times,serif" font-size="14.00">DUPLICATED &#45; Limitation</text>
</g>
<!-- qkv_proj_gpu_2&#45;&gt;kv_cache_gpu_2 -->
<g id="edge9" class="edge">
<title>qkv_proj_gpu_2&#45;&gt;kv_cache_gpu_2</title>
<path fill="none" stroke="black" d="M1216,-1936.83C1216,-1928.58 1216,-1919.79 1216,-1911.23"/>
<polygon fill="black" stroke="black" points="1219.5,-1910.95 1216,-1900.95 1212.5,-1910.95 1219.5,-1910.95"/>
</g>
<!-- kv_cache_gpu_3 -->
<g id="node10" class="node">
<title>kv_cache_gpu_3</title>
<polygon fill="lightpink" stroke="black" points="1937.5,-1900.93 1474.5,-1900.93 1474.5,-1817.93 1937.5,-1817.93 1937.5,-1900.93"/>
<text text-anchor="middle" x="1706" y="-1885.73" font-family="Times,serif" font-size="14.00">KV Cache</text>
<text text-anchor="middle" x="1706" y="-1870.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="1706" y="-1855.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="1706" y="-1840.73" font-family="Times,serif" font-size="14.00">Device: gpu_3</text>
<text text-anchor="middle" x="1706" y="-1825.73" font-family="Times,serif" font-size="14.00">DUPLICATED &#45; Limitation</text>
</g>
<!-- qkv_proj_gpu_3&#45;&gt;kv_cache_gpu_3 -->
<g id="edge12" class="edge">
<title>qkv_proj_gpu_3&#45;&gt;kv_cache_gpu_3</title>
<path fill="none" stroke="black" d="M1706,-1936.83C1706,-1928.58 1706,-1919.79 1706,-1911.23"/>
<polygon fill="black" stroke="black" points="1709.5,-1910.95 1706,-1900.95 1702.5,-1910.95 1709.5,-1910.95"/>
</g>
<!-- flash_attn_gpu_0 -->
<g id="node11" class="node">
<title>flash_attn_gpu_0</title>
<polygon fill="lightblue" stroke="black" points="472,-1781.93 0,-1781.93 0,-1713.93 472,-1713.93 472,-1781.93"/>
<text text-anchor="middle" x="236" y="-1766.73" font-family="Times,serif" font-size="14.00">FlashAttention</text>
<text text-anchor="middle" x="236" y="-1751.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, heads=32, d_k=128]</text>
<text text-anchor="middle" x="236" y="-1736.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=32, d_k=128]</text>
<text text-anchor="middle" x="236" y="-1721.73" font-family="Times,serif" font-size="14.00">Device: gpu_0</text>
</g>
<!-- kv_cache_gpu_0&#45;&gt;flash_attn_gpu_0 -->
<g id="edge4" class="edge">
<title>kv_cache_gpu_0&#45;&gt;flash_attn_gpu_0</title>
<path fill="none" stroke="black" d="M236,-1817.65C236,-1809.44 236,-1800.79 236,-1792.49"/>
<polygon fill="black" stroke="black" points="239.5,-1792.23 236,-1782.23 232.5,-1792.23 239.5,-1792.23"/>
</g>
<!-- flash_attn_gpu_1 -->
<g id="node12" class="node">
<title>flash_attn_gpu_1</title>
<polygon fill="lightblue" stroke="black" points="962,-1781.93 490,-1781.93 490,-1713.93 962,-1713.93 962,-1781.93"/>
<text text-anchor="middle" x="726" y="-1766.73" font-family="Times,serif" font-size="14.00">FlashAttention</text>
<text text-anchor="middle" x="726" y="-1751.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, heads=32, d_k=128]</text>
<text text-anchor="middle" x="726" y="-1736.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=32, d_k=128]</text>
<text text-anchor="middle" x="726" y="-1721.73" font-family="Times,serif" font-size="14.00">Device: gpu_1</text>
</g>
<!-- kv_cache_gpu_1&#45;&gt;flash_attn_gpu_1 -->
<g id="edge7" class="edge">
<title>kv_cache_gpu_1&#45;&gt;flash_attn_gpu_1</title>
<path fill="none" stroke="black" d="M726,-1817.65C726,-1809.44 726,-1800.79 726,-1792.49"/>
<polygon fill="black" stroke="black" points="729.5,-1792.23 726,-1782.23 722.5,-1792.23 729.5,-1792.23"/>
</g>
<!-- flash_attn_gpu_2 -->
<g id="node13" class="node">
<title>flash_attn_gpu_2</title>
<polygon fill="lightblue" stroke="black" points="1452,-1781.93 980,-1781.93 980,-1713.93 1452,-1713.93 1452,-1781.93"/>
<text text-anchor="middle" x="1216" y="-1766.73" font-family="Times,serif" font-size="14.00">FlashAttention</text>
<text text-anchor="middle" x="1216" y="-1751.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, heads=32, d_k=128]</text>
<text text-anchor="middle" x="1216" y="-1736.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=32, d_k=128]</text>
<text text-anchor="middle" x="1216" y="-1721.73" font-family="Times,serif" font-size="14.00">Device: gpu_2</text>
</g>
<!-- kv_cache_gpu_2&#45;&gt;flash_attn_gpu_2 -->
<g id="edge10" class="edge">
<title>kv_cache_gpu_2&#45;&gt;flash_attn_gpu_2</title>
<path fill="none" stroke="black" d="M1216,-1817.65C1216,-1809.44 1216,-1800.79 1216,-1792.49"/>
<polygon fill="black" stroke="black" points="1219.5,-1792.23 1216,-1782.23 1212.5,-1792.23 1219.5,-1792.23"/>
</g>
<!-- flash_attn_gpu_3 -->
<g id="node14" class="node">
<title>flash_attn_gpu_3</title>
<polygon fill="lightblue" stroke="black" points="1942,-1781.93 1470,-1781.93 1470,-1713.93 1942,-1713.93 1942,-1781.93"/>
<text text-anchor="middle" x="1706" y="-1766.73" font-family="Times,serif" font-size="14.00">FlashAttention</text>
<text text-anchor="middle" x="1706" y="-1751.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, heads=32, d_k=128]</text>
<text text-anchor="middle" x="1706" y="-1736.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=32, d_k=128]</text>
<text text-anchor="middle" x="1706" y="-1721.73" font-family="Times,serif" font-size="14.00">Device: gpu_3</text>
</g>
<!-- kv_cache_gpu_3&#45;&gt;flash_attn_gpu_3 -->
<g id="edge13" class="edge">
<title>kv_cache_gpu_3&#45;&gt;flash_attn_gpu_3</title>
<path fill="none" stroke="black" d="M1706,-1817.65C1706,-1809.44 1706,-1800.79 1706,-1792.49"/>
<polygon fill="black" stroke="black" points="1709.5,-1792.23 1706,-1782.23 1702.5,-1792.23 1709.5,-1792.23"/>
</g>
<!-- attn_all_reduce -->
<g id="node15" class="node">
<title>attn_all_reduce</title>
<polygon fill="yellow" stroke="black" points="1527.86,-1677.93 734.29,-1677.93 530.14,-1511.93 1323.71,-1511.93 1527.86,-1677.93"/>
<text text-anchor="middle" x="1029" y="-1621.23" font-family="Times,serif" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1029" y="-1606.23" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="1029" y="-1591.23" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="1029" y="-1576.23" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="1029" y="-1561.23" font-family="Times,serif" font-size="14.00">Device: all GPUs</text>
</g>
<!-- flash_attn_gpu_0&#45;&gt;attn_all_reduce -->
<g id="edge14" class="edge">
<title>flash_attn_gpu_0&#45;&gt;attn_all_reduce</title>
<path fill="none" stroke="black" d="M409.54,-1713.88C494.24,-1697.75 599.04,-1677.8 698.21,-1658.91"/>
<polygon fill="black" stroke="black" points="698.93,-1662.34 708.1,-1657.03 697.62,-1655.46 698.93,-1662.34"/>
</g>
<!-- flash_attn_gpu_1&#45;&gt;attn_all_reduce -->
<g id="edge17" class="edge">
<title>flash_attn_gpu_1&#45;&gt;attn_all_reduce</title>
<path fill="none" stroke="black" d="M792.49,-1713.79C811.4,-1704.37 832.92,-1693.64 855.1,-1682.59"/>
<polygon fill="black" stroke="black" points="856.91,-1685.6 864.3,-1678 853.79,-1679.33 856.91,-1685.6"/>
</g>
<!-- flash_attn_gpu_2&#45;&gt;attn_all_reduce -->
<g id="edge20" class="edge">
<title>flash_attn_gpu_2&#45;&gt;attn_all_reduce</title>
<path fill="none" stroke="black" d="M1174.96,-1713.79C1164.01,-1704.95 1151.64,-1694.96 1138.85,-1684.63"/>
<polygon fill="black" stroke="black" points="1140.82,-1681.72 1130.84,-1678.16 1136.42,-1687.16 1140.82,-1681.72"/>
</g>
<!-- flash_attn_gpu_3&#45;&gt;attn_all_reduce -->
<g id="edge23" class="edge">
<title>flash_attn_gpu_3&#45;&gt;attn_all_reduce</title>
<path fill="none" stroke="black" d="M1557.85,-1713.88C1512.42,-1703.75 1460.22,-1692.11 1406.69,-1680.17"/>
<polygon fill="black" stroke="black" points="1407.2,-1676.7 1396.68,-1677.93 1405.68,-1683.53 1407.2,-1676.7"/>
</g>
<!-- attn_out_gpu_0 -->
<g id="node16" class="node">
<title>attn_out_gpu_0</title>
<polygon fill="lightcoral" stroke="black" points="612.5,-1475.93 187.5,-1475.93 187.5,-1392.93 612.5,-1392.93 612.5,-1475.93"/>
<text text-anchor="middle" x="400" y="-1460.73" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="400" y="-1445.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=4096]</text>
<text text-anchor="middle" x="400" y="-1430.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=4096]</text>
<text text-anchor="middle" x="400" y="-1415.73" font-family="Times,serif" font-size="14.00">Device: gpu_0</text>
<text text-anchor="middle" x="400" y="-1400.73" font-family="Times,serif" font-size="14.00">Rows: 0&#45;4095</text>
</g>
<!-- attn_all_reduce&#45;&gt;attn_out_gpu_0 -->
<g id="edge15" class="edge">
<title>attn_all_reduce&#45;&gt;attn_out_gpu_0</title>
<path fill="none" stroke="black" d="M703.45,-1511.89C657.65,-1500.35 612.18,-1488.89 570.9,-1478.49"/>
<polygon fill="black" stroke="black" points="571.61,-1475.06 561.06,-1476.01 569.9,-1481.85 571.61,-1475.06"/>
</g>
<!-- attn_out_gpu_1 -->
<g id="node17" class="node">
<title>attn_out_gpu_1</title>
<polygon fill="lightcoral" stroke="black" points="1055.5,-1475.93 630.5,-1475.93 630.5,-1392.93 1055.5,-1392.93 1055.5,-1475.93"/>
<text text-anchor="middle" x="843" y="-1460.73" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="843" y="-1445.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=4096]</text>
<text text-anchor="middle" x="843" y="-1430.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=4096]</text>
<text text-anchor="middle" x="843" y="-1415.73" font-family="Times,serif" font-size="14.00">Device: gpu_1</text>
<text text-anchor="middle" x="843" y="-1400.73" font-family="Times,serif" font-size="14.00">Rows: 4096&#45;8191</text>
</g>
<!-- attn_all_reduce&#45;&gt;attn_out_gpu_1 -->
<g id="edge18" class="edge">
<title>attn_all_reduce&#45;&gt;attn_out_gpu_1</title>
<path fill="none" stroke="black" d="M932.73,-1511.89C921.03,-1501.92 909.4,-1492.01 898.59,-1482.79"/>
<polygon fill="black" stroke="black" points="900.74,-1480.03 890.86,-1476.21 896.2,-1485.36 900.74,-1480.03"/>
</g>
<!-- attn_out_gpu_2 -->
<g id="node18" class="node">
<title>attn_out_gpu_2</title>
<polygon fill="lightcoral" stroke="black" points="1498.5,-1475.93 1073.5,-1475.93 1073.5,-1392.93 1498.5,-1392.93 1498.5,-1475.93"/>
<text text-anchor="middle" x="1286" y="-1460.73" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="1286" y="-1445.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=4096]</text>
<text text-anchor="middle" x="1286" y="-1430.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=4096]</text>
<text text-anchor="middle" x="1286" y="-1415.73" font-family="Times,serif" font-size="14.00">Device: gpu_2</text>
<text text-anchor="middle" x="1286" y="-1400.73" font-family="Times,serif" font-size="14.00">Rows: 8192&#45;12287</text>
</g>
<!-- attn_all_reduce&#45;&gt;attn_out_gpu_2 -->
<g id="edge21" class="edge">
<title>attn_all_reduce&#45;&gt;attn_out_gpu_2</title>
<path fill="none" stroke="black" d="M1162.02,-1511.89C1179.07,-1501.37 1196.01,-1490.92 1211.65,-1481.28"/>
<polygon fill="black" stroke="black" points="1213.52,-1484.24 1220.19,-1476.01 1209.85,-1478.28 1213.52,-1484.24"/>
</g>
<!-- attn_out_gpu_3 -->
<g id="node19" class="node">
<title>attn_out_gpu_3</title>
<polygon fill="lightcoral" stroke="black" points="1941.5,-1475.93 1516.5,-1475.93 1516.5,-1392.93 1941.5,-1392.93 1941.5,-1475.93"/>
<text text-anchor="middle" x="1729" y="-1460.73" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="1729" y="-1445.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=4096]</text>
<text text-anchor="middle" x="1729" y="-1430.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=4096]</text>
<text text-anchor="middle" x="1729" y="-1415.73" font-family="Times,serif" font-size="14.00">Device: gpu_3</text>
<text text-anchor="middle" x="1729" y="-1400.73" font-family="Times,serif" font-size="14.00">Rows: 12288&#45;16383</text>
</g>
<!-- attn_all_reduce&#45;&gt;attn_out_gpu_3 -->
<g id="edge24" class="edge">
<title>attn_all_reduce&#45;&gt;attn_out_gpu_3</title>
<path fill="none" stroke="black" d="M1338.58,-1523.83C1407.19,-1508.29 1477.9,-1492.28 1539.97,-1478.23"/>
<polygon fill="black" stroke="black" points="1540.88,-1481.61 1549.86,-1475.99 1539.33,-1474.78 1540.88,-1481.61"/>
</g>
<!-- attn_out_all_reduce -->
<g id="node20" class="node">
<title>attn_out_all_reduce</title>
<polygon fill="yellow" stroke="black" points="1735.9,-1356.93 1020.21,-1356.93 836.1,-1190.93 1551.79,-1190.93 1735.9,-1356.93"/>
<text text-anchor="middle" x="1286" y="-1300.23" font-family="Times,serif" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1286" y="-1285.23" font-family="Times,serif" font-size="14.00">Final Attention</text>
<text text-anchor="middle" x="1286" y="-1270.23" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1286" y="-1255.23" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1286" y="-1240.23" font-family="Times,serif" font-size="14.00">Device: all GPUs</text>
</g>
<!-- attn_out_gpu_0&#45;&gt;attn_out_all_reduce -->
<g id="edge16" class="edge">
<title>attn_out_gpu_0&#45;&gt;attn_out_all_reduce</title>
<path fill="none" stroke="black" d="M612.6,-1394.44C615.41,-1393.93 618.22,-1393.43 621,-1392.93 737.21,-1371.97 864.91,-1349.24 977.06,-1329.37"/>
<polygon fill="black" stroke="black" points="977.94,-1332.77 987.18,-1327.58 976.72,-1325.88 977.94,-1332.77"/>
</g>
<!-- attn_out_gpu_1&#45;&gt;attn_out_all_reduce -->
<g id="edge19" class="edge">
<title>attn_out_gpu_1&#45;&gt;attn_out_all_reduce</title>
<path fill="none" stroke="black" d="M956.22,-1392.92C984.22,-1382.9 1015.27,-1371.79 1046.81,-1360.51"/>
<polygon fill="black" stroke="black" points="1048.37,-1363.66 1056.61,-1357 1046.01,-1357.07 1048.37,-1363.66"/>
</g>
<!-- attn_out_gpu_2&#45;&gt;attn_out_all_reduce -->
<g id="edge22" class="edge">
<title>attn_out_gpu_2&#45;&gt;attn_out_all_reduce</title>
<path fill="none" stroke="black" d="M1286,-1392.61C1286,-1384.68 1286,-1376.07 1286,-1367.24"/>
<polygon fill="black" stroke="black" points="1289.5,-1367.2 1286,-1357.2 1282.5,-1367.2 1289.5,-1367.2"/>
</g>
<!-- attn_out_gpu_3&#45;&gt;attn_out_all_reduce -->
<g id="edge25" class="edge">
<title>attn_out_gpu_3&#45;&gt;attn_out_all_reduce</title>
<path fill="none" stroke="black" d="M1615.78,-1392.92C1587.78,-1382.9 1556.73,-1371.79 1525.19,-1360.51"/>
<polygon fill="black" stroke="black" points="1525.99,-1357.07 1515.39,-1357 1523.63,-1363.66 1525.99,-1357.07"/>
</g>
<!-- attn_out_all_reduce&#45;&gt;residual_attn -->
<g id="edge26" class="edge">
<title>attn_out_all_reduce&#45;&gt;residual_attn</title>
<path fill="none" stroke="black" d="M1445.74,-1190.87C1468.67,-1179.08 1491.88,-1167.16 1513.71,-1155.95"/>
<polygon fill="black" stroke="black" points="1515.35,-1159.04 1522.64,-1151.36 1512.15,-1152.82 1515.35,-1159.04"/>
</g>
<!-- rmsnorm1 -->
<g id="node22" class="node">
<title>rmsnorm1</title>
<polygon fill="lightgray" stroke="black" points="1845,-1001.55 1411,-1001.55 1411,-933.55 1845,-933.55 1845,-1001.55"/>
<text text-anchor="middle" x="1628" y="-986.35" font-family="Times,serif" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1628" y="-971.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1628" y="-956.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1628" y="-941.35" font-family="Times,serif" font-size="14.00">Device: all GPUs</text>
</g>
<!-- residual_attn&#45;&gt;rmsnorm1 -->
<g id="edge28" class="edge">
<title>residual_attn&#45;&gt;rmsnorm1</title>
<path fill="none" stroke="black" d="M1628,-1037.45C1628,-1028.83 1628,-1020.06 1628,-1011.8"/>
<polygon fill="black" stroke="black" points="1631.5,-1011.66 1628,-1001.66 1624.5,-1011.66 1631.5,-1011.66"/>
</g>
<!-- ffn_fc1_gpu_0 -->
<g id="node23" class="node">
<title>ffn_fc1_gpu_0</title>
<polygon fill="lightblue" stroke="black" points="962.5,-897.55 549.5,-897.55 549.5,-814.55 962.5,-814.55 962.5,-897.55"/>
<text text-anchor="middle" x="756" y="-882.35" font-family="Times,serif" font-size="14.00">FFN FC1</text>
<text text-anchor="middle" x="756" y="-867.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=4096]</text>
<text text-anchor="middle" x="756" y="-852.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=16384]</text>
<text text-anchor="middle" x="756" y="-837.35" font-family="Times,serif" font-size="14.00">Device: gpu_0</text>
<text text-anchor="middle" x="756" y="-822.35" font-family="Times,serif" font-size="14.00">Columns: 0&#45;16383</text>
</g>
<!-- rmsnorm1&#45;&gt;ffn_fc1_gpu_0 -->
<g id="edge29" class="edge">
<title>rmsnorm1&#45;&gt;ffn_fc1_gpu_0</title>
<path fill="none" stroke="black" d="M1410.83,-947.58C1284.27,-935.51 1121.77,-918.26 978,-897.55 976.27,-897.3 974.53,-897.04 972.78,-896.79"/>
<polygon fill="black" stroke="black" points="973.12,-893.3 962.71,-895.28 972.09,-900.22 973.12,-893.3"/>
</g>
<!-- ffn_fc1_gpu_1 -->
<g id="node24" class="node">
<title>ffn_fc1_gpu_1</title>
<polygon fill="lightblue" stroke="black" points="1400.5,-897.55 987.5,-897.55 987.5,-814.55 1400.5,-814.55 1400.5,-897.55"/>
<text text-anchor="middle" x="1194" y="-882.35" font-family="Times,serif" font-size="14.00">FFN FC1</text>
<text text-anchor="middle" x="1194" y="-867.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=4096]</text>
<text text-anchor="middle" x="1194" y="-852.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=16384]</text>
<text text-anchor="middle" x="1194" y="-837.35" font-family="Times,serif" font-size="14.00">Device: gpu_1</text>
<text text-anchor="middle" x="1194" y="-822.35" font-family="Times,serif" font-size="14.00">Columns: 16384&#45;32767</text>
</g>
<!-- rmsnorm1&#45;&gt;ffn_fc1_gpu_1 -->
<g id="edge33" class="edge">
<title>rmsnorm1&#45;&gt;ffn_fc1_gpu_1</title>
<path fill="none" stroke="black" d="M1497.2,-933.54C1455.55,-923.04 1408.84,-911.25 1364.79,-900.14"/>
<polygon fill="black" stroke="black" points="1365.4,-896.68 1354.85,-897.63 1363.69,-903.47 1365.4,-896.68"/>
</g>
<!-- ffn_fc1_gpu_2 -->
<g id="node25" class="node">
<title>ffn_fc1_gpu_2</title>
<polygon fill="lightblue" stroke="black" points="1834.5,-897.55 1421.5,-897.55 1421.5,-814.55 1834.5,-814.55 1834.5,-897.55"/>
<text text-anchor="middle" x="1628" y="-882.35" font-family="Times,serif" font-size="14.00">FFN FC1</text>
<text text-anchor="middle" x="1628" y="-867.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=4096]</text>
<text text-anchor="middle" x="1628" y="-852.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=16384]</text>
<text text-anchor="middle" x="1628" y="-837.35" font-family="Times,serif" font-size="14.00">Device: gpu_2</text>
<text text-anchor="middle" x="1628" y="-822.35" font-family="Times,serif" font-size="14.00">Columns: 32768&#45;49151</text>
</g>
<!-- rmsnorm1&#45;&gt;ffn_fc1_gpu_2 -->
<g id="edge37" class="edge">
<title>rmsnorm1&#45;&gt;ffn_fc1_gpu_2</title>
<path fill="none" stroke="black" d="M1628,-933.4C1628,-925.34 1628,-916.55 1628,-907.88"/>
<polygon fill="black" stroke="black" points="1631.5,-907.82 1628,-897.82 1624.5,-907.82 1631.5,-907.82"/>
</g>
<!-- ffn_fc1_gpu_3 -->
<g id="node26" class="node">
<title>ffn_fc1_gpu_3</title>
<polygon fill="lightblue" stroke="black" points="2268.5,-897.55 1855.5,-897.55 1855.5,-814.55 2268.5,-814.55 2268.5,-897.55"/>
<text text-anchor="middle" x="2062" y="-882.35" font-family="Times,serif" font-size="14.00">FFN FC1</text>
<text text-anchor="middle" x="2062" y="-867.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=4096]</text>
<text text-anchor="middle" x="2062" y="-852.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=16384]</text>
<text text-anchor="middle" x="2062" y="-837.35" font-family="Times,serif" font-size="14.00">Device: gpu_3</text>
<text text-anchor="middle" x="2062" y="-822.35" font-family="Times,serif" font-size="14.00">Columns: 49152&#45;65535</text>
</g>
<!-- rmsnorm1&#45;&gt;ffn_fc1_gpu_3 -->
<g id="edge41" class="edge">
<title>rmsnorm1&#45;&gt;ffn_fc1_gpu_3</title>
<path fill="none" stroke="black" d="M1758.8,-933.54C1800.45,-923.04 1847.16,-911.25 1891.21,-900.14"/>
<polygon fill="black" stroke="black" points="1892.31,-903.47 1901.15,-897.63 1890.6,-896.68 1892.31,-903.47"/>
</g>
<!-- residual_ffn -->
<g id="node36" class="node">
<title>residual_ffn</title>
<ellipse fill="lightgreen" stroke="black" cx="1970" cy="-294.86" rx="306.77" ry="58.88"/>
<text text-anchor="middle" x="1970" y="-321.16" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="1970" y="-306.16" font-family="Times,serif" font-size="14.00">FFN</text>
<text text-anchor="middle" x="1970" y="-291.16" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1970" y="-276.16" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1970" y="-261.16" font-family="Times,serif" font-size="14.00">Device: all GPUs</text>
</g>
<!-- rmsnorm1&#45;&gt;residual_ffn -->
<g id="edge46" class="edge">
<title>rmsnorm1&#45;&gt;residual_ffn</title>
<path fill="none" stroke="black" d="M1845.43,-955.92C2021.6,-945.28 2245.74,-926.32 2278,-897.55 2329.67,-851.47 2312,-814.77 2312,-745.55 2312,-745.55 2312,-745.55 2312,-632.05 2312,-505.36 2191.18,-410.5 2093.16,-354.4"/>
<polygon fill="black" stroke="black" points="2094.79,-351.29 2084.36,-349.42 2091.34,-357.39 2094.79,-351.29"/>
</g>
<!-- ffn_act_gpu_0 -->
<g id="node27" class="node">
<title>ffn_act_gpu_0</title>
<polygon fill="lightblue" stroke="black" points="954,-778.55 550,-778.55 550,-710.55 954,-710.55 954,-778.55"/>
<text text-anchor="middle" x="752" y="-763.35" font-family="Times,serif" font-size="14.00">SwiGLU Activation</text>
<text text-anchor="middle" x="752" y="-748.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=16384]</text>
<text text-anchor="middle" x="752" y="-733.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=16384]</text>
<text text-anchor="middle" x="752" y="-718.35" font-family="Times,serif" font-size="14.00">Device: gpu_0</text>
</g>
<!-- ffn_fc1_gpu_0&#45;&gt;ffn_act_gpu_0 -->
<g id="edge30" class="edge">
<title>ffn_fc1_gpu_0&#45;&gt;ffn_act_gpu_0</title>
<path fill="none" stroke="black" d="M754.51,-814.27C754.21,-806.06 753.89,-797.41 753.59,-789.11"/>
<polygon fill="black" stroke="black" points="757.08,-788.71 753.22,-778.85 750.08,-788.97 757.08,-788.71"/>
</g>
<!-- ffn_act_gpu_1 -->
<g id="node28" class="node">
<title>ffn_act_gpu_1</title>
<polygon fill="lightblue" stroke="black" points="1391,-778.55 987,-778.55 987,-710.55 1391,-710.55 1391,-778.55"/>
<text text-anchor="middle" x="1189" y="-763.35" font-family="Times,serif" font-size="14.00">SwiGLU Activation</text>
<text text-anchor="middle" x="1189" y="-748.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=16384]</text>
<text text-anchor="middle" x="1189" y="-733.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=16384]</text>
<text text-anchor="middle" x="1189" y="-718.35" font-family="Times,serif" font-size="14.00">Device: gpu_1</text>
</g>
<!-- ffn_fc1_gpu_1&#45;&gt;ffn_act_gpu_1 -->
<g id="edge34" class="edge">
<title>ffn_fc1_gpu_1&#45;&gt;ffn_act_gpu_1</title>
<path fill="none" stroke="black" d="M1192.14,-814.27C1191.76,-806.06 1191.37,-797.41 1190.99,-789.11"/>
<polygon fill="black" stroke="black" points="1194.47,-788.68 1190.52,-778.85 1187.48,-789 1194.47,-788.68"/>
</g>
<!-- ffn_act_gpu_2 -->
<g id="node29" class="node">
<title>ffn_act_gpu_2</title>
<polygon fill="lightblue" stroke="black" points="1830,-778.55 1426,-778.55 1426,-710.55 1830,-710.55 1830,-778.55"/>
<text text-anchor="middle" x="1628" y="-763.35" font-family="Times,serif" font-size="14.00">SwiGLU Activation</text>
<text text-anchor="middle" x="1628" y="-748.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=16384]</text>
<text text-anchor="middle" x="1628" y="-733.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=16384]</text>
<text text-anchor="middle" x="1628" y="-718.35" font-family="Times,serif" font-size="14.00">Device: gpu_2</text>
</g>
<!-- ffn_fc1_gpu_2&#45;&gt;ffn_act_gpu_2 -->
<g id="edge38" class="edge">
<title>ffn_fc1_gpu_2&#45;&gt;ffn_act_gpu_2</title>
<path fill="none" stroke="black" d="M1628,-814.27C1628,-806.06 1628,-797.41 1628,-789.11"/>
<polygon fill="black" stroke="black" points="1631.5,-788.85 1628,-778.85 1624.5,-788.85 1631.5,-788.85"/>
</g>
<!-- ffn_act_gpu_3 -->
<g id="node30" class="node">
<title>ffn_act_gpu_3</title>
<polygon fill="lightblue" stroke="black" points="2267,-778.55 1863,-778.55 1863,-710.55 2267,-710.55 2267,-778.55"/>
<text text-anchor="middle" x="2065" y="-763.35" font-family="Times,serif" font-size="14.00">SwiGLU Activation</text>
<text text-anchor="middle" x="2065" y="-748.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=16384]</text>
<text text-anchor="middle" x="2065" y="-733.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=16384]</text>
<text text-anchor="middle" x="2065" y="-718.35" font-family="Times,serif" font-size="14.00">Device: gpu_3</text>
</g>
<!-- ffn_fc1_gpu_3&#45;&gt;ffn_act_gpu_3 -->
<g id="edge42" class="edge">
<title>ffn_fc1_gpu_3&#45;&gt;ffn_act_gpu_3</title>
<path fill="none" stroke="black" d="M2063.12,-814.27C2063.34,-806.06 2063.58,-797.41 2063.81,-789.11"/>
<polygon fill="black" stroke="black" points="2067.31,-788.94 2064.09,-778.85 2060.32,-788.75 2067.31,-788.94"/>
</g>
<!-- ffn_fc2_gpu_0 -->
<g id="node31" class="node">
<title>ffn_fc2_gpu_0</title>
<polygon fill="lightblue" stroke="black" points="954.5,-674.55 529.5,-674.55 529.5,-591.55 954.5,-591.55 954.5,-674.55"/>
<text text-anchor="middle" x="742" y="-659.35" font-family="Times,serif" font-size="14.00">FFN FC2</text>
<text text-anchor="middle" x="742" y="-644.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=16384]</text>
<text text-anchor="middle" x="742" y="-629.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=4096]</text>
<text text-anchor="middle" x="742" y="-614.35" font-family="Times,serif" font-size="14.00">Device: gpu_0</text>
<text text-anchor="middle" x="742" y="-599.35" font-family="Times,serif" font-size="14.00">Rows: 0&#45;4095</text>
</g>
<!-- ffn_act_gpu_0&#45;&gt;ffn_fc2_gpu_0 -->
<g id="edge31" class="edge">
<title>ffn_act_gpu_0&#45;&gt;ffn_fc2_gpu_0</title>
<path fill="none" stroke="black" d="M748.97,-710.4C748.24,-702.34 747.43,-693.55 746.64,-684.88"/>
<polygon fill="black" stroke="black" points="750.12,-684.46 745.72,-674.82 743.15,-685.1 750.12,-684.46"/>
</g>
<!-- ffn_fc2_gpu_1 -->
<g id="node32" class="node">
<title>ffn_fc2_gpu_1</title>
<polygon fill="lightblue" stroke="black" points="1397.5,-674.55 972.5,-674.55 972.5,-591.55 1397.5,-591.55 1397.5,-674.55"/>
<text text-anchor="middle" x="1185" y="-659.35" font-family="Times,serif" font-size="14.00">FFN FC2</text>
<text text-anchor="middle" x="1185" y="-644.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=16384]</text>
<text text-anchor="middle" x="1185" y="-629.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=4096]</text>
<text text-anchor="middle" x="1185" y="-614.35" font-family="Times,serif" font-size="14.00">Device: gpu_1</text>
<text text-anchor="middle" x="1185" y="-599.35" font-family="Times,serif" font-size="14.00">Rows: 4096&#45;8191</text>
</g>
<!-- ffn_act_gpu_1&#45;&gt;ffn_fc2_gpu_1 -->
<g id="edge35" class="edge">
<title>ffn_act_gpu_1&#45;&gt;ffn_fc2_gpu_1</title>
<path fill="none" stroke="black" d="M1187.79,-710.4C1187.49,-702.34 1187.17,-693.55 1186.86,-684.88"/>
<polygon fill="black" stroke="black" points="1190.35,-684.69 1186.49,-674.82 1183.36,-684.94 1190.35,-684.69"/>
</g>
<!-- ffn_fc2_gpu_2 -->
<g id="node33" class="node">
<title>ffn_fc2_gpu_2</title>
<polygon fill="lightblue" stroke="black" points="1840.5,-674.55 1415.5,-674.55 1415.5,-591.55 1840.5,-591.55 1840.5,-674.55"/>
<text text-anchor="middle" x="1628" y="-659.35" font-family="Times,serif" font-size="14.00">FFN FC2</text>
<text text-anchor="middle" x="1628" y="-644.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=16384]</text>
<text text-anchor="middle" x="1628" y="-629.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=4096]</text>
<text text-anchor="middle" x="1628" y="-614.35" font-family="Times,serif" font-size="14.00">Device: gpu_2</text>
<text text-anchor="middle" x="1628" y="-599.35" font-family="Times,serif" font-size="14.00">Rows: 8192&#45;12287</text>
</g>
<!-- ffn_act_gpu_2&#45;&gt;ffn_fc2_gpu_2 -->
<g id="edge39" class="edge">
<title>ffn_act_gpu_2&#45;&gt;ffn_fc2_gpu_2</title>
<path fill="none" stroke="black" d="M1628,-710.4C1628,-702.34 1628,-693.55 1628,-684.88"/>
<polygon fill="black" stroke="black" points="1631.5,-684.82 1628,-674.82 1624.5,-684.82 1631.5,-684.82"/>
</g>
<!-- ffn_fc2_gpu_3 -->
<g id="node34" class="node">
<title>ffn_fc2_gpu_3</title>
<polygon fill="lightblue" stroke="black" points="2283.5,-674.55 1858.5,-674.55 1858.5,-591.55 2283.5,-591.55 2283.5,-674.55"/>
<text text-anchor="middle" x="2071" y="-659.35" font-family="Times,serif" font-size="14.00">FFN FC2</text>
<text text-anchor="middle" x="2071" y="-644.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=16384]</text>
<text text-anchor="middle" x="2071" y="-629.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=4096]</text>
<text text-anchor="middle" x="2071" y="-614.35" font-family="Times,serif" font-size="14.00">Device: gpu_3</text>
<text text-anchor="middle" x="2071" y="-599.35" font-family="Times,serif" font-size="14.00">Rows: 12288&#45;16383</text>
</g>
<!-- ffn_act_gpu_3&#45;&gt;ffn_fc2_gpu_3 -->
<g id="edge43" class="edge">
<title>ffn_act_gpu_3&#45;&gt;ffn_fc2_gpu_3</title>
<path fill="none" stroke="black" d="M2066.82,-710.4C2067.26,-702.34 2067.74,-693.55 2068.21,-684.88"/>
<polygon fill="black" stroke="black" points="2071.71,-685 2068.77,-674.82 2064.72,-684.62 2071.71,-685"/>
</g>
<!-- ffn_all_reduce -->
<g id="node35" class="node">
<title>ffn_all_reduce</title>
<polygon fill="yellow" stroke="black" points="2077.9,-555.55 1362.21,-555.55 1178.1,-389.55 1893.79,-389.55 2077.9,-555.55"/>
<text text-anchor="middle" x="1628" y="-498.85" font-family="Times,serif" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1628" y="-483.85" font-family="Times,serif" font-size="14.00">FFN Output</text>
<text text-anchor="middle" x="1628" y="-468.85" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1628" y="-453.85" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1628" y="-438.85" font-family="Times,serif" font-size="14.00">Device: all GPUs</text>
</g>
<!-- ffn_fc2_gpu_0&#45;&gt;ffn_all_reduce -->
<g id="edge32" class="edge">
<title>ffn_fc2_gpu_0&#45;&gt;ffn_all_reduce</title>
<path fill="none" stroke="black" d="M954.6,-593.06C957.41,-592.55 960.22,-592.05 963,-591.55 1079.21,-570.59 1206.91,-547.86 1319.06,-527.99"/>
<polygon fill="black" stroke="black" points="1319.94,-531.39 1329.18,-526.2 1318.72,-524.5 1319.94,-531.39"/>
</g>
<!-- ffn_fc2_gpu_1&#45;&gt;ffn_all_reduce -->
<g id="edge36" class="edge">
<title>ffn_fc2_gpu_1&#45;&gt;ffn_all_reduce</title>
<path fill="none" stroke="black" d="M1298.22,-591.54C1326.22,-581.52 1357.27,-570.41 1388.81,-559.13"/>
<polygon fill="black" stroke="black" points="1390.37,-562.28 1398.61,-555.62 1388.01,-555.69 1390.37,-562.28"/>
</g>
<!-- ffn_fc2_gpu_2&#45;&gt;ffn_all_reduce -->
<g id="edge40" class="edge">
<title>ffn_fc2_gpu_2&#45;&gt;ffn_all_reduce</title>
<path fill="none" stroke="black" d="M1628,-591.23C1628,-583.3 1628,-574.69 1628,-565.86"/>
<polygon fill="black" stroke="black" points="1631.5,-565.82 1628,-555.82 1624.5,-565.82 1631.5,-565.82"/>
</g>
<!-- ffn_fc2_gpu_3&#45;&gt;ffn_all_reduce -->
<g id="edge44" class="edge">
<title>ffn_fc2_gpu_3&#45;&gt;ffn_all_reduce</title>
<path fill="none" stroke="black" d="M1957.78,-591.54C1929.78,-581.52 1898.73,-570.41 1867.19,-559.13"/>
<polygon fill="black" stroke="black" points="1867.99,-555.69 1857.39,-555.62 1865.63,-562.28 1867.99,-555.69"/>
</g>
<!-- ffn_all_reduce&#45;&gt;residual_ffn -->
<g id="edge45" class="edge">
<title>ffn_all_reduce&#45;&gt;residual_ffn</title>
<path fill="none" stroke="black" d="M1787.74,-389.49C1810.67,-377.7 1833.88,-365.78 1855.71,-354.57"/>
<polygon fill="black" stroke="black" points="1857.35,-357.66 1864.64,-349.98 1854.15,-351.44 1857.35,-357.66"/>
</g>
<!-- rmsnorm2 -->
<g id="node37" class="node">
<title>rmsnorm2</title>
<polygon fill="lightgray" stroke="black" points="2187,-200.17 1753,-200.17 1753,-132.17 2187,-132.17 2187,-200.17"/>
<text text-anchor="middle" x="1970" y="-184.97" font-family="Times,serif" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="1970" y="-169.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1970" y="-154.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1970" y="-139.97" font-family="Times,serif" font-size="14.00">Device: all GPUs</text>
</g>
<!-- residual_ffn&#45;&gt;rmsnorm2 -->
<g id="edge47" class="edge">
<title>residual_ffn&#45;&gt;rmsnorm2</title>
<path fill="none" stroke="black" d="M1970,-236.07C1970,-227.45 1970,-218.68 1970,-210.42"/>
<polygon fill="black" stroke="black" points="1973.5,-210.28 1970,-200.28 1966.5,-210.28 1973.5,-210.28"/>
</g>
<!-- output -->
<g id="node38" class="node">
<title>output</title>
<ellipse fill="lightgreen" stroke="black" cx="1970" cy="-48.08" rx="325.95" ry="48.17"/>
<text text-anchor="middle" x="1970" y="-66.88" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="1970" y="-51.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1970" y="-36.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, vocab_size=32000]</text>
<text text-anchor="middle" x="1970" y="-21.88" font-family="Times,serif" font-size="14.00">Device: CPU</text>
</g>
<!-- rmsnorm2&#45;&gt;output -->
<g id="edge48" class="edge">
<title>rmsnorm2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1970,-131.9C1970,-123.91 1970,-115.14 1970,-106.4"/>
<polygon fill="black" stroke="black" points="1973.5,-106.19 1970,-96.19 1966.5,-106.19 1973.5,-106.19"/>
</g>
</g>
</svg>
