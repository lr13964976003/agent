<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: DeepSeek_R1_Helix_Parallelism Pages: 1 -->
<svg width="2160pt" height="763pt"
 viewBox="0.00 0.00 2160.00 763.48" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.3 0.3) rotate(0) translate(4 2515.09)">
<title>DeepSeek_R1_Helix_Parallelism</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2515.09 7122.88,-2515.09 7122.88,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightgreen" stroke="black" cx="2997" cy="-2463.01" rx="306.77" ry="48.17"/>
<text text-anchor="middle" x="2997" y="-2481.81" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="2997" y="-2466.81" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="2997" y="-2451.81" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="2997" y="-2436.81" font-family="Times,serif" font-size="14.00">Device: CPU</text>
</g>
<!-- split_all_gpus -->
<g id="node2" class="node">
<title>split_all_gpus</title>
<polygon fill="yellow" stroke="black" points="3446.9,-2378.93 2731.21,-2378.93 2547.1,-2242.93 3262.79,-2242.93 3446.9,-2378.93"/>
<text text-anchor="middle" x="2997" y="-2329.73" font-family="Times,serif" font-size="14.00">Split Input</text>
<text text-anchor="middle" x="2997" y="-2314.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="2997" y="-2299.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="2997" y="-2284.73" font-family="Times,serif" font-size="14.00">Device: all GPUs</text>
</g>
<!-- input&#45;&gt;split_all_gpus -->
<g id="edge1" class="edge">
<title>input&#45;&gt;split_all_gpus</title>
<path fill="none" stroke="black" d="M2997,-2414.52C2997,-2406.44 2997,-2397.85 2997,-2389.23"/>
<polygon fill="black" stroke="black" points="3000.5,-2389.12 2997,-2379.12 2993.5,-2389.12 3000.5,-2389.12"/>
</g>
<!-- qkv_proj_gpu_0 -->
<g id="node3" class="node">
<title>qkv_proj_gpu_0</title>
<polygon fill="lightcoral" stroke="black" points="1241.5,-2206.93 760.5,-2206.93 760.5,-2138.93 1241.5,-2138.93 1241.5,-2206.93"/>
<text text-anchor="middle" x="1001" y="-2191.73" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1001" y="-2176.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1001" y="-2161.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="1001" y="-2146.73" font-family="Times,serif" font-size="14.00">Device: gpu_0</text>
</g>
<!-- split_all_gpus&#45;&gt;qkv_proj_gpu_0 -->
<g id="edge2" class="edge">
<title>split_all_gpus&#45;&gt;qkv_proj_gpu_0</title>
<path fill="none" stroke="black" d="M2618.11,-2295.56C2266.35,-2280.34 1727.99,-2252.3 1251.99,-2207.1"/>
<polygon fill="black" stroke="black" points="1252.1,-2203.59 1241.82,-2206.13 1251.44,-2210.56 1252.1,-2203.59"/>
</g>
<!-- qkv_proj_gpu_1 -->
<g id="node4" class="node">
<title>qkv_proj_gpu_1</title>
<polygon fill="lightcoral" stroke="black" points="1740.5,-2206.93 1259.5,-2206.93 1259.5,-2138.93 1740.5,-2138.93 1740.5,-2206.93"/>
<text text-anchor="middle" x="1500" y="-2191.73" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1500" y="-2176.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1500" y="-2161.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="1500" y="-2146.73" font-family="Times,serif" font-size="14.00">Device: gpu_1</text>
</g>
<!-- split_all_gpus&#45;&gt;qkv_proj_gpu_1 -->
<g id="edge5" class="edge">
<title>split_all_gpus&#45;&gt;qkv_proj_gpu_1</title>
<path fill="none" stroke="black" d="M2600.27,-2282.21C2357.65,-2264.03 2040.77,-2238.09 1751.12,-2207.14"/>
<polygon fill="black" stroke="black" points="1751.14,-2203.62 1740.82,-2206.04 1750.39,-2210.58 1751.14,-2203.62"/>
</g>
<!-- qkv_proj_gpu_2 -->
<g id="node5" class="node">
<title>qkv_proj_gpu_2</title>
<polygon fill="lightcoral" stroke="black" points="2239.5,-2206.93 1758.5,-2206.93 1758.5,-2138.93 2239.5,-2138.93 2239.5,-2206.93"/>
<text text-anchor="middle" x="1999" y="-2191.73" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1999" y="-2176.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1999" y="-2161.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="1999" y="-2146.73" font-family="Times,serif" font-size="14.00">Device: gpu_2</text>
</g>
<!-- split_all_gpus&#45;&gt;qkv_proj_gpu_2 -->
<g id="edge8" class="edge">
<title>split_all_gpus&#45;&gt;qkv_proj_gpu_2</title>
<path fill="none" stroke="black" d="M2556.36,-2249.88C2451.31,-2235.56 2342.77,-2220.77 2249.7,-2208.09"/>
<polygon fill="black" stroke="black" points="2249.97,-2204.59 2239.58,-2206.71 2249.02,-2211.53 2249.97,-2204.59"/>
</g>
<!-- qkv_proj_gpu_3 -->
<g id="node6" class="node">
<title>qkv_proj_gpu_3</title>
<polygon fill="lightcoral" stroke="black" points="2738.5,-2206.93 2257.5,-2206.93 2257.5,-2138.93 2738.5,-2138.93 2738.5,-2206.93"/>
<text text-anchor="middle" x="2498" y="-2191.73" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="2498" y="-2176.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="2498" y="-2161.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="2498" y="-2146.73" font-family="Times,serif" font-size="14.00">Device: gpu_3</text>
</g>
<!-- split_all_gpus&#45;&gt;qkv_proj_gpu_3 -->
<g id="edge11" class="edge">
<title>split_all_gpus&#45;&gt;qkv_proj_gpu_3</title>
<path fill="none" stroke="black" d="M2751.15,-2242.92C2709.04,-2231.44 2666.78,-2219.93 2629.19,-2209.68"/>
<polygon fill="black" stroke="black" points="2629.79,-2206.22 2619.23,-2206.97 2627.95,-2212.97 2629.79,-2206.22"/>
</g>
<!-- qkv_proj_gpu_4 -->
<g id="node7" class="node">
<title>qkv_proj_gpu_4</title>
<polygon fill="lightcoral" stroke="black" points="3237.5,-2206.93 2756.5,-2206.93 2756.5,-2138.93 3237.5,-2138.93 3237.5,-2206.93"/>
<text text-anchor="middle" x="2997" y="-2191.73" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="2997" y="-2176.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="2997" y="-2161.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="2997" y="-2146.73" font-family="Times,serif" font-size="14.00">Device: gpu_4</text>
</g>
<!-- split_all_gpus&#45;&gt;qkv_proj_gpu_4 -->
<g id="edge14" class="edge">
<title>split_all_gpus&#45;&gt;qkv_proj_gpu_4</title>
<path fill="none" stroke="black" d="M2997,-2242.72C2997,-2233.97 2997,-2225.2 2997,-2216.99"/>
<polygon fill="black" stroke="black" points="3000.5,-2216.94 2997,-2206.94 2993.5,-2216.94 3000.5,-2216.94"/>
</g>
<!-- qkv_proj_gpu_5 -->
<g id="node8" class="node">
<title>qkv_proj_gpu_5</title>
<polygon fill="lightcoral" stroke="black" points="3736.5,-2206.93 3255.5,-2206.93 3255.5,-2138.93 3736.5,-2138.93 3736.5,-2206.93"/>
<text text-anchor="middle" x="3496" y="-2191.73" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3496" y="-2176.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3496" y="-2161.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="3496" y="-2146.73" font-family="Times,serif" font-size="14.00">Device: gpu_5</text>
</g>
<!-- split_all_gpus&#45;&gt;qkv_proj_gpu_5 -->
<g id="edge17" class="edge">
<title>split_all_gpus&#45;&gt;qkv_proj_gpu_5</title>
<path fill="none" stroke="black" d="M3242.85,-2242.92C3284.96,-2231.44 3327.22,-2219.93 3364.81,-2209.68"/>
<polygon fill="black" stroke="black" points="3366.05,-2212.97 3374.77,-2206.97 3364.21,-2206.22 3366.05,-2212.97"/>
</g>
<!-- qkv_proj_gpu_6 -->
<g id="node9" class="node">
<title>qkv_proj_gpu_6</title>
<polygon fill="lightcoral" stroke="black" points="4235.5,-2206.93 3754.5,-2206.93 3754.5,-2138.93 4235.5,-2138.93 4235.5,-2206.93"/>
<text text-anchor="middle" x="3995" y="-2191.73" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3995" y="-2176.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3995" y="-2161.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="3995" y="-2146.73" font-family="Times,serif" font-size="14.00">Device: gpu_6</text>
</g>
<!-- split_all_gpus&#45;&gt;qkv_proj_gpu_6 -->
<g id="edge20" class="edge">
<title>split_all_gpus&#45;&gt;qkv_proj_gpu_6</title>
<path fill="none" stroke="black" d="M3298.12,-2268.89C3440.61,-2249.47 3608.78,-2226.56 3744.22,-2208.1"/>
<polygon fill="black" stroke="black" points="3744.89,-2211.54 3754.33,-2206.72 3743.95,-2204.61 3744.89,-2211.54"/>
</g>
<!-- qkv_proj_gpu_7 -->
<g id="node10" class="node">
<title>qkv_proj_gpu_7</title>
<polygon fill="lightcoral" stroke="black" points="4734.5,-2206.93 4253.5,-2206.93 4253.5,-2138.93 4734.5,-2138.93 4734.5,-2206.93"/>
<text text-anchor="middle" x="4494" y="-2191.73" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4494" y="-2176.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="4494" y="-2161.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="4494" y="-2146.73" font-family="Times,serif" font-size="14.00">Device: gpu_7</text>
</g>
<!-- split_all_gpus&#45;&gt;qkv_proj_gpu_7 -->
<g id="edge23" class="edge">
<title>split_all_gpus&#45;&gt;qkv_proj_gpu_7</title>
<path fill="none" stroke="black" d="M3322.99,-2287.38C3572.12,-2269.1 3924.23,-2241.01 4242.83,-2207.03"/>
<polygon fill="black" stroke="black" points="4243.63,-2210.47 4253.2,-2205.93 4242.88,-2203.51 4243.63,-2210.47"/>
</g>
<!-- residual_attn -->
<g id="node37" class="node">
<title>residual_attn</title>
<ellipse fill="lightgreen" stroke="black" cx="3978" cy="-1268.24" rx="306.77" ry="58.88"/>
<text text-anchor="middle" x="3978" y="-1294.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="3978" y="-1279.54" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="3978" y="-1264.54" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3978" y="-1249.54" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3978" y="-1234.54" font-family="Times,serif" font-size="14.00">Device: all GPUs</text>
</g>
<!-- split_all_gpus&#45;&gt;residual_attn -->
<g id="edge51" class="edge">
<title>split_all_gpus&#45;&gt;residual_attn</title>
<path fill="none" stroke="black" d="M3341.16,-2300.79C3835.6,-2286.06 4693.51,-2253.91 4744,-2206.93 4791.42,-2162.8 4763,-2127.2 4763,-2062.43 4763,-2062.43 4763,-2062.43 4763,-1605.43 4763,-1479.82 4419.1,-1373.21 4186.55,-1315.47"/>
<polygon fill="black" stroke="black" points="4187.14,-1312.01 4176.6,-1313.01 4185.46,-1318.81 4187.14,-1312.01"/>
</g>
<!-- kv_cache_gpu_0 -->
<g id="node11" class="node">
<title>kv_cache_gpu_0</title>
<polygon fill="lightpink" stroke="black" points="1241,-2102.93 787,-2102.93 787,-2019.93 1241,-2019.93 1241,-2102.93"/>
<text text-anchor="middle" x="1014" y="-2087.73" font-family="Times,serif" font-size="14.00">KV Cache</text>
<text text-anchor="middle" x="1014" y="-2072.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=125000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="1014" y="-2057.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=125000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="1014" y="-2042.73" font-family="Times,serif" font-size="14.00">Device: gpu_0</text>
<text text-anchor="middle" x="1014" y="-2027.73" font-family="Times,serif" font-size="14.00">Tokens: 0&#45;124999</text>
</g>
<!-- qkv_proj_gpu_0&#45;&gt;kv_cache_gpu_0 -->
<g id="edge3" class="edge">
<title>qkv_proj_gpu_0&#45;&gt;kv_cache_gpu_0</title>
<path fill="none" stroke="black" d="M1004.94,-2138.78C1005.89,-2130.72 1006.94,-2121.93 1007.96,-2113.26"/>
<polygon fill="black" stroke="black" points="1011.46,-2113.55 1009.16,-2103.2 1004.5,-2112.72 1011.46,-2113.55"/>
</g>
<!-- kv_cache_gpu_1 -->
<g id="node12" class="node">
<title>kv_cache_gpu_1</title>
<polygon fill="lightpink" stroke="black" points="1735,-2102.93 1281,-2102.93 1281,-2019.93 1735,-2019.93 1735,-2102.93"/>
<text text-anchor="middle" x="1508" y="-2087.73" font-family="Times,serif" font-size="14.00">KV Cache</text>
<text text-anchor="middle" x="1508" y="-2072.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=125000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="1508" y="-2057.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=125000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="1508" y="-2042.73" font-family="Times,serif" font-size="14.00">Device: gpu_1</text>
<text text-anchor="middle" x="1508" y="-2027.73" font-family="Times,serif" font-size="14.00">Tokens: 125000&#45;249999</text>
</g>
<!-- qkv_proj_gpu_1&#45;&gt;kv_cache_gpu_1 -->
<g id="edge6" class="edge">
<title>qkv_proj_gpu_1&#45;&gt;kv_cache_gpu_1</title>
<path fill="none" stroke="black" d="M1502.42,-2138.78C1503.01,-2130.72 1503.65,-2121.93 1504.29,-2113.26"/>
<polygon fill="black" stroke="black" points="1507.78,-2113.43 1505.02,-2103.2 1500.8,-2112.92 1507.78,-2113.43"/>
</g>
<!-- kv_cache_gpu_2 -->
<g id="node13" class="node">
<title>kv_cache_gpu_2</title>
<polygon fill="lightpink" stroke="black" points="2234,-2102.93 1780,-2102.93 1780,-2019.93 2234,-2019.93 2234,-2102.93"/>
<text text-anchor="middle" x="2007" y="-2087.73" font-family="Times,serif" font-size="14.00">KV Cache</text>
<text text-anchor="middle" x="2007" y="-2072.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=125000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="2007" y="-2057.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=125000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="2007" y="-2042.73" font-family="Times,serif" font-size="14.00">Device: gpu_2</text>
<text text-anchor="middle" x="2007" y="-2027.73" font-family="Times,serif" font-size="14.00">Tokens: 250000&#45;374999</text>
</g>
<!-- qkv_proj_gpu_2&#45;&gt;kv_cache_gpu_2 -->
<g id="edge9" class="edge">
<title>qkv_proj_gpu_2&#45;&gt;kv_cache_gpu_2</title>
<path fill="none" stroke="black" d="M2001.42,-2138.78C2002.01,-2130.72 2002.65,-2121.93 2003.29,-2113.26"/>
<polygon fill="black" stroke="black" points="2006.78,-2113.43 2004.02,-2103.2 1999.8,-2112.92 2006.78,-2113.43"/>
</g>
<!-- kv_cache_gpu_3 -->
<g id="node14" class="node">
<title>kv_cache_gpu_3</title>
<polygon fill="lightpink" stroke="black" points="2726,-2102.93 2272,-2102.93 2272,-2019.93 2726,-2019.93 2726,-2102.93"/>
<text text-anchor="middle" x="2499" y="-2087.73" font-family="Times,serif" font-size="14.00">KV Cache</text>
<text text-anchor="middle" x="2499" y="-2072.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=125000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="2499" y="-2057.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=125000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="2499" y="-2042.73" font-family="Times,serif" font-size="14.00">Device: gpu_3</text>
<text text-anchor="middle" x="2499" y="-2027.73" font-family="Times,serif" font-size="14.00">Tokens: 375000&#45;499999</text>
</g>
<!-- qkv_proj_gpu_3&#45;&gt;kv_cache_gpu_3 -->
<g id="edge12" class="edge">
<title>qkv_proj_gpu_3&#45;&gt;kv_cache_gpu_3</title>
<path fill="none" stroke="black" d="M2498.3,-2138.78C2498.38,-2130.72 2498.46,-2121.93 2498.54,-2113.26"/>
<polygon fill="black" stroke="black" points="2502.04,-2113.23 2498.63,-2103.2 2495.04,-2113.17 2502.04,-2113.23"/>
</g>
<!-- kv_cache_gpu_4 -->
<g id="node15" class="node">
<title>kv_cache_gpu_4</title>
<polygon fill="lightpink" stroke="black" points="3223,-2102.93 2769,-2102.93 2769,-2019.93 3223,-2019.93 3223,-2102.93"/>
<text text-anchor="middle" x="2996" y="-2087.73" font-family="Times,serif" font-size="14.00">KV Cache</text>
<text text-anchor="middle" x="2996" y="-2072.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=125000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="2996" y="-2057.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=125000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="2996" y="-2042.73" font-family="Times,serif" font-size="14.00">Device: gpu_4</text>
<text text-anchor="middle" x="2996" y="-2027.73" font-family="Times,serif" font-size="14.00">Tokens: 500000&#45;624999</text>
</g>
<!-- qkv_proj_gpu_4&#45;&gt;kv_cache_gpu_4 -->
<g id="edge15" class="edge">
<title>qkv_proj_gpu_4&#45;&gt;kv_cache_gpu_4</title>
<path fill="none" stroke="black" d="M2996.7,-2138.78C2996.62,-2130.72 2996.54,-2121.93 2996.46,-2113.26"/>
<polygon fill="black" stroke="black" points="2999.96,-2113.17 2996.37,-2103.2 2992.96,-2113.23 2999.96,-2113.17"/>
</g>
<!-- kv_cache_gpu_5 -->
<g id="node16" class="node">
<title>kv_cache_gpu_5</title>
<polygon fill="lightpink" stroke="black" points="3720,-2102.93 3266,-2102.93 3266,-2019.93 3720,-2019.93 3720,-2102.93"/>
<text text-anchor="middle" x="3493" y="-2087.73" font-family="Times,serif" font-size="14.00">KV Cache</text>
<text text-anchor="middle" x="3493" y="-2072.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=125000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="3493" y="-2057.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=125000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="3493" y="-2042.73" font-family="Times,serif" font-size="14.00">Device: gpu_5</text>
<text text-anchor="middle" x="3493" y="-2027.73" font-family="Times,serif" font-size="14.00">Tokens: 625000&#45;749999</text>
</g>
<!-- qkv_proj_gpu_5&#45;&gt;kv_cache_gpu_5 -->
<g id="edge18" class="edge">
<title>qkv_proj_gpu_5&#45;&gt;kv_cache_gpu_5</title>
<path fill="none" stroke="black" d="M3495.09,-2138.78C3494.87,-2130.72 3494.63,-2121.93 3494.39,-2113.26"/>
<polygon fill="black" stroke="black" points="3497.89,-2113.1 3494.12,-2103.2 3490.89,-2113.3 3497.89,-2113.1"/>
</g>
<!-- kv_cache_gpu_6 -->
<g id="node17" class="node">
<title>kv_cache_gpu_6</title>
<polygon fill="lightpink" stroke="black" points="4218,-2102.93 3764,-2102.93 3764,-2019.93 4218,-2019.93 4218,-2102.93"/>
<text text-anchor="middle" x="3991" y="-2087.73" font-family="Times,serif" font-size="14.00">KV Cache</text>
<text text-anchor="middle" x="3991" y="-2072.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=125000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="3991" y="-2057.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=125000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="3991" y="-2042.73" font-family="Times,serif" font-size="14.00">Device: gpu_6</text>
<text text-anchor="middle" x="3991" y="-2027.73" font-family="Times,serif" font-size="14.00">Tokens: 750000&#45;874999</text>
</g>
<!-- qkv_proj_gpu_6&#45;&gt;kv_cache_gpu_6 -->
<g id="edge21" class="edge">
<title>qkv_proj_gpu_6&#45;&gt;kv_cache_gpu_6</title>
<path fill="none" stroke="black" d="M3993.79,-2138.78C3993.49,-2130.72 3993.17,-2121.93 3992.86,-2113.26"/>
<polygon fill="black" stroke="black" points="3996.35,-2113.07 3992.49,-2103.2 3989.36,-2113.32 3996.35,-2113.07"/>
</g>
<!-- kv_cache_gpu_7 -->
<g id="node18" class="node">
<title>kv_cache_gpu_7</title>
<polygon fill="lightpink" stroke="black" points="4714,-2102.93 4260,-2102.93 4260,-2019.93 4714,-2019.93 4714,-2102.93"/>
<text text-anchor="middle" x="4487" y="-2087.73" font-family="Times,serif" font-size="14.00">KV Cache</text>
<text text-anchor="middle" x="4487" y="-2072.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=125000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="4487" y="-2057.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=125000, heads=1, d_k=128]</text>
<text text-anchor="middle" x="4487" y="-2042.73" font-family="Times,serif" font-size="14.00">Device: gpu_7</text>
<text text-anchor="middle" x="4487" y="-2027.73" font-family="Times,serif" font-size="14.00">Tokens: 875000&#45;999999</text>
</g>
<!-- qkv_proj_gpu_7&#45;&gt;kv_cache_gpu_7 -->
<g id="edge24" class="edge">
<title>qkv_proj_gpu_7&#45;&gt;kv_cache_gpu_7</title>
<path fill="none" stroke="black" d="M4491.88,-2138.78C4491.37,-2130.72 4490.8,-2121.93 4490.25,-2113.26"/>
<polygon fill="black" stroke="black" points="4493.74,-2112.96 4489.61,-2103.2 4486.75,-2113.41 4493.74,-2112.96"/>
</g>
<!-- flash_attn_gpu_0 -->
<g id="node19" class="node">
<title>flash_attn_gpu_0</title>
<polygon fill="lightblue" stroke="black" points="1254,-1983.93 782,-1983.93 782,-1915.93 1254,-1915.93 1254,-1983.93"/>
<text text-anchor="middle" x="1018" y="-1968.73" font-family="Times,serif" font-size="14.00">FlashAttention</text>
<text text-anchor="middle" x="1018" y="-1953.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=125000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="1018" y="-1938.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=125000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="1018" y="-1923.73" font-family="Times,serif" font-size="14.00">Device: gpu_0</text>
</g>
<!-- kv_cache_gpu_0&#45;&gt;flash_attn_gpu_0 -->
<g id="edge4" class="edge">
<title>kv_cache_gpu_0&#45;&gt;flash_attn_gpu_0</title>
<path fill="none" stroke="black" d="M1015.49,-2019.65C1015.79,-2011.44 1016.11,-2002.79 1016.41,-1994.49"/>
<polygon fill="black" stroke="black" points="1019.92,-1994.35 1016.78,-1984.23 1012.92,-1994.09 1019.92,-1994.35"/>
</g>
<!-- flash_attn_gpu_1 -->
<g id="node20" class="node">
<title>flash_attn_gpu_1</title>
<polygon fill="lightblue" stroke="black" points="1753,-1983.93 1281,-1983.93 1281,-1915.93 1753,-1915.93 1753,-1983.93"/>
<text text-anchor="middle" x="1517" y="-1968.73" font-family="Times,serif" font-size="14.00">FlashAttention</text>
<text text-anchor="middle" x="1517" y="-1953.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=125000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="1517" y="-1938.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=125000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="1517" y="-1923.73" font-family="Times,serif" font-size="14.00">Device: gpu_1</text>
</g>
<!-- kv_cache_gpu_1&#45;&gt;flash_attn_gpu_1 -->
<g id="edge7" class="edge">
<title>kv_cache_gpu_1&#45;&gt;flash_attn_gpu_1</title>
<path fill="none" stroke="black" d="M1511.35,-2019.65C1512.03,-2011.35 1512.75,-2002.59 1513.44,-1994.21"/>
<polygon fill="black" stroke="black" points="1516.93,-1994.48 1514.26,-1984.23 1509.96,-1993.91 1516.93,-1994.48"/>
</g>
<!-- flash_attn_gpu_2 -->
<g id="node21" class="node">
<title>flash_attn_gpu_2</title>
<polygon fill="lightblue" stroke="black" points="2247,-1983.93 1775,-1983.93 1775,-1915.93 2247,-1915.93 2247,-1983.93"/>
<text text-anchor="middle" x="2011" y="-1968.73" font-family="Times,serif" font-size="14.00">FlashAttention</text>
<text text-anchor="middle" x="2011" y="-1953.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=125000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="2011" y="-1938.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=125000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="2011" y="-1923.73" font-family="Times,serif" font-size="14.00">Device: gpu_2</text>
</g>
<!-- kv_cache_gpu_2&#45;&gt;flash_attn_gpu_2 -->
<g id="edge10" class="edge">
<title>kv_cache_gpu_2&#45;&gt;flash_attn_gpu_2</title>
<path fill="none" stroke="black" d="M2008.49,-2019.65C2008.79,-2011.44 2009.11,-2002.79 2009.41,-1994.49"/>
<polygon fill="black" stroke="black" points="2012.92,-1994.35 2009.78,-1984.23 2005.92,-1994.09 2012.92,-1994.35"/>
</g>
<!-- flash_attn_gpu_3 -->
<g id="node22" class="node">
<title>flash_attn_gpu_3</title>
<polygon fill="lightblue" stroke="black" points="2739,-1983.93 2267,-1983.93 2267,-1915.93 2739,-1915.93 2739,-1983.93"/>
<text text-anchor="middle" x="2503" y="-1968.73" font-family="Times,serif" font-size="14.00">FlashAttention</text>
<text text-anchor="middle" x="2503" y="-1953.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=125000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="2503" y="-1938.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=125000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="2503" y="-1923.73" font-family="Times,serif" font-size="14.00">Device: gpu_3</text>
</g>
<!-- kv_cache_gpu_3&#45;&gt;flash_attn_gpu_3 -->
<g id="edge13" class="edge">
<title>kv_cache_gpu_3&#45;&gt;flash_attn_gpu_3</title>
<path fill="none" stroke="black" d="M2500.49,-2019.65C2500.79,-2011.44 2501.11,-2002.79 2501.41,-1994.49"/>
<polygon fill="black" stroke="black" points="2504.92,-1994.35 2501.78,-1984.23 2497.92,-1994.09 2504.92,-1994.35"/>
</g>
<!-- flash_attn_gpu_4 -->
<g id="node23" class="node">
<title>flash_attn_gpu_4</title>
<polygon fill="lightblue" stroke="black" points="3230,-1983.93 2758,-1983.93 2758,-1915.93 3230,-1915.93 3230,-1983.93"/>
<text text-anchor="middle" x="2994" y="-1968.73" font-family="Times,serif" font-size="14.00">FlashAttention</text>
<text text-anchor="middle" x="2994" y="-1953.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=125000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="2994" y="-1938.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=125000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="2994" y="-1923.73" font-family="Times,serif" font-size="14.00">Device: gpu_4</text>
</g>
<!-- kv_cache_gpu_4&#45;&gt;flash_attn_gpu_4 -->
<g id="edge16" class="edge">
<title>kv_cache_gpu_4&#45;&gt;flash_attn_gpu_4</title>
<path fill="none" stroke="black" d="M2995.26,-2019.65C2995.11,-2011.44 2994.95,-2002.79 2994.8,-1994.49"/>
<polygon fill="black" stroke="black" points="2998.29,-1994.16 2994.61,-1984.23 2991.29,-1994.29 2998.29,-1994.16"/>
</g>
<!-- flash_attn_gpu_5 -->
<g id="node24" class="node">
<title>flash_attn_gpu_5</title>
<polygon fill="lightblue" stroke="black" points="3724,-1983.93 3252,-1983.93 3252,-1915.93 3724,-1915.93 3724,-1983.93"/>
<text text-anchor="middle" x="3488" y="-1968.73" font-family="Times,serif" font-size="14.00">FlashAttention</text>
<text text-anchor="middle" x="3488" y="-1953.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=125000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="3488" y="-1938.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=125000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="3488" y="-1923.73" font-family="Times,serif" font-size="14.00">Device: gpu_5</text>
</g>
<!-- kv_cache_gpu_5&#45;&gt;flash_attn_gpu_5 -->
<g id="edge19" class="edge">
<title>kv_cache_gpu_5&#45;&gt;flash_attn_gpu_5</title>
<path fill="none" stroke="black" d="M3491.14,-2019.65C3490.76,-2011.44 3490.37,-2002.79 3489.99,-1994.49"/>
<polygon fill="black" stroke="black" points="3493.47,-1994.06 3489.52,-1984.23 3486.48,-1994.37 3493.47,-1994.06"/>
</g>
<!-- flash_attn_gpu_6 -->
<g id="node25" class="node">
<title>flash_attn_gpu_6</title>
<polygon fill="lightblue" stroke="black" points="4222,-1983.93 3750,-1983.93 3750,-1915.93 4222,-1915.93 4222,-1983.93"/>
<text text-anchor="middle" x="3986" y="-1968.73" font-family="Times,serif" font-size="14.00">FlashAttention</text>
<text text-anchor="middle" x="3986" y="-1953.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=125000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="3986" y="-1938.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=125000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="3986" y="-1923.73" font-family="Times,serif" font-size="14.00">Device: gpu_6</text>
</g>
<!-- kv_cache_gpu_6&#45;&gt;flash_attn_gpu_6 -->
<g id="edge22" class="edge">
<title>kv_cache_gpu_6&#45;&gt;flash_attn_gpu_6</title>
<path fill="none" stroke="black" d="M3989.14,-2019.65C3988.76,-2011.44 3988.37,-2002.79 3987.99,-1994.49"/>
<polygon fill="black" stroke="black" points="3991.47,-1994.06 3987.52,-1984.23 3984.48,-1994.37 3991.47,-1994.06"/>
</g>
<!-- flash_attn_gpu_7 -->
<g id="node26" class="node">
<title>flash_attn_gpu_7</title>
<polygon fill="lightblue" stroke="black" points="4719,-1983.93 4247,-1983.93 4247,-1915.93 4719,-1915.93 4719,-1983.93"/>
<text text-anchor="middle" x="4483" y="-1968.73" font-family="Times,serif" font-size="14.00">FlashAttention</text>
<text text-anchor="middle" x="4483" y="-1953.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=125000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="4483" y="-1938.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=125000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="4483" y="-1923.73" font-family="Times,serif" font-size="14.00">Device: gpu_7</text>
</g>
<!-- kv_cache_gpu_7&#45;&gt;flash_attn_gpu_7 -->
<g id="edge25" class="edge">
<title>kv_cache_gpu_7&#45;&gt;flash_attn_gpu_7</title>
<path fill="none" stroke="black" d="M4485.51,-2019.65C4485.21,-2011.44 4484.89,-2002.79 4484.59,-1994.49"/>
<polygon fill="black" stroke="black" points="4488.08,-1994.09 4484.22,-1984.23 4481.08,-1994.35 4488.08,-1994.09"/>
</g>
<!-- all2all -->
<g id="node27" class="node">
<title>all2all</title>
<polygon fill="yellow" stroke="black" points="3370.86,-1879.93 2577.29,-1879.93 2373.14,-1683.93 3166.71,-1683.93 3370.86,-1879.93"/>
<text text-anchor="middle" x="2872" y="-1815.73" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="2872" y="-1800.73" font-family="Times,serif" font-size="14.00">Exchange Query Heads</text>
<text text-anchor="middle" x="2872" y="-1785.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="2872" y="-1770.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, heads=128, d_k=128]</text>
<text text-anchor="middle" x="2872" y="-1755.73" font-family="Times,serif" font-size="14.00">Volume: 1×128×128×0.5 bytes</text>
<text text-anchor="middle" x="2872" y="-1740.73" font-family="Times,serif" font-size="14.00">Device: all GPUs</text>
</g>
<!-- flash_attn_gpu_0&#45;&gt;all2all -->
<g id="edge26" class="edge">
<title>flash_attn_gpu_0&#45;&gt;all2all</title>
<path fill="none" stroke="black" d="M1254.22,-1917.86C1260.21,-1917.2 1266.14,-1916.55 1272,-1915.93 1688.98,-1871.53 2168.43,-1833.38 2492.92,-1809.47"/>
<polygon fill="black" stroke="black" points="2493.24,-1812.96 2502.95,-1808.73 2492.72,-1805.98 2493.24,-1812.96"/>
</g>
<!-- flash_attn_gpu_1&#45;&gt;all2all -->
<g id="edge27" class="edge">
<title>flash_attn_gpu_1&#45;&gt;all2all</title>
<path fill="none" stroke="black" d="M1753.24,-1917.55C1757.52,-1917 1761.78,-1916.46 1766,-1915.93 2013.78,-1884.61 2293.01,-1851.04 2508.92,-1825.47"/>
<polygon fill="black" stroke="black" points="2509.63,-1828.91 2519.15,-1824.26 2508.81,-1821.96 2509.63,-1828.91"/>
</g>
<!-- flash_attn_gpu_2&#45;&gt;all2all -->
<g id="edge28" class="edge">
<title>flash_attn_gpu_2&#45;&gt;all2all</title>
<path fill="none" stroke="black" d="M2182.39,-1915.88C2282.46,-1896.59 2412.28,-1871.56 2532.24,-1848.43"/>
<polygon fill="black" stroke="black" points="2533.18,-1851.82 2542.33,-1846.49 2531.85,-1844.94 2533.18,-1851.82"/>
</g>
<!-- flash_attn_gpu_3&#45;&gt;all2all -->
<g id="edge29" class="edge">
<title>flash_attn_gpu_3&#45;&gt;all2all</title>
<path fill="none" stroke="black" d="M2576.79,-1915.73C2597.77,-1906.29 2621.78,-1895.49 2646.84,-1884.22"/>
<polygon fill="black" stroke="black" points="2648.43,-1887.34 2656.12,-1880.04 2645.56,-1880.95 2648.43,-1887.34"/>
</g>
<!-- flash_attn_gpu_4&#45;&gt;all2all -->
<g id="edge30" class="edge">
<title>flash_attn_gpu_4&#45;&gt;all2all</title>
<path fill="none" stroke="black" d="M2969.6,-1915.73C2963.52,-1907.45 2956.66,-1898.13 2949.48,-1888.35"/>
<polygon fill="black" stroke="black" points="2952.12,-1886.03 2943.38,-1880.04 2946.48,-1890.17 2952.12,-1886.03"/>
</g>
<!-- flash_attn_gpu_5&#45;&gt;all2all -->
<g id="edge31" class="edge">
<title>flash_attn_gpu_5&#45;&gt;all2all</title>
<path fill="none" stroke="black" d="M3365.19,-1915.83C3328.41,-1905.92 3286.01,-1894.49 3241.85,-1882.59"/>
<polygon fill="black" stroke="black" points="3242.67,-1879.19 3232.1,-1879.97 3240.85,-1885.95 3242.67,-1879.19"/>
</g>
<!-- flash_attn_gpu_6&#45;&gt;all2all -->
<g id="edge32" class="edge">
<title>flash_attn_gpu_6&#45;&gt;all2all</title>
<path fill="none" stroke="black" d="M3764.24,-1915.88C3646.34,-1898.31 3496.51,-1875.99 3353.46,-1854.67"/>
<polygon fill="black" stroke="black" points="3353.58,-1851.15 3343.17,-1853.14 3352.55,-1858.07 3353.58,-1851.15"/>
</g>
<!-- flash_attn_gpu_7&#45;&gt;all2all -->
<g id="edge33" class="edge">
<title>flash_attn_gpu_7&#45;&gt;all2all</title>
<path fill="none" stroke="black" d="M4246.95,-1917.78C4241.58,-1917.15 4236.26,-1916.53 4231,-1915.93 3927.83,-1881.25 3585.95,-1847.82 3320.94,-1823.15"/>
<polygon fill="black" stroke="black" points="3321.04,-1819.64 3310.75,-1822.2 3320.39,-1826.61 3321.04,-1819.64"/>
</g>
<!-- attn_out_gpu_0 -->
<g id="node28" class="node">
<title>attn_out_gpu_0</title>
<polygon fill="lightcoral" stroke="black" points="1633.5,-1647.93 1208.5,-1647.93 1208.5,-1564.93 1633.5,-1564.93 1633.5,-1647.93"/>
<text text-anchor="middle" x="1421" y="-1632.73" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="1421" y="-1617.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=2048]</text>
<text text-anchor="middle" x="1421" y="-1602.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=2048]</text>
<text text-anchor="middle" x="1421" y="-1587.73" font-family="Times,serif" font-size="14.00">Device: gpu_0</text>
<text text-anchor="middle" x="1421" y="-1572.73" font-family="Times,serif" font-size="14.00">Rows: 0&#45;2047</text>
</g>
<!-- all2all&#45;&gt;attn_out_gpu_0 -->
<g id="edge34" class="edge">
<title>all2all&#45;&gt;attn_out_gpu_0</title>
<path fill="none" stroke="black" d="M2432.68,-1741.33C2200.58,-1718.45 1910.89,-1686.78 1643.84,-1648.17"/>
<polygon fill="black" stroke="black" points="1643.95,-1644.65 1633.55,-1646.68 1642.95,-1651.58 1643.95,-1644.65"/>
</g>
<!-- attn_out_gpu_1 -->
<g id="node29" class="node">
<title>attn_out_gpu_1</title>
<polygon fill="lightcoral" stroke="black" points="2076.5,-1647.93 1651.5,-1647.93 1651.5,-1564.93 2076.5,-1564.93 2076.5,-1647.93"/>
<text text-anchor="middle" x="1864" y="-1632.73" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="1864" y="-1617.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=2048]</text>
<text text-anchor="middle" x="1864" y="-1602.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=2048]</text>
<text text-anchor="middle" x="1864" y="-1587.73" font-family="Times,serif" font-size="14.00">Device: gpu_1</text>
<text text-anchor="middle" x="1864" y="-1572.73" font-family="Times,serif" font-size="14.00">Rows: 2048&#45;4095</text>
</g>
<!-- all2all&#45;&gt;attn_out_gpu_1 -->
<g id="edge36" class="edge">
<title>all2all&#45;&gt;attn_out_gpu_1</title>
<path fill="none" stroke="black" d="M2390.33,-1700.61C2292.57,-1684.01 2190.29,-1666.44 2086.63,-1648.21"/>
<polygon fill="black" stroke="black" points="2087.04,-1644.73 2076.59,-1646.44 2085.83,-1651.62 2087.04,-1644.73"/>
</g>
<!-- attn_out_gpu_2 -->
<g id="node30" class="node">
<title>attn_out_gpu_2</title>
<polygon fill="lightcoral" stroke="black" points="2519.5,-1647.93 2094.5,-1647.93 2094.5,-1564.93 2519.5,-1564.93 2519.5,-1647.93"/>
<text text-anchor="middle" x="2307" y="-1632.73" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="2307" y="-1617.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=2048]</text>
<text text-anchor="middle" x="2307" y="-1602.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=2048]</text>
<text text-anchor="middle" x="2307" y="-1587.73" font-family="Times,serif" font-size="14.00">Device: gpu_2</text>
<text text-anchor="middle" x="2307" y="-1572.73" font-family="Times,serif" font-size="14.00">Rows: 4096&#45;6143</text>
</g>
<!-- all2all&#45;&gt;attn_out_gpu_2 -->
<g id="edge38" class="edge">
<title>all2all&#45;&gt;attn_out_gpu_2</title>
<path fill="none" stroke="black" d="M2556.05,-1683.9C2518.6,-1672.4 2481.94,-1661.15 2448.76,-1650.96"/>
<polygon fill="black" stroke="black" points="2449.62,-1647.56 2439.03,-1647.97 2447.57,-1654.25 2449.62,-1647.56"/>
</g>
<!-- attn_out_gpu_3 -->
<g id="node31" class="node">
<title>attn_out_gpu_3</title>
<polygon fill="lightcoral" stroke="black" points="2962.5,-1647.93 2537.5,-1647.93 2537.5,-1564.93 2962.5,-1564.93 2962.5,-1647.93"/>
<text text-anchor="middle" x="2750" y="-1632.73" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="2750" y="-1617.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=2048]</text>
<text text-anchor="middle" x="2750" y="-1602.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=2048]</text>
<text text-anchor="middle" x="2750" y="-1587.73" font-family="Times,serif" font-size="14.00">Device: gpu_3</text>
<text text-anchor="middle" x="2750" y="-1572.73" font-family="Times,serif" font-size="14.00">Rows: 6144&#45;8191</text>
</g>
<!-- all2all&#45;&gt;attn_out_gpu_3 -->
<g id="edge40" class="edge">
<title>all2all&#45;&gt;attn_out_gpu_3</title>
<path fill="none" stroke="black" d="M2803.69,-1683.78C2797.07,-1674.37 2790.57,-1665.13 2784.51,-1656.5"/>
<polygon fill="black" stroke="black" points="2787.21,-1654.26 2778.6,-1648.1 2781.49,-1658.29 2787.21,-1654.26"/>
</g>
<!-- attn_out_gpu_4 -->
<g id="node32" class="node">
<title>attn_out_gpu_4</title>
<polygon fill="lightcoral" stroke="black" points="3405.5,-1647.93 2980.5,-1647.93 2980.5,-1564.93 3405.5,-1564.93 3405.5,-1647.93"/>
<text text-anchor="middle" x="3193" y="-1632.73" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3193" y="-1617.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=2048]</text>
<text text-anchor="middle" x="3193" y="-1602.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=2048]</text>
<text text-anchor="middle" x="3193" y="-1587.73" font-family="Times,serif" font-size="14.00">Device: gpu_4</text>
<text text-anchor="middle" x="3193" y="-1572.73" font-family="Times,serif" font-size="14.00">Rows: 8192&#45;10239</text>
</g>
<!-- all2all&#45;&gt;attn_out_gpu_4 -->
<g id="edge42" class="edge">
<title>all2all&#45;&gt;attn_out_gpu_4</title>
<path fill="none" stroke="black" d="M3051.74,-1683.78C3071.5,-1673.1 3090.87,-1662.63 3108.62,-1653.03"/>
<polygon fill="black" stroke="black" points="3110.62,-1655.93 3117.75,-1648.1 3107.29,-1649.77 3110.62,-1655.93"/>
</g>
<!-- attn_out_gpu_5 -->
<g id="node33" class="node">
<title>attn_out_gpu_5</title>
<polygon fill="lightcoral" stroke="black" points="3848.5,-1647.93 3423.5,-1647.93 3423.5,-1564.93 3848.5,-1564.93 3848.5,-1647.93"/>
<text text-anchor="middle" x="3636" y="-1632.73" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3636" y="-1617.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=2048]</text>
<text text-anchor="middle" x="3636" y="-1602.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=2048]</text>
<text text-anchor="middle" x="3636" y="-1587.73" font-family="Times,serif" font-size="14.00">Device: gpu_5</text>
<text text-anchor="middle" x="3636" y="-1572.73" font-family="Times,serif" font-size="14.00">Rows: 10240&#45;12287</text>
</g>
<!-- all2all&#45;&gt;attn_out_gpu_5 -->
<g id="edge44" class="edge">
<title>all2all&#45;&gt;attn_out_gpu_5</title>
<path fill="none" stroke="black" d="M3192.13,-1708.23C3279.13,-1688.47 3370.52,-1667.72 3447.61,-1650.21"/>
<polygon fill="black" stroke="black" points="3448.44,-1653.61 3457.42,-1647.98 3446.89,-1646.78 3448.44,-1653.61"/>
</g>
<!-- attn_out_gpu_6 -->
<g id="node34" class="node">
<title>attn_out_gpu_6</title>
<polygon fill="lightcoral" stroke="black" points="4291.5,-1647.93 3866.5,-1647.93 3866.5,-1564.93 4291.5,-1564.93 4291.5,-1647.93"/>
<text text-anchor="middle" x="4079" y="-1632.73" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4079" y="-1617.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=2048]</text>
<text text-anchor="middle" x="4079" y="-1602.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=2048]</text>
<text text-anchor="middle" x="4079" y="-1587.73" font-family="Times,serif" font-size="14.00">Device: gpu_6</text>
<text text-anchor="middle" x="4079" y="-1572.73" font-family="Times,serif" font-size="14.00">Rows: 12288&#45;14335</text>
</g>
<!-- all2all&#45;&gt;attn_out_gpu_6 -->
<g id="edge46" class="edge">
<title>all2all&#45;&gt;attn_out_gpu_6</title>
<path fill="none" stroke="black" d="M3222.74,-1737.57C3408.23,-1713.65 3639.92,-1682.2 3856.38,-1648.01"/>
<polygon fill="black" stroke="black" points="3857.02,-1651.45 3866.35,-1646.43 3855.93,-1644.53 3857.02,-1651.45"/>
</g>
<!-- attn_out_gpu_7 -->
<g id="node35" class="node">
<title>attn_out_gpu_7</title>
<polygon fill="lightcoral" stroke="black" points="4734.5,-1647.93 4309.5,-1647.93 4309.5,-1564.93 4734.5,-1564.93 4734.5,-1647.93"/>
<text text-anchor="middle" x="4522" y="-1632.73" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4522" y="-1617.73" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=2048]</text>
<text text-anchor="middle" x="4522" y="-1602.73" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=2048]</text>
<text text-anchor="middle" x="4522" y="-1587.73" font-family="Times,serif" font-size="14.00">Device: gpu_7</text>
<text text-anchor="middle" x="4522" y="-1572.73" font-family="Times,serif" font-size="14.00">Rows: 14336&#45;16383</text>
</g>
<!-- all2all&#45;&gt;attn_out_gpu_7 -->
<g id="edge48" class="edge">
<title>all2all&#45;&gt;attn_out_gpu_7</title>
<path fill="none" stroke="black" d="M3241.37,-1755.45C3527.68,-1733.57 3934.29,-1697.85 4299.4,-1647.98"/>
<polygon fill="black" stroke="black" points="4299.95,-1651.43 4309.38,-1646.61 4299,-1644.5 4299.95,-1651.43"/>
</g>
<!-- attn_all_reduce -->
<g id="node36" class="node">
<title>attn_all_reduce</title>
<polygon fill="yellow" stroke="black" points="3642.9,-1528.93 2927.21,-1528.93 2743.1,-1362.93 3458.79,-1362.93 3642.9,-1528.93"/>
<text text-anchor="middle" x="3193" y="-1472.23" font-family="Times,serif" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="3193" y="-1457.23" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3193" y="-1442.23" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3193" y="-1427.23" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3193" y="-1412.23" font-family="Times,serif" font-size="14.00">Device: all GPUs</text>
</g>
<!-- attn_out_gpu_0&#45;&gt;attn_all_reduce -->
<g id="edge35" class="edge">
<title>attn_out_gpu_0&#45;&gt;attn_all_reduce</title>
<path fill="none" stroke="black" d="M1633.53,-1566.05C1636.37,-1565.66 1639.2,-1565.29 1642,-1564.93 2052.83,-1511.8 2528.2,-1479.98 2843.25,-1463"/>
<polygon fill="black" stroke="black" points="2843.66,-1466.48 2853.46,-1462.45 2843.29,-1459.49 2843.66,-1466.48"/>
</g>
<!-- attn_out_gpu_1&#45;&gt;attn_all_reduce -->
<g id="edge37" class="edge">
<title>attn_out_gpu_1&#45;&gt;attn_all_reduce</title>
<path fill="none" stroke="black" d="M2076.55,-1566.17C2079.38,-1565.75 2082.2,-1565.33 2085,-1564.93 2343.32,-1527.55 2637.13,-1496.8 2857.27,-1476.06"/>
<polygon fill="black" stroke="black" points="2857.73,-1479.54 2867.36,-1475.12 2857.08,-1472.57 2857.73,-1479.54"/>
</g>
<!-- attn_out_gpu_2&#45;&gt;attn_all_reduce -->
<g id="edge39" class="edge">
<title>attn_out_gpu_2&#45;&gt;attn_all_reduce</title>
<path fill="none" stroke="black" d="M2519.6,-1566.44C2522.41,-1565.93 2525.22,-1565.43 2528,-1564.93 2644.21,-1543.97 2771.91,-1521.24 2884.06,-1501.37"/>
<polygon fill="black" stroke="black" points="2884.94,-1504.77 2894.18,-1499.58 2883.72,-1497.88 2884.94,-1504.77"/>
</g>
<!-- attn_out_gpu_3&#45;&gt;attn_all_reduce -->
<g id="edge41" class="edge">
<title>attn_out_gpu_3&#45;&gt;attn_all_reduce</title>
<path fill="none" stroke="black" d="M2863.22,-1564.92C2891.22,-1554.9 2922.27,-1543.79 2953.81,-1532.51"/>
<polygon fill="black" stroke="black" points="2955.37,-1535.66 2963.61,-1529 2953.01,-1529.07 2955.37,-1535.66"/>
</g>
<!-- attn_out_gpu_4&#45;&gt;attn_all_reduce -->
<g id="edge43" class="edge">
<title>attn_out_gpu_4&#45;&gt;attn_all_reduce</title>
<path fill="none" stroke="black" d="M3193,-1564.61C3193,-1556.68 3193,-1548.07 3193,-1539.24"/>
<polygon fill="black" stroke="black" points="3196.5,-1539.2 3193,-1529.2 3189.5,-1539.2 3196.5,-1539.2"/>
</g>
<!-- attn_out_gpu_5&#45;&gt;attn_all_reduce -->
<g id="edge45" class="edge">
<title>attn_out_gpu_5&#45;&gt;attn_all_reduce</title>
<path fill="none" stroke="black" d="M3522.78,-1564.92C3494.78,-1554.9 3463.73,-1543.79 3432.19,-1532.51"/>
<polygon fill="black" stroke="black" points="3432.99,-1529.07 3422.39,-1529 3430.63,-1535.66 3432.99,-1529.07"/>
</g>
<!-- attn_out_gpu_6&#45;&gt;attn_all_reduce -->
<g id="edge47" class="edge">
<title>attn_out_gpu_6&#45;&gt;attn_all_reduce</title>
<path fill="none" stroke="black" d="M3866.32,-1566.61C3863.19,-1566.04 3860.08,-1565.48 3857,-1564.93 3790.14,-1552.89 3719.48,-1540.24 3650.18,-1527.89"/>
<polygon fill="black" stroke="black" points="3650.42,-1524.38 3639.96,-1526.07 3649.19,-1531.27 3650.42,-1524.38"/>
</g>
<!-- attn_out_gpu_7&#45;&gt;attn_all_reduce -->
<g id="edge49" class="edge">
<title>attn_out_gpu_7&#45;&gt;attn_all_reduce</title>
<path fill="none" stroke="black" d="M4309.37,-1566.3C4306.23,-1565.83 4303.1,-1565.37 4300,-1564.93 4069.56,-1531.67 3810.87,-1503.58 3601.54,-1483.17"/>
<polygon fill="black" stroke="black" points="3601.59,-1479.65 3591.3,-1482.17 3600.91,-1486.62 3601.59,-1479.65"/>
</g>
<!-- attn_all_reduce&#45;&gt;residual_attn -->
<g id="edge50" class="edge">
<title>attn_all_reduce&#45;&gt;residual_attn</title>
<path fill="none" stroke="black" d="M3478.9,-1380.94C3575.64,-1359.29 3681.73,-1335.54 3771.13,-1315.54"/>
<polygon fill="black" stroke="black" points="3772.11,-1318.9 3781.11,-1313.3 3770.58,-1312.07 3772.11,-1318.9"/>
</g>
<!-- rmsnorm1 -->
<g id="node38" class="node">
<title>rmsnorm1</title>
<polygon fill="lightgray" stroke="black" points="4195,-1173.55 3761,-1173.55 3761,-1105.55 4195,-1105.55 4195,-1173.55"/>
<text text-anchor="middle" x="3978" y="-1158.35" font-family="Times,serif" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="3978" y="-1143.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3978" y="-1128.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3978" y="-1113.35" font-family="Times,serif" font-size="14.00">Device: all GPUs</text>
</g>
<!-- residual_attn&#45;&gt;rmsnorm1 -->
<g id="edge52" class="edge">
<title>residual_attn&#45;&gt;rmsnorm1</title>
<path fill="none" stroke="black" d="M3978,-1209.45C3978,-1200.83 3978,-1192.06 3978,-1183.8"/>
<polygon fill="black" stroke="black" points="3981.5,-1183.66 3978,-1173.66 3974.5,-1183.66 3981.5,-1183.66"/>
</g>
<!-- expert_gate_gpu_0 -->
<g id="node39" class="node">
<title>expert_gate_gpu_0</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="434,-1069.55 0,-986.55 434,-903.55 868,-986.55 434,-1069.55"/>
<text text-anchor="middle" x="434" y="-1012.85" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="434" y="-997.85" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="434" y="-982.85" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="434" y="-967.85" font-family="Times,serif" font-size="14.00">Device: gpu_0</text>
<text text-anchor="middle" x="434" y="-952.85" font-family="Times,serif" font-size="14.00">Experts: 224&#45;255</text>
</g>
<!-- rmsnorm1&#45;&gt;expert_gate_gpu_0 -->
<g id="edge53" class="edge">
<title>rmsnorm1&#45;&gt;expert_gate_gpu_0</title>
<path fill="none" stroke="black" d="M3760.78,-1138.26C3151.98,-1136.72 1437.19,-1127.25 877,-1069.55 800.21,-1061.64 716.79,-1047.64 643.26,-1033.42"/>
<polygon fill="black" stroke="black" points="643.9,-1029.98 633.42,-1031.51 642.56,-1036.85 643.9,-1029.98"/>
</g>
<!-- expert_gate_gpu_1 -->
<g id="node40" class="node">
<title>expert_gate_gpu_1</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1320,-1069.55 886,-986.55 1320,-903.55 1754,-986.55 1320,-1069.55"/>
<text text-anchor="middle" x="1320" y="-1012.85" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1320" y="-997.85" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1320" y="-982.85" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1320" y="-967.85" font-family="Times,serif" font-size="14.00">Device: gpu_1</text>
<text text-anchor="middle" x="1320" y="-952.85" font-family="Times,serif" font-size="14.00">Experts: 224&#45;255</text>
</g>
<!-- rmsnorm1&#45;&gt;expert_gate_gpu_1 -->
<g id="edge58" class="edge">
<title>rmsnorm1&#45;&gt;expert_gate_gpu_1</title>
<path fill="none" stroke="black" d="M3760.86,-1135.98C3281.58,-1129.64 2145.41,-1110.65 1763,-1069.55 1686.53,-1061.33 1603.44,-1047.32 1530.1,-1033.19"/>
<polygon fill="black" stroke="black" points="1530.77,-1029.75 1520.28,-1031.29 1529.44,-1036.63 1530.77,-1029.75"/>
</g>
<!-- expert_gate_gpu_2 -->
<g id="node41" class="node">
<title>expert_gate_gpu_2</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="2206,-1069.55 1772,-986.55 2206,-903.55 2640,-986.55 2206,-1069.55"/>
<text text-anchor="middle" x="2206" y="-1012.85" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="2206" y="-997.85" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="2206" y="-982.85" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="2206" y="-967.85" font-family="Times,serif" font-size="14.00">Device: gpu_2</text>
<text text-anchor="middle" x="2206" y="-952.85" font-family="Times,serif" font-size="14.00">Experts: 224&#45;255</text>
</g>
<!-- rmsnorm1&#45;&gt;expert_gate_gpu_2 -->
<g id="edge63" class="edge">
<title>rmsnorm1&#45;&gt;expert_gate_gpu_2</title>
<path fill="none" stroke="black" d="M3760.88,-1136C3497.13,-1130.9 3039.06,-1115.57 2649,-1069.55 2573.51,-1060.64 2491.5,-1046.68 2418.79,-1032.78"/>
<polygon fill="black" stroke="black" points="2419.08,-1029.27 2408.6,-1030.82 2417.76,-1036.15 2419.08,-1029.27"/>
</g>
<!-- expert_gate_gpu_3 -->
<g id="node42" class="node">
<title>expert_gate_gpu_3</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="3092,-1069.55 2658,-986.55 3092,-903.55 3526,-986.55 3092,-1069.55"/>
<text text-anchor="middle" x="3092" y="-1012.85" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="3092" y="-997.85" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3092" y="-982.85" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3092" y="-967.85" font-family="Times,serif" font-size="14.00">Device: gpu_3</text>
<text text-anchor="middle" x="3092" y="-952.85" font-family="Times,serif" font-size="14.00">Experts: 224&#45;255</text>
</g>
<!-- rmsnorm1&#45;&gt;expert_gate_gpu_3 -->
<g id="edge68" class="edge">
<title>rmsnorm1&#45;&gt;expert_gate_gpu_3</title>
<path fill="none" stroke="black" d="M3760.93,-1106C3688.95,-1094.87 3608.47,-1082.07 3535,-1069.55 3463.99,-1057.45 3386.74,-1043.44 3316.93,-1030.46"/>
<polygon fill="black" stroke="black" points="3317.15,-1026.95 3306.68,-1028.56 3315.87,-1033.83 3317.15,-1026.95"/>
</g>
<!-- expert_gate_gpu_4 -->
<g id="node43" class="node">
<title>expert_gate_gpu_4</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="3978,-1069.55 3544,-986.55 3978,-903.55 4412,-986.55 3978,-1069.55"/>
<text text-anchor="middle" x="3978" y="-1012.85" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="3978" y="-997.85" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3978" y="-982.85" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3978" y="-967.85" font-family="Times,serif" font-size="14.00">Device: gpu_4</text>
<text text-anchor="middle" x="3978" y="-952.85" font-family="Times,serif" font-size="14.00">Experts: 224&#45;255</text>
</g>
<!-- rmsnorm1&#45;&gt;expert_gate_gpu_4 -->
<g id="edge73" class="edge">
<title>rmsnorm1&#45;&gt;expert_gate_gpu_4</title>
<path fill="none" stroke="black" d="M3978,-1105.41C3978,-1097.65 3978,-1089.01 3978,-1080.03"/>
<polygon fill="black" stroke="black" points="3981.5,-1079.78 3978,-1069.78 3974.5,-1079.78 3981.5,-1079.78"/>
</g>
<!-- expert_gate_gpu_5 -->
<g id="node44" class="node">
<title>expert_gate_gpu_5</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="4864,-1069.55 4430,-986.55 4864,-903.55 5298,-986.55 4864,-1069.55"/>
<text text-anchor="middle" x="4864" y="-1012.85" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="4864" y="-997.85" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="4864" y="-982.85" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="4864" y="-967.85" font-family="Times,serif" font-size="14.00">Device: gpu_5</text>
<text text-anchor="middle" x="4864" y="-952.85" font-family="Times,serif" font-size="14.00">Experts: 224&#45;255</text>
</g>
<!-- rmsnorm1&#45;&gt;expert_gate_gpu_5 -->
<g id="edge78" class="edge">
<title>rmsnorm1&#45;&gt;expert_gate_gpu_5</title>
<path fill="none" stroke="black" d="M4195.07,-1106C4267.05,-1094.87 4347.53,-1082.07 4421,-1069.55 4492.01,-1057.45 4569.26,-1043.44 4639.07,-1030.46"/>
<polygon fill="black" stroke="black" points="4640.13,-1033.83 4649.32,-1028.56 4638.85,-1026.95 4640.13,-1033.83"/>
</g>
<!-- expert_gate_gpu_6 -->
<g id="node45" class="node">
<title>expert_gate_gpu_6</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="5750,-1069.55 5316,-986.55 5750,-903.55 6184,-986.55 5750,-1069.55"/>
<text text-anchor="middle" x="5750" y="-1012.85" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="5750" y="-997.85" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="5750" y="-982.85" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="5750" y="-967.85" font-family="Times,serif" font-size="14.00">Device: gpu_6</text>
<text text-anchor="middle" x="5750" y="-952.85" font-family="Times,serif" font-size="14.00">Experts: 224&#45;255</text>
</g>
<!-- rmsnorm1&#45;&gt;expert_gate_gpu_6 -->
<g id="edge83" class="edge">
<title>rmsnorm1&#45;&gt;expert_gate_gpu_6</title>
<path fill="none" stroke="black" d="M4195.12,-1136C4458.87,-1130.9 4916.94,-1115.57 5307,-1069.55 5382.49,-1060.64 5464.5,-1046.68 5537.21,-1032.78"/>
<polygon fill="black" stroke="black" points="5538.24,-1036.15 5547.4,-1030.82 5536.92,-1029.27 5538.24,-1036.15"/>
</g>
<!-- expert_gate_gpu_7 -->
<g id="node46" class="node">
<title>expert_gate_gpu_7</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="6636,-1069.55 6202,-986.55 6636,-903.55 7070,-986.55 6636,-1069.55"/>
<text text-anchor="middle" x="6636" y="-1012.85" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="6636" y="-997.85" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="6636" y="-982.85" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="6636" y="-967.85" font-family="Times,serif" font-size="14.00">Device: gpu_7</text>
<text text-anchor="middle" x="6636" y="-952.85" font-family="Times,serif" font-size="14.00">Experts: 224&#45;255</text>
</g>
<!-- rmsnorm1&#45;&gt;expert_gate_gpu_7 -->
<g id="edge88" class="edge">
<title>rmsnorm1&#45;&gt;expert_gate_gpu_7</title>
<path fill="none" stroke="black" d="M4195.14,-1135.98C4674.42,-1129.64 5810.59,-1110.65 6193,-1069.55 6269.47,-1061.33 6352.56,-1047.32 6425.9,-1033.19"/>
<polygon fill="black" stroke="black" points="6426.56,-1036.63 6435.72,-1031.29 6425.23,-1029.75 6426.56,-1036.63"/>
</g>
<!-- residual_ffn -->
<g id="node72" class="node">
<title>residual_ffn</title>
<ellipse fill="lightgreen" stroke="black" cx="5538" cy="-294.86" rx="306.77" ry="58.88"/>
<text text-anchor="middle" x="5538" y="-321.16" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5538" y="-306.16" font-family="Times,serif" font-size="14.00">FFN</text>
<text text-anchor="middle" x="5538" y="-291.16" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="5538" y="-276.16" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="5538" y="-261.16" font-family="Times,serif" font-size="14.00">Device: all GPUs</text>
</g>
<!-- rmsnorm1&#45;&gt;residual_ffn -->
<g id="edge94" class="edge">
<title>rmsnorm1&#45;&gt;residual_ffn</title>
<path fill="none" stroke="black" d="M4195.26,-1137.58C4891.74,-1134 7026.57,-1119 7079,-1069.55 7155.23,-997.65 7098,-939.33 7098,-834.55 7098,-834.55 7098,-834.55 7098,-624.55 7098,-372.8 6310.32,-312.86 5854.38,-299.26"/>
<polygon fill="black" stroke="black" points="5854.44,-295.76 5844.34,-298.96 5854.24,-302.75 5854.44,-295.76"/>
</g>
<!-- expert_fc1_gpu_0 -->
<g id="node47" class="node">
<title>expert_fc1_gpu_0</title>
<polygon fill="lightblue" stroke="black" points="862,-867.55 440,-867.55 440,-799.55 862,-799.55 862,-867.55"/>
<text text-anchor="middle" x="651" y="-852.35" font-family="Times,serif" font-size="14.00">Expert FC1</text>
<text text-anchor="middle" x="651" y="-837.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="651" y="-822.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="651" y="-807.35" font-family="Times,serif" font-size="14.00">Device: gpu_0</text>
</g>
<!-- expert_gate_gpu_0&#45;&gt;expert_fc1_gpu_0 -->
<g id="edge54" class="edge">
<title>expert_gate_gpu_0&#45;&gt;expert_fc1_gpu_0</title>
<path fill="none" stroke="black" d="M526.66,-921.07C549.94,-904.87 574.23,-887.97 595.09,-873.45"/>
<polygon fill="black" stroke="black" points="597.29,-876.18 603.5,-867.6 593.29,-870.44 597.29,-876.18"/>
</g>
<!-- expert_fc1_gpu_1 -->
<g id="node48" class="node">
<title>expert_fc1_gpu_1</title>
<polygon fill="lightblue" stroke="black" points="1649,-867.55 1227,-867.55 1227,-799.55 1649,-799.55 1649,-867.55"/>
<text text-anchor="middle" x="1438" y="-852.35" font-family="Times,serif" font-size="14.00">Expert FC1</text>
<text text-anchor="middle" x="1438" y="-837.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1438" y="-822.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="1438" y="-807.35" font-family="Times,serif" font-size="14.00">Device: gpu_1</text>
</g>
<!-- expert_gate_gpu_1&#45;&gt;expert_fc1_gpu_1 -->
<g id="edge59" class="edge">
<title>expert_gate_gpu_1&#45;&gt;expert_fc1_gpu_1</title>
<path fill="none" stroke="black" d="M1375.89,-914.03C1386.15,-900.9 1396.54,-887.6 1405.8,-875.75"/>
<polygon fill="black" stroke="black" points="1408.62,-877.82 1412.02,-867.79 1403.11,-873.51 1408.62,-877.82"/>
</g>
<!-- expert_fc1_gpu_2 -->
<g id="node49" class="node">
<title>expert_fc1_gpu_2</title>
<polygon fill="lightblue" stroke="black" points="2525,-867.55 2103,-867.55 2103,-799.55 2525,-799.55 2525,-867.55"/>
<text text-anchor="middle" x="2314" y="-852.35" font-family="Times,serif" font-size="14.00">Expert FC1</text>
<text text-anchor="middle" x="2314" y="-837.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="2314" y="-822.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="2314" y="-807.35" font-family="Times,serif" font-size="14.00">Device: gpu_2</text>
</g>
<!-- expert_gate_gpu_2&#45;&gt;expert_fc1_gpu_2 -->
<g id="edge64" class="edge">
<title>expert_gate_gpu_2&#45;&gt;expert_fc1_gpu_2</title>
<path fill="none" stroke="black" d="M2257.79,-913.14C2266.93,-900.35 2276.17,-887.44 2284.43,-875.89"/>
<polygon fill="black" stroke="black" points="2287.29,-877.9 2290.26,-867.73 2281.6,-873.83 2287.29,-877.9"/>
</g>
<!-- expert_fc1_gpu_3 -->
<g id="node50" class="node">
<title>expert_fc1_gpu_3</title>
<polygon fill="lightblue" stroke="black" points="3357,-867.55 2935,-867.55 2935,-799.55 3357,-799.55 3357,-867.55"/>
<text text-anchor="middle" x="3146" y="-852.35" font-family="Times,serif" font-size="14.00">Expert FC1</text>
<text text-anchor="middle" x="3146" y="-837.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3146" y="-822.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="3146" y="-807.35" font-family="Times,serif" font-size="14.00">Device: gpu_3</text>
</g>
<!-- expert_gate_gpu_3&#45;&gt;expert_fc1_gpu_3 -->
<g id="edge69" class="edge">
<title>expert_gate_gpu_3&#45;&gt;expert_fc1_gpu_3</title>
<path fill="none" stroke="black" d="M3119.47,-908.72C3123.34,-897.9 3127.2,-887.12 3130.72,-877.26"/>
<polygon fill="black" stroke="black" points="3134.06,-878.34 3134.13,-867.74 3127.47,-875.98 3134.06,-878.34"/>
</g>
<!-- expert_fc1_gpu_4 -->
<g id="node51" class="node">
<title>expert_fc1_gpu_4</title>
<polygon fill="lightblue" stroke="black" points="4189,-867.55 3767,-867.55 3767,-799.55 4189,-799.55 4189,-867.55"/>
<text text-anchor="middle" x="3978" y="-852.35" font-family="Times,serif" font-size="14.00">Expert FC1</text>
<text text-anchor="middle" x="3978" y="-837.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3978" y="-822.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="3978" y="-807.35" font-family="Times,serif" font-size="14.00">Device: gpu_4</text>
</g>
<!-- expert_gate_gpu_4&#45;&gt;expert_fc1_gpu_4 -->
<g id="edge74" class="edge">
<title>expert_gate_gpu_4&#45;&gt;expert_fc1_gpu_4</title>
<path fill="none" stroke="black" d="M3978,-903.42C3978,-894.66 3978,-886.03 3978,-877.99"/>
<polygon fill="black" stroke="black" points="3981.5,-877.81 3978,-867.81 3974.5,-877.81 3981.5,-877.81"/>
</g>
<!-- expert_fc1_gpu_5 -->
<g id="node52" class="node">
<title>expert_fc1_gpu_5</title>
<polygon fill="lightblue" stroke="black" points="4858,-867.55 4436,-867.55 4436,-799.55 4858,-799.55 4858,-867.55"/>
<text text-anchor="middle" x="4647" y="-852.35" font-family="Times,serif" font-size="14.00">Expert FC1</text>
<text text-anchor="middle" x="4647" y="-837.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="4647" y="-822.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="4647" y="-807.35" font-family="Times,serif" font-size="14.00">Device: gpu_5</text>
</g>
<!-- expert_gate_gpu_5&#45;&gt;expert_fc1_gpu_5 -->
<g id="edge79" class="edge">
<title>expert_gate_gpu_5&#45;&gt;expert_fc1_gpu_5</title>
<path fill="none" stroke="black" d="M4771.34,-921.07C4748.06,-904.87 4723.77,-887.97 4702.91,-873.45"/>
<polygon fill="black" stroke="black" points="4704.71,-870.44 4694.5,-867.6 4700.71,-876.18 4704.71,-870.44"/>
</g>
<!-- expert_fc1_gpu_6 -->
<g id="node53" class="node">
<title>expert_fc1_gpu_6</title>
<polygon fill="lightblue" stroke="black" points="5636,-867.55 5214,-867.55 5214,-799.55 5636,-799.55 5636,-867.55"/>
<text text-anchor="middle" x="5425" y="-852.35" font-family="Times,serif" font-size="14.00">Expert FC1</text>
<text text-anchor="middle" x="5425" y="-837.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="5425" y="-822.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="5425" y="-807.35" font-family="Times,serif" font-size="14.00">Device: gpu_6</text>
</g>
<!-- expert_gate_gpu_6&#45;&gt;expert_fc1_gpu_6 -->
<g id="edge84" class="edge">
<title>expert_gate_gpu_6&#45;&gt;expert_fc1_gpu_6</title>
<path fill="none" stroke="black" d="M5624.81,-927.38C5584.76,-908.77 5541.51,-888.68 5505.53,-871.96"/>
<polygon fill="black" stroke="black" points="5506.61,-868.6 5496.06,-867.56 5503.66,-874.95 5506.61,-868.6"/>
</g>
<!-- expert_fc1_gpu_7 -->
<g id="node54" class="node">
<title>expert_fc1_gpu_7</title>
<polygon fill="lightblue" stroke="black" points="6468,-867.55 6046,-867.55 6046,-799.55 6468,-799.55 6468,-867.55"/>
<text text-anchor="middle" x="6257" y="-852.35" font-family="Times,serif" font-size="14.00">Expert FC1</text>
<text text-anchor="middle" x="6257" y="-837.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="6257" y="-822.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="6257" y="-807.35" font-family="Times,serif" font-size="14.00">Device: gpu_7</text>
</g>
<!-- expert_gate_gpu_7&#45;&gt;expert_fc1_gpu_7 -->
<g id="edge89" class="edge">
<title>expert_gate_gpu_7&#45;&gt;expert_fc1_gpu_7</title>
<path fill="none" stroke="black" d="M6496.76,-930.07C6447.57,-910.47 6393.51,-888.94 6349.2,-871.28"/>
<polygon fill="black" stroke="black" points="6350.48,-868.02 6339.9,-867.57 6347.89,-874.53 6350.48,-868.02"/>
</g>
<!-- expert_act_gpu_0 -->
<g id="node55" class="node">
<title>expert_act_gpu_0</title>
<polygon fill="lightblue" stroke="black" points="1357.5,-763.55 962.5,-763.55 962.5,-695.55 1357.5,-695.55 1357.5,-763.55"/>
<text text-anchor="middle" x="1160" y="-748.35" font-family="Times,serif" font-size="14.00">SiLU Activation</text>
<text text-anchor="middle" x="1160" y="-733.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="1160" y="-718.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="1160" y="-703.35" font-family="Times,serif" font-size="14.00">Device: gpu_0</text>
</g>
<!-- expert_fc1_gpu_0&#45;&gt;expert_act_gpu_0 -->
<g id="edge55" class="edge">
<title>expert_fc1_gpu_0&#45;&gt;expert_act_gpu_0</title>
<path fill="none" stroke="black" d="M815.91,-799.5C870.01,-788.66 930.3,-776.58 985.11,-765.59"/>
<polygon fill="black" stroke="black" points="985.8,-769.02 994.92,-763.63 984.43,-762.16 985.8,-769.02"/>
</g>
<!-- expert_act_gpu_1 -->
<g id="node56" class="node">
<title>expert_act_gpu_1</title>
<polygon fill="lightblue" stroke="black" points="1871.5,-763.55 1476.5,-763.55 1476.5,-695.55 1871.5,-695.55 1871.5,-763.55"/>
<text text-anchor="middle" x="1674" y="-748.35" font-family="Times,serif" font-size="14.00">SiLU Activation</text>
<text text-anchor="middle" x="1674" y="-733.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="1674" y="-718.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="1674" y="-703.35" font-family="Times,serif" font-size="14.00">Device: gpu_1</text>
</g>
<!-- expert_fc1_gpu_1&#45;&gt;expert_act_gpu_1 -->
<g id="edge60" class="edge">
<title>expert_fc1_gpu_1&#45;&gt;expert_act_gpu_1</title>
<path fill="none" stroke="black" d="M1514.62,-799.43C1538.03,-789.31 1563.92,-778.12 1587.92,-767.75"/>
<polygon fill="black" stroke="black" points="1589.57,-770.85 1597.36,-763.67 1586.79,-764.43 1589.57,-770.85"/>
</g>
<!-- expert_act_gpu_2 -->
<g id="node57" class="node">
<title>expert_act_gpu_2</title>
<polygon fill="lightblue" stroke="black" points="2728.5,-763.55 2333.5,-763.55 2333.5,-695.55 2728.5,-695.55 2728.5,-763.55"/>
<text text-anchor="middle" x="2531" y="-748.35" font-family="Times,serif" font-size="14.00">SiLU Activation</text>
<text text-anchor="middle" x="2531" y="-733.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="2531" y="-718.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="2531" y="-703.35" font-family="Times,serif" font-size="14.00">Device: gpu_2</text>
</g>
<!-- expert_fc1_gpu_2&#45;&gt;expert_act_gpu_2 -->
<g id="edge65" class="edge">
<title>expert_fc1_gpu_2&#45;&gt;expert_act_gpu_2</title>
<path fill="none" stroke="black" d="M2384.45,-799.43C2405.79,-789.4 2429.36,-778.32 2451.26,-768.03"/>
<polygon fill="black" stroke="black" points="2452.97,-771.09 2460.53,-763.67 2449.99,-764.76 2452.97,-771.09"/>
</g>
<!-- expert_act_gpu_3 -->
<g id="node58" class="node">
<title>expert_act_gpu_3</title>
<polygon fill="lightblue" stroke="black" points="3451.5,-763.55 3056.5,-763.55 3056.5,-695.55 3451.5,-695.55 3451.5,-763.55"/>
<text text-anchor="middle" x="3254" y="-748.35" font-family="Times,serif" font-size="14.00">SiLU Activation</text>
<text text-anchor="middle" x="3254" y="-733.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="3254" y="-718.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="3254" y="-703.35" font-family="Times,serif" font-size="14.00">Device: gpu_3</text>
</g>
<!-- expert_fc1_gpu_3&#45;&gt;expert_act_gpu_3 -->
<g id="edge70" class="edge">
<title>expert_fc1_gpu_3&#45;&gt;expert_act_gpu_3</title>
<path fill="none" stroke="black" d="M3181.06,-799.43C3190.68,-790.34 3201.22,-780.39 3211.22,-770.95"/>
<polygon fill="black" stroke="black" points="3213.87,-773.26 3218.74,-763.85 3209.07,-768.17 3213.87,-773.26"/>
</g>
<!-- expert_act_gpu_4 -->
<g id="node59" class="node">
<title>expert_act_gpu_4</title>
<polygon fill="lightblue" stroke="black" points="4175.5,-763.55 3780.5,-763.55 3780.5,-695.55 4175.5,-695.55 4175.5,-763.55"/>
<text text-anchor="middle" x="3978" y="-748.35" font-family="Times,serif" font-size="14.00">SiLU Activation</text>
<text text-anchor="middle" x="3978" y="-733.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="3978" y="-718.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="3978" y="-703.35" font-family="Times,serif" font-size="14.00">Device: gpu_4</text>
</g>
<!-- expert_fc1_gpu_4&#45;&gt;expert_act_gpu_4 -->
<g id="edge75" class="edge">
<title>expert_fc1_gpu_4&#45;&gt;expert_act_gpu_4</title>
<path fill="none" stroke="black" d="M3978,-799.43C3978,-791.32 3978,-782.53 3978,-774.02"/>
<polygon fill="black" stroke="black" points="3981.5,-773.85 3978,-763.85 3974.5,-773.85 3981.5,-773.85"/>
</g>
<!-- expert_act_gpu_5 -->
<g id="node60" class="node">
<title>expert_act_gpu_5</title>
<polygon fill="lightblue" stroke="black" points="4736.5,-763.55 4341.5,-763.55 4341.5,-695.55 4736.5,-695.55 4736.5,-763.55"/>
<text text-anchor="middle" x="4539" y="-748.35" font-family="Times,serif" font-size="14.00">SiLU Activation</text>
<text text-anchor="middle" x="4539" y="-733.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="4539" y="-718.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="4539" y="-703.35" font-family="Times,serif" font-size="14.00">Device: gpu_5</text>
</g>
<!-- expert_fc1_gpu_5&#45;&gt;expert_act_gpu_5 -->
<g id="edge80" class="edge">
<title>expert_fc1_gpu_5&#45;&gt;expert_act_gpu_5</title>
<path fill="none" stroke="black" d="M4611.94,-799.43C4602.32,-790.34 4591.78,-780.39 4581.78,-770.95"/>
<polygon fill="black" stroke="black" points="4583.93,-768.17 4574.26,-763.85 4579.13,-773.26 4583.93,-768.17"/>
</g>
<!-- expert_act_gpu_6 -->
<g id="node61" class="node">
<title>expert_act_gpu_6</title>
<polygon fill="lightblue" stroke="black" points="5405.5,-763.55 5010.5,-763.55 5010.5,-695.55 5405.5,-695.55 5405.5,-763.55"/>
<text text-anchor="middle" x="5208" y="-748.35" font-family="Times,serif" font-size="14.00">SiLU Activation</text>
<text text-anchor="middle" x="5208" y="-733.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="5208" y="-718.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="5208" y="-703.35" font-family="Times,serif" font-size="14.00">Device: gpu_6</text>
</g>
<!-- expert_fc1_gpu_6&#45;&gt;expert_act_gpu_6 -->
<g id="edge85" class="edge">
<title>expert_fc1_gpu_6&#45;&gt;expert_act_gpu_6</title>
<path fill="none" stroke="black" d="M5354.55,-799.43C5333.21,-789.4 5309.64,-778.32 5287.74,-768.03"/>
<polygon fill="black" stroke="black" points="5289.01,-764.76 5278.47,-763.67 5286.03,-771.09 5289.01,-764.76"/>
</g>
<!-- expert_act_gpu_7 -->
<g id="node62" class="node">
<title>expert_act_gpu_7</title>
<polygon fill="lightblue" stroke="black" points="6156.5,-763.55 5761.5,-763.55 5761.5,-695.55 6156.5,-695.55 6156.5,-763.55"/>
<text text-anchor="middle" x="5959" y="-748.35" font-family="Times,serif" font-size="14.00">SiLU Activation</text>
<text text-anchor="middle" x="5959" y="-733.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="5959" y="-718.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="5959" y="-703.35" font-family="Times,serif" font-size="14.00">Device: gpu_7</text>
</g>
<!-- expert_fc1_gpu_7&#45;&gt;expert_act_gpu_7 -->
<g id="edge90" class="edge">
<title>expert_fc1_gpu_7&#45;&gt;expert_act_gpu_7</title>
<path fill="none" stroke="black" d="M6160.25,-799.43C6129.83,-789.02 6096.08,-777.47 6065.06,-766.85"/>
<polygon fill="black" stroke="black" points="6066.12,-763.51 6055.52,-763.58 6063.85,-770.13 6066.12,-763.51"/>
</g>
<!-- expert_fc2_gpu_0 -->
<g id="node63" class="node">
<title>expert_fc2_gpu_0</title>
<polygon fill="lightblue" stroke="black" points="1485,-659.55 1051,-659.55 1051,-591.55 1485,-591.55 1485,-659.55"/>
<text text-anchor="middle" x="1268" y="-644.35" font-family="Times,serif" font-size="14.00">Expert FC2</text>
<text text-anchor="middle" x="1268" y="-629.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="1268" y="-614.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1268" y="-599.35" font-family="Times,serif" font-size="14.00">Device: gpu_0</text>
</g>
<!-- expert_act_gpu_0&#45;&gt;expert_fc2_gpu_0 -->
<g id="edge56" class="edge">
<title>expert_act_gpu_0&#45;&gt;expert_fc2_gpu_0</title>
<path fill="none" stroke="black" d="M1195.06,-695.43C1204.68,-686.34 1215.22,-676.39 1225.22,-666.95"/>
<polygon fill="black" stroke="black" points="1227.87,-669.26 1232.74,-659.85 1223.07,-664.17 1227.87,-669.26"/>
</g>
<!-- expert_fc2_gpu_1 -->
<g id="node64" class="node">
<title>expert_fc2_gpu_1</title>
<polygon fill="lightblue" stroke="black" points="1991,-659.55 1557,-659.55 1557,-591.55 1991,-591.55 1991,-659.55"/>
<text text-anchor="middle" x="1774" y="-644.35" font-family="Times,serif" font-size="14.00">Expert FC2</text>
<text text-anchor="middle" x="1774" y="-629.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="1774" y="-614.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="1774" y="-599.35" font-family="Times,serif" font-size="14.00">Device: gpu_1</text>
</g>
<!-- expert_act_gpu_1&#45;&gt;expert_fc2_gpu_1 -->
<g id="edge61" class="edge">
<title>expert_act_gpu_1&#45;&gt;expert_fc2_gpu_1</title>
<path fill="none" stroke="black" d="M1706.47,-695.43C1715.29,-686.43 1724.94,-676.59 1734.12,-667.22"/>
<polygon fill="black" stroke="black" points="1736.85,-669.44 1741.35,-659.85 1731.85,-664.54 1736.85,-669.44"/>
</g>
<!-- expert_fc2_gpu_2 -->
<g id="node65" class="node">
<title>expert_fc2_gpu_2</title>
<polygon fill="lightblue" stroke="black" points="2965,-659.55 2531,-659.55 2531,-591.55 2965,-591.55 2965,-659.55"/>
<text text-anchor="middle" x="2748" y="-644.35" font-family="Times,serif" font-size="14.00">Expert FC2</text>
<text text-anchor="middle" x="2748" y="-629.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="2748" y="-614.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="2748" y="-599.35" font-family="Times,serif" font-size="14.00">Device: gpu_2</text>
</g>
<!-- expert_act_gpu_2&#45;&gt;expert_fc2_gpu_2 -->
<g id="edge66" class="edge">
<title>expert_act_gpu_2&#45;&gt;expert_fc2_gpu_2</title>
<path fill="none" stroke="black" d="M2601.45,-695.43C2622.79,-685.4 2646.36,-674.32 2668.26,-664.03"/>
<polygon fill="black" stroke="black" points="2669.97,-667.09 2677.53,-659.67 2666.99,-660.76 2669.97,-667.09"/>
</g>
<!-- expert_fc2_gpu_3 -->
<g id="node66" class="node">
<title>expert_fc2_gpu_3</title>
<polygon fill="lightblue" stroke="black" points="3688,-659.55 3254,-659.55 3254,-591.55 3688,-591.55 3688,-659.55"/>
<text text-anchor="middle" x="3471" y="-644.35" font-family="Times,serif" font-size="14.00">Expert FC2</text>
<text text-anchor="middle" x="3471" y="-629.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="3471" y="-614.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3471" y="-599.35" font-family="Times,serif" font-size="14.00">Device: gpu_3</text>
</g>
<!-- expert_act_gpu_3&#45;&gt;expert_fc2_gpu_3 -->
<g id="edge71" class="edge">
<title>expert_act_gpu_3&#45;&gt;expert_fc2_gpu_3</title>
<path fill="none" stroke="black" d="M3324.45,-695.43C3345.79,-685.4 3369.36,-674.32 3391.26,-664.03"/>
<polygon fill="black" stroke="black" points="3392.97,-667.09 3400.53,-659.67 3389.99,-660.76 3392.97,-667.09"/>
</g>
<!-- expert_fc2_gpu_4 -->
<g id="node67" class="node">
<title>expert_fc2_gpu_4</title>
<polygon fill="lightblue" stroke="black" points="4195,-659.55 3761,-659.55 3761,-591.55 4195,-591.55 4195,-659.55"/>
<text text-anchor="middle" x="3978" y="-644.35" font-family="Times,serif" font-size="14.00">Expert FC2</text>
<text text-anchor="middle" x="3978" y="-629.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="3978" y="-614.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3978" y="-599.35" font-family="Times,serif" font-size="14.00">Device: gpu_4</text>
</g>
<!-- expert_act_gpu_4&#45;&gt;expert_fc2_gpu_4 -->
<g id="edge76" class="edge">
<title>expert_act_gpu_4&#45;&gt;expert_fc2_gpu_4</title>
<path fill="none" stroke="black" d="M3978,-695.43C3978,-687.32 3978,-678.53 3978,-670.02"/>
<polygon fill="black" stroke="black" points="3981.5,-669.85 3978,-659.85 3974.5,-669.85 3981.5,-669.85"/>
</g>
<!-- expert_fc2_gpu_5 -->
<g id="node68" class="node">
<title>expert_fc2_gpu_5</title>
<polygon fill="lightblue" stroke="black" points="4702,-659.55 4268,-659.55 4268,-591.55 4702,-591.55 4702,-659.55"/>
<text text-anchor="middle" x="4485" y="-644.35" font-family="Times,serif" font-size="14.00">Expert FC2</text>
<text text-anchor="middle" x="4485" y="-629.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="4485" y="-614.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="4485" y="-599.35" font-family="Times,serif" font-size="14.00">Device: gpu_5</text>
</g>
<!-- expert_act_gpu_5&#45;&gt;expert_fc2_gpu_5 -->
<g id="edge81" class="edge">
<title>expert_act_gpu_5&#45;&gt;expert_fc2_gpu_5</title>
<path fill="none" stroke="black" d="M4521.47,-695.43C4516.99,-686.97 4512.11,-677.75 4507.42,-668.9"/>
<polygon fill="black" stroke="black" points="4510.4,-667.05 4502.63,-659.85 4504.21,-670.32 4510.4,-667.05"/>
</g>
<!-- expert_fc2_gpu_6 -->
<g id="node69" class="node">
<title>expert_fc2_gpu_6</title>
<polygon fill="lightblue" stroke="black" points="5290,-659.55 4856,-659.55 4856,-591.55 5290,-591.55 5290,-659.55"/>
<text text-anchor="middle" x="5073" y="-644.35" font-family="Times,serif" font-size="14.00">Expert FC2</text>
<text text-anchor="middle" x="5073" y="-629.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="5073" y="-614.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="5073" y="-599.35" font-family="Times,serif" font-size="14.00">Device: gpu_6</text>
</g>
<!-- expert_act_gpu_6&#45;&gt;expert_fc2_gpu_6 -->
<g id="edge86" class="edge">
<title>expert_act_gpu_6&#45;&gt;expert_fc2_gpu_6</title>
<path fill="none" stroke="black" d="M5164.17,-695.43C5151.79,-686.08 5138.2,-675.81 5125.37,-666.11"/>
<polygon fill="black" stroke="black" points="5127.16,-663.08 5117.07,-659.85 5122.94,-668.67 5127.16,-663.08"/>
</g>
<!-- expert_fc2_gpu_7 -->
<g id="node70" class="node">
<title>expert_fc2_gpu_7</title>
<polygon fill="lightblue" stroke="black" points="5959,-659.55 5525,-659.55 5525,-591.55 5959,-591.55 5959,-659.55"/>
<text text-anchor="middle" x="5742" y="-644.35" font-family="Times,serif" font-size="14.00">Expert FC2</text>
<text text-anchor="middle" x="5742" y="-629.35" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, ffn=8192]</text>
<text text-anchor="middle" x="5742" y="-614.35" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="5742" y="-599.35" font-family="Times,serif" font-size="14.00">Device: gpu_7</text>
</g>
<!-- expert_act_gpu_7&#45;&gt;expert_fc2_gpu_7 -->
<g id="edge91" class="edge">
<title>expert_act_gpu_7&#45;&gt;expert_fc2_gpu_7</title>
<path fill="none" stroke="black" d="M5888.55,-695.43C5867.21,-685.4 5843.64,-674.32 5821.74,-664.03"/>
<polygon fill="black" stroke="black" points="5823.01,-660.76 5812.47,-659.67 5820.03,-667.09 5823.01,-660.76"/>
</g>
<!-- ffn_all_reduce -->
<g id="node71" class="node">
<title>ffn_all_reduce</title>
<polygon fill="yellow" stroke="black" points="4427.9,-555.55 3712.21,-555.55 3528.1,-389.55 4243.79,-389.55 4427.9,-555.55"/>
<text text-anchor="middle" x="3978" y="-498.85" font-family="Times,serif" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="3978" y="-483.85" font-family="Times,serif" font-size="14.00">FFN Output</text>
<text text-anchor="middle" x="3978" y="-468.85" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3978" y="-453.85" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="3978" y="-438.85" font-family="Times,serif" font-size="14.00">Device: all GPUs</text>
</g>
<!-- expert_fc2_gpu_0&#45;&gt;ffn_all_reduce -->
<g id="edge57" class="edge">
<title>expert_fc2_gpu_0&#45;&gt;ffn_all_reduce</title>
<path fill="none" stroke="black" d="M1485.29,-597.45C1506.46,-595.26 1527.63,-593.24 1548,-591.55 2283.58,-530.41 3147.24,-497.76 3621.36,-483.19"/>
<polygon fill="black" stroke="black" points="3621.55,-486.68 3631.44,-482.88 3621.34,-479.68 3621.55,-486.68"/>
</g>
<!-- expert_fc2_gpu_1&#45;&gt;ffn_all_reduce -->
<g id="edge62" class="edge">
<title>expert_fc2_gpu_1&#45;&gt;ffn_all_reduce</title>
<path fill="none" stroke="black" d="M1991.11,-609.67C2375.17,-583.36 3177.06,-528.42 3636.03,-496.98"/>
<polygon fill="black" stroke="black" points="3636.39,-500.46 3646.13,-496.28 3635.91,-493.48 3636.39,-500.46"/>
</g>
<!-- expert_fc2_gpu_2&#45;&gt;ffn_all_reduce -->
<g id="edge67" class="edge">
<title>expert_fc2_gpu_2&#45;&gt;ffn_all_reduce</title>
<path fill="none" stroke="black" d="M2965.07,-597.9C3155.93,-574.47 3436.4,-540.03 3653.85,-513.34"/>
<polygon fill="black" stroke="black" points="3654.33,-516.81 3663.83,-512.11 3653.48,-509.86 3654.33,-516.81"/>
</g>
<!-- expert_fc2_gpu_3&#45;&gt;ffn_all_reduce -->
<g id="edge72" class="edge">
<title>expert_fc2_gpu_3&#45;&gt;ffn_all_reduce</title>
<path fill="none" stroke="black" d="M3581.95,-591.5C3617.3,-580.97 3658.13,-568.81 3699.86,-556.38"/>
<polygon fill="black" stroke="black" points="3701.04,-559.68 3709.63,-553.48 3699.04,-552.98 3701.04,-559.68"/>
</g>
<!-- expert_fc2_gpu_4&#45;&gt;ffn_all_reduce -->
<g id="edge77" class="edge">
<title>expert_fc2_gpu_4&#45;&gt;ffn_all_reduce</title>
<path fill="none" stroke="black" d="M3978,-591.41C3978,-583.65 3978,-575.01 3978,-566.03"/>
<polygon fill="black" stroke="black" points="3981.5,-565.78 3978,-555.78 3974.5,-565.78 3981.5,-565.78"/>
</g>
<!-- expert_fc2_gpu_5&#45;&gt;ffn_all_reduce -->
<g id="edge82" class="edge">
<title>expert_fc2_gpu_5&#45;&gt;ffn_all_reduce</title>
<path fill="none" stroke="black" d="M4374.05,-591.5C4340.74,-581.58 4302.56,-570.21 4263.34,-558.53"/>
<polygon fill="black" stroke="black" points="4263.94,-555.05 4253.35,-555.55 4261.94,-561.76 4263.94,-555.05"/>
</g>
<!-- expert_fc2_gpu_6&#45;&gt;ffn_all_reduce -->
<g id="edge87" class="edge">
<title>expert_fc2_gpu_6&#45;&gt;ffn_all_reduce</title>
<path fill="none" stroke="black" d="M4855.68,-594.58C4728.84,-577.09 4564.25,-554.39 4411.93,-533.39"/>
<polygon fill="black" stroke="black" points="4412.3,-529.9 4401.92,-532 4411.34,-536.84 4412.3,-529.9"/>
</g>
<!-- expert_fc2_gpu_7&#45;&gt;ffn_all_reduce -->
<g id="edge92" class="edge">
<title>expert_fc2_gpu_7&#45;&gt;ffn_all_reduce</title>
<path fill="none" stroke="black" d="M5524.82,-605.96C5241.48,-581.7 4740.12,-538.78 4385.07,-508.39"/>
<polygon fill="black" stroke="black" points="4385.13,-504.88 4374.87,-507.52 4384.53,-511.86 4385.13,-504.88"/>
</g>
<!-- ffn_all_reduce&#45;&gt;residual_ffn -->
<g id="edge93" class="edge">
<title>ffn_all_reduce&#45;&gt;residual_ffn</title>
<path fill="none" stroke="black" d="M4295.57,-435.78C4580.91,-403.65 4995.46,-356.96 5265.89,-326.5"/>
<polygon fill="black" stroke="black" points="5266.31,-329.98 5275.85,-325.38 5265.52,-323.02 5266.31,-329.98"/>
</g>
<!-- rmsnorm2 -->
<g id="node73" class="node">
<title>rmsnorm2</title>
<polygon fill="lightgray" stroke="black" points="5755,-200.17 5321,-200.17 5321,-132.17 5755,-132.17 5755,-200.17"/>
<text text-anchor="middle" x="5538" y="-184.97" font-family="Times,serif" font-size="14.00">RMSNorm</text>
<text text-anchor="middle" x="5538" y="-169.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="5538" y="-154.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="5538" y="-139.97" font-family="Times,serif" font-size="14.00">Device: all GPUs</text>
</g>
<!-- residual_ffn&#45;&gt;rmsnorm2 -->
<g id="edge95" class="edge">
<title>residual_ffn&#45;&gt;rmsnorm2</title>
<path fill="none" stroke="black" d="M5538,-236.07C5538,-227.45 5538,-218.68 5538,-210.42"/>
<polygon fill="black" stroke="black" points="5541.5,-210.28 5538,-200.28 5534.5,-210.28 5541.5,-210.28"/>
</g>
<!-- output -->
<g id="node74" class="node">
<title>output</title>
<ellipse fill="lightgreen" stroke="black" cx="5538" cy="-48.08" rx="325.95" ry="48.17"/>
<text text-anchor="middle" x="5538" y="-66.88" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="5538" y="-51.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=1, seq_len=1000000, hidden=16384]</text>
<text text-anchor="middle" x="5538" y="-36.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=1, seq_len=1000000, vocab_size=32000]</text>
<text text-anchor="middle" x="5538" y="-21.88" font-family="Times,serif" font-size="14.00">Device: CPU</text>
</g>
<!-- rmsnorm2&#45;&gt;output -->
<g id="edge96" class="edge">
<title>rmsnorm2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M5538,-131.9C5538,-123.91 5538,-115.14 5538,-106.4"/>
<polygon fill="black" stroke="black" points="5541.5,-106.19 5538,-96.19 5534.5,-106.19 5541.5,-106.19"/>
</g>
</g>
</svg>
