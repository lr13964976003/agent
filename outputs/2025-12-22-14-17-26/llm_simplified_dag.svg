<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1116pt" height="398pt"
 viewBox="0.00 0.00 1115.68 398.08" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 394.08)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-394.08 1111.68,-394.08 1111.68,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="white" stroke="black" points="167.15,-374.08 42.15,-374.08 42.15,-338.08 167.15,-338.08 167.15,-374.08"/>
<text text-anchor="middle" x="104.65" y="-359.48" font-family="Arial" font-size="12.00">Input Layer</text>
<text text-anchor="middle" x="104.65" y="-346.48" font-family="Arial" font-size="12.00">[128, seq_len, 1024]</text>
</g>
<!-- stage1 -->
<g id="node2" class="node">
<title>stage1</title>
<polygon fill="lightblue" stroke="black" points="157.15,-286.08 52.15,-286.08 52.15,-239.08 157.15,-239.08 157.15,-286.08"/>
<text text-anchor="middle" x="104.65" y="-272.48" font-family="Arial" font-size="12.00">Pipeline Stage 1</text>
<text text-anchor="middle" x="104.65" y="-259.48" font-family="Arial" font-size="12.00">Layers 1&#45;8</text>
<text text-anchor="middle" x="104.65" y="-246.48" font-family="Arial" font-size="12.00">TP8&#45;EP64</text>
</g>
<!-- input&#45;&gt;stage1 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;stage1</title>
<path fill="none" stroke="black" d="M104.65,-337.87C104.65,-326.24 104.65,-310.51 104.65,-296.51"/>
<polygon fill="black" stroke="black" points="108.15,-296.25 104.65,-286.25 101.15,-296.25 108.15,-296.25"/>
</g>
<!-- pp_comm -->
<g id="node4" class="node">
<title>pp_comm</title>
<ellipse fill="lightyellow" stroke="black" cx="104.65" cy="-179.04" rx="104.8" ry="24.08"/>
<text text-anchor="middle" x="104.65" y="-182.44" font-family="Arial" font-size="12.00">Pipeline Communication</text>
<text text-anchor="middle" x="104.65" y="-169.44" font-family="Arial" font-size="12.00">PP Transfer</text>
</g>
<!-- stage1&#45;&gt;pp_comm -->
<g id="edge2" class="edge">
<title>stage1&#45;&gt;pp_comm</title>
<path fill="none" stroke="black" d="M104.65,-238.87C104.65,-230.96 104.65,-221.92 104.65,-213.34"/>
<polygon fill="black" stroke="black" points="108.15,-213.2 104.65,-203.2 101.15,-213.2 108.15,-213.2"/>
</g>
<!-- routing -->
<g id="node8" class="node">
<title>routing</title>
<polygon fill="lightcoral" stroke="black" points="579.13,-390.08 422.47,-390.08 382.17,-322.08 538.83,-322.08 579.13,-390.08"/>
<text text-anchor="middle" x="480.65" y="-359.48" font-family="Arial" font-size="12.00">MoE Routing</text>
<text text-anchor="middle" x="480.65" y="-346.48" font-family="Arial" font-size="12.00">Gate Selection</text>
</g>
<!-- stage1&#45;&gt;routing -->
<g id="edge5" class="edge">
<title>stage1&#45;&gt;routing</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M157.29,-273.65C211.75,-284.39 299.11,-302.52 373.65,-322.08 373.75,-322.11 373.86,-322.14 373.96,-322.16"/>
<polygon fill="black" stroke="black" points="373.09,-325.55 383.65,-324.77 374.91,-318.79 373.09,-325.55"/>
</g>
<!-- stage2 -->
<g id="node3" class="node">
<title>stage2</title>
<polygon fill="lightgreen" stroke="black" points="157.15,-119 52.15,-119 52.15,-72 157.15,-72 157.15,-119"/>
<text text-anchor="middle" x="104.65" y="-105.4" font-family="Arial" font-size="12.00">Pipeline Stage 2</text>
<text text-anchor="middle" x="104.65" y="-92.4" font-family="Arial" font-size="12.00">Layers 9&#45;16</text>
<text text-anchor="middle" x="104.65" y="-79.4" font-family="Arial" font-size="12.00">TP8&#45;EP64</text>
</g>
<!-- output -->
<g id="node10" class="node">
<title>output</title>
<polygon fill="white" stroke="black" points="183.65,-36 25.65,-36 25.65,0 183.65,0 183.65,-36"/>
<text text-anchor="middle" x="104.65" y="-21.4" font-family="Arial" font-size="12.00">Output Layer</text>
<text text-anchor="middle" x="104.65" y="-8.4" font-family="Arial" font-size="12.00">[128, seq_len, vocab_size]</text>
</g>
<!-- stage2&#45;&gt;output -->
<g id="edge4" class="edge">
<title>stage2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M104.65,-71.85C104.65,-63.78 104.65,-54.62 104.65,-46.22"/>
<polygon fill="black" stroke="black" points="108.15,-46.11 104.65,-36.11 101.15,-46.11 108.15,-46.11"/>
</g>
<!-- pp_comm&#45;&gt;stage2 -->
<g id="edge3" class="edge">
<title>pp_comm&#45;&gt;stage2</title>
<path fill="none" stroke="black" d="M104.65,-154.89C104.65,-146.93 104.65,-137.85 104.65,-129.26"/>
<polygon fill="black" stroke="black" points="108.15,-129.14 104.65,-119.14 101.15,-129.14 108.15,-129.14"/>
</g>
<!-- ep_dispatch -->
<g id="node5" class="node">
<title>ep_dispatch</title>
<ellipse fill="lightyellow" stroke="black" cx="679.65" cy="-356.08" rx="82.05" ry="24.08"/>
<text text-anchor="middle" x="679.65" y="-359.48" font-family="Arial" font-size="12.00">Expert Dispatch</text>
<text text-anchor="middle" x="679.65" y="-346.48" font-family="Arial" font-size="12.00">All&#45;to&#45;All (128 ops)</text>
</g>
<!-- experts -->
<g id="node9" class="node">
<title>experts</title>
<polygon fill="lightblue" stroke="black" points="925.15,-374.08 780.15,-374.08 780.15,-338.08 925.15,-338.08 925.15,-374.08"/>
<text text-anchor="middle" x="852.65" y="-359.48" font-family="Arial" font-size="12.00">64 Expert Computations</text>
<text text-anchor="middle" x="852.65" y="-346.48" font-family="Arial" font-size="12.00">TP8 Parallel</text>
</g>
<!-- ep_dispatch&#45;&gt;experts -->
<g id="edge7" class="edge">
<title>ep_dispatch&#45;&gt;experts</title>
<path fill="none" stroke="black" d="M761.76,-356.08C764.4,-356.08 767.04,-356.08 769.68,-356.08"/>
<polygon fill="black" stroke="black" points="769.87,-359.58 779.87,-356.08 769.87,-352.58 769.87,-359.58"/>
</g>
<!-- ep_combine -->
<g id="node6" class="node">
<title>ep_combine</title>
<ellipse fill="lightyellow" stroke="black" cx="1025.65" cy="-356.08" rx="82.05" ry="24.08"/>
<text text-anchor="middle" x="1025.65" y="-359.48" font-family="Arial" font-size="12.00">Expert Combine</text>
<text text-anchor="middle" x="1025.65" y="-346.48" font-family="Arial" font-size="12.00">All&#45;to&#45;All (128 ops)</text>
</g>
<!-- ep_combine&#45;&gt;stage1 -->
<g id="edge9" class="edge">
<title>ep_combine&#45;&gt;stage1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M980.55,-335.93C966.13,-330.57 949.94,-325.33 934.65,-322.08 788.2,-291 334.74,-271.9 167.47,-265.76"/>
<polygon fill="black" stroke="black" points="167.47,-262.25 157.34,-265.39 167.21,-269.25 167.47,-262.25"/>
</g>
<!-- tp_sync -->
<g id="node7" class="node">
<title>tp_sync</title>
<ellipse fill="lightyellow" stroke="black" cx="274.65" cy="-356.08" rx="89.61" ry="24.08"/>
<text text-anchor="middle" x="274.65" y="-359.48" font-family="Arial" font-size="12.00">Tensor Parallel Sync</text>
<text text-anchor="middle" x="274.65" y="-346.48" font-family="Arial" font-size="12.00">All&#45;Reduce (16 ops)</text>
</g>
<!-- tp_sync&#45;&gt;stage1 -->
<g id="edge10" class="edge">
<title>tp_sync&#45;&gt;stage1</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M236.08,-334.32C212.24,-321.49 181.38,-304.88 155.55,-290.98"/>
<polygon fill="black" stroke="black" points="157.11,-287.84 146.65,-286.19 153.79,-294.01 157.11,-287.84"/>
</g>
<!-- tp_sync&#45;&gt;stage2 -->
<g id="edge11" class="edge">
<title>tp_sync&#45;&gt;stage2</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M274.01,-331.99C271.75,-291.7 261.77,-207.81 218.65,-155 205.11,-138.42 185.63,-126.03 166.6,-117.04"/>
<polygon fill="black" stroke="black" points="167.88,-113.77 157.32,-112.89 165.03,-120.16 167.88,-113.77"/>
</g>
<!-- routing&#45;&gt;ep_dispatch -->
<g id="edge6" class="edge">
<title>routing&#45;&gt;ep_dispatch</title>
<path fill="none" stroke="black" d="M559.16,-356.08C568.5,-356.08 577.83,-356.08 587.16,-356.08"/>
<polygon fill="black" stroke="black" points="587.29,-359.58 597.29,-356.08 587.29,-352.58 587.29,-359.58"/>
</g>
<!-- experts&#45;&gt;ep_combine -->
<g id="edge8" class="edge">
<title>experts&#45;&gt;ep_combine</title>
<path fill="none" stroke="black" d="M925.3,-356.08C927.93,-356.08 930.56,-356.08 933.19,-356.08"/>
<polygon fill="black" stroke="black" points="933.33,-359.58 943.33,-356.08 933.33,-352.58 933.33,-359.58"/>
</g>
</g>
</svg>
