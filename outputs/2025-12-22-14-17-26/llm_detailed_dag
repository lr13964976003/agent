// LLM EP64-TP8-PP2-DP2 Parallel Strategy DAG
digraph {
	bgcolor=white fontname=Arial rankdir=TB
	node [fontname=Arial fontsize=10 shape=ellipse style=filled]
	input [label="Input\nBatch Size: 128\nSeq Length: [128-10240]\nToken Dim: 1024" fillcolor=white shape=ellipse style=bold]
	subgraph cluster_stage1 {
		fillcolor=lightblue label="Pipeline Stage 1 (Layers 1-8)\nTP8-EP64-PP1" style=rounded
		embed_stage1 [label="Token Embedding (TP8)\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		ln1_1_stage1 [label="LayerNorm (TP8) L1\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		qkv_1_stage1 [label="QKV Projection (TP8) L1\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightblue shape=rectangle]
		attn_1_stage1 [label="Self-Attention (TP8) L1\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightblue shape=rectangle]
		attn_out_1_stage1 [label="Attention Output (TP8) L1\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		route_1_stage1 [label="MoE Routing (EP64) L1\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 2048]" fillcolor=lightcoral shape=parallelogram]
		dispatch_1_stage1 [label="Expert Dispatch (All-to-All) L1\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len/64, 2048]" fillcolor=lightyellow shape=ellipse]
		expert_1_0_stage1 [label="Expert 0 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_1_stage1 [label="Expert 1 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_2_stage1 [label="Expert 2 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_3_stage1 [label="Expert 3 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_4_stage1 [label="Expert 4 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_5_stage1 [label="Expert 5 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_6_stage1 [label="Expert 6 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_7_stage1 [label="Expert 7 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_8_stage1 [label="Expert 8 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_9_stage1 [label="Expert 9 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_10_stage1 [label="Expert 10 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_11_stage1 [label="Expert 11 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_12_stage1 [label="Expert 12 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_13_stage1 [label="Expert 13 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_14_stage1 [label="Expert 14 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_15_stage1 [label="Expert 15 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_16_stage1 [label="Expert 16 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_17_stage1 [label="Expert 17 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_18_stage1 [label="Expert 18 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_19_stage1 [label="Expert 19 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_20_stage1 [label="Expert 20 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_21_stage1 [label="Expert 21 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_22_stage1 [label="Expert 22 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_23_stage1 [label="Expert 23 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_24_stage1 [label="Expert 24 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_25_stage1 [label="Expert 25 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_26_stage1 [label="Expert 26 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_27_stage1 [label="Expert 27 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_28_stage1 [label="Expert 28 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_29_stage1 [label="Expert 29 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_30_stage1 [label="Expert 30 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_31_stage1 [label="Expert 31 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_32_stage1 [label="Expert 32 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_33_stage1 [label="Expert 33 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_34_stage1 [label="Expert 34 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_35_stage1 [label="Expert 35 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_36_stage1 [label="Expert 36 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_37_stage1 [label="Expert 37 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_38_stage1 [label="Expert 38 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_39_stage1 [label="Expert 39 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_40_stage1 [label="Expert 40 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_41_stage1 [label="Expert 41 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_42_stage1 [label="Expert 42 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_43_stage1 [label="Expert 43 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_44_stage1 [label="Expert 44 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_45_stage1 [label="Expert 45 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_46_stage1 [label="Expert 46 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_47_stage1 [label="Expert 47 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_48_stage1 [label="Expert 48 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_49_stage1 [label="Expert 49 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_50_stage1 [label="Expert 50 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_51_stage1 [label="Expert 51 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_52_stage1 [label="Expert 52 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_53_stage1 [label="Expert 53 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_54_stage1 [label="Expert 54 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_55_stage1 [label="Expert 55 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_56_stage1 [label="Expert 56 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_57_stage1 [label="Expert 57 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_58_stage1 [label="Expert 58 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_59_stage1 [label="Expert 59 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_60_stage1 [label="Expert 60 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_61_stage1 [label="Expert 61 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_62_stage1 [label="Expert 62 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_1_63_stage1 [label="Expert 63 (TP8) L1\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		combine_1_stage1 [label="Expert Combine (All-to-All) L1\nInput: [128, seq_len/64, 2048]\nOutput: [128, seq_len, 2048]" fillcolor=lightyellow shape=ellipse]
		moe_out_1_stage1 [label="MoE Output (TP8) L1\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		ln2_1_stage1 [label="LayerNorm (TP8) L1\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		ln1_2_stage1 [label="LayerNorm (TP8) L2\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		qkv_2_stage1 [label="QKV Projection (TP8) L2\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightblue shape=rectangle]
		attn_2_stage1 [label="Self-Attention (TP8) L2\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightblue shape=rectangle]
		attn_out_2_stage1 [label="Attention Output (TP8) L2\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		route_2_stage1 [label="MoE Routing (EP64) L2\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 2048]" fillcolor=lightcoral shape=parallelogram]
		dispatch_2_stage1 [label="Expert Dispatch (All-to-All) L2\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len/64, 2048]" fillcolor=lightyellow shape=ellipse]
		expert_2_0_stage1 [label="Expert 0 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_1_stage1 [label="Expert 1 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_2_stage1 [label="Expert 2 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_3_stage1 [label="Expert 3 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_4_stage1 [label="Expert 4 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_5_stage1 [label="Expert 5 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_6_stage1 [label="Expert 6 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_7_stage1 [label="Expert 7 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_8_stage1 [label="Expert 8 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_9_stage1 [label="Expert 9 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_10_stage1 [label="Expert 10 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_11_stage1 [label="Expert 11 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_12_stage1 [label="Expert 12 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_13_stage1 [label="Expert 13 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_14_stage1 [label="Expert 14 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_15_stage1 [label="Expert 15 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_16_stage1 [label="Expert 16 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_17_stage1 [label="Expert 17 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_18_stage1 [label="Expert 18 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_19_stage1 [label="Expert 19 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_20_stage1 [label="Expert 20 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_21_stage1 [label="Expert 21 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_22_stage1 [label="Expert 22 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_23_stage1 [label="Expert 23 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_24_stage1 [label="Expert 24 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_25_stage1 [label="Expert 25 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_26_stage1 [label="Expert 26 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_27_stage1 [label="Expert 27 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_28_stage1 [label="Expert 28 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_29_stage1 [label="Expert 29 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_30_stage1 [label="Expert 30 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_31_stage1 [label="Expert 31 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_32_stage1 [label="Expert 32 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_33_stage1 [label="Expert 33 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_34_stage1 [label="Expert 34 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_35_stage1 [label="Expert 35 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_36_stage1 [label="Expert 36 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_37_stage1 [label="Expert 37 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_38_stage1 [label="Expert 38 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_39_stage1 [label="Expert 39 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_40_stage1 [label="Expert 40 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_41_stage1 [label="Expert 41 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_42_stage1 [label="Expert 42 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_43_stage1 [label="Expert 43 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_44_stage1 [label="Expert 44 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_45_stage1 [label="Expert 45 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_46_stage1 [label="Expert 46 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_47_stage1 [label="Expert 47 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_48_stage1 [label="Expert 48 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_49_stage1 [label="Expert 49 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_50_stage1 [label="Expert 50 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_51_stage1 [label="Expert 51 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_52_stage1 [label="Expert 52 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_53_stage1 [label="Expert 53 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_54_stage1 [label="Expert 54 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_55_stage1 [label="Expert 55 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_56_stage1 [label="Expert 56 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_57_stage1 [label="Expert 57 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_58_stage1 [label="Expert 58 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_59_stage1 [label="Expert 59 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_60_stage1 [label="Expert 60 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_61_stage1 [label="Expert 61 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_62_stage1 [label="Expert 62 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_2_63_stage1 [label="Expert 63 (TP8) L2\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		combine_2_stage1 [label="Expert Combine (All-to-All) L2\nInput: [128, seq_len/64, 2048]\nOutput: [128, seq_len, 2048]" fillcolor=lightyellow shape=ellipse]
		moe_out_2_stage1 [label="MoE Output (TP8) L2\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		ln2_2_stage1 [label="LayerNorm (TP8) L2\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		ln1_3_stage1 [label="LayerNorm (TP8) L3\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		qkv_3_stage1 [label="QKV Projection (TP8) L3\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightblue shape=rectangle]
		attn_3_stage1 [label="Self-Attention (TP8) L3\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightblue shape=rectangle]
		attn_out_3_stage1 [label="Attention Output (TP8) L3\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		route_3_stage1 [label="MoE Routing (EP64) L3\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 2048]" fillcolor=lightcoral shape=parallelogram]
		dispatch_3_stage1 [label="Expert Dispatch (All-to-All) L3\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len/64, 2048]" fillcolor=lightyellow shape=ellipse]
		expert_3_0_stage1 [label="Expert 0 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_1_stage1 [label="Expert 1 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_2_stage1 [label="Expert 2 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_3_stage1 [label="Expert 3 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_4_stage1 [label="Expert 4 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_5_stage1 [label="Expert 5 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_6_stage1 [label="Expert 6 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_7_stage1 [label="Expert 7 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_8_stage1 [label="Expert 8 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_9_stage1 [label="Expert 9 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_10_stage1 [label="Expert 10 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_11_stage1 [label="Expert 11 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_12_stage1 [label="Expert 12 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_13_stage1 [label="Expert 13 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_14_stage1 [label="Expert 14 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_15_stage1 [label="Expert 15 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_16_stage1 [label="Expert 16 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_17_stage1 [label="Expert 17 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_18_stage1 [label="Expert 18 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_19_stage1 [label="Expert 19 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_20_stage1 [label="Expert 20 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_21_stage1 [label="Expert 21 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_22_stage1 [label="Expert 22 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_23_stage1 [label="Expert 23 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_24_stage1 [label="Expert 24 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_25_stage1 [label="Expert 25 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_26_stage1 [label="Expert 26 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_27_stage1 [label="Expert 27 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_28_stage1 [label="Expert 28 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_29_stage1 [label="Expert 29 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_30_stage1 [label="Expert 30 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_31_stage1 [label="Expert 31 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_32_stage1 [label="Expert 32 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_33_stage1 [label="Expert 33 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_34_stage1 [label="Expert 34 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_35_stage1 [label="Expert 35 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_36_stage1 [label="Expert 36 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_37_stage1 [label="Expert 37 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_38_stage1 [label="Expert 38 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_39_stage1 [label="Expert 39 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_40_stage1 [label="Expert 40 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_41_stage1 [label="Expert 41 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_42_stage1 [label="Expert 42 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_43_stage1 [label="Expert 43 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_44_stage1 [label="Expert 44 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_45_stage1 [label="Expert 45 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_46_stage1 [label="Expert 46 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_47_stage1 [label="Expert 47 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_48_stage1 [label="Expert 48 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_49_stage1 [label="Expert 49 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_50_stage1 [label="Expert 50 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_51_stage1 [label="Expert 51 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_52_stage1 [label="Expert 52 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_53_stage1 [label="Expert 53 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_54_stage1 [label="Expert 54 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_55_stage1 [label="Expert 55 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_56_stage1 [label="Expert 56 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_57_stage1 [label="Expert 57 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_58_stage1 [label="Expert 58 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_59_stage1 [label="Expert 59 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_60_stage1 [label="Expert 60 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_61_stage1 [label="Expert 61 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_62_stage1 [label="Expert 62 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_3_63_stage1 [label="Expert 63 (TP8) L3\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		combine_3_stage1 [label="Expert Combine (All-to-All) L3\nInput: [128, seq_len/64, 2048]\nOutput: [128, seq_len, 2048]" fillcolor=lightyellow shape=ellipse]
		moe_out_3_stage1 [label="MoE Output (TP8) L3\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		ln2_3_stage1 [label="LayerNorm (TP8) L3\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		ln1_4_stage1 [label="LayerNorm (TP8) L4\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		qkv_4_stage1 [label="QKV Projection (TP8) L4\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightblue shape=rectangle]
		attn_4_stage1 [label="Self-Attention (TP8) L4\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightblue shape=rectangle]
		attn_out_4_stage1 [label="Attention Output (TP8) L4\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		route_4_stage1 [label="MoE Routing (EP64) L4\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 2048]" fillcolor=lightcoral shape=parallelogram]
		dispatch_4_stage1 [label="Expert Dispatch (All-to-All) L4\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len/64, 2048]" fillcolor=lightyellow shape=ellipse]
		expert_4_0_stage1 [label="Expert 0 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_1_stage1 [label="Expert 1 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_2_stage1 [label="Expert 2 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_3_stage1 [label="Expert 3 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_4_stage1 [label="Expert 4 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_5_stage1 [label="Expert 5 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_6_stage1 [label="Expert 6 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_7_stage1 [label="Expert 7 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_8_stage1 [label="Expert 8 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_9_stage1 [label="Expert 9 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_10_stage1 [label="Expert 10 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_11_stage1 [label="Expert 11 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_12_stage1 [label="Expert 12 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_13_stage1 [label="Expert 13 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_14_stage1 [label="Expert 14 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_15_stage1 [label="Expert 15 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_16_stage1 [label="Expert 16 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_17_stage1 [label="Expert 17 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_18_stage1 [label="Expert 18 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_19_stage1 [label="Expert 19 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_20_stage1 [label="Expert 20 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_21_stage1 [label="Expert 21 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_22_stage1 [label="Expert 22 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_23_stage1 [label="Expert 23 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_24_stage1 [label="Expert 24 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_25_stage1 [label="Expert 25 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_26_stage1 [label="Expert 26 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_27_stage1 [label="Expert 27 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_28_stage1 [label="Expert 28 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_29_stage1 [label="Expert 29 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_30_stage1 [label="Expert 30 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_31_stage1 [label="Expert 31 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_32_stage1 [label="Expert 32 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_33_stage1 [label="Expert 33 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_34_stage1 [label="Expert 34 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_35_stage1 [label="Expert 35 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_36_stage1 [label="Expert 36 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_37_stage1 [label="Expert 37 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_38_stage1 [label="Expert 38 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_39_stage1 [label="Expert 39 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_40_stage1 [label="Expert 40 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_41_stage1 [label="Expert 41 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_42_stage1 [label="Expert 42 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_43_stage1 [label="Expert 43 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_44_stage1 [label="Expert 44 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_45_stage1 [label="Expert 45 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_46_stage1 [label="Expert 46 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_47_stage1 [label="Expert 47 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_48_stage1 [label="Expert 48 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_49_stage1 [label="Expert 49 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_50_stage1 [label="Expert 50 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_51_stage1 [label="Expert 51 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_52_stage1 [label="Expert 52 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_53_stage1 [label="Expert 53 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_54_stage1 [label="Expert 54 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_55_stage1 [label="Expert 55 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_56_stage1 [label="Expert 56 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_57_stage1 [label="Expert 57 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_58_stage1 [label="Expert 58 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_59_stage1 [label="Expert 59 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_60_stage1 [label="Expert 60 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_61_stage1 [label="Expert 61 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_62_stage1 [label="Expert 62 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_4_63_stage1 [label="Expert 63 (TP8) L4\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		combine_4_stage1 [label="Expert Combine (All-to-All) L4\nInput: [128, seq_len/64, 2048]\nOutput: [128, seq_len, 2048]" fillcolor=lightyellow shape=ellipse]
		moe_out_4_stage1 [label="MoE Output (TP8) L4\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		ln2_4_stage1 [label="LayerNorm (TP8) L4\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		ln1_5_stage1 [label="LayerNorm (TP8) L5\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		qkv_5_stage1 [label="QKV Projection (TP8) L5\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightblue shape=rectangle]
		attn_5_stage1 [label="Self-Attention (TP8) L5\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightblue shape=rectangle]
		attn_out_5_stage1 [label="Attention Output (TP8) L5\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		route_5_stage1 [label="MoE Routing (EP64) L5\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 2048]" fillcolor=lightcoral shape=parallelogram]
		dispatch_5_stage1 [label="Expert Dispatch (All-to-All) L5\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len/64, 2048]" fillcolor=lightyellow shape=ellipse]
		expert_5_0_stage1 [label="Expert 0 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_1_stage1 [label="Expert 1 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_2_stage1 [label="Expert 2 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_3_stage1 [label="Expert 3 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_4_stage1 [label="Expert 4 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_5_stage1 [label="Expert 5 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_6_stage1 [label="Expert 6 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_7_stage1 [label="Expert 7 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_8_stage1 [label="Expert 8 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_9_stage1 [label="Expert 9 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_10_stage1 [label="Expert 10 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_11_stage1 [label="Expert 11 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_12_stage1 [label="Expert 12 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_13_stage1 [label="Expert 13 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_14_stage1 [label="Expert 14 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_15_stage1 [label="Expert 15 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_16_stage1 [label="Expert 16 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_17_stage1 [label="Expert 17 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_18_stage1 [label="Expert 18 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_19_stage1 [label="Expert 19 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_20_stage1 [label="Expert 20 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_21_stage1 [label="Expert 21 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_22_stage1 [label="Expert 22 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_23_stage1 [label="Expert 23 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_24_stage1 [label="Expert 24 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_25_stage1 [label="Expert 25 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_26_stage1 [label="Expert 26 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_27_stage1 [label="Expert 27 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_28_stage1 [label="Expert 28 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_29_stage1 [label="Expert 29 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_30_stage1 [label="Expert 30 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_31_stage1 [label="Expert 31 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_32_stage1 [label="Expert 32 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_33_stage1 [label="Expert 33 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_34_stage1 [label="Expert 34 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_35_stage1 [label="Expert 35 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_36_stage1 [label="Expert 36 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_37_stage1 [label="Expert 37 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_38_stage1 [label="Expert 38 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_39_stage1 [label="Expert 39 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_40_stage1 [label="Expert 40 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_41_stage1 [label="Expert 41 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_42_stage1 [label="Expert 42 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_43_stage1 [label="Expert 43 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_44_stage1 [label="Expert 44 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_45_stage1 [label="Expert 45 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_46_stage1 [label="Expert 46 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_47_stage1 [label="Expert 47 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_48_stage1 [label="Expert 48 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_49_stage1 [label="Expert 49 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_50_stage1 [label="Expert 50 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_51_stage1 [label="Expert 51 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_52_stage1 [label="Expert 52 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_53_stage1 [label="Expert 53 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_54_stage1 [label="Expert 54 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_55_stage1 [label="Expert 55 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_56_stage1 [label="Expert 56 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_57_stage1 [label="Expert 57 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_58_stage1 [label="Expert 58 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_59_stage1 [label="Expert 59 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_60_stage1 [label="Expert 60 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_61_stage1 [label="Expert 61 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_62_stage1 [label="Expert 62 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_5_63_stage1 [label="Expert 63 (TP8) L5\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		combine_5_stage1 [label="Expert Combine (All-to-All) L5\nInput: [128, seq_len/64, 2048]\nOutput: [128, seq_len, 2048]" fillcolor=lightyellow shape=ellipse]
		moe_out_5_stage1 [label="MoE Output (TP8) L5\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		ln2_5_stage1 [label="LayerNorm (TP8) L5\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		ln1_6_stage1 [label="LayerNorm (TP8) L6\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		qkv_6_stage1 [label="QKV Projection (TP8) L6\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightblue shape=rectangle]
		attn_6_stage1 [label="Self-Attention (TP8) L6\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightblue shape=rectangle]
		attn_out_6_stage1 [label="Attention Output (TP8) L6\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		route_6_stage1 [label="MoE Routing (EP64) L6\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 2048]" fillcolor=lightcoral shape=parallelogram]
		dispatch_6_stage1 [label="Expert Dispatch (All-to-All) L6\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len/64, 2048]" fillcolor=lightyellow shape=ellipse]
		expert_6_0_stage1 [label="Expert 0 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_1_stage1 [label="Expert 1 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_2_stage1 [label="Expert 2 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_3_stage1 [label="Expert 3 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_4_stage1 [label="Expert 4 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_5_stage1 [label="Expert 5 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_6_stage1 [label="Expert 6 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_7_stage1 [label="Expert 7 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_8_stage1 [label="Expert 8 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_9_stage1 [label="Expert 9 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_10_stage1 [label="Expert 10 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_11_stage1 [label="Expert 11 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_12_stage1 [label="Expert 12 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_13_stage1 [label="Expert 13 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_14_stage1 [label="Expert 14 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_15_stage1 [label="Expert 15 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_16_stage1 [label="Expert 16 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_17_stage1 [label="Expert 17 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_18_stage1 [label="Expert 18 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_19_stage1 [label="Expert 19 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_20_stage1 [label="Expert 20 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_21_stage1 [label="Expert 21 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_22_stage1 [label="Expert 22 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_23_stage1 [label="Expert 23 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_24_stage1 [label="Expert 24 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_25_stage1 [label="Expert 25 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_26_stage1 [label="Expert 26 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_27_stage1 [label="Expert 27 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_28_stage1 [label="Expert 28 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_29_stage1 [label="Expert 29 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_30_stage1 [label="Expert 30 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_31_stage1 [label="Expert 31 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_32_stage1 [label="Expert 32 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_33_stage1 [label="Expert 33 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_34_stage1 [label="Expert 34 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_35_stage1 [label="Expert 35 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_36_stage1 [label="Expert 36 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_37_stage1 [label="Expert 37 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_38_stage1 [label="Expert 38 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_39_stage1 [label="Expert 39 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_40_stage1 [label="Expert 40 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_41_stage1 [label="Expert 41 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_42_stage1 [label="Expert 42 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_43_stage1 [label="Expert 43 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_44_stage1 [label="Expert 44 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_45_stage1 [label="Expert 45 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_46_stage1 [label="Expert 46 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_47_stage1 [label="Expert 47 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_48_stage1 [label="Expert 48 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_49_stage1 [label="Expert 49 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_50_stage1 [label="Expert 50 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_51_stage1 [label="Expert 51 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_52_stage1 [label="Expert 52 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_53_stage1 [label="Expert 53 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_54_stage1 [label="Expert 54 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_55_stage1 [label="Expert 55 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_56_stage1 [label="Expert 56 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_57_stage1 [label="Expert 57 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_58_stage1 [label="Expert 58 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_59_stage1 [label="Expert 59 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_60_stage1 [label="Expert 60 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_61_stage1 [label="Expert 61 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_62_stage1 [label="Expert 62 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_6_63_stage1 [label="Expert 63 (TP8) L6\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		combine_6_stage1 [label="Expert Combine (All-to-All) L6\nInput: [128, seq_len/64, 2048]\nOutput: [128, seq_len, 2048]" fillcolor=lightyellow shape=ellipse]
		moe_out_6_stage1 [label="MoE Output (TP8) L6\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		ln2_6_stage1 [label="LayerNorm (TP8) L6\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		ln1_7_stage1 [label="LayerNorm (TP8) L7\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		qkv_7_stage1 [label="QKV Projection (TP8) L7\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightblue shape=rectangle]
		attn_7_stage1 [label="Self-Attention (TP8) L7\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightblue shape=rectangle]
		attn_out_7_stage1 [label="Attention Output (TP8) L7\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		route_7_stage1 [label="MoE Routing (EP64) L7\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 2048]" fillcolor=lightcoral shape=parallelogram]
		dispatch_7_stage1 [label="Expert Dispatch (All-to-All) L7\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len/64, 2048]" fillcolor=lightyellow shape=ellipse]
		expert_7_0_stage1 [label="Expert 0 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_1_stage1 [label="Expert 1 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_2_stage1 [label="Expert 2 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_3_stage1 [label="Expert 3 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_4_stage1 [label="Expert 4 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_5_stage1 [label="Expert 5 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_6_stage1 [label="Expert 6 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_7_stage1 [label="Expert 7 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_8_stage1 [label="Expert 8 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_9_stage1 [label="Expert 9 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_10_stage1 [label="Expert 10 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_11_stage1 [label="Expert 11 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_12_stage1 [label="Expert 12 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_13_stage1 [label="Expert 13 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_14_stage1 [label="Expert 14 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_15_stage1 [label="Expert 15 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_16_stage1 [label="Expert 16 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_17_stage1 [label="Expert 17 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_18_stage1 [label="Expert 18 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_19_stage1 [label="Expert 19 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_20_stage1 [label="Expert 20 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_21_stage1 [label="Expert 21 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_22_stage1 [label="Expert 22 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_23_stage1 [label="Expert 23 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_24_stage1 [label="Expert 24 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_25_stage1 [label="Expert 25 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_26_stage1 [label="Expert 26 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_27_stage1 [label="Expert 27 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_28_stage1 [label="Expert 28 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_29_stage1 [label="Expert 29 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_30_stage1 [label="Expert 30 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_31_stage1 [label="Expert 31 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_32_stage1 [label="Expert 32 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_33_stage1 [label="Expert 33 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_34_stage1 [label="Expert 34 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_35_stage1 [label="Expert 35 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_36_stage1 [label="Expert 36 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_37_stage1 [label="Expert 37 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_38_stage1 [label="Expert 38 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_39_stage1 [label="Expert 39 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_40_stage1 [label="Expert 40 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_41_stage1 [label="Expert 41 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_42_stage1 [label="Expert 42 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_43_stage1 [label="Expert 43 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_44_stage1 [label="Expert 44 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_45_stage1 [label="Expert 45 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_46_stage1 [label="Expert 46 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_47_stage1 [label="Expert 47 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_48_stage1 [label="Expert 48 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_49_stage1 [label="Expert 49 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_50_stage1 [label="Expert 50 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_51_stage1 [label="Expert 51 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_52_stage1 [label="Expert 52 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_53_stage1 [label="Expert 53 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_54_stage1 [label="Expert 54 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_55_stage1 [label="Expert 55 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_56_stage1 [label="Expert 56 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_57_stage1 [label="Expert 57 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_58_stage1 [label="Expert 58 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_59_stage1 [label="Expert 59 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_60_stage1 [label="Expert 60 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_61_stage1 [label="Expert 61 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_62_stage1 [label="Expert 62 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_7_63_stage1 [label="Expert 63 (TP8) L7\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		combine_7_stage1 [label="Expert Combine (All-to-All) L7\nInput: [128, seq_len/64, 2048]\nOutput: [128, seq_len, 2048]" fillcolor=lightyellow shape=ellipse]
		moe_out_7_stage1 [label="MoE Output (TP8) L7\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		ln2_7_stage1 [label="LayerNorm (TP8) L7\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		ln1_8_stage1 [label="LayerNorm (TP8) L8\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		qkv_8_stage1 [label="QKV Projection (TP8) L8\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightblue shape=rectangle]
		attn_8_stage1 [label="Self-Attention (TP8) L8\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightblue shape=rectangle]
		attn_out_8_stage1 [label="Attention Output (TP8) L8\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		route_8_stage1 [label="MoE Routing (EP64) L8\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 2048]" fillcolor=lightcoral shape=parallelogram]
		dispatch_8_stage1 [label="Expert Dispatch (All-to-All) L8\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len/64, 2048]" fillcolor=lightyellow shape=ellipse]
		expert_8_0_stage1 [label="Expert 0 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_1_stage1 [label="Expert 1 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_2_stage1 [label="Expert 2 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_3_stage1 [label="Expert 3 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_4_stage1 [label="Expert 4 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_5_stage1 [label="Expert 5 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_6_stage1 [label="Expert 6 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_7_stage1 [label="Expert 7 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_8_stage1 [label="Expert 8 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_9_stage1 [label="Expert 9 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_10_stage1 [label="Expert 10 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_11_stage1 [label="Expert 11 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_12_stage1 [label="Expert 12 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_13_stage1 [label="Expert 13 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_14_stage1 [label="Expert 14 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_15_stage1 [label="Expert 15 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_16_stage1 [label="Expert 16 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_17_stage1 [label="Expert 17 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_18_stage1 [label="Expert 18 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_19_stage1 [label="Expert 19 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_20_stage1 [label="Expert 20 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_21_stage1 [label="Expert 21 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_22_stage1 [label="Expert 22 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_23_stage1 [label="Expert 23 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_24_stage1 [label="Expert 24 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_25_stage1 [label="Expert 25 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_26_stage1 [label="Expert 26 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_27_stage1 [label="Expert 27 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_28_stage1 [label="Expert 28 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_29_stage1 [label="Expert 29 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_30_stage1 [label="Expert 30 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_31_stage1 [label="Expert 31 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_32_stage1 [label="Expert 32 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_33_stage1 [label="Expert 33 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_34_stage1 [label="Expert 34 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_35_stage1 [label="Expert 35 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_36_stage1 [label="Expert 36 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_37_stage1 [label="Expert 37 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_38_stage1 [label="Expert 38 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_39_stage1 [label="Expert 39 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_40_stage1 [label="Expert 40 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_41_stage1 [label="Expert 41 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_42_stage1 [label="Expert 42 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_43_stage1 [label="Expert 43 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_44_stage1 [label="Expert 44 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_45_stage1 [label="Expert 45 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_46_stage1 [label="Expert 46 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_47_stage1 [label="Expert 47 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_48_stage1 [label="Expert 48 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_49_stage1 [label="Expert 49 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_50_stage1 [label="Expert 50 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_51_stage1 [label="Expert 51 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_52_stage1 [label="Expert 52 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_53_stage1 [label="Expert 53 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_54_stage1 [label="Expert 54 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_55_stage1 [label="Expert 55 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_56_stage1 [label="Expert 56 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_57_stage1 [label="Expert 57 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_58_stage1 [label="Expert 58 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_59_stage1 [label="Expert 59 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_60_stage1 [label="Expert 60 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_61_stage1 [label="Expert 61 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_62_stage1 [label="Expert 62 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		expert_8_63_stage1 [label="Expert 63 (TP8) L8\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightblue shape=rectangle]
		combine_8_stage1 [label="Expert Combine (All-to-All) L8\nInput: [128, seq_len/64, 2048]\nOutput: [128, seq_len, 2048]" fillcolor=lightyellow shape=ellipse]
		moe_out_8_stage1 [label="MoE Output (TP8) L8\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
		ln2_8_stage1 [label="LayerNorm (TP8) L8\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightblue shape=rectangle]
	}
	subgraph cluster_stage2 {
		fillcolor=lightgreen label="Pipeline Stage 2 (Layers 9-16)\nTP8-EP64-PP2" style=rounded
		ln1_9_stage2 [label="LayerNorm (TP8) L9\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		qkv_9_stage2 [label="QKV Projection (TP8) L9\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightgreen shape=rectangle]
		attn_9_stage2 [label="Self-Attention (TP8) L9\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightgreen shape=rectangle]
		attn_out_9_stage2 [label="Attention Output (TP8) L9\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		route_9_stage2 [label="MoE Routing (EP64) L9\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 2048]" fillcolor=lightcoral shape=parallelogram]
		dispatch_9_stage2 [label="Expert Dispatch (All-to-All) L9\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len/64, 2048]" fillcolor=lightyellow shape=ellipse]
		expert_9_0_stage2 [label="Expert 0 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_1_stage2 [label="Expert 1 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_2_stage2 [label="Expert 2 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_3_stage2 [label="Expert 3 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_4_stage2 [label="Expert 4 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_5_stage2 [label="Expert 5 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_6_stage2 [label="Expert 6 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_7_stage2 [label="Expert 7 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_8_stage2 [label="Expert 8 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_9_stage2 [label="Expert 9 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_10_stage2 [label="Expert 10 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_11_stage2 [label="Expert 11 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_12_stage2 [label="Expert 12 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_13_stage2 [label="Expert 13 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_14_stage2 [label="Expert 14 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_15_stage2 [label="Expert 15 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_16_stage2 [label="Expert 16 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_17_stage2 [label="Expert 17 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_18_stage2 [label="Expert 18 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_19_stage2 [label="Expert 19 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_20_stage2 [label="Expert 20 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_21_stage2 [label="Expert 21 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_22_stage2 [label="Expert 22 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_23_stage2 [label="Expert 23 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_24_stage2 [label="Expert 24 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_25_stage2 [label="Expert 25 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_26_stage2 [label="Expert 26 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_27_stage2 [label="Expert 27 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_28_stage2 [label="Expert 28 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_29_stage2 [label="Expert 29 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_30_stage2 [label="Expert 30 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_31_stage2 [label="Expert 31 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_32_stage2 [label="Expert 32 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_33_stage2 [label="Expert 33 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_34_stage2 [label="Expert 34 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_35_stage2 [label="Expert 35 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_36_stage2 [label="Expert 36 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_37_stage2 [label="Expert 37 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_38_stage2 [label="Expert 38 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_39_stage2 [label="Expert 39 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_40_stage2 [label="Expert 40 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_41_stage2 [label="Expert 41 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_42_stage2 [label="Expert 42 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_43_stage2 [label="Expert 43 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_44_stage2 [label="Expert 44 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_45_stage2 [label="Expert 45 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_46_stage2 [label="Expert 46 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_47_stage2 [label="Expert 47 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_48_stage2 [label="Expert 48 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_49_stage2 [label="Expert 49 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_50_stage2 [label="Expert 50 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_51_stage2 [label="Expert 51 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_52_stage2 [label="Expert 52 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_53_stage2 [label="Expert 53 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_54_stage2 [label="Expert 54 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_55_stage2 [label="Expert 55 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_56_stage2 [label="Expert 56 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_57_stage2 [label="Expert 57 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_58_stage2 [label="Expert 58 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_59_stage2 [label="Expert 59 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_60_stage2 [label="Expert 60 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_61_stage2 [label="Expert 61 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_62_stage2 [label="Expert 62 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_9_63_stage2 [label="Expert 63 (TP8) L9\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		combine_9_stage2 [label="Expert Combine (All-to-All) L9\nInput: [128, seq_len/64, 2048]\nOutput: [128, seq_len, 2048]" fillcolor=lightyellow shape=ellipse]
		moe_out_9_stage2 [label="MoE Output (TP8) L9\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		ln2_9_stage2 [label="LayerNorm (TP8) L9\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		ln1_10_stage2 [label="LayerNorm (TP8) L10\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		qkv_10_stage2 [label="QKV Projection (TP8) L10\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightgreen shape=rectangle]
		attn_10_stage2 [label="Self-Attention (TP8) L10\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightgreen shape=rectangle]
		attn_out_10_stage2 [label="Attention Output (TP8) L10\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		route_10_stage2 [label="MoE Routing (EP64) L10\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 2048]" fillcolor=lightcoral shape=parallelogram]
		dispatch_10_stage2 [label="Expert Dispatch (All-to-All) L10\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len/64, 2048]" fillcolor=lightyellow shape=ellipse]
		expert_10_0_stage2 [label="Expert 0 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_1_stage2 [label="Expert 1 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_2_stage2 [label="Expert 2 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_3_stage2 [label="Expert 3 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_4_stage2 [label="Expert 4 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_5_stage2 [label="Expert 5 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_6_stage2 [label="Expert 6 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_7_stage2 [label="Expert 7 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_8_stage2 [label="Expert 8 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_9_stage2 [label="Expert 9 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_10_stage2 [label="Expert 10 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_11_stage2 [label="Expert 11 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_12_stage2 [label="Expert 12 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_13_stage2 [label="Expert 13 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_14_stage2 [label="Expert 14 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_15_stage2 [label="Expert 15 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_16_stage2 [label="Expert 16 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_17_stage2 [label="Expert 17 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_18_stage2 [label="Expert 18 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_19_stage2 [label="Expert 19 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_20_stage2 [label="Expert 20 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_21_stage2 [label="Expert 21 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_22_stage2 [label="Expert 22 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_23_stage2 [label="Expert 23 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_24_stage2 [label="Expert 24 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_25_stage2 [label="Expert 25 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_26_stage2 [label="Expert 26 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_27_stage2 [label="Expert 27 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_28_stage2 [label="Expert 28 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_29_stage2 [label="Expert 29 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_30_stage2 [label="Expert 30 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_31_stage2 [label="Expert 31 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_32_stage2 [label="Expert 32 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_33_stage2 [label="Expert 33 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_34_stage2 [label="Expert 34 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_35_stage2 [label="Expert 35 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_36_stage2 [label="Expert 36 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_37_stage2 [label="Expert 37 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_38_stage2 [label="Expert 38 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_39_stage2 [label="Expert 39 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_40_stage2 [label="Expert 40 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_41_stage2 [label="Expert 41 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_42_stage2 [label="Expert 42 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_43_stage2 [label="Expert 43 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_44_stage2 [label="Expert 44 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_45_stage2 [label="Expert 45 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_46_stage2 [label="Expert 46 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_47_stage2 [label="Expert 47 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_48_stage2 [label="Expert 48 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_49_stage2 [label="Expert 49 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_50_stage2 [label="Expert 50 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_51_stage2 [label="Expert 51 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_52_stage2 [label="Expert 52 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_53_stage2 [label="Expert 53 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_54_stage2 [label="Expert 54 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_55_stage2 [label="Expert 55 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_56_stage2 [label="Expert 56 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_57_stage2 [label="Expert 57 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_58_stage2 [label="Expert 58 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_59_stage2 [label="Expert 59 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_60_stage2 [label="Expert 60 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_61_stage2 [label="Expert 61 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_62_stage2 [label="Expert 62 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_10_63_stage2 [label="Expert 63 (TP8) L10\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		combine_10_stage2 [label="Expert Combine (All-to-All) L10\nInput: [128, seq_len/64, 2048]\nOutput: [128, seq_len, 2048]" fillcolor=lightyellow shape=ellipse]
		moe_out_10_stage2 [label="MoE Output (TP8) L10\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		ln2_10_stage2 [label="LayerNorm (TP8) L10\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		ln1_11_stage2 [label="LayerNorm (TP8) L11\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		qkv_11_stage2 [label="QKV Projection (TP8) L11\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightgreen shape=rectangle]
		attn_11_stage2 [label="Self-Attention (TP8) L11\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightgreen shape=rectangle]
		attn_out_11_stage2 [label="Attention Output (TP8) L11\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		route_11_stage2 [label="MoE Routing (EP64) L11\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 2048]" fillcolor=lightcoral shape=parallelogram]
		dispatch_11_stage2 [label="Expert Dispatch (All-to-All) L11\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len/64, 2048]" fillcolor=lightyellow shape=ellipse]
		expert_11_0_stage2 [label="Expert 0 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_1_stage2 [label="Expert 1 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_2_stage2 [label="Expert 2 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_3_stage2 [label="Expert 3 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_4_stage2 [label="Expert 4 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_5_stage2 [label="Expert 5 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_6_stage2 [label="Expert 6 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_7_stage2 [label="Expert 7 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_8_stage2 [label="Expert 8 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_9_stage2 [label="Expert 9 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_10_stage2 [label="Expert 10 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_11_stage2 [label="Expert 11 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_12_stage2 [label="Expert 12 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_13_stage2 [label="Expert 13 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_14_stage2 [label="Expert 14 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_15_stage2 [label="Expert 15 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_16_stage2 [label="Expert 16 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_17_stage2 [label="Expert 17 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_18_stage2 [label="Expert 18 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_19_stage2 [label="Expert 19 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_20_stage2 [label="Expert 20 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_21_stage2 [label="Expert 21 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_22_stage2 [label="Expert 22 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_23_stage2 [label="Expert 23 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_24_stage2 [label="Expert 24 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_25_stage2 [label="Expert 25 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_26_stage2 [label="Expert 26 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_27_stage2 [label="Expert 27 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_28_stage2 [label="Expert 28 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_29_stage2 [label="Expert 29 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_30_stage2 [label="Expert 30 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_31_stage2 [label="Expert 31 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_32_stage2 [label="Expert 32 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_33_stage2 [label="Expert 33 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_34_stage2 [label="Expert 34 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_35_stage2 [label="Expert 35 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_36_stage2 [label="Expert 36 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_37_stage2 [label="Expert 37 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_38_stage2 [label="Expert 38 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_39_stage2 [label="Expert 39 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_40_stage2 [label="Expert 40 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_41_stage2 [label="Expert 41 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_42_stage2 [label="Expert 42 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_43_stage2 [label="Expert 43 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_44_stage2 [label="Expert 44 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_45_stage2 [label="Expert 45 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_46_stage2 [label="Expert 46 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_47_stage2 [label="Expert 47 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_48_stage2 [label="Expert 48 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_49_stage2 [label="Expert 49 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_50_stage2 [label="Expert 50 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_51_stage2 [label="Expert 51 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_52_stage2 [label="Expert 52 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_53_stage2 [label="Expert 53 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_54_stage2 [label="Expert 54 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_55_stage2 [label="Expert 55 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_56_stage2 [label="Expert 56 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_57_stage2 [label="Expert 57 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_58_stage2 [label="Expert 58 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_59_stage2 [label="Expert 59 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_60_stage2 [label="Expert 60 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_61_stage2 [label="Expert 61 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_62_stage2 [label="Expert 62 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_11_63_stage2 [label="Expert 63 (TP8) L11\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		combine_11_stage2 [label="Expert Combine (All-to-All) L11\nInput: [128, seq_len/64, 2048]\nOutput: [128, seq_len, 2048]" fillcolor=lightyellow shape=ellipse]
		moe_out_11_stage2 [label="MoE Output (TP8) L11\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		ln2_11_stage2 [label="LayerNorm (TP8) L11\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		ln1_12_stage2 [label="LayerNorm (TP8) L12\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		qkv_12_stage2 [label="QKV Projection (TP8) L12\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightgreen shape=rectangle]
		attn_12_stage2 [label="Self-Attention (TP8) L12\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightgreen shape=rectangle]
		attn_out_12_stage2 [label="Attention Output (TP8) L12\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		route_12_stage2 [label="MoE Routing (EP64) L12\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 2048]" fillcolor=lightcoral shape=parallelogram]
		dispatch_12_stage2 [label="Expert Dispatch (All-to-All) L12\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len/64, 2048]" fillcolor=lightyellow shape=ellipse]
		expert_12_0_stage2 [label="Expert 0 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_1_stage2 [label="Expert 1 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_2_stage2 [label="Expert 2 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_3_stage2 [label="Expert 3 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_4_stage2 [label="Expert 4 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_5_stage2 [label="Expert 5 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_6_stage2 [label="Expert 6 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_7_stage2 [label="Expert 7 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_8_stage2 [label="Expert 8 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_9_stage2 [label="Expert 9 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_10_stage2 [label="Expert 10 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_11_stage2 [label="Expert 11 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_12_stage2 [label="Expert 12 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_13_stage2 [label="Expert 13 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_14_stage2 [label="Expert 14 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_15_stage2 [label="Expert 15 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_16_stage2 [label="Expert 16 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_17_stage2 [label="Expert 17 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_18_stage2 [label="Expert 18 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_19_stage2 [label="Expert 19 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_20_stage2 [label="Expert 20 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_21_stage2 [label="Expert 21 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_22_stage2 [label="Expert 22 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_23_stage2 [label="Expert 23 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_24_stage2 [label="Expert 24 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_25_stage2 [label="Expert 25 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_26_stage2 [label="Expert 26 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_27_stage2 [label="Expert 27 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_28_stage2 [label="Expert 28 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_29_stage2 [label="Expert 29 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_30_stage2 [label="Expert 30 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_31_stage2 [label="Expert 31 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_32_stage2 [label="Expert 32 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_33_stage2 [label="Expert 33 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_34_stage2 [label="Expert 34 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_35_stage2 [label="Expert 35 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_36_stage2 [label="Expert 36 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_37_stage2 [label="Expert 37 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_38_stage2 [label="Expert 38 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_39_stage2 [label="Expert 39 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_40_stage2 [label="Expert 40 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_41_stage2 [label="Expert 41 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_42_stage2 [label="Expert 42 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_43_stage2 [label="Expert 43 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_44_stage2 [label="Expert 44 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_45_stage2 [label="Expert 45 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_46_stage2 [label="Expert 46 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_47_stage2 [label="Expert 47 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_48_stage2 [label="Expert 48 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_49_stage2 [label="Expert 49 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_50_stage2 [label="Expert 50 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_51_stage2 [label="Expert 51 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_52_stage2 [label="Expert 52 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_53_stage2 [label="Expert 53 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_54_stage2 [label="Expert 54 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_55_stage2 [label="Expert 55 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_56_stage2 [label="Expert 56 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_57_stage2 [label="Expert 57 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_58_stage2 [label="Expert 58 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_59_stage2 [label="Expert 59 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_60_stage2 [label="Expert 60 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_61_stage2 [label="Expert 61 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_62_stage2 [label="Expert 62 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_12_63_stage2 [label="Expert 63 (TP8) L12\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		combine_12_stage2 [label="Expert Combine (All-to-All) L12\nInput: [128, seq_len/64, 2048]\nOutput: [128, seq_len, 2048]" fillcolor=lightyellow shape=ellipse]
		moe_out_12_stage2 [label="MoE Output (TP8) L12\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		ln2_12_stage2 [label="LayerNorm (TP8) L12\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		ln1_13_stage2 [label="LayerNorm (TP8) L13\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		qkv_13_stage2 [label="QKV Projection (TP8) L13\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightgreen shape=rectangle]
		attn_13_stage2 [label="Self-Attention (TP8) L13\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightgreen shape=rectangle]
		attn_out_13_stage2 [label="Attention Output (TP8) L13\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		route_13_stage2 [label="MoE Routing (EP64) L13\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 2048]" fillcolor=lightcoral shape=parallelogram]
		dispatch_13_stage2 [label="Expert Dispatch (All-to-All) L13\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len/64, 2048]" fillcolor=lightyellow shape=ellipse]
		expert_13_0_stage2 [label="Expert 0 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_1_stage2 [label="Expert 1 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_2_stage2 [label="Expert 2 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_3_stage2 [label="Expert 3 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_4_stage2 [label="Expert 4 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_5_stage2 [label="Expert 5 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_6_stage2 [label="Expert 6 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_7_stage2 [label="Expert 7 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_8_stage2 [label="Expert 8 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_9_stage2 [label="Expert 9 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_10_stage2 [label="Expert 10 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_11_stage2 [label="Expert 11 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_12_stage2 [label="Expert 12 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_13_stage2 [label="Expert 13 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_14_stage2 [label="Expert 14 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_15_stage2 [label="Expert 15 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_16_stage2 [label="Expert 16 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_17_stage2 [label="Expert 17 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_18_stage2 [label="Expert 18 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_19_stage2 [label="Expert 19 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_20_stage2 [label="Expert 20 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_21_stage2 [label="Expert 21 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_22_stage2 [label="Expert 22 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_23_stage2 [label="Expert 23 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_24_stage2 [label="Expert 24 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_25_stage2 [label="Expert 25 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_26_stage2 [label="Expert 26 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_27_stage2 [label="Expert 27 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_28_stage2 [label="Expert 28 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_29_stage2 [label="Expert 29 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_30_stage2 [label="Expert 30 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_31_stage2 [label="Expert 31 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_32_stage2 [label="Expert 32 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_33_stage2 [label="Expert 33 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_34_stage2 [label="Expert 34 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_35_stage2 [label="Expert 35 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_36_stage2 [label="Expert 36 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_37_stage2 [label="Expert 37 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_38_stage2 [label="Expert 38 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_39_stage2 [label="Expert 39 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_40_stage2 [label="Expert 40 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_41_stage2 [label="Expert 41 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_42_stage2 [label="Expert 42 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_43_stage2 [label="Expert 43 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_44_stage2 [label="Expert 44 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_45_stage2 [label="Expert 45 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_46_stage2 [label="Expert 46 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_47_stage2 [label="Expert 47 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_48_stage2 [label="Expert 48 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_49_stage2 [label="Expert 49 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_50_stage2 [label="Expert 50 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_51_stage2 [label="Expert 51 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_52_stage2 [label="Expert 52 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_53_stage2 [label="Expert 53 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_54_stage2 [label="Expert 54 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_55_stage2 [label="Expert 55 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_56_stage2 [label="Expert 56 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_57_stage2 [label="Expert 57 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_58_stage2 [label="Expert 58 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_59_stage2 [label="Expert 59 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_60_stage2 [label="Expert 60 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_61_stage2 [label="Expert 61 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_62_stage2 [label="Expert 62 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_13_63_stage2 [label="Expert 63 (TP8) L13\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		combine_13_stage2 [label="Expert Combine (All-to-All) L13\nInput: [128, seq_len/64, 2048]\nOutput: [128, seq_len, 2048]" fillcolor=lightyellow shape=ellipse]
		moe_out_13_stage2 [label="MoE Output (TP8) L13\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		ln2_13_stage2 [label="LayerNorm (TP8) L13\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		ln1_14_stage2 [label="LayerNorm (TP8) L14\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		qkv_14_stage2 [label="QKV Projection (TP8) L14\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightgreen shape=rectangle]
		attn_14_stage2 [label="Self-Attention (TP8) L14\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightgreen shape=rectangle]
		attn_out_14_stage2 [label="Attention Output (TP8) L14\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		route_14_stage2 [label="MoE Routing (EP64) L14\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 2048]" fillcolor=lightcoral shape=parallelogram]
		dispatch_14_stage2 [label="Expert Dispatch (All-to-All) L14\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len/64, 2048]" fillcolor=lightyellow shape=ellipse]
		expert_14_0_stage2 [label="Expert 0 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_1_stage2 [label="Expert 1 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_2_stage2 [label="Expert 2 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_3_stage2 [label="Expert 3 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_4_stage2 [label="Expert 4 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_5_stage2 [label="Expert 5 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_6_stage2 [label="Expert 6 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_7_stage2 [label="Expert 7 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_8_stage2 [label="Expert 8 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_9_stage2 [label="Expert 9 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_10_stage2 [label="Expert 10 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_11_stage2 [label="Expert 11 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_12_stage2 [label="Expert 12 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_13_stage2 [label="Expert 13 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_14_stage2 [label="Expert 14 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_15_stage2 [label="Expert 15 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_16_stage2 [label="Expert 16 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_17_stage2 [label="Expert 17 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_18_stage2 [label="Expert 18 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_19_stage2 [label="Expert 19 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_20_stage2 [label="Expert 20 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_21_stage2 [label="Expert 21 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_22_stage2 [label="Expert 22 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_23_stage2 [label="Expert 23 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_24_stage2 [label="Expert 24 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_25_stage2 [label="Expert 25 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_26_stage2 [label="Expert 26 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_27_stage2 [label="Expert 27 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_28_stage2 [label="Expert 28 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_29_stage2 [label="Expert 29 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_30_stage2 [label="Expert 30 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_31_stage2 [label="Expert 31 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_32_stage2 [label="Expert 32 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_33_stage2 [label="Expert 33 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_34_stage2 [label="Expert 34 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_35_stage2 [label="Expert 35 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_36_stage2 [label="Expert 36 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_37_stage2 [label="Expert 37 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_38_stage2 [label="Expert 38 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_39_stage2 [label="Expert 39 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_40_stage2 [label="Expert 40 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_41_stage2 [label="Expert 41 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_42_stage2 [label="Expert 42 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_43_stage2 [label="Expert 43 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_44_stage2 [label="Expert 44 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_45_stage2 [label="Expert 45 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_46_stage2 [label="Expert 46 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_47_stage2 [label="Expert 47 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_48_stage2 [label="Expert 48 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_49_stage2 [label="Expert 49 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_50_stage2 [label="Expert 50 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_51_stage2 [label="Expert 51 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_52_stage2 [label="Expert 52 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_53_stage2 [label="Expert 53 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_54_stage2 [label="Expert 54 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_55_stage2 [label="Expert 55 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_56_stage2 [label="Expert 56 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_57_stage2 [label="Expert 57 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_58_stage2 [label="Expert 58 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_59_stage2 [label="Expert 59 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_60_stage2 [label="Expert 60 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_61_stage2 [label="Expert 61 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_62_stage2 [label="Expert 62 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_14_63_stage2 [label="Expert 63 (TP8) L14\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		combine_14_stage2 [label="Expert Combine (All-to-All) L14\nInput: [128, seq_len/64, 2048]\nOutput: [128, seq_len, 2048]" fillcolor=lightyellow shape=ellipse]
		moe_out_14_stage2 [label="MoE Output (TP8) L14\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		ln2_14_stage2 [label="LayerNorm (TP8) L14\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		ln1_15_stage2 [label="LayerNorm (TP8) L15\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		qkv_15_stage2 [label="QKV Projection (TP8) L15\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightgreen shape=rectangle]
		attn_15_stage2 [label="Self-Attention (TP8) L15\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightgreen shape=rectangle]
		attn_out_15_stage2 [label="Attention Output (TP8) L15\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		route_15_stage2 [label="MoE Routing (EP64) L15\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 2048]" fillcolor=lightcoral shape=parallelogram]
		dispatch_15_stage2 [label="Expert Dispatch (All-to-All) L15\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len/64, 2048]" fillcolor=lightyellow shape=ellipse]
		expert_15_0_stage2 [label="Expert 0 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_1_stage2 [label="Expert 1 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_2_stage2 [label="Expert 2 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_3_stage2 [label="Expert 3 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_4_stage2 [label="Expert 4 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_5_stage2 [label="Expert 5 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_6_stage2 [label="Expert 6 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_7_stage2 [label="Expert 7 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_8_stage2 [label="Expert 8 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_9_stage2 [label="Expert 9 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_10_stage2 [label="Expert 10 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_11_stage2 [label="Expert 11 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_12_stage2 [label="Expert 12 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_13_stage2 [label="Expert 13 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_14_stage2 [label="Expert 14 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_15_stage2 [label="Expert 15 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_16_stage2 [label="Expert 16 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_17_stage2 [label="Expert 17 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_18_stage2 [label="Expert 18 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_19_stage2 [label="Expert 19 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_20_stage2 [label="Expert 20 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_21_stage2 [label="Expert 21 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_22_stage2 [label="Expert 22 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_23_stage2 [label="Expert 23 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_24_stage2 [label="Expert 24 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_25_stage2 [label="Expert 25 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_26_stage2 [label="Expert 26 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_27_stage2 [label="Expert 27 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_28_stage2 [label="Expert 28 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_29_stage2 [label="Expert 29 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_30_stage2 [label="Expert 30 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_31_stage2 [label="Expert 31 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_32_stage2 [label="Expert 32 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_33_stage2 [label="Expert 33 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_34_stage2 [label="Expert 34 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_35_stage2 [label="Expert 35 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_36_stage2 [label="Expert 36 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_37_stage2 [label="Expert 37 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_38_stage2 [label="Expert 38 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_39_stage2 [label="Expert 39 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_40_stage2 [label="Expert 40 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_41_stage2 [label="Expert 41 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_42_stage2 [label="Expert 42 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_43_stage2 [label="Expert 43 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_44_stage2 [label="Expert 44 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_45_stage2 [label="Expert 45 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_46_stage2 [label="Expert 46 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_47_stage2 [label="Expert 47 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_48_stage2 [label="Expert 48 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_49_stage2 [label="Expert 49 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_50_stage2 [label="Expert 50 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_51_stage2 [label="Expert 51 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_52_stage2 [label="Expert 52 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_53_stage2 [label="Expert 53 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_54_stage2 [label="Expert 54 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_55_stage2 [label="Expert 55 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_56_stage2 [label="Expert 56 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_57_stage2 [label="Expert 57 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_58_stage2 [label="Expert 58 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_59_stage2 [label="Expert 59 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_60_stage2 [label="Expert 60 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_61_stage2 [label="Expert 61 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_62_stage2 [label="Expert 62 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_15_63_stage2 [label="Expert 63 (TP8) L15\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		combine_15_stage2 [label="Expert Combine (All-to-All) L15\nInput: [128, seq_len/64, 2048]\nOutput: [128, seq_len, 2048]" fillcolor=lightyellow shape=ellipse]
		moe_out_15_stage2 [label="MoE Output (TP8) L15\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		ln2_15_stage2 [label="LayerNorm (TP8) L15\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		ln1_16_stage2 [label="LayerNorm (TP8) L16\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		qkv_16_stage2 [label="QKV Projection (TP8) L16\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightgreen shape=rectangle]
		attn_16_stage2 [label="Self-Attention (TP8) L16\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 16, 64]" fillcolor=lightgreen shape=rectangle]
		attn_out_16_stage2 [label="Attention Output (TP8) L16\nInput: [128, seq_len, 16, 64]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		route_16_stage2 [label="MoE Routing (EP64) L16\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 2048]" fillcolor=lightcoral shape=parallelogram]
		dispatch_16_stage2 [label="Expert Dispatch (All-to-All) L16\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len/64, 2048]" fillcolor=lightyellow shape=ellipse]
		expert_16_0_stage2 [label="Expert 0 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_1_stage2 [label="Expert 1 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_2_stage2 [label="Expert 2 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_3_stage2 [label="Expert 3 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_4_stage2 [label="Expert 4 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_5_stage2 [label="Expert 5 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_6_stage2 [label="Expert 6 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_7_stage2 [label="Expert 7 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_8_stage2 [label="Expert 8 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_9_stage2 [label="Expert 9 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_10_stage2 [label="Expert 10 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_11_stage2 [label="Expert 11 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_12_stage2 [label="Expert 12 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_13_stage2 [label="Expert 13 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_14_stage2 [label="Expert 14 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_15_stage2 [label="Expert 15 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_16_stage2 [label="Expert 16 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_17_stage2 [label="Expert 17 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_18_stage2 [label="Expert 18 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_19_stage2 [label="Expert 19 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_20_stage2 [label="Expert 20 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_21_stage2 [label="Expert 21 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_22_stage2 [label="Expert 22 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_23_stage2 [label="Expert 23 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_24_stage2 [label="Expert 24 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_25_stage2 [label="Expert 25 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_26_stage2 [label="Expert 26 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_27_stage2 [label="Expert 27 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_28_stage2 [label="Expert 28 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_29_stage2 [label="Expert 29 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_30_stage2 [label="Expert 30 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_31_stage2 [label="Expert 31 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_32_stage2 [label="Expert 32 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_33_stage2 [label="Expert 33 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_34_stage2 [label="Expert 34 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_35_stage2 [label="Expert 35 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_36_stage2 [label="Expert 36 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_37_stage2 [label="Expert 37 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_38_stage2 [label="Expert 38 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_39_stage2 [label="Expert 39 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_40_stage2 [label="Expert 40 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_41_stage2 [label="Expert 41 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_42_stage2 [label="Expert 42 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_43_stage2 [label="Expert 43 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_44_stage2 [label="Expert 44 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_45_stage2 [label="Expert 45 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_46_stage2 [label="Expert 46 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_47_stage2 [label="Expert 47 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_48_stage2 [label="Expert 48 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_49_stage2 [label="Expert 49 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_50_stage2 [label="Expert 50 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_51_stage2 [label="Expert 51 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_52_stage2 [label="Expert 52 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_53_stage2 [label="Expert 53 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_54_stage2 [label="Expert 54 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_55_stage2 [label="Expert 55 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_56_stage2 [label="Expert 56 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_57_stage2 [label="Expert 57 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_58_stage2 [label="Expert 58 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_59_stage2 [label="Expert 59 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_60_stage2 [label="Expert 60 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_61_stage2 [label="Expert 61 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_62_stage2 [label="Expert 62 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		expert_16_63_stage2 [label="Expert 63 (TP8) L16\nInput: [2, seq_len/64, 2048]\nOutput: [2, seq_len/64, 2048]" fillcolor=lightgreen shape=rectangle]
		combine_16_stage2 [label="Expert Combine (All-to-All) L16\nInput: [128, seq_len/64, 2048]\nOutput: [128, seq_len, 2048]" fillcolor=lightyellow shape=ellipse]
		moe_out_16_stage2 [label="MoE Output (TP8) L16\nInput: [128, seq_len, 2048]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
		ln2_16_stage2 [label="LayerNorm (TP8) L16\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
	}
	final_ln [label="Final LayerNorm (TP8)\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, 1024]" fillcolor=lightgreen shape=rectangle]
	lm_head [label="LM Head (TP8)\nInput: [128, seq_len, 1024]\nOutput: [128, seq_len, vocab_size]" fillcolor=lightgreen shape=rectangle]
	output [label="Output\nBatch Size: 128\nSeq Length: [128-10240]\nVocab Size: vocab_size" fillcolor=white shape=ellipse style=bold]
	input -> embed_stage1
	embed_stage1 -> ln1_1_stage1
	ln1_1_stage1 -> qkv_1_stage1
	qkv_1_stage1 -> attn_1_stage1
	attn_1_stage1 -> attn_out_1_stage1
	attn_out_1_stage1 -> ln2_1_stage1
	ln2_1_stage1 -> route_1_stage1
	route_1_stage1 -> dispatch_1_stage1
	dispatch_1_stage1 -> expert_1_0_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_1_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_2_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_3_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_4_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_5_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_6_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_7_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_8_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_9_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_10_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_11_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_12_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_13_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_14_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_15_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_16_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_17_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_18_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_19_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_20_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_21_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_22_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_23_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_24_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_25_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_26_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_27_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_28_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_29_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_30_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_31_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_32_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_33_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_34_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_35_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_36_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_37_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_38_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_39_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_40_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_41_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_42_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_43_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_44_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_45_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_46_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_47_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_48_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_49_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_50_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_51_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_52_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_53_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_54_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_55_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_56_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_57_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_58_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_59_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_60_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_61_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_62_stage1 [style=dashed]
	dispatch_1_stage1 -> expert_1_63_stage1 [style=dashed]
	expert_1_0_stage1 -> combine_1_stage1
	expert_1_1_stage1 -> combine_1_stage1
	expert_1_2_stage1 -> combine_1_stage1
	expert_1_3_stage1 -> combine_1_stage1
	expert_1_4_stage1 -> combine_1_stage1
	expert_1_5_stage1 -> combine_1_stage1
	expert_1_6_stage1 -> combine_1_stage1
	expert_1_7_stage1 -> combine_1_stage1
	expert_1_8_stage1 -> combine_1_stage1
	expert_1_9_stage1 -> combine_1_stage1
	expert_1_10_stage1 -> combine_1_stage1
	expert_1_11_stage1 -> combine_1_stage1
	expert_1_12_stage1 -> combine_1_stage1
	expert_1_13_stage1 -> combine_1_stage1
	expert_1_14_stage1 -> combine_1_stage1
	expert_1_15_stage1 -> combine_1_stage1
	expert_1_16_stage1 -> combine_1_stage1
	expert_1_17_stage1 -> combine_1_stage1
	expert_1_18_stage1 -> combine_1_stage1
	expert_1_19_stage1 -> combine_1_stage1
	expert_1_20_stage1 -> combine_1_stage1
	expert_1_21_stage1 -> combine_1_stage1
	expert_1_22_stage1 -> combine_1_stage1
	expert_1_23_stage1 -> combine_1_stage1
	expert_1_24_stage1 -> combine_1_stage1
	expert_1_25_stage1 -> combine_1_stage1
	expert_1_26_stage1 -> combine_1_stage1
	expert_1_27_stage1 -> combine_1_stage1
	expert_1_28_stage1 -> combine_1_stage1
	expert_1_29_stage1 -> combine_1_stage1
	expert_1_30_stage1 -> combine_1_stage1
	expert_1_31_stage1 -> combine_1_stage1
	expert_1_32_stage1 -> combine_1_stage1
	expert_1_33_stage1 -> combine_1_stage1
	expert_1_34_stage1 -> combine_1_stage1
	expert_1_35_stage1 -> combine_1_stage1
	expert_1_36_stage1 -> combine_1_stage1
	expert_1_37_stage1 -> combine_1_stage1
	expert_1_38_stage1 -> combine_1_stage1
	expert_1_39_stage1 -> combine_1_stage1
	expert_1_40_stage1 -> combine_1_stage1
	expert_1_41_stage1 -> combine_1_stage1
	expert_1_42_stage1 -> combine_1_stage1
	expert_1_43_stage1 -> combine_1_stage1
	expert_1_44_stage1 -> combine_1_stage1
	expert_1_45_stage1 -> combine_1_stage1
	expert_1_46_stage1 -> combine_1_stage1
	expert_1_47_stage1 -> combine_1_stage1
	expert_1_48_stage1 -> combine_1_stage1
	expert_1_49_stage1 -> combine_1_stage1
	expert_1_50_stage1 -> combine_1_stage1
	expert_1_51_stage1 -> combine_1_stage1
	expert_1_52_stage1 -> combine_1_stage1
	expert_1_53_stage1 -> combine_1_stage1
	expert_1_54_stage1 -> combine_1_stage1
	expert_1_55_stage1 -> combine_1_stage1
	expert_1_56_stage1 -> combine_1_stage1
	expert_1_57_stage1 -> combine_1_stage1
	expert_1_58_stage1 -> combine_1_stage1
	expert_1_59_stage1 -> combine_1_stage1
	expert_1_60_stage1 -> combine_1_stage1
	expert_1_61_stage1 -> combine_1_stage1
	expert_1_62_stage1 -> combine_1_stage1
	expert_1_63_stage1 -> combine_1_stage1
	combine_1_stage1 -> moe_out_1_stage1
	moe_out_1_stage1 -> ln1_2_stage1
	ln2_8_stage1 -> ln1_9_stage2 [label="PP Transfer" style=bold]
	ln1_9_stage2 -> qkv_9_stage2
	qkv_9_stage2 -> attn_9_stage2
	attn_9_stage2 -> attn_out_9_stage2
	attn_out_9_stage2 -> ln2_9_stage2
	ln2_9_stage2 -> route_9_stage2
	route_9_stage2 -> dispatch_9_stage2
	dispatch_9_stage2 -> expert_9_0_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_1_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_2_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_3_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_4_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_5_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_6_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_7_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_8_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_9_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_10_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_11_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_12_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_13_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_14_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_15_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_16_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_17_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_18_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_19_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_20_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_21_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_22_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_23_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_24_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_25_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_26_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_27_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_28_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_29_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_30_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_31_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_32_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_33_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_34_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_35_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_36_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_37_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_38_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_39_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_40_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_41_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_42_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_43_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_44_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_45_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_46_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_47_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_48_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_49_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_50_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_51_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_52_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_53_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_54_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_55_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_56_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_57_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_58_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_59_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_60_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_61_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_62_stage2 [style=dashed]
	dispatch_9_stage2 -> expert_9_63_stage2 [style=dashed]
	expert_9_0_stage2 -> combine_9_stage2
	expert_9_1_stage2 -> combine_9_stage2
	expert_9_2_stage2 -> combine_9_stage2
	expert_9_3_stage2 -> combine_9_stage2
	expert_9_4_stage2 -> combine_9_stage2
	expert_9_5_stage2 -> combine_9_stage2
	expert_9_6_stage2 -> combine_9_stage2
	expert_9_7_stage2 -> combine_9_stage2
	expert_9_8_stage2 -> combine_9_stage2
	expert_9_9_stage2 -> combine_9_stage2
	expert_9_10_stage2 -> combine_9_stage2
	expert_9_11_stage2 -> combine_9_stage2
	expert_9_12_stage2 -> combine_9_stage2
	expert_9_13_stage2 -> combine_9_stage2
	expert_9_14_stage2 -> combine_9_stage2
	expert_9_15_stage2 -> combine_9_stage2
	expert_9_16_stage2 -> combine_9_stage2
	expert_9_17_stage2 -> combine_9_stage2
	expert_9_18_stage2 -> combine_9_stage2
	expert_9_19_stage2 -> combine_9_stage2
	expert_9_20_stage2 -> combine_9_stage2
	expert_9_21_stage2 -> combine_9_stage2
	expert_9_22_stage2 -> combine_9_stage2
	expert_9_23_stage2 -> combine_9_stage2
	expert_9_24_stage2 -> combine_9_stage2
	expert_9_25_stage2 -> combine_9_stage2
	expert_9_26_stage2 -> combine_9_stage2
	expert_9_27_stage2 -> combine_9_stage2
	expert_9_28_stage2 -> combine_9_stage2
	expert_9_29_stage2 -> combine_9_stage2
	expert_9_30_stage2 -> combine_9_stage2
	expert_9_31_stage2 -> combine_9_stage2
	expert_9_32_stage2 -> combine_9_stage2
	expert_9_33_stage2 -> combine_9_stage2
	expert_9_34_stage2 -> combine_9_stage2
	expert_9_35_stage2 -> combine_9_stage2
	expert_9_36_stage2 -> combine_9_stage2
	expert_9_37_stage2 -> combine_9_stage2
	expert_9_38_stage2 -> combine_9_stage2
	expert_9_39_stage2 -> combine_9_stage2
	expert_9_40_stage2 -> combine_9_stage2
	expert_9_41_stage2 -> combine_9_stage2
	expert_9_42_stage2 -> combine_9_stage2
	expert_9_43_stage2 -> combine_9_stage2
	expert_9_44_stage2 -> combine_9_stage2
	expert_9_45_stage2 -> combine_9_stage2
	expert_9_46_stage2 -> combine_9_stage2
	expert_9_47_stage2 -> combine_9_stage2
	expert_9_48_stage2 -> combine_9_stage2
	expert_9_49_stage2 -> combine_9_stage2
	expert_9_50_stage2 -> combine_9_stage2
	expert_9_51_stage2 -> combine_9_stage2
	expert_9_52_stage2 -> combine_9_stage2
	expert_9_53_stage2 -> combine_9_stage2
	expert_9_54_stage2 -> combine_9_stage2
	expert_9_55_stage2 -> combine_9_stage2
	expert_9_56_stage2 -> combine_9_stage2
	expert_9_57_stage2 -> combine_9_stage2
	expert_9_58_stage2 -> combine_9_stage2
	expert_9_59_stage2 -> combine_9_stage2
	expert_9_60_stage2 -> combine_9_stage2
	expert_9_61_stage2 -> combine_9_stage2
	expert_9_62_stage2 -> combine_9_stage2
	expert_9_63_stage2 -> combine_9_stage2
	combine_9_stage2 -> moe_out_9_stage2
	moe_out_9_stage2 -> ln1_10_stage2
	ln2_16_stage2 -> final_ln
	final_ln -> lm_head
	lm_head -> output
}
