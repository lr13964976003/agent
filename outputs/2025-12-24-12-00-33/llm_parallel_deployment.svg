<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="15000pt" height="2919pt"
 viewBox="0.00 0.00 3600.00 700.52" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(2.08 2.08) rotate(0) translate(4 1402.19)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1402.19 7222.5,-1402.19 7222.5,4 -4,4"/>
<!-- prefill_start -->
<g id="node1" class="node">
<title>prefill_start</title>
<polygon fill="red" stroke="black" points="204,-1383.69 0,-1383.69 0,-1330.69 204,-1330.69 204,-1383.69"/>
<text text-anchor="middle" x="102" y="-1368.49" font-family="Times,serif" font-size="14.00">PREFILL PHASE</text>
<text text-anchor="middle" x="102" y="-1353.49" font-family="Times,serif" font-size="14.00">PP=4, EP=4, TP=2, SP=2</text>
<text text-anchor="middle" x="102" y="-1338.49" font-family="Times,serif" font-size="14.00">64 GPUs Total</text>
</g>
<!-- input -->
<g id="node2" class="node">
<title>input</title>
<ellipse fill="white" stroke="black" stroke-width="3" cx="422" cy="-1357.19" rx="200.22" ry="28.98"/>
<text text-anchor="middle" x="422" y="-1365.69" font-family="Times,serif" font-size="10.00">INPUT</text>
<text text-anchor="middle" x="422" y="-1354.69" font-family="Times,serif" font-size="10.00">Input: [batch_size=4, seq_len=10240, hidden=512]</text>
<text text-anchor="middle" x="422" y="-1343.69" font-family="Times,serif" font-size="10.00">Output: [batch_size=4, seq_len=10240, hidden=512]</text>
</g>
<!-- sp_split_1 -->
<g id="node4" class="node">
<title>sp_split_1</title>
<polygon fill="lightyellow" stroke="black" points="661.48,-1250.19 280.52,-1250.19 182.52,-1146.19 563.48,-1146.19 661.48,-1250.19"/>
<text text-anchor="middle" x="422" y="-1212.19" font-family="Times,serif" font-size="10.00">SP SPLIT</text>
<text text-anchor="middle" x="422" y="-1201.19" font-family="Times,serif" font-size="10.00">Input: [batch=4, seq=10240, hidden=512]</text>
<text text-anchor="middle" x="422" y="-1190.19" font-family="Times,serif" font-size="10.00">Output: [batch=4, seq=5120, hidden=512]</text>
<text text-anchor="middle" x="422" y="-1179.19" font-family="Times,serif" font-size="10.00">GPU: 0&#45;15</text>
</g>
<!-- input&#45;&gt;sp_split_1 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;sp_split_1</title>
<path fill="none" stroke="black" d="M422,-1328.12C422,-1309.38 422,-1283.97 422,-1260.67"/>
<polygon fill="black" stroke="black" points="425.5,-1260.5 422,-1250.5 418.5,-1260.5 425.5,-1260.5"/>
</g>
<!-- stage1_label -->
<g id="node3" class="node">
<title>stage1_label</title>
<polygon fill="purple" stroke="black" points="775.5,-1380.69 640.5,-1380.69 640.5,-1333.69 775.5,-1333.69 775.5,-1380.69"/>
<text text-anchor="middle" x="708" y="-1367.09" font-family="Times,serif" font-size="12.00">PIPELINE STAGE 1</text>
<text text-anchor="middle" x="708" y="-1354.09" font-family="Times,serif" font-size="12.00">Layers 1&#45;4</text>
<text text-anchor="middle" x="708" y="-1341.09" font-family="Times,serif" font-size="12.00">GPUs: 0&#45;15</text>
</g>
<!-- layernorm1_1 -->
<g id="node5" class="node">
<title>layernorm1_1</title>
<polygon fill="lightgreen" stroke="black" points="537.5,-1109.19 306.5,-1109.19 306.5,-1057.19 537.5,-1057.19 537.5,-1109.19"/>
<text text-anchor="middle" x="422" y="-1097.19" font-family="Times,serif" font-size="10.00">LayerNorm</text>
<text text-anchor="middle" x="422" y="-1086.19" font-family="Times,serif" font-size="10.00">Input: [batch=4, seq=5120, hidden=512]</text>
<text text-anchor="middle" x="422" y="-1075.19" font-family="Times,serif" font-size="10.00">Output: [batch=4, seq=5120, hidden=512]</text>
<text text-anchor="middle" x="422" y="-1064.19" font-family="Times,serif" font-size="10.00">GPU: 0&#45;15</text>
</g>
<!-- sp_split_1&#45;&gt;layernorm1_1 -->
<g id="edge2" class="edge">
<title>sp_split_1&#45;&gt;layernorm1_1</title>
<path fill="none" stroke="black" d="M422,-1145.98C422,-1137.03 422,-1127.9 422,-1119.5"/>
<polygon fill="black" stroke="black" points="425.5,-1119.32 422,-1109.32 418.5,-1119.32 425.5,-1119.32"/>
</g>
<!-- attn_qkv1_1 -->
<g id="node6" class="node">
<title>attn_qkv1_1</title>
<polygon fill="lightgreen" stroke="black" points="357.5,-1020.19 126.5,-1020.19 126.5,-957.19 357.5,-957.19 357.5,-1020.19"/>
<text text-anchor="middle" x="242" y="-1008.19" font-family="Times,serif" font-size="10.00">Attention QKV Proj</text>
<text text-anchor="middle" x="242" y="-997.19" font-family="Times,serif" font-size="10.00">TP=2</text>
<text text-anchor="middle" x="242" y="-986.19" font-family="Times,serif" font-size="10.00">Input: [batch=4, seq=5120, hidden=512]</text>
<text text-anchor="middle" x="242" y="-975.19" font-family="Times,serif" font-size="10.00">Output: [batch=4, seq=5120, hidden=256]</text>
<text text-anchor="middle" x="242" y="-964.19" font-family="Times,serif" font-size="10.00">GPU: 0&#45;7</text>
</g>
<!-- layernorm1_1&#45;&gt;attn_qkv1_1 -->
<g id="edge3" class="edge">
<title>layernorm1_1&#45;&gt;attn_qkv1_1</title>
<path fill="none" stroke="black" d="M373.29,-1057.16C354.06,-1047.28 331.62,-1035.75 310.79,-1025.04"/>
<polygon fill="black" stroke="black" points="312.16,-1021.81 301.67,-1020.35 308.96,-1028.04 312.16,-1021.81"/>
</g>
<!-- attn_qkv1_2 -->
<g id="node7" class="node">
<title>attn_qkv1_2</title>
<polygon fill="lightgreen" stroke="black" points="606.5,-1020.19 375.5,-1020.19 375.5,-957.19 606.5,-957.19 606.5,-1020.19"/>
<text text-anchor="middle" x="491" y="-1008.19" font-family="Times,serif" font-size="10.00">Attention QKV Proj</text>
<text text-anchor="middle" x="491" y="-997.19" font-family="Times,serif" font-size="10.00">TP=2</text>
<text text-anchor="middle" x="491" y="-986.19" font-family="Times,serif" font-size="10.00">Input: [batch=4, seq=5120, hidden=512]</text>
<text text-anchor="middle" x="491" y="-975.19" font-family="Times,serif" font-size="10.00">Output: [batch=4, seq=5120, hidden=256]</text>
<text text-anchor="middle" x="491" y="-964.19" font-family="Times,serif" font-size="10.00">GPU: 8&#45;15</text>
</g>
<!-- layernorm1_1&#45;&gt;attn_qkv1_2 -->
<g id="edge4" class="edge">
<title>layernorm1_1&#45;&gt;attn_qkv1_2</title>
<path fill="none" stroke="black" d="M440.85,-1056.91C447.4,-1048.14 454.89,-1038.1 462.06,-1028.49"/>
<polygon fill="black" stroke="black" points="465.07,-1030.31 468.24,-1020.2 459.45,-1026.13 465.07,-1030.31"/>
</g>
<!-- attn_compute1_1 -->
<g id="node8" class="node">
<title>attn_compute1_1</title>
<polygon fill="lightgreen" stroke="black" points="357.5,-920.19 126.5,-920.19 126.5,-857.19 357.5,-857.19 357.5,-920.19"/>
<text text-anchor="middle" x="242" y="-908.19" font-family="Times,serif" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="242" y="-897.19" font-family="Times,serif" font-size="10.00">SP=2</text>
<text text-anchor="middle" x="242" y="-886.19" font-family="Times,serif" font-size="10.00">Input: [batch=4, seq=5120, hidden=256]</text>
<text text-anchor="middle" x="242" y="-875.19" font-family="Times,serif" font-size="10.00">Output: [batch=4, seq=5120, hidden=256]</text>
<text text-anchor="middle" x="242" y="-864.19" font-family="Times,serif" font-size="10.00">GPU: 0&#45;7</text>
</g>
<!-- attn_qkv1_1&#45;&gt;attn_compute1_1 -->
<g id="edge5" class="edge">
<title>attn_qkv1_1&#45;&gt;attn_compute1_1</title>
<path fill="none" stroke="black" d="M242,-956.95C242,-948.56 242,-939.33 242,-930.48"/>
<polygon fill="black" stroke="black" points="245.5,-930.32 242,-920.32 238.5,-930.32 245.5,-930.32"/>
</g>
<!-- attn_compute1_2 -->
<g id="node9" class="node">
<title>attn_compute1_2</title>
<polygon fill="lightgreen" stroke="black" points="606.5,-920.19 375.5,-920.19 375.5,-857.19 606.5,-857.19 606.5,-920.19"/>
<text text-anchor="middle" x="491" y="-908.19" font-family="Times,serif" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="491" y="-897.19" font-family="Times,serif" font-size="10.00">SP=2</text>
<text text-anchor="middle" x="491" y="-886.19" font-family="Times,serif" font-size="10.00">Input: [batch=4, seq=5120, hidden=256]</text>
<text text-anchor="middle" x="491" y="-875.19" font-family="Times,serif" font-size="10.00">Output: [batch=4, seq=5120, hidden=256]</text>
<text text-anchor="middle" x="491" y="-864.19" font-family="Times,serif" font-size="10.00">GPU: 8&#45;15</text>
</g>
<!-- attn_qkv1_2&#45;&gt;attn_compute1_2 -->
<g id="edge6" class="edge">
<title>attn_qkv1_2&#45;&gt;attn_compute1_2</title>
<path fill="none" stroke="black" d="M491,-956.95C491,-948.56 491,-939.33 491,-930.48"/>
<polygon fill="black" stroke="black" points="494.5,-930.32 491,-920.32 487.5,-930.32 494.5,-930.32"/>
</g>
<!-- attn_gather1 -->
<g id="node10" class="node">
<title>attn_gather1</title>
<ellipse fill="lightblue" stroke="black" cx="428" cy="-775.64" rx="163.18" ry="44.6"/>
<text text-anchor="middle" x="428" y="-795.14" font-family="Times,serif" font-size="10.00">All&#45;Gather</text>
<text text-anchor="middle" x="428" y="-784.14" font-family="Times,serif" font-size="10.00">TP Attention</text>
<text text-anchor="middle" x="428" y="-773.14" font-family="Times,serif" font-size="10.00">Input: [batch=4, seq=5120, hidden=256]</text>
<text text-anchor="middle" x="428" y="-762.14" font-family="Times,serif" font-size="10.00">Output: [batch=4, seq=5120, hidden=512]</text>
<text text-anchor="middle" x="428" y="-751.14" font-family="Times,serif" font-size="10.00">GPU: 0&#45;15</text>
</g>
<!-- attn_compute1_1&#45;&gt;attn_gather1 -->
<g id="edge7" class="edge">
<title>attn_compute1_1&#45;&gt;attn_gather1</title>
<path fill="none" stroke="black" d="M293.32,-857.05C311.68,-846.09 332.77,-833.5 352.73,-821.58"/>
<polygon fill="black" stroke="black" points="354.71,-824.48 361.5,-816.34 351.12,-818.47 354.71,-824.48"/>
</g>
<!-- attn_compute1_2&#45;&gt;attn_gather1 -->
<g id="edge8" class="edge">
<title>attn_compute1_2&#45;&gt;attn_gather1</title>
<path fill="none" stroke="black" d="M473.62,-857.05C468.65,-848.3 463.1,-838.52 457.62,-828.86"/>
<polygon fill="black" stroke="black" points="460.61,-827.04 452.63,-820.07 454.52,-830.49 460.61,-827.04"/>
</g>
<!-- mlp_gate1 -->
<g id="node11" class="node">
<title>mlp_gate1</title>
<polygon fill="lightgreen" stroke="black" points="556,-679.1 300,-679.1 300,-627.1 556,-627.1 556,-679.1"/>
<text text-anchor="middle" x="428" y="-667.1" font-family="Times,serif" font-size="10.00">MLP Gate</text>
<text text-anchor="middle" x="428" y="-656.1" font-family="Times,serif" font-size="10.00">Input: [batch=4, seq=5120, hidden=512]</text>
<text text-anchor="middle" x="428" y="-645.1" font-family="Times,serif" font-size="10.00">Output: [batch=4, seq=5120, num_experts=16]</text>
<text text-anchor="middle" x="428" y="-634.1" font-family="Times,serif" font-size="10.00">GPU: 0&#45;15</text>
</g>
<!-- attn_gather1&#45;&gt;mlp_gate1 -->
<g id="edge9" class="edge">
<title>attn_gather1&#45;&gt;mlp_gate1</title>
<path fill="none" stroke="black" d="M428,-730.78C428,-717.21 428,-702.44 428,-689.52"/>
<polygon fill="black" stroke="black" points="431.5,-689.17 428,-679.17 424.5,-689.17 431.5,-689.17"/>
</g>
<!-- expert_route1 -->
<g id="node12" class="node">
<title>expert_route1</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="524.34,-575.1 371.09,-575.1 331.66,-493.1 484.91,-493.1 524.34,-575.1"/>
<text text-anchor="middle" x="428" y="-542.6" font-family="Times,serif" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="428" y="-531.6" font-family="Times,serif" font-size="10.00">Top&#45;2 Selection</text>
<text text-anchor="middle" x="428" y="-520.6" font-family="Times,serif" font-size="10.00">GPU: 0&#45;15</text>
</g>
<!-- mlp_gate1&#45;&gt;expert_route1 -->
<g id="edge10" class="edge">
<title>mlp_gate1&#45;&gt;expert_route1</title>
<path fill="none" stroke="black" d="M428,-627C428,-614.89 428,-599.92 428,-585.6"/>
<polygon fill="black" stroke="black" points="431.5,-585.34 428,-575.34 424.5,-585.34 431.5,-585.34"/>
</g>
<!-- expert1_1 -->
<g id="node13" class="node">
<title>expert1_1</title>
<polygon fill="lightgreen" stroke="black" points="231.5,-456.1 0.5,-456.1 0.5,-393.1 231.5,-393.1 231.5,-456.1"/>
<text text-anchor="middle" x="116" y="-444.1" font-family="Times,serif" font-size="10.00">Expert 0&#45;3</text>
<text text-anchor="middle" x="116" y="-433.1" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="116" y="-422.1" font-family="Times,serif" font-size="10.00">Input: [batch=4, seq=1280, hidden=512]</text>
<text text-anchor="middle" x="116" y="-411.1" font-family="Times,serif" font-size="10.00">Output: [batch=4, seq=1280, hidden=512]</text>
<text text-anchor="middle" x="116" y="-400.1" font-family="Times,serif" font-size="10.00">GPU: 0&#45;3</text>
</g>
<!-- expert_route1&#45;&gt;expert1_1 -->
<g id="edge11" class="edge">
<title>expert_route1&#45;&gt;expert1_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M335.23,-501.13C297.15,-488.01 253.01,-472.8 214.36,-459.49"/>
<polygon fill="black" stroke="black" points="215.25,-456.09 204.66,-456.14 212.97,-462.71 215.25,-456.09"/>
</g>
<!-- expert1_2 -->
<g id="node14" class="node">
<title>expert1_2</title>
<polygon fill="lightgreen" stroke="black" points="480.5,-456.1 249.5,-456.1 249.5,-393.1 480.5,-393.1 480.5,-456.1"/>
<text text-anchor="middle" x="365" y="-444.1" font-family="Times,serif" font-size="10.00">Expert 4&#45;7</text>
<text text-anchor="middle" x="365" y="-433.1" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="365" y="-422.1" font-family="Times,serif" font-size="10.00">Input: [batch=4, seq=1280, hidden=512]</text>
<text text-anchor="middle" x="365" y="-411.1" font-family="Times,serif" font-size="10.00">Output: [batch=4, seq=1280, hidden=512]</text>
<text text-anchor="middle" x="365" y="-400.1" font-family="Times,serif" font-size="10.00">GPU: 4&#45;7</text>
</g>
<!-- expert_route1&#45;&gt;expert1_2 -->
<g id="edge12" class="edge">
<title>expert_route1&#45;&gt;expert1_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M404.54,-493.07C399.19,-483.93 393.5,-474.23 388.16,-465.12"/>
<polygon fill="black" stroke="black" points="391.04,-463.11 382.96,-456.25 385,-466.65 391.04,-463.11"/>
</g>
<!-- expert1_3 -->
<g id="node15" class="node">
<title>expert1_3</title>
<polygon fill="lightgreen" stroke="black" points="729.5,-456.1 498.5,-456.1 498.5,-393.1 729.5,-393.1 729.5,-456.1"/>
<text text-anchor="middle" x="614" y="-444.1" font-family="Times,serif" font-size="10.00">Expert 8&#45;11</text>
<text text-anchor="middle" x="614" y="-433.1" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="614" y="-422.1" font-family="Times,serif" font-size="10.00">Input: [batch=4, seq=1280, hidden=512]</text>
<text text-anchor="middle" x="614" y="-411.1" font-family="Times,serif" font-size="10.00">Output: [batch=4, seq=1280, hidden=512]</text>
<text text-anchor="middle" x="614" y="-400.1" font-family="Times,serif" font-size="10.00">GPU: 8&#45;11</text>
</g>
<!-- expert_route1&#45;&gt;expert1_3 -->
<g id="edge13" class="edge">
<title>expert_route1&#45;&gt;expert1_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M487.62,-498.64C508.26,-486.71 531.43,-473.32 552.24,-461.29"/>
<polygon fill="black" stroke="black" points="554.09,-464.26 561,-456.23 550.59,-458.2 554.09,-464.26"/>
</g>
<!-- expert1_4 -->
<g id="node16" class="node">
<title>expert1_4</title>
<polygon fill="lightgreen" stroke="black" points="978.5,-456.1 747.5,-456.1 747.5,-393.1 978.5,-393.1 978.5,-456.1"/>
<text text-anchor="middle" x="863" y="-444.1" font-family="Times,serif" font-size="10.00">Expert 12&#45;15</text>
<text text-anchor="middle" x="863" y="-433.1" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="863" y="-422.1" font-family="Times,serif" font-size="10.00">Input: [batch=4, seq=1280, hidden=512]</text>
<text text-anchor="middle" x="863" y="-411.1" font-family="Times,serif" font-size="10.00">Output: [batch=4, seq=1280, hidden=512]</text>
<text text-anchor="middle" x="863" y="-400.1" font-family="Times,serif" font-size="10.00">GPU: 12&#45;15</text>
</g>
<!-- expert_route1&#45;&gt;expert1_4 -->
<g id="edge14" class="edge">
<title>expert_route1&#45;&gt;expert1_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M496.45,-516.18C560.81,-500.28 658.72,-476.08 737.16,-456.69"/>
<polygon fill="black" stroke="black" points="738.25,-460.03 747.11,-454.23 736.57,-453.24 738.25,-460.03"/>
</g>
<!-- expert_all2all1 -->
<g id="node17" class="node">
<title>expert_all2all1</title>
<ellipse fill="lightblue" stroke="black" cx="434" cy="-311.55" rx="163.18" ry="44.6"/>
<text text-anchor="middle" x="434" y="-331.05" font-family="Times,serif" font-size="10.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="434" y="-320.05" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="434" y="-309.05" font-family="Times,serif" font-size="10.00">Input: [batch=4, seq=1280, hidden=512]</text>
<text text-anchor="middle" x="434" y="-298.05" font-family="Times,serif" font-size="10.00">Output: [batch=4, seq=5120, hidden=512]</text>
<text text-anchor="middle" x="434" y="-287.05" font-family="Times,serif" font-size="10.00">GPU: 0&#45;15</text>
</g>
<!-- expert1_1&#45;&gt;expert_all2all1 -->
<g id="edge15" class="edge">
<title>expert1_1&#45;&gt;expert_all2all1</title>
<path fill="none" stroke="black" d="M203.74,-392.96C241.44,-379.79 285.87,-364.27 325.6,-350.4"/>
<polygon fill="black" stroke="black" points="326.78,-353.7 335.06,-347.1 324.47,-347.09 326.78,-353.7"/>
</g>
<!-- expert1_2&#45;&gt;expert_all2all1 -->
<g id="edge16" class="edge">
<title>expert1_2&#45;&gt;expert_all2all1</title>
<path fill="none" stroke="black" d="M384.04,-392.96C389.59,-384.02 395.82,-374 401.94,-364.14"/>
<polygon fill="black" stroke="black" points="404.97,-365.89 407.28,-355.55 399.03,-362.2 404.97,-365.89"/>
</g>
<!-- expert1_3&#45;&gt;expert_all2all1 -->
<g id="edge17" class="edge">
<title>expert1_3&#45;&gt;expert_all2all1</title>
<path fill="none" stroke="black" d="M564.34,-392.96C546.74,-382.1 526.55,-369.64 507.4,-357.83"/>
<polygon fill="black" stroke="black" points="509.03,-354.73 498.69,-352.45 505.36,-360.68 509.03,-354.73"/>
</g>
<!-- expert1_4&#45;&gt;expert_all2all1 -->
<g id="edge18" class="edge">
<title>expert1_4&#45;&gt;expert_all2all1</title>
<path fill="none" stroke="black" d="M747.47,-393.69C689.76,-378.75 619.8,-360.64 560.63,-345.33"/>
<polygon fill="black" stroke="black" points="561.41,-341.91 550.85,-342.8 559.66,-348.69 561.41,-341.91"/>
</g>
<!-- sp_gather_1 -->
<g id="node18" class="node">
<title>sp_gather_1</title>
<polygon fill="lightyellow" stroke="black" points="679.92,-230 288.72,-230 188.08,-126 579.28,-126 679.92,-230"/>
<text text-anchor="middle" x="434" y="-192" font-family="Times,serif" font-size="10.00">SP GATHER</text>
<text text-anchor="middle" x="434" y="-181" font-family="Times,serif" font-size="10.00">Input: [batch=4, seq=5120, hidden=512]</text>
<text text-anchor="middle" x="434" y="-170" font-family="Times,serif" font-size="10.00">Output: [batch=4, seq=10240, hidden=512]</text>
<text text-anchor="middle" x="434" y="-159" font-family="Times,serif" font-size="10.00">GPU: 0&#45;15</text>
</g>
<!-- expert_all2all1&#45;&gt;sp_gather_1 -->
<g id="edge19" class="edge">
<title>expert_all2all1&#45;&gt;sp_gather_1</title>
<path fill="none" stroke="black" d="M434,-266.74C434,-258.36 434,-249.45 434,-240.63"/>
<polygon fill="black" stroke="black" points="437.5,-240.36 434,-230.36 430.5,-240.36 437.5,-240.36"/>
</g>
<!-- sp_split_2 -->
<g id="node20" class="node">
<title>sp_split_2</title>
<polygon fill="lightyellow" stroke="black" points="508.79,-60 389.81,-60 359.21,0 478.19,0 508.79,-60"/>
<text text-anchor="middle" x="434" y="-33" font-family="Times,serif" font-size="10.00">SP SPLIT</text>
<text text-anchor="middle" x="434" y="-22" font-family="Times,serif" font-size="10.00">GPU: 16&#45;31</text>
</g>
<!-- sp_gather_1&#45;&gt;sp_split_2 -->
<g id="edge20" class="edge">
<title>sp_gather_1&#45;&gt;sp_split_2</title>
<path fill="none" stroke="black" stroke-width="2" d="M434,-125.94C434,-107.69 434,-87.42 434,-70.31"/>
<polygon fill="black" stroke="black" stroke-width="2" points="437.5,-70.12 434,-60.12 430.5,-70.12 437.5,-70.12"/>
<text text-anchor="middle" x="472" y="-96.8" font-family="Times,serif" font-size="14.00">Pipeline</text>
<text text-anchor="middle" x="472" y="-81.8" font-family="Times,serif" font-size="14.00">Stage 1→2</text>
</g>
<!-- stage2_label -->
<g id="node19" class="node">
<title>stage2_label</title>
<polygon fill="purple" stroke="black" points="928.5,-1380.69 793.5,-1380.69 793.5,-1333.69 928.5,-1333.69 928.5,-1380.69"/>
<text text-anchor="middle" x="861" y="-1367.09" font-family="Times,serif" font-size="12.00">PIPELINE STAGE 2</text>
<text text-anchor="middle" x="861" y="-1354.09" font-family="Times,serif" font-size="12.00">Layers 5&#45;8</text>
<text text-anchor="middle" x="861" y="-1341.09" font-family="Times,serif" font-size="12.00">GPUs: 16&#45;31</text>
</g>
<!-- layernorm2 -->
<g id="node21" class="node">
<title>layernorm2</title>
<polygon fill="lightgreen" stroke="black" points="1019.5,-1375.19 946.5,-1375.19 946.5,-1339.19 1019.5,-1339.19 1019.5,-1375.19"/>
<text text-anchor="middle" x="983" y="-1360.19" font-family="Times,serif" font-size="10.00">LayerNorm</text>
<text text-anchor="middle" x="983" y="-1349.19" font-family="Times,serif" font-size="10.00">GPU: 16&#45;31</text>
</g>
<!-- attn_qkv2_1 -->
<g id="node22" class="node">
<title>attn_qkv2_1</title>
<polygon fill="lightgreen" stroke="black" points="1148.5,-1377.69 1037.5,-1377.69 1037.5,-1336.69 1148.5,-1336.69 1148.5,-1377.69"/>
<text text-anchor="middle" x="1093" y="-1365.69" font-family="Times,serif" font-size="10.00">Attention QKV Proj</text>
<text text-anchor="middle" x="1093" y="-1354.69" font-family="Times,serif" font-size="10.00">TP=2</text>
<text text-anchor="middle" x="1093" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 16&#45;23</text>
</g>
<!-- attn_qkv2_2 -->
<g id="node23" class="node">
<title>attn_qkv2_2</title>
<polygon fill="lightgreen" stroke="black" points="1277.5,-1377.69 1166.5,-1377.69 1166.5,-1336.69 1277.5,-1336.69 1277.5,-1377.69"/>
<text text-anchor="middle" x="1222" y="-1365.69" font-family="Times,serif" font-size="10.00">Attention QKV Proj</text>
<text text-anchor="middle" x="1222" y="-1354.69" font-family="Times,serif" font-size="10.00">TP=2</text>
<text text-anchor="middle" x="1222" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 24&#45;31</text>
</g>
<!-- attn_compute2_1 -->
<g id="node24" class="node">
<title>attn_compute2_1</title>
<polygon fill="lightgreen" stroke="black" points="1406.5,-1377.69 1295.5,-1377.69 1295.5,-1336.69 1406.5,-1336.69 1406.5,-1377.69"/>
<text text-anchor="middle" x="1351" y="-1365.69" font-family="Times,serif" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="1351" y="-1354.69" font-family="Times,serif" font-size="10.00">SP=2</text>
<text text-anchor="middle" x="1351" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 16&#45;23</text>
</g>
<!-- attn_compute2_2 -->
<g id="node25" class="node">
<title>attn_compute2_2</title>
<polygon fill="lightgreen" stroke="black" points="1535.5,-1377.69 1424.5,-1377.69 1424.5,-1336.69 1535.5,-1336.69 1535.5,-1377.69"/>
<text text-anchor="middle" x="1480" y="-1365.69" font-family="Times,serif" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="1480" y="-1354.69" font-family="Times,serif" font-size="10.00">SP=2</text>
<text text-anchor="middle" x="1480" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 24&#45;31</text>
</g>
<!-- attn_gather2 -->
<g id="node26" class="node">
<title>attn_gather2</title>
<ellipse fill="lightblue" stroke="black" cx="1609" cy="-1357.19" rx="55.31" ry="28.98"/>
<text text-anchor="middle" x="1609" y="-1365.69" font-family="Times,serif" font-size="10.00">All&#45;Gather</text>
<text text-anchor="middle" x="1609" y="-1354.69" font-family="Times,serif" font-size="10.00">TP Attention</text>
<text text-anchor="middle" x="1609" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 16&#45;31</text>
</g>
<!-- mlp_gate2 -->
<g id="node27" class="node">
<title>mlp_gate2</title>
<polygon fill="lightgreen" stroke="black" points="1754,-1375.19 1682,-1375.19 1682,-1339.19 1754,-1339.19 1754,-1375.19"/>
<text text-anchor="middle" x="1718" y="-1360.19" font-family="Times,serif" font-size="10.00">MLP Gate</text>
<text text-anchor="middle" x="1718" y="-1349.19" font-family="Times,serif" font-size="10.00">GPU: 16&#45;31</text>
</g>
<!-- expert_route2 -->
<g id="node28" class="node">
<title>expert_route2</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="1964.34,-1398.19 1811.09,-1398.19 1771.66,-1316.19 1924.91,-1316.19 1964.34,-1398.19"/>
<text text-anchor="middle" x="1868" y="-1365.69" font-family="Times,serif" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="1868" y="-1354.69" font-family="Times,serif" font-size="10.00">Top&#45;2 Selection</text>
<text text-anchor="middle" x="1868" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 16&#45;31</text>
</g>
<!-- expert2_1 -->
<g id="node29" class="node">
<title>expert2_1</title>
<polygon fill="lightgreen" stroke="black" points="2054,-1377.69 1982,-1377.69 1982,-1336.69 2054,-1336.69 2054,-1377.69"/>
<text text-anchor="middle" x="2018" y="-1365.69" font-family="Times,serif" font-size="10.00">Expert 0&#45;3</text>
<text text-anchor="middle" x="2018" y="-1354.69" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="2018" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 16&#45;19</text>
</g>
<!-- expert2_2 -->
<g id="node30" class="node">
<title>expert2_2</title>
<polygon fill="lightgreen" stroke="black" points="2144,-1377.69 2072,-1377.69 2072,-1336.69 2144,-1336.69 2144,-1377.69"/>
<text text-anchor="middle" x="2108" y="-1365.69" font-family="Times,serif" font-size="10.00">Expert 4&#45;7</text>
<text text-anchor="middle" x="2108" y="-1354.69" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="2108" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 20&#45;23</text>
</g>
<!-- expert2_3 -->
<g id="node31" class="node">
<title>expert2_3</title>
<polygon fill="lightgreen" stroke="black" points="2236,-1377.69 2162,-1377.69 2162,-1336.69 2236,-1336.69 2236,-1377.69"/>
<text text-anchor="middle" x="2199" y="-1365.69" font-family="Times,serif" font-size="10.00">Expert 8&#45;11</text>
<text text-anchor="middle" x="2199" y="-1354.69" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="2199" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 24&#45;27</text>
</g>
<!-- expert2_4 -->
<g id="node32" class="node">
<title>expert2_4</title>
<polygon fill="lightgreen" stroke="black" points="2334,-1377.69 2254,-1377.69 2254,-1336.69 2334,-1336.69 2334,-1377.69"/>
<text text-anchor="middle" x="2294" y="-1365.69" font-family="Times,serif" font-size="10.00">Expert 12&#45;15</text>
<text text-anchor="middle" x="2294" y="-1354.69" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="2294" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 28&#45;31</text>
</g>
<!-- expert_all2all2 -->
<g id="node33" class="node">
<title>expert_all2all2</title>
<ellipse fill="lightblue" stroke="black" cx="2434" cy="-1357.19" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="2434" y="-1365.69" font-family="Times,serif" font-size="10.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="2434" y="-1354.69" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2434" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 16&#45;31</text>
</g>
<!-- sp_gather_2 -->
<g id="node34" class="node">
<title>sp_gather_2</title>
<polygon fill="lightyellow" stroke="black" points="2693.66,-1387.19 2566.94,-1387.19 2534.34,-1327.19 2661.06,-1327.19 2693.66,-1387.19"/>
<text text-anchor="middle" x="2614" y="-1360.19" font-family="Times,serif" font-size="10.00">SP GATHER</text>
<text text-anchor="middle" x="2614" y="-1349.19" font-family="Times,serif" font-size="10.00">GPU: 16&#45;31</text>
</g>
<!-- sp_split_3 -->
<g id="node36" class="node">
<title>sp_split_3</title>
<polygon fill="lightyellow" stroke="black" points="2688.79,-1228.19 2569.81,-1228.19 2539.21,-1168.19 2658.19,-1168.19 2688.79,-1228.19"/>
<text text-anchor="middle" x="2614" y="-1201.19" font-family="Times,serif" font-size="10.00">SP SPLIT</text>
<text text-anchor="middle" x="2614" y="-1190.19" font-family="Times,serif" font-size="10.00">GPU: 32&#45;47</text>
</g>
<!-- sp_gather_2&#45;&gt;sp_split_3 -->
<g id="edge21" class="edge">
<title>sp_gather_2&#45;&gt;sp_split_3</title>
<path fill="none" stroke="black" stroke-width="2" d="M2614,-1327.03C2614,-1302.02 2614,-1265.79 2614,-1238.27"/>
<polygon fill="black" stroke="black" stroke-width="2" points="2617.5,-1238.2 2614,-1228.2 2610.5,-1238.2 2617.5,-1238.2"/>
<text text-anchor="middle" x="2652" y="-1286.99" font-family="Times,serif" font-size="14.00">Pipeline</text>
<text text-anchor="middle" x="2652" y="-1271.99" font-family="Times,serif" font-size="14.00">Stage 2→3</text>
</g>
<!-- stage3_label -->
<g id="node35" class="node">
<title>stage3_label</title>
<polygon fill="purple" stroke="black" points="2846.5,-1380.69 2711.5,-1380.69 2711.5,-1333.69 2846.5,-1333.69 2846.5,-1380.69"/>
<text text-anchor="middle" x="2779" y="-1367.09" font-family="Times,serif" font-size="12.00">PIPELINE STAGE 3</text>
<text text-anchor="middle" x="2779" y="-1354.09" font-family="Times,serif" font-size="12.00">Layers 9&#45;12</text>
<text text-anchor="middle" x="2779" y="-1341.09" font-family="Times,serif" font-size="12.00">GPUs: 32&#45;47</text>
</g>
<!-- layernorm3 -->
<g id="node37" class="node">
<title>layernorm3</title>
<polygon fill="lightgreen" stroke="black" points="2937.5,-1375.19 2864.5,-1375.19 2864.5,-1339.19 2937.5,-1339.19 2937.5,-1375.19"/>
<text text-anchor="middle" x="2901" y="-1360.19" font-family="Times,serif" font-size="10.00">LayerNorm</text>
<text text-anchor="middle" x="2901" y="-1349.19" font-family="Times,serif" font-size="10.00">GPU: 32&#45;47</text>
</g>
<!-- attn_qkv3_1 -->
<g id="node38" class="node">
<title>attn_qkv3_1</title>
<polygon fill="lightgreen" stroke="black" points="3066.5,-1377.69 2955.5,-1377.69 2955.5,-1336.69 3066.5,-1336.69 3066.5,-1377.69"/>
<text text-anchor="middle" x="3011" y="-1365.69" font-family="Times,serif" font-size="10.00">Attention QKV Proj</text>
<text text-anchor="middle" x="3011" y="-1354.69" font-family="Times,serif" font-size="10.00">TP=2</text>
<text text-anchor="middle" x="3011" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 32&#45;39</text>
</g>
<!-- attn_qkv3_2 -->
<g id="node39" class="node">
<title>attn_qkv3_2</title>
<polygon fill="lightgreen" stroke="black" points="3195.5,-1377.69 3084.5,-1377.69 3084.5,-1336.69 3195.5,-1336.69 3195.5,-1377.69"/>
<text text-anchor="middle" x="3140" y="-1365.69" font-family="Times,serif" font-size="10.00">Attention QKV Proj</text>
<text text-anchor="middle" x="3140" y="-1354.69" font-family="Times,serif" font-size="10.00">TP=2</text>
<text text-anchor="middle" x="3140" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 40&#45;47</text>
</g>
<!-- attn_compute3_1 -->
<g id="node40" class="node">
<title>attn_compute3_1</title>
<polygon fill="lightgreen" stroke="black" points="3324.5,-1377.69 3213.5,-1377.69 3213.5,-1336.69 3324.5,-1336.69 3324.5,-1377.69"/>
<text text-anchor="middle" x="3269" y="-1365.69" font-family="Times,serif" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="3269" y="-1354.69" font-family="Times,serif" font-size="10.00">SP=2</text>
<text text-anchor="middle" x="3269" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 32&#45;39</text>
</g>
<!-- attn_compute3_2 -->
<g id="node41" class="node">
<title>attn_compute3_2</title>
<polygon fill="lightgreen" stroke="black" points="3453.5,-1377.69 3342.5,-1377.69 3342.5,-1336.69 3453.5,-1336.69 3453.5,-1377.69"/>
<text text-anchor="middle" x="3398" y="-1365.69" font-family="Times,serif" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="3398" y="-1354.69" font-family="Times,serif" font-size="10.00">SP=2</text>
<text text-anchor="middle" x="3398" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 40&#45;47</text>
</g>
<!-- attn_gather3 -->
<g id="node42" class="node">
<title>attn_gather3</title>
<ellipse fill="lightblue" stroke="black" cx="3527" cy="-1357.19" rx="55.31" ry="28.98"/>
<text text-anchor="middle" x="3527" y="-1365.69" font-family="Times,serif" font-size="10.00">All&#45;Gather</text>
<text text-anchor="middle" x="3527" y="-1354.69" font-family="Times,serif" font-size="10.00">TP Attention</text>
<text text-anchor="middle" x="3527" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 32&#45;47</text>
</g>
<!-- mlp_gate3 -->
<g id="node43" class="node">
<title>mlp_gate3</title>
<polygon fill="lightgreen" stroke="black" points="3672,-1375.19 3600,-1375.19 3600,-1339.19 3672,-1339.19 3672,-1375.19"/>
<text text-anchor="middle" x="3636" y="-1360.19" font-family="Times,serif" font-size="10.00">MLP Gate</text>
<text text-anchor="middle" x="3636" y="-1349.19" font-family="Times,serif" font-size="10.00">GPU: 32&#45;47</text>
</g>
<!-- expert_route3 -->
<g id="node44" class="node">
<title>expert_route3</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="3882.34,-1398.19 3729.09,-1398.19 3689.66,-1316.19 3842.91,-1316.19 3882.34,-1398.19"/>
<text text-anchor="middle" x="3786" y="-1365.69" font-family="Times,serif" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="3786" y="-1354.69" font-family="Times,serif" font-size="10.00">Top&#45;2 Selection</text>
<text text-anchor="middle" x="3786" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 32&#45;47</text>
</g>
<!-- expert3_1 -->
<g id="node45" class="node">
<title>expert3_1</title>
<polygon fill="lightgreen" stroke="black" points="3972,-1377.69 3900,-1377.69 3900,-1336.69 3972,-1336.69 3972,-1377.69"/>
<text text-anchor="middle" x="3936" y="-1365.69" font-family="Times,serif" font-size="10.00">Expert 0&#45;3</text>
<text text-anchor="middle" x="3936" y="-1354.69" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="3936" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 32&#45;35</text>
</g>
<!-- expert3_2 -->
<g id="node46" class="node">
<title>expert3_2</title>
<polygon fill="lightgreen" stroke="black" points="4062,-1377.69 3990,-1377.69 3990,-1336.69 4062,-1336.69 4062,-1377.69"/>
<text text-anchor="middle" x="4026" y="-1365.69" font-family="Times,serif" font-size="10.00">Expert 4&#45;7</text>
<text text-anchor="middle" x="4026" y="-1354.69" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="4026" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 36&#45;39</text>
</g>
<!-- expert3_3 -->
<g id="node47" class="node">
<title>expert3_3</title>
<polygon fill="lightgreen" stroke="black" points="4154,-1377.69 4080,-1377.69 4080,-1336.69 4154,-1336.69 4154,-1377.69"/>
<text text-anchor="middle" x="4117" y="-1365.69" font-family="Times,serif" font-size="10.00">Expert 8&#45;11</text>
<text text-anchor="middle" x="4117" y="-1354.69" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="4117" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 40&#45;43</text>
</g>
<!-- expert3_4 -->
<g id="node48" class="node">
<title>expert3_4</title>
<polygon fill="lightgreen" stroke="black" points="4252,-1377.69 4172,-1377.69 4172,-1336.69 4252,-1336.69 4252,-1377.69"/>
<text text-anchor="middle" x="4212" y="-1365.69" font-family="Times,serif" font-size="10.00">Expert 12&#45;15</text>
<text text-anchor="middle" x="4212" y="-1354.69" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="4212" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 44&#45;47</text>
</g>
<!-- expert_all2all3 -->
<g id="node49" class="node">
<title>expert_all2all3</title>
<ellipse fill="lightblue" stroke="black" cx="4352" cy="-1357.19" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="4352" y="-1365.69" font-family="Times,serif" font-size="10.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="4352" y="-1354.69" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="4352" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 32&#45;47</text>
</g>
<!-- sp_gather_3 -->
<g id="node50" class="node">
<title>sp_gather_3</title>
<polygon fill="lightyellow" stroke="black" points="4611.66,-1387.19 4484.94,-1387.19 4452.34,-1327.19 4579.06,-1327.19 4611.66,-1387.19"/>
<text text-anchor="middle" x="4532" y="-1360.19" font-family="Times,serif" font-size="10.00">SP GATHER</text>
<text text-anchor="middle" x="4532" y="-1349.19" font-family="Times,serif" font-size="10.00">GPU: 32&#45;47</text>
</g>
<!-- sp_split_4 -->
<g id="node52" class="node">
<title>sp_split_4</title>
<polygon fill="lightyellow" stroke="black" points="4606.79,-1228.19 4487.81,-1228.19 4457.21,-1168.19 4576.19,-1168.19 4606.79,-1228.19"/>
<text text-anchor="middle" x="4532" y="-1201.19" font-family="Times,serif" font-size="10.00">SP SPLIT</text>
<text text-anchor="middle" x="4532" y="-1190.19" font-family="Times,serif" font-size="10.00">GPU: 48&#45;63</text>
</g>
<!-- sp_gather_3&#45;&gt;sp_split_4 -->
<g id="edge22" class="edge">
<title>sp_gather_3&#45;&gt;sp_split_4</title>
<path fill="none" stroke="black" stroke-width="2" d="M4532,-1327.03C4532,-1302.02 4532,-1265.79 4532,-1238.27"/>
<polygon fill="black" stroke="black" stroke-width="2" points="4535.5,-1238.2 4532,-1228.2 4528.5,-1238.2 4535.5,-1238.2"/>
<text text-anchor="middle" x="4570" y="-1286.99" font-family="Times,serif" font-size="14.00">Pipeline</text>
<text text-anchor="middle" x="4570" y="-1271.99" font-family="Times,serif" font-size="14.00">Stage 3→4</text>
</g>
<!-- stage4_label -->
<g id="node51" class="node">
<title>stage4_label</title>
<polygon fill="purple" stroke="black" points="4764.5,-1380.69 4629.5,-1380.69 4629.5,-1333.69 4764.5,-1333.69 4764.5,-1380.69"/>
<text text-anchor="middle" x="4697" y="-1367.09" font-family="Times,serif" font-size="12.00">PIPELINE STAGE 4</text>
<text text-anchor="middle" x="4697" y="-1354.09" font-family="Times,serif" font-size="12.00">Layers 13&#45;16</text>
<text text-anchor="middle" x="4697" y="-1341.09" font-family="Times,serif" font-size="12.00">GPUs: 48&#45;63</text>
</g>
<!-- layernorm4 -->
<g id="node53" class="node">
<title>layernorm4</title>
<polygon fill="lightgreen" stroke="black" points="4855.5,-1375.19 4782.5,-1375.19 4782.5,-1339.19 4855.5,-1339.19 4855.5,-1375.19"/>
<text text-anchor="middle" x="4819" y="-1360.19" font-family="Times,serif" font-size="10.00">LayerNorm</text>
<text text-anchor="middle" x="4819" y="-1349.19" font-family="Times,serif" font-size="10.00">GPU: 48&#45;63</text>
</g>
<!-- attn_qkv4_1 -->
<g id="node54" class="node">
<title>attn_qkv4_1</title>
<polygon fill="lightgreen" stroke="black" points="4984.5,-1377.69 4873.5,-1377.69 4873.5,-1336.69 4984.5,-1336.69 4984.5,-1377.69"/>
<text text-anchor="middle" x="4929" y="-1365.69" font-family="Times,serif" font-size="10.00">Attention QKV Proj</text>
<text text-anchor="middle" x="4929" y="-1354.69" font-family="Times,serif" font-size="10.00">TP=2</text>
<text text-anchor="middle" x="4929" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 48&#45;55</text>
</g>
<!-- attn_qkv4_2 -->
<g id="node55" class="node">
<title>attn_qkv4_2</title>
<polygon fill="lightgreen" stroke="black" points="5113.5,-1377.69 5002.5,-1377.69 5002.5,-1336.69 5113.5,-1336.69 5113.5,-1377.69"/>
<text text-anchor="middle" x="5058" y="-1365.69" font-family="Times,serif" font-size="10.00">Attention QKV Proj</text>
<text text-anchor="middle" x="5058" y="-1354.69" font-family="Times,serif" font-size="10.00">TP=2</text>
<text text-anchor="middle" x="5058" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 56&#45;63</text>
</g>
<!-- attn_compute4_1 -->
<g id="node56" class="node">
<title>attn_compute4_1</title>
<polygon fill="lightgreen" stroke="black" points="5242.5,-1377.69 5131.5,-1377.69 5131.5,-1336.69 5242.5,-1336.69 5242.5,-1377.69"/>
<text text-anchor="middle" x="5187" y="-1365.69" font-family="Times,serif" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="5187" y="-1354.69" font-family="Times,serif" font-size="10.00">SP=2</text>
<text text-anchor="middle" x="5187" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 48&#45;55</text>
</g>
<!-- attn_compute4_2 -->
<g id="node57" class="node">
<title>attn_compute4_2</title>
<polygon fill="lightgreen" stroke="black" points="5371.5,-1377.69 5260.5,-1377.69 5260.5,-1336.69 5371.5,-1336.69 5371.5,-1377.69"/>
<text text-anchor="middle" x="5316" y="-1365.69" font-family="Times,serif" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="5316" y="-1354.69" font-family="Times,serif" font-size="10.00">SP=2</text>
<text text-anchor="middle" x="5316" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 56&#45;63</text>
</g>
<!-- attn_gather4 -->
<g id="node58" class="node">
<title>attn_gather4</title>
<ellipse fill="lightblue" stroke="black" cx="5445" cy="-1357.19" rx="55.31" ry="28.98"/>
<text text-anchor="middle" x="5445" y="-1365.69" font-family="Times,serif" font-size="10.00">All&#45;Gather</text>
<text text-anchor="middle" x="5445" y="-1354.69" font-family="Times,serif" font-size="10.00">TP Attention</text>
<text text-anchor="middle" x="5445" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 48&#45;63</text>
</g>
<!-- mlp_gate4 -->
<g id="node59" class="node">
<title>mlp_gate4</title>
<polygon fill="lightgreen" stroke="black" points="5590,-1375.19 5518,-1375.19 5518,-1339.19 5590,-1339.19 5590,-1375.19"/>
<text text-anchor="middle" x="5554" y="-1360.19" font-family="Times,serif" font-size="10.00">MLP Gate</text>
<text text-anchor="middle" x="5554" y="-1349.19" font-family="Times,serif" font-size="10.00">GPU: 48&#45;63</text>
</g>
<!-- expert_route4 -->
<g id="node60" class="node">
<title>expert_route4</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="5800.34,-1398.19 5647.09,-1398.19 5607.66,-1316.19 5760.91,-1316.19 5800.34,-1398.19"/>
<text text-anchor="middle" x="5704" y="-1365.69" font-family="Times,serif" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="5704" y="-1354.69" font-family="Times,serif" font-size="10.00">Top&#45;2 Selection</text>
<text text-anchor="middle" x="5704" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 48&#45;63</text>
</g>
<!-- expert4_1 -->
<g id="node61" class="node">
<title>expert4_1</title>
<polygon fill="lightgreen" stroke="black" points="5890,-1377.69 5818,-1377.69 5818,-1336.69 5890,-1336.69 5890,-1377.69"/>
<text text-anchor="middle" x="5854" y="-1365.69" font-family="Times,serif" font-size="10.00">Expert 0&#45;3</text>
<text text-anchor="middle" x="5854" y="-1354.69" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="5854" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 48&#45;51</text>
</g>
<!-- expert4_2 -->
<g id="node62" class="node">
<title>expert4_2</title>
<polygon fill="lightgreen" stroke="black" points="5980,-1377.69 5908,-1377.69 5908,-1336.69 5980,-1336.69 5980,-1377.69"/>
<text text-anchor="middle" x="5944" y="-1365.69" font-family="Times,serif" font-size="10.00">Expert 4&#45;7</text>
<text text-anchor="middle" x="5944" y="-1354.69" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="5944" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 52&#45;55</text>
</g>
<!-- expert4_3 -->
<g id="node63" class="node">
<title>expert4_3</title>
<polygon fill="lightgreen" stroke="black" points="6072,-1377.69 5998,-1377.69 5998,-1336.69 6072,-1336.69 6072,-1377.69"/>
<text text-anchor="middle" x="6035" y="-1365.69" font-family="Times,serif" font-size="10.00">Expert 8&#45;11</text>
<text text-anchor="middle" x="6035" y="-1354.69" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="6035" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 56&#45;59</text>
</g>
<!-- expert4_4 -->
<g id="node64" class="node">
<title>expert4_4</title>
<polygon fill="lightgreen" stroke="black" points="6170,-1377.69 6090,-1377.69 6090,-1336.69 6170,-1336.69 6170,-1377.69"/>
<text text-anchor="middle" x="6130" y="-1365.69" font-family="Times,serif" font-size="10.00">Expert 12&#45;15</text>
<text text-anchor="middle" x="6130" y="-1354.69" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="6130" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 60&#45;63</text>
</g>
<!-- expert_all2all4 -->
<g id="node65" class="node">
<title>expert_all2all4</title>
<ellipse fill="lightblue" stroke="black" cx="6270" cy="-1357.19" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="6270" y="-1365.69" font-family="Times,serif" font-size="10.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="6270" y="-1354.69" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="6270" y="-1343.69" font-family="Times,serif" font-size="10.00">GPU: 48&#45;63</text>
</g>
<!-- sp_gather_4 -->
<g id="node66" class="node">
<title>sp_gather_4</title>
<polygon fill="lightyellow" stroke="black" points="6529.66,-1387.19 6402.94,-1387.19 6370.34,-1327.19 6497.06,-1327.19 6529.66,-1387.19"/>
<text text-anchor="middle" x="6450" y="-1360.19" font-family="Times,serif" font-size="10.00">SP GATHER</text>
<text text-anchor="middle" x="6450" y="-1349.19" font-family="Times,serif" font-size="10.00">GPU: 48&#45;63</text>
</g>
<!-- final_output -->
<g id="node67" class="node">
<title>final_output</title>
<ellipse fill="white" stroke="black" stroke-width="3" cx="6450" cy="-1198.19" rx="167.67" ry="28.98"/>
<text text-anchor="middle" x="6450" y="-1206.69" font-family="Times,serif" font-size="10.00">FINAL OUTPUT</text>
<text text-anchor="middle" x="6450" y="-1195.69" font-family="Times,serif" font-size="10.00">Input: [batch=4, seq=10240, hidden=512]</text>
<text text-anchor="middle" x="6450" y="-1184.69" font-family="Times,serif" font-size="10.00">Output: [batch=4, seq=10240, hidden=512]</text>
</g>
<!-- sp_gather_4&#45;&gt;final_output -->
<g id="edge23" class="edge">
<title>sp_gather_4&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M6450,-1327.03C6450,-1301.79 6450,-1265.1 6450,-1237.5"/>
<polygon fill="black" stroke="black" points="6453.5,-1237.4 6450,-1227.4 6446.5,-1237.4 6453.5,-1237.4"/>
</g>
<!-- decode_start -->
<g id="node68" class="node">
<title>decode_start</title>
<polygon fill="red" stroke="black" points="6752,-1383.69 6548,-1383.69 6548,-1330.69 6752,-1330.69 6752,-1383.69"/>
<text text-anchor="middle" x="6650" y="-1368.49" font-family="Times,serif" font-size="14.00">DECODE PHASE</text>
<text text-anchor="middle" x="6650" y="-1353.49" font-family="Times,serif" font-size="14.00">PP=4, EP=4, TP=2, SP=1</text>
<text text-anchor="middle" x="6650" y="-1338.49" font-family="Times,serif" font-size="14.00">32 GPUs Total</text>
</g>
<!-- decode_input -->
<g id="node69" class="node">
<title>decode_input</title>
<ellipse fill="pink" stroke="black" stroke-width="3" cx="6921" cy="-1357.19" rx="150.73" ry="36.54"/>
<text text-anchor="middle" x="6921" y="-1371.19" font-family="Times,serif" font-size="10.00">DECODE INPUT</text>
<text text-anchor="middle" x="6921" y="-1360.19" font-family="Times,serif" font-size="10.00">Single Token</text>
<text text-anchor="middle" x="6921" y="-1349.19" font-family="Times,serif" font-size="10.00">Input: [batch=4, seq=1, hidden=512]</text>
<text text-anchor="middle" x="6921" y="-1338.19" font-family="Times,serif" font-size="10.00">Output: [batch=4, seq=1, hidden=512]</text>
</g>
<!-- decode_layernorm1 -->
<g id="node71" class="node">
<title>decode_layernorm1</title>
<polygon fill="lightgreen" stroke="black" points="7027.5,-1224.19 6814.5,-1224.19 6814.5,-1172.19 7027.5,-1172.19 7027.5,-1224.19"/>
<text text-anchor="middle" x="6921" y="-1212.19" font-family="Times,serif" font-size="10.00">LayerNorm</text>
<text text-anchor="middle" x="6921" y="-1201.19" font-family="Times,serif" font-size="10.00">Input: [batch=4, seq=1, hidden=512]</text>
<text text-anchor="middle" x="6921" y="-1190.19" font-family="Times,serif" font-size="10.00">Output: [batch=4, seq=1, hidden=512]</text>
<text text-anchor="middle" x="6921" y="-1179.19" font-family="Times,serif" font-size="10.00">GPU: 0&#45;15</text>
</g>
<!-- decode_input&#45;&gt;decode_layernorm1 -->
<g id="edge24" class="edge">
<title>decode_input&#45;&gt;decode_layernorm1</title>
<path fill="none" stroke="black" d="M6921,-1320.17C6921,-1294.39 6921,-1259.86 6921,-1234.29"/>
<polygon fill="black" stroke="black" points="6924.5,-1234.28 6921,-1224.28 6917.5,-1234.28 6924.5,-1234.28"/>
</g>
<!-- decode_stage1 -->
<g id="node70" class="node">
<title>decode_stage1</title>
<polygon fill="purple" stroke="black" points="7218.5,-1380.69 7089.5,-1380.69 7089.5,-1333.69 7218.5,-1333.69 7218.5,-1380.69"/>
<text text-anchor="middle" x="7154" y="-1367.09" font-family="Times,serif" font-size="12.00">DECODE STAGE 1</text>
<text text-anchor="middle" x="7154" y="-1354.09" font-family="Times,serif" font-size="12.00">Layers 1&#45;4</text>
<text text-anchor="middle" x="7154" y="-1341.09" font-family="Times,serif" font-size="12.00">GPUs: 0&#45;15</text>
</g>
<!-- decode_attn_qkv1_1 -->
<g id="node72" class="node">
<title>decode_attn_qkv1_1</title>
<polygon fill="lightgreen" stroke="black" points="6937.5,-1103.69 6826.5,-1103.69 6826.5,-1062.69 6937.5,-1062.69 6937.5,-1103.69"/>
<text text-anchor="middle" x="6882" y="-1091.69" font-family="Times,serif" font-size="10.00">Attention QKV Proj</text>
<text text-anchor="middle" x="6882" y="-1080.69" font-family="Times,serif" font-size="10.00">TP=2</text>
<text text-anchor="middle" x="6882" y="-1069.69" font-family="Times,serif" font-size="10.00">GPU: 0&#45;7</text>
</g>
<!-- decode_layernorm1&#45;&gt;decode_attn_qkv1_1 -->
<g id="edge25" class="edge">
<title>decode_layernorm1&#45;&gt;decode_attn_qkv1_1</title>
<path fill="none" stroke="black" d="M6912.34,-1172.11C6906.36,-1154.78 6898.38,-1131.65 6892.11,-1113.47"/>
<polygon fill="black" stroke="black" points="6895.39,-1112.26 6888.82,-1103.95 6888.77,-1114.54 6895.39,-1112.26"/>
</g>
<!-- decode_attn_qkv1_2 -->
<g id="node73" class="node">
<title>decode_attn_qkv1_2</title>
<polygon fill="lightgreen" stroke="black" points="7066.5,-1103.69 6955.5,-1103.69 6955.5,-1062.69 7066.5,-1062.69 7066.5,-1103.69"/>
<text text-anchor="middle" x="7011" y="-1091.69" font-family="Times,serif" font-size="10.00">Attention QKV Proj</text>
<text text-anchor="middle" x="7011" y="-1080.69" font-family="Times,serif" font-size="10.00">TP=2</text>
<text text-anchor="middle" x="7011" y="-1069.69" font-family="Times,serif" font-size="10.00">GPU: 8&#45;15</text>
</g>
<!-- decode_layernorm1&#45;&gt;decode_attn_qkv1_2 -->
<g id="edge26" class="edge">
<title>decode_layernorm1&#45;&gt;decode_attn_qkv1_2</title>
<path fill="none" stroke="black" d="M6940.97,-1172.11C6955.17,-1154.29 6974.23,-1130.36 6988.88,-1111.97"/>
<polygon fill="black" stroke="black" points="6991.77,-1113.95 6995.27,-1103.95 6986.3,-1109.59 6991.77,-1113.95"/>
</g>
<!-- decode_attn1_1 -->
<g id="node74" class="node">
<title>decode_attn1_1</title>
<polygon fill="lightgreen" stroke="black" points="6937.5,-1009.19 6826.5,-1009.19 6826.5,-968.19 6937.5,-968.19 6937.5,-1009.19"/>
<text text-anchor="middle" x="6882" y="-997.19" font-family="Times,serif" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="6882" y="-986.19" font-family="Times,serif" font-size="10.00">No SP</text>
<text text-anchor="middle" x="6882" y="-975.19" font-family="Times,serif" font-size="10.00">GPU: 0&#45;7</text>
</g>
<!-- decode_attn_qkv1_1&#45;&gt;decode_attn1_1 -->
<g id="edge27" class="edge">
<title>decode_attn_qkv1_1&#45;&gt;decode_attn1_1</title>
<path fill="none" stroke="black" d="M6882,-1062.57C6882,-1050.07 6882,-1033.61 6882,-1019.51"/>
<polygon fill="black" stroke="black" points="6885.5,-1019.28 6882,-1009.28 6878.5,-1019.28 6885.5,-1019.28"/>
</g>
<!-- decode_attn1_2 -->
<g id="node75" class="node">
<title>decode_attn1_2</title>
<polygon fill="lightgreen" stroke="black" points="7066.5,-1009.19 6955.5,-1009.19 6955.5,-968.19 7066.5,-968.19 7066.5,-1009.19"/>
<text text-anchor="middle" x="7011" y="-997.19" font-family="Times,serif" font-size="10.00">Attention Compute</text>
<text text-anchor="middle" x="7011" y="-986.19" font-family="Times,serif" font-size="10.00">No SP</text>
<text text-anchor="middle" x="7011" y="-975.19" font-family="Times,serif" font-size="10.00">GPU: 8&#45;15</text>
</g>
<!-- decode_attn_qkv1_2&#45;&gt;decode_attn1_2 -->
<g id="edge28" class="edge">
<title>decode_attn_qkv1_2&#45;&gt;decode_attn1_2</title>
<path fill="none" stroke="black" d="M7011,-1062.57C7011,-1050.07 7011,-1033.61 7011,-1019.51"/>
<polygon fill="black" stroke="black" points="7014.5,-1019.28 7011,-1009.28 7007.5,-1019.28 7014.5,-1019.28"/>
</g>
<!-- decode_attn_gather1 -->
<g id="node76" class="node">
<title>decode_attn_gather1</title>
<ellipse fill="lightblue" stroke="black" cx="6946" cy="-888.69" rx="55.31" ry="28.98"/>
<text text-anchor="middle" x="6946" y="-897.19" font-family="Times,serif" font-size="10.00">All&#45;Gather</text>
<text text-anchor="middle" x="6946" y="-886.19" font-family="Times,serif" font-size="10.00">TP Attention</text>
<text text-anchor="middle" x="6946" y="-875.19" font-family="Times,serif" font-size="10.00">GPU: 0&#45;15</text>
</g>
<!-- decode_attn1_1&#45;&gt;decode_attn_gather1 -->
<g id="edge29" class="edge">
<title>decode_attn1_1&#45;&gt;decode_attn_gather1</title>
<path fill="none" stroke="black" d="M6894.95,-967.86C6902.94,-955.63 6913.41,-939.59 6922.79,-925.23"/>
<polygon fill="black" stroke="black" points="6925.92,-926.84 6928.46,-916.55 6920.06,-923.01 6925.92,-926.84"/>
</g>
<!-- decode_attn1_2&#45;&gt;decode_attn_gather1 -->
<g id="edge30" class="edge">
<title>decode_attn1_2&#45;&gt;decode_attn_gather1</title>
<path fill="none" stroke="black" d="M6997.85,-967.86C6989.67,-955.54 6978.94,-939.35 6969.36,-924.9"/>
<polygon fill="black" stroke="black" points="6972.02,-922.58 6963.57,-916.18 6966.18,-926.45 6972.02,-922.58"/>
</g>
<!-- decode_mlp_gate1 -->
<g id="node77" class="node">
<title>decode_mlp_gate1</title>
<polygon fill="lightgreen" stroke="black" points="6979,-793.64 6913,-793.64 6913,-757.64 6979,-757.64 6979,-793.64"/>
<text text-anchor="middle" x="6946" y="-778.64" font-family="Times,serif" font-size="10.00">MLP Gate</text>
<text text-anchor="middle" x="6946" y="-767.64" font-family="Times,serif" font-size="10.00">GPU: 0&#45;15</text>
</g>
<!-- decode_attn_gather1&#45;&gt;decode_mlp_gate1 -->
<g id="edge31" class="edge">
<title>decode_attn_gather1&#45;&gt;decode_mlp_gate1</title>
<path fill="none" stroke="black" d="M6946,-859.67C6946,-842.7 6946,-821.14 6946,-804.24"/>
<polygon fill="black" stroke="black" points="6949.5,-803.91 6946,-793.91 6942.5,-803.91 6949.5,-803.91"/>
</g>
<!-- decode_expert_route1 -->
<g id="node78" class="node">
<title>decode_expert_route1</title>
<polygon fill="orange" stroke="black" stroke-dasharray="5,2" points="7042.34,-694.1 6889.09,-694.1 6849.66,-612.1 7002.91,-612.1 7042.34,-694.1"/>
<text text-anchor="middle" x="6946" y="-661.6" font-family="Times,serif" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="6946" y="-650.6" font-family="Times,serif" font-size="10.00">Top&#45;2 Selection</text>
<text text-anchor="middle" x="6946" y="-639.6" font-family="Times,serif" font-size="10.00">GPU: 0&#45;15</text>
</g>
<!-- decode_mlp_gate1&#45;&gt;decode_expert_route1 -->
<g id="edge32" class="edge">
<title>decode_mlp_gate1&#45;&gt;decode_expert_route1</title>
<path fill="none" stroke="black" d="M6946,-757.63C6946,-743.71 6946,-723.29 6946,-704.25"/>
<polygon fill="black" stroke="black" points="6949.5,-704.17 6946,-694.17 6942.5,-704.17 6949.5,-704.17"/>
</g>
<!-- decode_expert1_1 -->
<g id="node79" class="node">
<title>decode_expert1_1</title>
<polygon fill="lightgreen" stroke="black" points="6850,-554.6 6782,-554.6 6782,-513.6 6850,-513.6 6850,-554.6"/>
<text text-anchor="middle" x="6816" y="-542.6" font-family="Times,serif" font-size="10.00">Expert 0&#45;3</text>
<text text-anchor="middle" x="6816" y="-531.6" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="6816" y="-520.6" font-family="Times,serif" font-size="10.00">GPU: 0&#45;3</text>
</g>
<!-- decode_expert_route1&#45;&gt;decode_expert1_1 -->
<g id="edge33" class="edge">
<title>decode_expert_route1&#45;&gt;decode_expert1_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6900.21,-611.94C6886.86,-600.14 6872.29,-587.16 6859,-575.1 6854.24,-570.78 6849.22,-566.16 6844.36,-561.66"/>
<polygon fill="black" stroke="black" points="6846.61,-558.97 6836.9,-554.73 6841.84,-564.1 6846.61,-558.97"/>
</g>
<!-- decode_expert1_2 -->
<g id="node80" class="node">
<title>decode_expert1_2</title>
<polygon fill="lightgreen" stroke="black" points="6936,-554.6 6868,-554.6 6868,-513.6 6936,-513.6 6936,-554.6"/>
<text text-anchor="middle" x="6902" y="-542.6" font-family="Times,serif" font-size="10.00">Expert 4&#45;7</text>
<text text-anchor="middle" x="6902" y="-531.6" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="6902" y="-520.6" font-family="Times,serif" font-size="10.00">GPU: 4&#45;7</text>
</g>
<!-- decode_expert_route1&#45;&gt;decode_expert1_2 -->
<g id="edge34" class="edge">
<title>decode_expert_route1&#45;&gt;decode_expert1_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6930.86,-611.83C6924.96,-596.15 6918.33,-578.52 6912.92,-564.12"/>
<polygon fill="black" stroke="black" points="6916.18,-562.86 6909.38,-554.73 6909.63,-565.32 6916.18,-562.86"/>
</g>
<!-- decode_expert1_3 -->
<g id="node81" class="node">
<title>decode_expert1_3</title>
<polygon fill="lightgreen" stroke="black" points="7028,-554.6 6954,-554.6 6954,-513.6 7028,-513.6 7028,-554.6"/>
<text text-anchor="middle" x="6991" y="-542.6" font-family="Times,serif" font-size="10.00">Expert 8&#45;11</text>
<text text-anchor="middle" x="6991" y="-531.6" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="6991" y="-520.6" font-family="Times,serif" font-size="10.00">GPU: 8&#45;11</text>
</g>
<!-- decode_expert_route1&#45;&gt;decode_expert1_3 -->
<g id="edge35" class="edge">
<title>decode_expert_route1&#45;&gt;decode_expert1_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6961.49,-611.83C6967.52,-596.15 6974.3,-578.52 6979.84,-564.12"/>
<polygon fill="black" stroke="black" points="6983.12,-565.32 6983.45,-554.73 6976.59,-562.81 6983.12,-565.32"/>
</g>
<!-- decode_expert1_4 -->
<g id="node82" class="node">
<title>decode_expert1_4</title>
<polygon fill="lightgreen" stroke="black" points="7126,-554.6 7046,-554.6 7046,-513.6 7126,-513.6 7126,-554.6"/>
<text text-anchor="middle" x="7086" y="-542.6" font-family="Times,serif" font-size="10.00">Expert 12&#45;15</text>
<text text-anchor="middle" x="7086" y="-531.6" font-family="Times,serif" font-size="10.00">EP=4</text>
<text text-anchor="middle" x="7086" y="-520.6" font-family="Times,serif" font-size="10.00">GPU: 12&#45;15</text>
</g>
<!-- decode_expert_route1&#45;&gt;decode_expert1_4 -->
<g id="edge36" class="edge">
<title>decode_expert_route1&#45;&gt;decode_expert1_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6994.18,-611.83C7014.21,-595.09 7036.89,-576.14 7054.69,-561.26"/>
<polygon fill="black" stroke="black" points="7057.07,-563.83 7062.5,-554.73 7052.59,-558.46 7057.07,-563.83"/>
</g>
<!-- decode_expert_all2all1 -->
<g id="node83" class="node">
<title>decode_expert_all2all1</title>
<ellipse fill="lightblue" stroke="black" cx="6939" cy="-424.6" rx="82.05" ry="28.98"/>
<text text-anchor="middle" x="6939" y="-433.1" font-family="Times,serif" font-size="10.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="6939" y="-422.1" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="6939" y="-411.1" font-family="Times,serif" font-size="10.00">GPU: 0&#45;15</text>
</g>
<!-- decode_expert1_1&#45;&gt;decode_expert_all2all1 -->
<g id="edge37" class="edge">
<title>decode_expert1_1&#45;&gt;decode_expert_all2all1</title>
<path fill="none" stroke="black" d="M6836.81,-513.36C6843.8,-506.83 6851.67,-499.59 6859,-493.1 6872.07,-481.52 6886.59,-469.13 6899.64,-458.16"/>
<polygon fill="black" stroke="black" points="6902.13,-460.64 6907.55,-451.53 6897.63,-455.27 6902.13,-460.64"/>
</g>
<!-- decode_expert1_2&#45;&gt;decode_expert_all2all1 -->
<g id="edge38" class="edge">
<title>decode_expert1_2&#45;&gt;decode_expert_all2all1</title>
<path fill="none" stroke="black" d="M6908.79,-513.38C6913.6,-499.39 6920.21,-480.19 6926.02,-463.31"/>
<polygon fill="black" stroke="black" points="6929.38,-464.29 6929.33,-453.69 6922.77,-462.01 6929.38,-464.29"/>
</g>
<!-- decode_expert1_3&#45;&gt;decode_expert_all2all1 -->
<g id="edge39" class="edge">
<title>decode_expert1_3&#45;&gt;decode_expert_all2all1</title>
<path fill="none" stroke="black" d="M6981.46,-513.38C6974.58,-499.16 6965.1,-479.55 6956.83,-462.46"/>
<polygon fill="black" stroke="black" points="6959.9,-460.76 6952.39,-453.28 6953.6,-463.81 6959.9,-460.76"/>
</g>
<!-- decode_expert1_4&#45;&gt;decode_expert_all2all1 -->
<g id="edge40" class="edge">
<title>decode_expert1_4&#45;&gt;decode_expert_all2all1</title>
<path fill="none" stroke="black" d="M7062.88,-513.58C7054.81,-506.93 7045.61,-499.56 7037,-493.1 7020.4,-480.63 7001.73,-467.55 6985.18,-456.26"/>
<polygon fill="black" stroke="black" points="6986.97,-453.25 6976.73,-450.53 6983.04,-459.05 6986.97,-453.25"/>
</g>
<!-- decode_output1 -->
<g id="node84" class="node">
<title>decode_output1</title>
<ellipse fill="lightcyan" stroke="black" cx="6939" cy="-311.55" rx="76.24" ry="21.43"/>
<text text-anchor="middle" x="6939" y="-314.55" font-family="Times,serif" font-size="10.00">STAGE 1 OUTPUT</text>
<text text-anchor="middle" x="6939" y="-303.55" font-family="Times,serif" font-size="10.00">GPU: 0&#45;15</text>
</g>
<!-- decode_expert_all2all1&#45;&gt;decode_output1 -->
<g id="edge41" class="edge">
<title>decode_expert_all2all1&#45;&gt;decode_output1</title>
<path fill="none" stroke="black" d="M6939,-395.57C6939,-379.55 6939,-359.44 6939,-343.02"/>
<polygon fill="black" stroke="black" points="6942.5,-342.85 6939,-332.85 6935.5,-342.85 6942.5,-342.85"/>
</g>
</g>
</svg>
