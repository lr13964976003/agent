<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="6490pt" height="5740pt"
 viewBox="0.00 0.00 1557.65 1377.72" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(4.17 4.17) rotate(0) translate(4 1373.72)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1373.72 1553.65,-1373.72 1553.65,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="white" stroke="black" stroke-width="3" cx="460.82" cy="-1332.24" rx="172.57" ry="28.07"/>
<text text-anchor="middle" x="460.82" y="-1335.64" font-family="Times,serif" font-size="12.00">INPUT</text>
<text text-anchor="middle" x="460.82" y="-1322.64" font-family="Times,serif" font-size="12.00">[batch=4, seq=10240, hidden=512]</text>
</g>
<!-- prefill_stage1 -->
<g id="node3" class="node">
<title>prefill_stage1</title>
<polygon fill="lightgreen" stroke="black" points="535.32,-1257.77 386.32,-1257.77 386.32,-1191.77 535.32,-1191.77 535.32,-1257.77"/>
<text text-anchor="middle" x="460.82" y="-1241.17" font-family="Times,serif" font-size="12.00">PIPELINE STAGE 1</text>
<text text-anchor="middle" x="460.82" y="-1228.17" font-family="Times,serif" font-size="12.00">Layers 1&#45;4</text>
<text text-anchor="middle" x="460.82" y="-1215.17" font-family="Times,serif" font-size="12.00">GPUs 0&#45;15</text>
<text text-anchor="middle" x="460.82" y="-1202.17" font-family="Times,serif" font-size="12.00">Attention + MoE</text>
</g>
<!-- input&#45;&gt;prefill_stage1 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;prefill_stage1</title>
<path fill="none" stroke="black" d="M460.82,-1303.81C460.82,-1292.95 460.82,-1280.21 460.82,-1268.22"/>
<polygon fill="black" stroke="black" points="464.32,-1267.93 460.82,-1257.93 457.32,-1267.93 464.32,-1267.93"/>
</g>
<!-- prefill_start -->
<g id="node2" class="node">
<title>prefill_start</title>
<polygon fill="red" stroke="black" points="869.82,-1361.74 651.82,-1361.74 651.82,-1302.74 869.82,-1302.74 869.82,-1361.74"/>
<text text-anchor="middle" x="760.82" y="-1343.54" font-family="Times,serif" font-size="14.00">PREFILL PHASE</text>
<text text-anchor="middle" x="760.82" y="-1328.54" font-family="Times,serif" font-size="14.00">PP=4, EP=4, TP=2, SP=2</text>
<text text-anchor="middle" x="760.82" y="-1313.54" font-family="Times,serif" font-size="14.00">64 GPUs</text>
</g>
<!-- sp_comm -->
<g id="node7" class="node">
<title>sp_comm</title>
<ellipse fill="lightblue" stroke="black" cx="460.82" cy="-1117.29" rx="101.65" ry="37.45"/>
<text text-anchor="middle" x="460.82" y="-1127.19" font-family="Times,serif" font-size="12.00">SP Communication</text>
<text text-anchor="middle" x="460.82" y="-1114.19" font-family="Times,serif" font-size="12.00">All&#45;Gather/Split</text>
<text text-anchor="middle" x="460.82" y="-1101.19" font-family="Times,serif" font-size="12.00">Across 64 GPUs</text>
</g>
<!-- prefill_stage1&#45;&gt;sp_comm -->
<g id="edge2" class="edge">
<title>prefill_stage1&#45;&gt;sp_comm</title>
<path fill="none" stroke="black" d="M460.82,-1191.55C460.82,-1183.27 460.82,-1174.2 460.82,-1165.35"/>
<polygon fill="black" stroke="black" points="464.32,-1165.11 460.82,-1155.11 457.32,-1165.11 464.32,-1165.11"/>
</g>
<!-- tp_comm -->
<g id="node8" class="node">
<title>tp_comm</title>
<ellipse fill="lightblue" stroke="black" cx="114.82" cy="-687.38" rx="101.65" ry="37.45"/>
<text text-anchor="middle" x="114.82" y="-697.28" font-family="Times,serif" font-size="12.00">TP Communication</text>
<text text-anchor="middle" x="114.82" y="-684.28" font-family="Times,serif" font-size="12.00">All&#45;Gather</text>
<text text-anchor="middle" x="114.82" y="-671.28" font-family="Times,serif" font-size="12.00">Across TP pairs</text>
</g>
<!-- prefill_stage1&#45;&gt;tp_comm -->
<g id="edge9" class="edge">
<title>prefill_stage1&#45;&gt;tp_comm</title>
<path fill="none" stroke="black" d="M386.13,-1212C300.43,-1195.78 171.82,-1163.35 171.82,-1118.29 171.82,-1118.29 171.82,-1118.29 171.82,-793.86 171.82,-771.4 160.93,-749.78 148.6,-732.03"/>
<polygon fill="black" stroke="black" points="151.2,-729.65 142.48,-723.64 145.55,-733.78 151.2,-729.65"/>
</g>
<!-- ep_comm -->
<g id="node9" class="node">
<title>ep_comm</title>
<ellipse fill="lightblue" stroke="black" cx="498.82" cy="-902.34" rx="102.56" ry="37.45"/>
<text text-anchor="middle" x="498.82" y="-912.24" font-family="Times,serif" font-size="12.00">EP Communication</text>
<text text-anchor="middle" x="498.82" y="-899.24" font-family="Times,serif" font-size="12.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="498.82" y="-886.24" font-family="Times,serif" font-size="12.00">Expert routing</text>
</g>
<!-- prefill_stage1&#45;&gt;ep_comm -->
<g id="edge11" class="edge">
<title>prefill_stage1&#45;&gt;ep_comm</title>
<path fill="none" stroke="black" d="M527.09,-1191.76C541.26,-1182.04 554.45,-1169.84 562.82,-1154.77 599.98,-1087.92 556.75,-1000.32 525.32,-948.13"/>
<polygon fill="black" stroke="black" points="528.2,-946.14 520,-939.44 522.23,-949.8 528.2,-946.14"/>
</g>
<!-- prefill_stage2 -->
<g id="node4" class="node">
<title>prefill_stage2</title>
<polygon fill="lightgreen" stroke="black" points="535.32,-1042.81 386.32,-1042.81 386.32,-976.81 535.32,-976.81 535.32,-1042.81"/>
<text text-anchor="middle" x="460.82" y="-1026.21" font-family="Times,serif" font-size="12.00">PIPELINE STAGE 2</text>
<text text-anchor="middle" x="460.82" y="-1013.21" font-family="Times,serif" font-size="12.00">Layers 5&#45;8</text>
<text text-anchor="middle" x="460.82" y="-1000.21" font-family="Times,serif" font-size="12.00">GPUs 16&#45;31</text>
<text text-anchor="middle" x="460.82" y="-987.21" font-family="Times,serif" font-size="12.00">Attention + MoE</text>
</g>
<!-- prefill_stage2&#45;&gt;sp_comm -->
<g id="edge4" class="edge">
<title>prefill_stage2&#45;&gt;sp_comm</title>
<path fill="none" stroke="black" d="M467.1,-1043.12C467.5,-1051.43 467.65,-1060.54 467.54,-1069.43"/>
<polygon fill="black" stroke="black" points="464.03,-1069.61 467.28,-1079.7 471.03,-1069.78 464.03,-1069.61"/>
</g>
<!-- prefill_stage2&#45;&gt;tp_comm -->
<g id="edge13" class="edge">
<title>prefill_stage2&#45;&gt;tp_comm</title>
<path fill="none" stroke="black" d="M416.85,-976.68C403.96,-965.23 390.11,-952.12 377.82,-939.81 293.41,-855.25 287.31,-818.52 194.82,-742.86 187.72,-737.05 179.94,-731.4 172.1,-726.08"/>
<polygon fill="black" stroke="black" points="173.87,-723.06 163.6,-720.45 170,-728.89 173.87,-723.06"/>
</g>
<!-- prefill_stage2&#45;&gt;ep_comm -->
<g id="edge15" class="edge">
<title>prefill_stage2&#45;&gt;ep_comm</title>
<path fill="none" stroke="black" d="M466.16,-976.59C468.87,-967.87 472.2,-958.26 475.69,-948.95"/>
<polygon fill="black" stroke="black" points="479.04,-950 479.39,-939.41 472.51,-947.47 479.04,-950"/>
</g>
<!-- prefill_stage3 -->
<g id="node5" class="node">
<title>prefill_stage3</title>
<polygon fill="lightgreen" stroke="black" points="691.32,-594.43 542.32,-594.43 542.32,-528.43 691.32,-528.43 691.32,-594.43"/>
<text text-anchor="middle" x="616.82" y="-577.83" font-family="Times,serif" font-size="12.00">PIPELINE STAGE 3</text>
<text text-anchor="middle" x="616.82" y="-564.83" font-family="Times,serif" font-size="12.00">Layers 9&#45;12</text>
<text text-anchor="middle" x="616.82" y="-551.83" font-family="Times,serif" font-size="12.00">GPUs 32&#45;47</text>
<text text-anchor="middle" x="616.82" y="-538.83" font-family="Times,serif" font-size="12.00">Attention + MoE</text>
</g>
<!-- prefill_stage3&#45;&gt;sp_comm -->
<g id="edge6" class="edge">
<title>prefill_stage3&#45;&gt;sp_comm</title>
<path fill="none" stroke="black" d="M636.7,-594.64C638.96,-601.88 640.77,-609.59 641.82,-616.91 642.77,-623.51 642.06,-625.24 641.82,-631.91 636.93,-769.02 663.06,-809.61 619.82,-939.81 601.31,-995.57 555.07,-1045.17 517.11,-1077.47"/>
<polygon fill="black" stroke="black" points="514.59,-1075.01 509.14,-1084.1 519.07,-1080.39 514.59,-1075.01"/>
</g>
<!-- prefill_stage3&#45;&gt;tp_comm -->
<g id="edge17" class="edge">
<title>prefill_stage3&#45;&gt;tp_comm</title>
<path fill="none" stroke="black" d="M556.23,-594.44C551.42,-596.11 546.58,-597.62 541.82,-598.91 477.01,-616.46 458.08,-606.03 391.82,-616.91 321.03,-628.52 303.09,-631.25 233.82,-649.91 223.15,-652.78 212,-656.1 200.97,-659.54"/>
<polygon fill="black" stroke="black" points="199.81,-656.24 191.33,-662.59 201.92,-662.91 199.81,-656.24"/>
</g>
<!-- prefill_stage3&#45;&gt;ep_comm -->
<g id="edge19" class="edge">
<title>prefill_stage3&#45;&gt;ep_comm</title>
<path fill="none" stroke="black" d="M620.9,-594.56C619.74,-627.84 612.41,-681.01 597.82,-724.86 582.01,-772.39 555.06,-822.97 533.1,-857.73"/>
<polygon fill="black" stroke="black" points="530.11,-855.92 527.64,-866.22 535.99,-859.71 530.11,-855.92"/>
</g>
<!-- prefill_stage4 -->
<g id="node6" class="node">
<title>prefill_stage4</title>
<polygon fill="lightgreen" stroke="black" points="484.32,-827.86 335.32,-827.86 335.32,-761.86 484.32,-761.86 484.32,-827.86"/>
<text text-anchor="middle" x="409.82" y="-811.26" font-family="Times,serif" font-size="12.00">PIPELINE STAGE 4</text>
<text text-anchor="middle" x="409.82" y="-798.26" font-family="Times,serif" font-size="12.00">Layers 13&#45;16</text>
<text text-anchor="middle" x="409.82" y="-785.26" font-family="Times,serif" font-size="12.00">GPUs 48&#45;63</text>
<text text-anchor="middle" x="409.82" y="-772.26" font-family="Times,serif" font-size="12.00">Attention + MoE</text>
</g>
<!-- prefill_stage4&#45;&gt;tp_comm -->
<g id="edge21" class="edge">
<title>prefill_stage4&#45;&gt;tp_comm</title>
<path fill="none" stroke="black" d="M352.29,-761.64C339.63,-754.58 326.07,-747.76 312.82,-742.86 271.7,-727.65 258.29,-735.79 215.82,-724.86 208.14,-722.88 200.2,-720.65 192.32,-718.28"/>
<polygon fill="black" stroke="black" points="193.33,-714.93 182.75,-715.34 191.28,-721.62 193.33,-714.93"/>
</g>
<!-- prefill_stage4&#45;&gt;ep_comm -->
<g id="edge23" class="edge">
<title>prefill_stage4&#45;&gt;ep_comm</title>
<path fill="none" stroke="black" d="M443.2,-827.99C451.58,-837.37 460.5,-847.79 468.71,-857.76"/>
<polygon fill="black" stroke="black" points="466.09,-860.08 475.12,-865.63 471.52,-855.66 466.09,-860.08"/>
</g>
<!-- final_output -->
<g id="node20" class="node">
<title>final_output</title>
<ellipse fill="white" stroke="black" stroke-width="3" cx="406.82" cy="-687.38" rx="172.57" ry="28.07"/>
<text text-anchor="middle" x="406.82" y="-690.78" font-family="Times,serif" font-size="12.00">FINAL OUTPUT</text>
<text text-anchor="middle" x="406.82" y="-677.78" font-family="Times,serif" font-size="12.00">[batch=4, seq=10240, hidden=512]</text>
</g>
<!-- prefill_stage4&#45;&gt;final_output -->
<g id="edge8" class="edge">
<title>prefill_stage4&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M408.91,-761.64C408.59,-750.42 408.23,-737.72 407.9,-726.09"/>
<polygon fill="black" stroke="black" points="411.39,-725.68 407.6,-715.78 404.39,-725.88 411.39,-725.68"/>
</g>
<!-- sp_comm&#45;&gt;prefill_stage2 -->
<g id="edge3" class="edge">
<title>sp_comm&#45;&gt;prefill_stage2</title>
<path fill="none" stroke="black" d="M454.36,-1079.7C454.05,-1071.14 453.99,-1061.96 454.19,-1053.18"/>
<polygon fill="black" stroke="black" points="457.69,-1053.24 454.55,-1043.12 450.7,-1052.99 457.69,-1053.24"/>
</g>
<!-- sp_comm&#45;&gt;prefill_stage3 -->
<g id="edge5" class="edge">
<title>sp_comm&#45;&gt;prefill_stage3</title>
<path fill="none" stroke="black" d="M497.29,-1082.24C532.32,-1050.17 582.37,-998.39 601.82,-939.81 645.06,-809.61 618.93,-769.02 623.82,-631.91 624.06,-625.24 624.77,-623.51 623.82,-616.91 623.25,-612.9 622.45,-608.79 621.54,-604.69"/>
<polygon fill="black" stroke="black" points="624.87,-603.57 619.16,-594.64 618.06,-605.18 624.87,-603.57"/>
</g>
<!-- sp_comm&#45;&gt;prefill_stage4 -->
<g id="edge7" class="edge">
<title>sp_comm&#45;&gt;prefill_stage4</title>
<path fill="none" stroke="black" d="M411.23,-1084.34C397.86,-1072.99 385.09,-1058.96 377.82,-1042.81 347.56,-975.6 371.81,-888.36 391.38,-837.6"/>
<polygon fill="black" stroke="black" points="394.65,-838.84 395.09,-828.25 388.14,-836.26 394.65,-838.84"/>
</g>
<!-- tp_comm&#45;&gt;prefill_stage1 -->
<g id="edge10" class="edge">
<title>tp_comm&#45;&gt;prefill_stage1</title>
<path fill="none" stroke="black" d="M156.94,-721.76C174.09,-741.08 189.82,-766.86 189.82,-793.86 189.82,-1118.29 189.82,-1118.29 189.82,-1118.29 189.82,-1159.33 296.47,-1189.88 376.01,-1207.27"/>
<polygon fill="black" stroke="black" points="375.55,-1210.75 386.06,-1209.43 377.02,-1203.9 375.55,-1210.75"/>
</g>
<!-- tp_comm&#45;&gt;prefill_stage2 -->
<g id="edge14" class="edge">
<title>tp_comm&#45;&gt;prefill_stage2</title>
<path fill="none" stroke="black" d="M176.48,-717.5C189.03,-725.14 201.75,-733.8 212.82,-742.86 305.31,-818.52 311.41,-855.25 395.82,-939.81 405.61,-949.62 416.4,-959.94 426.37,-969.52"/>
<polygon fill="black" stroke="black" points="424.18,-972.26 433.81,-976.68 429.03,-967.22 424.18,-972.26"/>
</g>
<!-- tp_comm&#45;&gt;prefill_stage3 -->
<g id="edge18" class="edge">
<title>tp_comm&#45;&gt;prefill_stage3</title>
<path fill="none" stroke="black" d="M183.1,-659.56C193.97,-656.11 205.14,-652.78 215.82,-649.91 285.09,-631.25 303.03,-628.52 373.82,-616.91 440.08,-606.03 459.01,-616.46 523.82,-598.91 526.63,-598.15 529.46,-597.31 532.31,-596.41"/>
<polygon fill="black" stroke="black" points="533.66,-599.65 542.01,-593.13 531.42,-593.02 533.66,-599.65"/>
</g>
<!-- tp_comm&#45;&gt;prefill_stage4 -->
<g id="edge22" class="edge">
<title>tp_comm&#45;&gt;prefill_stage4</title>
<path fill="none" stroke="black" d="M190.97,-712.33C205.16,-716.85 219.89,-721.28 233.82,-724.86 276.29,-735.79 289.7,-727.65 330.82,-742.86 340.97,-746.61 351.29,-751.49 361.01,-756.74"/>
<polygon fill="black" stroke="black" points="359.31,-759.8 369.75,-761.64 362.74,-753.69 359.31,-759.8"/>
</g>
<!-- ep_comm&#45;&gt;prefill_stage1 -->
<g id="edge12" class="edge">
<title>ep_comm&#45;&gt;prefill_stage1</title>
<path fill="none" stroke="black" d="M531,-938.17C568.62,-988.53 620.46,-1083.45 580.82,-1154.77 572.39,-1169.94 559.09,-1182.2 544.34,-1191.94"/>
<polygon fill="black" stroke="black" points="542.19,-1189.16 535.51,-1197.39 545.86,-1195.12 542.19,-1189.16"/>
</g>
<!-- ep_comm&#45;&gt;prefill_stage2 -->
<g id="edge16" class="edge">
<title>ep_comm&#45;&gt;prefill_stage2</title>
<path fill="none" stroke="black" d="M492.15,-939.78C489.31,-948.57 485.96,-958.03 482.49,-967.04"/>
<polygon fill="black" stroke="black" points="479.14,-966.01 478.7,-976.59 485.64,-968.59 479.14,-966.01"/>
</g>
<!-- ep_comm&#45;&gt;prefill_stage3 -->
<g id="edge20" class="edge">
<title>ep_comm&#45;&gt;prefill_stage3</title>
<path fill="none" stroke="black" d="M514.4,-865.23C532.98,-830.51 562.83,-775.93 579.82,-724.86 592.99,-685.29 600.24,-638.14 605.7,-604.85"/>
<polygon fill="black" stroke="black" points="609.22,-605 607.42,-594.56 602.32,-603.85 609.22,-605"/>
</g>
<!-- ep_comm&#45;&gt;prefill_stage4 -->
<g id="edge24" class="edge">
<title>ep_comm&#45;&gt;prefill_stage4</title>
<path fill="none" stroke="black" d="M463.56,-867.09C454.8,-857.22 445.57,-846.36 437.24,-836.15"/>
<polygon fill="black" stroke="black" points="439.79,-833.73 430.79,-828.14 434.34,-838.12 439.79,-833.73"/>
</g>
<!-- pp_comm -->
<g id="node10" class="node">
<title>pp_comm</title>
<ellipse fill="lightblue" stroke="black" cx="989.82" cy="-1332.24" rx="101.65" ry="37.45"/>
<text text-anchor="middle" x="989.82" y="-1342.14" font-family="Times,serif" font-size="12.00">PP Communication</text>
<text text-anchor="middle" x="989.82" y="-1329.14" font-family="Times,serif" font-size="12.00">Pipeline bubbles</text>
<text text-anchor="middle" x="989.82" y="-1316.14" font-family="Times,serif" font-size="12.00">Stage&#45;to&#45;stage</text>
</g>
<!-- decode_start -->
<g id="node11" class="node">
<title>decode_start</title>
<polygon fill="red" stroke="black" points="1327.82,-1361.74 1109.82,-1361.74 1109.82,-1302.74 1327.82,-1302.74 1327.82,-1361.74"/>
<text text-anchor="middle" x="1218.82" y="-1343.54" font-family="Times,serif" font-size="14.00">DECODE PHASE</text>
<text text-anchor="middle" x="1218.82" y="-1328.54" font-family="Times,serif" font-size="14.00">PP=4, EP=4, TP=2, SP=1</text>
<text text-anchor="middle" x="1218.82" y="-1313.54" font-family="Times,serif" font-size="14.00">32 GPUs</text>
</g>
<!-- decode_input -->
<g id="node12" class="node">
<title>decode_input</title>
<ellipse fill="pink" stroke="black" stroke-width="3" cx="372.82" cy="-561.43" rx="151.14" ry="37.45"/>
<text text-anchor="middle" x="372.82" y="-571.33" font-family="Times,serif" font-size="12.00">DECODE INPUT</text>
<text text-anchor="middle" x="372.82" y="-558.33" font-family="Times,serif" font-size="12.00">Single Token</text>
<text text-anchor="middle" x="372.82" y="-545.33" font-family="Times,serif" font-size="12.00">[batch=4, seq=1, hidden=512]</text>
</g>
<!-- decode_stage1 -->
<g id="node13" class="node">
<title>decode_stage1</title>
<polygon fill="lightgreen" stroke="black" points="444.32,-486.95 301.32,-486.95 301.32,-420.95 444.32,-420.95 444.32,-486.95"/>
<text text-anchor="middle" x="372.82" y="-470.35" font-family="Times,serif" font-size="12.00">DECODE STAGE 1</text>
<text text-anchor="middle" x="372.82" y="-457.35" font-family="Times,serif" font-size="12.00">Layers 1&#45;4</text>
<text text-anchor="middle" x="372.82" y="-444.35" font-family="Times,serif" font-size="12.00">GPUs 0&#45;15</text>
<text text-anchor="middle" x="372.82" y="-431.35" font-family="Times,serif" font-size="12.00">Attention + MoE</text>
</g>
<!-- decode_input&#45;&gt;decode_stage1 -->
<g id="edge25" class="edge">
<title>decode_input&#45;&gt;decode_stage1</title>
<path fill="none" stroke="black" d="M372.82,-523.84C372.82,-515.28 372.82,-506.1 372.82,-497.32"/>
<polygon fill="black" stroke="black" points="376.32,-497.26 372.82,-487.26 369.32,-497.26 376.32,-497.26"/>
</g>
<!-- decode_stage2 -->
<g id="node14" class="node">
<title>decode_stage2</title>
<polygon fill="lightgreen" stroke="black" points="444.32,-383.95 301.32,-383.95 301.32,-317.95 444.32,-317.95 444.32,-383.95"/>
<text text-anchor="middle" x="372.82" y="-367.35" font-family="Times,serif" font-size="12.00">DECODE STAGE 2</text>
<text text-anchor="middle" x="372.82" y="-354.35" font-family="Times,serif" font-size="12.00">Layers 5&#45;8</text>
<text text-anchor="middle" x="372.82" y="-341.35" font-family="Times,serif" font-size="12.00">GPUs 16&#45;31</text>
<text text-anchor="middle" x="372.82" y="-328.35" font-family="Times,serif" font-size="12.00">Attention + MoE</text>
</g>
<!-- decode_stage1&#45;&gt;decode_stage2 -->
<g id="edge26" class="edge">
<title>decode_stage1&#45;&gt;decode_stage2</title>
<path fill="none" stroke="black" d="M372.82,-420.72C372.82,-412.34 372.82,-403.18 372.82,-394.36"/>
<polygon fill="black" stroke="black" points="376.32,-394.23 372.82,-384.23 369.32,-394.23 376.32,-394.23"/>
</g>
<!-- decode_tp_comm -->
<g id="node17" class="node">
<title>decode_tp_comm</title>
<ellipse fill="lightblue" stroke="black" cx="101.82" cy="-37.48" rx="101.65" ry="37.45"/>
<text text-anchor="middle" x="101.82" y="-47.38" font-family="Times,serif" font-size="12.00">TP Communication</text>
<text text-anchor="middle" x="101.82" y="-34.38" font-family="Times,serif" font-size="12.00">All&#45;Gather</text>
<text text-anchor="middle" x="101.82" y="-21.38" font-family="Times,serif" font-size="12.00">Across TP pairs</text>
</g>
<!-- decode_stage1&#45;&gt;decode_tp_comm -->
<g id="edge30" class="edge">
<title>decode_stage1&#45;&gt;decode_tp_comm</title>
<path fill="none" stroke="black" d="M300.99,-441.3C220.04,-425.51 99.82,-394.34 99.82,-351.95 99.82,-351.95 99.82,-351.95 99.82,-143.95 99.82,-124.69 98.65,-103.48 97.88,-85.17"/>
<polygon fill="black" stroke="black" points="101.37,-84.91 97.49,-75.05 94.38,-85.17 101.37,-84.91"/>
</g>
<!-- decode_ep_comm -->
<g id="node18" class="node">
<title>decode_ep_comm</title>
<ellipse fill="lightblue" stroke="black" cx="644.82" cy="-37.48" rx="102.56" ry="37.45"/>
<text text-anchor="middle" x="644.82" y="-47.38" font-family="Times,serif" font-size="12.00">EP Communication</text>
<text text-anchor="middle" x="644.82" y="-34.38" font-family="Times,serif" font-size="12.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="644.82" y="-21.38" font-family="Times,serif" font-size="12.00">Expert routing</text>
</g>
<!-- decode_stage1&#45;&gt;decode_ep_comm -->
<g id="edge32" class="edge">
<title>decode_stage1&#45;&gt;decode_ep_comm</title>
<path fill="none" stroke="black" d="M444.61,-438.76C520.4,-422.33 628.82,-392.26 628.82,-351.95 628.82,-351.95 628.82,-351.95 628.82,-143.95 628.82,-124.69 630,-103.48 632.01,-85.17"/>
<polygon fill="black" stroke="black" points="635.51,-85.4 633.25,-75.05 628.56,-84.55 635.51,-85.4"/>
</g>
<!-- decode_stage3 -->
<g id="node15" class="node">
<title>decode_stage3</title>
<polygon fill="lightgreen" stroke="black" points="444.32,-280.95 301.32,-280.95 301.32,-214.95 444.32,-214.95 444.32,-280.95"/>
<text text-anchor="middle" x="372.82" y="-264.35" font-family="Times,serif" font-size="12.00">DECODE STAGE 3</text>
<text text-anchor="middle" x="372.82" y="-251.35" font-family="Times,serif" font-size="12.00">Layers 9&#45;12</text>
<text text-anchor="middle" x="372.82" y="-238.35" font-family="Times,serif" font-size="12.00">GPUs 32&#45;47</text>
<text text-anchor="middle" x="372.82" y="-225.35" font-family="Times,serif" font-size="12.00">Attention + MoE</text>
</g>
<!-- decode_stage2&#45;&gt;decode_stage3 -->
<g id="edge27" class="edge">
<title>decode_stage2&#45;&gt;decode_stage3</title>
<path fill="none" stroke="black" d="M372.82,-317.72C372.82,-309.34 372.82,-300.18 372.82,-291.36"/>
<polygon fill="black" stroke="black" points="376.32,-291.23 372.82,-281.23 369.32,-291.23 376.32,-291.23"/>
</g>
<!-- decode_stage2&#45;&gt;decode_tp_comm -->
<g id="edge34" class="edge">
<title>decode_stage2&#45;&gt;decode_tp_comm</title>
<path fill="none" stroke="black" d="M323.87,-317.7C310.29,-306.56 295.99,-293.68 283.82,-280.95 222.02,-216.34 159.65,-132.95 126.19,-82.71"/>
<polygon fill="black" stroke="black" points="129.1,-80.76 120.68,-74.33 123.25,-84.61 129.1,-80.76"/>
</g>
<!-- decode_stage2&#45;&gt;decode_ep_comm -->
<g id="edge36" class="edge">
<title>decode_stage2&#45;&gt;decode_ep_comm</title>
<path fill="none" stroke="black" d="M405.26,-317.76C418.06,-306.63 432.53,-293.73 444.82,-280.95 507.3,-216.03 570.1,-131.79 608.4,-81.61"/>
<polygon fill="black" stroke="black" points="611.27,-83.63 614.56,-73.56 605.71,-79.37 611.27,-83.63"/>
</g>
<!-- decode_stage4 -->
<g id="node16" class="node">
<title>decode_stage4</title>
<polygon fill="lightgreen" stroke="black" points="444.32,-177.95 301.32,-177.95 301.32,-111.95 444.32,-111.95 444.32,-177.95"/>
<text text-anchor="middle" x="372.82" y="-161.35" font-family="Times,serif" font-size="12.00">DECODE STAGE 4</text>
<text text-anchor="middle" x="372.82" y="-148.35" font-family="Times,serif" font-size="12.00">Layers 13&#45;16</text>
<text text-anchor="middle" x="372.82" y="-135.35" font-family="Times,serif" font-size="12.00">GPUs 48&#45;63</text>
<text text-anchor="middle" x="372.82" y="-122.35" font-family="Times,serif" font-size="12.00">Attention + MoE</text>
</g>
<!-- decode_stage3&#45;&gt;decode_stage4 -->
<g id="edge28" class="edge">
<title>decode_stage3&#45;&gt;decode_stage4</title>
<path fill="none" stroke="black" d="M372.82,-214.72C372.82,-206.34 372.82,-197.18 372.82,-188.36"/>
<polygon fill="black" stroke="black" points="376.32,-188.23 372.82,-178.23 369.32,-188.23 376.32,-188.23"/>
</g>
<!-- decode_stage3&#45;&gt;decode_tp_comm -->
<g id="edge38" class="edge">
<title>decode_stage3&#45;&gt;decode_tp_comm</title>
<path fill="none" stroke="black" d="M325.36,-214.75C311.57,-203.41 296.81,-190.38 283.82,-177.95 246.35,-142.07 245.56,-123.77 203.82,-92.95 193.81,-85.56 182.63,-78.72 171.44,-72.56"/>
<polygon fill="black" stroke="black" points="172.96,-69.4 162.49,-67.77 169.66,-75.57 172.96,-69.4"/>
</g>
<!-- decode_stage3&#45;&gt;decode_ep_comm -->
<g id="edge40" class="edge">
<title>decode_stage3&#45;&gt;decode_ep_comm</title>
<path fill="none" stroke="black" d="M403.82,-214.81C416.77,-203.47 431.71,-190.43 444.82,-177.95 482.4,-142.19 483.09,-123.77 524.82,-92.95 536.87,-84.06 550.58,-75.97 564.35,-68.91"/>
<polygon fill="black" stroke="black" points="565.99,-72 573.39,-64.42 562.87,-65.73 565.99,-72"/>
</g>
<!-- decode_stage4&#45;&gt;decode_tp_comm -->
<g id="edge42" class="edge">
<title>decode_stage4&#45;&gt;decode_tp_comm</title>
<path fill="none" stroke="black" d="M311.17,-111.72C298.39,-104.91 284.87,-98.2 271.82,-92.95 242.82,-81.29 233.8,-83.84 203.82,-74.95 196.44,-72.76 188.8,-70.42 181.18,-68.02"/>
<polygon fill="black" stroke="black" points="182.15,-64.66 171.56,-64.95 180.02,-71.33 182.15,-64.66"/>
</g>
<!-- decode_stage4&#45;&gt;decode_ep_comm -->
<g id="edge44" class="edge">
<title>decode_stage4&#45;&gt;decode_ep_comm</title>
<path fill="none" stroke="black" d="M421.84,-111.88C434.92,-105.14 449.18,-98.42 462.82,-92.95 489.06,-82.43 496.83,-83.33 523.82,-74.95 534.4,-71.67 545.51,-68.15 556.54,-64.63"/>
<polygon fill="black" stroke="black" points="557.74,-67.92 566.2,-61.54 555.61,-61.25 557.74,-67.92"/>
</g>
<!-- decode_output -->
<g id="node21" class="node">
<title>decode_output</title>
<ellipse fill="pink" stroke="black" stroke-width="3" cx="372.82" cy="-37.48" rx="151.14" ry="28.07"/>
<text text-anchor="middle" x="372.82" y="-40.88" font-family="Times,serif" font-size="12.00">DECODE OUTPUT</text>
<text text-anchor="middle" x="372.82" y="-27.88" font-family="Times,serif" font-size="12.00">[batch=4, seq=1, hidden=512]</text>
</g>
<!-- decode_stage4&#45;&gt;decode_output -->
<g id="edge29" class="edge">
<title>decode_stage4&#45;&gt;decode_output</title>
<path fill="none" stroke="black" d="M372.82,-111.73C372.82,-100.51 372.82,-87.81 372.82,-76.18"/>
<polygon fill="black" stroke="black" points="376.32,-75.88 372.82,-65.88 369.32,-75.88 376.32,-75.88"/>
</g>
<!-- decode_tp_comm&#45;&gt;decode_stage1 -->
<g id="edge31" class="edge">
<title>decode_tp_comm&#45;&gt;decode_stage1</title>
<path fill="none" stroke="black" d="M113.4,-75.05C116.15,-95.33 117.82,-121.01 117.82,-143.95 117.82,-351.95 117.82,-351.95 117.82,-351.95 117.82,-390.35 216.45,-419.54 291.09,-436.44"/>
<polygon fill="black" stroke="black" points="290.46,-439.88 300.98,-438.64 291.98,-433.05 290.46,-439.88"/>
</g>
<!-- decode_tp_comm&#45;&gt;decode_stage2 -->
<g id="edge35" class="edge">
<title>decode_tp_comm&#45;&gt;decode_stage2</title>
<path fill="none" stroke="black" d="M132.14,-73.5C169.68,-122.23 236.08,-212.21 301.82,-280.95 311.62,-291.19 322.78,-301.54 333.36,-310.99"/>
<polygon fill="black" stroke="black" points="331.12,-313.68 340.92,-317.7 335.76,-308.44 331.12,-313.68"/>
</g>
<!-- decode_tp_comm&#45;&gt;decode_stage3 -->
<g id="edge39" class="edge">
<title>decode_tp_comm&#45;&gt;decode_stage3</title>
<path fill="none" stroke="black" d="M173.26,-64.42C189.98,-72.47 207.14,-82.12 221.82,-92.95 263.56,-123.77 264.35,-142.07 301.82,-177.95 312.27,-187.96 323.87,-198.34 334.66,-207.93"/>
<polygon fill="black" stroke="black" points="332.55,-210.73 342.35,-214.75 337.19,-205.5 332.55,-210.73"/>
</g>
<!-- decode_tp_comm&#45;&gt;decode_stage4 -->
<g id="edge43" class="edge">
<title>decode_tp_comm&#45;&gt;decode_stage4</title>
<path fill="none" stroke="black" d="M179.42,-61.78C193.53,-66.3 208.11,-70.89 221.82,-74.95 251.8,-83.84 260.82,-81.29 289.82,-92.95 299.81,-96.97 310.08,-101.84 319.86,-106.96"/>
<polygon fill="black" stroke="black" points="318.21,-110.05 328.68,-111.72 321.53,-103.89 318.21,-110.05"/>
</g>
<!-- decode_ep_comm&#45;&gt;decode_stage1 -->
<g id="edge33" class="edge">
<title>decode_ep_comm&#45;&gt;decode_stage1</title>
<path fill="none" stroke="black" d="M649.15,-75.05C648.49,-95.33 646.82,-121.01 646.82,-143.95 646.82,-351.95 646.82,-351.95 646.82,-351.95 646.82,-392.79 535.53,-423.12 454.74,-439.41"/>
<polygon fill="black" stroke="black" points="453.68,-436.05 444.55,-441.42 455.04,-442.91 453.68,-436.05"/>
</g>
<!-- decode_ep_comm&#45;&gt;decode_stage2 -->
<g id="edge37" class="edge">
<title>decode_ep_comm&#45;&gt;decode_stage2</title>
<path fill="none" stroke="black" d="M626.03,-74.39C594.35,-123.36 528.41,-212.8 462.82,-280.95 452.83,-291.34 441.41,-301.8 430.1,-311.32"/>
<polygon fill="black" stroke="black" points="427.79,-308.69 422.31,-317.76 432.25,-314.09 427.79,-308.69"/>
</g>
<!-- decode_ep_comm&#45;&gt;decode_stage3 -->
<g id="edge41" class="edge">
<title>decode_ep_comm&#45;&gt;decode_stage3</title>
<path fill="none" stroke="black" d="M584.16,-67.77C570.07,-75.1 555.52,-83.58 542.82,-92.95 501.09,-123.77 500.4,-142.19 462.82,-177.95 452.17,-188.09 440.3,-198.6 428.75,-208.27"/>
<polygon fill="black" stroke="black" points="426.3,-205.75 420.81,-214.81 430.75,-211.15 426.3,-205.75"/>
</g>
<!-- decode_ep_comm&#45;&gt;decode_stage4 -->
<g id="edge45" class="edge">
<title>decode_ep_comm&#45;&gt;decode_stage4</title>
<path fill="none" stroke="black" d="M573.99,-64.75C563.25,-68.23 552.27,-71.71 541.82,-74.95 514.83,-83.33 507.06,-82.43 480.82,-92.95 470.17,-97.23 459.13,-102.26 448.35,-107.47"/>
<polygon fill="black" stroke="black" points="446.8,-104.33 439.36,-111.88 449.88,-110.62 446.8,-104.33"/>
</g>
<!-- decode_pp_comm -->
<g id="node19" class="node">
<title>decode_pp_comm</title>
<ellipse fill="lightblue" stroke="black" cx="1447.82" cy="-1332.24" rx="101.65" ry="37.45"/>
<text text-anchor="middle" x="1447.82" y="-1342.14" font-family="Times,serif" font-size="12.00">PP Communication</text>
<text text-anchor="middle" x="1447.82" y="-1329.14" font-family="Times,serif" font-size="12.00">Pipeline bubbles</text>
<text text-anchor="middle" x="1447.82" y="-1316.14" font-family="Times,serif" font-size="12.00">Stage&#45;to&#45;stage</text>
</g>
<!-- final_output&#45;&gt;decode_input -->
<g id="edge46" class="edge">
<title>final_output&#45;&gt;decode_input</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M399.28,-658.87C395.25,-644.21 390.2,-625.76 385.58,-608.94"/>
<polygon fill="black" stroke="black" points="388.95,-607.99 382.93,-599.27 382.2,-609.84 388.95,-607.99"/>
<text text-anchor="middle" x="431.32" y="-620.71" font-family="Times,serif" font-size="14.00">Next token</text>
</g>
</g>
</svg>
