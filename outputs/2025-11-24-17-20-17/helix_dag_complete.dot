digraph helix_dag_complete {
    rankdir=TB;
    splines=ortho;
    nodesep=0.3;
    ranksep=1.2;
    
    node [shape=ellipse, style=filled, fillcolor=lightblue];
    input [label="Model Input\nGPU: 0\nInput: [batch_size=128, seq_len=10000, hidden_dim=4096]"];
    output [label="Model Output\nGPU: 15\nOutput: [batch_size=128, seq_len=10000, hidden_dim=4096]"];
    
    /* ======================================== */
    /* LAYER 0 - Complete 4×4 Helix Partitioning */
    /* ======================================== */
    subgraph cluster_layer0 {
        label="Layer 0 - 4×4 Helix (16 GPUs)";
        style=rounded, filled;
        fillcolor=lightgrey;
        
        /* Head Group 0: GPUs 0-3 */
        subgraph cluster_l0_hg0 {
            label="Head Group 0 (Heads 0-7)";
            style=dashed;
            
            node [shape=rectangle, style=filled, fillcolor=lightgreen];
            l0_q_0_0 [label="Q Proj L0\nGPU: 0\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_k_0_0 [label="K Proj L0\nGPU: 0\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_v_0_0 [label="V Proj L0\nGPU: 0\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_attn_0_0 [label="Attention L0\nGPU: 0\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l0_q_0_1 [label="Q Proj L0\nGPU: 1\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_k_0_1 [label="K Proj L0\nGPU: 1\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_v_0_1 [label="V Proj L0\nGPU: 1\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_attn_0_1 [label="Attention L0\nGPU: 1\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l0_q_0_2 [label="Q Proj L0\nGPU: 2\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_k_0_2 [label="K Proj L0\nGPU: 2\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_v_0_2 [label="V Proj L0\nGPU: 2\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_attn_0_2 [label="Attention L0\nGPU: 2\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l0_q_0_3 [label="Q Proj L0\nGPU: 3\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_k_0_3 [label="K Proj L0\nGPU: 3\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_v_0_3 [label="V Proj L0\nGPU: 3\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_attn_0_3 [label="Attention L0\nGPU: 3\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
        }
        
        /* Head Group 1: GPUs 4-7 */
        subgraph cluster_l0_hg1 {
            label="Head Group 1 (Heads 8-15)";
            style=dashed;
            
            node [shape=rectangle, style=filled, fillcolor=lightgreen];
            l0_q_1_0 [label="Q Proj L0\nGPU: 4\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_k_1_0 [label="K Proj L0\nGPU: 4\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_v_1_0 [label="V Proj L0\nGPU: 4\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_attn_1_0 [label="Attention L0\nGPU: 4\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l0_q_1_1 [label="Q Proj L0\nGPU: 5\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_k_1_1 [label="K Proj L0\nGPU: 5\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_v_1_1 [label="V Proj L0\nGPU: 5\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_attn_1_1 [label="Attention L0\nGPU: 5\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l0_q_1_2 [label="Q Proj L0\nGPU: 6\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_k_1_2 [label="K Proj L0\nGPU: 6\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_v_1_2 [label="V Proj L0\nGPU: 6\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_attn_1_2 [label="Attention L0\nGPU: 6\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l0_q_1_3 [label="Q Proj L0\nGPU: 7\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_k_1_3 [label="K Proj L0\nGPU: 7\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_v_1_3 [label="V Proj L0\nGPU: 7\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_attn_1_3 [label="Attention L0\nGPU: 7\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
        }
        
        /* Head Group 2: GPUs 8-11 */
        subgraph cluster_l0_hg2 {
            label="Head Group 2 (Heads 16-23)";
            style=dashed;
            
            node [shape=rectangle, style=filled, fillcolor=lightgreen];
            l0_q_2_0 [label="Q Proj L0\nGPU: 8\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_k_2_0 [label="K Proj L0\nGPU: 8\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_v_2_0 [label="V Proj L0\nGPU: 8\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_attn_2_0 [label="Attention L0\nGPU: 8\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l0_q_2_1 [label="Q Proj L0\nGPU: 9\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_k_2_1 [label="K Proj L0\nGPU: 9\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_v_2_1 [label="V Proj L0\nGPU: 9\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_attn_2_1 [label="Attention L0\nGPU: 9\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l0_q_2_2 [label="Q Proj L0\nGPU: 10\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_k_2_2 [label="K Proj L0\nGPU: 10\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_v_2_2 [label="V Proj L0\nGPU: 10\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_attn_2_2 [label="Attention L0\nGPU: 10\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l0_q_2_3 [label="Q Proj L0\nGPU: 11\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_k_2_3 [label="K Proj L0\nGPU: 11\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_v_2_3 [label="V Proj L0\nGPU: 11\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_attn_2_3 [label="Attention L0\nGPU: 11\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
        }
        
        /* Head Group 3: GPUs 12-15 */
        subgraph cluster_l0_hg3 {
            label="Head Group 3 (Heads 24-31)";
            style=dashed;
            
            node [shape=rectangle, style=filled, fillcolor=lightgreen];
            l0_q_3_0 [label="Q Proj L0\nGPU: 12\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_k_3_0 [label="K Proj L0\nGPU: 12\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_v_3_0 [label="V Proj L0\nGPU: 12\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_attn_3_0 [label="Attention L0\nGPU: 12\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l0_q_3_1 [label="Q Proj L0\nGPU: 13\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_k_3_1 [label="K Proj L0\nGPU: 13\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_v_3_1 [label="V Proj L0\nGPU: 13\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_attn_3_1 [label="Attention L0\nGPU: 13\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l0_q_3_2 [label="Q Proj L0\nGPU: 14\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_k_3_2 [label="K Proj L0\nGPU: 14\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_v_3_2 [label="V Proj L0\nGPU: 14\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_attn_3_2 [label="Attention L0\nGPU: 14\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l0_q_3_3 [label="Q Proj L0\nGPU: 15\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_k_3_3 [label="K Proj L0\nGPU: 15\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_v_3_3 [label="V Proj L0\nGPU: 15\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l0_attn_3_3 [label="Attention L0\nGPU: 15\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
        }
        
        /* Concatenation and MLP */
        node [shape=parallelogram, style=filled, fillcolor=yellow];
        l0_concat [label="All-Gather Concat\nGPU: 0\nInput: 16×[128,10000,32,8]\nOutput: [128,10000,4096]"];
        
        node [shape=hexagon, style=filled, fillcolor=lightcoral];
        l0_mha_residual [label="MHA Residual L0\nGPU: 0\nInput1: [128,10000,4096]\nInput2: [128,10000,4096]\nOutput: [128,10000,4096]"];
        
        node [shape=rectangle, style=filled, fillcolor=lightgreen];
        l0_mlp_fc1 [label="MLP FC1 L0\nGPU: 0-15\nEach GPU: [4096,1024]\nInput: [128,10000,4096]\nOutput: [128,10000,1024]"];
        l0_mlp_fc2 [label="MLP FC2 L0\nGPU: 0-15\nEach GPU: [1024,4096]\nInput: [128,10000,1024]\nOutput: [128,10000,4096]"];
        
        node [shape=hexagon, style=filled, fillcolor=lightcoral];
        l0_mlp_residual [label="MLP Residual L0\nGPU: 0\nInput1: [128,10000,4096]\nInput2: [128,10000,4096]\nOutput: [128,10000,4096]"];
    }
    
    /* ======================================== */
    /* LAYER 1 - Complete 4×4 Helix Partitioning */
    /* ======================================== */
    subgraph cluster_layer1 {
        label="Layer 1 - 4×4 Helix (16 GPUs)";
        style=rounded, filled;
        fillcolor=lightgrey;
        
        /* Head Group 0: GPUs 0-3 */
        subgraph cluster_l1_hg0 {
            label="Head Group 0 (Heads 0-7)";
            style=dashed;
            
            node [shape=rectangle, style=filled, fillcolor=lightgreen];
            l1_q_0_0 [label="Q Proj L1\nGPU: 0\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_k_0_0 [label="K Proj L1\nGPU: 0\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_v_0_0 [label="V Proj L1\nGPU: 0\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_attn_0_0 [label="Attention L1\nGPU: 0\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l1_q_0_1 [label="Q Proj L1\nGPU: 1\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_k_0_1 [label="K Proj L1\nGPU: 1\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_v_0_1 [label="V Proj L1\nGPU: 1\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_attn_0_1 [label="Attention L1\nGPU: 1\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l1_q_0_2 [label="Q Proj L1\nGPU: 2\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_k_0_2 [label="K Proj L1\nGPU: 2\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_v_0_2 [label="V Proj L1\nGPU: 2\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_attn_0_2 [label="Attention L1\nGPU: 2\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l1_q_0_3 [label="Q Proj L1\nGPU: 3\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_k_0_3 [label="K Proj L1\nGPU: 3\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_v_0_3 [label="V Proj L1\nGPU: 3\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_attn_0_3 [label="Attention L1\nGPU: 3\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
        }
        
        /* Head Group 1: GPUs 4-7 */
        subgraph cluster_l1_hg1 {
            label="Head Group 1 (Heads 8-15)";
            style=dashed;
            
            node [shape=rectangle, style=filled, fillcolor=lightgreen];
            l1_q_1_0 [label="Q Proj L1\nGPU: 4\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_k_1_0 [label="K Proj L1\nGPU: 4\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_v_1_0 [label="V Proj L1\nGPU: 4\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_attn_1_0 [label="Attention L1\nGPU: 4\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l1_q_1_1 [label="Q Proj L1\nGPU: 5\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_k_1_1 [label="K Proj L1\nGPU: 5\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_v_1_1 [label="V Proj L1\nGPU: 5\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_attn_1_1 [label="Attention L1\nGPU: 5\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l1_q_1_2 [label="Q Proj L1\nGPU: 6\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_k_1_2 [label="K Proj L1\nGPU: 6\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_v_1_2 [label="V Proj L1\nGPU: 6\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_attn_1_2 [label="Attention L1\nGPU: 6\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l1_q_1_3 [label="Q Proj L1\nGPU: 7\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_k_1_3 [label="K Proj L1\nGPU: 7\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_v_1_3 [label="V Proj L1\nGPU: 7\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_attn_1_3 [label="Attention L1\nGPU: 7\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
        }
        
        /* Head Group 2: GPUs 8-11 */
        subgraph cluster_l1_hg2 {
            label="Head Group 2 (Heads 16-23)";
            style=dashed;
            
            node [shape=rectangle, style=filled, fillcolor=lightgreen];
            l1_q_2_0 [label="Q Proj L1\nGPU: 8\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_k_2_0 [label="K Proj L1\nGPU: 8\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_v_2_0 [label="V Proj L1\nGPU: 8\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_attn_2_0 [label="Attention L1\nGPU: 8\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l1_q_2_1 [label="Q Proj L1\nGPU: 9\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_k_2_1 [label="K Proj L1\nGPU: 9\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_v_2_1 [label="V Proj L1\nGPU: 9\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_attn_2_1 [label="Attention L1\nGPU: 9\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l1_q_2_2 [label="Q Proj L1\nGPU: 10\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_k_2_2 [label="K Proj L1\nGPU: 10\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_v_2_2 [label="V Proj L1\nGPU: 10\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_attn_2_2 [label="Attention L1\nGPU: 10\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l1_q_2_3 [label="Q Proj L1\nGPU: 11\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_k_2_3 [label="K Proj L1\nGPU: 11\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_v_2_3 [label="V Proj L1\nGPU: 11\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_attn_2_3 [label="Attention L1\nGPU: 11\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
        }
        
        /* Head Group 3: GPUs 12-15 */
        subgraph cluster_l1_hg3 {
            label="Head Group 3 (Heads 24-31)";
            style=dashed;
            
            node [shape=rectangle, style=filled, fillcolor=lightgreen];
            l1_q_3_0 [label="Q Proj L1\nGPU: 12\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_k_3_0 [label="K Proj L1\nGPU: 12\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_v_3_0 [label="V Proj L1\nGPU: 12\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_attn_3_0 [label="Attention L1\nGPU: 12\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l1_q_3_1 [label="Q Proj L1\nGPU: 13\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_k_3_1 [label="K Proj L1\nGPU: 13\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_v_3_1 [label="V Proj L1\nGPU: 13\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_attn_3_1 [label="Attention L1\nGPU: 13\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l1_q_3_2 [label="Q Proj L1\nGPU: 14\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_k_3_2 [label="K Proj L1\nGPU: 14\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_v_3_2 [label="V Proj L1\nGPU: 14\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_attn_3_2 [label="Attention L1\nGPU: 14\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l1_q_3_3 [label="Q Proj L1\nGPU: 15\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_k_3_3 [label="K Proj L1\nGPU: 15\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_v_3_3 [label="V Proj L1\nGPU: 15\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l1_attn_3_3 [label="Attention L1\nGPU: 15\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
        }
        
        /* Concatenation and MLP */
        node [shape=parallelogram, style=filled, fillcolor=yellow];
        l1_concat [label="All-Gather Concat\nGPU: 0\nInput: 16×[128,10000,32,8]\nOutput: [128,10000,4096]"];
        
        node [shape=hexagon, style=filled, fillcolor=lightcoral];
        l1_mha_residual [label="MHA Residual L1\nGPU: 0\nInput1: [128,10000,4096]\nInput2: [128,10000,4096]\nOutput: [128,10000,4096]"];
        
        node [shape=rectangle, style=filled, fillcolor=lightgreen];
        l1_mlp_fc1 [label="MLP FC1 L1\nGPU: 0-15\nEach GPU: [4096,1024]\nInput: [128,10000,4096]\nOutput: [128,10000,1024]"];
        l1_mlp_fc2 [label="MLP FC2 L1\nGPU: 0-15\nEach GPU: [1024,4096]\nInput: [128,10000,1024]\nOutput: [128,10000,4096]"];
        
        node [shape=hexagon, style=filled, fillcolor=lightcoral];
        l1_mlp_residual [label="MLP Residual L1\nGPU: 0\nInput1: [128,10000,4096]\nInput2: [128,10000,4096]\nOutput: [128,10000,4096]"];
    }
    
    /* ======================================== */
    /* LAYER 2 - Complete 4×4 Helix Partitioning */
    /* ======================================== */
    subgraph cluster_layer2 {
        label="Layer 2 - 4×4 Helix (16 GPUs)";
        style=rounded, filled;
        fillcolor=lightgrey;
        
        /* Head Group 0: GPUs 0-3 */
        subgraph cluster_l2_hg0 {
            label="Head Group 0 (Heads 0-7)";
            style=dashed;
            
            node [shape=rectangle, style=filled, fillcolor=lightgreen];
            l2_q_0_0 [label="Q Proj L2\nGPU: 0\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_k_0_0 [label="K Proj L2\nGPU: 0\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_v_0_0 [label="V Proj L2\nGPU: 0\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_attn_0_0 [label="Attention L2\nGPU: 0\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l2_q_0_1 [label="Q Proj L2\nGPU: 1\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_k_0_1 [label="K Proj L2\nGPU: 1\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_v_0_1 [label="V Proj L2\nGPU: 1\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_attn_0_1 [label="Attention L2\nGPU: 1\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l2_q_0_2 [label="Q Proj L2\nGPU: 2\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_k_0_2 [label="K Proj L2\nGPU: 2\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_v_0_2 [label="V Proj L2\nGPU: 2\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_attn_0_2 [label="Attention L2\nGPU: 2\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l2_q_0_3 [label="Q Proj L2\nGPU: 3\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_k_0_3 [label="K Proj L2\nGPU: 3\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_v_0_3 [label="V Proj L2\nGPU: 3\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_attn_0_3 [label="Attention L2\nGPU: 3\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
        }
        
        /* Head Group 1: GPUs 4-7 */
        subgraph cluster_l2_hg1 {
            label="Head Group 1 (Heads 8-15)";
            style=dashed;
            
            node [shape=rectangle, style=filled, fillcolor=lightgreen];
            l2_q_1_0 [label="Q Proj L2\nGPU: 4\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_k_1_0 [label="K Proj L2\nGPU: 4\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_v_1_0 [label="V Proj L2\nGPU: 4\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_attn_1_0 [label="Attention L2\nGPU: 4\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l2_q_1_1 [label="Q Proj L2\nGPU: 5\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_k_1_1 [label="K Proj L2\nGPU: 5\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_v_1_1 [label="V Proj L2\nGPU: 5\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_attn_1_1 [label="Attention L2\nGPU: 5\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l2_q_1_2 [label="Q Proj L2\nGPU: 6\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_k_1_2 [label="K Proj L2\nGPU: 6\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_v_1_2 [label="V Proj L2\nGPU: 6\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_attn_1_2 [label="Attention L2\nGPU: 6\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l2_q_1_3 [label="Q Proj L2\nGPU: 7\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_k_1_3 [label="K Proj L2\nGPU: 7\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_v_1_3 [label="V Proj L2\nGPU: 7\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_attn_1_3 [label="Attention L2\nGPU: 7\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
        }
        
        /* Head Group 2: GPUs 8-11 */
        subgraph cluster_l2_hg2 {
            label="Head Group 2 (Heads 16-23)";
            style=dashed;
            
            node [shape=rectangle, style=filled, fillcolor=lightgreen];
            l2_q_2_0 [label="Q Proj L2\nGPU: 8\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_k_2_0 [label="K Proj L2\nGPU: 8\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_v_2_0 [label="V Proj L2\nGPU: 8\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_attn_2_0 [label="Attention L2\nGPU: 8\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l2_q_2_1 [label="Q Proj L2\nGPU: 9\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_k_2_1 [label="K Proj L2\nGPU: 9\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_v_2_1 [label="V Proj L2\nGPU: 9\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_attn_2_1 [label="Attention L2\nGPU: 9\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l2_q_2_2 [label="Q Proj L2\nGPU: 10\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_k_2_2 [label="K Proj L2\nGPU: 10\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_v_2_2 [label="V Proj L2\nGPU: 10\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_attn_2_2 [label="Attention L2\nGPU: 10\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l2_q_2_3 [label="Q Proj L2\nGPU: 11\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_k_2_3 [label="K Proj L2\nGPU: 11\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_v_2_3 [label="V Proj L2\nGPU: 11\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_attn_2_3 [label="Attention L2\nGPU: 11\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
        }
        
        /* Head Group 3: GPUs 12-15 */
        subgraph cluster_l2_hg3 {
            label="Head Group 3 (Heads 24-31)";
            style=dashed;
            
            node [shape=rectangle, style=filled, fillcolor=lightgreen];
            l2_q_3_0 [label="Q Proj L2\nGPU: 12\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_k_3_0 [label="K Proj L2\nGPU: 12\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_v_3_0 [label="V Proj L2\nGPU: 12\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_attn_3_0 [label="Attention L2\nGPU: 12\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l2_q_3_1 [label="Q Proj L2\nGPU: 13\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_k_3_1 [label="K Proj L2\nGPU: 13\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_v_3_1 [label="V Proj L2\nGPU: 13\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_attn_3_1 [label="Attention L2\nGPU: 13\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l2_q_3_2 [label="Q Proj L2\nGPU: 14\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_k_3_2 [label="K Proj L2\nGPU: 14\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_v_3_2 [label="V Proj L2\nGPU: 14\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_attn_3_2 [label="Attention L2\nGPU: 14\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l2_q_3_3 [label="Q Proj L2\nGPU: 15\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_k_3_3 [label="K Proj L2\nGPU: 15\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_v_3_3 [label="V Proj L2\nGPU: 15\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l2_attn_3_3 [label="Attention L2\nGPU: 15\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
        }
        
        /* Concatenation and MLP */
        node [shape=parallelogram, style=filled, fillcolor=yellow];
        l2_concat [label="All-Gather Concat\nGPU: 0\nInput: 16×[128,10000,32,8]\nOutput: [128,10000,4096]"];
        
        node [shape=hexagon, style=filled, fillcolor=lightcoral];
        l2_mha_residual [label="MHA Residual L2\nGPU: 0\nInput1: [128,10000,4096]\nInput2: [128,10000,4096]\nOutput: [128,10000,4096]"];
        
        node [shape=rectangle, style=filled, fillcolor=lightgreen];
        l2_mlp_fc1 [label="MLP FC1 L2\nGPU: 0-15\nEach GPU: [4096,1024]\nInput: [128,10000,4096]\nOutput: [128,10000,1024]"];
        l2_mlp_fc2 [label="MLP FC2 L2\nGPU: 0-15\nEach GPU: [1024,4096]\nInput: [128,10000,1024]\nOutput: [128,10000,4096]"];
        
        node [shape=hexagon, style=filled, fillcolor=lightcoral];
        l2_mlp_residual [label="MLP Residual L2\nGPU: 0\nInput1: [128,10000,4096]\nInput2: [128,10000,4096]\nOutput: [128,10000,4096]"];
    }
    
    /* ======================================== */
    /* LAYER 3 - Complete 4×4 Helix Partitioning */
    /* ======================================== */
    subgraph cluster_layer3 {
        label="Layer 3 - 4×4 Helix (16 GPUs)";
        style=rounded, filled;
        fillcolor=lightgrey;
        
        /* Head Group 0: GPUs 0-3 */
        subgraph cluster_l3_hg0 {
            label="Head Group 0 (Heads 0-7)";
            style=dashed;
            
            node [shape=rectangle, style=filled, fillcolor=lightgreen];
            l3_q_0_0 [label="Q Proj L3\nGPU: 0\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_k_0_0 [label="K Proj L3\nGPU: 0\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_v_0_0 [label="V Proj L3\nGPU: 0\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_attn_0_0 [label="Attention L3\nGPU: 0\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l3_q_0_1 [label="Q Proj L3\nGPU: 1\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_k_0_1 [label="K Proj L3\nGPU: 1\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_v_0_1 [label="V Proj L3\nGPU: 1\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_attn_0_1 [label="Attention L3\nGPU: 1\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l3_q_0_2 [label="Q Proj L3\nGPU: 2\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_k_0_2 [label="K Proj L3\nGPU: 2\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_v_0_2 [label="V Proj L3\nGPU: 2\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_attn_0_2 [label="Attention L3\nGPU: 2\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l3_q_0_3 [label="Q Proj L3\nGPU: 3\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_k_0_3 [label="K Proj L3\nGPU: 3\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_v_0_3 [label="V Proj L3\nGPU: 3\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_attn_0_3 [label="Attention L3\nGPU: 3\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
        }
        
        /* Head Group 1: GPUs 4-7 */
        subgraph cluster_l3_hg1 {
            label="Head Group 1 (Heads 8-15)";
            style=dashed;
            
            node [shape=rectangle, style=filled, fillcolor=lightgreen];
            l3_q_1_0 [label="Q Proj L3\nGPU: 4\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_k_1_0 [label="K Proj L3\nGPU: 4\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_v_1_0 [label="V Proj L3\nGPU: 4\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_attn_1_0 [label="Attention L3\nGPU: 4\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l3_q_1_1 [label="Q Proj L3\nGPU: 5\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_k_1_1 [label="K Proj L3\nGPU: 5\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_v_1_1 [label="V Proj L3\nGPU: 5\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_attn_1_1 [label="Attention L3\nGPU: 5\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l3_q_1_2 [label="Q Proj L3\nGPU: 6\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_k_1_2 [label="K Proj L3\nGPU: 6\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_v_1_2 [label="V Proj L3\nGPU: 6\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_attn_1_2 [label="Attention L3\nGPU: 6\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
            
            l3_q_1_3 [label="Q Proj L3\nGPU: 7\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_k_1_3 [label="K Proj L3\nGPU: 7\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_v_1_3 [label="V Proj L3\nGPU: 7\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_attn_1_3 [label="Attention L3\nGPU: 7\nInput: [128,10000,32,8]×3\nOutput: [128,10000,32,8]"];
        }
        
        /* Head Group 2: GPUs 8-11 */
        subgraph cluster_l3_hg2 {
            label="Head Group 2 (Heads 16-23)";
            style=dashed;
            
            node [shape=rectangle, style=filled, fillcolor=lightgreen];
            l3_q_2_0 [label="Q Proj L3\nGPU: 8\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_k_2_0 [label="K Proj L3\nGPU: 8\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3_v_2_0 [label="V Proj L3\nGPU: 8\nWeight: [4096,256]\nInput: [128,10000,4096]\nOutput: [128,10000,32,8]"];
            l3