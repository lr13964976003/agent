// LLM Deployment DAG - EP1-TP1-PP1-DP8
digraph {
	rankdir=TB size="20,30"
	node [fontname=Arial fontsize=10]
	edge [fontname=Arial fontsize=9]
	input [label="Input\nBatch: 2048 sequences\nSeq_len: 512\nGPU: All" fillcolor=lightpink shape=ellipse style=filled]
	dp_split [label="Data Parallel Split\n256 seq/GPU\nGPU: All" fillcolor=lightyellow shape=parallelogram style=filled]
	input -> dp_split [label="Split batch\n2048â†’256 seq/GPU"]
	gpu0_embed [label="Embedding Layer\nInput: [256, 512]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	dp_split -> gpu0_embed [label="GPU 0\n256 sequences"]
	gpu0_layer0_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer0_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer0_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer0_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer0_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer0_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer0_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightgreen shape=ellipse style=filled]
	gpu0_layer0_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer0_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer0_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer0_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer0_routing -> gpu0_layer0_expert0 [label="Gate selection" style=dashed]
	gpu0_layer0_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer0_routing -> gpu0_layer0_expert1 [label="Gate selection" style=dashed]
	gpu0_layer0_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer0_routing -> gpu0_layer0_expert2 [label="Gate selection" style=dashed]
	gpu0_layer0_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer0_routing -> gpu0_layer0_expert3 [label="Gate selection" style=dashed]
	gpu0_layer0_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer0_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_embed -> gpu0_layer0_ln1
	gpu0_layer0_ln1 -> gpu0_layer0_qkv
	gpu0_layer0_qkv -> gpu0_layer0_reshape
	gpu0_layer0_reshape -> gpu0_layer0_attn
	gpu0_layer0_attn -> gpu0_layer0_attn_reshape
	gpu0_layer0_attn_reshape -> gpu0_layer0_attn_out
	gpu0_layer0_attn_out -> gpu0_layer0_kv_update
	gpu0_layer0_kv_update -> gpu0_layer0_res1
	gpu0_layer0_res1 -> gpu0_layer0_ln2
	gpu0_layer0_ln2 -> gpu0_layer0_routing
	gpu0_layer0_expert0 -> gpu0_layer0_expert_agg
	gpu0_layer0_expert1 -> gpu0_layer0_expert_agg
	gpu0_layer0_expert2 -> gpu0_layer0_expert_agg
	gpu0_layer0_expert3 -> gpu0_layer0_expert_agg
	gpu0_layer0_routing -> gpu0_layer0_expert_agg
	gpu0_layer0_expert_agg -> gpu0_layer0_res2
	gpu0_layer1_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer1_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer1_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer1_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer1_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer1_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer1_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightgreen shape=ellipse style=filled]
	gpu0_layer1_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer1_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer1_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer1_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer1_routing -> gpu0_layer1_expert0 [label="Gate selection" style=dashed]
	gpu0_layer1_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer1_routing -> gpu0_layer1_expert1 [label="Gate selection" style=dashed]
	gpu0_layer1_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer1_routing -> gpu0_layer1_expert2 [label="Gate selection" style=dashed]
	gpu0_layer1_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer1_routing -> gpu0_layer1_expert3 [label="Gate selection" style=dashed]
	gpu0_layer1_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer1_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer0_res2 -> gpu0_layer1_ln1
	gpu0_layer1_ln1 -> gpu0_layer1_qkv
	gpu0_layer1_qkv -> gpu0_layer1_reshape
	gpu0_layer1_reshape -> gpu0_layer1_attn
	gpu0_layer1_attn -> gpu0_layer1_attn_reshape
	gpu0_layer1_attn_reshape -> gpu0_layer1_attn_out
	gpu0_layer1_attn_out -> gpu0_layer1_kv_update
	gpu0_layer1_kv_update -> gpu0_layer1_res1
	gpu0_layer1_res1 -> gpu0_layer1_ln2
	gpu0_layer1_ln2 -> gpu0_layer1_routing
	gpu0_layer1_expert0 -> gpu0_layer1_expert_agg
	gpu0_layer1_expert1 -> gpu0_layer1_expert_agg
	gpu0_layer1_expert2 -> gpu0_layer1_expert_agg
	gpu0_layer1_expert3 -> gpu0_layer1_expert_agg
	gpu0_layer1_routing -> gpu0_layer1_expert_agg
	gpu0_layer1_expert_agg -> gpu0_layer1_res2
	gpu0_layer2_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer2_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer2_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer2_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer2_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer2_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer2_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightgreen shape=ellipse style=filled]
	gpu0_layer2_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer2_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer2_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer2_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer2_routing -> gpu0_layer2_expert0 [label="Gate selection" style=dashed]
	gpu0_layer2_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer2_routing -> gpu0_layer2_expert1 [label="Gate selection" style=dashed]
	gpu0_layer2_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer2_routing -> gpu0_layer2_expert2 [label="Gate selection" style=dashed]
	gpu0_layer2_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer2_routing -> gpu0_layer2_expert3 [label="Gate selection" style=dashed]
	gpu0_layer2_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer2_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer1_res2 -> gpu0_layer2_ln1
	gpu0_layer2_ln1 -> gpu0_layer2_qkv
	gpu0_layer2_qkv -> gpu0_layer2_reshape
	gpu0_layer2_reshape -> gpu0_layer2_attn
	gpu0_layer2_attn -> gpu0_layer2_attn_reshape
	gpu0_layer2_attn_reshape -> gpu0_layer2_attn_out
	gpu0_layer2_attn_out -> gpu0_layer2_kv_update
	gpu0_layer2_kv_update -> gpu0_layer2_res1
	gpu0_layer2_res1 -> gpu0_layer2_ln2
	gpu0_layer2_ln2 -> gpu0_layer2_routing
	gpu0_layer2_expert0 -> gpu0_layer2_expert_agg
	gpu0_layer2_expert1 -> gpu0_layer2_expert_agg
	gpu0_layer2_expert2 -> gpu0_layer2_expert_agg
	gpu0_layer2_expert3 -> gpu0_layer2_expert_agg
	gpu0_layer2_routing -> gpu0_layer2_expert_agg
	gpu0_layer2_expert_agg -> gpu0_layer2_res2
	gpu0_layer3_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer3_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer3_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer3_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer3_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer3_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer3_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightgreen shape=ellipse style=filled]
	gpu0_layer3_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer3_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer3_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer3_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer3_routing -> gpu0_layer3_expert0 [label="Gate selection" style=dashed]
	gpu0_layer3_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer3_routing -> gpu0_layer3_expert1 [label="Gate selection" style=dashed]
	gpu0_layer3_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer3_routing -> gpu0_layer3_expert2 [label="Gate selection" style=dashed]
	gpu0_layer3_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer3_routing -> gpu0_layer3_expert3 [label="Gate selection" style=dashed]
	gpu0_layer3_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer3_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer2_res2 -> gpu0_layer3_ln1
	gpu0_layer3_ln1 -> gpu0_layer3_qkv
	gpu0_layer3_qkv -> gpu0_layer3_reshape
	gpu0_layer3_reshape -> gpu0_layer3_attn
	gpu0_layer3_attn -> gpu0_layer3_attn_reshape
	gpu0_layer3_attn_reshape -> gpu0_layer3_attn_out
	gpu0_layer3_attn_out -> gpu0_layer3_kv_update
	gpu0_layer3_kv_update -> gpu0_layer3_res1
	gpu0_layer3_res1 -> gpu0_layer3_ln2
	gpu0_layer3_ln2 -> gpu0_layer3_routing
	gpu0_layer3_expert0 -> gpu0_layer3_expert_agg
	gpu0_layer3_expert1 -> gpu0_layer3_expert_agg
	gpu0_layer3_expert2 -> gpu0_layer3_expert_agg
	gpu0_layer3_expert3 -> gpu0_layer3_expert_agg
	gpu0_layer3_routing -> gpu0_layer3_expert_agg
	gpu0_layer3_expert_agg -> gpu0_layer3_res2
	gpu0_layer4_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer4_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer4_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer4_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer4_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer4_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer4_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightgreen shape=ellipse style=filled]
	gpu0_layer4_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer4_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer4_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer4_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer4_routing -> gpu0_layer4_expert0 [label="Gate selection" style=dashed]
	gpu0_layer4_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer4_routing -> gpu0_layer4_expert1 [label="Gate selection" style=dashed]
	gpu0_layer4_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer4_routing -> gpu0_layer4_expert2 [label="Gate selection" style=dashed]
	gpu0_layer4_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer4_routing -> gpu0_layer4_expert3 [label="Gate selection" style=dashed]
	gpu0_layer4_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer4_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer3_res2 -> gpu0_layer4_ln1
	gpu0_layer4_ln1 -> gpu0_layer4_qkv
	gpu0_layer4_qkv -> gpu0_layer4_reshape
	gpu0_layer4_reshape -> gpu0_layer4_attn
	gpu0_layer4_attn -> gpu0_layer4_attn_reshape
	gpu0_layer4_attn_reshape -> gpu0_layer4_attn_out
	gpu0_layer4_attn_out -> gpu0_layer4_kv_update
	gpu0_layer4_kv_update -> gpu0_layer4_res1
	gpu0_layer4_res1 -> gpu0_layer4_ln2
	gpu0_layer4_ln2 -> gpu0_layer4_routing
	gpu0_layer4_expert0 -> gpu0_layer4_expert_agg
	gpu0_layer4_expert1 -> gpu0_layer4_expert_agg
	gpu0_layer4_expert2 -> gpu0_layer4_expert_agg
	gpu0_layer4_expert3 -> gpu0_layer4_expert_agg
	gpu0_layer4_routing -> gpu0_layer4_expert_agg
	gpu0_layer4_expert_agg -> gpu0_layer4_res2
	gpu0_layer5_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer5_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer5_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer5_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer5_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer5_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer5_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightgreen shape=ellipse style=filled]
	gpu0_layer5_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer5_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer5_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer5_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer5_routing -> gpu0_layer5_expert0 [label="Gate selection" style=dashed]
	gpu0_layer5_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer5_routing -> gpu0_layer5_expert1 [label="Gate selection" style=dashed]
	gpu0_layer5_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer5_routing -> gpu0_layer5_expert2 [label="Gate selection" style=dashed]
	gpu0_layer5_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer5_routing -> gpu0_layer5_expert3 [label="Gate selection" style=dashed]
	gpu0_layer5_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer5_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer4_res2 -> gpu0_layer5_ln1
	gpu0_layer5_ln1 -> gpu0_layer5_qkv
	gpu0_layer5_qkv -> gpu0_layer5_reshape
	gpu0_layer5_reshape -> gpu0_layer5_attn
	gpu0_layer5_attn -> gpu0_layer5_attn_reshape
	gpu0_layer5_attn_reshape -> gpu0_layer5_attn_out
	gpu0_layer5_attn_out -> gpu0_layer5_kv_update
	gpu0_layer5_kv_update -> gpu0_layer5_res1
	gpu0_layer5_res1 -> gpu0_layer5_ln2
	gpu0_layer5_ln2 -> gpu0_layer5_routing
	gpu0_layer5_expert0 -> gpu0_layer5_expert_agg
	gpu0_layer5_expert1 -> gpu0_layer5_expert_agg
	gpu0_layer5_expert2 -> gpu0_layer5_expert_agg
	gpu0_layer5_expert3 -> gpu0_layer5_expert_agg
	gpu0_layer5_routing -> gpu0_layer5_expert_agg
	gpu0_layer5_expert_agg -> gpu0_layer5_res2
	gpu0_layer6_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer6_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer6_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer6_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer6_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer6_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer6_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightgreen shape=ellipse style=filled]
	gpu0_layer6_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer6_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer6_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer6_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer6_routing -> gpu0_layer6_expert0 [label="Gate selection" style=dashed]
	gpu0_layer6_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer6_routing -> gpu0_layer6_expert1 [label="Gate selection" style=dashed]
	gpu0_layer6_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer6_routing -> gpu0_layer6_expert2 [label="Gate selection" style=dashed]
	gpu0_layer6_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer6_routing -> gpu0_layer6_expert3 [label="Gate selection" style=dashed]
	gpu0_layer6_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer6_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer5_res2 -> gpu0_layer6_ln1
	gpu0_layer6_ln1 -> gpu0_layer6_qkv
	gpu0_layer6_qkv -> gpu0_layer6_reshape
	gpu0_layer6_reshape -> gpu0_layer6_attn
	gpu0_layer6_attn -> gpu0_layer6_attn_reshape
	gpu0_layer6_attn_reshape -> gpu0_layer6_attn_out
	gpu0_layer6_attn_out -> gpu0_layer6_kv_update
	gpu0_layer6_kv_update -> gpu0_layer6_res1
	gpu0_layer6_res1 -> gpu0_layer6_ln2
	gpu0_layer6_ln2 -> gpu0_layer6_routing
	gpu0_layer6_expert0 -> gpu0_layer6_expert_agg
	gpu0_layer6_expert1 -> gpu0_layer6_expert_agg
	gpu0_layer6_expert2 -> gpu0_layer6_expert_agg
	gpu0_layer6_expert3 -> gpu0_layer6_expert_agg
	gpu0_layer6_routing -> gpu0_layer6_expert_agg
	gpu0_layer6_expert_agg -> gpu0_layer6_res2
	gpu0_layer7_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer7_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer7_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer7_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer7_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer7_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer7_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightgreen shape=ellipse style=filled]
	gpu0_layer7_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer7_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer7_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer7_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer7_routing -> gpu0_layer7_expert0 [label="Gate selection" style=dashed]
	gpu0_layer7_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer7_routing -> gpu0_layer7_expert1 [label="Gate selection" style=dashed]
	gpu0_layer7_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer7_routing -> gpu0_layer7_expert2 [label="Gate selection" style=dashed]
	gpu0_layer7_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer7_routing -> gpu0_layer7_expert3 [label="Gate selection" style=dashed]
	gpu0_layer7_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer7_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer6_res2 -> gpu0_layer7_ln1
	gpu0_layer7_ln1 -> gpu0_layer7_qkv
	gpu0_layer7_qkv -> gpu0_layer7_reshape
	gpu0_layer7_reshape -> gpu0_layer7_attn
	gpu0_layer7_attn -> gpu0_layer7_attn_reshape
	gpu0_layer7_attn_reshape -> gpu0_layer7_attn_out
	gpu0_layer7_attn_out -> gpu0_layer7_kv_update
	gpu0_layer7_kv_update -> gpu0_layer7_res1
	gpu0_layer7_res1 -> gpu0_layer7_ln2
	gpu0_layer7_ln2 -> gpu0_layer7_routing
	gpu0_layer7_expert0 -> gpu0_layer7_expert_agg
	gpu0_layer7_expert1 -> gpu0_layer7_expert_agg
	gpu0_layer7_expert2 -> gpu0_layer7_expert_agg
	gpu0_layer7_expert3 -> gpu0_layer7_expert_agg
	gpu0_layer7_routing -> gpu0_layer7_expert_agg
	gpu0_layer7_expert_agg -> gpu0_layer7_res2
	gpu0_layer8_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer8_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer8_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer8_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer8_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer8_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer8_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightgreen shape=ellipse style=filled]
	gpu0_layer8_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer8_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer8_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer8_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer8_routing -> gpu0_layer8_expert0 [label="Gate selection" style=dashed]
	gpu0_layer8_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer8_routing -> gpu0_layer8_expert1 [label="Gate selection" style=dashed]
	gpu0_layer8_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer8_routing -> gpu0_layer8_expert2 [label="Gate selection" style=dashed]
	gpu0_layer8_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer8_routing -> gpu0_layer8_expert3 [label="Gate selection" style=dashed]
	gpu0_layer8_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer8_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer7_res2 -> gpu0_layer8_ln1
	gpu0_layer8_ln1 -> gpu0_layer8_qkv
	gpu0_layer8_qkv -> gpu0_layer8_reshape
	gpu0_layer8_reshape -> gpu0_layer8_attn
	gpu0_layer8_attn -> gpu0_layer8_attn_reshape
	gpu0_layer8_attn_reshape -> gpu0_layer8_attn_out
	gpu0_layer8_attn_out -> gpu0_layer8_kv_update
	gpu0_layer8_kv_update -> gpu0_layer8_res1
	gpu0_layer8_res1 -> gpu0_layer8_ln2
	gpu0_layer8_ln2 -> gpu0_layer8_routing
	gpu0_layer8_expert0 -> gpu0_layer8_expert_agg
	gpu0_layer8_expert1 -> gpu0_layer8_expert_agg
	gpu0_layer8_expert2 -> gpu0_layer8_expert_agg
	gpu0_layer8_expert3 -> gpu0_layer8_expert_agg
	gpu0_layer8_routing -> gpu0_layer8_expert_agg
	gpu0_layer8_expert_agg -> gpu0_layer8_res2
	gpu0_layer9_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer9_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer9_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer9_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer9_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer9_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer9_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightgreen shape=ellipse style=filled]
	gpu0_layer9_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer9_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer9_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer9_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer9_routing -> gpu0_layer9_expert0 [label="Gate selection" style=dashed]
	gpu0_layer9_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer9_routing -> gpu0_layer9_expert1 [label="Gate selection" style=dashed]
	gpu0_layer9_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer9_routing -> gpu0_layer9_expert2 [label="Gate selection" style=dashed]
	gpu0_layer9_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer9_routing -> gpu0_layer9_expert3 [label="Gate selection" style=dashed]
	gpu0_layer9_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer9_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer8_res2 -> gpu0_layer9_ln1
	gpu0_layer9_ln1 -> gpu0_layer9_qkv
	gpu0_layer9_qkv -> gpu0_layer9_reshape
	gpu0_layer9_reshape -> gpu0_layer9_attn
	gpu0_layer9_attn -> gpu0_layer9_attn_reshape
	gpu0_layer9_attn_reshape -> gpu0_layer9_attn_out
	gpu0_layer9_attn_out -> gpu0_layer9_kv_update
	gpu0_layer9_kv_update -> gpu0_layer9_res1
	gpu0_layer9_res1 -> gpu0_layer9_ln2
	gpu0_layer9_ln2 -> gpu0_layer9_routing
	gpu0_layer9_expert0 -> gpu0_layer9_expert_agg
	gpu0_layer9_expert1 -> gpu0_layer9_expert_agg
	gpu0_layer9_expert2 -> gpu0_layer9_expert_agg
	gpu0_layer9_expert3 -> gpu0_layer9_expert_agg
	gpu0_layer9_routing -> gpu0_layer9_expert_agg
	gpu0_layer9_expert_agg -> gpu0_layer9_res2
	gpu0_layer10_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer10_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer10_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer10_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer10_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer10_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer10_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightgreen shape=ellipse style=filled]
	gpu0_layer10_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer10_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer10_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer10_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer10_routing -> gpu0_layer10_expert0 [label="Gate selection" style=dashed]
	gpu0_layer10_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer10_routing -> gpu0_layer10_expert1 [label="Gate selection" style=dashed]
	gpu0_layer10_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer10_routing -> gpu0_layer10_expert2 [label="Gate selection" style=dashed]
	gpu0_layer10_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer10_routing -> gpu0_layer10_expert3 [label="Gate selection" style=dashed]
	gpu0_layer10_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer10_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer9_res2 -> gpu0_layer10_ln1
	gpu0_layer10_ln1 -> gpu0_layer10_qkv
	gpu0_layer10_qkv -> gpu0_layer10_reshape
	gpu0_layer10_reshape -> gpu0_layer10_attn
	gpu0_layer10_attn -> gpu0_layer10_attn_reshape
	gpu0_layer10_attn_reshape -> gpu0_layer10_attn_out
	gpu0_layer10_attn_out -> gpu0_layer10_kv_update
	gpu0_layer10_kv_update -> gpu0_layer10_res1
	gpu0_layer10_res1 -> gpu0_layer10_ln2
	gpu0_layer10_ln2 -> gpu0_layer10_routing
	gpu0_layer10_expert0 -> gpu0_layer10_expert_agg
	gpu0_layer10_expert1 -> gpu0_layer10_expert_agg
	gpu0_layer10_expert2 -> gpu0_layer10_expert_agg
	gpu0_layer10_expert3 -> gpu0_layer10_expert_agg
	gpu0_layer10_routing -> gpu0_layer10_expert_agg
	gpu0_layer10_expert_agg -> gpu0_layer10_res2
	gpu0_layer11_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer11_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer11_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer11_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer11_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer11_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer11_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightgreen shape=ellipse style=filled]
	gpu0_layer11_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer11_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer11_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer11_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer11_routing -> gpu0_layer11_expert0 [label="Gate selection" style=dashed]
	gpu0_layer11_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer11_routing -> gpu0_layer11_expert1 [label="Gate selection" style=dashed]
	gpu0_layer11_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer11_routing -> gpu0_layer11_expert2 [label="Gate selection" style=dashed]
	gpu0_layer11_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer11_routing -> gpu0_layer11_expert3 [label="Gate selection" style=dashed]
	gpu0_layer11_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer11_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer10_res2 -> gpu0_layer11_ln1
	gpu0_layer11_ln1 -> gpu0_layer11_qkv
	gpu0_layer11_qkv -> gpu0_layer11_reshape
	gpu0_layer11_reshape -> gpu0_layer11_attn
	gpu0_layer11_attn -> gpu0_layer11_attn_reshape
	gpu0_layer11_attn_reshape -> gpu0_layer11_attn_out
	gpu0_layer11_attn_out -> gpu0_layer11_kv_update
	gpu0_layer11_kv_update -> gpu0_layer11_res1
	gpu0_layer11_res1 -> gpu0_layer11_ln2
	gpu0_layer11_ln2 -> gpu0_layer11_routing
	gpu0_layer11_expert0 -> gpu0_layer11_expert_agg
	gpu0_layer11_expert1 -> gpu0_layer11_expert_agg
	gpu0_layer11_expert2 -> gpu0_layer11_expert_agg
	gpu0_layer11_expert3 -> gpu0_layer11_expert_agg
	gpu0_layer11_routing -> gpu0_layer11_expert_agg
	gpu0_layer11_expert_agg -> gpu0_layer11_res2
	gpu0_layer12_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer12_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer12_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer12_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer12_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer12_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer12_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightgreen shape=ellipse style=filled]
	gpu0_layer12_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer12_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer12_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer12_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer12_routing -> gpu0_layer12_expert0 [label="Gate selection" style=dashed]
	gpu0_layer12_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer12_routing -> gpu0_layer12_expert1 [label="Gate selection" style=dashed]
	gpu0_layer12_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer12_routing -> gpu0_layer12_expert2 [label="Gate selection" style=dashed]
	gpu0_layer12_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer12_routing -> gpu0_layer12_expert3 [label="Gate selection" style=dashed]
	gpu0_layer12_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer12_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer11_res2 -> gpu0_layer12_ln1
	gpu0_layer12_ln1 -> gpu0_layer12_qkv
	gpu0_layer12_qkv -> gpu0_layer12_reshape
	gpu0_layer12_reshape -> gpu0_layer12_attn
	gpu0_layer12_attn -> gpu0_layer12_attn_reshape
	gpu0_layer12_attn_reshape -> gpu0_layer12_attn_out
	gpu0_layer12_attn_out -> gpu0_layer12_kv_update
	gpu0_layer12_kv_update -> gpu0_layer12_res1
	gpu0_layer12_res1 -> gpu0_layer12_ln2
	gpu0_layer12_ln2 -> gpu0_layer12_routing
	gpu0_layer12_expert0 -> gpu0_layer12_expert_agg
	gpu0_layer12_expert1 -> gpu0_layer12_expert_agg
	gpu0_layer12_expert2 -> gpu0_layer12_expert_agg
	gpu0_layer12_expert3 -> gpu0_layer12_expert_agg
	gpu0_layer12_routing -> gpu0_layer12_expert_agg
	gpu0_layer12_expert_agg -> gpu0_layer12_res2
	gpu0_layer13_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer13_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer13_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer13_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer13_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer13_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer13_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightgreen shape=ellipse style=filled]
	gpu0_layer13_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer13_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer13_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer13_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer13_routing -> gpu0_layer13_expert0 [label="Gate selection" style=dashed]
	gpu0_layer13_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer13_routing -> gpu0_layer13_expert1 [label="Gate selection" style=dashed]
	gpu0_layer13_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer13_routing -> gpu0_layer13_expert2 [label="Gate selection" style=dashed]
	gpu0_layer13_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer13_routing -> gpu0_layer13_expert3 [label="Gate selection" style=dashed]
	gpu0_layer13_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer13_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer12_res2 -> gpu0_layer13_ln1
	gpu0_layer13_ln1 -> gpu0_layer13_qkv
	gpu0_layer13_qkv -> gpu0_layer13_reshape
	gpu0_layer13_reshape -> gpu0_layer13_attn
	gpu0_layer13_attn -> gpu0_layer13_attn_reshape
	gpu0_layer13_attn_reshape -> gpu0_layer13_attn_out
	gpu0_layer13_attn_out -> gpu0_layer13_kv_update
	gpu0_layer13_kv_update -> gpu0_layer13_res1
	gpu0_layer13_res1 -> gpu0_layer13_ln2
	gpu0_layer13_ln2 -> gpu0_layer13_routing
	gpu0_layer13_expert0 -> gpu0_layer13_expert_agg
	gpu0_layer13_expert1 -> gpu0_layer13_expert_agg
	gpu0_layer13_expert2 -> gpu0_layer13_expert_agg
	gpu0_layer13_expert3 -> gpu0_layer13_expert_agg
	gpu0_layer13_routing -> gpu0_layer13_expert_agg
	gpu0_layer13_expert_agg -> gpu0_layer13_res2
	gpu0_layer14_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer14_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer14_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer14_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer14_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer14_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer14_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightgreen shape=ellipse style=filled]
	gpu0_layer14_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer14_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer14_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer14_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer14_routing -> gpu0_layer14_expert0 [label="Gate selection" style=dashed]
	gpu0_layer14_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer14_routing -> gpu0_layer14_expert1 [label="Gate selection" style=dashed]
	gpu0_layer14_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer14_routing -> gpu0_layer14_expert2 [label="Gate selection" style=dashed]
	gpu0_layer14_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer14_routing -> gpu0_layer14_expert3 [label="Gate selection" style=dashed]
	gpu0_layer14_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer14_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer13_res2 -> gpu0_layer14_ln1
	gpu0_layer14_ln1 -> gpu0_layer14_qkv
	gpu0_layer14_qkv -> gpu0_layer14_reshape
	gpu0_layer14_reshape -> gpu0_layer14_attn
	gpu0_layer14_attn -> gpu0_layer14_attn_reshape
	gpu0_layer14_attn_reshape -> gpu0_layer14_attn_out
	gpu0_layer14_attn_out -> gpu0_layer14_kv_update
	gpu0_layer14_kv_update -> gpu0_layer14_res1
	gpu0_layer14_res1 -> gpu0_layer14_ln2
	gpu0_layer14_ln2 -> gpu0_layer14_routing
	gpu0_layer14_expert0 -> gpu0_layer14_expert_agg
	gpu0_layer14_expert1 -> gpu0_layer14_expert_agg
	gpu0_layer14_expert2 -> gpu0_layer14_expert_agg
	gpu0_layer14_expert3 -> gpu0_layer14_expert_agg
	gpu0_layer14_routing -> gpu0_layer14_expert_agg
	gpu0_layer14_expert_agg -> gpu0_layer14_res2
	gpu0_layer15_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer15_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer15_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer15_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer15_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer15_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer15_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightgreen shape=ellipse style=filled]
	gpu0_layer15_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer15_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer15_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer15_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer15_routing -> gpu0_layer15_expert0 [label="Gate selection" style=dashed]
	gpu0_layer15_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer15_routing -> gpu0_layer15_expert1 [label="Gate selection" style=dashed]
	gpu0_layer15_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer15_routing -> gpu0_layer15_expert2 [label="Gate selection" style=dashed]
	gpu0_layer15_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer15_routing -> gpu0_layer15_expert3 [label="Gate selection" style=dashed]
	gpu0_layer15_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu0_layer15_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer14_res2 -> gpu0_layer15_ln1
	gpu0_layer15_ln1 -> gpu0_layer15_qkv
	gpu0_layer15_qkv -> gpu0_layer15_reshape
	gpu0_layer15_reshape -> gpu0_layer15_attn
	gpu0_layer15_attn -> gpu0_layer15_attn_reshape
	gpu0_layer15_attn_reshape -> gpu0_layer15_attn_out
	gpu0_layer15_attn_out -> gpu0_layer15_kv_update
	gpu0_layer15_kv_update -> gpu0_layer15_res1
	gpu0_layer15_res1 -> gpu0_layer15_ln2
	gpu0_layer15_ln2 -> gpu0_layer15_routing
	gpu0_layer15_expert0 -> gpu0_layer15_expert_agg
	gpu0_layer15_expert1 -> gpu0_layer15_expert_agg
	gpu0_layer15_expert2 -> gpu0_layer15_expert_agg
	gpu0_layer15_expert3 -> gpu0_layer15_expert_agg
	gpu0_layer15_routing -> gpu0_layer15_expert_agg
	gpu0_layer15_expert_agg -> gpu0_layer15_res2
	gpu0_final_ln [label="Final LayerNorm\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_layer15_res2 -> gpu0_final_ln
	gpu0_output_proj [label="Output Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 32000]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_final_ln -> gpu0_output_proj
	gpu0_softmax [label="Softmax\nInput: [256, 512, 32000]\nOutput: [256, 512, 32000]\nGPU: GPU0" fillcolor=lightblue shape=rectangle style=filled]
	gpu0_output_proj -> gpu0_softmax
	gpu1_embed [label="Embedding Layer\nInput: [256, 512]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	dp_split -> gpu1_embed [label="GPU 1\n256 sequences"]
	gpu1_layer0_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer0_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer0_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer0_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer0_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer0_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer0_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightgreen shape=ellipse style=filled]
	gpu1_layer0_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer0_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer0_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer0_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer0_routing -> gpu1_layer0_expert0 [label="Gate selection" style=dashed]
	gpu1_layer0_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer0_routing -> gpu1_layer0_expert1 [label="Gate selection" style=dashed]
	gpu1_layer0_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer0_routing -> gpu1_layer0_expert2 [label="Gate selection" style=dashed]
	gpu1_layer0_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer0_routing -> gpu1_layer0_expert3 [label="Gate selection" style=dashed]
	gpu1_layer0_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer0_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_embed -> gpu1_layer0_ln1
	gpu1_layer0_ln1 -> gpu1_layer0_qkv
	gpu1_layer0_qkv -> gpu1_layer0_reshape
	gpu1_layer0_reshape -> gpu1_layer0_attn
	gpu1_layer0_attn -> gpu1_layer0_attn_reshape
	gpu1_layer0_attn_reshape -> gpu1_layer0_attn_out
	gpu1_layer0_attn_out -> gpu1_layer0_kv_update
	gpu1_layer0_kv_update -> gpu1_layer0_res1
	gpu1_layer0_res1 -> gpu1_layer0_ln2
	gpu1_layer0_ln2 -> gpu1_layer0_routing
	gpu1_layer0_expert0 -> gpu1_layer0_expert_agg
	gpu1_layer0_expert1 -> gpu1_layer0_expert_agg
	gpu1_layer0_expert2 -> gpu1_layer0_expert_agg
	gpu1_layer0_expert3 -> gpu1_layer0_expert_agg
	gpu1_layer0_routing -> gpu1_layer0_expert_agg
	gpu1_layer0_expert_agg -> gpu1_layer0_res2
	gpu1_layer1_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer1_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer1_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer1_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer1_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer1_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer1_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightgreen shape=ellipse style=filled]
	gpu1_layer1_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer1_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer1_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer1_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer1_routing -> gpu1_layer1_expert0 [label="Gate selection" style=dashed]
	gpu1_layer1_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer1_routing -> gpu1_layer1_expert1 [label="Gate selection" style=dashed]
	gpu1_layer1_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer1_routing -> gpu1_layer1_expert2 [label="Gate selection" style=dashed]
	gpu1_layer1_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer1_routing -> gpu1_layer1_expert3 [label="Gate selection" style=dashed]
	gpu1_layer1_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer1_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer0_res2 -> gpu1_layer1_ln1
	gpu1_layer1_ln1 -> gpu1_layer1_qkv
	gpu1_layer1_qkv -> gpu1_layer1_reshape
	gpu1_layer1_reshape -> gpu1_layer1_attn
	gpu1_layer1_attn -> gpu1_layer1_attn_reshape
	gpu1_layer1_attn_reshape -> gpu1_layer1_attn_out
	gpu1_layer1_attn_out -> gpu1_layer1_kv_update
	gpu1_layer1_kv_update -> gpu1_layer1_res1
	gpu1_layer1_res1 -> gpu1_layer1_ln2
	gpu1_layer1_ln2 -> gpu1_layer1_routing
	gpu1_layer1_expert0 -> gpu1_layer1_expert_agg
	gpu1_layer1_expert1 -> gpu1_layer1_expert_agg
	gpu1_layer1_expert2 -> gpu1_layer1_expert_agg
	gpu1_layer1_expert3 -> gpu1_layer1_expert_agg
	gpu1_layer1_routing -> gpu1_layer1_expert_agg
	gpu1_layer1_expert_agg -> gpu1_layer1_res2
	gpu1_layer2_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer2_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer2_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer2_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer2_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer2_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer2_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightgreen shape=ellipse style=filled]
	gpu1_layer2_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer2_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer2_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer2_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer2_routing -> gpu1_layer2_expert0 [label="Gate selection" style=dashed]
	gpu1_layer2_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer2_routing -> gpu1_layer2_expert1 [label="Gate selection" style=dashed]
	gpu1_layer2_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer2_routing -> gpu1_layer2_expert2 [label="Gate selection" style=dashed]
	gpu1_layer2_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer2_routing -> gpu1_layer2_expert3 [label="Gate selection" style=dashed]
	gpu1_layer2_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer2_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer1_res2 -> gpu1_layer2_ln1
	gpu1_layer2_ln1 -> gpu1_layer2_qkv
	gpu1_layer2_qkv -> gpu1_layer2_reshape
	gpu1_layer2_reshape -> gpu1_layer2_attn
	gpu1_layer2_attn -> gpu1_layer2_attn_reshape
	gpu1_layer2_attn_reshape -> gpu1_layer2_attn_out
	gpu1_layer2_attn_out -> gpu1_layer2_kv_update
	gpu1_layer2_kv_update -> gpu1_layer2_res1
	gpu1_layer2_res1 -> gpu1_layer2_ln2
	gpu1_layer2_ln2 -> gpu1_layer2_routing
	gpu1_layer2_expert0 -> gpu1_layer2_expert_agg
	gpu1_layer2_expert1 -> gpu1_layer2_expert_agg
	gpu1_layer2_expert2 -> gpu1_layer2_expert_agg
	gpu1_layer2_expert3 -> gpu1_layer2_expert_agg
	gpu1_layer2_routing -> gpu1_layer2_expert_agg
	gpu1_layer2_expert_agg -> gpu1_layer2_res2
	gpu1_layer3_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer3_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer3_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer3_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer3_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer3_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer3_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightgreen shape=ellipse style=filled]
	gpu1_layer3_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer3_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer3_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer3_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer3_routing -> gpu1_layer3_expert0 [label="Gate selection" style=dashed]
	gpu1_layer3_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer3_routing -> gpu1_layer3_expert1 [label="Gate selection" style=dashed]
	gpu1_layer3_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer3_routing -> gpu1_layer3_expert2 [label="Gate selection" style=dashed]
	gpu1_layer3_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer3_routing -> gpu1_layer3_expert3 [label="Gate selection" style=dashed]
	gpu1_layer3_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer3_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer2_res2 -> gpu1_layer3_ln1
	gpu1_layer3_ln1 -> gpu1_layer3_qkv
	gpu1_layer3_qkv -> gpu1_layer3_reshape
	gpu1_layer3_reshape -> gpu1_layer3_attn
	gpu1_layer3_attn -> gpu1_layer3_attn_reshape
	gpu1_layer3_attn_reshape -> gpu1_layer3_attn_out
	gpu1_layer3_attn_out -> gpu1_layer3_kv_update
	gpu1_layer3_kv_update -> gpu1_layer3_res1
	gpu1_layer3_res1 -> gpu1_layer3_ln2
	gpu1_layer3_ln2 -> gpu1_layer3_routing
	gpu1_layer3_expert0 -> gpu1_layer3_expert_agg
	gpu1_layer3_expert1 -> gpu1_layer3_expert_agg
	gpu1_layer3_expert2 -> gpu1_layer3_expert_agg
	gpu1_layer3_expert3 -> gpu1_layer3_expert_agg
	gpu1_layer3_routing -> gpu1_layer3_expert_agg
	gpu1_layer3_expert_agg -> gpu1_layer3_res2
	gpu1_layer4_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer4_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer4_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer4_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer4_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer4_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer4_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightgreen shape=ellipse style=filled]
	gpu1_layer4_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer4_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer4_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer4_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer4_routing -> gpu1_layer4_expert0 [label="Gate selection" style=dashed]
	gpu1_layer4_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer4_routing -> gpu1_layer4_expert1 [label="Gate selection" style=dashed]
	gpu1_layer4_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer4_routing -> gpu1_layer4_expert2 [label="Gate selection" style=dashed]
	gpu1_layer4_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer4_routing -> gpu1_layer4_expert3 [label="Gate selection" style=dashed]
	gpu1_layer4_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer4_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer3_res2 -> gpu1_layer4_ln1
	gpu1_layer4_ln1 -> gpu1_layer4_qkv
	gpu1_layer4_qkv -> gpu1_layer4_reshape
	gpu1_layer4_reshape -> gpu1_layer4_attn
	gpu1_layer4_attn -> gpu1_layer4_attn_reshape
	gpu1_layer4_attn_reshape -> gpu1_layer4_attn_out
	gpu1_layer4_attn_out -> gpu1_layer4_kv_update
	gpu1_layer4_kv_update -> gpu1_layer4_res1
	gpu1_layer4_res1 -> gpu1_layer4_ln2
	gpu1_layer4_ln2 -> gpu1_layer4_routing
	gpu1_layer4_expert0 -> gpu1_layer4_expert_agg
	gpu1_layer4_expert1 -> gpu1_layer4_expert_agg
	gpu1_layer4_expert2 -> gpu1_layer4_expert_agg
	gpu1_layer4_expert3 -> gpu1_layer4_expert_agg
	gpu1_layer4_routing -> gpu1_layer4_expert_agg
	gpu1_layer4_expert_agg -> gpu1_layer4_res2
	gpu1_layer5_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer5_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer5_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer5_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer5_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer5_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer5_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightgreen shape=ellipse style=filled]
	gpu1_layer5_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer5_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer5_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer5_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer5_routing -> gpu1_layer5_expert0 [label="Gate selection" style=dashed]
	gpu1_layer5_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer5_routing -> gpu1_layer5_expert1 [label="Gate selection" style=dashed]
	gpu1_layer5_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer5_routing -> gpu1_layer5_expert2 [label="Gate selection" style=dashed]
	gpu1_layer5_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer5_routing -> gpu1_layer5_expert3 [label="Gate selection" style=dashed]
	gpu1_layer5_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer5_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer4_res2 -> gpu1_layer5_ln1
	gpu1_layer5_ln1 -> gpu1_layer5_qkv
	gpu1_layer5_qkv -> gpu1_layer5_reshape
	gpu1_layer5_reshape -> gpu1_layer5_attn
	gpu1_layer5_attn -> gpu1_layer5_attn_reshape
	gpu1_layer5_attn_reshape -> gpu1_layer5_attn_out
	gpu1_layer5_attn_out -> gpu1_layer5_kv_update
	gpu1_layer5_kv_update -> gpu1_layer5_res1
	gpu1_layer5_res1 -> gpu1_layer5_ln2
	gpu1_layer5_ln2 -> gpu1_layer5_routing
	gpu1_layer5_expert0 -> gpu1_layer5_expert_agg
	gpu1_layer5_expert1 -> gpu1_layer5_expert_agg
	gpu1_layer5_expert2 -> gpu1_layer5_expert_agg
	gpu1_layer5_expert3 -> gpu1_layer5_expert_agg
	gpu1_layer5_routing -> gpu1_layer5_expert_agg
	gpu1_layer5_expert_agg -> gpu1_layer5_res2
	gpu1_layer6_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer6_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer6_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer6_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer6_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer6_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer6_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightgreen shape=ellipse style=filled]
	gpu1_layer6_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer6_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer6_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer6_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer6_routing -> gpu1_layer6_expert0 [label="Gate selection" style=dashed]
	gpu1_layer6_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer6_routing -> gpu1_layer6_expert1 [label="Gate selection" style=dashed]
	gpu1_layer6_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer6_routing -> gpu1_layer6_expert2 [label="Gate selection" style=dashed]
	gpu1_layer6_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer6_routing -> gpu1_layer6_expert3 [label="Gate selection" style=dashed]
	gpu1_layer6_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer6_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer5_res2 -> gpu1_layer6_ln1
	gpu1_layer6_ln1 -> gpu1_layer6_qkv
	gpu1_layer6_qkv -> gpu1_layer6_reshape
	gpu1_layer6_reshape -> gpu1_layer6_attn
	gpu1_layer6_attn -> gpu1_layer6_attn_reshape
	gpu1_layer6_attn_reshape -> gpu1_layer6_attn_out
	gpu1_layer6_attn_out -> gpu1_layer6_kv_update
	gpu1_layer6_kv_update -> gpu1_layer6_res1
	gpu1_layer6_res1 -> gpu1_layer6_ln2
	gpu1_layer6_ln2 -> gpu1_layer6_routing
	gpu1_layer6_expert0 -> gpu1_layer6_expert_agg
	gpu1_layer6_expert1 -> gpu1_layer6_expert_agg
	gpu1_layer6_expert2 -> gpu1_layer6_expert_agg
	gpu1_layer6_expert3 -> gpu1_layer6_expert_agg
	gpu1_layer6_routing -> gpu1_layer6_expert_agg
	gpu1_layer6_expert_agg -> gpu1_layer6_res2
	gpu1_layer7_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer7_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer7_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer7_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer7_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer7_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer7_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightgreen shape=ellipse style=filled]
	gpu1_layer7_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer7_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer7_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer7_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer7_routing -> gpu1_layer7_expert0 [label="Gate selection" style=dashed]
	gpu1_layer7_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer7_routing -> gpu1_layer7_expert1 [label="Gate selection" style=dashed]
	gpu1_layer7_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer7_routing -> gpu1_layer7_expert2 [label="Gate selection" style=dashed]
	gpu1_layer7_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer7_routing -> gpu1_layer7_expert3 [label="Gate selection" style=dashed]
	gpu1_layer7_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer7_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer6_res2 -> gpu1_layer7_ln1
	gpu1_layer7_ln1 -> gpu1_layer7_qkv
	gpu1_layer7_qkv -> gpu1_layer7_reshape
	gpu1_layer7_reshape -> gpu1_layer7_attn
	gpu1_layer7_attn -> gpu1_layer7_attn_reshape
	gpu1_layer7_attn_reshape -> gpu1_layer7_attn_out
	gpu1_layer7_attn_out -> gpu1_layer7_kv_update
	gpu1_layer7_kv_update -> gpu1_layer7_res1
	gpu1_layer7_res1 -> gpu1_layer7_ln2
	gpu1_layer7_ln2 -> gpu1_layer7_routing
	gpu1_layer7_expert0 -> gpu1_layer7_expert_agg
	gpu1_layer7_expert1 -> gpu1_layer7_expert_agg
	gpu1_layer7_expert2 -> gpu1_layer7_expert_agg
	gpu1_layer7_expert3 -> gpu1_layer7_expert_agg
	gpu1_layer7_routing -> gpu1_layer7_expert_agg
	gpu1_layer7_expert_agg -> gpu1_layer7_res2
	gpu1_layer8_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer8_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer8_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer8_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer8_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer8_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer8_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightgreen shape=ellipse style=filled]
	gpu1_layer8_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer8_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer8_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer8_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer8_routing -> gpu1_layer8_expert0 [label="Gate selection" style=dashed]
	gpu1_layer8_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer8_routing -> gpu1_layer8_expert1 [label="Gate selection" style=dashed]
	gpu1_layer8_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer8_routing -> gpu1_layer8_expert2 [label="Gate selection" style=dashed]
	gpu1_layer8_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer8_routing -> gpu1_layer8_expert3 [label="Gate selection" style=dashed]
	gpu1_layer8_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer8_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer7_res2 -> gpu1_layer8_ln1
	gpu1_layer8_ln1 -> gpu1_layer8_qkv
	gpu1_layer8_qkv -> gpu1_layer8_reshape
	gpu1_layer8_reshape -> gpu1_layer8_attn
	gpu1_layer8_attn -> gpu1_layer8_attn_reshape
	gpu1_layer8_attn_reshape -> gpu1_layer8_attn_out
	gpu1_layer8_attn_out -> gpu1_layer8_kv_update
	gpu1_layer8_kv_update -> gpu1_layer8_res1
	gpu1_layer8_res1 -> gpu1_layer8_ln2
	gpu1_layer8_ln2 -> gpu1_layer8_routing
	gpu1_layer8_expert0 -> gpu1_layer8_expert_agg
	gpu1_layer8_expert1 -> gpu1_layer8_expert_agg
	gpu1_layer8_expert2 -> gpu1_layer8_expert_agg
	gpu1_layer8_expert3 -> gpu1_layer8_expert_agg
	gpu1_layer8_routing -> gpu1_layer8_expert_agg
	gpu1_layer8_expert_agg -> gpu1_layer8_res2
	gpu1_layer9_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer9_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer9_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer9_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer9_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer9_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer9_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightgreen shape=ellipse style=filled]
	gpu1_layer9_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer9_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer9_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer9_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer9_routing -> gpu1_layer9_expert0 [label="Gate selection" style=dashed]
	gpu1_layer9_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer9_routing -> gpu1_layer9_expert1 [label="Gate selection" style=dashed]
	gpu1_layer9_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer9_routing -> gpu1_layer9_expert2 [label="Gate selection" style=dashed]
	gpu1_layer9_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer9_routing -> gpu1_layer9_expert3 [label="Gate selection" style=dashed]
	gpu1_layer9_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer9_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer8_res2 -> gpu1_layer9_ln1
	gpu1_layer9_ln1 -> gpu1_layer9_qkv
	gpu1_layer9_qkv -> gpu1_layer9_reshape
	gpu1_layer9_reshape -> gpu1_layer9_attn
	gpu1_layer9_attn -> gpu1_layer9_attn_reshape
	gpu1_layer9_attn_reshape -> gpu1_layer9_attn_out
	gpu1_layer9_attn_out -> gpu1_layer9_kv_update
	gpu1_layer9_kv_update -> gpu1_layer9_res1
	gpu1_layer9_res1 -> gpu1_layer9_ln2
	gpu1_layer9_ln2 -> gpu1_layer9_routing
	gpu1_layer9_expert0 -> gpu1_layer9_expert_agg
	gpu1_layer9_expert1 -> gpu1_layer9_expert_agg
	gpu1_layer9_expert2 -> gpu1_layer9_expert_agg
	gpu1_layer9_expert3 -> gpu1_layer9_expert_agg
	gpu1_layer9_routing -> gpu1_layer9_expert_agg
	gpu1_layer9_expert_agg -> gpu1_layer9_res2
	gpu1_layer10_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer10_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer10_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer10_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer10_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer10_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer10_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightgreen shape=ellipse style=filled]
	gpu1_layer10_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer10_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer10_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer10_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer10_routing -> gpu1_layer10_expert0 [label="Gate selection" style=dashed]
	gpu1_layer10_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer10_routing -> gpu1_layer10_expert1 [label="Gate selection" style=dashed]
	gpu1_layer10_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer10_routing -> gpu1_layer10_expert2 [label="Gate selection" style=dashed]
	gpu1_layer10_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer10_routing -> gpu1_layer10_expert3 [label="Gate selection" style=dashed]
	gpu1_layer10_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer10_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer9_res2 -> gpu1_layer10_ln1
	gpu1_layer10_ln1 -> gpu1_layer10_qkv
	gpu1_layer10_qkv -> gpu1_layer10_reshape
	gpu1_layer10_reshape -> gpu1_layer10_attn
	gpu1_layer10_attn -> gpu1_layer10_attn_reshape
	gpu1_layer10_attn_reshape -> gpu1_layer10_attn_out
	gpu1_layer10_attn_out -> gpu1_layer10_kv_update
	gpu1_layer10_kv_update -> gpu1_layer10_res1
	gpu1_layer10_res1 -> gpu1_layer10_ln2
	gpu1_layer10_ln2 -> gpu1_layer10_routing
	gpu1_layer10_expert0 -> gpu1_layer10_expert_agg
	gpu1_layer10_expert1 -> gpu1_layer10_expert_agg
	gpu1_layer10_expert2 -> gpu1_layer10_expert_agg
	gpu1_layer10_expert3 -> gpu1_layer10_expert_agg
	gpu1_layer10_routing -> gpu1_layer10_expert_agg
	gpu1_layer10_expert_agg -> gpu1_layer10_res2
	gpu1_layer11_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer11_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer11_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer11_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer11_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer11_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer11_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightgreen shape=ellipse style=filled]
	gpu1_layer11_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer11_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer11_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer11_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer11_routing -> gpu1_layer11_expert0 [label="Gate selection" style=dashed]
	gpu1_layer11_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer11_routing -> gpu1_layer11_expert1 [label="Gate selection" style=dashed]
	gpu1_layer11_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer11_routing -> gpu1_layer11_expert2 [label="Gate selection" style=dashed]
	gpu1_layer11_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer11_routing -> gpu1_layer11_expert3 [label="Gate selection" style=dashed]
	gpu1_layer11_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer11_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer10_res2 -> gpu1_layer11_ln1
	gpu1_layer11_ln1 -> gpu1_layer11_qkv
	gpu1_layer11_qkv -> gpu1_layer11_reshape
	gpu1_layer11_reshape -> gpu1_layer11_attn
	gpu1_layer11_attn -> gpu1_layer11_attn_reshape
	gpu1_layer11_attn_reshape -> gpu1_layer11_attn_out
	gpu1_layer11_attn_out -> gpu1_layer11_kv_update
	gpu1_layer11_kv_update -> gpu1_layer11_res1
	gpu1_layer11_res1 -> gpu1_layer11_ln2
	gpu1_layer11_ln2 -> gpu1_layer11_routing
	gpu1_layer11_expert0 -> gpu1_layer11_expert_agg
	gpu1_layer11_expert1 -> gpu1_layer11_expert_agg
	gpu1_layer11_expert2 -> gpu1_layer11_expert_agg
	gpu1_layer11_expert3 -> gpu1_layer11_expert_agg
	gpu1_layer11_routing -> gpu1_layer11_expert_agg
	gpu1_layer11_expert_agg -> gpu1_layer11_res2
	gpu1_layer12_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer12_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer12_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer12_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer12_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer12_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer12_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightgreen shape=ellipse style=filled]
	gpu1_layer12_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer12_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer12_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer12_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer12_routing -> gpu1_layer12_expert0 [label="Gate selection" style=dashed]
	gpu1_layer12_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer12_routing -> gpu1_layer12_expert1 [label="Gate selection" style=dashed]
	gpu1_layer12_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer12_routing -> gpu1_layer12_expert2 [label="Gate selection" style=dashed]
	gpu1_layer12_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer12_routing -> gpu1_layer12_expert3 [label="Gate selection" style=dashed]
	gpu1_layer12_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer12_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer11_res2 -> gpu1_layer12_ln1
	gpu1_layer12_ln1 -> gpu1_layer12_qkv
	gpu1_layer12_qkv -> gpu1_layer12_reshape
	gpu1_layer12_reshape -> gpu1_layer12_attn
	gpu1_layer12_attn -> gpu1_layer12_attn_reshape
	gpu1_layer12_attn_reshape -> gpu1_layer12_attn_out
	gpu1_layer12_attn_out -> gpu1_layer12_kv_update
	gpu1_layer12_kv_update -> gpu1_layer12_res1
	gpu1_layer12_res1 -> gpu1_layer12_ln2
	gpu1_layer12_ln2 -> gpu1_layer12_routing
	gpu1_layer12_expert0 -> gpu1_layer12_expert_agg
	gpu1_layer12_expert1 -> gpu1_layer12_expert_agg
	gpu1_layer12_expert2 -> gpu1_layer12_expert_agg
	gpu1_layer12_expert3 -> gpu1_layer12_expert_agg
	gpu1_layer12_routing -> gpu1_layer12_expert_agg
	gpu1_layer12_expert_agg -> gpu1_layer12_res2
	gpu1_layer13_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer13_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer13_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer13_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer13_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer13_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer13_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightgreen shape=ellipse style=filled]
	gpu1_layer13_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer13_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer13_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer13_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer13_routing -> gpu1_layer13_expert0 [label="Gate selection" style=dashed]
	gpu1_layer13_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer13_routing -> gpu1_layer13_expert1 [label="Gate selection" style=dashed]
	gpu1_layer13_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer13_routing -> gpu1_layer13_expert2 [label="Gate selection" style=dashed]
	gpu1_layer13_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer13_routing -> gpu1_layer13_expert3 [label="Gate selection" style=dashed]
	gpu1_layer13_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer13_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer12_res2 -> gpu1_layer13_ln1
	gpu1_layer13_ln1 -> gpu1_layer13_qkv
	gpu1_layer13_qkv -> gpu1_layer13_reshape
	gpu1_layer13_reshape -> gpu1_layer13_attn
	gpu1_layer13_attn -> gpu1_layer13_attn_reshape
	gpu1_layer13_attn_reshape -> gpu1_layer13_attn_out
	gpu1_layer13_attn_out -> gpu1_layer13_kv_update
	gpu1_layer13_kv_update -> gpu1_layer13_res1
	gpu1_layer13_res1 -> gpu1_layer13_ln2
	gpu1_layer13_ln2 -> gpu1_layer13_routing
	gpu1_layer13_expert0 -> gpu1_layer13_expert_agg
	gpu1_layer13_expert1 -> gpu1_layer13_expert_agg
	gpu1_layer13_expert2 -> gpu1_layer13_expert_agg
	gpu1_layer13_expert3 -> gpu1_layer13_expert_agg
	gpu1_layer13_routing -> gpu1_layer13_expert_agg
	gpu1_layer13_expert_agg -> gpu1_layer13_res2
	gpu1_layer14_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer14_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer14_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer14_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer14_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer14_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer14_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightgreen shape=ellipse style=filled]
	gpu1_layer14_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer14_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer14_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer14_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer14_routing -> gpu1_layer14_expert0 [label="Gate selection" style=dashed]
	gpu1_layer14_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer14_routing -> gpu1_layer14_expert1 [label="Gate selection" style=dashed]
	gpu1_layer14_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer14_routing -> gpu1_layer14_expert2 [label="Gate selection" style=dashed]
	gpu1_layer14_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer14_routing -> gpu1_layer14_expert3 [label="Gate selection" style=dashed]
	gpu1_layer14_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer14_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer13_res2 -> gpu1_layer14_ln1
	gpu1_layer14_ln1 -> gpu1_layer14_qkv
	gpu1_layer14_qkv -> gpu1_layer14_reshape
	gpu1_layer14_reshape -> gpu1_layer14_attn
	gpu1_layer14_attn -> gpu1_layer14_attn_reshape
	gpu1_layer14_attn_reshape -> gpu1_layer14_attn_out
	gpu1_layer14_attn_out -> gpu1_layer14_kv_update
	gpu1_layer14_kv_update -> gpu1_layer14_res1
	gpu1_layer14_res1 -> gpu1_layer14_ln2
	gpu1_layer14_ln2 -> gpu1_layer14_routing
	gpu1_layer14_expert0 -> gpu1_layer14_expert_agg
	gpu1_layer14_expert1 -> gpu1_layer14_expert_agg
	gpu1_layer14_expert2 -> gpu1_layer14_expert_agg
	gpu1_layer14_expert3 -> gpu1_layer14_expert_agg
	gpu1_layer14_routing -> gpu1_layer14_expert_agg
	gpu1_layer14_expert_agg -> gpu1_layer14_res2
	gpu1_layer15_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer15_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer15_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer15_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer15_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer15_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer15_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightgreen shape=ellipse style=filled]
	gpu1_layer15_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer15_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer15_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer15_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer15_routing -> gpu1_layer15_expert0 [label="Gate selection" style=dashed]
	gpu1_layer15_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer15_routing -> gpu1_layer15_expert1 [label="Gate selection" style=dashed]
	gpu1_layer15_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer15_routing -> gpu1_layer15_expert2 [label="Gate selection" style=dashed]
	gpu1_layer15_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer15_routing -> gpu1_layer15_expert3 [label="Gate selection" style=dashed]
	gpu1_layer15_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu1_layer15_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer14_res2 -> gpu1_layer15_ln1
	gpu1_layer15_ln1 -> gpu1_layer15_qkv
	gpu1_layer15_qkv -> gpu1_layer15_reshape
	gpu1_layer15_reshape -> gpu1_layer15_attn
	gpu1_layer15_attn -> gpu1_layer15_attn_reshape
	gpu1_layer15_attn_reshape -> gpu1_layer15_attn_out
	gpu1_layer15_attn_out -> gpu1_layer15_kv_update
	gpu1_layer15_kv_update -> gpu1_layer15_res1
	gpu1_layer15_res1 -> gpu1_layer15_ln2
	gpu1_layer15_ln2 -> gpu1_layer15_routing
	gpu1_layer15_expert0 -> gpu1_layer15_expert_agg
	gpu1_layer15_expert1 -> gpu1_layer15_expert_agg
	gpu1_layer15_expert2 -> gpu1_layer15_expert_agg
	gpu1_layer15_expert3 -> gpu1_layer15_expert_agg
	gpu1_layer15_routing -> gpu1_layer15_expert_agg
	gpu1_layer15_expert_agg -> gpu1_layer15_res2
	gpu1_final_ln [label="Final LayerNorm\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_layer15_res2 -> gpu1_final_ln
	gpu1_output_proj [label="Output Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 32000]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_final_ln -> gpu1_output_proj
	gpu1_softmax [label="Softmax\nInput: [256, 512, 32000]\nOutput: [256, 512, 32000]\nGPU: GPU1" fillcolor=lightblue shape=rectangle style=filled]
	gpu1_output_proj -> gpu1_softmax
	gpu2_embed [label="Embedding Layer\nInput: [256, 512]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	dp_split -> gpu2_embed [label="GPU 2\n256 sequences"]
	gpu2_layer0_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer0_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer0_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer0_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer0_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer0_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer0_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightgreen shape=ellipse style=filled]
	gpu2_layer0_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer0_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer0_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer0_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer0_routing -> gpu2_layer0_expert0 [label="Gate selection" style=dashed]
	gpu2_layer0_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer0_routing -> gpu2_layer0_expert1 [label="Gate selection" style=dashed]
	gpu2_layer0_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer0_routing -> gpu2_layer0_expert2 [label="Gate selection" style=dashed]
	gpu2_layer0_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer0_routing -> gpu2_layer0_expert3 [label="Gate selection" style=dashed]
	gpu2_layer0_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer0_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_embed -> gpu2_layer0_ln1
	gpu2_layer0_ln1 -> gpu2_layer0_qkv
	gpu2_layer0_qkv -> gpu2_layer0_reshape
	gpu2_layer0_reshape -> gpu2_layer0_attn
	gpu2_layer0_attn -> gpu2_layer0_attn_reshape
	gpu2_layer0_attn_reshape -> gpu2_layer0_attn_out
	gpu2_layer0_attn_out -> gpu2_layer0_kv_update
	gpu2_layer0_kv_update -> gpu2_layer0_res1
	gpu2_layer0_res1 -> gpu2_layer0_ln2
	gpu2_layer0_ln2 -> gpu2_layer0_routing
	gpu2_layer0_expert0 -> gpu2_layer0_expert_agg
	gpu2_layer0_expert1 -> gpu2_layer0_expert_agg
	gpu2_layer0_expert2 -> gpu2_layer0_expert_agg
	gpu2_layer0_expert3 -> gpu2_layer0_expert_agg
	gpu2_layer0_routing -> gpu2_layer0_expert_agg
	gpu2_layer0_expert_agg -> gpu2_layer0_res2
	gpu2_layer1_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer1_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer1_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer1_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer1_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer1_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer1_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightgreen shape=ellipse style=filled]
	gpu2_layer1_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer1_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer1_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer1_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer1_routing -> gpu2_layer1_expert0 [label="Gate selection" style=dashed]
	gpu2_layer1_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer1_routing -> gpu2_layer1_expert1 [label="Gate selection" style=dashed]
	gpu2_layer1_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer1_routing -> gpu2_layer1_expert2 [label="Gate selection" style=dashed]
	gpu2_layer1_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer1_routing -> gpu2_layer1_expert3 [label="Gate selection" style=dashed]
	gpu2_layer1_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer1_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer0_res2 -> gpu2_layer1_ln1
	gpu2_layer1_ln1 -> gpu2_layer1_qkv
	gpu2_layer1_qkv -> gpu2_layer1_reshape
	gpu2_layer1_reshape -> gpu2_layer1_attn
	gpu2_layer1_attn -> gpu2_layer1_attn_reshape
	gpu2_layer1_attn_reshape -> gpu2_layer1_attn_out
	gpu2_layer1_attn_out -> gpu2_layer1_kv_update
	gpu2_layer1_kv_update -> gpu2_layer1_res1
	gpu2_layer1_res1 -> gpu2_layer1_ln2
	gpu2_layer1_ln2 -> gpu2_layer1_routing
	gpu2_layer1_expert0 -> gpu2_layer1_expert_agg
	gpu2_layer1_expert1 -> gpu2_layer1_expert_agg
	gpu2_layer1_expert2 -> gpu2_layer1_expert_agg
	gpu2_layer1_expert3 -> gpu2_layer1_expert_agg
	gpu2_layer1_routing -> gpu2_layer1_expert_agg
	gpu2_layer1_expert_agg -> gpu2_layer1_res2
	gpu2_layer2_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer2_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer2_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer2_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer2_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer2_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer2_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightgreen shape=ellipse style=filled]
	gpu2_layer2_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer2_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer2_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer2_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer2_routing -> gpu2_layer2_expert0 [label="Gate selection" style=dashed]
	gpu2_layer2_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer2_routing -> gpu2_layer2_expert1 [label="Gate selection" style=dashed]
	gpu2_layer2_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer2_routing -> gpu2_layer2_expert2 [label="Gate selection" style=dashed]
	gpu2_layer2_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer2_routing -> gpu2_layer2_expert3 [label="Gate selection" style=dashed]
	gpu2_layer2_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer2_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer1_res2 -> gpu2_layer2_ln1
	gpu2_layer2_ln1 -> gpu2_layer2_qkv
	gpu2_layer2_qkv -> gpu2_layer2_reshape
	gpu2_layer2_reshape -> gpu2_layer2_attn
	gpu2_layer2_attn -> gpu2_layer2_attn_reshape
	gpu2_layer2_attn_reshape -> gpu2_layer2_attn_out
	gpu2_layer2_attn_out -> gpu2_layer2_kv_update
	gpu2_layer2_kv_update -> gpu2_layer2_res1
	gpu2_layer2_res1 -> gpu2_layer2_ln2
	gpu2_layer2_ln2 -> gpu2_layer2_routing
	gpu2_layer2_expert0 -> gpu2_layer2_expert_agg
	gpu2_layer2_expert1 -> gpu2_layer2_expert_agg
	gpu2_layer2_expert2 -> gpu2_layer2_expert_agg
	gpu2_layer2_expert3 -> gpu2_layer2_expert_agg
	gpu2_layer2_routing -> gpu2_layer2_expert_agg
	gpu2_layer2_expert_agg -> gpu2_layer2_res2
	gpu2_layer3_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer3_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer3_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer3_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer3_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer3_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer3_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightgreen shape=ellipse style=filled]
	gpu2_layer3_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer3_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer3_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer3_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer3_routing -> gpu2_layer3_expert0 [label="Gate selection" style=dashed]
	gpu2_layer3_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer3_routing -> gpu2_layer3_expert1 [label="Gate selection" style=dashed]
	gpu2_layer3_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer3_routing -> gpu2_layer3_expert2 [label="Gate selection" style=dashed]
	gpu2_layer3_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer3_routing -> gpu2_layer3_expert3 [label="Gate selection" style=dashed]
	gpu2_layer3_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer3_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer2_res2 -> gpu2_layer3_ln1
	gpu2_layer3_ln1 -> gpu2_layer3_qkv
	gpu2_layer3_qkv -> gpu2_layer3_reshape
	gpu2_layer3_reshape -> gpu2_layer3_attn
	gpu2_layer3_attn -> gpu2_layer3_attn_reshape
	gpu2_layer3_attn_reshape -> gpu2_layer3_attn_out
	gpu2_layer3_attn_out -> gpu2_layer3_kv_update
	gpu2_layer3_kv_update -> gpu2_layer3_res1
	gpu2_layer3_res1 -> gpu2_layer3_ln2
	gpu2_layer3_ln2 -> gpu2_layer3_routing
	gpu2_layer3_expert0 -> gpu2_layer3_expert_agg
	gpu2_layer3_expert1 -> gpu2_layer3_expert_agg
	gpu2_layer3_expert2 -> gpu2_layer3_expert_agg
	gpu2_layer3_expert3 -> gpu2_layer3_expert_agg
	gpu2_layer3_routing -> gpu2_layer3_expert_agg
	gpu2_layer3_expert_agg -> gpu2_layer3_res2
	gpu2_layer4_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer4_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer4_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer4_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer4_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer4_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer4_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightgreen shape=ellipse style=filled]
	gpu2_layer4_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer4_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer4_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer4_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer4_routing -> gpu2_layer4_expert0 [label="Gate selection" style=dashed]
	gpu2_layer4_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer4_routing -> gpu2_layer4_expert1 [label="Gate selection" style=dashed]
	gpu2_layer4_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer4_routing -> gpu2_layer4_expert2 [label="Gate selection" style=dashed]
	gpu2_layer4_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer4_routing -> gpu2_layer4_expert3 [label="Gate selection" style=dashed]
	gpu2_layer4_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer4_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer3_res2 -> gpu2_layer4_ln1
	gpu2_layer4_ln1 -> gpu2_layer4_qkv
	gpu2_layer4_qkv -> gpu2_layer4_reshape
	gpu2_layer4_reshape -> gpu2_layer4_attn
	gpu2_layer4_attn -> gpu2_layer4_attn_reshape
	gpu2_layer4_attn_reshape -> gpu2_layer4_attn_out
	gpu2_layer4_attn_out -> gpu2_layer4_kv_update
	gpu2_layer4_kv_update -> gpu2_layer4_res1
	gpu2_layer4_res1 -> gpu2_layer4_ln2
	gpu2_layer4_ln2 -> gpu2_layer4_routing
	gpu2_layer4_expert0 -> gpu2_layer4_expert_agg
	gpu2_layer4_expert1 -> gpu2_layer4_expert_agg
	gpu2_layer4_expert2 -> gpu2_layer4_expert_agg
	gpu2_layer4_expert3 -> gpu2_layer4_expert_agg
	gpu2_layer4_routing -> gpu2_layer4_expert_agg
	gpu2_layer4_expert_agg -> gpu2_layer4_res2
	gpu2_layer5_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer5_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer5_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer5_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer5_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer5_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer5_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightgreen shape=ellipse style=filled]
	gpu2_layer5_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer5_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer5_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer5_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer5_routing -> gpu2_layer5_expert0 [label="Gate selection" style=dashed]
	gpu2_layer5_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer5_routing -> gpu2_layer5_expert1 [label="Gate selection" style=dashed]
	gpu2_layer5_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer5_routing -> gpu2_layer5_expert2 [label="Gate selection" style=dashed]
	gpu2_layer5_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer5_routing -> gpu2_layer5_expert3 [label="Gate selection" style=dashed]
	gpu2_layer5_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer5_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer4_res2 -> gpu2_layer5_ln1
	gpu2_layer5_ln1 -> gpu2_layer5_qkv
	gpu2_layer5_qkv -> gpu2_layer5_reshape
	gpu2_layer5_reshape -> gpu2_layer5_attn
	gpu2_layer5_attn -> gpu2_layer5_attn_reshape
	gpu2_layer5_attn_reshape -> gpu2_layer5_attn_out
	gpu2_layer5_attn_out -> gpu2_layer5_kv_update
	gpu2_layer5_kv_update -> gpu2_layer5_res1
	gpu2_layer5_res1 -> gpu2_layer5_ln2
	gpu2_layer5_ln2 -> gpu2_layer5_routing
	gpu2_layer5_expert0 -> gpu2_layer5_expert_agg
	gpu2_layer5_expert1 -> gpu2_layer5_expert_agg
	gpu2_layer5_expert2 -> gpu2_layer5_expert_agg
	gpu2_layer5_expert3 -> gpu2_layer5_expert_agg
	gpu2_layer5_routing -> gpu2_layer5_expert_agg
	gpu2_layer5_expert_agg -> gpu2_layer5_res2
	gpu2_layer6_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer6_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer6_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer6_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer6_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer6_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer6_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightgreen shape=ellipse style=filled]
	gpu2_layer6_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer6_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer6_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer6_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer6_routing -> gpu2_layer6_expert0 [label="Gate selection" style=dashed]
	gpu2_layer6_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer6_routing -> gpu2_layer6_expert1 [label="Gate selection" style=dashed]
	gpu2_layer6_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer6_routing -> gpu2_layer6_expert2 [label="Gate selection" style=dashed]
	gpu2_layer6_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer6_routing -> gpu2_layer6_expert3 [label="Gate selection" style=dashed]
	gpu2_layer6_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer6_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer5_res2 -> gpu2_layer6_ln1
	gpu2_layer6_ln1 -> gpu2_layer6_qkv
	gpu2_layer6_qkv -> gpu2_layer6_reshape
	gpu2_layer6_reshape -> gpu2_layer6_attn
	gpu2_layer6_attn -> gpu2_layer6_attn_reshape
	gpu2_layer6_attn_reshape -> gpu2_layer6_attn_out
	gpu2_layer6_attn_out -> gpu2_layer6_kv_update
	gpu2_layer6_kv_update -> gpu2_layer6_res1
	gpu2_layer6_res1 -> gpu2_layer6_ln2
	gpu2_layer6_ln2 -> gpu2_layer6_routing
	gpu2_layer6_expert0 -> gpu2_layer6_expert_agg
	gpu2_layer6_expert1 -> gpu2_layer6_expert_agg
	gpu2_layer6_expert2 -> gpu2_layer6_expert_agg
	gpu2_layer6_expert3 -> gpu2_layer6_expert_agg
	gpu2_layer6_routing -> gpu2_layer6_expert_agg
	gpu2_layer6_expert_agg -> gpu2_layer6_res2
	gpu2_layer7_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer7_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer7_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer7_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer7_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer7_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer7_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightgreen shape=ellipse style=filled]
	gpu2_layer7_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer7_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer7_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer7_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer7_routing -> gpu2_layer7_expert0 [label="Gate selection" style=dashed]
	gpu2_layer7_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer7_routing -> gpu2_layer7_expert1 [label="Gate selection" style=dashed]
	gpu2_layer7_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer7_routing -> gpu2_layer7_expert2 [label="Gate selection" style=dashed]
	gpu2_layer7_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer7_routing -> gpu2_layer7_expert3 [label="Gate selection" style=dashed]
	gpu2_layer7_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer7_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer6_res2 -> gpu2_layer7_ln1
	gpu2_layer7_ln1 -> gpu2_layer7_qkv
	gpu2_layer7_qkv -> gpu2_layer7_reshape
	gpu2_layer7_reshape -> gpu2_layer7_attn
	gpu2_layer7_attn -> gpu2_layer7_attn_reshape
	gpu2_layer7_attn_reshape -> gpu2_layer7_attn_out
	gpu2_layer7_attn_out -> gpu2_layer7_kv_update
	gpu2_layer7_kv_update -> gpu2_layer7_res1
	gpu2_layer7_res1 -> gpu2_layer7_ln2
	gpu2_layer7_ln2 -> gpu2_layer7_routing
	gpu2_layer7_expert0 -> gpu2_layer7_expert_agg
	gpu2_layer7_expert1 -> gpu2_layer7_expert_agg
	gpu2_layer7_expert2 -> gpu2_layer7_expert_agg
	gpu2_layer7_expert3 -> gpu2_layer7_expert_agg
	gpu2_layer7_routing -> gpu2_layer7_expert_agg
	gpu2_layer7_expert_agg -> gpu2_layer7_res2
	gpu2_layer8_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer8_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer8_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer8_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer8_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer8_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer8_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightgreen shape=ellipse style=filled]
	gpu2_layer8_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer8_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer8_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer8_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer8_routing -> gpu2_layer8_expert0 [label="Gate selection" style=dashed]
	gpu2_layer8_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer8_routing -> gpu2_layer8_expert1 [label="Gate selection" style=dashed]
	gpu2_layer8_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer8_routing -> gpu2_layer8_expert2 [label="Gate selection" style=dashed]
	gpu2_layer8_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer8_routing -> gpu2_layer8_expert3 [label="Gate selection" style=dashed]
	gpu2_layer8_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer8_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer7_res2 -> gpu2_layer8_ln1
	gpu2_layer8_ln1 -> gpu2_layer8_qkv
	gpu2_layer8_qkv -> gpu2_layer8_reshape
	gpu2_layer8_reshape -> gpu2_layer8_attn
	gpu2_layer8_attn -> gpu2_layer8_attn_reshape
	gpu2_layer8_attn_reshape -> gpu2_layer8_attn_out
	gpu2_layer8_attn_out -> gpu2_layer8_kv_update
	gpu2_layer8_kv_update -> gpu2_layer8_res1
	gpu2_layer8_res1 -> gpu2_layer8_ln2
	gpu2_layer8_ln2 -> gpu2_layer8_routing
	gpu2_layer8_expert0 -> gpu2_layer8_expert_agg
	gpu2_layer8_expert1 -> gpu2_layer8_expert_agg
	gpu2_layer8_expert2 -> gpu2_layer8_expert_agg
	gpu2_layer8_expert3 -> gpu2_layer8_expert_agg
	gpu2_layer8_routing -> gpu2_layer8_expert_agg
	gpu2_layer8_expert_agg -> gpu2_layer8_res2
	gpu2_layer9_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer9_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer9_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer9_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer9_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer9_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer9_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightgreen shape=ellipse style=filled]
	gpu2_layer9_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer9_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer9_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer9_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer9_routing -> gpu2_layer9_expert0 [label="Gate selection" style=dashed]
	gpu2_layer9_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer9_routing -> gpu2_layer9_expert1 [label="Gate selection" style=dashed]
	gpu2_layer9_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer9_routing -> gpu2_layer9_expert2 [label="Gate selection" style=dashed]
	gpu2_layer9_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer9_routing -> gpu2_layer9_expert3 [label="Gate selection" style=dashed]
	gpu2_layer9_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer9_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer8_res2 -> gpu2_layer9_ln1
	gpu2_layer9_ln1 -> gpu2_layer9_qkv
	gpu2_layer9_qkv -> gpu2_layer9_reshape
	gpu2_layer9_reshape -> gpu2_layer9_attn
	gpu2_layer9_attn -> gpu2_layer9_attn_reshape
	gpu2_layer9_attn_reshape -> gpu2_layer9_attn_out
	gpu2_layer9_attn_out -> gpu2_layer9_kv_update
	gpu2_layer9_kv_update -> gpu2_layer9_res1
	gpu2_layer9_res1 -> gpu2_layer9_ln2
	gpu2_layer9_ln2 -> gpu2_layer9_routing
	gpu2_layer9_expert0 -> gpu2_layer9_expert_agg
	gpu2_layer9_expert1 -> gpu2_layer9_expert_agg
	gpu2_layer9_expert2 -> gpu2_layer9_expert_agg
	gpu2_layer9_expert3 -> gpu2_layer9_expert_agg
	gpu2_layer9_routing -> gpu2_layer9_expert_agg
	gpu2_layer9_expert_agg -> gpu2_layer9_res2
	gpu2_layer10_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer10_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer10_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer10_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer10_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer10_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer10_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightgreen shape=ellipse style=filled]
	gpu2_layer10_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer10_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer10_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer10_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer10_routing -> gpu2_layer10_expert0 [label="Gate selection" style=dashed]
	gpu2_layer10_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer10_routing -> gpu2_layer10_expert1 [label="Gate selection" style=dashed]
	gpu2_layer10_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer10_routing -> gpu2_layer10_expert2 [label="Gate selection" style=dashed]
	gpu2_layer10_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer10_routing -> gpu2_layer10_expert3 [label="Gate selection" style=dashed]
	gpu2_layer10_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer10_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer9_res2 -> gpu2_layer10_ln1
	gpu2_layer10_ln1 -> gpu2_layer10_qkv
	gpu2_layer10_qkv -> gpu2_layer10_reshape
	gpu2_layer10_reshape -> gpu2_layer10_attn
	gpu2_layer10_attn -> gpu2_layer10_attn_reshape
	gpu2_layer10_attn_reshape -> gpu2_layer10_attn_out
	gpu2_layer10_attn_out -> gpu2_layer10_kv_update
	gpu2_layer10_kv_update -> gpu2_layer10_res1
	gpu2_layer10_res1 -> gpu2_layer10_ln2
	gpu2_layer10_ln2 -> gpu2_layer10_routing
	gpu2_layer10_expert0 -> gpu2_layer10_expert_agg
	gpu2_layer10_expert1 -> gpu2_layer10_expert_agg
	gpu2_layer10_expert2 -> gpu2_layer10_expert_agg
	gpu2_layer10_expert3 -> gpu2_layer10_expert_agg
	gpu2_layer10_routing -> gpu2_layer10_expert_agg
	gpu2_layer10_expert_agg -> gpu2_layer10_res2
	gpu2_layer11_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer11_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer11_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer11_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer11_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer11_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer11_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightgreen shape=ellipse style=filled]
	gpu2_layer11_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer11_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer11_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer11_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer11_routing -> gpu2_layer11_expert0 [label="Gate selection" style=dashed]
	gpu2_layer11_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer11_routing -> gpu2_layer11_expert1 [label="Gate selection" style=dashed]
	gpu2_layer11_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer11_routing -> gpu2_layer11_expert2 [label="Gate selection" style=dashed]
	gpu2_layer11_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer11_routing -> gpu2_layer11_expert3 [label="Gate selection" style=dashed]
	gpu2_layer11_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer11_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer10_res2 -> gpu2_layer11_ln1
	gpu2_layer11_ln1 -> gpu2_layer11_qkv
	gpu2_layer11_qkv -> gpu2_layer11_reshape
	gpu2_layer11_reshape -> gpu2_layer11_attn
	gpu2_layer11_attn -> gpu2_layer11_attn_reshape
	gpu2_layer11_attn_reshape -> gpu2_layer11_attn_out
	gpu2_layer11_attn_out -> gpu2_layer11_kv_update
	gpu2_layer11_kv_update -> gpu2_layer11_res1
	gpu2_layer11_res1 -> gpu2_layer11_ln2
	gpu2_layer11_ln2 -> gpu2_layer11_routing
	gpu2_layer11_expert0 -> gpu2_layer11_expert_agg
	gpu2_layer11_expert1 -> gpu2_layer11_expert_agg
	gpu2_layer11_expert2 -> gpu2_layer11_expert_agg
	gpu2_layer11_expert3 -> gpu2_layer11_expert_agg
	gpu2_layer11_routing -> gpu2_layer11_expert_agg
	gpu2_layer11_expert_agg -> gpu2_layer11_res2
	gpu2_layer12_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer12_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer12_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer12_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer12_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer12_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer12_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightgreen shape=ellipse style=filled]
	gpu2_layer12_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer12_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer12_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer12_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer12_routing -> gpu2_layer12_expert0 [label="Gate selection" style=dashed]
	gpu2_layer12_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer12_routing -> gpu2_layer12_expert1 [label="Gate selection" style=dashed]
	gpu2_layer12_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer12_routing -> gpu2_layer12_expert2 [label="Gate selection" style=dashed]
	gpu2_layer12_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer12_routing -> gpu2_layer12_expert3 [label="Gate selection" style=dashed]
	gpu2_layer12_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer12_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer11_res2 -> gpu2_layer12_ln1
	gpu2_layer12_ln1 -> gpu2_layer12_qkv
	gpu2_layer12_qkv -> gpu2_layer12_reshape
	gpu2_layer12_reshape -> gpu2_layer12_attn
	gpu2_layer12_attn -> gpu2_layer12_attn_reshape
	gpu2_layer12_attn_reshape -> gpu2_layer12_attn_out
	gpu2_layer12_attn_out -> gpu2_layer12_kv_update
	gpu2_layer12_kv_update -> gpu2_layer12_res1
	gpu2_layer12_res1 -> gpu2_layer12_ln2
	gpu2_layer12_ln2 -> gpu2_layer12_routing
	gpu2_layer12_expert0 -> gpu2_layer12_expert_agg
	gpu2_layer12_expert1 -> gpu2_layer12_expert_agg
	gpu2_layer12_expert2 -> gpu2_layer12_expert_agg
	gpu2_layer12_expert3 -> gpu2_layer12_expert_agg
	gpu2_layer12_routing -> gpu2_layer12_expert_agg
	gpu2_layer12_expert_agg -> gpu2_layer12_res2
	gpu2_layer13_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer13_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer13_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer13_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer13_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer13_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer13_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightgreen shape=ellipse style=filled]
	gpu2_layer13_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer13_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer13_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer13_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer13_routing -> gpu2_layer13_expert0 [label="Gate selection" style=dashed]
	gpu2_layer13_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer13_routing -> gpu2_layer13_expert1 [label="Gate selection" style=dashed]
	gpu2_layer13_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer13_routing -> gpu2_layer13_expert2 [label="Gate selection" style=dashed]
	gpu2_layer13_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer13_routing -> gpu2_layer13_expert3 [label="Gate selection" style=dashed]
	gpu2_layer13_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer13_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer12_res2 -> gpu2_layer13_ln1
	gpu2_layer13_ln1 -> gpu2_layer13_qkv
	gpu2_layer13_qkv -> gpu2_layer13_reshape
	gpu2_layer13_reshape -> gpu2_layer13_attn
	gpu2_layer13_attn -> gpu2_layer13_attn_reshape
	gpu2_layer13_attn_reshape -> gpu2_layer13_attn_out
	gpu2_layer13_attn_out -> gpu2_layer13_kv_update
	gpu2_layer13_kv_update -> gpu2_layer13_res1
	gpu2_layer13_res1 -> gpu2_layer13_ln2
	gpu2_layer13_ln2 -> gpu2_layer13_routing
	gpu2_layer13_expert0 -> gpu2_layer13_expert_agg
	gpu2_layer13_expert1 -> gpu2_layer13_expert_agg
	gpu2_layer13_expert2 -> gpu2_layer13_expert_agg
	gpu2_layer13_expert3 -> gpu2_layer13_expert_agg
	gpu2_layer13_routing -> gpu2_layer13_expert_agg
	gpu2_layer13_expert_agg -> gpu2_layer13_res2
	gpu2_layer14_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer14_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer14_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer14_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer14_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer14_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer14_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightgreen shape=ellipse style=filled]
	gpu2_layer14_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer14_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer14_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer14_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer14_routing -> gpu2_layer14_expert0 [label="Gate selection" style=dashed]
	gpu2_layer14_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer14_routing -> gpu2_layer14_expert1 [label="Gate selection" style=dashed]
	gpu2_layer14_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer14_routing -> gpu2_layer14_expert2 [label="Gate selection" style=dashed]
	gpu2_layer14_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer14_routing -> gpu2_layer14_expert3 [label="Gate selection" style=dashed]
	gpu2_layer14_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer14_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer13_res2 -> gpu2_layer14_ln1
	gpu2_layer14_ln1 -> gpu2_layer14_qkv
	gpu2_layer14_qkv -> gpu2_layer14_reshape
	gpu2_layer14_reshape -> gpu2_layer14_attn
	gpu2_layer14_attn -> gpu2_layer14_attn_reshape
	gpu2_layer14_attn_reshape -> gpu2_layer14_attn_out
	gpu2_layer14_attn_out -> gpu2_layer14_kv_update
	gpu2_layer14_kv_update -> gpu2_layer14_res1
	gpu2_layer14_res1 -> gpu2_layer14_ln2
	gpu2_layer14_ln2 -> gpu2_layer14_routing
	gpu2_layer14_expert0 -> gpu2_layer14_expert_agg
	gpu2_layer14_expert1 -> gpu2_layer14_expert_agg
	gpu2_layer14_expert2 -> gpu2_layer14_expert_agg
	gpu2_layer14_expert3 -> gpu2_layer14_expert_agg
	gpu2_layer14_routing -> gpu2_layer14_expert_agg
	gpu2_layer14_expert_agg -> gpu2_layer14_res2
	gpu2_layer15_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer15_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer15_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer15_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer15_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer15_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer15_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightgreen shape=ellipse style=filled]
	gpu2_layer15_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer15_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer15_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer15_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer15_routing -> gpu2_layer15_expert0 [label="Gate selection" style=dashed]
	gpu2_layer15_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer15_routing -> gpu2_layer15_expert1 [label="Gate selection" style=dashed]
	gpu2_layer15_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer15_routing -> gpu2_layer15_expert2 [label="Gate selection" style=dashed]
	gpu2_layer15_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer15_routing -> gpu2_layer15_expert3 [label="Gate selection" style=dashed]
	gpu2_layer15_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu2_layer15_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer14_res2 -> gpu2_layer15_ln1
	gpu2_layer15_ln1 -> gpu2_layer15_qkv
	gpu2_layer15_qkv -> gpu2_layer15_reshape
	gpu2_layer15_reshape -> gpu2_layer15_attn
	gpu2_layer15_attn -> gpu2_layer15_attn_reshape
	gpu2_layer15_attn_reshape -> gpu2_layer15_attn_out
	gpu2_layer15_attn_out -> gpu2_layer15_kv_update
	gpu2_layer15_kv_update -> gpu2_layer15_res1
	gpu2_layer15_res1 -> gpu2_layer15_ln2
	gpu2_layer15_ln2 -> gpu2_layer15_routing
	gpu2_layer15_expert0 -> gpu2_layer15_expert_agg
	gpu2_layer15_expert1 -> gpu2_layer15_expert_agg
	gpu2_layer15_expert2 -> gpu2_layer15_expert_agg
	gpu2_layer15_expert3 -> gpu2_layer15_expert_agg
	gpu2_layer15_routing -> gpu2_layer15_expert_agg
	gpu2_layer15_expert_agg -> gpu2_layer15_res2
	gpu2_final_ln [label="Final LayerNorm\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_layer15_res2 -> gpu2_final_ln
	gpu2_output_proj [label="Output Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 32000]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_final_ln -> gpu2_output_proj
	gpu2_softmax [label="Softmax\nInput: [256, 512, 32000]\nOutput: [256, 512, 32000]\nGPU: GPU2" fillcolor=lightblue shape=rectangle style=filled]
	gpu2_output_proj -> gpu2_softmax
	gpu3_embed [label="Embedding Layer\nInput: [256, 512]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	dp_split -> gpu3_embed [label="GPU 3\n256 sequences"]
	gpu3_layer0_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer0_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer0_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer0_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer0_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer0_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer0_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightgreen shape=ellipse style=filled]
	gpu3_layer0_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer0_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer0_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer0_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer0_routing -> gpu3_layer0_expert0 [label="Gate selection" style=dashed]
	gpu3_layer0_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer0_routing -> gpu3_layer0_expert1 [label="Gate selection" style=dashed]
	gpu3_layer0_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer0_routing -> gpu3_layer0_expert2 [label="Gate selection" style=dashed]
	gpu3_layer0_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer0_routing -> gpu3_layer0_expert3 [label="Gate selection" style=dashed]
	gpu3_layer0_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer0_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_embed -> gpu3_layer0_ln1
	gpu3_layer0_ln1 -> gpu3_layer0_qkv
	gpu3_layer0_qkv -> gpu3_layer0_reshape
	gpu3_layer0_reshape -> gpu3_layer0_attn
	gpu3_layer0_attn -> gpu3_layer0_attn_reshape
	gpu3_layer0_attn_reshape -> gpu3_layer0_attn_out
	gpu3_layer0_attn_out -> gpu3_layer0_kv_update
	gpu3_layer0_kv_update -> gpu3_layer0_res1
	gpu3_layer0_res1 -> gpu3_layer0_ln2
	gpu3_layer0_ln2 -> gpu3_layer0_routing
	gpu3_layer0_expert0 -> gpu3_layer0_expert_agg
	gpu3_layer0_expert1 -> gpu3_layer0_expert_agg
	gpu3_layer0_expert2 -> gpu3_layer0_expert_agg
	gpu3_layer0_expert3 -> gpu3_layer0_expert_agg
	gpu3_layer0_routing -> gpu3_layer0_expert_agg
	gpu3_layer0_expert_agg -> gpu3_layer0_res2
	gpu3_layer1_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer1_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer1_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer1_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer1_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer1_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer1_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightgreen shape=ellipse style=filled]
	gpu3_layer1_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer1_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer1_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer1_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer1_routing -> gpu3_layer1_expert0 [label="Gate selection" style=dashed]
	gpu3_layer1_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer1_routing -> gpu3_layer1_expert1 [label="Gate selection" style=dashed]
	gpu3_layer1_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer1_routing -> gpu3_layer1_expert2 [label="Gate selection" style=dashed]
	gpu3_layer1_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer1_routing -> gpu3_layer1_expert3 [label="Gate selection" style=dashed]
	gpu3_layer1_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer1_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer0_res2 -> gpu3_layer1_ln1
	gpu3_layer1_ln1 -> gpu3_layer1_qkv
	gpu3_layer1_qkv -> gpu3_layer1_reshape
	gpu3_layer1_reshape -> gpu3_layer1_attn
	gpu3_layer1_attn -> gpu3_layer1_attn_reshape
	gpu3_layer1_attn_reshape -> gpu3_layer1_attn_out
	gpu3_layer1_attn_out -> gpu3_layer1_kv_update
	gpu3_layer1_kv_update -> gpu3_layer1_res1
	gpu3_layer1_res1 -> gpu3_layer1_ln2
	gpu3_layer1_ln2 -> gpu3_layer1_routing
	gpu3_layer1_expert0 -> gpu3_layer1_expert_agg
	gpu3_layer1_expert1 -> gpu3_layer1_expert_agg
	gpu3_layer1_expert2 -> gpu3_layer1_expert_agg
	gpu3_layer1_expert3 -> gpu3_layer1_expert_agg
	gpu3_layer1_routing -> gpu3_layer1_expert_agg
	gpu3_layer1_expert_agg -> gpu3_layer1_res2
	gpu3_layer2_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer2_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer2_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer2_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer2_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer2_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer2_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightgreen shape=ellipse style=filled]
	gpu3_layer2_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer2_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer2_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer2_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer2_routing -> gpu3_layer2_expert0 [label="Gate selection" style=dashed]
	gpu3_layer2_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer2_routing -> gpu3_layer2_expert1 [label="Gate selection" style=dashed]
	gpu3_layer2_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer2_routing -> gpu3_layer2_expert2 [label="Gate selection" style=dashed]
	gpu3_layer2_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer2_routing -> gpu3_layer2_expert3 [label="Gate selection" style=dashed]
	gpu3_layer2_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer2_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer1_res2 -> gpu3_layer2_ln1
	gpu3_layer2_ln1 -> gpu3_layer2_qkv
	gpu3_layer2_qkv -> gpu3_layer2_reshape
	gpu3_layer2_reshape -> gpu3_layer2_attn
	gpu3_layer2_attn -> gpu3_layer2_attn_reshape
	gpu3_layer2_attn_reshape -> gpu3_layer2_attn_out
	gpu3_layer2_attn_out -> gpu3_layer2_kv_update
	gpu3_layer2_kv_update -> gpu3_layer2_res1
	gpu3_layer2_res1 -> gpu3_layer2_ln2
	gpu3_layer2_ln2 -> gpu3_layer2_routing
	gpu3_layer2_expert0 -> gpu3_layer2_expert_agg
	gpu3_layer2_expert1 -> gpu3_layer2_expert_agg
	gpu3_layer2_expert2 -> gpu3_layer2_expert_agg
	gpu3_layer2_expert3 -> gpu3_layer2_expert_agg
	gpu3_layer2_routing -> gpu3_layer2_expert_agg
	gpu3_layer2_expert_agg -> gpu3_layer2_res2
	gpu3_layer3_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer3_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer3_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer3_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer3_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer3_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer3_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightgreen shape=ellipse style=filled]
	gpu3_layer3_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer3_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer3_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer3_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer3_routing -> gpu3_layer3_expert0 [label="Gate selection" style=dashed]
	gpu3_layer3_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer3_routing -> gpu3_layer3_expert1 [label="Gate selection" style=dashed]
	gpu3_layer3_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer3_routing -> gpu3_layer3_expert2 [label="Gate selection" style=dashed]
	gpu3_layer3_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer3_routing -> gpu3_layer3_expert3 [label="Gate selection" style=dashed]
	gpu3_layer3_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer3_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer2_res2 -> gpu3_layer3_ln1
	gpu3_layer3_ln1 -> gpu3_layer3_qkv
	gpu3_layer3_qkv -> gpu3_layer3_reshape
	gpu3_layer3_reshape -> gpu3_layer3_attn
	gpu3_layer3_attn -> gpu3_layer3_attn_reshape
	gpu3_layer3_attn_reshape -> gpu3_layer3_attn_out
	gpu3_layer3_attn_out -> gpu3_layer3_kv_update
	gpu3_layer3_kv_update -> gpu3_layer3_res1
	gpu3_layer3_res1 -> gpu3_layer3_ln2
	gpu3_layer3_ln2 -> gpu3_layer3_routing
	gpu3_layer3_expert0 -> gpu3_layer3_expert_agg
	gpu3_layer3_expert1 -> gpu3_layer3_expert_agg
	gpu3_layer3_expert2 -> gpu3_layer3_expert_agg
	gpu3_layer3_expert3 -> gpu3_layer3_expert_agg
	gpu3_layer3_routing -> gpu3_layer3_expert_agg
	gpu3_layer3_expert_agg -> gpu3_layer3_res2
	gpu3_layer4_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer4_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer4_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer4_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer4_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer4_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer4_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightgreen shape=ellipse style=filled]
	gpu3_layer4_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer4_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer4_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer4_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer4_routing -> gpu3_layer4_expert0 [label="Gate selection" style=dashed]
	gpu3_layer4_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer4_routing -> gpu3_layer4_expert1 [label="Gate selection" style=dashed]
	gpu3_layer4_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer4_routing -> gpu3_layer4_expert2 [label="Gate selection" style=dashed]
	gpu3_layer4_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer4_routing -> gpu3_layer4_expert3 [label="Gate selection" style=dashed]
	gpu3_layer4_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer4_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer3_res2 -> gpu3_layer4_ln1
	gpu3_layer4_ln1 -> gpu3_layer4_qkv
	gpu3_layer4_qkv -> gpu3_layer4_reshape
	gpu3_layer4_reshape -> gpu3_layer4_attn
	gpu3_layer4_attn -> gpu3_layer4_attn_reshape
	gpu3_layer4_attn_reshape -> gpu3_layer4_attn_out
	gpu3_layer4_attn_out -> gpu3_layer4_kv_update
	gpu3_layer4_kv_update -> gpu3_layer4_res1
	gpu3_layer4_res1 -> gpu3_layer4_ln2
	gpu3_layer4_ln2 -> gpu3_layer4_routing
	gpu3_layer4_expert0 -> gpu3_layer4_expert_agg
	gpu3_layer4_expert1 -> gpu3_layer4_expert_agg
	gpu3_layer4_expert2 -> gpu3_layer4_expert_agg
	gpu3_layer4_expert3 -> gpu3_layer4_expert_agg
	gpu3_layer4_routing -> gpu3_layer4_expert_agg
	gpu3_layer4_expert_agg -> gpu3_layer4_res2
	gpu3_layer5_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer5_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer5_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer5_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer5_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer5_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer5_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightgreen shape=ellipse style=filled]
	gpu3_layer5_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer5_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer5_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer5_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer5_routing -> gpu3_layer5_expert0 [label="Gate selection" style=dashed]
	gpu3_layer5_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer5_routing -> gpu3_layer5_expert1 [label="Gate selection" style=dashed]
	gpu3_layer5_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer5_routing -> gpu3_layer5_expert2 [label="Gate selection" style=dashed]
	gpu3_layer5_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer5_routing -> gpu3_layer5_expert3 [label="Gate selection" style=dashed]
	gpu3_layer5_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer5_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer4_res2 -> gpu3_layer5_ln1
	gpu3_layer5_ln1 -> gpu3_layer5_qkv
	gpu3_layer5_qkv -> gpu3_layer5_reshape
	gpu3_layer5_reshape -> gpu3_layer5_attn
	gpu3_layer5_attn -> gpu3_layer5_attn_reshape
	gpu3_layer5_attn_reshape -> gpu3_layer5_attn_out
	gpu3_layer5_attn_out -> gpu3_layer5_kv_update
	gpu3_layer5_kv_update -> gpu3_layer5_res1
	gpu3_layer5_res1 -> gpu3_layer5_ln2
	gpu3_layer5_ln2 -> gpu3_layer5_routing
	gpu3_layer5_expert0 -> gpu3_layer5_expert_agg
	gpu3_layer5_expert1 -> gpu3_layer5_expert_agg
	gpu3_layer5_expert2 -> gpu3_layer5_expert_agg
	gpu3_layer5_expert3 -> gpu3_layer5_expert_agg
	gpu3_layer5_routing -> gpu3_layer5_expert_agg
	gpu3_layer5_expert_agg -> gpu3_layer5_res2
	gpu3_layer6_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer6_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer6_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer6_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer6_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer6_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer6_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightgreen shape=ellipse style=filled]
	gpu3_layer6_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer6_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer6_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer6_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer6_routing -> gpu3_layer6_expert0 [label="Gate selection" style=dashed]
	gpu3_layer6_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer6_routing -> gpu3_layer6_expert1 [label="Gate selection" style=dashed]
	gpu3_layer6_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer6_routing -> gpu3_layer6_expert2 [label="Gate selection" style=dashed]
	gpu3_layer6_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer6_routing -> gpu3_layer6_expert3 [label="Gate selection" style=dashed]
	gpu3_layer6_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer6_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer5_res2 -> gpu3_layer6_ln1
	gpu3_layer6_ln1 -> gpu3_layer6_qkv
	gpu3_layer6_qkv -> gpu3_layer6_reshape
	gpu3_layer6_reshape -> gpu3_layer6_attn
	gpu3_layer6_attn -> gpu3_layer6_attn_reshape
	gpu3_layer6_attn_reshape -> gpu3_layer6_attn_out
	gpu3_layer6_attn_out -> gpu3_layer6_kv_update
	gpu3_layer6_kv_update -> gpu3_layer6_res1
	gpu3_layer6_res1 -> gpu3_layer6_ln2
	gpu3_layer6_ln2 -> gpu3_layer6_routing
	gpu3_layer6_expert0 -> gpu3_layer6_expert_agg
	gpu3_layer6_expert1 -> gpu3_layer6_expert_agg
	gpu3_layer6_expert2 -> gpu3_layer6_expert_agg
	gpu3_layer6_expert3 -> gpu3_layer6_expert_agg
	gpu3_layer6_routing -> gpu3_layer6_expert_agg
	gpu3_layer6_expert_agg -> gpu3_layer6_res2
	gpu3_layer7_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer7_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer7_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer7_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer7_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer7_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer7_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightgreen shape=ellipse style=filled]
	gpu3_layer7_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer7_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer7_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer7_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer7_routing -> gpu3_layer7_expert0 [label="Gate selection" style=dashed]
	gpu3_layer7_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer7_routing -> gpu3_layer7_expert1 [label="Gate selection" style=dashed]
	gpu3_layer7_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer7_routing -> gpu3_layer7_expert2 [label="Gate selection" style=dashed]
	gpu3_layer7_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer7_routing -> gpu3_layer7_expert3 [label="Gate selection" style=dashed]
	gpu3_layer7_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer7_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer6_res2 -> gpu3_layer7_ln1
	gpu3_layer7_ln1 -> gpu3_layer7_qkv
	gpu3_layer7_qkv -> gpu3_layer7_reshape
	gpu3_layer7_reshape -> gpu3_layer7_attn
	gpu3_layer7_attn -> gpu3_layer7_attn_reshape
	gpu3_layer7_attn_reshape -> gpu3_layer7_attn_out
	gpu3_layer7_attn_out -> gpu3_layer7_kv_update
	gpu3_layer7_kv_update -> gpu3_layer7_res1
	gpu3_layer7_res1 -> gpu3_layer7_ln2
	gpu3_layer7_ln2 -> gpu3_layer7_routing
	gpu3_layer7_expert0 -> gpu3_layer7_expert_agg
	gpu3_layer7_expert1 -> gpu3_layer7_expert_agg
	gpu3_layer7_expert2 -> gpu3_layer7_expert_agg
	gpu3_layer7_expert3 -> gpu3_layer7_expert_agg
	gpu3_layer7_routing -> gpu3_layer7_expert_agg
	gpu3_layer7_expert_agg -> gpu3_layer7_res2
	gpu3_layer8_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer8_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer8_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer8_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer8_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer8_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer8_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightgreen shape=ellipse style=filled]
	gpu3_layer8_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer8_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer8_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer8_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer8_routing -> gpu3_layer8_expert0 [label="Gate selection" style=dashed]
	gpu3_layer8_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer8_routing -> gpu3_layer8_expert1 [label="Gate selection" style=dashed]
	gpu3_layer8_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer8_routing -> gpu3_layer8_expert2 [label="Gate selection" style=dashed]
	gpu3_layer8_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer8_routing -> gpu3_layer8_expert3 [label="Gate selection" style=dashed]
	gpu3_layer8_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer8_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer7_res2 -> gpu3_layer8_ln1
	gpu3_layer8_ln1 -> gpu3_layer8_qkv
	gpu3_layer8_qkv -> gpu3_layer8_reshape
	gpu3_layer8_reshape -> gpu3_layer8_attn
	gpu3_layer8_attn -> gpu3_layer8_attn_reshape
	gpu3_layer8_attn_reshape -> gpu3_layer8_attn_out
	gpu3_layer8_attn_out -> gpu3_layer8_kv_update
	gpu3_layer8_kv_update -> gpu3_layer8_res1
	gpu3_layer8_res1 -> gpu3_layer8_ln2
	gpu3_layer8_ln2 -> gpu3_layer8_routing
	gpu3_layer8_expert0 -> gpu3_layer8_expert_agg
	gpu3_layer8_expert1 -> gpu3_layer8_expert_agg
	gpu3_layer8_expert2 -> gpu3_layer8_expert_agg
	gpu3_layer8_expert3 -> gpu3_layer8_expert_agg
	gpu3_layer8_routing -> gpu3_layer8_expert_agg
	gpu3_layer8_expert_agg -> gpu3_layer8_res2
	gpu3_layer9_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer9_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer9_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer9_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer9_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer9_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer9_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightgreen shape=ellipse style=filled]
	gpu3_layer9_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer9_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer9_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer9_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer9_routing -> gpu3_layer9_expert0 [label="Gate selection" style=dashed]
	gpu3_layer9_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer9_routing -> gpu3_layer9_expert1 [label="Gate selection" style=dashed]
	gpu3_layer9_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer9_routing -> gpu3_layer9_expert2 [label="Gate selection" style=dashed]
	gpu3_layer9_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer9_routing -> gpu3_layer9_expert3 [label="Gate selection" style=dashed]
	gpu3_layer9_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer9_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer8_res2 -> gpu3_layer9_ln1
	gpu3_layer9_ln1 -> gpu3_layer9_qkv
	gpu3_layer9_qkv -> gpu3_layer9_reshape
	gpu3_layer9_reshape -> gpu3_layer9_attn
	gpu3_layer9_attn -> gpu3_layer9_attn_reshape
	gpu3_layer9_attn_reshape -> gpu3_layer9_attn_out
	gpu3_layer9_attn_out -> gpu3_layer9_kv_update
	gpu3_layer9_kv_update -> gpu3_layer9_res1
	gpu3_layer9_res1 -> gpu3_layer9_ln2
	gpu3_layer9_ln2 -> gpu3_layer9_routing
	gpu3_layer9_expert0 -> gpu3_layer9_expert_agg
	gpu3_layer9_expert1 -> gpu3_layer9_expert_agg
	gpu3_layer9_expert2 -> gpu3_layer9_expert_agg
	gpu3_layer9_expert3 -> gpu3_layer9_expert_agg
	gpu3_layer9_routing -> gpu3_layer9_expert_agg
	gpu3_layer9_expert_agg -> gpu3_layer9_res2
	gpu3_layer10_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer10_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer10_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer10_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer10_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer10_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer10_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightgreen shape=ellipse style=filled]
	gpu3_layer10_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer10_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer10_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer10_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer10_routing -> gpu3_layer10_expert0 [label="Gate selection" style=dashed]
	gpu3_layer10_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer10_routing -> gpu3_layer10_expert1 [label="Gate selection" style=dashed]
	gpu3_layer10_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer10_routing -> gpu3_layer10_expert2 [label="Gate selection" style=dashed]
	gpu3_layer10_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer10_routing -> gpu3_layer10_expert3 [label="Gate selection" style=dashed]
	gpu3_layer10_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer10_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer9_res2 -> gpu3_layer10_ln1
	gpu3_layer10_ln1 -> gpu3_layer10_qkv
	gpu3_layer10_qkv -> gpu3_layer10_reshape
	gpu3_layer10_reshape -> gpu3_layer10_attn
	gpu3_layer10_attn -> gpu3_layer10_attn_reshape
	gpu3_layer10_attn_reshape -> gpu3_layer10_attn_out
	gpu3_layer10_attn_out -> gpu3_layer10_kv_update
	gpu3_layer10_kv_update -> gpu3_layer10_res1
	gpu3_layer10_res1 -> gpu3_layer10_ln2
	gpu3_layer10_ln2 -> gpu3_layer10_routing
	gpu3_layer10_expert0 -> gpu3_layer10_expert_agg
	gpu3_layer10_expert1 -> gpu3_layer10_expert_agg
	gpu3_layer10_expert2 -> gpu3_layer10_expert_agg
	gpu3_layer10_expert3 -> gpu3_layer10_expert_agg
	gpu3_layer10_routing -> gpu3_layer10_expert_agg
	gpu3_layer10_expert_agg -> gpu3_layer10_res2
	gpu3_layer11_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer11_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer11_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer11_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer11_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer11_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer11_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightgreen shape=ellipse style=filled]
	gpu3_layer11_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer11_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer11_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer11_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer11_routing -> gpu3_layer11_expert0 [label="Gate selection" style=dashed]
	gpu3_layer11_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer11_routing -> gpu3_layer11_expert1 [label="Gate selection" style=dashed]
	gpu3_layer11_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer11_routing -> gpu3_layer11_expert2 [label="Gate selection" style=dashed]
	gpu3_layer11_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer11_routing -> gpu3_layer11_expert3 [label="Gate selection" style=dashed]
	gpu3_layer11_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer11_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer10_res2 -> gpu3_layer11_ln1
	gpu3_layer11_ln1 -> gpu3_layer11_qkv
	gpu3_layer11_qkv -> gpu3_layer11_reshape
	gpu3_layer11_reshape -> gpu3_layer11_attn
	gpu3_layer11_attn -> gpu3_layer11_attn_reshape
	gpu3_layer11_attn_reshape -> gpu3_layer11_attn_out
	gpu3_layer11_attn_out -> gpu3_layer11_kv_update
	gpu3_layer11_kv_update -> gpu3_layer11_res1
	gpu3_layer11_res1 -> gpu3_layer11_ln2
	gpu3_layer11_ln2 -> gpu3_layer11_routing
	gpu3_layer11_expert0 -> gpu3_layer11_expert_agg
	gpu3_layer11_expert1 -> gpu3_layer11_expert_agg
	gpu3_layer11_expert2 -> gpu3_layer11_expert_agg
	gpu3_layer11_expert3 -> gpu3_layer11_expert_agg
	gpu3_layer11_routing -> gpu3_layer11_expert_agg
	gpu3_layer11_expert_agg -> gpu3_layer11_res2
	gpu3_layer12_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer12_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer12_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer12_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer12_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer12_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer12_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightgreen shape=ellipse style=filled]
	gpu3_layer12_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer12_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer12_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer12_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer12_routing -> gpu3_layer12_expert0 [label="Gate selection" style=dashed]
	gpu3_layer12_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer12_routing -> gpu3_layer12_expert1 [label="Gate selection" style=dashed]
	gpu3_layer12_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer12_routing -> gpu3_layer12_expert2 [label="Gate selection" style=dashed]
	gpu3_layer12_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer12_routing -> gpu3_layer12_expert3 [label="Gate selection" style=dashed]
	gpu3_layer12_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer12_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer11_res2 -> gpu3_layer12_ln1
	gpu3_layer12_ln1 -> gpu3_layer12_qkv
	gpu3_layer12_qkv -> gpu3_layer12_reshape
	gpu3_layer12_reshape -> gpu3_layer12_attn
	gpu3_layer12_attn -> gpu3_layer12_attn_reshape
	gpu3_layer12_attn_reshape -> gpu3_layer12_attn_out
	gpu3_layer12_attn_out -> gpu3_layer12_kv_update
	gpu3_layer12_kv_update -> gpu3_layer12_res1
	gpu3_layer12_res1 -> gpu3_layer12_ln2
	gpu3_layer12_ln2 -> gpu3_layer12_routing
	gpu3_layer12_expert0 -> gpu3_layer12_expert_agg
	gpu3_layer12_expert1 -> gpu3_layer12_expert_agg
	gpu3_layer12_expert2 -> gpu3_layer12_expert_agg
	gpu3_layer12_expert3 -> gpu3_layer12_expert_agg
	gpu3_layer12_routing -> gpu3_layer12_expert_agg
	gpu3_layer12_expert_agg -> gpu3_layer12_res2
	gpu3_layer13_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer13_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer13_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer13_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer13_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer13_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer13_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightgreen shape=ellipse style=filled]
	gpu3_layer13_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer13_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer13_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer13_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer13_routing -> gpu3_layer13_expert0 [label="Gate selection" style=dashed]
	gpu3_layer13_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer13_routing -> gpu3_layer13_expert1 [label="Gate selection" style=dashed]
	gpu3_layer13_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer13_routing -> gpu3_layer13_expert2 [label="Gate selection" style=dashed]
	gpu3_layer13_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer13_routing -> gpu3_layer13_expert3 [label="Gate selection" style=dashed]
	gpu3_layer13_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer13_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer12_res2 -> gpu3_layer13_ln1
	gpu3_layer13_ln1 -> gpu3_layer13_qkv
	gpu3_layer13_qkv -> gpu3_layer13_reshape
	gpu3_layer13_reshape -> gpu3_layer13_attn
	gpu3_layer13_attn -> gpu3_layer13_attn_reshape
	gpu3_layer13_attn_reshape -> gpu3_layer13_attn_out
	gpu3_layer13_attn_out -> gpu3_layer13_kv_update
	gpu3_layer13_kv_update -> gpu3_layer13_res1
	gpu3_layer13_res1 -> gpu3_layer13_ln2
	gpu3_layer13_ln2 -> gpu3_layer13_routing
	gpu3_layer13_expert0 -> gpu3_layer13_expert_agg
	gpu3_layer13_expert1 -> gpu3_layer13_expert_agg
	gpu3_layer13_expert2 -> gpu3_layer13_expert_agg
	gpu3_layer13_expert3 -> gpu3_layer13_expert_agg
	gpu3_layer13_routing -> gpu3_layer13_expert_agg
	gpu3_layer13_expert_agg -> gpu3_layer13_res2
	gpu3_layer14_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer14_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer14_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer14_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer14_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer14_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer14_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightgreen shape=ellipse style=filled]
	gpu3_layer14_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer14_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer14_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer14_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer14_routing -> gpu3_layer14_expert0 [label="Gate selection" style=dashed]
	gpu3_layer14_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer14_routing -> gpu3_layer14_expert1 [label="Gate selection" style=dashed]
	gpu3_layer14_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer14_routing -> gpu3_layer14_expert2 [label="Gate selection" style=dashed]
	gpu3_layer14_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer14_routing -> gpu3_layer14_expert3 [label="Gate selection" style=dashed]
	gpu3_layer14_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer14_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer13_res2 -> gpu3_layer14_ln1
	gpu3_layer14_ln1 -> gpu3_layer14_qkv
	gpu3_layer14_qkv -> gpu3_layer14_reshape
	gpu3_layer14_reshape -> gpu3_layer14_attn
	gpu3_layer14_attn -> gpu3_layer14_attn_reshape
	gpu3_layer14_attn_reshape -> gpu3_layer14_attn_out
	gpu3_layer14_attn_out -> gpu3_layer14_kv_update
	gpu3_layer14_kv_update -> gpu3_layer14_res1
	gpu3_layer14_res1 -> gpu3_layer14_ln2
	gpu3_layer14_ln2 -> gpu3_layer14_routing
	gpu3_layer14_expert0 -> gpu3_layer14_expert_agg
	gpu3_layer14_expert1 -> gpu3_layer14_expert_agg
	gpu3_layer14_expert2 -> gpu3_layer14_expert_agg
	gpu3_layer14_expert3 -> gpu3_layer14_expert_agg
	gpu3_layer14_routing -> gpu3_layer14_expert_agg
	gpu3_layer14_expert_agg -> gpu3_layer14_res2
	gpu3_layer15_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer15_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer15_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer15_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer15_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer15_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer15_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightgreen shape=ellipse style=filled]
	gpu3_layer15_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer15_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer15_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer15_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer15_routing -> gpu3_layer15_expert0 [label="Gate selection" style=dashed]
	gpu3_layer15_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer15_routing -> gpu3_layer15_expert1 [label="Gate selection" style=dashed]
	gpu3_layer15_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer15_routing -> gpu3_layer15_expert2 [label="Gate selection" style=dashed]
	gpu3_layer15_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer15_routing -> gpu3_layer15_expert3 [label="Gate selection" style=dashed]
	gpu3_layer15_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu3_layer15_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer14_res2 -> gpu3_layer15_ln1
	gpu3_layer15_ln1 -> gpu3_layer15_qkv
	gpu3_layer15_qkv -> gpu3_layer15_reshape
	gpu3_layer15_reshape -> gpu3_layer15_attn
	gpu3_layer15_attn -> gpu3_layer15_attn_reshape
	gpu3_layer15_attn_reshape -> gpu3_layer15_attn_out
	gpu3_layer15_attn_out -> gpu3_layer15_kv_update
	gpu3_layer15_kv_update -> gpu3_layer15_res1
	gpu3_layer15_res1 -> gpu3_layer15_ln2
	gpu3_layer15_ln2 -> gpu3_layer15_routing
	gpu3_layer15_expert0 -> gpu3_layer15_expert_agg
	gpu3_layer15_expert1 -> gpu3_layer15_expert_agg
	gpu3_layer15_expert2 -> gpu3_layer15_expert_agg
	gpu3_layer15_expert3 -> gpu3_layer15_expert_agg
	gpu3_layer15_routing -> gpu3_layer15_expert_agg
	gpu3_layer15_expert_agg -> gpu3_layer15_res2
	gpu3_final_ln [label="Final LayerNorm\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_layer15_res2 -> gpu3_final_ln
	gpu3_output_proj [label="Output Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 32000]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_final_ln -> gpu3_output_proj
	gpu3_softmax [label="Softmax\nInput: [256, 512, 32000]\nOutput: [256, 512, 32000]\nGPU: GPU3" fillcolor=lightblue shape=rectangle style=filled]
	gpu3_output_proj -> gpu3_softmax
	gpu4_embed [label="Embedding Layer\nInput: [256, 512]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	dp_split -> gpu4_embed [label="GPU 4\n256 sequences"]
	gpu4_layer0_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer0_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer0_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer0_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer0_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer0_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer0_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightgreen shape=ellipse style=filled]
	gpu4_layer0_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer0_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer0_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer0_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer0_routing -> gpu4_layer0_expert0 [label="Gate selection" style=dashed]
	gpu4_layer0_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer0_routing -> gpu4_layer0_expert1 [label="Gate selection" style=dashed]
	gpu4_layer0_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer0_routing -> gpu4_layer0_expert2 [label="Gate selection" style=dashed]
	gpu4_layer0_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer0_routing -> gpu4_layer0_expert3 [label="Gate selection" style=dashed]
	gpu4_layer0_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer0_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_embed -> gpu4_layer0_ln1
	gpu4_layer0_ln1 -> gpu4_layer0_qkv
	gpu4_layer0_qkv -> gpu4_layer0_reshape
	gpu4_layer0_reshape -> gpu4_layer0_attn
	gpu4_layer0_attn -> gpu4_layer0_attn_reshape
	gpu4_layer0_attn_reshape -> gpu4_layer0_attn_out
	gpu4_layer0_attn_out -> gpu4_layer0_kv_update
	gpu4_layer0_kv_update -> gpu4_layer0_res1
	gpu4_layer0_res1 -> gpu4_layer0_ln2
	gpu4_layer0_ln2 -> gpu4_layer0_routing
	gpu4_layer0_expert0 -> gpu4_layer0_expert_agg
	gpu4_layer0_expert1 -> gpu4_layer0_expert_agg
	gpu4_layer0_expert2 -> gpu4_layer0_expert_agg
	gpu4_layer0_expert3 -> gpu4_layer0_expert_agg
	gpu4_layer0_routing -> gpu4_layer0_expert_agg
	gpu4_layer0_expert_agg -> gpu4_layer0_res2
	gpu4_layer1_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer1_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer1_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer1_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer1_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer1_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer1_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightgreen shape=ellipse style=filled]
	gpu4_layer1_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer1_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer1_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer1_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer1_routing -> gpu4_layer1_expert0 [label="Gate selection" style=dashed]
	gpu4_layer1_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer1_routing -> gpu4_layer1_expert1 [label="Gate selection" style=dashed]
	gpu4_layer1_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer1_routing -> gpu4_layer1_expert2 [label="Gate selection" style=dashed]
	gpu4_layer1_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer1_routing -> gpu4_layer1_expert3 [label="Gate selection" style=dashed]
	gpu4_layer1_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer1_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer0_res2 -> gpu4_layer1_ln1
	gpu4_layer1_ln1 -> gpu4_layer1_qkv
	gpu4_layer1_qkv -> gpu4_layer1_reshape
	gpu4_layer1_reshape -> gpu4_layer1_attn
	gpu4_layer1_attn -> gpu4_layer1_attn_reshape
	gpu4_layer1_attn_reshape -> gpu4_layer1_attn_out
	gpu4_layer1_attn_out -> gpu4_layer1_kv_update
	gpu4_layer1_kv_update -> gpu4_layer1_res1
	gpu4_layer1_res1 -> gpu4_layer1_ln2
	gpu4_layer1_ln2 -> gpu4_layer1_routing
	gpu4_layer1_expert0 -> gpu4_layer1_expert_agg
	gpu4_layer1_expert1 -> gpu4_layer1_expert_agg
	gpu4_layer1_expert2 -> gpu4_layer1_expert_agg
	gpu4_layer1_expert3 -> gpu4_layer1_expert_agg
	gpu4_layer1_routing -> gpu4_layer1_expert_agg
	gpu4_layer1_expert_agg -> gpu4_layer1_res2
	gpu4_layer2_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer2_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer2_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer2_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer2_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer2_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer2_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightgreen shape=ellipse style=filled]
	gpu4_layer2_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer2_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer2_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer2_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer2_routing -> gpu4_layer2_expert0 [label="Gate selection" style=dashed]
	gpu4_layer2_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer2_routing -> gpu4_layer2_expert1 [label="Gate selection" style=dashed]
	gpu4_layer2_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer2_routing -> gpu4_layer2_expert2 [label="Gate selection" style=dashed]
	gpu4_layer2_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer2_routing -> gpu4_layer2_expert3 [label="Gate selection" style=dashed]
	gpu4_layer2_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer2_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer1_res2 -> gpu4_layer2_ln1
	gpu4_layer2_ln1 -> gpu4_layer2_qkv
	gpu4_layer2_qkv -> gpu4_layer2_reshape
	gpu4_layer2_reshape -> gpu4_layer2_attn
	gpu4_layer2_attn -> gpu4_layer2_attn_reshape
	gpu4_layer2_attn_reshape -> gpu4_layer2_attn_out
	gpu4_layer2_attn_out -> gpu4_layer2_kv_update
	gpu4_layer2_kv_update -> gpu4_layer2_res1
	gpu4_layer2_res1 -> gpu4_layer2_ln2
	gpu4_layer2_ln2 -> gpu4_layer2_routing
	gpu4_layer2_expert0 -> gpu4_layer2_expert_agg
	gpu4_layer2_expert1 -> gpu4_layer2_expert_agg
	gpu4_layer2_expert2 -> gpu4_layer2_expert_agg
	gpu4_layer2_expert3 -> gpu4_layer2_expert_agg
	gpu4_layer2_routing -> gpu4_layer2_expert_agg
	gpu4_layer2_expert_agg -> gpu4_layer2_res2
	gpu4_layer3_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer3_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer3_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer3_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer3_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer3_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer3_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightgreen shape=ellipse style=filled]
	gpu4_layer3_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer3_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer3_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer3_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer3_routing -> gpu4_layer3_expert0 [label="Gate selection" style=dashed]
	gpu4_layer3_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer3_routing -> gpu4_layer3_expert1 [label="Gate selection" style=dashed]
	gpu4_layer3_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer3_routing -> gpu4_layer3_expert2 [label="Gate selection" style=dashed]
	gpu4_layer3_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer3_routing -> gpu4_layer3_expert3 [label="Gate selection" style=dashed]
	gpu4_layer3_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer3_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer2_res2 -> gpu4_layer3_ln1
	gpu4_layer3_ln1 -> gpu4_layer3_qkv
	gpu4_layer3_qkv -> gpu4_layer3_reshape
	gpu4_layer3_reshape -> gpu4_layer3_attn
	gpu4_layer3_attn -> gpu4_layer3_attn_reshape
	gpu4_layer3_attn_reshape -> gpu4_layer3_attn_out
	gpu4_layer3_attn_out -> gpu4_layer3_kv_update
	gpu4_layer3_kv_update -> gpu4_layer3_res1
	gpu4_layer3_res1 -> gpu4_layer3_ln2
	gpu4_layer3_ln2 -> gpu4_layer3_routing
	gpu4_layer3_expert0 -> gpu4_layer3_expert_agg
	gpu4_layer3_expert1 -> gpu4_layer3_expert_agg
	gpu4_layer3_expert2 -> gpu4_layer3_expert_agg
	gpu4_layer3_expert3 -> gpu4_layer3_expert_agg
	gpu4_layer3_routing -> gpu4_layer3_expert_agg
	gpu4_layer3_expert_agg -> gpu4_layer3_res2
	gpu4_layer4_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer4_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer4_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer4_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer4_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer4_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer4_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightgreen shape=ellipse style=filled]
	gpu4_layer4_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer4_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer4_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer4_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer4_routing -> gpu4_layer4_expert0 [label="Gate selection" style=dashed]
	gpu4_layer4_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer4_routing -> gpu4_layer4_expert1 [label="Gate selection" style=dashed]
	gpu4_layer4_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer4_routing -> gpu4_layer4_expert2 [label="Gate selection" style=dashed]
	gpu4_layer4_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer4_routing -> gpu4_layer4_expert3 [label="Gate selection" style=dashed]
	gpu4_layer4_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer4_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer3_res2 -> gpu4_layer4_ln1
	gpu4_layer4_ln1 -> gpu4_layer4_qkv
	gpu4_layer4_qkv -> gpu4_layer4_reshape
	gpu4_layer4_reshape -> gpu4_layer4_attn
	gpu4_layer4_attn -> gpu4_layer4_attn_reshape
	gpu4_layer4_attn_reshape -> gpu4_layer4_attn_out
	gpu4_layer4_attn_out -> gpu4_layer4_kv_update
	gpu4_layer4_kv_update -> gpu4_layer4_res1
	gpu4_layer4_res1 -> gpu4_layer4_ln2
	gpu4_layer4_ln2 -> gpu4_layer4_routing
	gpu4_layer4_expert0 -> gpu4_layer4_expert_agg
	gpu4_layer4_expert1 -> gpu4_layer4_expert_agg
	gpu4_layer4_expert2 -> gpu4_layer4_expert_agg
	gpu4_layer4_expert3 -> gpu4_layer4_expert_agg
	gpu4_layer4_routing -> gpu4_layer4_expert_agg
	gpu4_layer4_expert_agg -> gpu4_layer4_res2
	gpu4_layer5_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer5_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer5_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer5_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer5_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer5_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer5_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightgreen shape=ellipse style=filled]
	gpu4_layer5_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer5_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer5_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer5_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer5_routing -> gpu4_layer5_expert0 [label="Gate selection" style=dashed]
	gpu4_layer5_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer5_routing -> gpu4_layer5_expert1 [label="Gate selection" style=dashed]
	gpu4_layer5_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer5_routing -> gpu4_layer5_expert2 [label="Gate selection" style=dashed]
	gpu4_layer5_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer5_routing -> gpu4_layer5_expert3 [label="Gate selection" style=dashed]
	gpu4_layer5_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer5_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer4_res2 -> gpu4_layer5_ln1
	gpu4_layer5_ln1 -> gpu4_layer5_qkv
	gpu4_layer5_qkv -> gpu4_layer5_reshape
	gpu4_layer5_reshape -> gpu4_layer5_attn
	gpu4_layer5_attn -> gpu4_layer5_attn_reshape
	gpu4_layer5_attn_reshape -> gpu4_layer5_attn_out
	gpu4_layer5_attn_out -> gpu4_layer5_kv_update
	gpu4_layer5_kv_update -> gpu4_layer5_res1
	gpu4_layer5_res1 -> gpu4_layer5_ln2
	gpu4_layer5_ln2 -> gpu4_layer5_routing
	gpu4_layer5_expert0 -> gpu4_layer5_expert_agg
	gpu4_layer5_expert1 -> gpu4_layer5_expert_agg
	gpu4_layer5_expert2 -> gpu4_layer5_expert_agg
	gpu4_layer5_expert3 -> gpu4_layer5_expert_agg
	gpu4_layer5_routing -> gpu4_layer5_expert_agg
	gpu4_layer5_expert_agg -> gpu4_layer5_res2
	gpu4_layer6_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer6_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer6_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer6_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer6_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer6_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer6_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightgreen shape=ellipse style=filled]
	gpu4_layer6_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer6_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer6_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer6_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer6_routing -> gpu4_layer6_expert0 [label="Gate selection" style=dashed]
	gpu4_layer6_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer6_routing -> gpu4_layer6_expert1 [label="Gate selection" style=dashed]
	gpu4_layer6_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer6_routing -> gpu4_layer6_expert2 [label="Gate selection" style=dashed]
	gpu4_layer6_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer6_routing -> gpu4_layer6_expert3 [label="Gate selection" style=dashed]
	gpu4_layer6_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer6_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer5_res2 -> gpu4_layer6_ln1
	gpu4_layer6_ln1 -> gpu4_layer6_qkv
	gpu4_layer6_qkv -> gpu4_layer6_reshape
	gpu4_layer6_reshape -> gpu4_layer6_attn
	gpu4_layer6_attn -> gpu4_layer6_attn_reshape
	gpu4_layer6_attn_reshape -> gpu4_layer6_attn_out
	gpu4_layer6_attn_out -> gpu4_layer6_kv_update
	gpu4_layer6_kv_update -> gpu4_layer6_res1
	gpu4_layer6_res1 -> gpu4_layer6_ln2
	gpu4_layer6_ln2 -> gpu4_layer6_routing
	gpu4_layer6_expert0 -> gpu4_layer6_expert_agg
	gpu4_layer6_expert1 -> gpu4_layer6_expert_agg
	gpu4_layer6_expert2 -> gpu4_layer6_expert_agg
	gpu4_layer6_expert3 -> gpu4_layer6_expert_agg
	gpu4_layer6_routing -> gpu4_layer6_expert_agg
	gpu4_layer6_expert_agg -> gpu4_layer6_res2
	gpu4_layer7_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer7_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer7_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer7_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer7_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer7_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer7_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightgreen shape=ellipse style=filled]
	gpu4_layer7_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer7_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer7_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer7_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer7_routing -> gpu4_layer7_expert0 [label="Gate selection" style=dashed]
	gpu4_layer7_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer7_routing -> gpu4_layer7_expert1 [label="Gate selection" style=dashed]
	gpu4_layer7_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer7_routing -> gpu4_layer7_expert2 [label="Gate selection" style=dashed]
	gpu4_layer7_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer7_routing -> gpu4_layer7_expert3 [label="Gate selection" style=dashed]
	gpu4_layer7_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer7_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer6_res2 -> gpu4_layer7_ln1
	gpu4_layer7_ln1 -> gpu4_layer7_qkv
	gpu4_layer7_qkv -> gpu4_layer7_reshape
	gpu4_layer7_reshape -> gpu4_layer7_attn
	gpu4_layer7_attn -> gpu4_layer7_attn_reshape
	gpu4_layer7_attn_reshape -> gpu4_layer7_attn_out
	gpu4_layer7_attn_out -> gpu4_layer7_kv_update
	gpu4_layer7_kv_update -> gpu4_layer7_res1
	gpu4_layer7_res1 -> gpu4_layer7_ln2
	gpu4_layer7_ln2 -> gpu4_layer7_routing
	gpu4_layer7_expert0 -> gpu4_layer7_expert_agg
	gpu4_layer7_expert1 -> gpu4_layer7_expert_agg
	gpu4_layer7_expert2 -> gpu4_layer7_expert_agg
	gpu4_layer7_expert3 -> gpu4_layer7_expert_agg
	gpu4_layer7_routing -> gpu4_layer7_expert_agg
	gpu4_layer7_expert_agg -> gpu4_layer7_res2
	gpu4_layer8_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer8_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer8_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer8_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer8_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer8_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer8_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightgreen shape=ellipse style=filled]
	gpu4_layer8_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer8_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer8_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer8_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer8_routing -> gpu4_layer8_expert0 [label="Gate selection" style=dashed]
	gpu4_layer8_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer8_routing -> gpu4_layer8_expert1 [label="Gate selection" style=dashed]
	gpu4_layer8_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer8_routing -> gpu4_layer8_expert2 [label="Gate selection" style=dashed]
	gpu4_layer8_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer8_routing -> gpu4_layer8_expert3 [label="Gate selection" style=dashed]
	gpu4_layer8_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer8_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer7_res2 -> gpu4_layer8_ln1
	gpu4_layer8_ln1 -> gpu4_layer8_qkv
	gpu4_layer8_qkv -> gpu4_layer8_reshape
	gpu4_layer8_reshape -> gpu4_layer8_attn
	gpu4_layer8_attn -> gpu4_layer8_attn_reshape
	gpu4_layer8_attn_reshape -> gpu4_layer8_attn_out
	gpu4_layer8_attn_out -> gpu4_layer8_kv_update
	gpu4_layer8_kv_update -> gpu4_layer8_res1
	gpu4_layer8_res1 -> gpu4_layer8_ln2
	gpu4_layer8_ln2 -> gpu4_layer8_routing
	gpu4_layer8_expert0 -> gpu4_layer8_expert_agg
	gpu4_layer8_expert1 -> gpu4_layer8_expert_agg
	gpu4_layer8_expert2 -> gpu4_layer8_expert_agg
	gpu4_layer8_expert3 -> gpu4_layer8_expert_agg
	gpu4_layer8_routing -> gpu4_layer8_expert_agg
	gpu4_layer8_expert_agg -> gpu4_layer8_res2
	gpu4_layer9_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer9_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer9_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer9_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer9_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer9_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer9_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightgreen shape=ellipse style=filled]
	gpu4_layer9_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer9_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer9_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer9_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer9_routing -> gpu4_layer9_expert0 [label="Gate selection" style=dashed]
	gpu4_layer9_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer9_routing -> gpu4_layer9_expert1 [label="Gate selection" style=dashed]
	gpu4_layer9_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer9_routing -> gpu4_layer9_expert2 [label="Gate selection" style=dashed]
	gpu4_layer9_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer9_routing -> gpu4_layer9_expert3 [label="Gate selection" style=dashed]
	gpu4_layer9_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer9_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer8_res2 -> gpu4_layer9_ln1
	gpu4_layer9_ln1 -> gpu4_layer9_qkv
	gpu4_layer9_qkv -> gpu4_layer9_reshape
	gpu4_layer9_reshape -> gpu4_layer9_attn
	gpu4_layer9_attn -> gpu4_layer9_attn_reshape
	gpu4_layer9_attn_reshape -> gpu4_layer9_attn_out
	gpu4_layer9_attn_out -> gpu4_layer9_kv_update
	gpu4_layer9_kv_update -> gpu4_layer9_res1
	gpu4_layer9_res1 -> gpu4_layer9_ln2
	gpu4_layer9_ln2 -> gpu4_layer9_routing
	gpu4_layer9_expert0 -> gpu4_layer9_expert_agg
	gpu4_layer9_expert1 -> gpu4_layer9_expert_agg
	gpu4_layer9_expert2 -> gpu4_layer9_expert_agg
	gpu4_layer9_expert3 -> gpu4_layer9_expert_agg
	gpu4_layer9_routing -> gpu4_layer9_expert_agg
	gpu4_layer9_expert_agg -> gpu4_layer9_res2
	gpu4_layer10_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer10_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer10_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer10_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer10_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer10_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer10_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightgreen shape=ellipse style=filled]
	gpu4_layer10_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer10_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer10_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer10_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer10_routing -> gpu4_layer10_expert0 [label="Gate selection" style=dashed]
	gpu4_layer10_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer10_routing -> gpu4_layer10_expert1 [label="Gate selection" style=dashed]
	gpu4_layer10_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer10_routing -> gpu4_layer10_expert2 [label="Gate selection" style=dashed]
	gpu4_layer10_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer10_routing -> gpu4_layer10_expert3 [label="Gate selection" style=dashed]
	gpu4_layer10_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer10_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer9_res2 -> gpu4_layer10_ln1
	gpu4_layer10_ln1 -> gpu4_layer10_qkv
	gpu4_layer10_qkv -> gpu4_layer10_reshape
	gpu4_layer10_reshape -> gpu4_layer10_attn
	gpu4_layer10_attn -> gpu4_layer10_attn_reshape
	gpu4_layer10_attn_reshape -> gpu4_layer10_attn_out
	gpu4_layer10_attn_out -> gpu4_layer10_kv_update
	gpu4_layer10_kv_update -> gpu4_layer10_res1
	gpu4_layer10_res1 -> gpu4_layer10_ln2
	gpu4_layer10_ln2 -> gpu4_layer10_routing
	gpu4_layer10_expert0 -> gpu4_layer10_expert_agg
	gpu4_layer10_expert1 -> gpu4_layer10_expert_agg
	gpu4_layer10_expert2 -> gpu4_layer10_expert_agg
	gpu4_layer10_expert3 -> gpu4_layer10_expert_agg
	gpu4_layer10_routing -> gpu4_layer10_expert_agg
	gpu4_layer10_expert_agg -> gpu4_layer10_res2
	gpu4_layer11_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer11_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer11_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer11_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer11_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer11_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer11_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightgreen shape=ellipse style=filled]
	gpu4_layer11_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer11_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer11_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer11_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer11_routing -> gpu4_layer11_expert0 [label="Gate selection" style=dashed]
	gpu4_layer11_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer11_routing -> gpu4_layer11_expert1 [label="Gate selection" style=dashed]
	gpu4_layer11_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer11_routing -> gpu4_layer11_expert2 [label="Gate selection" style=dashed]
	gpu4_layer11_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer11_routing -> gpu4_layer11_expert3 [label="Gate selection" style=dashed]
	gpu4_layer11_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer11_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer10_res2 -> gpu4_layer11_ln1
	gpu4_layer11_ln1 -> gpu4_layer11_qkv
	gpu4_layer11_qkv -> gpu4_layer11_reshape
	gpu4_layer11_reshape -> gpu4_layer11_attn
	gpu4_layer11_attn -> gpu4_layer11_attn_reshape
	gpu4_layer11_attn_reshape -> gpu4_layer11_attn_out
	gpu4_layer11_attn_out -> gpu4_layer11_kv_update
	gpu4_layer11_kv_update -> gpu4_layer11_res1
	gpu4_layer11_res1 -> gpu4_layer11_ln2
	gpu4_layer11_ln2 -> gpu4_layer11_routing
	gpu4_layer11_expert0 -> gpu4_layer11_expert_agg
	gpu4_layer11_expert1 -> gpu4_layer11_expert_agg
	gpu4_layer11_expert2 -> gpu4_layer11_expert_agg
	gpu4_layer11_expert3 -> gpu4_layer11_expert_agg
	gpu4_layer11_routing -> gpu4_layer11_expert_agg
	gpu4_layer11_expert_agg -> gpu4_layer11_res2
	gpu4_layer12_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer12_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer12_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer12_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer12_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer12_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer12_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightgreen shape=ellipse style=filled]
	gpu4_layer12_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer12_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer12_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer12_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer12_routing -> gpu4_layer12_expert0 [label="Gate selection" style=dashed]
	gpu4_layer12_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer12_routing -> gpu4_layer12_expert1 [label="Gate selection" style=dashed]
	gpu4_layer12_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer12_routing -> gpu4_layer12_expert2 [label="Gate selection" style=dashed]
	gpu4_layer12_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer12_routing -> gpu4_layer12_expert3 [label="Gate selection" style=dashed]
	gpu4_layer12_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer12_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer11_res2 -> gpu4_layer12_ln1
	gpu4_layer12_ln1 -> gpu4_layer12_qkv
	gpu4_layer12_qkv -> gpu4_layer12_reshape
	gpu4_layer12_reshape -> gpu4_layer12_attn
	gpu4_layer12_attn -> gpu4_layer12_attn_reshape
	gpu4_layer12_attn_reshape -> gpu4_layer12_attn_out
	gpu4_layer12_attn_out -> gpu4_layer12_kv_update
	gpu4_layer12_kv_update -> gpu4_layer12_res1
	gpu4_layer12_res1 -> gpu4_layer12_ln2
	gpu4_layer12_ln2 -> gpu4_layer12_routing
	gpu4_layer12_expert0 -> gpu4_layer12_expert_agg
	gpu4_layer12_expert1 -> gpu4_layer12_expert_agg
	gpu4_layer12_expert2 -> gpu4_layer12_expert_agg
	gpu4_layer12_expert3 -> gpu4_layer12_expert_agg
	gpu4_layer12_routing -> gpu4_layer12_expert_agg
	gpu4_layer12_expert_agg -> gpu4_layer12_res2
	gpu4_layer13_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer13_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer13_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer13_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer13_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer13_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer13_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightgreen shape=ellipse style=filled]
	gpu4_layer13_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer13_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer13_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer13_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer13_routing -> gpu4_layer13_expert0 [label="Gate selection" style=dashed]
	gpu4_layer13_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer13_routing -> gpu4_layer13_expert1 [label="Gate selection" style=dashed]
	gpu4_layer13_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer13_routing -> gpu4_layer13_expert2 [label="Gate selection" style=dashed]
	gpu4_layer13_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer13_routing -> gpu4_layer13_expert3 [label="Gate selection" style=dashed]
	gpu4_layer13_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer13_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer12_res2 -> gpu4_layer13_ln1
	gpu4_layer13_ln1 -> gpu4_layer13_qkv
	gpu4_layer13_qkv -> gpu4_layer13_reshape
	gpu4_layer13_reshape -> gpu4_layer13_attn
	gpu4_layer13_attn -> gpu4_layer13_attn_reshape
	gpu4_layer13_attn_reshape -> gpu4_layer13_attn_out
	gpu4_layer13_attn_out -> gpu4_layer13_kv_update
	gpu4_layer13_kv_update -> gpu4_layer13_res1
	gpu4_layer13_res1 -> gpu4_layer13_ln2
	gpu4_layer13_ln2 -> gpu4_layer13_routing
	gpu4_layer13_expert0 -> gpu4_layer13_expert_agg
	gpu4_layer13_expert1 -> gpu4_layer13_expert_agg
	gpu4_layer13_expert2 -> gpu4_layer13_expert_agg
	gpu4_layer13_expert3 -> gpu4_layer13_expert_agg
	gpu4_layer13_routing -> gpu4_layer13_expert_agg
	gpu4_layer13_expert_agg -> gpu4_layer13_res2
	gpu4_layer14_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer14_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer14_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer14_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer14_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer14_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer14_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightgreen shape=ellipse style=filled]
	gpu4_layer14_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer14_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer14_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer14_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer14_routing -> gpu4_layer14_expert0 [label="Gate selection" style=dashed]
	gpu4_layer14_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer14_routing -> gpu4_layer14_expert1 [label="Gate selection" style=dashed]
	gpu4_layer14_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer14_routing -> gpu4_layer14_expert2 [label="Gate selection" style=dashed]
	gpu4_layer14_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer14_routing -> gpu4_layer14_expert3 [label="Gate selection" style=dashed]
	gpu4_layer14_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer14_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer13_res2 -> gpu4_layer14_ln1
	gpu4_layer14_ln1 -> gpu4_layer14_qkv
	gpu4_layer14_qkv -> gpu4_layer14_reshape
	gpu4_layer14_reshape -> gpu4_layer14_attn
	gpu4_layer14_attn -> gpu4_layer14_attn_reshape
	gpu4_layer14_attn_reshape -> gpu4_layer14_attn_out
	gpu4_layer14_attn_out -> gpu4_layer14_kv_update
	gpu4_layer14_kv_update -> gpu4_layer14_res1
	gpu4_layer14_res1 -> gpu4_layer14_ln2
	gpu4_layer14_ln2 -> gpu4_layer14_routing
	gpu4_layer14_expert0 -> gpu4_layer14_expert_agg
	gpu4_layer14_expert1 -> gpu4_layer14_expert_agg
	gpu4_layer14_expert2 -> gpu4_layer14_expert_agg
	gpu4_layer14_expert3 -> gpu4_layer14_expert_agg
	gpu4_layer14_routing -> gpu4_layer14_expert_agg
	gpu4_layer14_expert_agg -> gpu4_layer14_res2
	gpu4_layer15_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer15_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer15_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer15_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer15_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer15_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer15_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightgreen shape=ellipse style=filled]
	gpu4_layer15_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer15_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer15_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer15_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer15_routing -> gpu4_layer15_expert0 [label="Gate selection" style=dashed]
	gpu4_layer15_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer15_routing -> gpu4_layer15_expert1 [label="Gate selection" style=dashed]
	gpu4_layer15_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer15_routing -> gpu4_layer15_expert2 [label="Gate selection" style=dashed]
	gpu4_layer15_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer15_routing -> gpu4_layer15_expert3 [label="Gate selection" style=dashed]
	gpu4_layer15_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu4_layer15_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer14_res2 -> gpu4_layer15_ln1
	gpu4_layer15_ln1 -> gpu4_layer15_qkv
	gpu4_layer15_qkv -> gpu4_layer15_reshape
	gpu4_layer15_reshape -> gpu4_layer15_attn
	gpu4_layer15_attn -> gpu4_layer15_attn_reshape
	gpu4_layer15_attn_reshape -> gpu4_layer15_attn_out
	gpu4_layer15_attn_out -> gpu4_layer15_kv_update
	gpu4_layer15_kv_update -> gpu4_layer15_res1
	gpu4_layer15_res1 -> gpu4_layer15_ln2
	gpu4_layer15_ln2 -> gpu4_layer15_routing
	gpu4_layer15_expert0 -> gpu4_layer15_expert_agg
	gpu4_layer15_expert1 -> gpu4_layer15_expert_agg
	gpu4_layer15_expert2 -> gpu4_layer15_expert_agg
	gpu4_layer15_expert3 -> gpu4_layer15_expert_agg
	gpu4_layer15_routing -> gpu4_layer15_expert_agg
	gpu4_layer15_expert_agg -> gpu4_layer15_res2
	gpu4_final_ln [label="Final LayerNorm\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_layer15_res2 -> gpu4_final_ln
	gpu4_output_proj [label="Output Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 32000]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_final_ln -> gpu4_output_proj
	gpu4_softmax [label="Softmax\nInput: [256, 512, 32000]\nOutput: [256, 512, 32000]\nGPU: GPU4" fillcolor=lightblue shape=rectangle style=filled]
	gpu4_output_proj -> gpu4_softmax
	gpu5_embed [label="Embedding Layer\nInput: [256, 512]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	dp_split -> gpu5_embed [label="GPU 5\n256 sequences"]
	gpu5_layer0_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer0_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer0_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer0_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer0_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer0_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer0_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightgreen shape=ellipse style=filled]
	gpu5_layer0_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer0_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer0_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer0_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer0_routing -> gpu5_layer0_expert0 [label="Gate selection" style=dashed]
	gpu5_layer0_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer0_routing -> gpu5_layer0_expert1 [label="Gate selection" style=dashed]
	gpu5_layer0_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer0_routing -> gpu5_layer0_expert2 [label="Gate selection" style=dashed]
	gpu5_layer0_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer0_routing -> gpu5_layer0_expert3 [label="Gate selection" style=dashed]
	gpu5_layer0_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer0_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_embed -> gpu5_layer0_ln1
	gpu5_layer0_ln1 -> gpu5_layer0_qkv
	gpu5_layer0_qkv -> gpu5_layer0_reshape
	gpu5_layer0_reshape -> gpu5_layer0_attn
	gpu5_layer0_attn -> gpu5_layer0_attn_reshape
	gpu5_layer0_attn_reshape -> gpu5_layer0_attn_out
	gpu5_layer0_attn_out -> gpu5_layer0_kv_update
	gpu5_layer0_kv_update -> gpu5_layer0_res1
	gpu5_layer0_res1 -> gpu5_layer0_ln2
	gpu5_layer0_ln2 -> gpu5_layer0_routing
	gpu5_layer0_expert0 -> gpu5_layer0_expert_agg
	gpu5_layer0_expert1 -> gpu5_layer0_expert_agg
	gpu5_layer0_expert2 -> gpu5_layer0_expert_agg
	gpu5_layer0_expert3 -> gpu5_layer0_expert_agg
	gpu5_layer0_routing -> gpu5_layer0_expert_agg
	gpu5_layer0_expert_agg -> gpu5_layer0_res2
	gpu5_layer1_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer1_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer1_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer1_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer1_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer1_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer1_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightgreen shape=ellipse style=filled]
	gpu5_layer1_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer1_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer1_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer1_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer1_routing -> gpu5_layer1_expert0 [label="Gate selection" style=dashed]
	gpu5_layer1_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer1_routing -> gpu5_layer1_expert1 [label="Gate selection" style=dashed]
	gpu5_layer1_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer1_routing -> gpu5_layer1_expert2 [label="Gate selection" style=dashed]
	gpu5_layer1_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer1_routing -> gpu5_layer1_expert3 [label="Gate selection" style=dashed]
	gpu5_layer1_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer1_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer0_res2 -> gpu5_layer1_ln1
	gpu5_layer1_ln1 -> gpu5_layer1_qkv
	gpu5_layer1_qkv -> gpu5_layer1_reshape
	gpu5_layer1_reshape -> gpu5_layer1_attn
	gpu5_layer1_attn -> gpu5_layer1_attn_reshape
	gpu5_layer1_attn_reshape -> gpu5_layer1_attn_out
	gpu5_layer1_attn_out -> gpu5_layer1_kv_update
	gpu5_layer1_kv_update -> gpu5_layer1_res1
	gpu5_layer1_res1 -> gpu5_layer1_ln2
	gpu5_layer1_ln2 -> gpu5_layer1_routing
	gpu5_layer1_expert0 -> gpu5_layer1_expert_agg
	gpu5_layer1_expert1 -> gpu5_layer1_expert_agg
	gpu5_layer1_expert2 -> gpu5_layer1_expert_agg
	gpu5_layer1_expert3 -> gpu5_layer1_expert_agg
	gpu5_layer1_routing -> gpu5_layer1_expert_agg
	gpu5_layer1_expert_agg -> gpu5_layer1_res2
	gpu5_layer2_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer2_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer2_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer2_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer2_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer2_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer2_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightgreen shape=ellipse style=filled]
	gpu5_layer2_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer2_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer2_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer2_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer2_routing -> gpu5_layer2_expert0 [label="Gate selection" style=dashed]
	gpu5_layer2_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer2_routing -> gpu5_layer2_expert1 [label="Gate selection" style=dashed]
	gpu5_layer2_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer2_routing -> gpu5_layer2_expert2 [label="Gate selection" style=dashed]
	gpu5_layer2_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer2_routing -> gpu5_layer2_expert3 [label="Gate selection" style=dashed]
	gpu5_layer2_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer2_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer1_res2 -> gpu5_layer2_ln1
	gpu5_layer2_ln1 -> gpu5_layer2_qkv
	gpu5_layer2_qkv -> gpu5_layer2_reshape
	gpu5_layer2_reshape -> gpu5_layer2_attn
	gpu5_layer2_attn -> gpu5_layer2_attn_reshape
	gpu5_layer2_attn_reshape -> gpu5_layer2_attn_out
	gpu5_layer2_attn_out -> gpu5_layer2_kv_update
	gpu5_layer2_kv_update -> gpu5_layer2_res1
	gpu5_layer2_res1 -> gpu5_layer2_ln2
	gpu5_layer2_ln2 -> gpu5_layer2_routing
	gpu5_layer2_expert0 -> gpu5_layer2_expert_agg
	gpu5_layer2_expert1 -> gpu5_layer2_expert_agg
	gpu5_layer2_expert2 -> gpu5_layer2_expert_agg
	gpu5_layer2_expert3 -> gpu5_layer2_expert_agg
	gpu5_layer2_routing -> gpu5_layer2_expert_agg
	gpu5_layer2_expert_agg -> gpu5_layer2_res2
	gpu5_layer3_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer3_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer3_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer3_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer3_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer3_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer3_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightgreen shape=ellipse style=filled]
	gpu5_layer3_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer3_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer3_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer3_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer3_routing -> gpu5_layer3_expert0 [label="Gate selection" style=dashed]
	gpu5_layer3_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer3_routing -> gpu5_layer3_expert1 [label="Gate selection" style=dashed]
	gpu5_layer3_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer3_routing -> gpu5_layer3_expert2 [label="Gate selection" style=dashed]
	gpu5_layer3_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer3_routing -> gpu5_layer3_expert3 [label="Gate selection" style=dashed]
	gpu5_layer3_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer3_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer2_res2 -> gpu5_layer3_ln1
	gpu5_layer3_ln1 -> gpu5_layer3_qkv
	gpu5_layer3_qkv -> gpu5_layer3_reshape
	gpu5_layer3_reshape -> gpu5_layer3_attn
	gpu5_layer3_attn -> gpu5_layer3_attn_reshape
	gpu5_layer3_attn_reshape -> gpu5_layer3_attn_out
	gpu5_layer3_attn_out -> gpu5_layer3_kv_update
	gpu5_layer3_kv_update -> gpu5_layer3_res1
	gpu5_layer3_res1 -> gpu5_layer3_ln2
	gpu5_layer3_ln2 -> gpu5_layer3_routing
	gpu5_layer3_expert0 -> gpu5_layer3_expert_agg
	gpu5_layer3_expert1 -> gpu5_layer3_expert_agg
	gpu5_layer3_expert2 -> gpu5_layer3_expert_agg
	gpu5_layer3_expert3 -> gpu5_layer3_expert_agg
	gpu5_layer3_routing -> gpu5_layer3_expert_agg
	gpu5_layer3_expert_agg -> gpu5_layer3_res2
	gpu5_layer4_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer4_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer4_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer4_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer4_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer4_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer4_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightgreen shape=ellipse style=filled]
	gpu5_layer4_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer4_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer4_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer4_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer4_routing -> gpu5_layer4_expert0 [label="Gate selection" style=dashed]
	gpu5_layer4_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer4_routing -> gpu5_layer4_expert1 [label="Gate selection" style=dashed]
	gpu5_layer4_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer4_routing -> gpu5_layer4_expert2 [label="Gate selection" style=dashed]
	gpu5_layer4_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer4_routing -> gpu5_layer4_expert3 [label="Gate selection" style=dashed]
	gpu5_layer4_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer4_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer3_res2 -> gpu5_layer4_ln1
	gpu5_layer4_ln1 -> gpu5_layer4_qkv
	gpu5_layer4_qkv -> gpu5_layer4_reshape
	gpu5_layer4_reshape -> gpu5_layer4_attn
	gpu5_layer4_attn -> gpu5_layer4_attn_reshape
	gpu5_layer4_attn_reshape -> gpu5_layer4_attn_out
	gpu5_layer4_attn_out -> gpu5_layer4_kv_update
	gpu5_layer4_kv_update -> gpu5_layer4_res1
	gpu5_layer4_res1 -> gpu5_layer4_ln2
	gpu5_layer4_ln2 -> gpu5_layer4_routing
	gpu5_layer4_expert0 -> gpu5_layer4_expert_agg
	gpu5_layer4_expert1 -> gpu5_layer4_expert_agg
	gpu5_layer4_expert2 -> gpu5_layer4_expert_agg
	gpu5_layer4_expert3 -> gpu5_layer4_expert_agg
	gpu5_layer4_routing -> gpu5_layer4_expert_agg
	gpu5_layer4_expert_agg -> gpu5_layer4_res2
	gpu5_layer5_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer5_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer5_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer5_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer5_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer5_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer5_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightgreen shape=ellipse style=filled]
	gpu5_layer5_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer5_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer5_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer5_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer5_routing -> gpu5_layer5_expert0 [label="Gate selection" style=dashed]
	gpu5_layer5_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer5_routing -> gpu5_layer5_expert1 [label="Gate selection" style=dashed]
	gpu5_layer5_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer5_routing -> gpu5_layer5_expert2 [label="Gate selection" style=dashed]
	gpu5_layer5_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer5_routing -> gpu5_layer5_expert3 [label="Gate selection" style=dashed]
	gpu5_layer5_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer5_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer4_res2 -> gpu5_layer5_ln1
	gpu5_layer5_ln1 -> gpu5_layer5_qkv
	gpu5_layer5_qkv -> gpu5_layer5_reshape
	gpu5_layer5_reshape -> gpu5_layer5_attn
	gpu5_layer5_attn -> gpu5_layer5_attn_reshape
	gpu5_layer5_attn_reshape -> gpu5_layer5_attn_out
	gpu5_layer5_attn_out -> gpu5_layer5_kv_update
	gpu5_layer5_kv_update -> gpu5_layer5_res1
	gpu5_layer5_res1 -> gpu5_layer5_ln2
	gpu5_layer5_ln2 -> gpu5_layer5_routing
	gpu5_layer5_expert0 -> gpu5_layer5_expert_agg
	gpu5_layer5_expert1 -> gpu5_layer5_expert_agg
	gpu5_layer5_expert2 -> gpu5_layer5_expert_agg
	gpu5_layer5_expert3 -> gpu5_layer5_expert_agg
	gpu5_layer5_routing -> gpu5_layer5_expert_agg
	gpu5_layer5_expert_agg -> gpu5_layer5_res2
	gpu5_layer6_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer6_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer6_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer6_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer6_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer6_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer6_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightgreen shape=ellipse style=filled]
	gpu5_layer6_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer6_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer6_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer6_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer6_routing -> gpu5_layer6_expert0 [label="Gate selection" style=dashed]
	gpu5_layer6_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer6_routing -> gpu5_layer6_expert1 [label="Gate selection" style=dashed]
	gpu5_layer6_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer6_routing -> gpu5_layer6_expert2 [label="Gate selection" style=dashed]
	gpu5_layer6_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer6_routing -> gpu5_layer6_expert3 [label="Gate selection" style=dashed]
	gpu5_layer6_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer6_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer5_res2 -> gpu5_layer6_ln1
	gpu5_layer6_ln1 -> gpu5_layer6_qkv
	gpu5_layer6_qkv -> gpu5_layer6_reshape
	gpu5_layer6_reshape -> gpu5_layer6_attn
	gpu5_layer6_attn -> gpu5_layer6_attn_reshape
	gpu5_layer6_attn_reshape -> gpu5_layer6_attn_out
	gpu5_layer6_attn_out -> gpu5_layer6_kv_update
	gpu5_layer6_kv_update -> gpu5_layer6_res1
	gpu5_layer6_res1 -> gpu5_layer6_ln2
	gpu5_layer6_ln2 -> gpu5_layer6_routing
	gpu5_layer6_expert0 -> gpu5_layer6_expert_agg
	gpu5_layer6_expert1 -> gpu5_layer6_expert_agg
	gpu5_layer6_expert2 -> gpu5_layer6_expert_agg
	gpu5_layer6_expert3 -> gpu5_layer6_expert_agg
	gpu5_layer6_routing -> gpu5_layer6_expert_agg
	gpu5_layer6_expert_agg -> gpu5_layer6_res2
	gpu5_layer7_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer7_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer7_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer7_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer7_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer7_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer7_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightgreen shape=ellipse style=filled]
	gpu5_layer7_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer7_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer7_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer7_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer7_routing -> gpu5_layer7_expert0 [label="Gate selection" style=dashed]
	gpu5_layer7_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer7_routing -> gpu5_layer7_expert1 [label="Gate selection" style=dashed]
	gpu5_layer7_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer7_routing -> gpu5_layer7_expert2 [label="Gate selection" style=dashed]
	gpu5_layer7_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer7_routing -> gpu5_layer7_expert3 [label="Gate selection" style=dashed]
	gpu5_layer7_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer7_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer6_res2 -> gpu5_layer7_ln1
	gpu5_layer7_ln1 -> gpu5_layer7_qkv
	gpu5_layer7_qkv -> gpu5_layer7_reshape
	gpu5_layer7_reshape -> gpu5_layer7_attn
	gpu5_layer7_attn -> gpu5_layer7_attn_reshape
	gpu5_layer7_attn_reshape -> gpu5_layer7_attn_out
	gpu5_layer7_attn_out -> gpu5_layer7_kv_update
	gpu5_layer7_kv_update -> gpu5_layer7_res1
	gpu5_layer7_res1 -> gpu5_layer7_ln2
	gpu5_layer7_ln2 -> gpu5_layer7_routing
	gpu5_layer7_expert0 -> gpu5_layer7_expert_agg
	gpu5_layer7_expert1 -> gpu5_layer7_expert_agg
	gpu5_layer7_expert2 -> gpu5_layer7_expert_agg
	gpu5_layer7_expert3 -> gpu5_layer7_expert_agg
	gpu5_layer7_routing -> gpu5_layer7_expert_agg
	gpu5_layer7_expert_agg -> gpu5_layer7_res2
	gpu5_layer8_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer8_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer8_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer8_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer8_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer8_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer8_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightgreen shape=ellipse style=filled]
	gpu5_layer8_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer8_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer8_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer8_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer8_routing -> gpu5_layer8_expert0 [label="Gate selection" style=dashed]
	gpu5_layer8_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer8_routing -> gpu5_layer8_expert1 [label="Gate selection" style=dashed]
	gpu5_layer8_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer8_routing -> gpu5_layer8_expert2 [label="Gate selection" style=dashed]
	gpu5_layer8_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer8_routing -> gpu5_layer8_expert3 [label="Gate selection" style=dashed]
	gpu5_layer8_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer8_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer7_res2 -> gpu5_layer8_ln1
	gpu5_layer8_ln1 -> gpu5_layer8_qkv
	gpu5_layer8_qkv -> gpu5_layer8_reshape
	gpu5_layer8_reshape -> gpu5_layer8_attn
	gpu5_layer8_attn -> gpu5_layer8_attn_reshape
	gpu5_layer8_attn_reshape -> gpu5_layer8_attn_out
	gpu5_layer8_attn_out -> gpu5_layer8_kv_update
	gpu5_layer8_kv_update -> gpu5_layer8_res1
	gpu5_layer8_res1 -> gpu5_layer8_ln2
	gpu5_layer8_ln2 -> gpu5_layer8_routing
	gpu5_layer8_expert0 -> gpu5_layer8_expert_agg
	gpu5_layer8_expert1 -> gpu5_layer8_expert_agg
	gpu5_layer8_expert2 -> gpu5_layer8_expert_agg
	gpu5_layer8_expert3 -> gpu5_layer8_expert_agg
	gpu5_layer8_routing -> gpu5_layer8_expert_agg
	gpu5_layer8_expert_agg -> gpu5_layer8_res2
	gpu5_layer9_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer9_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer9_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer9_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer9_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer9_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer9_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightgreen shape=ellipse style=filled]
	gpu5_layer9_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer9_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer9_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer9_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer9_routing -> gpu5_layer9_expert0 [label="Gate selection" style=dashed]
	gpu5_layer9_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer9_routing -> gpu5_layer9_expert1 [label="Gate selection" style=dashed]
	gpu5_layer9_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer9_routing -> gpu5_layer9_expert2 [label="Gate selection" style=dashed]
	gpu5_layer9_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer9_routing -> gpu5_layer9_expert3 [label="Gate selection" style=dashed]
	gpu5_layer9_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer9_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer8_res2 -> gpu5_layer9_ln1
	gpu5_layer9_ln1 -> gpu5_layer9_qkv
	gpu5_layer9_qkv -> gpu5_layer9_reshape
	gpu5_layer9_reshape -> gpu5_layer9_attn
	gpu5_layer9_attn -> gpu5_layer9_attn_reshape
	gpu5_layer9_attn_reshape -> gpu5_layer9_attn_out
	gpu5_layer9_attn_out -> gpu5_layer9_kv_update
	gpu5_layer9_kv_update -> gpu5_layer9_res1
	gpu5_layer9_res1 -> gpu5_layer9_ln2
	gpu5_layer9_ln2 -> gpu5_layer9_routing
	gpu5_layer9_expert0 -> gpu5_layer9_expert_agg
	gpu5_layer9_expert1 -> gpu5_layer9_expert_agg
	gpu5_layer9_expert2 -> gpu5_layer9_expert_agg
	gpu5_layer9_expert3 -> gpu5_layer9_expert_agg
	gpu5_layer9_routing -> gpu5_layer9_expert_agg
	gpu5_layer9_expert_agg -> gpu5_layer9_res2
	gpu5_layer10_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer10_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer10_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer10_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer10_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer10_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer10_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightgreen shape=ellipse style=filled]
	gpu5_layer10_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer10_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer10_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer10_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer10_routing -> gpu5_layer10_expert0 [label="Gate selection" style=dashed]
	gpu5_layer10_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer10_routing -> gpu5_layer10_expert1 [label="Gate selection" style=dashed]
	gpu5_layer10_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer10_routing -> gpu5_layer10_expert2 [label="Gate selection" style=dashed]
	gpu5_layer10_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer10_routing -> gpu5_layer10_expert3 [label="Gate selection" style=dashed]
	gpu5_layer10_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer10_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer9_res2 -> gpu5_layer10_ln1
	gpu5_layer10_ln1 -> gpu5_layer10_qkv
	gpu5_layer10_qkv -> gpu5_layer10_reshape
	gpu5_layer10_reshape -> gpu5_layer10_attn
	gpu5_layer10_attn -> gpu5_layer10_attn_reshape
	gpu5_layer10_attn_reshape -> gpu5_layer10_attn_out
	gpu5_layer10_attn_out -> gpu5_layer10_kv_update
	gpu5_layer10_kv_update -> gpu5_layer10_res1
	gpu5_layer10_res1 -> gpu5_layer10_ln2
	gpu5_layer10_ln2 -> gpu5_layer10_routing
	gpu5_layer10_expert0 -> gpu5_layer10_expert_agg
	gpu5_layer10_expert1 -> gpu5_layer10_expert_agg
	gpu5_layer10_expert2 -> gpu5_layer10_expert_agg
	gpu5_layer10_expert3 -> gpu5_layer10_expert_agg
	gpu5_layer10_routing -> gpu5_layer10_expert_agg
	gpu5_layer10_expert_agg -> gpu5_layer10_res2
	gpu5_layer11_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer11_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer11_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer11_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer11_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer11_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer11_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightgreen shape=ellipse style=filled]
	gpu5_layer11_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer11_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer11_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer11_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer11_routing -> gpu5_layer11_expert0 [label="Gate selection" style=dashed]
	gpu5_layer11_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer11_routing -> gpu5_layer11_expert1 [label="Gate selection" style=dashed]
	gpu5_layer11_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer11_routing -> gpu5_layer11_expert2 [label="Gate selection" style=dashed]
	gpu5_layer11_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer11_routing -> gpu5_layer11_expert3 [label="Gate selection" style=dashed]
	gpu5_layer11_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer11_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer10_res2 -> gpu5_layer11_ln1
	gpu5_layer11_ln1 -> gpu5_layer11_qkv
	gpu5_layer11_qkv -> gpu5_layer11_reshape
	gpu5_layer11_reshape -> gpu5_layer11_attn
	gpu5_layer11_attn -> gpu5_layer11_attn_reshape
	gpu5_layer11_attn_reshape -> gpu5_layer11_attn_out
	gpu5_layer11_attn_out -> gpu5_layer11_kv_update
	gpu5_layer11_kv_update -> gpu5_layer11_res1
	gpu5_layer11_res1 -> gpu5_layer11_ln2
	gpu5_layer11_ln2 -> gpu5_layer11_routing
	gpu5_layer11_expert0 -> gpu5_layer11_expert_agg
	gpu5_layer11_expert1 -> gpu5_layer11_expert_agg
	gpu5_layer11_expert2 -> gpu5_layer11_expert_agg
	gpu5_layer11_expert3 -> gpu5_layer11_expert_agg
	gpu5_layer11_routing -> gpu5_layer11_expert_agg
	gpu5_layer11_expert_agg -> gpu5_layer11_res2
	gpu5_layer12_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer12_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer12_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer12_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer12_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer12_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer12_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightgreen shape=ellipse style=filled]
	gpu5_layer12_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer12_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer12_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer12_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer12_routing -> gpu5_layer12_expert0 [label="Gate selection" style=dashed]
	gpu5_layer12_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer12_routing -> gpu5_layer12_expert1 [label="Gate selection" style=dashed]
	gpu5_layer12_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer12_routing -> gpu5_layer12_expert2 [label="Gate selection" style=dashed]
	gpu5_layer12_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer12_routing -> gpu5_layer12_expert3 [label="Gate selection" style=dashed]
	gpu5_layer12_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer12_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer11_res2 -> gpu5_layer12_ln1
	gpu5_layer12_ln1 -> gpu5_layer12_qkv
	gpu5_layer12_qkv -> gpu5_layer12_reshape
	gpu5_layer12_reshape -> gpu5_layer12_attn
	gpu5_layer12_attn -> gpu5_layer12_attn_reshape
	gpu5_layer12_attn_reshape -> gpu5_layer12_attn_out
	gpu5_layer12_attn_out -> gpu5_layer12_kv_update
	gpu5_layer12_kv_update -> gpu5_layer12_res1
	gpu5_layer12_res1 -> gpu5_layer12_ln2
	gpu5_layer12_ln2 -> gpu5_layer12_routing
	gpu5_layer12_expert0 -> gpu5_layer12_expert_agg
	gpu5_layer12_expert1 -> gpu5_layer12_expert_agg
	gpu5_layer12_expert2 -> gpu5_layer12_expert_agg
	gpu5_layer12_expert3 -> gpu5_layer12_expert_agg
	gpu5_layer12_routing -> gpu5_layer12_expert_agg
	gpu5_layer12_expert_agg -> gpu5_layer12_res2
	gpu5_layer13_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer13_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer13_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer13_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer13_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer13_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer13_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightgreen shape=ellipse style=filled]
	gpu5_layer13_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer13_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer13_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer13_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer13_routing -> gpu5_layer13_expert0 [label="Gate selection" style=dashed]
	gpu5_layer13_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer13_routing -> gpu5_layer13_expert1 [label="Gate selection" style=dashed]
	gpu5_layer13_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer13_routing -> gpu5_layer13_expert2 [label="Gate selection" style=dashed]
	gpu5_layer13_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer13_routing -> gpu5_layer13_expert3 [label="Gate selection" style=dashed]
	gpu5_layer13_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer13_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer12_res2 -> gpu5_layer13_ln1
	gpu5_layer13_ln1 -> gpu5_layer13_qkv
	gpu5_layer13_qkv -> gpu5_layer13_reshape
	gpu5_layer13_reshape -> gpu5_layer13_attn
	gpu5_layer13_attn -> gpu5_layer13_attn_reshape
	gpu5_layer13_attn_reshape -> gpu5_layer13_attn_out
	gpu5_layer13_attn_out -> gpu5_layer13_kv_update
	gpu5_layer13_kv_update -> gpu5_layer13_res1
	gpu5_layer13_res1 -> gpu5_layer13_ln2
	gpu5_layer13_ln2 -> gpu5_layer13_routing
	gpu5_layer13_expert0 -> gpu5_layer13_expert_agg
	gpu5_layer13_expert1 -> gpu5_layer13_expert_agg
	gpu5_layer13_expert2 -> gpu5_layer13_expert_agg
	gpu5_layer13_expert3 -> gpu5_layer13_expert_agg
	gpu5_layer13_routing -> gpu5_layer13_expert_agg
	gpu5_layer13_expert_agg -> gpu5_layer13_res2
	gpu5_layer14_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer14_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer14_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer14_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer14_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer14_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer14_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightgreen shape=ellipse style=filled]
	gpu5_layer14_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer14_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer14_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer14_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer14_routing -> gpu5_layer14_expert0 [label="Gate selection" style=dashed]
	gpu5_layer14_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer14_routing -> gpu5_layer14_expert1 [label="Gate selection" style=dashed]
	gpu5_layer14_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer14_routing -> gpu5_layer14_expert2 [label="Gate selection" style=dashed]
	gpu5_layer14_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer14_routing -> gpu5_layer14_expert3 [label="Gate selection" style=dashed]
	gpu5_layer14_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer14_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer13_res2 -> gpu5_layer14_ln1
	gpu5_layer14_ln1 -> gpu5_layer14_qkv
	gpu5_layer14_qkv -> gpu5_layer14_reshape
	gpu5_layer14_reshape -> gpu5_layer14_attn
	gpu5_layer14_attn -> gpu5_layer14_attn_reshape
	gpu5_layer14_attn_reshape -> gpu5_layer14_attn_out
	gpu5_layer14_attn_out -> gpu5_layer14_kv_update
	gpu5_layer14_kv_update -> gpu5_layer14_res1
	gpu5_layer14_res1 -> gpu5_layer14_ln2
	gpu5_layer14_ln2 -> gpu5_layer14_routing
	gpu5_layer14_expert0 -> gpu5_layer14_expert_agg
	gpu5_layer14_expert1 -> gpu5_layer14_expert_agg
	gpu5_layer14_expert2 -> gpu5_layer14_expert_agg
	gpu5_layer14_expert3 -> gpu5_layer14_expert_agg
	gpu5_layer14_routing -> gpu5_layer14_expert_agg
	gpu5_layer14_expert_agg -> gpu5_layer14_res2
	gpu5_layer15_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer15_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer15_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer15_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer15_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer15_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer15_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightgreen shape=ellipse style=filled]
	gpu5_layer15_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer15_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer15_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer15_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer15_routing -> gpu5_layer15_expert0 [label="Gate selection" style=dashed]
	gpu5_layer15_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer15_routing -> gpu5_layer15_expert1 [label="Gate selection" style=dashed]
	gpu5_layer15_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer15_routing -> gpu5_layer15_expert2 [label="Gate selection" style=dashed]
	gpu5_layer15_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer15_routing -> gpu5_layer15_expert3 [label="Gate selection" style=dashed]
	gpu5_layer15_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu5_layer15_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer14_res2 -> gpu5_layer15_ln1
	gpu5_layer15_ln1 -> gpu5_layer15_qkv
	gpu5_layer15_qkv -> gpu5_layer15_reshape
	gpu5_layer15_reshape -> gpu5_layer15_attn
	gpu5_layer15_attn -> gpu5_layer15_attn_reshape
	gpu5_layer15_attn_reshape -> gpu5_layer15_attn_out
	gpu5_layer15_attn_out -> gpu5_layer15_kv_update
	gpu5_layer15_kv_update -> gpu5_layer15_res1
	gpu5_layer15_res1 -> gpu5_layer15_ln2
	gpu5_layer15_ln2 -> gpu5_layer15_routing
	gpu5_layer15_expert0 -> gpu5_layer15_expert_agg
	gpu5_layer15_expert1 -> gpu5_layer15_expert_agg
	gpu5_layer15_expert2 -> gpu5_layer15_expert_agg
	gpu5_layer15_expert3 -> gpu5_layer15_expert_agg
	gpu5_layer15_routing -> gpu5_layer15_expert_agg
	gpu5_layer15_expert_agg -> gpu5_layer15_res2
	gpu5_final_ln [label="Final LayerNorm\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_layer15_res2 -> gpu5_final_ln
	gpu5_output_proj [label="Output Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 32000]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_final_ln -> gpu5_output_proj
	gpu5_softmax [label="Softmax\nInput: [256, 512, 32000]\nOutput: [256, 512, 32000]\nGPU: GPU5" fillcolor=lightblue shape=rectangle style=filled]
	gpu5_output_proj -> gpu5_softmax
	gpu6_embed [label="Embedding Layer\nInput: [256, 512]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	dp_split -> gpu6_embed [label="GPU 6\n256 sequences"]
	gpu6_layer0_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer0_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer0_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer0_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer0_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer0_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer0_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightgreen shape=ellipse style=filled]
	gpu6_layer0_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer0_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer0_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer0_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer0_routing -> gpu6_layer0_expert0 [label="Gate selection" style=dashed]
	gpu6_layer0_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer0_routing -> gpu6_layer0_expert1 [label="Gate selection" style=dashed]
	gpu6_layer0_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer0_routing -> gpu6_layer0_expert2 [label="Gate selection" style=dashed]
	gpu6_layer0_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer0_routing -> gpu6_layer0_expert3 [label="Gate selection" style=dashed]
	gpu6_layer0_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer0_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_embed -> gpu6_layer0_ln1
	gpu6_layer0_ln1 -> gpu6_layer0_qkv
	gpu6_layer0_qkv -> gpu6_layer0_reshape
	gpu6_layer0_reshape -> gpu6_layer0_attn
	gpu6_layer0_attn -> gpu6_layer0_attn_reshape
	gpu6_layer0_attn_reshape -> gpu6_layer0_attn_out
	gpu6_layer0_attn_out -> gpu6_layer0_kv_update
	gpu6_layer0_kv_update -> gpu6_layer0_res1
	gpu6_layer0_res1 -> gpu6_layer0_ln2
	gpu6_layer0_ln2 -> gpu6_layer0_routing
	gpu6_layer0_expert0 -> gpu6_layer0_expert_agg
	gpu6_layer0_expert1 -> gpu6_layer0_expert_agg
	gpu6_layer0_expert2 -> gpu6_layer0_expert_agg
	gpu6_layer0_expert3 -> gpu6_layer0_expert_agg
	gpu6_layer0_routing -> gpu6_layer0_expert_agg
	gpu6_layer0_expert_agg -> gpu6_layer0_res2
	gpu6_layer1_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer1_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer1_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer1_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer1_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer1_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer1_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightgreen shape=ellipse style=filled]
	gpu6_layer1_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer1_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer1_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer1_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer1_routing -> gpu6_layer1_expert0 [label="Gate selection" style=dashed]
	gpu6_layer1_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer1_routing -> gpu6_layer1_expert1 [label="Gate selection" style=dashed]
	gpu6_layer1_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer1_routing -> gpu6_layer1_expert2 [label="Gate selection" style=dashed]
	gpu6_layer1_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer1_routing -> gpu6_layer1_expert3 [label="Gate selection" style=dashed]
	gpu6_layer1_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer1_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer0_res2 -> gpu6_layer1_ln1
	gpu6_layer1_ln1 -> gpu6_layer1_qkv
	gpu6_layer1_qkv -> gpu6_layer1_reshape
	gpu6_layer1_reshape -> gpu6_layer1_attn
	gpu6_layer1_attn -> gpu6_layer1_attn_reshape
	gpu6_layer1_attn_reshape -> gpu6_layer1_attn_out
	gpu6_layer1_attn_out -> gpu6_layer1_kv_update
	gpu6_layer1_kv_update -> gpu6_layer1_res1
	gpu6_layer1_res1 -> gpu6_layer1_ln2
	gpu6_layer1_ln2 -> gpu6_layer1_routing
	gpu6_layer1_expert0 -> gpu6_layer1_expert_agg
	gpu6_layer1_expert1 -> gpu6_layer1_expert_agg
	gpu6_layer1_expert2 -> gpu6_layer1_expert_agg
	gpu6_layer1_expert3 -> gpu6_layer1_expert_agg
	gpu6_layer1_routing -> gpu6_layer1_expert_agg
	gpu6_layer1_expert_agg -> gpu6_layer1_res2
	gpu6_layer2_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer2_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer2_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer2_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer2_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer2_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer2_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightgreen shape=ellipse style=filled]
	gpu6_layer2_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer2_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer2_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer2_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer2_routing -> gpu6_layer2_expert0 [label="Gate selection" style=dashed]
	gpu6_layer2_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer2_routing -> gpu6_layer2_expert1 [label="Gate selection" style=dashed]
	gpu6_layer2_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer2_routing -> gpu6_layer2_expert2 [label="Gate selection" style=dashed]
	gpu6_layer2_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer2_routing -> gpu6_layer2_expert3 [label="Gate selection" style=dashed]
	gpu6_layer2_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer2_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer1_res2 -> gpu6_layer2_ln1
	gpu6_layer2_ln1 -> gpu6_layer2_qkv
	gpu6_layer2_qkv -> gpu6_layer2_reshape
	gpu6_layer2_reshape -> gpu6_layer2_attn
	gpu6_layer2_attn -> gpu6_layer2_attn_reshape
	gpu6_layer2_attn_reshape -> gpu6_layer2_attn_out
	gpu6_layer2_attn_out -> gpu6_layer2_kv_update
	gpu6_layer2_kv_update -> gpu6_layer2_res1
	gpu6_layer2_res1 -> gpu6_layer2_ln2
	gpu6_layer2_ln2 -> gpu6_layer2_routing
	gpu6_layer2_expert0 -> gpu6_layer2_expert_agg
	gpu6_layer2_expert1 -> gpu6_layer2_expert_agg
	gpu6_layer2_expert2 -> gpu6_layer2_expert_agg
	gpu6_layer2_expert3 -> gpu6_layer2_expert_agg
	gpu6_layer2_routing -> gpu6_layer2_expert_agg
	gpu6_layer2_expert_agg -> gpu6_layer2_res2
	gpu6_layer3_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer3_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer3_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer3_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer3_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer3_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer3_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightgreen shape=ellipse style=filled]
	gpu6_layer3_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer3_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer3_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer3_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer3_routing -> gpu6_layer3_expert0 [label="Gate selection" style=dashed]
	gpu6_layer3_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer3_routing -> gpu6_layer3_expert1 [label="Gate selection" style=dashed]
	gpu6_layer3_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer3_routing -> gpu6_layer3_expert2 [label="Gate selection" style=dashed]
	gpu6_layer3_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer3_routing -> gpu6_layer3_expert3 [label="Gate selection" style=dashed]
	gpu6_layer3_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer3_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer2_res2 -> gpu6_layer3_ln1
	gpu6_layer3_ln1 -> gpu6_layer3_qkv
	gpu6_layer3_qkv -> gpu6_layer3_reshape
	gpu6_layer3_reshape -> gpu6_layer3_attn
	gpu6_layer3_attn -> gpu6_layer3_attn_reshape
	gpu6_layer3_attn_reshape -> gpu6_layer3_attn_out
	gpu6_layer3_attn_out -> gpu6_layer3_kv_update
	gpu6_layer3_kv_update -> gpu6_layer3_res1
	gpu6_layer3_res1 -> gpu6_layer3_ln2
	gpu6_layer3_ln2 -> gpu6_layer3_routing
	gpu6_layer3_expert0 -> gpu6_layer3_expert_agg
	gpu6_layer3_expert1 -> gpu6_layer3_expert_agg
	gpu6_layer3_expert2 -> gpu6_layer3_expert_agg
	gpu6_layer3_expert3 -> gpu6_layer3_expert_agg
	gpu6_layer3_routing -> gpu6_layer3_expert_agg
	gpu6_layer3_expert_agg -> gpu6_layer3_res2
	gpu6_layer4_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer4_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer4_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer4_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer4_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer4_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer4_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightgreen shape=ellipse style=filled]
	gpu6_layer4_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer4_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer4_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer4_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer4_routing -> gpu6_layer4_expert0 [label="Gate selection" style=dashed]
	gpu6_layer4_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer4_routing -> gpu6_layer4_expert1 [label="Gate selection" style=dashed]
	gpu6_layer4_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer4_routing -> gpu6_layer4_expert2 [label="Gate selection" style=dashed]
	gpu6_layer4_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer4_routing -> gpu6_layer4_expert3 [label="Gate selection" style=dashed]
	gpu6_layer4_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer4_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer3_res2 -> gpu6_layer4_ln1
	gpu6_layer4_ln1 -> gpu6_layer4_qkv
	gpu6_layer4_qkv -> gpu6_layer4_reshape
	gpu6_layer4_reshape -> gpu6_layer4_attn
	gpu6_layer4_attn -> gpu6_layer4_attn_reshape
	gpu6_layer4_attn_reshape -> gpu6_layer4_attn_out
	gpu6_layer4_attn_out -> gpu6_layer4_kv_update
	gpu6_layer4_kv_update -> gpu6_layer4_res1
	gpu6_layer4_res1 -> gpu6_layer4_ln2
	gpu6_layer4_ln2 -> gpu6_layer4_routing
	gpu6_layer4_expert0 -> gpu6_layer4_expert_agg
	gpu6_layer4_expert1 -> gpu6_layer4_expert_agg
	gpu6_layer4_expert2 -> gpu6_layer4_expert_agg
	gpu6_layer4_expert3 -> gpu6_layer4_expert_agg
	gpu6_layer4_routing -> gpu6_layer4_expert_agg
	gpu6_layer4_expert_agg -> gpu6_layer4_res2
	gpu6_layer5_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer5_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer5_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer5_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer5_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer5_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer5_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightgreen shape=ellipse style=filled]
	gpu6_layer5_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer5_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer5_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer5_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer5_routing -> gpu6_layer5_expert0 [label="Gate selection" style=dashed]
	gpu6_layer5_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer5_routing -> gpu6_layer5_expert1 [label="Gate selection" style=dashed]
	gpu6_layer5_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer5_routing -> gpu6_layer5_expert2 [label="Gate selection" style=dashed]
	gpu6_layer5_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer5_routing -> gpu6_layer5_expert3 [label="Gate selection" style=dashed]
	gpu6_layer5_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer5_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer4_res2 -> gpu6_layer5_ln1
	gpu6_layer5_ln1 -> gpu6_layer5_qkv
	gpu6_layer5_qkv -> gpu6_layer5_reshape
	gpu6_layer5_reshape -> gpu6_layer5_attn
	gpu6_layer5_attn -> gpu6_layer5_attn_reshape
	gpu6_layer5_attn_reshape -> gpu6_layer5_attn_out
	gpu6_layer5_attn_out -> gpu6_layer5_kv_update
	gpu6_layer5_kv_update -> gpu6_layer5_res1
	gpu6_layer5_res1 -> gpu6_layer5_ln2
	gpu6_layer5_ln2 -> gpu6_layer5_routing
	gpu6_layer5_expert0 -> gpu6_layer5_expert_agg
	gpu6_layer5_expert1 -> gpu6_layer5_expert_agg
	gpu6_layer5_expert2 -> gpu6_layer5_expert_agg
	gpu6_layer5_expert3 -> gpu6_layer5_expert_agg
	gpu6_layer5_routing -> gpu6_layer5_expert_agg
	gpu6_layer5_expert_agg -> gpu6_layer5_res2
	gpu6_layer6_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer6_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer6_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer6_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer6_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer6_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer6_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightgreen shape=ellipse style=filled]
	gpu6_layer6_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer6_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer6_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer6_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer6_routing -> gpu6_layer6_expert0 [label="Gate selection" style=dashed]
	gpu6_layer6_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer6_routing -> gpu6_layer6_expert1 [label="Gate selection" style=dashed]
	gpu6_layer6_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer6_routing -> gpu6_layer6_expert2 [label="Gate selection" style=dashed]
	gpu6_layer6_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer6_routing -> gpu6_layer6_expert3 [label="Gate selection" style=dashed]
	gpu6_layer6_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer6_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer5_res2 -> gpu6_layer6_ln1
	gpu6_layer6_ln1 -> gpu6_layer6_qkv
	gpu6_layer6_qkv -> gpu6_layer6_reshape
	gpu6_layer6_reshape -> gpu6_layer6_attn
	gpu6_layer6_attn -> gpu6_layer6_attn_reshape
	gpu6_layer6_attn_reshape -> gpu6_layer6_attn_out
	gpu6_layer6_attn_out -> gpu6_layer6_kv_update
	gpu6_layer6_kv_update -> gpu6_layer6_res1
	gpu6_layer6_res1 -> gpu6_layer6_ln2
	gpu6_layer6_ln2 -> gpu6_layer6_routing
	gpu6_layer6_expert0 -> gpu6_layer6_expert_agg
	gpu6_layer6_expert1 -> gpu6_layer6_expert_agg
	gpu6_layer6_expert2 -> gpu6_layer6_expert_agg
	gpu6_layer6_expert3 -> gpu6_layer6_expert_agg
	gpu6_layer6_routing -> gpu6_layer6_expert_agg
	gpu6_layer6_expert_agg -> gpu6_layer6_res2
	gpu6_layer7_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer7_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer7_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer7_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer7_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer7_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer7_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightgreen shape=ellipse style=filled]
	gpu6_layer7_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer7_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer7_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer7_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer7_routing -> gpu6_layer7_expert0 [label="Gate selection" style=dashed]
	gpu6_layer7_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer7_routing -> gpu6_layer7_expert1 [label="Gate selection" style=dashed]
	gpu6_layer7_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer7_routing -> gpu6_layer7_expert2 [label="Gate selection" style=dashed]
	gpu6_layer7_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer7_routing -> gpu6_layer7_expert3 [label="Gate selection" style=dashed]
	gpu6_layer7_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer7_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer6_res2 -> gpu6_layer7_ln1
	gpu6_layer7_ln1 -> gpu6_layer7_qkv
	gpu6_layer7_qkv -> gpu6_layer7_reshape
	gpu6_layer7_reshape -> gpu6_layer7_attn
	gpu6_layer7_attn -> gpu6_layer7_attn_reshape
	gpu6_layer7_attn_reshape -> gpu6_layer7_attn_out
	gpu6_layer7_attn_out -> gpu6_layer7_kv_update
	gpu6_layer7_kv_update -> gpu6_layer7_res1
	gpu6_layer7_res1 -> gpu6_layer7_ln2
	gpu6_layer7_ln2 -> gpu6_layer7_routing
	gpu6_layer7_expert0 -> gpu6_layer7_expert_agg
	gpu6_layer7_expert1 -> gpu6_layer7_expert_agg
	gpu6_layer7_expert2 -> gpu6_layer7_expert_agg
	gpu6_layer7_expert3 -> gpu6_layer7_expert_agg
	gpu6_layer7_routing -> gpu6_layer7_expert_agg
	gpu6_layer7_expert_agg -> gpu6_layer7_res2
	gpu6_layer8_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer8_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer8_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer8_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer8_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer8_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer8_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightgreen shape=ellipse style=filled]
	gpu6_layer8_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer8_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer8_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer8_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer8_routing -> gpu6_layer8_expert0 [label="Gate selection" style=dashed]
	gpu6_layer8_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer8_routing -> gpu6_layer8_expert1 [label="Gate selection" style=dashed]
	gpu6_layer8_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer8_routing -> gpu6_layer8_expert2 [label="Gate selection" style=dashed]
	gpu6_layer8_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer8_routing -> gpu6_layer8_expert3 [label="Gate selection" style=dashed]
	gpu6_layer8_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer8_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer7_res2 -> gpu6_layer8_ln1
	gpu6_layer8_ln1 -> gpu6_layer8_qkv
	gpu6_layer8_qkv -> gpu6_layer8_reshape
	gpu6_layer8_reshape -> gpu6_layer8_attn
	gpu6_layer8_attn -> gpu6_layer8_attn_reshape
	gpu6_layer8_attn_reshape -> gpu6_layer8_attn_out
	gpu6_layer8_attn_out -> gpu6_layer8_kv_update
	gpu6_layer8_kv_update -> gpu6_layer8_res1
	gpu6_layer8_res1 -> gpu6_layer8_ln2
	gpu6_layer8_ln2 -> gpu6_layer8_routing
	gpu6_layer8_expert0 -> gpu6_layer8_expert_agg
	gpu6_layer8_expert1 -> gpu6_layer8_expert_agg
	gpu6_layer8_expert2 -> gpu6_layer8_expert_agg
	gpu6_layer8_expert3 -> gpu6_layer8_expert_agg
	gpu6_layer8_routing -> gpu6_layer8_expert_agg
	gpu6_layer8_expert_agg -> gpu6_layer8_res2
	gpu6_layer9_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer9_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer9_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer9_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer9_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer9_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer9_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightgreen shape=ellipse style=filled]
	gpu6_layer9_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer9_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer9_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer9_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer9_routing -> gpu6_layer9_expert0 [label="Gate selection" style=dashed]
	gpu6_layer9_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer9_routing -> gpu6_layer9_expert1 [label="Gate selection" style=dashed]
	gpu6_layer9_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer9_routing -> gpu6_layer9_expert2 [label="Gate selection" style=dashed]
	gpu6_layer9_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer9_routing -> gpu6_layer9_expert3 [label="Gate selection" style=dashed]
	gpu6_layer9_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer9_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer8_res2 -> gpu6_layer9_ln1
	gpu6_layer9_ln1 -> gpu6_layer9_qkv
	gpu6_layer9_qkv -> gpu6_layer9_reshape
	gpu6_layer9_reshape -> gpu6_layer9_attn
	gpu6_layer9_attn -> gpu6_layer9_attn_reshape
	gpu6_layer9_attn_reshape -> gpu6_layer9_attn_out
	gpu6_layer9_attn_out -> gpu6_layer9_kv_update
	gpu6_layer9_kv_update -> gpu6_layer9_res1
	gpu6_layer9_res1 -> gpu6_layer9_ln2
	gpu6_layer9_ln2 -> gpu6_layer9_routing
	gpu6_layer9_expert0 -> gpu6_layer9_expert_agg
	gpu6_layer9_expert1 -> gpu6_layer9_expert_agg
	gpu6_layer9_expert2 -> gpu6_layer9_expert_agg
	gpu6_layer9_expert3 -> gpu6_layer9_expert_agg
	gpu6_layer9_routing -> gpu6_layer9_expert_agg
	gpu6_layer9_expert_agg -> gpu6_layer9_res2
	gpu6_layer10_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer10_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer10_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer10_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer10_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer10_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer10_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightgreen shape=ellipse style=filled]
	gpu6_layer10_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer10_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer10_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer10_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer10_routing -> gpu6_layer10_expert0 [label="Gate selection" style=dashed]
	gpu6_layer10_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer10_routing -> gpu6_layer10_expert1 [label="Gate selection" style=dashed]
	gpu6_layer10_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer10_routing -> gpu6_layer10_expert2 [label="Gate selection" style=dashed]
	gpu6_layer10_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer10_routing -> gpu6_layer10_expert3 [label="Gate selection" style=dashed]
	gpu6_layer10_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer10_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer9_res2 -> gpu6_layer10_ln1
	gpu6_layer10_ln1 -> gpu6_layer10_qkv
	gpu6_layer10_qkv -> gpu6_layer10_reshape
	gpu6_layer10_reshape -> gpu6_layer10_attn
	gpu6_layer10_attn -> gpu6_layer10_attn_reshape
	gpu6_layer10_attn_reshape -> gpu6_layer10_attn_out
	gpu6_layer10_attn_out -> gpu6_layer10_kv_update
	gpu6_layer10_kv_update -> gpu6_layer10_res1
	gpu6_layer10_res1 -> gpu6_layer10_ln2
	gpu6_layer10_ln2 -> gpu6_layer10_routing
	gpu6_layer10_expert0 -> gpu6_layer10_expert_agg
	gpu6_layer10_expert1 -> gpu6_layer10_expert_agg
	gpu6_layer10_expert2 -> gpu6_layer10_expert_agg
	gpu6_layer10_expert3 -> gpu6_layer10_expert_agg
	gpu6_layer10_routing -> gpu6_layer10_expert_agg
	gpu6_layer10_expert_agg -> gpu6_layer10_res2
	gpu6_layer11_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer11_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer11_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer11_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer11_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer11_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer11_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightgreen shape=ellipse style=filled]
	gpu6_layer11_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer11_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer11_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer11_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer11_routing -> gpu6_layer11_expert0 [label="Gate selection" style=dashed]
	gpu6_layer11_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer11_routing -> gpu6_layer11_expert1 [label="Gate selection" style=dashed]
	gpu6_layer11_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer11_routing -> gpu6_layer11_expert2 [label="Gate selection" style=dashed]
	gpu6_layer11_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer11_routing -> gpu6_layer11_expert3 [label="Gate selection" style=dashed]
	gpu6_layer11_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer11_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer10_res2 -> gpu6_layer11_ln1
	gpu6_layer11_ln1 -> gpu6_layer11_qkv
	gpu6_layer11_qkv -> gpu6_layer11_reshape
	gpu6_layer11_reshape -> gpu6_layer11_attn
	gpu6_layer11_attn -> gpu6_layer11_attn_reshape
	gpu6_layer11_attn_reshape -> gpu6_layer11_attn_out
	gpu6_layer11_attn_out -> gpu6_layer11_kv_update
	gpu6_layer11_kv_update -> gpu6_layer11_res1
	gpu6_layer11_res1 -> gpu6_layer11_ln2
	gpu6_layer11_ln2 -> gpu6_layer11_routing
	gpu6_layer11_expert0 -> gpu6_layer11_expert_agg
	gpu6_layer11_expert1 -> gpu6_layer11_expert_agg
	gpu6_layer11_expert2 -> gpu6_layer11_expert_agg
	gpu6_layer11_expert3 -> gpu6_layer11_expert_agg
	gpu6_layer11_routing -> gpu6_layer11_expert_agg
	gpu6_layer11_expert_agg -> gpu6_layer11_res2
	gpu6_layer12_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer12_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer12_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer12_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer12_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer12_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer12_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightgreen shape=ellipse style=filled]
	gpu6_layer12_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer12_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer12_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer12_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer12_routing -> gpu6_layer12_expert0 [label="Gate selection" style=dashed]
	gpu6_layer12_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer12_routing -> gpu6_layer12_expert1 [label="Gate selection" style=dashed]
	gpu6_layer12_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer12_routing -> gpu6_layer12_expert2 [label="Gate selection" style=dashed]
	gpu6_layer12_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer12_routing -> gpu6_layer12_expert3 [label="Gate selection" style=dashed]
	gpu6_layer12_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer12_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer11_res2 -> gpu6_layer12_ln1
	gpu6_layer12_ln1 -> gpu6_layer12_qkv
	gpu6_layer12_qkv -> gpu6_layer12_reshape
	gpu6_layer12_reshape -> gpu6_layer12_attn
	gpu6_layer12_attn -> gpu6_layer12_attn_reshape
	gpu6_layer12_attn_reshape -> gpu6_layer12_attn_out
	gpu6_layer12_attn_out -> gpu6_layer12_kv_update
	gpu6_layer12_kv_update -> gpu6_layer12_res1
	gpu6_layer12_res1 -> gpu6_layer12_ln2
	gpu6_layer12_ln2 -> gpu6_layer12_routing
	gpu6_layer12_expert0 -> gpu6_layer12_expert_agg
	gpu6_layer12_expert1 -> gpu6_layer12_expert_agg
	gpu6_layer12_expert2 -> gpu6_layer12_expert_agg
	gpu6_layer12_expert3 -> gpu6_layer12_expert_agg
	gpu6_layer12_routing -> gpu6_layer12_expert_agg
	gpu6_layer12_expert_agg -> gpu6_layer12_res2
	gpu6_layer13_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer13_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer13_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer13_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer13_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer13_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer13_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightgreen shape=ellipse style=filled]
	gpu6_layer13_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer13_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer13_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer13_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer13_routing -> gpu6_layer13_expert0 [label="Gate selection" style=dashed]
	gpu6_layer13_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer13_routing -> gpu6_layer13_expert1 [label="Gate selection" style=dashed]
	gpu6_layer13_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer13_routing -> gpu6_layer13_expert2 [label="Gate selection" style=dashed]
	gpu6_layer13_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer13_routing -> gpu6_layer13_expert3 [label="Gate selection" style=dashed]
	gpu6_layer13_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer13_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer12_res2 -> gpu6_layer13_ln1
	gpu6_layer13_ln1 -> gpu6_layer13_qkv
	gpu6_layer13_qkv -> gpu6_layer13_reshape
	gpu6_layer13_reshape -> gpu6_layer13_attn
	gpu6_layer13_attn -> gpu6_layer13_attn_reshape
	gpu6_layer13_attn_reshape -> gpu6_layer13_attn_out
	gpu6_layer13_attn_out -> gpu6_layer13_kv_update
	gpu6_layer13_kv_update -> gpu6_layer13_res1
	gpu6_layer13_res1 -> gpu6_layer13_ln2
	gpu6_layer13_ln2 -> gpu6_layer13_routing
	gpu6_layer13_expert0 -> gpu6_layer13_expert_agg
	gpu6_layer13_expert1 -> gpu6_layer13_expert_agg
	gpu6_layer13_expert2 -> gpu6_layer13_expert_agg
	gpu6_layer13_expert3 -> gpu6_layer13_expert_agg
	gpu6_layer13_routing -> gpu6_layer13_expert_agg
	gpu6_layer13_expert_agg -> gpu6_layer13_res2
	gpu6_layer14_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer14_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer14_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer14_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer14_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer14_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer14_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightgreen shape=ellipse style=filled]
	gpu6_layer14_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer14_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer14_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer14_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer14_routing -> gpu6_layer14_expert0 [label="Gate selection" style=dashed]
	gpu6_layer14_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer14_routing -> gpu6_layer14_expert1 [label="Gate selection" style=dashed]
	gpu6_layer14_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer14_routing -> gpu6_layer14_expert2 [label="Gate selection" style=dashed]
	gpu6_layer14_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer14_routing -> gpu6_layer14_expert3 [label="Gate selection" style=dashed]
	gpu6_layer14_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer14_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer13_res2 -> gpu6_layer14_ln1
	gpu6_layer14_ln1 -> gpu6_layer14_qkv
	gpu6_layer14_qkv -> gpu6_layer14_reshape
	gpu6_layer14_reshape -> gpu6_layer14_attn
	gpu6_layer14_attn -> gpu6_layer14_attn_reshape
	gpu6_layer14_attn_reshape -> gpu6_layer14_attn_out
	gpu6_layer14_attn_out -> gpu6_layer14_kv_update
	gpu6_layer14_kv_update -> gpu6_layer14_res1
	gpu6_layer14_res1 -> gpu6_layer14_ln2
	gpu6_layer14_ln2 -> gpu6_layer14_routing
	gpu6_layer14_expert0 -> gpu6_layer14_expert_agg
	gpu6_layer14_expert1 -> gpu6_layer14_expert_agg
	gpu6_layer14_expert2 -> gpu6_layer14_expert_agg
	gpu6_layer14_expert3 -> gpu6_layer14_expert_agg
	gpu6_layer14_routing -> gpu6_layer14_expert_agg
	gpu6_layer14_expert_agg -> gpu6_layer14_res2
	gpu6_layer15_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer15_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer15_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer15_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer15_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer15_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer15_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightgreen shape=ellipse style=filled]
	gpu6_layer15_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer15_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer15_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer15_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer15_routing -> gpu6_layer15_expert0 [label="Gate selection" style=dashed]
	gpu6_layer15_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer15_routing -> gpu6_layer15_expert1 [label="Gate selection" style=dashed]
	gpu6_layer15_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer15_routing -> gpu6_layer15_expert2 [label="Gate selection" style=dashed]
	gpu6_layer15_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer15_routing -> gpu6_layer15_expert3 [label="Gate selection" style=dashed]
	gpu6_layer15_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu6_layer15_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer14_res2 -> gpu6_layer15_ln1
	gpu6_layer15_ln1 -> gpu6_layer15_qkv
	gpu6_layer15_qkv -> gpu6_layer15_reshape
	gpu6_layer15_reshape -> gpu6_layer15_attn
	gpu6_layer15_attn -> gpu6_layer15_attn_reshape
	gpu6_layer15_attn_reshape -> gpu6_layer15_attn_out
	gpu6_layer15_attn_out -> gpu6_layer15_kv_update
	gpu6_layer15_kv_update -> gpu6_layer15_res1
	gpu6_layer15_res1 -> gpu6_layer15_ln2
	gpu6_layer15_ln2 -> gpu6_layer15_routing
	gpu6_layer15_expert0 -> gpu6_layer15_expert_agg
	gpu6_layer15_expert1 -> gpu6_layer15_expert_agg
	gpu6_layer15_expert2 -> gpu6_layer15_expert_agg
	gpu6_layer15_expert3 -> gpu6_layer15_expert_agg
	gpu6_layer15_routing -> gpu6_layer15_expert_agg
	gpu6_layer15_expert_agg -> gpu6_layer15_res2
	gpu6_final_ln [label="Final LayerNorm\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_layer15_res2 -> gpu6_final_ln
	gpu6_output_proj [label="Output Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 32000]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_final_ln -> gpu6_output_proj
	gpu6_softmax [label="Softmax\nInput: [256, 512, 32000]\nOutput: [256, 512, 32000]\nGPU: GPU6" fillcolor=lightblue shape=rectangle style=filled]
	gpu6_output_proj -> gpu6_softmax
	gpu7_embed [label="Embedding Layer\nInput: [256, 512]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	dp_split -> gpu7_embed [label="GPU 7\n256 sequences"]
	gpu7_layer0_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer0_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer0_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer0_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer0_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer0_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer0_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightgreen shape=ellipse style=filled]
	gpu7_layer0_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer0_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer0_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer0_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer0_routing -> gpu7_layer0_expert0 [label="Gate selection" style=dashed]
	gpu7_layer0_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer0_routing -> gpu7_layer0_expert1 [label="Gate selection" style=dashed]
	gpu7_layer0_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer0_routing -> gpu7_layer0_expert2 [label="Gate selection" style=dashed]
	gpu7_layer0_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer0_routing -> gpu7_layer0_expert3 [label="Gate selection" style=dashed]
	gpu7_layer0_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer0_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_embed -> gpu7_layer0_ln1
	gpu7_layer0_ln1 -> gpu7_layer0_qkv
	gpu7_layer0_qkv -> gpu7_layer0_reshape
	gpu7_layer0_reshape -> gpu7_layer0_attn
	gpu7_layer0_attn -> gpu7_layer0_attn_reshape
	gpu7_layer0_attn_reshape -> gpu7_layer0_attn_out
	gpu7_layer0_attn_out -> gpu7_layer0_kv_update
	gpu7_layer0_kv_update -> gpu7_layer0_res1
	gpu7_layer0_res1 -> gpu7_layer0_ln2
	gpu7_layer0_ln2 -> gpu7_layer0_routing
	gpu7_layer0_expert0 -> gpu7_layer0_expert_agg
	gpu7_layer0_expert1 -> gpu7_layer0_expert_agg
	gpu7_layer0_expert2 -> gpu7_layer0_expert_agg
	gpu7_layer0_expert3 -> gpu7_layer0_expert_agg
	gpu7_layer0_routing -> gpu7_layer0_expert_agg
	gpu7_layer0_expert_agg -> gpu7_layer0_res2
	gpu7_layer1_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer1_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer1_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer1_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer1_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer1_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer1_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightgreen shape=ellipse style=filled]
	gpu7_layer1_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer1_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer1_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer1_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer1_routing -> gpu7_layer1_expert0 [label="Gate selection" style=dashed]
	gpu7_layer1_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer1_routing -> gpu7_layer1_expert1 [label="Gate selection" style=dashed]
	gpu7_layer1_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer1_routing -> gpu7_layer1_expert2 [label="Gate selection" style=dashed]
	gpu7_layer1_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer1_routing -> gpu7_layer1_expert3 [label="Gate selection" style=dashed]
	gpu7_layer1_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer1_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer0_res2 -> gpu7_layer1_ln1
	gpu7_layer1_ln1 -> gpu7_layer1_qkv
	gpu7_layer1_qkv -> gpu7_layer1_reshape
	gpu7_layer1_reshape -> gpu7_layer1_attn
	gpu7_layer1_attn -> gpu7_layer1_attn_reshape
	gpu7_layer1_attn_reshape -> gpu7_layer1_attn_out
	gpu7_layer1_attn_out -> gpu7_layer1_kv_update
	gpu7_layer1_kv_update -> gpu7_layer1_res1
	gpu7_layer1_res1 -> gpu7_layer1_ln2
	gpu7_layer1_ln2 -> gpu7_layer1_routing
	gpu7_layer1_expert0 -> gpu7_layer1_expert_agg
	gpu7_layer1_expert1 -> gpu7_layer1_expert_agg
	gpu7_layer1_expert2 -> gpu7_layer1_expert_agg
	gpu7_layer1_expert3 -> gpu7_layer1_expert_agg
	gpu7_layer1_routing -> gpu7_layer1_expert_agg
	gpu7_layer1_expert_agg -> gpu7_layer1_res2
	gpu7_layer2_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer2_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer2_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer2_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer2_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer2_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer2_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightgreen shape=ellipse style=filled]
	gpu7_layer2_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer2_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer2_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer2_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer2_routing -> gpu7_layer2_expert0 [label="Gate selection" style=dashed]
	gpu7_layer2_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer2_routing -> gpu7_layer2_expert1 [label="Gate selection" style=dashed]
	gpu7_layer2_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer2_routing -> gpu7_layer2_expert2 [label="Gate selection" style=dashed]
	gpu7_layer2_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer2_routing -> gpu7_layer2_expert3 [label="Gate selection" style=dashed]
	gpu7_layer2_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer2_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer1_res2 -> gpu7_layer2_ln1
	gpu7_layer2_ln1 -> gpu7_layer2_qkv
	gpu7_layer2_qkv -> gpu7_layer2_reshape
	gpu7_layer2_reshape -> gpu7_layer2_attn
	gpu7_layer2_attn -> gpu7_layer2_attn_reshape
	gpu7_layer2_attn_reshape -> gpu7_layer2_attn_out
	gpu7_layer2_attn_out -> gpu7_layer2_kv_update
	gpu7_layer2_kv_update -> gpu7_layer2_res1
	gpu7_layer2_res1 -> gpu7_layer2_ln2
	gpu7_layer2_ln2 -> gpu7_layer2_routing
	gpu7_layer2_expert0 -> gpu7_layer2_expert_agg
	gpu7_layer2_expert1 -> gpu7_layer2_expert_agg
	gpu7_layer2_expert2 -> gpu7_layer2_expert_agg
	gpu7_layer2_expert3 -> gpu7_layer2_expert_agg
	gpu7_layer2_routing -> gpu7_layer2_expert_agg
	gpu7_layer2_expert_agg -> gpu7_layer2_res2
	gpu7_layer3_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer3_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer3_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer3_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer3_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer3_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer3_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightgreen shape=ellipse style=filled]
	gpu7_layer3_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer3_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer3_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer3_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer3_routing -> gpu7_layer3_expert0 [label="Gate selection" style=dashed]
	gpu7_layer3_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer3_routing -> gpu7_layer3_expert1 [label="Gate selection" style=dashed]
	gpu7_layer3_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer3_routing -> gpu7_layer3_expert2 [label="Gate selection" style=dashed]
	gpu7_layer3_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer3_routing -> gpu7_layer3_expert3 [label="Gate selection" style=dashed]
	gpu7_layer3_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer3_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer2_res2 -> gpu7_layer3_ln1
	gpu7_layer3_ln1 -> gpu7_layer3_qkv
	gpu7_layer3_qkv -> gpu7_layer3_reshape
	gpu7_layer3_reshape -> gpu7_layer3_attn
	gpu7_layer3_attn -> gpu7_layer3_attn_reshape
	gpu7_layer3_attn_reshape -> gpu7_layer3_attn_out
	gpu7_layer3_attn_out -> gpu7_layer3_kv_update
	gpu7_layer3_kv_update -> gpu7_layer3_res1
	gpu7_layer3_res1 -> gpu7_layer3_ln2
	gpu7_layer3_ln2 -> gpu7_layer3_routing
	gpu7_layer3_expert0 -> gpu7_layer3_expert_agg
	gpu7_layer3_expert1 -> gpu7_layer3_expert_agg
	gpu7_layer3_expert2 -> gpu7_layer3_expert_agg
	gpu7_layer3_expert3 -> gpu7_layer3_expert_agg
	gpu7_layer3_routing -> gpu7_layer3_expert_agg
	gpu7_layer3_expert_agg -> gpu7_layer3_res2
	gpu7_layer4_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer4_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer4_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer4_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer4_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer4_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer4_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightgreen shape=ellipse style=filled]
	gpu7_layer4_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer4_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer4_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer4_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer4_routing -> gpu7_layer4_expert0 [label="Gate selection" style=dashed]
	gpu7_layer4_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer4_routing -> gpu7_layer4_expert1 [label="Gate selection" style=dashed]
	gpu7_layer4_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer4_routing -> gpu7_layer4_expert2 [label="Gate selection" style=dashed]
	gpu7_layer4_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer4_routing -> gpu7_layer4_expert3 [label="Gate selection" style=dashed]
	gpu7_layer4_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer4_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer3_res2 -> gpu7_layer4_ln1
	gpu7_layer4_ln1 -> gpu7_layer4_qkv
	gpu7_layer4_qkv -> gpu7_layer4_reshape
	gpu7_layer4_reshape -> gpu7_layer4_attn
	gpu7_layer4_attn -> gpu7_layer4_attn_reshape
	gpu7_layer4_attn_reshape -> gpu7_layer4_attn_out
	gpu7_layer4_attn_out -> gpu7_layer4_kv_update
	gpu7_layer4_kv_update -> gpu7_layer4_res1
	gpu7_layer4_res1 -> gpu7_layer4_ln2
	gpu7_layer4_ln2 -> gpu7_layer4_routing
	gpu7_layer4_expert0 -> gpu7_layer4_expert_agg
	gpu7_layer4_expert1 -> gpu7_layer4_expert_agg
	gpu7_layer4_expert2 -> gpu7_layer4_expert_agg
	gpu7_layer4_expert3 -> gpu7_layer4_expert_agg
	gpu7_layer4_routing -> gpu7_layer4_expert_agg
	gpu7_layer4_expert_agg -> gpu7_layer4_res2
	gpu7_layer5_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer5_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer5_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer5_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer5_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer5_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer5_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightgreen shape=ellipse style=filled]
	gpu7_layer5_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer5_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer5_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer5_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer5_routing -> gpu7_layer5_expert0 [label="Gate selection" style=dashed]
	gpu7_layer5_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer5_routing -> gpu7_layer5_expert1 [label="Gate selection" style=dashed]
	gpu7_layer5_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer5_routing -> gpu7_layer5_expert2 [label="Gate selection" style=dashed]
	gpu7_layer5_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer5_routing -> gpu7_layer5_expert3 [label="Gate selection" style=dashed]
	gpu7_layer5_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer5_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer4_res2 -> gpu7_layer5_ln1
	gpu7_layer5_ln1 -> gpu7_layer5_qkv
	gpu7_layer5_qkv -> gpu7_layer5_reshape
	gpu7_layer5_reshape -> gpu7_layer5_attn
	gpu7_layer5_attn -> gpu7_layer5_attn_reshape
	gpu7_layer5_attn_reshape -> gpu7_layer5_attn_out
	gpu7_layer5_attn_out -> gpu7_layer5_kv_update
	gpu7_layer5_kv_update -> gpu7_layer5_res1
	gpu7_layer5_res1 -> gpu7_layer5_ln2
	gpu7_layer5_ln2 -> gpu7_layer5_routing
	gpu7_layer5_expert0 -> gpu7_layer5_expert_agg
	gpu7_layer5_expert1 -> gpu7_layer5_expert_agg
	gpu7_layer5_expert2 -> gpu7_layer5_expert_agg
	gpu7_layer5_expert3 -> gpu7_layer5_expert_agg
	gpu7_layer5_routing -> gpu7_layer5_expert_agg
	gpu7_layer5_expert_agg -> gpu7_layer5_res2
	gpu7_layer6_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer6_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer6_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer6_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer6_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer6_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer6_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightgreen shape=ellipse style=filled]
	gpu7_layer6_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer6_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer6_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer6_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer6_routing -> gpu7_layer6_expert0 [label="Gate selection" style=dashed]
	gpu7_layer6_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer6_routing -> gpu7_layer6_expert1 [label="Gate selection" style=dashed]
	gpu7_layer6_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer6_routing -> gpu7_layer6_expert2 [label="Gate selection" style=dashed]
	gpu7_layer6_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer6_routing -> gpu7_layer6_expert3 [label="Gate selection" style=dashed]
	gpu7_layer6_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer6_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer5_res2 -> gpu7_layer6_ln1
	gpu7_layer6_ln1 -> gpu7_layer6_qkv
	gpu7_layer6_qkv -> gpu7_layer6_reshape
	gpu7_layer6_reshape -> gpu7_layer6_attn
	gpu7_layer6_attn -> gpu7_layer6_attn_reshape
	gpu7_layer6_attn_reshape -> gpu7_layer6_attn_out
	gpu7_layer6_attn_out -> gpu7_layer6_kv_update
	gpu7_layer6_kv_update -> gpu7_layer6_res1
	gpu7_layer6_res1 -> gpu7_layer6_ln2
	gpu7_layer6_ln2 -> gpu7_layer6_routing
	gpu7_layer6_expert0 -> gpu7_layer6_expert_agg
	gpu7_layer6_expert1 -> gpu7_layer6_expert_agg
	gpu7_layer6_expert2 -> gpu7_layer6_expert_agg
	gpu7_layer6_expert3 -> gpu7_layer6_expert_agg
	gpu7_layer6_routing -> gpu7_layer6_expert_agg
	gpu7_layer6_expert_agg -> gpu7_layer6_res2
	gpu7_layer7_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer7_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer7_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer7_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer7_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer7_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer7_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightgreen shape=ellipse style=filled]
	gpu7_layer7_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer7_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer7_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer7_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer7_routing -> gpu7_layer7_expert0 [label="Gate selection" style=dashed]
	gpu7_layer7_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer7_routing -> gpu7_layer7_expert1 [label="Gate selection" style=dashed]
	gpu7_layer7_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer7_routing -> gpu7_layer7_expert2 [label="Gate selection" style=dashed]
	gpu7_layer7_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer7_routing -> gpu7_layer7_expert3 [label="Gate selection" style=dashed]
	gpu7_layer7_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer7_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer6_res2 -> gpu7_layer7_ln1
	gpu7_layer7_ln1 -> gpu7_layer7_qkv
	gpu7_layer7_qkv -> gpu7_layer7_reshape
	gpu7_layer7_reshape -> gpu7_layer7_attn
	gpu7_layer7_attn -> gpu7_layer7_attn_reshape
	gpu7_layer7_attn_reshape -> gpu7_layer7_attn_out
	gpu7_layer7_attn_out -> gpu7_layer7_kv_update
	gpu7_layer7_kv_update -> gpu7_layer7_res1
	gpu7_layer7_res1 -> gpu7_layer7_ln2
	gpu7_layer7_ln2 -> gpu7_layer7_routing
	gpu7_layer7_expert0 -> gpu7_layer7_expert_agg
	gpu7_layer7_expert1 -> gpu7_layer7_expert_agg
	gpu7_layer7_expert2 -> gpu7_layer7_expert_agg
	gpu7_layer7_expert3 -> gpu7_layer7_expert_agg
	gpu7_layer7_routing -> gpu7_layer7_expert_agg
	gpu7_layer7_expert_agg -> gpu7_layer7_res2
	gpu7_layer8_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer8_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer8_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer8_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer8_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer8_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer8_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightgreen shape=ellipse style=filled]
	gpu7_layer8_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer8_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer8_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer8_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer8_routing -> gpu7_layer8_expert0 [label="Gate selection" style=dashed]
	gpu7_layer8_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer8_routing -> gpu7_layer8_expert1 [label="Gate selection" style=dashed]
	gpu7_layer8_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer8_routing -> gpu7_layer8_expert2 [label="Gate selection" style=dashed]
	gpu7_layer8_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer8_routing -> gpu7_layer8_expert3 [label="Gate selection" style=dashed]
	gpu7_layer8_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer8_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer7_res2 -> gpu7_layer8_ln1
	gpu7_layer8_ln1 -> gpu7_layer8_qkv
	gpu7_layer8_qkv -> gpu7_layer8_reshape
	gpu7_layer8_reshape -> gpu7_layer8_attn
	gpu7_layer8_attn -> gpu7_layer8_attn_reshape
	gpu7_layer8_attn_reshape -> gpu7_layer8_attn_out
	gpu7_layer8_attn_out -> gpu7_layer8_kv_update
	gpu7_layer8_kv_update -> gpu7_layer8_res1
	gpu7_layer8_res1 -> gpu7_layer8_ln2
	gpu7_layer8_ln2 -> gpu7_layer8_routing
	gpu7_layer8_expert0 -> gpu7_layer8_expert_agg
	gpu7_layer8_expert1 -> gpu7_layer8_expert_agg
	gpu7_layer8_expert2 -> gpu7_layer8_expert_agg
	gpu7_layer8_expert3 -> gpu7_layer8_expert_agg
	gpu7_layer8_routing -> gpu7_layer8_expert_agg
	gpu7_layer8_expert_agg -> gpu7_layer8_res2
	gpu7_layer9_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer9_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer9_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer9_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer9_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer9_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer9_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightgreen shape=ellipse style=filled]
	gpu7_layer9_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer9_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer9_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer9_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer9_routing -> gpu7_layer9_expert0 [label="Gate selection" style=dashed]
	gpu7_layer9_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer9_routing -> gpu7_layer9_expert1 [label="Gate selection" style=dashed]
	gpu7_layer9_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer9_routing -> gpu7_layer9_expert2 [label="Gate selection" style=dashed]
	gpu7_layer9_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer9_routing -> gpu7_layer9_expert3 [label="Gate selection" style=dashed]
	gpu7_layer9_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer9_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer8_res2 -> gpu7_layer9_ln1
	gpu7_layer9_ln1 -> gpu7_layer9_qkv
	gpu7_layer9_qkv -> gpu7_layer9_reshape
	gpu7_layer9_reshape -> gpu7_layer9_attn
	gpu7_layer9_attn -> gpu7_layer9_attn_reshape
	gpu7_layer9_attn_reshape -> gpu7_layer9_attn_out
	gpu7_layer9_attn_out -> gpu7_layer9_kv_update
	gpu7_layer9_kv_update -> gpu7_layer9_res1
	gpu7_layer9_res1 -> gpu7_layer9_ln2
	gpu7_layer9_ln2 -> gpu7_layer9_routing
	gpu7_layer9_expert0 -> gpu7_layer9_expert_agg
	gpu7_layer9_expert1 -> gpu7_layer9_expert_agg
	gpu7_layer9_expert2 -> gpu7_layer9_expert_agg
	gpu7_layer9_expert3 -> gpu7_layer9_expert_agg
	gpu7_layer9_routing -> gpu7_layer9_expert_agg
	gpu7_layer9_expert_agg -> gpu7_layer9_res2
	gpu7_layer10_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer10_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer10_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer10_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer10_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer10_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer10_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightgreen shape=ellipse style=filled]
	gpu7_layer10_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer10_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer10_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer10_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer10_routing -> gpu7_layer10_expert0 [label="Gate selection" style=dashed]
	gpu7_layer10_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer10_routing -> gpu7_layer10_expert1 [label="Gate selection" style=dashed]
	gpu7_layer10_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer10_routing -> gpu7_layer10_expert2 [label="Gate selection" style=dashed]
	gpu7_layer10_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer10_routing -> gpu7_layer10_expert3 [label="Gate selection" style=dashed]
	gpu7_layer10_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer10_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer9_res2 -> gpu7_layer10_ln1
	gpu7_layer10_ln1 -> gpu7_layer10_qkv
	gpu7_layer10_qkv -> gpu7_layer10_reshape
	gpu7_layer10_reshape -> gpu7_layer10_attn
	gpu7_layer10_attn -> gpu7_layer10_attn_reshape
	gpu7_layer10_attn_reshape -> gpu7_layer10_attn_out
	gpu7_layer10_attn_out -> gpu7_layer10_kv_update
	gpu7_layer10_kv_update -> gpu7_layer10_res1
	gpu7_layer10_res1 -> gpu7_layer10_ln2
	gpu7_layer10_ln2 -> gpu7_layer10_routing
	gpu7_layer10_expert0 -> gpu7_layer10_expert_agg
	gpu7_layer10_expert1 -> gpu7_layer10_expert_agg
	gpu7_layer10_expert2 -> gpu7_layer10_expert_agg
	gpu7_layer10_expert3 -> gpu7_layer10_expert_agg
	gpu7_layer10_routing -> gpu7_layer10_expert_agg
	gpu7_layer10_expert_agg -> gpu7_layer10_res2
	gpu7_layer11_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer11_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer11_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer11_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer11_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer11_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer11_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightgreen shape=ellipse style=filled]
	gpu7_layer11_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer11_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer11_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer11_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer11_routing -> gpu7_layer11_expert0 [label="Gate selection" style=dashed]
	gpu7_layer11_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer11_routing -> gpu7_layer11_expert1 [label="Gate selection" style=dashed]
	gpu7_layer11_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer11_routing -> gpu7_layer11_expert2 [label="Gate selection" style=dashed]
	gpu7_layer11_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer11_routing -> gpu7_layer11_expert3 [label="Gate selection" style=dashed]
	gpu7_layer11_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer11_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer10_res2 -> gpu7_layer11_ln1
	gpu7_layer11_ln1 -> gpu7_layer11_qkv
	gpu7_layer11_qkv -> gpu7_layer11_reshape
	gpu7_layer11_reshape -> gpu7_layer11_attn
	gpu7_layer11_attn -> gpu7_layer11_attn_reshape
	gpu7_layer11_attn_reshape -> gpu7_layer11_attn_out
	gpu7_layer11_attn_out -> gpu7_layer11_kv_update
	gpu7_layer11_kv_update -> gpu7_layer11_res1
	gpu7_layer11_res1 -> gpu7_layer11_ln2
	gpu7_layer11_ln2 -> gpu7_layer11_routing
	gpu7_layer11_expert0 -> gpu7_layer11_expert_agg
	gpu7_layer11_expert1 -> gpu7_layer11_expert_agg
	gpu7_layer11_expert2 -> gpu7_layer11_expert_agg
	gpu7_layer11_expert3 -> gpu7_layer11_expert_agg
	gpu7_layer11_routing -> gpu7_layer11_expert_agg
	gpu7_layer11_expert_agg -> gpu7_layer11_res2
	gpu7_layer12_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer12_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer12_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer12_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer12_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer12_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer12_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightgreen shape=ellipse style=filled]
	gpu7_layer12_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer12_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer12_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer12_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer12_routing -> gpu7_layer12_expert0 [label="Gate selection" style=dashed]
	gpu7_layer12_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer12_routing -> gpu7_layer12_expert1 [label="Gate selection" style=dashed]
	gpu7_layer12_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer12_routing -> gpu7_layer12_expert2 [label="Gate selection" style=dashed]
	gpu7_layer12_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer12_routing -> gpu7_layer12_expert3 [label="Gate selection" style=dashed]
	gpu7_layer12_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer12_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer11_res2 -> gpu7_layer12_ln1
	gpu7_layer12_ln1 -> gpu7_layer12_qkv
	gpu7_layer12_qkv -> gpu7_layer12_reshape
	gpu7_layer12_reshape -> gpu7_layer12_attn
	gpu7_layer12_attn -> gpu7_layer12_attn_reshape
	gpu7_layer12_attn_reshape -> gpu7_layer12_attn_out
	gpu7_layer12_attn_out -> gpu7_layer12_kv_update
	gpu7_layer12_kv_update -> gpu7_layer12_res1
	gpu7_layer12_res1 -> gpu7_layer12_ln2
	gpu7_layer12_ln2 -> gpu7_layer12_routing
	gpu7_layer12_expert0 -> gpu7_layer12_expert_agg
	gpu7_layer12_expert1 -> gpu7_layer12_expert_agg
	gpu7_layer12_expert2 -> gpu7_layer12_expert_agg
	gpu7_layer12_expert3 -> gpu7_layer12_expert_agg
	gpu7_layer12_routing -> gpu7_layer12_expert_agg
	gpu7_layer12_expert_agg -> gpu7_layer12_res2
	gpu7_layer13_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer13_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer13_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer13_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer13_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer13_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer13_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightgreen shape=ellipse style=filled]
	gpu7_layer13_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer13_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer13_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer13_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer13_routing -> gpu7_layer13_expert0 [label="Gate selection" style=dashed]
	gpu7_layer13_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer13_routing -> gpu7_layer13_expert1 [label="Gate selection" style=dashed]
	gpu7_layer13_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer13_routing -> gpu7_layer13_expert2 [label="Gate selection" style=dashed]
	gpu7_layer13_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer13_routing -> gpu7_layer13_expert3 [label="Gate selection" style=dashed]
	gpu7_layer13_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer13_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer12_res2 -> gpu7_layer13_ln1
	gpu7_layer13_ln1 -> gpu7_layer13_qkv
	gpu7_layer13_qkv -> gpu7_layer13_reshape
	gpu7_layer13_reshape -> gpu7_layer13_attn
	gpu7_layer13_attn -> gpu7_layer13_attn_reshape
	gpu7_layer13_attn_reshape -> gpu7_layer13_attn_out
	gpu7_layer13_attn_out -> gpu7_layer13_kv_update
	gpu7_layer13_kv_update -> gpu7_layer13_res1
	gpu7_layer13_res1 -> gpu7_layer13_ln2
	gpu7_layer13_ln2 -> gpu7_layer13_routing
	gpu7_layer13_expert0 -> gpu7_layer13_expert_agg
	gpu7_layer13_expert1 -> gpu7_layer13_expert_agg
	gpu7_layer13_expert2 -> gpu7_layer13_expert_agg
	gpu7_layer13_expert3 -> gpu7_layer13_expert_agg
	gpu7_layer13_routing -> gpu7_layer13_expert_agg
	gpu7_layer13_expert_agg -> gpu7_layer13_res2
	gpu7_layer14_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer14_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer14_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer14_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer14_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer14_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer14_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightgreen shape=ellipse style=filled]
	gpu7_layer14_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer14_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer14_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer14_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer14_routing -> gpu7_layer14_expert0 [label="Gate selection" style=dashed]
	gpu7_layer14_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer14_routing -> gpu7_layer14_expert1 [label="Gate selection" style=dashed]
	gpu7_layer14_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer14_routing -> gpu7_layer14_expert2 [label="Gate selection" style=dashed]
	gpu7_layer14_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer14_routing -> gpu7_layer14_expert3 [label="Gate selection" style=dashed]
	gpu7_layer14_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer14_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer13_res2 -> gpu7_layer14_ln1
	gpu7_layer14_ln1 -> gpu7_layer14_qkv
	gpu7_layer14_qkv -> gpu7_layer14_reshape
	gpu7_layer14_reshape -> gpu7_layer14_attn
	gpu7_layer14_attn -> gpu7_layer14_attn_reshape
	gpu7_layer14_attn_reshape -> gpu7_layer14_attn_out
	gpu7_layer14_attn_out -> gpu7_layer14_kv_update
	gpu7_layer14_kv_update -> gpu7_layer14_res1
	gpu7_layer14_res1 -> gpu7_layer14_ln2
	gpu7_layer14_ln2 -> gpu7_layer14_routing
	gpu7_layer14_expert0 -> gpu7_layer14_expert_agg
	gpu7_layer14_expert1 -> gpu7_layer14_expert_agg
	gpu7_layer14_expert2 -> gpu7_layer14_expert_agg
	gpu7_layer14_expert3 -> gpu7_layer14_expert_agg
	gpu7_layer14_routing -> gpu7_layer14_expert_agg
	gpu7_layer14_expert_agg -> gpu7_layer14_res2
	gpu7_layer15_ln1 [label="LayerNorm1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer15_qkv [label="QKV Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 3072]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer15_reshape [label="Reshape QKV\nInput: [256, 512, 3072]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer15_attn [label="Self-Attention\nInput: [256, 16, 512, 64]\nOutput: [256, 16, 512, 64]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer15_attn_out [label="Attention Output Proj\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer15_attn_reshape [label="Reshape Back\nInput: [256, 16, 512, 64]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer15_kv_update [label="KV Cache Update\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightgreen shape=ellipse style=filled]
	gpu7_layer15_res1 [label="Residual Add1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer15_ln2 [label="LayerNorm2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer15_routing [label="MoE Router\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nExperts: 64\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer15_expert0 [label="Expert 0\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer15_routing -> gpu7_layer15_expert0 [label="Gate selection" style=dashed]
	gpu7_layer15_expert1 [label="Expert 1\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer15_routing -> gpu7_layer15_expert1 [label="Gate selection" style=dashed]
	gpu7_layer15_expert2 [label="Expert 2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer15_routing -> gpu7_layer15_expert2 [label="Gate selection" style=dashed]
	gpu7_layer15_expert3 [label="Expert 3\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer15_routing -> gpu7_layer15_expert3 [label="Gate selection" style=dashed]
	gpu7_layer15_expert_agg [label="Expert Aggregation\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightyellow shape=parallelogram style=filled]
	gpu7_layer15_res2 [label="Residual Add2\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer14_res2 -> gpu7_layer15_ln1
	gpu7_layer15_ln1 -> gpu7_layer15_qkv
	gpu7_layer15_qkv -> gpu7_layer15_reshape
	gpu7_layer15_reshape -> gpu7_layer15_attn
	gpu7_layer15_attn -> gpu7_layer15_attn_reshape
	gpu7_layer15_attn_reshape -> gpu7_layer15_attn_out
	gpu7_layer15_attn_out -> gpu7_layer15_kv_update
	gpu7_layer15_kv_update -> gpu7_layer15_res1
	gpu7_layer15_res1 -> gpu7_layer15_ln2
	gpu7_layer15_ln2 -> gpu7_layer15_routing
	gpu7_layer15_expert0 -> gpu7_layer15_expert_agg
	gpu7_layer15_expert1 -> gpu7_layer15_expert_agg
	gpu7_layer15_expert2 -> gpu7_layer15_expert_agg
	gpu7_layer15_expert3 -> gpu7_layer15_expert_agg
	gpu7_layer15_routing -> gpu7_layer15_expert_agg
	gpu7_layer15_expert_agg -> gpu7_layer15_res2
	gpu7_final_ln [label="Final LayerNorm\nInput: [256, 512, 2048]\nOutput: [256, 512, 2048]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_layer15_res2 -> gpu7_final_ln
	gpu7_output_proj [label="Output Projection\nInput: [256, 512, 2048]\nOutput: [256, 512, 32000]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_final_ln -> gpu7_output_proj
	gpu7_softmax [label="Softmax\nInput: [256, 512, 32000]\nOutput: [256, 512, 32000]\nGPU: GPU7" fillcolor=lightblue shape=rectangle style=filled]
	gpu7_output_proj -> gpu7_softmax
	dp_aggregate [label="Data Parallel Aggregate\nInput: [256, 512, 32000] x 8 GPUs\nOutput: [2048, 512, 32000]\nGPU: All" fillcolor=lightgreen shape=parallelogram style=filled]
	gpu0_softmax -> dp_aggregate [label="GPU 0 output"]
	gpu1_softmax -> dp_aggregate [label="GPU 1 output"]
	gpu2_softmax -> dp_aggregate [label="GPU 2 output"]
	gpu3_softmax -> dp_aggregate [label="GPU 3 output"]
	gpu4_softmax -> dp_aggregate [label="GPU 4 output"]
	gpu5_softmax -> dp_aggregate [label="GPU 5 output"]
	gpu6_softmax -> dp_aggregate [label="GPU 6 output"]
	gpu7_softmax -> dp_aggregate [label="GPU 7 output"]
	output [label="Final Output\nBatch: 2048 sequences\nVocab: 32000\nGPU: All" fillcolor=lightgray shape=ellipse style=filled]
	dp_aggregate -> output [label="Combined results"]
	subgraph cluster_legend {
		color=gray label=Legend style=dashed
		legend_compute [label="Computation Node" fillcolor=lightblue shape=rectangle style=filled]
		legend_comm [label="Communication Node" fillcolor=lightgreen shape=ellipse style=filled]
		legend_routing [label="Routing/Aggregation" fillcolor=lightyellow shape=parallelogram style=filled]
		legend_input [label="Input/Output" fillcolor=lightpink shape=ellipse style=filled]
	}
}
