// LLM Deployment DAG - EP1-TP1-PP1-DP8
digraph {
	rankdir=TB
	graph [bgcolor=white fontname=Arial]
	node [fontname=Arial fontsize=10]
	subgraph cluster_gpu_0 {
		color=blue fillcolor=lightblue label="GPU 0" style=rounded
		input_gpu0 [label="Input\nGPU 0\nInput: [batch=256, seq=512, dim=1024]\nOutput: [batch=256, seq=512, dim=1024]" fillcolor=lightgreen shape=ellipse style=filled]
		embed_gpu0 [label="Token Embedding\nGPU 0\nInput: [batch=256, seq=512]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		pos_enc_gpu0 [label="Position Encoding\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		layer_0_ln1_gpu0 [label="Layer 0 LayerNorm1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_0_q_proj_gpu0 [label="Layer 0 Q Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_k_proj_gpu0 [label="Layer 0 K Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_v_proj_gpu0 [label="Layer 0 V Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_attn_gpu0 [label="Layer 0 Scaled Dot-Product Attention\nGPU 0\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_attn_out_proj_gpu0 [label="Layer 0 Attention Output Projection\nGPU 0\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_residual1_gpu0 [label="Layer 0 Residual1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_0_ln2_gpu0 [label="Layer 0 LayerNorm2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_0_router_gpu0 [label="Layer 0 Router\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_0_gate_gpu0 [label="Layer 0 Gate Selection\nGPU 0\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_0_expert_0_gpu0 [label="Layer 0 Expert 0\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_1_gpu0 [label="Layer 0 Expert 1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_2_gpu0 [label="Layer 0 Expert 2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_3_gpu0 [label="Layer 0 Expert 3\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_agg_gpu0 [label="Layer 0 Expert Aggregation\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_0_moe_out_proj_gpu0 [label="Layer 0 MoE Output Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_residual2_gpu0 [label="Layer 0 Residual2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		pos_enc_gpu0 -> layer_0_ln1_gpu0
		layer_0_ln1_gpu0 -> layer_0_q_proj_gpu0
		layer_0_ln1_gpu0 -> layer_0_k_proj_gpu0
		layer_0_ln1_gpu0 -> layer_0_v_proj_gpu0
		layer_0_q_proj_gpu0 -> layer_0_attn_gpu0
		layer_0_k_proj_gpu0 -> layer_0_attn_gpu0
		layer_0_v_proj_gpu0 -> layer_0_attn_gpu0
		layer_0_attn_gpu0 -> layer_0_attn_out_proj_gpu0
		layer_0_attn_out_proj_gpu0 -> layer_0_residual1_gpu0
		layer_0_residual1_gpu0 -> layer_0_ln2_gpu0
		layer_0_ln2_gpu0 -> layer_0_router_gpu0
		layer_0_router_gpu0 -> layer_0_gate_gpu0
		layer_0_gate_gpu0 -> layer_0_expert_0_gpu0 [style=dashed]
		layer_0_gate_gpu0 -> layer_0_expert_1_gpu0 [style=dashed]
		layer_0_gate_gpu0 -> layer_0_expert_2_gpu0 [style=dashed]
		layer_0_gate_gpu0 -> layer_0_expert_3_gpu0 [style=dashed]
		layer_0_expert_0_gpu0 -> layer_0_expert_agg_gpu0
		layer_0_expert_1_gpu0 -> layer_0_expert_agg_gpu0
		layer_0_expert_2_gpu0 -> layer_0_expert_agg_gpu0
		layer_0_expert_3_gpu0 -> layer_0_expert_agg_gpu0
		layer_0_expert_agg_gpu0 -> layer_0_moe_out_proj_gpu0
		layer_0_moe_out_proj_gpu0 -> layer_0_residual2_gpu0
		layer_0_output_gpu0 [label="Layer 0 Output\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_0_residual2_gpu0 -> layer_0_output_gpu0
		layer_1_ln1_gpu0 [label="Layer 1 LayerNorm1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_1_q_proj_gpu0 [label="Layer 1 Q Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_k_proj_gpu0 [label="Layer 1 K Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_v_proj_gpu0 [label="Layer 1 V Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_attn_gpu0 [label="Layer 1 Scaled Dot-Product Attention\nGPU 0\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_attn_out_proj_gpu0 [label="Layer 1 Attention Output Projection\nGPU 0\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_residual1_gpu0 [label="Layer 1 Residual1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_1_ln2_gpu0 [label="Layer 1 LayerNorm2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_1_router_gpu0 [label="Layer 1 Router\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_1_gate_gpu0 [label="Layer 1 Gate Selection\nGPU 0\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_1_expert_0_gpu0 [label="Layer 1 Expert 0\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_1_gpu0 [label="Layer 1 Expert 1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_2_gpu0 [label="Layer 1 Expert 2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_3_gpu0 [label="Layer 1 Expert 3\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_agg_gpu0 [label="Layer 1 Expert Aggregation\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_1_moe_out_proj_gpu0 [label="Layer 1 MoE Output Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_residual2_gpu0 [label="Layer 1 Residual2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_0_output_gpu0 -> layer_1_ln1_gpu0
		layer_1_ln1_gpu0 -> layer_1_q_proj_gpu0
		layer_1_ln1_gpu0 -> layer_1_k_proj_gpu0
		layer_1_ln1_gpu0 -> layer_1_v_proj_gpu0
		layer_1_q_proj_gpu0 -> layer_1_attn_gpu0
		layer_1_k_proj_gpu0 -> layer_1_attn_gpu0
		layer_1_v_proj_gpu0 -> layer_1_attn_gpu0
		layer_1_attn_gpu0 -> layer_1_attn_out_proj_gpu0
		layer_1_attn_out_proj_gpu0 -> layer_1_residual1_gpu0
		layer_1_residual1_gpu0 -> layer_1_ln2_gpu0
		layer_1_ln2_gpu0 -> layer_1_router_gpu0
		layer_1_router_gpu0 -> layer_1_gate_gpu0
		layer_1_gate_gpu0 -> layer_1_expert_0_gpu0 [style=dashed]
		layer_1_gate_gpu0 -> layer_1_expert_1_gpu0 [style=dashed]
		layer_1_gate_gpu0 -> layer_1_expert_2_gpu0 [style=dashed]
		layer_1_gate_gpu0 -> layer_1_expert_3_gpu0 [style=dashed]
		layer_1_expert_0_gpu0 -> layer_1_expert_agg_gpu0
		layer_1_expert_1_gpu0 -> layer_1_expert_agg_gpu0
		layer_1_expert_2_gpu0 -> layer_1_expert_agg_gpu0
		layer_1_expert_3_gpu0 -> layer_1_expert_agg_gpu0
		layer_1_expert_agg_gpu0 -> layer_1_moe_out_proj_gpu0
		layer_1_moe_out_proj_gpu0 -> layer_1_residual2_gpu0
		layer_1_output_gpu0 [label="Layer 1 Output\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_1_residual2_gpu0 -> layer_1_output_gpu0
		layer_2_ln1_gpu0 [label="Layer 2 LayerNorm1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_2_q_proj_gpu0 [label="Layer 2 Q Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_k_proj_gpu0 [label="Layer 2 K Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_v_proj_gpu0 [label="Layer 2 V Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_attn_gpu0 [label="Layer 2 Scaled Dot-Product Attention\nGPU 0\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_attn_out_proj_gpu0 [label="Layer 2 Attention Output Projection\nGPU 0\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_residual1_gpu0 [label="Layer 2 Residual1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_2_ln2_gpu0 [label="Layer 2 LayerNorm2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_2_router_gpu0 [label="Layer 2 Router\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_2_gate_gpu0 [label="Layer 2 Gate Selection\nGPU 0\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_2_expert_0_gpu0 [label="Layer 2 Expert 0\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_1_gpu0 [label="Layer 2 Expert 1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_2_gpu0 [label="Layer 2 Expert 2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_3_gpu0 [label="Layer 2 Expert 3\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_agg_gpu0 [label="Layer 2 Expert Aggregation\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_2_moe_out_proj_gpu0 [label="Layer 2 MoE Output Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_residual2_gpu0 [label="Layer 2 Residual2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_1_output_gpu0 -> layer_2_ln1_gpu0
		layer_2_ln1_gpu0 -> layer_2_q_proj_gpu0
		layer_2_ln1_gpu0 -> layer_2_k_proj_gpu0
		layer_2_ln1_gpu0 -> layer_2_v_proj_gpu0
		layer_2_q_proj_gpu0 -> layer_2_attn_gpu0
		layer_2_k_proj_gpu0 -> layer_2_attn_gpu0
		layer_2_v_proj_gpu0 -> layer_2_attn_gpu0
		layer_2_attn_gpu0 -> layer_2_attn_out_proj_gpu0
		layer_2_attn_out_proj_gpu0 -> layer_2_residual1_gpu0
		layer_2_residual1_gpu0 -> layer_2_ln2_gpu0
		layer_2_ln2_gpu0 -> layer_2_router_gpu0
		layer_2_router_gpu0 -> layer_2_gate_gpu0
		layer_2_gate_gpu0 -> layer_2_expert_0_gpu0 [style=dashed]
		layer_2_gate_gpu0 -> layer_2_expert_1_gpu0 [style=dashed]
		layer_2_gate_gpu0 -> layer_2_expert_2_gpu0 [style=dashed]
		layer_2_gate_gpu0 -> layer_2_expert_3_gpu0 [style=dashed]
		layer_2_expert_0_gpu0 -> layer_2_expert_agg_gpu0
		layer_2_expert_1_gpu0 -> layer_2_expert_agg_gpu0
		layer_2_expert_2_gpu0 -> layer_2_expert_agg_gpu0
		layer_2_expert_3_gpu0 -> layer_2_expert_agg_gpu0
		layer_2_expert_agg_gpu0 -> layer_2_moe_out_proj_gpu0
		layer_2_moe_out_proj_gpu0 -> layer_2_residual2_gpu0
		layer_2_output_gpu0 [label="Layer 2 Output\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_2_residual2_gpu0 -> layer_2_output_gpu0
		layer_3_ln1_gpu0 [label="Layer 3 LayerNorm1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_3_q_proj_gpu0 [label="Layer 3 Q Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_k_proj_gpu0 [label="Layer 3 K Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_v_proj_gpu0 [label="Layer 3 V Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_attn_gpu0 [label="Layer 3 Scaled Dot-Product Attention\nGPU 0\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_attn_out_proj_gpu0 [label="Layer 3 Attention Output Projection\nGPU 0\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_residual1_gpu0 [label="Layer 3 Residual1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_3_ln2_gpu0 [label="Layer 3 LayerNorm2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_3_router_gpu0 [label="Layer 3 Router\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_3_gate_gpu0 [label="Layer 3 Gate Selection\nGPU 0\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_3_expert_0_gpu0 [label="Layer 3 Expert 0\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_1_gpu0 [label="Layer 3 Expert 1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_2_gpu0 [label="Layer 3 Expert 2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_3_gpu0 [label="Layer 3 Expert 3\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_agg_gpu0 [label="Layer 3 Expert Aggregation\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_3_moe_out_proj_gpu0 [label="Layer 3 MoE Output Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_residual2_gpu0 [label="Layer 3 Residual2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_2_output_gpu0 -> layer_3_ln1_gpu0
		layer_3_ln1_gpu0 -> layer_3_q_proj_gpu0
		layer_3_ln1_gpu0 -> layer_3_k_proj_gpu0
		layer_3_ln1_gpu0 -> layer_3_v_proj_gpu0
		layer_3_q_proj_gpu0 -> layer_3_attn_gpu0
		layer_3_k_proj_gpu0 -> layer_3_attn_gpu0
		layer_3_v_proj_gpu0 -> layer_3_attn_gpu0
		layer_3_attn_gpu0 -> layer_3_attn_out_proj_gpu0
		layer_3_attn_out_proj_gpu0 -> layer_3_residual1_gpu0
		layer_3_residual1_gpu0 -> layer_3_ln2_gpu0
		layer_3_ln2_gpu0 -> layer_3_router_gpu0
		layer_3_router_gpu0 -> layer_3_gate_gpu0
		layer_3_gate_gpu0 -> layer_3_expert_0_gpu0 [style=dashed]
		layer_3_gate_gpu0 -> layer_3_expert_1_gpu0 [style=dashed]
		layer_3_gate_gpu0 -> layer_3_expert_2_gpu0 [style=dashed]
		layer_3_gate_gpu0 -> layer_3_expert_3_gpu0 [style=dashed]
		layer_3_expert_0_gpu0 -> layer_3_expert_agg_gpu0
		layer_3_expert_1_gpu0 -> layer_3_expert_agg_gpu0
		layer_3_expert_2_gpu0 -> layer_3_expert_agg_gpu0
		layer_3_expert_3_gpu0 -> layer_3_expert_agg_gpu0
		layer_3_expert_agg_gpu0 -> layer_3_moe_out_proj_gpu0
		layer_3_moe_out_proj_gpu0 -> layer_3_residual2_gpu0
		layer_3_output_gpu0 [label="Layer 3 Output\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_3_residual2_gpu0 -> layer_3_output_gpu0
		layer_4_ln1_gpu0 [label="Layer 4 LayerNorm1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_4_q_proj_gpu0 [label="Layer 4 Q Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_k_proj_gpu0 [label="Layer 4 K Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_v_proj_gpu0 [label="Layer 4 V Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_attn_gpu0 [label="Layer 4 Scaled Dot-Product Attention\nGPU 0\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_attn_out_proj_gpu0 [label="Layer 4 Attention Output Projection\nGPU 0\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_residual1_gpu0 [label="Layer 4 Residual1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_4_ln2_gpu0 [label="Layer 4 LayerNorm2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_4_router_gpu0 [label="Layer 4 Router\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_4_gate_gpu0 [label="Layer 4 Gate Selection\nGPU 0\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_4_expert_0_gpu0 [label="Layer 4 Expert 0\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_1_gpu0 [label="Layer 4 Expert 1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_2_gpu0 [label="Layer 4 Expert 2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_3_gpu0 [label="Layer 4 Expert 3\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_agg_gpu0 [label="Layer 4 Expert Aggregation\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_4_moe_out_proj_gpu0 [label="Layer 4 MoE Output Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_residual2_gpu0 [label="Layer 4 Residual2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_3_output_gpu0 -> layer_4_ln1_gpu0
		layer_4_ln1_gpu0 -> layer_4_q_proj_gpu0
		layer_4_ln1_gpu0 -> layer_4_k_proj_gpu0
		layer_4_ln1_gpu0 -> layer_4_v_proj_gpu0
		layer_4_q_proj_gpu0 -> layer_4_attn_gpu0
		layer_4_k_proj_gpu0 -> layer_4_attn_gpu0
		layer_4_v_proj_gpu0 -> layer_4_attn_gpu0
		layer_4_attn_gpu0 -> layer_4_attn_out_proj_gpu0
		layer_4_attn_out_proj_gpu0 -> layer_4_residual1_gpu0
		layer_4_residual1_gpu0 -> layer_4_ln2_gpu0
		layer_4_ln2_gpu0 -> layer_4_router_gpu0
		layer_4_router_gpu0 -> layer_4_gate_gpu0
		layer_4_gate_gpu0 -> layer_4_expert_0_gpu0 [style=dashed]
		layer_4_gate_gpu0 -> layer_4_expert_1_gpu0 [style=dashed]
		layer_4_gate_gpu0 -> layer_4_expert_2_gpu0 [style=dashed]
		layer_4_gate_gpu0 -> layer_4_expert_3_gpu0 [style=dashed]
		layer_4_expert_0_gpu0 -> layer_4_expert_agg_gpu0
		layer_4_expert_1_gpu0 -> layer_4_expert_agg_gpu0
		layer_4_expert_2_gpu0 -> layer_4_expert_agg_gpu0
		layer_4_expert_3_gpu0 -> layer_4_expert_agg_gpu0
		layer_4_expert_agg_gpu0 -> layer_4_moe_out_proj_gpu0
		layer_4_moe_out_proj_gpu0 -> layer_4_residual2_gpu0
		layer_4_output_gpu0 [label="Layer 4 Output\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_4_residual2_gpu0 -> layer_4_output_gpu0
		layer_5_ln1_gpu0 [label="Layer 5 LayerNorm1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_5_q_proj_gpu0 [label="Layer 5 Q Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_k_proj_gpu0 [label="Layer 5 K Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_v_proj_gpu0 [label="Layer 5 V Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_attn_gpu0 [label="Layer 5 Scaled Dot-Product Attention\nGPU 0\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_attn_out_proj_gpu0 [label="Layer 5 Attention Output Projection\nGPU 0\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_residual1_gpu0 [label="Layer 5 Residual1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_5_ln2_gpu0 [label="Layer 5 LayerNorm2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_5_router_gpu0 [label="Layer 5 Router\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_5_gate_gpu0 [label="Layer 5 Gate Selection\nGPU 0\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_5_expert_0_gpu0 [label="Layer 5 Expert 0\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_1_gpu0 [label="Layer 5 Expert 1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_2_gpu0 [label="Layer 5 Expert 2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_3_gpu0 [label="Layer 5 Expert 3\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_agg_gpu0 [label="Layer 5 Expert Aggregation\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_5_moe_out_proj_gpu0 [label="Layer 5 MoE Output Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_residual2_gpu0 [label="Layer 5 Residual2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_4_output_gpu0 -> layer_5_ln1_gpu0
		layer_5_ln1_gpu0 -> layer_5_q_proj_gpu0
		layer_5_ln1_gpu0 -> layer_5_k_proj_gpu0
		layer_5_ln1_gpu0 -> layer_5_v_proj_gpu0
		layer_5_q_proj_gpu0 -> layer_5_attn_gpu0
		layer_5_k_proj_gpu0 -> layer_5_attn_gpu0
		layer_5_v_proj_gpu0 -> layer_5_attn_gpu0
		layer_5_attn_gpu0 -> layer_5_attn_out_proj_gpu0
		layer_5_attn_out_proj_gpu0 -> layer_5_residual1_gpu0
		layer_5_residual1_gpu0 -> layer_5_ln2_gpu0
		layer_5_ln2_gpu0 -> layer_5_router_gpu0
		layer_5_router_gpu0 -> layer_5_gate_gpu0
		layer_5_gate_gpu0 -> layer_5_expert_0_gpu0 [style=dashed]
		layer_5_gate_gpu0 -> layer_5_expert_1_gpu0 [style=dashed]
		layer_5_gate_gpu0 -> layer_5_expert_2_gpu0 [style=dashed]
		layer_5_gate_gpu0 -> layer_5_expert_3_gpu0 [style=dashed]
		layer_5_expert_0_gpu0 -> layer_5_expert_agg_gpu0
		layer_5_expert_1_gpu0 -> layer_5_expert_agg_gpu0
		layer_5_expert_2_gpu0 -> layer_5_expert_agg_gpu0
		layer_5_expert_3_gpu0 -> layer_5_expert_agg_gpu0
		layer_5_expert_agg_gpu0 -> layer_5_moe_out_proj_gpu0
		layer_5_moe_out_proj_gpu0 -> layer_5_residual2_gpu0
		layer_5_output_gpu0 [label="Layer 5 Output\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_5_residual2_gpu0 -> layer_5_output_gpu0
		layer_6_ln1_gpu0 [label="Layer 6 LayerNorm1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_6_q_proj_gpu0 [label="Layer 6 Q Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_k_proj_gpu0 [label="Layer 6 K Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_v_proj_gpu0 [label="Layer 6 V Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_attn_gpu0 [label="Layer 6 Scaled Dot-Product Attention\nGPU 0\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_attn_out_proj_gpu0 [label="Layer 6 Attention Output Projection\nGPU 0\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_residual1_gpu0 [label="Layer 6 Residual1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_6_ln2_gpu0 [label="Layer 6 LayerNorm2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_6_router_gpu0 [label="Layer 6 Router\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_6_gate_gpu0 [label="Layer 6 Gate Selection\nGPU 0\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_6_expert_0_gpu0 [label="Layer 6 Expert 0\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_1_gpu0 [label="Layer 6 Expert 1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_2_gpu0 [label="Layer 6 Expert 2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_3_gpu0 [label="Layer 6 Expert 3\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_agg_gpu0 [label="Layer 6 Expert Aggregation\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_6_moe_out_proj_gpu0 [label="Layer 6 MoE Output Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_residual2_gpu0 [label="Layer 6 Residual2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_5_output_gpu0 -> layer_6_ln1_gpu0
		layer_6_ln1_gpu0 -> layer_6_q_proj_gpu0
		layer_6_ln1_gpu0 -> layer_6_k_proj_gpu0
		layer_6_ln1_gpu0 -> layer_6_v_proj_gpu0
		layer_6_q_proj_gpu0 -> layer_6_attn_gpu0
		layer_6_k_proj_gpu0 -> layer_6_attn_gpu0
		layer_6_v_proj_gpu0 -> layer_6_attn_gpu0
		layer_6_attn_gpu0 -> layer_6_attn_out_proj_gpu0
		layer_6_attn_out_proj_gpu0 -> layer_6_residual1_gpu0
		layer_6_residual1_gpu0 -> layer_6_ln2_gpu0
		layer_6_ln2_gpu0 -> layer_6_router_gpu0
		layer_6_router_gpu0 -> layer_6_gate_gpu0
		layer_6_gate_gpu0 -> layer_6_expert_0_gpu0 [style=dashed]
		layer_6_gate_gpu0 -> layer_6_expert_1_gpu0 [style=dashed]
		layer_6_gate_gpu0 -> layer_6_expert_2_gpu0 [style=dashed]
		layer_6_gate_gpu0 -> layer_6_expert_3_gpu0 [style=dashed]
		layer_6_expert_0_gpu0 -> layer_6_expert_agg_gpu0
		layer_6_expert_1_gpu0 -> layer_6_expert_agg_gpu0
		layer_6_expert_2_gpu0 -> layer_6_expert_agg_gpu0
		layer_6_expert_3_gpu0 -> layer_6_expert_agg_gpu0
		layer_6_expert_agg_gpu0 -> layer_6_moe_out_proj_gpu0
		layer_6_moe_out_proj_gpu0 -> layer_6_residual2_gpu0
		layer_6_output_gpu0 [label="Layer 6 Output\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_6_residual2_gpu0 -> layer_6_output_gpu0
		layer_7_ln1_gpu0 [label="Layer 7 LayerNorm1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_7_q_proj_gpu0 [label="Layer 7 Q Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_k_proj_gpu0 [label="Layer 7 K Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_v_proj_gpu0 [label="Layer 7 V Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_attn_gpu0 [label="Layer 7 Scaled Dot-Product Attention\nGPU 0\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_attn_out_proj_gpu0 [label="Layer 7 Attention Output Projection\nGPU 0\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_residual1_gpu0 [label="Layer 7 Residual1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_7_ln2_gpu0 [label="Layer 7 LayerNorm2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_7_router_gpu0 [label="Layer 7 Router\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_7_gate_gpu0 [label="Layer 7 Gate Selection\nGPU 0\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_7_expert_0_gpu0 [label="Layer 7 Expert 0\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_1_gpu0 [label="Layer 7 Expert 1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_2_gpu0 [label="Layer 7 Expert 2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_3_gpu0 [label="Layer 7 Expert 3\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_agg_gpu0 [label="Layer 7 Expert Aggregation\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_7_moe_out_proj_gpu0 [label="Layer 7 MoE Output Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_residual2_gpu0 [label="Layer 7 Residual2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_6_output_gpu0 -> layer_7_ln1_gpu0
		layer_7_ln1_gpu0 -> layer_7_q_proj_gpu0
		layer_7_ln1_gpu0 -> layer_7_k_proj_gpu0
		layer_7_ln1_gpu0 -> layer_7_v_proj_gpu0
		layer_7_q_proj_gpu0 -> layer_7_attn_gpu0
		layer_7_k_proj_gpu0 -> layer_7_attn_gpu0
		layer_7_v_proj_gpu0 -> layer_7_attn_gpu0
		layer_7_attn_gpu0 -> layer_7_attn_out_proj_gpu0
		layer_7_attn_out_proj_gpu0 -> layer_7_residual1_gpu0
		layer_7_residual1_gpu0 -> layer_7_ln2_gpu0
		layer_7_ln2_gpu0 -> layer_7_router_gpu0
		layer_7_router_gpu0 -> layer_7_gate_gpu0
		layer_7_gate_gpu0 -> layer_7_expert_0_gpu0 [style=dashed]
		layer_7_gate_gpu0 -> layer_7_expert_1_gpu0 [style=dashed]
		layer_7_gate_gpu0 -> layer_7_expert_2_gpu0 [style=dashed]
		layer_7_gate_gpu0 -> layer_7_expert_3_gpu0 [style=dashed]
		layer_7_expert_0_gpu0 -> layer_7_expert_agg_gpu0
		layer_7_expert_1_gpu0 -> layer_7_expert_agg_gpu0
		layer_7_expert_2_gpu0 -> layer_7_expert_agg_gpu0
		layer_7_expert_3_gpu0 -> layer_7_expert_agg_gpu0
		layer_7_expert_agg_gpu0 -> layer_7_moe_out_proj_gpu0
		layer_7_moe_out_proj_gpu0 -> layer_7_residual2_gpu0
		layer_7_output_gpu0 [label="Layer 7 Output\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_7_residual2_gpu0 -> layer_7_output_gpu0
		layer_8_ln1_gpu0 [label="Layer 8 LayerNorm1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_8_q_proj_gpu0 [label="Layer 8 Q Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_k_proj_gpu0 [label="Layer 8 K Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_v_proj_gpu0 [label="Layer 8 V Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_attn_gpu0 [label="Layer 8 Scaled Dot-Product Attention\nGPU 0\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_attn_out_proj_gpu0 [label="Layer 8 Attention Output Projection\nGPU 0\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_residual1_gpu0 [label="Layer 8 Residual1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_8_ln2_gpu0 [label="Layer 8 LayerNorm2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_8_router_gpu0 [label="Layer 8 Router\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_8_gate_gpu0 [label="Layer 8 Gate Selection\nGPU 0\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_8_expert_0_gpu0 [label="Layer 8 Expert 0\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_1_gpu0 [label="Layer 8 Expert 1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_2_gpu0 [label="Layer 8 Expert 2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_3_gpu0 [label="Layer 8 Expert 3\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_agg_gpu0 [label="Layer 8 Expert Aggregation\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_8_moe_out_proj_gpu0 [label="Layer 8 MoE Output Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_residual2_gpu0 [label="Layer 8 Residual2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_7_output_gpu0 -> layer_8_ln1_gpu0
		layer_8_ln1_gpu0 -> layer_8_q_proj_gpu0
		layer_8_ln1_gpu0 -> layer_8_k_proj_gpu0
		layer_8_ln1_gpu0 -> layer_8_v_proj_gpu0
		layer_8_q_proj_gpu0 -> layer_8_attn_gpu0
		layer_8_k_proj_gpu0 -> layer_8_attn_gpu0
		layer_8_v_proj_gpu0 -> layer_8_attn_gpu0
		layer_8_attn_gpu0 -> layer_8_attn_out_proj_gpu0
		layer_8_attn_out_proj_gpu0 -> layer_8_residual1_gpu0
		layer_8_residual1_gpu0 -> layer_8_ln2_gpu0
		layer_8_ln2_gpu0 -> layer_8_router_gpu0
		layer_8_router_gpu0 -> layer_8_gate_gpu0
		layer_8_gate_gpu0 -> layer_8_expert_0_gpu0 [style=dashed]
		layer_8_gate_gpu0 -> layer_8_expert_1_gpu0 [style=dashed]
		layer_8_gate_gpu0 -> layer_8_expert_2_gpu0 [style=dashed]
		layer_8_gate_gpu0 -> layer_8_expert_3_gpu0 [style=dashed]
		layer_8_expert_0_gpu0 -> layer_8_expert_agg_gpu0
		layer_8_expert_1_gpu0 -> layer_8_expert_agg_gpu0
		layer_8_expert_2_gpu0 -> layer_8_expert_agg_gpu0
		layer_8_expert_3_gpu0 -> layer_8_expert_agg_gpu0
		layer_8_expert_agg_gpu0 -> layer_8_moe_out_proj_gpu0
		layer_8_moe_out_proj_gpu0 -> layer_8_residual2_gpu0
		layer_8_output_gpu0 [label="Layer 8 Output\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_8_residual2_gpu0 -> layer_8_output_gpu0
		layer_9_ln1_gpu0 [label="Layer 9 LayerNorm1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_9_q_proj_gpu0 [label="Layer 9 Q Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_k_proj_gpu0 [label="Layer 9 K Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_v_proj_gpu0 [label="Layer 9 V Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_attn_gpu0 [label="Layer 9 Scaled Dot-Product Attention\nGPU 0\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_attn_out_proj_gpu0 [label="Layer 9 Attention Output Projection\nGPU 0\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_residual1_gpu0 [label="Layer 9 Residual1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_9_ln2_gpu0 [label="Layer 9 LayerNorm2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_9_router_gpu0 [label="Layer 9 Router\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_9_gate_gpu0 [label="Layer 9 Gate Selection\nGPU 0\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_9_expert_0_gpu0 [label="Layer 9 Expert 0\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_1_gpu0 [label="Layer 9 Expert 1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_2_gpu0 [label="Layer 9 Expert 2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_3_gpu0 [label="Layer 9 Expert 3\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_agg_gpu0 [label="Layer 9 Expert Aggregation\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_9_moe_out_proj_gpu0 [label="Layer 9 MoE Output Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_residual2_gpu0 [label="Layer 9 Residual2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_8_output_gpu0 -> layer_9_ln1_gpu0
		layer_9_ln1_gpu0 -> layer_9_q_proj_gpu0
		layer_9_ln1_gpu0 -> layer_9_k_proj_gpu0
		layer_9_ln1_gpu0 -> layer_9_v_proj_gpu0
		layer_9_q_proj_gpu0 -> layer_9_attn_gpu0
		layer_9_k_proj_gpu0 -> layer_9_attn_gpu0
		layer_9_v_proj_gpu0 -> layer_9_attn_gpu0
		layer_9_attn_gpu0 -> layer_9_attn_out_proj_gpu0
		layer_9_attn_out_proj_gpu0 -> layer_9_residual1_gpu0
		layer_9_residual1_gpu0 -> layer_9_ln2_gpu0
		layer_9_ln2_gpu0 -> layer_9_router_gpu0
		layer_9_router_gpu0 -> layer_9_gate_gpu0
		layer_9_gate_gpu0 -> layer_9_expert_0_gpu0 [style=dashed]
		layer_9_gate_gpu0 -> layer_9_expert_1_gpu0 [style=dashed]
		layer_9_gate_gpu0 -> layer_9_expert_2_gpu0 [style=dashed]
		layer_9_gate_gpu0 -> layer_9_expert_3_gpu0 [style=dashed]
		layer_9_expert_0_gpu0 -> layer_9_expert_agg_gpu0
		layer_9_expert_1_gpu0 -> layer_9_expert_agg_gpu0
		layer_9_expert_2_gpu0 -> layer_9_expert_agg_gpu0
		layer_9_expert_3_gpu0 -> layer_9_expert_agg_gpu0
		layer_9_expert_agg_gpu0 -> layer_9_moe_out_proj_gpu0
		layer_9_moe_out_proj_gpu0 -> layer_9_residual2_gpu0
		layer_9_output_gpu0 [label="Layer 9 Output\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_9_residual2_gpu0 -> layer_9_output_gpu0
		layer_10_ln1_gpu0 [label="Layer 10 LayerNorm1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_10_q_proj_gpu0 [label="Layer 10 Q Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_k_proj_gpu0 [label="Layer 10 K Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_v_proj_gpu0 [label="Layer 10 V Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_attn_gpu0 [label="Layer 10 Scaled Dot-Product Attention\nGPU 0\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_attn_out_proj_gpu0 [label="Layer 10 Attention Output Projection\nGPU 0\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_residual1_gpu0 [label="Layer 10 Residual1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_10_ln2_gpu0 [label="Layer 10 LayerNorm2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_10_router_gpu0 [label="Layer 10 Router\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_10_gate_gpu0 [label="Layer 10 Gate Selection\nGPU 0\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_10_expert_0_gpu0 [label="Layer 10 Expert 0\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_1_gpu0 [label="Layer 10 Expert 1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_2_gpu0 [label="Layer 10 Expert 2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_3_gpu0 [label="Layer 10 Expert 3\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_agg_gpu0 [label="Layer 10 Expert Aggregation\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_10_moe_out_proj_gpu0 [label="Layer 10 MoE Output Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_residual2_gpu0 [label="Layer 10 Residual2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_9_output_gpu0 -> layer_10_ln1_gpu0
		layer_10_ln1_gpu0 -> layer_10_q_proj_gpu0
		layer_10_ln1_gpu0 -> layer_10_k_proj_gpu0
		layer_10_ln1_gpu0 -> layer_10_v_proj_gpu0
		layer_10_q_proj_gpu0 -> layer_10_attn_gpu0
		layer_10_k_proj_gpu0 -> layer_10_attn_gpu0
		layer_10_v_proj_gpu0 -> layer_10_attn_gpu0
		layer_10_attn_gpu0 -> layer_10_attn_out_proj_gpu0
		layer_10_attn_out_proj_gpu0 -> layer_10_residual1_gpu0
		layer_10_residual1_gpu0 -> layer_10_ln2_gpu0
		layer_10_ln2_gpu0 -> layer_10_router_gpu0
		layer_10_router_gpu0 -> layer_10_gate_gpu0
		layer_10_gate_gpu0 -> layer_10_expert_0_gpu0 [style=dashed]
		layer_10_gate_gpu0 -> layer_10_expert_1_gpu0 [style=dashed]
		layer_10_gate_gpu0 -> layer_10_expert_2_gpu0 [style=dashed]
		layer_10_gate_gpu0 -> layer_10_expert_3_gpu0 [style=dashed]
		layer_10_expert_0_gpu0 -> layer_10_expert_agg_gpu0
		layer_10_expert_1_gpu0 -> layer_10_expert_agg_gpu0
		layer_10_expert_2_gpu0 -> layer_10_expert_agg_gpu0
		layer_10_expert_3_gpu0 -> layer_10_expert_agg_gpu0
		layer_10_expert_agg_gpu0 -> layer_10_moe_out_proj_gpu0
		layer_10_moe_out_proj_gpu0 -> layer_10_residual2_gpu0
		layer_10_output_gpu0 [label="Layer 10 Output\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_10_residual2_gpu0 -> layer_10_output_gpu0
		layer_11_ln1_gpu0 [label="Layer 11 LayerNorm1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_11_q_proj_gpu0 [label="Layer 11 Q Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_k_proj_gpu0 [label="Layer 11 K Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_v_proj_gpu0 [label="Layer 11 V Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_attn_gpu0 [label="Layer 11 Scaled Dot-Product Attention\nGPU 0\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_attn_out_proj_gpu0 [label="Layer 11 Attention Output Projection\nGPU 0\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_residual1_gpu0 [label="Layer 11 Residual1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_11_ln2_gpu0 [label="Layer 11 LayerNorm2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_11_router_gpu0 [label="Layer 11 Router\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_11_gate_gpu0 [label="Layer 11 Gate Selection\nGPU 0\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_11_expert_0_gpu0 [label="Layer 11 Expert 0\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_1_gpu0 [label="Layer 11 Expert 1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_2_gpu0 [label="Layer 11 Expert 2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_3_gpu0 [label="Layer 11 Expert 3\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_agg_gpu0 [label="Layer 11 Expert Aggregation\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_11_moe_out_proj_gpu0 [label="Layer 11 MoE Output Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_residual2_gpu0 [label="Layer 11 Residual2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_10_output_gpu0 -> layer_11_ln1_gpu0
		layer_11_ln1_gpu0 -> layer_11_q_proj_gpu0
		layer_11_ln1_gpu0 -> layer_11_k_proj_gpu0
		layer_11_ln1_gpu0 -> layer_11_v_proj_gpu0
		layer_11_q_proj_gpu0 -> layer_11_attn_gpu0
		layer_11_k_proj_gpu0 -> layer_11_attn_gpu0
		layer_11_v_proj_gpu0 -> layer_11_attn_gpu0
		layer_11_attn_gpu0 -> layer_11_attn_out_proj_gpu0
		layer_11_attn_out_proj_gpu0 -> layer_11_residual1_gpu0
		layer_11_residual1_gpu0 -> layer_11_ln2_gpu0
		layer_11_ln2_gpu0 -> layer_11_router_gpu0
		layer_11_router_gpu0 -> layer_11_gate_gpu0
		layer_11_gate_gpu0 -> layer_11_expert_0_gpu0 [style=dashed]
		layer_11_gate_gpu0 -> layer_11_expert_1_gpu0 [style=dashed]
		layer_11_gate_gpu0 -> layer_11_expert_2_gpu0 [style=dashed]
		layer_11_gate_gpu0 -> layer_11_expert_3_gpu0 [style=dashed]
		layer_11_expert_0_gpu0 -> layer_11_expert_agg_gpu0
		layer_11_expert_1_gpu0 -> layer_11_expert_agg_gpu0
		layer_11_expert_2_gpu0 -> layer_11_expert_agg_gpu0
		layer_11_expert_3_gpu0 -> layer_11_expert_agg_gpu0
		layer_11_expert_agg_gpu0 -> layer_11_moe_out_proj_gpu0
		layer_11_moe_out_proj_gpu0 -> layer_11_residual2_gpu0
		layer_11_output_gpu0 [label="Layer 11 Output\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_11_residual2_gpu0 -> layer_11_output_gpu0
		layer_12_ln1_gpu0 [label="Layer 12 LayerNorm1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_12_q_proj_gpu0 [label="Layer 12 Q Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_k_proj_gpu0 [label="Layer 12 K Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_v_proj_gpu0 [label="Layer 12 V Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_attn_gpu0 [label="Layer 12 Scaled Dot-Product Attention\nGPU 0\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_attn_out_proj_gpu0 [label="Layer 12 Attention Output Projection\nGPU 0\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_residual1_gpu0 [label="Layer 12 Residual1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_12_ln2_gpu0 [label="Layer 12 LayerNorm2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_12_router_gpu0 [label="Layer 12 Router\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_12_gate_gpu0 [label="Layer 12 Gate Selection\nGPU 0\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_12_expert_0_gpu0 [label="Layer 12 Expert 0\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_1_gpu0 [label="Layer 12 Expert 1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_2_gpu0 [label="Layer 12 Expert 2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_3_gpu0 [label="Layer 12 Expert 3\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_agg_gpu0 [label="Layer 12 Expert Aggregation\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_12_moe_out_proj_gpu0 [label="Layer 12 MoE Output Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_residual2_gpu0 [label="Layer 12 Residual2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_11_output_gpu0 -> layer_12_ln1_gpu0
		layer_12_ln1_gpu0 -> layer_12_q_proj_gpu0
		layer_12_ln1_gpu0 -> layer_12_k_proj_gpu0
		layer_12_ln1_gpu0 -> layer_12_v_proj_gpu0
		layer_12_q_proj_gpu0 -> layer_12_attn_gpu0
		layer_12_k_proj_gpu0 -> layer_12_attn_gpu0
		layer_12_v_proj_gpu0 -> layer_12_attn_gpu0
		layer_12_attn_gpu0 -> layer_12_attn_out_proj_gpu0
		layer_12_attn_out_proj_gpu0 -> layer_12_residual1_gpu0
		layer_12_residual1_gpu0 -> layer_12_ln2_gpu0
		layer_12_ln2_gpu0 -> layer_12_router_gpu0
		layer_12_router_gpu0 -> layer_12_gate_gpu0
		layer_12_gate_gpu0 -> layer_12_expert_0_gpu0 [style=dashed]
		layer_12_gate_gpu0 -> layer_12_expert_1_gpu0 [style=dashed]
		layer_12_gate_gpu0 -> layer_12_expert_2_gpu0 [style=dashed]
		layer_12_gate_gpu0 -> layer_12_expert_3_gpu0 [style=dashed]
		layer_12_expert_0_gpu0 -> layer_12_expert_agg_gpu0
		layer_12_expert_1_gpu0 -> layer_12_expert_agg_gpu0
		layer_12_expert_2_gpu0 -> layer_12_expert_agg_gpu0
		layer_12_expert_3_gpu0 -> layer_12_expert_agg_gpu0
		layer_12_expert_agg_gpu0 -> layer_12_moe_out_proj_gpu0
		layer_12_moe_out_proj_gpu0 -> layer_12_residual2_gpu0
		layer_12_output_gpu0 [label="Layer 12 Output\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_12_residual2_gpu0 -> layer_12_output_gpu0
		layer_13_ln1_gpu0 [label="Layer 13 LayerNorm1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_13_q_proj_gpu0 [label="Layer 13 Q Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_k_proj_gpu0 [label="Layer 13 K Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_v_proj_gpu0 [label="Layer 13 V Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_attn_gpu0 [label="Layer 13 Scaled Dot-Product Attention\nGPU 0\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_attn_out_proj_gpu0 [label="Layer 13 Attention Output Projection\nGPU 0\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_residual1_gpu0 [label="Layer 13 Residual1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_13_ln2_gpu0 [label="Layer 13 LayerNorm2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_13_router_gpu0 [label="Layer 13 Router\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_13_gate_gpu0 [label="Layer 13 Gate Selection\nGPU 0\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_13_expert_0_gpu0 [label="Layer 13 Expert 0\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_1_gpu0 [label="Layer 13 Expert 1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_2_gpu0 [label="Layer 13 Expert 2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_3_gpu0 [label="Layer 13 Expert 3\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_agg_gpu0 [label="Layer 13 Expert Aggregation\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_13_moe_out_proj_gpu0 [label="Layer 13 MoE Output Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_residual2_gpu0 [label="Layer 13 Residual2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_12_output_gpu0 -> layer_13_ln1_gpu0
		layer_13_ln1_gpu0 -> layer_13_q_proj_gpu0
		layer_13_ln1_gpu0 -> layer_13_k_proj_gpu0
		layer_13_ln1_gpu0 -> layer_13_v_proj_gpu0
		layer_13_q_proj_gpu0 -> layer_13_attn_gpu0
		layer_13_k_proj_gpu0 -> layer_13_attn_gpu0
		layer_13_v_proj_gpu0 -> layer_13_attn_gpu0
		layer_13_attn_gpu0 -> layer_13_attn_out_proj_gpu0
		layer_13_attn_out_proj_gpu0 -> layer_13_residual1_gpu0
		layer_13_residual1_gpu0 -> layer_13_ln2_gpu0
		layer_13_ln2_gpu0 -> layer_13_router_gpu0
		layer_13_router_gpu0 -> layer_13_gate_gpu0
		layer_13_gate_gpu0 -> layer_13_expert_0_gpu0 [style=dashed]
		layer_13_gate_gpu0 -> layer_13_expert_1_gpu0 [style=dashed]
		layer_13_gate_gpu0 -> layer_13_expert_2_gpu0 [style=dashed]
		layer_13_gate_gpu0 -> layer_13_expert_3_gpu0 [style=dashed]
		layer_13_expert_0_gpu0 -> layer_13_expert_agg_gpu0
		layer_13_expert_1_gpu0 -> layer_13_expert_agg_gpu0
		layer_13_expert_2_gpu0 -> layer_13_expert_agg_gpu0
		layer_13_expert_3_gpu0 -> layer_13_expert_agg_gpu0
		layer_13_expert_agg_gpu0 -> layer_13_moe_out_proj_gpu0
		layer_13_moe_out_proj_gpu0 -> layer_13_residual2_gpu0
		layer_13_output_gpu0 [label="Layer 13 Output\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_13_residual2_gpu0 -> layer_13_output_gpu0
		layer_14_ln1_gpu0 [label="Layer 14 LayerNorm1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_14_q_proj_gpu0 [label="Layer 14 Q Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_k_proj_gpu0 [label="Layer 14 K Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_v_proj_gpu0 [label="Layer 14 V Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_attn_gpu0 [label="Layer 14 Scaled Dot-Product Attention\nGPU 0\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_attn_out_proj_gpu0 [label="Layer 14 Attention Output Projection\nGPU 0\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_residual1_gpu0 [label="Layer 14 Residual1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_14_ln2_gpu0 [label="Layer 14 LayerNorm2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_14_router_gpu0 [label="Layer 14 Router\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_14_gate_gpu0 [label="Layer 14 Gate Selection\nGPU 0\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_14_expert_0_gpu0 [label="Layer 14 Expert 0\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_1_gpu0 [label="Layer 14 Expert 1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_2_gpu0 [label="Layer 14 Expert 2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_3_gpu0 [label="Layer 14 Expert 3\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_agg_gpu0 [label="Layer 14 Expert Aggregation\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_14_moe_out_proj_gpu0 [label="Layer 14 MoE Output Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_residual2_gpu0 [label="Layer 14 Residual2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_13_output_gpu0 -> layer_14_ln1_gpu0
		layer_14_ln1_gpu0 -> layer_14_q_proj_gpu0
		layer_14_ln1_gpu0 -> layer_14_k_proj_gpu0
		layer_14_ln1_gpu0 -> layer_14_v_proj_gpu0
		layer_14_q_proj_gpu0 -> layer_14_attn_gpu0
		layer_14_k_proj_gpu0 -> layer_14_attn_gpu0
		layer_14_v_proj_gpu0 -> layer_14_attn_gpu0
		layer_14_attn_gpu0 -> layer_14_attn_out_proj_gpu0
		layer_14_attn_out_proj_gpu0 -> layer_14_residual1_gpu0
		layer_14_residual1_gpu0 -> layer_14_ln2_gpu0
		layer_14_ln2_gpu0 -> layer_14_router_gpu0
		layer_14_router_gpu0 -> layer_14_gate_gpu0
		layer_14_gate_gpu0 -> layer_14_expert_0_gpu0 [style=dashed]
		layer_14_gate_gpu0 -> layer_14_expert_1_gpu0 [style=dashed]
		layer_14_gate_gpu0 -> layer_14_expert_2_gpu0 [style=dashed]
		layer_14_gate_gpu0 -> layer_14_expert_3_gpu0 [style=dashed]
		layer_14_expert_0_gpu0 -> layer_14_expert_agg_gpu0
		layer_14_expert_1_gpu0 -> layer_14_expert_agg_gpu0
		layer_14_expert_2_gpu0 -> layer_14_expert_agg_gpu0
		layer_14_expert_3_gpu0 -> layer_14_expert_agg_gpu0
		layer_14_expert_agg_gpu0 -> layer_14_moe_out_proj_gpu0
		layer_14_moe_out_proj_gpu0 -> layer_14_residual2_gpu0
		layer_14_output_gpu0 [label="Layer 14 Output\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_14_residual2_gpu0 -> layer_14_output_gpu0
		layer_15_ln1_gpu0 [label="Layer 15 LayerNorm1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_15_q_proj_gpu0 [label="Layer 15 Q Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_k_proj_gpu0 [label="Layer 15 K Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_v_proj_gpu0 [label="Layer 15 V Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_attn_gpu0 [label="Layer 15 Scaled Dot-Product Attention\nGPU 0\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_attn_out_proj_gpu0 [label="Layer 15 Attention Output Projection\nGPU 0\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_residual1_gpu0 [label="Layer 15 Residual1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_15_ln2_gpu0 [label="Layer 15 LayerNorm2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_15_router_gpu0 [label="Layer 15 Router\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_15_gate_gpu0 [label="Layer 15 Gate Selection\nGPU 0\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_15_expert_0_gpu0 [label="Layer 15 Expert 0\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_1_gpu0 [label="Layer 15 Expert 1\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_2_gpu0 [label="Layer 15 Expert 2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_3_gpu0 [label="Layer 15 Expert 3\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_agg_gpu0 [label="Layer 15 Expert Aggregation\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_15_moe_out_proj_gpu0 [label="Layer 15 MoE Output Projection\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_residual2_gpu0 [label="Layer 15 Residual2\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_14_output_gpu0 -> layer_15_ln1_gpu0
		layer_15_ln1_gpu0 -> layer_15_q_proj_gpu0
		layer_15_ln1_gpu0 -> layer_15_k_proj_gpu0
		layer_15_ln1_gpu0 -> layer_15_v_proj_gpu0
		layer_15_q_proj_gpu0 -> layer_15_attn_gpu0
		layer_15_k_proj_gpu0 -> layer_15_attn_gpu0
		layer_15_v_proj_gpu0 -> layer_15_attn_gpu0
		layer_15_attn_gpu0 -> layer_15_attn_out_proj_gpu0
		layer_15_attn_out_proj_gpu0 -> layer_15_residual1_gpu0
		layer_15_residual1_gpu0 -> layer_15_ln2_gpu0
		layer_15_ln2_gpu0 -> layer_15_router_gpu0
		layer_15_router_gpu0 -> layer_15_gate_gpu0
		layer_15_gate_gpu0 -> layer_15_expert_0_gpu0 [style=dashed]
		layer_15_gate_gpu0 -> layer_15_expert_1_gpu0 [style=dashed]
		layer_15_gate_gpu0 -> layer_15_expert_2_gpu0 [style=dashed]
		layer_15_gate_gpu0 -> layer_15_expert_3_gpu0 [style=dashed]
		layer_15_expert_0_gpu0 -> layer_15_expert_agg_gpu0
		layer_15_expert_1_gpu0 -> layer_15_expert_agg_gpu0
		layer_15_expert_2_gpu0 -> layer_15_expert_agg_gpu0
		layer_15_expert_3_gpu0 -> layer_15_expert_agg_gpu0
		layer_15_expert_agg_gpu0 -> layer_15_moe_out_proj_gpu0
		layer_15_moe_out_proj_gpu0 -> layer_15_residual2_gpu0
		layer_15_output_gpu0 [label="Layer 15 Output\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_15_residual2_gpu0 -> layer_15_output_gpu0
		final_ln_gpu0 [label="Final Layer Norm\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		layer_15_output_gpu0 -> final_ln_gpu0
		lm_head_gpu0 [label="LM Head\nGPU 0\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, vocab_size]" fillcolor=lightcoral shape=rectangle style=filled]
		output_gpu0 [label="Output\nGPU 0\nInput: [batch=256, seq=512, vocab_size]\nOutput: [batch=256, seq=512, vocab_size]" fillcolor=lightgreen shape=ellipse style=filled]
		input_gpu0 -> embed_gpu0
		embed_gpu0 -> pos_enc_gpu0
		final_ln_gpu0 -> lm_head_gpu0
		lm_head_gpu0 -> output_gpu0
	}
	subgraph cluster_gpu_1 {
		color=blue fillcolor=lightblue label="GPU 1" style=rounded
		input_gpu1 [label="Input\nGPU 1\nInput: [batch=256, seq=512, dim=1024]\nOutput: [batch=256, seq=512, dim=1024]" fillcolor=lightgreen shape=ellipse style=filled]
		embed_gpu1 [label="Token Embedding\nGPU 1\nInput: [batch=256, seq=512]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		pos_enc_gpu1 [label="Position Encoding\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		layer_0_ln1_gpu1 [label="Layer 0 LayerNorm1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_0_q_proj_gpu1 [label="Layer 0 Q Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_k_proj_gpu1 [label="Layer 0 K Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_v_proj_gpu1 [label="Layer 0 V Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_attn_gpu1 [label="Layer 0 Scaled Dot-Product Attention\nGPU 1\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_attn_out_proj_gpu1 [label="Layer 0 Attention Output Projection\nGPU 1\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_residual1_gpu1 [label="Layer 0 Residual1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_0_ln2_gpu1 [label="Layer 0 LayerNorm2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_0_router_gpu1 [label="Layer 0 Router\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_0_gate_gpu1 [label="Layer 0 Gate Selection\nGPU 1\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_0_expert_0_gpu1 [label="Layer 0 Expert 0\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_1_gpu1 [label="Layer 0 Expert 1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_2_gpu1 [label="Layer 0 Expert 2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_3_gpu1 [label="Layer 0 Expert 3\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_agg_gpu1 [label="Layer 0 Expert Aggregation\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_0_moe_out_proj_gpu1 [label="Layer 0 MoE Output Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_residual2_gpu1 [label="Layer 0 Residual2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		pos_enc_gpu1 -> layer_0_ln1_gpu1
		layer_0_ln1_gpu1 -> layer_0_q_proj_gpu1
		layer_0_ln1_gpu1 -> layer_0_k_proj_gpu1
		layer_0_ln1_gpu1 -> layer_0_v_proj_gpu1
		layer_0_q_proj_gpu1 -> layer_0_attn_gpu1
		layer_0_k_proj_gpu1 -> layer_0_attn_gpu1
		layer_0_v_proj_gpu1 -> layer_0_attn_gpu1
		layer_0_attn_gpu1 -> layer_0_attn_out_proj_gpu1
		layer_0_attn_out_proj_gpu1 -> layer_0_residual1_gpu1
		layer_0_residual1_gpu1 -> layer_0_ln2_gpu1
		layer_0_ln2_gpu1 -> layer_0_router_gpu1
		layer_0_router_gpu1 -> layer_0_gate_gpu1
		layer_0_gate_gpu1 -> layer_0_expert_0_gpu1 [style=dashed]
		layer_0_gate_gpu1 -> layer_0_expert_1_gpu1 [style=dashed]
		layer_0_gate_gpu1 -> layer_0_expert_2_gpu1 [style=dashed]
		layer_0_gate_gpu1 -> layer_0_expert_3_gpu1 [style=dashed]
		layer_0_expert_0_gpu1 -> layer_0_expert_agg_gpu1
		layer_0_expert_1_gpu1 -> layer_0_expert_agg_gpu1
		layer_0_expert_2_gpu1 -> layer_0_expert_agg_gpu1
		layer_0_expert_3_gpu1 -> layer_0_expert_agg_gpu1
		layer_0_expert_agg_gpu1 -> layer_0_moe_out_proj_gpu1
		layer_0_moe_out_proj_gpu1 -> layer_0_residual2_gpu1
		layer_0_output_gpu1 [label="Layer 0 Output\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_0_residual2_gpu1 -> layer_0_output_gpu1
		layer_1_ln1_gpu1 [label="Layer 1 LayerNorm1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_1_q_proj_gpu1 [label="Layer 1 Q Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_k_proj_gpu1 [label="Layer 1 K Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_v_proj_gpu1 [label="Layer 1 V Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_attn_gpu1 [label="Layer 1 Scaled Dot-Product Attention\nGPU 1\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_attn_out_proj_gpu1 [label="Layer 1 Attention Output Projection\nGPU 1\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_residual1_gpu1 [label="Layer 1 Residual1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_1_ln2_gpu1 [label="Layer 1 LayerNorm2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_1_router_gpu1 [label="Layer 1 Router\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_1_gate_gpu1 [label="Layer 1 Gate Selection\nGPU 1\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_1_expert_0_gpu1 [label="Layer 1 Expert 0\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_1_gpu1 [label="Layer 1 Expert 1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_2_gpu1 [label="Layer 1 Expert 2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_3_gpu1 [label="Layer 1 Expert 3\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_agg_gpu1 [label="Layer 1 Expert Aggregation\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_1_moe_out_proj_gpu1 [label="Layer 1 MoE Output Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_residual2_gpu1 [label="Layer 1 Residual2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_0_output_gpu1 -> layer_1_ln1_gpu1
		layer_1_ln1_gpu1 -> layer_1_q_proj_gpu1
		layer_1_ln1_gpu1 -> layer_1_k_proj_gpu1
		layer_1_ln1_gpu1 -> layer_1_v_proj_gpu1
		layer_1_q_proj_gpu1 -> layer_1_attn_gpu1
		layer_1_k_proj_gpu1 -> layer_1_attn_gpu1
		layer_1_v_proj_gpu1 -> layer_1_attn_gpu1
		layer_1_attn_gpu1 -> layer_1_attn_out_proj_gpu1
		layer_1_attn_out_proj_gpu1 -> layer_1_residual1_gpu1
		layer_1_residual1_gpu1 -> layer_1_ln2_gpu1
		layer_1_ln2_gpu1 -> layer_1_router_gpu1
		layer_1_router_gpu1 -> layer_1_gate_gpu1
		layer_1_gate_gpu1 -> layer_1_expert_0_gpu1 [style=dashed]
		layer_1_gate_gpu1 -> layer_1_expert_1_gpu1 [style=dashed]
		layer_1_gate_gpu1 -> layer_1_expert_2_gpu1 [style=dashed]
		layer_1_gate_gpu1 -> layer_1_expert_3_gpu1 [style=dashed]
		layer_1_expert_0_gpu1 -> layer_1_expert_agg_gpu1
		layer_1_expert_1_gpu1 -> layer_1_expert_agg_gpu1
		layer_1_expert_2_gpu1 -> layer_1_expert_agg_gpu1
		layer_1_expert_3_gpu1 -> layer_1_expert_agg_gpu1
		layer_1_expert_agg_gpu1 -> layer_1_moe_out_proj_gpu1
		layer_1_moe_out_proj_gpu1 -> layer_1_residual2_gpu1
		layer_1_output_gpu1 [label="Layer 1 Output\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_1_residual2_gpu1 -> layer_1_output_gpu1
		layer_2_ln1_gpu1 [label="Layer 2 LayerNorm1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_2_q_proj_gpu1 [label="Layer 2 Q Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_k_proj_gpu1 [label="Layer 2 K Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_v_proj_gpu1 [label="Layer 2 V Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_attn_gpu1 [label="Layer 2 Scaled Dot-Product Attention\nGPU 1\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_attn_out_proj_gpu1 [label="Layer 2 Attention Output Projection\nGPU 1\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_residual1_gpu1 [label="Layer 2 Residual1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_2_ln2_gpu1 [label="Layer 2 LayerNorm2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_2_router_gpu1 [label="Layer 2 Router\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_2_gate_gpu1 [label="Layer 2 Gate Selection\nGPU 1\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_2_expert_0_gpu1 [label="Layer 2 Expert 0\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_1_gpu1 [label="Layer 2 Expert 1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_2_gpu1 [label="Layer 2 Expert 2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_3_gpu1 [label="Layer 2 Expert 3\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_agg_gpu1 [label="Layer 2 Expert Aggregation\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_2_moe_out_proj_gpu1 [label="Layer 2 MoE Output Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_residual2_gpu1 [label="Layer 2 Residual2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_1_output_gpu1 -> layer_2_ln1_gpu1
		layer_2_ln1_gpu1 -> layer_2_q_proj_gpu1
		layer_2_ln1_gpu1 -> layer_2_k_proj_gpu1
		layer_2_ln1_gpu1 -> layer_2_v_proj_gpu1
		layer_2_q_proj_gpu1 -> layer_2_attn_gpu1
		layer_2_k_proj_gpu1 -> layer_2_attn_gpu1
		layer_2_v_proj_gpu1 -> layer_2_attn_gpu1
		layer_2_attn_gpu1 -> layer_2_attn_out_proj_gpu1
		layer_2_attn_out_proj_gpu1 -> layer_2_residual1_gpu1
		layer_2_residual1_gpu1 -> layer_2_ln2_gpu1
		layer_2_ln2_gpu1 -> layer_2_router_gpu1
		layer_2_router_gpu1 -> layer_2_gate_gpu1
		layer_2_gate_gpu1 -> layer_2_expert_0_gpu1 [style=dashed]
		layer_2_gate_gpu1 -> layer_2_expert_1_gpu1 [style=dashed]
		layer_2_gate_gpu1 -> layer_2_expert_2_gpu1 [style=dashed]
		layer_2_gate_gpu1 -> layer_2_expert_3_gpu1 [style=dashed]
		layer_2_expert_0_gpu1 -> layer_2_expert_agg_gpu1
		layer_2_expert_1_gpu1 -> layer_2_expert_agg_gpu1
		layer_2_expert_2_gpu1 -> layer_2_expert_agg_gpu1
		layer_2_expert_3_gpu1 -> layer_2_expert_agg_gpu1
		layer_2_expert_agg_gpu1 -> layer_2_moe_out_proj_gpu1
		layer_2_moe_out_proj_gpu1 -> layer_2_residual2_gpu1
		layer_2_output_gpu1 [label="Layer 2 Output\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_2_residual2_gpu1 -> layer_2_output_gpu1
		layer_3_ln1_gpu1 [label="Layer 3 LayerNorm1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_3_q_proj_gpu1 [label="Layer 3 Q Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_k_proj_gpu1 [label="Layer 3 K Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_v_proj_gpu1 [label="Layer 3 V Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_attn_gpu1 [label="Layer 3 Scaled Dot-Product Attention\nGPU 1\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_attn_out_proj_gpu1 [label="Layer 3 Attention Output Projection\nGPU 1\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_residual1_gpu1 [label="Layer 3 Residual1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_3_ln2_gpu1 [label="Layer 3 LayerNorm2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_3_router_gpu1 [label="Layer 3 Router\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_3_gate_gpu1 [label="Layer 3 Gate Selection\nGPU 1\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_3_expert_0_gpu1 [label="Layer 3 Expert 0\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_1_gpu1 [label="Layer 3 Expert 1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_2_gpu1 [label="Layer 3 Expert 2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_3_gpu1 [label="Layer 3 Expert 3\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_agg_gpu1 [label="Layer 3 Expert Aggregation\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_3_moe_out_proj_gpu1 [label="Layer 3 MoE Output Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_residual2_gpu1 [label="Layer 3 Residual2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_2_output_gpu1 -> layer_3_ln1_gpu1
		layer_3_ln1_gpu1 -> layer_3_q_proj_gpu1
		layer_3_ln1_gpu1 -> layer_3_k_proj_gpu1
		layer_3_ln1_gpu1 -> layer_3_v_proj_gpu1
		layer_3_q_proj_gpu1 -> layer_3_attn_gpu1
		layer_3_k_proj_gpu1 -> layer_3_attn_gpu1
		layer_3_v_proj_gpu1 -> layer_3_attn_gpu1
		layer_3_attn_gpu1 -> layer_3_attn_out_proj_gpu1
		layer_3_attn_out_proj_gpu1 -> layer_3_residual1_gpu1
		layer_3_residual1_gpu1 -> layer_3_ln2_gpu1
		layer_3_ln2_gpu1 -> layer_3_router_gpu1
		layer_3_router_gpu1 -> layer_3_gate_gpu1
		layer_3_gate_gpu1 -> layer_3_expert_0_gpu1 [style=dashed]
		layer_3_gate_gpu1 -> layer_3_expert_1_gpu1 [style=dashed]
		layer_3_gate_gpu1 -> layer_3_expert_2_gpu1 [style=dashed]
		layer_3_gate_gpu1 -> layer_3_expert_3_gpu1 [style=dashed]
		layer_3_expert_0_gpu1 -> layer_3_expert_agg_gpu1
		layer_3_expert_1_gpu1 -> layer_3_expert_agg_gpu1
		layer_3_expert_2_gpu1 -> layer_3_expert_agg_gpu1
		layer_3_expert_3_gpu1 -> layer_3_expert_agg_gpu1
		layer_3_expert_agg_gpu1 -> layer_3_moe_out_proj_gpu1
		layer_3_moe_out_proj_gpu1 -> layer_3_residual2_gpu1
		layer_3_output_gpu1 [label="Layer 3 Output\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_3_residual2_gpu1 -> layer_3_output_gpu1
		layer_4_ln1_gpu1 [label="Layer 4 LayerNorm1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_4_q_proj_gpu1 [label="Layer 4 Q Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_k_proj_gpu1 [label="Layer 4 K Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_v_proj_gpu1 [label="Layer 4 V Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_attn_gpu1 [label="Layer 4 Scaled Dot-Product Attention\nGPU 1\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_attn_out_proj_gpu1 [label="Layer 4 Attention Output Projection\nGPU 1\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_residual1_gpu1 [label="Layer 4 Residual1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_4_ln2_gpu1 [label="Layer 4 LayerNorm2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_4_router_gpu1 [label="Layer 4 Router\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_4_gate_gpu1 [label="Layer 4 Gate Selection\nGPU 1\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_4_expert_0_gpu1 [label="Layer 4 Expert 0\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_1_gpu1 [label="Layer 4 Expert 1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_2_gpu1 [label="Layer 4 Expert 2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_3_gpu1 [label="Layer 4 Expert 3\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_agg_gpu1 [label="Layer 4 Expert Aggregation\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_4_moe_out_proj_gpu1 [label="Layer 4 MoE Output Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_residual2_gpu1 [label="Layer 4 Residual2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_3_output_gpu1 -> layer_4_ln1_gpu1
		layer_4_ln1_gpu1 -> layer_4_q_proj_gpu1
		layer_4_ln1_gpu1 -> layer_4_k_proj_gpu1
		layer_4_ln1_gpu1 -> layer_4_v_proj_gpu1
		layer_4_q_proj_gpu1 -> layer_4_attn_gpu1
		layer_4_k_proj_gpu1 -> layer_4_attn_gpu1
		layer_4_v_proj_gpu1 -> layer_4_attn_gpu1
		layer_4_attn_gpu1 -> layer_4_attn_out_proj_gpu1
		layer_4_attn_out_proj_gpu1 -> layer_4_residual1_gpu1
		layer_4_residual1_gpu1 -> layer_4_ln2_gpu1
		layer_4_ln2_gpu1 -> layer_4_router_gpu1
		layer_4_router_gpu1 -> layer_4_gate_gpu1
		layer_4_gate_gpu1 -> layer_4_expert_0_gpu1 [style=dashed]
		layer_4_gate_gpu1 -> layer_4_expert_1_gpu1 [style=dashed]
		layer_4_gate_gpu1 -> layer_4_expert_2_gpu1 [style=dashed]
		layer_4_gate_gpu1 -> layer_4_expert_3_gpu1 [style=dashed]
		layer_4_expert_0_gpu1 -> layer_4_expert_agg_gpu1
		layer_4_expert_1_gpu1 -> layer_4_expert_agg_gpu1
		layer_4_expert_2_gpu1 -> layer_4_expert_agg_gpu1
		layer_4_expert_3_gpu1 -> layer_4_expert_agg_gpu1
		layer_4_expert_agg_gpu1 -> layer_4_moe_out_proj_gpu1
		layer_4_moe_out_proj_gpu1 -> layer_4_residual2_gpu1
		layer_4_output_gpu1 [label="Layer 4 Output\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_4_residual2_gpu1 -> layer_4_output_gpu1
		layer_5_ln1_gpu1 [label="Layer 5 LayerNorm1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_5_q_proj_gpu1 [label="Layer 5 Q Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_k_proj_gpu1 [label="Layer 5 K Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_v_proj_gpu1 [label="Layer 5 V Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_attn_gpu1 [label="Layer 5 Scaled Dot-Product Attention\nGPU 1\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_attn_out_proj_gpu1 [label="Layer 5 Attention Output Projection\nGPU 1\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_residual1_gpu1 [label="Layer 5 Residual1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_5_ln2_gpu1 [label="Layer 5 LayerNorm2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_5_router_gpu1 [label="Layer 5 Router\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_5_gate_gpu1 [label="Layer 5 Gate Selection\nGPU 1\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_5_expert_0_gpu1 [label="Layer 5 Expert 0\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_1_gpu1 [label="Layer 5 Expert 1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_2_gpu1 [label="Layer 5 Expert 2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_3_gpu1 [label="Layer 5 Expert 3\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_agg_gpu1 [label="Layer 5 Expert Aggregation\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_5_moe_out_proj_gpu1 [label="Layer 5 MoE Output Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_residual2_gpu1 [label="Layer 5 Residual2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_4_output_gpu1 -> layer_5_ln1_gpu1
		layer_5_ln1_gpu1 -> layer_5_q_proj_gpu1
		layer_5_ln1_gpu1 -> layer_5_k_proj_gpu1
		layer_5_ln1_gpu1 -> layer_5_v_proj_gpu1
		layer_5_q_proj_gpu1 -> layer_5_attn_gpu1
		layer_5_k_proj_gpu1 -> layer_5_attn_gpu1
		layer_5_v_proj_gpu1 -> layer_5_attn_gpu1
		layer_5_attn_gpu1 -> layer_5_attn_out_proj_gpu1
		layer_5_attn_out_proj_gpu1 -> layer_5_residual1_gpu1
		layer_5_residual1_gpu1 -> layer_5_ln2_gpu1
		layer_5_ln2_gpu1 -> layer_5_router_gpu1
		layer_5_router_gpu1 -> layer_5_gate_gpu1
		layer_5_gate_gpu1 -> layer_5_expert_0_gpu1 [style=dashed]
		layer_5_gate_gpu1 -> layer_5_expert_1_gpu1 [style=dashed]
		layer_5_gate_gpu1 -> layer_5_expert_2_gpu1 [style=dashed]
		layer_5_gate_gpu1 -> layer_5_expert_3_gpu1 [style=dashed]
		layer_5_expert_0_gpu1 -> layer_5_expert_agg_gpu1
		layer_5_expert_1_gpu1 -> layer_5_expert_agg_gpu1
		layer_5_expert_2_gpu1 -> layer_5_expert_agg_gpu1
		layer_5_expert_3_gpu1 -> layer_5_expert_agg_gpu1
		layer_5_expert_agg_gpu1 -> layer_5_moe_out_proj_gpu1
		layer_5_moe_out_proj_gpu1 -> layer_5_residual2_gpu1
		layer_5_output_gpu1 [label="Layer 5 Output\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_5_residual2_gpu1 -> layer_5_output_gpu1
		layer_6_ln1_gpu1 [label="Layer 6 LayerNorm1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_6_q_proj_gpu1 [label="Layer 6 Q Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_k_proj_gpu1 [label="Layer 6 K Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_v_proj_gpu1 [label="Layer 6 V Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_attn_gpu1 [label="Layer 6 Scaled Dot-Product Attention\nGPU 1\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_attn_out_proj_gpu1 [label="Layer 6 Attention Output Projection\nGPU 1\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_residual1_gpu1 [label="Layer 6 Residual1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_6_ln2_gpu1 [label="Layer 6 LayerNorm2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_6_router_gpu1 [label="Layer 6 Router\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_6_gate_gpu1 [label="Layer 6 Gate Selection\nGPU 1\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_6_expert_0_gpu1 [label="Layer 6 Expert 0\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_1_gpu1 [label="Layer 6 Expert 1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_2_gpu1 [label="Layer 6 Expert 2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_3_gpu1 [label="Layer 6 Expert 3\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_agg_gpu1 [label="Layer 6 Expert Aggregation\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_6_moe_out_proj_gpu1 [label="Layer 6 MoE Output Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_residual2_gpu1 [label="Layer 6 Residual2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_5_output_gpu1 -> layer_6_ln1_gpu1
		layer_6_ln1_gpu1 -> layer_6_q_proj_gpu1
		layer_6_ln1_gpu1 -> layer_6_k_proj_gpu1
		layer_6_ln1_gpu1 -> layer_6_v_proj_gpu1
		layer_6_q_proj_gpu1 -> layer_6_attn_gpu1
		layer_6_k_proj_gpu1 -> layer_6_attn_gpu1
		layer_6_v_proj_gpu1 -> layer_6_attn_gpu1
		layer_6_attn_gpu1 -> layer_6_attn_out_proj_gpu1
		layer_6_attn_out_proj_gpu1 -> layer_6_residual1_gpu1
		layer_6_residual1_gpu1 -> layer_6_ln2_gpu1
		layer_6_ln2_gpu1 -> layer_6_router_gpu1
		layer_6_router_gpu1 -> layer_6_gate_gpu1
		layer_6_gate_gpu1 -> layer_6_expert_0_gpu1 [style=dashed]
		layer_6_gate_gpu1 -> layer_6_expert_1_gpu1 [style=dashed]
		layer_6_gate_gpu1 -> layer_6_expert_2_gpu1 [style=dashed]
		layer_6_gate_gpu1 -> layer_6_expert_3_gpu1 [style=dashed]
		layer_6_expert_0_gpu1 -> layer_6_expert_agg_gpu1
		layer_6_expert_1_gpu1 -> layer_6_expert_agg_gpu1
		layer_6_expert_2_gpu1 -> layer_6_expert_agg_gpu1
		layer_6_expert_3_gpu1 -> layer_6_expert_agg_gpu1
		layer_6_expert_agg_gpu1 -> layer_6_moe_out_proj_gpu1
		layer_6_moe_out_proj_gpu1 -> layer_6_residual2_gpu1
		layer_6_output_gpu1 [label="Layer 6 Output\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_6_residual2_gpu1 -> layer_6_output_gpu1
		layer_7_ln1_gpu1 [label="Layer 7 LayerNorm1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_7_q_proj_gpu1 [label="Layer 7 Q Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_k_proj_gpu1 [label="Layer 7 K Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_v_proj_gpu1 [label="Layer 7 V Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_attn_gpu1 [label="Layer 7 Scaled Dot-Product Attention\nGPU 1\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_attn_out_proj_gpu1 [label="Layer 7 Attention Output Projection\nGPU 1\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_residual1_gpu1 [label="Layer 7 Residual1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_7_ln2_gpu1 [label="Layer 7 LayerNorm2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_7_router_gpu1 [label="Layer 7 Router\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_7_gate_gpu1 [label="Layer 7 Gate Selection\nGPU 1\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_7_expert_0_gpu1 [label="Layer 7 Expert 0\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_1_gpu1 [label="Layer 7 Expert 1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_2_gpu1 [label="Layer 7 Expert 2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_3_gpu1 [label="Layer 7 Expert 3\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_agg_gpu1 [label="Layer 7 Expert Aggregation\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_7_moe_out_proj_gpu1 [label="Layer 7 MoE Output Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_residual2_gpu1 [label="Layer 7 Residual2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_6_output_gpu1 -> layer_7_ln1_gpu1
		layer_7_ln1_gpu1 -> layer_7_q_proj_gpu1
		layer_7_ln1_gpu1 -> layer_7_k_proj_gpu1
		layer_7_ln1_gpu1 -> layer_7_v_proj_gpu1
		layer_7_q_proj_gpu1 -> layer_7_attn_gpu1
		layer_7_k_proj_gpu1 -> layer_7_attn_gpu1
		layer_7_v_proj_gpu1 -> layer_7_attn_gpu1
		layer_7_attn_gpu1 -> layer_7_attn_out_proj_gpu1
		layer_7_attn_out_proj_gpu1 -> layer_7_residual1_gpu1
		layer_7_residual1_gpu1 -> layer_7_ln2_gpu1
		layer_7_ln2_gpu1 -> layer_7_router_gpu1
		layer_7_router_gpu1 -> layer_7_gate_gpu1
		layer_7_gate_gpu1 -> layer_7_expert_0_gpu1 [style=dashed]
		layer_7_gate_gpu1 -> layer_7_expert_1_gpu1 [style=dashed]
		layer_7_gate_gpu1 -> layer_7_expert_2_gpu1 [style=dashed]
		layer_7_gate_gpu1 -> layer_7_expert_3_gpu1 [style=dashed]
		layer_7_expert_0_gpu1 -> layer_7_expert_agg_gpu1
		layer_7_expert_1_gpu1 -> layer_7_expert_agg_gpu1
		layer_7_expert_2_gpu1 -> layer_7_expert_agg_gpu1
		layer_7_expert_3_gpu1 -> layer_7_expert_agg_gpu1
		layer_7_expert_agg_gpu1 -> layer_7_moe_out_proj_gpu1
		layer_7_moe_out_proj_gpu1 -> layer_7_residual2_gpu1
		layer_7_output_gpu1 [label="Layer 7 Output\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_7_residual2_gpu1 -> layer_7_output_gpu1
		layer_8_ln1_gpu1 [label="Layer 8 LayerNorm1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_8_q_proj_gpu1 [label="Layer 8 Q Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_k_proj_gpu1 [label="Layer 8 K Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_v_proj_gpu1 [label="Layer 8 V Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_attn_gpu1 [label="Layer 8 Scaled Dot-Product Attention\nGPU 1\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_attn_out_proj_gpu1 [label="Layer 8 Attention Output Projection\nGPU 1\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_residual1_gpu1 [label="Layer 8 Residual1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_8_ln2_gpu1 [label="Layer 8 LayerNorm2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_8_router_gpu1 [label="Layer 8 Router\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_8_gate_gpu1 [label="Layer 8 Gate Selection\nGPU 1\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_8_expert_0_gpu1 [label="Layer 8 Expert 0\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_1_gpu1 [label="Layer 8 Expert 1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_2_gpu1 [label="Layer 8 Expert 2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_3_gpu1 [label="Layer 8 Expert 3\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_agg_gpu1 [label="Layer 8 Expert Aggregation\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_8_moe_out_proj_gpu1 [label="Layer 8 MoE Output Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_residual2_gpu1 [label="Layer 8 Residual2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_7_output_gpu1 -> layer_8_ln1_gpu1
		layer_8_ln1_gpu1 -> layer_8_q_proj_gpu1
		layer_8_ln1_gpu1 -> layer_8_k_proj_gpu1
		layer_8_ln1_gpu1 -> layer_8_v_proj_gpu1
		layer_8_q_proj_gpu1 -> layer_8_attn_gpu1
		layer_8_k_proj_gpu1 -> layer_8_attn_gpu1
		layer_8_v_proj_gpu1 -> layer_8_attn_gpu1
		layer_8_attn_gpu1 -> layer_8_attn_out_proj_gpu1
		layer_8_attn_out_proj_gpu1 -> layer_8_residual1_gpu1
		layer_8_residual1_gpu1 -> layer_8_ln2_gpu1
		layer_8_ln2_gpu1 -> layer_8_router_gpu1
		layer_8_router_gpu1 -> layer_8_gate_gpu1
		layer_8_gate_gpu1 -> layer_8_expert_0_gpu1 [style=dashed]
		layer_8_gate_gpu1 -> layer_8_expert_1_gpu1 [style=dashed]
		layer_8_gate_gpu1 -> layer_8_expert_2_gpu1 [style=dashed]
		layer_8_gate_gpu1 -> layer_8_expert_3_gpu1 [style=dashed]
		layer_8_expert_0_gpu1 -> layer_8_expert_agg_gpu1
		layer_8_expert_1_gpu1 -> layer_8_expert_agg_gpu1
		layer_8_expert_2_gpu1 -> layer_8_expert_agg_gpu1
		layer_8_expert_3_gpu1 -> layer_8_expert_agg_gpu1
		layer_8_expert_agg_gpu1 -> layer_8_moe_out_proj_gpu1
		layer_8_moe_out_proj_gpu1 -> layer_8_residual2_gpu1
		layer_8_output_gpu1 [label="Layer 8 Output\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_8_residual2_gpu1 -> layer_8_output_gpu1
		layer_9_ln1_gpu1 [label="Layer 9 LayerNorm1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_9_q_proj_gpu1 [label="Layer 9 Q Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_k_proj_gpu1 [label="Layer 9 K Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_v_proj_gpu1 [label="Layer 9 V Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_attn_gpu1 [label="Layer 9 Scaled Dot-Product Attention\nGPU 1\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_attn_out_proj_gpu1 [label="Layer 9 Attention Output Projection\nGPU 1\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_residual1_gpu1 [label="Layer 9 Residual1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_9_ln2_gpu1 [label="Layer 9 LayerNorm2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_9_router_gpu1 [label="Layer 9 Router\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_9_gate_gpu1 [label="Layer 9 Gate Selection\nGPU 1\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_9_expert_0_gpu1 [label="Layer 9 Expert 0\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_1_gpu1 [label="Layer 9 Expert 1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_2_gpu1 [label="Layer 9 Expert 2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_3_gpu1 [label="Layer 9 Expert 3\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_agg_gpu1 [label="Layer 9 Expert Aggregation\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_9_moe_out_proj_gpu1 [label="Layer 9 MoE Output Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_residual2_gpu1 [label="Layer 9 Residual2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_8_output_gpu1 -> layer_9_ln1_gpu1
		layer_9_ln1_gpu1 -> layer_9_q_proj_gpu1
		layer_9_ln1_gpu1 -> layer_9_k_proj_gpu1
		layer_9_ln1_gpu1 -> layer_9_v_proj_gpu1
		layer_9_q_proj_gpu1 -> layer_9_attn_gpu1
		layer_9_k_proj_gpu1 -> layer_9_attn_gpu1
		layer_9_v_proj_gpu1 -> layer_9_attn_gpu1
		layer_9_attn_gpu1 -> layer_9_attn_out_proj_gpu1
		layer_9_attn_out_proj_gpu1 -> layer_9_residual1_gpu1
		layer_9_residual1_gpu1 -> layer_9_ln2_gpu1
		layer_9_ln2_gpu1 -> layer_9_router_gpu1
		layer_9_router_gpu1 -> layer_9_gate_gpu1
		layer_9_gate_gpu1 -> layer_9_expert_0_gpu1 [style=dashed]
		layer_9_gate_gpu1 -> layer_9_expert_1_gpu1 [style=dashed]
		layer_9_gate_gpu1 -> layer_9_expert_2_gpu1 [style=dashed]
		layer_9_gate_gpu1 -> layer_9_expert_3_gpu1 [style=dashed]
		layer_9_expert_0_gpu1 -> layer_9_expert_agg_gpu1
		layer_9_expert_1_gpu1 -> layer_9_expert_agg_gpu1
		layer_9_expert_2_gpu1 -> layer_9_expert_agg_gpu1
		layer_9_expert_3_gpu1 -> layer_9_expert_agg_gpu1
		layer_9_expert_agg_gpu1 -> layer_9_moe_out_proj_gpu1
		layer_9_moe_out_proj_gpu1 -> layer_9_residual2_gpu1
		layer_9_output_gpu1 [label="Layer 9 Output\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_9_residual2_gpu1 -> layer_9_output_gpu1
		layer_10_ln1_gpu1 [label="Layer 10 LayerNorm1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_10_q_proj_gpu1 [label="Layer 10 Q Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_k_proj_gpu1 [label="Layer 10 K Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_v_proj_gpu1 [label="Layer 10 V Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_attn_gpu1 [label="Layer 10 Scaled Dot-Product Attention\nGPU 1\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_attn_out_proj_gpu1 [label="Layer 10 Attention Output Projection\nGPU 1\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_residual1_gpu1 [label="Layer 10 Residual1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_10_ln2_gpu1 [label="Layer 10 LayerNorm2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_10_router_gpu1 [label="Layer 10 Router\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_10_gate_gpu1 [label="Layer 10 Gate Selection\nGPU 1\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_10_expert_0_gpu1 [label="Layer 10 Expert 0\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_1_gpu1 [label="Layer 10 Expert 1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_2_gpu1 [label="Layer 10 Expert 2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_3_gpu1 [label="Layer 10 Expert 3\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_agg_gpu1 [label="Layer 10 Expert Aggregation\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_10_moe_out_proj_gpu1 [label="Layer 10 MoE Output Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_residual2_gpu1 [label="Layer 10 Residual2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_9_output_gpu1 -> layer_10_ln1_gpu1
		layer_10_ln1_gpu1 -> layer_10_q_proj_gpu1
		layer_10_ln1_gpu1 -> layer_10_k_proj_gpu1
		layer_10_ln1_gpu1 -> layer_10_v_proj_gpu1
		layer_10_q_proj_gpu1 -> layer_10_attn_gpu1
		layer_10_k_proj_gpu1 -> layer_10_attn_gpu1
		layer_10_v_proj_gpu1 -> layer_10_attn_gpu1
		layer_10_attn_gpu1 -> layer_10_attn_out_proj_gpu1
		layer_10_attn_out_proj_gpu1 -> layer_10_residual1_gpu1
		layer_10_residual1_gpu1 -> layer_10_ln2_gpu1
		layer_10_ln2_gpu1 -> layer_10_router_gpu1
		layer_10_router_gpu1 -> layer_10_gate_gpu1
		layer_10_gate_gpu1 -> layer_10_expert_0_gpu1 [style=dashed]
		layer_10_gate_gpu1 -> layer_10_expert_1_gpu1 [style=dashed]
		layer_10_gate_gpu1 -> layer_10_expert_2_gpu1 [style=dashed]
		layer_10_gate_gpu1 -> layer_10_expert_3_gpu1 [style=dashed]
		layer_10_expert_0_gpu1 -> layer_10_expert_agg_gpu1
		layer_10_expert_1_gpu1 -> layer_10_expert_agg_gpu1
		layer_10_expert_2_gpu1 -> layer_10_expert_agg_gpu1
		layer_10_expert_3_gpu1 -> layer_10_expert_agg_gpu1
		layer_10_expert_agg_gpu1 -> layer_10_moe_out_proj_gpu1
		layer_10_moe_out_proj_gpu1 -> layer_10_residual2_gpu1
		layer_10_output_gpu1 [label="Layer 10 Output\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_10_residual2_gpu1 -> layer_10_output_gpu1
		layer_11_ln1_gpu1 [label="Layer 11 LayerNorm1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_11_q_proj_gpu1 [label="Layer 11 Q Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_k_proj_gpu1 [label="Layer 11 K Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_v_proj_gpu1 [label="Layer 11 V Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_attn_gpu1 [label="Layer 11 Scaled Dot-Product Attention\nGPU 1\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_attn_out_proj_gpu1 [label="Layer 11 Attention Output Projection\nGPU 1\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_residual1_gpu1 [label="Layer 11 Residual1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_11_ln2_gpu1 [label="Layer 11 LayerNorm2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_11_router_gpu1 [label="Layer 11 Router\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_11_gate_gpu1 [label="Layer 11 Gate Selection\nGPU 1\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_11_expert_0_gpu1 [label="Layer 11 Expert 0\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_1_gpu1 [label="Layer 11 Expert 1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_2_gpu1 [label="Layer 11 Expert 2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_3_gpu1 [label="Layer 11 Expert 3\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_agg_gpu1 [label="Layer 11 Expert Aggregation\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_11_moe_out_proj_gpu1 [label="Layer 11 MoE Output Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_residual2_gpu1 [label="Layer 11 Residual2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_10_output_gpu1 -> layer_11_ln1_gpu1
		layer_11_ln1_gpu1 -> layer_11_q_proj_gpu1
		layer_11_ln1_gpu1 -> layer_11_k_proj_gpu1
		layer_11_ln1_gpu1 -> layer_11_v_proj_gpu1
		layer_11_q_proj_gpu1 -> layer_11_attn_gpu1
		layer_11_k_proj_gpu1 -> layer_11_attn_gpu1
		layer_11_v_proj_gpu1 -> layer_11_attn_gpu1
		layer_11_attn_gpu1 -> layer_11_attn_out_proj_gpu1
		layer_11_attn_out_proj_gpu1 -> layer_11_residual1_gpu1
		layer_11_residual1_gpu1 -> layer_11_ln2_gpu1
		layer_11_ln2_gpu1 -> layer_11_router_gpu1
		layer_11_router_gpu1 -> layer_11_gate_gpu1
		layer_11_gate_gpu1 -> layer_11_expert_0_gpu1 [style=dashed]
		layer_11_gate_gpu1 -> layer_11_expert_1_gpu1 [style=dashed]
		layer_11_gate_gpu1 -> layer_11_expert_2_gpu1 [style=dashed]
		layer_11_gate_gpu1 -> layer_11_expert_3_gpu1 [style=dashed]
		layer_11_expert_0_gpu1 -> layer_11_expert_agg_gpu1
		layer_11_expert_1_gpu1 -> layer_11_expert_agg_gpu1
		layer_11_expert_2_gpu1 -> layer_11_expert_agg_gpu1
		layer_11_expert_3_gpu1 -> layer_11_expert_agg_gpu1
		layer_11_expert_agg_gpu1 -> layer_11_moe_out_proj_gpu1
		layer_11_moe_out_proj_gpu1 -> layer_11_residual2_gpu1
		layer_11_output_gpu1 [label="Layer 11 Output\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_11_residual2_gpu1 -> layer_11_output_gpu1
		layer_12_ln1_gpu1 [label="Layer 12 LayerNorm1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_12_q_proj_gpu1 [label="Layer 12 Q Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_k_proj_gpu1 [label="Layer 12 K Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_v_proj_gpu1 [label="Layer 12 V Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_attn_gpu1 [label="Layer 12 Scaled Dot-Product Attention\nGPU 1\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_attn_out_proj_gpu1 [label="Layer 12 Attention Output Projection\nGPU 1\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_residual1_gpu1 [label="Layer 12 Residual1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_12_ln2_gpu1 [label="Layer 12 LayerNorm2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_12_router_gpu1 [label="Layer 12 Router\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_12_gate_gpu1 [label="Layer 12 Gate Selection\nGPU 1\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_12_expert_0_gpu1 [label="Layer 12 Expert 0\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_1_gpu1 [label="Layer 12 Expert 1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_2_gpu1 [label="Layer 12 Expert 2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_3_gpu1 [label="Layer 12 Expert 3\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_agg_gpu1 [label="Layer 12 Expert Aggregation\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_12_moe_out_proj_gpu1 [label="Layer 12 MoE Output Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_residual2_gpu1 [label="Layer 12 Residual2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_11_output_gpu1 -> layer_12_ln1_gpu1
		layer_12_ln1_gpu1 -> layer_12_q_proj_gpu1
		layer_12_ln1_gpu1 -> layer_12_k_proj_gpu1
		layer_12_ln1_gpu1 -> layer_12_v_proj_gpu1
		layer_12_q_proj_gpu1 -> layer_12_attn_gpu1
		layer_12_k_proj_gpu1 -> layer_12_attn_gpu1
		layer_12_v_proj_gpu1 -> layer_12_attn_gpu1
		layer_12_attn_gpu1 -> layer_12_attn_out_proj_gpu1
		layer_12_attn_out_proj_gpu1 -> layer_12_residual1_gpu1
		layer_12_residual1_gpu1 -> layer_12_ln2_gpu1
		layer_12_ln2_gpu1 -> layer_12_router_gpu1
		layer_12_router_gpu1 -> layer_12_gate_gpu1
		layer_12_gate_gpu1 -> layer_12_expert_0_gpu1 [style=dashed]
		layer_12_gate_gpu1 -> layer_12_expert_1_gpu1 [style=dashed]
		layer_12_gate_gpu1 -> layer_12_expert_2_gpu1 [style=dashed]
		layer_12_gate_gpu1 -> layer_12_expert_3_gpu1 [style=dashed]
		layer_12_expert_0_gpu1 -> layer_12_expert_agg_gpu1
		layer_12_expert_1_gpu1 -> layer_12_expert_agg_gpu1
		layer_12_expert_2_gpu1 -> layer_12_expert_agg_gpu1
		layer_12_expert_3_gpu1 -> layer_12_expert_agg_gpu1
		layer_12_expert_agg_gpu1 -> layer_12_moe_out_proj_gpu1
		layer_12_moe_out_proj_gpu1 -> layer_12_residual2_gpu1
		layer_12_output_gpu1 [label="Layer 12 Output\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_12_residual2_gpu1 -> layer_12_output_gpu1
		layer_13_ln1_gpu1 [label="Layer 13 LayerNorm1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_13_q_proj_gpu1 [label="Layer 13 Q Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_k_proj_gpu1 [label="Layer 13 K Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_v_proj_gpu1 [label="Layer 13 V Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_attn_gpu1 [label="Layer 13 Scaled Dot-Product Attention\nGPU 1\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_attn_out_proj_gpu1 [label="Layer 13 Attention Output Projection\nGPU 1\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_residual1_gpu1 [label="Layer 13 Residual1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_13_ln2_gpu1 [label="Layer 13 LayerNorm2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_13_router_gpu1 [label="Layer 13 Router\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_13_gate_gpu1 [label="Layer 13 Gate Selection\nGPU 1\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_13_expert_0_gpu1 [label="Layer 13 Expert 0\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_1_gpu1 [label="Layer 13 Expert 1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_2_gpu1 [label="Layer 13 Expert 2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_3_gpu1 [label="Layer 13 Expert 3\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_agg_gpu1 [label="Layer 13 Expert Aggregation\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_13_moe_out_proj_gpu1 [label="Layer 13 MoE Output Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_residual2_gpu1 [label="Layer 13 Residual2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_12_output_gpu1 -> layer_13_ln1_gpu1
		layer_13_ln1_gpu1 -> layer_13_q_proj_gpu1
		layer_13_ln1_gpu1 -> layer_13_k_proj_gpu1
		layer_13_ln1_gpu1 -> layer_13_v_proj_gpu1
		layer_13_q_proj_gpu1 -> layer_13_attn_gpu1
		layer_13_k_proj_gpu1 -> layer_13_attn_gpu1
		layer_13_v_proj_gpu1 -> layer_13_attn_gpu1
		layer_13_attn_gpu1 -> layer_13_attn_out_proj_gpu1
		layer_13_attn_out_proj_gpu1 -> layer_13_residual1_gpu1
		layer_13_residual1_gpu1 -> layer_13_ln2_gpu1
		layer_13_ln2_gpu1 -> layer_13_router_gpu1
		layer_13_router_gpu1 -> layer_13_gate_gpu1
		layer_13_gate_gpu1 -> layer_13_expert_0_gpu1 [style=dashed]
		layer_13_gate_gpu1 -> layer_13_expert_1_gpu1 [style=dashed]
		layer_13_gate_gpu1 -> layer_13_expert_2_gpu1 [style=dashed]
		layer_13_gate_gpu1 -> layer_13_expert_3_gpu1 [style=dashed]
		layer_13_expert_0_gpu1 -> layer_13_expert_agg_gpu1
		layer_13_expert_1_gpu1 -> layer_13_expert_agg_gpu1
		layer_13_expert_2_gpu1 -> layer_13_expert_agg_gpu1
		layer_13_expert_3_gpu1 -> layer_13_expert_agg_gpu1
		layer_13_expert_agg_gpu1 -> layer_13_moe_out_proj_gpu1
		layer_13_moe_out_proj_gpu1 -> layer_13_residual2_gpu1
		layer_13_output_gpu1 [label="Layer 13 Output\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_13_residual2_gpu1 -> layer_13_output_gpu1
		layer_14_ln1_gpu1 [label="Layer 14 LayerNorm1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_14_q_proj_gpu1 [label="Layer 14 Q Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_k_proj_gpu1 [label="Layer 14 K Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_v_proj_gpu1 [label="Layer 14 V Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_attn_gpu1 [label="Layer 14 Scaled Dot-Product Attention\nGPU 1\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_attn_out_proj_gpu1 [label="Layer 14 Attention Output Projection\nGPU 1\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_residual1_gpu1 [label="Layer 14 Residual1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_14_ln2_gpu1 [label="Layer 14 LayerNorm2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_14_router_gpu1 [label="Layer 14 Router\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_14_gate_gpu1 [label="Layer 14 Gate Selection\nGPU 1\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_14_expert_0_gpu1 [label="Layer 14 Expert 0\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_1_gpu1 [label="Layer 14 Expert 1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_2_gpu1 [label="Layer 14 Expert 2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_3_gpu1 [label="Layer 14 Expert 3\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_agg_gpu1 [label="Layer 14 Expert Aggregation\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_14_moe_out_proj_gpu1 [label="Layer 14 MoE Output Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_residual2_gpu1 [label="Layer 14 Residual2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_13_output_gpu1 -> layer_14_ln1_gpu1
		layer_14_ln1_gpu1 -> layer_14_q_proj_gpu1
		layer_14_ln1_gpu1 -> layer_14_k_proj_gpu1
		layer_14_ln1_gpu1 -> layer_14_v_proj_gpu1
		layer_14_q_proj_gpu1 -> layer_14_attn_gpu1
		layer_14_k_proj_gpu1 -> layer_14_attn_gpu1
		layer_14_v_proj_gpu1 -> layer_14_attn_gpu1
		layer_14_attn_gpu1 -> layer_14_attn_out_proj_gpu1
		layer_14_attn_out_proj_gpu1 -> layer_14_residual1_gpu1
		layer_14_residual1_gpu1 -> layer_14_ln2_gpu1
		layer_14_ln2_gpu1 -> layer_14_router_gpu1
		layer_14_router_gpu1 -> layer_14_gate_gpu1
		layer_14_gate_gpu1 -> layer_14_expert_0_gpu1 [style=dashed]
		layer_14_gate_gpu1 -> layer_14_expert_1_gpu1 [style=dashed]
		layer_14_gate_gpu1 -> layer_14_expert_2_gpu1 [style=dashed]
		layer_14_gate_gpu1 -> layer_14_expert_3_gpu1 [style=dashed]
		layer_14_expert_0_gpu1 -> layer_14_expert_agg_gpu1
		layer_14_expert_1_gpu1 -> layer_14_expert_agg_gpu1
		layer_14_expert_2_gpu1 -> layer_14_expert_agg_gpu1
		layer_14_expert_3_gpu1 -> layer_14_expert_agg_gpu1
		layer_14_expert_agg_gpu1 -> layer_14_moe_out_proj_gpu1
		layer_14_moe_out_proj_gpu1 -> layer_14_residual2_gpu1
		layer_14_output_gpu1 [label="Layer 14 Output\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_14_residual2_gpu1 -> layer_14_output_gpu1
		layer_15_ln1_gpu1 [label="Layer 15 LayerNorm1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_15_q_proj_gpu1 [label="Layer 15 Q Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_k_proj_gpu1 [label="Layer 15 K Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_v_proj_gpu1 [label="Layer 15 V Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_attn_gpu1 [label="Layer 15 Scaled Dot-Product Attention\nGPU 1\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_attn_out_proj_gpu1 [label="Layer 15 Attention Output Projection\nGPU 1\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_residual1_gpu1 [label="Layer 15 Residual1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_15_ln2_gpu1 [label="Layer 15 LayerNorm2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_15_router_gpu1 [label="Layer 15 Router\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_15_gate_gpu1 [label="Layer 15 Gate Selection\nGPU 1\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_15_expert_0_gpu1 [label="Layer 15 Expert 0\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_1_gpu1 [label="Layer 15 Expert 1\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_2_gpu1 [label="Layer 15 Expert 2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_3_gpu1 [label="Layer 15 Expert 3\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_agg_gpu1 [label="Layer 15 Expert Aggregation\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_15_moe_out_proj_gpu1 [label="Layer 15 MoE Output Projection\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_residual2_gpu1 [label="Layer 15 Residual2\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_14_output_gpu1 -> layer_15_ln1_gpu1
		layer_15_ln1_gpu1 -> layer_15_q_proj_gpu1
		layer_15_ln1_gpu1 -> layer_15_k_proj_gpu1
		layer_15_ln1_gpu1 -> layer_15_v_proj_gpu1
		layer_15_q_proj_gpu1 -> layer_15_attn_gpu1
		layer_15_k_proj_gpu1 -> layer_15_attn_gpu1
		layer_15_v_proj_gpu1 -> layer_15_attn_gpu1
		layer_15_attn_gpu1 -> layer_15_attn_out_proj_gpu1
		layer_15_attn_out_proj_gpu1 -> layer_15_residual1_gpu1
		layer_15_residual1_gpu1 -> layer_15_ln2_gpu1
		layer_15_ln2_gpu1 -> layer_15_router_gpu1
		layer_15_router_gpu1 -> layer_15_gate_gpu1
		layer_15_gate_gpu1 -> layer_15_expert_0_gpu1 [style=dashed]
		layer_15_gate_gpu1 -> layer_15_expert_1_gpu1 [style=dashed]
		layer_15_gate_gpu1 -> layer_15_expert_2_gpu1 [style=dashed]
		layer_15_gate_gpu1 -> layer_15_expert_3_gpu1 [style=dashed]
		layer_15_expert_0_gpu1 -> layer_15_expert_agg_gpu1
		layer_15_expert_1_gpu1 -> layer_15_expert_agg_gpu1
		layer_15_expert_2_gpu1 -> layer_15_expert_agg_gpu1
		layer_15_expert_3_gpu1 -> layer_15_expert_agg_gpu1
		layer_15_expert_agg_gpu1 -> layer_15_moe_out_proj_gpu1
		layer_15_moe_out_proj_gpu1 -> layer_15_residual2_gpu1
		layer_15_output_gpu1 [label="Layer 15 Output\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_15_residual2_gpu1 -> layer_15_output_gpu1
		final_ln_gpu1 [label="Final Layer Norm\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		layer_15_output_gpu1 -> final_ln_gpu1
		lm_head_gpu1 [label="LM Head\nGPU 1\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, vocab_size]" fillcolor=lightcoral shape=rectangle style=filled]
		output_gpu1 [label="Output\nGPU 1\nInput: [batch=256, seq=512, vocab_size]\nOutput: [batch=256, seq=512, vocab_size]" fillcolor=lightgreen shape=ellipse style=filled]
		input_gpu1 -> embed_gpu1
		embed_gpu1 -> pos_enc_gpu1
		final_ln_gpu1 -> lm_head_gpu1
		lm_head_gpu1 -> output_gpu1
	}
	subgraph cluster_gpu_2 {
		color=blue fillcolor=lightblue label="GPU 2" style=rounded
		input_gpu2 [label="Input\nGPU 2\nInput: [batch=256, seq=512, dim=1024]\nOutput: [batch=256, seq=512, dim=1024]" fillcolor=lightgreen shape=ellipse style=filled]
		embed_gpu2 [label="Token Embedding\nGPU 2\nInput: [batch=256, seq=512]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		pos_enc_gpu2 [label="Position Encoding\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		layer_0_ln1_gpu2 [label="Layer 0 LayerNorm1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_0_q_proj_gpu2 [label="Layer 0 Q Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_k_proj_gpu2 [label="Layer 0 K Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_v_proj_gpu2 [label="Layer 0 V Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_attn_gpu2 [label="Layer 0 Scaled Dot-Product Attention\nGPU 2\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_attn_out_proj_gpu2 [label="Layer 0 Attention Output Projection\nGPU 2\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_residual1_gpu2 [label="Layer 0 Residual1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_0_ln2_gpu2 [label="Layer 0 LayerNorm2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_0_router_gpu2 [label="Layer 0 Router\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_0_gate_gpu2 [label="Layer 0 Gate Selection\nGPU 2\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_0_expert_0_gpu2 [label="Layer 0 Expert 0\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_1_gpu2 [label="Layer 0 Expert 1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_2_gpu2 [label="Layer 0 Expert 2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_3_gpu2 [label="Layer 0 Expert 3\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_agg_gpu2 [label="Layer 0 Expert Aggregation\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_0_moe_out_proj_gpu2 [label="Layer 0 MoE Output Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_residual2_gpu2 [label="Layer 0 Residual2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		pos_enc_gpu2 -> layer_0_ln1_gpu2
		layer_0_ln1_gpu2 -> layer_0_q_proj_gpu2
		layer_0_ln1_gpu2 -> layer_0_k_proj_gpu2
		layer_0_ln1_gpu2 -> layer_0_v_proj_gpu2
		layer_0_q_proj_gpu2 -> layer_0_attn_gpu2
		layer_0_k_proj_gpu2 -> layer_0_attn_gpu2
		layer_0_v_proj_gpu2 -> layer_0_attn_gpu2
		layer_0_attn_gpu2 -> layer_0_attn_out_proj_gpu2
		layer_0_attn_out_proj_gpu2 -> layer_0_residual1_gpu2
		layer_0_residual1_gpu2 -> layer_0_ln2_gpu2
		layer_0_ln2_gpu2 -> layer_0_router_gpu2
		layer_0_router_gpu2 -> layer_0_gate_gpu2
		layer_0_gate_gpu2 -> layer_0_expert_0_gpu2 [style=dashed]
		layer_0_gate_gpu2 -> layer_0_expert_1_gpu2 [style=dashed]
		layer_0_gate_gpu2 -> layer_0_expert_2_gpu2 [style=dashed]
		layer_0_gate_gpu2 -> layer_0_expert_3_gpu2 [style=dashed]
		layer_0_expert_0_gpu2 -> layer_0_expert_agg_gpu2
		layer_0_expert_1_gpu2 -> layer_0_expert_agg_gpu2
		layer_0_expert_2_gpu2 -> layer_0_expert_agg_gpu2
		layer_0_expert_3_gpu2 -> layer_0_expert_agg_gpu2
		layer_0_expert_agg_gpu2 -> layer_0_moe_out_proj_gpu2
		layer_0_moe_out_proj_gpu2 -> layer_0_residual2_gpu2
		layer_0_output_gpu2 [label="Layer 0 Output\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_0_residual2_gpu2 -> layer_0_output_gpu2
		layer_1_ln1_gpu2 [label="Layer 1 LayerNorm1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_1_q_proj_gpu2 [label="Layer 1 Q Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_k_proj_gpu2 [label="Layer 1 K Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_v_proj_gpu2 [label="Layer 1 V Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_attn_gpu2 [label="Layer 1 Scaled Dot-Product Attention\nGPU 2\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_attn_out_proj_gpu2 [label="Layer 1 Attention Output Projection\nGPU 2\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_residual1_gpu2 [label="Layer 1 Residual1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_1_ln2_gpu2 [label="Layer 1 LayerNorm2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_1_router_gpu2 [label="Layer 1 Router\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_1_gate_gpu2 [label="Layer 1 Gate Selection\nGPU 2\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_1_expert_0_gpu2 [label="Layer 1 Expert 0\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_1_gpu2 [label="Layer 1 Expert 1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_2_gpu2 [label="Layer 1 Expert 2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_3_gpu2 [label="Layer 1 Expert 3\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_agg_gpu2 [label="Layer 1 Expert Aggregation\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_1_moe_out_proj_gpu2 [label="Layer 1 MoE Output Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_residual2_gpu2 [label="Layer 1 Residual2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_0_output_gpu2 -> layer_1_ln1_gpu2
		layer_1_ln1_gpu2 -> layer_1_q_proj_gpu2
		layer_1_ln1_gpu2 -> layer_1_k_proj_gpu2
		layer_1_ln1_gpu2 -> layer_1_v_proj_gpu2
		layer_1_q_proj_gpu2 -> layer_1_attn_gpu2
		layer_1_k_proj_gpu2 -> layer_1_attn_gpu2
		layer_1_v_proj_gpu2 -> layer_1_attn_gpu2
		layer_1_attn_gpu2 -> layer_1_attn_out_proj_gpu2
		layer_1_attn_out_proj_gpu2 -> layer_1_residual1_gpu2
		layer_1_residual1_gpu2 -> layer_1_ln2_gpu2
		layer_1_ln2_gpu2 -> layer_1_router_gpu2
		layer_1_router_gpu2 -> layer_1_gate_gpu2
		layer_1_gate_gpu2 -> layer_1_expert_0_gpu2 [style=dashed]
		layer_1_gate_gpu2 -> layer_1_expert_1_gpu2 [style=dashed]
		layer_1_gate_gpu2 -> layer_1_expert_2_gpu2 [style=dashed]
		layer_1_gate_gpu2 -> layer_1_expert_3_gpu2 [style=dashed]
		layer_1_expert_0_gpu2 -> layer_1_expert_agg_gpu2
		layer_1_expert_1_gpu2 -> layer_1_expert_agg_gpu2
		layer_1_expert_2_gpu2 -> layer_1_expert_agg_gpu2
		layer_1_expert_3_gpu2 -> layer_1_expert_agg_gpu2
		layer_1_expert_agg_gpu2 -> layer_1_moe_out_proj_gpu2
		layer_1_moe_out_proj_gpu2 -> layer_1_residual2_gpu2
		layer_1_output_gpu2 [label="Layer 1 Output\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_1_residual2_gpu2 -> layer_1_output_gpu2
		layer_2_ln1_gpu2 [label="Layer 2 LayerNorm1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_2_q_proj_gpu2 [label="Layer 2 Q Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_k_proj_gpu2 [label="Layer 2 K Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_v_proj_gpu2 [label="Layer 2 V Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_attn_gpu2 [label="Layer 2 Scaled Dot-Product Attention\nGPU 2\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_attn_out_proj_gpu2 [label="Layer 2 Attention Output Projection\nGPU 2\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_residual1_gpu2 [label="Layer 2 Residual1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_2_ln2_gpu2 [label="Layer 2 LayerNorm2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_2_router_gpu2 [label="Layer 2 Router\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_2_gate_gpu2 [label="Layer 2 Gate Selection\nGPU 2\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_2_expert_0_gpu2 [label="Layer 2 Expert 0\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_1_gpu2 [label="Layer 2 Expert 1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_2_gpu2 [label="Layer 2 Expert 2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_3_gpu2 [label="Layer 2 Expert 3\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_agg_gpu2 [label="Layer 2 Expert Aggregation\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_2_moe_out_proj_gpu2 [label="Layer 2 MoE Output Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_residual2_gpu2 [label="Layer 2 Residual2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_1_output_gpu2 -> layer_2_ln1_gpu2
		layer_2_ln1_gpu2 -> layer_2_q_proj_gpu2
		layer_2_ln1_gpu2 -> layer_2_k_proj_gpu2
		layer_2_ln1_gpu2 -> layer_2_v_proj_gpu2
		layer_2_q_proj_gpu2 -> layer_2_attn_gpu2
		layer_2_k_proj_gpu2 -> layer_2_attn_gpu2
		layer_2_v_proj_gpu2 -> layer_2_attn_gpu2
		layer_2_attn_gpu2 -> layer_2_attn_out_proj_gpu2
		layer_2_attn_out_proj_gpu2 -> layer_2_residual1_gpu2
		layer_2_residual1_gpu2 -> layer_2_ln2_gpu2
		layer_2_ln2_gpu2 -> layer_2_router_gpu2
		layer_2_router_gpu2 -> layer_2_gate_gpu2
		layer_2_gate_gpu2 -> layer_2_expert_0_gpu2 [style=dashed]
		layer_2_gate_gpu2 -> layer_2_expert_1_gpu2 [style=dashed]
		layer_2_gate_gpu2 -> layer_2_expert_2_gpu2 [style=dashed]
		layer_2_gate_gpu2 -> layer_2_expert_3_gpu2 [style=dashed]
		layer_2_expert_0_gpu2 -> layer_2_expert_agg_gpu2
		layer_2_expert_1_gpu2 -> layer_2_expert_agg_gpu2
		layer_2_expert_2_gpu2 -> layer_2_expert_agg_gpu2
		layer_2_expert_3_gpu2 -> layer_2_expert_agg_gpu2
		layer_2_expert_agg_gpu2 -> layer_2_moe_out_proj_gpu2
		layer_2_moe_out_proj_gpu2 -> layer_2_residual2_gpu2
		layer_2_output_gpu2 [label="Layer 2 Output\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_2_residual2_gpu2 -> layer_2_output_gpu2
		layer_3_ln1_gpu2 [label="Layer 3 LayerNorm1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_3_q_proj_gpu2 [label="Layer 3 Q Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_k_proj_gpu2 [label="Layer 3 K Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_v_proj_gpu2 [label="Layer 3 V Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_attn_gpu2 [label="Layer 3 Scaled Dot-Product Attention\nGPU 2\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_attn_out_proj_gpu2 [label="Layer 3 Attention Output Projection\nGPU 2\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_residual1_gpu2 [label="Layer 3 Residual1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_3_ln2_gpu2 [label="Layer 3 LayerNorm2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_3_router_gpu2 [label="Layer 3 Router\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_3_gate_gpu2 [label="Layer 3 Gate Selection\nGPU 2\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_3_expert_0_gpu2 [label="Layer 3 Expert 0\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_1_gpu2 [label="Layer 3 Expert 1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_2_gpu2 [label="Layer 3 Expert 2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_3_gpu2 [label="Layer 3 Expert 3\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_agg_gpu2 [label="Layer 3 Expert Aggregation\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_3_moe_out_proj_gpu2 [label="Layer 3 MoE Output Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_residual2_gpu2 [label="Layer 3 Residual2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_2_output_gpu2 -> layer_3_ln1_gpu2
		layer_3_ln1_gpu2 -> layer_3_q_proj_gpu2
		layer_3_ln1_gpu2 -> layer_3_k_proj_gpu2
		layer_3_ln1_gpu2 -> layer_3_v_proj_gpu2
		layer_3_q_proj_gpu2 -> layer_3_attn_gpu2
		layer_3_k_proj_gpu2 -> layer_3_attn_gpu2
		layer_3_v_proj_gpu2 -> layer_3_attn_gpu2
		layer_3_attn_gpu2 -> layer_3_attn_out_proj_gpu2
		layer_3_attn_out_proj_gpu2 -> layer_3_residual1_gpu2
		layer_3_residual1_gpu2 -> layer_3_ln2_gpu2
		layer_3_ln2_gpu2 -> layer_3_router_gpu2
		layer_3_router_gpu2 -> layer_3_gate_gpu2
		layer_3_gate_gpu2 -> layer_3_expert_0_gpu2 [style=dashed]
		layer_3_gate_gpu2 -> layer_3_expert_1_gpu2 [style=dashed]
		layer_3_gate_gpu2 -> layer_3_expert_2_gpu2 [style=dashed]
		layer_3_gate_gpu2 -> layer_3_expert_3_gpu2 [style=dashed]
		layer_3_expert_0_gpu2 -> layer_3_expert_agg_gpu2
		layer_3_expert_1_gpu2 -> layer_3_expert_agg_gpu2
		layer_3_expert_2_gpu2 -> layer_3_expert_agg_gpu2
		layer_3_expert_3_gpu2 -> layer_3_expert_agg_gpu2
		layer_3_expert_agg_gpu2 -> layer_3_moe_out_proj_gpu2
		layer_3_moe_out_proj_gpu2 -> layer_3_residual2_gpu2
		layer_3_output_gpu2 [label="Layer 3 Output\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_3_residual2_gpu2 -> layer_3_output_gpu2
		layer_4_ln1_gpu2 [label="Layer 4 LayerNorm1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_4_q_proj_gpu2 [label="Layer 4 Q Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_k_proj_gpu2 [label="Layer 4 K Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_v_proj_gpu2 [label="Layer 4 V Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_attn_gpu2 [label="Layer 4 Scaled Dot-Product Attention\nGPU 2\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_attn_out_proj_gpu2 [label="Layer 4 Attention Output Projection\nGPU 2\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_residual1_gpu2 [label="Layer 4 Residual1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_4_ln2_gpu2 [label="Layer 4 LayerNorm2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_4_router_gpu2 [label="Layer 4 Router\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_4_gate_gpu2 [label="Layer 4 Gate Selection\nGPU 2\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_4_expert_0_gpu2 [label="Layer 4 Expert 0\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_1_gpu2 [label="Layer 4 Expert 1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_2_gpu2 [label="Layer 4 Expert 2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_3_gpu2 [label="Layer 4 Expert 3\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_agg_gpu2 [label="Layer 4 Expert Aggregation\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_4_moe_out_proj_gpu2 [label="Layer 4 MoE Output Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_residual2_gpu2 [label="Layer 4 Residual2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_3_output_gpu2 -> layer_4_ln1_gpu2
		layer_4_ln1_gpu2 -> layer_4_q_proj_gpu2
		layer_4_ln1_gpu2 -> layer_4_k_proj_gpu2
		layer_4_ln1_gpu2 -> layer_4_v_proj_gpu2
		layer_4_q_proj_gpu2 -> layer_4_attn_gpu2
		layer_4_k_proj_gpu2 -> layer_4_attn_gpu2
		layer_4_v_proj_gpu2 -> layer_4_attn_gpu2
		layer_4_attn_gpu2 -> layer_4_attn_out_proj_gpu2
		layer_4_attn_out_proj_gpu2 -> layer_4_residual1_gpu2
		layer_4_residual1_gpu2 -> layer_4_ln2_gpu2
		layer_4_ln2_gpu2 -> layer_4_router_gpu2
		layer_4_router_gpu2 -> layer_4_gate_gpu2
		layer_4_gate_gpu2 -> layer_4_expert_0_gpu2 [style=dashed]
		layer_4_gate_gpu2 -> layer_4_expert_1_gpu2 [style=dashed]
		layer_4_gate_gpu2 -> layer_4_expert_2_gpu2 [style=dashed]
		layer_4_gate_gpu2 -> layer_4_expert_3_gpu2 [style=dashed]
		layer_4_expert_0_gpu2 -> layer_4_expert_agg_gpu2
		layer_4_expert_1_gpu2 -> layer_4_expert_agg_gpu2
		layer_4_expert_2_gpu2 -> layer_4_expert_agg_gpu2
		layer_4_expert_3_gpu2 -> layer_4_expert_agg_gpu2
		layer_4_expert_agg_gpu2 -> layer_4_moe_out_proj_gpu2
		layer_4_moe_out_proj_gpu2 -> layer_4_residual2_gpu2
		layer_4_output_gpu2 [label="Layer 4 Output\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_4_residual2_gpu2 -> layer_4_output_gpu2
		layer_5_ln1_gpu2 [label="Layer 5 LayerNorm1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_5_q_proj_gpu2 [label="Layer 5 Q Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_k_proj_gpu2 [label="Layer 5 K Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_v_proj_gpu2 [label="Layer 5 V Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_attn_gpu2 [label="Layer 5 Scaled Dot-Product Attention\nGPU 2\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_attn_out_proj_gpu2 [label="Layer 5 Attention Output Projection\nGPU 2\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_residual1_gpu2 [label="Layer 5 Residual1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_5_ln2_gpu2 [label="Layer 5 LayerNorm2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_5_router_gpu2 [label="Layer 5 Router\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_5_gate_gpu2 [label="Layer 5 Gate Selection\nGPU 2\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_5_expert_0_gpu2 [label="Layer 5 Expert 0\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_1_gpu2 [label="Layer 5 Expert 1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_2_gpu2 [label="Layer 5 Expert 2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_3_gpu2 [label="Layer 5 Expert 3\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_agg_gpu2 [label="Layer 5 Expert Aggregation\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_5_moe_out_proj_gpu2 [label="Layer 5 MoE Output Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_residual2_gpu2 [label="Layer 5 Residual2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_4_output_gpu2 -> layer_5_ln1_gpu2
		layer_5_ln1_gpu2 -> layer_5_q_proj_gpu2
		layer_5_ln1_gpu2 -> layer_5_k_proj_gpu2
		layer_5_ln1_gpu2 -> layer_5_v_proj_gpu2
		layer_5_q_proj_gpu2 -> layer_5_attn_gpu2
		layer_5_k_proj_gpu2 -> layer_5_attn_gpu2
		layer_5_v_proj_gpu2 -> layer_5_attn_gpu2
		layer_5_attn_gpu2 -> layer_5_attn_out_proj_gpu2
		layer_5_attn_out_proj_gpu2 -> layer_5_residual1_gpu2
		layer_5_residual1_gpu2 -> layer_5_ln2_gpu2
		layer_5_ln2_gpu2 -> layer_5_router_gpu2
		layer_5_router_gpu2 -> layer_5_gate_gpu2
		layer_5_gate_gpu2 -> layer_5_expert_0_gpu2 [style=dashed]
		layer_5_gate_gpu2 -> layer_5_expert_1_gpu2 [style=dashed]
		layer_5_gate_gpu2 -> layer_5_expert_2_gpu2 [style=dashed]
		layer_5_gate_gpu2 -> layer_5_expert_3_gpu2 [style=dashed]
		layer_5_expert_0_gpu2 -> layer_5_expert_agg_gpu2
		layer_5_expert_1_gpu2 -> layer_5_expert_agg_gpu2
		layer_5_expert_2_gpu2 -> layer_5_expert_agg_gpu2
		layer_5_expert_3_gpu2 -> layer_5_expert_agg_gpu2
		layer_5_expert_agg_gpu2 -> layer_5_moe_out_proj_gpu2
		layer_5_moe_out_proj_gpu2 -> layer_5_residual2_gpu2
		layer_5_output_gpu2 [label="Layer 5 Output\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_5_residual2_gpu2 -> layer_5_output_gpu2
		layer_6_ln1_gpu2 [label="Layer 6 LayerNorm1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_6_q_proj_gpu2 [label="Layer 6 Q Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_k_proj_gpu2 [label="Layer 6 K Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_v_proj_gpu2 [label="Layer 6 V Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_attn_gpu2 [label="Layer 6 Scaled Dot-Product Attention\nGPU 2\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_attn_out_proj_gpu2 [label="Layer 6 Attention Output Projection\nGPU 2\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_residual1_gpu2 [label="Layer 6 Residual1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_6_ln2_gpu2 [label="Layer 6 LayerNorm2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_6_router_gpu2 [label="Layer 6 Router\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_6_gate_gpu2 [label="Layer 6 Gate Selection\nGPU 2\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_6_expert_0_gpu2 [label="Layer 6 Expert 0\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_1_gpu2 [label="Layer 6 Expert 1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_2_gpu2 [label="Layer 6 Expert 2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_3_gpu2 [label="Layer 6 Expert 3\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_agg_gpu2 [label="Layer 6 Expert Aggregation\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_6_moe_out_proj_gpu2 [label="Layer 6 MoE Output Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_residual2_gpu2 [label="Layer 6 Residual2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_5_output_gpu2 -> layer_6_ln1_gpu2
		layer_6_ln1_gpu2 -> layer_6_q_proj_gpu2
		layer_6_ln1_gpu2 -> layer_6_k_proj_gpu2
		layer_6_ln1_gpu2 -> layer_6_v_proj_gpu2
		layer_6_q_proj_gpu2 -> layer_6_attn_gpu2
		layer_6_k_proj_gpu2 -> layer_6_attn_gpu2
		layer_6_v_proj_gpu2 -> layer_6_attn_gpu2
		layer_6_attn_gpu2 -> layer_6_attn_out_proj_gpu2
		layer_6_attn_out_proj_gpu2 -> layer_6_residual1_gpu2
		layer_6_residual1_gpu2 -> layer_6_ln2_gpu2
		layer_6_ln2_gpu2 -> layer_6_router_gpu2
		layer_6_router_gpu2 -> layer_6_gate_gpu2
		layer_6_gate_gpu2 -> layer_6_expert_0_gpu2 [style=dashed]
		layer_6_gate_gpu2 -> layer_6_expert_1_gpu2 [style=dashed]
		layer_6_gate_gpu2 -> layer_6_expert_2_gpu2 [style=dashed]
		layer_6_gate_gpu2 -> layer_6_expert_3_gpu2 [style=dashed]
		layer_6_expert_0_gpu2 -> layer_6_expert_agg_gpu2
		layer_6_expert_1_gpu2 -> layer_6_expert_agg_gpu2
		layer_6_expert_2_gpu2 -> layer_6_expert_agg_gpu2
		layer_6_expert_3_gpu2 -> layer_6_expert_agg_gpu2
		layer_6_expert_agg_gpu2 -> layer_6_moe_out_proj_gpu2
		layer_6_moe_out_proj_gpu2 -> layer_6_residual2_gpu2
		layer_6_output_gpu2 [label="Layer 6 Output\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_6_residual2_gpu2 -> layer_6_output_gpu2
		layer_7_ln1_gpu2 [label="Layer 7 LayerNorm1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_7_q_proj_gpu2 [label="Layer 7 Q Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_k_proj_gpu2 [label="Layer 7 K Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_v_proj_gpu2 [label="Layer 7 V Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_attn_gpu2 [label="Layer 7 Scaled Dot-Product Attention\nGPU 2\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_attn_out_proj_gpu2 [label="Layer 7 Attention Output Projection\nGPU 2\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_residual1_gpu2 [label="Layer 7 Residual1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_7_ln2_gpu2 [label="Layer 7 LayerNorm2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_7_router_gpu2 [label="Layer 7 Router\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_7_gate_gpu2 [label="Layer 7 Gate Selection\nGPU 2\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_7_expert_0_gpu2 [label="Layer 7 Expert 0\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_1_gpu2 [label="Layer 7 Expert 1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_2_gpu2 [label="Layer 7 Expert 2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_3_gpu2 [label="Layer 7 Expert 3\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_agg_gpu2 [label="Layer 7 Expert Aggregation\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_7_moe_out_proj_gpu2 [label="Layer 7 MoE Output Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_residual2_gpu2 [label="Layer 7 Residual2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_6_output_gpu2 -> layer_7_ln1_gpu2
		layer_7_ln1_gpu2 -> layer_7_q_proj_gpu2
		layer_7_ln1_gpu2 -> layer_7_k_proj_gpu2
		layer_7_ln1_gpu2 -> layer_7_v_proj_gpu2
		layer_7_q_proj_gpu2 -> layer_7_attn_gpu2
		layer_7_k_proj_gpu2 -> layer_7_attn_gpu2
		layer_7_v_proj_gpu2 -> layer_7_attn_gpu2
		layer_7_attn_gpu2 -> layer_7_attn_out_proj_gpu2
		layer_7_attn_out_proj_gpu2 -> layer_7_residual1_gpu2
		layer_7_residual1_gpu2 -> layer_7_ln2_gpu2
		layer_7_ln2_gpu2 -> layer_7_router_gpu2
		layer_7_router_gpu2 -> layer_7_gate_gpu2
		layer_7_gate_gpu2 -> layer_7_expert_0_gpu2 [style=dashed]
		layer_7_gate_gpu2 -> layer_7_expert_1_gpu2 [style=dashed]
		layer_7_gate_gpu2 -> layer_7_expert_2_gpu2 [style=dashed]
		layer_7_gate_gpu2 -> layer_7_expert_3_gpu2 [style=dashed]
		layer_7_expert_0_gpu2 -> layer_7_expert_agg_gpu2
		layer_7_expert_1_gpu2 -> layer_7_expert_agg_gpu2
		layer_7_expert_2_gpu2 -> layer_7_expert_agg_gpu2
		layer_7_expert_3_gpu2 -> layer_7_expert_agg_gpu2
		layer_7_expert_agg_gpu2 -> layer_7_moe_out_proj_gpu2
		layer_7_moe_out_proj_gpu2 -> layer_7_residual2_gpu2
		layer_7_output_gpu2 [label="Layer 7 Output\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_7_residual2_gpu2 -> layer_7_output_gpu2
		layer_8_ln1_gpu2 [label="Layer 8 LayerNorm1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_8_q_proj_gpu2 [label="Layer 8 Q Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_k_proj_gpu2 [label="Layer 8 K Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_v_proj_gpu2 [label="Layer 8 V Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_attn_gpu2 [label="Layer 8 Scaled Dot-Product Attention\nGPU 2\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_attn_out_proj_gpu2 [label="Layer 8 Attention Output Projection\nGPU 2\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_residual1_gpu2 [label="Layer 8 Residual1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_8_ln2_gpu2 [label="Layer 8 LayerNorm2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_8_router_gpu2 [label="Layer 8 Router\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_8_gate_gpu2 [label="Layer 8 Gate Selection\nGPU 2\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_8_expert_0_gpu2 [label="Layer 8 Expert 0\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_1_gpu2 [label="Layer 8 Expert 1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_2_gpu2 [label="Layer 8 Expert 2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_3_gpu2 [label="Layer 8 Expert 3\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_agg_gpu2 [label="Layer 8 Expert Aggregation\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_8_moe_out_proj_gpu2 [label="Layer 8 MoE Output Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_residual2_gpu2 [label="Layer 8 Residual2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_7_output_gpu2 -> layer_8_ln1_gpu2
		layer_8_ln1_gpu2 -> layer_8_q_proj_gpu2
		layer_8_ln1_gpu2 -> layer_8_k_proj_gpu2
		layer_8_ln1_gpu2 -> layer_8_v_proj_gpu2
		layer_8_q_proj_gpu2 -> layer_8_attn_gpu2
		layer_8_k_proj_gpu2 -> layer_8_attn_gpu2
		layer_8_v_proj_gpu2 -> layer_8_attn_gpu2
		layer_8_attn_gpu2 -> layer_8_attn_out_proj_gpu2
		layer_8_attn_out_proj_gpu2 -> layer_8_residual1_gpu2
		layer_8_residual1_gpu2 -> layer_8_ln2_gpu2
		layer_8_ln2_gpu2 -> layer_8_router_gpu2
		layer_8_router_gpu2 -> layer_8_gate_gpu2
		layer_8_gate_gpu2 -> layer_8_expert_0_gpu2 [style=dashed]
		layer_8_gate_gpu2 -> layer_8_expert_1_gpu2 [style=dashed]
		layer_8_gate_gpu2 -> layer_8_expert_2_gpu2 [style=dashed]
		layer_8_gate_gpu2 -> layer_8_expert_3_gpu2 [style=dashed]
		layer_8_expert_0_gpu2 -> layer_8_expert_agg_gpu2
		layer_8_expert_1_gpu2 -> layer_8_expert_agg_gpu2
		layer_8_expert_2_gpu2 -> layer_8_expert_agg_gpu2
		layer_8_expert_3_gpu2 -> layer_8_expert_agg_gpu2
		layer_8_expert_agg_gpu2 -> layer_8_moe_out_proj_gpu2
		layer_8_moe_out_proj_gpu2 -> layer_8_residual2_gpu2
		layer_8_output_gpu2 [label="Layer 8 Output\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_8_residual2_gpu2 -> layer_8_output_gpu2
		layer_9_ln1_gpu2 [label="Layer 9 LayerNorm1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_9_q_proj_gpu2 [label="Layer 9 Q Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_k_proj_gpu2 [label="Layer 9 K Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_v_proj_gpu2 [label="Layer 9 V Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_attn_gpu2 [label="Layer 9 Scaled Dot-Product Attention\nGPU 2\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_attn_out_proj_gpu2 [label="Layer 9 Attention Output Projection\nGPU 2\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_residual1_gpu2 [label="Layer 9 Residual1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_9_ln2_gpu2 [label="Layer 9 LayerNorm2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_9_router_gpu2 [label="Layer 9 Router\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_9_gate_gpu2 [label="Layer 9 Gate Selection\nGPU 2\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_9_expert_0_gpu2 [label="Layer 9 Expert 0\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_1_gpu2 [label="Layer 9 Expert 1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_2_gpu2 [label="Layer 9 Expert 2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_3_gpu2 [label="Layer 9 Expert 3\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_agg_gpu2 [label="Layer 9 Expert Aggregation\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_9_moe_out_proj_gpu2 [label="Layer 9 MoE Output Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_residual2_gpu2 [label="Layer 9 Residual2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_8_output_gpu2 -> layer_9_ln1_gpu2
		layer_9_ln1_gpu2 -> layer_9_q_proj_gpu2
		layer_9_ln1_gpu2 -> layer_9_k_proj_gpu2
		layer_9_ln1_gpu2 -> layer_9_v_proj_gpu2
		layer_9_q_proj_gpu2 -> layer_9_attn_gpu2
		layer_9_k_proj_gpu2 -> layer_9_attn_gpu2
		layer_9_v_proj_gpu2 -> layer_9_attn_gpu2
		layer_9_attn_gpu2 -> layer_9_attn_out_proj_gpu2
		layer_9_attn_out_proj_gpu2 -> layer_9_residual1_gpu2
		layer_9_residual1_gpu2 -> layer_9_ln2_gpu2
		layer_9_ln2_gpu2 -> layer_9_router_gpu2
		layer_9_router_gpu2 -> layer_9_gate_gpu2
		layer_9_gate_gpu2 -> layer_9_expert_0_gpu2 [style=dashed]
		layer_9_gate_gpu2 -> layer_9_expert_1_gpu2 [style=dashed]
		layer_9_gate_gpu2 -> layer_9_expert_2_gpu2 [style=dashed]
		layer_9_gate_gpu2 -> layer_9_expert_3_gpu2 [style=dashed]
		layer_9_expert_0_gpu2 -> layer_9_expert_agg_gpu2
		layer_9_expert_1_gpu2 -> layer_9_expert_agg_gpu2
		layer_9_expert_2_gpu2 -> layer_9_expert_agg_gpu2
		layer_9_expert_3_gpu2 -> layer_9_expert_agg_gpu2
		layer_9_expert_agg_gpu2 -> layer_9_moe_out_proj_gpu2
		layer_9_moe_out_proj_gpu2 -> layer_9_residual2_gpu2
		layer_9_output_gpu2 [label="Layer 9 Output\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_9_residual2_gpu2 -> layer_9_output_gpu2
		layer_10_ln1_gpu2 [label="Layer 10 LayerNorm1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_10_q_proj_gpu2 [label="Layer 10 Q Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_k_proj_gpu2 [label="Layer 10 K Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_v_proj_gpu2 [label="Layer 10 V Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_attn_gpu2 [label="Layer 10 Scaled Dot-Product Attention\nGPU 2\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_attn_out_proj_gpu2 [label="Layer 10 Attention Output Projection\nGPU 2\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_residual1_gpu2 [label="Layer 10 Residual1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_10_ln2_gpu2 [label="Layer 10 LayerNorm2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_10_router_gpu2 [label="Layer 10 Router\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_10_gate_gpu2 [label="Layer 10 Gate Selection\nGPU 2\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_10_expert_0_gpu2 [label="Layer 10 Expert 0\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_1_gpu2 [label="Layer 10 Expert 1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_2_gpu2 [label="Layer 10 Expert 2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_3_gpu2 [label="Layer 10 Expert 3\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_agg_gpu2 [label="Layer 10 Expert Aggregation\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_10_moe_out_proj_gpu2 [label="Layer 10 MoE Output Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_residual2_gpu2 [label="Layer 10 Residual2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_9_output_gpu2 -> layer_10_ln1_gpu2
		layer_10_ln1_gpu2 -> layer_10_q_proj_gpu2
		layer_10_ln1_gpu2 -> layer_10_k_proj_gpu2
		layer_10_ln1_gpu2 -> layer_10_v_proj_gpu2
		layer_10_q_proj_gpu2 -> layer_10_attn_gpu2
		layer_10_k_proj_gpu2 -> layer_10_attn_gpu2
		layer_10_v_proj_gpu2 -> layer_10_attn_gpu2
		layer_10_attn_gpu2 -> layer_10_attn_out_proj_gpu2
		layer_10_attn_out_proj_gpu2 -> layer_10_residual1_gpu2
		layer_10_residual1_gpu2 -> layer_10_ln2_gpu2
		layer_10_ln2_gpu2 -> layer_10_router_gpu2
		layer_10_router_gpu2 -> layer_10_gate_gpu2
		layer_10_gate_gpu2 -> layer_10_expert_0_gpu2 [style=dashed]
		layer_10_gate_gpu2 -> layer_10_expert_1_gpu2 [style=dashed]
		layer_10_gate_gpu2 -> layer_10_expert_2_gpu2 [style=dashed]
		layer_10_gate_gpu2 -> layer_10_expert_3_gpu2 [style=dashed]
		layer_10_expert_0_gpu2 -> layer_10_expert_agg_gpu2
		layer_10_expert_1_gpu2 -> layer_10_expert_agg_gpu2
		layer_10_expert_2_gpu2 -> layer_10_expert_agg_gpu2
		layer_10_expert_3_gpu2 -> layer_10_expert_agg_gpu2
		layer_10_expert_agg_gpu2 -> layer_10_moe_out_proj_gpu2
		layer_10_moe_out_proj_gpu2 -> layer_10_residual2_gpu2
		layer_10_output_gpu2 [label="Layer 10 Output\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_10_residual2_gpu2 -> layer_10_output_gpu2
		layer_11_ln1_gpu2 [label="Layer 11 LayerNorm1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_11_q_proj_gpu2 [label="Layer 11 Q Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_k_proj_gpu2 [label="Layer 11 K Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_v_proj_gpu2 [label="Layer 11 V Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_attn_gpu2 [label="Layer 11 Scaled Dot-Product Attention\nGPU 2\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_attn_out_proj_gpu2 [label="Layer 11 Attention Output Projection\nGPU 2\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_residual1_gpu2 [label="Layer 11 Residual1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_11_ln2_gpu2 [label="Layer 11 LayerNorm2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_11_router_gpu2 [label="Layer 11 Router\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_11_gate_gpu2 [label="Layer 11 Gate Selection\nGPU 2\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_11_expert_0_gpu2 [label="Layer 11 Expert 0\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_1_gpu2 [label="Layer 11 Expert 1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_2_gpu2 [label="Layer 11 Expert 2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_3_gpu2 [label="Layer 11 Expert 3\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_agg_gpu2 [label="Layer 11 Expert Aggregation\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_11_moe_out_proj_gpu2 [label="Layer 11 MoE Output Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_residual2_gpu2 [label="Layer 11 Residual2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_10_output_gpu2 -> layer_11_ln1_gpu2
		layer_11_ln1_gpu2 -> layer_11_q_proj_gpu2
		layer_11_ln1_gpu2 -> layer_11_k_proj_gpu2
		layer_11_ln1_gpu2 -> layer_11_v_proj_gpu2
		layer_11_q_proj_gpu2 -> layer_11_attn_gpu2
		layer_11_k_proj_gpu2 -> layer_11_attn_gpu2
		layer_11_v_proj_gpu2 -> layer_11_attn_gpu2
		layer_11_attn_gpu2 -> layer_11_attn_out_proj_gpu2
		layer_11_attn_out_proj_gpu2 -> layer_11_residual1_gpu2
		layer_11_residual1_gpu2 -> layer_11_ln2_gpu2
		layer_11_ln2_gpu2 -> layer_11_router_gpu2
		layer_11_router_gpu2 -> layer_11_gate_gpu2
		layer_11_gate_gpu2 -> layer_11_expert_0_gpu2 [style=dashed]
		layer_11_gate_gpu2 -> layer_11_expert_1_gpu2 [style=dashed]
		layer_11_gate_gpu2 -> layer_11_expert_2_gpu2 [style=dashed]
		layer_11_gate_gpu2 -> layer_11_expert_3_gpu2 [style=dashed]
		layer_11_expert_0_gpu2 -> layer_11_expert_agg_gpu2
		layer_11_expert_1_gpu2 -> layer_11_expert_agg_gpu2
		layer_11_expert_2_gpu2 -> layer_11_expert_agg_gpu2
		layer_11_expert_3_gpu2 -> layer_11_expert_agg_gpu2
		layer_11_expert_agg_gpu2 -> layer_11_moe_out_proj_gpu2
		layer_11_moe_out_proj_gpu2 -> layer_11_residual2_gpu2
		layer_11_output_gpu2 [label="Layer 11 Output\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_11_residual2_gpu2 -> layer_11_output_gpu2
		layer_12_ln1_gpu2 [label="Layer 12 LayerNorm1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_12_q_proj_gpu2 [label="Layer 12 Q Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_k_proj_gpu2 [label="Layer 12 K Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_v_proj_gpu2 [label="Layer 12 V Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_attn_gpu2 [label="Layer 12 Scaled Dot-Product Attention\nGPU 2\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_attn_out_proj_gpu2 [label="Layer 12 Attention Output Projection\nGPU 2\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_residual1_gpu2 [label="Layer 12 Residual1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_12_ln2_gpu2 [label="Layer 12 LayerNorm2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_12_router_gpu2 [label="Layer 12 Router\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_12_gate_gpu2 [label="Layer 12 Gate Selection\nGPU 2\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_12_expert_0_gpu2 [label="Layer 12 Expert 0\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_1_gpu2 [label="Layer 12 Expert 1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_2_gpu2 [label="Layer 12 Expert 2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_3_gpu2 [label="Layer 12 Expert 3\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_agg_gpu2 [label="Layer 12 Expert Aggregation\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_12_moe_out_proj_gpu2 [label="Layer 12 MoE Output Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_residual2_gpu2 [label="Layer 12 Residual2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_11_output_gpu2 -> layer_12_ln1_gpu2
		layer_12_ln1_gpu2 -> layer_12_q_proj_gpu2
		layer_12_ln1_gpu2 -> layer_12_k_proj_gpu2
		layer_12_ln1_gpu2 -> layer_12_v_proj_gpu2
		layer_12_q_proj_gpu2 -> layer_12_attn_gpu2
		layer_12_k_proj_gpu2 -> layer_12_attn_gpu2
		layer_12_v_proj_gpu2 -> layer_12_attn_gpu2
		layer_12_attn_gpu2 -> layer_12_attn_out_proj_gpu2
		layer_12_attn_out_proj_gpu2 -> layer_12_residual1_gpu2
		layer_12_residual1_gpu2 -> layer_12_ln2_gpu2
		layer_12_ln2_gpu2 -> layer_12_router_gpu2
		layer_12_router_gpu2 -> layer_12_gate_gpu2
		layer_12_gate_gpu2 -> layer_12_expert_0_gpu2 [style=dashed]
		layer_12_gate_gpu2 -> layer_12_expert_1_gpu2 [style=dashed]
		layer_12_gate_gpu2 -> layer_12_expert_2_gpu2 [style=dashed]
		layer_12_gate_gpu2 -> layer_12_expert_3_gpu2 [style=dashed]
		layer_12_expert_0_gpu2 -> layer_12_expert_agg_gpu2
		layer_12_expert_1_gpu2 -> layer_12_expert_agg_gpu2
		layer_12_expert_2_gpu2 -> layer_12_expert_agg_gpu2
		layer_12_expert_3_gpu2 -> layer_12_expert_agg_gpu2
		layer_12_expert_agg_gpu2 -> layer_12_moe_out_proj_gpu2
		layer_12_moe_out_proj_gpu2 -> layer_12_residual2_gpu2
		layer_12_output_gpu2 [label="Layer 12 Output\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_12_residual2_gpu2 -> layer_12_output_gpu2
		layer_13_ln1_gpu2 [label="Layer 13 LayerNorm1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_13_q_proj_gpu2 [label="Layer 13 Q Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_k_proj_gpu2 [label="Layer 13 K Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_v_proj_gpu2 [label="Layer 13 V Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_attn_gpu2 [label="Layer 13 Scaled Dot-Product Attention\nGPU 2\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_attn_out_proj_gpu2 [label="Layer 13 Attention Output Projection\nGPU 2\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_residual1_gpu2 [label="Layer 13 Residual1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_13_ln2_gpu2 [label="Layer 13 LayerNorm2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_13_router_gpu2 [label="Layer 13 Router\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_13_gate_gpu2 [label="Layer 13 Gate Selection\nGPU 2\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_13_expert_0_gpu2 [label="Layer 13 Expert 0\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_1_gpu2 [label="Layer 13 Expert 1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_2_gpu2 [label="Layer 13 Expert 2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_3_gpu2 [label="Layer 13 Expert 3\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_agg_gpu2 [label="Layer 13 Expert Aggregation\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_13_moe_out_proj_gpu2 [label="Layer 13 MoE Output Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_residual2_gpu2 [label="Layer 13 Residual2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_12_output_gpu2 -> layer_13_ln1_gpu2
		layer_13_ln1_gpu2 -> layer_13_q_proj_gpu2
		layer_13_ln1_gpu2 -> layer_13_k_proj_gpu2
		layer_13_ln1_gpu2 -> layer_13_v_proj_gpu2
		layer_13_q_proj_gpu2 -> layer_13_attn_gpu2
		layer_13_k_proj_gpu2 -> layer_13_attn_gpu2
		layer_13_v_proj_gpu2 -> layer_13_attn_gpu2
		layer_13_attn_gpu2 -> layer_13_attn_out_proj_gpu2
		layer_13_attn_out_proj_gpu2 -> layer_13_residual1_gpu2
		layer_13_residual1_gpu2 -> layer_13_ln2_gpu2
		layer_13_ln2_gpu2 -> layer_13_router_gpu2
		layer_13_router_gpu2 -> layer_13_gate_gpu2
		layer_13_gate_gpu2 -> layer_13_expert_0_gpu2 [style=dashed]
		layer_13_gate_gpu2 -> layer_13_expert_1_gpu2 [style=dashed]
		layer_13_gate_gpu2 -> layer_13_expert_2_gpu2 [style=dashed]
		layer_13_gate_gpu2 -> layer_13_expert_3_gpu2 [style=dashed]
		layer_13_expert_0_gpu2 -> layer_13_expert_agg_gpu2
		layer_13_expert_1_gpu2 -> layer_13_expert_agg_gpu2
		layer_13_expert_2_gpu2 -> layer_13_expert_agg_gpu2
		layer_13_expert_3_gpu2 -> layer_13_expert_agg_gpu2
		layer_13_expert_agg_gpu2 -> layer_13_moe_out_proj_gpu2
		layer_13_moe_out_proj_gpu2 -> layer_13_residual2_gpu2
		layer_13_output_gpu2 [label="Layer 13 Output\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_13_residual2_gpu2 -> layer_13_output_gpu2
		layer_14_ln1_gpu2 [label="Layer 14 LayerNorm1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_14_q_proj_gpu2 [label="Layer 14 Q Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_k_proj_gpu2 [label="Layer 14 K Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_v_proj_gpu2 [label="Layer 14 V Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_attn_gpu2 [label="Layer 14 Scaled Dot-Product Attention\nGPU 2\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_attn_out_proj_gpu2 [label="Layer 14 Attention Output Projection\nGPU 2\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_residual1_gpu2 [label="Layer 14 Residual1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_14_ln2_gpu2 [label="Layer 14 LayerNorm2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_14_router_gpu2 [label="Layer 14 Router\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_14_gate_gpu2 [label="Layer 14 Gate Selection\nGPU 2\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_14_expert_0_gpu2 [label="Layer 14 Expert 0\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_1_gpu2 [label="Layer 14 Expert 1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_2_gpu2 [label="Layer 14 Expert 2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_3_gpu2 [label="Layer 14 Expert 3\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_agg_gpu2 [label="Layer 14 Expert Aggregation\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_14_moe_out_proj_gpu2 [label="Layer 14 MoE Output Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_residual2_gpu2 [label="Layer 14 Residual2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_13_output_gpu2 -> layer_14_ln1_gpu2
		layer_14_ln1_gpu2 -> layer_14_q_proj_gpu2
		layer_14_ln1_gpu2 -> layer_14_k_proj_gpu2
		layer_14_ln1_gpu2 -> layer_14_v_proj_gpu2
		layer_14_q_proj_gpu2 -> layer_14_attn_gpu2
		layer_14_k_proj_gpu2 -> layer_14_attn_gpu2
		layer_14_v_proj_gpu2 -> layer_14_attn_gpu2
		layer_14_attn_gpu2 -> layer_14_attn_out_proj_gpu2
		layer_14_attn_out_proj_gpu2 -> layer_14_residual1_gpu2
		layer_14_residual1_gpu2 -> layer_14_ln2_gpu2
		layer_14_ln2_gpu2 -> layer_14_router_gpu2
		layer_14_router_gpu2 -> layer_14_gate_gpu2
		layer_14_gate_gpu2 -> layer_14_expert_0_gpu2 [style=dashed]
		layer_14_gate_gpu2 -> layer_14_expert_1_gpu2 [style=dashed]
		layer_14_gate_gpu2 -> layer_14_expert_2_gpu2 [style=dashed]
		layer_14_gate_gpu2 -> layer_14_expert_3_gpu2 [style=dashed]
		layer_14_expert_0_gpu2 -> layer_14_expert_agg_gpu2
		layer_14_expert_1_gpu2 -> layer_14_expert_agg_gpu2
		layer_14_expert_2_gpu2 -> layer_14_expert_agg_gpu2
		layer_14_expert_3_gpu2 -> layer_14_expert_agg_gpu2
		layer_14_expert_agg_gpu2 -> layer_14_moe_out_proj_gpu2
		layer_14_moe_out_proj_gpu2 -> layer_14_residual2_gpu2
		layer_14_output_gpu2 [label="Layer 14 Output\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_14_residual2_gpu2 -> layer_14_output_gpu2
		layer_15_ln1_gpu2 [label="Layer 15 LayerNorm1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_15_q_proj_gpu2 [label="Layer 15 Q Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_k_proj_gpu2 [label="Layer 15 K Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_v_proj_gpu2 [label="Layer 15 V Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_attn_gpu2 [label="Layer 15 Scaled Dot-Product Attention\nGPU 2\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_attn_out_proj_gpu2 [label="Layer 15 Attention Output Projection\nGPU 2\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_residual1_gpu2 [label="Layer 15 Residual1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_15_ln2_gpu2 [label="Layer 15 LayerNorm2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_15_router_gpu2 [label="Layer 15 Router\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_15_gate_gpu2 [label="Layer 15 Gate Selection\nGPU 2\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_15_expert_0_gpu2 [label="Layer 15 Expert 0\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_1_gpu2 [label="Layer 15 Expert 1\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_2_gpu2 [label="Layer 15 Expert 2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_3_gpu2 [label="Layer 15 Expert 3\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_agg_gpu2 [label="Layer 15 Expert Aggregation\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_15_moe_out_proj_gpu2 [label="Layer 15 MoE Output Projection\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_residual2_gpu2 [label="Layer 15 Residual2\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_14_output_gpu2 -> layer_15_ln1_gpu2
		layer_15_ln1_gpu2 -> layer_15_q_proj_gpu2
		layer_15_ln1_gpu2 -> layer_15_k_proj_gpu2
		layer_15_ln1_gpu2 -> layer_15_v_proj_gpu2
		layer_15_q_proj_gpu2 -> layer_15_attn_gpu2
		layer_15_k_proj_gpu2 -> layer_15_attn_gpu2
		layer_15_v_proj_gpu2 -> layer_15_attn_gpu2
		layer_15_attn_gpu2 -> layer_15_attn_out_proj_gpu2
		layer_15_attn_out_proj_gpu2 -> layer_15_residual1_gpu2
		layer_15_residual1_gpu2 -> layer_15_ln2_gpu2
		layer_15_ln2_gpu2 -> layer_15_router_gpu2
		layer_15_router_gpu2 -> layer_15_gate_gpu2
		layer_15_gate_gpu2 -> layer_15_expert_0_gpu2 [style=dashed]
		layer_15_gate_gpu2 -> layer_15_expert_1_gpu2 [style=dashed]
		layer_15_gate_gpu2 -> layer_15_expert_2_gpu2 [style=dashed]
		layer_15_gate_gpu2 -> layer_15_expert_3_gpu2 [style=dashed]
		layer_15_expert_0_gpu2 -> layer_15_expert_agg_gpu2
		layer_15_expert_1_gpu2 -> layer_15_expert_agg_gpu2
		layer_15_expert_2_gpu2 -> layer_15_expert_agg_gpu2
		layer_15_expert_3_gpu2 -> layer_15_expert_agg_gpu2
		layer_15_expert_agg_gpu2 -> layer_15_moe_out_proj_gpu2
		layer_15_moe_out_proj_gpu2 -> layer_15_residual2_gpu2
		layer_15_output_gpu2 [label="Layer 15 Output\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_15_residual2_gpu2 -> layer_15_output_gpu2
		final_ln_gpu2 [label="Final Layer Norm\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		layer_15_output_gpu2 -> final_ln_gpu2
		lm_head_gpu2 [label="LM Head\nGPU 2\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, vocab_size]" fillcolor=lightcoral shape=rectangle style=filled]
		output_gpu2 [label="Output\nGPU 2\nInput: [batch=256, seq=512, vocab_size]\nOutput: [batch=256, seq=512, vocab_size]" fillcolor=lightgreen shape=ellipse style=filled]
		input_gpu2 -> embed_gpu2
		embed_gpu2 -> pos_enc_gpu2
		final_ln_gpu2 -> lm_head_gpu2
		lm_head_gpu2 -> output_gpu2
	}
	subgraph cluster_gpu_3 {
		color=blue fillcolor=lightblue label="GPU 3" style=rounded
		input_gpu3 [label="Input\nGPU 3\nInput: [batch=256, seq=512, dim=1024]\nOutput: [batch=256, seq=512, dim=1024]" fillcolor=lightgreen shape=ellipse style=filled]
		embed_gpu3 [label="Token Embedding\nGPU 3\nInput: [batch=256, seq=512]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		pos_enc_gpu3 [label="Position Encoding\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		layer_0_ln1_gpu3 [label="Layer 0 LayerNorm1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_0_q_proj_gpu3 [label="Layer 0 Q Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_k_proj_gpu3 [label="Layer 0 K Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_v_proj_gpu3 [label="Layer 0 V Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_attn_gpu3 [label="Layer 0 Scaled Dot-Product Attention\nGPU 3\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_attn_out_proj_gpu3 [label="Layer 0 Attention Output Projection\nGPU 3\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_residual1_gpu3 [label="Layer 0 Residual1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_0_ln2_gpu3 [label="Layer 0 LayerNorm2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_0_router_gpu3 [label="Layer 0 Router\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_0_gate_gpu3 [label="Layer 0 Gate Selection\nGPU 3\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_0_expert_0_gpu3 [label="Layer 0 Expert 0\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_1_gpu3 [label="Layer 0 Expert 1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_2_gpu3 [label="Layer 0 Expert 2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_3_gpu3 [label="Layer 0 Expert 3\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_agg_gpu3 [label="Layer 0 Expert Aggregation\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_0_moe_out_proj_gpu3 [label="Layer 0 MoE Output Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_residual2_gpu3 [label="Layer 0 Residual2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		pos_enc_gpu3 -> layer_0_ln1_gpu3
		layer_0_ln1_gpu3 -> layer_0_q_proj_gpu3
		layer_0_ln1_gpu3 -> layer_0_k_proj_gpu3
		layer_0_ln1_gpu3 -> layer_0_v_proj_gpu3
		layer_0_q_proj_gpu3 -> layer_0_attn_gpu3
		layer_0_k_proj_gpu3 -> layer_0_attn_gpu3
		layer_0_v_proj_gpu3 -> layer_0_attn_gpu3
		layer_0_attn_gpu3 -> layer_0_attn_out_proj_gpu3
		layer_0_attn_out_proj_gpu3 -> layer_0_residual1_gpu3
		layer_0_residual1_gpu3 -> layer_0_ln2_gpu3
		layer_0_ln2_gpu3 -> layer_0_router_gpu3
		layer_0_router_gpu3 -> layer_0_gate_gpu3
		layer_0_gate_gpu3 -> layer_0_expert_0_gpu3 [style=dashed]
		layer_0_gate_gpu3 -> layer_0_expert_1_gpu3 [style=dashed]
		layer_0_gate_gpu3 -> layer_0_expert_2_gpu3 [style=dashed]
		layer_0_gate_gpu3 -> layer_0_expert_3_gpu3 [style=dashed]
		layer_0_expert_0_gpu3 -> layer_0_expert_agg_gpu3
		layer_0_expert_1_gpu3 -> layer_0_expert_agg_gpu3
		layer_0_expert_2_gpu3 -> layer_0_expert_agg_gpu3
		layer_0_expert_3_gpu3 -> layer_0_expert_agg_gpu3
		layer_0_expert_agg_gpu3 -> layer_0_moe_out_proj_gpu3
		layer_0_moe_out_proj_gpu3 -> layer_0_residual2_gpu3
		layer_0_output_gpu3 [label="Layer 0 Output\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_0_residual2_gpu3 -> layer_0_output_gpu3
		layer_1_ln1_gpu3 [label="Layer 1 LayerNorm1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_1_q_proj_gpu3 [label="Layer 1 Q Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_k_proj_gpu3 [label="Layer 1 K Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_v_proj_gpu3 [label="Layer 1 V Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_attn_gpu3 [label="Layer 1 Scaled Dot-Product Attention\nGPU 3\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_attn_out_proj_gpu3 [label="Layer 1 Attention Output Projection\nGPU 3\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_residual1_gpu3 [label="Layer 1 Residual1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_1_ln2_gpu3 [label="Layer 1 LayerNorm2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_1_router_gpu3 [label="Layer 1 Router\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_1_gate_gpu3 [label="Layer 1 Gate Selection\nGPU 3\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_1_expert_0_gpu3 [label="Layer 1 Expert 0\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_1_gpu3 [label="Layer 1 Expert 1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_2_gpu3 [label="Layer 1 Expert 2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_3_gpu3 [label="Layer 1 Expert 3\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_agg_gpu3 [label="Layer 1 Expert Aggregation\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_1_moe_out_proj_gpu3 [label="Layer 1 MoE Output Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_residual2_gpu3 [label="Layer 1 Residual2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_0_output_gpu3 -> layer_1_ln1_gpu3
		layer_1_ln1_gpu3 -> layer_1_q_proj_gpu3
		layer_1_ln1_gpu3 -> layer_1_k_proj_gpu3
		layer_1_ln1_gpu3 -> layer_1_v_proj_gpu3
		layer_1_q_proj_gpu3 -> layer_1_attn_gpu3
		layer_1_k_proj_gpu3 -> layer_1_attn_gpu3
		layer_1_v_proj_gpu3 -> layer_1_attn_gpu3
		layer_1_attn_gpu3 -> layer_1_attn_out_proj_gpu3
		layer_1_attn_out_proj_gpu3 -> layer_1_residual1_gpu3
		layer_1_residual1_gpu3 -> layer_1_ln2_gpu3
		layer_1_ln2_gpu3 -> layer_1_router_gpu3
		layer_1_router_gpu3 -> layer_1_gate_gpu3
		layer_1_gate_gpu3 -> layer_1_expert_0_gpu3 [style=dashed]
		layer_1_gate_gpu3 -> layer_1_expert_1_gpu3 [style=dashed]
		layer_1_gate_gpu3 -> layer_1_expert_2_gpu3 [style=dashed]
		layer_1_gate_gpu3 -> layer_1_expert_3_gpu3 [style=dashed]
		layer_1_expert_0_gpu3 -> layer_1_expert_agg_gpu3
		layer_1_expert_1_gpu3 -> layer_1_expert_agg_gpu3
		layer_1_expert_2_gpu3 -> layer_1_expert_agg_gpu3
		layer_1_expert_3_gpu3 -> layer_1_expert_agg_gpu3
		layer_1_expert_agg_gpu3 -> layer_1_moe_out_proj_gpu3
		layer_1_moe_out_proj_gpu3 -> layer_1_residual2_gpu3
		layer_1_output_gpu3 [label="Layer 1 Output\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_1_residual2_gpu3 -> layer_1_output_gpu3
		layer_2_ln1_gpu3 [label="Layer 2 LayerNorm1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_2_q_proj_gpu3 [label="Layer 2 Q Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_k_proj_gpu3 [label="Layer 2 K Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_v_proj_gpu3 [label="Layer 2 V Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_attn_gpu3 [label="Layer 2 Scaled Dot-Product Attention\nGPU 3\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_attn_out_proj_gpu3 [label="Layer 2 Attention Output Projection\nGPU 3\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_residual1_gpu3 [label="Layer 2 Residual1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_2_ln2_gpu3 [label="Layer 2 LayerNorm2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_2_router_gpu3 [label="Layer 2 Router\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_2_gate_gpu3 [label="Layer 2 Gate Selection\nGPU 3\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_2_expert_0_gpu3 [label="Layer 2 Expert 0\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_1_gpu3 [label="Layer 2 Expert 1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_2_gpu3 [label="Layer 2 Expert 2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_3_gpu3 [label="Layer 2 Expert 3\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_agg_gpu3 [label="Layer 2 Expert Aggregation\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_2_moe_out_proj_gpu3 [label="Layer 2 MoE Output Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_residual2_gpu3 [label="Layer 2 Residual2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_1_output_gpu3 -> layer_2_ln1_gpu3
		layer_2_ln1_gpu3 -> layer_2_q_proj_gpu3
		layer_2_ln1_gpu3 -> layer_2_k_proj_gpu3
		layer_2_ln1_gpu3 -> layer_2_v_proj_gpu3
		layer_2_q_proj_gpu3 -> layer_2_attn_gpu3
		layer_2_k_proj_gpu3 -> layer_2_attn_gpu3
		layer_2_v_proj_gpu3 -> layer_2_attn_gpu3
		layer_2_attn_gpu3 -> layer_2_attn_out_proj_gpu3
		layer_2_attn_out_proj_gpu3 -> layer_2_residual1_gpu3
		layer_2_residual1_gpu3 -> layer_2_ln2_gpu3
		layer_2_ln2_gpu3 -> layer_2_router_gpu3
		layer_2_router_gpu3 -> layer_2_gate_gpu3
		layer_2_gate_gpu3 -> layer_2_expert_0_gpu3 [style=dashed]
		layer_2_gate_gpu3 -> layer_2_expert_1_gpu3 [style=dashed]
		layer_2_gate_gpu3 -> layer_2_expert_2_gpu3 [style=dashed]
		layer_2_gate_gpu3 -> layer_2_expert_3_gpu3 [style=dashed]
		layer_2_expert_0_gpu3 -> layer_2_expert_agg_gpu3
		layer_2_expert_1_gpu3 -> layer_2_expert_agg_gpu3
		layer_2_expert_2_gpu3 -> layer_2_expert_agg_gpu3
		layer_2_expert_3_gpu3 -> layer_2_expert_agg_gpu3
		layer_2_expert_agg_gpu3 -> layer_2_moe_out_proj_gpu3
		layer_2_moe_out_proj_gpu3 -> layer_2_residual2_gpu3
		layer_2_output_gpu3 [label="Layer 2 Output\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_2_residual2_gpu3 -> layer_2_output_gpu3
		layer_3_ln1_gpu3 [label="Layer 3 LayerNorm1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_3_q_proj_gpu3 [label="Layer 3 Q Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_k_proj_gpu3 [label="Layer 3 K Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_v_proj_gpu3 [label="Layer 3 V Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_attn_gpu3 [label="Layer 3 Scaled Dot-Product Attention\nGPU 3\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_attn_out_proj_gpu3 [label="Layer 3 Attention Output Projection\nGPU 3\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_residual1_gpu3 [label="Layer 3 Residual1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_3_ln2_gpu3 [label="Layer 3 LayerNorm2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_3_router_gpu3 [label="Layer 3 Router\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_3_gate_gpu3 [label="Layer 3 Gate Selection\nGPU 3\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_3_expert_0_gpu3 [label="Layer 3 Expert 0\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_1_gpu3 [label="Layer 3 Expert 1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_2_gpu3 [label="Layer 3 Expert 2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_3_gpu3 [label="Layer 3 Expert 3\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_agg_gpu3 [label="Layer 3 Expert Aggregation\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_3_moe_out_proj_gpu3 [label="Layer 3 MoE Output Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_residual2_gpu3 [label="Layer 3 Residual2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_2_output_gpu3 -> layer_3_ln1_gpu3
		layer_3_ln1_gpu3 -> layer_3_q_proj_gpu3
		layer_3_ln1_gpu3 -> layer_3_k_proj_gpu3
		layer_3_ln1_gpu3 -> layer_3_v_proj_gpu3
		layer_3_q_proj_gpu3 -> layer_3_attn_gpu3
		layer_3_k_proj_gpu3 -> layer_3_attn_gpu3
		layer_3_v_proj_gpu3 -> layer_3_attn_gpu3
		layer_3_attn_gpu3 -> layer_3_attn_out_proj_gpu3
		layer_3_attn_out_proj_gpu3 -> layer_3_residual1_gpu3
		layer_3_residual1_gpu3 -> layer_3_ln2_gpu3
		layer_3_ln2_gpu3 -> layer_3_router_gpu3
		layer_3_router_gpu3 -> layer_3_gate_gpu3
		layer_3_gate_gpu3 -> layer_3_expert_0_gpu3 [style=dashed]
		layer_3_gate_gpu3 -> layer_3_expert_1_gpu3 [style=dashed]
		layer_3_gate_gpu3 -> layer_3_expert_2_gpu3 [style=dashed]
		layer_3_gate_gpu3 -> layer_3_expert_3_gpu3 [style=dashed]
		layer_3_expert_0_gpu3 -> layer_3_expert_agg_gpu3
		layer_3_expert_1_gpu3 -> layer_3_expert_agg_gpu3
		layer_3_expert_2_gpu3 -> layer_3_expert_agg_gpu3
		layer_3_expert_3_gpu3 -> layer_3_expert_agg_gpu3
		layer_3_expert_agg_gpu3 -> layer_3_moe_out_proj_gpu3
		layer_3_moe_out_proj_gpu3 -> layer_3_residual2_gpu3
		layer_3_output_gpu3 [label="Layer 3 Output\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_3_residual2_gpu3 -> layer_3_output_gpu3
		layer_4_ln1_gpu3 [label="Layer 4 LayerNorm1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_4_q_proj_gpu3 [label="Layer 4 Q Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_k_proj_gpu3 [label="Layer 4 K Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_v_proj_gpu3 [label="Layer 4 V Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_attn_gpu3 [label="Layer 4 Scaled Dot-Product Attention\nGPU 3\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_attn_out_proj_gpu3 [label="Layer 4 Attention Output Projection\nGPU 3\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_residual1_gpu3 [label="Layer 4 Residual1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_4_ln2_gpu3 [label="Layer 4 LayerNorm2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_4_router_gpu3 [label="Layer 4 Router\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_4_gate_gpu3 [label="Layer 4 Gate Selection\nGPU 3\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_4_expert_0_gpu3 [label="Layer 4 Expert 0\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_1_gpu3 [label="Layer 4 Expert 1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_2_gpu3 [label="Layer 4 Expert 2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_3_gpu3 [label="Layer 4 Expert 3\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_agg_gpu3 [label="Layer 4 Expert Aggregation\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_4_moe_out_proj_gpu3 [label="Layer 4 MoE Output Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_residual2_gpu3 [label="Layer 4 Residual2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_3_output_gpu3 -> layer_4_ln1_gpu3
		layer_4_ln1_gpu3 -> layer_4_q_proj_gpu3
		layer_4_ln1_gpu3 -> layer_4_k_proj_gpu3
		layer_4_ln1_gpu3 -> layer_4_v_proj_gpu3
		layer_4_q_proj_gpu3 -> layer_4_attn_gpu3
		layer_4_k_proj_gpu3 -> layer_4_attn_gpu3
		layer_4_v_proj_gpu3 -> layer_4_attn_gpu3
		layer_4_attn_gpu3 -> layer_4_attn_out_proj_gpu3
		layer_4_attn_out_proj_gpu3 -> layer_4_residual1_gpu3
		layer_4_residual1_gpu3 -> layer_4_ln2_gpu3
		layer_4_ln2_gpu3 -> layer_4_router_gpu3
		layer_4_router_gpu3 -> layer_4_gate_gpu3
		layer_4_gate_gpu3 -> layer_4_expert_0_gpu3 [style=dashed]
		layer_4_gate_gpu3 -> layer_4_expert_1_gpu3 [style=dashed]
		layer_4_gate_gpu3 -> layer_4_expert_2_gpu3 [style=dashed]
		layer_4_gate_gpu3 -> layer_4_expert_3_gpu3 [style=dashed]
		layer_4_expert_0_gpu3 -> layer_4_expert_agg_gpu3
		layer_4_expert_1_gpu3 -> layer_4_expert_agg_gpu3
		layer_4_expert_2_gpu3 -> layer_4_expert_agg_gpu3
		layer_4_expert_3_gpu3 -> layer_4_expert_agg_gpu3
		layer_4_expert_agg_gpu3 -> layer_4_moe_out_proj_gpu3
		layer_4_moe_out_proj_gpu3 -> layer_4_residual2_gpu3
		layer_4_output_gpu3 [label="Layer 4 Output\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_4_residual2_gpu3 -> layer_4_output_gpu3
		layer_5_ln1_gpu3 [label="Layer 5 LayerNorm1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_5_q_proj_gpu3 [label="Layer 5 Q Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_k_proj_gpu3 [label="Layer 5 K Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_v_proj_gpu3 [label="Layer 5 V Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_attn_gpu3 [label="Layer 5 Scaled Dot-Product Attention\nGPU 3\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_attn_out_proj_gpu3 [label="Layer 5 Attention Output Projection\nGPU 3\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_residual1_gpu3 [label="Layer 5 Residual1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_5_ln2_gpu3 [label="Layer 5 LayerNorm2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_5_router_gpu3 [label="Layer 5 Router\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_5_gate_gpu3 [label="Layer 5 Gate Selection\nGPU 3\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_5_expert_0_gpu3 [label="Layer 5 Expert 0\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_1_gpu3 [label="Layer 5 Expert 1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_2_gpu3 [label="Layer 5 Expert 2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_3_gpu3 [label="Layer 5 Expert 3\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_agg_gpu3 [label="Layer 5 Expert Aggregation\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_5_moe_out_proj_gpu3 [label="Layer 5 MoE Output Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_residual2_gpu3 [label="Layer 5 Residual2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_4_output_gpu3 -> layer_5_ln1_gpu3
		layer_5_ln1_gpu3 -> layer_5_q_proj_gpu3
		layer_5_ln1_gpu3 -> layer_5_k_proj_gpu3
		layer_5_ln1_gpu3 -> layer_5_v_proj_gpu3
		layer_5_q_proj_gpu3 -> layer_5_attn_gpu3
		layer_5_k_proj_gpu3 -> layer_5_attn_gpu3
		layer_5_v_proj_gpu3 -> layer_5_attn_gpu3
		layer_5_attn_gpu3 -> layer_5_attn_out_proj_gpu3
		layer_5_attn_out_proj_gpu3 -> layer_5_residual1_gpu3
		layer_5_residual1_gpu3 -> layer_5_ln2_gpu3
		layer_5_ln2_gpu3 -> layer_5_router_gpu3
		layer_5_router_gpu3 -> layer_5_gate_gpu3
		layer_5_gate_gpu3 -> layer_5_expert_0_gpu3 [style=dashed]
		layer_5_gate_gpu3 -> layer_5_expert_1_gpu3 [style=dashed]
		layer_5_gate_gpu3 -> layer_5_expert_2_gpu3 [style=dashed]
		layer_5_gate_gpu3 -> layer_5_expert_3_gpu3 [style=dashed]
		layer_5_expert_0_gpu3 -> layer_5_expert_agg_gpu3
		layer_5_expert_1_gpu3 -> layer_5_expert_agg_gpu3
		layer_5_expert_2_gpu3 -> layer_5_expert_agg_gpu3
		layer_5_expert_3_gpu3 -> layer_5_expert_agg_gpu3
		layer_5_expert_agg_gpu3 -> layer_5_moe_out_proj_gpu3
		layer_5_moe_out_proj_gpu3 -> layer_5_residual2_gpu3
		layer_5_output_gpu3 [label="Layer 5 Output\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_5_residual2_gpu3 -> layer_5_output_gpu3
		layer_6_ln1_gpu3 [label="Layer 6 LayerNorm1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_6_q_proj_gpu3 [label="Layer 6 Q Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_k_proj_gpu3 [label="Layer 6 K Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_v_proj_gpu3 [label="Layer 6 V Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_attn_gpu3 [label="Layer 6 Scaled Dot-Product Attention\nGPU 3\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_attn_out_proj_gpu3 [label="Layer 6 Attention Output Projection\nGPU 3\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_residual1_gpu3 [label="Layer 6 Residual1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_6_ln2_gpu3 [label="Layer 6 LayerNorm2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_6_router_gpu3 [label="Layer 6 Router\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_6_gate_gpu3 [label="Layer 6 Gate Selection\nGPU 3\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_6_expert_0_gpu3 [label="Layer 6 Expert 0\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_1_gpu3 [label="Layer 6 Expert 1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_2_gpu3 [label="Layer 6 Expert 2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_3_gpu3 [label="Layer 6 Expert 3\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_agg_gpu3 [label="Layer 6 Expert Aggregation\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_6_moe_out_proj_gpu3 [label="Layer 6 MoE Output Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_residual2_gpu3 [label="Layer 6 Residual2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_5_output_gpu3 -> layer_6_ln1_gpu3
		layer_6_ln1_gpu3 -> layer_6_q_proj_gpu3
		layer_6_ln1_gpu3 -> layer_6_k_proj_gpu3
		layer_6_ln1_gpu3 -> layer_6_v_proj_gpu3
		layer_6_q_proj_gpu3 -> layer_6_attn_gpu3
		layer_6_k_proj_gpu3 -> layer_6_attn_gpu3
		layer_6_v_proj_gpu3 -> layer_6_attn_gpu3
		layer_6_attn_gpu3 -> layer_6_attn_out_proj_gpu3
		layer_6_attn_out_proj_gpu3 -> layer_6_residual1_gpu3
		layer_6_residual1_gpu3 -> layer_6_ln2_gpu3
		layer_6_ln2_gpu3 -> layer_6_router_gpu3
		layer_6_router_gpu3 -> layer_6_gate_gpu3
		layer_6_gate_gpu3 -> layer_6_expert_0_gpu3 [style=dashed]
		layer_6_gate_gpu3 -> layer_6_expert_1_gpu3 [style=dashed]
		layer_6_gate_gpu3 -> layer_6_expert_2_gpu3 [style=dashed]
		layer_6_gate_gpu3 -> layer_6_expert_3_gpu3 [style=dashed]
		layer_6_expert_0_gpu3 -> layer_6_expert_agg_gpu3
		layer_6_expert_1_gpu3 -> layer_6_expert_agg_gpu3
		layer_6_expert_2_gpu3 -> layer_6_expert_agg_gpu3
		layer_6_expert_3_gpu3 -> layer_6_expert_agg_gpu3
		layer_6_expert_agg_gpu3 -> layer_6_moe_out_proj_gpu3
		layer_6_moe_out_proj_gpu3 -> layer_6_residual2_gpu3
		layer_6_output_gpu3 [label="Layer 6 Output\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_6_residual2_gpu3 -> layer_6_output_gpu3
		layer_7_ln1_gpu3 [label="Layer 7 LayerNorm1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_7_q_proj_gpu3 [label="Layer 7 Q Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_k_proj_gpu3 [label="Layer 7 K Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_v_proj_gpu3 [label="Layer 7 V Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_attn_gpu3 [label="Layer 7 Scaled Dot-Product Attention\nGPU 3\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_attn_out_proj_gpu3 [label="Layer 7 Attention Output Projection\nGPU 3\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_residual1_gpu3 [label="Layer 7 Residual1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_7_ln2_gpu3 [label="Layer 7 LayerNorm2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_7_router_gpu3 [label="Layer 7 Router\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_7_gate_gpu3 [label="Layer 7 Gate Selection\nGPU 3\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_7_expert_0_gpu3 [label="Layer 7 Expert 0\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_1_gpu3 [label="Layer 7 Expert 1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_2_gpu3 [label="Layer 7 Expert 2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_3_gpu3 [label="Layer 7 Expert 3\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_agg_gpu3 [label="Layer 7 Expert Aggregation\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_7_moe_out_proj_gpu3 [label="Layer 7 MoE Output Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_residual2_gpu3 [label="Layer 7 Residual2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_6_output_gpu3 -> layer_7_ln1_gpu3
		layer_7_ln1_gpu3 -> layer_7_q_proj_gpu3
		layer_7_ln1_gpu3 -> layer_7_k_proj_gpu3
		layer_7_ln1_gpu3 -> layer_7_v_proj_gpu3
		layer_7_q_proj_gpu3 -> layer_7_attn_gpu3
		layer_7_k_proj_gpu3 -> layer_7_attn_gpu3
		layer_7_v_proj_gpu3 -> layer_7_attn_gpu3
		layer_7_attn_gpu3 -> layer_7_attn_out_proj_gpu3
		layer_7_attn_out_proj_gpu3 -> layer_7_residual1_gpu3
		layer_7_residual1_gpu3 -> layer_7_ln2_gpu3
		layer_7_ln2_gpu3 -> layer_7_router_gpu3
		layer_7_router_gpu3 -> layer_7_gate_gpu3
		layer_7_gate_gpu3 -> layer_7_expert_0_gpu3 [style=dashed]
		layer_7_gate_gpu3 -> layer_7_expert_1_gpu3 [style=dashed]
		layer_7_gate_gpu3 -> layer_7_expert_2_gpu3 [style=dashed]
		layer_7_gate_gpu3 -> layer_7_expert_3_gpu3 [style=dashed]
		layer_7_expert_0_gpu3 -> layer_7_expert_agg_gpu3
		layer_7_expert_1_gpu3 -> layer_7_expert_agg_gpu3
		layer_7_expert_2_gpu3 -> layer_7_expert_agg_gpu3
		layer_7_expert_3_gpu3 -> layer_7_expert_agg_gpu3
		layer_7_expert_agg_gpu3 -> layer_7_moe_out_proj_gpu3
		layer_7_moe_out_proj_gpu3 -> layer_7_residual2_gpu3
		layer_7_output_gpu3 [label="Layer 7 Output\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_7_residual2_gpu3 -> layer_7_output_gpu3
		layer_8_ln1_gpu3 [label="Layer 8 LayerNorm1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_8_q_proj_gpu3 [label="Layer 8 Q Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_k_proj_gpu3 [label="Layer 8 K Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_v_proj_gpu3 [label="Layer 8 V Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_attn_gpu3 [label="Layer 8 Scaled Dot-Product Attention\nGPU 3\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_attn_out_proj_gpu3 [label="Layer 8 Attention Output Projection\nGPU 3\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_residual1_gpu3 [label="Layer 8 Residual1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_8_ln2_gpu3 [label="Layer 8 LayerNorm2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_8_router_gpu3 [label="Layer 8 Router\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_8_gate_gpu3 [label="Layer 8 Gate Selection\nGPU 3\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_8_expert_0_gpu3 [label="Layer 8 Expert 0\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_1_gpu3 [label="Layer 8 Expert 1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_2_gpu3 [label="Layer 8 Expert 2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_3_gpu3 [label="Layer 8 Expert 3\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_agg_gpu3 [label="Layer 8 Expert Aggregation\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_8_moe_out_proj_gpu3 [label="Layer 8 MoE Output Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_residual2_gpu3 [label="Layer 8 Residual2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_7_output_gpu3 -> layer_8_ln1_gpu3
		layer_8_ln1_gpu3 -> layer_8_q_proj_gpu3
		layer_8_ln1_gpu3 -> layer_8_k_proj_gpu3
		layer_8_ln1_gpu3 -> layer_8_v_proj_gpu3
		layer_8_q_proj_gpu3 -> layer_8_attn_gpu3
		layer_8_k_proj_gpu3 -> layer_8_attn_gpu3
		layer_8_v_proj_gpu3 -> layer_8_attn_gpu3
		layer_8_attn_gpu3 -> layer_8_attn_out_proj_gpu3
		layer_8_attn_out_proj_gpu3 -> layer_8_residual1_gpu3
		layer_8_residual1_gpu3 -> layer_8_ln2_gpu3
		layer_8_ln2_gpu3 -> layer_8_router_gpu3
		layer_8_router_gpu3 -> layer_8_gate_gpu3
		layer_8_gate_gpu3 -> layer_8_expert_0_gpu3 [style=dashed]
		layer_8_gate_gpu3 -> layer_8_expert_1_gpu3 [style=dashed]
		layer_8_gate_gpu3 -> layer_8_expert_2_gpu3 [style=dashed]
		layer_8_gate_gpu3 -> layer_8_expert_3_gpu3 [style=dashed]
		layer_8_expert_0_gpu3 -> layer_8_expert_agg_gpu3
		layer_8_expert_1_gpu3 -> layer_8_expert_agg_gpu3
		layer_8_expert_2_gpu3 -> layer_8_expert_agg_gpu3
		layer_8_expert_3_gpu3 -> layer_8_expert_agg_gpu3
		layer_8_expert_agg_gpu3 -> layer_8_moe_out_proj_gpu3
		layer_8_moe_out_proj_gpu3 -> layer_8_residual2_gpu3
		layer_8_output_gpu3 [label="Layer 8 Output\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_8_residual2_gpu3 -> layer_8_output_gpu3
		layer_9_ln1_gpu3 [label="Layer 9 LayerNorm1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_9_q_proj_gpu3 [label="Layer 9 Q Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_k_proj_gpu3 [label="Layer 9 K Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_v_proj_gpu3 [label="Layer 9 V Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_attn_gpu3 [label="Layer 9 Scaled Dot-Product Attention\nGPU 3\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_attn_out_proj_gpu3 [label="Layer 9 Attention Output Projection\nGPU 3\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_residual1_gpu3 [label="Layer 9 Residual1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_9_ln2_gpu3 [label="Layer 9 LayerNorm2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_9_router_gpu3 [label="Layer 9 Router\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_9_gate_gpu3 [label="Layer 9 Gate Selection\nGPU 3\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_9_expert_0_gpu3 [label="Layer 9 Expert 0\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_1_gpu3 [label="Layer 9 Expert 1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_2_gpu3 [label="Layer 9 Expert 2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_3_gpu3 [label="Layer 9 Expert 3\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_agg_gpu3 [label="Layer 9 Expert Aggregation\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_9_moe_out_proj_gpu3 [label="Layer 9 MoE Output Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_residual2_gpu3 [label="Layer 9 Residual2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_8_output_gpu3 -> layer_9_ln1_gpu3
		layer_9_ln1_gpu3 -> layer_9_q_proj_gpu3
		layer_9_ln1_gpu3 -> layer_9_k_proj_gpu3
		layer_9_ln1_gpu3 -> layer_9_v_proj_gpu3
		layer_9_q_proj_gpu3 -> layer_9_attn_gpu3
		layer_9_k_proj_gpu3 -> layer_9_attn_gpu3
		layer_9_v_proj_gpu3 -> layer_9_attn_gpu3
		layer_9_attn_gpu3 -> layer_9_attn_out_proj_gpu3
		layer_9_attn_out_proj_gpu3 -> layer_9_residual1_gpu3
		layer_9_residual1_gpu3 -> layer_9_ln2_gpu3
		layer_9_ln2_gpu3 -> layer_9_router_gpu3
		layer_9_router_gpu3 -> layer_9_gate_gpu3
		layer_9_gate_gpu3 -> layer_9_expert_0_gpu3 [style=dashed]
		layer_9_gate_gpu3 -> layer_9_expert_1_gpu3 [style=dashed]
		layer_9_gate_gpu3 -> layer_9_expert_2_gpu3 [style=dashed]
		layer_9_gate_gpu3 -> layer_9_expert_3_gpu3 [style=dashed]
		layer_9_expert_0_gpu3 -> layer_9_expert_agg_gpu3
		layer_9_expert_1_gpu3 -> layer_9_expert_agg_gpu3
		layer_9_expert_2_gpu3 -> layer_9_expert_agg_gpu3
		layer_9_expert_3_gpu3 -> layer_9_expert_agg_gpu3
		layer_9_expert_agg_gpu3 -> layer_9_moe_out_proj_gpu3
		layer_9_moe_out_proj_gpu3 -> layer_9_residual2_gpu3
		layer_9_output_gpu3 [label="Layer 9 Output\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_9_residual2_gpu3 -> layer_9_output_gpu3
		layer_10_ln1_gpu3 [label="Layer 10 LayerNorm1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_10_q_proj_gpu3 [label="Layer 10 Q Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_k_proj_gpu3 [label="Layer 10 K Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_v_proj_gpu3 [label="Layer 10 V Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_attn_gpu3 [label="Layer 10 Scaled Dot-Product Attention\nGPU 3\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_attn_out_proj_gpu3 [label="Layer 10 Attention Output Projection\nGPU 3\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_residual1_gpu3 [label="Layer 10 Residual1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_10_ln2_gpu3 [label="Layer 10 LayerNorm2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_10_router_gpu3 [label="Layer 10 Router\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_10_gate_gpu3 [label="Layer 10 Gate Selection\nGPU 3\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_10_expert_0_gpu3 [label="Layer 10 Expert 0\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_1_gpu3 [label="Layer 10 Expert 1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_2_gpu3 [label="Layer 10 Expert 2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_3_gpu3 [label="Layer 10 Expert 3\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_agg_gpu3 [label="Layer 10 Expert Aggregation\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_10_moe_out_proj_gpu3 [label="Layer 10 MoE Output Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_residual2_gpu3 [label="Layer 10 Residual2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_9_output_gpu3 -> layer_10_ln1_gpu3
		layer_10_ln1_gpu3 -> layer_10_q_proj_gpu3
		layer_10_ln1_gpu3 -> layer_10_k_proj_gpu3
		layer_10_ln1_gpu3 -> layer_10_v_proj_gpu3
		layer_10_q_proj_gpu3 -> layer_10_attn_gpu3
		layer_10_k_proj_gpu3 -> layer_10_attn_gpu3
		layer_10_v_proj_gpu3 -> layer_10_attn_gpu3
		layer_10_attn_gpu3 -> layer_10_attn_out_proj_gpu3
		layer_10_attn_out_proj_gpu3 -> layer_10_residual1_gpu3
		layer_10_residual1_gpu3 -> layer_10_ln2_gpu3
		layer_10_ln2_gpu3 -> layer_10_router_gpu3
		layer_10_router_gpu3 -> layer_10_gate_gpu3
		layer_10_gate_gpu3 -> layer_10_expert_0_gpu3 [style=dashed]
		layer_10_gate_gpu3 -> layer_10_expert_1_gpu3 [style=dashed]
		layer_10_gate_gpu3 -> layer_10_expert_2_gpu3 [style=dashed]
		layer_10_gate_gpu3 -> layer_10_expert_3_gpu3 [style=dashed]
		layer_10_expert_0_gpu3 -> layer_10_expert_agg_gpu3
		layer_10_expert_1_gpu3 -> layer_10_expert_agg_gpu3
		layer_10_expert_2_gpu3 -> layer_10_expert_agg_gpu3
		layer_10_expert_3_gpu3 -> layer_10_expert_agg_gpu3
		layer_10_expert_agg_gpu3 -> layer_10_moe_out_proj_gpu3
		layer_10_moe_out_proj_gpu3 -> layer_10_residual2_gpu3
		layer_10_output_gpu3 [label="Layer 10 Output\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_10_residual2_gpu3 -> layer_10_output_gpu3
		layer_11_ln1_gpu3 [label="Layer 11 LayerNorm1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_11_q_proj_gpu3 [label="Layer 11 Q Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_k_proj_gpu3 [label="Layer 11 K Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_v_proj_gpu3 [label="Layer 11 V Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_attn_gpu3 [label="Layer 11 Scaled Dot-Product Attention\nGPU 3\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_attn_out_proj_gpu3 [label="Layer 11 Attention Output Projection\nGPU 3\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_residual1_gpu3 [label="Layer 11 Residual1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_11_ln2_gpu3 [label="Layer 11 LayerNorm2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_11_router_gpu3 [label="Layer 11 Router\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_11_gate_gpu3 [label="Layer 11 Gate Selection\nGPU 3\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_11_expert_0_gpu3 [label="Layer 11 Expert 0\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_1_gpu3 [label="Layer 11 Expert 1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_2_gpu3 [label="Layer 11 Expert 2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_3_gpu3 [label="Layer 11 Expert 3\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_agg_gpu3 [label="Layer 11 Expert Aggregation\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_11_moe_out_proj_gpu3 [label="Layer 11 MoE Output Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_residual2_gpu3 [label="Layer 11 Residual2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_10_output_gpu3 -> layer_11_ln1_gpu3
		layer_11_ln1_gpu3 -> layer_11_q_proj_gpu3
		layer_11_ln1_gpu3 -> layer_11_k_proj_gpu3
		layer_11_ln1_gpu3 -> layer_11_v_proj_gpu3
		layer_11_q_proj_gpu3 -> layer_11_attn_gpu3
		layer_11_k_proj_gpu3 -> layer_11_attn_gpu3
		layer_11_v_proj_gpu3 -> layer_11_attn_gpu3
		layer_11_attn_gpu3 -> layer_11_attn_out_proj_gpu3
		layer_11_attn_out_proj_gpu3 -> layer_11_residual1_gpu3
		layer_11_residual1_gpu3 -> layer_11_ln2_gpu3
		layer_11_ln2_gpu3 -> layer_11_router_gpu3
		layer_11_router_gpu3 -> layer_11_gate_gpu3
		layer_11_gate_gpu3 -> layer_11_expert_0_gpu3 [style=dashed]
		layer_11_gate_gpu3 -> layer_11_expert_1_gpu3 [style=dashed]
		layer_11_gate_gpu3 -> layer_11_expert_2_gpu3 [style=dashed]
		layer_11_gate_gpu3 -> layer_11_expert_3_gpu3 [style=dashed]
		layer_11_expert_0_gpu3 -> layer_11_expert_agg_gpu3
		layer_11_expert_1_gpu3 -> layer_11_expert_agg_gpu3
		layer_11_expert_2_gpu3 -> layer_11_expert_agg_gpu3
		layer_11_expert_3_gpu3 -> layer_11_expert_agg_gpu3
		layer_11_expert_agg_gpu3 -> layer_11_moe_out_proj_gpu3
		layer_11_moe_out_proj_gpu3 -> layer_11_residual2_gpu3
		layer_11_output_gpu3 [label="Layer 11 Output\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_11_residual2_gpu3 -> layer_11_output_gpu3
		layer_12_ln1_gpu3 [label="Layer 12 LayerNorm1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_12_q_proj_gpu3 [label="Layer 12 Q Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_k_proj_gpu3 [label="Layer 12 K Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_v_proj_gpu3 [label="Layer 12 V Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_attn_gpu3 [label="Layer 12 Scaled Dot-Product Attention\nGPU 3\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_attn_out_proj_gpu3 [label="Layer 12 Attention Output Projection\nGPU 3\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_residual1_gpu3 [label="Layer 12 Residual1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_12_ln2_gpu3 [label="Layer 12 LayerNorm2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_12_router_gpu3 [label="Layer 12 Router\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_12_gate_gpu3 [label="Layer 12 Gate Selection\nGPU 3\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_12_expert_0_gpu3 [label="Layer 12 Expert 0\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_1_gpu3 [label="Layer 12 Expert 1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_2_gpu3 [label="Layer 12 Expert 2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_3_gpu3 [label="Layer 12 Expert 3\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_agg_gpu3 [label="Layer 12 Expert Aggregation\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_12_moe_out_proj_gpu3 [label="Layer 12 MoE Output Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_residual2_gpu3 [label="Layer 12 Residual2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_11_output_gpu3 -> layer_12_ln1_gpu3
		layer_12_ln1_gpu3 -> layer_12_q_proj_gpu3
		layer_12_ln1_gpu3 -> layer_12_k_proj_gpu3
		layer_12_ln1_gpu3 -> layer_12_v_proj_gpu3
		layer_12_q_proj_gpu3 -> layer_12_attn_gpu3
		layer_12_k_proj_gpu3 -> layer_12_attn_gpu3
		layer_12_v_proj_gpu3 -> layer_12_attn_gpu3
		layer_12_attn_gpu3 -> layer_12_attn_out_proj_gpu3
		layer_12_attn_out_proj_gpu3 -> layer_12_residual1_gpu3
		layer_12_residual1_gpu3 -> layer_12_ln2_gpu3
		layer_12_ln2_gpu3 -> layer_12_router_gpu3
		layer_12_router_gpu3 -> layer_12_gate_gpu3
		layer_12_gate_gpu3 -> layer_12_expert_0_gpu3 [style=dashed]
		layer_12_gate_gpu3 -> layer_12_expert_1_gpu3 [style=dashed]
		layer_12_gate_gpu3 -> layer_12_expert_2_gpu3 [style=dashed]
		layer_12_gate_gpu3 -> layer_12_expert_3_gpu3 [style=dashed]
		layer_12_expert_0_gpu3 -> layer_12_expert_agg_gpu3
		layer_12_expert_1_gpu3 -> layer_12_expert_agg_gpu3
		layer_12_expert_2_gpu3 -> layer_12_expert_agg_gpu3
		layer_12_expert_3_gpu3 -> layer_12_expert_agg_gpu3
		layer_12_expert_agg_gpu3 -> layer_12_moe_out_proj_gpu3
		layer_12_moe_out_proj_gpu3 -> layer_12_residual2_gpu3
		layer_12_output_gpu3 [label="Layer 12 Output\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_12_residual2_gpu3 -> layer_12_output_gpu3
		layer_13_ln1_gpu3 [label="Layer 13 LayerNorm1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_13_q_proj_gpu3 [label="Layer 13 Q Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_k_proj_gpu3 [label="Layer 13 K Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_v_proj_gpu3 [label="Layer 13 V Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_attn_gpu3 [label="Layer 13 Scaled Dot-Product Attention\nGPU 3\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_attn_out_proj_gpu3 [label="Layer 13 Attention Output Projection\nGPU 3\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_residual1_gpu3 [label="Layer 13 Residual1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_13_ln2_gpu3 [label="Layer 13 LayerNorm2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_13_router_gpu3 [label="Layer 13 Router\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_13_gate_gpu3 [label="Layer 13 Gate Selection\nGPU 3\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_13_expert_0_gpu3 [label="Layer 13 Expert 0\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_1_gpu3 [label="Layer 13 Expert 1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_2_gpu3 [label="Layer 13 Expert 2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_3_gpu3 [label="Layer 13 Expert 3\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_agg_gpu3 [label="Layer 13 Expert Aggregation\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_13_moe_out_proj_gpu3 [label="Layer 13 MoE Output Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_residual2_gpu3 [label="Layer 13 Residual2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_12_output_gpu3 -> layer_13_ln1_gpu3
		layer_13_ln1_gpu3 -> layer_13_q_proj_gpu3
		layer_13_ln1_gpu3 -> layer_13_k_proj_gpu3
		layer_13_ln1_gpu3 -> layer_13_v_proj_gpu3
		layer_13_q_proj_gpu3 -> layer_13_attn_gpu3
		layer_13_k_proj_gpu3 -> layer_13_attn_gpu3
		layer_13_v_proj_gpu3 -> layer_13_attn_gpu3
		layer_13_attn_gpu3 -> layer_13_attn_out_proj_gpu3
		layer_13_attn_out_proj_gpu3 -> layer_13_residual1_gpu3
		layer_13_residual1_gpu3 -> layer_13_ln2_gpu3
		layer_13_ln2_gpu3 -> layer_13_router_gpu3
		layer_13_router_gpu3 -> layer_13_gate_gpu3
		layer_13_gate_gpu3 -> layer_13_expert_0_gpu3 [style=dashed]
		layer_13_gate_gpu3 -> layer_13_expert_1_gpu3 [style=dashed]
		layer_13_gate_gpu3 -> layer_13_expert_2_gpu3 [style=dashed]
		layer_13_gate_gpu3 -> layer_13_expert_3_gpu3 [style=dashed]
		layer_13_expert_0_gpu3 -> layer_13_expert_agg_gpu3
		layer_13_expert_1_gpu3 -> layer_13_expert_agg_gpu3
		layer_13_expert_2_gpu3 -> layer_13_expert_agg_gpu3
		layer_13_expert_3_gpu3 -> layer_13_expert_agg_gpu3
		layer_13_expert_agg_gpu3 -> layer_13_moe_out_proj_gpu3
		layer_13_moe_out_proj_gpu3 -> layer_13_residual2_gpu3
		layer_13_output_gpu3 [label="Layer 13 Output\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_13_residual2_gpu3 -> layer_13_output_gpu3
		layer_14_ln1_gpu3 [label="Layer 14 LayerNorm1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_14_q_proj_gpu3 [label="Layer 14 Q Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_k_proj_gpu3 [label="Layer 14 K Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_v_proj_gpu3 [label="Layer 14 V Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_attn_gpu3 [label="Layer 14 Scaled Dot-Product Attention\nGPU 3\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_attn_out_proj_gpu3 [label="Layer 14 Attention Output Projection\nGPU 3\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_residual1_gpu3 [label="Layer 14 Residual1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_14_ln2_gpu3 [label="Layer 14 LayerNorm2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_14_router_gpu3 [label="Layer 14 Router\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_14_gate_gpu3 [label="Layer 14 Gate Selection\nGPU 3\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_14_expert_0_gpu3 [label="Layer 14 Expert 0\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_1_gpu3 [label="Layer 14 Expert 1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_2_gpu3 [label="Layer 14 Expert 2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_3_gpu3 [label="Layer 14 Expert 3\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_agg_gpu3 [label="Layer 14 Expert Aggregation\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_14_moe_out_proj_gpu3 [label="Layer 14 MoE Output Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_residual2_gpu3 [label="Layer 14 Residual2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_13_output_gpu3 -> layer_14_ln1_gpu3
		layer_14_ln1_gpu3 -> layer_14_q_proj_gpu3
		layer_14_ln1_gpu3 -> layer_14_k_proj_gpu3
		layer_14_ln1_gpu3 -> layer_14_v_proj_gpu3
		layer_14_q_proj_gpu3 -> layer_14_attn_gpu3
		layer_14_k_proj_gpu3 -> layer_14_attn_gpu3
		layer_14_v_proj_gpu3 -> layer_14_attn_gpu3
		layer_14_attn_gpu3 -> layer_14_attn_out_proj_gpu3
		layer_14_attn_out_proj_gpu3 -> layer_14_residual1_gpu3
		layer_14_residual1_gpu3 -> layer_14_ln2_gpu3
		layer_14_ln2_gpu3 -> layer_14_router_gpu3
		layer_14_router_gpu3 -> layer_14_gate_gpu3
		layer_14_gate_gpu3 -> layer_14_expert_0_gpu3 [style=dashed]
		layer_14_gate_gpu3 -> layer_14_expert_1_gpu3 [style=dashed]
		layer_14_gate_gpu3 -> layer_14_expert_2_gpu3 [style=dashed]
		layer_14_gate_gpu3 -> layer_14_expert_3_gpu3 [style=dashed]
		layer_14_expert_0_gpu3 -> layer_14_expert_agg_gpu3
		layer_14_expert_1_gpu3 -> layer_14_expert_agg_gpu3
		layer_14_expert_2_gpu3 -> layer_14_expert_agg_gpu3
		layer_14_expert_3_gpu3 -> layer_14_expert_agg_gpu3
		layer_14_expert_agg_gpu3 -> layer_14_moe_out_proj_gpu3
		layer_14_moe_out_proj_gpu3 -> layer_14_residual2_gpu3
		layer_14_output_gpu3 [label="Layer 14 Output\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_14_residual2_gpu3 -> layer_14_output_gpu3
		layer_15_ln1_gpu3 [label="Layer 15 LayerNorm1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_15_q_proj_gpu3 [label="Layer 15 Q Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_k_proj_gpu3 [label="Layer 15 K Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_v_proj_gpu3 [label="Layer 15 V Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_attn_gpu3 [label="Layer 15 Scaled Dot-Product Attention\nGPU 3\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_attn_out_proj_gpu3 [label="Layer 15 Attention Output Projection\nGPU 3\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_residual1_gpu3 [label="Layer 15 Residual1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_15_ln2_gpu3 [label="Layer 15 LayerNorm2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_15_router_gpu3 [label="Layer 15 Router\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_15_gate_gpu3 [label="Layer 15 Gate Selection\nGPU 3\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_15_expert_0_gpu3 [label="Layer 15 Expert 0\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_1_gpu3 [label="Layer 15 Expert 1\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_2_gpu3 [label="Layer 15 Expert 2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_3_gpu3 [label="Layer 15 Expert 3\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_agg_gpu3 [label="Layer 15 Expert Aggregation\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_15_moe_out_proj_gpu3 [label="Layer 15 MoE Output Projection\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_residual2_gpu3 [label="Layer 15 Residual2\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_14_output_gpu3 -> layer_15_ln1_gpu3
		layer_15_ln1_gpu3 -> layer_15_q_proj_gpu3
		layer_15_ln1_gpu3 -> layer_15_k_proj_gpu3
		layer_15_ln1_gpu3 -> layer_15_v_proj_gpu3
		layer_15_q_proj_gpu3 -> layer_15_attn_gpu3
		layer_15_k_proj_gpu3 -> layer_15_attn_gpu3
		layer_15_v_proj_gpu3 -> layer_15_attn_gpu3
		layer_15_attn_gpu3 -> layer_15_attn_out_proj_gpu3
		layer_15_attn_out_proj_gpu3 -> layer_15_residual1_gpu3
		layer_15_residual1_gpu3 -> layer_15_ln2_gpu3
		layer_15_ln2_gpu3 -> layer_15_router_gpu3
		layer_15_router_gpu3 -> layer_15_gate_gpu3
		layer_15_gate_gpu3 -> layer_15_expert_0_gpu3 [style=dashed]
		layer_15_gate_gpu3 -> layer_15_expert_1_gpu3 [style=dashed]
		layer_15_gate_gpu3 -> layer_15_expert_2_gpu3 [style=dashed]
		layer_15_gate_gpu3 -> layer_15_expert_3_gpu3 [style=dashed]
		layer_15_expert_0_gpu3 -> layer_15_expert_agg_gpu3
		layer_15_expert_1_gpu3 -> layer_15_expert_agg_gpu3
		layer_15_expert_2_gpu3 -> layer_15_expert_agg_gpu3
		layer_15_expert_3_gpu3 -> layer_15_expert_agg_gpu3
		layer_15_expert_agg_gpu3 -> layer_15_moe_out_proj_gpu3
		layer_15_moe_out_proj_gpu3 -> layer_15_residual2_gpu3
		layer_15_output_gpu3 [label="Layer 15 Output\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_15_residual2_gpu3 -> layer_15_output_gpu3
		final_ln_gpu3 [label="Final Layer Norm\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		layer_15_output_gpu3 -> final_ln_gpu3
		lm_head_gpu3 [label="LM Head\nGPU 3\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, vocab_size]" fillcolor=lightcoral shape=rectangle style=filled]
		output_gpu3 [label="Output\nGPU 3\nInput: [batch=256, seq=512, vocab_size]\nOutput: [batch=256, seq=512, vocab_size]" fillcolor=lightgreen shape=ellipse style=filled]
		input_gpu3 -> embed_gpu3
		embed_gpu3 -> pos_enc_gpu3
		final_ln_gpu3 -> lm_head_gpu3
		lm_head_gpu3 -> output_gpu3
	}
	subgraph cluster_gpu_4 {
		color=blue fillcolor=lightblue label="GPU 4" style=rounded
		input_gpu4 [label="Input\nGPU 4\nInput: [batch=256, seq=512, dim=1024]\nOutput: [batch=256, seq=512, dim=1024]" fillcolor=lightgreen shape=ellipse style=filled]
		embed_gpu4 [label="Token Embedding\nGPU 4\nInput: [batch=256, seq=512]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		pos_enc_gpu4 [label="Position Encoding\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		layer_0_ln1_gpu4 [label="Layer 0 LayerNorm1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_0_q_proj_gpu4 [label="Layer 0 Q Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_k_proj_gpu4 [label="Layer 0 K Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_v_proj_gpu4 [label="Layer 0 V Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_attn_gpu4 [label="Layer 0 Scaled Dot-Product Attention\nGPU 4\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_attn_out_proj_gpu4 [label="Layer 0 Attention Output Projection\nGPU 4\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_residual1_gpu4 [label="Layer 0 Residual1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_0_ln2_gpu4 [label="Layer 0 LayerNorm2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_0_router_gpu4 [label="Layer 0 Router\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_0_gate_gpu4 [label="Layer 0 Gate Selection\nGPU 4\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_0_expert_0_gpu4 [label="Layer 0 Expert 0\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_1_gpu4 [label="Layer 0 Expert 1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_2_gpu4 [label="Layer 0 Expert 2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_3_gpu4 [label="Layer 0 Expert 3\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_agg_gpu4 [label="Layer 0 Expert Aggregation\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_0_moe_out_proj_gpu4 [label="Layer 0 MoE Output Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_residual2_gpu4 [label="Layer 0 Residual2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		pos_enc_gpu4 -> layer_0_ln1_gpu4
		layer_0_ln1_gpu4 -> layer_0_q_proj_gpu4
		layer_0_ln1_gpu4 -> layer_0_k_proj_gpu4
		layer_0_ln1_gpu4 -> layer_0_v_proj_gpu4
		layer_0_q_proj_gpu4 -> layer_0_attn_gpu4
		layer_0_k_proj_gpu4 -> layer_0_attn_gpu4
		layer_0_v_proj_gpu4 -> layer_0_attn_gpu4
		layer_0_attn_gpu4 -> layer_0_attn_out_proj_gpu4
		layer_0_attn_out_proj_gpu4 -> layer_0_residual1_gpu4
		layer_0_residual1_gpu4 -> layer_0_ln2_gpu4
		layer_0_ln2_gpu4 -> layer_0_router_gpu4
		layer_0_router_gpu4 -> layer_0_gate_gpu4
		layer_0_gate_gpu4 -> layer_0_expert_0_gpu4 [style=dashed]
		layer_0_gate_gpu4 -> layer_0_expert_1_gpu4 [style=dashed]
		layer_0_gate_gpu4 -> layer_0_expert_2_gpu4 [style=dashed]
		layer_0_gate_gpu4 -> layer_0_expert_3_gpu4 [style=dashed]
		layer_0_expert_0_gpu4 -> layer_0_expert_agg_gpu4
		layer_0_expert_1_gpu4 -> layer_0_expert_agg_gpu4
		layer_0_expert_2_gpu4 -> layer_0_expert_agg_gpu4
		layer_0_expert_3_gpu4 -> layer_0_expert_agg_gpu4
		layer_0_expert_agg_gpu4 -> layer_0_moe_out_proj_gpu4
		layer_0_moe_out_proj_gpu4 -> layer_0_residual2_gpu4
		layer_0_output_gpu4 [label="Layer 0 Output\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_0_residual2_gpu4 -> layer_0_output_gpu4
		layer_1_ln1_gpu4 [label="Layer 1 LayerNorm1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_1_q_proj_gpu4 [label="Layer 1 Q Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_k_proj_gpu4 [label="Layer 1 K Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_v_proj_gpu4 [label="Layer 1 V Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_attn_gpu4 [label="Layer 1 Scaled Dot-Product Attention\nGPU 4\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_attn_out_proj_gpu4 [label="Layer 1 Attention Output Projection\nGPU 4\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_residual1_gpu4 [label="Layer 1 Residual1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_1_ln2_gpu4 [label="Layer 1 LayerNorm2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_1_router_gpu4 [label="Layer 1 Router\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_1_gate_gpu4 [label="Layer 1 Gate Selection\nGPU 4\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_1_expert_0_gpu4 [label="Layer 1 Expert 0\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_1_gpu4 [label="Layer 1 Expert 1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_2_gpu4 [label="Layer 1 Expert 2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_3_gpu4 [label="Layer 1 Expert 3\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_agg_gpu4 [label="Layer 1 Expert Aggregation\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_1_moe_out_proj_gpu4 [label="Layer 1 MoE Output Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_residual2_gpu4 [label="Layer 1 Residual2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_0_output_gpu4 -> layer_1_ln1_gpu4
		layer_1_ln1_gpu4 -> layer_1_q_proj_gpu4
		layer_1_ln1_gpu4 -> layer_1_k_proj_gpu4
		layer_1_ln1_gpu4 -> layer_1_v_proj_gpu4
		layer_1_q_proj_gpu4 -> layer_1_attn_gpu4
		layer_1_k_proj_gpu4 -> layer_1_attn_gpu4
		layer_1_v_proj_gpu4 -> layer_1_attn_gpu4
		layer_1_attn_gpu4 -> layer_1_attn_out_proj_gpu4
		layer_1_attn_out_proj_gpu4 -> layer_1_residual1_gpu4
		layer_1_residual1_gpu4 -> layer_1_ln2_gpu4
		layer_1_ln2_gpu4 -> layer_1_router_gpu4
		layer_1_router_gpu4 -> layer_1_gate_gpu4
		layer_1_gate_gpu4 -> layer_1_expert_0_gpu4 [style=dashed]
		layer_1_gate_gpu4 -> layer_1_expert_1_gpu4 [style=dashed]
		layer_1_gate_gpu4 -> layer_1_expert_2_gpu4 [style=dashed]
		layer_1_gate_gpu4 -> layer_1_expert_3_gpu4 [style=dashed]
		layer_1_expert_0_gpu4 -> layer_1_expert_agg_gpu4
		layer_1_expert_1_gpu4 -> layer_1_expert_agg_gpu4
		layer_1_expert_2_gpu4 -> layer_1_expert_agg_gpu4
		layer_1_expert_3_gpu4 -> layer_1_expert_agg_gpu4
		layer_1_expert_agg_gpu4 -> layer_1_moe_out_proj_gpu4
		layer_1_moe_out_proj_gpu4 -> layer_1_residual2_gpu4
		layer_1_output_gpu4 [label="Layer 1 Output\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_1_residual2_gpu4 -> layer_1_output_gpu4
		layer_2_ln1_gpu4 [label="Layer 2 LayerNorm1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_2_q_proj_gpu4 [label="Layer 2 Q Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_k_proj_gpu4 [label="Layer 2 K Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_v_proj_gpu4 [label="Layer 2 V Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_attn_gpu4 [label="Layer 2 Scaled Dot-Product Attention\nGPU 4\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_attn_out_proj_gpu4 [label="Layer 2 Attention Output Projection\nGPU 4\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_residual1_gpu4 [label="Layer 2 Residual1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_2_ln2_gpu4 [label="Layer 2 LayerNorm2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_2_router_gpu4 [label="Layer 2 Router\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_2_gate_gpu4 [label="Layer 2 Gate Selection\nGPU 4\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_2_expert_0_gpu4 [label="Layer 2 Expert 0\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_1_gpu4 [label="Layer 2 Expert 1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_2_gpu4 [label="Layer 2 Expert 2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_3_gpu4 [label="Layer 2 Expert 3\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_agg_gpu4 [label="Layer 2 Expert Aggregation\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_2_moe_out_proj_gpu4 [label="Layer 2 MoE Output Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_residual2_gpu4 [label="Layer 2 Residual2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_1_output_gpu4 -> layer_2_ln1_gpu4
		layer_2_ln1_gpu4 -> layer_2_q_proj_gpu4
		layer_2_ln1_gpu4 -> layer_2_k_proj_gpu4
		layer_2_ln1_gpu4 -> layer_2_v_proj_gpu4
		layer_2_q_proj_gpu4 -> layer_2_attn_gpu4
		layer_2_k_proj_gpu4 -> layer_2_attn_gpu4
		layer_2_v_proj_gpu4 -> layer_2_attn_gpu4
		layer_2_attn_gpu4 -> layer_2_attn_out_proj_gpu4
		layer_2_attn_out_proj_gpu4 -> layer_2_residual1_gpu4
		layer_2_residual1_gpu4 -> layer_2_ln2_gpu4
		layer_2_ln2_gpu4 -> layer_2_router_gpu4
		layer_2_router_gpu4 -> layer_2_gate_gpu4
		layer_2_gate_gpu4 -> layer_2_expert_0_gpu4 [style=dashed]
		layer_2_gate_gpu4 -> layer_2_expert_1_gpu4 [style=dashed]
		layer_2_gate_gpu4 -> layer_2_expert_2_gpu4 [style=dashed]
		layer_2_gate_gpu4 -> layer_2_expert_3_gpu4 [style=dashed]
		layer_2_expert_0_gpu4 -> layer_2_expert_agg_gpu4
		layer_2_expert_1_gpu4 -> layer_2_expert_agg_gpu4
		layer_2_expert_2_gpu4 -> layer_2_expert_agg_gpu4
		layer_2_expert_3_gpu4 -> layer_2_expert_agg_gpu4
		layer_2_expert_agg_gpu4 -> layer_2_moe_out_proj_gpu4
		layer_2_moe_out_proj_gpu4 -> layer_2_residual2_gpu4
		layer_2_output_gpu4 [label="Layer 2 Output\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_2_residual2_gpu4 -> layer_2_output_gpu4
		layer_3_ln1_gpu4 [label="Layer 3 LayerNorm1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_3_q_proj_gpu4 [label="Layer 3 Q Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_k_proj_gpu4 [label="Layer 3 K Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_v_proj_gpu4 [label="Layer 3 V Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_attn_gpu4 [label="Layer 3 Scaled Dot-Product Attention\nGPU 4\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_attn_out_proj_gpu4 [label="Layer 3 Attention Output Projection\nGPU 4\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_residual1_gpu4 [label="Layer 3 Residual1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_3_ln2_gpu4 [label="Layer 3 LayerNorm2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_3_router_gpu4 [label="Layer 3 Router\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_3_gate_gpu4 [label="Layer 3 Gate Selection\nGPU 4\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_3_expert_0_gpu4 [label="Layer 3 Expert 0\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_1_gpu4 [label="Layer 3 Expert 1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_2_gpu4 [label="Layer 3 Expert 2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_3_gpu4 [label="Layer 3 Expert 3\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_agg_gpu4 [label="Layer 3 Expert Aggregation\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_3_moe_out_proj_gpu4 [label="Layer 3 MoE Output Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_residual2_gpu4 [label="Layer 3 Residual2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_2_output_gpu4 -> layer_3_ln1_gpu4
		layer_3_ln1_gpu4 -> layer_3_q_proj_gpu4
		layer_3_ln1_gpu4 -> layer_3_k_proj_gpu4
		layer_3_ln1_gpu4 -> layer_3_v_proj_gpu4
		layer_3_q_proj_gpu4 -> layer_3_attn_gpu4
		layer_3_k_proj_gpu4 -> layer_3_attn_gpu4
		layer_3_v_proj_gpu4 -> layer_3_attn_gpu4
		layer_3_attn_gpu4 -> layer_3_attn_out_proj_gpu4
		layer_3_attn_out_proj_gpu4 -> layer_3_residual1_gpu4
		layer_3_residual1_gpu4 -> layer_3_ln2_gpu4
		layer_3_ln2_gpu4 -> layer_3_router_gpu4
		layer_3_router_gpu4 -> layer_3_gate_gpu4
		layer_3_gate_gpu4 -> layer_3_expert_0_gpu4 [style=dashed]
		layer_3_gate_gpu4 -> layer_3_expert_1_gpu4 [style=dashed]
		layer_3_gate_gpu4 -> layer_3_expert_2_gpu4 [style=dashed]
		layer_3_gate_gpu4 -> layer_3_expert_3_gpu4 [style=dashed]
		layer_3_expert_0_gpu4 -> layer_3_expert_agg_gpu4
		layer_3_expert_1_gpu4 -> layer_3_expert_agg_gpu4
		layer_3_expert_2_gpu4 -> layer_3_expert_agg_gpu4
		layer_3_expert_3_gpu4 -> layer_3_expert_agg_gpu4
		layer_3_expert_agg_gpu4 -> layer_3_moe_out_proj_gpu4
		layer_3_moe_out_proj_gpu4 -> layer_3_residual2_gpu4
		layer_3_output_gpu4 [label="Layer 3 Output\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_3_residual2_gpu4 -> layer_3_output_gpu4
		layer_4_ln1_gpu4 [label="Layer 4 LayerNorm1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_4_q_proj_gpu4 [label="Layer 4 Q Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_k_proj_gpu4 [label="Layer 4 K Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_v_proj_gpu4 [label="Layer 4 V Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_attn_gpu4 [label="Layer 4 Scaled Dot-Product Attention\nGPU 4\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_attn_out_proj_gpu4 [label="Layer 4 Attention Output Projection\nGPU 4\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_residual1_gpu4 [label="Layer 4 Residual1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_4_ln2_gpu4 [label="Layer 4 LayerNorm2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_4_router_gpu4 [label="Layer 4 Router\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_4_gate_gpu4 [label="Layer 4 Gate Selection\nGPU 4\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_4_expert_0_gpu4 [label="Layer 4 Expert 0\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_1_gpu4 [label="Layer 4 Expert 1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_2_gpu4 [label="Layer 4 Expert 2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_3_gpu4 [label="Layer 4 Expert 3\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_agg_gpu4 [label="Layer 4 Expert Aggregation\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_4_moe_out_proj_gpu4 [label="Layer 4 MoE Output Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_residual2_gpu4 [label="Layer 4 Residual2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_3_output_gpu4 -> layer_4_ln1_gpu4
		layer_4_ln1_gpu4 -> layer_4_q_proj_gpu4
		layer_4_ln1_gpu4 -> layer_4_k_proj_gpu4
		layer_4_ln1_gpu4 -> layer_4_v_proj_gpu4
		layer_4_q_proj_gpu4 -> layer_4_attn_gpu4
		layer_4_k_proj_gpu4 -> layer_4_attn_gpu4
		layer_4_v_proj_gpu4 -> layer_4_attn_gpu4
		layer_4_attn_gpu4 -> layer_4_attn_out_proj_gpu4
		layer_4_attn_out_proj_gpu4 -> layer_4_residual1_gpu4
		layer_4_residual1_gpu4 -> layer_4_ln2_gpu4
		layer_4_ln2_gpu4 -> layer_4_router_gpu4
		layer_4_router_gpu4 -> layer_4_gate_gpu4
		layer_4_gate_gpu4 -> layer_4_expert_0_gpu4 [style=dashed]
		layer_4_gate_gpu4 -> layer_4_expert_1_gpu4 [style=dashed]
		layer_4_gate_gpu4 -> layer_4_expert_2_gpu4 [style=dashed]
		layer_4_gate_gpu4 -> layer_4_expert_3_gpu4 [style=dashed]
		layer_4_expert_0_gpu4 -> layer_4_expert_agg_gpu4
		layer_4_expert_1_gpu4 -> layer_4_expert_agg_gpu4
		layer_4_expert_2_gpu4 -> layer_4_expert_agg_gpu4
		layer_4_expert_3_gpu4 -> layer_4_expert_agg_gpu4
		layer_4_expert_agg_gpu4 -> layer_4_moe_out_proj_gpu4
		layer_4_moe_out_proj_gpu4 -> layer_4_residual2_gpu4
		layer_4_output_gpu4 [label="Layer 4 Output\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_4_residual2_gpu4 -> layer_4_output_gpu4
		layer_5_ln1_gpu4 [label="Layer 5 LayerNorm1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_5_q_proj_gpu4 [label="Layer 5 Q Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_k_proj_gpu4 [label="Layer 5 K Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_v_proj_gpu4 [label="Layer 5 V Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_attn_gpu4 [label="Layer 5 Scaled Dot-Product Attention\nGPU 4\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_attn_out_proj_gpu4 [label="Layer 5 Attention Output Projection\nGPU 4\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_residual1_gpu4 [label="Layer 5 Residual1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_5_ln2_gpu4 [label="Layer 5 LayerNorm2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_5_router_gpu4 [label="Layer 5 Router\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_5_gate_gpu4 [label="Layer 5 Gate Selection\nGPU 4\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_5_expert_0_gpu4 [label="Layer 5 Expert 0\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_1_gpu4 [label="Layer 5 Expert 1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_2_gpu4 [label="Layer 5 Expert 2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_3_gpu4 [label="Layer 5 Expert 3\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_agg_gpu4 [label="Layer 5 Expert Aggregation\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_5_moe_out_proj_gpu4 [label="Layer 5 MoE Output Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_residual2_gpu4 [label="Layer 5 Residual2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_4_output_gpu4 -> layer_5_ln1_gpu4
		layer_5_ln1_gpu4 -> layer_5_q_proj_gpu4
		layer_5_ln1_gpu4 -> layer_5_k_proj_gpu4
		layer_5_ln1_gpu4 -> layer_5_v_proj_gpu4
		layer_5_q_proj_gpu4 -> layer_5_attn_gpu4
		layer_5_k_proj_gpu4 -> layer_5_attn_gpu4
		layer_5_v_proj_gpu4 -> layer_5_attn_gpu4
		layer_5_attn_gpu4 -> layer_5_attn_out_proj_gpu4
		layer_5_attn_out_proj_gpu4 -> layer_5_residual1_gpu4
		layer_5_residual1_gpu4 -> layer_5_ln2_gpu4
		layer_5_ln2_gpu4 -> layer_5_router_gpu4
		layer_5_router_gpu4 -> layer_5_gate_gpu4
		layer_5_gate_gpu4 -> layer_5_expert_0_gpu4 [style=dashed]
		layer_5_gate_gpu4 -> layer_5_expert_1_gpu4 [style=dashed]
		layer_5_gate_gpu4 -> layer_5_expert_2_gpu4 [style=dashed]
		layer_5_gate_gpu4 -> layer_5_expert_3_gpu4 [style=dashed]
		layer_5_expert_0_gpu4 -> layer_5_expert_agg_gpu4
		layer_5_expert_1_gpu4 -> layer_5_expert_agg_gpu4
		layer_5_expert_2_gpu4 -> layer_5_expert_agg_gpu4
		layer_5_expert_3_gpu4 -> layer_5_expert_agg_gpu4
		layer_5_expert_agg_gpu4 -> layer_5_moe_out_proj_gpu4
		layer_5_moe_out_proj_gpu4 -> layer_5_residual2_gpu4
		layer_5_output_gpu4 [label="Layer 5 Output\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_5_residual2_gpu4 -> layer_5_output_gpu4
		layer_6_ln1_gpu4 [label="Layer 6 LayerNorm1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_6_q_proj_gpu4 [label="Layer 6 Q Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_k_proj_gpu4 [label="Layer 6 K Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_v_proj_gpu4 [label="Layer 6 V Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_attn_gpu4 [label="Layer 6 Scaled Dot-Product Attention\nGPU 4\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_attn_out_proj_gpu4 [label="Layer 6 Attention Output Projection\nGPU 4\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_residual1_gpu4 [label="Layer 6 Residual1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_6_ln2_gpu4 [label="Layer 6 LayerNorm2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_6_router_gpu4 [label="Layer 6 Router\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_6_gate_gpu4 [label="Layer 6 Gate Selection\nGPU 4\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_6_expert_0_gpu4 [label="Layer 6 Expert 0\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_1_gpu4 [label="Layer 6 Expert 1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_2_gpu4 [label="Layer 6 Expert 2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_3_gpu4 [label="Layer 6 Expert 3\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_agg_gpu4 [label="Layer 6 Expert Aggregation\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_6_moe_out_proj_gpu4 [label="Layer 6 MoE Output Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_residual2_gpu4 [label="Layer 6 Residual2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_5_output_gpu4 -> layer_6_ln1_gpu4
		layer_6_ln1_gpu4 -> layer_6_q_proj_gpu4
		layer_6_ln1_gpu4 -> layer_6_k_proj_gpu4
		layer_6_ln1_gpu4 -> layer_6_v_proj_gpu4
		layer_6_q_proj_gpu4 -> layer_6_attn_gpu4
		layer_6_k_proj_gpu4 -> layer_6_attn_gpu4
		layer_6_v_proj_gpu4 -> layer_6_attn_gpu4
		layer_6_attn_gpu4 -> layer_6_attn_out_proj_gpu4
		layer_6_attn_out_proj_gpu4 -> layer_6_residual1_gpu4
		layer_6_residual1_gpu4 -> layer_6_ln2_gpu4
		layer_6_ln2_gpu4 -> layer_6_router_gpu4
		layer_6_router_gpu4 -> layer_6_gate_gpu4
		layer_6_gate_gpu4 -> layer_6_expert_0_gpu4 [style=dashed]
		layer_6_gate_gpu4 -> layer_6_expert_1_gpu4 [style=dashed]
		layer_6_gate_gpu4 -> layer_6_expert_2_gpu4 [style=dashed]
		layer_6_gate_gpu4 -> layer_6_expert_3_gpu4 [style=dashed]
		layer_6_expert_0_gpu4 -> layer_6_expert_agg_gpu4
		layer_6_expert_1_gpu4 -> layer_6_expert_agg_gpu4
		layer_6_expert_2_gpu4 -> layer_6_expert_agg_gpu4
		layer_6_expert_3_gpu4 -> layer_6_expert_agg_gpu4
		layer_6_expert_agg_gpu4 -> layer_6_moe_out_proj_gpu4
		layer_6_moe_out_proj_gpu4 -> layer_6_residual2_gpu4
		layer_6_output_gpu4 [label="Layer 6 Output\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_6_residual2_gpu4 -> layer_6_output_gpu4
		layer_7_ln1_gpu4 [label="Layer 7 LayerNorm1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_7_q_proj_gpu4 [label="Layer 7 Q Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_k_proj_gpu4 [label="Layer 7 K Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_v_proj_gpu4 [label="Layer 7 V Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_attn_gpu4 [label="Layer 7 Scaled Dot-Product Attention\nGPU 4\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_attn_out_proj_gpu4 [label="Layer 7 Attention Output Projection\nGPU 4\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_residual1_gpu4 [label="Layer 7 Residual1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_7_ln2_gpu4 [label="Layer 7 LayerNorm2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_7_router_gpu4 [label="Layer 7 Router\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_7_gate_gpu4 [label="Layer 7 Gate Selection\nGPU 4\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_7_expert_0_gpu4 [label="Layer 7 Expert 0\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_1_gpu4 [label="Layer 7 Expert 1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_2_gpu4 [label="Layer 7 Expert 2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_3_gpu4 [label="Layer 7 Expert 3\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_agg_gpu4 [label="Layer 7 Expert Aggregation\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_7_moe_out_proj_gpu4 [label="Layer 7 MoE Output Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_residual2_gpu4 [label="Layer 7 Residual2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_6_output_gpu4 -> layer_7_ln1_gpu4
		layer_7_ln1_gpu4 -> layer_7_q_proj_gpu4
		layer_7_ln1_gpu4 -> layer_7_k_proj_gpu4
		layer_7_ln1_gpu4 -> layer_7_v_proj_gpu4
		layer_7_q_proj_gpu4 -> layer_7_attn_gpu4
		layer_7_k_proj_gpu4 -> layer_7_attn_gpu4
		layer_7_v_proj_gpu4 -> layer_7_attn_gpu4
		layer_7_attn_gpu4 -> layer_7_attn_out_proj_gpu4
		layer_7_attn_out_proj_gpu4 -> layer_7_residual1_gpu4
		layer_7_residual1_gpu4 -> layer_7_ln2_gpu4
		layer_7_ln2_gpu4 -> layer_7_router_gpu4
		layer_7_router_gpu4 -> layer_7_gate_gpu4
		layer_7_gate_gpu4 -> layer_7_expert_0_gpu4 [style=dashed]
		layer_7_gate_gpu4 -> layer_7_expert_1_gpu4 [style=dashed]
		layer_7_gate_gpu4 -> layer_7_expert_2_gpu4 [style=dashed]
		layer_7_gate_gpu4 -> layer_7_expert_3_gpu4 [style=dashed]
		layer_7_expert_0_gpu4 -> layer_7_expert_agg_gpu4
		layer_7_expert_1_gpu4 -> layer_7_expert_agg_gpu4
		layer_7_expert_2_gpu4 -> layer_7_expert_agg_gpu4
		layer_7_expert_3_gpu4 -> layer_7_expert_agg_gpu4
		layer_7_expert_agg_gpu4 -> layer_7_moe_out_proj_gpu4
		layer_7_moe_out_proj_gpu4 -> layer_7_residual2_gpu4
		layer_7_output_gpu4 [label="Layer 7 Output\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_7_residual2_gpu4 -> layer_7_output_gpu4
		layer_8_ln1_gpu4 [label="Layer 8 LayerNorm1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_8_q_proj_gpu4 [label="Layer 8 Q Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_k_proj_gpu4 [label="Layer 8 K Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_v_proj_gpu4 [label="Layer 8 V Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_attn_gpu4 [label="Layer 8 Scaled Dot-Product Attention\nGPU 4\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_attn_out_proj_gpu4 [label="Layer 8 Attention Output Projection\nGPU 4\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_residual1_gpu4 [label="Layer 8 Residual1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_8_ln2_gpu4 [label="Layer 8 LayerNorm2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_8_router_gpu4 [label="Layer 8 Router\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_8_gate_gpu4 [label="Layer 8 Gate Selection\nGPU 4\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_8_expert_0_gpu4 [label="Layer 8 Expert 0\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_1_gpu4 [label="Layer 8 Expert 1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_2_gpu4 [label="Layer 8 Expert 2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_3_gpu4 [label="Layer 8 Expert 3\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_agg_gpu4 [label="Layer 8 Expert Aggregation\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_8_moe_out_proj_gpu4 [label="Layer 8 MoE Output Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_residual2_gpu4 [label="Layer 8 Residual2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_7_output_gpu4 -> layer_8_ln1_gpu4
		layer_8_ln1_gpu4 -> layer_8_q_proj_gpu4
		layer_8_ln1_gpu4 -> layer_8_k_proj_gpu4
		layer_8_ln1_gpu4 -> layer_8_v_proj_gpu4
		layer_8_q_proj_gpu4 -> layer_8_attn_gpu4
		layer_8_k_proj_gpu4 -> layer_8_attn_gpu4
		layer_8_v_proj_gpu4 -> layer_8_attn_gpu4
		layer_8_attn_gpu4 -> layer_8_attn_out_proj_gpu4
		layer_8_attn_out_proj_gpu4 -> layer_8_residual1_gpu4
		layer_8_residual1_gpu4 -> layer_8_ln2_gpu4
		layer_8_ln2_gpu4 -> layer_8_router_gpu4
		layer_8_router_gpu4 -> layer_8_gate_gpu4
		layer_8_gate_gpu4 -> layer_8_expert_0_gpu4 [style=dashed]
		layer_8_gate_gpu4 -> layer_8_expert_1_gpu4 [style=dashed]
		layer_8_gate_gpu4 -> layer_8_expert_2_gpu4 [style=dashed]
		layer_8_gate_gpu4 -> layer_8_expert_3_gpu4 [style=dashed]
		layer_8_expert_0_gpu4 -> layer_8_expert_agg_gpu4
		layer_8_expert_1_gpu4 -> layer_8_expert_agg_gpu4
		layer_8_expert_2_gpu4 -> layer_8_expert_agg_gpu4
		layer_8_expert_3_gpu4 -> layer_8_expert_agg_gpu4
		layer_8_expert_agg_gpu4 -> layer_8_moe_out_proj_gpu4
		layer_8_moe_out_proj_gpu4 -> layer_8_residual2_gpu4
		layer_8_output_gpu4 [label="Layer 8 Output\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_8_residual2_gpu4 -> layer_8_output_gpu4
		layer_9_ln1_gpu4 [label="Layer 9 LayerNorm1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_9_q_proj_gpu4 [label="Layer 9 Q Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_k_proj_gpu4 [label="Layer 9 K Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_v_proj_gpu4 [label="Layer 9 V Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_attn_gpu4 [label="Layer 9 Scaled Dot-Product Attention\nGPU 4\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_attn_out_proj_gpu4 [label="Layer 9 Attention Output Projection\nGPU 4\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_residual1_gpu4 [label="Layer 9 Residual1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_9_ln2_gpu4 [label="Layer 9 LayerNorm2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_9_router_gpu4 [label="Layer 9 Router\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_9_gate_gpu4 [label="Layer 9 Gate Selection\nGPU 4\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_9_expert_0_gpu4 [label="Layer 9 Expert 0\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_1_gpu4 [label="Layer 9 Expert 1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_2_gpu4 [label="Layer 9 Expert 2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_3_gpu4 [label="Layer 9 Expert 3\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_agg_gpu4 [label="Layer 9 Expert Aggregation\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_9_moe_out_proj_gpu4 [label="Layer 9 MoE Output Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_residual2_gpu4 [label="Layer 9 Residual2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_8_output_gpu4 -> layer_9_ln1_gpu4
		layer_9_ln1_gpu4 -> layer_9_q_proj_gpu4
		layer_9_ln1_gpu4 -> layer_9_k_proj_gpu4
		layer_9_ln1_gpu4 -> layer_9_v_proj_gpu4
		layer_9_q_proj_gpu4 -> layer_9_attn_gpu4
		layer_9_k_proj_gpu4 -> layer_9_attn_gpu4
		layer_9_v_proj_gpu4 -> layer_9_attn_gpu4
		layer_9_attn_gpu4 -> layer_9_attn_out_proj_gpu4
		layer_9_attn_out_proj_gpu4 -> layer_9_residual1_gpu4
		layer_9_residual1_gpu4 -> layer_9_ln2_gpu4
		layer_9_ln2_gpu4 -> layer_9_router_gpu4
		layer_9_router_gpu4 -> layer_9_gate_gpu4
		layer_9_gate_gpu4 -> layer_9_expert_0_gpu4 [style=dashed]
		layer_9_gate_gpu4 -> layer_9_expert_1_gpu4 [style=dashed]
		layer_9_gate_gpu4 -> layer_9_expert_2_gpu4 [style=dashed]
		layer_9_gate_gpu4 -> layer_9_expert_3_gpu4 [style=dashed]
		layer_9_expert_0_gpu4 -> layer_9_expert_agg_gpu4
		layer_9_expert_1_gpu4 -> layer_9_expert_agg_gpu4
		layer_9_expert_2_gpu4 -> layer_9_expert_agg_gpu4
		layer_9_expert_3_gpu4 -> layer_9_expert_agg_gpu4
		layer_9_expert_agg_gpu4 -> layer_9_moe_out_proj_gpu4
		layer_9_moe_out_proj_gpu4 -> layer_9_residual2_gpu4
		layer_9_output_gpu4 [label="Layer 9 Output\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_9_residual2_gpu4 -> layer_9_output_gpu4
		layer_10_ln1_gpu4 [label="Layer 10 LayerNorm1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_10_q_proj_gpu4 [label="Layer 10 Q Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_k_proj_gpu4 [label="Layer 10 K Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_v_proj_gpu4 [label="Layer 10 V Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_attn_gpu4 [label="Layer 10 Scaled Dot-Product Attention\nGPU 4\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_attn_out_proj_gpu4 [label="Layer 10 Attention Output Projection\nGPU 4\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_residual1_gpu4 [label="Layer 10 Residual1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_10_ln2_gpu4 [label="Layer 10 LayerNorm2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_10_router_gpu4 [label="Layer 10 Router\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_10_gate_gpu4 [label="Layer 10 Gate Selection\nGPU 4\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_10_expert_0_gpu4 [label="Layer 10 Expert 0\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_1_gpu4 [label="Layer 10 Expert 1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_2_gpu4 [label="Layer 10 Expert 2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_3_gpu4 [label="Layer 10 Expert 3\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_agg_gpu4 [label="Layer 10 Expert Aggregation\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_10_moe_out_proj_gpu4 [label="Layer 10 MoE Output Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_residual2_gpu4 [label="Layer 10 Residual2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_9_output_gpu4 -> layer_10_ln1_gpu4
		layer_10_ln1_gpu4 -> layer_10_q_proj_gpu4
		layer_10_ln1_gpu4 -> layer_10_k_proj_gpu4
		layer_10_ln1_gpu4 -> layer_10_v_proj_gpu4
		layer_10_q_proj_gpu4 -> layer_10_attn_gpu4
		layer_10_k_proj_gpu4 -> layer_10_attn_gpu4
		layer_10_v_proj_gpu4 -> layer_10_attn_gpu4
		layer_10_attn_gpu4 -> layer_10_attn_out_proj_gpu4
		layer_10_attn_out_proj_gpu4 -> layer_10_residual1_gpu4
		layer_10_residual1_gpu4 -> layer_10_ln2_gpu4
		layer_10_ln2_gpu4 -> layer_10_router_gpu4
		layer_10_router_gpu4 -> layer_10_gate_gpu4
		layer_10_gate_gpu4 -> layer_10_expert_0_gpu4 [style=dashed]
		layer_10_gate_gpu4 -> layer_10_expert_1_gpu4 [style=dashed]
		layer_10_gate_gpu4 -> layer_10_expert_2_gpu4 [style=dashed]
		layer_10_gate_gpu4 -> layer_10_expert_3_gpu4 [style=dashed]
		layer_10_expert_0_gpu4 -> layer_10_expert_agg_gpu4
		layer_10_expert_1_gpu4 -> layer_10_expert_agg_gpu4
		layer_10_expert_2_gpu4 -> layer_10_expert_agg_gpu4
		layer_10_expert_3_gpu4 -> layer_10_expert_agg_gpu4
		layer_10_expert_agg_gpu4 -> layer_10_moe_out_proj_gpu4
		layer_10_moe_out_proj_gpu4 -> layer_10_residual2_gpu4
		layer_10_output_gpu4 [label="Layer 10 Output\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_10_residual2_gpu4 -> layer_10_output_gpu4
		layer_11_ln1_gpu4 [label="Layer 11 LayerNorm1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_11_q_proj_gpu4 [label="Layer 11 Q Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_k_proj_gpu4 [label="Layer 11 K Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_v_proj_gpu4 [label="Layer 11 V Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_attn_gpu4 [label="Layer 11 Scaled Dot-Product Attention\nGPU 4\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_attn_out_proj_gpu4 [label="Layer 11 Attention Output Projection\nGPU 4\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_residual1_gpu4 [label="Layer 11 Residual1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_11_ln2_gpu4 [label="Layer 11 LayerNorm2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_11_router_gpu4 [label="Layer 11 Router\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_11_gate_gpu4 [label="Layer 11 Gate Selection\nGPU 4\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_11_expert_0_gpu4 [label="Layer 11 Expert 0\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_1_gpu4 [label="Layer 11 Expert 1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_2_gpu4 [label="Layer 11 Expert 2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_3_gpu4 [label="Layer 11 Expert 3\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_agg_gpu4 [label="Layer 11 Expert Aggregation\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_11_moe_out_proj_gpu4 [label="Layer 11 MoE Output Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_residual2_gpu4 [label="Layer 11 Residual2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_10_output_gpu4 -> layer_11_ln1_gpu4
		layer_11_ln1_gpu4 -> layer_11_q_proj_gpu4
		layer_11_ln1_gpu4 -> layer_11_k_proj_gpu4
		layer_11_ln1_gpu4 -> layer_11_v_proj_gpu4
		layer_11_q_proj_gpu4 -> layer_11_attn_gpu4
		layer_11_k_proj_gpu4 -> layer_11_attn_gpu4
		layer_11_v_proj_gpu4 -> layer_11_attn_gpu4
		layer_11_attn_gpu4 -> layer_11_attn_out_proj_gpu4
		layer_11_attn_out_proj_gpu4 -> layer_11_residual1_gpu4
		layer_11_residual1_gpu4 -> layer_11_ln2_gpu4
		layer_11_ln2_gpu4 -> layer_11_router_gpu4
		layer_11_router_gpu4 -> layer_11_gate_gpu4
		layer_11_gate_gpu4 -> layer_11_expert_0_gpu4 [style=dashed]
		layer_11_gate_gpu4 -> layer_11_expert_1_gpu4 [style=dashed]
		layer_11_gate_gpu4 -> layer_11_expert_2_gpu4 [style=dashed]
		layer_11_gate_gpu4 -> layer_11_expert_3_gpu4 [style=dashed]
		layer_11_expert_0_gpu4 -> layer_11_expert_agg_gpu4
		layer_11_expert_1_gpu4 -> layer_11_expert_agg_gpu4
		layer_11_expert_2_gpu4 -> layer_11_expert_agg_gpu4
		layer_11_expert_3_gpu4 -> layer_11_expert_agg_gpu4
		layer_11_expert_agg_gpu4 -> layer_11_moe_out_proj_gpu4
		layer_11_moe_out_proj_gpu4 -> layer_11_residual2_gpu4
		layer_11_output_gpu4 [label="Layer 11 Output\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_11_residual2_gpu4 -> layer_11_output_gpu4
		layer_12_ln1_gpu4 [label="Layer 12 LayerNorm1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_12_q_proj_gpu4 [label="Layer 12 Q Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_k_proj_gpu4 [label="Layer 12 K Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_v_proj_gpu4 [label="Layer 12 V Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_attn_gpu4 [label="Layer 12 Scaled Dot-Product Attention\nGPU 4\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_attn_out_proj_gpu4 [label="Layer 12 Attention Output Projection\nGPU 4\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_residual1_gpu4 [label="Layer 12 Residual1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_12_ln2_gpu4 [label="Layer 12 LayerNorm2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_12_router_gpu4 [label="Layer 12 Router\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_12_gate_gpu4 [label="Layer 12 Gate Selection\nGPU 4\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_12_expert_0_gpu4 [label="Layer 12 Expert 0\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_1_gpu4 [label="Layer 12 Expert 1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_2_gpu4 [label="Layer 12 Expert 2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_3_gpu4 [label="Layer 12 Expert 3\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_agg_gpu4 [label="Layer 12 Expert Aggregation\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_12_moe_out_proj_gpu4 [label="Layer 12 MoE Output Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_residual2_gpu4 [label="Layer 12 Residual2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_11_output_gpu4 -> layer_12_ln1_gpu4
		layer_12_ln1_gpu4 -> layer_12_q_proj_gpu4
		layer_12_ln1_gpu4 -> layer_12_k_proj_gpu4
		layer_12_ln1_gpu4 -> layer_12_v_proj_gpu4
		layer_12_q_proj_gpu4 -> layer_12_attn_gpu4
		layer_12_k_proj_gpu4 -> layer_12_attn_gpu4
		layer_12_v_proj_gpu4 -> layer_12_attn_gpu4
		layer_12_attn_gpu4 -> layer_12_attn_out_proj_gpu4
		layer_12_attn_out_proj_gpu4 -> layer_12_residual1_gpu4
		layer_12_residual1_gpu4 -> layer_12_ln2_gpu4
		layer_12_ln2_gpu4 -> layer_12_router_gpu4
		layer_12_router_gpu4 -> layer_12_gate_gpu4
		layer_12_gate_gpu4 -> layer_12_expert_0_gpu4 [style=dashed]
		layer_12_gate_gpu4 -> layer_12_expert_1_gpu4 [style=dashed]
		layer_12_gate_gpu4 -> layer_12_expert_2_gpu4 [style=dashed]
		layer_12_gate_gpu4 -> layer_12_expert_3_gpu4 [style=dashed]
		layer_12_expert_0_gpu4 -> layer_12_expert_agg_gpu4
		layer_12_expert_1_gpu4 -> layer_12_expert_agg_gpu4
		layer_12_expert_2_gpu4 -> layer_12_expert_agg_gpu4
		layer_12_expert_3_gpu4 -> layer_12_expert_agg_gpu4
		layer_12_expert_agg_gpu4 -> layer_12_moe_out_proj_gpu4
		layer_12_moe_out_proj_gpu4 -> layer_12_residual2_gpu4
		layer_12_output_gpu4 [label="Layer 12 Output\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_12_residual2_gpu4 -> layer_12_output_gpu4
		layer_13_ln1_gpu4 [label="Layer 13 LayerNorm1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_13_q_proj_gpu4 [label="Layer 13 Q Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_k_proj_gpu4 [label="Layer 13 K Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_v_proj_gpu4 [label="Layer 13 V Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_attn_gpu4 [label="Layer 13 Scaled Dot-Product Attention\nGPU 4\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_attn_out_proj_gpu4 [label="Layer 13 Attention Output Projection\nGPU 4\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_residual1_gpu4 [label="Layer 13 Residual1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_13_ln2_gpu4 [label="Layer 13 LayerNorm2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_13_router_gpu4 [label="Layer 13 Router\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_13_gate_gpu4 [label="Layer 13 Gate Selection\nGPU 4\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_13_expert_0_gpu4 [label="Layer 13 Expert 0\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_1_gpu4 [label="Layer 13 Expert 1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_2_gpu4 [label="Layer 13 Expert 2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_3_gpu4 [label="Layer 13 Expert 3\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_agg_gpu4 [label="Layer 13 Expert Aggregation\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_13_moe_out_proj_gpu4 [label="Layer 13 MoE Output Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_residual2_gpu4 [label="Layer 13 Residual2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_12_output_gpu4 -> layer_13_ln1_gpu4
		layer_13_ln1_gpu4 -> layer_13_q_proj_gpu4
		layer_13_ln1_gpu4 -> layer_13_k_proj_gpu4
		layer_13_ln1_gpu4 -> layer_13_v_proj_gpu4
		layer_13_q_proj_gpu4 -> layer_13_attn_gpu4
		layer_13_k_proj_gpu4 -> layer_13_attn_gpu4
		layer_13_v_proj_gpu4 -> layer_13_attn_gpu4
		layer_13_attn_gpu4 -> layer_13_attn_out_proj_gpu4
		layer_13_attn_out_proj_gpu4 -> layer_13_residual1_gpu4
		layer_13_residual1_gpu4 -> layer_13_ln2_gpu4
		layer_13_ln2_gpu4 -> layer_13_router_gpu4
		layer_13_router_gpu4 -> layer_13_gate_gpu4
		layer_13_gate_gpu4 -> layer_13_expert_0_gpu4 [style=dashed]
		layer_13_gate_gpu4 -> layer_13_expert_1_gpu4 [style=dashed]
		layer_13_gate_gpu4 -> layer_13_expert_2_gpu4 [style=dashed]
		layer_13_gate_gpu4 -> layer_13_expert_3_gpu4 [style=dashed]
		layer_13_expert_0_gpu4 -> layer_13_expert_agg_gpu4
		layer_13_expert_1_gpu4 -> layer_13_expert_agg_gpu4
		layer_13_expert_2_gpu4 -> layer_13_expert_agg_gpu4
		layer_13_expert_3_gpu4 -> layer_13_expert_agg_gpu4
		layer_13_expert_agg_gpu4 -> layer_13_moe_out_proj_gpu4
		layer_13_moe_out_proj_gpu4 -> layer_13_residual2_gpu4
		layer_13_output_gpu4 [label="Layer 13 Output\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_13_residual2_gpu4 -> layer_13_output_gpu4
		layer_14_ln1_gpu4 [label="Layer 14 LayerNorm1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_14_q_proj_gpu4 [label="Layer 14 Q Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_k_proj_gpu4 [label="Layer 14 K Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_v_proj_gpu4 [label="Layer 14 V Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_attn_gpu4 [label="Layer 14 Scaled Dot-Product Attention\nGPU 4\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_attn_out_proj_gpu4 [label="Layer 14 Attention Output Projection\nGPU 4\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_residual1_gpu4 [label="Layer 14 Residual1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_14_ln2_gpu4 [label="Layer 14 LayerNorm2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_14_router_gpu4 [label="Layer 14 Router\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_14_gate_gpu4 [label="Layer 14 Gate Selection\nGPU 4\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_14_expert_0_gpu4 [label="Layer 14 Expert 0\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_1_gpu4 [label="Layer 14 Expert 1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_2_gpu4 [label="Layer 14 Expert 2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_3_gpu4 [label="Layer 14 Expert 3\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_agg_gpu4 [label="Layer 14 Expert Aggregation\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_14_moe_out_proj_gpu4 [label="Layer 14 MoE Output Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_residual2_gpu4 [label="Layer 14 Residual2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_13_output_gpu4 -> layer_14_ln1_gpu4
		layer_14_ln1_gpu4 -> layer_14_q_proj_gpu4
		layer_14_ln1_gpu4 -> layer_14_k_proj_gpu4
		layer_14_ln1_gpu4 -> layer_14_v_proj_gpu4
		layer_14_q_proj_gpu4 -> layer_14_attn_gpu4
		layer_14_k_proj_gpu4 -> layer_14_attn_gpu4
		layer_14_v_proj_gpu4 -> layer_14_attn_gpu4
		layer_14_attn_gpu4 -> layer_14_attn_out_proj_gpu4
		layer_14_attn_out_proj_gpu4 -> layer_14_residual1_gpu4
		layer_14_residual1_gpu4 -> layer_14_ln2_gpu4
		layer_14_ln2_gpu4 -> layer_14_router_gpu4
		layer_14_router_gpu4 -> layer_14_gate_gpu4
		layer_14_gate_gpu4 -> layer_14_expert_0_gpu4 [style=dashed]
		layer_14_gate_gpu4 -> layer_14_expert_1_gpu4 [style=dashed]
		layer_14_gate_gpu4 -> layer_14_expert_2_gpu4 [style=dashed]
		layer_14_gate_gpu4 -> layer_14_expert_3_gpu4 [style=dashed]
		layer_14_expert_0_gpu4 -> layer_14_expert_agg_gpu4
		layer_14_expert_1_gpu4 -> layer_14_expert_agg_gpu4
		layer_14_expert_2_gpu4 -> layer_14_expert_agg_gpu4
		layer_14_expert_3_gpu4 -> layer_14_expert_agg_gpu4
		layer_14_expert_agg_gpu4 -> layer_14_moe_out_proj_gpu4
		layer_14_moe_out_proj_gpu4 -> layer_14_residual2_gpu4
		layer_14_output_gpu4 [label="Layer 14 Output\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_14_residual2_gpu4 -> layer_14_output_gpu4
		layer_15_ln1_gpu4 [label="Layer 15 LayerNorm1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_15_q_proj_gpu4 [label="Layer 15 Q Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_k_proj_gpu4 [label="Layer 15 K Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_v_proj_gpu4 [label="Layer 15 V Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_attn_gpu4 [label="Layer 15 Scaled Dot-Product Attention\nGPU 4\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_attn_out_proj_gpu4 [label="Layer 15 Attention Output Projection\nGPU 4\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_residual1_gpu4 [label="Layer 15 Residual1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_15_ln2_gpu4 [label="Layer 15 LayerNorm2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_15_router_gpu4 [label="Layer 15 Router\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_15_gate_gpu4 [label="Layer 15 Gate Selection\nGPU 4\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_15_expert_0_gpu4 [label="Layer 15 Expert 0\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_1_gpu4 [label="Layer 15 Expert 1\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_2_gpu4 [label="Layer 15 Expert 2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_3_gpu4 [label="Layer 15 Expert 3\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_agg_gpu4 [label="Layer 15 Expert Aggregation\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_15_moe_out_proj_gpu4 [label="Layer 15 MoE Output Projection\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_residual2_gpu4 [label="Layer 15 Residual2\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_14_output_gpu4 -> layer_15_ln1_gpu4
		layer_15_ln1_gpu4 -> layer_15_q_proj_gpu4
		layer_15_ln1_gpu4 -> layer_15_k_proj_gpu4
		layer_15_ln1_gpu4 -> layer_15_v_proj_gpu4
		layer_15_q_proj_gpu4 -> layer_15_attn_gpu4
		layer_15_k_proj_gpu4 -> layer_15_attn_gpu4
		layer_15_v_proj_gpu4 -> layer_15_attn_gpu4
		layer_15_attn_gpu4 -> layer_15_attn_out_proj_gpu4
		layer_15_attn_out_proj_gpu4 -> layer_15_residual1_gpu4
		layer_15_residual1_gpu4 -> layer_15_ln2_gpu4
		layer_15_ln2_gpu4 -> layer_15_router_gpu4
		layer_15_router_gpu4 -> layer_15_gate_gpu4
		layer_15_gate_gpu4 -> layer_15_expert_0_gpu4 [style=dashed]
		layer_15_gate_gpu4 -> layer_15_expert_1_gpu4 [style=dashed]
		layer_15_gate_gpu4 -> layer_15_expert_2_gpu4 [style=dashed]
		layer_15_gate_gpu4 -> layer_15_expert_3_gpu4 [style=dashed]
		layer_15_expert_0_gpu4 -> layer_15_expert_agg_gpu4
		layer_15_expert_1_gpu4 -> layer_15_expert_agg_gpu4
		layer_15_expert_2_gpu4 -> layer_15_expert_agg_gpu4
		layer_15_expert_3_gpu4 -> layer_15_expert_agg_gpu4
		layer_15_expert_agg_gpu4 -> layer_15_moe_out_proj_gpu4
		layer_15_moe_out_proj_gpu4 -> layer_15_residual2_gpu4
		layer_15_output_gpu4 [label="Layer 15 Output\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_15_residual2_gpu4 -> layer_15_output_gpu4
		final_ln_gpu4 [label="Final Layer Norm\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		layer_15_output_gpu4 -> final_ln_gpu4
		lm_head_gpu4 [label="LM Head\nGPU 4\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, vocab_size]" fillcolor=lightcoral shape=rectangle style=filled]
		output_gpu4 [label="Output\nGPU 4\nInput: [batch=256, seq=512, vocab_size]\nOutput: [batch=256, seq=512, vocab_size]" fillcolor=lightgreen shape=ellipse style=filled]
		input_gpu4 -> embed_gpu4
		embed_gpu4 -> pos_enc_gpu4
		final_ln_gpu4 -> lm_head_gpu4
		lm_head_gpu4 -> output_gpu4
	}
	subgraph cluster_gpu_5 {
		color=blue fillcolor=lightblue label="GPU 5" style=rounded
		input_gpu5 [label="Input\nGPU 5\nInput: [batch=256, seq=512, dim=1024]\nOutput: [batch=256, seq=512, dim=1024]" fillcolor=lightgreen shape=ellipse style=filled]
		embed_gpu5 [label="Token Embedding\nGPU 5\nInput: [batch=256, seq=512]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		pos_enc_gpu5 [label="Position Encoding\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		layer_0_ln1_gpu5 [label="Layer 0 LayerNorm1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_0_q_proj_gpu5 [label="Layer 0 Q Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_k_proj_gpu5 [label="Layer 0 K Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_v_proj_gpu5 [label="Layer 0 V Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_attn_gpu5 [label="Layer 0 Scaled Dot-Product Attention\nGPU 5\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_attn_out_proj_gpu5 [label="Layer 0 Attention Output Projection\nGPU 5\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_residual1_gpu5 [label="Layer 0 Residual1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_0_ln2_gpu5 [label="Layer 0 LayerNorm2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_0_router_gpu5 [label="Layer 0 Router\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_0_gate_gpu5 [label="Layer 0 Gate Selection\nGPU 5\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_0_expert_0_gpu5 [label="Layer 0 Expert 0\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_1_gpu5 [label="Layer 0 Expert 1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_2_gpu5 [label="Layer 0 Expert 2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_3_gpu5 [label="Layer 0 Expert 3\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_agg_gpu5 [label="Layer 0 Expert Aggregation\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_0_moe_out_proj_gpu5 [label="Layer 0 MoE Output Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_residual2_gpu5 [label="Layer 0 Residual2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		pos_enc_gpu5 -> layer_0_ln1_gpu5
		layer_0_ln1_gpu5 -> layer_0_q_proj_gpu5
		layer_0_ln1_gpu5 -> layer_0_k_proj_gpu5
		layer_0_ln1_gpu5 -> layer_0_v_proj_gpu5
		layer_0_q_proj_gpu5 -> layer_0_attn_gpu5
		layer_0_k_proj_gpu5 -> layer_0_attn_gpu5
		layer_0_v_proj_gpu5 -> layer_0_attn_gpu5
		layer_0_attn_gpu5 -> layer_0_attn_out_proj_gpu5
		layer_0_attn_out_proj_gpu5 -> layer_0_residual1_gpu5
		layer_0_residual1_gpu5 -> layer_0_ln2_gpu5
		layer_0_ln2_gpu5 -> layer_0_router_gpu5
		layer_0_router_gpu5 -> layer_0_gate_gpu5
		layer_0_gate_gpu5 -> layer_0_expert_0_gpu5 [style=dashed]
		layer_0_gate_gpu5 -> layer_0_expert_1_gpu5 [style=dashed]
		layer_0_gate_gpu5 -> layer_0_expert_2_gpu5 [style=dashed]
		layer_0_gate_gpu5 -> layer_0_expert_3_gpu5 [style=dashed]
		layer_0_expert_0_gpu5 -> layer_0_expert_agg_gpu5
		layer_0_expert_1_gpu5 -> layer_0_expert_agg_gpu5
		layer_0_expert_2_gpu5 -> layer_0_expert_agg_gpu5
		layer_0_expert_3_gpu5 -> layer_0_expert_agg_gpu5
		layer_0_expert_agg_gpu5 -> layer_0_moe_out_proj_gpu5
		layer_0_moe_out_proj_gpu5 -> layer_0_residual2_gpu5
		layer_0_output_gpu5 [label="Layer 0 Output\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_0_residual2_gpu5 -> layer_0_output_gpu5
		layer_1_ln1_gpu5 [label="Layer 1 LayerNorm1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_1_q_proj_gpu5 [label="Layer 1 Q Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_k_proj_gpu5 [label="Layer 1 K Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_v_proj_gpu5 [label="Layer 1 V Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_attn_gpu5 [label="Layer 1 Scaled Dot-Product Attention\nGPU 5\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_attn_out_proj_gpu5 [label="Layer 1 Attention Output Projection\nGPU 5\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_residual1_gpu5 [label="Layer 1 Residual1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_1_ln2_gpu5 [label="Layer 1 LayerNorm2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_1_router_gpu5 [label="Layer 1 Router\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_1_gate_gpu5 [label="Layer 1 Gate Selection\nGPU 5\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_1_expert_0_gpu5 [label="Layer 1 Expert 0\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_1_gpu5 [label="Layer 1 Expert 1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_2_gpu5 [label="Layer 1 Expert 2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_3_gpu5 [label="Layer 1 Expert 3\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_agg_gpu5 [label="Layer 1 Expert Aggregation\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_1_moe_out_proj_gpu5 [label="Layer 1 MoE Output Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_residual2_gpu5 [label="Layer 1 Residual2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_0_output_gpu5 -> layer_1_ln1_gpu5
		layer_1_ln1_gpu5 -> layer_1_q_proj_gpu5
		layer_1_ln1_gpu5 -> layer_1_k_proj_gpu5
		layer_1_ln1_gpu5 -> layer_1_v_proj_gpu5
		layer_1_q_proj_gpu5 -> layer_1_attn_gpu5
		layer_1_k_proj_gpu5 -> layer_1_attn_gpu5
		layer_1_v_proj_gpu5 -> layer_1_attn_gpu5
		layer_1_attn_gpu5 -> layer_1_attn_out_proj_gpu5
		layer_1_attn_out_proj_gpu5 -> layer_1_residual1_gpu5
		layer_1_residual1_gpu5 -> layer_1_ln2_gpu5
		layer_1_ln2_gpu5 -> layer_1_router_gpu5
		layer_1_router_gpu5 -> layer_1_gate_gpu5
		layer_1_gate_gpu5 -> layer_1_expert_0_gpu5 [style=dashed]
		layer_1_gate_gpu5 -> layer_1_expert_1_gpu5 [style=dashed]
		layer_1_gate_gpu5 -> layer_1_expert_2_gpu5 [style=dashed]
		layer_1_gate_gpu5 -> layer_1_expert_3_gpu5 [style=dashed]
		layer_1_expert_0_gpu5 -> layer_1_expert_agg_gpu5
		layer_1_expert_1_gpu5 -> layer_1_expert_agg_gpu5
		layer_1_expert_2_gpu5 -> layer_1_expert_agg_gpu5
		layer_1_expert_3_gpu5 -> layer_1_expert_agg_gpu5
		layer_1_expert_agg_gpu5 -> layer_1_moe_out_proj_gpu5
		layer_1_moe_out_proj_gpu5 -> layer_1_residual2_gpu5
		layer_1_output_gpu5 [label="Layer 1 Output\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_1_residual2_gpu5 -> layer_1_output_gpu5
		layer_2_ln1_gpu5 [label="Layer 2 LayerNorm1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_2_q_proj_gpu5 [label="Layer 2 Q Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_k_proj_gpu5 [label="Layer 2 K Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_v_proj_gpu5 [label="Layer 2 V Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_attn_gpu5 [label="Layer 2 Scaled Dot-Product Attention\nGPU 5\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_attn_out_proj_gpu5 [label="Layer 2 Attention Output Projection\nGPU 5\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_residual1_gpu5 [label="Layer 2 Residual1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_2_ln2_gpu5 [label="Layer 2 LayerNorm2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_2_router_gpu5 [label="Layer 2 Router\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_2_gate_gpu5 [label="Layer 2 Gate Selection\nGPU 5\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_2_expert_0_gpu5 [label="Layer 2 Expert 0\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_1_gpu5 [label="Layer 2 Expert 1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_2_gpu5 [label="Layer 2 Expert 2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_3_gpu5 [label="Layer 2 Expert 3\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_agg_gpu5 [label="Layer 2 Expert Aggregation\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_2_moe_out_proj_gpu5 [label="Layer 2 MoE Output Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_residual2_gpu5 [label="Layer 2 Residual2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_1_output_gpu5 -> layer_2_ln1_gpu5
		layer_2_ln1_gpu5 -> layer_2_q_proj_gpu5
		layer_2_ln1_gpu5 -> layer_2_k_proj_gpu5
		layer_2_ln1_gpu5 -> layer_2_v_proj_gpu5
		layer_2_q_proj_gpu5 -> layer_2_attn_gpu5
		layer_2_k_proj_gpu5 -> layer_2_attn_gpu5
		layer_2_v_proj_gpu5 -> layer_2_attn_gpu5
		layer_2_attn_gpu5 -> layer_2_attn_out_proj_gpu5
		layer_2_attn_out_proj_gpu5 -> layer_2_residual1_gpu5
		layer_2_residual1_gpu5 -> layer_2_ln2_gpu5
		layer_2_ln2_gpu5 -> layer_2_router_gpu5
		layer_2_router_gpu5 -> layer_2_gate_gpu5
		layer_2_gate_gpu5 -> layer_2_expert_0_gpu5 [style=dashed]
		layer_2_gate_gpu5 -> layer_2_expert_1_gpu5 [style=dashed]
		layer_2_gate_gpu5 -> layer_2_expert_2_gpu5 [style=dashed]
		layer_2_gate_gpu5 -> layer_2_expert_3_gpu5 [style=dashed]
		layer_2_expert_0_gpu5 -> layer_2_expert_agg_gpu5
		layer_2_expert_1_gpu5 -> layer_2_expert_agg_gpu5
		layer_2_expert_2_gpu5 -> layer_2_expert_agg_gpu5
		layer_2_expert_3_gpu5 -> layer_2_expert_agg_gpu5
		layer_2_expert_agg_gpu5 -> layer_2_moe_out_proj_gpu5
		layer_2_moe_out_proj_gpu5 -> layer_2_residual2_gpu5
		layer_2_output_gpu5 [label="Layer 2 Output\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_2_residual2_gpu5 -> layer_2_output_gpu5
		layer_3_ln1_gpu5 [label="Layer 3 LayerNorm1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_3_q_proj_gpu5 [label="Layer 3 Q Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_k_proj_gpu5 [label="Layer 3 K Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_v_proj_gpu5 [label="Layer 3 V Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_attn_gpu5 [label="Layer 3 Scaled Dot-Product Attention\nGPU 5\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_attn_out_proj_gpu5 [label="Layer 3 Attention Output Projection\nGPU 5\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_residual1_gpu5 [label="Layer 3 Residual1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_3_ln2_gpu5 [label="Layer 3 LayerNorm2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_3_router_gpu5 [label="Layer 3 Router\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_3_gate_gpu5 [label="Layer 3 Gate Selection\nGPU 5\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_3_expert_0_gpu5 [label="Layer 3 Expert 0\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_1_gpu5 [label="Layer 3 Expert 1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_2_gpu5 [label="Layer 3 Expert 2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_3_gpu5 [label="Layer 3 Expert 3\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_agg_gpu5 [label="Layer 3 Expert Aggregation\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_3_moe_out_proj_gpu5 [label="Layer 3 MoE Output Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_residual2_gpu5 [label="Layer 3 Residual2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_2_output_gpu5 -> layer_3_ln1_gpu5
		layer_3_ln1_gpu5 -> layer_3_q_proj_gpu5
		layer_3_ln1_gpu5 -> layer_3_k_proj_gpu5
		layer_3_ln1_gpu5 -> layer_3_v_proj_gpu5
		layer_3_q_proj_gpu5 -> layer_3_attn_gpu5
		layer_3_k_proj_gpu5 -> layer_3_attn_gpu5
		layer_3_v_proj_gpu5 -> layer_3_attn_gpu5
		layer_3_attn_gpu5 -> layer_3_attn_out_proj_gpu5
		layer_3_attn_out_proj_gpu5 -> layer_3_residual1_gpu5
		layer_3_residual1_gpu5 -> layer_3_ln2_gpu5
		layer_3_ln2_gpu5 -> layer_3_router_gpu5
		layer_3_router_gpu5 -> layer_3_gate_gpu5
		layer_3_gate_gpu5 -> layer_3_expert_0_gpu5 [style=dashed]
		layer_3_gate_gpu5 -> layer_3_expert_1_gpu5 [style=dashed]
		layer_3_gate_gpu5 -> layer_3_expert_2_gpu5 [style=dashed]
		layer_3_gate_gpu5 -> layer_3_expert_3_gpu5 [style=dashed]
		layer_3_expert_0_gpu5 -> layer_3_expert_agg_gpu5
		layer_3_expert_1_gpu5 -> layer_3_expert_agg_gpu5
		layer_3_expert_2_gpu5 -> layer_3_expert_agg_gpu5
		layer_3_expert_3_gpu5 -> layer_3_expert_agg_gpu5
		layer_3_expert_agg_gpu5 -> layer_3_moe_out_proj_gpu5
		layer_3_moe_out_proj_gpu5 -> layer_3_residual2_gpu5
		layer_3_output_gpu5 [label="Layer 3 Output\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_3_residual2_gpu5 -> layer_3_output_gpu5
		layer_4_ln1_gpu5 [label="Layer 4 LayerNorm1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_4_q_proj_gpu5 [label="Layer 4 Q Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_k_proj_gpu5 [label="Layer 4 K Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_v_proj_gpu5 [label="Layer 4 V Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_attn_gpu5 [label="Layer 4 Scaled Dot-Product Attention\nGPU 5\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_attn_out_proj_gpu5 [label="Layer 4 Attention Output Projection\nGPU 5\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_residual1_gpu5 [label="Layer 4 Residual1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_4_ln2_gpu5 [label="Layer 4 LayerNorm2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_4_router_gpu5 [label="Layer 4 Router\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_4_gate_gpu5 [label="Layer 4 Gate Selection\nGPU 5\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_4_expert_0_gpu5 [label="Layer 4 Expert 0\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_1_gpu5 [label="Layer 4 Expert 1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_2_gpu5 [label="Layer 4 Expert 2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_3_gpu5 [label="Layer 4 Expert 3\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_agg_gpu5 [label="Layer 4 Expert Aggregation\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_4_moe_out_proj_gpu5 [label="Layer 4 MoE Output Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_residual2_gpu5 [label="Layer 4 Residual2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_3_output_gpu5 -> layer_4_ln1_gpu5
		layer_4_ln1_gpu5 -> layer_4_q_proj_gpu5
		layer_4_ln1_gpu5 -> layer_4_k_proj_gpu5
		layer_4_ln1_gpu5 -> layer_4_v_proj_gpu5
		layer_4_q_proj_gpu5 -> layer_4_attn_gpu5
		layer_4_k_proj_gpu5 -> layer_4_attn_gpu5
		layer_4_v_proj_gpu5 -> layer_4_attn_gpu5
		layer_4_attn_gpu5 -> layer_4_attn_out_proj_gpu5
		layer_4_attn_out_proj_gpu5 -> layer_4_residual1_gpu5
		layer_4_residual1_gpu5 -> layer_4_ln2_gpu5
		layer_4_ln2_gpu5 -> layer_4_router_gpu5
		layer_4_router_gpu5 -> layer_4_gate_gpu5
		layer_4_gate_gpu5 -> layer_4_expert_0_gpu5 [style=dashed]
		layer_4_gate_gpu5 -> layer_4_expert_1_gpu5 [style=dashed]
		layer_4_gate_gpu5 -> layer_4_expert_2_gpu5 [style=dashed]
		layer_4_gate_gpu5 -> layer_4_expert_3_gpu5 [style=dashed]
		layer_4_expert_0_gpu5 -> layer_4_expert_agg_gpu5
		layer_4_expert_1_gpu5 -> layer_4_expert_agg_gpu5
		layer_4_expert_2_gpu5 -> layer_4_expert_agg_gpu5
		layer_4_expert_3_gpu5 -> layer_4_expert_agg_gpu5
		layer_4_expert_agg_gpu5 -> layer_4_moe_out_proj_gpu5
		layer_4_moe_out_proj_gpu5 -> layer_4_residual2_gpu5
		layer_4_output_gpu5 [label="Layer 4 Output\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_4_residual2_gpu5 -> layer_4_output_gpu5
		layer_5_ln1_gpu5 [label="Layer 5 LayerNorm1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_5_q_proj_gpu5 [label="Layer 5 Q Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_k_proj_gpu5 [label="Layer 5 K Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_v_proj_gpu5 [label="Layer 5 V Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_attn_gpu5 [label="Layer 5 Scaled Dot-Product Attention\nGPU 5\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_attn_out_proj_gpu5 [label="Layer 5 Attention Output Projection\nGPU 5\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_residual1_gpu5 [label="Layer 5 Residual1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_5_ln2_gpu5 [label="Layer 5 LayerNorm2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_5_router_gpu5 [label="Layer 5 Router\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_5_gate_gpu5 [label="Layer 5 Gate Selection\nGPU 5\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_5_expert_0_gpu5 [label="Layer 5 Expert 0\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_1_gpu5 [label="Layer 5 Expert 1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_2_gpu5 [label="Layer 5 Expert 2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_3_gpu5 [label="Layer 5 Expert 3\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_agg_gpu5 [label="Layer 5 Expert Aggregation\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_5_moe_out_proj_gpu5 [label="Layer 5 MoE Output Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_residual2_gpu5 [label="Layer 5 Residual2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_4_output_gpu5 -> layer_5_ln1_gpu5
		layer_5_ln1_gpu5 -> layer_5_q_proj_gpu5
		layer_5_ln1_gpu5 -> layer_5_k_proj_gpu5
		layer_5_ln1_gpu5 -> layer_5_v_proj_gpu5
		layer_5_q_proj_gpu5 -> layer_5_attn_gpu5
		layer_5_k_proj_gpu5 -> layer_5_attn_gpu5
		layer_5_v_proj_gpu5 -> layer_5_attn_gpu5
		layer_5_attn_gpu5 -> layer_5_attn_out_proj_gpu5
		layer_5_attn_out_proj_gpu5 -> layer_5_residual1_gpu5
		layer_5_residual1_gpu5 -> layer_5_ln2_gpu5
		layer_5_ln2_gpu5 -> layer_5_router_gpu5
		layer_5_router_gpu5 -> layer_5_gate_gpu5
		layer_5_gate_gpu5 -> layer_5_expert_0_gpu5 [style=dashed]
		layer_5_gate_gpu5 -> layer_5_expert_1_gpu5 [style=dashed]
		layer_5_gate_gpu5 -> layer_5_expert_2_gpu5 [style=dashed]
		layer_5_gate_gpu5 -> layer_5_expert_3_gpu5 [style=dashed]
		layer_5_expert_0_gpu5 -> layer_5_expert_agg_gpu5
		layer_5_expert_1_gpu5 -> layer_5_expert_agg_gpu5
		layer_5_expert_2_gpu5 -> layer_5_expert_agg_gpu5
		layer_5_expert_3_gpu5 -> layer_5_expert_agg_gpu5
		layer_5_expert_agg_gpu5 -> layer_5_moe_out_proj_gpu5
		layer_5_moe_out_proj_gpu5 -> layer_5_residual2_gpu5
		layer_5_output_gpu5 [label="Layer 5 Output\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_5_residual2_gpu5 -> layer_5_output_gpu5
		layer_6_ln1_gpu5 [label="Layer 6 LayerNorm1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_6_q_proj_gpu5 [label="Layer 6 Q Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_k_proj_gpu5 [label="Layer 6 K Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_v_proj_gpu5 [label="Layer 6 V Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_attn_gpu5 [label="Layer 6 Scaled Dot-Product Attention\nGPU 5\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_attn_out_proj_gpu5 [label="Layer 6 Attention Output Projection\nGPU 5\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_residual1_gpu5 [label="Layer 6 Residual1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_6_ln2_gpu5 [label="Layer 6 LayerNorm2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_6_router_gpu5 [label="Layer 6 Router\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_6_gate_gpu5 [label="Layer 6 Gate Selection\nGPU 5\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_6_expert_0_gpu5 [label="Layer 6 Expert 0\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_1_gpu5 [label="Layer 6 Expert 1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_2_gpu5 [label="Layer 6 Expert 2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_3_gpu5 [label="Layer 6 Expert 3\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_agg_gpu5 [label="Layer 6 Expert Aggregation\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_6_moe_out_proj_gpu5 [label="Layer 6 MoE Output Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_residual2_gpu5 [label="Layer 6 Residual2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_5_output_gpu5 -> layer_6_ln1_gpu5
		layer_6_ln1_gpu5 -> layer_6_q_proj_gpu5
		layer_6_ln1_gpu5 -> layer_6_k_proj_gpu5
		layer_6_ln1_gpu5 -> layer_6_v_proj_gpu5
		layer_6_q_proj_gpu5 -> layer_6_attn_gpu5
		layer_6_k_proj_gpu5 -> layer_6_attn_gpu5
		layer_6_v_proj_gpu5 -> layer_6_attn_gpu5
		layer_6_attn_gpu5 -> layer_6_attn_out_proj_gpu5
		layer_6_attn_out_proj_gpu5 -> layer_6_residual1_gpu5
		layer_6_residual1_gpu5 -> layer_6_ln2_gpu5
		layer_6_ln2_gpu5 -> layer_6_router_gpu5
		layer_6_router_gpu5 -> layer_6_gate_gpu5
		layer_6_gate_gpu5 -> layer_6_expert_0_gpu5 [style=dashed]
		layer_6_gate_gpu5 -> layer_6_expert_1_gpu5 [style=dashed]
		layer_6_gate_gpu5 -> layer_6_expert_2_gpu5 [style=dashed]
		layer_6_gate_gpu5 -> layer_6_expert_3_gpu5 [style=dashed]
		layer_6_expert_0_gpu5 -> layer_6_expert_agg_gpu5
		layer_6_expert_1_gpu5 -> layer_6_expert_agg_gpu5
		layer_6_expert_2_gpu5 -> layer_6_expert_agg_gpu5
		layer_6_expert_3_gpu5 -> layer_6_expert_agg_gpu5
		layer_6_expert_agg_gpu5 -> layer_6_moe_out_proj_gpu5
		layer_6_moe_out_proj_gpu5 -> layer_6_residual2_gpu5
		layer_6_output_gpu5 [label="Layer 6 Output\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_6_residual2_gpu5 -> layer_6_output_gpu5
		layer_7_ln1_gpu5 [label="Layer 7 LayerNorm1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_7_q_proj_gpu5 [label="Layer 7 Q Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_k_proj_gpu5 [label="Layer 7 K Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_v_proj_gpu5 [label="Layer 7 V Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_attn_gpu5 [label="Layer 7 Scaled Dot-Product Attention\nGPU 5\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_attn_out_proj_gpu5 [label="Layer 7 Attention Output Projection\nGPU 5\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_residual1_gpu5 [label="Layer 7 Residual1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_7_ln2_gpu5 [label="Layer 7 LayerNorm2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_7_router_gpu5 [label="Layer 7 Router\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_7_gate_gpu5 [label="Layer 7 Gate Selection\nGPU 5\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_7_expert_0_gpu5 [label="Layer 7 Expert 0\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_1_gpu5 [label="Layer 7 Expert 1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_2_gpu5 [label="Layer 7 Expert 2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_3_gpu5 [label="Layer 7 Expert 3\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_agg_gpu5 [label="Layer 7 Expert Aggregation\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_7_moe_out_proj_gpu5 [label="Layer 7 MoE Output Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_residual2_gpu5 [label="Layer 7 Residual2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_6_output_gpu5 -> layer_7_ln1_gpu5
		layer_7_ln1_gpu5 -> layer_7_q_proj_gpu5
		layer_7_ln1_gpu5 -> layer_7_k_proj_gpu5
		layer_7_ln1_gpu5 -> layer_7_v_proj_gpu5
		layer_7_q_proj_gpu5 -> layer_7_attn_gpu5
		layer_7_k_proj_gpu5 -> layer_7_attn_gpu5
		layer_7_v_proj_gpu5 -> layer_7_attn_gpu5
		layer_7_attn_gpu5 -> layer_7_attn_out_proj_gpu5
		layer_7_attn_out_proj_gpu5 -> layer_7_residual1_gpu5
		layer_7_residual1_gpu5 -> layer_7_ln2_gpu5
		layer_7_ln2_gpu5 -> layer_7_router_gpu5
		layer_7_router_gpu5 -> layer_7_gate_gpu5
		layer_7_gate_gpu5 -> layer_7_expert_0_gpu5 [style=dashed]
		layer_7_gate_gpu5 -> layer_7_expert_1_gpu5 [style=dashed]
		layer_7_gate_gpu5 -> layer_7_expert_2_gpu5 [style=dashed]
		layer_7_gate_gpu5 -> layer_7_expert_3_gpu5 [style=dashed]
		layer_7_expert_0_gpu5 -> layer_7_expert_agg_gpu5
		layer_7_expert_1_gpu5 -> layer_7_expert_agg_gpu5
		layer_7_expert_2_gpu5 -> layer_7_expert_agg_gpu5
		layer_7_expert_3_gpu5 -> layer_7_expert_agg_gpu5
		layer_7_expert_agg_gpu5 -> layer_7_moe_out_proj_gpu5
		layer_7_moe_out_proj_gpu5 -> layer_7_residual2_gpu5
		layer_7_output_gpu5 [label="Layer 7 Output\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_7_residual2_gpu5 -> layer_7_output_gpu5
		layer_8_ln1_gpu5 [label="Layer 8 LayerNorm1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_8_q_proj_gpu5 [label="Layer 8 Q Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_k_proj_gpu5 [label="Layer 8 K Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_v_proj_gpu5 [label="Layer 8 V Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_attn_gpu5 [label="Layer 8 Scaled Dot-Product Attention\nGPU 5\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_attn_out_proj_gpu5 [label="Layer 8 Attention Output Projection\nGPU 5\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_residual1_gpu5 [label="Layer 8 Residual1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_8_ln2_gpu5 [label="Layer 8 LayerNorm2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_8_router_gpu5 [label="Layer 8 Router\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_8_gate_gpu5 [label="Layer 8 Gate Selection\nGPU 5\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_8_expert_0_gpu5 [label="Layer 8 Expert 0\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_1_gpu5 [label="Layer 8 Expert 1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_2_gpu5 [label="Layer 8 Expert 2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_3_gpu5 [label="Layer 8 Expert 3\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_agg_gpu5 [label="Layer 8 Expert Aggregation\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_8_moe_out_proj_gpu5 [label="Layer 8 MoE Output Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_residual2_gpu5 [label="Layer 8 Residual2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_7_output_gpu5 -> layer_8_ln1_gpu5
		layer_8_ln1_gpu5 -> layer_8_q_proj_gpu5
		layer_8_ln1_gpu5 -> layer_8_k_proj_gpu5
		layer_8_ln1_gpu5 -> layer_8_v_proj_gpu5
		layer_8_q_proj_gpu5 -> layer_8_attn_gpu5
		layer_8_k_proj_gpu5 -> layer_8_attn_gpu5
		layer_8_v_proj_gpu5 -> layer_8_attn_gpu5
		layer_8_attn_gpu5 -> layer_8_attn_out_proj_gpu5
		layer_8_attn_out_proj_gpu5 -> layer_8_residual1_gpu5
		layer_8_residual1_gpu5 -> layer_8_ln2_gpu5
		layer_8_ln2_gpu5 -> layer_8_router_gpu5
		layer_8_router_gpu5 -> layer_8_gate_gpu5
		layer_8_gate_gpu5 -> layer_8_expert_0_gpu5 [style=dashed]
		layer_8_gate_gpu5 -> layer_8_expert_1_gpu5 [style=dashed]
		layer_8_gate_gpu5 -> layer_8_expert_2_gpu5 [style=dashed]
		layer_8_gate_gpu5 -> layer_8_expert_3_gpu5 [style=dashed]
		layer_8_expert_0_gpu5 -> layer_8_expert_agg_gpu5
		layer_8_expert_1_gpu5 -> layer_8_expert_agg_gpu5
		layer_8_expert_2_gpu5 -> layer_8_expert_agg_gpu5
		layer_8_expert_3_gpu5 -> layer_8_expert_agg_gpu5
		layer_8_expert_agg_gpu5 -> layer_8_moe_out_proj_gpu5
		layer_8_moe_out_proj_gpu5 -> layer_8_residual2_gpu5
		layer_8_output_gpu5 [label="Layer 8 Output\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_8_residual2_gpu5 -> layer_8_output_gpu5
		layer_9_ln1_gpu5 [label="Layer 9 LayerNorm1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_9_q_proj_gpu5 [label="Layer 9 Q Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_k_proj_gpu5 [label="Layer 9 K Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_v_proj_gpu5 [label="Layer 9 V Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_attn_gpu5 [label="Layer 9 Scaled Dot-Product Attention\nGPU 5\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_attn_out_proj_gpu5 [label="Layer 9 Attention Output Projection\nGPU 5\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_residual1_gpu5 [label="Layer 9 Residual1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_9_ln2_gpu5 [label="Layer 9 LayerNorm2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_9_router_gpu5 [label="Layer 9 Router\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_9_gate_gpu5 [label="Layer 9 Gate Selection\nGPU 5\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_9_expert_0_gpu5 [label="Layer 9 Expert 0\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_1_gpu5 [label="Layer 9 Expert 1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_2_gpu5 [label="Layer 9 Expert 2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_3_gpu5 [label="Layer 9 Expert 3\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_agg_gpu5 [label="Layer 9 Expert Aggregation\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_9_moe_out_proj_gpu5 [label="Layer 9 MoE Output Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_residual2_gpu5 [label="Layer 9 Residual2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_8_output_gpu5 -> layer_9_ln1_gpu5
		layer_9_ln1_gpu5 -> layer_9_q_proj_gpu5
		layer_9_ln1_gpu5 -> layer_9_k_proj_gpu5
		layer_9_ln1_gpu5 -> layer_9_v_proj_gpu5
		layer_9_q_proj_gpu5 -> layer_9_attn_gpu5
		layer_9_k_proj_gpu5 -> layer_9_attn_gpu5
		layer_9_v_proj_gpu5 -> layer_9_attn_gpu5
		layer_9_attn_gpu5 -> layer_9_attn_out_proj_gpu5
		layer_9_attn_out_proj_gpu5 -> layer_9_residual1_gpu5
		layer_9_residual1_gpu5 -> layer_9_ln2_gpu5
		layer_9_ln2_gpu5 -> layer_9_router_gpu5
		layer_9_router_gpu5 -> layer_9_gate_gpu5
		layer_9_gate_gpu5 -> layer_9_expert_0_gpu5 [style=dashed]
		layer_9_gate_gpu5 -> layer_9_expert_1_gpu5 [style=dashed]
		layer_9_gate_gpu5 -> layer_9_expert_2_gpu5 [style=dashed]
		layer_9_gate_gpu5 -> layer_9_expert_3_gpu5 [style=dashed]
		layer_9_expert_0_gpu5 -> layer_9_expert_agg_gpu5
		layer_9_expert_1_gpu5 -> layer_9_expert_agg_gpu5
		layer_9_expert_2_gpu5 -> layer_9_expert_agg_gpu5
		layer_9_expert_3_gpu5 -> layer_9_expert_agg_gpu5
		layer_9_expert_agg_gpu5 -> layer_9_moe_out_proj_gpu5
		layer_9_moe_out_proj_gpu5 -> layer_9_residual2_gpu5
		layer_9_output_gpu5 [label="Layer 9 Output\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_9_residual2_gpu5 -> layer_9_output_gpu5
		layer_10_ln1_gpu5 [label="Layer 10 LayerNorm1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_10_q_proj_gpu5 [label="Layer 10 Q Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_k_proj_gpu5 [label="Layer 10 K Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_v_proj_gpu5 [label="Layer 10 V Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_attn_gpu5 [label="Layer 10 Scaled Dot-Product Attention\nGPU 5\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_attn_out_proj_gpu5 [label="Layer 10 Attention Output Projection\nGPU 5\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_residual1_gpu5 [label="Layer 10 Residual1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_10_ln2_gpu5 [label="Layer 10 LayerNorm2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_10_router_gpu5 [label="Layer 10 Router\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_10_gate_gpu5 [label="Layer 10 Gate Selection\nGPU 5\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_10_expert_0_gpu5 [label="Layer 10 Expert 0\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_1_gpu5 [label="Layer 10 Expert 1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_2_gpu5 [label="Layer 10 Expert 2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_3_gpu5 [label="Layer 10 Expert 3\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_agg_gpu5 [label="Layer 10 Expert Aggregation\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_10_moe_out_proj_gpu5 [label="Layer 10 MoE Output Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_residual2_gpu5 [label="Layer 10 Residual2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_9_output_gpu5 -> layer_10_ln1_gpu5
		layer_10_ln1_gpu5 -> layer_10_q_proj_gpu5
		layer_10_ln1_gpu5 -> layer_10_k_proj_gpu5
		layer_10_ln1_gpu5 -> layer_10_v_proj_gpu5
		layer_10_q_proj_gpu5 -> layer_10_attn_gpu5
		layer_10_k_proj_gpu5 -> layer_10_attn_gpu5
		layer_10_v_proj_gpu5 -> layer_10_attn_gpu5
		layer_10_attn_gpu5 -> layer_10_attn_out_proj_gpu5
		layer_10_attn_out_proj_gpu5 -> layer_10_residual1_gpu5
		layer_10_residual1_gpu5 -> layer_10_ln2_gpu5
		layer_10_ln2_gpu5 -> layer_10_router_gpu5
		layer_10_router_gpu5 -> layer_10_gate_gpu5
		layer_10_gate_gpu5 -> layer_10_expert_0_gpu5 [style=dashed]
		layer_10_gate_gpu5 -> layer_10_expert_1_gpu5 [style=dashed]
		layer_10_gate_gpu5 -> layer_10_expert_2_gpu5 [style=dashed]
		layer_10_gate_gpu5 -> layer_10_expert_3_gpu5 [style=dashed]
		layer_10_expert_0_gpu5 -> layer_10_expert_agg_gpu5
		layer_10_expert_1_gpu5 -> layer_10_expert_agg_gpu5
		layer_10_expert_2_gpu5 -> layer_10_expert_agg_gpu5
		layer_10_expert_3_gpu5 -> layer_10_expert_agg_gpu5
		layer_10_expert_agg_gpu5 -> layer_10_moe_out_proj_gpu5
		layer_10_moe_out_proj_gpu5 -> layer_10_residual2_gpu5
		layer_10_output_gpu5 [label="Layer 10 Output\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_10_residual2_gpu5 -> layer_10_output_gpu5
		layer_11_ln1_gpu5 [label="Layer 11 LayerNorm1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_11_q_proj_gpu5 [label="Layer 11 Q Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_k_proj_gpu5 [label="Layer 11 K Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_v_proj_gpu5 [label="Layer 11 V Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_attn_gpu5 [label="Layer 11 Scaled Dot-Product Attention\nGPU 5\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_attn_out_proj_gpu5 [label="Layer 11 Attention Output Projection\nGPU 5\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_residual1_gpu5 [label="Layer 11 Residual1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_11_ln2_gpu5 [label="Layer 11 LayerNorm2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_11_router_gpu5 [label="Layer 11 Router\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_11_gate_gpu5 [label="Layer 11 Gate Selection\nGPU 5\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_11_expert_0_gpu5 [label="Layer 11 Expert 0\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_1_gpu5 [label="Layer 11 Expert 1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_2_gpu5 [label="Layer 11 Expert 2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_3_gpu5 [label="Layer 11 Expert 3\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_agg_gpu5 [label="Layer 11 Expert Aggregation\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_11_moe_out_proj_gpu5 [label="Layer 11 MoE Output Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_residual2_gpu5 [label="Layer 11 Residual2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_10_output_gpu5 -> layer_11_ln1_gpu5
		layer_11_ln1_gpu5 -> layer_11_q_proj_gpu5
		layer_11_ln1_gpu5 -> layer_11_k_proj_gpu5
		layer_11_ln1_gpu5 -> layer_11_v_proj_gpu5
		layer_11_q_proj_gpu5 -> layer_11_attn_gpu5
		layer_11_k_proj_gpu5 -> layer_11_attn_gpu5
		layer_11_v_proj_gpu5 -> layer_11_attn_gpu5
		layer_11_attn_gpu5 -> layer_11_attn_out_proj_gpu5
		layer_11_attn_out_proj_gpu5 -> layer_11_residual1_gpu5
		layer_11_residual1_gpu5 -> layer_11_ln2_gpu5
		layer_11_ln2_gpu5 -> layer_11_router_gpu5
		layer_11_router_gpu5 -> layer_11_gate_gpu5
		layer_11_gate_gpu5 -> layer_11_expert_0_gpu5 [style=dashed]
		layer_11_gate_gpu5 -> layer_11_expert_1_gpu5 [style=dashed]
		layer_11_gate_gpu5 -> layer_11_expert_2_gpu5 [style=dashed]
		layer_11_gate_gpu5 -> layer_11_expert_3_gpu5 [style=dashed]
		layer_11_expert_0_gpu5 -> layer_11_expert_agg_gpu5
		layer_11_expert_1_gpu5 -> layer_11_expert_agg_gpu5
		layer_11_expert_2_gpu5 -> layer_11_expert_agg_gpu5
		layer_11_expert_3_gpu5 -> layer_11_expert_agg_gpu5
		layer_11_expert_agg_gpu5 -> layer_11_moe_out_proj_gpu5
		layer_11_moe_out_proj_gpu5 -> layer_11_residual2_gpu5
		layer_11_output_gpu5 [label="Layer 11 Output\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_11_residual2_gpu5 -> layer_11_output_gpu5
		layer_12_ln1_gpu5 [label="Layer 12 LayerNorm1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_12_q_proj_gpu5 [label="Layer 12 Q Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_k_proj_gpu5 [label="Layer 12 K Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_v_proj_gpu5 [label="Layer 12 V Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_attn_gpu5 [label="Layer 12 Scaled Dot-Product Attention\nGPU 5\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_attn_out_proj_gpu5 [label="Layer 12 Attention Output Projection\nGPU 5\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_residual1_gpu5 [label="Layer 12 Residual1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_12_ln2_gpu5 [label="Layer 12 LayerNorm2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_12_router_gpu5 [label="Layer 12 Router\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_12_gate_gpu5 [label="Layer 12 Gate Selection\nGPU 5\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_12_expert_0_gpu5 [label="Layer 12 Expert 0\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_1_gpu5 [label="Layer 12 Expert 1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_2_gpu5 [label="Layer 12 Expert 2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_3_gpu5 [label="Layer 12 Expert 3\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_agg_gpu5 [label="Layer 12 Expert Aggregation\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_12_moe_out_proj_gpu5 [label="Layer 12 MoE Output Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_residual2_gpu5 [label="Layer 12 Residual2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_11_output_gpu5 -> layer_12_ln1_gpu5
		layer_12_ln1_gpu5 -> layer_12_q_proj_gpu5
		layer_12_ln1_gpu5 -> layer_12_k_proj_gpu5
		layer_12_ln1_gpu5 -> layer_12_v_proj_gpu5
		layer_12_q_proj_gpu5 -> layer_12_attn_gpu5
		layer_12_k_proj_gpu5 -> layer_12_attn_gpu5
		layer_12_v_proj_gpu5 -> layer_12_attn_gpu5
		layer_12_attn_gpu5 -> layer_12_attn_out_proj_gpu5
		layer_12_attn_out_proj_gpu5 -> layer_12_residual1_gpu5
		layer_12_residual1_gpu5 -> layer_12_ln2_gpu5
		layer_12_ln2_gpu5 -> layer_12_router_gpu5
		layer_12_router_gpu5 -> layer_12_gate_gpu5
		layer_12_gate_gpu5 -> layer_12_expert_0_gpu5 [style=dashed]
		layer_12_gate_gpu5 -> layer_12_expert_1_gpu5 [style=dashed]
		layer_12_gate_gpu5 -> layer_12_expert_2_gpu5 [style=dashed]
		layer_12_gate_gpu5 -> layer_12_expert_3_gpu5 [style=dashed]
		layer_12_expert_0_gpu5 -> layer_12_expert_agg_gpu5
		layer_12_expert_1_gpu5 -> layer_12_expert_agg_gpu5
		layer_12_expert_2_gpu5 -> layer_12_expert_agg_gpu5
		layer_12_expert_3_gpu5 -> layer_12_expert_agg_gpu5
		layer_12_expert_agg_gpu5 -> layer_12_moe_out_proj_gpu5
		layer_12_moe_out_proj_gpu5 -> layer_12_residual2_gpu5
		layer_12_output_gpu5 [label="Layer 12 Output\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_12_residual2_gpu5 -> layer_12_output_gpu5
		layer_13_ln1_gpu5 [label="Layer 13 LayerNorm1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_13_q_proj_gpu5 [label="Layer 13 Q Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_k_proj_gpu5 [label="Layer 13 K Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_v_proj_gpu5 [label="Layer 13 V Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_attn_gpu5 [label="Layer 13 Scaled Dot-Product Attention\nGPU 5\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_attn_out_proj_gpu5 [label="Layer 13 Attention Output Projection\nGPU 5\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_residual1_gpu5 [label="Layer 13 Residual1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_13_ln2_gpu5 [label="Layer 13 LayerNorm2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_13_router_gpu5 [label="Layer 13 Router\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_13_gate_gpu5 [label="Layer 13 Gate Selection\nGPU 5\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_13_expert_0_gpu5 [label="Layer 13 Expert 0\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_1_gpu5 [label="Layer 13 Expert 1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_2_gpu5 [label="Layer 13 Expert 2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_3_gpu5 [label="Layer 13 Expert 3\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_agg_gpu5 [label="Layer 13 Expert Aggregation\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_13_moe_out_proj_gpu5 [label="Layer 13 MoE Output Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_residual2_gpu5 [label="Layer 13 Residual2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_12_output_gpu5 -> layer_13_ln1_gpu5
		layer_13_ln1_gpu5 -> layer_13_q_proj_gpu5
		layer_13_ln1_gpu5 -> layer_13_k_proj_gpu5
		layer_13_ln1_gpu5 -> layer_13_v_proj_gpu5
		layer_13_q_proj_gpu5 -> layer_13_attn_gpu5
		layer_13_k_proj_gpu5 -> layer_13_attn_gpu5
		layer_13_v_proj_gpu5 -> layer_13_attn_gpu5
		layer_13_attn_gpu5 -> layer_13_attn_out_proj_gpu5
		layer_13_attn_out_proj_gpu5 -> layer_13_residual1_gpu5
		layer_13_residual1_gpu5 -> layer_13_ln2_gpu5
		layer_13_ln2_gpu5 -> layer_13_router_gpu5
		layer_13_router_gpu5 -> layer_13_gate_gpu5
		layer_13_gate_gpu5 -> layer_13_expert_0_gpu5 [style=dashed]
		layer_13_gate_gpu5 -> layer_13_expert_1_gpu5 [style=dashed]
		layer_13_gate_gpu5 -> layer_13_expert_2_gpu5 [style=dashed]
		layer_13_gate_gpu5 -> layer_13_expert_3_gpu5 [style=dashed]
		layer_13_expert_0_gpu5 -> layer_13_expert_agg_gpu5
		layer_13_expert_1_gpu5 -> layer_13_expert_agg_gpu5
		layer_13_expert_2_gpu5 -> layer_13_expert_agg_gpu5
		layer_13_expert_3_gpu5 -> layer_13_expert_agg_gpu5
		layer_13_expert_agg_gpu5 -> layer_13_moe_out_proj_gpu5
		layer_13_moe_out_proj_gpu5 -> layer_13_residual2_gpu5
		layer_13_output_gpu5 [label="Layer 13 Output\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_13_residual2_gpu5 -> layer_13_output_gpu5
		layer_14_ln1_gpu5 [label="Layer 14 LayerNorm1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_14_q_proj_gpu5 [label="Layer 14 Q Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_k_proj_gpu5 [label="Layer 14 K Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_v_proj_gpu5 [label="Layer 14 V Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_attn_gpu5 [label="Layer 14 Scaled Dot-Product Attention\nGPU 5\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_attn_out_proj_gpu5 [label="Layer 14 Attention Output Projection\nGPU 5\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_residual1_gpu5 [label="Layer 14 Residual1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_14_ln2_gpu5 [label="Layer 14 LayerNorm2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_14_router_gpu5 [label="Layer 14 Router\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_14_gate_gpu5 [label="Layer 14 Gate Selection\nGPU 5\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_14_expert_0_gpu5 [label="Layer 14 Expert 0\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_1_gpu5 [label="Layer 14 Expert 1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_2_gpu5 [label="Layer 14 Expert 2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_3_gpu5 [label="Layer 14 Expert 3\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_agg_gpu5 [label="Layer 14 Expert Aggregation\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_14_moe_out_proj_gpu5 [label="Layer 14 MoE Output Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_residual2_gpu5 [label="Layer 14 Residual2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_13_output_gpu5 -> layer_14_ln1_gpu5
		layer_14_ln1_gpu5 -> layer_14_q_proj_gpu5
		layer_14_ln1_gpu5 -> layer_14_k_proj_gpu5
		layer_14_ln1_gpu5 -> layer_14_v_proj_gpu5
		layer_14_q_proj_gpu5 -> layer_14_attn_gpu5
		layer_14_k_proj_gpu5 -> layer_14_attn_gpu5
		layer_14_v_proj_gpu5 -> layer_14_attn_gpu5
		layer_14_attn_gpu5 -> layer_14_attn_out_proj_gpu5
		layer_14_attn_out_proj_gpu5 -> layer_14_residual1_gpu5
		layer_14_residual1_gpu5 -> layer_14_ln2_gpu5
		layer_14_ln2_gpu5 -> layer_14_router_gpu5
		layer_14_router_gpu5 -> layer_14_gate_gpu5
		layer_14_gate_gpu5 -> layer_14_expert_0_gpu5 [style=dashed]
		layer_14_gate_gpu5 -> layer_14_expert_1_gpu5 [style=dashed]
		layer_14_gate_gpu5 -> layer_14_expert_2_gpu5 [style=dashed]
		layer_14_gate_gpu5 -> layer_14_expert_3_gpu5 [style=dashed]
		layer_14_expert_0_gpu5 -> layer_14_expert_agg_gpu5
		layer_14_expert_1_gpu5 -> layer_14_expert_agg_gpu5
		layer_14_expert_2_gpu5 -> layer_14_expert_agg_gpu5
		layer_14_expert_3_gpu5 -> layer_14_expert_agg_gpu5
		layer_14_expert_agg_gpu5 -> layer_14_moe_out_proj_gpu5
		layer_14_moe_out_proj_gpu5 -> layer_14_residual2_gpu5
		layer_14_output_gpu5 [label="Layer 14 Output\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_14_residual2_gpu5 -> layer_14_output_gpu5
		layer_15_ln1_gpu5 [label="Layer 15 LayerNorm1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_15_q_proj_gpu5 [label="Layer 15 Q Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_k_proj_gpu5 [label="Layer 15 K Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_v_proj_gpu5 [label="Layer 15 V Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_attn_gpu5 [label="Layer 15 Scaled Dot-Product Attention\nGPU 5\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_attn_out_proj_gpu5 [label="Layer 15 Attention Output Projection\nGPU 5\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_residual1_gpu5 [label="Layer 15 Residual1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_15_ln2_gpu5 [label="Layer 15 LayerNorm2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_15_router_gpu5 [label="Layer 15 Router\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_15_gate_gpu5 [label="Layer 15 Gate Selection\nGPU 5\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_15_expert_0_gpu5 [label="Layer 15 Expert 0\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_1_gpu5 [label="Layer 15 Expert 1\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_2_gpu5 [label="Layer 15 Expert 2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_3_gpu5 [label="Layer 15 Expert 3\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_agg_gpu5 [label="Layer 15 Expert Aggregation\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_15_moe_out_proj_gpu5 [label="Layer 15 MoE Output Projection\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_residual2_gpu5 [label="Layer 15 Residual2\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_14_output_gpu5 -> layer_15_ln1_gpu5
		layer_15_ln1_gpu5 -> layer_15_q_proj_gpu5
		layer_15_ln1_gpu5 -> layer_15_k_proj_gpu5
		layer_15_ln1_gpu5 -> layer_15_v_proj_gpu5
		layer_15_q_proj_gpu5 -> layer_15_attn_gpu5
		layer_15_k_proj_gpu5 -> layer_15_attn_gpu5
		layer_15_v_proj_gpu5 -> layer_15_attn_gpu5
		layer_15_attn_gpu5 -> layer_15_attn_out_proj_gpu5
		layer_15_attn_out_proj_gpu5 -> layer_15_residual1_gpu5
		layer_15_residual1_gpu5 -> layer_15_ln2_gpu5
		layer_15_ln2_gpu5 -> layer_15_router_gpu5
		layer_15_router_gpu5 -> layer_15_gate_gpu5
		layer_15_gate_gpu5 -> layer_15_expert_0_gpu5 [style=dashed]
		layer_15_gate_gpu5 -> layer_15_expert_1_gpu5 [style=dashed]
		layer_15_gate_gpu5 -> layer_15_expert_2_gpu5 [style=dashed]
		layer_15_gate_gpu5 -> layer_15_expert_3_gpu5 [style=dashed]
		layer_15_expert_0_gpu5 -> layer_15_expert_agg_gpu5
		layer_15_expert_1_gpu5 -> layer_15_expert_agg_gpu5
		layer_15_expert_2_gpu5 -> layer_15_expert_agg_gpu5
		layer_15_expert_3_gpu5 -> layer_15_expert_agg_gpu5
		layer_15_expert_agg_gpu5 -> layer_15_moe_out_proj_gpu5
		layer_15_moe_out_proj_gpu5 -> layer_15_residual2_gpu5
		layer_15_output_gpu5 [label="Layer 15 Output\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_15_residual2_gpu5 -> layer_15_output_gpu5
		final_ln_gpu5 [label="Final Layer Norm\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		layer_15_output_gpu5 -> final_ln_gpu5
		lm_head_gpu5 [label="LM Head\nGPU 5\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, vocab_size]" fillcolor=lightcoral shape=rectangle style=filled]
		output_gpu5 [label="Output\nGPU 5\nInput: [batch=256, seq=512, vocab_size]\nOutput: [batch=256, seq=512, vocab_size]" fillcolor=lightgreen shape=ellipse style=filled]
		input_gpu5 -> embed_gpu5
		embed_gpu5 -> pos_enc_gpu5
		final_ln_gpu5 -> lm_head_gpu5
		lm_head_gpu5 -> output_gpu5
	}
	subgraph cluster_gpu_6 {
		color=blue fillcolor=lightblue label="GPU 6" style=rounded
		input_gpu6 [label="Input\nGPU 6\nInput: [batch=256, seq=512, dim=1024]\nOutput: [batch=256, seq=512, dim=1024]" fillcolor=lightgreen shape=ellipse style=filled]
		embed_gpu6 [label="Token Embedding\nGPU 6\nInput: [batch=256, seq=512]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		pos_enc_gpu6 [label="Position Encoding\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		layer_0_ln1_gpu6 [label="Layer 0 LayerNorm1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_0_q_proj_gpu6 [label="Layer 0 Q Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_k_proj_gpu6 [label="Layer 0 K Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_v_proj_gpu6 [label="Layer 0 V Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_attn_gpu6 [label="Layer 0 Scaled Dot-Product Attention\nGPU 6\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_attn_out_proj_gpu6 [label="Layer 0 Attention Output Projection\nGPU 6\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_residual1_gpu6 [label="Layer 0 Residual1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_0_ln2_gpu6 [label="Layer 0 LayerNorm2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_0_router_gpu6 [label="Layer 0 Router\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_0_gate_gpu6 [label="Layer 0 Gate Selection\nGPU 6\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_0_expert_0_gpu6 [label="Layer 0 Expert 0\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_1_gpu6 [label="Layer 0 Expert 1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_2_gpu6 [label="Layer 0 Expert 2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_3_gpu6 [label="Layer 0 Expert 3\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_agg_gpu6 [label="Layer 0 Expert Aggregation\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_0_moe_out_proj_gpu6 [label="Layer 0 MoE Output Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_residual2_gpu6 [label="Layer 0 Residual2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		pos_enc_gpu6 -> layer_0_ln1_gpu6
		layer_0_ln1_gpu6 -> layer_0_q_proj_gpu6
		layer_0_ln1_gpu6 -> layer_0_k_proj_gpu6
		layer_0_ln1_gpu6 -> layer_0_v_proj_gpu6
		layer_0_q_proj_gpu6 -> layer_0_attn_gpu6
		layer_0_k_proj_gpu6 -> layer_0_attn_gpu6
		layer_0_v_proj_gpu6 -> layer_0_attn_gpu6
		layer_0_attn_gpu6 -> layer_0_attn_out_proj_gpu6
		layer_0_attn_out_proj_gpu6 -> layer_0_residual1_gpu6
		layer_0_residual1_gpu6 -> layer_0_ln2_gpu6
		layer_0_ln2_gpu6 -> layer_0_router_gpu6
		layer_0_router_gpu6 -> layer_0_gate_gpu6
		layer_0_gate_gpu6 -> layer_0_expert_0_gpu6 [style=dashed]
		layer_0_gate_gpu6 -> layer_0_expert_1_gpu6 [style=dashed]
		layer_0_gate_gpu6 -> layer_0_expert_2_gpu6 [style=dashed]
		layer_0_gate_gpu6 -> layer_0_expert_3_gpu6 [style=dashed]
		layer_0_expert_0_gpu6 -> layer_0_expert_agg_gpu6
		layer_0_expert_1_gpu6 -> layer_0_expert_agg_gpu6
		layer_0_expert_2_gpu6 -> layer_0_expert_agg_gpu6
		layer_0_expert_3_gpu6 -> layer_0_expert_agg_gpu6
		layer_0_expert_agg_gpu6 -> layer_0_moe_out_proj_gpu6
		layer_0_moe_out_proj_gpu6 -> layer_0_residual2_gpu6
		layer_0_output_gpu6 [label="Layer 0 Output\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_0_residual2_gpu6 -> layer_0_output_gpu6
		layer_1_ln1_gpu6 [label="Layer 1 LayerNorm1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_1_q_proj_gpu6 [label="Layer 1 Q Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_k_proj_gpu6 [label="Layer 1 K Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_v_proj_gpu6 [label="Layer 1 V Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_attn_gpu6 [label="Layer 1 Scaled Dot-Product Attention\nGPU 6\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_attn_out_proj_gpu6 [label="Layer 1 Attention Output Projection\nGPU 6\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_residual1_gpu6 [label="Layer 1 Residual1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_1_ln2_gpu6 [label="Layer 1 LayerNorm2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_1_router_gpu6 [label="Layer 1 Router\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_1_gate_gpu6 [label="Layer 1 Gate Selection\nGPU 6\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_1_expert_0_gpu6 [label="Layer 1 Expert 0\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_1_gpu6 [label="Layer 1 Expert 1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_2_gpu6 [label="Layer 1 Expert 2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_3_gpu6 [label="Layer 1 Expert 3\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_agg_gpu6 [label="Layer 1 Expert Aggregation\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_1_moe_out_proj_gpu6 [label="Layer 1 MoE Output Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_residual2_gpu6 [label="Layer 1 Residual2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_0_output_gpu6 -> layer_1_ln1_gpu6
		layer_1_ln1_gpu6 -> layer_1_q_proj_gpu6
		layer_1_ln1_gpu6 -> layer_1_k_proj_gpu6
		layer_1_ln1_gpu6 -> layer_1_v_proj_gpu6
		layer_1_q_proj_gpu6 -> layer_1_attn_gpu6
		layer_1_k_proj_gpu6 -> layer_1_attn_gpu6
		layer_1_v_proj_gpu6 -> layer_1_attn_gpu6
		layer_1_attn_gpu6 -> layer_1_attn_out_proj_gpu6
		layer_1_attn_out_proj_gpu6 -> layer_1_residual1_gpu6
		layer_1_residual1_gpu6 -> layer_1_ln2_gpu6
		layer_1_ln2_gpu6 -> layer_1_router_gpu6
		layer_1_router_gpu6 -> layer_1_gate_gpu6
		layer_1_gate_gpu6 -> layer_1_expert_0_gpu6 [style=dashed]
		layer_1_gate_gpu6 -> layer_1_expert_1_gpu6 [style=dashed]
		layer_1_gate_gpu6 -> layer_1_expert_2_gpu6 [style=dashed]
		layer_1_gate_gpu6 -> layer_1_expert_3_gpu6 [style=dashed]
		layer_1_expert_0_gpu6 -> layer_1_expert_agg_gpu6
		layer_1_expert_1_gpu6 -> layer_1_expert_agg_gpu6
		layer_1_expert_2_gpu6 -> layer_1_expert_agg_gpu6
		layer_1_expert_3_gpu6 -> layer_1_expert_agg_gpu6
		layer_1_expert_agg_gpu6 -> layer_1_moe_out_proj_gpu6
		layer_1_moe_out_proj_gpu6 -> layer_1_residual2_gpu6
		layer_1_output_gpu6 [label="Layer 1 Output\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_1_residual2_gpu6 -> layer_1_output_gpu6
		layer_2_ln1_gpu6 [label="Layer 2 LayerNorm1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_2_q_proj_gpu6 [label="Layer 2 Q Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_k_proj_gpu6 [label="Layer 2 K Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_v_proj_gpu6 [label="Layer 2 V Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_attn_gpu6 [label="Layer 2 Scaled Dot-Product Attention\nGPU 6\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_attn_out_proj_gpu6 [label="Layer 2 Attention Output Projection\nGPU 6\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_residual1_gpu6 [label="Layer 2 Residual1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_2_ln2_gpu6 [label="Layer 2 LayerNorm2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_2_router_gpu6 [label="Layer 2 Router\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_2_gate_gpu6 [label="Layer 2 Gate Selection\nGPU 6\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_2_expert_0_gpu6 [label="Layer 2 Expert 0\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_1_gpu6 [label="Layer 2 Expert 1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_2_gpu6 [label="Layer 2 Expert 2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_3_gpu6 [label="Layer 2 Expert 3\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_agg_gpu6 [label="Layer 2 Expert Aggregation\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_2_moe_out_proj_gpu6 [label="Layer 2 MoE Output Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_residual2_gpu6 [label="Layer 2 Residual2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_1_output_gpu6 -> layer_2_ln1_gpu6
		layer_2_ln1_gpu6 -> layer_2_q_proj_gpu6
		layer_2_ln1_gpu6 -> layer_2_k_proj_gpu6
		layer_2_ln1_gpu6 -> layer_2_v_proj_gpu6
		layer_2_q_proj_gpu6 -> layer_2_attn_gpu6
		layer_2_k_proj_gpu6 -> layer_2_attn_gpu6
		layer_2_v_proj_gpu6 -> layer_2_attn_gpu6
		layer_2_attn_gpu6 -> layer_2_attn_out_proj_gpu6
		layer_2_attn_out_proj_gpu6 -> layer_2_residual1_gpu6
		layer_2_residual1_gpu6 -> layer_2_ln2_gpu6
		layer_2_ln2_gpu6 -> layer_2_router_gpu6
		layer_2_router_gpu6 -> layer_2_gate_gpu6
		layer_2_gate_gpu6 -> layer_2_expert_0_gpu6 [style=dashed]
		layer_2_gate_gpu6 -> layer_2_expert_1_gpu6 [style=dashed]
		layer_2_gate_gpu6 -> layer_2_expert_2_gpu6 [style=dashed]
		layer_2_gate_gpu6 -> layer_2_expert_3_gpu6 [style=dashed]
		layer_2_expert_0_gpu6 -> layer_2_expert_agg_gpu6
		layer_2_expert_1_gpu6 -> layer_2_expert_agg_gpu6
		layer_2_expert_2_gpu6 -> layer_2_expert_agg_gpu6
		layer_2_expert_3_gpu6 -> layer_2_expert_agg_gpu6
		layer_2_expert_agg_gpu6 -> layer_2_moe_out_proj_gpu6
		layer_2_moe_out_proj_gpu6 -> layer_2_residual2_gpu6
		layer_2_output_gpu6 [label="Layer 2 Output\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_2_residual2_gpu6 -> layer_2_output_gpu6
		layer_3_ln1_gpu6 [label="Layer 3 LayerNorm1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_3_q_proj_gpu6 [label="Layer 3 Q Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_k_proj_gpu6 [label="Layer 3 K Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_v_proj_gpu6 [label="Layer 3 V Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_attn_gpu6 [label="Layer 3 Scaled Dot-Product Attention\nGPU 6\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_attn_out_proj_gpu6 [label="Layer 3 Attention Output Projection\nGPU 6\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_residual1_gpu6 [label="Layer 3 Residual1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_3_ln2_gpu6 [label="Layer 3 LayerNorm2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_3_router_gpu6 [label="Layer 3 Router\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_3_gate_gpu6 [label="Layer 3 Gate Selection\nGPU 6\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_3_expert_0_gpu6 [label="Layer 3 Expert 0\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_1_gpu6 [label="Layer 3 Expert 1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_2_gpu6 [label="Layer 3 Expert 2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_3_gpu6 [label="Layer 3 Expert 3\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_agg_gpu6 [label="Layer 3 Expert Aggregation\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_3_moe_out_proj_gpu6 [label="Layer 3 MoE Output Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_residual2_gpu6 [label="Layer 3 Residual2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_2_output_gpu6 -> layer_3_ln1_gpu6
		layer_3_ln1_gpu6 -> layer_3_q_proj_gpu6
		layer_3_ln1_gpu6 -> layer_3_k_proj_gpu6
		layer_3_ln1_gpu6 -> layer_3_v_proj_gpu6
		layer_3_q_proj_gpu6 -> layer_3_attn_gpu6
		layer_3_k_proj_gpu6 -> layer_3_attn_gpu6
		layer_3_v_proj_gpu6 -> layer_3_attn_gpu6
		layer_3_attn_gpu6 -> layer_3_attn_out_proj_gpu6
		layer_3_attn_out_proj_gpu6 -> layer_3_residual1_gpu6
		layer_3_residual1_gpu6 -> layer_3_ln2_gpu6
		layer_3_ln2_gpu6 -> layer_3_router_gpu6
		layer_3_router_gpu6 -> layer_3_gate_gpu6
		layer_3_gate_gpu6 -> layer_3_expert_0_gpu6 [style=dashed]
		layer_3_gate_gpu6 -> layer_3_expert_1_gpu6 [style=dashed]
		layer_3_gate_gpu6 -> layer_3_expert_2_gpu6 [style=dashed]
		layer_3_gate_gpu6 -> layer_3_expert_3_gpu6 [style=dashed]
		layer_3_expert_0_gpu6 -> layer_3_expert_agg_gpu6
		layer_3_expert_1_gpu6 -> layer_3_expert_agg_gpu6
		layer_3_expert_2_gpu6 -> layer_3_expert_agg_gpu6
		layer_3_expert_3_gpu6 -> layer_3_expert_agg_gpu6
		layer_3_expert_agg_gpu6 -> layer_3_moe_out_proj_gpu6
		layer_3_moe_out_proj_gpu6 -> layer_3_residual2_gpu6
		layer_3_output_gpu6 [label="Layer 3 Output\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_3_residual2_gpu6 -> layer_3_output_gpu6
		layer_4_ln1_gpu6 [label="Layer 4 LayerNorm1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_4_q_proj_gpu6 [label="Layer 4 Q Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_k_proj_gpu6 [label="Layer 4 K Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_v_proj_gpu6 [label="Layer 4 V Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_attn_gpu6 [label="Layer 4 Scaled Dot-Product Attention\nGPU 6\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_attn_out_proj_gpu6 [label="Layer 4 Attention Output Projection\nGPU 6\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_residual1_gpu6 [label="Layer 4 Residual1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_4_ln2_gpu6 [label="Layer 4 LayerNorm2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_4_router_gpu6 [label="Layer 4 Router\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_4_gate_gpu6 [label="Layer 4 Gate Selection\nGPU 6\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_4_expert_0_gpu6 [label="Layer 4 Expert 0\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_1_gpu6 [label="Layer 4 Expert 1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_2_gpu6 [label="Layer 4 Expert 2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_3_gpu6 [label="Layer 4 Expert 3\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_agg_gpu6 [label="Layer 4 Expert Aggregation\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_4_moe_out_proj_gpu6 [label="Layer 4 MoE Output Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_residual2_gpu6 [label="Layer 4 Residual2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_3_output_gpu6 -> layer_4_ln1_gpu6
		layer_4_ln1_gpu6 -> layer_4_q_proj_gpu6
		layer_4_ln1_gpu6 -> layer_4_k_proj_gpu6
		layer_4_ln1_gpu6 -> layer_4_v_proj_gpu6
		layer_4_q_proj_gpu6 -> layer_4_attn_gpu6
		layer_4_k_proj_gpu6 -> layer_4_attn_gpu6
		layer_4_v_proj_gpu6 -> layer_4_attn_gpu6
		layer_4_attn_gpu6 -> layer_4_attn_out_proj_gpu6
		layer_4_attn_out_proj_gpu6 -> layer_4_residual1_gpu6
		layer_4_residual1_gpu6 -> layer_4_ln2_gpu6
		layer_4_ln2_gpu6 -> layer_4_router_gpu6
		layer_4_router_gpu6 -> layer_4_gate_gpu6
		layer_4_gate_gpu6 -> layer_4_expert_0_gpu6 [style=dashed]
		layer_4_gate_gpu6 -> layer_4_expert_1_gpu6 [style=dashed]
		layer_4_gate_gpu6 -> layer_4_expert_2_gpu6 [style=dashed]
		layer_4_gate_gpu6 -> layer_4_expert_3_gpu6 [style=dashed]
		layer_4_expert_0_gpu6 -> layer_4_expert_agg_gpu6
		layer_4_expert_1_gpu6 -> layer_4_expert_agg_gpu6
		layer_4_expert_2_gpu6 -> layer_4_expert_agg_gpu6
		layer_4_expert_3_gpu6 -> layer_4_expert_agg_gpu6
		layer_4_expert_agg_gpu6 -> layer_4_moe_out_proj_gpu6
		layer_4_moe_out_proj_gpu6 -> layer_4_residual2_gpu6
		layer_4_output_gpu6 [label="Layer 4 Output\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_4_residual2_gpu6 -> layer_4_output_gpu6
		layer_5_ln1_gpu6 [label="Layer 5 LayerNorm1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_5_q_proj_gpu6 [label="Layer 5 Q Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_k_proj_gpu6 [label="Layer 5 K Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_v_proj_gpu6 [label="Layer 5 V Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_attn_gpu6 [label="Layer 5 Scaled Dot-Product Attention\nGPU 6\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_attn_out_proj_gpu6 [label="Layer 5 Attention Output Projection\nGPU 6\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_residual1_gpu6 [label="Layer 5 Residual1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_5_ln2_gpu6 [label="Layer 5 LayerNorm2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_5_router_gpu6 [label="Layer 5 Router\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_5_gate_gpu6 [label="Layer 5 Gate Selection\nGPU 6\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_5_expert_0_gpu6 [label="Layer 5 Expert 0\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_1_gpu6 [label="Layer 5 Expert 1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_2_gpu6 [label="Layer 5 Expert 2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_3_gpu6 [label="Layer 5 Expert 3\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_agg_gpu6 [label="Layer 5 Expert Aggregation\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_5_moe_out_proj_gpu6 [label="Layer 5 MoE Output Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_residual2_gpu6 [label="Layer 5 Residual2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_4_output_gpu6 -> layer_5_ln1_gpu6
		layer_5_ln1_gpu6 -> layer_5_q_proj_gpu6
		layer_5_ln1_gpu6 -> layer_5_k_proj_gpu6
		layer_5_ln1_gpu6 -> layer_5_v_proj_gpu6
		layer_5_q_proj_gpu6 -> layer_5_attn_gpu6
		layer_5_k_proj_gpu6 -> layer_5_attn_gpu6
		layer_5_v_proj_gpu6 -> layer_5_attn_gpu6
		layer_5_attn_gpu6 -> layer_5_attn_out_proj_gpu6
		layer_5_attn_out_proj_gpu6 -> layer_5_residual1_gpu6
		layer_5_residual1_gpu6 -> layer_5_ln2_gpu6
		layer_5_ln2_gpu6 -> layer_5_router_gpu6
		layer_5_router_gpu6 -> layer_5_gate_gpu6
		layer_5_gate_gpu6 -> layer_5_expert_0_gpu6 [style=dashed]
		layer_5_gate_gpu6 -> layer_5_expert_1_gpu6 [style=dashed]
		layer_5_gate_gpu6 -> layer_5_expert_2_gpu6 [style=dashed]
		layer_5_gate_gpu6 -> layer_5_expert_3_gpu6 [style=dashed]
		layer_5_expert_0_gpu6 -> layer_5_expert_agg_gpu6
		layer_5_expert_1_gpu6 -> layer_5_expert_agg_gpu6
		layer_5_expert_2_gpu6 -> layer_5_expert_agg_gpu6
		layer_5_expert_3_gpu6 -> layer_5_expert_agg_gpu6
		layer_5_expert_agg_gpu6 -> layer_5_moe_out_proj_gpu6
		layer_5_moe_out_proj_gpu6 -> layer_5_residual2_gpu6
		layer_5_output_gpu6 [label="Layer 5 Output\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_5_residual2_gpu6 -> layer_5_output_gpu6
		layer_6_ln1_gpu6 [label="Layer 6 LayerNorm1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_6_q_proj_gpu6 [label="Layer 6 Q Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_k_proj_gpu6 [label="Layer 6 K Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_v_proj_gpu6 [label="Layer 6 V Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_attn_gpu6 [label="Layer 6 Scaled Dot-Product Attention\nGPU 6\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_attn_out_proj_gpu6 [label="Layer 6 Attention Output Projection\nGPU 6\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_residual1_gpu6 [label="Layer 6 Residual1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_6_ln2_gpu6 [label="Layer 6 LayerNorm2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_6_router_gpu6 [label="Layer 6 Router\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_6_gate_gpu6 [label="Layer 6 Gate Selection\nGPU 6\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_6_expert_0_gpu6 [label="Layer 6 Expert 0\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_1_gpu6 [label="Layer 6 Expert 1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_2_gpu6 [label="Layer 6 Expert 2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_3_gpu6 [label="Layer 6 Expert 3\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_agg_gpu6 [label="Layer 6 Expert Aggregation\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_6_moe_out_proj_gpu6 [label="Layer 6 MoE Output Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_residual2_gpu6 [label="Layer 6 Residual2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_5_output_gpu6 -> layer_6_ln1_gpu6
		layer_6_ln1_gpu6 -> layer_6_q_proj_gpu6
		layer_6_ln1_gpu6 -> layer_6_k_proj_gpu6
		layer_6_ln1_gpu6 -> layer_6_v_proj_gpu6
		layer_6_q_proj_gpu6 -> layer_6_attn_gpu6
		layer_6_k_proj_gpu6 -> layer_6_attn_gpu6
		layer_6_v_proj_gpu6 -> layer_6_attn_gpu6
		layer_6_attn_gpu6 -> layer_6_attn_out_proj_gpu6
		layer_6_attn_out_proj_gpu6 -> layer_6_residual1_gpu6
		layer_6_residual1_gpu6 -> layer_6_ln2_gpu6
		layer_6_ln2_gpu6 -> layer_6_router_gpu6
		layer_6_router_gpu6 -> layer_6_gate_gpu6
		layer_6_gate_gpu6 -> layer_6_expert_0_gpu6 [style=dashed]
		layer_6_gate_gpu6 -> layer_6_expert_1_gpu6 [style=dashed]
		layer_6_gate_gpu6 -> layer_6_expert_2_gpu6 [style=dashed]
		layer_6_gate_gpu6 -> layer_6_expert_3_gpu6 [style=dashed]
		layer_6_expert_0_gpu6 -> layer_6_expert_agg_gpu6
		layer_6_expert_1_gpu6 -> layer_6_expert_agg_gpu6
		layer_6_expert_2_gpu6 -> layer_6_expert_agg_gpu6
		layer_6_expert_3_gpu6 -> layer_6_expert_agg_gpu6
		layer_6_expert_agg_gpu6 -> layer_6_moe_out_proj_gpu6
		layer_6_moe_out_proj_gpu6 -> layer_6_residual2_gpu6
		layer_6_output_gpu6 [label="Layer 6 Output\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_6_residual2_gpu6 -> layer_6_output_gpu6
		layer_7_ln1_gpu6 [label="Layer 7 LayerNorm1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_7_q_proj_gpu6 [label="Layer 7 Q Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_k_proj_gpu6 [label="Layer 7 K Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_v_proj_gpu6 [label="Layer 7 V Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_attn_gpu6 [label="Layer 7 Scaled Dot-Product Attention\nGPU 6\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_attn_out_proj_gpu6 [label="Layer 7 Attention Output Projection\nGPU 6\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_residual1_gpu6 [label="Layer 7 Residual1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_7_ln2_gpu6 [label="Layer 7 LayerNorm2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_7_router_gpu6 [label="Layer 7 Router\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_7_gate_gpu6 [label="Layer 7 Gate Selection\nGPU 6\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_7_expert_0_gpu6 [label="Layer 7 Expert 0\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_1_gpu6 [label="Layer 7 Expert 1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_2_gpu6 [label="Layer 7 Expert 2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_3_gpu6 [label="Layer 7 Expert 3\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_agg_gpu6 [label="Layer 7 Expert Aggregation\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_7_moe_out_proj_gpu6 [label="Layer 7 MoE Output Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_residual2_gpu6 [label="Layer 7 Residual2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_6_output_gpu6 -> layer_7_ln1_gpu6
		layer_7_ln1_gpu6 -> layer_7_q_proj_gpu6
		layer_7_ln1_gpu6 -> layer_7_k_proj_gpu6
		layer_7_ln1_gpu6 -> layer_7_v_proj_gpu6
		layer_7_q_proj_gpu6 -> layer_7_attn_gpu6
		layer_7_k_proj_gpu6 -> layer_7_attn_gpu6
		layer_7_v_proj_gpu6 -> layer_7_attn_gpu6
		layer_7_attn_gpu6 -> layer_7_attn_out_proj_gpu6
		layer_7_attn_out_proj_gpu6 -> layer_7_residual1_gpu6
		layer_7_residual1_gpu6 -> layer_7_ln2_gpu6
		layer_7_ln2_gpu6 -> layer_7_router_gpu6
		layer_7_router_gpu6 -> layer_7_gate_gpu6
		layer_7_gate_gpu6 -> layer_7_expert_0_gpu6 [style=dashed]
		layer_7_gate_gpu6 -> layer_7_expert_1_gpu6 [style=dashed]
		layer_7_gate_gpu6 -> layer_7_expert_2_gpu6 [style=dashed]
		layer_7_gate_gpu6 -> layer_7_expert_3_gpu6 [style=dashed]
		layer_7_expert_0_gpu6 -> layer_7_expert_agg_gpu6
		layer_7_expert_1_gpu6 -> layer_7_expert_agg_gpu6
		layer_7_expert_2_gpu6 -> layer_7_expert_agg_gpu6
		layer_7_expert_3_gpu6 -> layer_7_expert_agg_gpu6
		layer_7_expert_agg_gpu6 -> layer_7_moe_out_proj_gpu6
		layer_7_moe_out_proj_gpu6 -> layer_7_residual2_gpu6
		layer_7_output_gpu6 [label="Layer 7 Output\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_7_residual2_gpu6 -> layer_7_output_gpu6
		layer_8_ln1_gpu6 [label="Layer 8 LayerNorm1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_8_q_proj_gpu6 [label="Layer 8 Q Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_k_proj_gpu6 [label="Layer 8 K Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_v_proj_gpu6 [label="Layer 8 V Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_attn_gpu6 [label="Layer 8 Scaled Dot-Product Attention\nGPU 6\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_attn_out_proj_gpu6 [label="Layer 8 Attention Output Projection\nGPU 6\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_residual1_gpu6 [label="Layer 8 Residual1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_8_ln2_gpu6 [label="Layer 8 LayerNorm2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_8_router_gpu6 [label="Layer 8 Router\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_8_gate_gpu6 [label="Layer 8 Gate Selection\nGPU 6\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_8_expert_0_gpu6 [label="Layer 8 Expert 0\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_1_gpu6 [label="Layer 8 Expert 1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_2_gpu6 [label="Layer 8 Expert 2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_3_gpu6 [label="Layer 8 Expert 3\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_agg_gpu6 [label="Layer 8 Expert Aggregation\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_8_moe_out_proj_gpu6 [label="Layer 8 MoE Output Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_residual2_gpu6 [label="Layer 8 Residual2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_7_output_gpu6 -> layer_8_ln1_gpu6
		layer_8_ln1_gpu6 -> layer_8_q_proj_gpu6
		layer_8_ln1_gpu6 -> layer_8_k_proj_gpu6
		layer_8_ln1_gpu6 -> layer_8_v_proj_gpu6
		layer_8_q_proj_gpu6 -> layer_8_attn_gpu6
		layer_8_k_proj_gpu6 -> layer_8_attn_gpu6
		layer_8_v_proj_gpu6 -> layer_8_attn_gpu6
		layer_8_attn_gpu6 -> layer_8_attn_out_proj_gpu6
		layer_8_attn_out_proj_gpu6 -> layer_8_residual1_gpu6
		layer_8_residual1_gpu6 -> layer_8_ln2_gpu6
		layer_8_ln2_gpu6 -> layer_8_router_gpu6
		layer_8_router_gpu6 -> layer_8_gate_gpu6
		layer_8_gate_gpu6 -> layer_8_expert_0_gpu6 [style=dashed]
		layer_8_gate_gpu6 -> layer_8_expert_1_gpu6 [style=dashed]
		layer_8_gate_gpu6 -> layer_8_expert_2_gpu6 [style=dashed]
		layer_8_gate_gpu6 -> layer_8_expert_3_gpu6 [style=dashed]
		layer_8_expert_0_gpu6 -> layer_8_expert_agg_gpu6
		layer_8_expert_1_gpu6 -> layer_8_expert_agg_gpu6
		layer_8_expert_2_gpu6 -> layer_8_expert_agg_gpu6
		layer_8_expert_3_gpu6 -> layer_8_expert_agg_gpu6
		layer_8_expert_agg_gpu6 -> layer_8_moe_out_proj_gpu6
		layer_8_moe_out_proj_gpu6 -> layer_8_residual2_gpu6
		layer_8_output_gpu6 [label="Layer 8 Output\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_8_residual2_gpu6 -> layer_8_output_gpu6
		layer_9_ln1_gpu6 [label="Layer 9 LayerNorm1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_9_q_proj_gpu6 [label="Layer 9 Q Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_k_proj_gpu6 [label="Layer 9 K Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_v_proj_gpu6 [label="Layer 9 V Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_attn_gpu6 [label="Layer 9 Scaled Dot-Product Attention\nGPU 6\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_attn_out_proj_gpu6 [label="Layer 9 Attention Output Projection\nGPU 6\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_residual1_gpu6 [label="Layer 9 Residual1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_9_ln2_gpu6 [label="Layer 9 LayerNorm2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_9_router_gpu6 [label="Layer 9 Router\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_9_gate_gpu6 [label="Layer 9 Gate Selection\nGPU 6\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_9_expert_0_gpu6 [label="Layer 9 Expert 0\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_1_gpu6 [label="Layer 9 Expert 1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_2_gpu6 [label="Layer 9 Expert 2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_3_gpu6 [label="Layer 9 Expert 3\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_agg_gpu6 [label="Layer 9 Expert Aggregation\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_9_moe_out_proj_gpu6 [label="Layer 9 MoE Output Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_residual2_gpu6 [label="Layer 9 Residual2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_8_output_gpu6 -> layer_9_ln1_gpu6
		layer_9_ln1_gpu6 -> layer_9_q_proj_gpu6
		layer_9_ln1_gpu6 -> layer_9_k_proj_gpu6
		layer_9_ln1_gpu6 -> layer_9_v_proj_gpu6
		layer_9_q_proj_gpu6 -> layer_9_attn_gpu6
		layer_9_k_proj_gpu6 -> layer_9_attn_gpu6
		layer_9_v_proj_gpu6 -> layer_9_attn_gpu6
		layer_9_attn_gpu6 -> layer_9_attn_out_proj_gpu6
		layer_9_attn_out_proj_gpu6 -> layer_9_residual1_gpu6
		layer_9_residual1_gpu6 -> layer_9_ln2_gpu6
		layer_9_ln2_gpu6 -> layer_9_router_gpu6
		layer_9_router_gpu6 -> layer_9_gate_gpu6
		layer_9_gate_gpu6 -> layer_9_expert_0_gpu6 [style=dashed]
		layer_9_gate_gpu6 -> layer_9_expert_1_gpu6 [style=dashed]
		layer_9_gate_gpu6 -> layer_9_expert_2_gpu6 [style=dashed]
		layer_9_gate_gpu6 -> layer_9_expert_3_gpu6 [style=dashed]
		layer_9_expert_0_gpu6 -> layer_9_expert_agg_gpu6
		layer_9_expert_1_gpu6 -> layer_9_expert_agg_gpu6
		layer_9_expert_2_gpu6 -> layer_9_expert_agg_gpu6
		layer_9_expert_3_gpu6 -> layer_9_expert_agg_gpu6
		layer_9_expert_agg_gpu6 -> layer_9_moe_out_proj_gpu6
		layer_9_moe_out_proj_gpu6 -> layer_9_residual2_gpu6
		layer_9_output_gpu6 [label="Layer 9 Output\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_9_residual2_gpu6 -> layer_9_output_gpu6
		layer_10_ln1_gpu6 [label="Layer 10 LayerNorm1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_10_q_proj_gpu6 [label="Layer 10 Q Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_k_proj_gpu6 [label="Layer 10 K Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_v_proj_gpu6 [label="Layer 10 V Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_attn_gpu6 [label="Layer 10 Scaled Dot-Product Attention\nGPU 6\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_attn_out_proj_gpu6 [label="Layer 10 Attention Output Projection\nGPU 6\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_residual1_gpu6 [label="Layer 10 Residual1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_10_ln2_gpu6 [label="Layer 10 LayerNorm2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_10_router_gpu6 [label="Layer 10 Router\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_10_gate_gpu6 [label="Layer 10 Gate Selection\nGPU 6\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_10_expert_0_gpu6 [label="Layer 10 Expert 0\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_1_gpu6 [label="Layer 10 Expert 1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_2_gpu6 [label="Layer 10 Expert 2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_3_gpu6 [label="Layer 10 Expert 3\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_agg_gpu6 [label="Layer 10 Expert Aggregation\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_10_moe_out_proj_gpu6 [label="Layer 10 MoE Output Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_residual2_gpu6 [label="Layer 10 Residual2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_9_output_gpu6 -> layer_10_ln1_gpu6
		layer_10_ln1_gpu6 -> layer_10_q_proj_gpu6
		layer_10_ln1_gpu6 -> layer_10_k_proj_gpu6
		layer_10_ln1_gpu6 -> layer_10_v_proj_gpu6
		layer_10_q_proj_gpu6 -> layer_10_attn_gpu6
		layer_10_k_proj_gpu6 -> layer_10_attn_gpu6
		layer_10_v_proj_gpu6 -> layer_10_attn_gpu6
		layer_10_attn_gpu6 -> layer_10_attn_out_proj_gpu6
		layer_10_attn_out_proj_gpu6 -> layer_10_residual1_gpu6
		layer_10_residual1_gpu6 -> layer_10_ln2_gpu6
		layer_10_ln2_gpu6 -> layer_10_router_gpu6
		layer_10_router_gpu6 -> layer_10_gate_gpu6
		layer_10_gate_gpu6 -> layer_10_expert_0_gpu6 [style=dashed]
		layer_10_gate_gpu6 -> layer_10_expert_1_gpu6 [style=dashed]
		layer_10_gate_gpu6 -> layer_10_expert_2_gpu6 [style=dashed]
		layer_10_gate_gpu6 -> layer_10_expert_3_gpu6 [style=dashed]
		layer_10_expert_0_gpu6 -> layer_10_expert_agg_gpu6
		layer_10_expert_1_gpu6 -> layer_10_expert_agg_gpu6
		layer_10_expert_2_gpu6 -> layer_10_expert_agg_gpu6
		layer_10_expert_3_gpu6 -> layer_10_expert_agg_gpu6
		layer_10_expert_agg_gpu6 -> layer_10_moe_out_proj_gpu6
		layer_10_moe_out_proj_gpu6 -> layer_10_residual2_gpu6
		layer_10_output_gpu6 [label="Layer 10 Output\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_10_residual2_gpu6 -> layer_10_output_gpu6
		layer_11_ln1_gpu6 [label="Layer 11 LayerNorm1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_11_q_proj_gpu6 [label="Layer 11 Q Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_k_proj_gpu6 [label="Layer 11 K Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_v_proj_gpu6 [label="Layer 11 V Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_attn_gpu6 [label="Layer 11 Scaled Dot-Product Attention\nGPU 6\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_attn_out_proj_gpu6 [label="Layer 11 Attention Output Projection\nGPU 6\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_residual1_gpu6 [label="Layer 11 Residual1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_11_ln2_gpu6 [label="Layer 11 LayerNorm2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_11_router_gpu6 [label="Layer 11 Router\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_11_gate_gpu6 [label="Layer 11 Gate Selection\nGPU 6\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_11_expert_0_gpu6 [label="Layer 11 Expert 0\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_1_gpu6 [label="Layer 11 Expert 1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_2_gpu6 [label="Layer 11 Expert 2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_3_gpu6 [label="Layer 11 Expert 3\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_agg_gpu6 [label="Layer 11 Expert Aggregation\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_11_moe_out_proj_gpu6 [label="Layer 11 MoE Output Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_residual2_gpu6 [label="Layer 11 Residual2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_10_output_gpu6 -> layer_11_ln1_gpu6
		layer_11_ln1_gpu6 -> layer_11_q_proj_gpu6
		layer_11_ln1_gpu6 -> layer_11_k_proj_gpu6
		layer_11_ln1_gpu6 -> layer_11_v_proj_gpu6
		layer_11_q_proj_gpu6 -> layer_11_attn_gpu6
		layer_11_k_proj_gpu6 -> layer_11_attn_gpu6
		layer_11_v_proj_gpu6 -> layer_11_attn_gpu6
		layer_11_attn_gpu6 -> layer_11_attn_out_proj_gpu6
		layer_11_attn_out_proj_gpu6 -> layer_11_residual1_gpu6
		layer_11_residual1_gpu6 -> layer_11_ln2_gpu6
		layer_11_ln2_gpu6 -> layer_11_router_gpu6
		layer_11_router_gpu6 -> layer_11_gate_gpu6
		layer_11_gate_gpu6 -> layer_11_expert_0_gpu6 [style=dashed]
		layer_11_gate_gpu6 -> layer_11_expert_1_gpu6 [style=dashed]
		layer_11_gate_gpu6 -> layer_11_expert_2_gpu6 [style=dashed]
		layer_11_gate_gpu6 -> layer_11_expert_3_gpu6 [style=dashed]
		layer_11_expert_0_gpu6 -> layer_11_expert_agg_gpu6
		layer_11_expert_1_gpu6 -> layer_11_expert_agg_gpu6
		layer_11_expert_2_gpu6 -> layer_11_expert_agg_gpu6
		layer_11_expert_3_gpu6 -> layer_11_expert_agg_gpu6
		layer_11_expert_agg_gpu6 -> layer_11_moe_out_proj_gpu6
		layer_11_moe_out_proj_gpu6 -> layer_11_residual2_gpu6
		layer_11_output_gpu6 [label="Layer 11 Output\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_11_residual2_gpu6 -> layer_11_output_gpu6
		layer_12_ln1_gpu6 [label="Layer 12 LayerNorm1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_12_q_proj_gpu6 [label="Layer 12 Q Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_k_proj_gpu6 [label="Layer 12 K Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_v_proj_gpu6 [label="Layer 12 V Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_attn_gpu6 [label="Layer 12 Scaled Dot-Product Attention\nGPU 6\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_attn_out_proj_gpu6 [label="Layer 12 Attention Output Projection\nGPU 6\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_residual1_gpu6 [label="Layer 12 Residual1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_12_ln2_gpu6 [label="Layer 12 LayerNorm2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_12_router_gpu6 [label="Layer 12 Router\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_12_gate_gpu6 [label="Layer 12 Gate Selection\nGPU 6\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_12_expert_0_gpu6 [label="Layer 12 Expert 0\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_1_gpu6 [label="Layer 12 Expert 1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_2_gpu6 [label="Layer 12 Expert 2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_3_gpu6 [label="Layer 12 Expert 3\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_agg_gpu6 [label="Layer 12 Expert Aggregation\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_12_moe_out_proj_gpu6 [label="Layer 12 MoE Output Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_residual2_gpu6 [label="Layer 12 Residual2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_11_output_gpu6 -> layer_12_ln1_gpu6
		layer_12_ln1_gpu6 -> layer_12_q_proj_gpu6
		layer_12_ln1_gpu6 -> layer_12_k_proj_gpu6
		layer_12_ln1_gpu6 -> layer_12_v_proj_gpu6
		layer_12_q_proj_gpu6 -> layer_12_attn_gpu6
		layer_12_k_proj_gpu6 -> layer_12_attn_gpu6
		layer_12_v_proj_gpu6 -> layer_12_attn_gpu6
		layer_12_attn_gpu6 -> layer_12_attn_out_proj_gpu6
		layer_12_attn_out_proj_gpu6 -> layer_12_residual1_gpu6
		layer_12_residual1_gpu6 -> layer_12_ln2_gpu6
		layer_12_ln2_gpu6 -> layer_12_router_gpu6
		layer_12_router_gpu6 -> layer_12_gate_gpu6
		layer_12_gate_gpu6 -> layer_12_expert_0_gpu6 [style=dashed]
		layer_12_gate_gpu6 -> layer_12_expert_1_gpu6 [style=dashed]
		layer_12_gate_gpu6 -> layer_12_expert_2_gpu6 [style=dashed]
		layer_12_gate_gpu6 -> layer_12_expert_3_gpu6 [style=dashed]
		layer_12_expert_0_gpu6 -> layer_12_expert_agg_gpu6
		layer_12_expert_1_gpu6 -> layer_12_expert_agg_gpu6
		layer_12_expert_2_gpu6 -> layer_12_expert_agg_gpu6
		layer_12_expert_3_gpu6 -> layer_12_expert_agg_gpu6
		layer_12_expert_agg_gpu6 -> layer_12_moe_out_proj_gpu6
		layer_12_moe_out_proj_gpu6 -> layer_12_residual2_gpu6
		layer_12_output_gpu6 [label="Layer 12 Output\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_12_residual2_gpu6 -> layer_12_output_gpu6
		layer_13_ln1_gpu6 [label="Layer 13 LayerNorm1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_13_q_proj_gpu6 [label="Layer 13 Q Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_k_proj_gpu6 [label="Layer 13 K Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_v_proj_gpu6 [label="Layer 13 V Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_attn_gpu6 [label="Layer 13 Scaled Dot-Product Attention\nGPU 6\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_attn_out_proj_gpu6 [label="Layer 13 Attention Output Projection\nGPU 6\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_residual1_gpu6 [label="Layer 13 Residual1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_13_ln2_gpu6 [label="Layer 13 LayerNorm2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_13_router_gpu6 [label="Layer 13 Router\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_13_gate_gpu6 [label="Layer 13 Gate Selection\nGPU 6\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_13_expert_0_gpu6 [label="Layer 13 Expert 0\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_1_gpu6 [label="Layer 13 Expert 1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_2_gpu6 [label="Layer 13 Expert 2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_3_gpu6 [label="Layer 13 Expert 3\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_agg_gpu6 [label="Layer 13 Expert Aggregation\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_13_moe_out_proj_gpu6 [label="Layer 13 MoE Output Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_residual2_gpu6 [label="Layer 13 Residual2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_12_output_gpu6 -> layer_13_ln1_gpu6
		layer_13_ln1_gpu6 -> layer_13_q_proj_gpu6
		layer_13_ln1_gpu6 -> layer_13_k_proj_gpu6
		layer_13_ln1_gpu6 -> layer_13_v_proj_gpu6
		layer_13_q_proj_gpu6 -> layer_13_attn_gpu6
		layer_13_k_proj_gpu6 -> layer_13_attn_gpu6
		layer_13_v_proj_gpu6 -> layer_13_attn_gpu6
		layer_13_attn_gpu6 -> layer_13_attn_out_proj_gpu6
		layer_13_attn_out_proj_gpu6 -> layer_13_residual1_gpu6
		layer_13_residual1_gpu6 -> layer_13_ln2_gpu6
		layer_13_ln2_gpu6 -> layer_13_router_gpu6
		layer_13_router_gpu6 -> layer_13_gate_gpu6
		layer_13_gate_gpu6 -> layer_13_expert_0_gpu6 [style=dashed]
		layer_13_gate_gpu6 -> layer_13_expert_1_gpu6 [style=dashed]
		layer_13_gate_gpu6 -> layer_13_expert_2_gpu6 [style=dashed]
		layer_13_gate_gpu6 -> layer_13_expert_3_gpu6 [style=dashed]
		layer_13_expert_0_gpu6 -> layer_13_expert_agg_gpu6
		layer_13_expert_1_gpu6 -> layer_13_expert_agg_gpu6
		layer_13_expert_2_gpu6 -> layer_13_expert_agg_gpu6
		layer_13_expert_3_gpu6 -> layer_13_expert_agg_gpu6
		layer_13_expert_agg_gpu6 -> layer_13_moe_out_proj_gpu6
		layer_13_moe_out_proj_gpu6 -> layer_13_residual2_gpu6
		layer_13_output_gpu6 [label="Layer 13 Output\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_13_residual2_gpu6 -> layer_13_output_gpu6
		layer_14_ln1_gpu6 [label="Layer 14 LayerNorm1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_14_q_proj_gpu6 [label="Layer 14 Q Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_k_proj_gpu6 [label="Layer 14 K Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_v_proj_gpu6 [label="Layer 14 V Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_attn_gpu6 [label="Layer 14 Scaled Dot-Product Attention\nGPU 6\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_attn_out_proj_gpu6 [label="Layer 14 Attention Output Projection\nGPU 6\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_residual1_gpu6 [label="Layer 14 Residual1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_14_ln2_gpu6 [label="Layer 14 LayerNorm2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_14_router_gpu6 [label="Layer 14 Router\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_14_gate_gpu6 [label="Layer 14 Gate Selection\nGPU 6\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_14_expert_0_gpu6 [label="Layer 14 Expert 0\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_1_gpu6 [label="Layer 14 Expert 1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_2_gpu6 [label="Layer 14 Expert 2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_3_gpu6 [label="Layer 14 Expert 3\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_agg_gpu6 [label="Layer 14 Expert Aggregation\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_14_moe_out_proj_gpu6 [label="Layer 14 MoE Output Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_residual2_gpu6 [label="Layer 14 Residual2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_13_output_gpu6 -> layer_14_ln1_gpu6
		layer_14_ln1_gpu6 -> layer_14_q_proj_gpu6
		layer_14_ln1_gpu6 -> layer_14_k_proj_gpu6
		layer_14_ln1_gpu6 -> layer_14_v_proj_gpu6
		layer_14_q_proj_gpu6 -> layer_14_attn_gpu6
		layer_14_k_proj_gpu6 -> layer_14_attn_gpu6
		layer_14_v_proj_gpu6 -> layer_14_attn_gpu6
		layer_14_attn_gpu6 -> layer_14_attn_out_proj_gpu6
		layer_14_attn_out_proj_gpu6 -> layer_14_residual1_gpu6
		layer_14_residual1_gpu6 -> layer_14_ln2_gpu6
		layer_14_ln2_gpu6 -> layer_14_router_gpu6
		layer_14_router_gpu6 -> layer_14_gate_gpu6
		layer_14_gate_gpu6 -> layer_14_expert_0_gpu6 [style=dashed]
		layer_14_gate_gpu6 -> layer_14_expert_1_gpu6 [style=dashed]
		layer_14_gate_gpu6 -> layer_14_expert_2_gpu6 [style=dashed]
		layer_14_gate_gpu6 -> layer_14_expert_3_gpu6 [style=dashed]
		layer_14_expert_0_gpu6 -> layer_14_expert_agg_gpu6
		layer_14_expert_1_gpu6 -> layer_14_expert_agg_gpu6
		layer_14_expert_2_gpu6 -> layer_14_expert_agg_gpu6
		layer_14_expert_3_gpu6 -> layer_14_expert_agg_gpu6
		layer_14_expert_agg_gpu6 -> layer_14_moe_out_proj_gpu6
		layer_14_moe_out_proj_gpu6 -> layer_14_residual2_gpu6
		layer_14_output_gpu6 [label="Layer 14 Output\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_14_residual2_gpu6 -> layer_14_output_gpu6
		layer_15_ln1_gpu6 [label="Layer 15 LayerNorm1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_15_q_proj_gpu6 [label="Layer 15 Q Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_k_proj_gpu6 [label="Layer 15 K Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_v_proj_gpu6 [label="Layer 15 V Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_attn_gpu6 [label="Layer 15 Scaled Dot-Product Attention\nGPU 6\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_attn_out_proj_gpu6 [label="Layer 15 Attention Output Projection\nGPU 6\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_residual1_gpu6 [label="Layer 15 Residual1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_15_ln2_gpu6 [label="Layer 15 LayerNorm2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_15_router_gpu6 [label="Layer 15 Router\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_15_gate_gpu6 [label="Layer 15 Gate Selection\nGPU 6\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_15_expert_0_gpu6 [label="Layer 15 Expert 0\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_1_gpu6 [label="Layer 15 Expert 1\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_2_gpu6 [label="Layer 15 Expert 2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_3_gpu6 [label="Layer 15 Expert 3\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_agg_gpu6 [label="Layer 15 Expert Aggregation\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_15_moe_out_proj_gpu6 [label="Layer 15 MoE Output Projection\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_residual2_gpu6 [label="Layer 15 Residual2\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_14_output_gpu6 -> layer_15_ln1_gpu6
		layer_15_ln1_gpu6 -> layer_15_q_proj_gpu6
		layer_15_ln1_gpu6 -> layer_15_k_proj_gpu6
		layer_15_ln1_gpu6 -> layer_15_v_proj_gpu6
		layer_15_q_proj_gpu6 -> layer_15_attn_gpu6
		layer_15_k_proj_gpu6 -> layer_15_attn_gpu6
		layer_15_v_proj_gpu6 -> layer_15_attn_gpu6
		layer_15_attn_gpu6 -> layer_15_attn_out_proj_gpu6
		layer_15_attn_out_proj_gpu6 -> layer_15_residual1_gpu6
		layer_15_residual1_gpu6 -> layer_15_ln2_gpu6
		layer_15_ln2_gpu6 -> layer_15_router_gpu6
		layer_15_router_gpu6 -> layer_15_gate_gpu6
		layer_15_gate_gpu6 -> layer_15_expert_0_gpu6 [style=dashed]
		layer_15_gate_gpu6 -> layer_15_expert_1_gpu6 [style=dashed]
		layer_15_gate_gpu6 -> layer_15_expert_2_gpu6 [style=dashed]
		layer_15_gate_gpu6 -> layer_15_expert_3_gpu6 [style=dashed]
		layer_15_expert_0_gpu6 -> layer_15_expert_agg_gpu6
		layer_15_expert_1_gpu6 -> layer_15_expert_agg_gpu6
		layer_15_expert_2_gpu6 -> layer_15_expert_agg_gpu6
		layer_15_expert_3_gpu6 -> layer_15_expert_agg_gpu6
		layer_15_expert_agg_gpu6 -> layer_15_moe_out_proj_gpu6
		layer_15_moe_out_proj_gpu6 -> layer_15_residual2_gpu6
		layer_15_output_gpu6 [label="Layer 15 Output\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_15_residual2_gpu6 -> layer_15_output_gpu6
		final_ln_gpu6 [label="Final Layer Norm\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		layer_15_output_gpu6 -> final_ln_gpu6
		lm_head_gpu6 [label="LM Head\nGPU 6\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, vocab_size]" fillcolor=lightcoral shape=rectangle style=filled]
		output_gpu6 [label="Output\nGPU 6\nInput: [batch=256, seq=512, vocab_size]\nOutput: [batch=256, seq=512, vocab_size]" fillcolor=lightgreen shape=ellipse style=filled]
		input_gpu6 -> embed_gpu6
		embed_gpu6 -> pos_enc_gpu6
		final_ln_gpu6 -> lm_head_gpu6
		lm_head_gpu6 -> output_gpu6
	}
	subgraph cluster_gpu_7 {
		color=blue fillcolor=lightblue label="GPU 7" style=rounded
		input_gpu7 [label="Input\nGPU 7\nInput: [batch=256, seq=512, dim=1024]\nOutput: [batch=256, seq=512, dim=1024]" fillcolor=lightgreen shape=ellipse style=filled]
		embed_gpu7 [label="Token Embedding\nGPU 7\nInput: [batch=256, seq=512]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		pos_enc_gpu7 [label="Position Encoding\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		layer_0_ln1_gpu7 [label="Layer 0 LayerNorm1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_0_q_proj_gpu7 [label="Layer 0 Q Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_k_proj_gpu7 [label="Layer 0 K Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_v_proj_gpu7 [label="Layer 0 V Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_attn_gpu7 [label="Layer 0 Scaled Dot-Product Attention\nGPU 7\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_attn_out_proj_gpu7 [label="Layer 0 Attention Output Projection\nGPU 7\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_0_residual1_gpu7 [label="Layer 0 Residual1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_0_ln2_gpu7 [label="Layer 0 LayerNorm2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_0_router_gpu7 [label="Layer 0 Router\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_0_gate_gpu7 [label="Layer 0 Gate Selection\nGPU 7\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_0_expert_0_gpu7 [label="Layer 0 Expert 0\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_1_gpu7 [label="Layer 0 Expert 1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_2_gpu7 [label="Layer 0 Expert 2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_3_gpu7 [label="Layer 0 Expert 3\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_expert_agg_gpu7 [label="Layer 0 Expert Aggregation\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_0_moe_out_proj_gpu7 [label="Layer 0 MoE Output Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_0_residual2_gpu7 [label="Layer 0 Residual2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		pos_enc_gpu7 -> layer_0_ln1_gpu7
		layer_0_ln1_gpu7 -> layer_0_q_proj_gpu7
		layer_0_ln1_gpu7 -> layer_0_k_proj_gpu7
		layer_0_ln1_gpu7 -> layer_0_v_proj_gpu7
		layer_0_q_proj_gpu7 -> layer_0_attn_gpu7
		layer_0_k_proj_gpu7 -> layer_0_attn_gpu7
		layer_0_v_proj_gpu7 -> layer_0_attn_gpu7
		layer_0_attn_gpu7 -> layer_0_attn_out_proj_gpu7
		layer_0_attn_out_proj_gpu7 -> layer_0_residual1_gpu7
		layer_0_residual1_gpu7 -> layer_0_ln2_gpu7
		layer_0_ln2_gpu7 -> layer_0_router_gpu7
		layer_0_router_gpu7 -> layer_0_gate_gpu7
		layer_0_gate_gpu7 -> layer_0_expert_0_gpu7 [style=dashed]
		layer_0_gate_gpu7 -> layer_0_expert_1_gpu7 [style=dashed]
		layer_0_gate_gpu7 -> layer_0_expert_2_gpu7 [style=dashed]
		layer_0_gate_gpu7 -> layer_0_expert_3_gpu7 [style=dashed]
		layer_0_expert_0_gpu7 -> layer_0_expert_agg_gpu7
		layer_0_expert_1_gpu7 -> layer_0_expert_agg_gpu7
		layer_0_expert_2_gpu7 -> layer_0_expert_agg_gpu7
		layer_0_expert_3_gpu7 -> layer_0_expert_agg_gpu7
		layer_0_expert_agg_gpu7 -> layer_0_moe_out_proj_gpu7
		layer_0_moe_out_proj_gpu7 -> layer_0_residual2_gpu7
		layer_0_output_gpu7 [label="Layer 0 Output\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_0_residual2_gpu7 -> layer_0_output_gpu7
		layer_1_ln1_gpu7 [label="Layer 1 LayerNorm1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_1_q_proj_gpu7 [label="Layer 1 Q Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_k_proj_gpu7 [label="Layer 1 K Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_v_proj_gpu7 [label="Layer 1 V Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_attn_gpu7 [label="Layer 1 Scaled Dot-Product Attention\nGPU 7\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_attn_out_proj_gpu7 [label="Layer 1 Attention Output Projection\nGPU 7\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_1_residual1_gpu7 [label="Layer 1 Residual1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_1_ln2_gpu7 [label="Layer 1 LayerNorm2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_1_router_gpu7 [label="Layer 1 Router\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_1_gate_gpu7 [label="Layer 1 Gate Selection\nGPU 7\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_1_expert_0_gpu7 [label="Layer 1 Expert 0\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_1_gpu7 [label="Layer 1 Expert 1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_2_gpu7 [label="Layer 1 Expert 2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_3_gpu7 [label="Layer 1 Expert 3\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_expert_agg_gpu7 [label="Layer 1 Expert Aggregation\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_1_moe_out_proj_gpu7 [label="Layer 1 MoE Output Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_1_residual2_gpu7 [label="Layer 1 Residual2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_0_output_gpu7 -> layer_1_ln1_gpu7
		layer_1_ln1_gpu7 -> layer_1_q_proj_gpu7
		layer_1_ln1_gpu7 -> layer_1_k_proj_gpu7
		layer_1_ln1_gpu7 -> layer_1_v_proj_gpu7
		layer_1_q_proj_gpu7 -> layer_1_attn_gpu7
		layer_1_k_proj_gpu7 -> layer_1_attn_gpu7
		layer_1_v_proj_gpu7 -> layer_1_attn_gpu7
		layer_1_attn_gpu7 -> layer_1_attn_out_proj_gpu7
		layer_1_attn_out_proj_gpu7 -> layer_1_residual1_gpu7
		layer_1_residual1_gpu7 -> layer_1_ln2_gpu7
		layer_1_ln2_gpu7 -> layer_1_router_gpu7
		layer_1_router_gpu7 -> layer_1_gate_gpu7
		layer_1_gate_gpu7 -> layer_1_expert_0_gpu7 [style=dashed]
		layer_1_gate_gpu7 -> layer_1_expert_1_gpu7 [style=dashed]
		layer_1_gate_gpu7 -> layer_1_expert_2_gpu7 [style=dashed]
		layer_1_gate_gpu7 -> layer_1_expert_3_gpu7 [style=dashed]
		layer_1_expert_0_gpu7 -> layer_1_expert_agg_gpu7
		layer_1_expert_1_gpu7 -> layer_1_expert_agg_gpu7
		layer_1_expert_2_gpu7 -> layer_1_expert_agg_gpu7
		layer_1_expert_3_gpu7 -> layer_1_expert_agg_gpu7
		layer_1_expert_agg_gpu7 -> layer_1_moe_out_proj_gpu7
		layer_1_moe_out_proj_gpu7 -> layer_1_residual2_gpu7
		layer_1_output_gpu7 [label="Layer 1 Output\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_1_residual2_gpu7 -> layer_1_output_gpu7
		layer_2_ln1_gpu7 [label="Layer 2 LayerNorm1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_2_q_proj_gpu7 [label="Layer 2 Q Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_k_proj_gpu7 [label="Layer 2 K Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_v_proj_gpu7 [label="Layer 2 V Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_attn_gpu7 [label="Layer 2 Scaled Dot-Product Attention\nGPU 7\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_attn_out_proj_gpu7 [label="Layer 2 Attention Output Projection\nGPU 7\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_2_residual1_gpu7 [label="Layer 2 Residual1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_2_ln2_gpu7 [label="Layer 2 LayerNorm2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_2_router_gpu7 [label="Layer 2 Router\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_2_gate_gpu7 [label="Layer 2 Gate Selection\nGPU 7\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_2_expert_0_gpu7 [label="Layer 2 Expert 0\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_1_gpu7 [label="Layer 2 Expert 1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_2_gpu7 [label="Layer 2 Expert 2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_3_gpu7 [label="Layer 2 Expert 3\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_expert_agg_gpu7 [label="Layer 2 Expert Aggregation\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_2_moe_out_proj_gpu7 [label="Layer 2 MoE Output Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_2_residual2_gpu7 [label="Layer 2 Residual2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_1_output_gpu7 -> layer_2_ln1_gpu7
		layer_2_ln1_gpu7 -> layer_2_q_proj_gpu7
		layer_2_ln1_gpu7 -> layer_2_k_proj_gpu7
		layer_2_ln1_gpu7 -> layer_2_v_proj_gpu7
		layer_2_q_proj_gpu7 -> layer_2_attn_gpu7
		layer_2_k_proj_gpu7 -> layer_2_attn_gpu7
		layer_2_v_proj_gpu7 -> layer_2_attn_gpu7
		layer_2_attn_gpu7 -> layer_2_attn_out_proj_gpu7
		layer_2_attn_out_proj_gpu7 -> layer_2_residual1_gpu7
		layer_2_residual1_gpu7 -> layer_2_ln2_gpu7
		layer_2_ln2_gpu7 -> layer_2_router_gpu7
		layer_2_router_gpu7 -> layer_2_gate_gpu7
		layer_2_gate_gpu7 -> layer_2_expert_0_gpu7 [style=dashed]
		layer_2_gate_gpu7 -> layer_2_expert_1_gpu7 [style=dashed]
		layer_2_gate_gpu7 -> layer_2_expert_2_gpu7 [style=dashed]
		layer_2_gate_gpu7 -> layer_2_expert_3_gpu7 [style=dashed]
		layer_2_expert_0_gpu7 -> layer_2_expert_agg_gpu7
		layer_2_expert_1_gpu7 -> layer_2_expert_agg_gpu7
		layer_2_expert_2_gpu7 -> layer_2_expert_agg_gpu7
		layer_2_expert_3_gpu7 -> layer_2_expert_agg_gpu7
		layer_2_expert_agg_gpu7 -> layer_2_moe_out_proj_gpu7
		layer_2_moe_out_proj_gpu7 -> layer_2_residual2_gpu7
		layer_2_output_gpu7 [label="Layer 2 Output\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_2_residual2_gpu7 -> layer_2_output_gpu7
		layer_3_ln1_gpu7 [label="Layer 3 LayerNorm1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_3_q_proj_gpu7 [label="Layer 3 Q Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_k_proj_gpu7 [label="Layer 3 K Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_v_proj_gpu7 [label="Layer 3 V Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_attn_gpu7 [label="Layer 3 Scaled Dot-Product Attention\nGPU 7\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_attn_out_proj_gpu7 [label="Layer 3 Attention Output Projection\nGPU 7\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_3_residual1_gpu7 [label="Layer 3 Residual1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_3_ln2_gpu7 [label="Layer 3 LayerNorm2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_3_router_gpu7 [label="Layer 3 Router\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_3_gate_gpu7 [label="Layer 3 Gate Selection\nGPU 7\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_3_expert_0_gpu7 [label="Layer 3 Expert 0\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_1_gpu7 [label="Layer 3 Expert 1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_2_gpu7 [label="Layer 3 Expert 2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_3_gpu7 [label="Layer 3 Expert 3\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_expert_agg_gpu7 [label="Layer 3 Expert Aggregation\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_3_moe_out_proj_gpu7 [label="Layer 3 MoE Output Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_3_residual2_gpu7 [label="Layer 3 Residual2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_2_output_gpu7 -> layer_3_ln1_gpu7
		layer_3_ln1_gpu7 -> layer_3_q_proj_gpu7
		layer_3_ln1_gpu7 -> layer_3_k_proj_gpu7
		layer_3_ln1_gpu7 -> layer_3_v_proj_gpu7
		layer_3_q_proj_gpu7 -> layer_3_attn_gpu7
		layer_3_k_proj_gpu7 -> layer_3_attn_gpu7
		layer_3_v_proj_gpu7 -> layer_3_attn_gpu7
		layer_3_attn_gpu7 -> layer_3_attn_out_proj_gpu7
		layer_3_attn_out_proj_gpu7 -> layer_3_residual1_gpu7
		layer_3_residual1_gpu7 -> layer_3_ln2_gpu7
		layer_3_ln2_gpu7 -> layer_3_router_gpu7
		layer_3_router_gpu7 -> layer_3_gate_gpu7
		layer_3_gate_gpu7 -> layer_3_expert_0_gpu7 [style=dashed]
		layer_3_gate_gpu7 -> layer_3_expert_1_gpu7 [style=dashed]
		layer_3_gate_gpu7 -> layer_3_expert_2_gpu7 [style=dashed]
		layer_3_gate_gpu7 -> layer_3_expert_3_gpu7 [style=dashed]
		layer_3_expert_0_gpu7 -> layer_3_expert_agg_gpu7
		layer_3_expert_1_gpu7 -> layer_3_expert_agg_gpu7
		layer_3_expert_2_gpu7 -> layer_3_expert_agg_gpu7
		layer_3_expert_3_gpu7 -> layer_3_expert_agg_gpu7
		layer_3_expert_agg_gpu7 -> layer_3_moe_out_proj_gpu7
		layer_3_moe_out_proj_gpu7 -> layer_3_residual2_gpu7
		layer_3_output_gpu7 [label="Layer 3 Output\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_3_residual2_gpu7 -> layer_3_output_gpu7
		layer_4_ln1_gpu7 [label="Layer 4 LayerNorm1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_4_q_proj_gpu7 [label="Layer 4 Q Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_k_proj_gpu7 [label="Layer 4 K Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_v_proj_gpu7 [label="Layer 4 V Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_attn_gpu7 [label="Layer 4 Scaled Dot-Product Attention\nGPU 7\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_attn_out_proj_gpu7 [label="Layer 4 Attention Output Projection\nGPU 7\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_4_residual1_gpu7 [label="Layer 4 Residual1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_4_ln2_gpu7 [label="Layer 4 LayerNorm2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_4_router_gpu7 [label="Layer 4 Router\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_4_gate_gpu7 [label="Layer 4 Gate Selection\nGPU 7\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_4_expert_0_gpu7 [label="Layer 4 Expert 0\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_1_gpu7 [label="Layer 4 Expert 1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_2_gpu7 [label="Layer 4 Expert 2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_3_gpu7 [label="Layer 4 Expert 3\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_expert_agg_gpu7 [label="Layer 4 Expert Aggregation\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_4_moe_out_proj_gpu7 [label="Layer 4 MoE Output Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_4_residual2_gpu7 [label="Layer 4 Residual2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_3_output_gpu7 -> layer_4_ln1_gpu7
		layer_4_ln1_gpu7 -> layer_4_q_proj_gpu7
		layer_4_ln1_gpu7 -> layer_4_k_proj_gpu7
		layer_4_ln1_gpu7 -> layer_4_v_proj_gpu7
		layer_4_q_proj_gpu7 -> layer_4_attn_gpu7
		layer_4_k_proj_gpu7 -> layer_4_attn_gpu7
		layer_4_v_proj_gpu7 -> layer_4_attn_gpu7
		layer_4_attn_gpu7 -> layer_4_attn_out_proj_gpu7
		layer_4_attn_out_proj_gpu7 -> layer_4_residual1_gpu7
		layer_4_residual1_gpu7 -> layer_4_ln2_gpu7
		layer_4_ln2_gpu7 -> layer_4_router_gpu7
		layer_4_router_gpu7 -> layer_4_gate_gpu7
		layer_4_gate_gpu7 -> layer_4_expert_0_gpu7 [style=dashed]
		layer_4_gate_gpu7 -> layer_4_expert_1_gpu7 [style=dashed]
		layer_4_gate_gpu7 -> layer_4_expert_2_gpu7 [style=dashed]
		layer_4_gate_gpu7 -> layer_4_expert_3_gpu7 [style=dashed]
		layer_4_expert_0_gpu7 -> layer_4_expert_agg_gpu7
		layer_4_expert_1_gpu7 -> layer_4_expert_agg_gpu7
		layer_4_expert_2_gpu7 -> layer_4_expert_agg_gpu7
		layer_4_expert_3_gpu7 -> layer_4_expert_agg_gpu7
		layer_4_expert_agg_gpu7 -> layer_4_moe_out_proj_gpu7
		layer_4_moe_out_proj_gpu7 -> layer_4_residual2_gpu7
		layer_4_output_gpu7 [label="Layer 4 Output\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_4_residual2_gpu7 -> layer_4_output_gpu7
		layer_5_ln1_gpu7 [label="Layer 5 LayerNorm1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_5_q_proj_gpu7 [label="Layer 5 Q Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_k_proj_gpu7 [label="Layer 5 K Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_v_proj_gpu7 [label="Layer 5 V Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_attn_gpu7 [label="Layer 5 Scaled Dot-Product Attention\nGPU 7\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_attn_out_proj_gpu7 [label="Layer 5 Attention Output Projection\nGPU 7\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_5_residual1_gpu7 [label="Layer 5 Residual1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_5_ln2_gpu7 [label="Layer 5 LayerNorm2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_5_router_gpu7 [label="Layer 5 Router\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_5_gate_gpu7 [label="Layer 5 Gate Selection\nGPU 7\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_5_expert_0_gpu7 [label="Layer 5 Expert 0\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_1_gpu7 [label="Layer 5 Expert 1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_2_gpu7 [label="Layer 5 Expert 2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_3_gpu7 [label="Layer 5 Expert 3\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_expert_agg_gpu7 [label="Layer 5 Expert Aggregation\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_5_moe_out_proj_gpu7 [label="Layer 5 MoE Output Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_5_residual2_gpu7 [label="Layer 5 Residual2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_4_output_gpu7 -> layer_5_ln1_gpu7
		layer_5_ln1_gpu7 -> layer_5_q_proj_gpu7
		layer_5_ln1_gpu7 -> layer_5_k_proj_gpu7
		layer_5_ln1_gpu7 -> layer_5_v_proj_gpu7
		layer_5_q_proj_gpu7 -> layer_5_attn_gpu7
		layer_5_k_proj_gpu7 -> layer_5_attn_gpu7
		layer_5_v_proj_gpu7 -> layer_5_attn_gpu7
		layer_5_attn_gpu7 -> layer_5_attn_out_proj_gpu7
		layer_5_attn_out_proj_gpu7 -> layer_5_residual1_gpu7
		layer_5_residual1_gpu7 -> layer_5_ln2_gpu7
		layer_5_ln2_gpu7 -> layer_5_router_gpu7
		layer_5_router_gpu7 -> layer_5_gate_gpu7
		layer_5_gate_gpu7 -> layer_5_expert_0_gpu7 [style=dashed]
		layer_5_gate_gpu7 -> layer_5_expert_1_gpu7 [style=dashed]
		layer_5_gate_gpu7 -> layer_5_expert_2_gpu7 [style=dashed]
		layer_5_gate_gpu7 -> layer_5_expert_3_gpu7 [style=dashed]
		layer_5_expert_0_gpu7 -> layer_5_expert_agg_gpu7
		layer_5_expert_1_gpu7 -> layer_5_expert_agg_gpu7
		layer_5_expert_2_gpu7 -> layer_5_expert_agg_gpu7
		layer_5_expert_3_gpu7 -> layer_5_expert_agg_gpu7
		layer_5_expert_agg_gpu7 -> layer_5_moe_out_proj_gpu7
		layer_5_moe_out_proj_gpu7 -> layer_5_residual2_gpu7
		layer_5_output_gpu7 [label="Layer 5 Output\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_5_residual2_gpu7 -> layer_5_output_gpu7
		layer_6_ln1_gpu7 [label="Layer 6 LayerNorm1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_6_q_proj_gpu7 [label="Layer 6 Q Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_k_proj_gpu7 [label="Layer 6 K Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_v_proj_gpu7 [label="Layer 6 V Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_attn_gpu7 [label="Layer 6 Scaled Dot-Product Attention\nGPU 7\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_attn_out_proj_gpu7 [label="Layer 6 Attention Output Projection\nGPU 7\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_6_residual1_gpu7 [label="Layer 6 Residual1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_6_ln2_gpu7 [label="Layer 6 LayerNorm2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_6_router_gpu7 [label="Layer 6 Router\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_6_gate_gpu7 [label="Layer 6 Gate Selection\nGPU 7\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_6_expert_0_gpu7 [label="Layer 6 Expert 0\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_1_gpu7 [label="Layer 6 Expert 1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_2_gpu7 [label="Layer 6 Expert 2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_3_gpu7 [label="Layer 6 Expert 3\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_expert_agg_gpu7 [label="Layer 6 Expert Aggregation\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_6_moe_out_proj_gpu7 [label="Layer 6 MoE Output Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_6_residual2_gpu7 [label="Layer 6 Residual2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_5_output_gpu7 -> layer_6_ln1_gpu7
		layer_6_ln1_gpu7 -> layer_6_q_proj_gpu7
		layer_6_ln1_gpu7 -> layer_6_k_proj_gpu7
		layer_6_ln1_gpu7 -> layer_6_v_proj_gpu7
		layer_6_q_proj_gpu7 -> layer_6_attn_gpu7
		layer_6_k_proj_gpu7 -> layer_6_attn_gpu7
		layer_6_v_proj_gpu7 -> layer_6_attn_gpu7
		layer_6_attn_gpu7 -> layer_6_attn_out_proj_gpu7
		layer_6_attn_out_proj_gpu7 -> layer_6_residual1_gpu7
		layer_6_residual1_gpu7 -> layer_6_ln2_gpu7
		layer_6_ln2_gpu7 -> layer_6_router_gpu7
		layer_6_router_gpu7 -> layer_6_gate_gpu7
		layer_6_gate_gpu7 -> layer_6_expert_0_gpu7 [style=dashed]
		layer_6_gate_gpu7 -> layer_6_expert_1_gpu7 [style=dashed]
		layer_6_gate_gpu7 -> layer_6_expert_2_gpu7 [style=dashed]
		layer_6_gate_gpu7 -> layer_6_expert_3_gpu7 [style=dashed]
		layer_6_expert_0_gpu7 -> layer_6_expert_agg_gpu7
		layer_6_expert_1_gpu7 -> layer_6_expert_agg_gpu7
		layer_6_expert_2_gpu7 -> layer_6_expert_agg_gpu7
		layer_6_expert_3_gpu7 -> layer_6_expert_agg_gpu7
		layer_6_expert_agg_gpu7 -> layer_6_moe_out_proj_gpu7
		layer_6_moe_out_proj_gpu7 -> layer_6_residual2_gpu7
		layer_6_output_gpu7 [label="Layer 6 Output\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_6_residual2_gpu7 -> layer_6_output_gpu7
		layer_7_ln1_gpu7 [label="Layer 7 LayerNorm1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_7_q_proj_gpu7 [label="Layer 7 Q Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_k_proj_gpu7 [label="Layer 7 K Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_v_proj_gpu7 [label="Layer 7 V Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_attn_gpu7 [label="Layer 7 Scaled Dot-Product Attention\nGPU 7\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_attn_out_proj_gpu7 [label="Layer 7 Attention Output Projection\nGPU 7\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_7_residual1_gpu7 [label="Layer 7 Residual1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_7_ln2_gpu7 [label="Layer 7 LayerNorm2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_7_router_gpu7 [label="Layer 7 Router\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_7_gate_gpu7 [label="Layer 7 Gate Selection\nGPU 7\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_7_expert_0_gpu7 [label="Layer 7 Expert 0\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_1_gpu7 [label="Layer 7 Expert 1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_2_gpu7 [label="Layer 7 Expert 2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_3_gpu7 [label="Layer 7 Expert 3\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_expert_agg_gpu7 [label="Layer 7 Expert Aggregation\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_7_moe_out_proj_gpu7 [label="Layer 7 MoE Output Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_7_residual2_gpu7 [label="Layer 7 Residual2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_6_output_gpu7 -> layer_7_ln1_gpu7
		layer_7_ln1_gpu7 -> layer_7_q_proj_gpu7
		layer_7_ln1_gpu7 -> layer_7_k_proj_gpu7
		layer_7_ln1_gpu7 -> layer_7_v_proj_gpu7
		layer_7_q_proj_gpu7 -> layer_7_attn_gpu7
		layer_7_k_proj_gpu7 -> layer_7_attn_gpu7
		layer_7_v_proj_gpu7 -> layer_7_attn_gpu7
		layer_7_attn_gpu7 -> layer_7_attn_out_proj_gpu7
		layer_7_attn_out_proj_gpu7 -> layer_7_residual1_gpu7
		layer_7_residual1_gpu7 -> layer_7_ln2_gpu7
		layer_7_ln2_gpu7 -> layer_7_router_gpu7
		layer_7_router_gpu7 -> layer_7_gate_gpu7
		layer_7_gate_gpu7 -> layer_7_expert_0_gpu7 [style=dashed]
		layer_7_gate_gpu7 -> layer_7_expert_1_gpu7 [style=dashed]
		layer_7_gate_gpu7 -> layer_7_expert_2_gpu7 [style=dashed]
		layer_7_gate_gpu7 -> layer_7_expert_3_gpu7 [style=dashed]
		layer_7_expert_0_gpu7 -> layer_7_expert_agg_gpu7
		layer_7_expert_1_gpu7 -> layer_7_expert_agg_gpu7
		layer_7_expert_2_gpu7 -> layer_7_expert_agg_gpu7
		layer_7_expert_3_gpu7 -> layer_7_expert_agg_gpu7
		layer_7_expert_agg_gpu7 -> layer_7_moe_out_proj_gpu7
		layer_7_moe_out_proj_gpu7 -> layer_7_residual2_gpu7
		layer_7_output_gpu7 [label="Layer 7 Output\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_7_residual2_gpu7 -> layer_7_output_gpu7
		layer_8_ln1_gpu7 [label="Layer 8 LayerNorm1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_8_q_proj_gpu7 [label="Layer 8 Q Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_k_proj_gpu7 [label="Layer 8 K Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_v_proj_gpu7 [label="Layer 8 V Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_attn_gpu7 [label="Layer 8 Scaled Dot-Product Attention\nGPU 7\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_attn_out_proj_gpu7 [label="Layer 8 Attention Output Projection\nGPU 7\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_8_residual1_gpu7 [label="Layer 8 Residual1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_8_ln2_gpu7 [label="Layer 8 LayerNorm2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_8_router_gpu7 [label="Layer 8 Router\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_8_gate_gpu7 [label="Layer 8 Gate Selection\nGPU 7\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_8_expert_0_gpu7 [label="Layer 8 Expert 0\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_1_gpu7 [label="Layer 8 Expert 1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_2_gpu7 [label="Layer 8 Expert 2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_3_gpu7 [label="Layer 8 Expert 3\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_expert_agg_gpu7 [label="Layer 8 Expert Aggregation\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_8_moe_out_proj_gpu7 [label="Layer 8 MoE Output Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_8_residual2_gpu7 [label="Layer 8 Residual2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_7_output_gpu7 -> layer_8_ln1_gpu7
		layer_8_ln1_gpu7 -> layer_8_q_proj_gpu7
		layer_8_ln1_gpu7 -> layer_8_k_proj_gpu7
		layer_8_ln1_gpu7 -> layer_8_v_proj_gpu7
		layer_8_q_proj_gpu7 -> layer_8_attn_gpu7
		layer_8_k_proj_gpu7 -> layer_8_attn_gpu7
		layer_8_v_proj_gpu7 -> layer_8_attn_gpu7
		layer_8_attn_gpu7 -> layer_8_attn_out_proj_gpu7
		layer_8_attn_out_proj_gpu7 -> layer_8_residual1_gpu7
		layer_8_residual1_gpu7 -> layer_8_ln2_gpu7
		layer_8_ln2_gpu7 -> layer_8_router_gpu7
		layer_8_router_gpu7 -> layer_8_gate_gpu7
		layer_8_gate_gpu7 -> layer_8_expert_0_gpu7 [style=dashed]
		layer_8_gate_gpu7 -> layer_8_expert_1_gpu7 [style=dashed]
		layer_8_gate_gpu7 -> layer_8_expert_2_gpu7 [style=dashed]
		layer_8_gate_gpu7 -> layer_8_expert_3_gpu7 [style=dashed]
		layer_8_expert_0_gpu7 -> layer_8_expert_agg_gpu7
		layer_8_expert_1_gpu7 -> layer_8_expert_agg_gpu7
		layer_8_expert_2_gpu7 -> layer_8_expert_agg_gpu7
		layer_8_expert_3_gpu7 -> layer_8_expert_agg_gpu7
		layer_8_expert_agg_gpu7 -> layer_8_moe_out_proj_gpu7
		layer_8_moe_out_proj_gpu7 -> layer_8_residual2_gpu7
		layer_8_output_gpu7 [label="Layer 8 Output\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_8_residual2_gpu7 -> layer_8_output_gpu7
		layer_9_ln1_gpu7 [label="Layer 9 LayerNorm1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_9_q_proj_gpu7 [label="Layer 9 Q Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_k_proj_gpu7 [label="Layer 9 K Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_v_proj_gpu7 [label="Layer 9 V Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_attn_gpu7 [label="Layer 9 Scaled Dot-Product Attention\nGPU 7\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_attn_out_proj_gpu7 [label="Layer 9 Attention Output Projection\nGPU 7\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_9_residual1_gpu7 [label="Layer 9 Residual1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_9_ln2_gpu7 [label="Layer 9 LayerNorm2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_9_router_gpu7 [label="Layer 9 Router\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_9_gate_gpu7 [label="Layer 9 Gate Selection\nGPU 7\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_9_expert_0_gpu7 [label="Layer 9 Expert 0\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_1_gpu7 [label="Layer 9 Expert 1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_2_gpu7 [label="Layer 9 Expert 2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_3_gpu7 [label="Layer 9 Expert 3\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_expert_agg_gpu7 [label="Layer 9 Expert Aggregation\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_9_moe_out_proj_gpu7 [label="Layer 9 MoE Output Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_9_residual2_gpu7 [label="Layer 9 Residual2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_8_output_gpu7 -> layer_9_ln1_gpu7
		layer_9_ln1_gpu7 -> layer_9_q_proj_gpu7
		layer_9_ln1_gpu7 -> layer_9_k_proj_gpu7
		layer_9_ln1_gpu7 -> layer_9_v_proj_gpu7
		layer_9_q_proj_gpu7 -> layer_9_attn_gpu7
		layer_9_k_proj_gpu7 -> layer_9_attn_gpu7
		layer_9_v_proj_gpu7 -> layer_9_attn_gpu7
		layer_9_attn_gpu7 -> layer_9_attn_out_proj_gpu7
		layer_9_attn_out_proj_gpu7 -> layer_9_residual1_gpu7
		layer_9_residual1_gpu7 -> layer_9_ln2_gpu7
		layer_9_ln2_gpu7 -> layer_9_router_gpu7
		layer_9_router_gpu7 -> layer_9_gate_gpu7
		layer_9_gate_gpu7 -> layer_9_expert_0_gpu7 [style=dashed]
		layer_9_gate_gpu7 -> layer_9_expert_1_gpu7 [style=dashed]
		layer_9_gate_gpu7 -> layer_9_expert_2_gpu7 [style=dashed]
		layer_9_gate_gpu7 -> layer_9_expert_3_gpu7 [style=dashed]
		layer_9_expert_0_gpu7 -> layer_9_expert_agg_gpu7
		layer_9_expert_1_gpu7 -> layer_9_expert_agg_gpu7
		layer_9_expert_2_gpu7 -> layer_9_expert_agg_gpu7
		layer_9_expert_3_gpu7 -> layer_9_expert_agg_gpu7
		layer_9_expert_agg_gpu7 -> layer_9_moe_out_proj_gpu7
		layer_9_moe_out_proj_gpu7 -> layer_9_residual2_gpu7
		layer_9_output_gpu7 [label="Layer 9 Output\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_9_residual2_gpu7 -> layer_9_output_gpu7
		layer_10_ln1_gpu7 [label="Layer 10 LayerNorm1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_10_q_proj_gpu7 [label="Layer 10 Q Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_k_proj_gpu7 [label="Layer 10 K Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_v_proj_gpu7 [label="Layer 10 V Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_attn_gpu7 [label="Layer 10 Scaled Dot-Product Attention\nGPU 7\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_attn_out_proj_gpu7 [label="Layer 10 Attention Output Projection\nGPU 7\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_10_residual1_gpu7 [label="Layer 10 Residual1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_10_ln2_gpu7 [label="Layer 10 LayerNorm2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_10_router_gpu7 [label="Layer 10 Router\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_10_gate_gpu7 [label="Layer 10 Gate Selection\nGPU 7\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_10_expert_0_gpu7 [label="Layer 10 Expert 0\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_1_gpu7 [label="Layer 10 Expert 1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_2_gpu7 [label="Layer 10 Expert 2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_3_gpu7 [label="Layer 10 Expert 3\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_expert_agg_gpu7 [label="Layer 10 Expert Aggregation\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_10_moe_out_proj_gpu7 [label="Layer 10 MoE Output Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_10_residual2_gpu7 [label="Layer 10 Residual2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_9_output_gpu7 -> layer_10_ln1_gpu7
		layer_10_ln1_gpu7 -> layer_10_q_proj_gpu7
		layer_10_ln1_gpu7 -> layer_10_k_proj_gpu7
		layer_10_ln1_gpu7 -> layer_10_v_proj_gpu7
		layer_10_q_proj_gpu7 -> layer_10_attn_gpu7
		layer_10_k_proj_gpu7 -> layer_10_attn_gpu7
		layer_10_v_proj_gpu7 -> layer_10_attn_gpu7
		layer_10_attn_gpu7 -> layer_10_attn_out_proj_gpu7
		layer_10_attn_out_proj_gpu7 -> layer_10_residual1_gpu7
		layer_10_residual1_gpu7 -> layer_10_ln2_gpu7
		layer_10_ln2_gpu7 -> layer_10_router_gpu7
		layer_10_router_gpu7 -> layer_10_gate_gpu7
		layer_10_gate_gpu7 -> layer_10_expert_0_gpu7 [style=dashed]
		layer_10_gate_gpu7 -> layer_10_expert_1_gpu7 [style=dashed]
		layer_10_gate_gpu7 -> layer_10_expert_2_gpu7 [style=dashed]
		layer_10_gate_gpu7 -> layer_10_expert_3_gpu7 [style=dashed]
		layer_10_expert_0_gpu7 -> layer_10_expert_agg_gpu7
		layer_10_expert_1_gpu7 -> layer_10_expert_agg_gpu7
		layer_10_expert_2_gpu7 -> layer_10_expert_agg_gpu7
		layer_10_expert_3_gpu7 -> layer_10_expert_agg_gpu7
		layer_10_expert_agg_gpu7 -> layer_10_moe_out_proj_gpu7
		layer_10_moe_out_proj_gpu7 -> layer_10_residual2_gpu7
		layer_10_output_gpu7 [label="Layer 10 Output\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_10_residual2_gpu7 -> layer_10_output_gpu7
		layer_11_ln1_gpu7 [label="Layer 11 LayerNorm1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_11_q_proj_gpu7 [label="Layer 11 Q Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_k_proj_gpu7 [label="Layer 11 K Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_v_proj_gpu7 [label="Layer 11 V Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_attn_gpu7 [label="Layer 11 Scaled Dot-Product Attention\nGPU 7\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_attn_out_proj_gpu7 [label="Layer 11 Attention Output Projection\nGPU 7\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_11_residual1_gpu7 [label="Layer 11 Residual1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_11_ln2_gpu7 [label="Layer 11 LayerNorm2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_11_router_gpu7 [label="Layer 11 Router\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_11_gate_gpu7 [label="Layer 11 Gate Selection\nGPU 7\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_11_expert_0_gpu7 [label="Layer 11 Expert 0\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_1_gpu7 [label="Layer 11 Expert 1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_2_gpu7 [label="Layer 11 Expert 2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_3_gpu7 [label="Layer 11 Expert 3\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_expert_agg_gpu7 [label="Layer 11 Expert Aggregation\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_11_moe_out_proj_gpu7 [label="Layer 11 MoE Output Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_11_residual2_gpu7 [label="Layer 11 Residual2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_10_output_gpu7 -> layer_11_ln1_gpu7
		layer_11_ln1_gpu7 -> layer_11_q_proj_gpu7
		layer_11_ln1_gpu7 -> layer_11_k_proj_gpu7
		layer_11_ln1_gpu7 -> layer_11_v_proj_gpu7
		layer_11_q_proj_gpu7 -> layer_11_attn_gpu7
		layer_11_k_proj_gpu7 -> layer_11_attn_gpu7
		layer_11_v_proj_gpu7 -> layer_11_attn_gpu7
		layer_11_attn_gpu7 -> layer_11_attn_out_proj_gpu7
		layer_11_attn_out_proj_gpu7 -> layer_11_residual1_gpu7
		layer_11_residual1_gpu7 -> layer_11_ln2_gpu7
		layer_11_ln2_gpu7 -> layer_11_router_gpu7
		layer_11_router_gpu7 -> layer_11_gate_gpu7
		layer_11_gate_gpu7 -> layer_11_expert_0_gpu7 [style=dashed]
		layer_11_gate_gpu7 -> layer_11_expert_1_gpu7 [style=dashed]
		layer_11_gate_gpu7 -> layer_11_expert_2_gpu7 [style=dashed]
		layer_11_gate_gpu7 -> layer_11_expert_3_gpu7 [style=dashed]
		layer_11_expert_0_gpu7 -> layer_11_expert_agg_gpu7
		layer_11_expert_1_gpu7 -> layer_11_expert_agg_gpu7
		layer_11_expert_2_gpu7 -> layer_11_expert_agg_gpu7
		layer_11_expert_3_gpu7 -> layer_11_expert_agg_gpu7
		layer_11_expert_agg_gpu7 -> layer_11_moe_out_proj_gpu7
		layer_11_moe_out_proj_gpu7 -> layer_11_residual2_gpu7
		layer_11_output_gpu7 [label="Layer 11 Output\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_11_residual2_gpu7 -> layer_11_output_gpu7
		layer_12_ln1_gpu7 [label="Layer 12 LayerNorm1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_12_q_proj_gpu7 [label="Layer 12 Q Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_k_proj_gpu7 [label="Layer 12 K Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_v_proj_gpu7 [label="Layer 12 V Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_attn_gpu7 [label="Layer 12 Scaled Dot-Product Attention\nGPU 7\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_attn_out_proj_gpu7 [label="Layer 12 Attention Output Projection\nGPU 7\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_12_residual1_gpu7 [label="Layer 12 Residual1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_12_ln2_gpu7 [label="Layer 12 LayerNorm2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_12_router_gpu7 [label="Layer 12 Router\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_12_gate_gpu7 [label="Layer 12 Gate Selection\nGPU 7\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_12_expert_0_gpu7 [label="Layer 12 Expert 0\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_1_gpu7 [label="Layer 12 Expert 1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_2_gpu7 [label="Layer 12 Expert 2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_3_gpu7 [label="Layer 12 Expert 3\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_expert_agg_gpu7 [label="Layer 12 Expert Aggregation\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_12_moe_out_proj_gpu7 [label="Layer 12 MoE Output Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_12_residual2_gpu7 [label="Layer 12 Residual2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_11_output_gpu7 -> layer_12_ln1_gpu7
		layer_12_ln1_gpu7 -> layer_12_q_proj_gpu7
		layer_12_ln1_gpu7 -> layer_12_k_proj_gpu7
		layer_12_ln1_gpu7 -> layer_12_v_proj_gpu7
		layer_12_q_proj_gpu7 -> layer_12_attn_gpu7
		layer_12_k_proj_gpu7 -> layer_12_attn_gpu7
		layer_12_v_proj_gpu7 -> layer_12_attn_gpu7
		layer_12_attn_gpu7 -> layer_12_attn_out_proj_gpu7
		layer_12_attn_out_proj_gpu7 -> layer_12_residual1_gpu7
		layer_12_residual1_gpu7 -> layer_12_ln2_gpu7
		layer_12_ln2_gpu7 -> layer_12_router_gpu7
		layer_12_router_gpu7 -> layer_12_gate_gpu7
		layer_12_gate_gpu7 -> layer_12_expert_0_gpu7 [style=dashed]
		layer_12_gate_gpu7 -> layer_12_expert_1_gpu7 [style=dashed]
		layer_12_gate_gpu7 -> layer_12_expert_2_gpu7 [style=dashed]
		layer_12_gate_gpu7 -> layer_12_expert_3_gpu7 [style=dashed]
		layer_12_expert_0_gpu7 -> layer_12_expert_agg_gpu7
		layer_12_expert_1_gpu7 -> layer_12_expert_agg_gpu7
		layer_12_expert_2_gpu7 -> layer_12_expert_agg_gpu7
		layer_12_expert_3_gpu7 -> layer_12_expert_agg_gpu7
		layer_12_expert_agg_gpu7 -> layer_12_moe_out_proj_gpu7
		layer_12_moe_out_proj_gpu7 -> layer_12_residual2_gpu7
		layer_12_output_gpu7 [label="Layer 12 Output\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_12_residual2_gpu7 -> layer_12_output_gpu7
		layer_13_ln1_gpu7 [label="Layer 13 LayerNorm1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_13_q_proj_gpu7 [label="Layer 13 Q Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_k_proj_gpu7 [label="Layer 13 K Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_v_proj_gpu7 [label="Layer 13 V Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_attn_gpu7 [label="Layer 13 Scaled Dot-Product Attention\nGPU 7\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_attn_out_proj_gpu7 [label="Layer 13 Attention Output Projection\nGPU 7\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_13_residual1_gpu7 [label="Layer 13 Residual1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_13_ln2_gpu7 [label="Layer 13 LayerNorm2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_13_router_gpu7 [label="Layer 13 Router\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_13_gate_gpu7 [label="Layer 13 Gate Selection\nGPU 7\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_13_expert_0_gpu7 [label="Layer 13 Expert 0\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_1_gpu7 [label="Layer 13 Expert 1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_2_gpu7 [label="Layer 13 Expert 2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_3_gpu7 [label="Layer 13 Expert 3\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_expert_agg_gpu7 [label="Layer 13 Expert Aggregation\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_13_moe_out_proj_gpu7 [label="Layer 13 MoE Output Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_13_residual2_gpu7 [label="Layer 13 Residual2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_12_output_gpu7 -> layer_13_ln1_gpu7
		layer_13_ln1_gpu7 -> layer_13_q_proj_gpu7
		layer_13_ln1_gpu7 -> layer_13_k_proj_gpu7
		layer_13_ln1_gpu7 -> layer_13_v_proj_gpu7
		layer_13_q_proj_gpu7 -> layer_13_attn_gpu7
		layer_13_k_proj_gpu7 -> layer_13_attn_gpu7
		layer_13_v_proj_gpu7 -> layer_13_attn_gpu7
		layer_13_attn_gpu7 -> layer_13_attn_out_proj_gpu7
		layer_13_attn_out_proj_gpu7 -> layer_13_residual1_gpu7
		layer_13_residual1_gpu7 -> layer_13_ln2_gpu7
		layer_13_ln2_gpu7 -> layer_13_router_gpu7
		layer_13_router_gpu7 -> layer_13_gate_gpu7
		layer_13_gate_gpu7 -> layer_13_expert_0_gpu7 [style=dashed]
		layer_13_gate_gpu7 -> layer_13_expert_1_gpu7 [style=dashed]
		layer_13_gate_gpu7 -> layer_13_expert_2_gpu7 [style=dashed]
		layer_13_gate_gpu7 -> layer_13_expert_3_gpu7 [style=dashed]
		layer_13_expert_0_gpu7 -> layer_13_expert_agg_gpu7
		layer_13_expert_1_gpu7 -> layer_13_expert_agg_gpu7
		layer_13_expert_2_gpu7 -> layer_13_expert_agg_gpu7
		layer_13_expert_3_gpu7 -> layer_13_expert_agg_gpu7
		layer_13_expert_agg_gpu7 -> layer_13_moe_out_proj_gpu7
		layer_13_moe_out_proj_gpu7 -> layer_13_residual2_gpu7
		layer_13_output_gpu7 [label="Layer 13 Output\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_13_residual2_gpu7 -> layer_13_output_gpu7
		layer_14_ln1_gpu7 [label="Layer 14 LayerNorm1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_14_q_proj_gpu7 [label="Layer 14 Q Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_k_proj_gpu7 [label="Layer 14 K Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_v_proj_gpu7 [label="Layer 14 V Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_attn_gpu7 [label="Layer 14 Scaled Dot-Product Attention\nGPU 7\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_attn_out_proj_gpu7 [label="Layer 14 Attention Output Projection\nGPU 7\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_14_residual1_gpu7 [label="Layer 14 Residual1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_14_ln2_gpu7 [label="Layer 14 LayerNorm2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_14_router_gpu7 [label="Layer 14 Router\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_14_gate_gpu7 [label="Layer 14 Gate Selection\nGPU 7\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_14_expert_0_gpu7 [label="Layer 14 Expert 0\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_1_gpu7 [label="Layer 14 Expert 1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_2_gpu7 [label="Layer 14 Expert 2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_3_gpu7 [label="Layer 14 Expert 3\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_expert_agg_gpu7 [label="Layer 14 Expert Aggregation\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_14_moe_out_proj_gpu7 [label="Layer 14 MoE Output Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_14_residual2_gpu7 [label="Layer 14 Residual2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_13_output_gpu7 -> layer_14_ln1_gpu7
		layer_14_ln1_gpu7 -> layer_14_q_proj_gpu7
		layer_14_ln1_gpu7 -> layer_14_k_proj_gpu7
		layer_14_ln1_gpu7 -> layer_14_v_proj_gpu7
		layer_14_q_proj_gpu7 -> layer_14_attn_gpu7
		layer_14_k_proj_gpu7 -> layer_14_attn_gpu7
		layer_14_v_proj_gpu7 -> layer_14_attn_gpu7
		layer_14_attn_gpu7 -> layer_14_attn_out_proj_gpu7
		layer_14_attn_out_proj_gpu7 -> layer_14_residual1_gpu7
		layer_14_residual1_gpu7 -> layer_14_ln2_gpu7
		layer_14_ln2_gpu7 -> layer_14_router_gpu7
		layer_14_router_gpu7 -> layer_14_gate_gpu7
		layer_14_gate_gpu7 -> layer_14_expert_0_gpu7 [style=dashed]
		layer_14_gate_gpu7 -> layer_14_expert_1_gpu7 [style=dashed]
		layer_14_gate_gpu7 -> layer_14_expert_2_gpu7 [style=dashed]
		layer_14_gate_gpu7 -> layer_14_expert_3_gpu7 [style=dashed]
		layer_14_expert_0_gpu7 -> layer_14_expert_agg_gpu7
		layer_14_expert_1_gpu7 -> layer_14_expert_agg_gpu7
		layer_14_expert_2_gpu7 -> layer_14_expert_agg_gpu7
		layer_14_expert_3_gpu7 -> layer_14_expert_agg_gpu7
		layer_14_expert_agg_gpu7 -> layer_14_moe_out_proj_gpu7
		layer_14_moe_out_proj_gpu7 -> layer_14_residual2_gpu7
		layer_14_output_gpu7 [label="Layer 14 Output\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_14_residual2_gpu7 -> layer_14_output_gpu7
		layer_15_ln1_gpu7 [label="Layer 15 LayerNorm1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_15_q_proj_gpu7 [label="Layer 15 Q Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_k_proj_gpu7 [label="Layer 15 K Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_v_proj_gpu7 [label="Layer 15 V Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_attn_gpu7 [label="Layer 15 Scaled Dot-Product Attention\nGPU 7\nInput Q: [batch=256, seq=512, heads=16, d_k=64]\nInput K,V: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, heads=16, d_k=64]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_attn_out_proj_gpu7 [label="Layer 15 Attention Output Projection\nGPU 7\nInput: [batch=256, seq=512, heads=16, d_k=64]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightcyan shape=rectangle style=filled]
		layer_15_residual1_gpu7 [label="Layer 15 Residual1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogram style=filled]
		layer_15_ln2_gpu7 [label="Layer 15 LayerNorm2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightblue shape=rectangle style=filled]
		layer_15_router_gpu7 [label="Layer 15 Router\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, num_experts=64]" fillcolor=lightsteelblue shape=parallelogram style=filled]
		layer_15_gate_gpu7 [label="Layer 15 Gate Selection\nGPU 7\nInput: [batch=256, seq=512, num_experts=64]\nOutput: [batch=256, seq=512, top_k=2]" fillcolor=lightsteelblue shape=parallelogram style=dashed]
		layer_15_expert_0_gpu7 [label="Layer 15 Expert 0\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_1_gpu7 [label="Layer 15 Expert 1\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_2_gpu7 [label="Layer 15 Expert 2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_3_gpu7 [label="Layer 15 Expert 3\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_expert_agg_gpu7 [label="Layer 15 Expert Aggregation\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsteelblue shape=parallelogam style=filled]
		layer_15_moe_out_proj_gpu7 [label="Layer 15 MoE Output Projection\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightsalmon shape=rectangle style=filled]
		layer_15_residual2_gpu7 [label="Layer 15 Residual2\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightpink shape=parallelogam style=filled]
		layer_14_output_gpu7 -> layer_15_ln1_gpu7
		layer_15_ln1_gpu7 -> layer_15_q_proj_gpu7
		layer_15_ln1_gpu7 -> layer_15_k_proj_gpu7
		layer_15_ln1_gpu7 -> layer_15_v_proj_gpu7
		layer_15_q_proj_gpu7 -> layer_15_attn_gpu7
		layer_15_k_proj_gpu7 -> layer_15_attn_gpu7
		layer_15_v_proj_gpu7 -> layer_15_attn_gpu7
		layer_15_attn_gpu7 -> layer_15_attn_out_proj_gpu7
		layer_15_attn_out_proj_gpu7 -> layer_15_residual1_gpu7
		layer_15_residual1_gpu7 -> layer_15_ln2_gpu7
		layer_15_ln2_gpu7 -> layer_15_router_gpu7
		layer_15_router_gpu7 -> layer_15_gate_gpu7
		layer_15_gate_gpu7 -> layer_15_expert_0_gpu7 [style=dashed]
		layer_15_gate_gpu7 -> layer_15_expert_1_gpu7 [style=dashed]
		layer_15_gate_gpu7 -> layer_15_expert_2_gpu7 [style=dashed]
		layer_15_gate_gpu7 -> layer_15_expert_3_gpu7 [style=dashed]
		layer_15_expert_0_gpu7 -> layer_15_expert_agg_gpu7
		layer_15_expert_1_gpu7 -> layer_15_expert_agg_gpu7
		layer_15_expert_2_gpu7 -> layer_15_expert_agg_gpu7
		layer_15_expert_3_gpu7 -> layer_15_expert_agg_gpu7
		layer_15_expert_agg_gpu7 -> layer_15_moe_out_proj_gpu7
		layer_15_moe_out_proj_gpu7 -> layer_15_residual2_gpu7
		layer_15_output_gpu7 [label="Layer 15 Output\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightgray shape=ellipse style=filled]
		layer_15_residual2_gpu7 -> layer_15_output_gpu7
		final_ln_gpu7 [label="Final Layer Norm\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, dim=2048]" fillcolor=lightyellow shape=rectangle style=filled]
		layer_15_output_gpu7 -> final_ln_gpu7
		lm_head_gpu7 [label="LM Head\nGPU 7\nInput: [batch=256, seq=512, dim=2048]\nOutput: [batch=256, seq=512, vocab_size]" fillcolor=lightcoral shape=rectangle style=filled]
		output_gpu7 [label="Output\nGPU 7\nInput: [batch=256, seq=512, vocab_size]\nOutput: [batch=256, seq=512, vocab_size]" fillcolor=lightgreen shape=ellipse style=filled]
		input_gpu7 -> embed_gpu7
		embed_gpu7 -> pos_enc_gpu7
		final_ln_gpu7 -> lm_head_gpu7
		lm_head_gpu7 -> output_gpu7
	}
	final_aggregation [label="Final Output Aggregation\nAll GPUs\nInput: 8[batch=256, seq=512, vocab_size]\nOutput: [batch=2048, seq=512, vocab_size]" fillcolor=lightgreen shape=parallelogam style=filled]
	output_gpu0 -> final_aggregation
	output_gpu1 -> final_aggregation
	output_gpu2 -> final_aggregation
	output_gpu3 -> final_aggregation
	output_gpu4 -> final_aggregation
	output_gpu5 -> final_aggregation
	output_gpu6 -> final_aggregation
	output_gpu7 -> final_aggregation
}
