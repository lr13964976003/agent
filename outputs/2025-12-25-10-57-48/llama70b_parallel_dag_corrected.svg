<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1440pt" height="1768pt"
 viewBox="0.00 0.00 1440.00 1768.10" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.62 0.62) rotate(0) translate(4 2869.16)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2869.16 2336,-2869.16 2336,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage0</title>
<path fill="lightgray" stroke="black" d="M566,-2229.85C566,-2229.85 1948,-2229.85 1948,-2229.85 1954,-2229.85 1960,-2235.85 1960,-2241.85 1960,-2241.85 1960,-2845.16 1960,-2845.16 1960,-2851.16 1954,-2857.16 1948,-2857.16 1948,-2857.16 566,-2857.16 566,-2857.16 560,-2857.16 554,-2851.16 554,-2845.16 554,-2845.16 554,-2241.85 554,-2241.85 554,-2235.85 560,-2229.85 566,-2229.85"/>
<text text-anchor="middle" x="1257" y="-2841.96" font-family="Times,serif" font-size="14.00">Stage 0: GPUs 0,1 (Layers 0&#45;19)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_gpu0</title>
<path fill="none" stroke="black" d="M1363,-2358.62C1363,-2358.62 1928,-2358.62 1928,-2358.62 1934,-2358.62 1940,-2364.62 1940,-2370.62 1940,-2370.62 1940,-2728.39 1940,-2728.39 1940,-2734.39 1934,-2740.39 1928,-2740.39 1928,-2740.39 1363,-2740.39 1363,-2740.39 1357,-2740.39 1351,-2734.39 1351,-2728.39 1351,-2728.39 1351,-2370.62 1351,-2370.62 1351,-2364.62 1357,-2358.62 1363,-2358.62"/>
<text text-anchor="middle" x="1645.5" y="-2725.19" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_gpu1</title>
<path fill="none" stroke="black" d="M586,-2358.62C586,-2358.62 1151,-2358.62 1151,-2358.62 1157,-2358.62 1163,-2364.62 1163,-2370.62 1163,-2370.62 1163,-2728.39 1163,-2728.39 1163,-2734.39 1157,-2740.39 1151,-2740.39 1151,-2740.39 586,-2740.39 586,-2740.39 580,-2740.39 574,-2734.39 574,-2728.39 574,-2728.39 574,-2370.62 574,-2370.62 574,-2364.62 580,-2358.62 586,-2358.62"/>
<text text-anchor="middle" x="868.5" y="-2725.19" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_stage1</title>
<path fill="lightgray" stroke="black" d="M445,-1489.23C445,-1489.23 1834,-1489.23 1834,-1489.23 1840,-1489.23 1846,-1495.23 1846,-1501.23 1846,-1501.23 1846,-2209.85 1846,-2209.85 1846,-2215.85 1840,-2221.85 1834,-2221.85 1834,-2221.85 445,-2221.85 445,-2221.85 439,-2221.85 433,-2215.85 433,-2209.85 433,-2209.85 433,-1501.23 433,-1501.23 433,-1495.23 439,-1489.23 445,-1489.23"/>
<text text-anchor="middle" x="1139.5" y="-2206.65" font-family="Times,serif" font-size="14.00">Stage 1: GPUs 2,3 (Layers 20&#45;39)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_gpu2</title>
<path fill="none" stroke="black" d="M453,-1618C453,-1618 1023,-1618 1023,-1618 1029,-1618 1035,-1624 1035,-1630 1035,-1630 1035,-1987.77 1035,-1987.77 1035,-1993.77 1029,-1999.77 1023,-1999.77 1023,-1999.77 453,-1999.77 453,-1999.77 447,-1999.77 441,-1993.77 441,-1987.77 441,-1987.77 441,-1630 441,-1630 441,-1624 447,-1618 453,-1618"/>
<text text-anchor="middle" x="738" y="-1984.57" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_gpu3</title>
<path fill="none" stroke="black" d="M1255,-1618C1255,-1618 1826,-1618 1826,-1618 1832,-1618 1838,-1624 1838,-1630 1838,-1630 1838,-1987.77 1838,-1987.77 1838,-1993.77 1832,-1999.77 1826,-1999.77 1826,-1999.77 1255,-1999.77 1255,-1999.77 1249,-1999.77 1243,-1993.77 1243,-1987.77 1243,-1987.77 1243,-1630 1243,-1630 1243,-1624 1249,-1618 1255,-1618"/>
<text text-anchor="middle" x="1540.5" y="-1984.57" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_stage2</title>
<path fill="lightgray" stroke="black" d="M923,-748.62C923,-748.62 2312,-748.62 2312,-748.62 2318,-748.62 2324,-754.62 2324,-760.62 2324,-760.62 2324,-1469.23 2324,-1469.23 2324,-1475.23 2318,-1481.23 2312,-1481.23 2312,-1481.23 923,-1481.23 923,-1481.23 917,-1481.23 911,-1475.23 911,-1469.23 911,-1469.23 911,-760.62 911,-760.62 911,-754.62 917,-748.62 923,-748.62"/>
<text text-anchor="middle" x="1617.5" y="-1466.03" font-family="Times,serif" font-size="14.00">Stage 2: GPUs 4,5 (Layers 40&#45;59)</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_gpu4</title>
<path fill="none" stroke="black" d="M931,-877.39C931,-877.39 1501,-877.39 1501,-877.39 1507,-877.39 1513,-883.39 1513,-889.39 1513,-889.39 1513,-1247.16 1513,-1247.16 1513,-1253.16 1507,-1259.16 1501,-1259.16 1501,-1259.16 931,-1259.16 931,-1259.16 925,-1259.16 919,-1253.16 919,-1247.16 919,-1247.16 919,-889.39 919,-889.39 919,-883.39 925,-877.39 931,-877.39"/>
<text text-anchor="middle" x="1216" y="-1243.96" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_gpu5</title>
<path fill="none" stroke="black" d="M1733,-877.39C1733,-877.39 2304,-877.39 2304,-877.39 2310,-877.39 2316,-883.39 2316,-889.39 2316,-889.39 2316,-1247.16 2316,-1247.16 2316,-1253.16 2310,-1259.16 2304,-1259.16 2304,-1259.16 1733,-1259.16 1733,-1259.16 1727,-1259.16 1721,-1253.16 1721,-1247.16 1721,-1247.16 1721,-889.39 1721,-889.39 1721,-883.39 1727,-877.39 1733,-877.39"/>
<text text-anchor="middle" x="2018.5" y="-1243.96" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_stage3</title>
<path fill="lightgray" stroke="black" d="M231,-8C231,-8 2187,-8 2187,-8 2193,-8 2199,-14 2199,-20 2199,-20 2199,-728.62 2199,-728.62 2199,-734.62 2193,-740.62 2187,-740.62 2187,-740.62 231,-740.62 231,-740.62 225,-740.62 219,-734.62 219,-728.62 219,-728.62 219,-20 219,-20 219,-14 225,-8 231,-8"/>
<text text-anchor="middle" x="1209" y="-725.42" font-family="Times,serif" font-size="14.00">Stage 3: GPUs 6,7 (Layers 60&#45;79)</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_gpu6</title>
<path fill="none" stroke="black" d="M239,-132.54C239,-132.54 961,-132.54 961,-132.54 967,-132.54 973,-138.54 973,-144.54 973,-144.54 973,-506.54 973,-506.54 973,-512.54 967,-518.54 961,-518.54 961,-518.54 239,-518.54 239,-518.54 233,-518.54 227,-512.54 227,-506.54 227,-506.54 227,-144.54 227,-144.54 227,-138.54 233,-132.54 239,-132.54"/>
<text text-anchor="middle" x="600" y="-503.34" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<g id="clust12" class="cluster">
<title>cluster_gpu7</title>
<path fill="none" stroke="black" d="M1457,-132.54C1457,-132.54 2179,-132.54 2179,-132.54 2185,-132.54 2191,-138.54 2191,-144.54 2191,-144.54 2191,-506.54 2191,-506.54 2191,-512.54 2185,-518.54 2179,-518.54 2179,-518.54 1457,-518.54 1457,-518.54 1451,-518.54 1445,-512.54 1445,-506.54 1445,-506.54 1445,-144.54 1445,-144.54 1445,-138.54 1451,-132.54 1457,-132.54"/>
<text text-anchor="middle" x="1818" y="-503.34" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="lightpink" stroke="black" points="273,-2830.39 0,-2789.39 273,-2748.39 546,-2789.39 273,-2830.39"/>
<text text-anchor="middle" x="273" y="-2797.89" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="273" y="-2786.89" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=8192, hidden_size=8192]</text>
<text text-anchor="middle" x="273" y="-2775.89" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=8192, hidden_size=8192]</text>
</g>
<!-- gpu0_layer0_attn_qkv -->
<g id="node2" class="node">
<title>gpu0_layer0_attn_qkv</title>
<polygon fill="lightgreen" stroke="black" points="1502.5,-2683.39 1359.5,-2683.39 1359.5,-2631.39 1502.5,-2631.39 1502.5,-2683.39"/>
<text text-anchor="middle" x="1431" y="-2671.39" font-family="Arial" font-size="10.00">Layer 0 Attention QKV Linear</text>
<text text-anchor="middle" x="1431" y="-2660.39" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1431" y="-2649.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1431" y="-2638.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 3072]</text>
</g>
<!-- input&#45;&gt;gpu0_layer0_attn_qkv -->
<g id="edge1" class="edge">
<title>input&#45;&gt;gpu0_layer0_attn_qkv</title>
<path fill="none" stroke="black" d="M397.06,-2766.95C444.73,-2759.64 499.74,-2752.33 550,-2748.39 618.35,-2743.04 1099.28,-2751.12 1167,-2740.39 1233.6,-2729.84 1306.62,-2706.17 1358.95,-2686.96"/>
<polygon fill="black" stroke="black" points="1360.32,-2690.19 1368.47,-2683.43 1357.88,-2683.62 1360.32,-2690.19"/>
</g>
<!-- gpu1_layer0_attn_qkv -->
<g id="node8" class="node">
<title>gpu1_layer0_attn_qkv</title>
<polygon fill="lightgreen" stroke="black" points="725.5,-2683.39 582.5,-2683.39 582.5,-2631.39 725.5,-2631.39 725.5,-2683.39"/>
<text text-anchor="middle" x="654" y="-2671.39" font-family="Arial" font-size="10.00">Layer 0 Attention QKV Linear</text>
<text text-anchor="middle" x="654" y="-2660.39" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="654" y="-2649.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="654" y="-2638.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 3072]</text>
</g>
<!-- input&#45;&gt;gpu1_layer0_attn_qkv -->
<g id="edge2" class="edge">
<title>input&#45;&gt;gpu1_layer0_attn_qkv</title>
<path fill="none" stroke="black" d="M354.73,-2760.5C419.1,-2738.54 508.39,-2708.08 572.66,-2686.15"/>
<polygon fill="black" stroke="black" points="574.01,-2689.38 582.35,-2682.84 571.75,-2682.76 574.01,-2689.38"/>
</g>
<!-- gpu0_layer0_attn_gate -->
<g id="node3" class="node">
<title>gpu0_layer0_attn_gate</title>
<polygon fill="lightyellow" stroke="black" points="1611.47,-2569.39 1410.29,-2569.39 1358.53,-2465.39 1559.71,-2465.39 1611.47,-2569.39"/>
<text text-anchor="middle" x="1485" y="-2531.39" font-family="Arial" font-size="10.00">Layer 0 Attention Gate</text>
<text text-anchor="middle" x="1485" y="-2520.39" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="1485" y="-2509.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 3072]</text>
<text text-anchor="middle" x="1485" y="-2498.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 1536]</text>
</g>
<!-- gpu0_layer0_attn_qkv&#45;&gt;gpu0_layer0_attn_gate -->
<g id="edge3" class="edge">
<title>gpu0_layer0_attn_qkv&#45;&gt;gpu0_layer0_attn_gate</title>
<path fill="none" stroke="black" d="M1440.9,-2631.08C1446.63,-2616.44 1454.11,-2597.33 1461.27,-2579.03"/>
<polygon fill="black" stroke="black" points="1464.6,-2580.14 1464.98,-2569.55 1458.08,-2577.59 1464.6,-2580.14"/>
</g>
<!-- gpu0_layer0_attn_out -->
<g id="node4" class="node">
<title>gpu0_layer0_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1746,-2418.62 1594,-2418.62 1594,-2366.62 1746,-2366.62 1746,-2418.62"/>
<text text-anchor="middle" x="1670" y="-2406.62" font-family="Arial" font-size="10.00">Layer 0 Attention Output Linear</text>
<text text-anchor="middle" x="1670" y="-2395.62" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1670" y="-2384.62" font-family="Arial" font-size="10.00">Input: [64, 8192, 1536]</text>
<text text-anchor="middle" x="1670" y="-2373.62" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu0_layer0_attn_gate&#45;&gt;gpu0_layer0_attn_out -->
<g id="edge4" class="edge">
<title>gpu0_layer0_attn_gate&#45;&gt;gpu0_layer0_attn_out</title>
<path fill="none" stroke="black" d="M1560.25,-2466.46C1581.67,-2452.24 1604.38,-2437.17 1623.55,-2424.45"/>
<polygon fill="black" stroke="black" points="1625.69,-2427.23 1632.09,-2418.78 1621.82,-2421.39 1625.69,-2427.23"/>
</g>
<!-- stage0_tp_allreduce1 -->
<g id="node14" class="node">
<title>stage0_tp_allreduce1</title>
<ellipse fill="lightblue" stroke="black" cx="1372" cy="-2789.39" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1372" y="-2803.39" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1372" y="-2792.39" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="1372" y="-2781.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1372" y="-2770.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu0_layer0_attn_out&#45;&gt;stage0_tp_allreduce1 -->
<g id="edge5" class="edge">
<title>gpu0_layer0_attn_out&#45;&gt;stage0_tp_allreduce1</title>
<path fill="none" stroke="black" d="M1715.78,-2418.67C1817.47,-2477.29 2045.19,-2627.04 1941,-2740.39 1909.77,-2774.37 1622.89,-2784.31 1468.82,-2787.21"/>
<polygon fill="black" stroke="black" points="1468.35,-2783.72 1458.41,-2787.4 1468.47,-2790.72 1468.35,-2783.72"/>
</g>
<!-- gpu0_layer0_mlp_gate -->
<g id="node5" class="node">
<title>gpu0_layer0_mlp_gate</title>
<polygon fill="lightyellow" stroke="black" points="1785.91,-2709.39 1574.48,-2709.39 1520.09,-2605.39 1731.52,-2605.39 1785.91,-2709.39"/>
<text text-anchor="middle" x="1653" y="-2671.39" font-family="Arial" font-size="10.00">Layer 0 MLP Gate</text>
<text text-anchor="middle" x="1653" y="-2660.39" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="1653" y="-2649.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1653" y="-2638.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu0_layer0_mlp_down -->
<g id="node7" class="node">
<title>gpu0_layer0_mlp_down</title>
<polygon fill="lightgreen" stroke="black" points="1759,-2543.39 1629,-2543.39 1629,-2491.39 1759,-2491.39 1759,-2543.39"/>
<text text-anchor="middle" x="1694" y="-2531.39" font-family="Arial" font-size="10.00">Layer 0 MLP Down Linear</text>
<text text-anchor="middle" x="1694" y="-2520.39" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1694" y="-2509.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 28672]</text>
<text text-anchor="middle" x="1694" y="-2498.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu0_layer0_mlp_gate&#45;&gt;gpu0_layer0_mlp_down -->
<g id="edge13" class="edge">
<title>gpu0_layer0_mlp_gate&#45;&gt;gpu0_layer0_mlp_down</title>
<path fill="none" stroke="black" d="M1668.27,-2605C1673.38,-2587.78 1678.97,-2568.99 1683.62,-2553.32"/>
<polygon fill="black" stroke="black" points="1687.04,-2554.11 1686.53,-2543.53 1680.33,-2552.12 1687.04,-2554.11"/>
</g>
<!-- gpu0_layer0_mlp_up -->
<g id="node6" class="node">
<title>gpu0_layer0_mlp_up</title>
<polygon fill="lightgreen" stroke="black" points="1932,-2683.39 1804,-2683.39 1804,-2631.39 1932,-2631.39 1932,-2683.39"/>
<text text-anchor="middle" x="1868" y="-2671.39" font-family="Arial" font-size="10.00">Layer 0 MLP Up Linear</text>
<text text-anchor="middle" x="1868" y="-2660.39" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1868" y="-2649.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1868" y="-2638.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu0_layer0_mlp_up&#45;&gt;gpu0_layer0_mlp_down -->
<g id="edge15" class="edge">
<title>gpu0_layer0_mlp_up&#45;&gt;gpu0_layer0_mlp_down</title>
<path fill="none" stroke="black" d="M1836.09,-2631.08C1807.27,-2608.22 1764.75,-2574.5 1733.73,-2549.9"/>
<polygon fill="black" stroke="black" points="1735.72,-2547.01 1725.71,-2543.54 1731.37,-2552.5 1735.72,-2547.01"/>
</g>
<!-- stage0_tp_allreduce2 -->
<g id="node15" class="node">
<title>stage0_tp_allreduce2</title>
<ellipse fill="lightblue" stroke="black" cx="1257" cy="-2392.62" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1257" y="-2406.62" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1257" y="-2395.62" font-family="Arial" font-size="10.00">MLP Output</text>
<text text-anchor="middle" x="1257" y="-2384.62" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1257" y="-2373.62" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu0_layer0_mlp_down&#45;&gt;stage0_tp_allreduce2 -->
<g id="edge17" class="edge">
<title>gpu0_layer0_mlp_down&#45;&gt;stage0_tp_allreduce2</title>
<path fill="none" stroke="black" d="M1664.52,-2491.3C1651.64,-2481.65 1635.87,-2471.5 1620,-2465.39 1505.78,-2421.45 1465.44,-2460.23 1347,-2429.39 1340.06,-2427.59 1332.94,-2425.39 1325.89,-2422.98"/>
<polygon fill="black" stroke="black" points="1326.93,-2419.64 1316.34,-2419.59 1324.59,-2426.24 1326.93,-2419.64"/>
</g>
<!-- gpu1_layer0_attn_gate -->
<g id="node9" class="node">
<title>gpu1_layer0_attn_gate</title>
<polygon fill="lightyellow" stroke="black" points="834.47,-2569.39 633.29,-2569.39 581.53,-2465.39 782.71,-2465.39 834.47,-2569.39"/>
<text text-anchor="middle" x="708" y="-2531.39" font-family="Arial" font-size="10.00">Layer 0 Attention Gate</text>
<text text-anchor="middle" x="708" y="-2520.39" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="708" y="-2509.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 3072]</text>
<text text-anchor="middle" x="708" y="-2498.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 1536]</text>
</g>
<!-- gpu1_layer0_attn_qkv&#45;&gt;gpu1_layer0_attn_gate -->
<g id="edge6" class="edge">
<title>gpu1_layer0_attn_qkv&#45;&gt;gpu1_layer0_attn_gate</title>
<path fill="none" stroke="black" d="M663.9,-2631.08C669.63,-2616.44 677.11,-2597.33 684.27,-2579.03"/>
<polygon fill="black" stroke="black" points="687.6,-2580.14 687.98,-2569.55 681.08,-2577.59 687.6,-2580.14"/>
</g>
<!-- gpu1_layer0_attn_out -->
<g id="node10" class="node">
<title>gpu1_layer0_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="759,-2418.62 607,-2418.62 607,-2366.62 759,-2366.62 759,-2418.62"/>
<text text-anchor="middle" x="683" y="-2406.62" font-family="Arial" font-size="10.00">Layer 0 Attention Output Linear</text>
<text text-anchor="middle" x="683" y="-2395.62" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="683" y="-2384.62" font-family="Arial" font-size="10.00">Input: [64, 8192, 1536]</text>
<text text-anchor="middle" x="683" y="-2373.62" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu1_layer0_attn_gate&#45;&gt;gpu1_layer0_attn_out -->
<g id="edge7" class="edge">
<title>gpu1_layer0_attn_gate&#45;&gt;gpu1_layer0_attn_out</title>
<path fill="none" stroke="black" d="M697.54,-2465.04C695.04,-2452.76 692.43,-2439.94 690.12,-2428.6"/>
<polygon fill="black" stroke="black" points="693.52,-2427.76 688.1,-2418.66 686.66,-2429.16 693.52,-2427.76"/>
</g>
<!-- gpu1_layer0_attn_out&#45;&gt;stage0_tp_allreduce1 -->
<g id="edge8" class="edge">
<title>gpu1_layer0_attn_out&#45;&gt;stage0_tp_allreduce1</title>
<path fill="none" stroke="black" d="M622.34,-2418.76C603.02,-2430 583.86,-2445.34 573,-2465.39 514.8,-2572.87 489.95,-2651.65 574,-2740.39 597.79,-2765.5 1068.59,-2780.62 1275.66,-2786.07"/>
<polygon fill="black" stroke="black" points="1275.83,-2789.58 1285.92,-2786.34 1276.02,-2782.58 1275.83,-2789.58"/>
</g>
<!-- gpu1_layer0_mlp_gate -->
<g id="node11" class="node">
<title>gpu1_layer0_mlp_gate</title>
<polygon fill="lightyellow" stroke="black" points="1008.91,-2709.39 797.48,-2709.39 743.09,-2605.39 954.52,-2605.39 1008.91,-2709.39"/>
<text text-anchor="middle" x="876" y="-2671.39" font-family="Arial" font-size="10.00">Layer 0 MLP Gate</text>
<text text-anchor="middle" x="876" y="-2660.39" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="876" y="-2649.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="876" y="-2638.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu1_layer0_mlp_down -->
<g id="node13" class="node">
<title>gpu1_layer0_mlp_down</title>
<polygon fill="lightgreen" stroke="black" points="1155,-2543.39 1025,-2543.39 1025,-2491.39 1155,-2491.39 1155,-2543.39"/>
<text text-anchor="middle" x="1090" y="-2531.39" font-family="Arial" font-size="10.00">Layer 0 MLP Down Linear</text>
<text text-anchor="middle" x="1090" y="-2520.39" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1090" y="-2509.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 28672]</text>
<text text-anchor="middle" x="1090" y="-2498.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu1_layer0_mlp_gate&#45;&gt;gpu1_layer0_mlp_down -->
<g id="edge14" class="edge">
<title>gpu1_layer0_mlp_gate&#45;&gt;gpu1_layer0_mlp_down</title>
<path fill="none" stroke="black" d="M954.77,-2605.59C984.22,-2586.6 1016.74,-2565.64 1042.5,-2549.02"/>
<polygon fill="black" stroke="black" points="1044.46,-2551.92 1050.97,-2543.56 1040.67,-2546.04 1044.46,-2551.92"/>
</g>
<!-- gpu1_layer0_mlp_up -->
<g id="node12" class="node">
<title>gpu1_layer0_mlp_up</title>
<polygon fill="lightgreen" stroke="black" points="1155,-2683.39 1027,-2683.39 1027,-2631.39 1155,-2631.39 1155,-2683.39"/>
<text text-anchor="middle" x="1091" y="-2671.39" font-family="Arial" font-size="10.00">Layer 0 MLP Up Linear</text>
<text text-anchor="middle" x="1091" y="-2660.39" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1091" y="-2649.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1091" y="-2638.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu1_layer0_mlp_up&#45;&gt;gpu1_layer0_mlp_down -->
<g id="edge16" class="edge">
<title>gpu1_layer0_mlp_up&#45;&gt;gpu1_layer0_mlp_down</title>
<path fill="none" stroke="black" d="M1090.82,-2631.08C1090.66,-2609.39 1090.43,-2577.92 1090.26,-2553.74"/>
<polygon fill="black" stroke="black" points="1093.75,-2553.52 1090.18,-2543.54 1086.75,-2553.57 1093.75,-2553.52"/>
</g>
<!-- gpu1_layer0_mlp_down&#45;&gt;stage0_tp_allreduce2 -->
<g id="edge18" class="edge">
<title>gpu1_layer0_mlp_down&#45;&gt;stage0_tp_allreduce2</title>
<path fill="none" stroke="black" d="M1124.2,-2491.25C1147.89,-2473.83 1179.84,-2450.34 1206.46,-2430.77"/>
<polygon fill="black" stroke="black" points="1208.56,-2433.58 1214.54,-2424.84 1204.41,-2427.94 1208.56,-2433.58"/>
</g>
<!-- stage0_tp_allreduce1&#45;&gt;gpu0_layer0_mlp_gate -->
<g id="edge9" class="edge">
<title>stage0_tp_allreduce1&#45;&gt;gpu0_layer0_mlp_gate</title>
<path fill="none" stroke="black" d="M1441.77,-2767.47C1464.53,-2759.86 1489.68,-2750.59 1512,-2740.39 1529.44,-2732.42 1547.51,-2722.94 1564.67,-2713.29"/>
<polygon fill="black" stroke="black" points="1566.59,-2716.23 1573.55,-2708.24 1563.13,-2710.14 1566.59,-2716.23"/>
</g>
<!-- stage0_tp_allreduce1&#45;&gt;gpu0_layer0_mlp_up -->
<g id="edge10" class="edge">
<title>stage0_tp_allreduce1&#45;&gt;gpu0_layer0_mlp_up</title>
<path fill="none" stroke="black" d="M1458.2,-2785.82C1564.52,-2781.42 1738.16,-2769.85 1795,-2740.39 1816.23,-2729.39 1834.19,-2709.47 1846.98,-2692.02"/>
<polygon fill="black" stroke="black" points="1849.94,-2693.9 1852.83,-2683.71 1844.21,-2689.87 1849.94,-2693.9"/>
</g>
<!-- stage0_tp_allreduce1&#45;&gt;gpu1_layer0_mlp_gate -->
<g id="edge11" class="edge">
<title>stage0_tp_allreduce1&#45;&gt;gpu1_layer0_mlp_gate</title>
<path fill="none" stroke="black" d="M1285.83,-2786.01C1212.79,-2781.82 1106.18,-2770.52 1018,-2740.39 998.67,-2733.79 979.02,-2724.44 960.75,-2714.41"/>
<polygon fill="black" stroke="black" points="962.33,-2711.29 951.89,-2709.44 958.9,-2717.39 962.33,-2711.29"/>
</g>
<!-- stage0_tp_allreduce1&#45;&gt;gpu1_layer0_mlp_up -->
<g id="edge12" class="edge">
<title>stage0_tp_allreduce1&#45;&gt;gpu1_layer0_mlp_up</title>
<path fill="none" stroke="black" d="M1314.46,-2761.77C1267.94,-2740.25 1202.53,-2709.99 1154.49,-2687.77"/>
<polygon fill="black" stroke="black" points="1155.67,-2684.46 1145.13,-2683.43 1152.74,-2690.81 1155.67,-2684.46"/>
</g>
<!-- stage0_output -->
<g id="node16" class="node">
<title>stage0_output</title>
<polygon fill="lightcoral" stroke="black" points="1257,-2319.85 1135,-2278.85 1257,-2237.85 1379,-2278.85 1257,-2319.85"/>
<text text-anchor="middle" x="1257" y="-2287.35" font-family="Arial" font-size="10.00">Stage 0 Output</text>
<text text-anchor="middle" x="1257" y="-2276.35" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1257" y="-2265.35" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- stage0_tp_allreduce2&#45;&gt;stage0_output -->
<g id="edge19" class="edge">
<title>stage0_tp_allreduce2&#45;&gt;stage0_output</title>
<path fill="none" stroke="black" d="M1257,-2355.64C1257,-2347.57 1257,-2338.85 1257,-2330.31"/>
<polygon fill="black" stroke="black" points="1260.5,-2330.03 1257,-2320.03 1253.5,-2330.03 1260.5,-2330.03"/>
</g>
<!-- p2p_send_0_1 -->
<g id="node31" class="node">
<title>p2p_send_0_1</title>
<ellipse fill="lightblue" stroke="black" cx="1257" cy="-2154.08" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1257" y="-2168.08" font-family="Arial" font-size="10.00">Pipeline Send</text>
<text text-anchor="middle" x="1257" y="-2157.08" font-family="Arial" font-size="10.00">Stage0→Stage1</text>
<text text-anchor="middle" x="1257" y="-2146.08" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1257" y="-2135.08" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- stage0_output&#45;&gt;p2p_send_0_1 -->
<g id="edge20" class="edge">
<title>stage0_output&#45;&gt;p2p_send_0_1</title>
<path fill="none" stroke="black" d="M1257,-2237.65C1257,-2226.08 1257,-2213.36 1257,-2201.44"/>
<polygon fill="black" stroke="black" points="1260.5,-2201.23 1257,-2191.23 1253.5,-2201.23 1260.5,-2201.23"/>
</g>
<!-- gpu2_layer20_attn_qkv -->
<g id="node17" class="node">
<title>gpu2_layer20_attn_qkv</title>
<polygon fill="lightgreen" stroke="black" points="597.5,-1942.77 448.5,-1942.77 448.5,-1890.77 597.5,-1890.77 597.5,-1942.77"/>
<text text-anchor="middle" x="523" y="-1930.77" font-family="Arial" font-size="10.00">Layer 20 Attention QKV Linear</text>
<text text-anchor="middle" x="523" y="-1919.77" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="523" y="-1908.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="523" y="-1897.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 3072]</text>
</g>
<!-- gpu2_layer20_attn_gate -->
<g id="node18" class="node">
<title>gpu2_layer20_attn_gate</title>
<polygon fill="lightyellow" stroke="black" points="787.47,-1828.77 586.29,-1828.77 534.53,-1724.77 735.71,-1724.77 787.47,-1828.77"/>
<text text-anchor="middle" x="661" y="-1790.77" font-family="Arial" font-size="10.00">Layer 20 Attention Gate</text>
<text text-anchor="middle" x="661" y="-1779.77" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="661" y="-1768.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 3072]</text>
<text text-anchor="middle" x="661" y="-1757.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 1536]</text>
</g>
<!-- gpu2_layer20_attn_qkv&#45;&gt;gpu2_layer20_attn_gate -->
<g id="edge24" class="edge">
<title>gpu2_layer20_attn_qkv&#45;&gt;gpu2_layer20_attn_gate</title>
<path fill="none" stroke="black" d="M548.31,-1890.46C563.56,-1875.21 583.64,-1855.13 602.63,-1836.15"/>
<polygon fill="black" stroke="black" points="605.24,-1838.48 609.84,-1828.94 600.29,-1833.53 605.24,-1838.48"/>
</g>
<!-- gpu2_layer20_attn_out -->
<g id="node19" class="node">
<title>gpu2_layer20_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="881.5,-1678 724.5,-1678 724.5,-1626 881.5,-1626 881.5,-1678"/>
<text text-anchor="middle" x="803" y="-1666" font-family="Arial" font-size="10.00">Layer 20 Attention Output Linear</text>
<text text-anchor="middle" x="803" y="-1655" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="803" y="-1644" font-family="Arial" font-size="10.00">Input: [64, 8192, 1536]</text>
<text text-anchor="middle" x="803" y="-1633" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu2_layer20_attn_gate&#45;&gt;gpu2_layer20_attn_out -->
<g id="edge25" class="edge">
<title>gpu2_layer20_attn_gate&#45;&gt;gpu2_layer20_attn_out</title>
<path fill="none" stroke="black" d="M720.4,-1724.42C735.9,-1711.02 752.16,-1696.96 766.11,-1684.9"/>
<polygon fill="black" stroke="black" points="768.76,-1687.23 774.04,-1678.04 764.19,-1681.94 768.76,-1687.23"/>
</g>
<!-- stage1_tp_allreduce1 -->
<g id="node29" class="node">
<title>stage1_tp_allreduce1</title>
<ellipse fill="lightblue" stroke="black" cx="1415" cy="-1538.23" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1415" y="-1552.23" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1415" y="-1541.23" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="1415" y="-1530.23" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1415" y="-1519.23" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu2_layer20_attn_out&#45;&gt;stage1_tp_allreduce1 -->
<g id="edge26" class="edge">
<title>gpu2_layer20_attn_out&#45;&gt;stage1_tp_allreduce1</title>
<path fill="none" stroke="black" d="M854.38,-1625.94C864.65,-1621.77 875.51,-1617.93 886,-1615.23 1047.74,-1573.69 1095.54,-1608.19 1260,-1579.23 1284.66,-1574.89 1311.16,-1568.65 1335.15,-1562.39"/>
<polygon fill="black" stroke="black" points="1336.14,-1565.75 1344.91,-1559.81 1334.34,-1558.98 1336.14,-1565.75"/>
</g>
<!-- gpu2_layer20_mlp_gate -->
<g id="node20" class="node">
<title>gpu2_layer20_mlp_gate</title>
<polygon fill="lightyellow" stroke="black" points="880.91,-1968.77 669.48,-1968.77 615.09,-1864.77 826.52,-1864.77 880.91,-1968.77"/>
<text text-anchor="middle" x="748" y="-1930.77" font-family="Arial" font-size="10.00">Layer 20 MLP Gate</text>
<text text-anchor="middle" x="748" y="-1919.77" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="748" y="-1908.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="748" y="-1897.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu2_layer20_mlp_down -->
<g id="node22" class="node">
<title>gpu2_layer20_mlp_down</title>
<polygon fill="lightgreen" stroke="black" points="1026.5,-1802.77 891.5,-1802.77 891.5,-1750.77 1026.5,-1750.77 1026.5,-1802.77"/>
<text text-anchor="middle" x="959" y="-1790.77" font-family="Arial" font-size="10.00">Layer 20 MLP Down Linear</text>
<text text-anchor="middle" x="959" y="-1779.77" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="959" y="-1768.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 28672]</text>
<text text-anchor="middle" x="959" y="-1757.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu2_layer20_mlp_gate&#45;&gt;gpu2_layer20_mlp_down -->
<g id="edge32" class="edge">
<title>gpu2_layer20_mlp_gate&#45;&gt;gpu2_layer20_mlp_down</title>
<path fill="none" stroke="black" d="M826.27,-1864.58C855.12,-1845.71 886.89,-1824.94 912.11,-1808.44"/>
<polygon fill="black" stroke="black" points="914.29,-1811.2 920.74,-1802.8 910.46,-1805.34 914.29,-1811.2"/>
</g>
<!-- gpu2_layer20_mlp_up -->
<g id="node21" class="node">
<title>gpu2_layer20_mlp_up</title>
<polygon fill="lightgreen" stroke="black" points="1027,-1942.77 899,-1942.77 899,-1890.77 1027,-1890.77 1027,-1942.77"/>
<text text-anchor="middle" x="963" y="-1930.77" font-family="Arial" font-size="10.00">Layer 20 MLP Up Linear</text>
<text text-anchor="middle" x="963" y="-1919.77" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="963" y="-1908.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="963" y="-1897.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu2_layer20_mlp_up&#45;&gt;gpu2_layer20_mlp_down -->
<g id="edge34" class="edge">
<title>gpu2_layer20_mlp_up&#45;&gt;gpu2_layer20_mlp_down</title>
<path fill="none" stroke="black" d="M962.27,-1890.46C961.64,-1868.77 960.73,-1837.3 960.02,-1813.12"/>
<polygon fill="black" stroke="black" points="963.52,-1812.82 959.73,-1802.92 956.52,-1813.02 963.52,-1812.82"/>
</g>
<!-- stage1_tp_allreduce2 -->
<g id="node30" class="node">
<title>stage1_tp_allreduce2</title>
<ellipse fill="lightblue" stroke="black" cx="1129" cy="-1652" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1129" y="-1666" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1129" y="-1655" font-family="Arial" font-size="10.00">MLP Output</text>
<text text-anchor="middle" x="1129" y="-1644" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1129" y="-1633" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu2_layer20_mlp_down&#45;&gt;stage1_tp_allreduce2 -->
<g id="edge36" class="edge">
<title>gpu2_layer20_mlp_down&#45;&gt;stage1_tp_allreduce2</title>
<path fill="none" stroke="black" d="M993.81,-1750.63C1018.02,-1733.15 1050.69,-1709.56 1077.85,-1689.94"/>
<polygon fill="black" stroke="black" points="1080.03,-1692.69 1086.09,-1683.99 1075.93,-1687.01 1080.03,-1692.69"/>
</g>
<!-- gpu3_layer20_attn_qkv -->
<g id="node23" class="node">
<title>gpu3_layer20_attn_qkv</title>
<polygon fill="lightgreen" stroke="black" points="1683.5,-1942.77 1534.5,-1942.77 1534.5,-1890.77 1683.5,-1890.77 1683.5,-1942.77"/>
<text text-anchor="middle" x="1609" y="-1930.77" font-family="Arial" font-size="10.00">Layer 20 Attention QKV Linear</text>
<text text-anchor="middle" x="1609" y="-1919.77" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1609" y="-1908.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1609" y="-1897.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 3072]</text>
</g>
<!-- gpu3_layer20_attn_gate -->
<g id="node24" class="node">
<title>gpu3_layer20_attn_gate</title>
<polygon fill="lightyellow" stroke="black" points="1728.47,-1828.77 1527.29,-1828.77 1475.53,-1724.77 1676.71,-1724.77 1728.47,-1828.77"/>
<text text-anchor="middle" x="1602" y="-1790.77" font-family="Arial" font-size="10.00">Layer 20 Attention Gate</text>
<text text-anchor="middle" x="1602" y="-1779.77" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="1602" y="-1768.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 3072]</text>
<text text-anchor="middle" x="1602" y="-1757.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 1536]</text>
</g>
<!-- gpu3_layer20_attn_qkv&#45;&gt;gpu3_layer20_attn_gate -->
<g id="edge27" class="edge">
<title>gpu3_layer20_attn_qkv&#45;&gt;gpu3_layer20_attn_gate</title>
<path fill="none" stroke="black" d="M1607.72,-1890.46C1606.98,-1876.02 1606.03,-1857.24 1605.11,-1839.16"/>
<polygon fill="black" stroke="black" points="1608.6,-1838.75 1604.6,-1828.94 1601.61,-1839.1 1608.6,-1838.75"/>
</g>
<!-- gpu3_layer20_attn_out -->
<g id="node25" class="node">
<title>gpu3_layer20_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1613.5,-1678 1456.5,-1678 1456.5,-1626 1613.5,-1626 1613.5,-1678"/>
<text text-anchor="middle" x="1535" y="-1666" font-family="Arial" font-size="10.00">Layer 20 Attention Output Linear</text>
<text text-anchor="middle" x="1535" y="-1655" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1535" y="-1644" font-family="Arial" font-size="10.00">Input: [64, 8192, 1536]</text>
<text text-anchor="middle" x="1535" y="-1633" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu3_layer20_attn_gate&#45;&gt;gpu3_layer20_attn_out -->
<g id="edge28" class="edge">
<title>gpu3_layer20_attn_gate&#45;&gt;gpu3_layer20_attn_out</title>
<path fill="none" stroke="black" d="M1573.97,-1724.42C1567.07,-1711.77 1559.85,-1698.53 1553.52,-1686.94"/>
<polygon fill="black" stroke="black" points="1556.53,-1685.14 1548.66,-1678.04 1550.38,-1688.5 1556.53,-1685.14"/>
</g>
<!-- gpu3_layer20_attn_out&#45;&gt;stage1_tp_allreduce1 -->
<g id="edge29" class="edge">
<title>gpu3_layer20_attn_out&#45;&gt;stage1_tp_allreduce1</title>
<path fill="none" stroke="black" d="M1508.07,-1625.92C1493.21,-1612.08 1474.41,-1594.57 1457.61,-1578.92"/>
<polygon fill="black" stroke="black" points="1459.75,-1576.13 1450.05,-1571.88 1454.98,-1581.25 1459.75,-1576.13"/>
</g>
<!-- gpu3_layer20_mlp_gate -->
<g id="node26" class="node">
<title>gpu3_layer20_mlp_gate</title>
<polygon fill="lightyellow" stroke="black" points="1516.91,-1968.77 1305.48,-1968.77 1251.09,-1864.77 1462.52,-1864.77 1516.91,-1968.77"/>
<text text-anchor="middle" x="1384" y="-1930.77" font-family="Arial" font-size="10.00">Layer 20 MLP Gate</text>
<text text-anchor="middle" x="1384" y="-1919.77" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="1384" y="-1908.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1384" y="-1897.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu3_layer20_mlp_down -->
<g id="node28" class="node">
<title>gpu3_layer20_mlp_down</title>
<polygon fill="lightgreen" stroke="black" points="1451.5,-1802.77 1316.5,-1802.77 1316.5,-1750.77 1451.5,-1750.77 1451.5,-1802.77"/>
<text text-anchor="middle" x="1384" y="-1790.77" font-family="Arial" font-size="10.00">Layer 20 MLP Down Linear</text>
<text text-anchor="middle" x="1384" y="-1779.77" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1384" y="-1768.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 28672]</text>
<text text-anchor="middle" x="1384" y="-1757.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu3_layer20_mlp_gate&#45;&gt;gpu3_layer20_mlp_down -->
<g id="edge33" class="edge">
<title>gpu3_layer20_mlp_gate&#45;&gt;gpu3_layer20_mlp_down</title>
<path fill="none" stroke="black" d="M1384,-1864.39C1384,-1847.33 1384,-1828.73 1384,-1813.15"/>
<polygon fill="black" stroke="black" points="1387.5,-1812.91 1384,-1802.91 1380.5,-1812.91 1387.5,-1812.91"/>
</g>
<!-- gpu3_layer20_mlp_up -->
<g id="node27" class="node">
<title>gpu3_layer20_mlp_up</title>
<polygon fill="lightgreen" stroke="black" points="1830,-1942.77 1702,-1942.77 1702,-1890.77 1830,-1890.77 1830,-1942.77"/>
<text text-anchor="middle" x="1766" y="-1930.77" font-family="Arial" font-size="10.00">Layer 20 MLP Up Linear</text>
<text text-anchor="middle" x="1766" y="-1919.77" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1766" y="-1908.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1766" y="-1897.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu3_layer20_mlp_up&#45;&gt;gpu3_layer20_mlp_down -->
<g id="edge35" class="edge">
<title>gpu3_layer20_mlp_up&#45;&gt;gpu3_layer20_mlp_down</title>
<path fill="none" stroke="black" d="M1736.54,-1890.62C1723.89,-1881.08 1708.48,-1871.03 1693,-1864.77 1598.69,-1826.68 1562.39,-1864.08 1467,-1828.77 1453.22,-1823.67 1439.22,-1816.16 1426.76,-1808.45"/>
<polygon fill="black" stroke="black" points="1428.28,-1805.28 1417.97,-1802.84 1424.52,-1811.18 1428.28,-1805.28"/>
</g>
<!-- gpu3_layer20_mlp_down&#45;&gt;stage1_tp_allreduce2 -->
<g id="edge37" class="edge">
<title>gpu3_layer20_mlp_down&#45;&gt;stage1_tp_allreduce2</title>
<path fill="none" stroke="black" d="M1331.78,-1750.63C1292.01,-1731.48 1237,-1705 1194.32,-1684.45"/>
<polygon fill="black" stroke="black" points="1195.66,-1681.21 1185.13,-1680.03 1192.62,-1687.52 1195.66,-1681.21"/>
</g>
<!-- stage1_tp_allreduce1&#45;&gt;gpu2_layer20_mlp_up -->
<g id="edge30" class="edge">
<title>stage1_tp_allreduce1&#45;&gt;gpu2_layer20_mlp_up</title>
<path fill="none" stroke="black" d="M1338.29,-1555.1C1303.09,-1566.22 1263.76,-1584.75 1239,-1615.23 1217.97,-1641.13 1240.81,-1659.96 1224,-1688.77 1172.88,-1776.41 1075.56,-1847.24 1015.29,-1885.28"/>
<polygon fill="black" stroke="black" points="1013.31,-1882.39 1006.67,-1890.65 1017.01,-1888.33 1013.31,-1882.39"/>
</g>
<!-- stage1_tp_allreduce1&#45;&gt;gpu3_layer20_mlp_up -->
<g id="edge31" class="edge">
<title>stage1_tp_allreduce1&#45;&gt;gpu3_layer20_mlp_up</title>
<path fill="none" stroke="black" d="M1489.57,-1557.07C1568.42,-1580.5 1688.03,-1630.25 1737,-1724.77 1762.78,-1774.53 1767.26,-1840.69 1767.26,-1880.65"/>
<polygon fill="black" stroke="black" points="1763.76,-1880.68 1767.17,-1890.71 1770.76,-1880.74 1763.76,-1880.68"/>
</g>
<!-- stage1_output -->
<g id="node33" class="node">
<title>stage1_output</title>
<polygon fill="lightcoral" stroke="black" points="1129,-1579.23 1007,-1538.23 1129,-1497.23 1251,-1538.23 1129,-1579.23"/>
<text text-anchor="middle" x="1129" y="-1546.73" font-family="Arial" font-size="10.00">Stage 1 Output</text>
<text text-anchor="middle" x="1129" y="-1535.73" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1129" y="-1524.73" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- stage1_tp_allreduce2&#45;&gt;stage1_output -->
<g id="edge38" class="edge">
<title>stage1_tp_allreduce2&#45;&gt;stage1_output</title>
<path fill="none" stroke="black" d="M1129,-1615.02C1129,-1606.95 1129,-1598.24 1129,-1589.69"/>
<polygon fill="black" stroke="black" points="1132.5,-1589.41 1129,-1579.41 1125.5,-1589.41 1132.5,-1589.41"/>
</g>
<!-- p2p_recv_0_1 -->
<g id="node32" class="node">
<title>p2p_recv_0_1</title>
<ellipse fill="lightblue" stroke="black" cx="1257" cy="-2044.54" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1257" y="-2058.54" font-family="Arial" font-size="10.00">Pipeline Receive</text>
<text text-anchor="middle" x="1257" y="-2047.54" font-family="Arial" font-size="10.00">Stage0→Stage1</text>
<text text-anchor="middle" x="1257" y="-2036.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1257" y="-2025.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- p2p_send_0_1&#45;&gt;p2p_recv_0_1 -->
<g id="edge21" class="edge">
<title>p2p_send_0_1&#45;&gt;p2p_recv_0_1</title>
<path fill="none" stroke="black" d="M1257,-2117.27C1257,-2109.11 1257,-2100.32 1257,-2091.78"/>
<polygon fill="black" stroke="black" points="1260.5,-2091.56 1257,-2081.56 1253.5,-2091.56 1260.5,-2091.56"/>
</g>
<!-- p2p_recv_0_1&#45;&gt;gpu2_layer20_attn_qkv -->
<g id="edge22" class="edge">
<title>p2p_recv_0_1&#45;&gt;gpu2_layer20_attn_qkv</title>
<path fill="none" stroke="black" d="M1171.03,-2041.1C1005.92,-2035.91 656.22,-2022.4 606,-1999.77 582.46,-1989.17 561.78,-1968.79 546.95,-1951.01"/>
<polygon fill="black" stroke="black" points="549.56,-1948.66 540.56,-1943.06 544.1,-1953.05 549.56,-1948.66"/>
</g>
<!-- p2p_recv_0_1&#45;&gt;gpu3_layer20_attn_qkv -->
<g id="edge23" class="edge">
<title>p2p_recv_0_1&#45;&gt;gpu3_layer20_attn_qkv</title>
<path fill="none" stroke="black" d="M1343.23,-2042.79C1398.16,-2039.19 1469.38,-2028.56 1526,-1999.77 1548.7,-1988.23 1569.13,-1968.24 1584.04,-1950.89"/>
<polygon fill="black" stroke="black" points="1586.78,-1953.07 1590.49,-1943.15 1581.4,-1948.59 1586.78,-1953.07"/>
</g>
<!-- p2p_send_1_2 -->
<g id="node48" class="node">
<title>p2p_send_1_2</title>
<ellipse fill="lightblue" stroke="black" cx="1129" cy="-1413.47" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1129" y="-1427.47" font-family="Arial" font-size="10.00">Pipeline Send</text>
<text text-anchor="middle" x="1129" y="-1416.47" font-family="Arial" font-size="10.00">Stage1→Stage2</text>
<text text-anchor="middle" x="1129" y="-1405.47" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1129" y="-1394.47" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- stage1_output&#45;&gt;p2p_send_1_2 -->
<g id="edge39" class="edge">
<title>stage1_output&#45;&gt;p2p_send_1_2</title>
<path fill="none" stroke="black" d="M1129,-1497.04C1129,-1485.46 1129,-1472.74 1129,-1460.83"/>
<polygon fill="black" stroke="black" points="1132.5,-1460.61 1129,-1450.61 1125.5,-1460.61 1132.5,-1460.61"/>
</g>
<!-- gpu4_layer40_attn_qkv -->
<g id="node34" class="node">
<title>gpu4_layer40_attn_qkv</title>
<polygon fill="lightgreen" stroke="black" points="1075.5,-1202.16 926.5,-1202.16 926.5,-1150.16 1075.5,-1150.16 1075.5,-1202.16"/>
<text text-anchor="middle" x="1001" y="-1190.16" font-family="Arial" font-size="10.00">Layer 40 Attention QKV Linear</text>
<text text-anchor="middle" x="1001" y="-1179.16" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1001" y="-1168.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1001" y="-1157.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 3072]</text>
</g>
<!-- gpu4_layer40_attn_gate -->
<g id="node35" class="node">
<title>gpu4_layer40_attn_gate</title>
<polygon fill="lightyellow" stroke="black" points="1265.47,-1088.16 1064.29,-1088.16 1012.53,-984.16 1213.71,-984.16 1265.47,-1088.16"/>
<text text-anchor="middle" x="1139" y="-1050.16" font-family="Arial" font-size="10.00">Layer 40 Attention Gate</text>
<text text-anchor="middle" x="1139" y="-1039.16" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="1139" y="-1028.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 3072]</text>
<text text-anchor="middle" x="1139" y="-1017.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 1536]</text>
</g>
<!-- gpu4_layer40_attn_qkv&#45;&gt;gpu4_layer40_attn_gate -->
<g id="edge43" class="edge">
<title>gpu4_layer40_attn_qkv&#45;&gt;gpu4_layer40_attn_gate</title>
<path fill="none" stroke="black" d="M1026.31,-1149.85C1041.56,-1134.6 1061.64,-1114.51 1080.63,-1095.53"/>
<polygon fill="black" stroke="black" points="1083.24,-1097.86 1087.84,-1088.32 1078.29,-1092.92 1083.24,-1097.86"/>
</g>
<!-- gpu4_layer40_attn_out -->
<g id="node36" class="node">
<title>gpu4_layer40_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1359.5,-937.39 1202.5,-937.39 1202.5,-885.39 1359.5,-885.39 1359.5,-937.39"/>
<text text-anchor="middle" x="1281" y="-925.39" font-family="Arial" font-size="10.00">Layer 40 Attention Output Linear</text>
<text text-anchor="middle" x="1281" y="-914.39" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1281" y="-903.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 1536]</text>
<text text-anchor="middle" x="1281" y="-892.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu4_layer40_attn_gate&#45;&gt;gpu4_layer40_attn_out -->
<g id="edge44" class="edge">
<title>gpu4_layer40_attn_gate&#45;&gt;gpu4_layer40_attn_out</title>
<path fill="none" stroke="black" d="M1198.4,-983.8C1213.9,-970.4 1230.16,-956.34 1244.11,-944.28"/>
<polygon fill="black" stroke="black" points="1246.76,-946.61 1252.04,-937.43 1242.19,-941.32 1246.76,-946.61"/>
</g>
<!-- stage2_tp_allreduce1 -->
<g id="node46" class="node">
<title>stage2_tp_allreduce1</title>
<ellipse fill="lightblue" stroke="black" cx="1953" cy="-797.62" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1953" y="-811.62" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1953" y="-800.62" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="1953" y="-789.62" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1953" y="-778.62" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu4_layer40_attn_out&#45;&gt;stage2_tp_allreduce1 -->
<g id="edge45" class="edge">
<title>gpu4_layer40_attn_out&#45;&gt;stage2_tp_allreduce1</title>
<path fill="none" stroke="black" d="M1332.38,-885.32C1342.65,-881.15 1353.51,-877.31 1364,-874.62 1525.74,-833.07 1572.64,-861.91 1738,-838.62 1780.36,-832.65 1827.09,-824.19 1866.13,-816.58"/>
<polygon fill="black" stroke="black" points="1867.26,-819.92 1876.4,-814.56 1865.91,-813.05 1867.26,-819.92"/>
</g>
<!-- gpu4_layer40_mlp_gate -->
<g id="node37" class="node">
<title>gpu4_layer40_mlp_gate</title>
<polygon fill="lightyellow" stroke="black" points="1358.91,-1228.16 1147.48,-1228.16 1093.09,-1124.16 1304.52,-1124.16 1358.91,-1228.16"/>
<text text-anchor="middle" x="1226" y="-1190.16" font-family="Arial" font-size="10.00">Layer 40 MLP Gate</text>
<text text-anchor="middle" x="1226" y="-1179.16" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="1226" y="-1168.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1226" y="-1157.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu4_layer40_mlp_down -->
<g id="node39" class="node">
<title>gpu4_layer40_mlp_down</title>
<polygon fill="lightgreen" stroke="black" points="1504.5,-1062.16 1369.5,-1062.16 1369.5,-1010.16 1504.5,-1010.16 1504.5,-1062.16"/>
<text text-anchor="middle" x="1437" y="-1050.16" font-family="Arial" font-size="10.00">Layer 40 MLP Down Linear</text>
<text text-anchor="middle" x="1437" y="-1039.16" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1437" y="-1028.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 28672]</text>
<text text-anchor="middle" x="1437" y="-1017.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu4_layer40_mlp_gate&#45;&gt;gpu4_layer40_mlp_down -->
<g id="edge51" class="edge">
<title>gpu4_layer40_mlp_gate&#45;&gt;gpu4_layer40_mlp_down</title>
<path fill="none" stroke="black" d="M1304.27,-1123.97C1333.12,-1105.1 1364.89,-1084.32 1390.11,-1067.82"/>
<polygon fill="black" stroke="black" points="1392.29,-1070.58 1398.74,-1062.18 1388.46,-1064.72 1392.29,-1070.58"/>
</g>
<!-- gpu4_layer40_mlp_up -->
<g id="node38" class="node">
<title>gpu4_layer40_mlp_up</title>
<polygon fill="lightgreen" stroke="black" points="1505,-1202.16 1377,-1202.16 1377,-1150.16 1505,-1150.16 1505,-1202.16"/>
<text text-anchor="middle" x="1441" y="-1190.16" font-family="Arial" font-size="10.00">Layer 40 MLP Up Linear</text>
<text text-anchor="middle" x="1441" y="-1179.16" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1441" y="-1168.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1441" y="-1157.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu4_layer40_mlp_up&#45;&gt;gpu4_layer40_mlp_down -->
<g id="edge53" class="edge">
<title>gpu4_layer40_mlp_up&#45;&gt;gpu4_layer40_mlp_down</title>
<path fill="none" stroke="black" d="M1440.27,-1149.85C1439.64,-1128.16 1438.73,-1096.68 1438.02,-1072.51"/>
<polygon fill="black" stroke="black" points="1441.52,-1072.2 1437.73,-1062.31 1434.52,-1072.4 1441.52,-1072.2"/>
</g>
<!-- stage2_tp_allreduce2 -->
<g id="node47" class="node">
<title>stage2_tp_allreduce2</title>
<ellipse fill="lightblue" stroke="black" cx="1607" cy="-911.39" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1607" y="-925.39" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1607" y="-914.39" font-family="Arial" font-size="10.00">MLP Output</text>
<text text-anchor="middle" x="1607" y="-903.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1607" y="-892.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu4_layer40_mlp_down&#45;&gt;stage2_tp_allreduce2 -->
<g id="edge55" class="edge">
<title>gpu4_layer40_mlp_down&#45;&gt;stage2_tp_allreduce2</title>
<path fill="none" stroke="black" d="M1471.81,-1010.02C1496.02,-992.53 1528.69,-968.94 1555.85,-949.32"/>
<polygon fill="black" stroke="black" points="1558.03,-952.07 1564.09,-943.38 1553.93,-946.39 1558.03,-952.07"/>
</g>
<!-- gpu5_layer40_attn_qkv -->
<g id="node40" class="node">
<title>gpu5_layer40_attn_qkv</title>
<polygon fill="lightgreen" stroke="black" points="2161.5,-1202.16 2012.5,-1202.16 2012.5,-1150.16 2161.5,-1150.16 2161.5,-1202.16"/>
<text text-anchor="middle" x="2087" y="-1190.16" font-family="Arial" font-size="10.00">Layer 40 Attention QKV Linear</text>
<text text-anchor="middle" x="2087" y="-1179.16" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="2087" y="-1168.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="2087" y="-1157.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 3072]</text>
</g>
<!-- gpu5_layer40_attn_gate -->
<g id="node41" class="node">
<title>gpu5_layer40_attn_gate</title>
<polygon fill="lightyellow" stroke="black" points="2206.47,-1088.16 2005.29,-1088.16 1953.53,-984.16 2154.71,-984.16 2206.47,-1088.16"/>
<text text-anchor="middle" x="2080" y="-1050.16" font-family="Arial" font-size="10.00">Layer 40 Attention Gate</text>
<text text-anchor="middle" x="2080" y="-1039.16" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="2080" y="-1028.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 3072]</text>
<text text-anchor="middle" x="2080" y="-1017.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 1536]</text>
</g>
<!-- gpu5_layer40_attn_qkv&#45;&gt;gpu5_layer40_attn_gate -->
<g id="edge46" class="edge">
<title>gpu5_layer40_attn_qkv&#45;&gt;gpu5_layer40_attn_gate</title>
<path fill="none" stroke="black" d="M2085.72,-1149.85C2084.98,-1135.4 2084.03,-1116.62 2083.11,-1098.55"/>
<polygon fill="black" stroke="black" points="2086.6,-1098.13 2082.6,-1088.32 2079.61,-1098.48 2086.6,-1098.13"/>
</g>
<!-- gpu5_layer40_attn_out -->
<g id="node42" class="node">
<title>gpu5_layer40_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="2098.5,-937.39 1941.5,-937.39 1941.5,-885.39 2098.5,-885.39 2098.5,-937.39"/>
<text text-anchor="middle" x="2020" y="-925.39" font-family="Arial" font-size="10.00">Layer 40 Attention Output Linear</text>
<text text-anchor="middle" x="2020" y="-914.39" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="2020" y="-903.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 1536]</text>
<text text-anchor="middle" x="2020" y="-892.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu5_layer40_attn_gate&#45;&gt;gpu5_layer40_attn_out -->
<g id="edge47" class="edge">
<title>gpu5_layer40_attn_gate&#45;&gt;gpu5_layer40_attn_out</title>
<path fill="none" stroke="black" d="M2054.9,-983.8C2048.78,-971.28 2042.38,-958.18 2036.76,-946.67"/>
<polygon fill="black" stroke="black" points="2039.77,-944.87 2032.24,-937.43 2033.48,-947.95 2039.77,-944.87"/>
</g>
<!-- gpu5_layer40_attn_out&#45;&gt;stage2_tp_allreduce1 -->
<g id="edge48" class="edge">
<title>gpu5_layer40_attn_out&#45;&gt;stage2_tp_allreduce1</title>
<path fill="none" stroke="black" d="M2004.96,-885.3C1997.36,-872.62 1987.91,-856.85 1979.16,-842.26"/>
<polygon fill="black" stroke="black" points="1981.97,-840.14 1973.83,-833.36 1975.97,-843.74 1981.97,-840.14"/>
</g>
<!-- gpu5_layer40_mlp_gate -->
<g id="node43" class="node">
<title>gpu5_layer40_mlp_gate</title>
<polygon fill="lightyellow" stroke="black" points="1994.91,-1228.16 1783.48,-1228.16 1729.09,-1124.16 1940.52,-1124.16 1994.91,-1228.16"/>
<text text-anchor="middle" x="1862" y="-1190.16" font-family="Arial" font-size="10.00">Layer 40 MLP Gate</text>
<text text-anchor="middle" x="1862" y="-1179.16" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="1862" y="-1168.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1862" y="-1157.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu5_layer40_mlp_down -->
<g id="node45" class="node">
<title>gpu5_layer40_mlp_down</title>
<polygon fill="lightgreen" stroke="black" points="1929.5,-1062.16 1794.5,-1062.16 1794.5,-1010.16 1929.5,-1010.16 1929.5,-1062.16"/>
<text text-anchor="middle" x="1862" y="-1050.16" font-family="Arial" font-size="10.00">Layer 40 MLP Down Linear</text>
<text text-anchor="middle" x="1862" y="-1039.16" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1862" y="-1028.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 28672]</text>
<text text-anchor="middle" x="1862" y="-1017.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu5_layer40_mlp_gate&#45;&gt;gpu5_layer40_mlp_down -->
<g id="edge52" class="edge">
<title>gpu5_layer40_mlp_gate&#45;&gt;gpu5_layer40_mlp_down</title>
<path fill="none" stroke="black" d="M1862,-1123.77C1862,-1106.71 1862,-1088.11 1862,-1072.54"/>
<polygon fill="black" stroke="black" points="1865.5,-1072.29 1862,-1062.29 1858.5,-1072.29 1865.5,-1072.29"/>
</g>
<!-- gpu5_layer40_mlp_up -->
<g id="node44" class="node">
<title>gpu5_layer40_mlp_up</title>
<polygon fill="lightgreen" stroke="black" points="2308,-1202.16 2180,-1202.16 2180,-1150.16 2308,-1150.16 2308,-1202.16"/>
<text text-anchor="middle" x="2244" y="-1190.16" font-family="Arial" font-size="10.00">Layer 40 MLP Up Linear</text>
<text text-anchor="middle" x="2244" y="-1179.16" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="2244" y="-1168.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="2244" y="-1157.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu5_layer40_mlp_up&#45;&gt;gpu5_layer40_mlp_down -->
<g id="edge54" class="edge">
<title>gpu5_layer40_mlp_up&#45;&gt;gpu5_layer40_mlp_down</title>
<path fill="none" stroke="black" d="M2214.54,-1150C2201.89,-1140.46 2186.48,-1130.41 2171,-1124.16 2076.69,-1086.06 2040.39,-1123.46 1945,-1088.16 1931.22,-1083.05 1917.22,-1075.54 1904.76,-1067.84"/>
<polygon fill="black" stroke="black" points="1906.28,-1064.66 1895.97,-1062.23 1902.52,-1070.56 1906.28,-1064.66"/>
</g>
<!-- gpu5_layer40_mlp_down&#45;&gt;stage2_tp_allreduce2 -->
<g id="edge56" class="edge">
<title>gpu5_layer40_mlp_down&#45;&gt;stage2_tp_allreduce2</title>
<path fill="none" stroke="black" d="M1809.78,-1010.02C1770.01,-990.87 1715,-964.39 1672.32,-943.83"/>
<polygon fill="black" stroke="black" points="1673.66,-940.59 1663.13,-939.41 1670.62,-946.9 1673.66,-940.59"/>
</g>
<!-- stage2_tp_allreduce1&#45;&gt;gpu4_layer40_mlp_up -->
<g id="edge49" class="edge">
<title>stage2_tp_allreduce1&#45;&gt;gpu4_layer40_mlp_up</title>
<path fill="none" stroke="black" d="M1868.36,-804.85C1817.4,-813.12 1755.19,-831.97 1717,-874.62 1694.75,-899.47 1718.81,-919.34 1702,-948.16 1650.88,-1035.79 1553.56,-1106.62 1493.29,-1144.66"/>
<polygon fill="black" stroke="black" points="1491.31,-1141.77 1484.67,-1150.03 1495.01,-1147.71 1491.31,-1141.77"/>
</g>
<!-- stage2_tp_allreduce1&#45;&gt;gpu5_layer40_mlp_up -->
<g id="edge50" class="edge">
<title>stage2_tp_allreduce1&#45;&gt;gpu5_layer40_mlp_up</title>
<path fill="none" stroke="black" d="M2016.75,-822.6C2080.51,-850.5 2174.74,-903.34 2215,-984.16 2239.92,-1034.17 2244.68,-1099.99 2244.98,-1139.85"/>
<polygon fill="black" stroke="black" points="2241.48,-1139.88 2244.96,-1149.89 2248.48,-1139.89 2241.48,-1139.88"/>
</g>
<!-- stage2_output -->
<g id="node50" class="node">
<title>stage2_output</title>
<polygon fill="lightcoral" stroke="black" points="1607,-838.62 1485,-797.62 1607,-756.62 1729,-797.62 1607,-838.62"/>
<text text-anchor="middle" x="1607" y="-806.12" font-family="Arial" font-size="10.00">Stage 2 Output</text>
<text text-anchor="middle" x="1607" y="-795.12" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1607" y="-784.12" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- stage2_tp_allreduce2&#45;&gt;stage2_output -->
<g id="edge57" class="edge">
<title>stage2_tp_allreduce2&#45;&gt;stage2_output</title>
<path fill="none" stroke="black" d="M1607,-874.41C1607,-866.33 1607,-857.62 1607,-849.07"/>
<polygon fill="black" stroke="black" points="1610.5,-848.79 1607,-838.79 1603.5,-848.79 1610.5,-848.79"/>
</g>
<!-- p2p_recv_1_2 -->
<g id="node49" class="node">
<title>p2p_recv_1_2</title>
<ellipse fill="lightblue" stroke="black" cx="1129" cy="-1303.93" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1129" y="-1317.93" font-family="Arial" font-size="10.00">Pipeline Receive</text>
<text text-anchor="middle" x="1129" y="-1306.93" font-family="Arial" font-size="10.00">Stage1→Stage2</text>
<text text-anchor="middle" x="1129" y="-1295.93" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1129" y="-1284.93" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- p2p_send_1_2&#45;&gt;p2p_recv_1_2 -->
<g id="edge40" class="edge">
<title>p2p_send_1_2&#45;&gt;p2p_recv_1_2</title>
<path fill="none" stroke="black" d="M1129,-1376.66C1129,-1368.49 1129,-1359.7 1129,-1351.17"/>
<polygon fill="black" stroke="black" points="1132.5,-1350.95 1129,-1340.95 1125.5,-1350.95 1132.5,-1350.95"/>
</g>
<!-- p2p_recv_1_2&#45;&gt;gpu4_layer40_attn_qkv -->
<g id="edge41" class="edge">
<title>p2p_recv_1_2&#45;&gt;gpu4_layer40_attn_qkv</title>
<path fill="none" stroke="black" d="M1095.06,-1269.97C1091.33,-1266.33 1087.58,-1262.67 1084,-1259.16 1067.34,-1242.83 1048.88,-1224.6 1033.6,-1209.48"/>
<polygon fill="black" stroke="black" points="1035.95,-1206.88 1026.38,-1202.33 1031.02,-1211.85 1035.95,-1206.88"/>
</g>
<!-- p2p_recv_1_2&#45;&gt;gpu5_layer40_attn_qkv -->
<g id="edge42" class="edge">
<title>p2p_recv_1_2&#45;&gt;gpu5_layer40_attn_qkv</title>
<path fill="none" stroke="black" d="M1215.37,-1302.09C1422.04,-1299.6 1933.18,-1290.33 2004,-1259.16 2027.79,-1248.68 2048.59,-1228.1 2063.42,-1210.18"/>
<polygon fill="black" stroke="black" points="2066.3,-1212.18 2069.8,-1202.18 2060.83,-1207.81 2066.3,-1212.18"/>
</g>
<!-- p2p_send_2_3 -->
<g id="node67" class="node">
<title>p2p_send_2_3</title>
<ellipse fill="lightblue" stroke="black" cx="1607" cy="-672.85" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1607" y="-686.85" font-family="Arial" font-size="10.00">Pipeline Send</text>
<text text-anchor="middle" x="1607" y="-675.85" font-family="Arial" font-size="10.00">Stage2→Stage3</text>
<text text-anchor="middle" x="1607" y="-664.85" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1607" y="-653.85" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- stage2_output&#45;&gt;p2p_send_2_3 -->
<g id="edge58" class="edge">
<title>stage2_output&#45;&gt;p2p_send_2_3</title>
<path fill="none" stroke="black" d="M1607,-756.42C1607,-744.84 1607,-732.12 1607,-720.21"/>
<polygon fill="black" stroke="black" points="1610.5,-719.99 1607,-709.99 1603.5,-719.99 1610.5,-719.99"/>
</g>
<!-- gpu6_layer60_attn_qkv -->
<g id="node51" class="node">
<title>gpu6_layer60_attn_qkv</title>
<polygon fill="lightgreen" stroke="black" points="530.5,-461.54 381.5,-461.54 381.5,-409.54 530.5,-409.54 530.5,-461.54"/>
<text text-anchor="middle" x="456" y="-449.54" font-family="Arial" font-size="10.00">Layer 60 Attention QKV Linear</text>
<text text-anchor="middle" x="456" y="-438.54" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="456" y="-427.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="456" y="-416.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 3072]</text>
</g>
<!-- gpu6_layer60_attn_gate -->
<g id="node52" class="node">
<title>gpu6_layer60_attn_gate</title>
<polygon fill="lightyellow" stroke="black" points="589.47,-347.54 388.29,-347.54 336.53,-243.54 537.71,-243.54 589.47,-347.54"/>
<text text-anchor="middle" x="463" y="-309.54" font-family="Arial" font-size="10.00">Layer 60 Attention Gate</text>
<text text-anchor="middle" x="463" y="-298.54" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="463" y="-287.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 3072]</text>
<text text-anchor="middle" x="463" y="-276.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 1536]</text>
</g>
<!-- gpu6_layer60_attn_qkv&#45;&gt;gpu6_layer60_attn_gate -->
<g id="edge62" class="edge">
<title>gpu6_layer60_attn_qkv&#45;&gt;gpu6_layer60_attn_gate</title>
<path fill="none" stroke="black" d="M457.28,-409.23C458.02,-394.79 458.97,-376.01 459.89,-357.93"/>
<polygon fill="black" stroke="black" points="463.39,-357.87 460.4,-347.7 456.4,-357.51 463.39,-357.87"/>
</g>
<!-- gpu6_layer60_attn_out -->
<g id="node53" class="node">
<title>gpu6_layer60_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="751.5,-192.54 594.5,-192.54 594.5,-140.54 751.5,-140.54 751.5,-192.54"/>
<text text-anchor="middle" x="673" y="-180.54" font-family="Arial" font-size="10.00">Layer 60 Attention Output Linear</text>
<text text-anchor="middle" x="673" y="-169.54" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="673" y="-158.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 1536]</text>
<text text-anchor="middle" x="673" y="-147.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu6_layer60_attn_gate&#45;&gt;gpu6_layer60_attn_out -->
<g id="edge63" class="edge">
<title>gpu6_layer60_attn_gate&#45;&gt;gpu6_layer60_attn_out</title>
<path fill="none" stroke="black" d="M540,-247.97C567.53,-231.33 597.82,-213.01 622.53,-198.06"/>
<polygon fill="black" stroke="black" points="624.62,-200.89 631.37,-192.72 621,-194.9 624.62,-200.89"/>
</g>
<!-- stage3_tp_allreduce1 -->
<g id="node65" class="node">
<title>stage3_tp_allreduce1</title>
<ellipse fill="lightblue" stroke="black" cx="1315" cy="-52.77" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1315" y="-66.77" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1315" y="-55.77" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="1315" y="-44.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1315" y="-33.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu6_layer60_attn_out&#45;&gt;stage3_tp_allreduce1 -->
<g id="edge64" class="edge">
<title>gpu6_layer60_attn_out&#45;&gt;stage3_tp_allreduce1</title>
<path fill="none" stroke="black" d="M718.48,-140.39C730.39,-134.71 743.43,-129.27 756,-125.54 913.98,-78.67 1106.04,-62.41 1218.96,-56.77"/>
<polygon fill="black" stroke="black" points="1219.14,-60.26 1228.96,-56.28 1218.8,-53.27 1219.14,-60.26"/>
</g>
<!-- gpu6_layer60_mlp_gate -->
<g id="node54" class="node">
<title>gpu6_layer60_mlp_gate</title>
<polygon fill="lightyellow" stroke="black" points="813.91,-487.54 602.48,-487.54 548.09,-383.54 759.52,-383.54 813.91,-487.54"/>
<text text-anchor="middle" x="681" y="-449.54" font-family="Arial" font-size="10.00">Layer 60 MLP Gate</text>
<text text-anchor="middle" x="681" y="-438.54" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="681" y="-427.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="681" y="-416.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu6_layer60_mlp_down -->
<g id="node56" class="node">
<title>gpu6_layer60_mlp_down</title>
<polygon fill="lightgreen" stroke="black" points="748.5,-321.54 613.5,-321.54 613.5,-269.54 748.5,-269.54 748.5,-321.54"/>
<text text-anchor="middle" x="681" y="-309.54" font-family="Arial" font-size="10.00">Layer 60 MLP Down Linear</text>
<text text-anchor="middle" x="681" y="-298.54" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="681" y="-287.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 28672]</text>
<text text-anchor="middle" x="681" y="-276.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu6_layer60_mlp_gate&#45;&gt;gpu6_layer60_mlp_down -->
<g id="edge70" class="edge">
<title>gpu6_layer60_mlp_gate&#45;&gt;gpu6_layer60_mlp_down</title>
<path fill="none" stroke="black" d="M681,-383.15C681,-366.09 681,-347.49 681,-331.92"/>
<polygon fill="black" stroke="black" points="684.5,-331.67 681,-321.67 677.5,-331.67 684.5,-331.67"/>
</g>
<!-- gpu6_layer60_mlp_up -->
<g id="node55" class="node">
<title>gpu6_layer60_mlp_up</title>
<polygon fill="lightgreen" stroke="black" points="363,-461.54 235,-461.54 235,-409.54 363,-409.54 363,-461.54"/>
<text text-anchor="middle" x="299" y="-449.54" font-family="Arial" font-size="10.00">Layer 60 MLP Up Linear</text>
<text text-anchor="middle" x="299" y="-438.54" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="299" y="-427.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="299" y="-416.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu6_layer60_mlp_up&#45;&gt;gpu6_layer60_mlp_down -->
<g id="edge72" class="edge">
<title>gpu6_layer60_mlp_up&#45;&gt;gpu6_layer60_mlp_down</title>
<path fill="none" stroke="black" d="M328.92,-409.39C341.74,-399.86 357.36,-389.81 373,-383.54 467.01,-345.88 503.04,-382.72 598,-347.54 611.78,-342.43 625.77,-334.92 638.24,-327.21"/>
<polygon fill="black" stroke="black" points="640.48,-329.94 647.03,-321.6 636.71,-324.04 640.48,-329.94"/>
</g>
<!-- stage3_tp_allreduce2 -->
<g id="node66" class="node">
<title>stage3_tp_allreduce2</title>
<ellipse fill="lightblue" stroke="black" cx="1351" cy="-166.54" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1351" y="-180.54" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1351" y="-169.54" font-family="Arial" font-size="10.00">MLP Output</text>
<text text-anchor="middle" x="1351" y="-158.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1351" y="-147.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu6_layer60_mlp_down&#45;&gt;stage3_tp_allreduce2 -->
<g id="edge74" class="edge">
<title>gpu6_layer60_mlp_down&#45;&gt;stage3_tp_allreduce2</title>
<path fill="none" stroke="black" d="M708.72,-269.51C721.33,-259.62 736.99,-249.27 753,-243.54 964.01,-167.98 1038.03,-259.72 1256,-207.54 1265.72,-205.21 1275.73,-201.99 1285.43,-198.39"/>
<polygon fill="black" stroke="black" points="1286.95,-201.55 1295.01,-194.67 1284.42,-195.02 1286.95,-201.55"/>
</g>
<!-- gpu6_lm_head -->
<g id="node57" class="node">
<title>gpu6_lm_head</title>
<polygon fill="lightgreen" stroke="black" points="964.5,-461.54 831.5,-461.54 831.5,-409.54 964.5,-409.54 964.5,-461.54"/>
<text text-anchor="middle" x="898" y="-449.54" font-family="Arial" font-size="10.00">LM Head</text>
<text text-anchor="middle" x="898" y="-438.54" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="898" y="-427.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="898" y="-416.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 128256]</text>
</g>
<!-- final_allreduce -->
<g id="node69" class="node">
<title>final_allreduce</title>
<ellipse fill="lightblue" stroke="black" cx="1114" cy="-295.54" rx="94.09" ry="36.54"/>
<text text-anchor="middle" x="1114" y="-309.54" font-family="Arial" font-size="10.00">Final All&#45;Reduce</text>
<text text-anchor="middle" x="1114" y="-298.54" font-family="Arial" font-size="10.00">LM Head Output</text>
<text text-anchor="middle" x="1114" y="-287.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 128256]</text>
<text text-anchor="middle" x="1114" y="-276.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 128256]</text>
</g>
<!-- gpu6_lm_head&#45;&gt;final_allreduce -->
<g id="edge78" class="edge">
<title>gpu6_lm_head&#45;&gt;final_allreduce</title>
<path fill="none" stroke="black" d="M937.62,-409.23C971.11,-387.83 1019.49,-356.92 1057.12,-332.88"/>
<polygon fill="black" stroke="black" points="1059.41,-335.57 1065.95,-327.24 1055.64,-329.67 1059.41,-335.57"/>
</g>
<!-- gpu7_layer60_attn_qkv -->
<g id="node58" class="node">
<title>gpu7_layer60_attn_qkv</title>
<polygon fill="lightgreen" stroke="black" points="2036.5,-461.54 1887.5,-461.54 1887.5,-409.54 2036.5,-409.54 2036.5,-461.54"/>
<text text-anchor="middle" x="1962" y="-449.54" font-family="Arial" font-size="10.00">Layer 60 Attention QKV Linear</text>
<text text-anchor="middle" x="1962" y="-438.54" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1962" y="-427.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1962" y="-416.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 3072]</text>
</g>
<!-- gpu7_layer60_attn_gate -->
<g id="node59" class="node">
<title>gpu7_layer60_attn_gate</title>
<polygon fill="lightyellow" stroke="black" points="2081.47,-347.54 1880.29,-347.54 1828.53,-243.54 2029.71,-243.54 2081.47,-347.54"/>
<text text-anchor="middle" x="1955" y="-309.54" font-family="Arial" font-size="10.00">Layer 60 Attention Gate</text>
<text text-anchor="middle" x="1955" y="-298.54" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="1955" y="-287.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 3072]</text>
<text text-anchor="middle" x="1955" y="-276.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 1536]</text>
</g>
<!-- gpu7_layer60_attn_qkv&#45;&gt;gpu7_layer60_attn_gate -->
<g id="edge65" class="edge">
<title>gpu7_layer60_attn_qkv&#45;&gt;gpu7_layer60_attn_gate</title>
<path fill="none" stroke="black" d="M1960.72,-409.23C1959.98,-394.79 1959.03,-376.01 1958.11,-357.93"/>
<polygon fill="black" stroke="black" points="1961.6,-357.51 1957.6,-347.7 1954.61,-357.87 1961.6,-357.51"/>
</g>
<!-- gpu7_layer60_attn_out -->
<g id="node60" class="node">
<title>gpu7_layer60_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1826.5,-192.54 1669.5,-192.54 1669.5,-140.54 1826.5,-140.54 1826.5,-192.54"/>
<text text-anchor="middle" x="1748" y="-180.54" font-family="Arial" font-size="10.00">Layer 60 Attention Output Linear</text>
<text text-anchor="middle" x="1748" y="-169.54" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1748" y="-158.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 1536]</text>
<text text-anchor="middle" x="1748" y="-147.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu7_layer60_attn_gate&#45;&gt;gpu7_layer60_attn_out -->
<g id="edge66" class="edge">
<title>gpu7_layer60_attn_gate&#45;&gt;gpu7_layer60_attn_out</title>
<path fill="none" stroke="black" d="M1871.7,-243.43C1846.51,-227.98 1819.66,-211.5 1797.43,-197.87"/>
<polygon fill="black" stroke="black" points="1799.19,-194.84 1788.84,-192.59 1795.53,-200.81 1799.19,-194.84"/>
</g>
<!-- gpu7_layer60_attn_out&#45;&gt;stage3_tp_allreduce1 -->
<g id="edge67" class="edge">
<title>gpu7_layer60_attn_out&#45;&gt;stage3_tp_allreduce1</title>
<path fill="none" stroke="black" d="M1701.6,-140.39C1690.19,-134.92 1677.85,-129.57 1666,-125.54 1580.37,-96.42 1478.77,-77.23 1406.97,-66.08"/>
<polygon fill="black" stroke="black" points="1407.46,-62.61 1397.05,-64.56 1406.4,-69.53 1407.46,-62.61"/>
</g>
<!-- gpu7_layer60_mlp_gate -->
<g id="node61" class="node">
<title>gpu7_layer60_mlp_gate</title>
<polygon fill="lightyellow" stroke="black" points="1869.91,-487.54 1658.48,-487.54 1604.09,-383.54 1815.52,-383.54 1869.91,-487.54"/>
<text text-anchor="middle" x="1737" y="-449.54" font-family="Arial" font-size="10.00">Layer 60 MLP Gate</text>
<text text-anchor="middle" x="1737" y="-438.54" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="1737" y="-427.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1737" y="-416.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu7_layer60_mlp_down -->
<g id="node63" class="node">
<title>gpu7_layer60_mlp_down</title>
<polygon fill="lightgreen" stroke="black" points="1804.5,-321.54 1669.5,-321.54 1669.5,-269.54 1804.5,-269.54 1804.5,-321.54"/>
<text text-anchor="middle" x="1737" y="-309.54" font-family="Arial" font-size="10.00">Layer 60 MLP Down Linear</text>
<text text-anchor="middle" x="1737" y="-298.54" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1737" y="-287.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 28672]</text>
<text text-anchor="middle" x="1737" y="-276.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu7_layer60_mlp_gate&#45;&gt;gpu7_layer60_mlp_down -->
<g id="edge71" class="edge">
<title>gpu7_layer60_mlp_gate&#45;&gt;gpu7_layer60_mlp_down</title>
<path fill="none" stroke="black" d="M1737,-383.15C1737,-366.09 1737,-347.49 1737,-331.92"/>
<polygon fill="black" stroke="black" points="1740.5,-331.67 1737,-321.67 1733.5,-331.67 1740.5,-331.67"/>
</g>
<!-- gpu7_layer60_mlp_up -->
<g id="node62" class="node">
<title>gpu7_layer60_mlp_up</title>
<polygon fill="lightgreen" stroke="black" points="2183,-461.54 2055,-461.54 2055,-409.54 2183,-409.54 2183,-461.54"/>
<text text-anchor="middle" x="2119" y="-449.54" font-family="Arial" font-size="10.00">Layer 60 MLP Up Linear</text>
<text text-anchor="middle" x="2119" y="-438.54" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="2119" y="-427.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="2119" y="-416.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu7_layer60_mlp_up&#45;&gt;gpu7_layer60_mlp_down -->
<g id="edge73" class="edge">
<title>gpu7_layer60_mlp_up&#45;&gt;gpu7_layer60_mlp_down</title>
<path fill="none" stroke="black" d="M2089.54,-409.38C2076.89,-399.85 2061.48,-389.79 2046,-383.54 1951.69,-345.45 1915.39,-382.84 1820,-347.54 1806.22,-342.44 1792.22,-334.92 1779.76,-327.22"/>
<polygon fill="black" stroke="black" points="1781.28,-324.04 1770.97,-321.61 1777.52,-329.94 1781.28,-324.04"/>
</g>
<!-- gpu7_layer60_mlp_down&#45;&gt;stage3_tp_allreduce2 -->
<g id="edge75" class="edge">
<title>gpu7_layer60_mlp_down&#45;&gt;stage3_tp_allreduce2</title>
<path fill="none" stroke="black" d="M1708.44,-269.37C1696.16,-259.84 1681.16,-249.78 1666,-243.54 1572.36,-204.96 1538.09,-236.35 1441,-207.54 1432.66,-205.07 1424.09,-202 1415.69,-198.66"/>
<polygon fill="black" stroke="black" points="1416.9,-195.38 1406.32,-194.81 1414.24,-201.85 1416.9,-195.38"/>
</g>
<!-- gpu7_lm_head -->
<g id="node64" class="node">
<title>gpu7_lm_head</title>
<polygon fill="lightgreen" stroke="black" points="1586.5,-461.54 1453.5,-461.54 1453.5,-409.54 1586.5,-409.54 1586.5,-461.54"/>
<text text-anchor="middle" x="1520" y="-449.54" font-family="Arial" font-size="10.00">LM Head</text>
<text text-anchor="middle" x="1520" y="-438.54" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1520" y="-427.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1520" y="-416.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 128256]</text>
</g>
<!-- gpu7_lm_head&#45;&gt;final_allreduce -->
<g id="edge79" class="edge">
<title>gpu7_lm_head&#45;&gt;final_allreduce</title>
<path fill="none" stroke="black" d="M1453.41,-411.91C1382.22,-387.71 1269.36,-349.35 1193.55,-323.58"/>
<polygon fill="black" stroke="black" points="1194.62,-320.25 1184.03,-320.34 1192.37,-326.87 1194.62,-320.25"/>
</g>
<!-- stage3_tp_allreduce1&#45;&gt;gpu6_layer60_mlp_up -->
<g id="edge68" class="edge">
<title>stage3_tp_allreduce1&#45;&gt;gpu6_layer60_mlp_up</title>
<path fill="none" stroke="black" d="M1228.62,-53.14C1090.44,-54.15 812.23,-64.5 586,-125.54 464.26,-158.39 403.93,-142.88 328,-243.54 293.81,-288.86 292.16,-357.75 294.96,-399.23"/>
<polygon fill="black" stroke="black" points="291.49,-399.72 295.77,-409.4 298.46,-399.16 291.49,-399.72"/>
</g>
<!-- stage3_tp_allreduce1&#45;&gt;gpu7_layer60_mlp_up -->
<g id="edge69" class="edge">
<title>stage3_tp_allreduce1&#45;&gt;gpu7_layer60_mlp_up</title>
<path fill="none" stroke="black" d="M1400.55,-57.75C1505.13,-64.38 1686.64,-81.64 1836,-125.54 1955.42,-160.64 2015.34,-143.94 2090,-243.54 2124.05,-288.96 2125.75,-357.82 2123,-399.26"/>
<polygon fill="black" stroke="black" points="2119.49,-399.19 2122.19,-409.43 2126.47,-399.74 2119.49,-399.19"/>
</g>
<!-- stage3_tp_allreduce2&#45;&gt;gpu6_lm_head -->
<g id="edge76" class="edge">
<title>stage3_tp_allreduce2&#45;&gt;gpu6_lm_head</title>
<path fill="none" stroke="black" d="M1333.94,-202.92C1312.37,-243.88 1271.39,-310.44 1217,-347.54 1144.04,-397.3 1043.56,-418.67 974.99,-427.81"/>
<polygon fill="black" stroke="black" points="974.16,-424.38 964.69,-429.12 975.05,-431.33 974.16,-424.38"/>
</g>
<!-- stage3_tp_allreduce2&#45;&gt;gpu7_lm_head -->
<g id="edge77" class="edge">
<title>stage3_tp_allreduce2&#45;&gt;gpu7_lm_head</title>
<path fill="none" stroke="black" d="M1373.06,-202.39C1405.68,-253.93 1466.39,-349.84 1498.62,-400.76"/>
<polygon fill="black" stroke="black" points="1495.8,-402.84 1504.1,-409.42 1501.71,-399.1 1495.8,-402.84"/>
</g>
<!-- p2p_recv_2_3 -->
<g id="node68" class="node">
<title>p2p_recv_2_3</title>
<ellipse fill="lightblue" stroke="black" cx="1607" cy="-563.31" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1607" y="-577.31" font-family="Arial" font-size="10.00">Pipeline Receive</text>
<text text-anchor="middle" x="1607" y="-566.31" font-family="Arial" font-size="10.00">Stage2→Stage3</text>
<text text-anchor="middle" x="1607" y="-555.31" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1607" y="-544.31" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- p2p_send_2_3&#45;&gt;p2p_recv_2_3 -->
<g id="edge59" class="edge">
<title>p2p_send_2_3&#45;&gt;p2p_recv_2_3</title>
<path fill="none" stroke="black" d="M1607,-636.04C1607,-627.87 1607,-619.08 1607,-610.55"/>
<polygon fill="black" stroke="black" points="1610.5,-610.33 1607,-600.33 1603.5,-610.33 1610.5,-610.33"/>
</g>
<!-- p2p_recv_2_3&#45;&gt;gpu6_layer60_attn_qkv -->
<g id="edge60" class="edge">
<title>p2p_recv_2_3&#45;&gt;gpu6_layer60_attn_qkv</title>
<path fill="none" stroke="black" d="M1520.36,-562.33C1281.93,-561.9 627.81,-557.16 539,-518.54 515.16,-508.17 494.36,-487.59 479.55,-469.64"/>
<polygon fill="black" stroke="black" points="482.14,-467.27 473.17,-461.63 476.66,-471.63 482.14,-467.27"/>
</g>
<!-- p2p_recv_2_3&#45;&gt;gpu7_layer60_attn_qkv -->
<g id="edge61" class="edge">
<title>p2p_recv_2_3&#45;&gt;gpu7_layer60_attn_qkv</title>
<path fill="none" stroke="black" d="M1690.82,-554.47C1758.24,-547.13 1846.85,-534.85 1879,-518.54 1901.71,-507.02 1922.14,-487.03 1937.04,-469.67"/>
<polygon fill="black" stroke="black" points="1939.79,-471.85 1943.49,-461.93 1934.41,-467.37 1939.79,-471.85"/>
</g>
<!-- output -->
<g id="node70" class="node">
<title>output</title>
<polygon fill="lightpink" stroke="black" points="1114,-207.54 981,-166.54 1114,-125.54 1247,-166.54 1114,-207.54"/>
<text text-anchor="middle" x="1114" y="-175.04" font-family="Arial" font-size="10.00">Final Output</text>
<text text-anchor="middle" x="1114" y="-164.04" font-family="Arial" font-size="10.00">Input: [64, 8192, 128256]</text>
<text text-anchor="middle" x="1114" y="-153.04" font-family="Arial" font-size="10.00">Output: [64, 8192, 128256]</text>
</g>
<!-- final_allreduce&#45;&gt;output -->
<g id="edge80" class="edge">
<title>final_allreduce&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1114,-258.49C1114,-245.86 1114,-231.45 1114,-217.87"/>
<polygon fill="black" stroke="black" points="1117.5,-217.7 1114,-207.7 1110.5,-217.7 1117.5,-217.7"/>
</g>
</g>
</svg>
