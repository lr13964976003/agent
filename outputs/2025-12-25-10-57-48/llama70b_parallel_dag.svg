<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1440pt" height="1801pt"
 viewBox="0.00 0.00 1440.00 1801.39" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.73 0.73) rotate(0) translate(4 2469.16)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2469.16 1973,-2469.16 1973,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage0</title>
<path fill="lightgray" stroke="black" d="M566,-1829.85C566,-1829.85 1949,-1829.85 1949,-1829.85 1955,-1829.85 1961,-1835.85 1961,-1841.85 1961,-1841.85 1961,-2445.16 1961,-2445.16 1961,-2451.16 1955,-2457.16 1949,-2457.16 1949,-2457.16 566,-2457.16 566,-2457.16 560,-2457.16 554,-2451.16 554,-2445.16 554,-2445.16 554,-1841.85 554,-1841.85 554,-1835.85 560,-1829.85 566,-1829.85"/>
<text text-anchor="middle" x="1257.5" y="-2441.96" font-family="Times,serif" font-size="14.00">Stage 0: GPUs 0,1 (Layers 0&#45;19)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_gpu0</title>
<path fill="none" stroke="black" d="M1363,-1958.62C1363,-1958.62 1929,-1958.62 1929,-1958.62 1935,-1958.62 1941,-1964.62 1941,-1970.62 1941,-1970.62 1941,-2328.39 1941,-2328.39 1941,-2334.39 1935,-2340.39 1929,-2340.39 1929,-2340.39 1363,-2340.39 1363,-2340.39 1357,-2340.39 1351,-2334.39 1351,-2328.39 1351,-2328.39 1351,-1970.62 1351,-1970.62 1351,-1964.62 1357,-1958.62 1363,-1958.62"/>
<text text-anchor="middle" x="1646" y="-2325.19" font-family="Times,serif" font-size="14.00">GPU 0</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_gpu1</title>
<path fill="none" stroke="black" d="M586,-1958.62C586,-1958.62 1151,-1958.62 1151,-1958.62 1157,-1958.62 1163,-1964.62 1163,-1970.62 1163,-1970.62 1163,-2328.39 1163,-2328.39 1163,-2334.39 1157,-2340.39 1151,-2340.39 1151,-2340.39 586,-2340.39 586,-2340.39 580,-2340.39 574,-2334.39 574,-2328.39 574,-2328.39 574,-1970.62 574,-1970.62 574,-1964.62 580,-1958.62 586,-1958.62"/>
<text text-anchor="middle" x="868.5" y="-2325.19" font-family="Times,serif" font-size="14.00">GPU 1</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_stage1</title>
<path fill="lightgray" stroke="black" d="M981,-1193.23C981,-1193.23 1661,-1193.23 1661,-1193.23 1667,-1193.23 1673,-1199.23 1673,-1205.23 1673,-1205.23 1673,-1809.85 1673,-1809.85 1673,-1815.85 1667,-1821.85 1661,-1821.85 1661,-1821.85 981,-1821.85 981,-1821.85 975,-1821.85 969,-1815.85 969,-1809.85 969,-1809.85 969,-1205.23 969,-1205.23 969,-1199.23 975,-1193.23 981,-1193.23"/>
<text text-anchor="middle" x="1321" y="-1806.65" font-family="Times,serif" font-size="14.00">Stage 1: GPUs 2,3 (Layers 20&#45;39)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_gpu2</title>
<path fill="none" stroke="black" d="M1001,-1420.77C1001,-1420.77 1304,-1420.77 1304,-1420.77 1310,-1420.77 1316,-1426.77 1316,-1432.77 1316,-1432.77 1316,-1587.77 1316,-1587.77 1316,-1593.77 1310,-1599.77 1304,-1599.77 1304,-1599.77 1001,-1599.77 1001,-1599.77 995,-1599.77 989,-1593.77 989,-1587.77 989,-1587.77 989,-1432.77 989,-1432.77 989,-1426.77 995,-1420.77 1001,-1420.77"/>
<text text-anchor="middle" x="1152.5" y="-1584.57" font-family="Times,serif" font-size="14.00">GPU 2</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_gpu3</title>
<path fill="none" stroke="black" d="M1350,-1420.77C1350,-1420.77 1653,-1420.77 1653,-1420.77 1659,-1420.77 1665,-1426.77 1665,-1432.77 1665,-1432.77 1665,-1587.77 1665,-1587.77 1665,-1593.77 1659,-1599.77 1653,-1599.77 1653,-1599.77 1350,-1599.77 1350,-1599.77 1344,-1599.77 1338,-1593.77 1338,-1587.77 1338,-1587.77 1338,-1432.77 1338,-1432.77 1338,-1426.77 1344,-1420.77 1350,-1420.77"/>
<text text-anchor="middle" x="1501.5" y="-1584.57" font-family="Times,serif" font-size="14.00">GPU 3</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_stage2</title>
<path fill="lightgray" stroke="black" d="M804,-556.62C804,-556.62 1484,-556.62 1484,-556.62 1490,-556.62 1496,-562.62 1496,-568.62 1496,-568.62 1496,-1173.23 1496,-1173.23 1496,-1179.23 1490,-1185.23 1484,-1185.23 1484,-1185.23 804,-1185.23 804,-1185.23 798,-1185.23 792,-1179.23 792,-1173.23 792,-1173.23 792,-568.62 792,-568.62 792,-562.62 798,-556.62 804,-556.62"/>
<text text-anchor="middle" x="1144" y="-1170.03" font-family="Times,serif" font-size="14.00">Stage 2: GPUs 4,5 (Layers 40&#45;59)</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_gpu4</title>
<path fill="none" stroke="black" d="M824,-784.16C824,-784.16 1127,-784.16 1127,-784.16 1133,-784.16 1139,-790.16 1139,-796.16 1139,-796.16 1139,-951.16 1139,-951.16 1139,-957.16 1133,-963.16 1127,-963.16 1127,-963.16 824,-963.16 824,-963.16 818,-963.16 812,-957.16 812,-951.16 812,-951.16 812,-796.16 812,-796.16 812,-790.16 818,-784.16 824,-784.16"/>
<text text-anchor="middle" x="975.5" y="-947.96" font-family="Times,serif" font-size="14.00">GPU 4</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_gpu5</title>
<path fill="none" stroke="black" d="M1173,-784.16C1173,-784.16 1476,-784.16 1476,-784.16 1482,-784.16 1488,-790.16 1488,-796.16 1488,-796.16 1488,-951.16 1488,-951.16 1488,-957.16 1482,-963.16 1476,-963.16 1476,-963.16 1173,-963.16 1173,-963.16 1167,-963.16 1161,-957.16 1161,-951.16 1161,-951.16 1161,-796.16 1161,-796.16 1161,-790.16 1167,-784.16 1173,-784.16"/>
<text text-anchor="middle" x="1324.5" y="-947.96" font-family="Times,serif" font-size="14.00">GPU 5</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_stage3</title>
<path fill="lightgray" stroke="black" d="M592,-8C592,-8 1753,-8 1753,-8 1759,-8 1765,-14 1765,-20 1765,-20 1765,-536.62 1765,-536.62 1765,-542.62 1759,-548.62 1753,-548.62 1753,-548.62 592,-548.62 592,-548.62 586,-548.62 580,-542.62 580,-536.62 580,-536.62 580,-20 580,-20 580,-14 586,-8 592,-8"/>
<text text-anchor="middle" x="1172.5" y="-533.42" font-family="Times,serif" font-size="14.00">Stage 3: GPUs 6,7 (Layers 60&#45;79)</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_gpu6</title>
<path fill="none" stroke="black" d="M1307,-136.77C1307,-136.77 1745,-136.77 1745,-136.77 1751,-136.77 1757,-142.77 1757,-148.77 1757,-148.77 1757,-314.54 1757,-314.54 1757,-320.54 1751,-326.54 1745,-326.54 1745,-326.54 1307,-326.54 1307,-326.54 1301,-326.54 1295,-320.54 1295,-314.54 1295,-314.54 1295,-148.77 1295,-148.77 1295,-142.77 1301,-136.77 1307,-136.77"/>
<text text-anchor="middle" x="1526" y="-311.34" font-family="Times,serif" font-size="14.00">GPU 6</text>
</g>
<g id="clust12" class="cluster">
<title>cluster_gpu7</title>
<path fill="none" stroke="black" d="M600,-136.77C600,-136.77 1039,-136.77 1039,-136.77 1045,-136.77 1051,-142.77 1051,-148.77 1051,-148.77 1051,-314.54 1051,-314.54 1051,-320.54 1045,-326.54 1039,-326.54 1039,-326.54 600,-326.54 600,-326.54 594,-326.54 588,-320.54 588,-314.54 588,-314.54 588,-148.77 588,-148.77 588,-142.77 594,-136.77 600,-136.77"/>
<text text-anchor="middle" x="819.5" y="-311.34" font-family="Times,serif" font-size="14.00">GPU 7</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="lightpink" stroke="black" points="273,-2430.39 0,-2389.39 273,-2348.39 546,-2389.39 273,-2430.39"/>
<text text-anchor="middle" x="273" y="-2397.89" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="273" y="-2386.89" font-family="Arial" font-size="10.00">Input: [batch_size=64, seq_len=8192, hidden_size=8192]</text>
<text text-anchor="middle" x="273" y="-2375.89" font-family="Arial" font-size="10.00">Output: [batch_size=64, seq_len=8192, hidden_size=8192]</text>
</g>
<!-- gpu0_layer0_attn_qkv -->
<g id="node2" class="node">
<title>gpu0_layer0_attn_qkv</title>
<polygon fill="lightgreen" stroke="black" points="1502.5,-2283.39 1359.5,-2283.39 1359.5,-2231.39 1502.5,-2231.39 1502.5,-2283.39"/>
<text text-anchor="middle" x="1431" y="-2271.39" font-family="Arial" font-size="10.00">Layer 0 Attention QKV Linear</text>
<text text-anchor="middle" x="1431" y="-2260.39" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1431" y="-2249.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1431" y="-2238.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 3072]</text>
</g>
<!-- input&#45;&gt;gpu0_layer0_attn_qkv -->
<g id="edge1" class="edge">
<title>input&#45;&gt;gpu0_layer0_attn_qkv</title>
<path fill="none" stroke="black" d="M397.06,-2366.95C444.73,-2359.64 499.74,-2352.33 550,-2348.39 618.35,-2343.04 1099.28,-2351.12 1167,-2340.39 1233.6,-2329.84 1306.62,-2306.17 1358.95,-2286.96"/>
<polygon fill="black" stroke="black" points="1360.32,-2290.19 1368.47,-2283.43 1357.88,-2283.62 1360.32,-2290.19"/>
</g>
<!-- gpu1_layer0_attn_qkv -->
<g id="node8" class="node">
<title>gpu1_layer0_attn_qkv</title>
<polygon fill="lightgreen" stroke="black" points="725.5,-2283.39 582.5,-2283.39 582.5,-2231.39 725.5,-2231.39 725.5,-2283.39"/>
<text text-anchor="middle" x="654" y="-2271.39" font-family="Arial" font-size="10.00">Layer 0 Attention QKV Linear</text>
<text text-anchor="middle" x="654" y="-2260.39" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="654" y="-2249.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="654" y="-2238.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 3072]</text>
</g>
<!-- input&#45;&gt;gpu1_layer0_attn_qkv -->
<g id="edge2" class="edge">
<title>input&#45;&gt;gpu1_layer0_attn_qkv</title>
<path fill="none" stroke="black" d="M354.73,-2360.5C419.1,-2338.54 508.39,-2308.08 572.66,-2286.15"/>
<polygon fill="black" stroke="black" points="574.01,-2289.38 582.35,-2282.84 571.75,-2282.76 574.01,-2289.38"/>
</g>
<!-- gpu0_layer0_attn_gate -->
<g id="node3" class="node">
<title>gpu0_layer0_attn_gate</title>
<polygon fill="lightyellow" stroke="black" points="1611.47,-2169.39 1410.29,-2169.39 1358.53,-2065.39 1559.71,-2065.39 1611.47,-2169.39"/>
<text text-anchor="middle" x="1485" y="-2131.39" font-family="Arial" font-size="10.00">Layer 0 Attention Gate</text>
<text text-anchor="middle" x="1485" y="-2120.39" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="1485" y="-2109.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 3072]</text>
<text text-anchor="middle" x="1485" y="-2098.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 1536]</text>
</g>
<!-- gpu0_layer0_attn_qkv&#45;&gt;gpu0_layer0_attn_gate -->
<g id="edge3" class="edge">
<title>gpu0_layer0_attn_qkv&#45;&gt;gpu0_layer0_attn_gate</title>
<path fill="none" stroke="black" d="M1440.9,-2231.08C1446.63,-2216.44 1454.11,-2197.33 1461.27,-2179.03"/>
<polygon fill="black" stroke="black" points="1464.6,-2180.14 1464.98,-2169.55 1458.08,-2177.59 1464.6,-2180.14"/>
</g>
<!-- gpu0_layer0_attn_out -->
<g id="node4" class="node">
<title>gpu0_layer0_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1747,-2018.62 1595,-2018.62 1595,-1966.62 1747,-1966.62 1747,-2018.62"/>
<text text-anchor="middle" x="1671" y="-2006.62" font-family="Arial" font-size="10.00">Layer 0 Attention Output Linear</text>
<text text-anchor="middle" x="1671" y="-1995.62" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1671" y="-1984.62" font-family="Arial" font-size="10.00">Input: [64, 8192, 1536]</text>
<text text-anchor="middle" x="1671" y="-1973.62" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu0_layer0_attn_gate&#45;&gt;gpu0_layer0_attn_out -->
<g id="edge5" class="edge">
<title>gpu0_layer0_attn_gate&#45;&gt;gpu0_layer0_attn_out</title>
<path fill="none" stroke="black" d="M1560.39,-2066.63C1582.14,-2052.27 1605.23,-2037.03 1624.65,-2024.21"/>
<polygon fill="black" stroke="black" points="1626.6,-2027.12 1633.02,-2018.69 1622.75,-2021.28 1626.6,-2027.12"/>
</g>
<!-- stage0_tp_allreduce1 -->
<g id="node14" class="node">
<title>stage0_tp_allreduce1</title>
<ellipse fill="lightblue" stroke="black" cx="1338" cy="-2389.39" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1338" y="-2403.39" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1338" y="-2392.39" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="1338" y="-2381.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1338" y="-2370.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu0_layer0_attn_out&#45;&gt;stage0_tp_allreduce1 -->
<g id="edge7" class="edge">
<title>gpu0_layer0_attn_out&#45;&gt;stage0_tp_allreduce1</title>
<path fill="none" stroke="black" d="M1716.82,-2018.7C1818.58,-2077.4 2046.46,-2227.3 1942,-2340.39 1908.37,-2376.8 1596.83,-2385.62 1434.85,-2387.73"/>
<polygon fill="black" stroke="black" points="1434.36,-2384.24 1424.4,-2387.86 1434.44,-2391.24 1434.36,-2384.24"/>
</g>
<!-- gpu0_layer0_mlp_gate -->
<g id="node5" class="node">
<title>gpu0_layer0_mlp_gate</title>
<polygon fill="lightyellow" stroke="black" points="1932.91,-2309.39 1721.48,-2309.39 1667.09,-2205.39 1878.52,-2205.39 1932.91,-2309.39"/>
<text text-anchor="middle" x="1800" y="-2271.39" font-family="Arial" font-size="10.00">Layer 0 MLP Gate</text>
<text text-anchor="middle" x="1800" y="-2260.39" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="1800" y="-2249.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1800" y="-2238.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu0_layer0_mlp_down -->
<g id="node7" class="node">
<title>gpu0_layer0_mlp_down</title>
<polygon fill="lightgreen" stroke="black" points="1759,-2143.39 1629,-2143.39 1629,-2091.39 1759,-2091.39 1759,-2143.39"/>
<text text-anchor="middle" x="1694" y="-2131.39" font-family="Arial" font-size="10.00">Layer 0 MLP Down Linear</text>
<text text-anchor="middle" x="1694" y="-2120.39" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1694" y="-2109.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 28672]</text>
<text text-anchor="middle" x="1694" y="-2098.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu0_layer0_mlp_gate&#45;&gt;gpu0_layer0_mlp_down -->
<g id="edge13" class="edge">
<title>gpu0_layer0_mlp_gate&#45;&gt;gpu0_layer0_mlp_down</title>
<path fill="none" stroke="black" d="M1760.53,-2205C1746.8,-2187.12 1731.76,-2167.55 1719.47,-2151.55"/>
<polygon fill="black" stroke="black" points="1722.17,-2149.33 1713.31,-2143.53 1716.62,-2153.59 1722.17,-2149.33"/>
</g>
<!-- gpu0_layer0_mlp_up -->
<g id="node6" class="node">
<title>gpu0_layer0_mlp_up</title>
<polygon fill="lightgreen" stroke="black" points="1649,-2283.39 1521,-2283.39 1521,-2231.39 1649,-2231.39 1649,-2283.39"/>
<text text-anchor="middle" x="1585" y="-2271.39" font-family="Arial" font-size="10.00">Layer 0 MLP Up Linear</text>
<text text-anchor="middle" x="1585" y="-2260.39" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1585" y="-2249.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1585" y="-2238.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu0_layer0_mlp_up&#45;&gt;gpu0_layer0_mlp_down -->
<g id="edge15" class="edge">
<title>gpu0_layer0_mlp_up&#45;&gt;gpu0_layer0_mlp_down</title>
<path fill="none" stroke="black" d="M1604.99,-2231.08C1622.66,-2208.71 1648.55,-2175.93 1667.86,-2151.49"/>
<polygon fill="black" stroke="black" points="1670.68,-2153.56 1674.13,-2143.54 1665.19,-2149.22 1670.68,-2153.56"/>
</g>
<!-- stage0_tp_allreduce2 -->
<g id="node15" class="node">
<title>stage0_tp_allreduce2</title>
<ellipse fill="lightblue" stroke="black" cx="1257" cy="-1992.62" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1257" y="-2006.62" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1257" y="-1995.62" font-family="Arial" font-size="10.00">MLP Output</text>
<text text-anchor="middle" x="1257" y="-1984.62" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1257" y="-1973.62" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu0_layer0_mlp_down&#45;&gt;stage0_tp_allreduce2 -->
<g id="edge17" class="edge">
<title>gpu0_layer0_mlp_down&#45;&gt;stage0_tp_allreduce2</title>
<path fill="none" stroke="black" d="M1664.52,-2091.3C1651.64,-2081.65 1635.87,-2071.5 1620,-2065.39 1505.78,-2021.45 1465.44,-2060.23 1347,-2029.39 1340.06,-2027.59 1332.94,-2025.39 1325.89,-2022.98"/>
<polygon fill="black" stroke="black" points="1326.93,-2019.64 1316.34,-2019.59 1324.59,-2026.24 1326.93,-2019.64"/>
</g>
<!-- gpu1_layer0_attn_gate -->
<g id="node9" class="node">
<title>gpu1_layer0_attn_gate</title>
<polygon fill="lightyellow" stroke="black" points="834.47,-2169.39 633.29,-2169.39 581.53,-2065.39 782.71,-2065.39 834.47,-2169.39"/>
<text text-anchor="middle" x="708" y="-2131.39" font-family="Arial" font-size="10.00">Layer 0 Attention Gate</text>
<text text-anchor="middle" x="708" y="-2120.39" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="708" y="-2109.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 3072]</text>
<text text-anchor="middle" x="708" y="-2098.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 1536]</text>
</g>
<!-- gpu1_layer0_attn_qkv&#45;&gt;gpu1_layer0_attn_gate -->
<g id="edge4" class="edge">
<title>gpu1_layer0_attn_qkv&#45;&gt;gpu1_layer0_attn_gate</title>
<path fill="none" stroke="black" d="M663.9,-2231.08C669.63,-2216.44 677.11,-2197.33 684.27,-2179.03"/>
<polygon fill="black" stroke="black" points="687.6,-2180.14 687.98,-2169.55 681.08,-2177.59 687.6,-2180.14"/>
</g>
<!-- gpu1_layer0_attn_out -->
<g id="node10" class="node">
<title>gpu1_layer0_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="759,-2018.62 607,-2018.62 607,-1966.62 759,-1966.62 759,-2018.62"/>
<text text-anchor="middle" x="683" y="-2006.62" font-family="Arial" font-size="10.00">Layer 0 Attention Output Linear</text>
<text text-anchor="middle" x="683" y="-1995.62" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="683" y="-1984.62" font-family="Arial" font-size="10.00">Input: [64, 8192, 1536]</text>
<text text-anchor="middle" x="683" y="-1973.62" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu1_layer0_attn_gate&#45;&gt;gpu1_layer0_attn_out -->
<g id="edge6" class="edge">
<title>gpu1_layer0_attn_gate&#45;&gt;gpu1_layer0_attn_out</title>
<path fill="none" stroke="black" d="M697.54,-2065.04C695.04,-2052.76 692.43,-2039.94 690.12,-2028.6"/>
<polygon fill="black" stroke="black" points="693.52,-2027.76 688.1,-2018.66 686.66,-2029.16 693.52,-2027.76"/>
</g>
<!-- gpu1_layer0_attn_out&#45;&gt;stage0_tp_allreduce1 -->
<g id="edge8" class="edge">
<title>gpu1_layer0_attn_out&#45;&gt;stage0_tp_allreduce1</title>
<path fill="none" stroke="black" d="M622.34,-2018.76C603.02,-2030 583.86,-2045.34 573,-2065.39 514.8,-2172.87 490.07,-2251.54 574,-2340.39 596.59,-2364.31 1041.52,-2379.95 1241.77,-2385.8"/>
<polygon fill="black" stroke="black" points="1241.89,-2389.31 1251.99,-2386.1 1242.1,-2382.31 1241.89,-2389.31"/>
</g>
<!-- gpu1_layer0_mlp_gate -->
<g id="node11" class="node">
<title>gpu1_layer0_mlp_gate</title>
<polygon fill="lightyellow" stroke="black" points="1008.91,-2309.39 797.48,-2309.39 743.09,-2205.39 954.52,-2205.39 1008.91,-2309.39"/>
<text text-anchor="middle" x="876" y="-2271.39" font-family="Arial" font-size="10.00">Layer 0 MLP Gate</text>
<text text-anchor="middle" x="876" y="-2260.39" font-family="Arial" font-size="10.00">Routing</text>
<text text-anchor="middle" x="876" y="-2249.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="876" y="-2238.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu1_layer0_mlp_down -->
<g id="node13" class="node">
<title>gpu1_layer0_mlp_down</title>
<polygon fill="lightgreen" stroke="black" points="1155,-2143.39 1025,-2143.39 1025,-2091.39 1155,-2091.39 1155,-2143.39"/>
<text text-anchor="middle" x="1090" y="-2131.39" font-family="Arial" font-size="10.00">Layer 0 MLP Down Linear</text>
<text text-anchor="middle" x="1090" y="-2120.39" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1090" y="-2109.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 28672]</text>
<text text-anchor="middle" x="1090" y="-2098.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu1_layer0_mlp_gate&#45;&gt;gpu1_layer0_mlp_down -->
<g id="edge14" class="edge">
<title>gpu1_layer0_mlp_gate&#45;&gt;gpu1_layer0_mlp_down</title>
<path fill="none" stroke="black" d="M954.77,-2205.59C984.22,-2186.6 1016.74,-2165.64 1042.5,-2149.02"/>
<polygon fill="black" stroke="black" points="1044.46,-2151.92 1050.97,-2143.56 1040.67,-2146.04 1044.46,-2151.92"/>
</g>
<!-- gpu1_layer0_mlp_up -->
<g id="node12" class="node">
<title>gpu1_layer0_mlp_up</title>
<polygon fill="lightgreen" stroke="black" points="1155,-2283.39 1027,-2283.39 1027,-2231.39 1155,-2231.39 1155,-2283.39"/>
<text text-anchor="middle" x="1091" y="-2271.39" font-family="Arial" font-size="10.00">Layer 0 MLP Up Linear</text>
<text text-anchor="middle" x="1091" y="-2260.39" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1091" y="-2249.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1091" y="-2238.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu1_layer0_mlp_up&#45;&gt;gpu1_layer0_mlp_down -->
<g id="edge16" class="edge">
<title>gpu1_layer0_mlp_up&#45;&gt;gpu1_layer0_mlp_down</title>
<path fill="none" stroke="black" d="M1090.82,-2231.08C1090.66,-2209.39 1090.43,-2177.92 1090.26,-2153.74"/>
<polygon fill="black" stroke="black" points="1093.75,-2153.52 1090.18,-2143.54 1086.75,-2153.57 1093.75,-2153.52"/>
</g>
<!-- gpu1_layer0_mlp_down&#45;&gt;stage0_tp_allreduce2 -->
<g id="edge18" class="edge">
<title>gpu1_layer0_mlp_down&#45;&gt;stage0_tp_allreduce2</title>
<path fill="none" stroke="black" d="M1124.2,-2091.25C1147.89,-2073.83 1179.84,-2050.34 1206.46,-2030.77"/>
<polygon fill="black" stroke="black" points="1208.56,-2033.58 1214.54,-2024.84 1204.41,-2027.94 1208.56,-2033.58"/>
</g>
<!-- stage0_tp_allreduce1&#45;&gt;gpu0_layer0_mlp_gate -->
<g id="edge9" class="edge">
<title>stage0_tp_allreduce1&#45;&gt;gpu0_layer0_mlp_gate</title>
<path fill="none" stroke="black" d="M1423.62,-2384.25C1489.29,-2379.02 1581.37,-2367.18 1658,-2340.39 1677.17,-2333.69 1696.68,-2324.36 1714.85,-2314.38"/>
<polygon fill="black" stroke="black" points="1716.65,-2317.38 1723.66,-2309.44 1713.23,-2311.28 1716.65,-2317.38"/>
</g>
<!-- stage0_tp_allreduce1&#45;&gt;gpu0_layer0_mlp_up -->
<g id="edge10" class="edge">
<title>stage0_tp_allreduce1&#45;&gt;gpu0_layer0_mlp_up</title>
<path fill="none" stroke="black" d="M1418.59,-2376.23C1449.44,-2369.07 1483.92,-2357.85 1512,-2340.39 1532.03,-2327.94 1549.75,-2308.36 1562.72,-2291.46"/>
<polygon fill="black" stroke="black" points="1565.54,-2293.54 1568.69,-2283.42 1559.92,-2289.36 1565.54,-2293.54"/>
</g>
<!-- stage0_tp_allreduce1&#45;&gt;gpu1_layer0_mlp_gate -->
<g id="edge11" class="edge">
<title>stage0_tp_allreduce1&#45;&gt;gpu1_layer0_mlp_gate</title>
<path fill="none" stroke="black" d="M1252.38,-2384.25C1186.71,-2379.02 1094.63,-2367.18 1018,-2340.39 998.83,-2333.69 979.32,-2324.36 961.15,-2314.38"/>
<polygon fill="black" stroke="black" points="962.77,-2311.28 952.34,-2309.44 959.35,-2317.38 962.77,-2311.28"/>
</g>
<!-- stage0_tp_allreduce1&#45;&gt;gpu1_layer0_mlp_up -->
<g id="edge12" class="edge">
<title>stage0_tp_allreduce1&#45;&gt;gpu1_layer0_mlp_up</title>
<path fill="none" stroke="black" d="M1284.71,-2360.34C1244.36,-2339.11 1189.05,-2310 1147.86,-2288.32"/>
<polygon fill="black" stroke="black" points="1149.24,-2285.09 1138.76,-2283.53 1145.98,-2291.29 1149.24,-2285.09"/>
</g>
<!-- stage0_output -->
<g id="node16" class="node">
<title>stage0_output</title>
<polygon fill="lightcoral" stroke="black" points="1257,-1919.85 1135,-1878.85 1257,-1837.85 1379,-1878.85 1257,-1919.85"/>
<text text-anchor="middle" x="1257" y="-1887.35" font-family="Arial" font-size="10.00">Stage 0 Output</text>
<text text-anchor="middle" x="1257" y="-1876.35" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1257" y="-1865.35" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- stage0_tp_allreduce2&#45;&gt;stage0_output -->
<g id="edge19" class="edge">
<title>stage0_tp_allreduce2&#45;&gt;stage0_output</title>
<path fill="none" stroke="black" d="M1257,-1955.64C1257,-1947.57 1257,-1938.85 1257,-1930.31"/>
<polygon fill="black" stroke="black" points="1260.5,-1930.03 1257,-1920.03 1253.5,-1930.03 1260.5,-1930.03"/>
</g>
<!-- p2p_send_0_1 -->
<g id="node27" class="node">
<title>p2p_send_0_1</title>
<ellipse fill="lightblue" stroke="black" cx="1257" cy="-1754.08" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1257" y="-1768.08" font-family="Arial" font-size="10.00">Pipeline Send</text>
<text text-anchor="middle" x="1257" y="-1757.08" font-family="Arial" font-size="10.00">Stage0→Stage1</text>
<text text-anchor="middle" x="1257" y="-1746.08" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1257" y="-1735.08" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- stage0_output&#45;&gt;p2p_send_0_1 -->
<g id="edge20" class="edge">
<title>stage0_output&#45;&gt;p2p_send_0_1</title>
<path fill="none" stroke="black" d="M1257,-1837.65C1257,-1826.08 1257,-1813.36 1257,-1801.44"/>
<polygon fill="black" stroke="black" points="1260.5,-1801.23 1257,-1791.23 1253.5,-1801.23 1260.5,-1801.23"/>
</g>
<!-- gpu2_layer20_attn_qkv -->
<g id="node17" class="node">
<title>gpu2_layer20_attn_qkv</title>
<polygon fill="lightgreen" stroke="black" points="1305.5,-1568.77 1156.5,-1568.77 1156.5,-1516.77 1305.5,-1516.77 1305.5,-1568.77"/>
<text text-anchor="middle" x="1231" y="-1556.77" font-family="Arial" font-size="10.00">Layer 20 Attention QKV Linear</text>
<text text-anchor="middle" x="1231" y="-1545.77" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1231" y="-1534.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1231" y="-1523.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 3072]</text>
</g>
<!-- gpu2_layer20_attn_out -->
<g id="node18" class="node">
<title>gpu2_layer20_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1307.5,-1480.77 1150.5,-1480.77 1150.5,-1428.77 1307.5,-1428.77 1307.5,-1480.77"/>
<text text-anchor="middle" x="1229" y="-1468.77" font-family="Arial" font-size="10.00">Layer 20 Attention Output Linear</text>
<text text-anchor="middle" x="1229" y="-1457.77" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1229" y="-1446.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 1536]</text>
<text text-anchor="middle" x="1229" y="-1435.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu2_layer20_attn_qkv&#45;&gt;gpu2_layer20_attn_out -->
<g id="edge24" class="edge">
<title>gpu2_layer20_attn_qkv&#45;&gt;gpu2_layer20_attn_out</title>
<path fill="none" stroke="black" d="M1230.41,-1516.44C1230.23,-1508.48 1230.02,-1499.54 1229.82,-1491.02"/>
<polygon fill="black" stroke="black" points="1233.32,-1490.85 1229.59,-1480.93 1226.32,-1491.01 1233.32,-1490.85"/>
</g>
<!-- stage1_tp_allreduce1 -->
<g id="node25" class="node">
<title>stage1_tp_allreduce1</title>
<ellipse fill="lightblue" stroke="black" cx="1316" cy="-1356" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1316" y="-1370" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1316" y="-1359" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="1316" y="-1348" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1316" y="-1337" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu2_layer20_attn_out&#45;&gt;stage1_tp_allreduce1 -->
<g id="edge26" class="edge">
<title>gpu2_layer20_attn_out&#45;&gt;stage1_tp_allreduce1</title>
<path fill="none" stroke="black" d="M1251.63,-1428.6C1259.9,-1419.41 1269.48,-1408.75 1278.68,-1398.51"/>
<polygon fill="black" stroke="black" points="1281.54,-1400.57 1285.62,-1390.8 1276.33,-1395.89 1281.54,-1400.57"/>
</g>
<!-- gpu2_layer20_mlp_up -->
<g id="node19" class="node">
<title>gpu2_layer20_mlp_up</title>
<polygon fill="lightgreen" stroke="black" points="1127,-1568.77 999,-1568.77 999,-1516.77 1127,-1516.77 1127,-1568.77"/>
<text text-anchor="middle" x="1063" y="-1556.77" font-family="Arial" font-size="10.00">Layer 20 MLP Up Linear</text>
<text text-anchor="middle" x="1063" y="-1545.77" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1063" y="-1534.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1063" y="-1523.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu2_layer20_mlp_down -->
<g id="node20" class="node">
<title>gpu2_layer20_mlp_down</title>
<polygon fill="lightgreen" stroke="black" points="1132.5,-1480.77 997.5,-1480.77 997.5,-1428.77 1132.5,-1428.77 1132.5,-1480.77"/>
<text text-anchor="middle" x="1065" y="-1468.77" font-family="Arial" font-size="10.00">Layer 20 MLP Down Linear</text>
<text text-anchor="middle" x="1065" y="-1457.77" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1065" y="-1446.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 28672]</text>
<text text-anchor="middle" x="1065" y="-1435.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu2_layer20_mlp_up&#45;&gt;gpu2_layer20_mlp_down -->
<g id="edge30" class="edge">
<title>gpu2_layer20_mlp_up&#45;&gt;gpu2_layer20_mlp_down</title>
<path fill="none" stroke="black" d="M1063.59,-1516.44C1063.77,-1508.48 1063.98,-1499.54 1064.18,-1491.02"/>
<polygon fill="black" stroke="black" points="1067.68,-1491.01 1064.41,-1480.93 1060.68,-1490.85 1067.68,-1491.01"/>
</g>
<!-- stage1_tp_allreduce2 -->
<g id="node26" class="node">
<title>stage1_tp_allreduce2</title>
<ellipse fill="lightblue" stroke="black" cx="1107" cy="-1356" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1107" y="-1370" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1107" y="-1359" font-family="Arial" font-size="10.00">MLP Output</text>
<text text-anchor="middle" x="1107" y="-1348" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1107" y="-1337" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu2_layer20_mlp_down&#45;&gt;stage1_tp_allreduce2 -->
<g id="edge32" class="edge">
<title>gpu2_layer20_mlp_down&#45;&gt;stage1_tp_allreduce2</title>
<path fill="none" stroke="black" d="M1075.93,-1428.6C1079.53,-1420.29 1083.66,-1410.77 1087.71,-1401.45"/>
<polygon fill="black" stroke="black" points="1090.93,-1402.82 1091.7,-1392.25 1084.51,-1400.03 1090.93,-1402.82"/>
</g>
<!-- gpu3_layer20_attn_qkv -->
<g id="node21" class="node">
<title>gpu3_layer20_attn_qkv</title>
<polygon fill="lightgreen" stroke="black" points="1647.5,-1568.77 1498.5,-1568.77 1498.5,-1516.77 1647.5,-1516.77 1647.5,-1568.77"/>
<text text-anchor="middle" x="1573" y="-1556.77" font-family="Arial" font-size="10.00">Layer 20 Attention QKV Linear</text>
<text text-anchor="middle" x="1573" y="-1545.77" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1573" y="-1534.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1573" y="-1523.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 3072]</text>
</g>
<!-- gpu3_layer20_attn_out -->
<g id="node22" class="node">
<title>gpu3_layer20_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1656.5,-1480.77 1499.5,-1480.77 1499.5,-1428.77 1656.5,-1428.77 1656.5,-1480.77"/>
<text text-anchor="middle" x="1578" y="-1468.77" font-family="Arial" font-size="10.00">Layer 20 Attention Output Linear</text>
<text text-anchor="middle" x="1578" y="-1457.77" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1578" y="-1446.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 1536]</text>
<text text-anchor="middle" x="1578" y="-1435.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu3_layer20_attn_qkv&#45;&gt;gpu3_layer20_attn_out -->
<g id="edge25" class="edge">
<title>gpu3_layer20_attn_qkv&#45;&gt;gpu3_layer20_attn_out</title>
<path fill="none" stroke="black" d="M1574.47,-1516.44C1574.94,-1508.48 1575.46,-1499.54 1575.95,-1491.02"/>
<polygon fill="black" stroke="black" points="1579.45,-1491.12 1576.54,-1480.93 1572.46,-1490.71 1579.45,-1491.12"/>
</g>
<!-- gpu3_layer20_attn_out&#45;&gt;stage1_tp_allreduce1 -->
<g id="edge27" class="edge">
<title>gpu3_layer20_attn_out&#45;&gt;stage1_tp_allreduce1</title>
<path fill="none" stroke="black" d="M1512.01,-1428.64C1504.92,-1425.97 1497.81,-1423.31 1491,-1420.77 1458.04,-1408.52 1421.5,-1395.17 1390.37,-1383.86"/>
<polygon fill="black" stroke="black" points="1391.49,-1380.55 1380.9,-1380.42 1389.1,-1387.13 1391.49,-1380.55"/>
</g>
<!-- gpu3_layer20_mlp_up -->
<g id="node23" class="node">
<title>gpu3_layer20_mlp_up</title>
<polygon fill="lightgreen" stroke="black" points="1476,-1568.77 1348,-1568.77 1348,-1516.77 1476,-1516.77 1476,-1568.77"/>
<text text-anchor="middle" x="1412" y="-1556.77" font-family="Arial" font-size="10.00">Layer 20 MLP Up Linear</text>
<text text-anchor="middle" x="1412" y="-1545.77" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1412" y="-1534.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1412" y="-1523.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu3_layer20_mlp_down -->
<g id="node24" class="node">
<title>gpu3_layer20_mlp_down</title>
<polygon fill="lightgreen" stroke="black" points="1481.5,-1480.77 1346.5,-1480.77 1346.5,-1428.77 1481.5,-1428.77 1481.5,-1480.77"/>
<text text-anchor="middle" x="1414" y="-1468.77" font-family="Arial" font-size="10.00">Layer 20 MLP Down Linear</text>
<text text-anchor="middle" x="1414" y="-1457.77" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1414" y="-1446.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 28672]</text>
<text text-anchor="middle" x="1414" y="-1435.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu3_layer20_mlp_up&#45;&gt;gpu3_layer20_mlp_down -->
<g id="edge31" class="edge">
<title>gpu3_layer20_mlp_up&#45;&gt;gpu3_layer20_mlp_down</title>
<path fill="none" stroke="black" d="M1412.59,-1516.44C1412.77,-1508.48 1412.98,-1499.54 1413.18,-1491.02"/>
<polygon fill="black" stroke="black" points="1416.68,-1491.01 1413.41,-1480.93 1409.68,-1490.85 1416.68,-1491.01"/>
</g>
<!-- gpu3_layer20_mlp_down&#45;&gt;stage1_tp_allreduce2 -->
<g id="edge33" class="edge">
<title>gpu3_layer20_mlp_down&#45;&gt;stage1_tp_allreduce2</title>
<path fill="none" stroke="black" d="M1346.39,-1429.48C1337.54,-1426.46 1328.57,-1423.49 1320,-1420.77 1276.41,-1406.97 1264.82,-1405.84 1221,-1392.77 1209.24,-1389.27 1196.82,-1385.47 1184.68,-1381.7"/>
<polygon fill="black" stroke="black" points="1185.61,-1378.33 1175.02,-1378.69 1183.53,-1385.01 1185.61,-1378.33"/>
</g>
<!-- stage1_tp_allreduce1&#45;&gt;gpu2_layer20_mlp_up -->
<g id="edge28" class="edge">
<title>stage1_tp_allreduce1&#45;&gt;gpu2_layer20_mlp_up</title>
<path fill="none" stroke="black" d="M1249.91,-1379.87C1234.34,-1384.66 1217.7,-1389.31 1202,-1392.77 1155.38,-1403.07 1020.48,-1384.88 989,-1420.77 971.42,-1440.82 977.62,-1456.65 989,-1480.77 994.32,-1492.06 1002.87,-1501.97 1012.31,-1510.34"/>
<polygon fill="black" stroke="black" points="1010.08,-1513.04 1020.01,-1516.71 1014.54,-1507.64 1010.08,-1513.04"/>
</g>
<!-- stage1_tp_allreduce1&#45;&gt;gpu3_layer20_mlp_up -->
<g id="edge29" class="edge">
<title>stage1_tp_allreduce1&#45;&gt;gpu3_layer20_mlp_up</title>
<path fill="none" stroke="black" d="M1319.59,-1392.78C1323.2,-1423.88 1329.47,-1466.17 1338,-1480.77 1344.43,-1491.78 1353.63,-1501.65 1363.36,-1510.09"/>
<polygon fill="black" stroke="black" points="1361.29,-1512.92 1371.25,-1516.55 1365.73,-1507.51 1361.29,-1512.92"/>
</g>
<!-- stage1_output -->
<g id="node29" class="node">
<title>stage1_output</title>
<polygon fill="lightcoral" stroke="black" points="1107,-1283.23 985,-1242.23 1107,-1201.23 1229,-1242.23 1107,-1283.23"/>
<text text-anchor="middle" x="1107" y="-1250.73" font-family="Arial" font-size="10.00">Stage 1 Output</text>
<text text-anchor="middle" x="1107" y="-1239.73" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1107" y="-1228.73" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- stage1_tp_allreduce2&#45;&gt;stage1_output -->
<g id="edge34" class="edge">
<title>stage1_tp_allreduce2&#45;&gt;stage1_output</title>
<path fill="none" stroke="black" d="M1107,-1319.02C1107,-1310.95 1107,-1302.24 1107,-1293.69"/>
<polygon fill="black" stroke="black" points="1110.5,-1293.41 1107,-1283.41 1103.5,-1293.41 1110.5,-1293.41"/>
</g>
<!-- p2p_recv_0_1 -->
<g id="node28" class="node">
<title>p2p_recv_0_1</title>
<ellipse fill="lightblue" stroke="black" cx="1257" cy="-1644.54" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1257" y="-1658.54" font-family="Arial" font-size="10.00">Pipeline Receive</text>
<text text-anchor="middle" x="1257" y="-1647.54" font-family="Arial" font-size="10.00">Stage0→Stage1</text>
<text text-anchor="middle" x="1257" y="-1636.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1257" y="-1625.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- p2p_send_0_1&#45;&gt;p2p_recv_0_1 -->
<g id="edge21" class="edge">
<title>p2p_send_0_1&#45;&gt;p2p_recv_0_1</title>
<path fill="none" stroke="black" d="M1257,-1717.27C1257,-1709.11 1257,-1700.32 1257,-1691.78"/>
<polygon fill="black" stroke="black" points="1260.5,-1691.56 1257,-1681.56 1253.5,-1691.56 1260.5,-1691.56"/>
</g>
<!-- p2p_recv_0_1&#45;&gt;gpu2_layer20_attn_qkv -->
<g id="edge22" class="edge">
<title>p2p_recv_0_1&#45;&gt;gpu2_layer20_attn_qkv</title>
<path fill="none" stroke="black" d="M1247.69,-1607.81C1245.23,-1598.36 1242.57,-1588.18 1240.12,-1578.78"/>
<polygon fill="black" stroke="black" points="1243.47,-1577.74 1237.56,-1568.95 1236.7,-1579.51 1243.47,-1577.74"/>
</g>
<!-- p2p_recv_0_1&#45;&gt;gpu3_layer20_attn_qkv -->
<g id="edge23" class="edge">
<title>p2p_recv_0_1&#45;&gt;gpu3_layer20_attn_qkv</title>
<path fill="none" stroke="black" d="M1340.64,-1635.16C1384.71,-1628.85 1439.02,-1618.04 1485,-1599.77 1501.03,-1593.41 1517.31,-1584.03 1531.44,-1574.76"/>
<polygon fill="black" stroke="black" points="1533.6,-1577.52 1539.93,-1569.03 1529.69,-1571.72 1533.6,-1577.52"/>
</g>
<!-- p2p_send_1_2 -->
<g id="node40" class="node">
<title>p2p_send_1_2</title>
<ellipse fill="lightblue" stroke="black" cx="1107" cy="-1117.47" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1107" y="-1131.47" font-family="Arial" font-size="10.00">Pipeline Send</text>
<text text-anchor="middle" x="1107" y="-1120.47" font-family="Arial" font-size="10.00">Stage1→Stage2</text>
<text text-anchor="middle" x="1107" y="-1109.47" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1107" y="-1098.47" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- stage1_output&#45;&gt;p2p_send_1_2 -->
<g id="edge35" class="edge">
<title>stage1_output&#45;&gt;p2p_send_1_2</title>
<path fill="none" stroke="black" d="M1107,-1201.04C1107,-1189.46 1107,-1176.74 1107,-1164.83"/>
<polygon fill="black" stroke="black" points="1110.5,-1164.61 1107,-1154.61 1103.5,-1164.61 1110.5,-1164.61"/>
</g>
<!-- gpu4_layer40_attn_qkv -->
<g id="node30" class="node">
<title>gpu4_layer40_attn_qkv</title>
<polygon fill="lightgreen" stroke="black" points="1128.5,-932.16 979.5,-932.16 979.5,-880.16 1128.5,-880.16 1128.5,-932.16"/>
<text text-anchor="middle" x="1054" y="-920.16" font-family="Arial" font-size="10.00">Layer 40 Attention QKV Linear</text>
<text text-anchor="middle" x="1054" y="-909.16" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1054" y="-898.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1054" y="-887.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 3072]</text>
</g>
<!-- gpu4_layer40_attn_out -->
<g id="node31" class="node">
<title>gpu4_layer40_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1130.5,-844.16 973.5,-844.16 973.5,-792.16 1130.5,-792.16 1130.5,-844.16"/>
<text text-anchor="middle" x="1052" y="-832.16" font-family="Arial" font-size="10.00">Layer 40 Attention Output Linear</text>
<text text-anchor="middle" x="1052" y="-821.16" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1052" y="-810.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 1536]</text>
<text text-anchor="middle" x="1052" y="-799.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu4_layer40_attn_qkv&#45;&gt;gpu4_layer40_attn_out -->
<g id="edge39" class="edge">
<title>gpu4_layer40_attn_qkv&#45;&gt;gpu4_layer40_attn_out</title>
<path fill="none" stroke="black" d="M1053.41,-879.82C1053.23,-871.86 1053.02,-862.92 1052.82,-854.4"/>
<polygon fill="black" stroke="black" points="1056.32,-854.23 1052.59,-844.31 1049.32,-854.39 1056.32,-854.23"/>
</g>
<!-- stage2_tp_allreduce1 -->
<g id="node38" class="node">
<title>stage2_tp_allreduce1</title>
<ellipse fill="lightblue" stroke="black" cx="1135" cy="-719.39" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1135" y="-733.39" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1135" y="-722.39" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="1135" y="-711.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1135" y="-700.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu4_layer40_attn_out&#45;&gt;stage2_tp_allreduce1 -->
<g id="edge41" class="edge">
<title>gpu4_layer40_attn_out&#45;&gt;stage2_tp_allreduce1</title>
<path fill="none" stroke="black" d="M1073.59,-791.98C1081.48,-782.79 1090.62,-772.13 1099.4,-761.89"/>
<polygon fill="black" stroke="black" points="1102.16,-764.05 1106.02,-754.18 1096.85,-759.49 1102.16,-764.05"/>
</g>
<!-- gpu4_layer40_mlp_up -->
<g id="node32" class="node">
<title>gpu4_layer40_mlp_up</title>
<polygon fill="lightgreen" stroke="black" points="950,-932.16 822,-932.16 822,-880.16 950,-880.16 950,-932.16"/>
<text text-anchor="middle" x="886" y="-920.16" font-family="Arial" font-size="10.00">Layer 40 MLP Up Linear</text>
<text text-anchor="middle" x="886" y="-909.16" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="886" y="-898.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="886" y="-887.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu4_layer40_mlp_down -->
<g id="node33" class="node">
<title>gpu4_layer40_mlp_down</title>
<polygon fill="lightgreen" stroke="black" points="955.5,-844.16 820.5,-844.16 820.5,-792.16 955.5,-792.16 955.5,-844.16"/>
<text text-anchor="middle" x="888" y="-832.16" font-family="Arial" font-size="10.00">Layer 40 MLP Down Linear</text>
<text text-anchor="middle" x="888" y="-821.16" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="888" y="-810.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 28672]</text>
<text text-anchor="middle" x="888" y="-799.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu4_layer40_mlp_up&#45;&gt;gpu4_layer40_mlp_down -->
<g id="edge45" class="edge">
<title>gpu4_layer40_mlp_up&#45;&gt;gpu4_layer40_mlp_down</title>
<path fill="none" stroke="black" d="M886.59,-879.82C886.77,-871.86 886.98,-862.92 887.18,-854.4"/>
<polygon fill="black" stroke="black" points="890.68,-854.39 887.41,-844.31 883.68,-854.23 890.68,-854.39"/>
</g>
<!-- stage2_tp_allreduce2 -->
<g id="node39" class="node">
<title>stage2_tp_allreduce2</title>
<ellipse fill="lightblue" stroke="black" cx="926" cy="-719.39" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="926" y="-733.39" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="926" y="-722.39" font-family="Arial" font-size="10.00">MLP Output</text>
<text text-anchor="middle" x="926" y="-711.39" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="926" y="-700.39" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu4_layer40_mlp_down&#45;&gt;stage2_tp_allreduce2 -->
<g id="edge47" class="edge">
<title>gpu4_layer40_mlp_down&#45;&gt;stage2_tp_allreduce2</title>
<path fill="none" stroke="black" d="M897.88,-791.98C901.08,-783.84 904.73,-774.54 908.32,-765.4"/>
<polygon fill="black" stroke="black" points="911.62,-766.58 912.02,-756 905.1,-764.03 911.62,-766.58"/>
</g>
<!-- gpu5_layer40_attn_qkv -->
<g id="node34" class="node">
<title>gpu5_layer40_attn_qkv</title>
<polygon fill="lightgreen" stroke="black" points="1470.5,-932.16 1321.5,-932.16 1321.5,-880.16 1470.5,-880.16 1470.5,-932.16"/>
<text text-anchor="middle" x="1396" y="-920.16" font-family="Arial" font-size="10.00">Layer 40 Attention QKV Linear</text>
<text text-anchor="middle" x="1396" y="-909.16" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1396" y="-898.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1396" y="-887.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 3072]</text>
</g>
<!-- gpu5_layer40_attn_out -->
<g id="node35" class="node">
<title>gpu5_layer40_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1479.5,-844.16 1322.5,-844.16 1322.5,-792.16 1479.5,-792.16 1479.5,-844.16"/>
<text text-anchor="middle" x="1401" y="-832.16" font-family="Arial" font-size="10.00">Layer 40 Attention Output Linear</text>
<text text-anchor="middle" x="1401" y="-821.16" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1401" y="-810.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 1536]</text>
<text text-anchor="middle" x="1401" y="-799.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu5_layer40_attn_qkv&#45;&gt;gpu5_layer40_attn_out -->
<g id="edge40" class="edge">
<title>gpu5_layer40_attn_qkv&#45;&gt;gpu5_layer40_attn_out</title>
<path fill="none" stroke="black" d="M1397.47,-879.82C1397.94,-871.86 1398.46,-862.92 1398.95,-854.4"/>
<polygon fill="black" stroke="black" points="1402.45,-854.5 1399.54,-844.31 1395.46,-854.09 1402.45,-854.5"/>
</g>
<!-- gpu5_layer40_attn_out&#45;&gt;stage2_tp_allreduce1 -->
<g id="edge42" class="edge">
<title>gpu5_layer40_attn_out&#45;&gt;stage2_tp_allreduce1</title>
<path fill="none" stroke="black" d="M1335.5,-792.15C1328.25,-789.43 1320.97,-786.72 1314,-784.16 1280.05,-771.67 1242.34,-758.18 1210.32,-746.84"/>
<polygon fill="black" stroke="black" points="1211.17,-743.43 1200.58,-743.39 1208.84,-750.03 1211.17,-743.43"/>
</g>
<!-- gpu5_layer40_mlp_up -->
<g id="node36" class="node">
<title>gpu5_layer40_mlp_up</title>
<polygon fill="lightgreen" stroke="black" points="1299,-932.16 1171,-932.16 1171,-880.16 1299,-880.16 1299,-932.16"/>
<text text-anchor="middle" x="1235" y="-920.16" font-family="Arial" font-size="10.00">Layer 40 MLP Up Linear</text>
<text text-anchor="middle" x="1235" y="-909.16" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1235" y="-898.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1235" y="-887.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu5_layer40_mlp_down -->
<g id="node37" class="node">
<title>gpu5_layer40_mlp_down</title>
<polygon fill="lightgreen" stroke="black" points="1304.5,-844.16 1169.5,-844.16 1169.5,-792.16 1304.5,-792.16 1304.5,-844.16"/>
<text text-anchor="middle" x="1237" y="-832.16" font-family="Arial" font-size="10.00">Layer 40 MLP Down Linear</text>
<text text-anchor="middle" x="1237" y="-821.16" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1237" y="-810.16" font-family="Arial" font-size="10.00">Input: [64, 8192, 28672]</text>
<text text-anchor="middle" x="1237" y="-799.16" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu5_layer40_mlp_up&#45;&gt;gpu5_layer40_mlp_down -->
<g id="edge46" class="edge">
<title>gpu5_layer40_mlp_up&#45;&gt;gpu5_layer40_mlp_down</title>
<path fill="none" stroke="black" d="M1235.59,-879.82C1235.77,-871.86 1235.98,-862.92 1236.18,-854.4"/>
<polygon fill="black" stroke="black" points="1239.68,-854.39 1236.41,-844.31 1232.68,-854.23 1239.68,-854.39"/>
</g>
<!-- gpu5_layer40_mlp_down&#45;&gt;stage2_tp_allreduce2 -->
<g id="edge48" class="edge">
<title>gpu5_layer40_mlp_down&#45;&gt;stage2_tp_allreduce2</title>
<path fill="none" stroke="black" d="M1169.42,-792.78C1160.57,-789.77 1151.59,-786.83 1143,-784.16 1097.7,-770.07 1085.53,-769.48 1040,-756.16 1028.22,-752.71 1015.79,-748.94 1003.65,-745.19"/>
<polygon fill="black" stroke="black" points="1004.58,-741.81 993.99,-742.19 1002.5,-748.5 1004.58,-741.81"/>
</g>
<!-- stage2_tp_allreduce1&#45;&gt;gpu4_layer40_mlp_up -->
<g id="edge43" class="edge">
<title>stage2_tp_allreduce1&#45;&gt;gpu4_layer40_mlp_up</title>
<path fill="none" stroke="black" d="M1068.91,-743.22C1053.33,-748.02 1036.69,-752.67 1021,-756.16 975.26,-766.32 842.86,-748.89 812,-784.16 794.44,-804.23 800.62,-820.04 812,-844.16 817.32,-855.44 825.87,-865.35 835.31,-873.72"/>
<polygon fill="black" stroke="black" points="833.08,-876.42 843.01,-880.1 837.54,-871.03 833.08,-876.42"/>
</g>
<!-- stage2_tp_allreduce1&#45;&gt;gpu5_layer40_mlp_up -->
<g id="edge44" class="edge">
<title>stage2_tp_allreduce1&#45;&gt;gpu5_layer40_mlp_up</title>
<path fill="none" stroke="black" d="M1139.83,-756.18C1144.52,-787.3 1152.19,-829.6 1161,-844.16 1167.67,-855.17 1177.06,-865.1 1186.92,-873.59"/>
<polygon fill="black" stroke="black" points="1184.92,-876.48 1194.88,-880.08 1189.35,-871.05 1184.92,-876.48"/>
</g>
<!-- stage2_output -->
<g id="node42" class="node">
<title>stage2_output</title>
<polygon fill="lightcoral" stroke="black" points="926,-646.62 804,-605.62 926,-564.62 1048,-605.62 926,-646.62"/>
<text text-anchor="middle" x="926" y="-614.12" font-family="Arial" font-size="10.00">Stage 2 Output</text>
<text text-anchor="middle" x="926" y="-603.12" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="926" y="-592.12" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- stage2_tp_allreduce2&#45;&gt;stage2_output -->
<g id="edge49" class="edge">
<title>stage2_tp_allreduce2&#45;&gt;stage2_output</title>
<path fill="none" stroke="black" d="M926,-682.41C926,-674.33 926,-665.62 926,-657.07"/>
<polygon fill="black" stroke="black" points="929.5,-656.79 926,-646.79 922.5,-656.79 929.5,-656.79"/>
</g>
<!-- p2p_recv_1_2 -->
<g id="node41" class="node">
<title>p2p_recv_1_2</title>
<ellipse fill="lightblue" stroke="black" cx="1107" cy="-1007.93" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1107" y="-1021.93" font-family="Arial" font-size="10.00">Pipeline Receive</text>
<text text-anchor="middle" x="1107" y="-1010.93" font-family="Arial" font-size="10.00">Stage1→Stage2</text>
<text text-anchor="middle" x="1107" y="-999.93" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1107" y="-988.93" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- p2p_send_1_2&#45;&gt;p2p_recv_1_2 -->
<g id="edge36" class="edge">
<title>p2p_send_1_2&#45;&gt;p2p_recv_1_2</title>
<path fill="none" stroke="black" d="M1107,-1080.66C1107,-1072.49 1107,-1063.7 1107,-1055.17"/>
<polygon fill="black" stroke="black" points="1110.5,-1054.95 1107,-1044.95 1103.5,-1054.95 1110.5,-1054.95"/>
</g>
<!-- p2p_recv_1_2&#45;&gt;gpu4_layer40_attn_qkv -->
<g id="edge37" class="edge">
<title>p2p_recv_1_2&#45;&gt;gpu4_layer40_attn_qkv</title>
<path fill="none" stroke="black" d="M1088.31,-971.75C1083.07,-961.89 1077.39,-951.18 1072.18,-941.37"/>
<polygon fill="black" stroke="black" points="1075.14,-939.49 1067.36,-932.3 1068.96,-942.78 1075.14,-939.49"/>
</g>
<!-- p2p_recv_1_2&#45;&gt;gpu5_layer40_attn_qkv -->
<g id="edge38" class="edge">
<title>p2p_recv_1_2&#45;&gt;gpu5_layer40_attn_qkv</title>
<path fill="none" stroke="black" d="M1188.68,-995.86C1225.99,-989.12 1270.19,-978.72 1308,-963.16 1323.95,-956.59 1340.21,-947.16 1354.34,-937.9"/>
<polygon fill="black" stroke="black" points="1356.5,-940.67 1362.85,-932.19 1352.59,-934.86 1356.5,-940.67"/>
</g>
<!-- p2p_send_2_3 -->
<g id="node55" class="node">
<title>p2p_send_2_3</title>
<ellipse fill="lightblue" stroke="black" cx="926" cy="-480.85" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="926" y="-494.85" font-family="Arial" font-size="10.00">Pipeline Send</text>
<text text-anchor="middle" x="926" y="-483.85" font-family="Arial" font-size="10.00">Stage2→Stage3</text>
<text text-anchor="middle" x="926" y="-472.85" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="926" y="-461.85" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- stage2_output&#45;&gt;p2p_send_2_3 -->
<g id="edge50" class="edge">
<title>stage2_output&#45;&gt;p2p_send_2_3</title>
<path fill="none" stroke="black" d="M926,-564.42C926,-552.84 926,-540.12 926,-528.21"/>
<polygon fill="black" stroke="black" points="929.5,-527.99 926,-517.99 922.5,-527.99 929.5,-527.99"/>
</g>
<!-- gpu6_layer60_attn_qkv -->
<g id="node43" class="node">
<title>gpu6_layer60_attn_qkv</title>
<polygon fill="lightgreen" stroke="black" points="1749.5,-295.54 1600.5,-295.54 1600.5,-243.54 1749.5,-243.54 1749.5,-295.54"/>
<text text-anchor="middle" x="1675" y="-283.54" font-family="Arial" font-size="10.00">Layer 60 Attention QKV Linear</text>
<text text-anchor="middle" x="1675" y="-272.54" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1675" y="-261.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1675" y="-250.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 3072]</text>
</g>
<!-- gpu6_layer60_attn_out -->
<g id="node44" class="node">
<title>gpu6_layer60_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1462.5,-196.77 1305.5,-196.77 1305.5,-144.77 1462.5,-144.77 1462.5,-196.77"/>
<text text-anchor="middle" x="1384" y="-184.77" font-family="Arial" font-size="10.00">Layer 60 Attention Output Linear</text>
<text text-anchor="middle" x="1384" y="-173.77" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1384" y="-162.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 1536]</text>
<text text-anchor="middle" x="1384" y="-151.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu6_layer60_attn_qkv&#45;&gt;gpu6_layer60_attn_out -->
<g id="edge54" class="edge">
<title>gpu6_layer60_attn_qkv&#45;&gt;gpu6_layer60_attn_out</title>
<path fill="none" stroke="black" d="M1600.34,-246.05C1597.53,-245.2 1594.74,-244.36 1592,-243.54 1538.68,-227.51 1524.52,-226.04 1472,-207.54 1465.73,-205.33 1459.25,-202.93 1452.79,-200.45"/>
<polygon fill="black" stroke="black" points="1453.94,-197.15 1443.35,-196.78 1451.4,-203.67 1453.94,-197.15"/>
</g>
<!-- stage3_tp_allreduce1 -->
<g id="node53" class="node">
<title>stage3_tp_allreduce1</title>
<ellipse fill="lightblue" stroke="black" cx="945" cy="-57" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="945" y="-71" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="945" y="-60" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="945" y="-49" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="945" y="-38" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu6_layer60_attn_out&#45;&gt;stage3_tp_allreduce1 -->
<g id="edge56" class="edge">
<title>gpu6_layer60_attn_out&#45;&gt;stage3_tp_allreduce1</title>
<path fill="none" stroke="black" d="M1332.28,-144.72C1322.4,-140.65 1312.01,-136.84 1302,-134 1193.6,-103.19 1160.15,-126.06 1051,-98 1039.13,-94.95 1026.75,-91.01 1014.82,-86.8"/>
<polygon fill="black" stroke="black" points="1015.96,-83.49 1005.36,-83.37 1013.57,-90.07 1015.96,-83.49"/>
</g>
<!-- gpu6_layer60_mlp_up -->
<g id="node45" class="node">
<title>gpu6_layer60_mlp_up</title>
<polygon fill="lightgreen" stroke="black" points="1431,-295.54 1303,-295.54 1303,-243.54 1431,-243.54 1431,-295.54"/>
<text text-anchor="middle" x="1367" y="-283.54" font-family="Arial" font-size="10.00">Layer 60 MLP Up Linear</text>
<text text-anchor="middle" x="1367" y="-272.54" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1367" y="-261.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1367" y="-250.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu6_layer60_mlp_down -->
<g id="node46" class="node">
<title>gpu6_layer60_mlp_down</title>
<polygon fill="lightgreen" stroke="black" points="1615.5,-196.77 1480.5,-196.77 1480.5,-144.77 1615.5,-144.77 1615.5,-196.77"/>
<text text-anchor="middle" x="1548" y="-184.77" font-family="Arial" font-size="10.00">Layer 60 MLP Down Linear</text>
<text text-anchor="middle" x="1548" y="-173.77" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="1548" y="-162.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 28672]</text>
<text text-anchor="middle" x="1548" y="-151.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu6_layer60_mlp_up&#45;&gt;gpu6_layer60_mlp_down -->
<g id="edge60" class="edge">
<title>gpu6_layer60_mlp_up&#45;&gt;gpu6_layer60_mlp_down</title>
<path fill="none" stroke="black" d="M1414.08,-243.37C1437.96,-230.6 1467.13,-215 1492.14,-201.63"/>
<polygon fill="black" stroke="black" points="1493.98,-204.62 1501.15,-196.82 1490.68,-198.44 1493.98,-204.62"/>
</g>
<!-- stage3_tp_allreduce2 -->
<g id="node54" class="node">
<title>stage3_tp_allreduce2</title>
<ellipse fill="lightblue" stroke="black" cx="1489" cy="-57" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="1489" y="-71" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1489" y="-60" font-family="Arial" font-size="10.00">MLP Output</text>
<text text-anchor="middle" x="1489" y="-49" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="1489" y="-38" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu6_layer60_mlp_down&#45;&gt;stage3_tp_allreduce2 -->
<g id="edge62" class="edge">
<title>gpu6_layer60_mlp_down&#45;&gt;stage3_tp_allreduce2</title>
<path fill="none" stroke="black" d="M1534.76,-144.69C1528.18,-132.23 1520.04,-116.8 1512.45,-102.42"/>
<polygon fill="black" stroke="black" points="1515.33,-100.38 1507.57,-93.17 1509.14,-103.65 1515.33,-100.38"/>
</g>
<!-- gpu6_lm_head -->
<g id="node47" class="node">
<title>gpu6_lm_head</title>
<polygon fill="lightgreen" stroke="black" points="1582.5,-295.54 1449.5,-295.54 1449.5,-243.54 1582.5,-243.54 1582.5,-295.54"/>
<text text-anchor="middle" x="1516" y="-283.54" font-family="Arial" font-size="10.00">LM Head</text>
<text text-anchor="middle" x="1516" y="-272.54" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="1516" y="-261.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="1516" y="-250.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 128256]</text>
</g>
<!-- final_allreduce -->
<g id="node57" class="node">
<title>final_allreduce</title>
<ellipse fill="lightblue" stroke="black" cx="1193" cy="-170.77" rx="94.09" ry="36.54"/>
<text text-anchor="middle" x="1193" y="-184.77" font-family="Arial" font-size="10.00">Final All&#45;Reduce</text>
<text text-anchor="middle" x="1193" y="-173.77" font-family="Arial" font-size="10.00">LM Head Output</text>
<text text-anchor="middle" x="1193" y="-162.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 128256]</text>
<text text-anchor="middle" x="1193" y="-151.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 128256]</text>
</g>
<!-- gpu6_lm_head&#45;&gt;final_allreduce -->
<g id="edge66" class="edge">
<title>gpu6_lm_head&#45;&gt;final_allreduce</title>
<path fill="none" stroke="black" d="M1449.37,-246.28C1446.21,-245.33 1443.07,-244.41 1440,-243.54 1374.48,-224.88 1356.21,-227.25 1291,-207.54 1283.69,-205.33 1276.12,-202.87 1268.59,-200.32"/>
<polygon fill="black" stroke="black" points="1269.68,-196.99 1259.08,-197.04 1267.39,-203.61 1269.68,-196.99"/>
</g>
<!-- gpu7_layer60_attn_qkv -->
<g id="node48" class="node">
<title>gpu7_layer60_attn_qkv</title>
<polygon fill="lightgreen" stroke="black" points="891.5,-295.54 742.5,-295.54 742.5,-243.54 891.5,-243.54 891.5,-295.54"/>
<text text-anchor="middle" x="817" y="-283.54" font-family="Arial" font-size="10.00">Layer 60 Attention QKV Linear</text>
<text text-anchor="middle" x="817" y="-272.54" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="817" y="-261.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="817" y="-250.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 3072]</text>
</g>
<!-- gpu7_layer60_attn_out -->
<g id="node49" class="node">
<title>gpu7_layer60_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1017.5,-196.77 860.5,-196.77 860.5,-144.77 1017.5,-144.77 1017.5,-196.77"/>
<text text-anchor="middle" x="939" y="-184.77" font-family="Arial" font-size="10.00">Layer 60 Attention Output Linear</text>
<text text-anchor="middle" x="939" y="-173.77" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="939" y="-162.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 1536]</text>
<text text-anchor="middle" x="939" y="-151.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu7_layer60_attn_qkv&#45;&gt;gpu7_layer60_attn_out -->
<g id="edge55" class="edge">
<title>gpu7_layer60_attn_qkv&#45;&gt;gpu7_layer60_attn_out</title>
<path fill="none" stroke="black" d="M848.74,-243.37C864.27,-231.05 883.12,-216.09 899.57,-203.05"/>
<polygon fill="black" stroke="black" points="901.76,-205.77 907.42,-196.82 897.41,-200.29 901.76,-205.77"/>
</g>
<!-- gpu7_layer60_attn_out&#45;&gt;stage3_tp_allreduce1 -->
<g id="edge57" class="edge">
<title>gpu7_layer60_attn_out&#45;&gt;stage3_tp_allreduce1</title>
<path fill="none" stroke="black" d="M940.35,-144.69C940.99,-132.79 941.77,-118.18 942.51,-104.37"/>
<polygon fill="black" stroke="black" points="946.03,-104.2 943.07,-94.02 939.04,-103.82 946.03,-104.2"/>
</g>
<!-- gpu7_layer60_mlp_up -->
<g id="node50" class="node">
<title>gpu7_layer60_mlp_up</title>
<polygon fill="lightgreen" stroke="black" points="724,-295.54 596,-295.54 596,-243.54 724,-243.54 724,-295.54"/>
<text text-anchor="middle" x="660" y="-283.54" font-family="Arial" font-size="10.00">Layer 60 MLP Up Linear</text>
<text text-anchor="middle" x="660" y="-272.54" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="660" y="-261.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 4096]</text>
<text text-anchor="middle" x="660" y="-250.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 28672]</text>
</g>
<!-- gpu7_layer60_mlp_down -->
<g id="node51" class="node">
<title>gpu7_layer60_mlp_down</title>
<polygon fill="lightgreen" stroke="black" points="820.5,-196.77 685.5,-196.77 685.5,-144.77 820.5,-144.77 820.5,-196.77"/>
<text text-anchor="middle" x="753" y="-184.77" font-family="Arial" font-size="10.00">Layer 60 MLP Down Linear</text>
<text text-anchor="middle" x="753" y="-173.77" font-family="Arial" font-size="10.00">Row Parallel</text>
<text text-anchor="middle" x="753" y="-162.77" font-family="Arial" font-size="10.00">Input: [64, 8192, 28672]</text>
<text text-anchor="middle" x="753" y="-151.77" font-family="Arial" font-size="10.00">Output: [64, 8192, 4096]</text>
</g>
<!-- gpu7_layer60_mlp_up&#45;&gt;gpu7_layer60_mlp_down -->
<g id="edge61" class="edge">
<title>gpu7_layer60_mlp_up&#45;&gt;gpu7_layer60_mlp_down</title>
<path fill="none" stroke="black" d="M684.19,-243.37C695.71,-231.38 709.62,-216.91 721.91,-204.12"/>
<polygon fill="black" stroke="black" points="724.52,-206.45 728.93,-196.82 719.48,-201.6 724.52,-206.45"/>
</g>
<!-- gpu7_layer60_mlp_down&#45;&gt;stage3_tp_allreduce2 -->
<g id="edge63" class="edge">
<title>gpu7_layer60_mlp_down&#45;&gt;stage3_tp_allreduce2</title>
<path fill="none" stroke="black" d="M814.3,-144.7C826.61,-140.5 839.58,-136.65 852,-134 1062.51,-89.01 1122.64,-133.2 1335,-98 1359.55,-93.93 1385.89,-87.77 1409.73,-81.5"/>
<polygon fill="black" stroke="black" points="1410.67,-84.87 1419.42,-78.9 1408.86,-78.11 1410.67,-84.87"/>
</g>
<!-- gpu7_lm_head -->
<g id="node52" class="node">
<title>gpu7_lm_head</title>
<polygon fill="lightgreen" stroke="black" points="1042.5,-295.54 909.5,-295.54 909.5,-243.54 1042.5,-243.54 1042.5,-295.54"/>
<text text-anchor="middle" x="976" y="-283.54" font-family="Arial" font-size="10.00">LM Head</text>
<text text-anchor="middle" x="976" y="-272.54" font-family="Arial" font-size="10.00">Column Parallel</text>
<text text-anchor="middle" x="976" y="-261.54" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="976" y="-250.54" font-family="Arial" font-size="10.00">Output: [64, 8192, 128256]</text>
</g>
<!-- gpu7_lm_head&#45;&gt;final_allreduce -->
<g id="edge67" class="edge">
<title>gpu7_lm_head&#45;&gt;final_allreduce</title>
<path fill="none" stroke="black" d="M1032.17,-243.49C1059.81,-231.16 1093.43,-216.17 1122.76,-203.09"/>
<polygon fill="black" stroke="black" points="1124.41,-206.19 1132.12,-198.92 1121.56,-199.8 1124.41,-206.19"/>
</g>
<!-- stage3_tp_allreduce1&#45;&gt;gpu6_layer60_mlp_up -->
<g id="edge58" class="edge">
<title>stage3_tp_allreduce1&#45;&gt;gpu6_layer60_mlp_up</title>
<path fill="none" stroke="black" d="M997.61,-86.4C1017.45,-99.01 1039.05,-115.26 1055,-134 1078.46,-161.56 1061.67,-185.01 1090,-207.54 1120.86,-232.07 1221.49,-249.78 1292.53,-259.6"/>
<polygon fill="black" stroke="black" points="1292.41,-263.12 1302.79,-261 1293.35,-256.18 1292.41,-263.12"/>
</g>
<!-- stage3_tp_allreduce1&#45;&gt;gpu7_layer60_mlp_up -->
<g id="edge59" class="edge">
<title>stage3_tp_allreduce1&#45;&gt;gpu7_layer60_mlp_up</title>
<path fill="none" stroke="black" d="M864.85,-70.76C795.13,-83.57 701.51,-105.49 677,-134 653.66,-161.15 652.05,-203.52 654.59,-233.44"/>
<polygon fill="black" stroke="black" points="651.12,-233.88 655.63,-243.47 658.08,-233.16 651.12,-233.88"/>
</g>
<!-- stage3_tp_allreduce2&#45;&gt;gpu6_lm_head -->
<g id="edge64" class="edge">
<title>stage3_tp_allreduce2&#45;&gt;gpu6_lm_head</title>
<path fill="none" stroke="black" d="M1557.63,-79.41C1583.46,-91.18 1610.15,-108.69 1625,-134 1641.54,-162.19 1641.53,-179.34 1625,-207.54 1617.08,-221.04 1604.96,-231.78 1591.64,-240.24"/>
<polygon fill="black" stroke="black" points="1589.59,-237.39 1582.74,-245.48 1593.14,-243.42 1589.59,-237.39"/>
</g>
<!-- stage3_tp_allreduce2&#45;&gt;gpu7_lm_head -->
<g id="edge65" class="edge">
<title>stage3_tp_allreduce2&#45;&gt;gpu7_lm_head</title>
<path fill="none" stroke="black" d="M1418.07,-78.14C1392.08,-85.06 1362.34,-92.46 1335,-98 1227.14,-119.87 1186.22,-80.57 1090,-134 1088.56,-134.8 1037.17,-195.76 1003.89,-235.34"/>
<polygon fill="black" stroke="black" points="1000.84,-233.52 997.09,-243.43 1006.2,-238.03 1000.84,-233.52"/>
</g>
<!-- p2p_recv_2_3 -->
<g id="node56" class="node">
<title>p2p_recv_2_3</title>
<ellipse fill="lightblue" stroke="black" cx="926" cy="-371.31" rx="86.03" ry="36.54"/>
<text text-anchor="middle" x="926" y="-385.31" font-family="Arial" font-size="10.00">Pipeline Receive</text>
<text text-anchor="middle" x="926" y="-374.31" font-family="Arial" font-size="10.00">Stage2→Stage3</text>
<text text-anchor="middle" x="926" y="-363.31" font-family="Arial" font-size="10.00">Input: [64, 8192, 8192]</text>
<text text-anchor="middle" x="926" y="-352.31" font-family="Arial" font-size="10.00">Output: [64, 8192, 8192]</text>
</g>
<!-- p2p_send_2_3&#45;&gt;p2p_recv_2_3 -->
<g id="edge51" class="edge">
<title>p2p_send_2_3&#45;&gt;p2p_recv_2_3</title>
<path fill="none" stroke="black" d="M926,-444.04C926,-435.87 926,-427.08 926,-418.55"/>
<polygon fill="black" stroke="black" points="929.5,-418.33 926,-408.33 922.5,-418.33 929.5,-418.33"/>
</g>
<!-- p2p_recv_2_3&#45;&gt;gpu6_layer60_attn_qkv -->
<g id="edge52" class="edge">
<title>p2p_recv_2_3&#45;&gt;gpu6_layer60_attn_qkv</title>
<path fill="none" stroke="black" d="M1012.45,-370.21C1167.68,-369.1 1487.23,-362.38 1592,-326.54 1608.21,-320.99 1624.24,-311.42 1637.82,-301.74"/>
<polygon fill="black" stroke="black" points="1639.99,-304.49 1645.95,-295.74 1635.82,-298.87 1639.99,-304.49"/>
</g>
<!-- p2p_recv_2_3&#45;&gt;gpu7_layer60_attn_qkv -->
<g id="edge53" class="edge">
<title>p2p_recv_2_3&#45;&gt;gpu7_layer60_attn_qkv</title>
<path fill="none" stroke="black" d="M890.31,-337.64C877.97,-326.35 864.16,-313.71 851.89,-302.47"/>
<polygon fill="black" stroke="black" points="854.21,-299.85 844.47,-295.68 849.48,-305.02 854.21,-299.85"/>
</g>
<!-- output -->
<g id="node58" class="node">
<title>output</title>
<polygon fill="lightpink" stroke="black" points="1193,-98 1060,-57 1193,-16 1326,-57 1193,-98"/>
<text text-anchor="middle" x="1193" y="-65.5" font-family="Arial" font-size="10.00">Final Output</text>
<text text-anchor="middle" x="1193" y="-54.5" font-family="Arial" font-size="10.00">Input: [64, 8192, 128256]</text>
<text text-anchor="middle" x="1193" y="-43.5" font-family="Arial" font-size="10.00">Output: [64, 8192, 128256]</text>
</g>
<!-- final_allreduce&#45;&gt;output -->
<g id="edge68" class="edge">
<title>final_allreduce&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1193,-133.79C1193,-125.71 1193,-117 1193,-108.46"/>
<polygon fill="black" stroke="black" points="1196.5,-108.18 1193,-98.18 1189.5,-108.18 1196.5,-108.18"/>
</g>
</g>
</svg>
