<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: optimized_communication_patterns Pages: 1 -->
<svg width="2160pt" height="194pt"
 viewBox="0.00 0.00 2160.00 193.87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.49 0.49) rotate(0) translate(4 390)">
<title>optimized_communication_patterns</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-390 4385.67,-390 4385.67,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage0</title>
<polygon fill="none" stroke="green" stroke-dasharray="5,2" points="872.92,-70 872.92,-192 1835.92,-192 1835.92,-70 872.92,-70"/>
<text text-anchor="middle" x="1354.42" y="-176.8" font-family="Times,serif" font-size="14.00">Pipeline Stage 0</text>
<text text-anchor="middle" x="1354.42" y="-161.8" font-family="Times,serif" font-size="14.00">GPUs 0&#45;7</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_stage1</title>
<polygon fill="none" stroke="blue" stroke-dasharray="5,2" points="2545.75,-126 2545.75,-248 3508.75,-248 3508.75,-126 2545.75,-126"/>
<text text-anchor="middle" x="3027.25" y="-232.8" font-family="Times,serif" font-size="14.00">Pipeline Stage 1</text>
<text text-anchor="middle" x="3027.25" y="-217.8" font-family="Times,serif" font-size="14.00">GPUs 8&#45;15</text>
</g>
<!-- mha_stage0 -->
<g id="node1" class="node">
<title>mha_stage0</title>
<polygon fill="lightcoral" stroke="black" points="1335.92,-146 880.92,-146 880.92,-78 1335.92,-78 1335.92,-146"/>
<text text-anchor="middle" x="1108.42" y="-130.8" font-family="Times,serif" font-size="14.00">MHA Layer 0</text>
<text text-anchor="middle" x="1108.42" y="-115.8" font-family="Times,serif" font-size="14.00">8&#45;way tensor parallel</text>
<text text-anchor="middle" x="1108.42" y="-100.8" font-family="Times,serif" font-size="14.00">Optimized communication</text>
<text text-anchor="middle" x="1108.42" y="-85.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=10000, embed_dim=8192]</text>
</g>
<!-- mlp_stage0 -->
<g id="node2" class="node">
<title>mlp_stage0</title>
<polygon fill="lightgreen" stroke="black" points="1827.92,-146 1372.92,-146 1372.92,-78 1827.92,-78 1827.92,-146"/>
<text text-anchor="middle" x="1600.42" y="-130.8" font-family="Times,serif" font-size="14.00">MLP Layer 0</text>
<text text-anchor="middle" x="1600.42" y="-115.8" font-family="Times,serif" font-size="14.00">8&#45;way tensor parallel</text>
<text text-anchor="middle" x="1600.42" y="-100.8" font-family="Times,serif" font-size="14.00">Overlap with next stage</text>
<text text-anchor="middle" x="1600.42" y="-85.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=10000, embed_dim=8192]</text>
</g>
<!-- mha_stage0&#45;&gt;mlp_stage0 -->
<g id="edge2" class="edge">
<title>mha_stage0&#45;&gt;mlp_stage0</title>
<path fill="none" stroke="black" d="M1336.13,-112C1344.86,-112 1353.63,-112 1362.38,-112"/>
<polygon fill="black" stroke="black" points="1362.64,-115.5 1372.64,-112 1362.64,-108.5 1362.64,-115.5"/>
</g>
<!-- optimized_allreduce -->
<g id="node7" class="node">
<title>optimized_allreduce</title>
<polygon fill="lightsteelblue" stroke="black" points="4136.2,-136 3855.44,-136 3783.21,0 4063.98,0 4136.2,-136"/>
<text text-anchor="middle" x="3959.71" y="-86.8" font-family="Times,serif" font-size="14.00">Optimized All&#45;Reduce</text>
<text text-anchor="middle" x="3959.71" y="-71.8" font-family="Times,serif" font-size="14.00">8 devices per stage</text>
<text text-anchor="middle" x="3959.71" y="-56.8" font-family="Times,serif" font-size="14.00">Ring topology</text>
<text text-anchor="middle" x="3959.71" y="-41.8" font-family="Times,serif" font-size="14.00">Reduced latency</text>
</g>
<!-- mha_stage0&#45;&gt;optimized_allreduce -->
<g id="edge8" class="edge">
<title>mha_stage0&#45;&gt;optimized_allreduce</title>
<path fill="none" stroke="black" d="M1240.23,-78C1338.36,-55.45 1476.4,-30 1599.42,-30 1599.42,-30 1599.42,-30 3274.25,-30 3455.52,-30 3663.38,-43.45 3802.03,-54.35"/>
<polygon fill="black" stroke="black" points="3802.06,-57.86 3812.3,-55.16 3802.61,-50.88 3802.06,-57.86"/>
</g>
<!-- pipeline_forward -->
<g id="node5" class="node">
<title>pipeline_forward</title>
<polygon fill="lightsteelblue" stroke="black" points="2437.67,-386 2060.12,-386 1963,-250 2340.54,-250 2437.67,-386"/>
<text text-anchor="middle" x="2200.33" y="-336.8" font-family="Times,serif" font-size="14.00">Pipeline Forward</text>
<text text-anchor="middle" x="2200.33" y="-321.8" font-family="Times,serif" font-size="14.00">Micro&#45;batch 0</text>
<text text-anchor="middle" x="2200.33" y="-306.8" font-family="Times,serif" font-size="14.00">Data transfer between stages</text>
<text text-anchor="middle" x="2200.33" y="-291.8" font-family="Times,serif" font-size="14.00">Latency hiding via overlap</text>
</g>
<!-- mlp_stage0&#45;&gt;pipeline_forward -->
<g id="edge3" class="edge">
<title>mlp_stage0&#45;&gt;pipeline_forward</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1694.79,-146.13C1767.64,-172.56 1871.47,-209.8 1962.92,-241 1968.48,-242.9 1974.12,-244.81 1979.81,-246.73"/>
<polygon fill="black" stroke="black" points="1978.84,-250.1 1989.43,-249.98 1981.07,-243.47 1978.84,-250.1"/>
<text text-anchor="middle" x="1895.42" y="-237.8" font-family="Times,serif" font-size="14.00">micro&#45;batch 0</text>
</g>
<!-- pipeline_overlap -->
<g id="node6" class="node">
<title>pipeline_overlap</title>
<polygon fill="lightsteelblue" stroke="black" points="2377.4,-232 2095.72,-232 2023.26,-96 2304.94,-96 2377.4,-232"/>
<text text-anchor="middle" x="2200.33" y="-182.8" font-family="Times,serif" font-size="14.00">Pipeline Overlap</text>
<text text-anchor="middle" x="2200.33" y="-167.8" font-family="Times,serif" font-size="14.00">Micro&#45;batch 1</text>
<text text-anchor="middle" x="2200.33" y="-152.8" font-family="Times,serif" font-size="14.00">Concurrent execution</text>
<text text-anchor="middle" x="2200.33" y="-137.8" font-family="Times,serif" font-size="14.00">Improved TPS</text>
</g>
<!-- mlp_stage0&#45;&gt;pipeline_overlap -->
<g id="edge4" class="edge">
<title>mlp_stage0&#45;&gt;pipeline_overlap</title>
<path fill="none" stroke="black" d="M1828.32,-131.73C1899.8,-137.95 1977.14,-144.68 2042.61,-150.37"/>
<polygon fill="black" stroke="black" points="2042.33,-153.86 2052.59,-151.24 2042.93,-146.88 2042.33,-153.86"/>
<text text-anchor="middle" x="1895.42" y="-144.8" font-family="Times,serif" font-size="14.00">micro&#45;batch 1</text>
</g>
<!-- mlp_stage0&#45;&gt;optimized_allreduce -->
<g id="edge9" class="edge">
<title>mlp_stage0&#45;&gt;optimized_allreduce</title>
<path fill="none" stroke="black" d="M1828.27,-87.43C1939.88,-77.35 2076.51,-68 2199.33,-68 2199.33,-68 2199.33,-68 3274.25,-68 3458.29,-68 3670.16,-68 3808.83,-68"/>
<polygon fill="black" stroke="black" points="3809.1,-71.5 3819.1,-68 3809.1,-64.5 3809.1,-71.5"/>
</g>
<!-- mha_stage1 -->
<g id="node3" class="node">
<title>mha_stage1</title>
<polygon fill="lightcoral" stroke="black" points="3008.75,-202 2553.75,-202 2553.75,-134 3008.75,-134 3008.75,-202"/>
<text text-anchor="middle" x="2781.25" y="-186.8" font-family="Times,serif" font-size="14.00">MHA Layer 1</text>
<text text-anchor="middle" x="2781.25" y="-171.8" font-family="Times,serif" font-size="14.00">8&#45;way tensor parallel</text>
<text text-anchor="middle" x="2781.25" y="-156.8" font-family="Times,serif" font-size="14.00">Optimized communication</text>
<text text-anchor="middle" x="2781.25" y="-141.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=10000, embed_dim=8192]</text>
</g>
<!-- mlp_stage1 -->
<g id="node4" class="node">
<title>mlp_stage1</title>
<polygon fill="lightgreen" stroke="black" points="3500.75,-202 3045.75,-202 3045.75,-134 3500.75,-134 3500.75,-202"/>
<text text-anchor="middle" x="3273.25" y="-186.8" font-family="Times,serif" font-size="14.00">MLP Layer 1</text>
<text text-anchor="middle" x="3273.25" y="-171.8" font-family="Times,serif" font-size="14.00">8&#45;way tensor parallel</text>
<text text-anchor="middle" x="3273.25" y="-156.8" font-family="Times,serif" font-size="14.00">Final output stage</text>
<text text-anchor="middle" x="3273.25" y="-141.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=10000, embed_dim=8192]</text>
</g>
<!-- mha_stage1&#45;&gt;mlp_stage1 -->
<g id="edge6" class="edge">
<title>mha_stage1&#45;&gt;mlp_stage1</title>
<path fill="none" stroke="black" d="M3008.96,-168C3017.7,-168 3026.46,-168 3035.21,-168"/>
<polygon fill="black" stroke="black" points="3035.48,-171.5 3045.48,-168 3035.48,-164.5 3035.48,-171.5"/>
</g>
<!-- mha_stage1&#45;&gt;optimized_allreduce -->
<g id="edge10" class="edge">
<title>mha_stage1&#45;&gt;optimized_allreduce</title>
<path fill="none" stroke="black" d="M2977.29,-133.95C3000.32,-130.59 3023.53,-127.5 3045.75,-125 3314.86,-94.72 3630.54,-79.49 3811.35,-72.69"/>
<polygon fill="black" stroke="black" points="3811.59,-76.19 3821.46,-72.32 3811.33,-69.19 3811.59,-76.19"/>
</g>
<!-- mlp_stage1&#45;&gt;optimized_allreduce -->
<g id="edge11" class="edge">
<title>mlp_stage1&#45;&gt;optimized_allreduce</title>
<path fill="none" stroke="black" d="M3501.21,-134.84C3606.24,-119.5 3727.66,-101.76 3819.01,-88.41"/>
<polygon fill="black" stroke="black" points="3819.76,-91.84 3829.15,-86.93 3818.75,-84.91 3819.76,-91.84"/>
</g>
<!-- model_output -->
<g id="node9" class="node">
<title>model_output</title>
<polygon fill="lightgreen" stroke="black" points="4381.63,-230 3710.45,-230 3537.79,-154 4208.97,-154 4381.63,-230"/>
<text text-anchor="middle" x="3959.71" y="-195.8" font-family="Times,serif" font-size="14.00">Model Output</text>
<text text-anchor="middle" x="3959.71" y="-180.8" font-family="Times,serif" font-size="14.00">[batch_size=1024, seq_len=10000, embed_dim=8192]</text>
</g>
<!-- mlp_stage1&#45;&gt;model_output -->
<g id="edge12" class="edge">
<title>mlp_stage1&#45;&gt;model_output</title>
<path fill="none" stroke="black" d="M3501.21,-175.96C3528.28,-176.91 3556.43,-177.89 3584.88,-178.89"/>
<polygon fill="black" stroke="black" points="3584.84,-182.39 3594.95,-179.25 3585.08,-175.4 3584.84,-182.39"/>
</g>
<!-- pipeline_forward&#45;&gt;mha_stage1 -->
<g id="edge5" class="edge">
<title>pipeline_forward&#45;&gt;mha_stage1</title>
<path fill="none" stroke="black" d="M2359.91,-276.91C2447.17,-254.3 2554.54,-226.48 2638.92,-204.62"/>
<polygon fill="black" stroke="black" points="2640.03,-207.95 2648.83,-202.05 2638.27,-201.17 2640.03,-207.95"/>
</g>
<!-- pipeline_overlap&#45;&gt;mha_stage1 -->
<g id="edge7" class="edge">
<title>pipeline_overlap&#45;&gt;mha_stage1</title>
<path fill="none" stroke="black" d="M2341.84,-164.97C2402.45,-165.39 2475.03,-165.89 2543.53,-166.36"/>
<polygon fill="black" stroke="black" points="2543.58,-169.86 2553.6,-166.43 2543.63,-162.86 2543.58,-169.86"/>
<text text-anchor="middle" x="2495.75" y="-169.8" font-family="Times,serif" font-size="14.00">overlapped</text>
</g>
<!-- model_input -->
<g id="node8" class="node">
<title>model_input</title>
<polygon fill="lightgreen" stroke="black" points="843.88,-150 172.7,-150 0.04,-74 671.22,-74 843.88,-150"/>
<text text-anchor="middle" x="421.96" y="-115.8" font-family="Times,serif" font-size="14.00">Model Input</text>
<text text-anchor="middle" x="421.96" y="-100.8" font-family="Times,serif" font-size="14.00">[batch_size=1024, seq_len=10000, embed_dim=8192]</text>
</g>
<!-- model_input&#45;&gt;mha_stage0 -->
<g id="edge1" class="edge">
<title>model_input&#45;&gt;mha_stage0</title>
<path fill="none" stroke="black" d="M757.67,-112C795.79,-112 834.03,-112 870.5,-112"/>
<polygon fill="black" stroke="black" points="870.74,-115.5 880.74,-112 870.74,-108.5 870.74,-115.5"/>
</g>
</g>
</svg>
