<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: MoE_Hybrid_Parallel Pages: 1 -->
<svg width="3295pt" height="1823pt"
 viewBox="0.00 0.00 3295.00 1822.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1818.5)">
<title>MoE_Hybrid_Parallel</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1818.5 3291,-1818.5 3291,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage0</title>
<polygon fill="lightgray" stroke="black" points="8,-69 8,-1765.5 3275,-1765.5 3275,-69 8,-69"/>
<text text-anchor="middle" x="1641.5" y="-1751.9" font-family="Arial" font-size="12.00">Pipeline Stage 0 (Layers 0&#45;1) &#45; GPUs 0&#45;3</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_layer0_attention</title>
<polygon fill="lightblue" stroke="black" points="16,-1003.54 16,-1736.5 3267,-1736.5 3267,-1003.54 16,-1003.54"/>
<text text-anchor="middle" x="1641.5" y="-1722.9" font-family="Arial" font-size="12.00">Layer 0 &#45; Multi&#45;Head Attention (TP=4)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_layer0_moe</title>
<polygon fill="lightcyan" stroke="black" points="1804,-178.54 1804,-995.54 2794,-995.54 2794,-178.54 1804,-178.54"/>
<text text-anchor="middle" x="2299" y="-981.94" font-family="Arial" font-size="12.00">Layer 0 &#45; MoE (EP=4)</text>
</g>
<!-- Input -->
<g id="node1" class="node">
<title>Input</title>
<polygon fill="lightcoral" stroke="black" points="2655.5,-1814.5 2408.5,-1814.5 2408.5,-1773.5 2655.5,-1773.5 2655.5,-1814.5"/>
<text text-anchor="middle" x="2532" y="-1802.5" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="2532" y="-1791.5" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,token_dim=1024]</text>
<text text-anchor="middle" x="2532" y="-1780.5" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,token_dim=1024]</text>
</g>
<!-- L0_Attention_Split -->
<g id="node2" class="node">
<title>L0_Attention_Split</title>
<polygon fill="lightgreen" stroke="black" points="2015.41,-1707.5 1636.16,-1707.5 1538.59,-1625.5 1917.84,-1625.5 2015.41,-1707.5"/>
<text text-anchor="middle" x="1777" y="-1675" font-family="Arial" font-size="10.00">Split Input</text>
<text text-anchor="middle" x="1777" y="-1664" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=4096]</text>
<text text-anchor="middle" x="1777" y="-1653" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=1024]</text>
</g>
<!-- Input&#45;&gt;L0_Attention_Split -->
<g id="edge1" class="edge">
<title>Input&#45;&gt;L0_Attention_Split</title>
<path fill="none" stroke="black" d="M2414.45,-1773.46C2310.73,-1756.22 2156.14,-1730.53 2025.17,-1708.76"/>
<polygon fill="black" stroke="black" points="2025.42,-1705.25 2014.98,-1707.06 2024.27,-1712.16 2025.42,-1705.25"/>
</g>
<!-- L0_Residual_Add -->
<g id="node27" class="node">
<title>L0_Residual_Add</title>
<polygon fill="lightgreen" stroke="black" points="2864.92,-1170.54 2193.74,-1170.54 2021.08,-1088.54 2692.26,-1088.54 2864.92,-1170.54"/>
<text text-anchor="middle" x="2443" y="-1138.04" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="2443" y="-1127.04" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=4096],[batch_size=8,seq_len=256,hidden=4096]</text>
<text text-anchor="middle" x="2443" y="-1116.04" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=4096]</text>
</g>
<!-- Input&#45;&gt;L0_Residual_Add -->
<g id="edge47" class="edge">
<title>Input&#45;&gt;L0_Residual_Add</title>
<path fill="none" stroke="black" d="M2655.83,-1782.16C2870.02,-1759.95 3287,-1700.02 3287,-1570 3287,-1570 3287,-1570 3287,-1320.02 3287,-1218.39 3051.05,-1171.25 2828.66,-1149.4"/>
<polygon fill="black" stroke="black" points="2828.7,-1145.89 2818.41,-1148.42 2828.03,-1152.86 2828.7,-1145.89"/>
</g>
<!-- L0_Q_Proj_GPU0 -->
<g id="node3" class="node">
<title>L0_Q_Proj_GPU0</title>
<polygon fill="lightblue" stroke="black" points="1632.5,-1589.5 1379.5,-1589.5 1379.5,-1548.5 1632.5,-1548.5 1632.5,-1589.5"/>
<text text-anchor="middle" x="1506" y="-1577.5" font-family="Arial" font-size="10.00">Q Projection GPU0</text>
<text text-anchor="middle" x="1506" y="-1566.5" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="1506" y="-1555.5" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
</g>
<!-- L0_Attention_Split&#45;&gt;L0_Q_Proj_GPU0 -->
<g id="edge2" class="edge">
<title>L0_Attention_Split&#45;&gt;L0_Q_Proj_GPU0</title>
<path fill="none" stroke="black" d="M1663.25,-1625.42C1631.76,-1614.32 1598.67,-1602.66 1571.01,-1592.91"/>
<polygon fill="black" stroke="black" points="1572.06,-1589.57 1561.46,-1589.55 1569.73,-1596.17 1572.06,-1589.57"/>
</g>
<!-- L0_K_Proj_GPU0 -->
<g id="node4" class="node">
<title>L0_K_Proj_GPU0</title>
<polygon fill="lightblue" stroke="black" points="2716.5,-1589.5 2463.5,-1589.5 2463.5,-1548.5 2716.5,-1548.5 2716.5,-1589.5"/>
<text text-anchor="middle" x="2590" y="-1577.5" font-family="Arial" font-size="10.00">K Projection GPU0</text>
<text text-anchor="middle" x="2590" y="-1566.5" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="2590" y="-1555.5" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
</g>
<!-- L0_Attention_Split&#45;&gt;L0_K_Proj_GPU0 -->
<g id="edge3" class="edge">
<title>L0_Attention_Split&#45;&gt;L0_K_Proj_GPU0</title>
<path fill="none" stroke="black" d="M1945.05,-1648.17C2079.81,-1633.91 2274.05,-1612.57 2453.05,-1589.74"/>
<polygon fill="black" stroke="black" points="2453.71,-1593.18 2463.18,-1588.44 2452.82,-1586.24 2453.71,-1593.18"/>
</g>
<!-- L0_V_Proj_GPU0 -->
<g id="node5" class="node">
<title>L0_V_Proj_GPU0</title>
<polygon fill="lightblue" stroke="black" points="819.5,-1589.5 566.5,-1589.5 566.5,-1548.5 819.5,-1548.5 819.5,-1589.5"/>
<text text-anchor="middle" x="693" y="-1577.5" font-family="Arial" font-size="10.00">V Projection GPU0</text>
<text text-anchor="middle" x="693" y="-1566.5" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="693" y="-1555.5" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
</g>
<!-- L0_Attention_Split&#45;&gt;L0_V_Proj_GPU0 -->
<g id="edge4" class="edge">
<title>L0_Attention_Split&#45;&gt;L0_V_Proj_GPU0</title>
<path fill="none" stroke="black" d="M1570.91,-1652.71C1381.08,-1640.04 1091.42,-1618.53 829.73,-1589.55"/>
<polygon fill="black" stroke="black" points="829.98,-1586.06 819.65,-1588.43 829.21,-1593.01 829.98,-1586.06"/>
</g>
<!-- L0_Q_Proj_GPU1 -->
<g id="node6" class="node">
<title>L0_Q_Proj_GPU1</title>
<polygon fill="lightblue" stroke="black" points="1903.5,-1589.5 1650.5,-1589.5 1650.5,-1548.5 1903.5,-1548.5 1903.5,-1589.5"/>
<text text-anchor="middle" x="1777" y="-1577.5" font-family="Arial" font-size="10.00">Q Projection GPU1</text>
<text text-anchor="middle" x="1777" y="-1566.5" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="1777" y="-1555.5" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
</g>
<!-- L0_Attention_Split&#45;&gt;L0_Q_Proj_GPU1 -->
<g id="edge5" class="edge">
<title>L0_Attention_Split&#45;&gt;L0_Q_Proj_GPU1</title>
<path fill="none" stroke="black" d="M1777,-1625.28C1777,-1616.7 1777,-1607.79 1777,-1599.7"/>
<polygon fill="black" stroke="black" points="1780.5,-1599.62 1777,-1589.62 1773.5,-1599.62 1780.5,-1599.62"/>
</g>
<!-- L0_K_Proj_GPU1 -->
<g id="node7" class="node">
<title>L0_K_Proj_GPU1</title>
<polygon fill="lightblue" stroke="black" points="2987.5,-1589.5 2734.5,-1589.5 2734.5,-1548.5 2987.5,-1548.5 2987.5,-1589.5"/>
<text text-anchor="middle" x="2861" y="-1577.5" font-family="Arial" font-size="10.00">K Projection GPU1</text>
<text text-anchor="middle" x="2861" y="-1566.5" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="2861" y="-1555.5" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
</g>
<!-- L0_Attention_Split&#45;&gt;L0_K_Proj_GPU1 -->
<g id="edge6" class="edge">
<title>L0_Attention_Split&#45;&gt;L0_K_Proj_GPU1</title>
<path fill="none" stroke="black" d="M1953.1,-1654.76C2141.54,-1642.49 2449.41,-1620.22 2724.03,-1589.7"/>
<polygon fill="black" stroke="black" points="2724.65,-1593.15 2734.2,-1588.56 2723.87,-1586.19 2724.65,-1593.15"/>
</g>
<!-- L0_V_Proj_GPU1 -->
<g id="node8" class="node">
<title>L0_V_Proj_GPU1</title>
<polygon fill="lightblue" stroke="black" points="1090.5,-1589.5 837.5,-1589.5 837.5,-1548.5 1090.5,-1548.5 1090.5,-1589.5"/>
<text text-anchor="middle" x="964" y="-1577.5" font-family="Arial" font-size="10.00">V Projection GPU1</text>
<text text-anchor="middle" x="964" y="-1566.5" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="964" y="-1555.5" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
</g>
<!-- L0_Attention_Split&#45;&gt;L0_V_Proj_GPU1 -->
<g id="edge7" class="edge">
<title>L0_Attention_Split&#45;&gt;L0_V_Proj_GPU1</title>
<path fill="none" stroke="black" d="M1558.8,-1642.72C1428.76,-1628.73 1260.18,-1609.86 1100.68,-1589.57"/>
<polygon fill="black" stroke="black" points="1101.03,-1586.09 1090.67,-1588.3 1100.15,-1593.03 1101.03,-1586.09"/>
</g>
<!-- L0_Q_Proj_GPU2 -->
<g id="node9" class="node">
<title>L0_Q_Proj_GPU2</title>
<polygon fill="lightblue" stroke="black" points="2174.5,-1589.5 1921.5,-1589.5 1921.5,-1548.5 2174.5,-1548.5 2174.5,-1589.5"/>
<text text-anchor="middle" x="2048" y="-1577.5" font-family="Arial" font-size="10.00">Q Projection GPU2</text>
<text text-anchor="middle" x="2048" y="-1566.5" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="2048" y="-1555.5" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
</g>
<!-- L0_Attention_Split&#45;&gt;L0_Q_Proj_GPU2 -->
<g id="edge8" class="edge">
<title>L0_Attention_Split&#45;&gt;L0_Q_Proj_GPU2</title>
<path fill="none" stroke="black" d="M1890.75,-1625.42C1922.24,-1614.32 1955.33,-1602.66 1982.99,-1592.91"/>
<polygon fill="black" stroke="black" points="1984.27,-1596.17 1992.54,-1589.55 1981.94,-1589.57 1984.27,-1596.17"/>
</g>
<!-- L0_K_Proj_GPU2 -->
<g id="node10" class="node">
<title>L0_K_Proj_GPU2</title>
<polygon fill="lightblue" stroke="black" points="3258.5,-1589.5 3005.5,-1589.5 3005.5,-1548.5 3258.5,-1548.5 3258.5,-1589.5"/>
<text text-anchor="middle" x="3132" y="-1577.5" font-family="Arial" font-size="10.00">K Projection GPU2</text>
<text text-anchor="middle" x="3132" y="-1566.5" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="3132" y="-1555.5" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
</g>
<!-- L0_Attention_Split&#45;&gt;L0_K_Proj_GPU2 -->
<g id="edge9" class="edge">
<title>L0_Attention_Split&#45;&gt;L0_K_Proj_GPU2</title>
<path fill="none" stroke="black" d="M1957.73,-1658.84C2194.07,-1649.08 2621.1,-1627.88 2994.99,-1589.67"/>
<polygon fill="black" stroke="black" points="2995.62,-1593.13 3005.21,-1588.63 2994.9,-1586.17 2995.62,-1593.13"/>
</g>
<!-- L0_V_Proj_GPU2 -->
<g id="node11" class="node">
<title>L0_V_Proj_GPU2</title>
<polygon fill="lightblue" stroke="black" points="277.5,-1589.5 24.5,-1589.5 24.5,-1548.5 277.5,-1548.5 277.5,-1589.5"/>
<text text-anchor="middle" x="151" y="-1577.5" font-family="Arial" font-size="10.00">V Projection GPU2</text>
<text text-anchor="middle" x="151" y="-1566.5" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="151" y="-1555.5" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
</g>
<!-- L0_Attention_Split&#45;&gt;L0_V_Proj_GPU2 -->
<g id="edge10" class="edge">
<title>L0_Attention_Split&#45;&gt;L0_V_Proj_GPU2</title>
<path fill="none" stroke="black" d="M1580.89,-1661.29C1297.42,-1653.89 756.62,-1634.91 287.81,-1589.64"/>
<polygon fill="black" stroke="black" points="288.08,-1586.15 277.79,-1588.67 287.41,-1593.12 288.08,-1586.15"/>
</g>
<!-- L0_Q_Proj_GPU3 -->
<g id="node12" class="node">
<title>L0_Q_Proj_GPU3</title>
<polygon fill="lightblue" stroke="black" points="1361.5,-1589.5 1108.5,-1589.5 1108.5,-1548.5 1361.5,-1548.5 1361.5,-1589.5"/>
<text text-anchor="middle" x="1235" y="-1577.5" font-family="Arial" font-size="10.00">Q Projection GPU3</text>
<text text-anchor="middle" x="1235" y="-1566.5" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="1235" y="-1555.5" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
</g>
<!-- L0_Attention_Split&#45;&gt;L0_Q_Proj_GPU3 -->
<g id="edge11" class="edge">
<title>L0_Attention_Split&#45;&gt;L0_Q_Proj_GPU3</title>
<path fill="none" stroke="black" d="M1549.89,-1625.49C1483.3,-1613.76 1413.08,-1601.38 1355.89,-1591.3"/>
<polygon fill="black" stroke="black" points="1356.19,-1587.8 1345.73,-1589.52 1354.97,-1594.7 1356.19,-1587.8"/>
</g>
<!-- L0_K_Proj_GPU3 -->
<g id="node13" class="node">
<title>L0_K_Proj_GPU3</title>
<polygon fill="lightblue" stroke="black" points="2445.5,-1589.5 2192.5,-1589.5 2192.5,-1548.5 2445.5,-1548.5 2445.5,-1589.5"/>
<text text-anchor="middle" x="2319" y="-1577.5" font-family="Arial" font-size="10.00">K Projection GPU3</text>
<text text-anchor="middle" x="2319" y="-1566.5" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="2319" y="-1555.5" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
</g>
<!-- L0_Attention_Split&#45;&gt;L0_K_Proj_GPU3 -->
<g id="edge12" class="edge">
<title>L0_Attention_Split&#45;&gt;L0_K_Proj_GPU3</title>
<path fill="none" stroke="black" d="M1933.04,-1638.01C2017.46,-1623.13 2120.16,-1605.04 2198.39,-1591.26"/>
<polygon fill="black" stroke="black" points="2199.05,-1594.69 2208.29,-1589.51 2197.83,-1587.8 2199.05,-1594.69"/>
</g>
<!-- L0_V_Proj_GPU3 -->
<g id="node14" class="node">
<title>L0_V_Proj_GPU3</title>
<polygon fill="lightblue" stroke="black" points="548.5,-1589.5 295.5,-1589.5 295.5,-1548.5 548.5,-1548.5 548.5,-1589.5"/>
<text text-anchor="middle" x="422" y="-1577.5" font-family="Arial" font-size="10.00">V Projection GPU3</text>
<text text-anchor="middle" x="422" y="-1566.5" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="422" y="-1555.5" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
</g>
<!-- L0_Attention_Split&#45;&gt;L0_V_Proj_GPU3 -->
<g id="edge13" class="edge">
<title>L0_Attention_Split&#45;&gt;L0_V_Proj_GPU3</title>
<path fill="none" stroke="black" d="M1577.06,-1657.96C1337.43,-1647.79 923.62,-1626.66 558.61,-1589.52"/>
<polygon fill="black" stroke="black" points="558.95,-1586.04 548.65,-1588.5 558.24,-1593 558.95,-1586.04"/>
</g>
<!-- L0_Q_AllReduce -->
<g id="node15" class="node">
<title>L0_Q_AllReduce</title>
<ellipse fill="yellow" stroke="black" cx="1777" cy="-1483.51" rx="181.04" ry="28.98"/>
<text text-anchor="middle" x="1777" y="-1492.01" font-family="Arial" font-size="10.00">All&#45;Reduce Q</text>
<text text-anchor="middle" x="1777" y="-1481.01" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,heads=2,d_k=128]x4</text>
<text text-anchor="middle" x="1777" y="-1470.01" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=8,d_k=128]</text>
</g>
<!-- L0_Q_Proj_GPU0&#45;&gt;L0_Q_AllReduce -->
<g id="edge14" class="edge">
<title>L0_Q_Proj_GPU0&#45;&gt;L0_Q_AllReduce</title>
<path fill="none" stroke="black" d="M1569.54,-1548.43C1604.29,-1537.72 1647.95,-1524.27 1686.24,-1512.48"/>
<polygon fill="black" stroke="black" points="1687.32,-1515.8 1695.85,-1509.51 1685.26,-1509.11 1687.32,-1515.8"/>
</g>
<!-- L0_K_AllReduce -->
<g id="node16" class="node">
<title>L0_K_AllReduce</title>
<ellipse fill="yellow" stroke="black" cx="2319" cy="-1483.51" rx="181.04" ry="28.98"/>
<text text-anchor="middle" x="2319" y="-1492.01" font-family="Arial" font-size="10.00">All&#45;Reduce K</text>
<text text-anchor="middle" x="2319" y="-1481.01" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,heads=2,d_k=128]x4</text>
<text text-anchor="middle" x="2319" y="-1470.01" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=8,d_k=128]</text>
</g>
<!-- L0_K_Proj_GPU0&#45;&gt;L0_K_AllReduce -->
<g id="edge18" class="edge">
<title>L0_K_Proj_GPU0&#45;&gt;L0_K_AllReduce</title>
<path fill="none" stroke="black" d="M2526.46,-1548.43C2491.71,-1537.72 2448.05,-1524.27 2409.76,-1512.48"/>
<polygon fill="black" stroke="black" points="2410.74,-1509.11 2400.15,-1509.51 2408.68,-1515.8 2410.74,-1509.11"/>
</g>
<!-- L0_V_AllReduce -->
<g id="node17" class="node">
<title>L0_V_AllReduce</title>
<ellipse fill="yellow" stroke="black" cx="1180" cy="-1483.51" rx="181.04" ry="28.98"/>
<text text-anchor="middle" x="1180" y="-1492.01" font-family="Arial" font-size="10.00">All&#45;Reduce V</text>
<text text-anchor="middle" x="1180" y="-1481.01" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,heads=2,d_k=128]x4</text>
<text text-anchor="middle" x="1180" y="-1470.01" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=8,d_k=128]</text>
</g>
<!-- L0_V_Proj_GPU0&#45;&gt;L0_V_AllReduce -->
<g id="edge22" class="edge">
<title>L0_V_Proj_GPU0&#45;&gt;L0_V_AllReduce</title>
<path fill="none" stroke="black" d="M806.87,-1548.48C879.37,-1536.05 973.52,-1519.91 1049.1,-1506.96"/>
<polygon fill="black" stroke="black" points="1049.9,-1510.37 1059.16,-1505.23 1048.72,-1503.47 1049.9,-1510.37"/>
</g>
<!-- L0_Q_Proj_GPU1&#45;&gt;L0_Q_AllReduce -->
<g id="edge15" class="edge">
<title>L0_Q_Proj_GPU1&#45;&gt;L0_Q_AllReduce</title>
<path fill="none" stroke="black" d="M1777,-1548.22C1777,-1540.59 1777,-1531.6 1777,-1522.82"/>
<polygon fill="black" stroke="black" points="1780.5,-1522.69 1777,-1512.69 1773.5,-1522.69 1780.5,-1522.69"/>
</g>
<!-- L0_K_Proj_GPU1&#45;&gt;L0_K_AllReduce -->
<g id="edge19" class="edge">
<title>L0_K_Proj_GPU1&#45;&gt;L0_K_AllReduce</title>
<path fill="none" stroke="black" d="M2734.27,-1548.48C2650.91,-1535.64 2541.85,-1518.84 2456.41,-1505.68"/>
<polygon fill="black" stroke="black" points="2456.79,-1502.2 2446.37,-1504.13 2455.72,-1509.12 2456.79,-1502.2"/>
</g>
<!-- L0_V_Proj_GPU1&#45;&gt;L0_V_AllReduce -->
<g id="edge23" class="edge">
<title>L0_V_Proj_GPU1&#45;&gt;L0_V_AllReduce</title>
<path fill="none" stroke="black" d="M1014.64,-1548.43C1041.08,-1538.21 1073.99,-1525.49 1103.46,-1514.1"/>
<polygon fill="black" stroke="black" points="1104.84,-1517.32 1112.9,-1510.45 1102.31,-1510.79 1104.84,-1517.32"/>
</g>
<!-- L0_Q_Proj_GPU2&#45;&gt;L0_Q_AllReduce -->
<g id="edge16" class="edge">
<title>L0_Q_Proj_GPU2&#45;&gt;L0_Q_AllReduce</title>
<path fill="none" stroke="black" d="M1984.46,-1548.43C1949.71,-1537.72 1906.05,-1524.27 1867.76,-1512.48"/>
<polygon fill="black" stroke="black" points="1868.74,-1509.11 1858.15,-1509.51 1866.68,-1515.8 1868.74,-1509.11"/>
</g>
<!-- L0_K_Proj_GPU2&#45;&gt;L0_K_AllReduce -->
<g id="edge20" class="edge">
<title>L0_K_Proj_GPU2&#45;&gt;L0_K_AllReduce</title>
<path fill="none" stroke="black" d="M3005.19,-1549.5C3002.44,-1549.16 2999.7,-1548.83 2997,-1548.5 2824.2,-1527.88 2625.97,-1509.82 2488.68,-1498.19"/>
<polygon fill="black" stroke="black" points="2488.75,-1494.68 2478.49,-1497.33 2488.16,-1501.66 2488.75,-1494.68"/>
</g>
<!-- L0_V_Proj_GPU2&#45;&gt;L0_V_AllReduce -->
<g id="edge24" class="edge">
<title>L0_V_Proj_GPU2&#45;&gt;L0_V_AllReduce</title>
<path fill="none" stroke="black" d="M277.8,-1549.42C280.56,-1549.1 283.29,-1548.8 286,-1548.5 532.17,-1521.95 817.7,-1503.68 998.56,-1493.66"/>
<polygon fill="black" stroke="black" points="998.91,-1497.15 1008.7,-1493.1 998.53,-1490.16 998.91,-1497.15"/>
</g>
<!-- L0_Q_Proj_GPU3&#45;&gt;L0_Q_AllReduce -->
<g id="edge17" class="edge">
<title>L0_Q_Proj_GPU3&#45;&gt;L0_Q_AllReduce</title>
<path fill="none" stroke="black" d="M1361.73,-1548.48C1445.09,-1535.64 1554.15,-1518.84 1639.59,-1505.68"/>
<polygon fill="black" stroke="black" points="1640.28,-1509.12 1649.63,-1504.13 1639.21,-1502.2 1640.28,-1509.12"/>
</g>
<!-- L0_K_Proj_GPU3&#45;&gt;L0_K_AllReduce -->
<g id="edge21" class="edge">
<title>L0_K_Proj_GPU3&#45;&gt;L0_K_AllReduce</title>
<path fill="none" stroke="black" d="M2319,-1548.22C2319,-1540.59 2319,-1531.6 2319,-1522.82"/>
<polygon fill="black" stroke="black" points="2322.5,-1522.69 2319,-1512.69 2315.5,-1522.69 2322.5,-1522.69"/>
</g>
<!-- L0_V_Proj_GPU3&#45;&gt;L0_V_AllReduce -->
<g id="edge25" class="edge">
<title>L0_V_Proj_GPU3&#45;&gt;L0_V_AllReduce</title>
<path fill="none" stroke="black" d="M548.66,-1549.67C551.81,-1549.27 554.92,-1548.88 558,-1548.5 712.86,-1529.44 889.9,-1511.61 1015.4,-1499.64"/>
<polygon fill="black" stroke="black" points="1015.86,-1503.11 1025.48,-1498.68 1015.19,-1496.15 1015.86,-1503.11"/>
</g>
<!-- L0_Attention_GPU0 -->
<g id="node18" class="node">
<title>L0_Attention_GPU0</title>
<polygon fill="lightblue" stroke="black" points="1632.5,-1418.52 1379.5,-1418.52 1379.5,-1377.52 1632.5,-1377.52 1632.5,-1418.52"/>
<text text-anchor="middle" x="1506" y="-1406.52" font-family="Arial" font-size="10.00">Attention Compute GPU0</text>
<text text-anchor="middle" x="1506" y="-1395.52" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,heads=8,d_k=128]</text>
<text text-anchor="middle" x="1506" y="-1384.52" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
</g>
<!-- L0_Q_AllReduce&#45;&gt;L0_Attention_GPU0 -->
<g id="edge26" class="edge">
<title>L0_Q_AllReduce&#45;&gt;L0_Attention_GPU0</title>
<path fill="none" stroke="black" d="M1696.06,-1457.58C1658.99,-1446.16 1615.39,-1432.72 1579.3,-1421.6"/>
<polygon fill="black" stroke="black" points="1579.92,-1418.13 1569.33,-1418.53 1577.86,-1424.82 1579.92,-1418.13"/>
</g>
<!-- L0_Attention_GPU1 -->
<g id="node19" class="node">
<title>L0_Attention_GPU1</title>
<polygon fill="lightblue" stroke="black" points="1903.5,-1418.52 1650.5,-1418.52 1650.5,-1377.52 1903.5,-1377.52 1903.5,-1418.52"/>
<text text-anchor="middle" x="1777" y="-1406.52" font-family="Arial" font-size="10.00">Attention Compute GPU1</text>
<text text-anchor="middle" x="1777" y="-1395.52" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,heads=8,d_k=128]</text>
<text text-anchor="middle" x="1777" y="-1384.52" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
</g>
<!-- L0_Q_AllReduce&#45;&gt;L0_Attention_GPU1 -->
<g id="edge27" class="edge">
<title>L0_Q_AllReduce&#45;&gt;L0_Attention_GPU1</title>
<path fill="none" stroke="black" d="M1777,-1454.25C1777,-1446 1777,-1436.96 1777,-1428.63"/>
<polygon fill="black" stroke="black" points="1780.5,-1428.57 1777,-1418.57 1773.5,-1428.57 1780.5,-1428.57"/>
</g>
<!-- L0_Attention_GPU2 -->
<g id="node20" class="node">
<title>L0_Attention_GPU2</title>
<polygon fill="lightblue" stroke="black" points="2174.5,-1418.52 1921.5,-1418.52 1921.5,-1377.52 2174.5,-1377.52 2174.5,-1418.52"/>
<text text-anchor="middle" x="2048" y="-1406.52" font-family="Arial" font-size="10.00">Attention Compute GPU2</text>
<text text-anchor="middle" x="2048" y="-1395.52" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,heads=8,d_k=128]</text>
<text text-anchor="middle" x="2048" y="-1384.52" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
</g>
<!-- L0_Q_AllReduce&#45;&gt;L0_Attention_GPU2 -->
<g id="edge28" class="edge">
<title>L0_Q_AllReduce&#45;&gt;L0_Attention_GPU2</title>
<path fill="none" stroke="black" d="M1857.94,-1457.58C1895.01,-1446.16 1938.61,-1432.72 1974.7,-1421.6"/>
<polygon fill="black" stroke="black" points="1976.14,-1424.82 1984.67,-1418.53 1974.08,-1418.13 1976.14,-1424.82"/>
</g>
<!-- L0_Attention_GPU3 -->
<g id="node21" class="node">
<title>L0_Attention_GPU3</title>
<polygon fill="lightblue" stroke="black" points="2445.5,-1418.52 2192.5,-1418.52 2192.5,-1377.52 2445.5,-1377.52 2445.5,-1418.52"/>
<text text-anchor="middle" x="2319" y="-1406.52" font-family="Arial" font-size="10.00">Attention Compute GPU3</text>
<text text-anchor="middle" x="2319" y="-1395.52" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,heads=8,d_k=128]</text>
<text text-anchor="middle" x="2319" y="-1384.52" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
</g>
<!-- L0_Q_AllReduce&#45;&gt;L0_Attention_GPU3 -->
<g id="edge29" class="edge">
<title>L0_Q_AllReduce&#45;&gt;L0_Attention_GPU3</title>
<path fill="none" stroke="black" d="M1904.42,-1462.89C1987.95,-1450.02 2097.07,-1433.21 2182.39,-1420.07"/>
<polygon fill="black" stroke="black" points="2183.06,-1423.5 2192.41,-1418.52 2181.99,-1416.59 2183.06,-1423.5"/>
</g>
<!-- L0_K_AllReduce&#45;&gt;L0_Attention_GPU0 -->
<g id="edge30" class="edge">
<title>L0_K_AllReduce&#45;&gt;L0_Attention_GPU0</title>
<path fill="none" stroke="black" d="M2159.75,-1469.64C2024.9,-1458.23 1826.21,-1440.21 1642.77,-1418.58"/>
<polygon fill="black" stroke="black" points="1643,-1415.09 1632.66,-1417.39 1642.18,-1422.04 1643,-1415.09"/>
</g>
<!-- L0_K_AllReduce&#45;&gt;L0_Attention_GPU1 -->
<g id="edge31" class="edge">
<title>L0_K_AllReduce&#45;&gt;L0_Attention_GPU1</title>
<path fill="none" stroke="black" d="M2191.58,-1462.89C2108.05,-1450.02 1998.93,-1433.21 1913.61,-1420.07"/>
<polygon fill="black" stroke="black" points="1914.01,-1416.59 1903.59,-1418.52 1912.94,-1423.5 1914.01,-1416.59"/>
</g>
<!-- L0_K_AllReduce&#45;&gt;L0_Attention_GPU2 -->
<g id="edge32" class="edge">
<title>L0_K_AllReduce&#45;&gt;L0_Attention_GPU2</title>
<path fill="none" stroke="black" d="M2238.06,-1457.58C2200.99,-1446.16 2157.39,-1432.72 2121.3,-1421.6"/>
<polygon fill="black" stroke="black" points="2121.92,-1418.13 2111.33,-1418.53 2119.86,-1424.82 2121.92,-1418.13"/>
</g>
<!-- L0_K_AllReduce&#45;&gt;L0_Attention_GPU3 -->
<g id="edge33" class="edge">
<title>L0_K_AllReduce&#45;&gt;L0_Attention_GPU3</title>
<path fill="none" stroke="black" d="M2319,-1454.25C2319,-1446 2319,-1436.96 2319,-1428.63"/>
<polygon fill="black" stroke="black" points="2322.5,-1428.57 2319,-1418.57 2315.5,-1428.57 2322.5,-1428.57"/>
</g>
<!-- L0_V_AllReduce&#45;&gt;L0_Attention_GPU0 -->
<g id="edge34" class="edge">
<title>L0_V_AllReduce&#45;&gt;L0_Attention_GPU0</title>
<path fill="none" stroke="black" d="M1273.42,-1458.59C1319.61,-1446.76 1374.97,-1432.58 1420.09,-1421.02"/>
<polygon fill="black" stroke="black" points="1421.04,-1424.4 1429.85,-1418.52 1419.3,-1417.61 1421.04,-1424.4"/>
</g>
<!-- L0_V_AllReduce&#45;&gt;L0_Attention_GPU1 -->
<g id="edge35" class="edge">
<title>L0_V_AllReduce&#45;&gt;L0_Attention_GPU1</title>
<path fill="none" stroke="black" d="M1314.47,-1464.1C1404.05,-1451.78 1524.7,-1435.09 1640.1,-1418.79"/>
<polygon fill="black" stroke="black" points="1640.76,-1422.23 1650.17,-1417.36 1639.78,-1415.3 1640.76,-1422.23"/>
</g>
<!-- L0_V_AllReduce&#45;&gt;L0_Attention_GPU2 -->
<g id="edge36" class="edge">
<title>L0_V_AllReduce&#45;&gt;L0_Attention_GPU2</title>
<path fill="none" stroke="black" d="M1343.3,-1470.91C1489.55,-1459.89 1710.12,-1441.76 1911.04,-1418.72"/>
<polygon fill="black" stroke="black" points="1911.66,-1422.17 1921.2,-1417.55 1910.86,-1415.22 1911.66,-1422.17"/>
</g>
<!-- L0_V_AllReduce&#45;&gt;L0_Attention_GPU3 -->
<g id="edge37" class="edge">
<title>L0_V_AllReduce&#45;&gt;L0_Attention_GPU3</title>
<path fill="none" stroke="black" d="M1343.36,-1470.96C1417.69,-1465.79 1506.78,-1459.7 1587,-1454.52 1848.9,-1437.62 1917.82,-1445.34 2181.92,-1418.69"/>
<polygon fill="black" stroke="black" points="2182.61,-1422.14 2192.21,-1417.65 2181.9,-1415.18 2182.61,-1422.14"/>
</g>
<!-- L0_O_Proj_GPU0 -->
<g id="node22" class="node">
<title>L0_O_Proj_GPU0</title>
<polygon fill="lightblue" stroke="black" points="1634.5,-1341.52 1389.5,-1341.52 1389.5,-1300.52 1634.5,-1300.52 1634.5,-1341.52"/>
<text text-anchor="middle" x="1512" y="-1329.52" font-family="Arial" font-size="10.00">O Projection GPU0</text>
<text text-anchor="middle" x="1512" y="-1318.52" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
<text text-anchor="middle" x="1512" y="-1307.52" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=1024]</text>
</g>
<!-- L0_Attention_GPU0&#45;&gt;L0_O_Proj_GPU0 -->
<g id="edge38" class="edge">
<title>L0_Attention_GPU0&#45;&gt;L0_O_Proj_GPU0</title>
<path fill="none" stroke="black" d="M1507.58,-1377.32C1508.2,-1369.48 1508.94,-1360.29 1509.63,-1351.68"/>
<polygon fill="black" stroke="black" points="1513.13,-1351.84 1510.43,-1341.6 1506.15,-1351.28 1513.13,-1351.84"/>
</g>
<!-- L0_O_Proj_GPU1 -->
<g id="node23" class="node">
<title>L0_O_Proj_GPU1</title>
<polygon fill="lightblue" stroke="black" points="1903.5,-1341.52 1658.5,-1341.52 1658.5,-1300.52 1903.5,-1300.52 1903.5,-1341.52"/>
<text text-anchor="middle" x="1781" y="-1329.52" font-family="Arial" font-size="10.00">O Projection GPU1</text>
<text text-anchor="middle" x="1781" y="-1318.52" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
<text text-anchor="middle" x="1781" y="-1307.52" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=1024]</text>
</g>
<!-- L0_Attention_GPU1&#45;&gt;L0_O_Proj_GPU1 -->
<g id="edge39" class="edge">
<title>L0_Attention_GPU1&#45;&gt;L0_O_Proj_GPU1</title>
<path fill="none" stroke="black" d="M1778.05,-1377.32C1778.47,-1369.48 1778.96,-1360.29 1779.42,-1351.68"/>
<polygon fill="black" stroke="black" points="1782.92,-1351.77 1779.96,-1341.6 1775.93,-1351.39 1782.92,-1351.77"/>
</g>
<!-- L0_O_Proj_GPU2 -->
<g id="node24" class="node">
<title>L0_O_Proj_GPU2</title>
<polygon fill="lightblue" stroke="black" points="2170.5,-1341.52 1925.5,-1341.52 1925.5,-1300.52 2170.5,-1300.52 2170.5,-1341.52"/>
<text text-anchor="middle" x="2048" y="-1329.52" font-family="Arial" font-size="10.00">O Projection GPU2</text>
<text text-anchor="middle" x="2048" y="-1318.52" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
<text text-anchor="middle" x="2048" y="-1307.52" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=1024]</text>
</g>
<!-- L0_Attention_GPU2&#45;&gt;L0_O_Proj_GPU2 -->
<g id="edge40" class="edge">
<title>L0_Attention_GPU2&#45;&gt;L0_O_Proj_GPU2</title>
<path fill="none" stroke="black" d="M2048,-1377.32C2048,-1369.48 2048,-1360.29 2048,-1351.68"/>
<polygon fill="black" stroke="black" points="2051.5,-1351.6 2048,-1341.6 2044.5,-1351.6 2051.5,-1351.6"/>
</g>
<!-- L0_O_Proj_GPU3 -->
<g id="node25" class="node">
<title>L0_O_Proj_GPU3</title>
<polygon fill="lightblue" stroke="black" points="2437.5,-1341.52 2192.5,-1341.52 2192.5,-1300.52 2437.5,-1300.52 2437.5,-1341.52"/>
<text text-anchor="middle" x="2315" y="-1329.52" font-family="Arial" font-size="10.00">O Projection GPU3</text>
<text text-anchor="middle" x="2315" y="-1318.52" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,heads=2,d_k=128]</text>
<text text-anchor="middle" x="2315" y="-1307.52" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=1024]</text>
</g>
<!-- L0_Attention_GPU3&#45;&gt;L0_O_Proj_GPU3 -->
<g id="edge41" class="edge">
<title>L0_Attention_GPU3&#45;&gt;L0_O_Proj_GPU3</title>
<path fill="none" stroke="black" d="M2317.95,-1377.32C2317.53,-1369.48 2317.04,-1360.29 2316.58,-1351.68"/>
<polygon fill="black" stroke="black" points="2320.07,-1351.39 2316.04,-1341.6 2313.08,-1351.77 2320.07,-1351.39"/>
</g>
<!-- L0_O_AllReduce -->
<g id="node26" class="node">
<title>L0_O_AllReduce</title>
<ellipse fill="yellow" stroke="black" cx="2048" cy="-1235.53" rx="164.51" ry="28.98"/>
<text text-anchor="middle" x="2048" y="-1244.03" font-family="Arial" font-size="10.00">All&#45;Reduce O</text>
<text text-anchor="middle" x="2048" y="-1233.03" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]x4</text>
<text text-anchor="middle" x="2048" y="-1222.03" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=4096]</text>
</g>
<!-- L0_O_Proj_GPU0&#45;&gt;L0_O_AllReduce -->
<g id="edge42" class="edge">
<title>L0_O_Proj_GPU0&#45;&gt;L0_O_AllReduce</title>
<path fill="none" stroke="black" d="M1634.63,-1300.92C1719.05,-1287.77 1831.07,-1270.32 1917.2,-1256.91"/>
<polygon fill="black" stroke="black" points="1917.96,-1260.33 1927.3,-1255.33 1916.88,-1253.41 1917.96,-1260.33"/>
</g>
<!-- L0_O_Proj_GPU1&#45;&gt;L0_O_AllReduce -->
<g id="edge43" class="edge">
<title>L0_O_Proj_GPU1&#45;&gt;L0_O_AllReduce</title>
<path fill="none" stroke="black" d="M1843.6,-1300.45C1878.27,-1289.61 1921.93,-1275.95 1959.99,-1264.05"/>
<polygon fill="black" stroke="black" points="1961.03,-1267.39 1969.53,-1261.07 1958.94,-1260.71 1961.03,-1267.39"/>
</g>
<!-- L0_O_Proj_GPU2&#45;&gt;L0_O_AllReduce -->
<g id="edge44" class="edge">
<title>L0_O_Proj_GPU2&#45;&gt;L0_O_AllReduce</title>
<path fill="none" stroke="black" d="M2048,-1300.24C2048,-1292.61 2048,-1283.62 2048,-1274.83"/>
<polygon fill="black" stroke="black" points="2051.5,-1274.71 2048,-1264.71 2044.5,-1274.71 2051.5,-1274.71"/>
</g>
<!-- L0_O_Proj_GPU3&#45;&gt;L0_O_AllReduce -->
<g id="edge45" class="edge">
<title>L0_O_Proj_GPU3&#45;&gt;L0_O_AllReduce</title>
<path fill="none" stroke="black" d="M2252.4,-1300.45C2217.73,-1289.61 2174.07,-1275.95 2136.01,-1264.05"/>
<polygon fill="black" stroke="black" points="2137.06,-1260.71 2126.47,-1261.07 2134.97,-1267.39 2137.06,-1260.71"/>
</g>
<!-- L0_O_AllReduce&#45;&gt;L0_Residual_Add -->
<g id="edge46" class="edge">
<title>L0_O_AllReduce&#45;&gt;L0_Residual_Add</title>
<path fill="none" stroke="black" d="M2137.14,-1211.06C2179.7,-1199.86 2231.98,-1186.1 2281.2,-1173.14"/>
<polygon fill="black" stroke="black" points="2282.22,-1176.49 2290.99,-1170.56 2280.43,-1169.72 2282.22,-1176.49"/>
</g>
<!-- L0_LayerNorm -->
<g id="node28" class="node">
<title>L0_LayerNorm</title>
<polygon fill="lightblue" stroke="black" points="2558,-1052.54 2328,-1052.54 2328,-1011.54 2558,-1011.54 2558,-1052.54"/>
<text text-anchor="middle" x="2443" y="-1040.54" font-family="Arial" font-size="10.00">Layer Norm</text>
<text text-anchor="middle" x="2443" y="-1029.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=4096]</text>
<text text-anchor="middle" x="2443" y="-1018.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=4096]</text>
</g>
<!-- L0_Residual_Add&#45;&gt;L0_LayerNorm -->
<g id="edge48" class="edge">
<title>L0_Residual_Add&#45;&gt;L0_LayerNorm</title>
<path fill="none" stroke="black" d="M2443,-1088.32C2443,-1079.74 2443,-1070.83 2443,-1062.73"/>
<polygon fill="black" stroke="black" points="2446.5,-1062.65 2443,-1052.65 2439.5,-1062.65 2446.5,-1062.65"/>
</g>
<!-- L0_Gate -->
<g id="node29" class="node">
<title>L0_Gate</title>
<polygon fill="lightblue" stroke="black" points="2340.5,-966.54 2117.5,-966.54 2117.5,-925.54 2340.5,-925.54 2340.5,-966.54"/>
<text text-anchor="middle" x="2229" y="-954.54" font-family="Arial" font-size="10.00">Gate GPU0</text>
<text text-anchor="middle" x="2229" y="-943.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=4096]</text>
<text text-anchor="middle" x="2229" y="-932.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,experts=4]</text>
</g>
<!-- L0_LayerNorm&#45;&gt;L0_Gate -->
<g id="edge49" class="edge">
<title>L0_LayerNorm&#45;&gt;L0_Gate</title>
<path fill="none" stroke="black" d="M2393.1,-1011.45C2361.85,-999.18 2321.41,-983.31 2288.49,-970.39"/>
<polygon fill="black" stroke="black" points="2289.57,-967.05 2278.98,-966.66 2287.01,-973.57 2289.57,-967.05"/>
</g>
<!-- L0_Expert0_GPU0 -->
<g id="node31" class="node">
<title>L0_Expert0_GPU0</title>
<polygon fill="lightblue" stroke="black" points="2042,-771.54 1812,-771.54 1812,-730.54 2042,-730.54 2042,-771.54"/>
<text text-anchor="middle" x="1927" y="-759.54" font-family="Arial" font-size="10.00">Expert 0 GPU0</text>
<text text-anchor="middle" x="1927" y="-748.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="1927" y="-737.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=1024]</text>
</g>
<!-- L0_LayerNorm&#45;&gt;L0_Expert0_GPU0 -->
<g id="edge55" class="edge">
<title>L0_LayerNorm&#45;&gt;L0_Expert0_GPU0</title>
<path fill="none" stroke="black" d="M2433.63,-1011.47C2431.5,-1006.38 2429.44,-1000.83 2428,-995.54 2425.23,-985.37 2410.56,-814.88 2403,-807.54 2348.66,-754.82 2144.9,-779.62 2052.34,-771.46"/>
<polygon fill="black" stroke="black" points="2052.47,-767.95 2042.15,-770.36 2051.72,-774.91 2052.47,-767.95"/>
</g>
<!-- L0_Expert1_GPU1 -->
<g id="node32" class="node">
<title>L0_Expert1_GPU1</title>
<polygon fill="lightblue" stroke="black" points="2290,-771.54 2060,-771.54 2060,-730.54 2290,-730.54 2290,-771.54"/>
<text text-anchor="middle" x="2175" y="-759.54" font-family="Arial" font-size="10.00">Expert 1 GPU1</text>
<text text-anchor="middle" x="2175" y="-748.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="2175" y="-737.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=1024]</text>
</g>
<!-- L0_LayerNorm&#45;&gt;L0_Expert1_GPU1 -->
<g id="edge56" class="edge">
<title>L0_LayerNorm&#45;&gt;L0_Expert1_GPU1</title>
<path fill="none" stroke="black" d="M2441.09,-1011.2C2435.84,-957.2 2421.39,-811.33 2418,-807.54 2409.18,-797.66 2353.24,-784.54 2297.26,-773.54"/>
<polygon fill="black" stroke="black" points="2297.67,-770.05 2287.19,-771.58 2296.34,-776.92 2297.67,-770.05"/>
</g>
<!-- L0_Expert2_GPU2 -->
<g id="node33" class="node">
<title>L0_Expert2_GPU2</title>
<polygon fill="lightblue" stroke="black" points="2538,-771.54 2308,-771.54 2308,-730.54 2538,-730.54 2538,-771.54"/>
<text text-anchor="middle" x="2423" y="-759.54" font-family="Arial" font-size="10.00">Expert 2 GPU2</text>
<text text-anchor="middle" x="2423" y="-748.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="2423" y="-737.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=1024]</text>
</g>
<!-- L0_LayerNorm&#45;&gt;L0_Expert2_GPU2 -->
<g id="edge57" class="edge">
<title>L0_LayerNorm&#45;&gt;L0_Expert2_GPU2</title>
<path fill="none" stroke="black" d="M2444.14,-1011.48C2446.06,-972.45 2448.77,-882.26 2438,-807.54 2436.75,-798.9 2434.61,-789.69 2432.33,-781.3"/>
<polygon fill="black" stroke="black" points="2435.65,-780.21 2429.52,-771.57 2428.93,-782.15 2435.65,-780.21"/>
</g>
<!-- L0_Expert3_GPU3 -->
<g id="node34" class="node">
<title>L0_Expert3_GPU3</title>
<polygon fill="lightblue" stroke="black" points="2786,-771.54 2556,-771.54 2556,-730.54 2786,-730.54 2786,-771.54"/>
<text text-anchor="middle" x="2671" y="-759.54" font-family="Arial" font-size="10.00">Expert 3 GPU3</text>
<text text-anchor="middle" x="2671" y="-748.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="2671" y="-737.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=1024]</text>
</g>
<!-- L0_LayerNorm&#45;&gt;L0_Expert3_GPU3 -->
<g id="edge58" class="edge">
<title>L0_LayerNorm&#45;&gt;L0_Expert3_GPU3</title>
<path fill="none" stroke="black" d="M2459.03,-1011.42C2498.93,-962.59 2602.77,-835.53 2648.65,-779.39"/>
<polygon fill="black" stroke="black" points="2651.37,-781.59 2654.99,-771.64 2645.95,-777.16 2651.37,-781.59"/>
</g>
<!-- L0_MoE_Residual_Add -->
<g id="node48" class="node">
<title>L0_MoE_Residual_Add</title>
<polygon fill="lightgreen" stroke="black" points="2785.92,-345.54 2114.74,-345.54 1942.08,-263.54 2613.26,-263.54 2785.92,-345.54"/>
<text text-anchor="middle" x="2364" y="-313.04" font-family="Arial" font-size="10.00">MoE Residual Add</text>
<text text-anchor="middle" x="2364" y="-302.04" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=4096],[batch_size=8,seq_len=256,hidden=4096]</text>
<text text-anchor="middle" x="2364" y="-291.04" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=4096]</text>
</g>
<!-- L0_LayerNorm&#45;&gt;L0_MoE_Residual_Add -->
<g id="edge76" class="edge">
<title>L0_LayerNorm&#45;&gt;L0_MoE_Residual_Add</title>
<path fill="none" stroke="black" d="M2558.04,-1020.99C2664.04,-1004.67 2805,-961.85 2805,-849.54 2805,-849.54 2805,-849.54 2805,-519.04 2805,-431.11 2733.09,-379.37 2647.35,-348.95"/>
<polygon fill="black" stroke="black" points="2648.24,-345.56 2637.65,-345.62 2645.97,-352.18 2648.24,-345.56"/>
</g>
<!-- L0_Router -->
<g id="node30" class="node">
<title>L0_Router</title>
<polygon fill="lightgreen" stroke="black" points="2393.51,-889.54 2045.91,-889.54 1956.49,-807.54 2304.09,-807.54 2393.51,-889.54"/>
<text text-anchor="middle" x="2175" y="-857.04" font-family="Arial" font-size="10.00">Router</text>
<text text-anchor="middle" x="2175" y="-846.04" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,experts=4]</text>
<text text-anchor="middle" x="2175" y="-835.04" font-family="Arial" font-size="10.00">Output:Routing decisions</text>
</g>
<!-- L0_Gate&#45;&gt;L0_Router -->
<g id="edge50" class="edge">
<title>L0_Gate&#45;&gt;L0_Router</title>
<path fill="none" stroke="black" d="M2217.81,-925.25C2213.41,-917.47 2208.14,-908.15 2202.83,-898.76"/>
<polygon fill="black" stroke="black" points="2205.73,-896.77 2197.76,-889.78 2199.63,-900.21 2205.73,-896.77"/>
</g>
<!-- L0_Router&#45;&gt;L0_Expert0_GPU0 -->
<g id="edge51" class="edge">
<title>L0_Router&#45;&gt;L0_Expert0_GPU0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2070.9,-807.45C2042.34,-796.45 2012.33,-784.9 1987.15,-775.2"/>
<polygon fill="black" stroke="black" points="1988.34,-771.91 1977.75,-771.58 1985.83,-778.44 1988.34,-771.91"/>
</g>
<!-- L0_Router&#45;&gt;L0_Expert1_GPU1 -->
<g id="edge52" class="edge">
<title>L0_Router&#45;&gt;L0_Expert1_GPU1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2175,-807.32C2175,-798.74 2175,-789.83 2175,-781.73"/>
<polygon fill="black" stroke="black" points="2178.5,-781.65 2175,-771.65 2171.5,-781.65 2178.5,-781.65"/>
</g>
<!-- L0_Router&#45;&gt;L0_Expert2_GPU2 -->
<g id="edge53" class="edge">
<title>L0_Router&#45;&gt;L0_Expert2_GPU2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2279.1,-807.45C2307.66,-796.45 2337.67,-784.9 2362.85,-775.2"/>
<polygon fill="black" stroke="black" points="2364.17,-778.44 2372.25,-771.58 2361.66,-771.91 2364.17,-778.44"/>
</g>
<!-- L0_Router&#45;&gt;L0_Expert3_GPU3 -->
<g id="edge54" class="edge">
<title>L0_Router&#45;&gt;L0_Expert3_GPU3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2317.8,-820.04C2394.74,-805.23 2488.27,-787.22 2559.75,-773.46"/>
<polygon fill="black" stroke="black" points="2560.52,-776.87 2569.68,-771.55 2559.2,-770 2560.52,-776.87"/>
</g>
<!-- L0_Expert0_FFN1 -->
<g id="node35" class="node">
<title>L0_Expert0_FFN1</title>
<polygon fill="lightblue" stroke="black" points="2038.5,-694.54 1815.5,-694.54 1815.5,-653.54 2038.5,-653.54 2038.5,-694.54"/>
<text text-anchor="middle" x="1927" y="-682.54" font-family="Arial" font-size="10.00">Expert0 FFN1 GPU0</text>
<text text-anchor="middle" x="1927" y="-671.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="1927" y="-660.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,ffn=2048]</text>
</g>
<!-- L0_Expert0_GPU0&#45;&gt;L0_Expert0_FFN1 -->
<g id="edge59" class="edge">
<title>L0_Expert0_GPU0&#45;&gt;L0_Expert0_FFN1</title>
<path fill="none" stroke="black" d="M1927,-730.33C1927,-722.5 1927,-713.31 1927,-704.7"/>
<polygon fill="black" stroke="black" points="1930.5,-704.61 1927,-694.61 1923.5,-704.61 1930.5,-704.61"/>
</g>
<!-- L0_Expert1_FFN1 -->
<g id="node38" class="node">
<title>L0_Expert1_FFN1</title>
<polygon fill="lightblue" stroke="black" points="2286.5,-694.54 2063.5,-694.54 2063.5,-653.54 2286.5,-653.54 2286.5,-694.54"/>
<text text-anchor="middle" x="2175" y="-682.54" font-family="Arial" font-size="10.00">Expert1 FFN1 GPU1</text>
<text text-anchor="middle" x="2175" y="-671.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="2175" y="-660.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,ffn=2048]</text>
</g>
<!-- L0_Expert1_GPU1&#45;&gt;L0_Expert1_FFN1 -->
<g id="edge62" class="edge">
<title>L0_Expert1_GPU1&#45;&gt;L0_Expert1_FFN1</title>
<path fill="none" stroke="black" d="M2175,-730.33C2175,-722.5 2175,-713.31 2175,-704.7"/>
<polygon fill="black" stroke="black" points="2178.5,-704.61 2175,-694.61 2171.5,-704.61 2178.5,-704.61"/>
</g>
<!-- L0_Expert2_FFN1 -->
<g id="node41" class="node">
<title>L0_Expert2_FFN1</title>
<polygon fill="lightblue" stroke="black" points="2534.5,-694.54 2311.5,-694.54 2311.5,-653.54 2534.5,-653.54 2534.5,-694.54"/>
<text text-anchor="middle" x="2423" y="-682.54" font-family="Arial" font-size="10.00">Expert2 FFN1 GPU2</text>
<text text-anchor="middle" x="2423" y="-671.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="2423" y="-660.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,ffn=2048]</text>
</g>
<!-- L0_Expert2_GPU2&#45;&gt;L0_Expert2_FFN1 -->
<g id="edge65" class="edge">
<title>L0_Expert2_GPU2&#45;&gt;L0_Expert2_FFN1</title>
<path fill="none" stroke="black" d="M2423,-730.33C2423,-722.5 2423,-713.31 2423,-704.7"/>
<polygon fill="black" stroke="black" points="2426.5,-704.61 2423,-694.61 2419.5,-704.61 2426.5,-704.61"/>
</g>
<!-- L0_Expert3_FFN1 -->
<g id="node44" class="node">
<title>L0_Expert3_FFN1</title>
<polygon fill="lightblue" stroke="black" points="2782.5,-694.54 2559.5,-694.54 2559.5,-653.54 2782.5,-653.54 2782.5,-694.54"/>
<text text-anchor="middle" x="2671" y="-682.54" font-family="Arial" font-size="10.00">Expert3 FFN1 GPU3</text>
<text text-anchor="middle" x="2671" y="-671.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]</text>
<text text-anchor="middle" x="2671" y="-660.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,ffn=2048]</text>
</g>
<!-- L0_Expert3_GPU3&#45;&gt;L0_Expert3_FFN1 -->
<g id="edge68" class="edge">
<title>L0_Expert3_GPU3&#45;&gt;L0_Expert3_FFN1</title>
<path fill="none" stroke="black" d="M2671,-730.33C2671,-722.5 2671,-713.31 2671,-704.7"/>
<polygon fill="black" stroke="black" points="2674.5,-704.61 2671,-694.61 2667.5,-704.61 2674.5,-704.61"/>
</g>
<!-- L0_Expert0_GELU -->
<g id="node36" class="node">
<title>L0_Expert0_GELU</title>
<polygon fill="lightblue" stroke="black" points="2033,-617.54 1821,-617.54 1821,-576.54 2033,-576.54 2033,-617.54"/>
<text text-anchor="middle" x="1927" y="-605.54" font-family="Arial" font-size="10.00">Expert0 GELU GPU0</text>
<text text-anchor="middle" x="1927" y="-594.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,ffn=2048]</text>
<text text-anchor="middle" x="1927" y="-583.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,ffn=2048]</text>
</g>
<!-- L0_Expert0_FFN1&#45;&gt;L0_Expert0_GELU -->
<g id="edge60" class="edge">
<title>L0_Expert0_FFN1&#45;&gt;L0_Expert0_GELU</title>
<path fill="none" stroke="black" d="M1927,-653.33C1927,-645.5 1927,-636.31 1927,-627.7"/>
<polygon fill="black" stroke="black" points="1930.5,-627.61 1927,-617.61 1923.5,-627.61 1930.5,-627.61"/>
</g>
<!-- L0_Expert0_FFN2 -->
<g id="node37" class="node">
<title>L0_Expert0_FFN2</title>
<polygon fill="lightblue" stroke="black" points="2042,-540.54 1812,-540.54 1812,-499.54 2042,-499.54 2042,-540.54"/>
<text text-anchor="middle" x="1927" y="-528.54" font-family="Arial" font-size="10.00">Expert0 FFN2 GPU0</text>
<text text-anchor="middle" x="1927" y="-517.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,ffn=2048]</text>
<text text-anchor="middle" x="1927" y="-506.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=1024]</text>
</g>
<!-- L0_Expert0_GELU&#45;&gt;L0_Expert0_FFN2 -->
<g id="edge61" class="edge">
<title>L0_Expert0_GELU&#45;&gt;L0_Expert0_FFN2</title>
<path fill="none" stroke="black" d="M1927,-576.33C1927,-568.5 1927,-559.31 1927,-550.7"/>
<polygon fill="black" stroke="black" points="1930.5,-550.61 1927,-540.61 1923.5,-550.61 1930.5,-550.61"/>
</g>
<!-- L0_Expert_Aggregate -->
<g id="node47" class="node">
<title>L0_Expert_Aggregate</title>
<polygon fill="lightgreen" stroke="black" points="2605.63,-463.54 2221.25,-463.54 2122.37,-381.54 2506.75,-381.54 2605.63,-463.54"/>
<text text-anchor="middle" x="2364" y="-431.04" font-family="Arial" font-size="10.00">Aggregate Experts</text>
<text text-anchor="middle" x="2364" y="-420.04" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=1024]x4</text>
<text text-anchor="middle" x="2364" y="-409.04" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=4096]</text>
</g>
<!-- L0_Expert0_FFN2&#45;&gt;L0_Expert_Aggregate -->
<g id="edge71" class="edge">
<title>L0_Expert0_FFN2&#45;&gt;L0_Expert_Aggregate</title>
<path fill="none" stroke="black" d="M2016.49,-499.48C2070.06,-487.78 2139.74,-472.55 2202.64,-458.8"/>
<polygon fill="black" stroke="black" points="2203.65,-462.16 2212.67,-456.61 2202.15,-455.33 2203.65,-462.16"/>
</g>
<!-- L0_Expert1_GELU -->
<g id="node39" class="node">
<title>L0_Expert1_GELU</title>
<polygon fill="lightblue" stroke="black" points="2281,-617.54 2069,-617.54 2069,-576.54 2281,-576.54 2281,-617.54"/>
<text text-anchor="middle" x="2175" y="-605.54" font-family="Arial" font-size="10.00">Expert1 GELU GPU1</text>
<text text-anchor="middle" x="2175" y="-594.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,ffn=2048]</text>
<text text-anchor="middle" x="2175" y="-583.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,ffn=2048]</text>
</g>
<!-- L0_Expert1_FFN1&#45;&gt;L0_Expert1_GELU -->
<g id="edge63" class="edge">
<title>L0_Expert1_FFN1&#45;&gt;L0_Expert1_GELU</title>
<path fill="none" stroke="black" d="M2175,-653.33C2175,-645.5 2175,-636.31 2175,-627.7"/>
<polygon fill="black" stroke="black" points="2178.5,-627.61 2175,-617.61 2171.5,-627.61 2178.5,-627.61"/>
</g>
<!-- L0_Expert1_FFN2 -->
<g id="node40" class="node">
<title>L0_Expert1_FFN2</title>
<polygon fill="lightblue" stroke="black" points="2290,-540.54 2060,-540.54 2060,-499.54 2290,-499.54 2290,-540.54"/>
<text text-anchor="middle" x="2175" y="-528.54" font-family="Arial" font-size="10.00">Expert1 FFN2 GPU1</text>
<text text-anchor="middle" x="2175" y="-517.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,ffn=2048]</text>
<text text-anchor="middle" x="2175" y="-506.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=1024]</text>
</g>
<!-- L0_Expert1_GELU&#45;&gt;L0_Expert1_FFN2 -->
<g id="edge64" class="edge">
<title>L0_Expert1_GELU&#45;&gt;L0_Expert1_FFN2</title>
<path fill="none" stroke="black" d="M2175,-576.33C2175,-568.5 2175,-559.31 2175,-550.7"/>
<polygon fill="black" stroke="black" points="2178.5,-550.61 2175,-540.61 2171.5,-550.61 2178.5,-550.61"/>
</g>
<!-- L0_Expert1_FFN2&#45;&gt;L0_Expert_Aggregate -->
<g id="edge72" class="edge">
<title>L0_Expert1_FFN2&#45;&gt;L0_Expert_Aggregate</title>
<path fill="none" stroke="black" d="M2213.7,-499.48C2231.74,-490.37 2254,-479.12 2275.81,-468.1"/>
<polygon fill="black" stroke="black" points="2277.43,-471.2 2284.78,-463.57 2274.28,-464.95 2277.43,-471.2"/>
</g>
<!-- L0_Expert2_GELU -->
<g id="node42" class="node">
<title>L0_Expert2_GELU</title>
<polygon fill="lightblue" stroke="black" points="2529,-617.54 2317,-617.54 2317,-576.54 2529,-576.54 2529,-617.54"/>
<text text-anchor="middle" x="2423" y="-605.54" font-family="Arial" font-size="10.00">Expert2 GELU GPU2</text>
<text text-anchor="middle" x="2423" y="-594.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,ffn=2048]</text>
<text text-anchor="middle" x="2423" y="-583.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,ffn=2048]</text>
</g>
<!-- L0_Expert2_FFN1&#45;&gt;L0_Expert2_GELU -->
<g id="edge66" class="edge">
<title>L0_Expert2_FFN1&#45;&gt;L0_Expert2_GELU</title>
<path fill="none" stroke="black" d="M2423,-653.33C2423,-645.5 2423,-636.31 2423,-627.7"/>
<polygon fill="black" stroke="black" points="2426.5,-627.61 2423,-617.61 2419.5,-627.61 2426.5,-627.61"/>
</g>
<!-- L0_Expert2_FFN2 -->
<g id="node43" class="node">
<title>L0_Expert2_FFN2</title>
<polygon fill="lightblue" stroke="black" points="2538,-540.54 2308,-540.54 2308,-499.54 2538,-499.54 2538,-540.54"/>
<text text-anchor="middle" x="2423" y="-528.54" font-family="Arial" font-size="10.00">Expert2 FFN2 GPU2</text>
<text text-anchor="middle" x="2423" y="-517.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,ffn=2048]</text>
<text text-anchor="middle" x="2423" y="-506.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=1024]</text>
</g>
<!-- L0_Expert2_GELU&#45;&gt;L0_Expert2_FFN2 -->
<g id="edge67" class="edge">
<title>L0_Expert2_GELU&#45;&gt;L0_Expert2_FFN2</title>
<path fill="none" stroke="black" d="M2423,-576.33C2423,-568.5 2423,-559.31 2423,-550.7"/>
<polygon fill="black" stroke="black" points="2426.5,-550.61 2423,-540.61 2419.5,-550.61 2426.5,-550.61"/>
</g>
<!-- L0_Expert2_FFN2&#45;&gt;L0_Expert_Aggregate -->
<g id="edge73" class="edge">
<title>L0_Expert2_FFN2&#45;&gt;L0_Expert_Aggregate</title>
<path fill="none" stroke="black" d="M2410.78,-499.25C2405.92,-491.39 2400.09,-481.96 2394.23,-472.47"/>
<polygon fill="black" stroke="black" points="2397.1,-470.45 2388.86,-463.78 2391.14,-474.13 2397.1,-470.45"/>
</g>
<!-- L0_Expert3_GELU -->
<g id="node45" class="node">
<title>L0_Expert3_GELU</title>
<polygon fill="lightblue" stroke="black" points="2777,-617.54 2565,-617.54 2565,-576.54 2777,-576.54 2777,-617.54"/>
<text text-anchor="middle" x="2671" y="-605.54" font-family="Arial" font-size="10.00">Expert3 GELU GPU3</text>
<text text-anchor="middle" x="2671" y="-594.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,ffn=2048]</text>
<text text-anchor="middle" x="2671" y="-583.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,ffn=2048]</text>
</g>
<!-- L0_Expert3_FFN1&#45;&gt;L0_Expert3_GELU -->
<g id="edge69" class="edge">
<title>L0_Expert3_FFN1&#45;&gt;L0_Expert3_GELU</title>
<path fill="none" stroke="black" d="M2671,-653.33C2671,-645.5 2671,-636.31 2671,-627.7"/>
<polygon fill="black" stroke="black" points="2674.5,-627.61 2671,-617.61 2667.5,-627.61 2674.5,-627.61"/>
</g>
<!-- L0_Expert3_FFN2 -->
<g id="node46" class="node">
<title>L0_Expert3_FFN2</title>
<polygon fill="lightblue" stroke="black" points="2786,-540.54 2556,-540.54 2556,-499.54 2786,-499.54 2786,-540.54"/>
<text text-anchor="middle" x="2671" y="-528.54" font-family="Arial" font-size="10.00">Expert3 FFN2 GPU3</text>
<text text-anchor="middle" x="2671" y="-517.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,ffn=2048]</text>
<text text-anchor="middle" x="2671" y="-506.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=1024]</text>
</g>
<!-- L0_Expert3_GELU&#45;&gt;L0_Expert3_FFN2 -->
<g id="edge70" class="edge">
<title>L0_Expert3_GELU&#45;&gt;L0_Expert3_FFN2</title>
<path fill="none" stroke="black" d="M2671,-576.33C2671,-568.5 2671,-559.31 2671,-550.7"/>
<polygon fill="black" stroke="black" points="2674.5,-550.61 2671,-540.61 2667.5,-550.61 2674.5,-550.61"/>
</g>
<!-- L0_Expert3_FFN2&#45;&gt;L0_Expert_Aggregate -->
<g id="edge74" class="edge">
<title>L0_Expert3_FFN2&#45;&gt;L0_Expert_Aggregate</title>
<path fill="none" stroke="black" d="M2608.13,-499.48C2577.54,-489.97 2539.46,-478.12 2502.54,-466.64"/>
<polygon fill="black" stroke="black" points="2503.27,-463.2 2492.68,-463.57 2501.19,-469.88 2503.27,-463.2"/>
</g>
<!-- L0_Expert_Aggregate&#45;&gt;L0_MoE_Residual_Add -->
<g id="edge75" class="edge">
<title>L0_Expert_Aggregate&#45;&gt;L0_MoE_Residual_Add</title>
<path fill="none" stroke="black" d="M2364,-381.29C2364,-373.11 2364,-364.4 2364,-355.91"/>
<polygon fill="black" stroke="black" points="2367.5,-355.71 2364,-345.71 2360.5,-355.71 2367.5,-355.71"/>
</g>
<!-- L0_MoE_LayerNorm -->
<g id="node49" class="node">
<title>L0_MoE_LayerNorm</title>
<polygon fill="lightblue" stroke="black" points="2479,-227.54 2249,-227.54 2249,-186.54 2479,-186.54 2479,-227.54"/>
<text text-anchor="middle" x="2364" y="-215.54" font-family="Arial" font-size="10.00">MoE Layer Norm</text>
<text text-anchor="middle" x="2364" y="-204.54" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=4096]</text>
<text text-anchor="middle" x="2364" y="-193.54" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=4096]</text>
</g>
<!-- L0_MoE_Residual_Add&#45;&gt;L0_MoE_LayerNorm -->
<g id="edge77" class="edge">
<title>L0_MoE_Residual_Add&#45;&gt;L0_MoE_LayerNorm</title>
<path fill="none" stroke="black" d="M2364,-263.32C2364,-254.74 2364,-245.83 2364,-237.73"/>
<polygon fill="black" stroke="black" points="2367.5,-237.65 2364,-227.65 2360.5,-237.65 2367.5,-237.65"/>
</g>
<!-- Stage0_to_Stage1 -->
<g id="node50" class="node">
<title>Stage0_to_Stage1</title>
<ellipse fill="yellow" stroke="black" cx="2364" cy="-113.77" rx="162.77" ry="36.54"/>
<text text-anchor="middle" x="2364" y="-127.77" font-family="Arial" font-size="10.00">Pipeline Comm</text>
<text text-anchor="middle" x="2364" y="-116.77" font-family="Arial" font-size="10.00">Stage0Stage1</text>
<text text-anchor="middle" x="2364" y="-105.77" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=4096]</text>
<text text-anchor="middle" x="2364" y="-94.77" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=4096]</text>
</g>
<!-- L0_MoE_LayerNorm&#45;&gt;Stage0_to_Stage1 -->
<g id="edge78" class="edge">
<title>L0_MoE_LayerNorm&#45;&gt;Stage0_to_Stage1</title>
<path fill="none" stroke="black" d="M2364,-186.23C2364,-178.69 2364,-169.75 2364,-160.78"/>
<polygon fill="black" stroke="black" points="2367.5,-160.72 2364,-150.73 2360.5,-160.73 2367.5,-160.72"/>
</g>
<!-- Output -->
<g id="node51" class="node">
<title>Output</title>
<polygon fill="lightcoral" stroke="black" points="2479,-41 2249,-41 2249,0 2479,0 2479,-41"/>
<text text-anchor="middle" x="2364" y="-29" font-family="Arial" font-size="10.00">Output</text>
<text text-anchor="middle" x="2364" y="-18" font-family="Arial" font-size="10.00">Input:[batch_size=8,seq_len=256,hidden=4096]</text>
<text text-anchor="middle" x="2364" y="-7" font-family="Arial" font-size="10.00">Output:[batch_size=8,seq_len=256,hidden=4096]</text>
</g>
<!-- Stage0_to_Stage1&#45;&gt;Output -->
<g id="edge79" class="edge">
<title>Stage0_to_Stage1&#45;&gt;Output</title>
<path fill="none" stroke="black" d="M2364,-76.96C2364,-68.49 2364,-59.54 2364,-51.36"/>
<polygon fill="black" stroke="black" points="2367.5,-51.16 2364,-41.16 2360.5,-51.16 2367.5,-51.16"/>
</g>
</g>
</svg>
