// Proposed MoE Deployment: EP16_OneExpertPerGPU
digraph proposed_moe_deployment {
	rankdir=TB size="20,30"
	node [shape=rectangle]
	input [label="Input\nInput: [batch_size=128, seq_len=10000, hidden=4096]" shape=ellipse]
	routing [label="Gating\nTop-2 Expert Selection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, expert_routing=2]" shape=diamond]
	layer0_mha_qkv [label="MHA QKV Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nAll GPUs" fillcolor=lightblue style=filled]
	layer0_mha_attn [label="MHA Attention\nInput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightgreen style=filled]
	layer0_mha_out [label="MHA Output Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightblue style=filled]
	layer0_res1 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer0_ln1 [label="Layer Norm\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=yellow style=filled]
	layer0_expert_routing [label="Expert Routing\nTop-2 Selection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, expert_id=2]\nAll GPUs" fillcolor=orange shape=diamond style=filled]
	layer0_token_distribution [label="Token Distribution\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: Tokens routed to 2 experts\nAll GPUs → Expert GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer0_expert0_gate [label="Expert 0 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer0_expert0_up [label="Expert 0 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer0_expert0_act [label="Expert 0 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightgreen style=filled]
	layer0_expert0_down [label="Expert 0 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 0" fillcolor=lightblue style=filled]
	layer0_expert1_gate [label="Expert 1 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer0_expert1_up [label="Expert 1 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer0_expert1_act [label="Expert 1 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightgreen style=filled]
	layer0_expert1_down [label="Expert 1 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 1" fillcolor=lightblue style=filled]
	layer0_expert2_gate [label="Expert 2 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer0_expert2_up [label="Expert 2 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer0_expert2_act [label="Expert 2 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightgreen style=filled]
	layer0_expert2_down [label="Expert 2 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 2" fillcolor=lightblue style=filled]
	layer0_expert3_gate [label="Expert 3 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer0_expert3_up [label="Expert 3 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer0_expert3_act [label="Expert 3 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightgreen style=filled]
	layer0_expert3_down [label="Expert 3 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 3" fillcolor=lightblue style=filled]
	layer0_expert4_gate [label="Expert 4 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer0_expert4_up [label="Expert 4 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer0_expert4_act [label="Expert 4 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightgreen style=filled]
	layer0_expert4_down [label="Expert 4 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 4" fillcolor=lightblue style=filled]
	layer0_expert5_gate [label="Expert 5 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer0_expert5_up [label="Expert 5 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer0_expert5_act [label="Expert 5 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightgreen style=filled]
	layer0_expert5_down [label="Expert 5 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 5" fillcolor=lightblue style=filled]
	layer0_expert6_gate [label="Expert 6 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer0_expert6_up [label="Expert 6 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer0_expert6_act [label="Expert 6 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightgreen style=filled]
	layer0_expert6_down [label="Expert 6 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 6" fillcolor=lightblue style=filled]
	layer0_expert7_gate [label="Expert 7 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer0_expert7_up [label="Expert 7 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer0_expert7_act [label="Expert 7 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightgreen style=filled]
	layer0_expert7_down [label="Expert 7 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 7" fillcolor=lightblue style=filled]
	layer0_expert8_gate [label="Expert 8 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer0_expert8_up [label="Expert 8 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer0_expert8_act [label="Expert 8 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightgreen style=filled]
	layer0_expert8_down [label="Expert 8 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 8" fillcolor=lightblue style=filled]
	layer0_expert9_gate [label="Expert 9 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer0_expert9_up [label="Expert 9 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer0_expert9_act [label="Expert 9 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightgreen style=filled]
	layer0_expert9_down [label="Expert 9 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 9" fillcolor=lightblue style=filled]
	layer0_expert10_gate [label="Expert 10 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer0_expert10_up [label="Expert 10 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer0_expert10_act [label="Expert 10 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightgreen style=filled]
	layer0_expert10_down [label="Expert 10 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 10" fillcolor=lightblue style=filled]
	layer0_expert11_gate [label="Expert 11 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer0_expert11_up [label="Expert 11 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer0_expert11_act [label="Expert 11 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightgreen style=filled]
	layer0_expert11_down [label="Expert 11 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 11" fillcolor=lightblue style=filled]
	layer0_expert12_gate [label="Expert 12 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer0_expert12_up [label="Expert 12 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer0_expert12_act [label="Expert 12 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightgreen style=filled]
	layer0_expert12_down [label="Expert 12 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 12" fillcolor=lightblue style=filled]
	layer0_expert13_gate [label="Expert 13 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer0_expert13_up [label="Expert 13 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer0_expert13_act [label="Expert 13 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightgreen style=filled]
	layer0_expert13_down [label="Expert 13 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 13" fillcolor=lightblue style=filled]
	layer0_expert14_gate [label="Expert 14 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer0_expert14_up [label="Expert 14 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer0_expert14_act [label="Expert 14 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightgreen style=filled]
	layer0_expert14_down [label="Expert 14 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 14" fillcolor=lightblue style=filled]
	layer0_expert15_gate [label="Expert 15 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer0_expert15_up [label="Expert 15 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer0_expert15_act [label="Expert 15 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightgreen style=filled]
	layer0_expert15_down [label="Expert 15 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 15" fillcolor=lightblue style=filled]
	layer0_token_aggregation [label="Token Aggregation\nInput: [dynamic_batch, seq_len, hidden=4096] from 2 experts\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer0_res2 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	routing -> layer0_mha_qkv
	layer0_mha_qkv -> layer0_mha_attn
	layer0_mha_attn -> layer0_mha_out
	layer0_mha_out -> layer0_res1
	layer0_res1 -> layer0_ln1
	layer0_ln1 -> layer0_expert_routing
	layer0_expert_routing -> layer0_token_distribution
	layer0_token_distribution -> layer0_expert0_gate [style=dashed]
	layer0_token_distribution -> layer0_expert0_up [style=dashed]
	layer0_expert0_gate -> layer0_expert0_act
	layer0_expert0_up -> layer0_expert0_act
	layer0_expert0_act -> layer0_expert0_down
	layer0_expert0_down -> layer0_token_aggregation
	layer0_token_distribution -> layer0_expert1_gate [style=dashed]
	layer0_token_distribution -> layer0_expert1_up [style=dashed]
	layer0_expert1_gate -> layer0_expert1_act
	layer0_expert1_up -> layer0_expert1_act
	layer0_expert1_act -> layer0_expert1_down
	layer0_expert1_down -> layer0_token_aggregation
	layer0_token_distribution -> layer0_expert2_gate [style=dashed]
	layer0_token_distribution -> layer0_expert2_up [style=dashed]
	layer0_expert2_gate -> layer0_expert2_act
	layer0_expert2_up -> layer0_expert2_act
	layer0_expert2_act -> layer0_expert2_down
	layer0_expert2_down -> layer0_token_aggregation
	layer0_token_distribution -> layer0_expert3_gate [style=dashed]
	layer0_token_distribution -> layer0_expert3_up [style=dashed]
	layer0_expert3_gate -> layer0_expert3_act
	layer0_expert3_up -> layer0_expert3_act
	layer0_expert3_act -> layer0_expert3_down
	layer0_expert3_down -> layer0_token_aggregation
	layer0_token_distribution -> layer0_expert4_gate [style=dashed]
	layer0_token_distribution -> layer0_expert4_up [style=dashed]
	layer0_expert4_gate -> layer0_expert4_act
	layer0_expert4_up -> layer0_expert4_act
	layer0_expert4_act -> layer0_expert4_down
	layer0_expert4_down -> layer0_token_aggregation
	layer0_token_distribution -> layer0_expert5_gate [style=dashed]
	layer0_token_distribution -> layer0_expert5_up [style=dashed]
	layer0_expert5_gate -> layer0_expert5_act
	layer0_expert5_up -> layer0_expert5_act
	layer0_expert5_act -> layer0_expert5_down
	layer0_expert5_down -> layer0_token_aggregation
	layer0_token_distribution -> layer0_expert6_gate [style=dashed]
	layer0_token_distribution -> layer0_expert6_up [style=dashed]
	layer0_expert6_gate -> layer0_expert6_act
	layer0_expert6_up -> layer0_expert6_act
	layer0_expert6_act -> layer0_expert6_down
	layer0_expert6_down -> layer0_token_aggregation
	layer0_token_distribution -> layer0_expert7_gate [style=dashed]
	layer0_token_distribution -> layer0_expert7_up [style=dashed]
	layer0_expert7_gate -> layer0_expert7_act
	layer0_expert7_up -> layer0_expert7_act
	layer0_expert7_act -> layer0_expert7_down
	layer0_expert7_down -> layer0_token_aggregation
	layer0_token_distribution -> layer0_expert8_gate [style=dashed]
	layer0_token_distribution -> layer0_expert8_up [style=dashed]
	layer0_expert8_gate -> layer0_expert8_act
	layer0_expert8_up -> layer0_expert8_act
	layer0_expert8_act -> layer0_expert8_down
	layer0_expert8_down -> layer0_token_aggregation
	layer0_token_distribution -> layer0_expert9_gate [style=dashed]
	layer0_token_distribution -> layer0_expert9_up [style=dashed]
	layer0_expert9_gate -> layer0_expert9_act
	layer0_expert9_up -> layer0_expert9_act
	layer0_expert9_act -> layer0_expert9_down
	layer0_expert9_down -> layer0_token_aggregation
	layer0_token_distribution -> layer0_expert10_gate [style=dashed]
	layer0_token_distribution -> layer0_expert10_up [style=dashed]
	layer0_expert10_gate -> layer0_expert10_act
	layer0_expert10_up -> layer0_expert10_act
	layer0_expert10_act -> layer0_expert10_down
	layer0_expert10_down -> layer0_token_aggregation
	layer0_token_distribution -> layer0_expert11_gate [style=dashed]
	layer0_token_distribution -> layer0_expert11_up [style=dashed]
	layer0_expert11_gate -> layer0_expert11_act
	layer0_expert11_up -> layer0_expert11_act
	layer0_expert11_act -> layer0_expert11_down
	layer0_expert11_down -> layer0_token_aggregation
	layer0_token_distribution -> layer0_expert12_gate [style=dashed]
	layer0_token_distribution -> layer0_expert12_up [style=dashed]
	layer0_expert12_gate -> layer0_expert12_act
	layer0_expert12_up -> layer0_expert12_act
	layer0_expert12_act -> layer0_expert12_down
	layer0_expert12_down -> layer0_token_aggregation
	layer0_token_distribution -> layer0_expert13_gate [style=dashed]
	layer0_token_distribution -> layer0_expert13_up [style=dashed]
	layer0_expert13_gate -> layer0_expert13_act
	layer0_expert13_up -> layer0_expert13_act
	layer0_expert13_act -> layer0_expert13_down
	layer0_expert13_down -> layer0_token_aggregation
	layer0_token_distribution -> layer0_expert14_gate [style=dashed]
	layer0_token_distribution -> layer0_expert14_up [style=dashed]
	layer0_expert14_gate -> layer0_expert14_act
	layer0_expert14_up -> layer0_expert14_act
	layer0_expert14_act -> layer0_expert14_down
	layer0_expert14_down -> layer0_token_aggregation
	layer0_token_distribution -> layer0_expert15_gate [style=dashed]
	layer0_token_distribution -> layer0_expert15_up [style=dashed]
	layer0_expert15_gate -> layer0_expert15_act
	layer0_expert15_up -> layer0_expert15_act
	layer0_expert15_act -> layer0_expert15_down
	layer0_expert15_down -> layer0_token_aggregation
	layer0_token_aggregation -> layer0_res2
	layer1_mha_qkv [label="MHA QKV Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nAll GPUs" fillcolor=lightblue style=filled]
	layer1_mha_attn [label="MHA Attention\nInput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightgreen style=filled]
	layer1_mha_out [label="MHA Output Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightblue style=filled]
	layer1_res1 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer1_ln1 [label="Layer Norm\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=yellow style=filled]
	layer1_expert_routing [label="Expert Routing\nTop-2 Selection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, expert_id=2]\nAll GPUs" fillcolor=orange shape=diamond style=filled]
	layer1_token_distribution [label="Token Distribution\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: Tokens routed to 2 experts\nAll GPUs → Expert GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer1_expert0_gate [label="Expert 0 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer1_expert0_up [label="Expert 0 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer1_expert0_act [label="Expert 0 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightgreen style=filled]
	layer1_expert0_down [label="Expert 0 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 0" fillcolor=lightblue style=filled]
	layer1_expert1_gate [label="Expert 1 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer1_expert1_up [label="Expert 1 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer1_expert1_act [label="Expert 1 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightgreen style=filled]
	layer1_expert1_down [label="Expert 1 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 1" fillcolor=lightblue style=filled]
	layer1_expert2_gate [label="Expert 2 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer1_expert2_up [label="Expert 2 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer1_expert2_act [label="Expert 2 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightgreen style=filled]
	layer1_expert2_down [label="Expert 2 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 2" fillcolor=lightblue style=filled]
	layer1_expert3_gate [label="Expert 3 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer1_expert3_up [label="Expert 3 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer1_expert3_act [label="Expert 3 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightgreen style=filled]
	layer1_expert3_down [label="Expert 3 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 3" fillcolor=lightblue style=filled]
	layer1_expert4_gate [label="Expert 4 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer1_expert4_up [label="Expert 4 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer1_expert4_act [label="Expert 4 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightgreen style=filled]
	layer1_expert4_down [label="Expert 4 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 4" fillcolor=lightblue style=filled]
	layer1_expert5_gate [label="Expert 5 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer1_expert5_up [label="Expert 5 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer1_expert5_act [label="Expert 5 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightgreen style=filled]
	layer1_expert5_down [label="Expert 5 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 5" fillcolor=lightblue style=filled]
	layer1_expert6_gate [label="Expert 6 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer1_expert6_up [label="Expert 6 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer1_expert6_act [label="Expert 6 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightgreen style=filled]
	layer1_expert6_down [label="Expert 6 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 6" fillcolor=lightblue style=filled]
	layer1_expert7_gate [label="Expert 7 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer1_expert7_up [label="Expert 7 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer1_expert7_act [label="Expert 7 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightgreen style=filled]
	layer1_expert7_down [label="Expert 7 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 7" fillcolor=lightblue style=filled]
	layer1_expert8_gate [label="Expert 8 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer1_expert8_up [label="Expert 8 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer1_expert8_act [label="Expert 8 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightgreen style=filled]
	layer1_expert8_down [label="Expert 8 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 8" fillcolor=lightblue style=filled]
	layer1_expert9_gate [label="Expert 9 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer1_expert9_up [label="Expert 9 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer1_expert9_act [label="Expert 9 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightgreen style=filled]
	layer1_expert9_down [label="Expert 9 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 9" fillcolor=lightblue style=filled]
	layer1_expert10_gate [label="Expert 10 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer1_expert10_up [label="Expert 10 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer1_expert10_act [label="Expert 10 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightgreen style=filled]
	layer1_expert10_down [label="Expert 10 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 10" fillcolor=lightblue style=filled]
	layer1_expert11_gate [label="Expert 11 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer1_expert11_up [label="Expert 11 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer1_expert11_act [label="Expert 11 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightgreen style=filled]
	layer1_expert11_down [label="Expert 11 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 11" fillcolor=lightblue style=filled]
	layer1_expert12_gate [label="Expert 12 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer1_expert12_up [label="Expert 12 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer1_expert12_act [label="Expert 12 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightgreen style=filled]
	layer1_expert12_down [label="Expert 12 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 12" fillcolor=lightblue style=filled]
	layer1_expert13_gate [label="Expert 13 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer1_expert13_up [label="Expert 13 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer1_expert13_act [label="Expert 13 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightgreen style=filled]
	layer1_expert13_down [label="Expert 13 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 13" fillcolor=lightblue style=filled]
	layer1_expert14_gate [label="Expert 14 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer1_expert14_up [label="Expert 14 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer1_expert14_act [label="Expert 14 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightgreen style=filled]
	layer1_expert14_down [label="Expert 14 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 14" fillcolor=lightblue style=filled]
	layer1_expert15_gate [label="Expert 15 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer1_expert15_up [label="Expert 15 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer1_expert15_act [label="Expert 15 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightgreen style=filled]
	layer1_expert15_down [label="Expert 15 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 15" fillcolor=lightblue style=filled]
	layer1_token_aggregation [label="Token Aggregation\nInput: [dynamic_batch, seq_len, hidden=4096] from 2 experts\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer1_res2 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer0_res2 -> layer1_mha_qkv
	layer1_mha_qkv -> layer1_mha_attn
	layer1_mha_attn -> layer1_mha_out
	layer1_mha_out -> layer1_res1
	layer1_res1 -> layer1_ln1
	layer1_ln1 -> layer1_expert_routing
	layer1_expert_routing -> layer1_token_distribution
	layer1_token_distribution -> layer1_expert0_gate [style=dashed]
	layer1_token_distribution -> layer1_expert0_up [style=dashed]
	layer1_expert0_gate -> layer1_expert0_act
	layer1_expert0_up -> layer1_expert0_act
	layer1_expert0_act -> layer1_expert0_down
	layer1_expert0_down -> layer1_token_aggregation
	layer1_token_distribution -> layer1_expert1_gate [style=dashed]
	layer1_token_distribution -> layer1_expert1_up [style=dashed]
	layer1_expert1_gate -> layer1_expert1_act
	layer1_expert1_up -> layer1_expert1_act
	layer1_expert1_act -> layer1_expert1_down
	layer1_expert1_down -> layer1_token_aggregation
	layer1_token_distribution -> layer1_expert2_gate [style=dashed]
	layer1_token_distribution -> layer1_expert2_up [style=dashed]
	layer1_expert2_gate -> layer1_expert2_act
	layer1_expert2_up -> layer1_expert2_act
	layer1_expert2_act -> layer1_expert2_down
	layer1_expert2_down -> layer1_token_aggregation
	layer1_token_distribution -> layer1_expert3_gate [style=dashed]
	layer1_token_distribution -> layer1_expert3_up [style=dashed]
	layer1_expert3_gate -> layer1_expert3_act
	layer1_expert3_up -> layer1_expert3_act
	layer1_expert3_act -> layer1_expert3_down
	layer1_expert3_down -> layer1_token_aggregation
	layer1_token_distribution -> layer1_expert4_gate [style=dashed]
	layer1_token_distribution -> layer1_expert4_up [style=dashed]
	layer1_expert4_gate -> layer1_expert4_act
	layer1_expert4_up -> layer1_expert4_act
	layer1_expert4_act -> layer1_expert4_down
	layer1_expert4_down -> layer1_token_aggregation
	layer1_token_distribution -> layer1_expert5_gate [style=dashed]
	layer1_token_distribution -> layer1_expert5_up [style=dashed]
	layer1_expert5_gate -> layer1_expert5_act
	layer1_expert5_up -> layer1_expert5_act
	layer1_expert5_act -> layer1_expert5_down
	layer1_expert5_down -> layer1_token_aggregation
	layer1_token_distribution -> layer1_expert6_gate [style=dashed]
	layer1_token_distribution -> layer1_expert6_up [style=dashed]
	layer1_expert6_gate -> layer1_expert6_act
	layer1_expert6_up -> layer1_expert6_act
	layer1_expert6_act -> layer1_expert6_down
	layer1_expert6_down -> layer1_token_aggregation
	layer1_token_distribution -> layer1_expert7_gate [style=dashed]
	layer1_token_distribution -> layer1_expert7_up [style=dashed]
	layer1_expert7_gate -> layer1_expert7_act
	layer1_expert7_up -> layer1_expert7_act
	layer1_expert7_act -> layer1_expert7_down
	layer1_expert7_down -> layer1_token_aggregation
	layer1_token_distribution -> layer1_expert8_gate [style=dashed]
	layer1_token_distribution -> layer1_expert8_up [style=dashed]
	layer1_expert8_gate -> layer1_expert8_act
	layer1_expert8_up -> layer1_expert8_act
	layer1_expert8_act -> layer1_expert8_down
	layer1_expert8_down -> layer1_token_aggregation
	layer1_token_distribution -> layer1_expert9_gate [style=dashed]
	layer1_token_distribution -> layer1_expert9_up [style=dashed]
	layer1_expert9_gate -> layer1_expert9_act
	layer1_expert9_up -> layer1_expert9_act
	layer1_expert9_act -> layer1_expert9_down
	layer1_expert9_down -> layer1_token_aggregation
	layer1_token_distribution -> layer1_expert10_gate [style=dashed]
	layer1_token_distribution -> layer1_expert10_up [style=dashed]
	layer1_expert10_gate -> layer1_expert10_act
	layer1_expert10_up -> layer1_expert10_act
	layer1_expert10_act -> layer1_expert10_down
	layer1_expert10_down -> layer1_token_aggregation
	layer1_token_distribution -> layer1_expert11_gate [style=dashed]
	layer1_token_distribution -> layer1_expert11_up [style=dashed]
	layer1_expert11_gate -> layer1_expert11_act
	layer1_expert11_up -> layer1_expert11_act
	layer1_expert11_act -> layer1_expert11_down
	layer1_expert11_down -> layer1_token_aggregation
	layer1_token_distribution -> layer1_expert12_gate [style=dashed]
	layer1_token_distribution -> layer1_expert12_up [style=dashed]
	layer1_expert12_gate -> layer1_expert12_act
	layer1_expert12_up -> layer1_expert12_act
	layer1_expert12_act -> layer1_expert12_down
	layer1_expert12_down -> layer1_token_aggregation
	layer1_token_distribution -> layer1_expert13_gate [style=dashed]
	layer1_token_distribution -> layer1_expert13_up [style=dashed]
	layer1_expert13_gate -> layer1_expert13_act
	layer1_expert13_up -> layer1_expert13_act
	layer1_expert13_act -> layer1_expert13_down
	layer1_expert13_down -> layer1_token_aggregation
	layer1_token_distribution -> layer1_expert14_gate [style=dashed]
	layer1_token_distribution -> layer1_expert14_up [style=dashed]
	layer1_expert14_gate -> layer1_expert14_act
	layer1_expert14_up -> layer1_expert14_act
	layer1_expert14_act -> layer1_expert14_down
	layer1_expert14_down -> layer1_token_aggregation
	layer1_token_distribution -> layer1_expert15_gate [style=dashed]
	layer1_token_distribution -> layer1_expert15_up [style=dashed]
	layer1_expert15_gate -> layer1_expert15_act
	layer1_expert15_up -> layer1_expert15_act
	layer1_expert15_act -> layer1_expert15_down
	layer1_expert15_down -> layer1_token_aggregation
	layer1_token_aggregation -> layer1_res2
	layer2_mha_qkv [label="MHA QKV Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nAll GPUs" fillcolor=lightblue style=filled]
	layer2_mha_attn [label="MHA Attention\nInput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightgreen style=filled]
	layer2_mha_out [label="MHA Output Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightblue style=filled]
	layer2_res1 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer2_ln1 [label="Layer Norm\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=yellow style=filled]
	layer2_expert_routing [label="Expert Routing\nTop-2 Selection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, expert_id=2]\nAll GPUs" fillcolor=orange shape=diamond style=filled]
	layer2_token_distribution [label="Token Distribution\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: Tokens routed to 2 experts\nAll GPUs → Expert GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer2_expert0_gate [label="Expert 0 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer2_expert0_up [label="Expert 0 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer2_expert0_act [label="Expert 0 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightgreen style=filled]
	layer2_expert0_down [label="Expert 0 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 0" fillcolor=lightblue style=filled]
	layer2_expert1_gate [label="Expert 1 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer2_expert1_up [label="Expert 1 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer2_expert1_act [label="Expert 1 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightgreen style=filled]
	layer2_expert1_down [label="Expert 1 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 1" fillcolor=lightblue style=filled]
	layer2_expert2_gate [label="Expert 2 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer2_expert2_up [label="Expert 2 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer2_expert2_act [label="Expert 2 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightgreen style=filled]
	layer2_expert2_down [label="Expert 2 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 2" fillcolor=lightblue style=filled]
	layer2_expert3_gate [label="Expert 3 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer2_expert3_up [label="Expert 3 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer2_expert3_act [label="Expert 3 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightgreen style=filled]
	layer2_expert3_down [label="Expert 3 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 3" fillcolor=lightblue style=filled]
	layer2_expert4_gate [label="Expert 4 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer2_expert4_up [label="Expert 4 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer2_expert4_act [label="Expert 4 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightgreen style=filled]
	layer2_expert4_down [label="Expert 4 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 4" fillcolor=lightblue style=filled]
	layer2_expert5_gate [label="Expert 5 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer2_expert5_up [label="Expert 5 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer2_expert5_act [label="Expert 5 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightgreen style=filled]
	layer2_expert5_down [label="Expert 5 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 5" fillcolor=lightblue style=filled]
	layer2_expert6_gate [label="Expert 6 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer2_expert6_up [label="Expert 6 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer2_expert6_act [label="Expert 6 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightgreen style=filled]
	layer2_expert6_down [label="Expert 6 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 6" fillcolor=lightblue style=filled]
	layer2_expert7_gate [label="Expert 7 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer2_expert7_up [label="Expert 7 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer2_expert7_act [label="Expert 7 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightgreen style=filled]
	layer2_expert7_down [label="Expert 7 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 7" fillcolor=lightblue style=filled]
	layer2_expert8_gate [label="Expert 8 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer2_expert8_up [label="Expert 8 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer2_expert8_act [label="Expert 8 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightgreen style=filled]
	layer2_expert8_down [label="Expert 8 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 8" fillcolor=lightblue style=filled]
	layer2_expert9_gate [label="Expert 9 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer2_expert9_up [label="Expert 9 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer2_expert9_act [label="Expert 9 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightgreen style=filled]
	layer2_expert9_down [label="Expert 9 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 9" fillcolor=lightblue style=filled]
	layer2_expert10_gate [label="Expert 10 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer2_expert10_up [label="Expert 10 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer2_expert10_act [label="Expert 10 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightgreen style=filled]
	layer2_expert10_down [label="Expert 10 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 10" fillcolor=lightblue style=filled]
	layer2_expert11_gate [label="Expert 11 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer2_expert11_up [label="Expert 11 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer2_expert11_act [label="Expert 11 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightgreen style=filled]
	layer2_expert11_down [label="Expert 11 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 11" fillcolor=lightblue style=filled]
	layer2_expert12_gate [label="Expert 12 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer2_expert12_up [label="Expert 12 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer2_expert12_act [label="Expert 12 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightgreen style=filled]
	layer2_expert12_down [label="Expert 12 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 12" fillcolor=lightblue style=filled]
	layer2_expert13_gate [label="Expert 13 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer2_expert13_up [label="Expert 13 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer2_expert13_act [label="Expert 13 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightgreen style=filled]
	layer2_expert13_down [label="Expert 13 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 13" fillcolor=lightblue style=filled]
	layer2_expert14_gate [label="Expert 14 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer2_expert14_up [label="Expert 14 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer2_expert14_act [label="Expert 14 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightgreen style=filled]
	layer2_expert14_down [label="Expert 14 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 14" fillcolor=lightblue style=filled]
	layer2_expert15_gate [label="Expert 15 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer2_expert15_up [label="Expert 15 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer2_expert15_act [label="Expert 15 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightgreen style=filled]
	layer2_expert15_down [label="Expert 15 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 15" fillcolor=lightblue style=filled]
	layer2_token_aggregation [label="Token Aggregation\nInput: [dynamic_batch, seq_len, hidden=4096] from 2 experts\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer2_res2 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer1_res2 -> layer2_mha_qkv
	layer2_mha_qkv -> layer2_mha_attn
	layer2_mha_attn -> layer2_mha_out
	layer2_mha_out -> layer2_res1
	layer2_res1 -> layer2_ln1
	layer2_ln1 -> layer2_expert_routing
	layer2_expert_routing -> layer2_token_distribution
	layer2_token_distribution -> layer2_expert0_gate [style=dashed]
	layer2_token_distribution -> layer2_expert0_up [style=dashed]
	layer2_expert0_gate -> layer2_expert0_act
	layer2_expert0_up -> layer2_expert0_act
	layer2_expert0_act -> layer2_expert0_down
	layer2_expert0_down -> layer2_token_aggregation
	layer2_token_distribution -> layer2_expert1_gate [style=dashed]
	layer2_token_distribution -> layer2_expert1_up [style=dashed]
	layer2_expert1_gate -> layer2_expert1_act
	layer2_expert1_up -> layer2_expert1_act
	layer2_expert1_act -> layer2_expert1_down
	layer2_expert1_down -> layer2_token_aggregation
	layer2_token_distribution -> layer2_expert2_gate [style=dashed]
	layer2_token_distribution -> layer2_expert2_up [style=dashed]
	layer2_expert2_gate -> layer2_expert2_act
	layer2_expert2_up -> layer2_expert2_act
	layer2_expert2_act -> layer2_expert2_down
	layer2_expert2_down -> layer2_token_aggregation
	layer2_token_distribution -> layer2_expert3_gate [style=dashed]
	layer2_token_distribution -> layer2_expert3_up [style=dashed]
	layer2_expert3_gate -> layer2_expert3_act
	layer2_expert3_up -> layer2_expert3_act
	layer2_expert3_act -> layer2_expert3_down
	layer2_expert3_down -> layer2_token_aggregation
	layer2_token_distribution -> layer2_expert4_gate [style=dashed]
	layer2_token_distribution -> layer2_expert4_up [style=dashed]
	layer2_expert4_gate -> layer2_expert4_act
	layer2_expert4_up -> layer2_expert4_act
	layer2_expert4_act -> layer2_expert4_down
	layer2_expert4_down -> layer2_token_aggregation
	layer2_token_distribution -> layer2_expert5_gate [style=dashed]
	layer2_token_distribution -> layer2_expert5_up [style=dashed]
	layer2_expert5_gate -> layer2_expert5_act
	layer2_expert5_up -> layer2_expert5_act
	layer2_expert5_act -> layer2_expert5_down
	layer2_expert5_down -> layer2_token_aggregation
	layer2_token_distribution -> layer2_expert6_gate [style=dashed]
	layer2_token_distribution -> layer2_expert6_up [style=dashed]
	layer2_expert6_gate -> layer2_expert6_act
	layer2_expert6_up -> layer2_expert6_act
	layer2_expert6_act -> layer2_expert6_down
	layer2_expert6_down -> layer2_token_aggregation
	layer2_token_distribution -> layer2_expert7_gate [style=dashed]
	layer2_token_distribution -> layer2_expert7_up [style=dashed]
	layer2_expert7_gate -> layer2_expert7_act
	layer2_expert7_up -> layer2_expert7_act
	layer2_expert7_act -> layer2_expert7_down
	layer2_expert7_down -> layer2_token_aggregation
	layer2_token_distribution -> layer2_expert8_gate [style=dashed]
	layer2_token_distribution -> layer2_expert8_up [style=dashed]
	layer2_expert8_gate -> layer2_expert8_act
	layer2_expert8_up -> layer2_expert8_act
	layer2_expert8_act -> layer2_expert8_down
	layer2_expert8_down -> layer2_token_aggregation
	layer2_token_distribution -> layer2_expert9_gate [style=dashed]
	layer2_token_distribution -> layer2_expert9_up [style=dashed]
	layer2_expert9_gate -> layer2_expert9_act
	layer2_expert9_up -> layer2_expert9_act
	layer2_expert9_act -> layer2_expert9_down
	layer2_expert9_down -> layer2_token_aggregation
	layer2_token_distribution -> layer2_expert10_gate [style=dashed]
	layer2_token_distribution -> layer2_expert10_up [style=dashed]
	layer2_expert10_gate -> layer2_expert10_act
	layer2_expert10_up -> layer2_expert10_act
	layer2_expert10_act -> layer2_expert10_down
	layer2_expert10_down -> layer2_token_aggregation
	layer2_token_distribution -> layer2_expert11_gate [style=dashed]
	layer2_token_distribution -> layer2_expert11_up [style=dashed]
	layer2_expert11_gate -> layer2_expert11_act
	layer2_expert11_up -> layer2_expert11_act
	layer2_expert11_act -> layer2_expert11_down
	layer2_expert11_down -> layer2_token_aggregation
	layer2_token_distribution -> layer2_expert12_gate [style=dashed]
	layer2_token_distribution -> layer2_expert12_up [style=dashed]
	layer2_expert12_gate -> layer2_expert12_act
	layer2_expert12_up -> layer2_expert12_act
	layer2_expert12_act -> layer2_expert12_down
	layer2_expert12_down -> layer2_token_aggregation
	layer2_token_distribution -> layer2_expert13_gate [style=dashed]
	layer2_token_distribution -> layer2_expert13_up [style=dashed]
	layer2_expert13_gate -> layer2_expert13_act
	layer2_expert13_up -> layer2_expert13_act
	layer2_expert13_act -> layer2_expert13_down
	layer2_expert13_down -> layer2_token_aggregation
	layer2_token_distribution -> layer2_expert14_gate [style=dashed]
	layer2_token_distribution -> layer2_expert14_up [style=dashed]
	layer2_expert14_gate -> layer2_expert14_act
	layer2_expert14_up -> layer2_expert14_act
	layer2_expert14_act -> layer2_expert14_down
	layer2_expert14_down -> layer2_token_aggregation
	layer2_token_distribution -> layer2_expert15_gate [style=dashed]
	layer2_token_distribution -> layer2_expert15_up [style=dashed]
	layer2_expert15_gate -> layer2_expert15_act
	layer2_expert15_up -> layer2_expert15_act
	layer2_expert15_act -> layer2_expert15_down
	layer2_expert15_down -> layer2_token_aggregation
	layer2_token_aggregation -> layer2_res2
	layer3_mha_qkv [label="MHA QKV Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nAll GPUs" fillcolor=lightblue style=filled]
	layer3_mha_attn [label="MHA Attention\nInput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightgreen style=filled]
	layer3_mha_out [label="MHA Output Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightblue style=filled]
	layer3_res1 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer3_ln1 [label="Layer Norm\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=yellow style=filled]
	layer3_expert_routing [label="Expert Routing\nTop-2 Selection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, expert_id=2]\nAll GPUs" fillcolor=orange shape=diamond style=filled]
	layer3_token_distribution [label="Token Distribution\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: Tokens routed to 2 experts\nAll GPUs → Expert GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer3_expert0_gate [label="Expert 0 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer3_expert0_up [label="Expert 0 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer3_expert0_act [label="Expert 0 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightgreen style=filled]
	layer3_expert0_down [label="Expert 0 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 0" fillcolor=lightblue style=filled]
	layer3_expert1_gate [label="Expert 1 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer3_expert1_up [label="Expert 1 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer3_expert1_act [label="Expert 1 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightgreen style=filled]
	layer3_expert1_down [label="Expert 1 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 1" fillcolor=lightblue style=filled]
	layer3_expert2_gate [label="Expert 2 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer3_expert2_up [label="Expert 2 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer3_expert2_act [label="Expert 2 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightgreen style=filled]
	layer3_expert2_down [label="Expert 2 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 2" fillcolor=lightblue style=filled]
	layer3_expert3_gate [label="Expert 3 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer3_expert3_up [label="Expert 3 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer3_expert3_act [label="Expert 3 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightgreen style=filled]
	layer3_expert3_down [label="Expert 3 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 3" fillcolor=lightblue style=filled]
	layer3_expert4_gate [label="Expert 4 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer3_expert4_up [label="Expert 4 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer3_expert4_act [label="Expert 4 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightgreen style=filled]
	layer3_expert4_down [label="Expert 4 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 4" fillcolor=lightblue style=filled]
	layer3_expert5_gate [label="Expert 5 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer3_expert5_up [label="Expert 5 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer3_expert5_act [label="Expert 5 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightgreen style=filled]
	layer3_expert5_down [label="Expert 5 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 5" fillcolor=lightblue style=filled]
	layer3_expert6_gate [label="Expert 6 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer3_expert6_up [label="Expert 6 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer3_expert6_act [label="Expert 6 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightgreen style=filled]
	layer3_expert6_down [label="Expert 6 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 6" fillcolor=lightblue style=filled]
	layer3_expert7_gate [label="Expert 7 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer3_expert7_up [label="Expert 7 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer3_expert7_act [label="Expert 7 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightgreen style=filled]
	layer3_expert7_down [label="Expert 7 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 7" fillcolor=lightblue style=filled]
	layer3_expert8_gate [label="Expert 8 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer3_expert8_up [label="Expert 8 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer3_expert8_act [label="Expert 8 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightgreen style=filled]
	layer3_expert8_down [label="Expert 8 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 8" fillcolor=lightblue style=filled]
	layer3_expert9_gate [label="Expert 9 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer3_expert9_up [label="Expert 9 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer3_expert9_act [label="Expert 9 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightgreen style=filled]
	layer3_expert9_down [label="Expert 9 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 9" fillcolor=lightblue style=filled]
	layer3_expert10_gate [label="Expert 10 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer3_expert10_up [label="Expert 10 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer3_expert10_act [label="Expert 10 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightgreen style=filled]
	layer3_expert10_down [label="Expert 10 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 10" fillcolor=lightblue style=filled]
	layer3_expert11_gate [label="Expert 11 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer3_expert11_up [label="Expert 11 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer3_expert11_act [label="Expert 11 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightgreen style=filled]
	layer3_expert11_down [label="Expert 11 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 11" fillcolor=lightblue style=filled]
	layer3_expert12_gate [label="Expert 12 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer3_expert12_up [label="Expert 12 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer3_expert12_act [label="Expert 12 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightgreen style=filled]
	layer3_expert12_down [label="Expert 12 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 12" fillcolor=lightblue style=filled]
	layer3_expert13_gate [label="Expert 13 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer3_expert13_up [label="Expert 13 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer3_expert13_act [label="Expert 13 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightgreen style=filled]
	layer3_expert13_down [label="Expert 13 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 13" fillcolor=lightblue style=filled]
	layer3_expert14_gate [label="Expert 14 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer3_expert14_up [label="Expert 14 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer3_expert14_act [label="Expert 14 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightgreen style=filled]
	layer3_expert14_down [label="Expert 14 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 14" fillcolor=lightblue style=filled]
	layer3_expert15_gate [label="Expert 15 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer3_expert15_up [label="Expert 15 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer3_expert15_act [label="Expert 15 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightgreen style=filled]
	layer3_expert15_down [label="Expert 15 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 15" fillcolor=lightblue style=filled]
	layer3_token_aggregation [label="Token Aggregation\nInput: [dynamic_batch, seq_len, hidden=4096] from 2 experts\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer3_res2 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer2_res2 -> layer3_mha_qkv
	layer3_mha_qkv -> layer3_mha_attn
	layer3_mha_attn -> layer3_mha_out
	layer3_mha_out -> layer3_res1
	layer3_res1 -> layer3_ln1
	layer3_ln1 -> layer3_expert_routing
	layer3_expert_routing -> layer3_token_distribution
	layer3_token_distribution -> layer3_expert0_gate [style=dashed]
	layer3_token_distribution -> layer3_expert0_up [style=dashed]
	layer3_expert0_gate -> layer3_expert0_act
	layer3_expert0_up -> layer3_expert0_act
	layer3_expert0_act -> layer3_expert0_down
	layer3_expert0_down -> layer3_token_aggregation
	layer3_token_distribution -> layer3_expert1_gate [style=dashed]
	layer3_token_distribution -> layer3_expert1_up [style=dashed]
	layer3_expert1_gate -> layer3_expert1_act
	layer3_expert1_up -> layer3_expert1_act
	layer3_expert1_act -> layer3_expert1_down
	layer3_expert1_down -> layer3_token_aggregation
	layer3_token_distribution -> layer3_expert2_gate [style=dashed]
	layer3_token_distribution -> layer3_expert2_up [style=dashed]
	layer3_expert2_gate -> layer3_expert2_act
	layer3_expert2_up -> layer3_expert2_act
	layer3_expert2_act -> layer3_expert2_down
	layer3_expert2_down -> layer3_token_aggregation
	layer3_token_distribution -> layer3_expert3_gate [style=dashed]
	layer3_token_distribution -> layer3_expert3_up [style=dashed]
	layer3_expert3_gate -> layer3_expert3_act
	layer3_expert3_up -> layer3_expert3_act
	layer3_expert3_act -> layer3_expert3_down
	layer3_expert3_down -> layer3_token_aggregation
	layer3_token_distribution -> layer3_expert4_gate [style=dashed]
	layer3_token_distribution -> layer3_expert4_up [style=dashed]
	layer3_expert4_gate -> layer3_expert4_act
	layer3_expert4_up -> layer3_expert4_act
	layer3_expert4_act -> layer3_expert4_down
	layer3_expert4_down -> layer3_token_aggregation
	layer3_token_distribution -> layer3_expert5_gate [style=dashed]
	layer3_token_distribution -> layer3_expert5_up [style=dashed]
	layer3_expert5_gate -> layer3_expert5_act
	layer3_expert5_up -> layer3_expert5_act
	layer3_expert5_act -> layer3_expert5_down
	layer3_expert5_down -> layer3_token_aggregation
	layer3_token_distribution -> layer3_expert6_gate [style=dashed]
	layer3_token_distribution -> layer3_expert6_up [style=dashed]
	layer3_expert6_gate -> layer3_expert6_act
	layer3_expert6_up -> layer3_expert6_act
	layer3_expert6_act -> layer3_expert6_down
	layer3_expert6_down -> layer3_token_aggregation
	layer3_token_distribution -> layer3_expert7_gate [style=dashed]
	layer3_token_distribution -> layer3_expert7_up [style=dashed]
	layer3_expert7_gate -> layer3_expert7_act
	layer3_expert7_up -> layer3_expert7_act
	layer3_expert7_act -> layer3_expert7_down
	layer3_expert7_down -> layer3_token_aggregation
	layer3_token_distribution -> layer3_expert8_gate [style=dashed]
	layer3_token_distribution -> layer3_expert8_up [style=dashed]
	layer3_expert8_gate -> layer3_expert8_act
	layer3_expert8_up -> layer3_expert8_act
	layer3_expert8_act -> layer3_expert8_down
	layer3_expert8_down -> layer3_token_aggregation
	layer3_token_distribution -> layer3_expert9_gate [style=dashed]
	layer3_token_distribution -> layer3_expert9_up [style=dashed]
	layer3_expert9_gate -> layer3_expert9_act
	layer3_expert9_up -> layer3_expert9_act
	layer3_expert9_act -> layer3_expert9_down
	layer3_expert9_down -> layer3_token_aggregation
	layer3_token_distribution -> layer3_expert10_gate [style=dashed]
	layer3_token_distribution -> layer3_expert10_up [style=dashed]
	layer3_expert10_gate -> layer3_expert10_act
	layer3_expert10_up -> layer3_expert10_act
	layer3_expert10_act -> layer3_expert10_down
	layer3_expert10_down -> layer3_token_aggregation
	layer3_token_distribution -> layer3_expert11_gate [style=dashed]
	layer3_token_distribution -> layer3_expert11_up [style=dashed]
	layer3_expert11_gate -> layer3_expert11_act
	layer3_expert11_up -> layer3_expert11_act
	layer3_expert11_act -> layer3_expert11_down
	layer3_expert11_down -> layer3_token_aggregation
	layer3_token_distribution -> layer3_expert12_gate [style=dashed]
	layer3_token_distribution -> layer3_expert12_up [style=dashed]
	layer3_expert12_gate -> layer3_expert12_act
	layer3_expert12_up -> layer3_expert12_act
	layer3_expert12_act -> layer3_expert12_down
	layer3_expert12_down -> layer3_token_aggregation
	layer3_token_distribution -> layer3_expert13_gate [style=dashed]
	layer3_token_distribution -> layer3_expert13_up [style=dashed]
	layer3_expert13_gate -> layer3_expert13_act
	layer3_expert13_up -> layer3_expert13_act
	layer3_expert13_act -> layer3_expert13_down
	layer3_expert13_down -> layer3_token_aggregation
	layer3_token_distribution -> layer3_expert14_gate [style=dashed]
	layer3_token_distribution -> layer3_expert14_up [style=dashed]
	layer3_expert14_gate -> layer3_expert14_act
	layer3_expert14_up -> layer3_expert14_act
	layer3_expert14_act -> layer3_expert14_down
	layer3_expert14_down -> layer3_token_aggregation
	layer3_token_distribution -> layer3_expert15_gate [style=dashed]
	layer3_token_distribution -> layer3_expert15_up [style=dashed]
	layer3_expert15_gate -> layer3_expert15_act
	layer3_expert15_up -> layer3_expert15_act
	layer3_expert15_act -> layer3_expert15_down
	layer3_expert15_down -> layer3_token_aggregation
	layer3_token_aggregation -> layer3_res2
	layer4_mha_qkv [label="MHA QKV Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nAll GPUs" fillcolor=lightblue style=filled]
	layer4_mha_attn [label="MHA Attention\nInput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightgreen style=filled]
	layer4_mha_out [label="MHA Output Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightblue style=filled]
	layer4_res1 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer4_ln1 [label="Layer Norm\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=yellow style=filled]
	layer4_expert_routing [label="Expert Routing\nTop-2 Selection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, expert_id=2]\nAll GPUs" fillcolor=orange shape=diamond style=filled]
	layer4_token_distribution [label="Token Distribution\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: Tokens routed to 2 experts\nAll GPUs → Expert GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer4_expert0_gate [label="Expert 0 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer4_expert0_up [label="Expert 0 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer4_expert0_act [label="Expert 0 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightgreen style=filled]
	layer4_expert0_down [label="Expert 0 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 0" fillcolor=lightblue style=filled]
	layer4_expert1_gate [label="Expert 1 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer4_expert1_up [label="Expert 1 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer4_expert1_act [label="Expert 1 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightgreen style=filled]
	layer4_expert1_down [label="Expert 1 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 1" fillcolor=lightblue style=filled]
	layer4_expert2_gate [label="Expert 2 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer4_expert2_up [label="Expert 2 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer4_expert2_act [label="Expert 2 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightgreen style=filled]
	layer4_expert2_down [label="Expert 2 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 2" fillcolor=lightblue style=filled]
	layer4_expert3_gate [label="Expert 3 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer4_expert3_up [label="Expert 3 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer4_expert3_act [label="Expert 3 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightgreen style=filled]
	layer4_expert3_down [label="Expert 3 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 3" fillcolor=lightblue style=filled]
	layer4_expert4_gate [label="Expert 4 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer4_expert4_up [label="Expert 4 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer4_expert4_act [label="Expert 4 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightgreen style=filled]
	layer4_expert4_down [label="Expert 4 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 4" fillcolor=lightblue style=filled]
	layer4_expert5_gate [label="Expert 5 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer4_expert5_up [label="Expert 5 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer4_expert5_act [label="Expert 5 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightgreen style=filled]
	layer4_expert5_down [label="Expert 5 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 5" fillcolor=lightblue style=filled]
	layer4_expert6_gate [label="Expert 6 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer4_expert6_up [label="Expert 6 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer4_expert6_act [label="Expert 6 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightgreen style=filled]
	layer4_expert6_down [label="Expert 6 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 6" fillcolor=lightblue style=filled]
	layer4_expert7_gate [label="Expert 7 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer4_expert7_up [label="Expert 7 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer4_expert7_act [label="Expert 7 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightgreen style=filled]
	layer4_expert7_down [label="Expert 7 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 7" fillcolor=lightblue style=filled]
	layer4_expert8_gate [label="Expert 8 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer4_expert8_up [label="Expert 8 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer4_expert8_act [label="Expert 8 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightgreen style=filled]
	layer4_expert8_down [label="Expert 8 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 8" fillcolor=lightblue style=filled]
	layer4_expert9_gate [label="Expert 9 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer4_expert9_up [label="Expert 9 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer4_expert9_act [label="Expert 9 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightgreen style=filled]
	layer4_expert9_down [label="Expert 9 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 9" fillcolor=lightblue style=filled]
	layer4_expert10_gate [label="Expert 10 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer4_expert10_up [label="Expert 10 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer4_expert10_act [label="Expert 10 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightgreen style=filled]
	layer4_expert10_down [label="Expert 10 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 10" fillcolor=lightblue style=filled]
	layer4_expert11_gate [label="Expert 11 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer4_expert11_up [label="Expert 11 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer4_expert11_act [label="Expert 11 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightgreen style=filled]
	layer4_expert11_down [label="Expert 11 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 11" fillcolor=lightblue style=filled]
	layer4_expert12_gate [label="Expert 12 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer4_expert12_up [label="Expert 12 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer4_expert12_act [label="Expert 12 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightgreen style=filled]
	layer4_expert12_down [label="Expert 12 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 12" fillcolor=lightblue style=filled]
	layer4_expert13_gate [label="Expert 13 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer4_expert13_up [label="Expert 13 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer4_expert13_act [label="Expert 13 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightgreen style=filled]
	layer4_expert13_down [label="Expert 13 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 13" fillcolor=lightblue style=filled]
	layer4_expert14_gate [label="Expert 14 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer4_expert14_up [label="Expert 14 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer4_expert14_act [label="Expert 14 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightgreen style=filled]
	layer4_expert14_down [label="Expert 14 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 14" fillcolor=lightblue style=filled]
	layer4_expert15_gate [label="Expert 15 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer4_expert15_up [label="Expert 15 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer4_expert15_act [label="Expert 15 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightgreen style=filled]
	layer4_expert15_down [label="Expert 15 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 15" fillcolor=lightblue style=filled]
	layer4_token_aggregation [label="Token Aggregation\nInput: [dynamic_batch, seq_len, hidden=4096] from 2 experts\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer4_res2 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer3_res2 -> layer4_mha_qkv
	layer4_mha_qkv -> layer4_mha_attn
	layer4_mha_attn -> layer4_mha_out
	layer4_mha_out -> layer4_res1
	layer4_res1 -> layer4_ln1
	layer4_ln1 -> layer4_expert_routing
	layer4_expert_routing -> layer4_token_distribution
	layer4_token_distribution -> layer4_expert0_gate [style=dashed]
	layer4_token_distribution -> layer4_expert0_up [style=dashed]
	layer4_expert0_gate -> layer4_expert0_act
	layer4_expert0_up -> layer4_expert0_act
	layer4_expert0_act -> layer4_expert0_down
	layer4_expert0_down -> layer4_token_aggregation
	layer4_token_distribution -> layer4_expert1_gate [style=dashed]
	layer4_token_distribution -> layer4_expert1_up [style=dashed]
	layer4_expert1_gate -> layer4_expert1_act
	layer4_expert1_up -> layer4_expert1_act
	layer4_expert1_act -> layer4_expert1_down
	layer4_expert1_down -> layer4_token_aggregation
	layer4_token_distribution -> layer4_expert2_gate [style=dashed]
	layer4_token_distribution -> layer4_expert2_up [style=dashed]
	layer4_expert2_gate -> layer4_expert2_act
	layer4_expert2_up -> layer4_expert2_act
	layer4_expert2_act -> layer4_expert2_down
	layer4_expert2_down -> layer4_token_aggregation
	layer4_token_distribution -> layer4_expert3_gate [style=dashed]
	layer4_token_distribution -> layer4_expert3_up [style=dashed]
	layer4_expert3_gate -> layer4_expert3_act
	layer4_expert3_up -> layer4_expert3_act
	layer4_expert3_act -> layer4_expert3_down
	layer4_expert3_down -> layer4_token_aggregation
	layer4_token_distribution -> layer4_expert4_gate [style=dashed]
	layer4_token_distribution -> layer4_expert4_up [style=dashed]
	layer4_expert4_gate -> layer4_expert4_act
	layer4_expert4_up -> layer4_expert4_act
	layer4_expert4_act -> layer4_expert4_down
	layer4_expert4_down -> layer4_token_aggregation
	layer4_token_distribution -> layer4_expert5_gate [style=dashed]
	layer4_token_distribution -> layer4_expert5_up [style=dashed]
	layer4_expert5_gate -> layer4_expert5_act
	layer4_expert5_up -> layer4_expert5_act
	layer4_expert5_act -> layer4_expert5_down
	layer4_expert5_down -> layer4_token_aggregation
	layer4_token_distribution -> layer4_expert6_gate [style=dashed]
	layer4_token_distribution -> layer4_expert6_up [style=dashed]
	layer4_expert6_gate -> layer4_expert6_act
	layer4_expert6_up -> layer4_expert6_act
	layer4_expert6_act -> layer4_expert6_down
	layer4_expert6_down -> layer4_token_aggregation
	layer4_token_distribution -> layer4_expert7_gate [style=dashed]
	layer4_token_distribution -> layer4_expert7_up [style=dashed]
	layer4_expert7_gate -> layer4_expert7_act
	layer4_expert7_up -> layer4_expert7_act
	layer4_expert7_act -> layer4_expert7_down
	layer4_expert7_down -> layer4_token_aggregation
	layer4_token_distribution -> layer4_expert8_gate [style=dashed]
	layer4_token_distribution -> layer4_expert8_up [style=dashed]
	layer4_expert8_gate -> layer4_expert8_act
	layer4_expert8_up -> layer4_expert8_act
	layer4_expert8_act -> layer4_expert8_down
	layer4_expert8_down -> layer4_token_aggregation
	layer4_token_distribution -> layer4_expert9_gate [style=dashed]
	layer4_token_distribution -> layer4_expert9_up [style=dashed]
	layer4_expert9_gate -> layer4_expert9_act
	layer4_expert9_up -> layer4_expert9_act
	layer4_expert9_act -> layer4_expert9_down
	layer4_expert9_down -> layer4_token_aggregation
	layer4_token_distribution -> layer4_expert10_gate [style=dashed]
	layer4_token_distribution -> layer4_expert10_up [style=dashed]
	layer4_expert10_gate -> layer4_expert10_act
	layer4_expert10_up -> layer4_expert10_act
	layer4_expert10_act -> layer4_expert10_down
	layer4_expert10_down -> layer4_token_aggregation
	layer4_token_distribution -> layer4_expert11_gate [style=dashed]
	layer4_token_distribution -> layer4_expert11_up [style=dashed]
	layer4_expert11_gate -> layer4_expert11_act
	layer4_expert11_up -> layer4_expert11_act
	layer4_expert11_act -> layer4_expert11_down
	layer4_expert11_down -> layer4_token_aggregation
	layer4_token_distribution -> layer4_expert12_gate [style=dashed]
	layer4_token_distribution -> layer4_expert12_up [style=dashed]
	layer4_expert12_gate -> layer4_expert12_act
	layer4_expert12_up -> layer4_expert12_act
	layer4_expert12_act -> layer4_expert12_down
	layer4_expert12_down -> layer4_token_aggregation
	layer4_token_distribution -> layer4_expert13_gate [style=dashed]
	layer4_token_distribution -> layer4_expert13_up [style=dashed]
	layer4_expert13_gate -> layer4_expert13_act
	layer4_expert13_up -> layer4_expert13_act
	layer4_expert13_act -> layer4_expert13_down
	layer4_expert13_down -> layer4_token_aggregation
	layer4_token_distribution -> layer4_expert14_gate [style=dashed]
	layer4_token_distribution -> layer4_expert14_up [style=dashed]
	layer4_expert14_gate -> layer4_expert14_act
	layer4_expert14_up -> layer4_expert14_act
	layer4_expert14_act -> layer4_expert14_down
	layer4_expert14_down -> layer4_token_aggregation
	layer4_token_distribution -> layer4_expert15_gate [style=dashed]
	layer4_token_distribution -> layer4_expert15_up [style=dashed]
	layer4_expert15_gate -> layer4_expert15_act
	layer4_expert15_up -> layer4_expert15_act
	layer4_expert15_act -> layer4_expert15_down
	layer4_expert15_down -> layer4_token_aggregation
	layer4_token_aggregation -> layer4_res2
	layer5_mha_qkv [label="MHA QKV Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nAll GPUs" fillcolor=lightblue style=filled]
	layer5_mha_attn [label="MHA Attention\nInput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightgreen style=filled]
	layer5_mha_out [label="MHA Output Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightblue style=filled]
	layer5_res1 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer5_ln1 [label="Layer Norm\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=yellow style=filled]
	layer5_expert_routing [label="Expert Routing\nTop-2 Selection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, expert_id=2]\nAll GPUs" fillcolor=orange shape=diamond style=filled]
	layer5_token_distribution [label="Token Distribution\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: Tokens routed to 2 experts\nAll GPUs → Expert GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer5_expert0_gate [label="Expert 0 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer5_expert0_up [label="Expert 0 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer5_expert0_act [label="Expert 0 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightgreen style=filled]
	layer5_expert0_down [label="Expert 0 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 0" fillcolor=lightblue style=filled]
	layer5_expert1_gate [label="Expert 1 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer5_expert1_up [label="Expert 1 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer5_expert1_act [label="Expert 1 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightgreen style=filled]
	layer5_expert1_down [label="Expert 1 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 1" fillcolor=lightblue style=filled]
	layer5_expert2_gate [label="Expert 2 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer5_expert2_up [label="Expert 2 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer5_expert2_act [label="Expert 2 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightgreen style=filled]
	layer5_expert2_down [label="Expert 2 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 2" fillcolor=lightblue style=filled]
	layer5_expert3_gate [label="Expert 3 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer5_expert3_up [label="Expert 3 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer5_expert3_act [label="Expert 3 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightgreen style=filled]
	layer5_expert3_down [label="Expert 3 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 3" fillcolor=lightblue style=filled]
	layer5_expert4_gate [label="Expert 4 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer5_expert4_up [label="Expert 4 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer5_expert4_act [label="Expert 4 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightgreen style=filled]
	layer5_expert4_down [label="Expert 4 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 4" fillcolor=lightblue style=filled]
	layer5_expert5_gate [label="Expert 5 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer5_expert5_up [label="Expert 5 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer5_expert5_act [label="Expert 5 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightgreen style=filled]
	layer5_expert5_down [label="Expert 5 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 5" fillcolor=lightblue style=filled]
	layer5_expert6_gate [label="Expert 6 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer5_expert6_up [label="Expert 6 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer5_expert6_act [label="Expert 6 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightgreen style=filled]
	layer5_expert6_down [label="Expert 6 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 6" fillcolor=lightblue style=filled]
	layer5_expert7_gate [label="Expert 7 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer5_expert7_up [label="Expert 7 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer5_expert7_act [label="Expert 7 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightgreen style=filled]
	layer5_expert7_down [label="Expert 7 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 7" fillcolor=lightblue style=filled]
	layer5_expert8_gate [label="Expert 8 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer5_expert8_up [label="Expert 8 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer5_expert8_act [label="Expert 8 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightgreen style=filled]
	layer5_expert8_down [label="Expert 8 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 8" fillcolor=lightblue style=filled]
	layer5_expert9_gate [label="Expert 9 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer5_expert9_up [label="Expert 9 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer5_expert9_act [label="Expert 9 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightgreen style=filled]
	layer5_expert9_down [label="Expert 9 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 9" fillcolor=lightblue style=filled]
	layer5_expert10_gate [label="Expert 10 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer5_expert10_up [label="Expert 10 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer5_expert10_act [label="Expert 10 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightgreen style=filled]
	layer5_expert10_down [label="Expert 10 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 10" fillcolor=lightblue style=filled]
	layer5_expert11_gate [label="Expert 11 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer5_expert11_up [label="Expert 11 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer5_expert11_act [label="Expert 11 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightgreen style=filled]
	layer5_expert11_down [label="Expert 11 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 11" fillcolor=lightblue style=filled]
	layer5_expert12_gate [label="Expert 12 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer5_expert12_up [label="Expert 12 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer5_expert12_act [label="Expert 12 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightgreen style=filled]
	layer5_expert12_down [label="Expert 12 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 12" fillcolor=lightblue style=filled]
	layer5_expert13_gate [label="Expert 13 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer5_expert13_up [label="Expert 13 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer5_expert13_act [label="Expert 13 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightgreen style=filled]
	layer5_expert13_down [label="Expert 13 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 13" fillcolor=lightblue style=filled]
	layer5_expert14_gate [label="Expert 14 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer5_expert14_up [label="Expert 14 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer5_expert14_act [label="Expert 14 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightgreen style=filled]
	layer5_expert14_down [label="Expert 14 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 14" fillcolor=lightblue style=filled]
	layer5_expert15_gate [label="Expert 15 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer5_expert15_up [label="Expert 15 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer5_expert15_act [label="Expert 15 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightgreen style=filled]
	layer5_expert15_down [label="Expert 15 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 15" fillcolor=lightblue style=filled]
	layer5_token_aggregation [label="Token Aggregation\nInput: [dynamic_batch, seq_len, hidden=4096] from 2 experts\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer5_res2 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer4_res2 -> layer5_mha_qkv
	layer5_mha_qkv -> layer5_mha_attn
	layer5_mha_attn -> layer5_mha_out
	layer5_mha_out -> layer5_res1
	layer5_res1 -> layer5_ln1
	layer5_ln1 -> layer5_expert_routing
	layer5_expert_routing -> layer5_token_distribution
	layer5_token_distribution -> layer5_expert0_gate [style=dashed]
	layer5_token_distribution -> layer5_expert0_up [style=dashed]
	layer5_expert0_gate -> layer5_expert0_act
	layer5_expert0_up -> layer5_expert0_act
	layer5_expert0_act -> layer5_expert0_down
	layer5_expert0_down -> layer5_token_aggregation
	layer5_token_distribution -> layer5_expert1_gate [style=dashed]
	layer5_token_distribution -> layer5_expert1_up [style=dashed]
	layer5_expert1_gate -> layer5_expert1_act
	layer5_expert1_up -> layer5_expert1_act
	layer5_expert1_act -> layer5_expert1_down
	layer5_expert1_down -> layer5_token_aggregation
	layer5_token_distribution -> layer5_expert2_gate [style=dashed]
	layer5_token_distribution -> layer5_expert2_up [style=dashed]
	layer5_expert2_gate -> layer5_expert2_act
	layer5_expert2_up -> layer5_expert2_act
	layer5_expert2_act -> layer5_expert2_down
	layer5_expert2_down -> layer5_token_aggregation
	layer5_token_distribution -> layer5_expert3_gate [style=dashed]
	layer5_token_distribution -> layer5_expert3_up [style=dashed]
	layer5_expert3_gate -> layer5_expert3_act
	layer5_expert3_up -> layer5_expert3_act
	layer5_expert3_act -> layer5_expert3_down
	layer5_expert3_down -> layer5_token_aggregation
	layer5_token_distribution -> layer5_expert4_gate [style=dashed]
	layer5_token_distribution -> layer5_expert4_up [style=dashed]
	layer5_expert4_gate -> layer5_expert4_act
	layer5_expert4_up -> layer5_expert4_act
	layer5_expert4_act -> layer5_expert4_down
	layer5_expert4_down -> layer5_token_aggregation
	layer5_token_distribution -> layer5_expert5_gate [style=dashed]
	layer5_token_distribution -> layer5_expert5_up [style=dashed]
	layer5_expert5_gate -> layer5_expert5_act
	layer5_expert5_up -> layer5_expert5_act
	layer5_expert5_act -> layer5_expert5_down
	layer5_expert5_down -> layer5_token_aggregation
	layer5_token_distribution -> layer5_expert6_gate [style=dashed]
	layer5_token_distribution -> layer5_expert6_up [style=dashed]
	layer5_expert6_gate -> layer5_expert6_act
	layer5_expert6_up -> layer5_expert6_act
	layer5_expert6_act -> layer5_expert6_down
	layer5_expert6_down -> layer5_token_aggregation
	layer5_token_distribution -> layer5_expert7_gate [style=dashed]
	layer5_token_distribution -> layer5_expert7_up [style=dashed]
	layer5_expert7_gate -> layer5_expert7_act
	layer5_expert7_up -> layer5_expert7_act
	layer5_expert7_act -> layer5_expert7_down
	layer5_expert7_down -> layer5_token_aggregation
	layer5_token_distribution -> layer5_expert8_gate [style=dashed]
	layer5_token_distribution -> layer5_expert8_up [style=dashed]
	layer5_expert8_gate -> layer5_expert8_act
	layer5_expert8_up -> layer5_expert8_act
	layer5_expert8_act -> layer5_expert8_down
	layer5_expert8_down -> layer5_token_aggregation
	layer5_token_distribution -> layer5_expert9_gate [style=dashed]
	layer5_token_distribution -> layer5_expert9_up [style=dashed]
	layer5_expert9_gate -> layer5_expert9_act
	layer5_expert9_up -> layer5_expert9_act
	layer5_expert9_act -> layer5_expert9_down
	layer5_expert9_down -> layer5_token_aggregation
	layer5_token_distribution -> layer5_expert10_gate [style=dashed]
	layer5_token_distribution -> layer5_expert10_up [style=dashed]
	layer5_expert10_gate -> layer5_expert10_act
	layer5_expert10_up -> layer5_expert10_act
	layer5_expert10_act -> layer5_expert10_down
	layer5_expert10_down -> layer5_token_aggregation
	layer5_token_distribution -> layer5_expert11_gate [style=dashed]
	layer5_token_distribution -> layer5_expert11_up [style=dashed]
	layer5_expert11_gate -> layer5_expert11_act
	layer5_expert11_up -> layer5_expert11_act
	layer5_expert11_act -> layer5_expert11_down
	layer5_expert11_down -> layer5_token_aggregation
	layer5_token_distribution -> layer5_expert12_gate [style=dashed]
	layer5_token_distribution -> layer5_expert12_up [style=dashed]
	layer5_expert12_gate -> layer5_expert12_act
	layer5_expert12_up -> layer5_expert12_act
	layer5_expert12_act -> layer5_expert12_down
	layer5_expert12_down -> layer5_token_aggregation
	layer5_token_distribution -> layer5_expert13_gate [style=dashed]
	layer5_token_distribution -> layer5_expert13_up [style=dashed]
	layer5_expert13_gate -> layer5_expert13_act
	layer5_expert13_up -> layer5_expert13_act
	layer5_expert13_act -> layer5_expert13_down
	layer5_expert13_down -> layer5_token_aggregation
	layer5_token_distribution -> layer5_expert14_gate [style=dashed]
	layer5_token_distribution -> layer5_expert14_up [style=dashed]
	layer5_expert14_gate -> layer5_expert14_act
	layer5_expert14_up -> layer5_expert14_act
	layer5_expert14_act -> layer5_expert14_down
	layer5_expert14_down -> layer5_token_aggregation
	layer5_token_distribution -> layer5_expert15_gate [style=dashed]
	layer5_token_distribution -> layer5_expert15_up [style=dashed]
	layer5_expert15_gate -> layer5_expert15_act
	layer5_expert15_up -> layer5_expert15_act
	layer5_expert15_act -> layer5_expert15_down
	layer5_expert15_down -> layer5_token_aggregation
	layer5_token_aggregation -> layer5_res2
	layer6_mha_qkv [label="MHA QKV Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nAll GPUs" fillcolor=lightblue style=filled]
	layer6_mha_attn [label="MHA Attention\nInput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightgreen style=filled]
	layer6_mha_out [label="MHA Output Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightblue style=filled]
	layer6_res1 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer6_ln1 [label="Layer Norm\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=yellow style=filled]
	layer6_expert_routing [label="Expert Routing\nTop-2 Selection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, expert_id=2]\nAll GPUs" fillcolor=orange shape=diamond style=filled]
	layer6_token_distribution [label="Token Distribution\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: Tokens routed to 2 experts\nAll GPUs → Expert GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer6_expert0_gate [label="Expert 0 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer6_expert0_up [label="Expert 0 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer6_expert0_act [label="Expert 0 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightgreen style=filled]
	layer6_expert0_down [label="Expert 0 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 0" fillcolor=lightblue style=filled]
	layer6_expert1_gate [label="Expert 1 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer6_expert1_up [label="Expert 1 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer6_expert1_act [label="Expert 1 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightgreen style=filled]
	layer6_expert1_down [label="Expert 1 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 1" fillcolor=lightblue style=filled]
	layer6_expert2_gate [label="Expert 2 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer6_expert2_up [label="Expert 2 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer6_expert2_act [label="Expert 2 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightgreen style=filled]
	layer6_expert2_down [label="Expert 2 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 2" fillcolor=lightblue style=filled]
	layer6_expert3_gate [label="Expert 3 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer6_expert3_up [label="Expert 3 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer6_expert3_act [label="Expert 3 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightgreen style=filled]
	layer6_expert3_down [label="Expert 3 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 3" fillcolor=lightblue style=filled]
	layer6_expert4_gate [label="Expert 4 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer6_expert4_up [label="Expert 4 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer6_expert4_act [label="Expert 4 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightgreen style=filled]
	layer6_expert4_down [label="Expert 4 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 4" fillcolor=lightblue style=filled]
	layer6_expert5_gate [label="Expert 5 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer6_expert5_up [label="Expert 5 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer6_expert5_act [label="Expert 5 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightgreen style=filled]
	layer6_expert5_down [label="Expert 5 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 5" fillcolor=lightblue style=filled]
	layer6_expert6_gate [label="Expert 6 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer6_expert6_up [label="Expert 6 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer6_expert6_act [label="Expert 6 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightgreen style=filled]
	layer6_expert6_down [label="Expert 6 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 6" fillcolor=lightblue style=filled]
	layer6_expert7_gate [label="Expert 7 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer6_expert7_up [label="Expert 7 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer6_expert7_act [label="Expert 7 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightgreen style=filled]
	layer6_expert7_down [label="Expert 7 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 7" fillcolor=lightblue style=filled]
	layer6_expert8_gate [label="Expert 8 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer6_expert8_up [label="Expert 8 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer6_expert8_act [label="Expert 8 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightgreen style=filled]
	layer6_expert8_down [label="Expert 8 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 8" fillcolor=lightblue style=filled]
	layer6_expert9_gate [label="Expert 9 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer6_expert9_up [label="Expert 9 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer6_expert9_act [label="Expert 9 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightgreen style=filled]
	layer6_expert9_down [label="Expert 9 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 9" fillcolor=lightblue style=filled]
	layer6_expert10_gate [label="Expert 10 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer6_expert10_up [label="Expert 10 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer6_expert10_act [label="Expert 10 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightgreen style=filled]
	layer6_expert10_down [label="Expert 10 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 10" fillcolor=lightblue style=filled]
	layer6_expert11_gate [label="Expert 11 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer6_expert11_up [label="Expert 11 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer6_expert11_act [label="Expert 11 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightgreen style=filled]
	layer6_expert11_down [label="Expert 11 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 11" fillcolor=lightblue style=filled]
	layer6_expert12_gate [label="Expert 12 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer6_expert12_up [label="Expert 12 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer6_expert12_act [label="Expert 12 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightgreen style=filled]
	layer6_expert12_down [label="Expert 12 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 12" fillcolor=lightblue style=filled]
	layer6_expert13_gate [label="Expert 13 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer6_expert13_up [label="Expert 13 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer6_expert13_act [label="Expert 13 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightgreen style=filled]
	layer6_expert13_down [label="Expert 13 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 13" fillcolor=lightblue style=filled]
	layer6_expert14_gate [label="Expert 14 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer6_expert14_up [label="Expert 14 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer6_expert14_act [label="Expert 14 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightgreen style=filled]
	layer6_expert14_down [label="Expert 14 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 14" fillcolor=lightblue style=filled]
	layer6_expert15_gate [label="Expert 15 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer6_expert15_up [label="Expert 15 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer6_expert15_act [label="Expert 15 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightgreen style=filled]
	layer6_expert15_down [label="Expert 15 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 15" fillcolor=lightblue style=filled]
	layer6_token_aggregation [label="Token Aggregation\nInput: [dynamic_batch, seq_len, hidden=4096] from 2 experts\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer6_res2 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer5_res2 -> layer6_mha_qkv
	layer6_mha_qkv -> layer6_mha_attn
	layer6_mha_attn -> layer6_mha_out
	layer6_mha_out -> layer6_res1
	layer6_res1 -> layer6_ln1
	layer6_ln1 -> layer6_expert_routing
	layer6_expert_routing -> layer6_token_distribution
	layer6_token_distribution -> layer6_expert0_gate [style=dashed]
	layer6_token_distribution -> layer6_expert0_up [style=dashed]
	layer6_expert0_gate -> layer6_expert0_act
	layer6_expert0_up -> layer6_expert0_act
	layer6_expert0_act -> layer6_expert0_down
	layer6_expert0_down -> layer6_token_aggregation
	layer6_token_distribution -> layer6_expert1_gate [style=dashed]
	layer6_token_distribution -> layer6_expert1_up [style=dashed]
	layer6_expert1_gate -> layer6_expert1_act
	layer6_expert1_up -> layer6_expert1_act
	layer6_expert1_act -> layer6_expert1_down
	layer6_expert1_down -> layer6_token_aggregation
	layer6_token_distribution -> layer6_expert2_gate [style=dashed]
	layer6_token_distribution -> layer6_expert2_up [style=dashed]
	layer6_expert2_gate -> layer6_expert2_act
	layer6_expert2_up -> layer6_expert2_act
	layer6_expert2_act -> layer6_expert2_down
	layer6_expert2_down -> layer6_token_aggregation
	layer6_token_distribution -> layer6_expert3_gate [style=dashed]
	layer6_token_distribution -> layer6_expert3_up [style=dashed]
	layer6_expert3_gate -> layer6_expert3_act
	layer6_expert3_up -> layer6_expert3_act
	layer6_expert3_act -> layer6_expert3_down
	layer6_expert3_down -> layer6_token_aggregation
	layer6_token_distribution -> layer6_expert4_gate [style=dashed]
	layer6_token_distribution -> layer6_expert4_up [style=dashed]
	layer6_expert4_gate -> layer6_expert4_act
	layer6_expert4_up -> layer6_expert4_act
	layer6_expert4_act -> layer6_expert4_down
	layer6_expert4_down -> layer6_token_aggregation
	layer6_token_distribution -> layer6_expert5_gate [style=dashed]
	layer6_token_distribution -> layer6_expert5_up [style=dashed]
	layer6_expert5_gate -> layer6_expert5_act
	layer6_expert5_up -> layer6_expert5_act
	layer6_expert5_act -> layer6_expert5_down
	layer6_expert5_down -> layer6_token_aggregation
	layer6_token_distribution -> layer6_expert6_gate [style=dashed]
	layer6_token_distribution -> layer6_expert6_up [style=dashed]
	layer6_expert6_gate -> layer6_expert6_act
	layer6_expert6_up -> layer6_expert6_act
	layer6_expert6_act -> layer6_expert6_down
	layer6_expert6_down -> layer6_token_aggregation
	layer6_token_distribution -> layer6_expert7_gate [style=dashed]
	layer6_token_distribution -> layer6_expert7_up [style=dashed]
	layer6_expert7_gate -> layer6_expert7_act
	layer6_expert7_up -> layer6_expert7_act
	layer6_expert7_act -> layer6_expert7_down
	layer6_expert7_down -> layer6_token_aggregation
	layer6_token_distribution -> layer6_expert8_gate [style=dashed]
	layer6_token_distribution -> layer6_expert8_up [style=dashed]
	layer6_expert8_gate -> layer6_expert8_act
	layer6_expert8_up -> layer6_expert8_act
	layer6_expert8_act -> layer6_expert8_down
	layer6_expert8_down -> layer6_token_aggregation
	layer6_token_distribution -> layer6_expert9_gate [style=dashed]
	layer6_token_distribution -> layer6_expert9_up [style=dashed]
	layer6_expert9_gate -> layer6_expert9_act
	layer6_expert9_up -> layer6_expert9_act
	layer6_expert9_act -> layer6_expert9_down
	layer6_expert9_down -> layer6_token_aggregation
	layer6_token_distribution -> layer6_expert10_gate [style=dashed]
	layer6_token_distribution -> layer6_expert10_up [style=dashed]
	layer6_expert10_gate -> layer6_expert10_act
	layer6_expert10_up -> layer6_expert10_act
	layer6_expert10_act -> layer6_expert10_down
	layer6_expert10_down -> layer6_token_aggregation
	layer6_token_distribution -> layer6_expert11_gate [style=dashed]
	layer6_token_distribution -> layer6_expert11_up [style=dashed]
	layer6_expert11_gate -> layer6_expert11_act
	layer6_expert11_up -> layer6_expert11_act
	layer6_expert11_act -> layer6_expert11_down
	layer6_expert11_down -> layer6_token_aggregation
	layer6_token_distribution -> layer6_expert12_gate [style=dashed]
	layer6_token_distribution -> layer6_expert12_up [style=dashed]
	layer6_expert12_gate -> layer6_expert12_act
	layer6_expert12_up -> layer6_expert12_act
	layer6_expert12_act -> layer6_expert12_down
	layer6_expert12_down -> layer6_token_aggregation
	layer6_token_distribution -> layer6_expert13_gate [style=dashed]
	layer6_token_distribution -> layer6_expert13_up [style=dashed]
	layer6_expert13_gate -> layer6_expert13_act
	layer6_expert13_up -> layer6_expert13_act
	layer6_expert13_act -> layer6_expert13_down
	layer6_expert13_down -> layer6_token_aggregation
	layer6_token_distribution -> layer6_expert14_gate [style=dashed]
	layer6_token_distribution -> layer6_expert14_up [style=dashed]
	layer6_expert14_gate -> layer6_expert14_act
	layer6_expert14_up -> layer6_expert14_act
	layer6_expert14_act -> layer6_expert14_down
	layer6_expert14_down -> layer6_token_aggregation
	layer6_token_distribution -> layer6_expert15_gate [style=dashed]
	layer6_token_distribution -> layer6_expert15_up [style=dashed]
	layer6_expert15_gate -> layer6_expert15_act
	layer6_expert15_up -> layer6_expert15_act
	layer6_expert15_act -> layer6_expert15_down
	layer6_expert15_down -> layer6_token_aggregation
	layer6_token_aggregation -> layer6_res2
	layer7_mha_qkv [label="MHA QKV Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nAll GPUs" fillcolor=lightblue style=filled]
	layer7_mha_attn [label="MHA Attention\nInput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightgreen style=filled]
	layer7_mha_out [label="MHA Output Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightblue style=filled]
	layer7_res1 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer7_ln1 [label="Layer Norm\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=yellow style=filled]
	layer7_expert_routing [label="Expert Routing\nTop-2 Selection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, expert_id=2]\nAll GPUs" fillcolor=orange shape=diamond style=filled]
	layer7_token_distribution [label="Token Distribution\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: Tokens routed to 2 experts\nAll GPUs → Expert GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer7_expert0_gate [label="Expert 0 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer7_expert0_up [label="Expert 0 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer7_expert0_act [label="Expert 0 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightgreen style=filled]
	layer7_expert0_down [label="Expert 0 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 0" fillcolor=lightblue style=filled]
	layer7_expert1_gate [label="Expert 1 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer7_expert1_up [label="Expert 1 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer7_expert1_act [label="Expert 1 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightgreen style=filled]
	layer7_expert1_down [label="Expert 1 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 1" fillcolor=lightblue style=filled]
	layer7_expert2_gate [label="Expert 2 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer7_expert2_up [label="Expert 2 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer7_expert2_act [label="Expert 2 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightgreen style=filled]
	layer7_expert2_down [label="Expert 2 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 2" fillcolor=lightblue style=filled]
	layer7_expert3_gate [label="Expert 3 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer7_expert3_up [label="Expert 3 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer7_expert3_act [label="Expert 3 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightgreen style=filled]
	layer7_expert3_down [label="Expert 3 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 3" fillcolor=lightblue style=filled]
	layer7_expert4_gate [label="Expert 4 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer7_expert4_up [label="Expert 4 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer7_expert4_act [label="Expert 4 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightgreen style=filled]
	layer7_expert4_down [label="Expert 4 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 4" fillcolor=lightblue style=filled]
	layer7_expert5_gate [label="Expert 5 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer7_expert5_up [label="Expert 5 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer7_expert5_act [label="Expert 5 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightgreen style=filled]
	layer7_expert5_down [label="Expert 5 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 5" fillcolor=lightblue style=filled]
	layer7_expert6_gate [label="Expert 6 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer7_expert6_up [label="Expert 6 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer7_expert6_act [label="Expert 6 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightgreen style=filled]
	layer7_expert6_down [label="Expert 6 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 6" fillcolor=lightblue style=filled]
	layer7_expert7_gate [label="Expert 7 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer7_expert7_up [label="Expert 7 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer7_expert7_act [label="Expert 7 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightgreen style=filled]
	layer7_expert7_down [label="Expert 7 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 7" fillcolor=lightblue style=filled]
	layer7_expert8_gate [label="Expert 8 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer7_expert8_up [label="Expert 8 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer7_expert8_act [label="Expert 8 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightgreen style=filled]
	layer7_expert8_down [label="Expert 8 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 8" fillcolor=lightblue style=filled]
	layer7_expert9_gate [label="Expert 9 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer7_expert9_up [label="Expert 9 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer7_expert9_act [label="Expert 9 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightgreen style=filled]
	layer7_expert9_down [label="Expert 9 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 9" fillcolor=lightblue style=filled]
	layer7_expert10_gate [label="Expert 10 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer7_expert10_up [label="Expert 10 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer7_expert10_act [label="Expert 10 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightgreen style=filled]
	layer7_expert10_down [label="Expert 10 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 10" fillcolor=lightblue style=filled]
	layer7_expert11_gate [label="Expert 11 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer7_expert11_up [label="Expert 11 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer7_expert11_act [label="Expert 11 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightgreen style=filled]
	layer7_expert11_down [label="Expert 11 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 11" fillcolor=lightblue style=filled]
	layer7_expert12_gate [label="Expert 12 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer7_expert12_up [label="Expert 12 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer7_expert12_act [label="Expert 12 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightgreen style=filled]
	layer7_expert12_down [label="Expert 12 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 12" fillcolor=lightblue style=filled]
	layer7_expert13_gate [label="Expert 13 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer7_expert13_up [label="Expert 13 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer7_expert13_act [label="Expert 13 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightgreen style=filled]
	layer7_expert13_down [label="Expert 13 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 13" fillcolor=lightblue style=filled]
	layer7_expert14_gate [label="Expert 14 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer7_expert14_up [label="Expert 14 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer7_expert14_act [label="Expert 14 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightgreen style=filled]
	layer7_expert14_down [label="Expert 14 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 14" fillcolor=lightblue style=filled]
	layer7_expert15_gate [label="Expert 15 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer7_expert15_up [label="Expert 15 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer7_expert15_act [label="Expert 15 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightgreen style=filled]
	layer7_expert15_down [label="Expert 15 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 15" fillcolor=lightblue style=filled]
	layer7_token_aggregation [label="Token Aggregation\nInput: [dynamic_batch, seq_len, hidden=4096] from 2 experts\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer7_res2 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer6_res2 -> layer7_mha_qkv
	layer7_mha_qkv -> layer7_mha_attn
	layer7_mha_attn -> layer7_mha_out
	layer7_mha_out -> layer7_res1
	layer7_res1 -> layer7_ln1
	layer7_ln1 -> layer7_expert_routing
	layer7_expert_routing -> layer7_token_distribution
	layer7_token_distribution -> layer7_expert0_gate [style=dashed]
	layer7_token_distribution -> layer7_expert0_up [style=dashed]
	layer7_expert0_gate -> layer7_expert0_act
	layer7_expert0_up -> layer7_expert0_act
	layer7_expert0_act -> layer7_expert0_down
	layer7_expert0_down -> layer7_token_aggregation
	layer7_token_distribution -> layer7_expert1_gate [style=dashed]
	layer7_token_distribution -> layer7_expert1_up [style=dashed]
	layer7_expert1_gate -> layer7_expert1_act
	layer7_expert1_up -> layer7_expert1_act
	layer7_expert1_act -> layer7_expert1_down
	layer7_expert1_down -> layer7_token_aggregation
	layer7_token_distribution -> layer7_expert2_gate [style=dashed]
	layer7_token_distribution -> layer7_expert2_up [style=dashed]
	layer7_expert2_gate -> layer7_expert2_act
	layer7_expert2_up -> layer7_expert2_act
	layer7_expert2_act -> layer7_expert2_down
	layer7_expert2_down -> layer7_token_aggregation
	layer7_token_distribution -> layer7_expert3_gate [style=dashed]
	layer7_token_distribution -> layer7_expert3_up [style=dashed]
	layer7_expert3_gate -> layer7_expert3_act
	layer7_expert3_up -> layer7_expert3_act
	layer7_expert3_act -> layer7_expert3_down
	layer7_expert3_down -> layer7_token_aggregation
	layer7_token_distribution -> layer7_expert4_gate [style=dashed]
	layer7_token_distribution -> layer7_expert4_up [style=dashed]
	layer7_expert4_gate -> layer7_expert4_act
	layer7_expert4_up -> layer7_expert4_act
	layer7_expert4_act -> layer7_expert4_down
	layer7_expert4_down -> layer7_token_aggregation
	layer7_token_distribution -> layer7_expert5_gate [style=dashed]
	layer7_token_distribution -> layer7_expert5_up [style=dashed]
	layer7_expert5_gate -> layer7_expert5_act
	layer7_expert5_up -> layer7_expert5_act
	layer7_expert5_act -> layer7_expert5_down
	layer7_expert5_down -> layer7_token_aggregation
	layer7_token_distribution -> layer7_expert6_gate [style=dashed]
	layer7_token_distribution -> layer7_expert6_up [style=dashed]
	layer7_expert6_gate -> layer7_expert6_act
	layer7_expert6_up -> layer7_expert6_act
	layer7_expert6_act -> layer7_expert6_down
	layer7_expert6_down -> layer7_token_aggregation
	layer7_token_distribution -> layer7_expert7_gate [style=dashed]
	layer7_token_distribution -> layer7_expert7_up [style=dashed]
	layer7_expert7_gate -> layer7_expert7_act
	layer7_expert7_up -> layer7_expert7_act
	layer7_expert7_act -> layer7_expert7_down
	layer7_expert7_down -> layer7_token_aggregation
	layer7_token_distribution -> layer7_expert8_gate [style=dashed]
	layer7_token_distribution -> layer7_expert8_up [style=dashed]
	layer7_expert8_gate -> layer7_expert8_act
	layer7_expert8_up -> layer7_expert8_act
	layer7_expert8_act -> layer7_expert8_down
	layer7_expert8_down -> layer7_token_aggregation
	layer7_token_distribution -> layer7_expert9_gate [style=dashed]
	layer7_token_distribution -> layer7_expert9_up [style=dashed]
	layer7_expert9_gate -> layer7_expert9_act
	layer7_expert9_up -> layer7_expert9_act
	layer7_expert9_act -> layer7_expert9_down
	layer7_expert9_down -> layer7_token_aggregation
	layer7_token_distribution -> layer7_expert10_gate [style=dashed]
	layer7_token_distribution -> layer7_expert10_up [style=dashed]
	layer7_expert10_gate -> layer7_expert10_act
	layer7_expert10_up -> layer7_expert10_act
	layer7_expert10_act -> layer7_expert10_down
	layer7_expert10_down -> layer7_token_aggregation
	layer7_token_distribution -> layer7_expert11_gate [style=dashed]
	layer7_token_distribution -> layer7_expert11_up [style=dashed]
	layer7_expert11_gate -> layer7_expert11_act
	layer7_expert11_up -> layer7_expert11_act
	layer7_expert11_act -> layer7_expert11_down
	layer7_expert11_down -> layer7_token_aggregation
	layer7_token_distribution -> layer7_expert12_gate [style=dashed]
	layer7_token_distribution -> layer7_expert12_up [style=dashed]
	layer7_expert12_gate -> layer7_expert12_act
	layer7_expert12_up -> layer7_expert12_act
	layer7_expert12_act -> layer7_expert12_down
	layer7_expert12_down -> layer7_token_aggregation
	layer7_token_distribution -> layer7_expert13_gate [style=dashed]
	layer7_token_distribution -> layer7_expert13_up [style=dashed]
	layer7_expert13_gate -> layer7_expert13_act
	layer7_expert13_up -> layer7_expert13_act
	layer7_expert13_act -> layer7_expert13_down
	layer7_expert13_down -> layer7_token_aggregation
	layer7_token_distribution -> layer7_expert14_gate [style=dashed]
	layer7_token_distribution -> layer7_expert14_up [style=dashed]
	layer7_expert14_gate -> layer7_expert14_act
	layer7_expert14_up -> layer7_expert14_act
	layer7_expert14_act -> layer7_expert14_down
	layer7_expert14_down -> layer7_token_aggregation
	layer7_token_distribution -> layer7_expert15_gate [style=dashed]
	layer7_token_distribution -> layer7_expert15_up [style=dashed]
	layer7_expert15_gate -> layer7_expert15_act
	layer7_expert15_up -> layer7_expert15_act
	layer7_expert15_act -> layer7_expert15_down
	layer7_expert15_down -> layer7_token_aggregation
	layer7_token_aggregation -> layer7_res2
	layer8_mha_qkv [label="MHA QKV Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nAll GPUs" fillcolor=lightblue style=filled]
	layer8_mha_attn [label="MHA Attention\nInput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightgreen style=filled]
	layer8_mha_out [label="MHA Output Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightblue style=filled]
	layer8_res1 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer8_ln1 [label="Layer Norm\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=yellow style=filled]
	layer8_expert_routing [label="Expert Routing\nTop-2 Selection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, expert_id=2]\nAll GPUs" fillcolor=orange shape=diamond style=filled]
	layer8_token_distribution [label="Token Distribution\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: Tokens routed to 2 experts\nAll GPUs → Expert GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer8_expert0_gate [label="Expert 0 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer8_expert0_up [label="Expert 0 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer8_expert0_act [label="Expert 0 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightgreen style=filled]
	layer8_expert0_down [label="Expert 0 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 0" fillcolor=lightblue style=filled]
	layer8_expert1_gate [label="Expert 1 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer8_expert1_up [label="Expert 1 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer8_expert1_act [label="Expert 1 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightgreen style=filled]
	layer8_expert1_down [label="Expert 1 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 1" fillcolor=lightblue style=filled]
	layer8_expert2_gate [label="Expert 2 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer8_expert2_up [label="Expert 2 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer8_expert2_act [label="Expert 2 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightgreen style=filled]
	layer8_expert2_down [label="Expert 2 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 2" fillcolor=lightblue style=filled]
	layer8_expert3_gate [label="Expert 3 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer8_expert3_up [label="Expert 3 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer8_expert3_act [label="Expert 3 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightgreen style=filled]
	layer8_expert3_down [label="Expert 3 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 3" fillcolor=lightblue style=filled]
	layer8_expert4_gate [label="Expert 4 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer8_expert4_up [label="Expert 4 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer8_expert4_act [label="Expert 4 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightgreen style=filled]
	layer8_expert4_down [label="Expert 4 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 4" fillcolor=lightblue style=filled]
	layer8_expert5_gate [label="Expert 5 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer8_expert5_up [label="Expert 5 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer8_expert5_act [label="Expert 5 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightgreen style=filled]
	layer8_expert5_down [label="Expert 5 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 5" fillcolor=lightblue style=filled]
	layer8_expert6_gate [label="Expert 6 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer8_expert6_up [label="Expert 6 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer8_expert6_act [label="Expert 6 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightgreen style=filled]
	layer8_expert6_down [label="Expert 6 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 6" fillcolor=lightblue style=filled]
	layer8_expert7_gate [label="Expert 7 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer8_expert7_up [label="Expert 7 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer8_expert7_act [label="Expert 7 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightgreen style=filled]
	layer8_expert7_down [label="Expert 7 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 7" fillcolor=lightblue style=filled]
	layer8_expert8_gate [label="Expert 8 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer8_expert8_up [label="Expert 8 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer8_expert8_act [label="Expert 8 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightgreen style=filled]
	layer8_expert8_down [label="Expert 8 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 8" fillcolor=lightblue style=filled]
	layer8_expert9_gate [label="Expert 9 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer8_expert9_up [label="Expert 9 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer8_expert9_act [label="Expert 9 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightgreen style=filled]
	layer8_expert9_down [label="Expert 9 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 9" fillcolor=lightblue style=filled]
	layer8_expert10_gate [label="Expert 10 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer8_expert10_up [label="Expert 10 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer8_expert10_act [label="Expert 10 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightgreen style=filled]
	layer8_expert10_down [label="Expert 10 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 10" fillcolor=lightblue style=filled]
	layer8_expert11_gate [label="Expert 11 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer8_expert11_up [label="Expert 11 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer8_expert11_act [label="Expert 11 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightgreen style=filled]
	layer8_expert11_down [label="Expert 11 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 11" fillcolor=lightblue style=filled]
	layer8_expert12_gate [label="Expert 12 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer8_expert12_up [label="Expert 12 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer8_expert12_act [label="Expert 12 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightgreen style=filled]
	layer8_expert12_down [label="Expert 12 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 12" fillcolor=lightblue style=filled]
	layer8_expert13_gate [label="Expert 13 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer8_expert13_up [label="Expert 13 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer8_expert13_act [label="Expert 13 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightgreen style=filled]
	layer8_expert13_down [label="Expert 13 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 13" fillcolor=lightblue style=filled]
	layer8_expert14_gate [label="Expert 14 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer8_expert14_up [label="Expert 14 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer8_expert14_act [label="Expert 14 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightgreen style=filled]
	layer8_expert14_down [label="Expert 14 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 14" fillcolor=lightblue style=filled]
	layer8_expert15_gate [label="Expert 15 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer8_expert15_up [label="Expert 15 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer8_expert15_act [label="Expert 15 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightgreen style=filled]
	layer8_expert15_down [label="Expert 15 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 15" fillcolor=lightblue style=filled]
	layer8_token_aggregation [label="Token Aggregation\nInput: [dynamic_batch, seq_len, hidden=4096] from 2 experts\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer8_res2 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer7_res2 -> layer8_mha_qkv
	layer8_mha_qkv -> layer8_mha_attn
	layer8_mha_attn -> layer8_mha_out
	layer8_mha_out -> layer8_res1
	layer8_res1 -> layer8_ln1
	layer8_ln1 -> layer8_expert_routing
	layer8_expert_routing -> layer8_token_distribution
	layer8_token_distribution -> layer8_expert0_gate [style=dashed]
	layer8_token_distribution -> layer8_expert0_up [style=dashed]
	layer8_expert0_gate -> layer8_expert0_act
	layer8_expert0_up -> layer8_expert0_act
	layer8_expert0_act -> layer8_expert0_down
	layer8_expert0_down -> layer8_token_aggregation
	layer8_token_distribution -> layer8_expert1_gate [style=dashed]
	layer8_token_distribution -> layer8_expert1_up [style=dashed]
	layer8_expert1_gate -> layer8_expert1_act
	layer8_expert1_up -> layer8_expert1_act
	layer8_expert1_act -> layer8_expert1_down
	layer8_expert1_down -> layer8_token_aggregation
	layer8_token_distribution -> layer8_expert2_gate [style=dashed]
	layer8_token_distribution -> layer8_expert2_up [style=dashed]
	layer8_expert2_gate -> layer8_expert2_act
	layer8_expert2_up -> layer8_expert2_act
	layer8_expert2_act -> layer8_expert2_down
	layer8_expert2_down -> layer8_token_aggregation
	layer8_token_distribution -> layer8_expert3_gate [style=dashed]
	layer8_token_distribution -> layer8_expert3_up [style=dashed]
	layer8_expert3_gate -> layer8_expert3_act
	layer8_expert3_up -> layer8_expert3_act
	layer8_expert3_act -> layer8_expert3_down
	layer8_expert3_down -> layer8_token_aggregation
	layer8_token_distribution -> layer8_expert4_gate [style=dashed]
	layer8_token_distribution -> layer8_expert4_up [style=dashed]
	layer8_expert4_gate -> layer8_expert4_act
	layer8_expert4_up -> layer8_expert4_act
	layer8_expert4_act -> layer8_expert4_down
	layer8_expert4_down -> layer8_token_aggregation
	layer8_token_distribution -> layer8_expert5_gate [style=dashed]
	layer8_token_distribution -> layer8_expert5_up [style=dashed]
	layer8_expert5_gate -> layer8_expert5_act
	layer8_expert5_up -> layer8_expert5_act
	layer8_expert5_act -> layer8_expert5_down
	layer8_expert5_down -> layer8_token_aggregation
	layer8_token_distribution -> layer8_expert6_gate [style=dashed]
	layer8_token_distribution -> layer8_expert6_up [style=dashed]
	layer8_expert6_gate -> layer8_expert6_act
	layer8_expert6_up -> layer8_expert6_act
	layer8_expert6_act -> layer8_expert6_down
	layer8_expert6_down -> layer8_token_aggregation
	layer8_token_distribution -> layer8_expert7_gate [style=dashed]
	layer8_token_distribution -> layer8_expert7_up [style=dashed]
	layer8_expert7_gate -> layer8_expert7_act
	layer8_expert7_up -> layer8_expert7_act
	layer8_expert7_act -> layer8_expert7_down
	layer8_expert7_down -> layer8_token_aggregation
	layer8_token_distribution -> layer8_expert8_gate [style=dashed]
	layer8_token_distribution -> layer8_expert8_up [style=dashed]
	layer8_expert8_gate -> layer8_expert8_act
	layer8_expert8_up -> layer8_expert8_act
	layer8_expert8_act -> layer8_expert8_down
	layer8_expert8_down -> layer8_token_aggregation
	layer8_token_distribution -> layer8_expert9_gate [style=dashed]
	layer8_token_distribution -> layer8_expert9_up [style=dashed]
	layer8_expert9_gate -> layer8_expert9_act
	layer8_expert9_up -> layer8_expert9_act
	layer8_expert9_act -> layer8_expert9_down
	layer8_expert9_down -> layer8_token_aggregation
	layer8_token_distribution -> layer8_expert10_gate [style=dashed]
	layer8_token_distribution -> layer8_expert10_up [style=dashed]
	layer8_expert10_gate -> layer8_expert10_act
	layer8_expert10_up -> layer8_expert10_act
	layer8_expert10_act -> layer8_expert10_down
	layer8_expert10_down -> layer8_token_aggregation
	layer8_token_distribution -> layer8_expert11_gate [style=dashed]
	layer8_token_distribution -> layer8_expert11_up [style=dashed]
	layer8_expert11_gate -> layer8_expert11_act
	layer8_expert11_up -> layer8_expert11_act
	layer8_expert11_act -> layer8_expert11_down
	layer8_expert11_down -> layer8_token_aggregation
	layer8_token_distribution -> layer8_expert12_gate [style=dashed]
	layer8_token_distribution -> layer8_expert12_up [style=dashed]
	layer8_expert12_gate -> layer8_expert12_act
	layer8_expert12_up -> layer8_expert12_act
	layer8_expert12_act -> layer8_expert12_down
	layer8_expert12_down -> layer8_token_aggregation
	layer8_token_distribution -> layer8_expert13_gate [style=dashed]
	layer8_token_distribution -> layer8_expert13_up [style=dashed]
	layer8_expert13_gate -> layer8_expert13_act
	layer8_expert13_up -> layer8_expert13_act
	layer8_expert13_act -> layer8_expert13_down
	layer8_expert13_down -> layer8_token_aggregation
	layer8_token_distribution -> layer8_expert14_gate [style=dashed]
	layer8_token_distribution -> layer8_expert14_up [style=dashed]
	layer8_expert14_gate -> layer8_expert14_act
	layer8_expert14_up -> layer8_expert14_act
	layer8_expert14_act -> layer8_expert14_down
	layer8_expert14_down -> layer8_token_aggregation
	layer8_token_distribution -> layer8_expert15_gate [style=dashed]
	layer8_token_distribution -> layer8_expert15_up [style=dashed]
	layer8_expert15_gate -> layer8_expert15_act
	layer8_expert15_up -> layer8_expert15_act
	layer8_expert15_act -> layer8_expert15_down
	layer8_expert15_down -> layer8_token_aggregation
	layer8_token_aggregation -> layer8_res2
	layer9_mha_qkv [label="MHA QKV Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nAll GPUs" fillcolor=lightblue style=filled]
	layer9_mha_attn [label="MHA Attention\nInput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightgreen style=filled]
	layer9_mha_out [label="MHA Output Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightblue style=filled]
	layer9_res1 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer9_ln1 [label="Layer Norm\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=yellow style=filled]
	layer9_expert_routing [label="Expert Routing\nTop-2 Selection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, expert_id=2]\nAll GPUs" fillcolor=orange shape=diamond style=filled]
	layer9_token_distribution [label="Token Distribution\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: Tokens routed to 2 experts\nAll GPUs → Expert GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer9_expert0_gate [label="Expert 0 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer9_expert0_up [label="Expert 0 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer9_expert0_act [label="Expert 0 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightgreen style=filled]
	layer9_expert0_down [label="Expert 0 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 0" fillcolor=lightblue style=filled]
	layer9_expert1_gate [label="Expert 1 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer9_expert1_up [label="Expert 1 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer9_expert1_act [label="Expert 1 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightgreen style=filled]
	layer9_expert1_down [label="Expert 1 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 1" fillcolor=lightblue style=filled]
	layer9_expert2_gate [label="Expert 2 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer9_expert2_up [label="Expert 2 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer9_expert2_act [label="Expert 2 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightgreen style=filled]
	layer9_expert2_down [label="Expert 2 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 2" fillcolor=lightblue style=filled]
	layer9_expert3_gate [label="Expert 3 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer9_expert3_up [label="Expert 3 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer9_expert3_act [label="Expert 3 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightgreen style=filled]
	layer9_expert3_down [label="Expert 3 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 3" fillcolor=lightblue style=filled]
	layer9_expert4_gate [label="Expert 4 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer9_expert4_up [label="Expert 4 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer9_expert4_act [label="Expert 4 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightgreen style=filled]
	layer9_expert4_down [label="Expert 4 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 4" fillcolor=lightblue style=filled]
	layer9_expert5_gate [label="Expert 5 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer9_expert5_up [label="Expert 5 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer9_expert5_act [label="Expert 5 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightgreen style=filled]
	layer9_expert5_down [label="Expert 5 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 5" fillcolor=lightblue style=filled]
	layer9_expert6_gate [label="Expert 6 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer9_expert6_up [label="Expert 6 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer9_expert6_act [label="Expert 6 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightgreen style=filled]
	layer9_expert6_down [label="Expert 6 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 6" fillcolor=lightblue style=filled]
	layer9_expert7_gate [label="Expert 7 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer9_expert7_up [label="Expert 7 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer9_expert7_act [label="Expert 7 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightgreen style=filled]
	layer9_expert7_down [label="Expert 7 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 7" fillcolor=lightblue style=filled]
	layer9_expert8_gate [label="Expert 8 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer9_expert8_up [label="Expert 8 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer9_expert8_act [label="Expert 8 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightgreen style=filled]
	layer9_expert8_down [label="Expert 8 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 8" fillcolor=lightblue style=filled]
	layer9_expert9_gate [label="Expert 9 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer9_expert9_up [label="Expert 9 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer9_expert9_act [label="Expert 9 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightgreen style=filled]
	layer9_expert9_down [label="Expert 9 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 9" fillcolor=lightblue style=filled]
	layer9_expert10_gate [label="Expert 10 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer9_expert10_up [label="Expert 10 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer9_expert10_act [label="Expert 10 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightgreen style=filled]
	layer9_expert10_down [label="Expert 10 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 10" fillcolor=lightblue style=filled]
	layer9_expert11_gate [label="Expert 11 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer9_expert11_up [label="Expert 11 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer9_expert11_act [label="Expert 11 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightgreen style=filled]
	layer9_expert11_down [label="Expert 11 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 11" fillcolor=lightblue style=filled]
	layer9_expert12_gate [label="Expert 12 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer9_expert12_up [label="Expert 12 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer9_expert12_act [label="Expert 12 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightgreen style=filled]
	layer9_expert12_down [label="Expert 12 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 12" fillcolor=lightblue style=filled]
	layer9_expert13_gate [label="Expert 13 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer9_expert13_up [label="Expert 13 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer9_expert13_act [label="Expert 13 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightgreen style=filled]
	layer9_expert13_down [label="Expert 13 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 13" fillcolor=lightblue style=filled]
	layer9_expert14_gate [label="Expert 14 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer9_expert14_up [label="Expert 14 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer9_expert14_act [label="Expert 14 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightgreen style=filled]
	layer9_expert14_down [label="Expert 14 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 14" fillcolor=lightblue style=filled]
	layer9_expert15_gate [label="Expert 15 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer9_expert15_up [label="Expert 15 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer9_expert15_act [label="Expert 15 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightgreen style=filled]
	layer9_expert15_down [label="Expert 15 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 15" fillcolor=lightblue style=filled]
	layer9_token_aggregation [label="Token Aggregation\nInput: [dynamic_batch, seq_len, hidden=4096] from 2 experts\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer9_res2 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer8_res2 -> layer9_mha_qkv
	layer9_mha_qkv -> layer9_mha_attn
	layer9_mha_attn -> layer9_mha_out
	layer9_mha_out -> layer9_res1
	layer9_res1 -> layer9_ln1
	layer9_ln1 -> layer9_expert_routing
	layer9_expert_routing -> layer9_token_distribution
	layer9_token_distribution -> layer9_expert0_gate [style=dashed]
	layer9_token_distribution -> layer9_expert0_up [style=dashed]
	layer9_expert0_gate -> layer9_expert0_act
	layer9_expert0_up -> layer9_expert0_act
	layer9_expert0_act -> layer9_expert0_down
	layer9_expert0_down -> layer9_token_aggregation
	layer9_token_distribution -> layer9_expert1_gate [style=dashed]
	layer9_token_distribution -> layer9_expert1_up [style=dashed]
	layer9_expert1_gate -> layer9_expert1_act
	layer9_expert1_up -> layer9_expert1_act
	layer9_expert1_act -> layer9_expert1_down
	layer9_expert1_down -> layer9_token_aggregation
	layer9_token_distribution -> layer9_expert2_gate [style=dashed]
	layer9_token_distribution -> layer9_expert2_up [style=dashed]
	layer9_expert2_gate -> layer9_expert2_act
	layer9_expert2_up -> layer9_expert2_act
	layer9_expert2_act -> layer9_expert2_down
	layer9_expert2_down -> layer9_token_aggregation
	layer9_token_distribution -> layer9_expert3_gate [style=dashed]
	layer9_token_distribution -> layer9_expert3_up [style=dashed]
	layer9_expert3_gate -> layer9_expert3_act
	layer9_expert3_up -> layer9_expert3_act
	layer9_expert3_act -> layer9_expert3_down
	layer9_expert3_down -> layer9_token_aggregation
	layer9_token_distribution -> layer9_expert4_gate [style=dashed]
	layer9_token_distribution -> layer9_expert4_up [style=dashed]
	layer9_expert4_gate -> layer9_expert4_act
	layer9_expert4_up -> layer9_expert4_act
	layer9_expert4_act -> layer9_expert4_down
	layer9_expert4_down -> layer9_token_aggregation
	layer9_token_distribution -> layer9_expert5_gate [style=dashed]
	layer9_token_distribution -> layer9_expert5_up [style=dashed]
	layer9_expert5_gate -> layer9_expert5_act
	layer9_expert5_up -> layer9_expert5_act
	layer9_expert5_act -> layer9_expert5_down
	layer9_expert5_down -> layer9_token_aggregation
	layer9_token_distribution -> layer9_expert6_gate [style=dashed]
	layer9_token_distribution -> layer9_expert6_up [style=dashed]
	layer9_expert6_gate -> layer9_expert6_act
	layer9_expert6_up -> layer9_expert6_act
	layer9_expert6_act -> layer9_expert6_down
	layer9_expert6_down -> layer9_token_aggregation
	layer9_token_distribution -> layer9_expert7_gate [style=dashed]
	layer9_token_distribution -> layer9_expert7_up [style=dashed]
	layer9_expert7_gate -> layer9_expert7_act
	layer9_expert7_up -> layer9_expert7_act
	layer9_expert7_act -> layer9_expert7_down
	layer9_expert7_down -> layer9_token_aggregation
	layer9_token_distribution -> layer9_expert8_gate [style=dashed]
	layer9_token_distribution -> layer9_expert8_up [style=dashed]
	layer9_expert8_gate -> layer9_expert8_act
	layer9_expert8_up -> layer9_expert8_act
	layer9_expert8_act -> layer9_expert8_down
	layer9_expert8_down -> layer9_token_aggregation
	layer9_token_distribution -> layer9_expert9_gate [style=dashed]
	layer9_token_distribution -> layer9_expert9_up [style=dashed]
	layer9_expert9_gate -> layer9_expert9_act
	layer9_expert9_up -> layer9_expert9_act
	layer9_expert9_act -> layer9_expert9_down
	layer9_expert9_down -> layer9_token_aggregation
	layer9_token_distribution -> layer9_expert10_gate [style=dashed]
	layer9_token_distribution -> layer9_expert10_up [style=dashed]
	layer9_expert10_gate -> layer9_expert10_act
	layer9_expert10_up -> layer9_expert10_act
	layer9_expert10_act -> layer9_expert10_down
	layer9_expert10_down -> layer9_token_aggregation
	layer9_token_distribution -> layer9_expert11_gate [style=dashed]
	layer9_token_distribution -> layer9_expert11_up [style=dashed]
	layer9_expert11_gate -> layer9_expert11_act
	layer9_expert11_up -> layer9_expert11_act
	layer9_expert11_act -> layer9_expert11_down
	layer9_expert11_down -> layer9_token_aggregation
	layer9_token_distribution -> layer9_expert12_gate [style=dashed]
	layer9_token_distribution -> layer9_expert12_up [style=dashed]
	layer9_expert12_gate -> layer9_expert12_act
	layer9_expert12_up -> layer9_expert12_act
	layer9_expert12_act -> layer9_expert12_down
	layer9_expert12_down -> layer9_token_aggregation
	layer9_token_distribution -> layer9_expert13_gate [style=dashed]
	layer9_token_distribution -> layer9_expert13_up [style=dashed]
	layer9_expert13_gate -> layer9_expert13_act
	layer9_expert13_up -> layer9_expert13_act
	layer9_expert13_act -> layer9_expert13_down
	layer9_expert13_down -> layer9_token_aggregation
	layer9_token_distribution -> layer9_expert14_gate [style=dashed]
	layer9_token_distribution -> layer9_expert14_up [style=dashed]
	layer9_expert14_gate -> layer9_expert14_act
	layer9_expert14_up -> layer9_expert14_act
	layer9_expert14_act -> layer9_expert14_down
	layer9_expert14_down -> layer9_token_aggregation
	layer9_token_distribution -> layer9_expert15_gate [style=dashed]
	layer9_token_distribution -> layer9_expert15_up [style=dashed]
	layer9_expert15_gate -> layer9_expert15_act
	layer9_expert15_up -> layer9_expert15_act
	layer9_expert15_act -> layer9_expert15_down
	layer9_expert15_down -> layer9_token_aggregation
	layer9_token_aggregation -> layer9_res2
	layer10_mha_qkv [label="MHA QKV Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nAll GPUs" fillcolor=lightblue style=filled]
	layer10_mha_attn [label="MHA Attention\nInput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightgreen style=filled]
	layer10_mha_out [label="MHA Output Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightblue style=filled]
	layer10_res1 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer10_ln1 [label="Layer Norm\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=yellow style=filled]
	layer10_expert_routing [label="Expert Routing\nTop-2 Selection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, expert_id=2]\nAll GPUs" fillcolor=orange shape=diamond style=filled]
	layer10_token_distribution [label="Token Distribution\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: Tokens routed to 2 experts\nAll GPUs → Expert GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer10_expert0_gate [label="Expert 0 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer10_expert0_up [label="Expert 0 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer10_expert0_act [label="Expert 0 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightgreen style=filled]
	layer10_expert0_down [label="Expert 0 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 0" fillcolor=lightblue style=filled]
	layer10_expert1_gate [label="Expert 1 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer10_expert1_up [label="Expert 1 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer10_expert1_act [label="Expert 1 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightgreen style=filled]
	layer10_expert1_down [label="Expert 1 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 1" fillcolor=lightblue style=filled]
	layer10_expert2_gate [label="Expert 2 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer10_expert2_up [label="Expert 2 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer10_expert2_act [label="Expert 2 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightgreen style=filled]
	layer10_expert2_down [label="Expert 2 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 2" fillcolor=lightblue style=filled]
	layer10_expert3_gate [label="Expert 3 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer10_expert3_up [label="Expert 3 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer10_expert3_act [label="Expert 3 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightgreen style=filled]
	layer10_expert3_down [label="Expert 3 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 3" fillcolor=lightblue style=filled]
	layer10_expert4_gate [label="Expert 4 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer10_expert4_up [label="Expert 4 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer10_expert4_act [label="Expert 4 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightgreen style=filled]
	layer10_expert4_down [label="Expert 4 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 4" fillcolor=lightblue style=filled]
	layer10_expert5_gate [label="Expert 5 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer10_expert5_up [label="Expert 5 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer10_expert5_act [label="Expert 5 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightgreen style=filled]
	layer10_expert5_down [label="Expert 5 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 5" fillcolor=lightblue style=filled]
	layer10_expert6_gate [label="Expert 6 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer10_expert6_up [label="Expert 6 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer10_expert6_act [label="Expert 6 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightgreen style=filled]
	layer10_expert6_down [label="Expert 6 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 6" fillcolor=lightblue style=filled]
	layer10_expert7_gate [label="Expert 7 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer10_expert7_up [label="Expert 7 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer10_expert7_act [label="Expert 7 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightgreen style=filled]
	layer10_expert7_down [label="Expert 7 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 7" fillcolor=lightblue style=filled]
	layer10_expert8_gate [label="Expert 8 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer10_expert8_up [label="Expert 8 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer10_expert8_act [label="Expert 8 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightgreen style=filled]
	layer10_expert8_down [label="Expert 8 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 8" fillcolor=lightblue style=filled]
	layer10_expert9_gate [label="Expert 9 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer10_expert9_up [label="Expert 9 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer10_expert9_act [label="Expert 9 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightgreen style=filled]
	layer10_expert9_down [label="Expert 9 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 9" fillcolor=lightblue style=filled]
	layer10_expert10_gate [label="Expert 10 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer10_expert10_up [label="Expert 10 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer10_expert10_act [label="Expert 10 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightgreen style=filled]
	layer10_expert10_down [label="Expert 10 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 10" fillcolor=lightblue style=filled]
	layer10_expert11_gate [label="Expert 11 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer10_expert11_up [label="Expert 11 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer10_expert11_act [label="Expert 11 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightgreen style=filled]
	layer10_expert11_down [label="Expert 11 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 11" fillcolor=lightblue style=filled]
	layer10_expert12_gate [label="Expert 12 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer10_expert12_up [label="Expert 12 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer10_expert12_act [label="Expert 12 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightgreen style=filled]
	layer10_expert12_down [label="Expert 12 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 12" fillcolor=lightblue style=filled]
	layer10_expert13_gate [label="Expert 13 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer10_expert13_up [label="Expert 13 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer10_expert13_act [label="Expert 13 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightgreen style=filled]
	layer10_expert13_down [label="Expert 13 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 13" fillcolor=lightblue style=filled]
	layer10_expert14_gate [label="Expert 14 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer10_expert14_up [label="Expert 14 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer10_expert14_act [label="Expert 14 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightgreen style=filled]
	layer10_expert14_down [label="Expert 14 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 14" fillcolor=lightblue style=filled]
	layer10_expert15_gate [label="Expert 15 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer10_expert15_up [label="Expert 15 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer10_expert15_act [label="Expert 15 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightgreen style=filled]
	layer10_expert15_down [label="Expert 15 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 15" fillcolor=lightblue style=filled]
	layer10_token_aggregation [label="Token Aggregation\nInput: [dynamic_batch, seq_len, hidden=4096] from 2 experts\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer10_res2 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer9_res2 -> layer10_mha_qkv
	layer10_mha_qkv -> layer10_mha_attn
	layer10_mha_attn -> layer10_mha_out
	layer10_mha_out -> layer10_res1
	layer10_res1 -> layer10_ln1
	layer10_ln1 -> layer10_expert_routing
	layer10_expert_routing -> layer10_token_distribution
	layer10_token_distribution -> layer10_expert0_gate [style=dashed]
	layer10_token_distribution -> layer10_expert0_up [style=dashed]
	layer10_expert0_gate -> layer10_expert0_act
	layer10_expert0_up -> layer10_expert0_act
	layer10_expert0_act -> layer10_expert0_down
	layer10_expert0_down -> layer10_token_aggregation
	layer10_token_distribution -> layer10_expert1_gate [style=dashed]
	layer10_token_distribution -> layer10_expert1_up [style=dashed]
	layer10_expert1_gate -> layer10_expert1_act
	layer10_expert1_up -> layer10_expert1_act
	layer10_expert1_act -> layer10_expert1_down
	layer10_expert1_down -> layer10_token_aggregation
	layer10_token_distribution -> layer10_expert2_gate [style=dashed]
	layer10_token_distribution -> layer10_expert2_up [style=dashed]
	layer10_expert2_gate -> layer10_expert2_act
	layer10_expert2_up -> layer10_expert2_act
	layer10_expert2_act -> layer10_expert2_down
	layer10_expert2_down -> layer10_token_aggregation
	layer10_token_distribution -> layer10_expert3_gate [style=dashed]
	layer10_token_distribution -> layer10_expert3_up [style=dashed]
	layer10_expert3_gate -> layer10_expert3_act
	layer10_expert3_up -> layer10_expert3_act
	layer10_expert3_act -> layer10_expert3_down
	layer10_expert3_down -> layer10_token_aggregation
	layer10_token_distribution -> layer10_expert4_gate [style=dashed]
	layer10_token_distribution -> layer10_expert4_up [style=dashed]
	layer10_expert4_gate -> layer10_expert4_act
	layer10_expert4_up -> layer10_expert4_act
	layer10_expert4_act -> layer10_expert4_down
	layer10_expert4_down -> layer10_token_aggregation
	layer10_token_distribution -> layer10_expert5_gate [style=dashed]
	layer10_token_distribution -> layer10_expert5_up [style=dashed]
	layer10_expert5_gate -> layer10_expert5_act
	layer10_expert5_up -> layer10_expert5_act
	layer10_expert5_act -> layer10_expert5_down
	layer10_expert5_down -> layer10_token_aggregation
	layer10_token_distribution -> layer10_expert6_gate [style=dashed]
	layer10_token_distribution -> layer10_expert6_up [style=dashed]
	layer10_expert6_gate -> layer10_expert6_act
	layer10_expert6_up -> layer10_expert6_act
	layer10_expert6_act -> layer10_expert6_down
	layer10_expert6_down -> layer10_token_aggregation
	layer10_token_distribution -> layer10_expert7_gate [style=dashed]
	layer10_token_distribution -> layer10_expert7_up [style=dashed]
	layer10_expert7_gate -> layer10_expert7_act
	layer10_expert7_up -> layer10_expert7_act
	layer10_expert7_act -> layer10_expert7_down
	layer10_expert7_down -> layer10_token_aggregation
	layer10_token_distribution -> layer10_expert8_gate [style=dashed]
	layer10_token_distribution -> layer10_expert8_up [style=dashed]
	layer10_expert8_gate -> layer10_expert8_act
	layer10_expert8_up -> layer10_expert8_act
	layer10_expert8_act -> layer10_expert8_down
	layer10_expert8_down -> layer10_token_aggregation
	layer10_token_distribution -> layer10_expert9_gate [style=dashed]
	layer10_token_distribution -> layer10_expert9_up [style=dashed]
	layer10_expert9_gate -> layer10_expert9_act
	layer10_expert9_up -> layer10_expert9_act
	layer10_expert9_act -> layer10_expert9_down
	layer10_expert9_down -> layer10_token_aggregation
	layer10_token_distribution -> layer10_expert10_gate [style=dashed]
	layer10_token_distribution -> layer10_expert10_up [style=dashed]
	layer10_expert10_gate -> layer10_expert10_act
	layer10_expert10_up -> layer10_expert10_act
	layer10_expert10_act -> layer10_expert10_down
	layer10_expert10_down -> layer10_token_aggregation
	layer10_token_distribution -> layer10_expert11_gate [style=dashed]
	layer10_token_distribution -> layer10_expert11_up [style=dashed]
	layer10_expert11_gate -> layer10_expert11_act
	layer10_expert11_up -> layer10_expert11_act
	layer10_expert11_act -> layer10_expert11_down
	layer10_expert11_down -> layer10_token_aggregation
	layer10_token_distribution -> layer10_expert12_gate [style=dashed]
	layer10_token_distribution -> layer10_expert12_up [style=dashed]
	layer10_expert12_gate -> layer10_expert12_act
	layer10_expert12_up -> layer10_expert12_act
	layer10_expert12_act -> layer10_expert12_down
	layer10_expert12_down -> layer10_token_aggregation
	layer10_token_distribution -> layer10_expert13_gate [style=dashed]
	layer10_token_distribution -> layer10_expert13_up [style=dashed]
	layer10_expert13_gate -> layer10_expert13_act
	layer10_expert13_up -> layer10_expert13_act
	layer10_expert13_act -> layer10_expert13_down
	layer10_expert13_down -> layer10_token_aggregation
	layer10_token_distribution -> layer10_expert14_gate [style=dashed]
	layer10_token_distribution -> layer10_expert14_up [style=dashed]
	layer10_expert14_gate -> layer10_expert14_act
	layer10_expert14_up -> layer10_expert14_act
	layer10_expert14_act -> layer10_expert14_down
	layer10_expert14_down -> layer10_token_aggregation
	layer10_token_distribution -> layer10_expert15_gate [style=dashed]
	layer10_token_distribution -> layer10_expert15_up [style=dashed]
	layer10_expert15_gate -> layer10_expert15_act
	layer10_expert15_up -> layer10_expert15_act
	layer10_expert15_act -> layer10_expert15_down
	layer10_expert15_down -> layer10_token_aggregation
	layer10_token_aggregation -> layer10_res2
	layer11_mha_qkv [label="MHA QKV Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nAll GPUs" fillcolor=lightblue style=filled]
	layer11_mha_attn [label="MHA Attention\nInput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightgreen style=filled]
	layer11_mha_out [label="MHA Output Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightblue style=filled]
	layer11_res1 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer11_ln1 [label="Layer Norm\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=yellow style=filled]
	layer11_expert_routing [label="Expert Routing\nTop-2 Selection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, expert_id=2]\nAll GPUs" fillcolor=orange shape=diamond style=filled]
	layer11_token_distribution [label="Token Distribution\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: Tokens routed to 2 experts\nAll GPUs → Expert GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer11_expert0_gate [label="Expert 0 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer11_expert0_up [label="Expert 0 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer11_expert0_act [label="Expert 0 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightgreen style=filled]
	layer11_expert0_down [label="Expert 0 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 0" fillcolor=lightblue style=filled]
	layer11_expert1_gate [label="Expert 1 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer11_expert1_up [label="Expert 1 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer11_expert1_act [label="Expert 1 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightgreen style=filled]
	layer11_expert1_down [label="Expert 1 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 1" fillcolor=lightblue style=filled]
	layer11_expert2_gate [label="Expert 2 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer11_expert2_up [label="Expert 2 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer11_expert2_act [label="Expert 2 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightgreen style=filled]
	layer11_expert2_down [label="Expert 2 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 2" fillcolor=lightblue style=filled]
	layer11_expert3_gate [label="Expert 3 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer11_expert3_up [label="Expert 3 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer11_expert3_act [label="Expert 3 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightgreen style=filled]
	layer11_expert3_down [label="Expert 3 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 3" fillcolor=lightblue style=filled]
	layer11_expert4_gate [label="Expert 4 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer11_expert4_up [label="Expert 4 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer11_expert4_act [label="Expert 4 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightgreen style=filled]
	layer11_expert4_down [label="Expert 4 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 4" fillcolor=lightblue style=filled]
	layer11_expert5_gate [label="Expert 5 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer11_expert5_up [label="Expert 5 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer11_expert5_act [label="Expert 5 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightgreen style=filled]
	layer11_expert5_down [label="Expert 5 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 5" fillcolor=lightblue style=filled]
	layer11_expert6_gate [label="Expert 6 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer11_expert6_up [label="Expert 6 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer11_expert6_act [label="Expert 6 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightgreen style=filled]
	layer11_expert6_down [label="Expert 6 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 6" fillcolor=lightblue style=filled]
	layer11_expert7_gate [label="Expert 7 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer11_expert7_up [label="Expert 7 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer11_expert7_act [label="Expert 7 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightgreen style=filled]
	layer11_expert7_down [label="Expert 7 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 7" fillcolor=lightblue style=filled]
	layer11_expert8_gate [label="Expert 8 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer11_expert8_up [label="Expert 8 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer11_expert8_act [label="Expert 8 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightgreen style=filled]
	layer11_expert8_down [label="Expert 8 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 8" fillcolor=lightblue style=filled]
	layer11_expert9_gate [label="Expert 9 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer11_expert9_up [label="Expert 9 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer11_expert9_act [label="Expert 9 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightgreen style=filled]
	layer11_expert9_down [label="Expert 9 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 9" fillcolor=lightblue style=filled]
	layer11_expert10_gate [label="Expert 10 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer11_expert10_up [label="Expert 10 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer11_expert10_act [label="Expert 10 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightgreen style=filled]
	layer11_expert10_down [label="Expert 10 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 10" fillcolor=lightblue style=filled]
	layer11_expert11_gate [label="Expert 11 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer11_expert11_up [label="Expert 11 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer11_expert11_act [label="Expert 11 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightgreen style=filled]
	layer11_expert11_down [label="Expert 11 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 11" fillcolor=lightblue style=filled]
	layer11_expert12_gate [label="Expert 12 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer11_expert12_up [label="Expert 12 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer11_expert12_act [label="Expert 12 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightgreen style=filled]
	layer11_expert12_down [label="Expert 12 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 12" fillcolor=lightblue style=filled]
	layer11_expert13_gate [label="Expert 13 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer11_expert13_up [label="Expert 13 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer11_expert13_act [label="Expert 13 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightgreen style=filled]
	layer11_expert13_down [label="Expert 13 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 13" fillcolor=lightblue style=filled]
	layer11_expert14_gate [label="Expert 14 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer11_expert14_up [label="Expert 14 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer11_expert14_act [label="Expert 14 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightgreen style=filled]
	layer11_expert14_down [label="Expert 14 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 14" fillcolor=lightblue style=filled]
	layer11_expert15_gate [label="Expert 15 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer11_expert15_up [label="Expert 15 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer11_expert15_act [label="Expert 15 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightgreen style=filled]
	layer11_expert15_down [label="Expert 15 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 15" fillcolor=lightblue style=filled]
	layer11_token_aggregation [label="Token Aggregation\nInput: [dynamic_batch, seq_len, hidden=4096] from 2 experts\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer11_res2 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer10_res2 -> layer11_mha_qkv
	layer11_mha_qkv -> layer11_mha_attn
	layer11_mha_attn -> layer11_mha_out
	layer11_mha_out -> layer11_res1
	layer11_res1 -> layer11_ln1
	layer11_ln1 -> layer11_expert_routing
	layer11_expert_routing -> layer11_token_distribution
	layer11_token_distribution -> layer11_expert0_gate [style=dashed]
	layer11_token_distribution -> layer11_expert0_up [style=dashed]
	layer11_expert0_gate -> layer11_expert0_act
	layer11_expert0_up -> layer11_expert0_act
	layer11_expert0_act -> layer11_expert0_down
	layer11_expert0_down -> layer11_token_aggregation
	layer11_token_distribution -> layer11_expert1_gate [style=dashed]
	layer11_token_distribution -> layer11_expert1_up [style=dashed]
	layer11_expert1_gate -> layer11_expert1_act
	layer11_expert1_up -> layer11_expert1_act
	layer11_expert1_act -> layer11_expert1_down
	layer11_expert1_down -> layer11_token_aggregation
	layer11_token_distribution -> layer11_expert2_gate [style=dashed]
	layer11_token_distribution -> layer11_expert2_up [style=dashed]
	layer11_expert2_gate -> layer11_expert2_act
	layer11_expert2_up -> layer11_expert2_act
	layer11_expert2_act -> layer11_expert2_down
	layer11_expert2_down -> layer11_token_aggregation
	layer11_token_distribution -> layer11_expert3_gate [style=dashed]
	layer11_token_distribution -> layer11_expert3_up [style=dashed]
	layer11_expert3_gate -> layer11_expert3_act
	layer11_expert3_up -> layer11_expert3_act
	layer11_expert3_act -> layer11_expert3_down
	layer11_expert3_down -> layer11_token_aggregation
	layer11_token_distribution -> layer11_expert4_gate [style=dashed]
	layer11_token_distribution -> layer11_expert4_up [style=dashed]
	layer11_expert4_gate -> layer11_expert4_act
	layer11_expert4_up -> layer11_expert4_act
	layer11_expert4_act -> layer11_expert4_down
	layer11_expert4_down -> layer11_token_aggregation
	layer11_token_distribution -> layer11_expert5_gate [style=dashed]
	layer11_token_distribution -> layer11_expert5_up [style=dashed]
	layer11_expert5_gate -> layer11_expert5_act
	layer11_expert5_up -> layer11_expert5_act
	layer11_expert5_act -> layer11_expert5_down
	layer11_expert5_down -> layer11_token_aggregation
	layer11_token_distribution -> layer11_expert6_gate [style=dashed]
	layer11_token_distribution -> layer11_expert6_up [style=dashed]
	layer11_expert6_gate -> layer11_expert6_act
	layer11_expert6_up -> layer11_expert6_act
	layer11_expert6_act -> layer11_expert6_down
	layer11_expert6_down -> layer11_token_aggregation
	layer11_token_distribution -> layer11_expert7_gate [style=dashed]
	layer11_token_distribution -> layer11_expert7_up [style=dashed]
	layer11_expert7_gate -> layer11_expert7_act
	layer11_expert7_up -> layer11_expert7_act
	layer11_expert7_act -> layer11_expert7_down
	layer11_expert7_down -> layer11_token_aggregation
	layer11_token_distribution -> layer11_expert8_gate [style=dashed]
	layer11_token_distribution -> layer11_expert8_up [style=dashed]
	layer11_expert8_gate -> layer11_expert8_act
	layer11_expert8_up -> layer11_expert8_act
	layer11_expert8_act -> layer11_expert8_down
	layer11_expert8_down -> layer11_token_aggregation
	layer11_token_distribution -> layer11_expert9_gate [style=dashed]
	layer11_token_distribution -> layer11_expert9_up [style=dashed]
	layer11_expert9_gate -> layer11_expert9_act
	layer11_expert9_up -> layer11_expert9_act
	layer11_expert9_act -> layer11_expert9_down
	layer11_expert9_down -> layer11_token_aggregation
	layer11_token_distribution -> layer11_expert10_gate [style=dashed]
	layer11_token_distribution -> layer11_expert10_up [style=dashed]
	layer11_expert10_gate -> layer11_expert10_act
	layer11_expert10_up -> layer11_expert10_act
	layer11_expert10_act -> layer11_expert10_down
	layer11_expert10_down -> layer11_token_aggregation
	layer11_token_distribution -> layer11_expert11_gate [style=dashed]
	layer11_token_distribution -> layer11_expert11_up [style=dashed]
	layer11_expert11_gate -> layer11_expert11_act
	layer11_expert11_up -> layer11_expert11_act
	layer11_expert11_act -> layer11_expert11_down
	layer11_expert11_down -> layer11_token_aggregation
	layer11_token_distribution -> layer11_expert12_gate [style=dashed]
	layer11_token_distribution -> layer11_expert12_up [style=dashed]
	layer11_expert12_gate -> layer11_expert12_act
	layer11_expert12_up -> layer11_expert12_act
	layer11_expert12_act -> layer11_expert12_down
	layer11_expert12_down -> layer11_token_aggregation
	layer11_token_distribution -> layer11_expert13_gate [style=dashed]
	layer11_token_distribution -> layer11_expert13_up [style=dashed]
	layer11_expert13_gate -> layer11_expert13_act
	layer11_expert13_up -> layer11_expert13_act
	layer11_expert13_act -> layer11_expert13_down
	layer11_expert13_down -> layer11_token_aggregation
	layer11_token_distribution -> layer11_expert14_gate [style=dashed]
	layer11_token_distribution -> layer11_expert14_up [style=dashed]
	layer11_expert14_gate -> layer11_expert14_act
	layer11_expert14_up -> layer11_expert14_act
	layer11_expert14_act -> layer11_expert14_down
	layer11_expert14_down -> layer11_token_aggregation
	layer11_token_distribution -> layer11_expert15_gate [style=dashed]
	layer11_token_distribution -> layer11_expert15_up [style=dashed]
	layer11_expert15_gate -> layer11_expert15_act
	layer11_expert15_up -> layer11_expert15_act
	layer11_expert15_act -> layer11_expert15_down
	layer11_expert15_down -> layer11_token_aggregation
	layer11_token_aggregation -> layer11_res2
	layer12_mha_qkv [label="MHA QKV Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nAll GPUs" fillcolor=lightblue style=filled]
	layer12_mha_attn [label="MHA Attention\nInput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightgreen style=filled]
	layer12_mha_out [label="MHA Output Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightblue style=filled]
	layer12_res1 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer12_ln1 [label="Layer Norm\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=yellow style=filled]
	layer12_expert_routing [label="Expert Routing\nTop-2 Selection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, expert_id=2]\nAll GPUs" fillcolor=orange shape=diamond style=filled]
	layer12_token_distribution [label="Token Distribution\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: Tokens routed to 2 experts\nAll GPUs → Expert GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer12_expert0_gate [label="Expert 0 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer12_expert0_up [label="Expert 0 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer12_expert0_act [label="Expert 0 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightgreen style=filled]
	layer12_expert0_down [label="Expert 0 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 0" fillcolor=lightblue style=filled]
	layer12_expert1_gate [label="Expert 1 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer12_expert1_up [label="Expert 1 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer12_expert1_act [label="Expert 1 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightgreen style=filled]
	layer12_expert1_down [label="Expert 1 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 1" fillcolor=lightblue style=filled]
	layer12_expert2_gate [label="Expert 2 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer12_expert2_up [label="Expert 2 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer12_expert2_act [label="Expert 2 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightgreen style=filled]
	layer12_expert2_down [label="Expert 2 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 2" fillcolor=lightblue style=filled]
	layer12_expert3_gate [label="Expert 3 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer12_expert3_up [label="Expert 3 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer12_expert3_act [label="Expert 3 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightgreen style=filled]
	layer12_expert3_down [label="Expert 3 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 3" fillcolor=lightblue style=filled]
	layer12_expert4_gate [label="Expert 4 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer12_expert4_up [label="Expert 4 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer12_expert4_act [label="Expert 4 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightgreen style=filled]
	layer12_expert4_down [label="Expert 4 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 4" fillcolor=lightblue style=filled]
	layer12_expert5_gate [label="Expert 5 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer12_expert5_up [label="Expert 5 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer12_expert5_act [label="Expert 5 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightgreen style=filled]
	layer12_expert5_down [label="Expert 5 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 5" fillcolor=lightblue style=filled]
	layer12_expert6_gate [label="Expert 6 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer12_expert6_up [label="Expert 6 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer12_expert6_act [label="Expert 6 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightgreen style=filled]
	layer12_expert6_down [label="Expert 6 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 6" fillcolor=lightblue style=filled]
	layer12_expert7_gate [label="Expert 7 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer12_expert7_up [label="Expert 7 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer12_expert7_act [label="Expert 7 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightgreen style=filled]
	layer12_expert7_down [label="Expert 7 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 7" fillcolor=lightblue style=filled]
	layer12_expert8_gate [label="Expert 8 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer12_expert8_up [label="Expert 8 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer12_expert8_act [label="Expert 8 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightgreen style=filled]
	layer12_expert8_down [label="Expert 8 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 8" fillcolor=lightblue style=filled]
	layer12_expert9_gate [label="Expert 9 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer12_expert9_up [label="Expert 9 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer12_expert9_act [label="Expert 9 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightgreen style=filled]
	layer12_expert9_down [label="Expert 9 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 9" fillcolor=lightblue style=filled]
	layer12_expert10_gate [label="Expert 10 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer12_expert10_up [label="Expert 10 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer12_expert10_act [label="Expert 10 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightgreen style=filled]
	layer12_expert10_down [label="Expert 10 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 10" fillcolor=lightblue style=filled]
	layer12_expert11_gate [label="Expert 11 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer12_expert11_up [label="Expert 11 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer12_expert11_act [label="Expert 11 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightgreen style=filled]
	layer12_expert11_down [label="Expert 11 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 11" fillcolor=lightblue style=filled]
	layer12_expert12_gate [label="Expert 12 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer12_expert12_up [label="Expert 12 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer12_expert12_act [label="Expert 12 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightgreen style=filled]
	layer12_expert12_down [label="Expert 12 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 12" fillcolor=lightblue style=filled]
	layer12_expert13_gate [label="Expert 13 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer12_expert13_up [label="Expert 13 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer12_expert13_act [label="Expert 13 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightgreen style=filled]
	layer12_expert13_down [label="Expert 13 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 13" fillcolor=lightblue style=filled]
	layer12_expert14_gate [label="Expert 14 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer12_expert14_up [label="Expert 14 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer12_expert14_act [label="Expert 14 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightgreen style=filled]
	layer12_expert14_down [label="Expert 14 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 14" fillcolor=lightblue style=filled]
	layer12_expert15_gate [label="Expert 15 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer12_expert15_up [label="Expert 15 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer12_expert15_act [label="Expert 15 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightgreen style=filled]
	layer12_expert15_down [label="Expert 15 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 15" fillcolor=lightblue style=filled]
	layer12_token_aggregation [label="Token Aggregation\nInput: [dynamic_batch, seq_len, hidden=4096] from 2 experts\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer12_res2 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer11_res2 -> layer12_mha_qkv
	layer12_mha_qkv -> layer12_mha_attn
	layer12_mha_attn -> layer12_mha_out
	layer12_mha_out -> layer12_res1
	layer12_res1 -> layer12_ln1
	layer12_ln1 -> layer12_expert_routing
	layer12_expert_routing -> layer12_token_distribution
	layer12_token_distribution -> layer12_expert0_gate [style=dashed]
	layer12_token_distribution -> layer12_expert0_up [style=dashed]
	layer12_expert0_gate -> layer12_expert0_act
	layer12_expert0_up -> layer12_expert0_act
	layer12_expert0_act -> layer12_expert0_down
	layer12_expert0_down -> layer12_token_aggregation
	layer12_token_distribution -> layer12_expert1_gate [style=dashed]
	layer12_token_distribution -> layer12_expert1_up [style=dashed]
	layer12_expert1_gate -> layer12_expert1_act
	layer12_expert1_up -> layer12_expert1_act
	layer12_expert1_act -> layer12_expert1_down
	layer12_expert1_down -> layer12_token_aggregation
	layer12_token_distribution -> layer12_expert2_gate [style=dashed]
	layer12_token_distribution -> layer12_expert2_up [style=dashed]
	layer12_expert2_gate -> layer12_expert2_act
	layer12_expert2_up -> layer12_expert2_act
	layer12_expert2_act -> layer12_expert2_down
	layer12_expert2_down -> layer12_token_aggregation
	layer12_token_distribution -> layer12_expert3_gate [style=dashed]
	layer12_token_distribution -> layer12_expert3_up [style=dashed]
	layer12_expert3_gate -> layer12_expert3_act
	layer12_expert3_up -> layer12_expert3_act
	layer12_expert3_act -> layer12_expert3_down
	layer12_expert3_down -> layer12_token_aggregation
	layer12_token_distribution -> layer12_expert4_gate [style=dashed]
	layer12_token_distribution -> layer12_expert4_up [style=dashed]
	layer12_expert4_gate -> layer12_expert4_act
	layer12_expert4_up -> layer12_expert4_act
	layer12_expert4_act -> layer12_expert4_down
	layer12_expert4_down -> layer12_token_aggregation
	layer12_token_distribution -> layer12_expert5_gate [style=dashed]
	layer12_token_distribution -> layer12_expert5_up [style=dashed]
	layer12_expert5_gate -> layer12_expert5_act
	layer12_expert5_up -> layer12_expert5_act
	layer12_expert5_act -> layer12_expert5_down
	layer12_expert5_down -> layer12_token_aggregation
	layer12_token_distribution -> layer12_expert6_gate [style=dashed]
	layer12_token_distribution -> layer12_expert6_up [style=dashed]
	layer12_expert6_gate -> layer12_expert6_act
	layer12_expert6_up -> layer12_expert6_act
	layer12_expert6_act -> layer12_expert6_down
	layer12_expert6_down -> layer12_token_aggregation
	layer12_token_distribution -> layer12_expert7_gate [style=dashed]
	layer12_token_distribution -> layer12_expert7_up [style=dashed]
	layer12_expert7_gate -> layer12_expert7_act
	layer12_expert7_up -> layer12_expert7_act
	layer12_expert7_act -> layer12_expert7_down
	layer12_expert7_down -> layer12_token_aggregation
	layer12_token_distribution -> layer12_expert8_gate [style=dashed]
	layer12_token_distribution -> layer12_expert8_up [style=dashed]
	layer12_expert8_gate -> layer12_expert8_act
	layer12_expert8_up -> layer12_expert8_act
	layer12_expert8_act -> layer12_expert8_down
	layer12_expert8_down -> layer12_token_aggregation
	layer12_token_distribution -> layer12_expert9_gate [style=dashed]
	layer12_token_distribution -> layer12_expert9_up [style=dashed]
	layer12_expert9_gate -> layer12_expert9_act
	layer12_expert9_up -> layer12_expert9_act
	layer12_expert9_act -> layer12_expert9_down
	layer12_expert9_down -> layer12_token_aggregation
	layer12_token_distribution -> layer12_expert10_gate [style=dashed]
	layer12_token_distribution -> layer12_expert10_up [style=dashed]
	layer12_expert10_gate -> layer12_expert10_act
	layer12_expert10_up -> layer12_expert10_act
	layer12_expert10_act -> layer12_expert10_down
	layer12_expert10_down -> layer12_token_aggregation
	layer12_token_distribution -> layer12_expert11_gate [style=dashed]
	layer12_token_distribution -> layer12_expert11_up [style=dashed]
	layer12_expert11_gate -> layer12_expert11_act
	layer12_expert11_up -> layer12_expert11_act
	layer12_expert11_act -> layer12_expert11_down
	layer12_expert11_down -> layer12_token_aggregation
	layer12_token_distribution -> layer12_expert12_gate [style=dashed]
	layer12_token_distribution -> layer12_expert12_up [style=dashed]
	layer12_expert12_gate -> layer12_expert12_act
	layer12_expert12_up -> layer12_expert12_act
	layer12_expert12_act -> layer12_expert12_down
	layer12_expert12_down -> layer12_token_aggregation
	layer12_token_distribution -> layer12_expert13_gate [style=dashed]
	layer12_token_distribution -> layer12_expert13_up [style=dashed]
	layer12_expert13_gate -> layer12_expert13_act
	layer12_expert13_up -> layer12_expert13_act
	layer12_expert13_act -> layer12_expert13_down
	layer12_expert13_down -> layer12_token_aggregation
	layer12_token_distribution -> layer12_expert14_gate [style=dashed]
	layer12_token_distribution -> layer12_expert14_up [style=dashed]
	layer12_expert14_gate -> layer12_expert14_act
	layer12_expert14_up -> layer12_expert14_act
	layer12_expert14_act -> layer12_expert14_down
	layer12_expert14_down -> layer12_token_aggregation
	layer12_token_distribution -> layer12_expert15_gate [style=dashed]
	layer12_token_distribution -> layer12_expert15_up [style=dashed]
	layer12_expert15_gate -> layer12_expert15_act
	layer12_expert15_up -> layer12_expert15_act
	layer12_expert15_act -> layer12_expert15_down
	layer12_expert15_down -> layer12_token_aggregation
	layer12_token_aggregation -> layer12_res2
	layer13_mha_qkv [label="MHA QKV Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nAll GPUs" fillcolor=lightblue style=filled]
	layer13_mha_attn [label="MHA Attention\nInput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightgreen style=filled]
	layer13_mha_out [label="MHA Output Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightblue style=filled]
	layer13_res1 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer13_ln1 [label="Layer Norm\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=yellow style=filled]
	layer13_expert_routing [label="Expert Routing\nTop-2 Selection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, expert_id=2]\nAll GPUs" fillcolor=orange shape=diamond style=filled]
	layer13_token_distribution [label="Token Distribution\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: Tokens routed to 2 experts\nAll GPUs → Expert GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer13_expert0_gate [label="Expert 0 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer13_expert0_up [label="Expert 0 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer13_expert0_act [label="Expert 0 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightgreen style=filled]
	layer13_expert0_down [label="Expert 0 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 0" fillcolor=lightblue style=filled]
	layer13_expert1_gate [label="Expert 1 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer13_expert1_up [label="Expert 1 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer13_expert1_act [label="Expert 1 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightgreen style=filled]
	layer13_expert1_down [label="Expert 1 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 1" fillcolor=lightblue style=filled]
	layer13_expert2_gate [label="Expert 2 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer13_expert2_up [label="Expert 2 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer13_expert2_act [label="Expert 2 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightgreen style=filled]
	layer13_expert2_down [label="Expert 2 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 2" fillcolor=lightblue style=filled]
	layer13_expert3_gate [label="Expert 3 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer13_expert3_up [label="Expert 3 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer13_expert3_act [label="Expert 3 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightgreen style=filled]
	layer13_expert3_down [label="Expert 3 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 3" fillcolor=lightblue style=filled]
	layer13_expert4_gate [label="Expert 4 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer13_expert4_up [label="Expert 4 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer13_expert4_act [label="Expert 4 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightgreen style=filled]
	layer13_expert4_down [label="Expert 4 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 4" fillcolor=lightblue style=filled]
	layer13_expert5_gate [label="Expert 5 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer13_expert5_up [label="Expert 5 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer13_expert5_act [label="Expert 5 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightgreen style=filled]
	layer13_expert5_down [label="Expert 5 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 5" fillcolor=lightblue style=filled]
	layer13_expert6_gate [label="Expert 6 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer13_expert6_up [label="Expert 6 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer13_expert6_act [label="Expert 6 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightgreen style=filled]
	layer13_expert6_down [label="Expert 6 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 6" fillcolor=lightblue style=filled]
	layer13_expert7_gate [label="Expert 7 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer13_expert7_up [label="Expert 7 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer13_expert7_act [label="Expert 7 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightgreen style=filled]
	layer13_expert7_down [label="Expert 7 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 7" fillcolor=lightblue style=filled]
	layer13_expert8_gate [label="Expert 8 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer13_expert8_up [label="Expert 8 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer13_expert8_act [label="Expert 8 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightgreen style=filled]
	layer13_expert8_down [label="Expert 8 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 8" fillcolor=lightblue style=filled]
	layer13_expert9_gate [label="Expert 9 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer13_expert9_up [label="Expert 9 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer13_expert9_act [label="Expert 9 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightgreen style=filled]
	layer13_expert9_down [label="Expert 9 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 9" fillcolor=lightblue style=filled]
	layer13_expert10_gate [label="Expert 10 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer13_expert10_up [label="Expert 10 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer13_expert10_act [label="Expert 10 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightgreen style=filled]
	layer13_expert10_down [label="Expert 10 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 10" fillcolor=lightblue style=filled]
	layer13_expert11_gate [label="Expert 11 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer13_expert11_up [label="Expert 11 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer13_expert11_act [label="Expert 11 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightgreen style=filled]
	layer13_expert11_down [label="Expert 11 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 11" fillcolor=lightblue style=filled]
	layer13_expert12_gate [label="Expert 12 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer13_expert12_up [label="Expert 12 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer13_expert12_act [label="Expert 12 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightgreen style=filled]
	layer13_expert12_down [label="Expert 12 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 12" fillcolor=lightblue style=filled]
	layer13_expert13_gate [label="Expert 13 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer13_expert13_up [label="Expert 13 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer13_expert13_act [label="Expert 13 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightgreen style=filled]
	layer13_expert13_down [label="Expert 13 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 13" fillcolor=lightblue style=filled]
	layer13_expert14_gate [label="Expert 14 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer13_expert14_up [label="Expert 14 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer13_expert14_act [label="Expert 14 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightgreen style=filled]
	layer13_expert14_down [label="Expert 14 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 14" fillcolor=lightblue style=filled]
	layer13_expert15_gate [label="Expert 15 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer13_expert15_up [label="Expert 15 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer13_expert15_act [label="Expert 15 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightgreen style=filled]
	layer13_expert15_down [label="Expert 15 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 15" fillcolor=lightblue style=filled]
	layer13_token_aggregation [label="Token Aggregation\nInput: [dynamic_batch, seq_len, hidden=4096] from 2 experts\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer13_res2 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer12_res2 -> layer13_mha_qkv
	layer13_mha_qkv -> layer13_mha_attn
	layer13_mha_attn -> layer13_mha_out
	layer13_mha_out -> layer13_res1
	layer13_res1 -> layer13_ln1
	layer13_ln1 -> layer13_expert_routing
	layer13_expert_routing -> layer13_token_distribution
	layer13_token_distribution -> layer13_expert0_gate [style=dashed]
	layer13_token_distribution -> layer13_expert0_up [style=dashed]
	layer13_expert0_gate -> layer13_expert0_act
	layer13_expert0_up -> layer13_expert0_act
	layer13_expert0_act -> layer13_expert0_down
	layer13_expert0_down -> layer13_token_aggregation
	layer13_token_distribution -> layer13_expert1_gate [style=dashed]
	layer13_token_distribution -> layer13_expert1_up [style=dashed]
	layer13_expert1_gate -> layer13_expert1_act
	layer13_expert1_up -> layer13_expert1_act
	layer13_expert1_act -> layer13_expert1_down
	layer13_expert1_down -> layer13_token_aggregation
	layer13_token_distribution -> layer13_expert2_gate [style=dashed]
	layer13_token_distribution -> layer13_expert2_up [style=dashed]
	layer13_expert2_gate -> layer13_expert2_act
	layer13_expert2_up -> layer13_expert2_act
	layer13_expert2_act -> layer13_expert2_down
	layer13_expert2_down -> layer13_token_aggregation
	layer13_token_distribution -> layer13_expert3_gate [style=dashed]
	layer13_token_distribution -> layer13_expert3_up [style=dashed]
	layer13_expert3_gate -> layer13_expert3_act
	layer13_expert3_up -> layer13_expert3_act
	layer13_expert3_act -> layer13_expert3_down
	layer13_expert3_down -> layer13_token_aggregation
	layer13_token_distribution -> layer13_expert4_gate [style=dashed]
	layer13_token_distribution -> layer13_expert4_up [style=dashed]
	layer13_expert4_gate -> layer13_expert4_act
	layer13_expert4_up -> layer13_expert4_act
	layer13_expert4_act -> layer13_expert4_down
	layer13_expert4_down -> layer13_token_aggregation
	layer13_token_distribution -> layer13_expert5_gate [style=dashed]
	layer13_token_distribution -> layer13_expert5_up [style=dashed]
	layer13_expert5_gate -> layer13_expert5_act
	layer13_expert5_up -> layer13_expert5_act
	layer13_expert5_act -> layer13_expert5_down
	layer13_expert5_down -> layer13_token_aggregation
	layer13_token_distribution -> layer13_expert6_gate [style=dashed]
	layer13_token_distribution -> layer13_expert6_up [style=dashed]
	layer13_expert6_gate -> layer13_expert6_act
	layer13_expert6_up -> layer13_expert6_act
	layer13_expert6_act -> layer13_expert6_down
	layer13_expert6_down -> layer13_token_aggregation
	layer13_token_distribution -> layer13_expert7_gate [style=dashed]
	layer13_token_distribution -> layer13_expert7_up [style=dashed]
	layer13_expert7_gate -> layer13_expert7_act
	layer13_expert7_up -> layer13_expert7_act
	layer13_expert7_act -> layer13_expert7_down
	layer13_expert7_down -> layer13_token_aggregation
	layer13_token_distribution -> layer13_expert8_gate [style=dashed]
	layer13_token_distribution -> layer13_expert8_up [style=dashed]
	layer13_expert8_gate -> layer13_expert8_act
	layer13_expert8_up -> layer13_expert8_act
	layer13_expert8_act -> layer13_expert8_down
	layer13_expert8_down -> layer13_token_aggregation
	layer13_token_distribution -> layer13_expert9_gate [style=dashed]
	layer13_token_distribution -> layer13_expert9_up [style=dashed]
	layer13_expert9_gate -> layer13_expert9_act
	layer13_expert9_up -> layer13_expert9_act
	layer13_expert9_act -> layer13_expert9_down
	layer13_expert9_down -> layer13_token_aggregation
	layer13_token_distribution -> layer13_expert10_gate [style=dashed]
	layer13_token_distribution -> layer13_expert10_up [style=dashed]
	layer13_expert10_gate -> layer13_expert10_act
	layer13_expert10_up -> layer13_expert10_act
	layer13_expert10_act -> layer13_expert10_down
	layer13_expert10_down -> layer13_token_aggregation
	layer13_token_distribution -> layer13_expert11_gate [style=dashed]
	layer13_token_distribution -> layer13_expert11_up [style=dashed]
	layer13_expert11_gate -> layer13_expert11_act
	layer13_expert11_up -> layer13_expert11_act
	layer13_expert11_act -> layer13_expert11_down
	layer13_expert11_down -> layer13_token_aggregation
	layer13_token_distribution -> layer13_expert12_gate [style=dashed]
	layer13_token_distribution -> layer13_expert12_up [style=dashed]
	layer13_expert12_gate -> layer13_expert12_act
	layer13_expert12_up -> layer13_expert12_act
	layer13_expert12_act -> layer13_expert12_down
	layer13_expert12_down -> layer13_token_aggregation
	layer13_token_distribution -> layer13_expert13_gate [style=dashed]
	layer13_token_distribution -> layer13_expert13_up [style=dashed]
	layer13_expert13_gate -> layer13_expert13_act
	layer13_expert13_up -> layer13_expert13_act
	layer13_expert13_act -> layer13_expert13_down
	layer13_expert13_down -> layer13_token_aggregation
	layer13_token_distribution -> layer13_expert14_gate [style=dashed]
	layer13_token_distribution -> layer13_expert14_up [style=dashed]
	layer13_expert14_gate -> layer13_expert14_act
	layer13_expert14_up -> layer13_expert14_act
	layer13_expert14_act -> layer13_expert14_down
	layer13_expert14_down -> layer13_token_aggregation
	layer13_token_distribution -> layer13_expert15_gate [style=dashed]
	layer13_token_distribution -> layer13_expert15_up [style=dashed]
	layer13_expert15_gate -> layer13_expert15_act
	layer13_expert15_up -> layer13_expert15_act
	layer13_expert15_act -> layer13_expert15_down
	layer13_expert15_down -> layer13_token_aggregation
	layer13_token_aggregation -> layer13_res2
	layer14_mha_qkv [label="MHA QKV Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nAll GPUs" fillcolor=lightblue style=filled]
	layer14_mha_attn [label="MHA Attention\nInput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightgreen style=filled]
	layer14_mha_out [label="MHA Output Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightblue style=filled]
	layer14_res1 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer14_ln1 [label="Layer Norm\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=yellow style=filled]
	layer14_expert_routing [label="Expert Routing\nTop-2 Selection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, expert_id=2]\nAll GPUs" fillcolor=orange shape=diamond style=filled]
	layer14_token_distribution [label="Token Distribution\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: Tokens routed to 2 experts\nAll GPUs → Expert GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer14_expert0_gate [label="Expert 0 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer14_expert0_up [label="Expert 0 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer14_expert0_act [label="Expert 0 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightgreen style=filled]
	layer14_expert0_down [label="Expert 0 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 0" fillcolor=lightblue style=filled]
	layer14_expert1_gate [label="Expert 1 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer14_expert1_up [label="Expert 1 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer14_expert1_act [label="Expert 1 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightgreen style=filled]
	layer14_expert1_down [label="Expert 1 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 1" fillcolor=lightblue style=filled]
	layer14_expert2_gate [label="Expert 2 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer14_expert2_up [label="Expert 2 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer14_expert2_act [label="Expert 2 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightgreen style=filled]
	layer14_expert2_down [label="Expert 2 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 2" fillcolor=lightblue style=filled]
	layer14_expert3_gate [label="Expert 3 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer14_expert3_up [label="Expert 3 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer14_expert3_act [label="Expert 3 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightgreen style=filled]
	layer14_expert3_down [label="Expert 3 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 3" fillcolor=lightblue style=filled]
	layer14_expert4_gate [label="Expert 4 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer14_expert4_up [label="Expert 4 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer14_expert4_act [label="Expert 4 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightgreen style=filled]
	layer14_expert4_down [label="Expert 4 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 4" fillcolor=lightblue style=filled]
	layer14_expert5_gate [label="Expert 5 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer14_expert5_up [label="Expert 5 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer14_expert5_act [label="Expert 5 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightgreen style=filled]
	layer14_expert5_down [label="Expert 5 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 5" fillcolor=lightblue style=filled]
	layer14_expert6_gate [label="Expert 6 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer14_expert6_up [label="Expert 6 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer14_expert6_act [label="Expert 6 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightgreen style=filled]
	layer14_expert6_down [label="Expert 6 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 6" fillcolor=lightblue style=filled]
	layer14_expert7_gate [label="Expert 7 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer14_expert7_up [label="Expert 7 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer14_expert7_act [label="Expert 7 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightgreen style=filled]
	layer14_expert7_down [label="Expert 7 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 7" fillcolor=lightblue style=filled]
	layer14_expert8_gate [label="Expert 8 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer14_expert8_up [label="Expert 8 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer14_expert8_act [label="Expert 8 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightgreen style=filled]
	layer14_expert8_down [label="Expert 8 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 8" fillcolor=lightblue style=filled]
	layer14_expert9_gate [label="Expert 9 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer14_expert9_up [label="Expert 9 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer14_expert9_act [label="Expert 9 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightgreen style=filled]
	layer14_expert9_down [label="Expert 9 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 9" fillcolor=lightblue style=filled]
	layer14_expert10_gate [label="Expert 10 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer14_expert10_up [label="Expert 10 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer14_expert10_act [label="Expert 10 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightgreen style=filled]
	layer14_expert10_down [label="Expert 10 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 10" fillcolor=lightblue style=filled]
	layer14_expert11_gate [label="Expert 11 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer14_expert11_up [label="Expert 11 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer14_expert11_act [label="Expert 11 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightgreen style=filled]
	layer14_expert11_down [label="Expert 11 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 11" fillcolor=lightblue style=filled]
	layer14_expert12_gate [label="Expert 12 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer14_expert12_up [label="Expert 12 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer14_expert12_act [label="Expert 12 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightgreen style=filled]
	layer14_expert12_down [label="Expert 12 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 12" fillcolor=lightblue style=filled]
	layer14_expert13_gate [label="Expert 13 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer14_expert13_up [label="Expert 13 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer14_expert13_act [label="Expert 13 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightgreen style=filled]
	layer14_expert13_down [label="Expert 13 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 13" fillcolor=lightblue style=filled]
	layer14_expert14_gate [label="Expert 14 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer14_expert14_up [label="Expert 14 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer14_expert14_act [label="Expert 14 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightgreen style=filled]
	layer14_expert14_down [label="Expert 14 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 14" fillcolor=lightblue style=filled]
	layer14_expert15_gate [label="Expert 15 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer14_expert15_up [label="Expert 15 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer14_expert15_act [label="Expert 15 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightgreen style=filled]
	layer14_expert15_down [label="Expert 15 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 15" fillcolor=lightblue style=filled]
	layer14_token_aggregation [label="Token Aggregation\nInput: [dynamic_batch, seq_len, hidden=4096] from 2 experts\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer14_res2 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer13_res2 -> layer14_mha_qkv
	layer14_mha_qkv -> layer14_mha_attn
	layer14_mha_attn -> layer14_mha_out
	layer14_mha_out -> layer14_res1
	layer14_res1 -> layer14_ln1
	layer14_ln1 -> layer14_expert_routing
	layer14_expert_routing -> layer14_token_distribution
	layer14_token_distribution -> layer14_expert0_gate [style=dashed]
	layer14_token_distribution -> layer14_expert0_up [style=dashed]
	layer14_expert0_gate -> layer14_expert0_act
	layer14_expert0_up -> layer14_expert0_act
	layer14_expert0_act -> layer14_expert0_down
	layer14_expert0_down -> layer14_token_aggregation
	layer14_token_distribution -> layer14_expert1_gate [style=dashed]
	layer14_token_distribution -> layer14_expert1_up [style=dashed]
	layer14_expert1_gate -> layer14_expert1_act
	layer14_expert1_up -> layer14_expert1_act
	layer14_expert1_act -> layer14_expert1_down
	layer14_expert1_down -> layer14_token_aggregation
	layer14_token_distribution -> layer14_expert2_gate [style=dashed]
	layer14_token_distribution -> layer14_expert2_up [style=dashed]
	layer14_expert2_gate -> layer14_expert2_act
	layer14_expert2_up -> layer14_expert2_act
	layer14_expert2_act -> layer14_expert2_down
	layer14_expert2_down -> layer14_token_aggregation
	layer14_token_distribution -> layer14_expert3_gate [style=dashed]
	layer14_token_distribution -> layer14_expert3_up [style=dashed]
	layer14_expert3_gate -> layer14_expert3_act
	layer14_expert3_up -> layer14_expert3_act
	layer14_expert3_act -> layer14_expert3_down
	layer14_expert3_down -> layer14_token_aggregation
	layer14_token_distribution -> layer14_expert4_gate [style=dashed]
	layer14_token_distribution -> layer14_expert4_up [style=dashed]
	layer14_expert4_gate -> layer14_expert4_act
	layer14_expert4_up -> layer14_expert4_act
	layer14_expert4_act -> layer14_expert4_down
	layer14_expert4_down -> layer14_token_aggregation
	layer14_token_distribution -> layer14_expert5_gate [style=dashed]
	layer14_token_distribution -> layer14_expert5_up [style=dashed]
	layer14_expert5_gate -> layer14_expert5_act
	layer14_expert5_up -> layer14_expert5_act
	layer14_expert5_act -> layer14_expert5_down
	layer14_expert5_down -> layer14_token_aggregation
	layer14_token_distribution -> layer14_expert6_gate [style=dashed]
	layer14_token_distribution -> layer14_expert6_up [style=dashed]
	layer14_expert6_gate -> layer14_expert6_act
	layer14_expert6_up -> layer14_expert6_act
	layer14_expert6_act -> layer14_expert6_down
	layer14_expert6_down -> layer14_token_aggregation
	layer14_token_distribution -> layer14_expert7_gate [style=dashed]
	layer14_token_distribution -> layer14_expert7_up [style=dashed]
	layer14_expert7_gate -> layer14_expert7_act
	layer14_expert7_up -> layer14_expert7_act
	layer14_expert7_act -> layer14_expert7_down
	layer14_expert7_down -> layer14_token_aggregation
	layer14_token_distribution -> layer14_expert8_gate [style=dashed]
	layer14_token_distribution -> layer14_expert8_up [style=dashed]
	layer14_expert8_gate -> layer14_expert8_act
	layer14_expert8_up -> layer14_expert8_act
	layer14_expert8_act -> layer14_expert8_down
	layer14_expert8_down -> layer14_token_aggregation
	layer14_token_distribution -> layer14_expert9_gate [style=dashed]
	layer14_token_distribution -> layer14_expert9_up [style=dashed]
	layer14_expert9_gate -> layer14_expert9_act
	layer14_expert9_up -> layer14_expert9_act
	layer14_expert9_act -> layer14_expert9_down
	layer14_expert9_down -> layer14_token_aggregation
	layer14_token_distribution -> layer14_expert10_gate [style=dashed]
	layer14_token_distribution -> layer14_expert10_up [style=dashed]
	layer14_expert10_gate -> layer14_expert10_act
	layer14_expert10_up -> layer14_expert10_act
	layer14_expert10_act -> layer14_expert10_down
	layer14_expert10_down -> layer14_token_aggregation
	layer14_token_distribution -> layer14_expert11_gate [style=dashed]
	layer14_token_distribution -> layer14_expert11_up [style=dashed]
	layer14_expert11_gate -> layer14_expert11_act
	layer14_expert11_up -> layer14_expert11_act
	layer14_expert11_act -> layer14_expert11_down
	layer14_expert11_down -> layer14_token_aggregation
	layer14_token_distribution -> layer14_expert12_gate [style=dashed]
	layer14_token_distribution -> layer14_expert12_up [style=dashed]
	layer14_expert12_gate -> layer14_expert12_act
	layer14_expert12_up -> layer14_expert12_act
	layer14_expert12_act -> layer14_expert12_down
	layer14_expert12_down -> layer14_token_aggregation
	layer14_token_distribution -> layer14_expert13_gate [style=dashed]
	layer14_token_distribution -> layer14_expert13_up [style=dashed]
	layer14_expert13_gate -> layer14_expert13_act
	layer14_expert13_up -> layer14_expert13_act
	layer14_expert13_act -> layer14_expert13_down
	layer14_expert13_down -> layer14_token_aggregation
	layer14_token_distribution -> layer14_expert14_gate [style=dashed]
	layer14_token_distribution -> layer14_expert14_up [style=dashed]
	layer14_expert14_gate -> layer14_expert14_act
	layer14_expert14_up -> layer14_expert14_act
	layer14_expert14_act -> layer14_expert14_down
	layer14_expert14_down -> layer14_token_aggregation
	layer14_token_distribution -> layer14_expert15_gate [style=dashed]
	layer14_token_distribution -> layer14_expert15_up [style=dashed]
	layer14_expert15_gate -> layer14_expert15_act
	layer14_expert15_up -> layer14_expert15_act
	layer14_expert15_act -> layer14_expert15_down
	layer14_expert15_down -> layer14_token_aggregation
	layer14_token_aggregation -> layer14_res2
	layer15_mha_qkv [label="MHA QKV Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nAll GPUs" fillcolor=lightblue style=filled]
	layer15_mha_attn [label="MHA Attention\nInput: [batch_size=128, seq_len=10000, heads=32, d_k=128]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightgreen style=filled]
	layer15_mha_out [label="MHA Output Projection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightblue style=filled]
	layer15_res1 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer15_ln1 [label="Layer Norm\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=yellow style=filled]
	layer15_expert_routing [label="Expert Routing\nTop-2 Selection\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, expert_id=2]\nAll GPUs" fillcolor=orange shape=diamond style=filled]
	layer15_token_distribution [label="Token Distribution\nInput: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: Tokens routed to 2 experts\nAll GPUs → Expert GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer15_expert0_gate [label="Expert 0 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer15_expert0_up [label="Expert 0 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightblue style=filled]
	layer15_expert0_act [label="Expert 0 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 0" fillcolor=lightgreen style=filled]
	layer15_expert0_down [label="Expert 0 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 0" fillcolor=lightblue style=filled]
	layer15_expert1_gate [label="Expert 1 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer15_expert1_up [label="Expert 1 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightblue style=filled]
	layer15_expert1_act [label="Expert 1 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 1" fillcolor=lightgreen style=filled]
	layer15_expert1_down [label="Expert 1 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 1" fillcolor=lightblue style=filled]
	layer15_expert2_gate [label="Expert 2 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer15_expert2_up [label="Expert 2 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightblue style=filled]
	layer15_expert2_act [label="Expert 2 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 2" fillcolor=lightgreen style=filled]
	layer15_expert2_down [label="Expert 2 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 2" fillcolor=lightblue style=filled]
	layer15_expert3_gate [label="Expert 3 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer15_expert3_up [label="Expert 3 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightblue style=filled]
	layer15_expert3_act [label="Expert 3 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 3" fillcolor=lightgreen style=filled]
	layer15_expert3_down [label="Expert 3 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 3" fillcolor=lightblue style=filled]
	layer15_expert4_gate [label="Expert 4 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer15_expert4_up [label="Expert 4 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightblue style=filled]
	layer15_expert4_act [label="Expert 4 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 4" fillcolor=lightgreen style=filled]
	layer15_expert4_down [label="Expert 4 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 4" fillcolor=lightblue style=filled]
	layer15_expert5_gate [label="Expert 5 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer15_expert5_up [label="Expert 5 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightblue style=filled]
	layer15_expert5_act [label="Expert 5 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 5" fillcolor=lightgreen style=filled]
	layer15_expert5_down [label="Expert 5 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 5" fillcolor=lightblue style=filled]
	layer15_expert6_gate [label="Expert 6 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer15_expert6_up [label="Expert 6 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightblue style=filled]
	layer15_expert6_act [label="Expert 6 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 6" fillcolor=lightgreen style=filled]
	layer15_expert6_down [label="Expert 6 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 6" fillcolor=lightblue style=filled]
	layer15_expert7_gate [label="Expert 7 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer15_expert7_up [label="Expert 7 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightblue style=filled]
	layer15_expert7_act [label="Expert 7 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 7" fillcolor=lightgreen style=filled]
	layer15_expert7_down [label="Expert 7 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 7" fillcolor=lightblue style=filled]
	layer15_expert8_gate [label="Expert 8 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer15_expert8_up [label="Expert 8 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightblue style=filled]
	layer15_expert8_act [label="Expert 8 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 8" fillcolor=lightgreen style=filled]
	layer15_expert8_down [label="Expert 8 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 8" fillcolor=lightblue style=filled]
	layer15_expert9_gate [label="Expert 9 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer15_expert9_up [label="Expert 9 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightblue style=filled]
	layer15_expert9_act [label="Expert 9 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 9" fillcolor=lightgreen style=filled]
	layer15_expert9_down [label="Expert 9 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 9" fillcolor=lightblue style=filled]
	layer15_expert10_gate [label="Expert 10 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer15_expert10_up [label="Expert 10 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightblue style=filled]
	layer15_expert10_act [label="Expert 10 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 10" fillcolor=lightgreen style=filled]
	layer15_expert10_down [label="Expert 10 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 10" fillcolor=lightblue style=filled]
	layer15_expert11_gate [label="Expert 11 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer15_expert11_up [label="Expert 11 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightblue style=filled]
	layer15_expert11_act [label="Expert 11 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 11" fillcolor=lightgreen style=filled]
	layer15_expert11_down [label="Expert 11 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 11" fillcolor=lightblue style=filled]
	layer15_expert12_gate [label="Expert 12 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer15_expert12_up [label="Expert 12 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightblue style=filled]
	layer15_expert12_act [label="Expert 12 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 12" fillcolor=lightgreen style=filled]
	layer15_expert12_down [label="Expert 12 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 12" fillcolor=lightblue style=filled]
	layer15_expert13_gate [label="Expert 13 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer15_expert13_up [label="Expert 13 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightblue style=filled]
	layer15_expert13_act [label="Expert 13 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 13" fillcolor=lightgreen style=filled]
	layer15_expert13_down [label="Expert 13 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 13" fillcolor=lightblue style=filled]
	layer15_expert14_gate [label="Expert 14 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer15_expert14_up [label="Expert 14 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightblue style=filled]
	layer15_expert14_act [label="Expert 14 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 14" fillcolor=lightgreen style=filled]
	layer15_expert14_down [label="Expert 14 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 14" fillcolor=lightblue style=filled]
	layer15_expert15_gate [label="Expert 15 Gate\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer15_expert15_up [label="Expert 15 Up\nInput: [dynamic_batch, seq_len, hidden=4096]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightblue style=filled]
	layer15_expert15_act [label="Expert 15 Activation\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, ffn_hidden=16384]\nGPU 15" fillcolor=lightgreen style=filled]
	layer15_expert15_down [label="Expert 15 Down\nInput: [dynamic_batch, seq_len, ffn_hidden=16384]\nOutput: [dynamic_batch, seq_len, hidden=4096]\nGPU 15" fillcolor=lightblue style=filled]
	layer15_token_aggregation [label="Token Aggregation\nInput: [dynamic_batch, seq_len, hidden=4096] from 2 experts\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" fillcolor=lightcoral shape=parallelogram style=filled]
	layer15_res2 [label="Residual Add\nInput1: [batch_size=128, seq_len=10000, hidden=4096]\nInput2: [batch_size=128, seq_len=10000, hidden=4096]\nOutput: [batch_size=128, seq_len=10000, hidden=4096]\nAll GPUs" shape=parallelogram]
	layer14_res2 -> layer15_mha_qkv
	layer15_mha_qkv -> layer15_mha_attn
	layer15_mha_attn -> layer15_mha_out
	layer15_mha_out -> layer15_res1
	layer15_res1 -> layer15_ln1
	layer15_ln1 -> layer15_expert_routing
	layer15_expert_routing -> layer15_token_distribution
	layer15_token_distribution -> layer15_expert0_gate [style=dashed]
	layer15_token_distribution -> layer15_expert0_up [style=dashed]
	layer15_expert0_gate -> layer15_expert0_act
	layer15_expert0_up -> layer15_expert0_act
	layer15_expert0_act -> layer15_expert0_down
	layer15_expert0_down -> layer15_token_aggregation
	layer15_token_distribution -> layer15_expert1_gate [style=dashed]
	layer15_token_distribution -> layer15_expert1_up [style=dashed]
	layer15_expert1_gate -> layer15_expert1_act
	layer15_expert1_up -> layer15_expert1_act
	layer15_expert1_act -> layer15_expert1_down
	layer15_expert1_down -> layer15_token_aggregation
	layer15_token_distribution -> layer15_expert2_gate [style=dashed]
	layer15_token_distribution -> layer15_expert2_up [style=dashed]
	layer15_expert2_gate -> layer15_expert2_act
	layer15_expert2_up -> layer15_expert2_act
	layer15_expert2_act -> layer15_expert2_down
	layer15_expert2_down -> layer15_token_aggregation
	layer15_token_distribution -> layer15_expert3_gate [style=dashed]
	layer15_token_distribution -> layer15_expert3_up [style=dashed]
	layer15_expert3_gate -> layer15_expert3_act
	layer15_expert3_up -> layer15_expert3_act
	layer15_expert3_act -> layer15_expert3_down
	layer15_expert3_down -> layer15_token_aggregation
	layer15_token_distribution -> layer15_expert4_gate [style=dashed]
	layer15_token_distribution -> layer15_expert4_up [style=dashed]
	layer15_expert4_gate -> layer15_expert4_act
	layer15_expert4_up -> layer15_expert4_act
	layer15_expert4_act -> layer15_expert4_down
	layer15_expert4_down -> layer15_token_aggregation
	layer15_token_distribution -> layer15_expert5_gate [style=dashed]
	layer15_token_distribution -> layer15_expert5_up [style=dashed]
	layer15_expert5_gate -> layer15_expert5_act
	layer15_expert5_up -> layer15_expert5_act
	layer15_expert5_act -> layer15_expert5_down
	layer15_expert5_down -> layer15_token_aggregation
	layer15_token_distribution -> layer15_expert6_gate [style=dashed]
	layer15_token_distribution -> layer15_expert6_up [style=dashed]
	layer15_expert6_gate -> layer15_expert6_act
	layer15_expert6_up -> layer15_expert6_act
	layer15_expert6_act -> layer15_expert6_down
	layer15_expert6_down -> layer15_token_aggregation
	layer15_token_distribution -> layer15_expert7_gate [style=dashed]
	layer15_token_distribution -> layer15_expert7_up [style=dashed]
	layer15_expert7_gate -> layer15_expert7_act
	layer15_expert7_up -> layer15_expert7_act
	layer15_expert7_act -> layer15_expert7_down
	layer15_expert7_down -> layer15_token_aggregation
	layer15_token_distribution -> layer15_expert8_gate [style=dashed]
	layer15_token_distribution -> layer15_expert8_up [style=dashed]
	layer15_expert8_gate -> layer15_expert8_act
	layer15_expert8_up -> layer15_expert8_act
	layer15_expert8_act -> layer15_expert8_down
	layer15_expert8_down -> layer15_token_aggregation
	layer15_token_distribution -> layer15_expert9_gate [style=dashed]
	layer15_token_distribution -> layer15_expert9_up [style=dashed]
	layer15_expert9_gate -> layer15_expert9_act
	layer15_expert9_up -> layer15_expert9_act
	layer15_expert9_act -> layer15_expert9_down
	layer15_expert9_down -> layer15_token_aggregation
	layer15_token_distribution -> layer15_expert10_gate [style=dashed]
	layer15_token_distribution -> layer15_expert10_up [style=dashed]
	layer15_expert10_gate -> layer15_expert10_act
	layer15_expert10_up -> layer15_expert10_act
	layer15_expert10_act -> layer15_expert10_down
	layer15_expert10_down -> layer15_token_aggregation
	layer15_token_distribution -> layer15_expert11_gate [style=dashed]
	layer15_token_distribution -> layer15_expert11_up [style=dashed]
	layer15_expert11_gate -> layer15_expert11_act
	layer15_expert11_up -> layer15_expert11_act
	layer15_expert11_act -> layer15_expert11_down
	layer15_expert11_down -> layer15_token_aggregation
	layer15_token_distribution -> layer15_expert12_gate [style=dashed]
	layer15_token_distribution -> layer15_expert12_up [style=dashed]
	layer15_expert12_gate -> layer15_expert12_act
	layer15_expert12_up -> layer15_expert12_act
	layer15_expert12_act -> layer15_expert12_down
	layer15_expert12_down -> layer15_token_aggregation
	layer15_token_distribution -> layer15_expert13_gate [style=dashed]
	layer15_token_distribution -> layer15_expert13_up [style=dashed]
	layer15_expert13_gate -> layer15_expert13_act
	layer15_expert13_up -> layer15_expert13_act
	layer15_expert13_act -> layer15_expert13_down
	layer15_expert13_down -> layer15_token_aggregation
	layer15_token_distribution -> layer15_expert14_gate [style=dashed]
	layer15_token_distribution -> layer15_expert14_up [style=dashed]
	layer15_expert14_gate -> layer15_expert14_act
	layer15_expert14_up -> layer15_expert14_act
	layer15_expert14_act -> layer15_expert14_down
	layer15_expert14_down -> layer15_token_aggregation
	layer15_token_distribution -> layer15_expert15_gate [style=dashed]
	layer15_token_distribution -> layer15_expert15_up [style=dashed]
	layer15_expert15_gate -> layer15_expert15_act
	layer15_expert15_up -> layer15_expert15_act
	layer15_expert15_act -> layer15_expert15_down
	layer15_expert15_down -> layer15_token_aggregation
	layer15_token_aggregation -> layer15_res2
	output [label="Output\nOutput: [batch_size=128, seq_len=10000, hidden=4096]" shape=ellipse]
	input -> routing
	routing -> layer0_mha_qkv
	layer15_mha_out -> output
}
