// LLaMA-7B GPipe Batch Pipeline
digraph {
	compound=true rankdir=TB splines=ortho
	node [fillcolor=lightgreen shape=ellipse style=filled]
	node [fillcolor=lightblue shape=rectangle style=filled]
	node [fillcolor=lightyellow shape=parallelogram style=filled]
	input [label="Input\nInput: [batch_size=6, seq_len=2048]\nOutput: [batch_size=6, seq_len=2048]\nGPU: all GPUs" fillcolor=lightgreen shape=ellipse]
	split_batches [label="Split Batches\nInput: [batch_size=6, seq_len=2048]\nOutput: [micro_batch_size=1, seq_len=2048]\nGPU: all GPUs" fillcolor=lightyellow shape=parallelogram]
	input -> split_batches
	split_batches -> mb_0_embedding
	split_batches -> mb_1_embedding
	split_batches -> mb_2_embedding
	split_batches -> mb_3_embedding
	split_batches -> mb_4_embedding
	split_batches -> mb_5_embedding
	subgraph cluster_stage_0 {
		label="Stage 1\nP@1\nLayers 1-5" style=dashed
		mb_0_embedding [label="Micro-Batch 0\nEmbedding\nInput: [batch_size=1, seq_len=2048]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nGPU: P@1"]
		mb_0_layer_1_attn_norm [label="MB0 L1\nAttention Norm\nGPU: P@1"]
		mb_0_layer_1_attn_qkv [label="MB0 L1\nAttention QKV\nGPU: P@1"]
		mb_0_layer_1_attn_out [label="MB0 L1\nAttention Out\nGPU: P@1"]
		mb_0_layer_1_attn_residual [label="MB0 L1\nAttn Residual\nGPU: P@1"]
		mb_0_layer_1_ffn_norm [label="MB0 L1\nFFN Norm\nGPU: P@1"]
		mb_0_layer_1_ffn_up [label="MB0 L1\nFFN Up\nGPU: P@1"]
		mb_0_layer_1_ffn_down [label="MB0 L1\nFFN Down\nGPU: P@1"]
		mb_0_layer_1_ffn_residual [label="MB0 L1\nFFN Residual\nGPU: P@1"]
		mb_0_embedding -> mb_0_layer_1_attn_norm
		mb_0_layer_1_attn_norm -> mb_0_layer_1_attn_qkv
		mb_0_layer_1_attn_qkv -> mb_0_layer_1_attn_out
		mb_0_layer_1_attn_out -> mb_0_layer_1_attn_residual
		mb_0_layer_1_attn_residual -> mb_0_layer_1_ffn_norm
		mb_0_layer_1_ffn_norm -> mb_0_layer_1_ffn_up
		mb_0_layer_1_ffn_up -> mb_0_layer_1_ffn_down
		mb_0_layer_1_ffn_down -> mb_0_layer_1_ffn_residual
		mb_0_layer_2_attn_norm [label="MB0 L2\nAttention Norm\nGPU: P@1"]
		mb_0_layer_2_attn_qkv [label="MB0 L2\nAttention QKV\nGPU: P@1"]
		mb_0_layer_2_attn_out [label="MB0 L2\nAttention Out\nGPU: P@1"]
		mb_0_layer_2_attn_residual [label="MB0 L2\nAttn Residual\nGPU: P@1"]
		mb_0_layer_2_ffn_norm [label="MB0 L2\nFFN Norm\nGPU: P@1"]
		mb_0_layer_2_ffn_up [label="MB0 L2\nFFN Up\nGPU: P@1"]
		mb_0_layer_2_ffn_down [label="MB0 L2\nFFN Down\nGPU: P@1"]
		mb_0_layer_2_ffn_residual [label="MB0 L2\nFFN Residual\nGPU: P@1"]
		mb_0_layer_1_ffn_residual -> mb_0_layer_2_attn_norm
		mb_0_layer_2_attn_norm -> mb_0_layer_2_attn_qkv
		mb_0_layer_2_attn_qkv -> mb_0_layer_2_attn_out
		mb_0_layer_2_attn_out -> mb_0_layer_2_attn_residual
		mb_0_layer_2_attn_residual -> mb_0_layer_2_ffn_norm
		mb_0_layer_2_ffn_norm -> mb_0_layer_2_ffn_up
		mb_0_layer_2_ffn_up -> mb_0_layer_2_ffn_down
		mb_0_layer_2_ffn_down -> mb_0_layer_2_ffn_residual
		mb_0_layer_3_attn_norm [label="MB0 L3\nAttention Norm\nGPU: P@1"]
		mb_0_layer_3_attn_qkv [label="MB0 L3\nAttention QKV\nGPU: P@1"]
		mb_0_layer_3_attn_out [label="MB0 L3\nAttention Out\nGPU: P@1"]
		mb_0_layer_3_attn_residual [label="MB0 L3\nAttn Residual\nGPU: P@1"]
		mb_0_layer_3_ffn_norm [label="MB0 L3\nFFN Norm\nGPU: P@1"]
		mb_0_layer_3_ffn_up [label="MB0 L3\nFFN Up\nGPU: P@1"]
		mb_0_layer_3_ffn_down [label="MB0 L3\nFFN Down\nGPU: P@1"]
		mb_0_layer_3_ffn_residual [label="MB0 L3\nFFN Residual\nGPU: P@1"]
		mb_0_layer_2_ffn_residual -> mb_0_layer_3_attn_norm
		mb_0_layer_3_attn_norm -> mb_0_layer_3_attn_qkv
		mb_0_layer_3_attn_qkv -> mb_0_layer_3_attn_out
		mb_0_layer_3_attn_out -> mb_0_layer_3_attn_residual
		mb_0_layer_3_attn_residual -> mb_0_layer_3_ffn_norm
		mb_0_layer_3_ffn_norm -> mb_0_layer_3_ffn_up
		mb_0_layer_3_ffn_up -> mb_0_layer_3_ffn_down
		mb_0_layer_3_ffn_down -> mb_0_layer_3_ffn_residual
		mb_0_layer_4_attn_norm [label="MB0 L4\nAttention Norm\nGPU: P@1"]
		mb_0_layer_4_attn_qkv [label="MB0 L4\nAttention QKV\nGPU: P@1"]
		mb_0_layer_4_attn_out [label="MB0 L4\nAttention Out\nGPU: P@1"]
		mb_0_layer_4_attn_residual [label="MB0 L4\nAttn Residual\nGPU: P@1"]
		mb_0_layer_4_ffn_norm [label="MB0 L4\nFFN Norm\nGPU: P@1"]
		mb_0_layer_4_ffn_up [label="MB0 L4\nFFN Up\nGPU: P@1"]
		mb_0_layer_4_ffn_down [label="MB0 L4\nFFN Down\nGPU: P@1"]
		mb_0_layer_4_ffn_residual [label="MB0 L4\nFFN Residual\nGPU: P@1"]
		mb_0_layer_3_ffn_residual -> mb_0_layer_4_attn_norm
		mb_0_layer_4_attn_norm -> mb_0_layer_4_attn_qkv
		mb_0_layer_4_attn_qkv -> mb_0_layer_4_attn_out
		mb_0_layer_4_attn_out -> mb_0_layer_4_attn_residual
		mb_0_layer_4_attn_residual -> mb_0_layer_4_ffn_norm
		mb_0_layer_4_ffn_norm -> mb_0_layer_4_ffn_up
		mb_0_layer_4_ffn_up -> mb_0_layer_4_ffn_down
		mb_0_layer_4_ffn_down -> mb_0_layer_4_ffn_residual
		mb_0_layer_5_attn_norm [label="MB0 L5\nAttention Norm\nGPU: P@1"]
		mb_0_layer_5_attn_qkv [label="MB0 L5\nAttention QKV\nGPU: P@1"]
		mb_0_layer_5_attn_out [label="MB0 L5\nAttention Out\nGPU: P@1"]
		mb_0_layer_5_attn_residual [label="MB0 L5\nAttn Residual\nGPU: P@1"]
		mb_0_layer_5_ffn_norm [label="MB0 L5\nFFN Norm\nGPU: P@1"]
		mb_0_layer_5_ffn_up [label="MB0 L5\nFFN Up\nGPU: P@1"]
		mb_0_layer_5_ffn_down [label="MB0 L5\nFFN Down\nGPU: P@1"]
		mb_0_layer_5_ffn_residual [label="MB0 L5\nFFN Residual\nGPU: P@1"]
		mb_0_layer_4_ffn_residual -> mb_0_layer_5_attn_norm
		mb_0_layer_5_attn_norm -> mb_0_layer_5_attn_qkv
		mb_0_layer_5_attn_qkv -> mb_0_layer_5_attn_out
		mb_0_layer_5_attn_out -> mb_0_layer_5_attn_residual
		mb_0_layer_5_attn_residual -> mb_0_layer_5_ffn_norm
		mb_0_layer_5_ffn_norm -> mb_0_layer_5_ffn_up
		mb_0_layer_5_ffn_up -> mb_0_layer_5_ffn_down
		mb_0_layer_5_ffn_down -> mb_0_layer_5_ffn_residual
		mb_0_stage_0_output [label="MB0\nStage 1\nOutput\nGPU: P@1"]
		mb_0_layer_5_ffn_residual -> mb_0_stage_0_output
		mb_1_embedding [label="Micro-Batch 1\nEmbedding\nInput: [batch_size=1, seq_len=2048]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nGPU: P@1"]
		mb_1_layer_1_attn_norm [label="MB1 L1\nAttention Norm\nGPU: P@1"]
		mb_1_layer_1_attn_qkv [label="MB1 L1\nAttention QKV\nGPU: P@1"]
		mb_1_layer_1_attn_out [label="MB1 L1\nAttention Out\nGPU: P@1"]
		mb_1_layer_1_attn_residual [label="MB1 L1\nAttn Residual\nGPU: P@1"]
		mb_1_layer_1_ffn_norm [label="MB1 L1\nFFN Norm\nGPU: P@1"]
		mb_1_layer_1_ffn_up [label="MB1 L1\nFFN Up\nGPU: P@1"]
		mb_1_layer_1_ffn_down [label="MB1 L1\nFFN Down\nGPU: P@1"]
		mb_1_layer_1_ffn_residual [label="MB1 L1\nFFN Residual\nGPU: P@1"]
		mb_1_embedding -> mb_1_layer_1_attn_norm
		mb_1_layer_1_attn_norm -> mb_1_layer_1_attn_qkv
		mb_1_layer_1_attn_qkv -> mb_1_layer_1_attn_out
		mb_1_layer_1_attn_out -> mb_1_layer_1_attn_residual
		mb_1_layer_1_attn_residual -> mb_1_layer_1_ffn_norm
		mb_1_layer_1_ffn_norm -> mb_1_layer_1_ffn_up
		mb_1_layer_1_ffn_up -> mb_1_layer_1_ffn_down
		mb_1_layer_1_ffn_down -> mb_1_layer_1_ffn_residual
		mb_1_layer_2_attn_norm [label="MB1 L2\nAttention Norm\nGPU: P@1"]
		mb_1_layer_2_attn_qkv [label="MB1 L2\nAttention QKV\nGPU: P@1"]
		mb_1_layer_2_attn_out [label="MB1 L2\nAttention Out\nGPU: P@1"]
		mb_1_layer_2_attn_residual [label="MB1 L2\nAttn Residual\nGPU: P@1"]
		mb_1_layer_2_ffn_norm [label="MB1 L2\nFFN Norm\nGPU: P@1"]
		mb_1_layer_2_ffn_up [label="MB1 L2\nFFN Up\nGPU: P@1"]
		mb_1_layer_2_ffn_down [label="MB1 L2\nFFN Down\nGPU: P@1"]
		mb_1_layer_2_ffn_residual [label="MB1 L2\nFFN Residual\nGPU: P@1"]
		mb_1_layer_1_ffn_residual -> mb_1_layer_2_attn_norm
		mb_1_layer_2_attn_norm -> mb_1_layer_2_attn_qkv
		mb_1_layer_2_attn_qkv -> mb_1_layer_2_attn_out
		mb_1_layer_2_attn_out -> mb_1_layer_2_attn_residual
		mb_1_layer_2_attn_residual -> mb_1_layer_2_ffn_norm
		mb_1_layer_2_ffn_norm -> mb_1_layer_2_ffn_up
		mb_1_layer_2_ffn_up -> mb_1_layer_2_ffn_down
		mb_1_layer_2_ffn_down -> mb_1_layer_2_ffn_residual
		mb_1_layer_3_attn_norm [label="MB1 L3\nAttention Norm\nGPU: P@1"]
		mb_1_layer_3_attn_qkv [label="MB1 L3\nAttention QKV\nGPU: P@1"]
		mb_1_layer_3_attn_out [label="MB1 L3\nAttention Out\nGPU: P@1"]
		mb_1_layer_3_attn_residual [label="MB1 L3\nAttn Residual\nGPU: P@1"]
		mb_1_layer_3_ffn_norm [label="MB1 L3\nFFN Norm\nGPU: P@1"]
		mb_1_layer_3_ffn_up [label="MB1 L3\nFFN Up\nGPU: P@1"]
		mb_1_layer_3_ffn_down [label="MB1 L3\nFFN Down\nGPU: P@1"]
		mb_1_layer_3_ffn_residual [label="MB1 L3\nFFN Residual\nGPU: P@1"]
		mb_1_layer_2_ffn_residual -> mb_1_layer_3_attn_norm
		mb_1_layer_3_attn_norm -> mb_1_layer_3_attn_qkv
		mb_1_layer_3_attn_qkv -> mb_1_layer_3_attn_out
		mb_1_layer_3_attn_out -> mb_1_layer_3_attn_residual
		mb_1_layer_3_attn_residual -> mb_1_layer_3_ffn_norm
		mb_1_layer_3_ffn_norm -> mb_1_layer_3_ffn_up
		mb_1_layer_3_ffn_up -> mb_1_layer_3_ffn_down
		mb_1_layer_3_ffn_down -> mb_1_layer_3_ffn_residual
		mb_1_layer_4_attn_norm [label="MB1 L4\nAttention Norm\nGPU: P@1"]
		mb_1_layer_4_attn_qkv [label="MB1 L4\nAttention QKV\nGPU: P@1"]
		mb_1_layer_4_attn_out [label="MB1 L4\nAttention Out\nGPU: P@1"]
		mb_1_layer_4_attn_residual [label="MB1 L4\nAttn Residual\nGPU: P@1"]
		mb_1_layer_4_ffn_norm [label="MB1 L4\nFFN Norm\nGPU: P@1"]
		mb_1_layer_4_ffn_up [label="MB1 L4\nFFN Up\nGPU: P@1"]
		mb_1_layer_4_ffn_down [label="MB1 L4\nFFN Down\nGPU: P@1"]
		mb_1_layer_4_ffn_residual [label="MB1 L4\nFFN Residual\nGPU: P@1"]
		mb_1_layer_3_ffn_residual -> mb_1_layer_4_attn_norm
		mb_1_layer_4_attn_norm -> mb_1_layer_4_attn_qkv
		mb_1_layer_4_attn_qkv -> mb_1_layer_4_attn_out
		mb_1_layer_4_attn_out -> mb_1_layer_4_attn_residual
		mb_1_layer_4_attn_residual -> mb_1_layer_4_ffn_norm
		mb_1_layer_4_ffn_norm -> mb_1_layer_4_ffn_up
		mb_1_layer_4_ffn_up -> mb_1_layer_4_ffn_down
		mb_1_layer_4_ffn_down -> mb_1_layer_4_ffn_residual
		mb_1_layer_5_attn_norm [label="MB1 L5\nAttention Norm\nGPU: P@1"]
		mb_1_layer_5_attn_qkv [label="MB1 L5\nAttention QKV\nGPU: P@1"]
		mb_1_layer_5_attn_out [label="MB1 L5\nAttention Out\nGPU: P@1"]
		mb_1_layer_5_attn_residual [label="MB1 L5\nAttn Residual\nGPU: P@1"]
		mb_1_layer_5_ffn_norm [label="MB1 L5\nFFN Norm\nGPU: P@1"]
		mb_1_layer_5_ffn_up [label="MB1 L5\nFFN Up\nGPU: P@1"]
		mb_1_layer_5_ffn_down [label="MB1 L5\nFFN Down\nGPU: P@1"]
		mb_1_layer_5_ffn_residual [label="MB1 L5\nFFN Residual\nGPU: P@1"]
		mb_1_layer_4_ffn_residual -> mb_1_layer_5_attn_norm
		mb_1_layer_5_attn_norm -> mb_1_layer_5_attn_qkv
		mb_1_layer_5_attn_qkv -> mb_1_layer_5_attn_out
		mb_1_layer_5_attn_out -> mb_1_layer_5_attn_residual
		mb_1_layer_5_attn_residual -> mb_1_layer_5_ffn_norm
		mb_1_layer_5_ffn_norm -> mb_1_layer_5_ffn_up
		mb_1_layer_5_ffn_up -> mb_1_layer_5_ffn_down
		mb_1_layer_5_ffn_down -> mb_1_layer_5_ffn_residual
		mb_1_stage_0_output [label="MB1\nStage 1\nOutput\nGPU: P@1"]
		mb_1_layer_5_ffn_residual -> mb_1_stage_0_output
		mb_2_embedding [label="Micro-Batch 2\nEmbedding\nInput: [batch_size=1, seq_len=2048]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nGPU: P@1"]
		mb_2_layer_1_attn_norm [label="MB2 L1\nAttention Norm\nGPU: P@1"]
		mb_2_layer_1_attn_qkv [label="MB2 L1\nAttention QKV\nGPU: P@1"]
		mb_2_layer_1_attn_out [label="MB2 L1\nAttention Out\nGPU: P@1"]
		mb_2_layer_1_attn_residual [label="MB2 L1\nAttn Residual\nGPU: P@1"]
		mb_2_layer_1_ffn_norm [label="MB2 L1\nFFN Norm\nGPU: P@1"]
		mb_2_layer_1_ffn_up [label="MB2 L1\nFFN Up\nGPU: P@1"]
		mb_2_layer_1_ffn_down [label="MB2 L1\nFFN Down\nGPU: P@1"]
		mb_2_layer_1_ffn_residual [label="MB2 L1\nFFN Residual\nGPU: P@1"]
		mb_2_embedding -> mb_2_layer_1_attn_norm
		mb_2_layer_1_attn_norm -> mb_2_layer_1_attn_qkv
		mb_2_layer_1_attn_qkv -> mb_2_layer_1_attn_out
		mb_2_layer_1_attn_out -> mb_2_layer_1_attn_residual
		mb_2_layer_1_attn_residual -> mb_2_layer_1_ffn_norm
		mb_2_layer_1_ffn_norm -> mb_2_layer_1_ffn_up
		mb_2_layer_1_ffn_up -> mb_2_layer_1_ffn_down
		mb_2_layer_1_ffn_down -> mb_2_layer_1_ffn_residual
		mb_2_layer_2_attn_norm [label="MB2 L2\nAttention Norm\nGPU: P@1"]
		mb_2_layer_2_attn_qkv [label="MB2 L2\nAttention QKV\nGPU: P@1"]
		mb_2_layer_2_attn_out [label="MB2 L2\nAttention Out\nGPU: P@1"]
		mb_2_layer_2_attn_residual [label="MB2 L2\nAttn Residual\nGPU: P@1"]
		mb_2_layer_2_ffn_norm [label="MB2 L2\nFFN Norm\nGPU: P@1"]
		mb_2_layer_2_ffn_up [label="MB2 L2\nFFN Up\nGPU: P@1"]
		mb_2_layer_2_ffn_down [label="MB2 L2\nFFN Down\nGPU: P@1"]
		mb_2_layer_2_ffn_residual [label="MB2 L2\nFFN Residual\nGPU: P@1"]
		mb_2_layer_1_ffn_residual -> mb_2_layer_2_attn_norm
		mb_2_layer_2_attn_norm -> mb_2_layer_2_attn_qkv
		mb_2_layer_2_attn_qkv -> mb_2_layer_2_attn_out
		mb_2_layer_2_attn_out -> mb_2_layer_2_attn_residual
		mb_2_layer_2_attn_residual -> mb_2_layer_2_ffn_norm
		mb_2_layer_2_ffn_norm -> mb_2_layer_2_ffn_up
		mb_2_layer_2_ffn_up -> mb_2_layer_2_ffn_down
		mb_2_layer_2_ffn_down -> mb_2_layer_2_ffn_residual
		mb_2_layer_3_attn_norm [label="MB2 L3\nAttention Norm\nGPU: P@1"]
		mb_2_layer_3_attn_qkv [label="MB2 L3\nAttention QKV\nGPU: P@1"]
		mb_2_layer_3_attn_out [label="MB2 L3\nAttention Out\nGPU: P@1"]
		mb_2_layer_3_attn_residual [label="MB2 L3\nAttn Residual\nGPU: P@1"]
		mb_2_layer_3_ffn_norm [label="MB2 L3\nFFN Norm\nGPU: P@1"]
		mb_2_layer_3_ffn_up [label="MB2 L3\nFFN Up\nGPU: P@1"]
		mb_2_layer_3_ffn_down [label="MB2 L3\nFFN Down\nGPU: P@1"]
		mb_2_layer_3_ffn_residual [label="MB2 L3\nFFN Residual\nGPU: P@1"]
		mb_2_layer_2_ffn_residual -> mb_2_layer_3_attn_norm
		mb_2_layer_3_attn_norm -> mb_2_layer_3_attn_qkv
		mb_2_layer_3_attn_qkv -> mb_2_layer_3_attn_out
		mb_2_layer_3_attn_out -> mb_2_layer_3_attn_residual
		mb_2_layer_3_attn_residual -> mb_2_layer_3_ffn_norm
		mb_2_layer_3_ffn_norm -> mb_2_layer_3_ffn_up
		mb_2_layer_3_ffn_up -> mb_2_layer_3_ffn_down
		mb_2_layer_3_ffn_down -> mb_2_layer_3_ffn_residual
		mb_2_layer_4_attn_norm [label="MB2 L4\nAttention Norm\nGPU: P@1"]
		mb_2_layer_4_attn_qkv [label="MB2 L4\nAttention QKV\nGPU: P@1"]
		mb_2_layer_4_attn_out [label="MB2 L4\nAttention Out\nGPU: P@1"]
		mb_2_layer_4_attn_residual [label="MB2 L4\nAttn Residual\nGPU: P@1"]
		mb_2_layer_4_ffn_norm [label="MB2 L4\nFFN Norm\nGPU: P@1"]
		mb_2_layer_4_ffn_up [label="MB2 L4\nFFN Up\nGPU: P@1"]
		mb_2_layer_4_ffn_down [label="MB2 L4\nFFN Down\nGPU: P@1"]
		mb_2_layer_4_ffn_residual [label="MB2 L4\nFFN Residual\nGPU: P@1"]
		mb_2_layer_3_ffn_residual -> mb_2_layer_4_attn_norm
		mb_2_layer_4_attn_norm -> mb_2_layer_4_attn_qkv
		mb_2_layer_4_attn_qkv -> mb_2_layer_4_attn_out
		mb_2_layer_4_attn_out -> mb_2_layer_4_attn_residual
		mb_2_layer_4_attn_residual -> mb_2_layer_4_ffn_norm
		mb_2_layer_4_ffn_norm -> mb_2_layer_4_ffn_up
		mb_2_layer_4_ffn_up -> mb_2_layer_4_ffn_down
		mb_2_layer_4_ffn_down -> mb_2_layer_4_ffn_residual
		mb_2_layer_5_attn_norm [label="MB2 L5\nAttention Norm\nGPU: P@1"]
		mb_2_layer_5_attn_qkv [label="MB2 L5\nAttention QKV\nGPU: P@1"]
		mb_2_layer_5_attn_out [label="MB2 L5\nAttention Out\nGPU: P@1"]
		mb_2_layer_5_attn_residual [label="MB2 L5\nAttn Residual\nGPU: P@1"]
		mb_2_layer_5_ffn_norm [label="MB2 L5\nFFN Norm\nGPU: P@1"]
		mb_2_layer_5_ffn_up [label="MB2 L5\nFFN Up\nGPU: P@1"]
		mb_2_layer_5_ffn_down [label="MB2 L5\nFFN Down\nGPU: P@1"]
		mb_2_layer_5_ffn_residual [label="MB2 L5\nFFN Residual\nGPU: P@1"]
		mb_2_layer_4_ffn_residual -> mb_2_layer_5_attn_norm
		mb_2_layer_5_attn_norm -> mb_2_layer_5_attn_qkv
		mb_2_layer_5_attn_qkv -> mb_2_layer_5_attn_out
		mb_2_layer_5_attn_out -> mb_2_layer_5_attn_residual
		mb_2_layer_5_attn_residual -> mb_2_layer_5_ffn_norm
		mb_2_layer_5_ffn_norm -> mb_2_layer_5_ffn_up
		mb_2_layer_5_ffn_up -> mb_2_layer_5_ffn_down
		mb_2_layer_5_ffn_down -> mb_2_layer_5_ffn_residual
		mb_2_stage_0_output [label="MB2\nStage 1\nOutput\nGPU: P@1"]
		mb_2_layer_5_ffn_residual -> mb_2_stage_0_output
		mb_3_embedding [label="Micro-Batch 3\nEmbedding\nInput: [batch_size=1, seq_len=2048]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nGPU: P@1"]
		mb_3_layer_1_attn_norm [label="MB3 L1\nAttention Norm\nGPU: P@1"]
		mb_3_layer_1_attn_qkv [label="MB3 L1\nAttention QKV\nGPU: P@1"]
		mb_3_layer_1_attn_out [label="MB3 L1\nAttention Out\nGPU: P@1"]
		mb_3_layer_1_attn_residual [label="MB3 L1\nAttn Residual\nGPU: P@1"]
		mb_3_layer_1_ffn_norm [label="MB3 L1\nFFN Norm\nGPU: P@1"]
		mb_3_layer_1_ffn_up [label="MB3 L1\nFFN Up\nGPU: P@1"]
		mb_3_layer_1_ffn_down [label="MB3 L1\nFFN Down\nGPU: P@1"]
		mb_3_layer_1_ffn_residual [label="MB3 L1\nFFN Residual\nGPU: P@1"]
		mb_3_embedding -> mb_3_layer_1_attn_norm
		mb_3_layer_1_attn_norm -> mb_3_layer_1_attn_qkv
		mb_3_layer_1_attn_qkv -> mb_3_layer_1_attn_out
		mb_3_layer_1_attn_out -> mb_3_layer_1_attn_residual
		mb_3_layer_1_attn_residual -> mb_3_layer_1_ffn_norm
		mb_3_layer_1_ffn_norm -> mb_3_layer_1_ffn_up
		mb_3_layer_1_ffn_up -> mb_3_layer_1_ffn_down
		mb_3_layer_1_ffn_down -> mb_3_layer_1_ffn_residual
		mb_3_layer_2_attn_norm [label="MB3 L2\nAttention Norm\nGPU: P@1"]
		mb_3_layer_2_attn_qkv [label="MB3 L2\nAttention QKV\nGPU: P@1"]
		mb_3_layer_2_attn_out [label="MB3 L2\nAttention Out\nGPU: P@1"]
		mb_3_layer_2_attn_residual [label="MB3 L2\nAttn Residual\nGPU: P@1"]
		mb_3_layer_2_ffn_norm [label="MB3 L2\nFFN Norm\nGPU: P@1"]
		mb_3_layer_2_ffn_up [label="MB3 L2\nFFN Up\nGPU: P@1"]
		mb_3_layer_2_ffn_down [label="MB3 L2\nFFN Down\nGPU: P@1"]
		mb_3_layer_2_ffn_residual [label="MB3 L2\nFFN Residual\nGPU: P@1"]
		mb_3_layer_1_ffn_residual -> mb_3_layer_2_attn_norm
		mb_3_layer_2_attn_norm -> mb_3_layer_2_attn_qkv
		mb_3_layer_2_attn_qkv -> mb_3_layer_2_attn_out
		mb_3_layer_2_attn_out -> mb_3_layer_2_attn_residual
		mb_3_layer_2_attn_residual -> mb_3_layer_2_ffn_norm
		mb_3_layer_2_ffn_norm -> mb_3_layer_2_ffn_up
		mb_3_layer_2_ffn_up -> mb_3_layer_2_ffn_down
		mb_3_layer_2_ffn_down -> mb_3_layer_2_ffn_residual
		mb_3_layer_3_attn_norm [label="MB3 L3\nAttention Norm\nGPU: P@1"]
		mb_3_layer_3_attn_qkv [label="MB3 L3\nAttention QKV\nGPU: P@1"]
		mb_3_layer_3_attn_out [label="MB3 L3\nAttention Out\nGPU: P@1"]
		mb_3_layer_3_attn_residual [label="MB3 L3\nAttn Residual\nGPU: P@1"]
		mb_3_layer_3_ffn_norm [label="MB3 L3\nFFN Norm\nGPU: P@1"]
		mb_3_layer_3_ffn_up [label="MB3 L3\nFFN Up\nGPU: P@1"]
		mb_3_layer_3_ffn_down [label="MB3 L3\nFFN Down\nGPU: P@1"]
		mb_3_layer_3_ffn_residual [label="MB3 L3\nFFN Residual\nGPU: P@1"]
		mb_3_layer_2_ffn_residual -> mb_3_layer_3_attn_norm
		mb_3_layer_3_attn_norm -> mb_3_layer_3_attn_qkv
		mb_3_layer_3_attn_qkv -> mb_3_layer_3_attn_out
		mb_3_layer_3_attn_out -> mb_3_layer_3_attn_residual
		mb_3_layer_3_attn_residual -> mb_3_layer_3_ffn_norm
		mb_3_layer_3_ffn_norm -> mb_3_layer_3_ffn_up
		mb_3_layer_3_ffn_up -> mb_3_layer_3_ffn_down
		mb_3_layer_3_ffn_down -> mb_3_layer_3_ffn_residual
		mb_3_layer_4_attn_norm [label="MB3 L4\nAttention Norm\nGPU: P@1"]
		mb_3_layer_4_attn_qkv [label="MB3 L4\nAttention QKV\nGPU: P@1"]
		mb_3_layer_4_attn_out [label="MB3 L4\nAttention Out\nGPU: P@1"]
		mb_3_layer_4_attn_residual [label="MB3 L4\nAttn Residual\nGPU: P@1"]
		mb_3_layer_4_ffn_norm [label="MB3 L4\nFFN Norm\nGPU: P@1"]
		mb_3_layer_4_ffn_up [label="MB3 L4\nFFN Up\nGPU: P@1"]
		mb_3_layer_4_ffn_down [label="MB3 L4\nFFN Down\nGPU: P@1"]
		mb_3_layer_4_ffn_residual [label="MB3 L4\nFFN Residual\nGPU: P@1"]
		mb_3_layer_3_ffn_residual -> mb_3_layer_4_attn_norm
		mb_3_layer_4_attn_norm -> mb_3_layer_4_attn_qkv
		mb_3_layer_4_attn_qkv -> mb_3_layer_4_attn_out
		mb_3_layer_4_attn_out -> mb_3_layer_4_attn_residual
		mb_3_layer_4_attn_residual -> mb_3_layer_4_ffn_norm
		mb_3_layer_4_ffn_norm -> mb_3_layer_4_ffn_up
		mb_3_layer_4_ffn_up -> mb_3_layer_4_ffn_down
		mb_3_layer_4_ffn_down -> mb_3_layer_4_ffn_residual
		mb_3_layer_5_attn_norm [label="MB3 L5\nAttention Norm\nGPU: P@1"]
		mb_3_layer_5_attn_qkv [label="MB3 L5\nAttention QKV\nGPU: P@1"]
		mb_3_layer_5_attn_out [label="MB3 L5\nAttention Out\nGPU: P@1"]
		mb_3_layer_5_attn_residual [label="MB3 L5\nAttn Residual\nGPU: P@1"]
		mb_3_layer_5_ffn_norm [label="MB3 L5\nFFN Norm\nGPU: P@1"]
		mb_3_layer_5_ffn_up [label="MB3 L5\nFFN Up\nGPU: P@1"]
		mb_3_layer_5_ffn_down [label="MB3 L5\nFFN Down\nGPU: P@1"]
		mb_3_layer_5_ffn_residual [label="MB3 L5\nFFN Residual\nGPU: P@1"]
		mb_3_layer_4_ffn_residual -> mb_3_layer_5_attn_norm
		mb_3_layer_5_attn_norm -> mb_3_layer_5_attn_qkv
		mb_3_layer_5_attn_qkv -> mb_3_layer_5_attn_out
		mb_3_layer_5_attn_out -> mb_3_layer_5_attn_residual
		mb_3_layer_5_attn_residual -> mb_3_layer_5_ffn_norm
		mb_3_layer_5_ffn_norm -> mb_3_layer_5_ffn_up
		mb_3_layer_5_ffn_up -> mb_3_layer_5_ffn_down
		mb_3_layer_5_ffn_down -> mb_3_layer_5_ffn_residual
		mb_3_stage_0_output [label="MB3\nStage 1\nOutput\nGPU: P@1"]
		mb_3_layer_5_ffn_residual -> mb_3_stage_0_output
		mb_4_embedding [label="Micro-Batch 4\nEmbedding\nInput: [batch_size=1, seq_len=2048]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nGPU: P@1"]
		mb_4_layer_1_attn_norm [label="MB4 L1\nAttention Norm\nGPU: P@1"]
		mb_4_layer_1_attn_qkv [label="MB4 L1\nAttention QKV\nGPU: P@1"]
		mb_4_layer_1_attn_out [label="MB4 L1\nAttention Out\nGPU: P@1"]
		mb_4_layer_1_attn_residual [label="MB4 L1\nAttn Residual\nGPU: P@1"]
		mb_4_layer_1_ffn_norm [label="MB4 L1\nFFN Norm\nGPU: P@1"]
		mb_4_layer_1_ffn_up [label="MB4 L1\nFFN Up\nGPU: P@1"]
		mb_4_layer_1_ffn_down [label="MB4 L1\nFFN Down\nGPU: P@1"]
		mb_4_layer_1_ffn_residual [label="MB4 L1\nFFN Residual\nGPU: P@1"]
		mb_4_embedding -> mb_4_layer_1_attn_norm
		mb_4_layer_1_attn_norm -> mb_4_layer_1_attn_qkv
		mb_4_layer_1_attn_qkv -> mb_4_layer_1_attn_out
		mb_4_layer_1_attn_out -> mb_4_layer_1_attn_residual
		mb_4_layer_1_attn_residual -> mb_4_layer_1_ffn_norm
		mb_4_layer_1_ffn_norm -> mb_4_layer_1_ffn_up
		mb_4_layer_1_ffn_up -> mb_4_layer_1_ffn_down
		mb_4_layer_1_ffn_down -> mb_4_layer_1_ffn_residual
		mb_4_layer_2_attn_norm [label="MB4 L2\nAttention Norm\nGPU: P@1"]
		mb_4_layer_2_attn_qkv [label="MB4 L2\nAttention QKV\nGPU: P@1"]
		mb_4_layer_2_attn_out [label="MB4 L2\nAttention Out\nGPU: P@1"]
		mb_4_layer_2_attn_residual [label="MB4 L2\nAttn Residual\nGPU: P@1"]
		mb_4_layer_2_ffn_norm [label="MB4 L2\nFFN Norm\nGPU: P@1"]
		mb_4_layer_2_ffn_up [label="MB4 L2\nFFN Up\nGPU: P@1"]
		mb_4_layer_2_ffn_down [label="MB4 L2\nFFN Down\nGPU: P@1"]
		mb_4_layer_2_ffn_residual [label="MB4 L2\nFFN Residual\nGPU: P@1"]
		mb_4_layer_1_ffn_residual -> mb_4_layer_2_attn_norm
		mb_4_layer_2_attn_norm -> mb_4_layer_2_attn_qkv
		mb_4_layer_2_attn_qkv -> mb_4_layer_2_attn_out
		mb_4_layer_2_attn_out -> mb_4_layer_2_attn_residual
		mb_4_layer_2_attn_residual -> mb_4_layer_2_ffn_norm
		mb_4_layer_2_ffn_norm -> mb_4_layer_2_ffn_up
		mb_4_layer_2_ffn_up -> mb_4_layer_2_ffn_down
		mb_4_layer_2_ffn_down -> mb_4_layer_2_ffn_residual
		mb_4_layer_3_attn_norm [label="MB4 L3\nAttention Norm\nGPU: P@1"]
		mb_4_layer_3_attn_qkv [label="MB4 L3\nAttention QKV\nGPU: P@1"]
		mb_4_layer_3_attn_out [label="MB4 L3\nAttention Out\nGPU: P@1"]
		mb_4_layer_3_attn_residual [label="MB4 L3\nAttn Residual\nGPU: P@1"]
		mb_4_layer_3_ffn_norm [label="MB4 L3\nFFN Norm\nGPU: P@1"]
		mb_4_layer_3_ffn_up [label="MB4 L3\nFFN Up\nGPU: P@1"]
		mb_4_layer_3_ffn_down [label="MB4 L3\nFFN Down\nGPU: P@1"]
		mb_4_layer_3_ffn_residual [label="MB4 L3\nFFN Residual\nGPU: P@1"]
		mb_4_layer_2_ffn_residual -> mb_4_layer_3_attn_norm
		mb_4_layer_3_attn_norm -> mb_4_layer_3_attn_qkv
		mb_4_layer_3_attn_qkv -> mb_4_layer_3_attn_out
		mb_4_layer_3_attn_out -> mb_4_layer_3_attn_residual
		mb_4_layer_3_attn_residual -> mb_4_layer_3_ffn_norm
		mb_4_layer_3_ffn_norm -> mb_4_layer_3_ffn_up
		mb_4_layer_3_ffn_up -> mb_4_layer_3_ffn_down
		mb_4_layer_3_ffn_down -> mb_4_layer_3_ffn_residual
		mb_4_layer_4_attn_norm [label="MB4 L4\nAttention Norm\nGPU: P@1"]
		mb_4_layer_4_attn_qkv [label="MB4 L4\nAttention QKV\nGPU: P@1"]
		mb_4_layer_4_attn_out [label="MB4 L4\nAttention Out\nGPU: P@1"]
		mb_4_layer_4_attn_residual [label="MB4 L4\nAttn Residual\nGPU: P@1"]
		mb_4_layer_4_ffn_norm [label="MB4 L4\nFFN Norm\nGPU: P@1"]
		mb_4_layer_4_ffn_up [label="MB4 L4\nFFN Up\nGPU: P@1"]
		mb_4_layer_4_ffn_down [label="MB4 L4\nFFN Down\nGPU: P@1"]
		mb_4_layer_4_ffn_residual [label="MB4 L4\nFFN Residual\nGPU: P@1"]
		mb_4_layer_3_ffn_residual -> mb_4_layer_4_attn_norm
		mb_4_layer_4_attn_norm -> mb_4_layer_4_attn_qkv
		mb_4_layer_4_attn_qkv -> mb_4_layer_4_attn_out
		mb_4_layer_4_attn_out -> mb_4_layer_4_attn_residual
		mb_4_layer_4_attn_residual -> mb_4_layer_4_ffn_norm
		mb_4_layer_4_ffn_norm -> mb_4_layer_4_ffn_up
		mb_4_layer_4_ffn_up -> mb_4_layer_4_ffn_down
		mb_4_layer_4_ffn_down -> mb_4_layer_4_ffn_residual
		mb_4_layer_5_attn_norm [label="MB4 L5\nAttention Norm\nGPU: P@1"]
		mb_4_layer_5_attn_qkv [label="MB4 L5\nAttention QKV\nGPU: P@1"]
		mb_4_layer_5_attn_out [label="MB4 L5\nAttention Out\nGPU: P@1"]
		mb_4_layer_5_attn_residual [label="MB4 L5\nAttn Residual\nGPU: P@1"]
		mb_4_layer_5_ffn_norm [label="MB4 L5\nFFN Norm\nGPU: P@1"]
		mb_4_layer_5_ffn_up [label="MB4 L5\nFFN Up\nGPU: P@1"]
		mb_4_layer_5_ffn_down [label="MB4 L5\nFFN Down\nGPU: P@1"]
		mb_4_layer_5_ffn_residual [label="MB4 L5\nFFN Residual\nGPU: P@1"]
		mb_4_layer_4_ffn_residual -> mb_4_layer_5_attn_norm
		mb_4_layer_5_attn_norm -> mb_4_layer_5_attn_qkv
		mb_4_layer_5_attn_qkv -> mb_4_layer_5_attn_out
		mb_4_layer_5_attn_out -> mb_4_layer_5_attn_residual
		mb_4_layer_5_attn_residual -> mb_4_layer_5_ffn_norm
		mb_4_layer_5_ffn_norm -> mb_4_layer_5_ffn_up
		mb_4_layer_5_ffn_up -> mb_4_layer_5_ffn_down
		mb_4_layer_5_ffn_down -> mb_4_layer_5_ffn_residual
		mb_4_stage_0_output [label="MB4\nStage 1\nOutput\nGPU: P@1"]
		mb_4_layer_5_ffn_residual -> mb_4_stage_0_output
		mb_5_embedding [label="Micro-Batch 5\nEmbedding\nInput: [batch_size=1, seq_len=2048]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nGPU: P@1"]
		mb_5_layer_1_attn_norm [label="MB5 L1\nAttention Norm\nGPU: P@1"]
		mb_5_layer_1_attn_qkv [label="MB5 L1\nAttention QKV\nGPU: P@1"]
		mb_5_layer_1_attn_out [label="MB5 L1\nAttention Out\nGPU: P@1"]
		mb_5_layer_1_attn_residual [label="MB5 L1\nAttn Residual\nGPU: P@1"]
		mb_5_layer_1_ffn_norm [label="MB5 L1\nFFN Norm\nGPU: P@1"]
		mb_5_layer_1_ffn_up [label="MB5 L1\nFFN Up\nGPU: P@1"]
		mb_5_layer_1_ffn_down [label="MB5 L1\nFFN Down\nGPU: P@1"]
		mb_5_layer_1_ffn_residual [label="MB5 L1\nFFN Residual\nGPU: P@1"]
		mb_5_embedding -> mb_5_layer_1_attn_norm
		mb_5_layer_1_attn_norm -> mb_5_layer_1_attn_qkv
		mb_5_layer_1_attn_qkv -> mb_5_layer_1_attn_out
		mb_5_layer_1_attn_out -> mb_5_layer_1_attn_residual
		mb_5_layer_1_attn_residual -> mb_5_layer_1_ffn_norm
		mb_5_layer_1_ffn_norm -> mb_5_layer_1_ffn_up
		mb_5_layer_1_ffn_up -> mb_5_layer_1_ffn_down
		mb_5_layer_1_ffn_down -> mb_5_layer_1_ffn_residual
		mb_5_layer_2_attn_norm [label="MB5 L2\nAttention Norm\nGPU: P@1"]
		mb_5_layer_2_attn_qkv [label="MB5 L2\nAttention QKV\nGPU: P@1"]
		mb_5_layer_2_attn_out [label="MB5 L2\nAttention Out\nGPU: P@1"]
		mb_5_layer_2_attn_residual [label="MB5 L2\nAttn Residual\nGPU: P@1"]
		mb_5_layer_2_ffn_norm [label="MB5 L2\nFFN Norm\nGPU: P@1"]
		mb_5_layer_2_ffn_up [label="MB5 L2\nFFN Up\nGPU: P@1"]
		mb_5_layer_2_ffn_down [label="MB5 L2\nFFN Down\nGPU: P@1"]
		mb_5_layer_2_ffn_residual [label="MB5 L2\nFFN Residual\nGPU: P@1"]
		mb_5_layer_1_ffn_residual -> mb_5_layer_2_attn_norm
		mb_5_layer_2_attn_norm -> mb_5_layer_2_attn_qkv
		mb_5_layer_2_attn_qkv -> mb_5_layer_2_attn_out
		mb_5_layer_2_attn_out -> mb_5_layer_2_attn_residual
		mb_5_layer_2_attn_residual -> mb_5_layer_2_ffn_norm
		mb_5_layer_2_ffn_norm -> mb_5_layer_2_ffn_up
		mb_5_layer_2_ffn_up -> mb_5_layer_2_ffn_down
		mb_5_layer_2_ffn_down -> mb_5_layer_2_ffn_residual
		mb_5_layer_3_attn_norm [label="MB5 L3\nAttention Norm\nGPU: P@1"]
		mb_5_layer_3_attn_qkv [label="MB5 L3\nAttention QKV\nGPU: P@1"]
		mb_5_layer_3_attn_out [label="MB5 L3\nAttention Out\nGPU: P@1"]
		mb_5_layer_3_attn_residual [label="MB5 L3\nAttn Residual\nGPU: P@1"]
		mb_5_layer_3_ffn_norm [label="MB5 L3\nFFN Norm\nGPU: P@1"]
		mb_5_layer_3_ffn_up [label="MB5 L3\nFFN Up\nGPU: P@1"]
		mb_5_layer_3_ffn_down [label="MB5 L3\nFFN Down\nGPU: P@1"]
		mb_5_layer_3_ffn_residual [label="MB5 L3\nFFN Residual\nGPU: P@1"]
		mb_5_layer_2_ffn_residual -> mb_5_layer_3_attn_norm
		mb_5_layer_3_attn_norm -> mb_5_layer_3_attn_qkv
		mb_5_layer_3_attn_qkv -> mb_5_layer_3_attn_out
		mb_5_layer_3_attn_out -> mb_5_layer_3_attn_residual
		mb_5_layer_3_attn_residual -> mb_5_layer_3_ffn_norm
		mb_5_layer_3_ffn_norm -> mb_5_layer_3_ffn_up
		mb_5_layer_3_ffn_up -> mb_5_layer_3_ffn_down
		mb_5_layer_3_ffn_down -> mb_5_layer_3_ffn_residual
		mb_5_layer_4_attn_norm [label="MB5 L4\nAttention Norm\nGPU: P@1"]
		mb_5_layer_4_attn_qkv [label="MB5 L4\nAttention QKV\nGPU: P@1"]
		mb_5_layer_4_attn_out [label="MB5 L4\nAttention Out\nGPU: P@1"]
		mb_5_layer_4_attn_residual [label="MB5 L4\nAttn Residual\nGPU: P@1"]
		mb_5_layer_4_ffn_norm [label="MB5 L4\nFFN Norm\nGPU: P@1"]
		mb_5_layer_4_ffn_up [label="MB5 L4\nFFN Up\nGPU: P@1"]
		mb_5_layer_4_ffn_down [label="MB5 L4\nFFN Down\nGPU: P@1"]
		mb_5_layer_4_ffn_residual [label="MB5 L4\nFFN Residual\nGPU: P@1"]
		mb_5_layer_3_ffn_residual -> mb_5_layer_4_attn_norm
		mb_5_layer_4_attn_norm -> mb_5_layer_4_attn_qkv
		mb_5_layer_4_attn_qkv -> mb_5_layer_4_attn_out
		mb_5_layer_4_attn_out -> mb_5_layer_4_attn_residual
		mb_5_layer_4_attn_residual -> mb_5_layer_4_ffn_norm
		mb_5_layer_4_ffn_norm -> mb_5_layer_4_ffn_up
		mb_5_layer_4_ffn_up -> mb_5_layer_4_ffn_down
		mb_5_layer_4_ffn_down -> mb_5_layer_4_ffn_residual
		mb_5_layer_5_attn_norm [label="MB5 L5\nAttention Norm\nGPU: P@1"]
		mb_5_layer_5_attn_qkv [label="MB5 L5\nAttention QKV\nGPU: P@1"]
		mb_5_layer_5_attn_out [label="MB5 L5\nAttention Out\nGPU: P@1"]
		mb_5_layer_5_attn_residual [label="MB5 L5\nAttn Residual\nGPU: P@1"]
		mb_5_layer_5_ffn_norm [label="MB5 L5\nFFN Norm\nGPU: P@1"]
		mb_5_layer_5_ffn_up [label="MB5 L5\nFFN Up\nGPU: P@1"]
		mb_5_layer_5_ffn_down [label="MB5 L5\nFFN Down\nGPU: P@1"]
		mb_5_layer_5_ffn_residual [label="MB5 L5\nFFN Residual\nGPU: P@1"]
		mb_5_layer_4_ffn_residual -> mb_5_layer_5_attn_norm
		mb_5_layer_5_attn_norm -> mb_5_layer_5_attn_qkv
		mb_5_layer_5_attn_qkv -> mb_5_layer_5_attn_out
		mb_5_layer_5_attn_out -> mb_5_layer_5_attn_residual
		mb_5_layer_5_attn_residual -> mb_5_layer_5_ffn_norm
		mb_5_layer_5_ffn_norm -> mb_5_layer_5_ffn_up
		mb_5_layer_5_ffn_up -> mb_5_layer_5_ffn_down
		mb_5_layer_5_ffn_down -> mb_5_layer_5_ffn_residual
		mb_5_stage_0_output [label="MB5\nStage 1\nOutput\nGPU: P@1"]
		mb_5_layer_5_ffn_residual -> mb_5_stage_0_output
	}
	mb_0_stage_0_output -> mb_0_comm_stage_0
	mb_1_stage_0_output -> mb_1_comm_stage_0
	mb_2_stage_0_output -> mb_2_comm_stage_0
	mb_3_stage_0_output -> mb_3_comm_stage_0
	mb_4_stage_0_output -> mb_4_comm_stage_0
	mb_5_stage_0_output -> mb_5_comm_stage_0
	subgraph cluster_stage_1 {
		label="Stage 2\nP@2\nLayers 6-10" style=dashed
		mb_0_comm_stage_0 [label="Micro-Batch 0\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@1 To: P@2" fillcolor=lightyellow shape=parallelogram]
		mb_0_layer_6_attn_norm [label="MB0 L6\nAttention Norm\nGPU: P@2"]
		mb_0_layer_6_attn_qkv [label="MB0 L6\nAttention QKV\nGPU: P@2"]
		mb_0_layer_6_attn_out [label="MB0 L6\nAttention Out\nGPU: P@2"]
		mb_0_layer_6_attn_residual [label="MB0 L6\nAttn Residual\nGPU: P@2"]
		mb_0_layer_6_ffn_norm [label="MB0 L6\nFFN Norm\nGPU: P@2"]
		mb_0_layer_6_ffn_up [label="MB0 L6\nFFN Up\nGPU: P@2"]
		mb_0_layer_6_ffn_down [label="MB0 L6\nFFN Down\nGPU: P@2"]
		mb_0_layer_6_ffn_residual [label="MB0 L6\nFFN Residual\nGPU: P@2"]
		mb_0_comm_stage_0 -> mb_0_layer_6_attn_norm
		mb_0_layer_6_attn_norm -> mb_0_layer_6_attn_qkv
		mb_0_layer_6_attn_qkv -> mb_0_layer_6_attn_out
		mb_0_layer_6_attn_out -> mb_0_layer_6_attn_residual
		mb_0_layer_6_attn_residual -> mb_0_layer_6_ffn_norm
		mb_0_layer_6_ffn_norm -> mb_0_layer_6_ffn_up
		mb_0_layer_6_ffn_up -> mb_0_layer_6_ffn_down
		mb_0_layer_6_ffn_down -> mb_0_layer_6_ffn_residual
		mb_0_layer_7_attn_norm [label="MB0 L7\nAttention Norm\nGPU: P@2"]
		mb_0_layer_7_attn_qkv [label="MB0 L7\nAttention QKV\nGPU: P@2"]
		mb_0_layer_7_attn_out [label="MB0 L7\nAttention Out\nGPU: P@2"]
		mb_0_layer_7_attn_residual [label="MB0 L7\nAttn Residual\nGPU: P@2"]
		mb_0_layer_7_ffn_norm [label="MB0 L7\nFFN Norm\nGPU: P@2"]
		mb_0_layer_7_ffn_up [label="MB0 L7\nFFN Up\nGPU: P@2"]
		mb_0_layer_7_ffn_down [label="MB0 L7\nFFN Down\nGPU: P@2"]
		mb_0_layer_7_ffn_residual [label="MB0 L7\nFFN Residual\nGPU: P@2"]
		mb_0_layer_6_ffn_residual -> mb_0_layer_7_attn_norm
		mb_0_layer_7_attn_norm -> mb_0_layer_7_attn_qkv
		mb_0_layer_7_attn_qkv -> mb_0_layer_7_attn_out
		mb_0_layer_7_attn_out -> mb_0_layer_7_attn_residual
		mb_0_layer_7_attn_residual -> mb_0_layer_7_ffn_norm
		mb_0_layer_7_ffn_norm -> mb_0_layer_7_ffn_up
		mb_0_layer_7_ffn_up -> mb_0_layer_7_ffn_down
		mb_0_layer_7_ffn_down -> mb_0_layer_7_ffn_residual
		mb_0_layer_8_attn_norm [label="MB0 L8\nAttention Norm\nGPU: P@2"]
		mb_0_layer_8_attn_qkv [label="MB0 L8\nAttention QKV\nGPU: P@2"]
		mb_0_layer_8_attn_out [label="MB0 L8\nAttention Out\nGPU: P@2"]
		mb_0_layer_8_attn_residual [label="MB0 L8\nAttn Residual\nGPU: P@2"]
		mb_0_layer_8_ffn_norm [label="MB0 L8\nFFN Norm\nGPU: P@2"]
		mb_0_layer_8_ffn_up [label="MB0 L8\nFFN Up\nGPU: P@2"]
		mb_0_layer_8_ffn_down [label="MB0 L8\nFFN Down\nGPU: P@2"]
		mb_0_layer_8_ffn_residual [label="MB0 L8\nFFN Residual\nGPU: P@2"]
		mb_0_layer_7_ffn_residual -> mb_0_layer_8_attn_norm
		mb_0_layer_8_attn_norm -> mb_0_layer_8_attn_qkv
		mb_0_layer_8_attn_qkv -> mb_0_layer_8_attn_out
		mb_0_layer_8_attn_out -> mb_0_layer_8_attn_residual
		mb_0_layer_8_attn_residual -> mb_0_layer_8_ffn_norm
		mb_0_layer_8_ffn_norm -> mb_0_layer_8_ffn_up
		mb_0_layer_8_ffn_up -> mb_0_layer_8_ffn_down
		mb_0_layer_8_ffn_down -> mb_0_layer_8_ffn_residual
		mb_0_layer_9_attn_norm [label="MB0 L9\nAttention Norm\nGPU: P@2"]
		mb_0_layer_9_attn_qkv [label="MB0 L9\nAttention QKV\nGPU: P@2"]
		mb_0_layer_9_attn_out [label="MB0 L9\nAttention Out\nGPU: P@2"]
		mb_0_layer_9_attn_residual [label="MB0 L9\nAttn Residual\nGPU: P@2"]
		mb_0_layer_9_ffn_norm [label="MB0 L9\nFFN Norm\nGPU: P@2"]
		mb_0_layer_9_ffn_up [label="MB0 L9\nFFN Up\nGPU: P@2"]
		mb_0_layer_9_ffn_down [label="MB0 L9\nFFN Down\nGPU: P@2"]
		mb_0_layer_9_ffn_residual [label="MB0 L9\nFFN Residual\nGPU: P@2"]
		mb_0_layer_8_ffn_residual -> mb_0_layer_9_attn_norm
		mb_0_layer_9_attn_norm -> mb_0_layer_9_attn_qkv
		mb_0_layer_9_attn_qkv -> mb_0_layer_9_attn_out
		mb_0_layer_9_attn_out -> mb_0_layer_9_attn_residual
		mb_0_layer_9_attn_residual -> mb_0_layer_9_ffn_norm
		mb_0_layer_9_ffn_norm -> mb_0_layer_9_ffn_up
		mb_0_layer_9_ffn_up -> mb_0_layer_9_ffn_down
		mb_0_layer_9_ffn_down -> mb_0_layer_9_ffn_residual
		mb_0_layer_10_attn_norm [label="MB0 L10\nAttention Norm\nGPU: P@2"]
		mb_0_layer_10_attn_qkv [label="MB0 L10\nAttention QKV\nGPU: P@2"]
		mb_0_layer_10_attn_out [label="MB0 L10\nAttention Out\nGPU: P@2"]
		mb_0_layer_10_attn_residual [label="MB0 L10\nAttn Residual\nGPU: P@2"]
		mb_0_layer_10_ffn_norm [label="MB0 L10\nFFN Norm\nGPU: P@2"]
		mb_0_layer_10_ffn_up [label="MB0 L10\nFFN Up\nGPU: P@2"]
		mb_0_layer_10_ffn_down [label="MB0 L10\nFFN Down\nGPU: P@2"]
		mb_0_layer_10_ffn_residual [label="MB0 L10\nFFN Residual\nGPU: P@2"]
		mb_0_layer_9_ffn_residual -> mb_0_layer_10_attn_norm
		mb_0_layer_10_attn_norm -> mb_0_layer_10_attn_qkv
		mb_0_layer_10_attn_qkv -> mb_0_layer_10_attn_out
		mb_0_layer_10_attn_out -> mb_0_layer_10_attn_residual
		mb_0_layer_10_attn_residual -> mb_0_layer_10_ffn_norm
		mb_0_layer_10_ffn_norm -> mb_0_layer_10_ffn_up
		mb_0_layer_10_ffn_up -> mb_0_layer_10_ffn_down
		mb_0_layer_10_ffn_down -> mb_0_layer_10_ffn_residual
		mb_0_stage_1_output [label="MB0\nStage 2\nOutput\nGPU: P@2"]
		mb_0_layer_10_ffn_residual -> mb_0_stage_1_output
		mb_1_comm_stage_0 [label="Micro-Batch 1\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@1 To: P@2" fillcolor=lightyellow shape=parallelogram]
		mb_1_layer_6_attn_norm [label="MB1 L6\nAttention Norm\nGPU: P@2"]
		mb_1_layer_6_attn_qkv [label="MB1 L6\nAttention QKV\nGPU: P@2"]
		mb_1_layer_6_attn_out [label="MB1 L6\nAttention Out\nGPU: P@2"]
		mb_1_layer_6_attn_residual [label="MB1 L6\nAttn Residual\nGPU: P@2"]
		mb_1_layer_6_ffn_norm [label="MB1 L6\nFFN Norm\nGPU: P@2"]
		mb_1_layer_6_ffn_up [label="MB1 L6\nFFN Up\nGPU: P@2"]
		mb_1_layer_6_ffn_down [label="MB1 L6\nFFN Down\nGPU: P@2"]
		mb_1_layer_6_ffn_residual [label="MB1 L6\nFFN Residual\nGPU: P@2"]
		mb_1_comm_stage_0 -> mb_1_layer_6_attn_norm
		mb_1_layer_6_attn_norm -> mb_1_layer_6_attn_qkv
		mb_1_layer_6_attn_qkv -> mb_1_layer_6_attn_out
		mb_1_layer_6_attn_out -> mb_1_layer_6_attn_residual
		mb_1_layer_6_attn_residual -> mb_1_layer_6_ffn_norm
		mb_1_layer_6_ffn_norm -> mb_1_layer_6_ffn_up
		mb_1_layer_6_ffn_up -> mb_1_layer_6_ffn_down
		mb_1_layer_6_ffn_down -> mb_1_layer_6_ffn_residual
		mb_1_layer_7_attn_norm [label="MB1 L7\nAttention Norm\nGPU: P@2"]
		mb_1_layer_7_attn_qkv [label="MB1 L7\nAttention QKV\nGPU: P@2"]
		mb_1_layer_7_attn_out [label="MB1 L7\nAttention Out\nGPU: P@2"]
		mb_1_layer_7_attn_residual [label="MB1 L7\nAttn Residual\nGPU: P@2"]
		mb_1_layer_7_ffn_norm [label="MB1 L7\nFFN Norm\nGPU: P@2"]
		mb_1_layer_7_ffn_up [label="MB1 L7\nFFN Up\nGPU: P@2"]
		mb_1_layer_7_ffn_down [label="MB1 L7\nFFN Down\nGPU: P@2"]
		mb_1_layer_7_ffn_residual [label="MB1 L7\nFFN Residual\nGPU: P@2"]
		mb_1_layer_6_ffn_residual -> mb_1_layer_7_attn_norm
		mb_1_layer_7_attn_norm -> mb_1_layer_7_attn_qkv
		mb_1_layer_7_attn_qkv -> mb_1_layer_7_attn_out
		mb_1_layer_7_attn_out -> mb_1_layer_7_attn_residual
		mb_1_layer_7_attn_residual -> mb_1_layer_7_ffn_norm
		mb_1_layer_7_ffn_norm -> mb_1_layer_7_ffn_up
		mb_1_layer_7_ffn_up -> mb_1_layer_7_ffn_down
		mb_1_layer_7_ffn_down -> mb_1_layer_7_ffn_residual
		mb_1_layer_8_attn_norm [label="MB1 L8\nAttention Norm\nGPU: P@2"]
		mb_1_layer_8_attn_qkv [label="MB1 L8\nAttention QKV\nGPU: P@2"]
		mb_1_layer_8_attn_out [label="MB1 L8\nAttention Out\nGPU: P@2"]
		mb_1_layer_8_attn_residual [label="MB1 L8\nAttn Residual\nGPU: P@2"]
		mb_1_layer_8_ffn_norm [label="MB1 L8\nFFN Norm\nGPU: P@2"]
		mb_1_layer_8_ffn_up [label="MB1 L8\nFFN Up\nGPU: P@2"]
		mb_1_layer_8_ffn_down [label="MB1 L8\nFFN Down\nGPU: P@2"]
		mb_1_layer_8_ffn_residual [label="MB1 L8\nFFN Residual\nGPU: P@2"]
		mb_1_layer_7_ffn_residual -> mb_1_layer_8_attn_norm
		mb_1_layer_8_attn_norm -> mb_1_layer_8_attn_qkv
		mb_1_layer_8_attn_qkv -> mb_1_layer_8_attn_out
		mb_1_layer_8_attn_out -> mb_1_layer_8_attn_residual
		mb_1_layer_8_attn_residual -> mb_1_layer_8_ffn_norm
		mb_1_layer_8_ffn_norm -> mb_1_layer_8_ffn_up
		mb_1_layer_8_ffn_up -> mb_1_layer_8_ffn_down
		mb_1_layer_8_ffn_down -> mb_1_layer_8_ffn_residual
		mb_1_layer_9_attn_norm [label="MB1 L9\nAttention Norm\nGPU: P@2"]
		mb_1_layer_9_attn_qkv [label="MB1 L9\nAttention QKV\nGPU: P@2"]
		mb_1_layer_9_attn_out [label="MB1 L9\nAttention Out\nGPU: P@2"]
		mb_1_layer_9_attn_residual [label="MB1 L9\nAttn Residual\nGPU: P@2"]
		mb_1_layer_9_ffn_norm [label="MB1 L9\nFFN Norm\nGPU: P@2"]
		mb_1_layer_9_ffn_up [label="MB1 L9\nFFN Up\nGPU: P@2"]
		mb_1_layer_9_ffn_down [label="MB1 L9\nFFN Down\nGPU: P@2"]
		mb_1_layer_9_ffn_residual [label="MB1 L9\nFFN Residual\nGPU: P@2"]
		mb_1_layer_8_ffn_residual -> mb_1_layer_9_attn_norm
		mb_1_layer_9_attn_norm -> mb_1_layer_9_attn_qkv
		mb_1_layer_9_attn_qkv -> mb_1_layer_9_attn_out
		mb_1_layer_9_attn_out -> mb_1_layer_9_attn_residual
		mb_1_layer_9_attn_residual -> mb_1_layer_9_ffn_norm
		mb_1_layer_9_ffn_norm -> mb_1_layer_9_ffn_up
		mb_1_layer_9_ffn_up -> mb_1_layer_9_ffn_down
		mb_1_layer_9_ffn_down -> mb_1_layer_9_ffn_residual
		mb_1_layer_10_attn_norm [label="MB1 L10\nAttention Norm\nGPU: P@2"]
		mb_1_layer_10_attn_qkv [label="MB1 L10\nAttention QKV\nGPU: P@2"]
		mb_1_layer_10_attn_out [label="MB1 L10\nAttention Out\nGPU: P@2"]
		mb_1_layer_10_attn_residual [label="MB1 L10\nAttn Residual\nGPU: P@2"]
		mb_1_layer_10_ffn_norm [label="MB1 L10\nFFN Norm\nGPU: P@2"]
		mb_1_layer_10_ffn_up [label="MB1 L10\nFFN Up\nGPU: P@2"]
		mb_1_layer_10_ffn_down [label="MB1 L10\nFFN Down\nGPU: P@2"]
		mb_1_layer_10_ffn_residual [label="MB1 L10\nFFN Residual\nGPU: P@2"]
		mb_1_layer_9_ffn_residual -> mb_1_layer_10_attn_norm
		mb_1_layer_10_attn_norm -> mb_1_layer_10_attn_qkv
		mb_1_layer_10_attn_qkv -> mb_1_layer_10_attn_out
		mb_1_layer_10_attn_out -> mb_1_layer_10_attn_residual
		mb_1_layer_10_attn_residual -> mb_1_layer_10_ffn_norm
		mb_1_layer_10_ffn_norm -> mb_1_layer_10_ffn_up
		mb_1_layer_10_ffn_up -> mb_1_layer_10_ffn_down
		mb_1_layer_10_ffn_down -> mb_1_layer_10_ffn_residual
		mb_1_stage_1_output [label="MB1\nStage 2\nOutput\nGPU: P@2"]
		mb_1_layer_10_ffn_residual -> mb_1_stage_1_output
		mb_2_comm_stage_0 [label="Micro-Batch 2\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@1 To: P@2" fillcolor=lightyellow shape=parallelogram]
		mb_2_layer_6_attn_norm [label="MB2 L6\nAttention Norm\nGPU: P@2"]
		mb_2_layer_6_attn_qkv [label="MB2 L6\nAttention QKV\nGPU: P@2"]
		mb_2_layer_6_attn_out [label="MB2 L6\nAttention Out\nGPU: P@2"]
		mb_2_layer_6_attn_residual [label="MB2 L6\nAttn Residual\nGPU: P@2"]
		mb_2_layer_6_ffn_norm [label="MB2 L6\nFFN Norm\nGPU: P@2"]
		mb_2_layer_6_ffn_up [label="MB2 L6\nFFN Up\nGPU: P@2"]
		mb_2_layer_6_ffn_down [label="MB2 L6\nFFN Down\nGPU: P@2"]
		mb_2_layer_6_ffn_residual [label="MB2 L6\nFFN Residual\nGPU: P@2"]
		mb_2_comm_stage_0 -> mb_2_layer_6_attn_norm
		mb_2_layer_6_attn_norm -> mb_2_layer_6_attn_qkv
		mb_2_layer_6_attn_qkv -> mb_2_layer_6_attn_out
		mb_2_layer_6_attn_out -> mb_2_layer_6_attn_residual
		mb_2_layer_6_attn_residual -> mb_2_layer_6_ffn_norm
		mb_2_layer_6_ffn_norm -> mb_2_layer_6_ffn_up
		mb_2_layer_6_ffn_up -> mb_2_layer_6_ffn_down
		mb_2_layer_6_ffn_down -> mb_2_layer_6_ffn_residual
		mb_2_layer_7_attn_norm [label="MB2 L7\nAttention Norm\nGPU: P@2"]
		mb_2_layer_7_attn_qkv [label="MB2 L7\nAttention QKV\nGPU: P@2"]
		mb_2_layer_7_attn_out [label="MB2 L7\nAttention Out\nGPU: P@2"]
		mb_2_layer_7_attn_residual [label="MB2 L7\nAttn Residual\nGPU: P@2"]
		mb_2_layer_7_ffn_norm [label="MB2 L7\nFFN Norm\nGPU: P@2"]
		mb_2_layer_7_ffn_up [label="MB2 L7\nFFN Up\nGPU: P@2"]
		mb_2_layer_7_ffn_down [label="MB2 L7\nFFN Down\nGPU: P@2"]
		mb_2_layer_7_ffn_residual [label="MB2 L7\nFFN Residual\nGPU: P@2"]
		mb_2_layer_6_ffn_residual -> mb_2_layer_7_attn_norm
		mb_2_layer_7_attn_norm -> mb_2_layer_7_attn_qkv
		mb_2_layer_7_attn_qkv -> mb_2_layer_7_attn_out
		mb_2_layer_7_attn_out -> mb_2_layer_7_attn_residual
		mb_2_layer_7_attn_residual -> mb_2_layer_7_ffn_norm
		mb_2_layer_7_ffn_norm -> mb_2_layer_7_ffn_up
		mb_2_layer_7_ffn_up -> mb_2_layer_7_ffn_down
		mb_2_layer_7_ffn_down -> mb_2_layer_7_ffn_residual
		mb_2_layer_8_attn_norm [label="MB2 L8\nAttention Norm\nGPU: P@2"]
		mb_2_layer_8_attn_qkv [label="MB2 L8\nAttention QKV\nGPU: P@2"]
		mb_2_layer_8_attn_out [label="MB2 L8\nAttention Out\nGPU: P@2"]
		mb_2_layer_8_attn_residual [label="MB2 L8\nAttn Residual\nGPU: P@2"]
		mb_2_layer_8_ffn_norm [label="MB2 L8\nFFN Norm\nGPU: P@2"]
		mb_2_layer_8_ffn_up [label="MB2 L8\nFFN Up\nGPU: P@2"]
		mb_2_layer_8_ffn_down [label="MB2 L8\nFFN Down\nGPU: P@2"]
		mb_2_layer_8_ffn_residual [label="MB2 L8\nFFN Residual\nGPU: P@2"]
		mb_2_layer_7_ffn_residual -> mb_2_layer_8_attn_norm
		mb_2_layer_8_attn_norm -> mb_2_layer_8_attn_qkv
		mb_2_layer_8_attn_qkv -> mb_2_layer_8_attn_out
		mb_2_layer_8_attn_out -> mb_2_layer_8_attn_residual
		mb_2_layer_8_attn_residual -> mb_2_layer_8_ffn_norm
		mb_2_layer_8_ffn_norm -> mb_2_layer_8_ffn_up
		mb_2_layer_8_ffn_up -> mb_2_layer_8_ffn_down
		mb_2_layer_8_ffn_down -> mb_2_layer_8_ffn_residual
		mb_2_layer_9_attn_norm [label="MB2 L9\nAttention Norm\nGPU: P@2"]
		mb_2_layer_9_attn_qkv [label="MB2 L9\nAttention QKV\nGPU: P@2"]
		mb_2_layer_9_attn_out [label="MB2 L9\nAttention Out\nGPU: P@2"]
		mb_2_layer_9_attn_residual [label="MB2 L9\nAttn Residual\nGPU: P@2"]
		mb_2_layer_9_ffn_norm [label="MB2 L9\nFFN Norm\nGPU: P@2"]
		mb_2_layer_9_ffn_up [label="MB2 L9\nFFN Up\nGPU: P@2"]
		mb_2_layer_9_ffn_down [label="MB2 L9\nFFN Down\nGPU: P@2"]
		mb_2_layer_9_ffn_residual [label="MB2 L9\nFFN Residual\nGPU: P@2"]
		mb_2_layer_8_ffn_residual -> mb_2_layer_9_attn_norm
		mb_2_layer_9_attn_norm -> mb_2_layer_9_attn_qkv
		mb_2_layer_9_attn_qkv -> mb_2_layer_9_attn_out
		mb_2_layer_9_attn_out -> mb_2_layer_9_attn_residual
		mb_2_layer_9_attn_residual -> mb_2_layer_9_ffn_norm
		mb_2_layer_9_ffn_norm -> mb_2_layer_9_ffn_up
		mb_2_layer_9_ffn_up -> mb_2_layer_9_ffn_down
		mb_2_layer_9_ffn_down -> mb_2_layer_9_ffn_residual
		mb_2_layer_10_attn_norm [label="MB2 L10\nAttention Norm\nGPU: P@2"]
		mb_2_layer_10_attn_qkv [label="MB2 L10\nAttention QKV\nGPU: P@2"]
		mb_2_layer_10_attn_out [label="MB2 L10\nAttention Out\nGPU: P@2"]
		mb_2_layer_10_attn_residual [label="MB2 L10\nAttn Residual\nGPU: P@2"]
		mb_2_layer_10_ffn_norm [label="MB2 L10\nFFN Norm\nGPU: P@2"]
		mb_2_layer_10_ffn_up [label="MB2 L10\nFFN Up\nGPU: P@2"]
		mb_2_layer_10_ffn_down [label="MB2 L10\nFFN Down\nGPU: P@2"]
		mb_2_layer_10_ffn_residual [label="MB2 L10\nFFN Residual\nGPU: P@2"]
		mb_2_layer_9_ffn_residual -> mb_2_layer_10_attn_norm
		mb_2_layer_10_attn_norm -> mb_2_layer_10_attn_qkv
		mb_2_layer_10_attn_qkv -> mb_2_layer_10_attn_out
		mb_2_layer_10_attn_out -> mb_2_layer_10_attn_residual
		mb_2_layer_10_attn_residual -> mb_2_layer_10_ffn_norm
		mb_2_layer_10_ffn_norm -> mb_2_layer_10_ffn_up
		mb_2_layer_10_ffn_up -> mb_2_layer_10_ffn_down
		mb_2_layer_10_ffn_down -> mb_2_layer_10_ffn_residual
		mb_2_stage_1_output [label="MB2\nStage 2\nOutput\nGPU: P@2"]
		mb_2_layer_10_ffn_residual -> mb_2_stage_1_output
		mb_3_comm_stage_0 [label="Micro-Batch 3\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@1 To: P@2" fillcolor=lightyellow shape=parallelogram]
		mb_3_layer_6_attn_norm [label="MB3 L6\nAttention Norm\nGPU: P@2"]
		mb_3_layer_6_attn_qkv [label="MB3 L6\nAttention QKV\nGPU: P@2"]
		mb_3_layer_6_attn_out [label="MB3 L6\nAttention Out\nGPU: P@2"]
		mb_3_layer_6_attn_residual [label="MB3 L6\nAttn Residual\nGPU: P@2"]
		mb_3_layer_6_ffn_norm [label="MB3 L6\nFFN Norm\nGPU: P@2"]
		mb_3_layer_6_ffn_up [label="MB3 L6\nFFN Up\nGPU: P@2"]
		mb_3_layer_6_ffn_down [label="MB3 L6\nFFN Down\nGPU: P@2"]
		mb_3_layer_6_ffn_residual [label="MB3 L6\nFFN Residual\nGPU: P@2"]
		mb_3_comm_stage_0 -> mb_3_layer_6_attn_norm
		mb_3_layer_6_attn_norm -> mb_3_layer_6_attn_qkv
		mb_3_layer_6_attn_qkv -> mb_3_layer_6_attn_out
		mb_3_layer_6_attn_out -> mb_3_layer_6_attn_residual
		mb_3_layer_6_attn_residual -> mb_3_layer_6_ffn_norm
		mb_3_layer_6_ffn_norm -> mb_3_layer_6_ffn_up
		mb_3_layer_6_ffn_up -> mb_3_layer_6_ffn_down
		mb_3_layer_6_ffn_down -> mb_3_layer_6_ffn_residual
		mb_3_layer_7_attn_norm [label="MB3 L7\nAttention Norm\nGPU: P@2"]
		mb_3_layer_7_attn_qkv [label="MB3 L7\nAttention QKV\nGPU: P@2"]
		mb_3_layer_7_attn_out [label="MB3 L7\nAttention Out\nGPU: P@2"]
		mb_3_layer_7_attn_residual [label="MB3 L7\nAttn Residual\nGPU: P@2"]
		mb_3_layer_7_ffn_norm [label="MB3 L7\nFFN Norm\nGPU: P@2"]
		mb_3_layer_7_ffn_up [label="MB3 L7\nFFN Up\nGPU: P@2"]
		mb_3_layer_7_ffn_down [label="MB3 L7\nFFN Down\nGPU: P@2"]
		mb_3_layer_7_ffn_residual [label="MB3 L7\nFFN Residual\nGPU: P@2"]
		mb_3_layer_6_ffn_residual -> mb_3_layer_7_attn_norm
		mb_3_layer_7_attn_norm -> mb_3_layer_7_attn_qkv
		mb_3_layer_7_attn_qkv -> mb_3_layer_7_attn_out
		mb_3_layer_7_attn_out -> mb_3_layer_7_attn_residual
		mb_3_layer_7_attn_residual -> mb_3_layer_7_ffn_norm
		mb_3_layer_7_ffn_norm -> mb_3_layer_7_ffn_up
		mb_3_layer_7_ffn_up -> mb_3_layer_7_ffn_down
		mb_3_layer_7_ffn_down -> mb_3_layer_7_ffn_residual
		mb_3_layer_8_attn_norm [label="MB3 L8\nAttention Norm\nGPU: P@2"]
		mb_3_layer_8_attn_qkv [label="MB3 L8\nAttention QKV\nGPU: P@2"]
		mb_3_layer_8_attn_out [label="MB3 L8\nAttention Out\nGPU: P@2"]
		mb_3_layer_8_attn_residual [label="MB3 L8\nAttn Residual\nGPU: P@2"]
		mb_3_layer_8_ffn_norm [label="MB3 L8\nFFN Norm\nGPU: P@2"]
		mb_3_layer_8_ffn_up [label="MB3 L8\nFFN Up\nGPU: P@2"]
		mb_3_layer_8_ffn_down [label="MB3 L8\nFFN Down\nGPU: P@2"]
		mb_3_layer_8_ffn_residual [label="MB3 L8\nFFN Residual\nGPU: P@2"]
		mb_3_layer_7_ffn_residual -> mb_3_layer_8_attn_norm
		mb_3_layer_8_attn_norm -> mb_3_layer_8_attn_qkv
		mb_3_layer_8_attn_qkv -> mb_3_layer_8_attn_out
		mb_3_layer_8_attn_out -> mb_3_layer_8_attn_residual
		mb_3_layer_8_attn_residual -> mb_3_layer_8_ffn_norm
		mb_3_layer_8_ffn_norm -> mb_3_layer_8_ffn_up
		mb_3_layer_8_ffn_up -> mb_3_layer_8_ffn_down
		mb_3_layer_8_ffn_down -> mb_3_layer_8_ffn_residual
		mb_3_layer_9_attn_norm [label="MB3 L9\nAttention Norm\nGPU: P@2"]
		mb_3_layer_9_attn_qkv [label="MB3 L9\nAttention QKV\nGPU: P@2"]
		mb_3_layer_9_attn_out [label="MB3 L9\nAttention Out\nGPU: P@2"]
		mb_3_layer_9_attn_residual [label="MB3 L9\nAttn Residual\nGPU: P@2"]
		mb_3_layer_9_ffn_norm [label="MB3 L9\nFFN Norm\nGPU: P@2"]
		mb_3_layer_9_ffn_up [label="MB3 L9\nFFN Up\nGPU: P@2"]
		mb_3_layer_9_ffn_down [label="MB3 L9\nFFN Down\nGPU: P@2"]
		mb_3_layer_9_ffn_residual [label="MB3 L9\nFFN Residual\nGPU: P@2"]
		mb_3_layer_8_ffn_residual -> mb_3_layer_9_attn_norm
		mb_3_layer_9_attn_norm -> mb_3_layer_9_attn_qkv
		mb_3_layer_9_attn_qkv -> mb_3_layer_9_attn_out
		mb_3_layer_9_attn_out -> mb_3_layer_9_attn_residual
		mb_3_layer_9_attn_residual -> mb_3_layer_9_ffn_norm
		mb_3_layer_9_ffn_norm -> mb_3_layer_9_ffn_up
		mb_3_layer_9_ffn_up -> mb_3_layer_9_ffn_down
		mb_3_layer_9_ffn_down -> mb_3_layer_9_ffn_residual
		mb_3_layer_10_attn_norm [label="MB3 L10\nAttention Norm\nGPU: P@2"]
		mb_3_layer_10_attn_qkv [label="MB3 L10\nAttention QKV\nGPU: P@2"]
		mb_3_layer_10_attn_out [label="MB3 L10\nAttention Out\nGPU: P@2"]
		mb_3_layer_10_attn_residual [label="MB3 L10\nAttn Residual\nGPU: P@2"]
		mb_3_layer_10_ffn_norm [label="MB3 L10\nFFN Norm\nGPU: P@2"]
		mb_3_layer_10_ffn_up [label="MB3 L10\nFFN Up\nGPU: P@2"]
		mb_3_layer_10_ffn_down [label="MB3 L10\nFFN Down\nGPU: P@2"]
		mb_3_layer_10_ffn_residual [label="MB3 L10\nFFN Residual\nGPU: P@2"]
		mb_3_layer_9_ffn_residual -> mb_3_layer_10_attn_norm
		mb_3_layer_10_attn_norm -> mb_3_layer_10_attn_qkv
		mb_3_layer_10_attn_qkv -> mb_3_layer_10_attn_out
		mb_3_layer_10_attn_out -> mb_3_layer_10_attn_residual
		mb_3_layer_10_attn_residual -> mb_3_layer_10_ffn_norm
		mb_3_layer_10_ffn_norm -> mb_3_layer_10_ffn_up
		mb_3_layer_10_ffn_up -> mb_3_layer_10_ffn_down
		mb_3_layer_10_ffn_down -> mb_3_layer_10_ffn_residual
		mb_3_stage_1_output [label="MB3\nStage 2\nOutput\nGPU: P@2"]
		mb_3_layer_10_ffn_residual -> mb_3_stage_1_output
		mb_4_comm_stage_0 [label="Micro-Batch 4\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@1 To: P@2" fillcolor=lightyellow shape=parallelogram]
		mb_4_layer_6_attn_norm [label="MB4 L6\nAttention Norm\nGPU: P@2"]
		mb_4_layer_6_attn_qkv [label="MB4 L6\nAttention QKV\nGPU: P@2"]
		mb_4_layer_6_attn_out [label="MB4 L6\nAttention Out\nGPU: P@2"]
		mb_4_layer_6_attn_residual [label="MB4 L6\nAttn Residual\nGPU: P@2"]
		mb_4_layer_6_ffn_norm [label="MB4 L6\nFFN Norm\nGPU: P@2"]
		mb_4_layer_6_ffn_up [label="MB4 L6\nFFN Up\nGPU: P@2"]
		mb_4_layer_6_ffn_down [label="MB4 L6\nFFN Down\nGPU: P@2"]
		mb_4_layer_6_ffn_residual [label="MB4 L6\nFFN Residual\nGPU: P@2"]
		mb_4_comm_stage_0 -> mb_4_layer_6_attn_norm
		mb_4_layer_6_attn_norm -> mb_4_layer_6_attn_qkv
		mb_4_layer_6_attn_qkv -> mb_4_layer_6_attn_out
		mb_4_layer_6_attn_out -> mb_4_layer_6_attn_residual
		mb_4_layer_6_attn_residual -> mb_4_layer_6_ffn_norm
		mb_4_layer_6_ffn_norm -> mb_4_layer_6_ffn_up
		mb_4_layer_6_ffn_up -> mb_4_layer_6_ffn_down
		mb_4_layer_6_ffn_down -> mb_4_layer_6_ffn_residual
		mb_4_layer_7_attn_norm [label="MB4 L7\nAttention Norm\nGPU: P@2"]
		mb_4_layer_7_attn_qkv [label="MB4 L7\nAttention QKV\nGPU: P@2"]
		mb_4_layer_7_attn_out [label="MB4 L7\nAttention Out\nGPU: P@2"]
		mb_4_layer_7_attn_residual [label="MB4 L7\nAttn Residual\nGPU: P@2"]
		mb_4_layer_7_ffn_norm [label="MB4 L7\nFFN Norm\nGPU: P@2"]
		mb_4_layer_7_ffn_up [label="MB4 L7\nFFN Up\nGPU: P@2"]
		mb_4_layer_7_ffn_down [label="MB4 L7\nFFN Down\nGPU: P@2"]
		mb_4_layer_7_ffn_residual [label="MB4 L7\nFFN Residual\nGPU: P@2"]
		mb_4_layer_6_ffn_residual -> mb_4_layer_7_attn_norm
		mb_4_layer_7_attn_norm -> mb_4_layer_7_attn_qkv
		mb_4_layer_7_attn_qkv -> mb_4_layer_7_attn_out
		mb_4_layer_7_attn_out -> mb_4_layer_7_attn_residual
		mb_4_layer_7_attn_residual -> mb_4_layer_7_ffn_norm
		mb_4_layer_7_ffn_norm -> mb_4_layer_7_ffn_up
		mb_4_layer_7_ffn_up -> mb_4_layer_7_ffn_down
		mb_4_layer_7_ffn_down -> mb_4_layer_7_ffn_residual
		mb_4_layer_8_attn_norm [label="MB4 L8\nAttention Norm\nGPU: P@2"]
		mb_4_layer_8_attn_qkv [label="MB4 L8\nAttention QKV\nGPU: P@2"]
		mb_4_layer_8_attn_out [label="MB4 L8\nAttention Out\nGPU: P@2"]
		mb_4_layer_8_attn_residual [label="MB4 L8\nAttn Residual\nGPU: P@2"]
		mb_4_layer_8_ffn_norm [label="MB4 L8\nFFN Norm\nGPU: P@2"]
		mb_4_layer_8_ffn_up [label="MB4 L8\nFFN Up\nGPU: P@2"]
		mb_4_layer_8_ffn_down [label="MB4 L8\nFFN Down\nGPU: P@2"]
		mb_4_layer_8_ffn_residual [label="MB4 L8\nFFN Residual\nGPU: P@2"]
		mb_4_layer_7_ffn_residual -> mb_4_layer_8_attn_norm
		mb_4_layer_8_attn_norm -> mb_4_layer_8_attn_qkv
		mb_4_layer_8_attn_qkv -> mb_4_layer_8_attn_out
		mb_4_layer_8_attn_out -> mb_4_layer_8_attn_residual
		mb_4_layer_8_attn_residual -> mb_4_layer_8_ffn_norm
		mb_4_layer_8_ffn_norm -> mb_4_layer_8_ffn_up
		mb_4_layer_8_ffn_up -> mb_4_layer_8_ffn_down
		mb_4_layer_8_ffn_down -> mb_4_layer_8_ffn_residual
		mb_4_layer_9_attn_norm [label="MB4 L9\nAttention Norm\nGPU: P@2"]
		mb_4_layer_9_attn_qkv [label="MB4 L9\nAttention QKV\nGPU: P@2"]
		mb_4_layer_9_attn_out [label="MB4 L9\nAttention Out\nGPU: P@2"]
		mb_4_layer_9_attn_residual [label="MB4 L9\nAttn Residual\nGPU: P@2"]
		mb_4_layer_9_ffn_norm [label="MB4 L9\nFFN Norm\nGPU: P@2"]
		mb_4_layer_9_ffn_up [label="MB4 L9\nFFN Up\nGPU: P@2"]
		mb_4_layer_9_ffn_down [label="MB4 L9\nFFN Down\nGPU: P@2"]
		mb_4_layer_9_ffn_residual [label="MB4 L9\nFFN Residual\nGPU: P@2"]
		mb_4_layer_8_ffn_residual -> mb_4_layer_9_attn_norm
		mb_4_layer_9_attn_norm -> mb_4_layer_9_attn_qkv
		mb_4_layer_9_attn_qkv -> mb_4_layer_9_attn_out
		mb_4_layer_9_attn_out -> mb_4_layer_9_attn_residual
		mb_4_layer_9_attn_residual -> mb_4_layer_9_ffn_norm
		mb_4_layer_9_ffn_norm -> mb_4_layer_9_ffn_up
		mb_4_layer_9_ffn_up -> mb_4_layer_9_ffn_down
		mb_4_layer_9_ffn_down -> mb_4_layer_9_ffn_residual
		mb_4_layer_10_attn_norm [label="MB4 L10\nAttention Norm\nGPU: P@2"]
		mb_4_layer_10_attn_qkv [label="MB4 L10\nAttention QKV\nGPU: P@2"]
		mb_4_layer_10_attn_out [label="MB4 L10\nAttention Out\nGPU: P@2"]
		mb_4_layer_10_attn_residual [label="MB4 L10\nAttn Residual\nGPU: P@2"]
		mb_4_layer_10_ffn_norm [label="MB4 L10\nFFN Norm\nGPU: P@2"]
		mb_4_layer_10_ffn_up [label="MB4 L10\nFFN Up\nGPU: P@2"]
		mb_4_layer_10_ffn_down [label="MB4 L10\nFFN Down\nGPU: P@2"]
		mb_4_layer_10_ffn_residual [label="MB4 L10\nFFN Residual\nGPU: P@2"]
		mb_4_layer_9_ffn_residual -> mb_4_layer_10_attn_norm
		mb_4_layer_10_attn_norm -> mb_4_layer_10_attn_qkv
		mb_4_layer_10_attn_qkv -> mb_4_layer_10_attn_out
		mb_4_layer_10_attn_out -> mb_4_layer_10_attn_residual
		mb_4_layer_10_attn_residual -> mb_4_layer_10_ffn_norm
		mb_4_layer_10_ffn_norm -> mb_4_layer_10_ffn_up
		mb_4_layer_10_ffn_up -> mb_4_layer_10_ffn_down
		mb_4_layer_10_ffn_down -> mb_4_layer_10_ffn_residual
		mb_4_stage_1_output [label="MB4\nStage 2\nOutput\nGPU: P@2"]
		mb_4_layer_10_ffn_residual -> mb_4_stage_1_output
		mb_5_comm_stage_0 [label="Micro-Batch 5\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@1 To: P@2" fillcolor=lightyellow shape=parallelogram]
		mb_5_layer_6_attn_norm [label="MB5 L6\nAttention Norm\nGPU: P@2"]
		mb_5_layer_6_attn_qkv [label="MB5 L6\nAttention QKV\nGPU: P@2"]
		mb_5_layer_6_attn_out [label="MB5 L6\nAttention Out\nGPU: P@2"]
		mb_5_layer_6_attn_residual [label="MB5 L6\nAttn Residual\nGPU: P@2"]
		mb_5_layer_6_ffn_norm [label="MB5 L6\nFFN Norm\nGPU: P@2"]
		mb_5_layer_6_ffn_up [label="MB5 L6\nFFN Up\nGPU: P@2"]
		mb_5_layer_6_ffn_down [label="MB5 L6\nFFN Down\nGPU: P@2"]
		mb_5_layer_6_ffn_residual [label="MB5 L6\nFFN Residual\nGPU: P@2"]
		mb_5_comm_stage_0 -> mb_5_layer_6_attn_norm
		mb_5_layer_6_attn_norm -> mb_5_layer_6_attn_qkv
		mb_5_layer_6_attn_qkv -> mb_5_layer_6_attn_out
		mb_5_layer_6_attn_out -> mb_5_layer_6_attn_residual
		mb_5_layer_6_attn_residual -> mb_5_layer_6_ffn_norm
		mb_5_layer_6_ffn_norm -> mb_5_layer_6_ffn_up
		mb_5_layer_6_ffn_up -> mb_5_layer_6_ffn_down
		mb_5_layer_6_ffn_down -> mb_5_layer_6_ffn_residual
		mb_5_layer_7_attn_norm [label="MB5 L7\nAttention Norm\nGPU: P@2"]
		mb_5_layer_7_attn_qkv [label="MB5 L7\nAttention QKV\nGPU: P@2"]
		mb_5_layer_7_attn_out [label="MB5 L7\nAttention Out\nGPU: P@2"]
		mb_5_layer_7_attn_residual [label="MB5 L7\nAttn Residual\nGPU: P@2"]
		mb_5_layer_7_ffn_norm [label="MB5 L7\nFFN Norm\nGPU: P@2"]
		mb_5_layer_7_ffn_up [label="MB5 L7\nFFN Up\nGPU: P@2"]
		mb_5_layer_7_ffn_down [label="MB5 L7\nFFN Down\nGPU: P@2"]
		mb_5_layer_7_ffn_residual [label="MB5 L7\nFFN Residual\nGPU: P@2"]
		mb_5_layer_6_ffn_residual -> mb_5_layer_7_attn_norm
		mb_5_layer_7_attn_norm -> mb_5_layer_7_attn_qkv
		mb_5_layer_7_attn_qkv -> mb_5_layer_7_attn_out
		mb_5_layer_7_attn_out -> mb_5_layer_7_attn_residual
		mb_5_layer_7_attn_residual -> mb_5_layer_7_ffn_norm
		mb_5_layer_7_ffn_norm -> mb_5_layer_7_ffn_up
		mb_5_layer_7_ffn_up -> mb_5_layer_7_ffn_down
		mb_5_layer_7_ffn_down -> mb_5_layer_7_ffn_residual
		mb_5_layer_8_attn_norm [label="MB5 L8\nAttention Norm\nGPU: P@2"]
		mb_5_layer_8_attn_qkv [label="MB5 L8\nAttention QKV\nGPU: P@2"]
		mb_5_layer_8_attn_out [label="MB5 L8\nAttention Out\nGPU: P@2"]
		mb_5_layer_8_attn_residual [label="MB5 L8\nAttn Residual\nGPU: P@2"]
		mb_5_layer_8_ffn_norm [label="MB5 L8\nFFN Norm\nGPU: P@2"]
		mb_5_layer_8_ffn_up [label="MB5 L8\nFFN Up\nGPU: P@2"]
		mb_5_layer_8_ffn_down [label="MB5 L8\nFFN Down\nGPU: P@2"]
		mb_5_layer_8_ffn_residual [label="MB5 L8\nFFN Residual\nGPU: P@2"]
		mb_5_layer_7_ffn_residual -> mb_5_layer_8_attn_norm
		mb_5_layer_8_attn_norm -> mb_5_layer_8_attn_qkv
		mb_5_layer_8_attn_qkv -> mb_5_layer_8_attn_out
		mb_5_layer_8_attn_out -> mb_5_layer_8_attn_residual
		mb_5_layer_8_attn_residual -> mb_5_layer_8_ffn_norm
		mb_5_layer_8_ffn_norm -> mb_5_layer_8_ffn_up
		mb_5_layer_8_ffn_up -> mb_5_layer_8_ffn_down
		mb_5_layer_8_ffn_down -> mb_5_layer_8_ffn_residual
		mb_5_layer_9_attn_norm [label="MB5 L9\nAttention Norm\nGPU: P@2"]
		mb_5_layer_9_attn_qkv [label="MB5 L9\nAttention QKV\nGPU: P@2"]
		mb_5_layer_9_attn_out [label="MB5 L9\nAttention Out\nGPU: P@2"]
		mb_5_layer_9_attn_residual [label="MB5 L9\nAttn Residual\nGPU: P@2"]
		mb_5_layer_9_ffn_norm [label="MB5 L9\nFFN Norm\nGPU: P@2"]
		mb_5_layer_9_ffn_up [label="MB5 L9\nFFN Up\nGPU: P@2"]
		mb_5_layer_9_ffn_down [label="MB5 L9\nFFN Down\nGPU: P@2"]
		mb_5_layer_9_ffn_residual [label="MB5 L9\nFFN Residual\nGPU: P@2"]
		mb_5_layer_8_ffn_residual -> mb_5_layer_9_attn_norm
		mb_5_layer_9_attn_norm -> mb_5_layer_9_attn_qkv
		mb_5_layer_9_attn_qkv -> mb_5_layer_9_attn_out
		mb_5_layer_9_attn_out -> mb_5_layer_9_attn_residual
		mb_5_layer_9_attn_residual -> mb_5_layer_9_ffn_norm
		mb_5_layer_9_ffn_norm -> mb_5_layer_9_ffn_up
		mb_5_layer_9_ffn_up -> mb_5_layer_9_ffn_down
		mb_5_layer_9_ffn_down -> mb_5_layer_9_ffn_residual
		mb_5_layer_10_attn_norm [label="MB5 L10\nAttention Norm\nGPU: P@2"]
		mb_5_layer_10_attn_qkv [label="MB5 L10\nAttention QKV\nGPU: P@2"]
		mb_5_layer_10_attn_out [label="MB5 L10\nAttention Out\nGPU: P@2"]
		mb_5_layer_10_attn_residual [label="MB5 L10\nAttn Residual\nGPU: P@2"]
		mb_5_layer_10_ffn_norm [label="MB5 L10\nFFN Norm\nGPU: P@2"]
		mb_5_layer_10_ffn_up [label="MB5 L10\nFFN Up\nGPU: P@2"]
		mb_5_layer_10_ffn_down [label="MB5 L10\nFFN Down\nGPU: P@2"]
		mb_5_layer_10_ffn_residual [label="MB5 L10\nFFN Residual\nGPU: P@2"]
		mb_5_layer_9_ffn_residual -> mb_5_layer_10_attn_norm
		mb_5_layer_10_attn_norm -> mb_5_layer_10_attn_qkv
		mb_5_layer_10_attn_qkv -> mb_5_layer_10_attn_out
		mb_5_layer_10_attn_out -> mb_5_layer_10_attn_residual
		mb_5_layer_10_attn_residual -> mb_5_layer_10_ffn_norm
		mb_5_layer_10_ffn_norm -> mb_5_layer_10_ffn_up
		mb_5_layer_10_ffn_up -> mb_5_layer_10_ffn_down
		mb_5_layer_10_ffn_down -> mb_5_layer_10_ffn_residual
		mb_5_stage_1_output [label="MB5\nStage 2\nOutput\nGPU: P@2"]
		mb_5_layer_10_ffn_residual -> mb_5_stage_1_output
	}
	mb_0_stage_1_output -> mb_0_comm_stage_1
	mb_1_stage_1_output -> mb_1_comm_stage_1
	mb_2_stage_1_output -> mb_2_comm_stage_1
	mb_3_stage_1_output -> mb_3_comm_stage_1
	mb_4_stage_1_output -> mb_4_comm_stage_1
	mb_5_stage_1_output -> mb_5_comm_stage_1
	subgraph cluster_stage_2 {
		label="Stage 3\nP@3\nLayers 11-15" style=dashed
		mb_0_comm_stage_1 [label="Micro-Batch 0\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@2 To: P@3" fillcolor=lightyellow shape=parallelogram]
		mb_0_layer_11_attn_norm [label="MB0 L11\nAttention Norm\nGPU: P@3"]
		mb_0_layer_11_attn_qkv [label="MB0 L11\nAttention QKV\nGPU: P@3"]
		mb_0_layer_11_attn_out [label="MB0 L11\nAttention Out\nGPU: P@3"]
		mb_0_layer_11_attn_residual [label="MB0 L11\nAttn Residual\nGPU: P@3"]
		mb_0_layer_11_ffn_norm [label="MB0 L11\nFFN Norm\nGPU: P@3"]
		mb_0_layer_11_ffn_up [label="MB0 L11\nFFN Up\nGPU: P@3"]
		mb_0_layer_11_ffn_down [label="MB0 L11\nFFN Down\nGPU: P@3"]
		mb_0_layer_11_ffn_residual [label="MB0 L11\nFFN Residual\nGPU: P@3"]
		mb_0_comm_stage_1 -> mb_0_layer_11_attn_norm
		mb_0_layer_11_attn_norm -> mb_0_layer_11_attn_qkv
		mb_0_layer_11_attn_qkv -> mb_0_layer_11_attn_out
		mb_0_layer_11_attn_out -> mb_0_layer_11_attn_residual
		mb_0_layer_11_attn_residual -> mb_0_layer_11_ffn_norm
		mb_0_layer_11_ffn_norm -> mb_0_layer_11_ffn_up
		mb_0_layer_11_ffn_up -> mb_0_layer_11_ffn_down
		mb_0_layer_11_ffn_down -> mb_0_layer_11_ffn_residual
		mb_0_layer_12_attn_norm [label="MB0 L12\nAttention Norm\nGPU: P@3"]
		mb_0_layer_12_attn_qkv [label="MB0 L12\nAttention QKV\nGPU: P@3"]
		mb_0_layer_12_attn_out [label="MB0 L12\nAttention Out\nGPU: P@3"]
		mb_0_layer_12_attn_residual [label="MB0 L12\nAttn Residual\nGPU: P@3"]
		mb_0_layer_12_ffn_norm [label="MB0 L12\nFFN Norm\nGPU: P@3"]
		mb_0_layer_12_ffn_up [label="MB0 L12\nFFN Up\nGPU: P@3"]
		mb_0_layer_12_ffn_down [label="MB0 L12\nFFN Down\nGPU: P@3"]
		mb_0_layer_12_ffn_residual [label="MB0 L12\nFFN Residual\nGPU: P@3"]
		mb_0_layer_11_ffn_residual -> mb_0_layer_12_attn_norm
		mb_0_layer_12_attn_norm -> mb_0_layer_12_attn_qkv
		mb_0_layer_12_attn_qkv -> mb_0_layer_12_attn_out
		mb_0_layer_12_attn_out -> mb_0_layer_12_attn_residual
		mb_0_layer_12_attn_residual -> mb_0_layer_12_ffn_norm
		mb_0_layer_12_ffn_norm -> mb_0_layer_12_ffn_up
		mb_0_layer_12_ffn_up -> mb_0_layer_12_ffn_down
		mb_0_layer_12_ffn_down -> mb_0_layer_12_ffn_residual
		mb_0_layer_13_attn_norm [label="MB0 L13\nAttention Norm\nGPU: P@3"]
		mb_0_layer_13_attn_qkv [label="MB0 L13\nAttention QKV\nGPU: P@3"]
		mb_0_layer_13_attn_out [label="MB0 L13\nAttention Out\nGPU: P@3"]
		mb_0_layer_13_attn_residual [label="MB0 L13\nAttn Residual\nGPU: P@3"]
		mb_0_layer_13_ffn_norm [label="MB0 L13\nFFN Norm\nGPU: P@3"]
		mb_0_layer_13_ffn_up [label="MB0 L13\nFFN Up\nGPU: P@3"]
		mb_0_layer_13_ffn_down [label="MB0 L13\nFFN Down\nGPU: P@3"]
		mb_0_layer_13_ffn_residual [label="MB0 L13\nFFN Residual\nGPU: P@3"]
		mb_0_layer_12_ffn_residual -> mb_0_layer_13_attn_norm
		mb_0_layer_13_attn_norm -> mb_0_layer_13_attn_qkv
		mb_0_layer_13_attn_qkv -> mb_0_layer_13_attn_out
		mb_0_layer_13_attn_out -> mb_0_layer_13_attn_residual
		mb_0_layer_13_attn_residual -> mb_0_layer_13_ffn_norm
		mb_0_layer_13_ffn_norm -> mb_0_layer_13_ffn_up
		mb_0_layer_13_ffn_up -> mb_0_layer_13_ffn_down
		mb_0_layer_13_ffn_down -> mb_0_layer_13_ffn_residual
		mb_0_layer_14_attn_norm [label="MB0 L14\nAttention Norm\nGPU: P@3"]
		mb_0_layer_14_attn_qkv [label="MB0 L14\nAttention QKV\nGPU: P@3"]
		mb_0_layer_14_attn_out [label="MB0 L14\nAttention Out\nGPU: P@3"]
		mb_0_layer_14_attn_residual [label="MB0 L14\nAttn Residual\nGPU: P@3"]
		mb_0_layer_14_ffn_norm [label="MB0 L14\nFFN Norm\nGPU: P@3"]
		mb_0_layer_14_ffn_up [label="MB0 L14\nFFN Up\nGPU: P@3"]
		mb_0_layer_14_ffn_down [label="MB0 L14\nFFN Down\nGPU: P@3"]
		mb_0_layer_14_ffn_residual [label="MB0 L14\nFFN Residual\nGPU: P@3"]
		mb_0_layer_13_ffn_residual -> mb_0_layer_14_attn_norm
		mb_0_layer_14_attn_norm -> mb_0_layer_14_attn_qkv
		mb_0_layer_14_attn_qkv -> mb_0_layer_14_attn_out
		mb_0_layer_14_attn_out -> mb_0_layer_14_attn_residual
		mb_0_layer_14_attn_residual -> mb_0_layer_14_ffn_norm
		mb_0_layer_14_ffn_norm -> mb_0_layer_14_ffn_up
		mb_0_layer_14_ffn_up -> mb_0_layer_14_ffn_down
		mb_0_layer_14_ffn_down -> mb_0_layer_14_ffn_residual
		mb_0_layer_15_attn_norm [label="MB0 L15\nAttention Norm\nGPU: P@3"]
		mb_0_layer_15_attn_qkv [label="MB0 L15\nAttention QKV\nGPU: P@3"]
		mb_0_layer_15_attn_out [label="MB0 L15\nAttention Out\nGPU: P@3"]
		mb_0_layer_15_attn_residual [label="MB0 L15\nAttn Residual\nGPU: P@3"]
		mb_0_layer_15_ffn_norm [label="MB0 L15\nFFN Norm\nGPU: P@3"]
		mb_0_layer_15_ffn_up [label="MB0 L15\nFFN Up\nGPU: P@3"]
		mb_0_layer_15_ffn_down [label="MB0 L15\nFFN Down\nGPU: P@3"]
		mb_0_layer_15_ffn_residual [label="MB0 L15\nFFN Residual\nGPU: P@3"]
		mb_0_layer_14_ffn_residual -> mb_0_layer_15_attn_norm
		mb_0_layer_15_attn_norm -> mb_0_layer_15_attn_qkv
		mb_0_layer_15_attn_qkv -> mb_0_layer_15_attn_out
		mb_0_layer_15_attn_out -> mb_0_layer_15_attn_residual
		mb_0_layer_15_attn_residual -> mb_0_layer_15_ffn_norm
		mb_0_layer_15_ffn_norm -> mb_0_layer_15_ffn_up
		mb_0_layer_15_ffn_up -> mb_0_layer_15_ffn_down
		mb_0_layer_15_ffn_down -> mb_0_layer_15_ffn_residual
		mb_0_stage_2_output [label="MB0\nStage 3\nOutput\nGPU: P@3"]
		mb_0_layer_15_ffn_residual -> mb_0_stage_2_output
		mb_1_comm_stage_1 [label="Micro-Batch 1\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@2 To: P@3" fillcolor=lightyellow shape=parallelogram]
		mb_1_layer_11_attn_norm [label="MB1 L11\nAttention Norm\nGPU: P@3"]
		mb_1_layer_11_attn_qkv [label="MB1 L11\nAttention QKV\nGPU: P@3"]
		mb_1_layer_11_attn_out [label="MB1 L11\nAttention Out\nGPU: P@3"]
		mb_1_layer_11_attn_residual [label="MB1 L11\nAttn Residual\nGPU: P@3"]
		mb_1_layer_11_ffn_norm [label="MB1 L11\nFFN Norm\nGPU: P@3"]
		mb_1_layer_11_ffn_up [label="MB1 L11\nFFN Up\nGPU: P@3"]
		mb_1_layer_11_ffn_down [label="MB1 L11\nFFN Down\nGPU: P@3"]
		mb_1_layer_11_ffn_residual [label="MB1 L11\nFFN Residual\nGPU: P@3"]
		mb_1_comm_stage_1 -> mb_1_layer_11_attn_norm
		mb_1_layer_11_attn_norm -> mb_1_layer_11_attn_qkv
		mb_1_layer_11_attn_qkv -> mb_1_layer_11_attn_out
		mb_1_layer_11_attn_out -> mb_1_layer_11_attn_residual
		mb_1_layer_11_attn_residual -> mb_1_layer_11_ffn_norm
		mb_1_layer_11_ffn_norm -> mb_1_layer_11_ffn_up
		mb_1_layer_11_ffn_up -> mb_1_layer_11_ffn_down
		mb_1_layer_11_ffn_down -> mb_1_layer_11_ffn_residual
		mb_1_layer_12_attn_norm [label="MB1 L12\nAttention Norm\nGPU: P@3"]
		mb_1_layer_12_attn_qkv [label="MB1 L12\nAttention QKV\nGPU: P@3"]
		mb_1_layer_12_attn_out [label="MB1 L12\nAttention Out\nGPU: P@3"]
		mb_1_layer_12_attn_residual [label="MB1 L12\nAttn Residual\nGPU: P@3"]
		mb_1_layer_12_ffn_norm [label="MB1 L12\nFFN Norm\nGPU: P@3"]
		mb_1_layer_12_ffn_up [label="MB1 L12\nFFN Up\nGPU: P@3"]
		mb_1_layer_12_ffn_down [label="MB1 L12\nFFN Down\nGPU: P@3"]
		mb_1_layer_12_ffn_residual [label="MB1 L12\nFFN Residual\nGPU: P@3"]
		mb_1_layer_11_ffn_residual -> mb_1_layer_12_attn_norm
		mb_1_layer_12_attn_norm -> mb_1_layer_12_attn_qkv
		mb_1_layer_12_attn_qkv -> mb_1_layer_12_attn_out
		mb_1_layer_12_attn_out -> mb_1_layer_12_attn_residual
		mb_1_layer_12_attn_residual -> mb_1_layer_12_ffn_norm
		mb_1_layer_12_ffn_norm -> mb_1_layer_12_ffn_up
		mb_1_layer_12_ffn_up -> mb_1_layer_12_ffn_down
		mb_1_layer_12_ffn_down -> mb_1_layer_12_ffn_residual
		mb_1_layer_13_attn_norm [label="MB1 L13\nAttention Norm\nGPU: P@3"]
		mb_1_layer_13_attn_qkv [label="MB1 L13\nAttention QKV\nGPU: P@3"]
		mb_1_layer_13_attn_out [label="MB1 L13\nAttention Out\nGPU: P@3"]
		mb_1_layer_13_attn_residual [label="MB1 L13\nAttn Residual\nGPU: P@3"]
		mb_1_layer_13_ffn_norm [label="MB1 L13\nFFN Norm\nGPU: P@3"]
		mb_1_layer_13_ffn_up [label="MB1 L13\nFFN Up\nGPU: P@3"]
		mb_1_layer_13_ffn_down [label="MB1 L13\nFFN Down\nGPU: P@3"]
		mb_1_layer_13_ffn_residual [label="MB1 L13\nFFN Residual\nGPU: P@3"]
		mb_1_layer_12_ffn_residual -> mb_1_layer_13_attn_norm
		mb_1_layer_13_attn_norm -> mb_1_layer_13_attn_qkv
		mb_1_layer_13_attn_qkv -> mb_1_layer_13_attn_out
		mb_1_layer_13_attn_out -> mb_1_layer_13_attn_residual
		mb_1_layer_13_attn_residual -> mb_1_layer_13_ffn_norm
		mb_1_layer_13_ffn_norm -> mb_1_layer_13_ffn_up
		mb_1_layer_13_ffn_up -> mb_1_layer_13_ffn_down
		mb_1_layer_13_ffn_down -> mb_1_layer_13_ffn_residual
		mb_1_layer_14_attn_norm [label="MB1 L14\nAttention Norm\nGPU: P@3"]
		mb_1_layer_14_attn_qkv [label="MB1 L14\nAttention QKV\nGPU: P@3"]
		mb_1_layer_14_attn_out [label="MB1 L14\nAttention Out\nGPU: P@3"]
		mb_1_layer_14_attn_residual [label="MB1 L14\nAttn Residual\nGPU: P@3"]
		mb_1_layer_14_ffn_norm [label="MB1 L14\nFFN Norm\nGPU: P@3"]
		mb_1_layer_14_ffn_up [label="MB1 L14\nFFN Up\nGPU: P@3"]
		mb_1_layer_14_ffn_down [label="MB1 L14\nFFN Down\nGPU: P@3"]
		mb_1_layer_14_ffn_residual [label="MB1 L14\nFFN Residual\nGPU: P@3"]
		mb_1_layer_13_ffn_residual -> mb_1_layer_14_attn_norm
		mb_1_layer_14_attn_norm -> mb_1_layer_14_attn_qkv
		mb_1_layer_14_attn_qkv -> mb_1_layer_14_attn_out
		mb_1_layer_14_attn_out -> mb_1_layer_14_attn_residual
		mb_1_layer_14_attn_residual -> mb_1_layer_14_ffn_norm
		mb_1_layer_14_ffn_norm -> mb_1_layer_14_ffn_up
		mb_1_layer_14_ffn_up -> mb_1_layer_14_ffn_down
		mb_1_layer_14_ffn_down -> mb_1_layer_14_ffn_residual
		mb_1_layer_15_attn_norm [label="MB1 L15\nAttention Norm\nGPU: P@3"]
		mb_1_layer_15_attn_qkv [label="MB1 L15\nAttention QKV\nGPU: P@3"]
		mb_1_layer_15_attn_out [label="MB1 L15\nAttention Out\nGPU: P@3"]
		mb_1_layer_15_attn_residual [label="MB1 L15\nAttn Residual\nGPU: P@3"]
		mb_1_layer_15_ffn_norm [label="MB1 L15\nFFN Norm\nGPU: P@3"]
		mb_1_layer_15_ffn_up [label="MB1 L15\nFFN Up\nGPU: P@3"]
		mb_1_layer_15_ffn_down [label="MB1 L15\nFFN Down\nGPU: P@3"]
		mb_1_layer_15_ffn_residual [label="MB1 L15\nFFN Residual\nGPU: P@3"]
		mb_1_layer_14_ffn_residual -> mb_1_layer_15_attn_norm
		mb_1_layer_15_attn_norm -> mb_1_layer_15_attn_qkv
		mb_1_layer_15_attn_qkv -> mb_1_layer_15_attn_out
		mb_1_layer_15_attn_out -> mb_1_layer_15_attn_residual
		mb_1_layer_15_attn_residual -> mb_1_layer_15_ffn_norm
		mb_1_layer_15_ffn_norm -> mb_1_layer_15_ffn_up
		mb_1_layer_15_ffn_up -> mb_1_layer_15_ffn_down
		mb_1_layer_15_ffn_down -> mb_1_layer_15_ffn_residual
		mb_1_stage_2_output [label="MB1\nStage 3\nOutput\nGPU: P@3"]
		mb_1_layer_15_ffn_residual -> mb_1_stage_2_output
		mb_2_comm_stage_1 [label="Micro-Batch 2\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@2 To: P@3" fillcolor=lightyellow shape=parallelogram]
		mb_2_layer_11_attn_norm [label="MB2 L11\nAttention Norm\nGPU: P@3"]
		mb_2_layer_11_attn_qkv [label="MB2 L11\nAttention QKV\nGPU: P@3"]
		mb_2_layer_11_attn_out [label="MB2 L11\nAttention Out\nGPU: P@3"]
		mb_2_layer_11_attn_residual [label="MB2 L11\nAttn Residual\nGPU: P@3"]
		mb_2_layer_11_ffn_norm [label="MB2 L11\nFFN Norm\nGPU: P@3"]
		mb_2_layer_11_ffn_up [label="MB2 L11\nFFN Up\nGPU: P@3"]
		mb_2_layer_11_ffn_down [label="MB2 L11\nFFN Down\nGPU: P@3"]
		mb_2_layer_11_ffn_residual [label="MB2 L11\nFFN Residual\nGPU: P@3"]
		mb_2_comm_stage_1 -> mb_2_layer_11_attn_norm
		mb_2_layer_11_attn_norm -> mb_2_layer_11_attn_qkv
		mb_2_layer_11_attn_qkv -> mb_2_layer_11_attn_out
		mb_2_layer_11_attn_out -> mb_2_layer_11_attn_residual
		mb_2_layer_11_attn_residual -> mb_2_layer_11_ffn_norm
		mb_2_layer_11_ffn_norm -> mb_2_layer_11_ffn_up
		mb_2_layer_11_ffn_up -> mb_2_layer_11_ffn_down
		mb_2_layer_11_ffn_down -> mb_2_layer_11_ffn_residual
		mb_2_layer_12_attn_norm [label="MB2 L12\nAttention Norm\nGPU: P@3"]
		mb_2_layer_12_attn_qkv [label="MB2 L12\nAttention QKV\nGPU: P@3"]
		mb_2_layer_12_attn_out [label="MB2 L12\nAttention Out\nGPU: P@3"]
		mb_2_layer_12_attn_residual [label="MB2 L12\nAttn Residual\nGPU: P@3"]
		mb_2_layer_12_ffn_norm [label="MB2 L12\nFFN Norm\nGPU: P@3"]
		mb_2_layer_12_ffn_up [label="MB2 L12\nFFN Up\nGPU: P@3"]
		mb_2_layer_12_ffn_down [label="MB2 L12\nFFN Down\nGPU: P@3"]
		mb_2_layer_12_ffn_residual [label="MB2 L12\nFFN Residual\nGPU: P@3"]
		mb_2_layer_11_ffn_residual -> mb_2_layer_12_attn_norm
		mb_2_layer_12_attn_norm -> mb_2_layer_12_attn_qkv
		mb_2_layer_12_attn_qkv -> mb_2_layer_12_attn_out
		mb_2_layer_12_attn_out -> mb_2_layer_12_attn_residual
		mb_2_layer_12_attn_residual -> mb_2_layer_12_ffn_norm
		mb_2_layer_12_ffn_norm -> mb_2_layer_12_ffn_up
		mb_2_layer_12_ffn_up -> mb_2_layer_12_ffn_down
		mb_2_layer_12_ffn_down -> mb_2_layer_12_ffn_residual
		mb_2_layer_13_attn_norm [label="MB2 L13\nAttention Norm\nGPU: P@3"]
		mb_2_layer_13_attn_qkv [label="MB2 L13\nAttention QKV\nGPU: P@3"]
		mb_2_layer_13_attn_out [label="MB2 L13\nAttention Out\nGPU: P@3"]
		mb_2_layer_13_attn_residual [label="MB2 L13\nAttn Residual\nGPU: P@3"]
		mb_2_layer_13_ffn_norm [label="MB2 L13\nFFN Norm\nGPU: P@3"]
		mb_2_layer_13_ffn_up [label="MB2 L13\nFFN Up\nGPU: P@3"]
		mb_2_layer_13_ffn_down [label="MB2 L13\nFFN Down\nGPU: P@3"]
		mb_2_layer_13_ffn_residual [label="MB2 L13\nFFN Residual\nGPU: P@3"]
		mb_2_layer_12_ffn_residual -> mb_2_layer_13_attn_norm
		mb_2_layer_13_attn_norm -> mb_2_layer_13_attn_qkv
		mb_2_layer_13_attn_qkv -> mb_2_layer_13_attn_out
		mb_2_layer_13_attn_out -> mb_2_layer_13_attn_residual
		mb_2_layer_13_attn_residual -> mb_2_layer_13_ffn_norm
		mb_2_layer_13_ffn_norm -> mb_2_layer_13_ffn_up
		mb_2_layer_13_ffn_up -> mb_2_layer_13_ffn_down
		mb_2_layer_13_ffn_down -> mb_2_layer_13_ffn_residual
		mb_2_layer_14_attn_norm [label="MB2 L14\nAttention Norm\nGPU: P@3"]
		mb_2_layer_14_attn_qkv [label="MB2 L14\nAttention QKV\nGPU: P@3"]
		mb_2_layer_14_attn_out [label="MB2 L14\nAttention Out\nGPU: P@3"]
		mb_2_layer_14_attn_residual [label="MB2 L14\nAttn Residual\nGPU: P@3"]
		mb_2_layer_14_ffn_norm [label="MB2 L14\nFFN Norm\nGPU: P@3"]
		mb_2_layer_14_ffn_up [label="MB2 L14\nFFN Up\nGPU: P@3"]
		mb_2_layer_14_ffn_down [label="MB2 L14\nFFN Down\nGPU: P@3"]
		mb_2_layer_14_ffn_residual [label="MB2 L14\nFFN Residual\nGPU: P@3"]
		mb_2_layer_13_ffn_residual -> mb_2_layer_14_attn_norm
		mb_2_layer_14_attn_norm -> mb_2_layer_14_attn_qkv
		mb_2_layer_14_attn_qkv -> mb_2_layer_14_attn_out
		mb_2_layer_14_attn_out -> mb_2_layer_14_attn_residual
		mb_2_layer_14_attn_residual -> mb_2_layer_14_ffn_norm
		mb_2_layer_14_ffn_norm -> mb_2_layer_14_ffn_up
		mb_2_layer_14_ffn_up -> mb_2_layer_14_ffn_down
		mb_2_layer_14_ffn_down -> mb_2_layer_14_ffn_residual
		mb_2_layer_15_attn_norm [label="MB2 L15\nAttention Norm\nGPU: P@3"]
		mb_2_layer_15_attn_qkv [label="MB2 L15\nAttention QKV\nGPU: P@3"]
		mb_2_layer_15_attn_out [label="MB2 L15\nAttention Out\nGPU: P@3"]
		mb_2_layer_15_attn_residual [label="MB2 L15\nAttn Residual\nGPU: P@3"]
		mb_2_layer_15_ffn_norm [label="MB2 L15\nFFN Norm\nGPU: P@3"]
		mb_2_layer_15_ffn_up [label="MB2 L15\nFFN Up\nGPU: P@3"]
		mb_2_layer_15_ffn_down [label="MB2 L15\nFFN Down\nGPU: P@3"]
		mb_2_layer_15_ffn_residual [label="MB2 L15\nFFN Residual\nGPU: P@3"]
		mb_2_layer_14_ffn_residual -> mb_2_layer_15_attn_norm
		mb_2_layer_15_attn_norm -> mb_2_layer_15_attn_qkv
		mb_2_layer_15_attn_qkv -> mb_2_layer_15_attn_out
		mb_2_layer_15_attn_out -> mb_2_layer_15_attn_residual
		mb_2_layer_15_attn_residual -> mb_2_layer_15_ffn_norm
		mb_2_layer_15_ffn_norm -> mb_2_layer_15_ffn_up
		mb_2_layer_15_ffn_up -> mb_2_layer_15_ffn_down
		mb_2_layer_15_ffn_down -> mb_2_layer_15_ffn_residual
		mb_2_stage_2_output [label="MB2\nStage 3\nOutput\nGPU: P@3"]
		mb_2_layer_15_ffn_residual -> mb_2_stage_2_output
		mb_3_comm_stage_1 [label="Micro-Batch 3\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@2 To: P@3" fillcolor=lightyellow shape=parallelogram]
		mb_3_layer_11_attn_norm [label="MB3 L11\nAttention Norm\nGPU: P@3"]
		mb_3_layer_11_attn_qkv [label="MB3 L11\nAttention QKV\nGPU: P@3"]
		mb_3_layer_11_attn_out [label="MB3 L11\nAttention Out\nGPU: P@3"]
		mb_3_layer_11_attn_residual [label="MB3 L11\nAttn Residual\nGPU: P@3"]
		mb_3_layer_11_ffn_norm [label="MB3 L11\nFFN Norm\nGPU: P@3"]
		mb_3_layer_11_ffn_up [label="MB3 L11\nFFN Up\nGPU: P@3"]
		mb_3_layer_11_ffn_down [label="MB3 L11\nFFN Down\nGPU: P@3"]
		mb_3_layer_11_ffn_residual [label="MB3 L11\nFFN Residual\nGPU: P@3"]
		mb_3_comm_stage_1 -> mb_3_layer_11_attn_norm
		mb_3_layer_11_attn_norm -> mb_3_layer_11_attn_qkv
		mb_3_layer_11_attn_qkv -> mb_3_layer_11_attn_out
		mb_3_layer_11_attn_out -> mb_3_layer_11_attn_residual
		mb_3_layer_11_attn_residual -> mb_3_layer_11_ffn_norm
		mb_3_layer_11_ffn_norm -> mb_3_layer_11_ffn_up
		mb_3_layer_11_ffn_up -> mb_3_layer_11_ffn_down
		mb_3_layer_11_ffn_down -> mb_3_layer_11_ffn_residual
		mb_3_layer_12_attn_norm [label="MB3 L12\nAttention Norm\nGPU: P@3"]
		mb_3_layer_12_attn_qkv [label="MB3 L12\nAttention QKV\nGPU: P@3"]
		mb_3_layer_12_attn_out [label="MB3 L12\nAttention Out\nGPU: P@3"]
		mb_3_layer_12_attn_residual [label="MB3 L12\nAttn Residual\nGPU: P@3"]
		mb_3_layer_12_ffn_norm [label="MB3 L12\nFFN Norm\nGPU: P@3"]
		mb_3_layer_12_ffn_up [label="MB3 L12\nFFN Up\nGPU: P@3"]
		mb_3_layer_12_ffn_down [label="MB3 L12\nFFN Down\nGPU: P@3"]
		mb_3_layer_12_ffn_residual [label="MB3 L12\nFFN Residual\nGPU: P@3"]
		mb_3_layer_11_ffn_residual -> mb_3_layer_12_attn_norm
		mb_3_layer_12_attn_norm -> mb_3_layer_12_attn_qkv
		mb_3_layer_12_attn_qkv -> mb_3_layer_12_attn_out
		mb_3_layer_12_attn_out -> mb_3_layer_12_attn_residual
		mb_3_layer_12_attn_residual -> mb_3_layer_12_ffn_norm
		mb_3_layer_12_ffn_norm -> mb_3_layer_12_ffn_up
		mb_3_layer_12_ffn_up -> mb_3_layer_12_ffn_down
		mb_3_layer_12_ffn_down -> mb_3_layer_12_ffn_residual
		mb_3_layer_13_attn_norm [label="MB3 L13\nAttention Norm\nGPU: P@3"]
		mb_3_layer_13_attn_qkv [label="MB3 L13\nAttention QKV\nGPU: P@3"]
		mb_3_layer_13_attn_out [label="MB3 L13\nAttention Out\nGPU: P@3"]
		mb_3_layer_13_attn_residual [label="MB3 L13\nAttn Residual\nGPU: P@3"]
		mb_3_layer_13_ffn_norm [label="MB3 L13\nFFN Norm\nGPU: P@3"]
		mb_3_layer_13_ffn_up [label="MB3 L13\nFFN Up\nGPU: P@3"]
		mb_3_layer_13_ffn_down [label="MB3 L13\nFFN Down\nGPU: P@3"]
		mb_3_layer_13_ffn_residual [label="MB3 L13\nFFN Residual\nGPU: P@3"]
		mb_3_layer_12_ffn_residual -> mb_3_layer_13_attn_norm
		mb_3_layer_13_attn_norm -> mb_3_layer_13_attn_qkv
		mb_3_layer_13_attn_qkv -> mb_3_layer_13_attn_out
		mb_3_layer_13_attn_out -> mb_3_layer_13_attn_residual
		mb_3_layer_13_attn_residual -> mb_3_layer_13_ffn_norm
		mb_3_layer_13_ffn_norm -> mb_3_layer_13_ffn_up
		mb_3_layer_13_ffn_up -> mb_3_layer_13_ffn_down
		mb_3_layer_13_ffn_down -> mb_3_layer_13_ffn_residual
		mb_3_layer_14_attn_norm [label="MB3 L14\nAttention Norm\nGPU: P@3"]
		mb_3_layer_14_attn_qkv [label="MB3 L14\nAttention QKV\nGPU: P@3"]
		mb_3_layer_14_attn_out [label="MB3 L14\nAttention Out\nGPU: P@3"]
		mb_3_layer_14_attn_residual [label="MB3 L14\nAttn Residual\nGPU: P@3"]
		mb_3_layer_14_ffn_norm [label="MB3 L14\nFFN Norm\nGPU: P@3"]
		mb_3_layer_14_ffn_up [label="MB3 L14\nFFN Up\nGPU: P@3"]
		mb_3_layer_14_ffn_down [label="MB3 L14\nFFN Down\nGPU: P@3"]
		mb_3_layer_14_ffn_residual [label="MB3 L14\nFFN Residual\nGPU: P@3"]
		mb_3_layer_13_ffn_residual -> mb_3_layer_14_attn_norm
		mb_3_layer_14_attn_norm -> mb_3_layer_14_attn_qkv
		mb_3_layer_14_attn_qkv -> mb_3_layer_14_attn_out
		mb_3_layer_14_attn_out -> mb_3_layer_14_attn_residual
		mb_3_layer_14_attn_residual -> mb_3_layer_14_ffn_norm
		mb_3_layer_14_ffn_norm -> mb_3_layer_14_ffn_up
		mb_3_layer_14_ffn_up -> mb_3_layer_14_ffn_down
		mb_3_layer_14_ffn_down -> mb_3_layer_14_ffn_residual
		mb_3_layer_15_attn_norm [label="MB3 L15\nAttention Norm\nGPU: P@3"]
		mb_3_layer_15_attn_qkv [label="MB3 L15\nAttention QKV\nGPU: P@3"]
		mb_3_layer_15_attn_out [label="MB3 L15\nAttention Out\nGPU: P@3"]
		mb_3_layer_15_attn_residual [label="MB3 L15\nAttn Residual\nGPU: P@3"]
		mb_3_layer_15_ffn_norm [label="MB3 L15\nFFN Norm\nGPU: P@3"]
		mb_3_layer_15_ffn_up [label="MB3 L15\nFFN Up\nGPU: P@3"]
		mb_3_layer_15_ffn_down [label="MB3 L15\nFFN Down\nGPU: P@3"]
		mb_3_layer_15_ffn_residual [label="MB3 L15\nFFN Residual\nGPU: P@3"]
		mb_3_layer_14_ffn_residual -> mb_3_layer_15_attn_norm
		mb_3_layer_15_attn_norm -> mb_3_layer_15_attn_qkv
		mb_3_layer_15_attn_qkv -> mb_3_layer_15_attn_out
		mb_3_layer_15_attn_out -> mb_3_layer_15_attn_residual
		mb_3_layer_15_attn_residual -> mb_3_layer_15_ffn_norm
		mb_3_layer_15_ffn_norm -> mb_3_layer_15_ffn_up
		mb_3_layer_15_ffn_up -> mb_3_layer_15_ffn_down
		mb_3_layer_15_ffn_down -> mb_3_layer_15_ffn_residual
		mb_3_stage_2_output [label="MB3\nStage 3\nOutput\nGPU: P@3"]
		mb_3_layer_15_ffn_residual -> mb_3_stage_2_output
		mb_4_comm_stage_1 [label="Micro-Batch 4\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@2 To: P@3" fillcolor=lightyellow shape=parallelogram]
		mb_4_layer_11_attn_norm [label="MB4 L11\nAttention Norm\nGPU: P@3"]
		mb_4_layer_11_attn_qkv [label="MB4 L11\nAttention QKV\nGPU: P@3"]
		mb_4_layer_11_attn_out [label="MB4 L11\nAttention Out\nGPU: P@3"]
		mb_4_layer_11_attn_residual [label="MB4 L11\nAttn Residual\nGPU: P@3"]
		mb_4_layer_11_ffn_norm [label="MB4 L11\nFFN Norm\nGPU: P@3"]
		mb_4_layer_11_ffn_up [label="MB4 L11\nFFN Up\nGPU: P@3"]
		mb_4_layer_11_ffn_down [label="MB4 L11\nFFN Down\nGPU: P@3"]
		mb_4_layer_11_ffn_residual [label="MB4 L11\nFFN Residual\nGPU: P@3"]
		mb_4_comm_stage_1 -> mb_4_layer_11_attn_norm
		mb_4_layer_11_attn_norm -> mb_4_layer_11_attn_qkv
		mb_4_layer_11_attn_qkv -> mb_4_layer_11_attn_out
		mb_4_layer_11_attn_out -> mb_4_layer_11_attn_residual
		mb_4_layer_11_attn_residual -> mb_4_layer_11_ffn_norm
		mb_4_layer_11_ffn_norm -> mb_4_layer_11_ffn_up
		mb_4_layer_11_ffn_up -> mb_4_layer_11_ffn_down
		mb_4_layer_11_ffn_down -> mb_4_layer_11_ffn_residual
		mb_4_layer_12_attn_norm [label="MB4 L12\nAttention Norm\nGPU: P@3"]
		mb_4_layer_12_attn_qkv [label="MB4 L12\nAttention QKV\nGPU: P@3"]
		mb_4_layer_12_attn_out [label="MB4 L12\nAttention Out\nGPU: P@3"]
		mb_4_layer_12_attn_residual [label="MB4 L12\nAttn Residual\nGPU: P@3"]
		mb_4_layer_12_ffn_norm [label="MB4 L12\nFFN Norm\nGPU: P@3"]
		mb_4_layer_12_ffn_up [label="MB4 L12\nFFN Up\nGPU: P@3"]
		mb_4_layer_12_ffn_down [label="MB4 L12\nFFN Down\nGPU: P@3"]
		mb_4_layer_12_ffn_residual [label="MB4 L12\nFFN Residual\nGPU: P@3"]
		mb_4_layer_11_ffn_residual -> mb_4_layer_12_attn_norm
		mb_4_layer_12_attn_norm -> mb_4_layer_12_attn_qkv
		mb_4_layer_12_attn_qkv -> mb_4_layer_12_attn_out
		mb_4_layer_12_attn_out -> mb_4_layer_12_attn_residual
		mb_4_layer_12_attn_residual -> mb_4_layer_12_ffn_norm
		mb_4_layer_12_ffn_norm -> mb_4_layer_12_ffn_up
		mb_4_layer_12_ffn_up -> mb_4_layer_12_ffn_down
		mb_4_layer_12_ffn_down -> mb_4_layer_12_ffn_residual
		mb_4_layer_13_attn_norm [label="MB4 L13\nAttention Norm\nGPU: P@3"]
		mb_4_layer_13_attn_qkv [label="MB4 L13\nAttention QKV\nGPU: P@3"]
		mb_4_layer_13_attn_out [label="MB4 L13\nAttention Out\nGPU: P@3"]
		mb_4_layer_13_attn_residual [label="MB4 L13\nAttn Residual\nGPU: P@3"]
		mb_4_layer_13_ffn_norm [label="MB4 L13\nFFN Norm\nGPU: P@3"]
		mb_4_layer_13_ffn_up [label="MB4 L13\nFFN Up\nGPU: P@3"]
		mb_4_layer_13_ffn_down [label="MB4 L13\nFFN Down\nGPU: P@3"]
		mb_4_layer_13_ffn_residual [label="MB4 L13\nFFN Residual\nGPU: P@3"]
		mb_4_layer_12_ffn_residual -> mb_4_layer_13_attn_norm
		mb_4_layer_13_attn_norm -> mb_4_layer_13_attn_qkv
		mb_4_layer_13_attn_qkv -> mb_4_layer_13_attn_out
		mb_4_layer_13_attn_out -> mb_4_layer_13_attn_residual
		mb_4_layer_13_attn_residual -> mb_4_layer_13_ffn_norm
		mb_4_layer_13_ffn_norm -> mb_4_layer_13_ffn_up
		mb_4_layer_13_ffn_up -> mb_4_layer_13_ffn_down
		mb_4_layer_13_ffn_down -> mb_4_layer_13_ffn_residual
		mb_4_layer_14_attn_norm [label="MB4 L14\nAttention Norm\nGPU: P@3"]
		mb_4_layer_14_attn_qkv [label="MB4 L14\nAttention QKV\nGPU: P@3"]
		mb_4_layer_14_attn_out [label="MB4 L14\nAttention Out\nGPU: P@3"]
		mb_4_layer_14_attn_residual [label="MB4 L14\nAttn Residual\nGPU: P@3"]
		mb_4_layer_14_ffn_norm [label="MB4 L14\nFFN Norm\nGPU: P@3"]
		mb_4_layer_14_ffn_up [label="MB4 L14\nFFN Up\nGPU: P@3"]
		mb_4_layer_14_ffn_down [label="MB4 L14\nFFN Down\nGPU: P@3"]
		mb_4_layer_14_ffn_residual [label="MB4 L14\nFFN Residual\nGPU: P@3"]
		mb_4_layer_13_ffn_residual -> mb_4_layer_14_attn_norm
		mb_4_layer_14_attn_norm -> mb_4_layer_14_attn_qkv
		mb_4_layer_14_attn_qkv -> mb_4_layer_14_attn_out
		mb_4_layer_14_attn_out -> mb_4_layer_14_attn_residual
		mb_4_layer_14_attn_residual -> mb_4_layer_14_ffn_norm
		mb_4_layer_14_ffn_norm -> mb_4_layer_14_ffn_up
		mb_4_layer_14_ffn_up -> mb_4_layer_14_ffn_down
		mb_4_layer_14_ffn_down -> mb_4_layer_14_ffn_residual
		mb_4_layer_15_attn_norm [label="MB4 L15\nAttention Norm\nGPU: P@3"]
		mb_4_layer_15_attn_qkv [label="MB4 L15\nAttention QKV\nGPU: P@3"]
		mb_4_layer_15_attn_out [label="MB4 L15\nAttention Out\nGPU: P@3"]
		mb_4_layer_15_attn_residual [label="MB4 L15\nAttn Residual\nGPU: P@3"]
		mb_4_layer_15_ffn_norm [label="MB4 L15\nFFN Norm\nGPU: P@3"]
		mb_4_layer_15_ffn_up [label="MB4 L15\nFFN Up\nGPU: P@3"]
		mb_4_layer_15_ffn_down [label="MB4 L15\nFFN Down\nGPU: P@3"]
		mb_4_layer_15_ffn_residual [label="MB4 L15\nFFN Residual\nGPU: P@3"]
		mb_4_layer_14_ffn_residual -> mb_4_layer_15_attn_norm
		mb_4_layer_15_attn_norm -> mb_4_layer_15_attn_qkv
		mb_4_layer_15_attn_qkv -> mb_4_layer_15_attn_out
		mb_4_layer_15_attn_out -> mb_4_layer_15_attn_residual
		mb_4_layer_15_attn_residual -> mb_4_layer_15_ffn_norm
		mb_4_layer_15_ffn_norm -> mb_4_layer_15_ffn_up
		mb_4_layer_15_ffn_up -> mb_4_layer_15_ffn_down
		mb_4_layer_15_ffn_down -> mb_4_layer_15_ffn_residual
		mb_4_stage_2_output [label="MB4\nStage 3\nOutput\nGPU: P@3"]
		mb_4_layer_15_ffn_residual -> mb_4_stage_2_output
		mb_5_comm_stage_1 [label="Micro-Batch 5\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@2 To: P@3" fillcolor=lightyellow shape=parallelogram]
		mb_5_layer_11_attn_norm [label="MB5 L11\nAttention Norm\nGPU: P@3"]
		mb_5_layer_11_attn_qkv [label="MB5 L11\nAttention QKV\nGPU: P@3"]
		mb_5_layer_11_attn_out [label="MB5 L11\nAttention Out\nGPU: P@3"]
		mb_5_layer_11_attn_residual [label="MB5 L11\nAttn Residual\nGPU: P@3"]
		mb_5_layer_11_ffn_norm [label="MB5 L11\nFFN Norm\nGPU: P@3"]
		mb_5_layer_11_ffn_up [label="MB5 L11\nFFN Up\nGPU: P@3"]
		mb_5_layer_11_ffn_down [label="MB5 L11\nFFN Down\nGPU: P@3"]
		mb_5_layer_11_ffn_residual [label="MB5 L11\nFFN Residual\nGPU: P@3"]
		mb_5_comm_stage_1 -> mb_5_layer_11_attn_norm
		mb_5_layer_11_attn_norm -> mb_5_layer_11_attn_qkv
		mb_5_layer_11_attn_qkv -> mb_5_layer_11_attn_out
		mb_5_layer_11_attn_out -> mb_5_layer_11_attn_residual
		mb_5_layer_11_attn_residual -> mb_5_layer_11_ffn_norm
		mb_5_layer_11_ffn_norm -> mb_5_layer_11_ffn_up
		mb_5_layer_11_ffn_up -> mb_5_layer_11_ffn_down
		mb_5_layer_11_ffn_down -> mb_5_layer_11_ffn_residual
		mb_5_layer_12_attn_norm [label="MB5 L12\nAttention Norm\nGPU: P@3"]
		mb_5_layer_12_attn_qkv [label="MB5 L12\nAttention QKV\nGPU: P@3"]
		mb_5_layer_12_attn_out [label="MB5 L12\nAttention Out\nGPU: P@3"]
		mb_5_layer_12_attn_residual [label="MB5 L12\nAttn Residual\nGPU: P@3"]
		mb_5_layer_12_ffn_norm [label="MB5 L12\nFFN Norm\nGPU: P@3"]
		mb_5_layer_12_ffn_up [label="MB5 L12\nFFN Up\nGPU: P@3"]
		mb_5_layer_12_ffn_down [label="MB5 L12\nFFN Down\nGPU: P@3"]
		mb_5_layer_12_ffn_residual [label="MB5 L12\nFFN Residual\nGPU: P@3"]
		mb_5_layer_11_ffn_residual -> mb_5_layer_12_attn_norm
		mb_5_layer_12_attn_norm -> mb_5_layer_12_attn_qkv
		mb_5_layer_12_attn_qkv -> mb_5_layer_12_attn_out
		mb_5_layer_12_attn_out -> mb_5_layer_12_attn_residual
		mb_5_layer_12_attn_residual -> mb_5_layer_12_ffn_norm
		mb_5_layer_12_ffn_norm -> mb_5_layer_12_ffn_up
		mb_5_layer_12_ffn_up -> mb_5_layer_12_ffn_down
		mb_5_layer_12_ffn_down -> mb_5_layer_12_ffn_residual
		mb_5_layer_13_attn_norm [label="MB5 L13\nAttention Norm\nGPU: P@3"]
		mb_5_layer_13_attn_qkv [label="MB5 L13\nAttention QKV\nGPU: P@3"]
		mb_5_layer_13_attn_out [label="MB5 L13\nAttention Out\nGPU: P@3"]
		mb_5_layer_13_attn_residual [label="MB5 L13\nAttn Residual\nGPU: P@3"]
		mb_5_layer_13_ffn_norm [label="MB5 L13\nFFN Norm\nGPU: P@3"]
		mb_5_layer_13_ffn_up [label="MB5 L13\nFFN Up\nGPU: P@3"]
		mb_5_layer_13_ffn_down [label="MB5 L13\nFFN Down\nGPU: P@3"]
		mb_5_layer_13_ffn_residual [label="MB5 L13\nFFN Residual\nGPU: P@3"]
		mb_5_layer_12_ffn_residual -> mb_5_layer_13_attn_norm
		mb_5_layer_13_attn_norm -> mb_5_layer_13_attn_qkv
		mb_5_layer_13_attn_qkv -> mb_5_layer_13_attn_out
		mb_5_layer_13_attn_out -> mb_5_layer_13_attn_residual
		mb_5_layer_13_attn_residual -> mb_5_layer_13_ffn_norm
		mb_5_layer_13_ffn_norm -> mb_5_layer_13_ffn_up
		mb_5_layer_13_ffn_up -> mb_5_layer_13_ffn_down
		mb_5_layer_13_ffn_down -> mb_5_layer_13_ffn_residual
		mb_5_layer_14_attn_norm [label="MB5 L14\nAttention Norm\nGPU: P@3"]
		mb_5_layer_14_attn_qkv [label="MB5 L14\nAttention QKV\nGPU: P@3"]
		mb_5_layer_14_attn_out [label="MB5 L14\nAttention Out\nGPU: P@3"]
		mb_5_layer_14_attn_residual [label="MB5 L14\nAttn Residual\nGPU: P@3"]
		mb_5_layer_14_ffn_norm [label="MB5 L14\nFFN Norm\nGPU: P@3"]
		mb_5_layer_14_ffn_up [label="MB5 L14\nFFN Up\nGPU: P@3"]
		mb_5_layer_14_ffn_down [label="MB5 L14\nFFN Down\nGPU: P@3"]
		mb_5_layer_14_ffn_residual [label="MB5 L14\nFFN Residual\nGPU: P@3"]
		mb_5_layer_13_ffn_residual -> mb_5_layer_14_attn_norm
		mb_5_layer_14_attn_norm -> mb_5_layer_14_attn_qkv
		mb_5_layer_14_attn_qkv -> mb_5_layer_14_attn_out
		mb_5_layer_14_attn_out -> mb_5_layer_14_attn_residual
		mb_5_layer_14_attn_residual -> mb_5_layer_14_ffn_norm
		mb_5_layer_14_ffn_norm -> mb_5_layer_14_ffn_up
		mb_5_layer_14_ffn_up -> mb_5_layer_14_ffn_down
		mb_5_layer_14_ffn_down -> mb_5_layer_14_ffn_residual
		mb_5_layer_15_attn_norm [label="MB5 L15\nAttention Norm\nGPU: P@3"]
		mb_5_layer_15_attn_qkv [label="MB5 L15\nAttention QKV\nGPU: P@3"]
		mb_5_layer_15_attn_out [label="MB5 L15\nAttention Out\nGPU: P@3"]
		mb_5_layer_15_attn_residual [label="MB5 L15\nAttn Residual\nGPU: P@3"]
		mb_5_layer_15_ffn_norm [label="MB5 L15\nFFN Norm\nGPU: P@3"]
		mb_5_layer_15_ffn_up [label="MB5 L15\nFFN Up\nGPU: P@3"]
		mb_5_layer_15_ffn_down [label="MB5 L15\nFFN Down\nGPU: P@3"]
		mb_5_layer_15_ffn_residual [label="MB5 L15\nFFN Residual\nGPU: P@3"]
		mb_5_layer_14_ffn_residual -> mb_5_layer_15_attn_norm
		mb_5_layer_15_attn_norm -> mb_5_layer_15_attn_qkv
		mb_5_layer_15_attn_qkv -> mb_5_layer_15_attn_out
		mb_5_layer_15_attn_out -> mb_5_layer_15_attn_residual
		mb_5_layer_15_attn_residual -> mb_5_layer_15_ffn_norm
		mb_5_layer_15_ffn_norm -> mb_5_layer_15_ffn_up
		mb_5_layer_15_ffn_up -> mb_5_layer_15_ffn_down
		mb_5_layer_15_ffn_down -> mb_5_layer_15_ffn_residual
		mb_5_stage_2_output [label="MB5\nStage 3\nOutput\nGPU: P@3"]
		mb_5_layer_15_ffn_residual -> mb_5_stage_2_output
	}
	mb_0_stage_2_output -> mb_0_comm_stage_2
	mb_1_stage_2_output -> mb_1_comm_stage_2
	mb_2_stage_2_output -> mb_2_comm_stage_2
	mb_3_stage_2_output -> mb_3_comm_stage_2
	mb_4_stage_2_output -> mb_4_comm_stage_2
	mb_5_stage_2_output -> mb_5_comm_stage_2
	subgraph cluster_stage_3 {
		label="Stage 4\nP@4\nLayers 16-20" style=dashed
		mb_0_comm_stage_2 [label="Micro-Batch 0\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@3 To: P@4" fillcolor=lightyellow shape=parallelogram]
		mb_0_layer_16_attn_norm [label="MB0 L16\nAttention Norm\nGPU: P@4"]
		mb_0_layer_16_attn_qkv [label="MB0 L16\nAttention QKV\nGPU: P@4"]
		mb_0_layer_16_attn_out [label="MB0 L16\nAttention Out\nGPU: P@4"]
		mb_0_layer_16_attn_residual [label="MB0 L16\nAttn Residual\nGPU: P@4"]
		mb_0_layer_16_ffn_norm [label="MB0 L16\nFFN Norm\nGPU: P@4"]
		mb_0_layer_16_ffn_up [label="MB0 L16\nFFN Up\nGPU: P@4"]
		mb_0_layer_16_ffn_down [label="MB0 L16\nFFN Down\nGPU: P@4"]
		mb_0_layer_16_ffn_residual [label="MB0 L16\nFFN Residual\nGPU: P@4"]
		mb_0_comm_stage_2 -> mb_0_layer_16_attn_norm
		mb_0_layer_16_attn_norm -> mb_0_layer_16_attn_qkv
		mb_0_layer_16_attn_qkv -> mb_0_layer_16_attn_out
		mb_0_layer_16_attn_out -> mb_0_layer_16_attn_residual
		mb_0_layer_16_attn_residual -> mb_0_layer_16_ffn_norm
		mb_0_layer_16_ffn_norm -> mb_0_layer_16_ffn_up
		mb_0_layer_16_ffn_up -> mb_0_layer_16_ffn_down
		mb_0_layer_16_ffn_down -> mb_0_layer_16_ffn_residual
		mb_0_layer_17_attn_norm [label="MB0 L17\nAttention Norm\nGPU: P@4"]
		mb_0_layer_17_attn_qkv [label="MB0 L17\nAttention QKV\nGPU: P@4"]
		mb_0_layer_17_attn_out [label="MB0 L17\nAttention Out\nGPU: P@4"]
		mb_0_layer_17_attn_residual [label="MB0 L17\nAttn Residual\nGPU: P@4"]
		mb_0_layer_17_ffn_norm [label="MB0 L17\nFFN Norm\nGPU: P@4"]
		mb_0_layer_17_ffn_up [label="MB0 L17\nFFN Up\nGPU: P@4"]
		mb_0_layer_17_ffn_down [label="MB0 L17\nFFN Down\nGPU: P@4"]
		mb_0_layer_17_ffn_residual [label="MB0 L17\nFFN Residual\nGPU: P@4"]
		mb_0_layer_16_ffn_residual -> mb_0_layer_17_attn_norm
		mb_0_layer_17_attn_norm -> mb_0_layer_17_attn_qkv
		mb_0_layer_17_attn_qkv -> mb_0_layer_17_attn_out
		mb_0_layer_17_attn_out -> mb_0_layer_17_attn_residual
		mb_0_layer_17_attn_residual -> mb_0_layer_17_ffn_norm
		mb_0_layer_17_ffn_norm -> mb_0_layer_17_ffn_up
		mb_0_layer_17_ffn_up -> mb_0_layer_17_ffn_down
		mb_0_layer_17_ffn_down -> mb_0_layer_17_ffn_residual
		mb_0_layer_18_attn_norm [label="MB0 L18\nAttention Norm\nGPU: P@4"]
		mb_0_layer_18_attn_qkv [label="MB0 L18\nAttention QKV\nGPU: P@4"]
		mb_0_layer_18_attn_out [label="MB0 L18\nAttention Out\nGPU: P@4"]
		mb_0_layer_18_attn_residual [label="MB0 L18\nAttn Residual\nGPU: P@4"]
		mb_0_layer_18_ffn_norm [label="MB0 L18\nFFN Norm\nGPU: P@4"]
		mb_0_layer_18_ffn_up [label="MB0 L18\nFFN Up\nGPU: P@4"]
		mb_0_layer_18_ffn_down [label="MB0 L18\nFFN Down\nGPU: P@4"]
		mb_0_layer_18_ffn_residual [label="MB0 L18\nFFN Residual\nGPU: P@4"]
		mb_0_layer_17_ffn_residual -> mb_0_layer_18_attn_norm
		mb_0_layer_18_attn_norm -> mb_0_layer_18_attn_qkv
		mb_0_layer_18_attn_qkv -> mb_0_layer_18_attn_out
		mb_0_layer_18_attn_out -> mb_0_layer_18_attn_residual
		mb_0_layer_18_attn_residual -> mb_0_layer_18_ffn_norm
		mb_0_layer_18_ffn_norm -> mb_0_layer_18_ffn_up
		mb_0_layer_18_ffn_up -> mb_0_layer_18_ffn_down
		mb_0_layer_18_ffn_down -> mb_0_layer_18_ffn_residual
		mb_0_layer_19_attn_norm [label="MB0 L19\nAttention Norm\nGPU: P@4"]
		mb_0_layer_19_attn_qkv [label="MB0 L19\nAttention QKV\nGPU: P@4"]
		mb_0_layer_19_attn_out [label="MB0 L19\nAttention Out\nGPU: P@4"]
		mb_0_layer_19_attn_residual [label="MB0 L19\nAttn Residual\nGPU: P@4"]
		mb_0_layer_19_ffn_norm [label="MB0 L19\nFFN Norm\nGPU: P@4"]
		mb_0_layer_19_ffn_up [label="MB0 L19\nFFN Up\nGPU: P@4"]
		mb_0_layer_19_ffn_down [label="MB0 L19\nFFN Down\nGPU: P@4"]
		mb_0_layer_19_ffn_residual [label="MB0 L19\nFFN Residual\nGPU: P@4"]
		mb_0_layer_18_ffn_residual -> mb_0_layer_19_attn_norm
		mb_0_layer_19_attn_norm -> mb_0_layer_19_attn_qkv
		mb_0_layer_19_attn_qkv -> mb_0_layer_19_attn_out
		mb_0_layer_19_attn_out -> mb_0_layer_19_attn_residual
		mb_0_layer_19_attn_residual -> mb_0_layer_19_ffn_norm
		mb_0_layer_19_ffn_norm -> mb_0_layer_19_ffn_up
		mb_0_layer_19_ffn_up -> mb_0_layer_19_ffn_down
		mb_0_layer_19_ffn_down -> mb_0_layer_19_ffn_residual
		mb_0_layer_20_attn_norm [label="MB0 L20\nAttention Norm\nGPU: P@4"]
		mb_0_layer_20_attn_qkv [label="MB0 L20\nAttention QKV\nGPU: P@4"]
		mb_0_layer_20_attn_out [label="MB0 L20\nAttention Out\nGPU: P@4"]
		mb_0_layer_20_attn_residual [label="MB0 L20\nAttn Residual\nGPU: P@4"]
		mb_0_layer_20_ffn_norm [label="MB0 L20\nFFN Norm\nGPU: P@4"]
		mb_0_layer_20_ffn_up [label="MB0 L20\nFFN Up\nGPU: P@4"]
		mb_0_layer_20_ffn_down [label="MB0 L20\nFFN Down\nGPU: P@4"]
		mb_0_layer_20_ffn_residual [label="MB0 L20\nFFN Residual\nGPU: P@4"]
		mb_0_layer_19_ffn_residual -> mb_0_layer_20_attn_norm
		mb_0_layer_20_attn_norm -> mb_0_layer_20_attn_qkv
		mb_0_layer_20_attn_qkv -> mb_0_layer_20_attn_out
		mb_0_layer_20_attn_out -> mb_0_layer_20_attn_residual
		mb_0_layer_20_attn_residual -> mb_0_layer_20_ffn_norm
		mb_0_layer_20_ffn_norm -> mb_0_layer_20_ffn_up
		mb_0_layer_20_ffn_up -> mb_0_layer_20_ffn_down
		mb_0_layer_20_ffn_down -> mb_0_layer_20_ffn_residual
		mb_0_stage_3_output [label="MB0\nStage 4\nOutput\nGPU: P@4"]
		mb_0_layer_20_ffn_residual -> mb_0_stage_3_output
		mb_1_comm_stage_2 [label="Micro-Batch 1\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@3 To: P@4" fillcolor=lightyellow shape=parallelogram]
		mb_1_layer_16_attn_norm [label="MB1 L16\nAttention Norm\nGPU: P@4"]
		mb_1_layer_16_attn_qkv [label="MB1 L16\nAttention QKV\nGPU: P@4"]
		mb_1_layer_16_attn_out [label="MB1 L16\nAttention Out\nGPU: P@4"]
		mb_1_layer_16_attn_residual [label="MB1 L16\nAttn Residual\nGPU: P@4"]
		mb_1_layer_16_ffn_norm [label="MB1 L16\nFFN Norm\nGPU: P@4"]
		mb_1_layer_16_ffn_up [label="MB1 L16\nFFN Up\nGPU: P@4"]
		mb_1_layer_16_ffn_down [label="MB1 L16\nFFN Down\nGPU: P@4"]
		mb_1_layer_16_ffn_residual [label="MB1 L16\nFFN Residual\nGPU: P@4"]
		mb_1_comm_stage_2 -> mb_1_layer_16_attn_norm
		mb_1_layer_16_attn_norm -> mb_1_layer_16_attn_qkv
		mb_1_layer_16_attn_qkv -> mb_1_layer_16_attn_out
		mb_1_layer_16_attn_out -> mb_1_layer_16_attn_residual
		mb_1_layer_16_attn_residual -> mb_1_layer_16_ffn_norm
		mb_1_layer_16_ffn_norm -> mb_1_layer_16_ffn_up
		mb_1_layer_16_ffn_up -> mb_1_layer_16_ffn_down
		mb_1_layer_16_ffn_down -> mb_1_layer_16_ffn_residual
		mb_1_layer_17_attn_norm [label="MB1 L17\nAttention Norm\nGPU: P@4"]
		mb_1_layer_17_attn_qkv [label="MB1 L17\nAttention QKV\nGPU: P@4"]
		mb_1_layer_17_attn_out [label="MB1 L17\nAttention Out\nGPU: P@4"]
		mb_1_layer_17_attn_residual [label="MB1 L17\nAttn Residual\nGPU: P@4"]
		mb_1_layer_17_ffn_norm [label="MB1 L17\nFFN Norm\nGPU: P@4"]
		mb_1_layer_17_ffn_up [label="MB1 L17\nFFN Up\nGPU: P@4"]
		mb_1_layer_17_ffn_down [label="MB1 L17\nFFN Down\nGPU: P@4"]
		mb_1_layer_17_ffn_residual [label="MB1 L17\nFFN Residual\nGPU: P@4"]
		mb_1_layer_16_ffn_residual -> mb_1_layer_17_attn_norm
		mb_1_layer_17_attn_norm -> mb_1_layer_17_attn_qkv
		mb_1_layer_17_attn_qkv -> mb_1_layer_17_attn_out
		mb_1_layer_17_attn_out -> mb_1_layer_17_attn_residual
		mb_1_layer_17_attn_residual -> mb_1_layer_17_ffn_norm
		mb_1_layer_17_ffn_norm -> mb_1_layer_17_ffn_up
		mb_1_layer_17_ffn_up -> mb_1_layer_17_ffn_down
		mb_1_layer_17_ffn_down -> mb_1_layer_17_ffn_residual
		mb_1_layer_18_attn_norm [label="MB1 L18\nAttention Norm\nGPU: P@4"]
		mb_1_layer_18_attn_qkv [label="MB1 L18\nAttention QKV\nGPU: P@4"]
		mb_1_layer_18_attn_out [label="MB1 L18\nAttention Out\nGPU: P@4"]
		mb_1_layer_18_attn_residual [label="MB1 L18\nAttn Residual\nGPU: P@4"]
		mb_1_layer_18_ffn_norm [label="MB1 L18\nFFN Norm\nGPU: P@4"]
		mb_1_layer_18_ffn_up [label="MB1 L18\nFFN Up\nGPU: P@4"]
		mb_1_layer_18_ffn_down [label="MB1 L18\nFFN Down\nGPU: P@4"]
		mb_1_layer_18_ffn_residual [label="MB1 L18\nFFN Residual\nGPU: P@4"]
		mb_1_layer_17_ffn_residual -> mb_1_layer_18_attn_norm
		mb_1_layer_18_attn_norm -> mb_1_layer_18_attn_qkv
		mb_1_layer_18_attn_qkv -> mb_1_layer_18_attn_out
		mb_1_layer_18_attn_out -> mb_1_layer_18_attn_residual
		mb_1_layer_18_attn_residual -> mb_1_layer_18_ffn_norm
		mb_1_layer_18_ffn_norm -> mb_1_layer_18_ffn_up
		mb_1_layer_18_ffn_up -> mb_1_layer_18_ffn_down
		mb_1_layer_18_ffn_down -> mb_1_layer_18_ffn_residual
		mb_1_layer_19_attn_norm [label="MB1 L19\nAttention Norm\nGPU: P@4"]
		mb_1_layer_19_attn_qkv [label="MB1 L19\nAttention QKV\nGPU: P@4"]
		mb_1_layer_19_attn_out [label="MB1 L19\nAttention Out\nGPU: P@4"]
		mb_1_layer_19_attn_residual [label="MB1 L19\nAttn Residual\nGPU: P@4"]
		mb_1_layer_19_ffn_norm [label="MB1 L19\nFFN Norm\nGPU: P@4"]
		mb_1_layer_19_ffn_up [label="MB1 L19\nFFN Up\nGPU: P@4"]
		mb_1_layer_19_ffn_down [label="MB1 L19\nFFN Down\nGPU: P@4"]
		mb_1_layer_19_ffn_residual [label="MB1 L19\nFFN Residual\nGPU: P@4"]
		mb_1_layer_18_ffn_residual -> mb_1_layer_19_attn_norm
		mb_1_layer_19_attn_norm -> mb_1_layer_19_attn_qkv
		mb_1_layer_19_attn_qkv -> mb_1_layer_19_attn_out
		mb_1_layer_19_attn_out -> mb_1_layer_19_attn_residual
		mb_1_layer_19_attn_residual -> mb_1_layer_19_ffn_norm
		mb_1_layer_19_ffn_norm -> mb_1_layer_19_ffn_up
		mb_1_layer_19_ffn_up -> mb_1_layer_19_ffn_down
		mb_1_layer_19_ffn_down -> mb_1_layer_19_ffn_residual
		mb_1_layer_20_attn_norm [label="MB1 L20\nAttention Norm\nGPU: P@4"]
		mb_1_layer_20_attn_qkv [label="MB1 L20\nAttention QKV\nGPU: P@4"]
		mb_1_layer_20_attn_out [label="MB1 L20\nAttention Out\nGPU: P@4"]
		mb_1_layer_20_attn_residual [label="MB1 L20\nAttn Residual\nGPU: P@4"]
		mb_1_layer_20_ffn_norm [label="MB1 L20\nFFN Norm\nGPU: P@4"]
		mb_1_layer_20_ffn_up [label="MB1 L20\nFFN Up\nGPU: P@4"]
		mb_1_layer_20_ffn_down [label="MB1 L20\nFFN Down\nGPU: P@4"]
		mb_1_layer_20_ffn_residual [label="MB1 L20\nFFN Residual\nGPU: P@4"]
		mb_1_layer_19_ffn_residual -> mb_1_layer_20_attn_norm
		mb_1_layer_20_attn_norm -> mb_1_layer_20_attn_qkv
		mb_1_layer_20_attn_qkv -> mb_1_layer_20_attn_out
		mb_1_layer_20_attn_out -> mb_1_layer_20_attn_residual
		mb_1_layer_20_attn_residual -> mb_1_layer_20_ffn_norm
		mb_1_layer_20_ffn_norm -> mb_1_layer_20_ffn_up
		mb_1_layer_20_ffn_up -> mb_1_layer_20_ffn_down
		mb_1_layer_20_ffn_down -> mb_1_layer_20_ffn_residual
		mb_1_stage_3_output [label="MB1\nStage 4\nOutput\nGPU: P@4"]
		mb_1_layer_20_ffn_residual -> mb_1_stage_3_output
		mb_2_comm_stage_2 [label="Micro-Batch 2\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@3 To: P@4" fillcolor=lightyellow shape=parallelogram]
		mb_2_layer_16_attn_norm [label="MB2 L16\nAttention Norm\nGPU: P@4"]
		mb_2_layer_16_attn_qkv [label="MB2 L16\nAttention QKV\nGPU: P@4"]
		mb_2_layer_16_attn_out [label="MB2 L16\nAttention Out\nGPU: P@4"]
		mb_2_layer_16_attn_residual [label="MB2 L16\nAttn Residual\nGPU: P@4"]
		mb_2_layer_16_ffn_norm [label="MB2 L16\nFFN Norm\nGPU: P@4"]
		mb_2_layer_16_ffn_up [label="MB2 L16\nFFN Up\nGPU: P@4"]
		mb_2_layer_16_ffn_down [label="MB2 L16\nFFN Down\nGPU: P@4"]
		mb_2_layer_16_ffn_residual [label="MB2 L16\nFFN Residual\nGPU: P@4"]
		mb_2_comm_stage_2 -> mb_2_layer_16_attn_norm
		mb_2_layer_16_attn_norm -> mb_2_layer_16_attn_qkv
		mb_2_layer_16_attn_qkv -> mb_2_layer_16_attn_out
		mb_2_layer_16_attn_out -> mb_2_layer_16_attn_residual
		mb_2_layer_16_attn_residual -> mb_2_layer_16_ffn_norm
		mb_2_layer_16_ffn_norm -> mb_2_layer_16_ffn_up
		mb_2_layer_16_ffn_up -> mb_2_layer_16_ffn_down
		mb_2_layer_16_ffn_down -> mb_2_layer_16_ffn_residual
		mb_2_layer_17_attn_norm [label="MB2 L17\nAttention Norm\nGPU: P@4"]
		mb_2_layer_17_attn_qkv [label="MB2 L17\nAttention QKV\nGPU: P@4"]
		mb_2_layer_17_attn_out [label="MB2 L17\nAttention Out\nGPU: P@4"]
		mb_2_layer_17_attn_residual [label="MB2 L17\nAttn Residual\nGPU: P@4"]
		mb_2_layer_17_ffn_norm [label="MB2 L17\nFFN Norm\nGPU: P@4"]
		mb_2_layer_17_ffn_up [label="MB2 L17\nFFN Up\nGPU: P@4"]
		mb_2_layer_17_ffn_down [label="MB2 L17\nFFN Down\nGPU: P@4"]
		mb_2_layer_17_ffn_residual [label="MB2 L17\nFFN Residual\nGPU: P@4"]
		mb_2_layer_16_ffn_residual -> mb_2_layer_17_attn_norm
		mb_2_layer_17_attn_norm -> mb_2_layer_17_attn_qkv
		mb_2_layer_17_attn_qkv -> mb_2_layer_17_attn_out
		mb_2_layer_17_attn_out -> mb_2_layer_17_attn_residual
		mb_2_layer_17_attn_residual -> mb_2_layer_17_ffn_norm
		mb_2_layer_17_ffn_norm -> mb_2_layer_17_ffn_up
		mb_2_layer_17_ffn_up -> mb_2_layer_17_ffn_down
		mb_2_layer_17_ffn_down -> mb_2_layer_17_ffn_residual
		mb_2_layer_18_attn_norm [label="MB2 L18\nAttention Norm\nGPU: P@4"]
		mb_2_layer_18_attn_qkv [label="MB2 L18\nAttention QKV\nGPU: P@4"]
		mb_2_layer_18_attn_out [label="MB2 L18\nAttention Out\nGPU: P@4"]
		mb_2_layer_18_attn_residual [label="MB2 L18\nAttn Residual\nGPU: P@4"]
		mb_2_layer_18_ffn_norm [label="MB2 L18\nFFN Norm\nGPU: P@4"]
		mb_2_layer_18_ffn_up [label="MB2 L18\nFFN Up\nGPU: P@4"]
		mb_2_layer_18_ffn_down [label="MB2 L18\nFFN Down\nGPU: P@4"]
		mb_2_layer_18_ffn_residual [label="MB2 L18\nFFN Residual\nGPU: P@4"]
		mb_2_layer_17_ffn_residual -> mb_2_layer_18_attn_norm
		mb_2_layer_18_attn_norm -> mb_2_layer_18_attn_qkv
		mb_2_layer_18_attn_qkv -> mb_2_layer_18_attn_out
		mb_2_layer_18_attn_out -> mb_2_layer_18_attn_residual
		mb_2_layer_18_attn_residual -> mb_2_layer_18_ffn_norm
		mb_2_layer_18_ffn_norm -> mb_2_layer_18_ffn_up
		mb_2_layer_18_ffn_up -> mb_2_layer_18_ffn_down
		mb_2_layer_18_ffn_down -> mb_2_layer_18_ffn_residual
		mb_2_layer_19_attn_norm [label="MB2 L19\nAttention Norm\nGPU: P@4"]
		mb_2_layer_19_attn_qkv [label="MB2 L19\nAttention QKV\nGPU: P@4"]
		mb_2_layer_19_attn_out [label="MB2 L19\nAttention Out\nGPU: P@4"]
		mb_2_layer_19_attn_residual [label="MB2 L19\nAttn Residual\nGPU: P@4"]
		mb_2_layer_19_ffn_norm [label="MB2 L19\nFFN Norm\nGPU: P@4"]
		mb_2_layer_19_ffn_up [label="MB2 L19\nFFN Up\nGPU: P@4"]
		mb_2_layer_19_ffn_down [label="MB2 L19\nFFN Down\nGPU: P@4"]
		mb_2_layer_19_ffn_residual [label="MB2 L19\nFFN Residual\nGPU: P@4"]
		mb_2_layer_18_ffn_residual -> mb_2_layer_19_attn_norm
		mb_2_layer_19_attn_norm -> mb_2_layer_19_attn_qkv
		mb_2_layer_19_attn_qkv -> mb_2_layer_19_attn_out
		mb_2_layer_19_attn_out -> mb_2_layer_19_attn_residual
		mb_2_layer_19_attn_residual -> mb_2_layer_19_ffn_norm
		mb_2_layer_19_ffn_norm -> mb_2_layer_19_ffn_up
		mb_2_layer_19_ffn_up -> mb_2_layer_19_ffn_down
		mb_2_layer_19_ffn_down -> mb_2_layer_19_ffn_residual
		mb_2_layer_20_attn_norm [label="MB2 L20\nAttention Norm\nGPU: P@4"]
		mb_2_layer_20_attn_qkv [label="MB2 L20\nAttention QKV\nGPU: P@4"]
		mb_2_layer_20_attn_out [label="MB2 L20\nAttention Out\nGPU: P@4"]
		mb_2_layer_20_attn_residual [label="MB2 L20\nAttn Residual\nGPU: P@4"]
		mb_2_layer_20_ffn_norm [label="MB2 L20\nFFN Norm\nGPU: P@4"]
		mb_2_layer_20_ffn_up [label="MB2 L20\nFFN Up\nGPU: P@4"]
		mb_2_layer_20_ffn_down [label="MB2 L20\nFFN Down\nGPU: P@4"]
		mb_2_layer_20_ffn_residual [label="MB2 L20\nFFN Residual\nGPU: P@4"]
		mb_2_layer_19_ffn_residual -> mb_2_layer_20_attn_norm
		mb_2_layer_20_attn_norm -> mb_2_layer_20_attn_qkv
		mb_2_layer_20_attn_qkv -> mb_2_layer_20_attn_out
		mb_2_layer_20_attn_out -> mb_2_layer_20_attn_residual
		mb_2_layer_20_attn_residual -> mb_2_layer_20_ffn_norm
		mb_2_layer_20_ffn_norm -> mb_2_layer_20_ffn_up
		mb_2_layer_20_ffn_up -> mb_2_layer_20_ffn_down
		mb_2_layer_20_ffn_down -> mb_2_layer_20_ffn_residual
		mb_2_stage_3_output [label="MB2\nStage 4\nOutput\nGPU: P@4"]
		mb_2_layer_20_ffn_residual -> mb_2_stage_3_output
		mb_3_comm_stage_2 [label="Micro-Batch 3\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@3 To: P@4" fillcolor=lightyellow shape=parallelogram]
		mb_3_layer_16_attn_norm [label="MB3 L16\nAttention Norm\nGPU: P@4"]
		mb_3_layer_16_attn_qkv [label="MB3 L16\nAttention QKV\nGPU: P@4"]
		mb_3_layer_16_attn_out [label="MB3 L16\nAttention Out\nGPU: P@4"]
		mb_3_layer_16_attn_residual [label="MB3 L16\nAttn Residual\nGPU: P@4"]
		mb_3_layer_16_ffn_norm [label="MB3 L16\nFFN Norm\nGPU: P@4"]
		mb_3_layer_16_ffn_up [label="MB3 L16\nFFN Up\nGPU: P@4"]
		mb_3_layer_16_ffn_down [label="MB3 L16\nFFN Down\nGPU: P@4"]
		mb_3_layer_16_ffn_residual [label="MB3 L16\nFFN Residual\nGPU: P@4"]
		mb_3_comm_stage_2 -> mb_3_layer_16_attn_norm
		mb_3_layer_16_attn_norm -> mb_3_layer_16_attn_qkv
		mb_3_layer_16_attn_qkv -> mb_3_layer_16_attn_out
		mb_3_layer_16_attn_out -> mb_3_layer_16_attn_residual
		mb_3_layer_16_attn_residual -> mb_3_layer_16_ffn_norm
		mb_3_layer_16_ffn_norm -> mb_3_layer_16_ffn_up
		mb_3_layer_16_ffn_up -> mb_3_layer_16_ffn_down
		mb_3_layer_16_ffn_down -> mb_3_layer_16_ffn_residual
		mb_3_layer_17_attn_norm [label="MB3 L17\nAttention Norm\nGPU: P@4"]
		mb_3_layer_17_attn_qkv [label="MB3 L17\nAttention QKV\nGPU: P@4"]
		mb_3_layer_17_attn_out [label="MB3 L17\nAttention Out\nGPU: P@4"]
		mb_3_layer_17_attn_residual [label="MB3 L17\nAttn Residual\nGPU: P@4"]
		mb_3_layer_17_ffn_norm [label="MB3 L17\nFFN Norm\nGPU: P@4"]
		mb_3_layer_17_ffn_up [label="MB3 L17\nFFN Up\nGPU: P@4"]
		mb_3_layer_17_ffn_down [label="MB3 L17\nFFN Down\nGPU: P@4"]
		mb_3_layer_17_ffn_residual [label="MB3 L17\nFFN Residual\nGPU: P@4"]
		mb_3_layer_16_ffn_residual -> mb_3_layer_17_attn_norm
		mb_3_layer_17_attn_norm -> mb_3_layer_17_attn_qkv
		mb_3_layer_17_attn_qkv -> mb_3_layer_17_attn_out
		mb_3_layer_17_attn_out -> mb_3_layer_17_attn_residual
		mb_3_layer_17_attn_residual -> mb_3_layer_17_ffn_norm
		mb_3_layer_17_ffn_norm -> mb_3_layer_17_ffn_up
		mb_3_layer_17_ffn_up -> mb_3_layer_17_ffn_down
		mb_3_layer_17_ffn_down -> mb_3_layer_17_ffn_residual
		mb_3_layer_18_attn_norm [label="MB3 L18\nAttention Norm\nGPU: P@4"]
		mb_3_layer_18_attn_qkv [label="MB3 L18\nAttention QKV\nGPU: P@4"]
		mb_3_layer_18_attn_out [label="MB3 L18\nAttention Out\nGPU: P@4"]
		mb_3_layer_18_attn_residual [label="MB3 L18\nAttn Residual\nGPU: P@4"]
		mb_3_layer_18_ffn_norm [label="MB3 L18\nFFN Norm\nGPU: P@4"]
		mb_3_layer_18_ffn_up [label="MB3 L18\nFFN Up\nGPU: P@4"]
		mb_3_layer_18_ffn_down [label="MB3 L18\nFFN Down\nGPU: P@4"]
		mb_3_layer_18_ffn_residual [label="MB3 L18\nFFN Residual\nGPU: P@4"]
		mb_3_layer_17_ffn_residual -> mb_3_layer_18_attn_norm
		mb_3_layer_18_attn_norm -> mb_3_layer_18_attn_qkv
		mb_3_layer_18_attn_qkv -> mb_3_layer_18_attn_out
		mb_3_layer_18_attn_out -> mb_3_layer_18_attn_residual
		mb_3_layer_18_attn_residual -> mb_3_layer_18_ffn_norm
		mb_3_layer_18_ffn_norm -> mb_3_layer_18_ffn_up
		mb_3_layer_18_ffn_up -> mb_3_layer_18_ffn_down
		mb_3_layer_18_ffn_down -> mb_3_layer_18_ffn_residual
		mb_3_layer_19_attn_norm [label="MB3 L19\nAttention Norm\nGPU: P@4"]
		mb_3_layer_19_attn_qkv [label="MB3 L19\nAttention QKV\nGPU: P@4"]
		mb_3_layer_19_attn_out [label="MB3 L19\nAttention Out\nGPU: P@4"]
		mb_3_layer_19_attn_residual [label="MB3 L19\nAttn Residual\nGPU: P@4"]
		mb_3_layer_19_ffn_norm [label="MB3 L19\nFFN Norm\nGPU: P@4"]
		mb_3_layer_19_ffn_up [label="MB3 L19\nFFN Up\nGPU: P@4"]
		mb_3_layer_19_ffn_down [label="MB3 L19\nFFN Down\nGPU: P@4"]
		mb_3_layer_19_ffn_residual [label="MB3 L19\nFFN Residual\nGPU: P@4"]
		mb_3_layer_18_ffn_residual -> mb_3_layer_19_attn_norm
		mb_3_layer_19_attn_norm -> mb_3_layer_19_attn_qkv
		mb_3_layer_19_attn_qkv -> mb_3_layer_19_attn_out
		mb_3_layer_19_attn_out -> mb_3_layer_19_attn_residual
		mb_3_layer_19_attn_residual -> mb_3_layer_19_ffn_norm
		mb_3_layer_19_ffn_norm -> mb_3_layer_19_ffn_up
		mb_3_layer_19_ffn_up -> mb_3_layer_19_ffn_down
		mb_3_layer_19_ffn_down -> mb_3_layer_19_ffn_residual
		mb_3_layer_20_attn_norm [label="MB3 L20\nAttention Norm\nGPU: P@4"]
		mb_3_layer_20_attn_qkv [label="MB3 L20\nAttention QKV\nGPU: P@4"]
		mb_3_layer_20_attn_out [label="MB3 L20\nAttention Out\nGPU: P@4"]
		mb_3_layer_20_attn_residual [label="MB3 L20\nAttn Residual\nGPU: P@4"]
		mb_3_layer_20_ffn_norm [label="MB3 L20\nFFN Norm\nGPU: P@4"]
		mb_3_layer_20_ffn_up [label="MB3 L20\nFFN Up\nGPU: P@4"]
		mb_3_layer_20_ffn_down [label="MB3 L20\nFFN Down\nGPU: P@4"]
		mb_3_layer_20_ffn_residual [label="MB3 L20\nFFN Residual\nGPU: P@4"]
		mb_3_layer_19_ffn_residual -> mb_3_layer_20_attn_norm
		mb_3_layer_20_attn_norm -> mb_3_layer_20_attn_qkv
		mb_3_layer_20_attn_qkv -> mb_3_layer_20_attn_out
		mb_3_layer_20_attn_out -> mb_3_layer_20_attn_residual
		mb_3_layer_20_attn_residual -> mb_3_layer_20_ffn_norm
		mb_3_layer_20_ffn_norm -> mb_3_layer_20_ffn_up
		mb_3_layer_20_ffn_up -> mb_3_layer_20_ffn_down
		mb_3_layer_20_ffn_down -> mb_3_layer_20_ffn_residual
		mb_3_stage_3_output [label="MB3\nStage 4\nOutput\nGPU: P@4"]
		mb_3_layer_20_ffn_residual -> mb_3_stage_3_output
		mb_4_comm_stage_2 [label="Micro-Batch 4\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@3 To: P@4" fillcolor=lightyellow shape=parallelogram]
		mb_4_layer_16_attn_norm [label="MB4 L16\nAttention Norm\nGPU: P@4"]
		mb_4_layer_16_attn_qkv [label="MB4 L16\nAttention QKV\nGPU: P@4"]
		mb_4_layer_16_attn_out [label="MB4 L16\nAttention Out\nGPU: P@4"]
		mb_4_layer_16_attn_residual [label="MB4 L16\nAttn Residual\nGPU: P@4"]
		mb_4_layer_16_ffn_norm [label="MB4 L16\nFFN Norm\nGPU: P@4"]
		mb_4_layer_16_ffn_up [label="MB4 L16\nFFN Up\nGPU: P@4"]
		mb_4_layer_16_ffn_down [label="MB4 L16\nFFN Down\nGPU: P@4"]
		mb_4_layer_16_ffn_residual [label="MB4 L16\nFFN Residual\nGPU: P@4"]
		mb_4_comm_stage_2 -> mb_4_layer_16_attn_norm
		mb_4_layer_16_attn_norm -> mb_4_layer_16_attn_qkv
		mb_4_layer_16_attn_qkv -> mb_4_layer_16_attn_out
		mb_4_layer_16_attn_out -> mb_4_layer_16_attn_residual
		mb_4_layer_16_attn_residual -> mb_4_layer_16_ffn_norm
		mb_4_layer_16_ffn_norm -> mb_4_layer_16_ffn_up
		mb_4_layer_16_ffn_up -> mb_4_layer_16_ffn_down
		mb_4_layer_16_ffn_down -> mb_4_layer_16_ffn_residual
		mb_4_layer_17_attn_norm [label="MB4 L17\nAttention Norm\nGPU: P@4"]
		mb_4_layer_17_attn_qkv [label="MB4 L17\nAttention QKV\nGPU: P@4"]
		mb_4_layer_17_attn_out [label="MB4 L17\nAttention Out\nGPU: P@4"]
		mb_4_layer_17_attn_residual [label="MB4 L17\nAttn Residual\nGPU: P@4"]
		mb_4_layer_17_ffn_norm [label="MB4 L17\nFFN Norm\nGPU: P@4"]
		mb_4_layer_17_ffn_up [label="MB4 L17\nFFN Up\nGPU: P@4"]
		mb_4_layer_17_ffn_down [label="MB4 L17\nFFN Down\nGPU: P@4"]
		mb_4_layer_17_ffn_residual [label="MB4 L17\nFFN Residual\nGPU: P@4"]
		mb_4_layer_16_ffn_residual -> mb_4_layer_17_attn_norm
		mb_4_layer_17_attn_norm -> mb_4_layer_17_attn_qkv
		mb_4_layer_17_attn_qkv -> mb_4_layer_17_attn_out
		mb_4_layer_17_attn_out -> mb_4_layer_17_attn_residual
		mb_4_layer_17_attn_residual -> mb_4_layer_17_ffn_norm
		mb_4_layer_17_ffn_norm -> mb_4_layer_17_ffn_up
		mb_4_layer_17_ffn_up -> mb_4_layer_17_ffn_down
		mb_4_layer_17_ffn_down -> mb_4_layer_17_ffn_residual
		mb_4_layer_18_attn_norm [label="MB4 L18\nAttention Norm\nGPU: P@4"]
		mb_4_layer_18_attn_qkv [label="MB4 L18\nAttention QKV\nGPU: P@4"]
		mb_4_layer_18_attn_out [label="MB4 L18\nAttention Out\nGPU: P@4"]
		mb_4_layer_18_attn_residual [label="MB4 L18\nAttn Residual\nGPU: P@4"]
		mb_4_layer_18_ffn_norm [label="MB4 L18\nFFN Norm\nGPU: P@4"]
		mb_4_layer_18_ffn_up [label="MB4 L18\nFFN Up\nGPU: P@4"]
		mb_4_layer_18_ffn_down [label="MB4 L18\nFFN Down\nGPU: P@4"]
		mb_4_layer_18_ffn_residual [label="MB4 L18\nFFN Residual\nGPU: P@4"]
		mb_4_layer_17_ffn_residual -> mb_4_layer_18_attn_norm
		mb_4_layer_18_attn_norm -> mb_4_layer_18_attn_qkv
		mb_4_layer_18_attn_qkv -> mb_4_layer_18_attn_out
		mb_4_layer_18_attn_out -> mb_4_layer_18_attn_residual
		mb_4_layer_18_attn_residual -> mb_4_layer_18_ffn_norm
		mb_4_layer_18_ffn_norm -> mb_4_layer_18_ffn_up
		mb_4_layer_18_ffn_up -> mb_4_layer_18_ffn_down
		mb_4_layer_18_ffn_down -> mb_4_layer_18_ffn_residual
		mb_4_layer_19_attn_norm [label="MB4 L19\nAttention Norm\nGPU: P@4"]
		mb_4_layer_19_attn_qkv [label="MB4 L19\nAttention QKV\nGPU: P@4"]
		mb_4_layer_19_attn_out [label="MB4 L19\nAttention Out\nGPU: P@4"]
		mb_4_layer_19_attn_residual [label="MB4 L19\nAttn Residual\nGPU: P@4"]
		mb_4_layer_19_ffn_norm [label="MB4 L19\nFFN Norm\nGPU: P@4"]
		mb_4_layer_19_ffn_up [label="MB4 L19\nFFN Up\nGPU: P@4"]
		mb_4_layer_19_ffn_down [label="MB4 L19\nFFN Down\nGPU: P@4"]
		mb_4_layer_19_ffn_residual [label="MB4 L19\nFFN Residual\nGPU: P@4"]
		mb_4_layer_18_ffn_residual -> mb_4_layer_19_attn_norm
		mb_4_layer_19_attn_norm -> mb_4_layer_19_attn_qkv
		mb_4_layer_19_attn_qkv -> mb_4_layer_19_attn_out
		mb_4_layer_19_attn_out -> mb_4_layer_19_attn_residual
		mb_4_layer_19_attn_residual -> mb_4_layer_19_ffn_norm
		mb_4_layer_19_ffn_norm -> mb_4_layer_19_ffn_up
		mb_4_layer_19_ffn_up -> mb_4_layer_19_ffn_down
		mb_4_layer_19_ffn_down -> mb_4_layer_19_ffn_residual
		mb_4_layer_20_attn_norm [label="MB4 L20\nAttention Norm\nGPU: P@4"]
		mb_4_layer_20_attn_qkv [label="MB4 L20\nAttention QKV\nGPU: P@4"]
		mb_4_layer_20_attn_out [label="MB4 L20\nAttention Out\nGPU: P@4"]
		mb_4_layer_20_attn_residual [label="MB4 L20\nAttn Residual\nGPU: P@4"]
		mb_4_layer_20_ffn_norm [label="MB4 L20\nFFN Norm\nGPU: P@4"]
		mb_4_layer_20_ffn_up [label="MB4 L20\nFFN Up\nGPU: P@4"]
		mb_4_layer_20_ffn_down [label="MB4 L20\nFFN Down\nGPU: P@4"]
		mb_4_layer_20_ffn_residual [label="MB4 L20\nFFN Residual\nGPU: P@4"]
		mb_4_layer_19_ffn_residual -> mb_4_layer_20_attn_norm
		mb_4_layer_20_attn_norm -> mb_4_layer_20_attn_qkv
		mb_4_layer_20_attn_qkv -> mb_4_layer_20_attn_out
		mb_4_layer_20_attn_out -> mb_4_layer_20_attn_residual
		mb_4_layer_20_attn_residual -> mb_4_layer_20_ffn_norm
		mb_4_layer_20_ffn_norm -> mb_4_layer_20_ffn_up
		mb_4_layer_20_ffn_up -> mb_4_layer_20_ffn_down
		mb_4_layer_20_ffn_down -> mb_4_layer_20_ffn_residual
		mb_4_stage_3_output [label="MB4\nStage 4\nOutput\nGPU: P@4"]
		mb_4_layer_20_ffn_residual -> mb_4_stage_3_output
		mb_5_comm_stage_2 [label="Micro-Batch 5\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@3 To: P@4" fillcolor=lightyellow shape=parallelogram]
		mb_5_layer_16_attn_norm [label="MB5 L16\nAttention Norm\nGPU: P@4"]
		mb_5_layer_16_attn_qkv [label="MB5 L16\nAttention QKV\nGPU: P@4"]
		mb_5_layer_16_attn_out [label="MB5 L16\nAttention Out\nGPU: P@4"]
		mb_5_layer_16_attn_residual [label="MB5 L16\nAttn Residual\nGPU: P@4"]
		mb_5_layer_16_ffn_norm [label="MB5 L16\nFFN Norm\nGPU: P@4"]
		mb_5_layer_16_ffn_up [label="MB5 L16\nFFN Up\nGPU: P@4"]
		mb_5_layer_16_ffn_down [label="MB5 L16\nFFN Down\nGPU: P@4"]
		mb_5_layer_16_ffn_residual [label="MB5 L16\nFFN Residual\nGPU: P@4"]
		mb_5_comm_stage_2 -> mb_5_layer_16_attn_norm
		mb_5_layer_16_attn_norm -> mb_5_layer_16_attn_qkv
		mb_5_layer_16_attn_qkv -> mb_5_layer_16_attn_out
		mb_5_layer_16_attn_out -> mb_5_layer_16_attn_residual
		mb_5_layer_16_attn_residual -> mb_5_layer_16_ffn_norm
		mb_5_layer_16_ffn_norm -> mb_5_layer_16_ffn_up
		mb_5_layer_16_ffn_up -> mb_5_layer_16_ffn_down
		mb_5_layer_16_ffn_down -> mb_5_layer_16_ffn_residual
		mb_5_layer_17_attn_norm [label="MB5 L17\nAttention Norm\nGPU: P@4"]
		mb_5_layer_17_attn_qkv [label="MB5 L17\nAttention QKV\nGPU: P@4"]
		mb_5_layer_17_attn_out [label="MB5 L17\nAttention Out\nGPU: P@4"]
		mb_5_layer_17_attn_residual [label="MB5 L17\nAttn Residual\nGPU: P@4"]
		mb_5_layer_17_ffn_norm [label="MB5 L17\nFFN Norm\nGPU: P@4"]
		mb_5_layer_17_ffn_up [label="MB5 L17\nFFN Up\nGPU: P@4"]
		mb_5_layer_17_ffn_down [label="MB5 L17\nFFN Down\nGPU: P@4"]
		mb_5_layer_17_ffn_residual [label="MB5 L17\nFFN Residual\nGPU: P@4"]
		mb_5_layer_16_ffn_residual -> mb_5_layer_17_attn_norm
		mb_5_layer_17_attn_norm -> mb_5_layer_17_attn_qkv
		mb_5_layer_17_attn_qkv -> mb_5_layer_17_attn_out
		mb_5_layer_17_attn_out -> mb_5_layer_17_attn_residual
		mb_5_layer_17_attn_residual -> mb_5_layer_17_ffn_norm
		mb_5_layer_17_ffn_norm -> mb_5_layer_17_ffn_up
		mb_5_layer_17_ffn_up -> mb_5_layer_17_ffn_down
		mb_5_layer_17_ffn_down -> mb_5_layer_17_ffn_residual
		mb_5_layer_18_attn_norm [label="MB5 L18\nAttention Norm\nGPU: P@4"]
		mb_5_layer_18_attn_qkv [label="MB5 L18\nAttention QKV\nGPU: P@4"]
		mb_5_layer_18_attn_out [label="MB5 L18\nAttention Out\nGPU: P@4"]
		mb_5_layer_18_attn_residual [label="MB5 L18\nAttn Residual\nGPU: P@4"]
		mb_5_layer_18_ffn_norm [label="MB5 L18\nFFN Norm\nGPU: P@4"]
		mb_5_layer_18_ffn_up [label="MB5 L18\nFFN Up\nGPU: P@4"]
		mb_5_layer_18_ffn_down [label="MB5 L18\nFFN Down\nGPU: P@4"]
		mb_5_layer_18_ffn_residual [label="MB5 L18\nFFN Residual\nGPU: P@4"]
		mb_5_layer_17_ffn_residual -> mb_5_layer_18_attn_norm
		mb_5_layer_18_attn_norm -> mb_5_layer_18_attn_qkv
		mb_5_layer_18_attn_qkv -> mb_5_layer_18_attn_out
		mb_5_layer_18_attn_out -> mb_5_layer_18_attn_residual
		mb_5_layer_18_attn_residual -> mb_5_layer_18_ffn_norm
		mb_5_layer_18_ffn_norm -> mb_5_layer_18_ffn_up
		mb_5_layer_18_ffn_up -> mb_5_layer_18_ffn_down
		mb_5_layer_18_ffn_down -> mb_5_layer_18_ffn_residual
		mb_5_layer_19_attn_norm [label="MB5 L19\nAttention Norm\nGPU: P@4"]
		mb_5_layer_19_attn_qkv [label="MB5 L19\nAttention QKV\nGPU: P@4"]
		mb_5_layer_19_attn_out [label="MB5 L19\nAttention Out\nGPU: P@4"]
		mb_5_layer_19_attn_residual [label="MB5 L19\nAttn Residual\nGPU: P@4"]
		mb_5_layer_19_ffn_norm [label="MB5 L19\nFFN Norm\nGPU: P@4"]
		mb_5_layer_19_ffn_up [label="MB5 L19\nFFN Up\nGPU: P@4"]
		mb_5_layer_19_ffn_down [label="MB5 L19\nFFN Down\nGPU: P@4"]
		mb_5_layer_19_ffn_residual [label="MB5 L19\nFFN Residual\nGPU: P@4"]
		mb_5_layer_18_ffn_residual -> mb_5_layer_19_attn_norm
		mb_5_layer_19_attn_norm -> mb_5_layer_19_attn_qkv
		mb_5_layer_19_attn_qkv -> mb_5_layer_19_attn_out
		mb_5_layer_19_attn_out -> mb_5_layer_19_attn_residual
		mb_5_layer_19_attn_residual -> mb_5_layer_19_ffn_norm
		mb_5_layer_19_ffn_norm -> mb_5_layer_19_ffn_up
		mb_5_layer_19_ffn_up -> mb_5_layer_19_ffn_down
		mb_5_layer_19_ffn_down -> mb_5_layer_19_ffn_residual
		mb_5_layer_20_attn_norm [label="MB5 L20\nAttention Norm\nGPU: P@4"]
		mb_5_layer_20_attn_qkv [label="MB5 L20\nAttention QKV\nGPU: P@4"]
		mb_5_layer_20_attn_out [label="MB5 L20\nAttention Out\nGPU: P@4"]
		mb_5_layer_20_attn_residual [label="MB5 L20\nAttn Residual\nGPU: P@4"]
		mb_5_layer_20_ffn_norm [label="MB5 L20\nFFN Norm\nGPU: P@4"]
		mb_5_layer_20_ffn_up [label="MB5 L20\nFFN Up\nGPU: P@4"]
		mb_5_layer_20_ffn_down [label="MB5 L20\nFFN Down\nGPU: P@4"]
		mb_5_layer_20_ffn_residual [label="MB5 L20\nFFN Residual\nGPU: P@4"]
		mb_5_layer_19_ffn_residual -> mb_5_layer_20_attn_norm
		mb_5_layer_20_attn_norm -> mb_5_layer_20_attn_qkv
		mb_5_layer_20_attn_qkv -> mb_5_layer_20_attn_out
		mb_5_layer_20_attn_out -> mb_5_layer_20_attn_residual
		mb_5_layer_20_attn_residual -> mb_5_layer_20_ffn_norm
		mb_5_layer_20_ffn_norm -> mb_5_layer_20_ffn_up
		mb_5_layer_20_ffn_up -> mb_5_layer_20_ffn_down
		mb_5_layer_20_ffn_down -> mb_5_layer_20_ffn_residual
		mb_5_stage_3_output [label="MB5\nStage 4\nOutput\nGPU: P@4"]
		mb_5_layer_20_ffn_residual -> mb_5_stage_3_output
	}
	mb_0_stage_3_output -> mb_0_comm_stage_3
	mb_1_stage_3_output -> mb_1_comm_stage_3
	mb_2_stage_3_output -> mb_2_comm_stage_3
	mb_3_stage_3_output -> mb_3_comm_stage_3
	mb_4_stage_3_output -> mb_4_comm_stage_3
	mb_5_stage_3_output -> mb_5_comm_stage_3
	subgraph cluster_stage_4 {
		label="Stage 5\nR@1\nLayers 21-25" style=dashed
		mb_0_comm_stage_3 [label="Micro-Batch 0\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@4 To: R@1" fillcolor=lightyellow shape=parallelogram]
		mb_0_layer_21_attn_norm [label="MB0 L21\nAttention Norm\nGPU: R@1"]
		mb_0_layer_21_attn_qkv [label="MB0 L21\nAttention QKV\nGPU: R@1"]
		mb_0_layer_21_attn_out [label="MB0 L21\nAttention Out\nGPU: R@1"]
		mb_0_layer_21_attn_residual [label="MB0 L21\nAttn Residual\nGPU: R@1"]
		mb_0_layer_21_ffn_norm [label="MB0 L21\nFFN Norm\nGPU: R@1"]
		mb_0_layer_21_ffn_up [label="MB0 L21\nFFN Up\nGPU: R@1"]
		mb_0_layer_21_ffn_down [label="MB0 L21\nFFN Down\nGPU: R@1"]
		mb_0_layer_21_ffn_residual [label="MB0 L21\nFFN Residual\nGPU: R@1"]
		mb_0_comm_stage_3 -> mb_0_layer_21_attn_norm
		mb_0_layer_21_attn_norm -> mb_0_layer_21_attn_qkv
		mb_0_layer_21_attn_qkv -> mb_0_layer_21_attn_out
		mb_0_layer_21_attn_out -> mb_0_layer_21_attn_residual
		mb_0_layer_21_attn_residual -> mb_0_layer_21_ffn_norm
		mb_0_layer_21_ffn_norm -> mb_0_layer_21_ffn_up
		mb_0_layer_21_ffn_up -> mb_0_layer_21_ffn_down
		mb_0_layer_21_ffn_down -> mb_0_layer_21_ffn_residual
		mb_0_layer_22_attn_norm [label="MB0 L22\nAttention Norm\nGPU: R@1"]
		mb_0_layer_22_attn_qkv [label="MB0 L22\nAttention QKV\nGPU: R@1"]
		mb_0_layer_22_attn_out [label="MB0 L22\nAttention Out\nGPU: R@1"]
		mb_0_layer_22_attn_residual [label="MB0 L22\nAttn Residual\nGPU: R@1"]
		mb_0_layer_22_ffn_norm [label="MB0 L22\nFFN Norm\nGPU: R@1"]
		mb_0_layer_22_ffn_up [label="MB0 L22\nFFN Up\nGPU: R@1"]
		mb_0_layer_22_ffn_down [label="MB0 L22\nFFN Down\nGPU: R@1"]
		mb_0_layer_22_ffn_residual [label="MB0 L22\nFFN Residual\nGPU: R@1"]
		mb_0_layer_21_ffn_residual -> mb_0_layer_22_attn_norm
		mb_0_layer_22_attn_norm -> mb_0_layer_22_attn_qkv
		mb_0_layer_22_attn_qkv -> mb_0_layer_22_attn_out
		mb_0_layer_22_attn_out -> mb_0_layer_22_attn_residual
		mb_0_layer_22_attn_residual -> mb_0_layer_22_ffn_norm
		mb_0_layer_22_ffn_norm -> mb_0_layer_22_ffn_up
		mb_0_layer_22_ffn_up -> mb_0_layer_22_ffn_down
		mb_0_layer_22_ffn_down -> mb_0_layer_22_ffn_residual
		mb_0_layer_23_attn_norm [label="MB0 L23\nAttention Norm\nGPU: R@1"]
		mb_0_layer_23_attn_qkv [label="MB0 L23\nAttention QKV\nGPU: R@1"]
		mb_0_layer_23_attn_out [label="MB0 L23\nAttention Out\nGPU: R@1"]
		mb_0_layer_23_attn_residual [label="MB0 L23\nAttn Residual\nGPU: R@1"]
		mb_0_layer_23_ffn_norm [label="MB0 L23\nFFN Norm\nGPU: R@1"]
		mb_0_layer_23_ffn_up [label="MB0 L23\nFFN Up\nGPU: R@1"]
		mb_0_layer_23_ffn_down [label="MB0 L23\nFFN Down\nGPU: R@1"]
		mb_0_layer_23_ffn_residual [label="MB0 L23\nFFN Residual\nGPU: R@1"]
		mb_0_layer_22_ffn_residual -> mb_0_layer_23_attn_norm
		mb_0_layer_23_attn_norm -> mb_0_layer_23_attn_qkv
		mb_0_layer_23_attn_qkv -> mb_0_layer_23_attn_out
		mb_0_layer_23_attn_out -> mb_0_layer_23_attn_residual
		mb_0_layer_23_attn_residual -> mb_0_layer_23_ffn_norm
		mb_0_layer_23_ffn_norm -> mb_0_layer_23_ffn_up
		mb_0_layer_23_ffn_up -> mb_0_layer_23_ffn_down
		mb_0_layer_23_ffn_down -> mb_0_layer_23_ffn_residual
		mb_0_layer_24_attn_norm [label="MB0 L24\nAttention Norm\nGPU: R@1"]
		mb_0_layer_24_attn_qkv [label="MB0 L24\nAttention QKV\nGPU: R@1"]
		mb_0_layer_24_attn_out [label="MB0 L24\nAttention Out\nGPU: R@1"]
		mb_0_layer_24_attn_residual [label="MB0 L24\nAttn Residual\nGPU: R@1"]
		mb_0_layer_24_ffn_norm [label="MB0 L24\nFFN Norm\nGPU: R@1"]
		mb_0_layer_24_ffn_up [label="MB0 L24\nFFN Up\nGPU: R@1"]
		mb_0_layer_24_ffn_down [label="MB0 L24\nFFN Down\nGPU: R@1"]
		mb_0_layer_24_ffn_residual [label="MB0 L24\nFFN Residual\nGPU: R@1"]
		mb_0_layer_23_ffn_residual -> mb_0_layer_24_attn_norm
		mb_0_layer_24_attn_norm -> mb_0_layer_24_attn_qkv
		mb_0_layer_24_attn_qkv -> mb_0_layer_24_attn_out
		mb_0_layer_24_attn_out -> mb_0_layer_24_attn_residual
		mb_0_layer_24_attn_residual -> mb_0_layer_24_ffn_norm
		mb_0_layer_24_ffn_norm -> mb_0_layer_24_ffn_up
		mb_0_layer_24_ffn_up -> mb_0_layer_24_ffn_down
		mb_0_layer_24_ffn_down -> mb_0_layer_24_ffn_residual
		mb_0_layer_25_attn_norm [label="MB0 L25\nAttention Norm\nGPU: R@1"]
		mb_0_layer_25_attn_qkv [label="MB0 L25\nAttention QKV\nGPU: R@1"]
		mb_0_layer_25_attn_out [label="MB0 L25\nAttention Out\nGPU: R@1"]
		mb_0_layer_25_attn_residual [label="MB0 L25\nAttn Residual\nGPU: R@1"]
		mb_0_layer_25_ffn_norm [label="MB0 L25\nFFN Norm\nGPU: R@1"]
		mb_0_layer_25_ffn_up [label="MB0 L25\nFFN Up\nGPU: R@1"]
		mb_0_layer_25_ffn_down [label="MB0 L25\nFFN Down\nGPU: R@1"]
		mb_0_layer_25_ffn_residual [label="MB0 L25\nFFN Residual\nGPU: R@1"]
		mb_0_layer_24_ffn_residual -> mb_0_layer_25_attn_norm
		mb_0_layer_25_attn_norm -> mb_0_layer_25_attn_qkv
		mb_0_layer_25_attn_qkv -> mb_0_layer_25_attn_out
		mb_0_layer_25_attn_out -> mb_0_layer_25_attn_residual
		mb_0_layer_25_attn_residual -> mb_0_layer_25_ffn_norm
		mb_0_layer_25_ffn_norm -> mb_0_layer_25_ffn_up
		mb_0_layer_25_ffn_up -> mb_0_layer_25_ffn_down
		mb_0_layer_25_ffn_down -> mb_0_layer_25_ffn_residual
		mb_0_stage_4_output [label="MB0\nStage 5\nOutput\nGPU: R@1"]
		mb_0_layer_25_ffn_residual -> mb_0_stage_4_output
		mb_1_comm_stage_3 [label="Micro-Batch 1\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@4 To: R@1" fillcolor=lightyellow shape=parallelogram]
		mb_1_layer_21_attn_norm [label="MB1 L21\nAttention Norm\nGPU: R@1"]
		mb_1_layer_21_attn_qkv [label="MB1 L21\nAttention QKV\nGPU: R@1"]
		mb_1_layer_21_attn_out [label="MB1 L21\nAttention Out\nGPU: R@1"]
		mb_1_layer_21_attn_residual [label="MB1 L21\nAttn Residual\nGPU: R@1"]
		mb_1_layer_21_ffn_norm [label="MB1 L21\nFFN Norm\nGPU: R@1"]
		mb_1_layer_21_ffn_up [label="MB1 L21\nFFN Up\nGPU: R@1"]
		mb_1_layer_21_ffn_down [label="MB1 L21\nFFN Down\nGPU: R@1"]
		mb_1_layer_21_ffn_residual [label="MB1 L21\nFFN Residual\nGPU: R@1"]
		mb_1_comm_stage_3 -> mb_1_layer_21_attn_norm
		mb_1_layer_21_attn_norm -> mb_1_layer_21_attn_qkv
		mb_1_layer_21_attn_qkv -> mb_1_layer_21_attn_out
		mb_1_layer_21_attn_out -> mb_1_layer_21_attn_residual
		mb_1_layer_21_attn_residual -> mb_1_layer_21_ffn_norm
		mb_1_layer_21_ffn_norm -> mb_1_layer_21_ffn_up
		mb_1_layer_21_ffn_up -> mb_1_layer_21_ffn_down
		mb_1_layer_21_ffn_down -> mb_1_layer_21_ffn_residual
		mb_1_layer_22_attn_norm [label="MB1 L22\nAttention Norm\nGPU: R@1"]
		mb_1_layer_22_attn_qkv [label="MB1 L22\nAttention QKV\nGPU: R@1"]
		mb_1_layer_22_attn_out [label="MB1 L22\nAttention Out\nGPU: R@1"]
		mb_1_layer_22_attn_residual [label="MB1 L22\nAttn Residual\nGPU: R@1"]
		mb_1_layer_22_ffn_norm [label="MB1 L22\nFFN Norm\nGPU: R@1"]
		mb_1_layer_22_ffn_up [label="MB1 L22\nFFN Up\nGPU: R@1"]
		mb_1_layer_22_ffn_down [label="MB1 L22\nFFN Down\nGPU: R@1"]
		mb_1_layer_22_ffn_residual [label="MB1 L22\nFFN Residual\nGPU: R@1"]
		mb_1_layer_21_ffn_residual -> mb_1_layer_22_attn_norm
		mb_1_layer_22_attn_norm -> mb_1_layer_22_attn_qkv
		mb_1_layer_22_attn_qkv -> mb_1_layer_22_attn_out
		mb_1_layer_22_attn_out -> mb_1_layer_22_attn_residual
		mb_1_layer_22_attn_residual -> mb_1_layer_22_ffn_norm
		mb_1_layer_22_ffn_norm -> mb_1_layer_22_ffn_up
		mb_1_layer_22_ffn_up -> mb_1_layer_22_ffn_down
		mb_1_layer_22_ffn_down -> mb_1_layer_22_ffn_residual
		mb_1_layer_23_attn_norm [label="MB1 L23\nAttention Norm\nGPU: R@1"]
		mb_1_layer_23_attn_qkv [label="MB1 L23\nAttention QKV\nGPU: R@1"]
		mb_1_layer_23_attn_out [label="MB1 L23\nAttention Out\nGPU: R@1"]
		mb_1_layer_23_attn_residual [label="MB1 L23\nAttn Residual\nGPU: R@1"]
		mb_1_layer_23_ffn_norm [label="MB1 L23\nFFN Norm\nGPU: R@1"]
		mb_1_layer_23_ffn_up [label="MB1 L23\nFFN Up\nGPU: R@1"]
		mb_1_layer_23_ffn_down [label="MB1 L23\nFFN Down\nGPU: R@1"]
		mb_1_layer_23_ffn_residual [label="MB1 L23\nFFN Residual\nGPU: R@1"]
		mb_1_layer_22_ffn_residual -> mb_1_layer_23_attn_norm
		mb_1_layer_23_attn_norm -> mb_1_layer_23_attn_qkv
		mb_1_layer_23_attn_qkv -> mb_1_layer_23_attn_out
		mb_1_layer_23_attn_out -> mb_1_layer_23_attn_residual
		mb_1_layer_23_attn_residual -> mb_1_layer_23_ffn_norm
		mb_1_layer_23_ffn_norm -> mb_1_layer_23_ffn_up
		mb_1_layer_23_ffn_up -> mb_1_layer_23_ffn_down
		mb_1_layer_23_ffn_down -> mb_1_layer_23_ffn_residual
		mb_1_layer_24_attn_norm [label="MB1 L24\nAttention Norm\nGPU: R@1"]
		mb_1_layer_24_attn_qkv [label="MB1 L24\nAttention QKV\nGPU: R@1"]
		mb_1_layer_24_attn_out [label="MB1 L24\nAttention Out\nGPU: R@1"]
		mb_1_layer_24_attn_residual [label="MB1 L24\nAttn Residual\nGPU: R@1"]
		mb_1_layer_24_ffn_norm [label="MB1 L24\nFFN Norm\nGPU: R@1"]
		mb_1_layer_24_ffn_up [label="MB1 L24\nFFN Up\nGPU: R@1"]
		mb_1_layer_24_ffn_down [label="MB1 L24\nFFN Down\nGPU: R@1"]
		mb_1_layer_24_ffn_residual [label="MB1 L24\nFFN Residual\nGPU: R@1"]
		mb_1_layer_23_ffn_residual -> mb_1_layer_24_attn_norm
		mb_1_layer_24_attn_norm -> mb_1_layer_24_attn_qkv
		mb_1_layer_24_attn_qkv -> mb_1_layer_24_attn_out
		mb_1_layer_24_attn_out -> mb_1_layer_24_attn_residual
		mb_1_layer_24_attn_residual -> mb_1_layer_24_ffn_norm
		mb_1_layer_24_ffn_norm -> mb_1_layer_24_ffn_up
		mb_1_layer_24_ffn_up -> mb_1_layer_24_ffn_down
		mb_1_layer_24_ffn_down -> mb_1_layer_24_ffn_residual
		mb_1_layer_25_attn_norm [label="MB1 L25\nAttention Norm\nGPU: R@1"]
		mb_1_layer_25_attn_qkv [label="MB1 L25\nAttention QKV\nGPU: R@1"]
		mb_1_layer_25_attn_out [label="MB1 L25\nAttention Out\nGPU: R@1"]
		mb_1_layer_25_attn_residual [label="MB1 L25\nAttn Residual\nGPU: R@1"]
		mb_1_layer_25_ffn_norm [label="MB1 L25\nFFN Norm\nGPU: R@1"]
		mb_1_layer_25_ffn_up [label="MB1 L25\nFFN Up\nGPU: R@1"]
		mb_1_layer_25_ffn_down [label="MB1 L25\nFFN Down\nGPU: R@1"]
		mb_1_layer_25_ffn_residual [label="MB1 L25\nFFN Residual\nGPU: R@1"]
		mb_1_layer_24_ffn_residual -> mb_1_layer_25_attn_norm
		mb_1_layer_25_attn_norm -> mb_1_layer_25_attn_qkv
		mb_1_layer_25_attn_qkv -> mb_1_layer_25_attn_out
		mb_1_layer_25_attn_out -> mb_1_layer_25_attn_residual
		mb_1_layer_25_attn_residual -> mb_1_layer_25_ffn_norm
		mb_1_layer_25_ffn_norm -> mb_1_layer_25_ffn_up
		mb_1_layer_25_ffn_up -> mb_1_layer_25_ffn_down
		mb_1_layer_25_ffn_down -> mb_1_layer_25_ffn_residual
		mb_1_stage_4_output [label="MB1\nStage 5\nOutput\nGPU: R@1"]
		mb_1_layer_25_ffn_residual -> mb_1_stage_4_output
		mb_2_comm_stage_3 [label="Micro-Batch 2\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@4 To: R@1" fillcolor=lightyellow shape=parallelogram]
		mb_2_layer_21_attn_norm [label="MB2 L21\nAttention Norm\nGPU: R@1"]
		mb_2_layer_21_attn_qkv [label="MB2 L21\nAttention QKV\nGPU: R@1"]
		mb_2_layer_21_attn_out [label="MB2 L21\nAttention Out\nGPU: R@1"]
		mb_2_layer_21_attn_residual [label="MB2 L21\nAttn Residual\nGPU: R@1"]
		mb_2_layer_21_ffn_norm [label="MB2 L21\nFFN Norm\nGPU: R@1"]
		mb_2_layer_21_ffn_up [label="MB2 L21\nFFN Up\nGPU: R@1"]
		mb_2_layer_21_ffn_down [label="MB2 L21\nFFN Down\nGPU: R@1"]
		mb_2_layer_21_ffn_residual [label="MB2 L21\nFFN Residual\nGPU: R@1"]
		mb_2_comm_stage_3 -> mb_2_layer_21_attn_norm
		mb_2_layer_21_attn_norm -> mb_2_layer_21_attn_qkv
		mb_2_layer_21_attn_qkv -> mb_2_layer_21_attn_out
		mb_2_layer_21_attn_out -> mb_2_layer_21_attn_residual
		mb_2_layer_21_attn_residual -> mb_2_layer_21_ffn_norm
		mb_2_layer_21_ffn_norm -> mb_2_layer_21_ffn_up
		mb_2_layer_21_ffn_up -> mb_2_layer_21_ffn_down
		mb_2_layer_21_ffn_down -> mb_2_layer_21_ffn_residual
		mb_2_layer_22_attn_norm [label="MB2 L22\nAttention Norm\nGPU: R@1"]
		mb_2_layer_22_attn_qkv [label="MB2 L22\nAttention QKV\nGPU: R@1"]
		mb_2_layer_22_attn_out [label="MB2 L22\nAttention Out\nGPU: R@1"]
		mb_2_layer_22_attn_residual [label="MB2 L22\nAttn Residual\nGPU: R@1"]
		mb_2_layer_22_ffn_norm [label="MB2 L22\nFFN Norm\nGPU: R@1"]
		mb_2_layer_22_ffn_up [label="MB2 L22\nFFN Up\nGPU: R@1"]
		mb_2_layer_22_ffn_down [label="MB2 L22\nFFN Down\nGPU: R@1"]
		mb_2_layer_22_ffn_residual [label="MB2 L22\nFFN Residual\nGPU: R@1"]
		mb_2_layer_21_ffn_residual -> mb_2_layer_22_attn_norm
		mb_2_layer_22_attn_norm -> mb_2_layer_22_attn_qkv
		mb_2_layer_22_attn_qkv -> mb_2_layer_22_attn_out
		mb_2_layer_22_attn_out -> mb_2_layer_22_attn_residual
		mb_2_layer_22_attn_residual -> mb_2_layer_22_ffn_norm
		mb_2_layer_22_ffn_norm -> mb_2_layer_22_ffn_up
		mb_2_layer_22_ffn_up -> mb_2_layer_22_ffn_down
		mb_2_layer_22_ffn_down -> mb_2_layer_22_ffn_residual
		mb_2_layer_23_attn_norm [label="MB2 L23\nAttention Norm\nGPU: R@1"]
		mb_2_layer_23_attn_qkv [label="MB2 L23\nAttention QKV\nGPU: R@1"]
		mb_2_layer_23_attn_out [label="MB2 L23\nAttention Out\nGPU: R@1"]
		mb_2_layer_23_attn_residual [label="MB2 L23\nAttn Residual\nGPU: R@1"]
		mb_2_layer_23_ffn_norm [label="MB2 L23\nFFN Norm\nGPU: R@1"]
		mb_2_layer_23_ffn_up [label="MB2 L23\nFFN Up\nGPU: R@1"]
		mb_2_layer_23_ffn_down [label="MB2 L23\nFFN Down\nGPU: R@1"]
		mb_2_layer_23_ffn_residual [label="MB2 L23\nFFN Residual\nGPU: R@1"]
		mb_2_layer_22_ffn_residual -> mb_2_layer_23_attn_norm
		mb_2_layer_23_attn_norm -> mb_2_layer_23_attn_qkv
		mb_2_layer_23_attn_qkv -> mb_2_layer_23_attn_out
		mb_2_layer_23_attn_out -> mb_2_layer_23_attn_residual
		mb_2_layer_23_attn_residual -> mb_2_layer_23_ffn_norm
		mb_2_layer_23_ffn_norm -> mb_2_layer_23_ffn_up
		mb_2_layer_23_ffn_up -> mb_2_layer_23_ffn_down
		mb_2_layer_23_ffn_down -> mb_2_layer_23_ffn_residual
		mb_2_layer_24_attn_norm [label="MB2 L24\nAttention Norm\nGPU: R@1"]
		mb_2_layer_24_attn_qkv [label="MB2 L24\nAttention QKV\nGPU: R@1"]
		mb_2_layer_24_attn_out [label="MB2 L24\nAttention Out\nGPU: R@1"]
		mb_2_layer_24_attn_residual [label="MB2 L24\nAttn Residual\nGPU: R@1"]
		mb_2_layer_24_ffn_norm [label="MB2 L24\nFFN Norm\nGPU: R@1"]
		mb_2_layer_24_ffn_up [label="MB2 L24\nFFN Up\nGPU: R@1"]
		mb_2_layer_24_ffn_down [label="MB2 L24\nFFN Down\nGPU: R@1"]
		mb_2_layer_24_ffn_residual [label="MB2 L24\nFFN Residual\nGPU: R@1"]
		mb_2_layer_23_ffn_residual -> mb_2_layer_24_attn_norm
		mb_2_layer_24_attn_norm -> mb_2_layer_24_attn_qkv
		mb_2_layer_24_attn_qkv -> mb_2_layer_24_attn_out
		mb_2_layer_24_attn_out -> mb_2_layer_24_attn_residual
		mb_2_layer_24_attn_residual -> mb_2_layer_24_ffn_norm
		mb_2_layer_24_ffn_norm -> mb_2_layer_24_ffn_up
		mb_2_layer_24_ffn_up -> mb_2_layer_24_ffn_down
		mb_2_layer_24_ffn_down -> mb_2_layer_24_ffn_residual
		mb_2_layer_25_attn_norm [label="MB2 L25\nAttention Norm\nGPU: R@1"]
		mb_2_layer_25_attn_qkv [label="MB2 L25\nAttention QKV\nGPU: R@1"]
		mb_2_layer_25_attn_out [label="MB2 L25\nAttention Out\nGPU: R@1"]
		mb_2_layer_25_attn_residual [label="MB2 L25\nAttn Residual\nGPU: R@1"]
		mb_2_layer_25_ffn_norm [label="MB2 L25\nFFN Norm\nGPU: R@1"]
		mb_2_layer_25_ffn_up [label="MB2 L25\nFFN Up\nGPU: R@1"]
		mb_2_layer_25_ffn_down [label="MB2 L25\nFFN Down\nGPU: R@1"]
		mb_2_layer_25_ffn_residual [label="MB2 L25\nFFN Residual\nGPU: R@1"]
		mb_2_layer_24_ffn_residual -> mb_2_layer_25_attn_norm
		mb_2_layer_25_attn_norm -> mb_2_layer_25_attn_qkv
		mb_2_layer_25_attn_qkv -> mb_2_layer_25_attn_out
		mb_2_layer_25_attn_out -> mb_2_layer_25_attn_residual
		mb_2_layer_25_attn_residual -> mb_2_layer_25_ffn_norm
		mb_2_layer_25_ffn_norm -> mb_2_layer_25_ffn_up
		mb_2_layer_25_ffn_up -> mb_2_layer_25_ffn_down
		mb_2_layer_25_ffn_down -> mb_2_layer_25_ffn_residual
		mb_2_stage_4_output [label="MB2\nStage 5\nOutput\nGPU: R@1"]
		mb_2_layer_25_ffn_residual -> mb_2_stage_4_output
		mb_3_comm_stage_3 [label="Micro-Batch 3\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@4 To: R@1" fillcolor=lightyellow shape=parallelogram]
		mb_3_layer_21_attn_norm [label="MB3 L21\nAttention Norm\nGPU: R@1"]
		mb_3_layer_21_attn_qkv [label="MB3 L21\nAttention QKV\nGPU: R@1"]
		mb_3_layer_21_attn_out [label="MB3 L21\nAttention Out\nGPU: R@1"]
		mb_3_layer_21_attn_residual [label="MB3 L21\nAttn Residual\nGPU: R@1"]
		mb_3_layer_21_ffn_norm [label="MB3 L21\nFFN Norm\nGPU: R@1"]
		mb_3_layer_21_ffn_up [label="MB3 L21\nFFN Up\nGPU: R@1"]
		mb_3_layer_21_ffn_down [label="MB3 L21\nFFN Down\nGPU: R@1"]
		mb_3_layer_21_ffn_residual [label="MB3 L21\nFFN Residual\nGPU: R@1"]
		mb_3_comm_stage_3 -> mb_3_layer_21_attn_norm
		mb_3_layer_21_attn_norm -> mb_3_layer_21_attn_qkv
		mb_3_layer_21_attn_qkv -> mb_3_layer_21_attn_out
		mb_3_layer_21_attn_out -> mb_3_layer_21_attn_residual
		mb_3_layer_21_attn_residual -> mb_3_layer_21_ffn_norm
		mb_3_layer_21_ffn_norm -> mb_3_layer_21_ffn_up
		mb_3_layer_21_ffn_up -> mb_3_layer_21_ffn_down
		mb_3_layer_21_ffn_down -> mb_3_layer_21_ffn_residual
		mb_3_layer_22_attn_norm [label="MB3 L22\nAttention Norm\nGPU: R@1"]
		mb_3_layer_22_attn_qkv [label="MB3 L22\nAttention QKV\nGPU: R@1"]
		mb_3_layer_22_attn_out [label="MB3 L22\nAttention Out\nGPU: R@1"]
		mb_3_layer_22_attn_residual [label="MB3 L22\nAttn Residual\nGPU: R@1"]
		mb_3_layer_22_ffn_norm [label="MB3 L22\nFFN Norm\nGPU: R@1"]
		mb_3_layer_22_ffn_up [label="MB3 L22\nFFN Up\nGPU: R@1"]
		mb_3_layer_22_ffn_down [label="MB3 L22\nFFN Down\nGPU: R@1"]
		mb_3_layer_22_ffn_residual [label="MB3 L22\nFFN Residual\nGPU: R@1"]
		mb_3_layer_21_ffn_residual -> mb_3_layer_22_attn_norm
		mb_3_layer_22_attn_norm -> mb_3_layer_22_attn_qkv
		mb_3_layer_22_attn_qkv -> mb_3_layer_22_attn_out
		mb_3_layer_22_attn_out -> mb_3_layer_22_attn_residual
		mb_3_layer_22_attn_residual -> mb_3_layer_22_ffn_norm
		mb_3_layer_22_ffn_norm -> mb_3_layer_22_ffn_up
		mb_3_layer_22_ffn_up -> mb_3_layer_22_ffn_down
		mb_3_layer_22_ffn_down -> mb_3_layer_22_ffn_residual
		mb_3_layer_23_attn_norm [label="MB3 L23\nAttention Norm\nGPU: R@1"]
		mb_3_layer_23_attn_qkv [label="MB3 L23\nAttention QKV\nGPU: R@1"]
		mb_3_layer_23_attn_out [label="MB3 L23\nAttention Out\nGPU: R@1"]
		mb_3_layer_23_attn_residual [label="MB3 L23\nAttn Residual\nGPU: R@1"]
		mb_3_layer_23_ffn_norm [label="MB3 L23\nFFN Norm\nGPU: R@1"]
		mb_3_layer_23_ffn_up [label="MB3 L23\nFFN Up\nGPU: R@1"]
		mb_3_layer_23_ffn_down [label="MB3 L23\nFFN Down\nGPU: R@1"]
		mb_3_layer_23_ffn_residual [label="MB3 L23\nFFN Residual\nGPU: R@1"]
		mb_3_layer_22_ffn_residual -> mb_3_layer_23_attn_norm
		mb_3_layer_23_attn_norm -> mb_3_layer_23_attn_qkv
		mb_3_layer_23_attn_qkv -> mb_3_layer_23_attn_out
		mb_3_layer_23_attn_out -> mb_3_layer_23_attn_residual
		mb_3_layer_23_attn_residual -> mb_3_layer_23_ffn_norm
		mb_3_layer_23_ffn_norm -> mb_3_layer_23_ffn_up
		mb_3_layer_23_ffn_up -> mb_3_layer_23_ffn_down
		mb_3_layer_23_ffn_down -> mb_3_layer_23_ffn_residual
		mb_3_layer_24_attn_norm [label="MB3 L24\nAttention Norm\nGPU: R@1"]
		mb_3_layer_24_attn_qkv [label="MB3 L24\nAttention QKV\nGPU: R@1"]
		mb_3_layer_24_attn_out [label="MB3 L24\nAttention Out\nGPU: R@1"]
		mb_3_layer_24_attn_residual [label="MB3 L24\nAttn Residual\nGPU: R@1"]
		mb_3_layer_24_ffn_norm [label="MB3 L24\nFFN Norm\nGPU: R@1"]
		mb_3_layer_24_ffn_up [label="MB3 L24\nFFN Up\nGPU: R@1"]
		mb_3_layer_24_ffn_down [label="MB3 L24\nFFN Down\nGPU: R@1"]
		mb_3_layer_24_ffn_residual [label="MB3 L24\nFFN Residual\nGPU: R@1"]
		mb_3_layer_23_ffn_residual -> mb_3_layer_24_attn_norm
		mb_3_layer_24_attn_norm -> mb_3_layer_24_attn_qkv
		mb_3_layer_24_attn_qkv -> mb_3_layer_24_attn_out
		mb_3_layer_24_attn_out -> mb_3_layer_24_attn_residual
		mb_3_layer_24_attn_residual -> mb_3_layer_24_ffn_norm
		mb_3_layer_24_ffn_norm -> mb_3_layer_24_ffn_up
		mb_3_layer_24_ffn_up -> mb_3_layer_24_ffn_down
		mb_3_layer_24_ffn_down -> mb_3_layer_24_ffn_residual
		mb_3_layer_25_attn_norm [label="MB3 L25\nAttention Norm\nGPU: R@1"]
		mb_3_layer_25_attn_qkv [label="MB3 L25\nAttention QKV\nGPU: R@1"]
		mb_3_layer_25_attn_out [label="MB3 L25\nAttention Out\nGPU: R@1"]
		mb_3_layer_25_attn_residual [label="MB3 L25\nAttn Residual\nGPU: R@1"]
		mb_3_layer_25_ffn_norm [label="MB3 L25\nFFN Norm\nGPU: R@1"]
		mb_3_layer_25_ffn_up [label="MB3 L25\nFFN Up\nGPU: R@1"]
		mb_3_layer_25_ffn_down [label="MB3 L25\nFFN Down\nGPU: R@1"]
		mb_3_layer_25_ffn_residual [label="MB3 L25\nFFN Residual\nGPU: R@1"]
		mb_3_layer_24_ffn_residual -> mb_3_layer_25_attn_norm
		mb_3_layer_25_attn_norm -> mb_3_layer_25_attn_qkv
		mb_3_layer_25_attn_qkv -> mb_3_layer_25_attn_out
		mb_3_layer_25_attn_out -> mb_3_layer_25_attn_residual
		mb_3_layer_25_attn_residual -> mb_3_layer_25_ffn_norm
		mb_3_layer_25_ffn_norm -> mb_3_layer_25_ffn_up
		mb_3_layer_25_ffn_up -> mb_3_layer_25_ffn_down
		mb_3_layer_25_ffn_down -> mb_3_layer_25_ffn_residual
		mb_3_stage_4_output [label="MB3\nStage 5\nOutput\nGPU: R@1"]
		mb_3_layer_25_ffn_residual -> mb_3_stage_4_output
		mb_4_comm_stage_3 [label="Micro-Batch 4\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@4 To: R@1" fillcolor=lightyellow shape=parallelogram]
		mb_4_layer_21_attn_norm [label="MB4 L21\nAttention Norm\nGPU: R@1"]
		mb_4_layer_21_attn_qkv [label="MB4 L21\nAttention QKV\nGPU: R@1"]
		mb_4_layer_21_attn_out [label="MB4 L21\nAttention Out\nGPU: R@1"]
		mb_4_layer_21_attn_residual [label="MB4 L21\nAttn Residual\nGPU: R@1"]
		mb_4_layer_21_ffn_norm [label="MB4 L21\nFFN Norm\nGPU: R@1"]
		mb_4_layer_21_ffn_up [label="MB4 L21\nFFN Up\nGPU: R@1"]
		mb_4_layer_21_ffn_down [label="MB4 L21\nFFN Down\nGPU: R@1"]
		mb_4_layer_21_ffn_residual [label="MB4 L21\nFFN Residual\nGPU: R@1"]
		mb_4_comm_stage_3 -> mb_4_layer_21_attn_norm
		mb_4_layer_21_attn_norm -> mb_4_layer_21_attn_qkv
		mb_4_layer_21_attn_qkv -> mb_4_layer_21_attn_out
		mb_4_layer_21_attn_out -> mb_4_layer_21_attn_residual
		mb_4_layer_21_attn_residual -> mb_4_layer_21_ffn_norm
		mb_4_layer_21_ffn_norm -> mb_4_layer_21_ffn_up
		mb_4_layer_21_ffn_up -> mb_4_layer_21_ffn_down
		mb_4_layer_21_ffn_down -> mb_4_layer_21_ffn_residual
		mb_4_layer_22_attn_norm [label="MB4 L22\nAttention Norm\nGPU: R@1"]
		mb_4_layer_22_attn_qkv [label="MB4 L22\nAttention QKV\nGPU: R@1"]
		mb_4_layer_22_attn_out [label="MB4 L22\nAttention Out\nGPU: R@1"]
		mb_4_layer_22_attn_residual [label="MB4 L22\nAttn Residual\nGPU: R@1"]
		mb_4_layer_22_ffn_norm [label="MB4 L22\nFFN Norm\nGPU: R@1"]
		mb_4_layer_22_ffn_up [label="MB4 L22\nFFN Up\nGPU: R@1"]
		mb_4_layer_22_ffn_down [label="MB4 L22\nFFN Down\nGPU: R@1"]
		mb_4_layer_22_ffn_residual [label="MB4 L22\nFFN Residual\nGPU: R@1"]
		mb_4_layer_21_ffn_residual -> mb_4_layer_22_attn_norm
		mb_4_layer_22_attn_norm -> mb_4_layer_22_attn_qkv
		mb_4_layer_22_attn_qkv -> mb_4_layer_22_attn_out
		mb_4_layer_22_attn_out -> mb_4_layer_22_attn_residual
		mb_4_layer_22_attn_residual -> mb_4_layer_22_ffn_norm
		mb_4_layer_22_ffn_norm -> mb_4_layer_22_ffn_up
		mb_4_layer_22_ffn_up -> mb_4_layer_22_ffn_down
		mb_4_layer_22_ffn_down -> mb_4_layer_22_ffn_residual
		mb_4_layer_23_attn_norm [label="MB4 L23\nAttention Norm\nGPU: R@1"]
		mb_4_layer_23_attn_qkv [label="MB4 L23\nAttention QKV\nGPU: R@1"]
		mb_4_layer_23_attn_out [label="MB4 L23\nAttention Out\nGPU: R@1"]
		mb_4_layer_23_attn_residual [label="MB4 L23\nAttn Residual\nGPU: R@1"]
		mb_4_layer_23_ffn_norm [label="MB4 L23\nFFN Norm\nGPU: R@1"]
		mb_4_layer_23_ffn_up [label="MB4 L23\nFFN Up\nGPU: R@1"]
		mb_4_layer_23_ffn_down [label="MB4 L23\nFFN Down\nGPU: R@1"]
		mb_4_layer_23_ffn_residual [label="MB4 L23\nFFN Residual\nGPU: R@1"]
		mb_4_layer_22_ffn_residual -> mb_4_layer_23_attn_norm
		mb_4_layer_23_attn_norm -> mb_4_layer_23_attn_qkv
		mb_4_layer_23_attn_qkv -> mb_4_layer_23_attn_out
		mb_4_layer_23_attn_out -> mb_4_layer_23_attn_residual
		mb_4_layer_23_attn_residual -> mb_4_layer_23_ffn_norm
		mb_4_layer_23_ffn_norm -> mb_4_layer_23_ffn_up
		mb_4_layer_23_ffn_up -> mb_4_layer_23_ffn_down
		mb_4_layer_23_ffn_down -> mb_4_layer_23_ffn_residual
		mb_4_layer_24_attn_norm [label="MB4 L24\nAttention Norm\nGPU: R@1"]
		mb_4_layer_24_attn_qkv [label="MB4 L24\nAttention QKV\nGPU: R@1"]
		mb_4_layer_24_attn_out [label="MB4 L24\nAttention Out\nGPU: R@1"]
		mb_4_layer_24_attn_residual [label="MB4 L24\nAttn Residual\nGPU: R@1"]
		mb_4_layer_24_ffn_norm [label="MB4 L24\nFFN Norm\nGPU: R@1"]
		mb_4_layer_24_ffn_up [label="MB4 L24\nFFN Up\nGPU: R@1"]
		mb_4_layer_24_ffn_down [label="MB4 L24\nFFN Down\nGPU: R@1"]
		mb_4_layer_24_ffn_residual [label="MB4 L24\nFFN Residual\nGPU: R@1"]
		mb_4_layer_23_ffn_residual -> mb_4_layer_24_attn_norm
		mb_4_layer_24_attn_norm -> mb_4_layer_24_attn_qkv
		mb_4_layer_24_attn_qkv -> mb_4_layer_24_attn_out
		mb_4_layer_24_attn_out -> mb_4_layer_24_attn_residual
		mb_4_layer_24_attn_residual -> mb_4_layer_24_ffn_norm
		mb_4_layer_24_ffn_norm -> mb_4_layer_24_ffn_up
		mb_4_layer_24_ffn_up -> mb_4_layer_24_ffn_down
		mb_4_layer_24_ffn_down -> mb_4_layer_24_ffn_residual
		mb_4_layer_25_attn_norm [label="MB4 L25\nAttention Norm\nGPU: R@1"]
		mb_4_layer_25_attn_qkv [label="MB4 L25\nAttention QKV\nGPU: R@1"]
		mb_4_layer_25_attn_out [label="MB4 L25\nAttention Out\nGPU: R@1"]
		mb_4_layer_25_attn_residual [label="MB4 L25\nAttn Residual\nGPU: R@1"]
		mb_4_layer_25_ffn_norm [label="MB4 L25\nFFN Norm\nGPU: R@1"]
		mb_4_layer_25_ffn_up [label="MB4 L25\nFFN Up\nGPU: R@1"]
		mb_4_layer_25_ffn_down [label="MB4 L25\nFFN Down\nGPU: R@1"]
		mb_4_layer_25_ffn_residual [label="MB4 L25\nFFN Residual\nGPU: R@1"]
		mb_4_layer_24_ffn_residual -> mb_4_layer_25_attn_norm
		mb_4_layer_25_attn_norm -> mb_4_layer_25_attn_qkv
		mb_4_layer_25_attn_qkv -> mb_4_layer_25_attn_out
		mb_4_layer_25_attn_out -> mb_4_layer_25_attn_residual
		mb_4_layer_25_attn_residual -> mb_4_layer_25_ffn_norm
		mb_4_layer_25_ffn_norm -> mb_4_layer_25_ffn_up
		mb_4_layer_25_ffn_up -> mb_4_layer_25_ffn_down
		mb_4_layer_25_ffn_down -> mb_4_layer_25_ffn_residual
		mb_4_stage_4_output [label="MB4\nStage 5\nOutput\nGPU: R@1"]
		mb_4_layer_25_ffn_residual -> mb_4_stage_4_output
		mb_5_comm_stage_3 [label="Micro-Batch 5\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: P@4 To: R@1" fillcolor=lightyellow shape=parallelogram]
		mb_5_layer_21_attn_norm [label="MB5 L21\nAttention Norm\nGPU: R@1"]
		mb_5_layer_21_attn_qkv [label="MB5 L21\nAttention QKV\nGPU: R@1"]
		mb_5_layer_21_attn_out [label="MB5 L21\nAttention Out\nGPU: R@1"]
		mb_5_layer_21_attn_residual [label="MB5 L21\nAttn Residual\nGPU: R@1"]
		mb_5_layer_21_ffn_norm [label="MB5 L21\nFFN Norm\nGPU: R@1"]
		mb_5_layer_21_ffn_up [label="MB5 L21\nFFN Up\nGPU: R@1"]
		mb_5_layer_21_ffn_down [label="MB5 L21\nFFN Down\nGPU: R@1"]
		mb_5_layer_21_ffn_residual [label="MB5 L21\nFFN Residual\nGPU: R@1"]
		mb_5_comm_stage_3 -> mb_5_layer_21_attn_norm
		mb_5_layer_21_attn_norm -> mb_5_layer_21_attn_qkv
		mb_5_layer_21_attn_qkv -> mb_5_layer_21_attn_out
		mb_5_layer_21_attn_out -> mb_5_layer_21_attn_residual
		mb_5_layer_21_attn_residual -> mb_5_layer_21_ffn_norm
		mb_5_layer_21_ffn_norm -> mb_5_layer_21_ffn_up
		mb_5_layer_21_ffn_up -> mb_5_layer_21_ffn_down
		mb_5_layer_21_ffn_down -> mb_5_layer_21_ffn_residual
		mb_5_layer_22_attn_norm [label="MB5 L22\nAttention Norm\nGPU: R@1"]
		mb_5_layer_22_attn_qkv [label="MB5 L22\nAttention QKV\nGPU: R@1"]
		mb_5_layer_22_attn_out [label="MB5 L22\nAttention Out\nGPU: R@1"]
		mb_5_layer_22_attn_residual [label="MB5 L22\nAttn Residual\nGPU: R@1"]
		mb_5_layer_22_ffn_norm [label="MB5 L22\nFFN Norm\nGPU: R@1"]
		mb_5_layer_22_ffn_up [label="MB5 L22\nFFN Up\nGPU: R@1"]
		mb_5_layer_22_ffn_down [label="MB5 L22\nFFN Down\nGPU: R@1"]
		mb_5_layer_22_ffn_residual [label="MB5 L22\nFFN Residual\nGPU: R@1"]
		mb_5_layer_21_ffn_residual -> mb_5_layer_22_attn_norm
		mb_5_layer_22_attn_norm -> mb_5_layer_22_attn_qkv
		mb_5_layer_22_attn_qkv -> mb_5_layer_22_attn_out
		mb_5_layer_22_attn_out -> mb_5_layer_22_attn_residual
		mb_5_layer_22_attn_residual -> mb_5_layer_22_ffn_norm
		mb_5_layer_22_ffn_norm -> mb_5_layer_22_ffn_up
		mb_5_layer_22_ffn_up -> mb_5_layer_22_ffn_down
		mb_5_layer_22_ffn_down -> mb_5_layer_22_ffn_residual
		mb_5_layer_23_attn_norm [label="MB5 L23\nAttention Norm\nGPU: R@1"]
		mb_5_layer_23_attn_qkv [label="MB5 L23\nAttention QKV\nGPU: R@1"]
		mb_5_layer_23_attn_out [label="MB5 L23\nAttention Out\nGPU: R@1"]
		mb_5_layer_23_attn_residual [label="MB5 L23\nAttn Residual\nGPU: R@1"]
		mb_5_layer_23_ffn_norm [label="MB5 L23\nFFN Norm\nGPU: R@1"]
		mb_5_layer_23_ffn_up [label="MB5 L23\nFFN Up\nGPU: R@1"]
		mb_5_layer_23_ffn_down [label="MB5 L23\nFFN Down\nGPU: R@1"]
		mb_5_layer_23_ffn_residual [label="MB5 L23\nFFN Residual\nGPU: R@1"]
		mb_5_layer_22_ffn_residual -> mb_5_layer_23_attn_norm
		mb_5_layer_23_attn_norm -> mb_5_layer_23_attn_qkv
		mb_5_layer_23_attn_qkv -> mb_5_layer_23_attn_out
		mb_5_layer_23_attn_out -> mb_5_layer_23_attn_residual
		mb_5_layer_23_attn_residual -> mb_5_layer_23_ffn_norm
		mb_5_layer_23_ffn_norm -> mb_5_layer_23_ffn_up
		mb_5_layer_23_ffn_up -> mb_5_layer_23_ffn_down
		mb_5_layer_23_ffn_down -> mb_5_layer_23_ffn_residual
		mb_5_layer_24_attn_norm [label="MB5 L24\nAttention Norm\nGPU: R@1"]
		mb_5_layer_24_attn_qkv [label="MB5 L24\nAttention QKV\nGPU: R@1"]
		mb_5_layer_24_attn_out [label="MB5 L24\nAttention Out\nGPU: R@1"]
		mb_5_layer_24_attn_residual [label="MB5 L24\nAttn Residual\nGPU: R@1"]
		mb_5_layer_24_ffn_norm [label="MB5 L24\nFFN Norm\nGPU: R@1"]
		mb_5_layer_24_ffn_up [label="MB5 L24\nFFN Up\nGPU: R@1"]
		mb_5_layer_24_ffn_down [label="MB5 L24\nFFN Down\nGPU: R@1"]
		mb_5_layer_24_ffn_residual [label="MB5 L24\nFFN Residual\nGPU: R@1"]
		mb_5_layer_23_ffn_residual -> mb_5_layer_24_attn_norm
		mb_5_layer_24_attn_norm -> mb_5_layer_24_attn_qkv
		mb_5_layer_24_attn_qkv -> mb_5_layer_24_attn_out
		mb_5_layer_24_attn_out -> mb_5_layer_24_attn_residual
		mb_5_layer_24_attn_residual -> mb_5_layer_24_ffn_norm
		mb_5_layer_24_ffn_norm -> mb_5_layer_24_ffn_up
		mb_5_layer_24_ffn_up -> mb_5_layer_24_ffn_down
		mb_5_layer_24_ffn_down -> mb_5_layer_24_ffn_residual
		mb_5_layer_25_attn_norm [label="MB5 L25\nAttention Norm\nGPU: R@1"]
		mb_5_layer_25_attn_qkv [label="MB5 L25\nAttention QKV\nGPU: R@1"]
		mb_5_layer_25_attn_out [label="MB5 L25\nAttention Out\nGPU: R@1"]
		mb_5_layer_25_attn_residual [label="MB5 L25\nAttn Residual\nGPU: R@1"]
		mb_5_layer_25_ffn_norm [label="MB5 L25\nFFN Norm\nGPU: R@1"]
		mb_5_layer_25_ffn_up [label="MB5 L25\nFFN Up\nGPU: R@1"]
		mb_5_layer_25_ffn_down [label="MB5 L25\nFFN Down\nGPU: R@1"]
		mb_5_layer_25_ffn_residual [label="MB5 L25\nFFN Residual\nGPU: R@1"]
		mb_5_layer_24_ffn_residual -> mb_5_layer_25_attn_norm
		mb_5_layer_25_attn_norm -> mb_5_layer_25_attn_qkv
		mb_5_layer_25_attn_qkv -> mb_5_layer_25_attn_out
		mb_5_layer_25_attn_out -> mb_5_layer_25_attn_residual
		mb_5_layer_25_attn_residual -> mb_5_layer_25_ffn_norm
		mb_5_layer_25_ffn_norm -> mb_5_layer_25_ffn_up
		mb_5_layer_25_ffn_up -> mb_5_layer_25_ffn_down
		mb_5_layer_25_ffn_down -> mb_5_layer_25_ffn_residual
		mb_5_stage_4_output [label="MB5\nStage 5\nOutput\nGPU: R@1"]
		mb_5_layer_25_ffn_residual -> mb_5_stage_4_output
	}
	mb_0_stage_4_output -> mb_0_comm_stage_4
	mb_1_stage_4_output -> mb_1_comm_stage_4
	mb_2_stage_4_output -> mb_2_comm_stage_4
	mb_3_stage_4_output -> mb_3_comm_stage_4
	mb_4_stage_4_output -> mb_4_comm_stage_4
	mb_5_stage_4_output -> mb_5_comm_stage_4
	subgraph cluster_stage_5 {
		label="Stage 6\nR@2\nLayers 26-32" style=dashed
		mb_0_comm_stage_4 [label="Micro-Batch 0\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: R@1 To: R@2" fillcolor=lightyellow shape=parallelogram]
		mb_0_layer_26_attn_norm [label="MB0 L26\nAttention Norm\nGPU: R@2"]
		mb_0_layer_26_attn_qkv [label="MB0 L26\nAttention QKV\nGPU: R@2"]
		mb_0_layer_26_attn_out [label="MB0 L26\nAttention Out\nGPU: R@2"]
		mb_0_layer_26_attn_residual [label="MB0 L26\nAttn Residual\nGPU: R@2"]
		mb_0_layer_26_ffn_norm [label="MB0 L26\nFFN Norm\nGPU: R@2"]
		mb_0_layer_26_ffn_up [label="MB0 L26\nFFN Up\nGPU: R@2"]
		mb_0_layer_26_ffn_down [label="MB0 L26\nFFN Down\nGPU: R@2"]
		mb_0_layer_26_ffn_residual [label="MB0 L26\nFFN Residual\nGPU: R@2"]
		mb_0_comm_stage_4 -> mb_0_layer_26_attn_norm
		mb_0_layer_26_attn_norm -> mb_0_layer_26_attn_qkv
		mb_0_layer_26_attn_qkv -> mb_0_layer_26_attn_out
		mb_0_layer_26_attn_out -> mb_0_layer_26_attn_residual
		mb_0_layer_26_attn_residual -> mb_0_layer_26_ffn_norm
		mb_0_layer_26_ffn_norm -> mb_0_layer_26_ffn_up
		mb_0_layer_26_ffn_up -> mb_0_layer_26_ffn_down
		mb_0_layer_26_ffn_down -> mb_0_layer_26_ffn_residual
		mb_0_layer_27_attn_norm [label="MB0 L27\nAttention Norm\nGPU: R@2"]
		mb_0_layer_27_attn_qkv [label="MB0 L27\nAttention QKV\nGPU: R@2"]
		mb_0_layer_27_attn_out [label="MB0 L27\nAttention Out\nGPU: R@2"]
		mb_0_layer_27_attn_residual [label="MB0 L27\nAttn Residual\nGPU: R@2"]
		mb_0_layer_27_ffn_norm [label="MB0 L27\nFFN Norm\nGPU: R@2"]
		mb_0_layer_27_ffn_up [label="MB0 L27\nFFN Up\nGPU: R@2"]
		mb_0_layer_27_ffn_down [label="MB0 L27\nFFN Down\nGPU: R@2"]
		mb_0_layer_27_ffn_residual [label="MB0 L27\nFFN Residual\nGPU: R@2"]
		mb_0_layer_26_ffn_residual -> mb_0_layer_27_attn_norm
		mb_0_layer_27_attn_norm -> mb_0_layer_27_attn_qkv
		mb_0_layer_27_attn_qkv -> mb_0_layer_27_attn_out
		mb_0_layer_27_attn_out -> mb_0_layer_27_attn_residual
		mb_0_layer_27_attn_residual -> mb_0_layer_27_ffn_norm
		mb_0_layer_27_ffn_norm -> mb_0_layer_27_ffn_up
		mb_0_layer_27_ffn_up -> mb_0_layer_27_ffn_down
		mb_0_layer_27_ffn_down -> mb_0_layer_27_ffn_residual
		mb_0_layer_28_attn_norm [label="MB0 L28\nAttention Norm\nGPU: R@2"]
		mb_0_layer_28_attn_qkv [label="MB0 L28\nAttention QKV\nGPU: R@2"]
		mb_0_layer_28_attn_out [label="MB0 L28\nAttention Out\nGPU: R@2"]
		mb_0_layer_28_attn_residual [label="MB0 L28\nAttn Residual\nGPU: R@2"]
		mb_0_layer_28_ffn_norm [label="MB0 L28\nFFN Norm\nGPU: R@2"]
		mb_0_layer_28_ffn_up [label="MB0 L28\nFFN Up\nGPU: R@2"]
		mb_0_layer_28_ffn_down [label="MB0 L28\nFFN Down\nGPU: R@2"]
		mb_0_layer_28_ffn_residual [label="MB0 L28\nFFN Residual\nGPU: R@2"]
		mb_0_layer_27_ffn_residual -> mb_0_layer_28_attn_norm
		mb_0_layer_28_attn_norm -> mb_0_layer_28_attn_qkv
		mb_0_layer_28_attn_qkv -> mb_0_layer_28_attn_out
		mb_0_layer_28_attn_out -> mb_0_layer_28_attn_residual
		mb_0_layer_28_attn_residual -> mb_0_layer_28_ffn_norm
		mb_0_layer_28_ffn_norm -> mb_0_layer_28_ffn_up
		mb_0_layer_28_ffn_up -> mb_0_layer_28_ffn_down
		mb_0_layer_28_ffn_down -> mb_0_layer_28_ffn_residual
		mb_0_layer_29_attn_norm [label="MB0 L29\nAttention Norm\nGPU: R@2"]
		mb_0_layer_29_attn_qkv [label="MB0 L29\nAttention QKV\nGPU: R@2"]
		mb_0_layer_29_attn_out [label="MB0 L29\nAttention Out\nGPU: R@2"]
		mb_0_layer_29_attn_residual [label="MB0 L29\nAttn Residual\nGPU: R@2"]
		mb_0_layer_29_ffn_norm [label="MB0 L29\nFFN Norm\nGPU: R@2"]
		mb_0_layer_29_ffn_up [label="MB0 L29\nFFN Up\nGPU: R@2"]
		mb_0_layer_29_ffn_down [label="MB0 L29\nFFN Down\nGPU: R@2"]
		mb_0_layer_29_ffn_residual [label="MB0 L29\nFFN Residual\nGPU: R@2"]
		mb_0_layer_28_ffn_residual -> mb_0_layer_29_attn_norm
		mb_0_layer_29_attn_norm -> mb_0_layer_29_attn_qkv
		mb_0_layer_29_attn_qkv -> mb_0_layer_29_attn_out
		mb_0_layer_29_attn_out -> mb_0_layer_29_attn_residual
		mb_0_layer_29_attn_residual -> mb_0_layer_29_ffn_norm
		mb_0_layer_29_ffn_norm -> mb_0_layer_29_ffn_up
		mb_0_layer_29_ffn_up -> mb_0_layer_29_ffn_down
		mb_0_layer_29_ffn_down -> mb_0_layer_29_ffn_residual
		mb_0_layer_30_attn_norm [label="MB0 L30\nAttention Norm\nGPU: R@2"]
		mb_0_layer_30_attn_qkv [label="MB0 L30\nAttention QKV\nGPU: R@2"]
		mb_0_layer_30_attn_out [label="MB0 L30\nAttention Out\nGPU: R@2"]
		mb_0_layer_30_attn_residual [label="MB0 L30\nAttn Residual\nGPU: R@2"]
		mb_0_layer_30_ffn_norm [label="MB0 L30\nFFN Norm\nGPU: R@2"]
		mb_0_layer_30_ffn_up [label="MB0 L30\nFFN Up\nGPU: R@2"]
		mb_0_layer_30_ffn_down [label="MB0 L30\nFFN Down\nGPU: R@2"]
		mb_0_layer_30_ffn_residual [label="MB0 L30\nFFN Residual\nGPU: R@2"]
		mb_0_layer_29_ffn_residual -> mb_0_layer_30_attn_norm
		mb_0_layer_30_attn_norm -> mb_0_layer_30_attn_qkv
		mb_0_layer_30_attn_qkv -> mb_0_layer_30_attn_out
		mb_0_layer_30_attn_out -> mb_0_layer_30_attn_residual
		mb_0_layer_30_attn_residual -> mb_0_layer_30_ffn_norm
		mb_0_layer_30_ffn_norm -> mb_0_layer_30_ffn_up
		mb_0_layer_30_ffn_up -> mb_0_layer_30_ffn_down
		mb_0_layer_30_ffn_down -> mb_0_layer_30_ffn_residual
		mb_0_layer_31_attn_norm [label="MB0 L31\nAttention Norm\nGPU: R@2"]
		mb_0_layer_31_attn_qkv [label="MB0 L31\nAttention QKV\nGPU: R@2"]
		mb_0_layer_31_attn_out [label="MB0 L31\nAttention Out\nGPU: R@2"]
		mb_0_layer_31_attn_residual [label="MB0 L31\nAttn Residual\nGPU: R@2"]
		mb_0_layer_31_ffn_norm [label="MB0 L31\nFFN Norm\nGPU: R@2"]
		mb_0_layer_31_ffn_up [label="MB0 L31\nFFN Up\nGPU: R@2"]
		mb_0_layer_31_ffn_down [label="MB0 L31\nFFN Down\nGPU: R@2"]
		mb_0_layer_31_ffn_residual [label="MB0 L31\nFFN Residual\nGPU: R@2"]
		mb_0_layer_30_ffn_residual -> mb_0_layer_31_attn_norm
		mb_0_layer_31_attn_norm -> mb_0_layer_31_attn_qkv
		mb_0_layer_31_attn_qkv -> mb_0_layer_31_attn_out
		mb_0_layer_31_attn_out -> mb_0_layer_31_attn_residual
		mb_0_layer_31_attn_residual -> mb_0_layer_31_ffn_norm
		mb_0_layer_31_ffn_norm -> mb_0_layer_31_ffn_up
		mb_0_layer_31_ffn_up -> mb_0_layer_31_ffn_down
		mb_0_layer_31_ffn_down -> mb_0_layer_31_ffn_residual
		mb_0_layer_32_attn_norm [label="MB0 L32\nAttention Norm\nGPU: R@2"]
		mb_0_layer_32_attn_qkv [label="MB0 L32\nAttention QKV\nGPU: R@2"]
		mb_0_layer_32_attn_out [label="MB0 L32\nAttention Out\nGPU: R@2"]
		mb_0_layer_32_attn_residual [label="MB0 L32\nAttn Residual\nGPU: R@2"]
		mb_0_layer_32_ffn_norm [label="MB0 L32\nFFN Norm\nGPU: R@2"]
		mb_0_layer_32_ffn_up [label="MB0 L32\nFFN Up\nGPU: R@2"]
		mb_0_layer_32_ffn_down [label="MB0 L32\nFFN Down\nGPU: R@2"]
		mb_0_layer_32_ffn_residual [label="MB0 L32\nFFN Residual\nGPU: R@2"]
		mb_0_layer_31_ffn_residual -> mb_0_layer_32_attn_norm
		mb_0_layer_32_attn_norm -> mb_0_layer_32_attn_qkv
		mb_0_layer_32_attn_qkv -> mb_0_layer_32_attn_out
		mb_0_layer_32_attn_out -> mb_0_layer_32_attn_residual
		mb_0_layer_32_attn_residual -> mb_0_layer_32_ffn_norm
		mb_0_layer_32_ffn_norm -> mb_0_layer_32_ffn_up
		mb_0_layer_32_ffn_up -> mb_0_layer_32_ffn_down
		mb_0_layer_32_ffn_down -> mb_0_layer_32_ffn_residual
		mb_0_stage_5_output [label="MB0\nStage 6\nOutput\nGPU: R@2"]
		mb_0_layer_32_ffn_residual -> mb_0_stage_5_output
		mb_1_comm_stage_4 [label="Micro-Batch 1\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: R@1 To: R@2" fillcolor=lightyellow shape=parallelogram]
		mb_1_layer_26_attn_norm [label="MB1 L26\nAttention Norm\nGPU: R@2"]
		mb_1_layer_26_attn_qkv [label="MB1 L26\nAttention QKV\nGPU: R@2"]
		mb_1_layer_26_attn_out [label="MB1 L26\nAttention Out\nGPU: R@2"]
		mb_1_layer_26_attn_residual [label="MB1 L26\nAttn Residual\nGPU: R@2"]
		mb_1_layer_26_ffn_norm [label="MB1 L26\nFFN Norm\nGPU: R@2"]
		mb_1_layer_26_ffn_up [label="MB1 L26\nFFN Up\nGPU: R@2"]
		mb_1_layer_26_ffn_down [label="MB1 L26\nFFN Down\nGPU: R@2"]
		mb_1_layer_26_ffn_residual [label="MB1 L26\nFFN Residual\nGPU: R@2"]
		mb_1_comm_stage_4 -> mb_1_layer_26_attn_norm
		mb_1_layer_26_attn_norm -> mb_1_layer_26_attn_qkv
		mb_1_layer_26_attn_qkv -> mb_1_layer_26_attn_out
		mb_1_layer_26_attn_out -> mb_1_layer_26_attn_residual
		mb_1_layer_26_attn_residual -> mb_1_layer_26_ffn_norm
		mb_1_layer_26_ffn_norm -> mb_1_layer_26_ffn_up
		mb_1_layer_26_ffn_up -> mb_1_layer_26_ffn_down
		mb_1_layer_26_ffn_down -> mb_1_layer_26_ffn_residual
		mb_1_layer_27_attn_norm [label="MB1 L27\nAttention Norm\nGPU: R@2"]
		mb_1_layer_27_attn_qkv [label="MB1 L27\nAttention QKV\nGPU: R@2"]
		mb_1_layer_27_attn_out [label="MB1 L27\nAttention Out\nGPU: R@2"]
		mb_1_layer_27_attn_residual [label="MB1 L27\nAttn Residual\nGPU: R@2"]
		mb_1_layer_27_ffn_norm [label="MB1 L27\nFFN Norm\nGPU: R@2"]
		mb_1_layer_27_ffn_up [label="MB1 L27\nFFN Up\nGPU: R@2"]
		mb_1_layer_27_ffn_down [label="MB1 L27\nFFN Down\nGPU: R@2"]
		mb_1_layer_27_ffn_residual [label="MB1 L27\nFFN Residual\nGPU: R@2"]
		mb_1_layer_26_ffn_residual -> mb_1_layer_27_attn_norm
		mb_1_layer_27_attn_norm -> mb_1_layer_27_attn_qkv
		mb_1_layer_27_attn_qkv -> mb_1_layer_27_attn_out
		mb_1_layer_27_attn_out -> mb_1_layer_27_attn_residual
		mb_1_layer_27_attn_residual -> mb_1_layer_27_ffn_norm
		mb_1_layer_27_ffn_norm -> mb_1_layer_27_ffn_up
		mb_1_layer_27_ffn_up -> mb_1_layer_27_ffn_down
		mb_1_layer_27_ffn_down -> mb_1_layer_27_ffn_residual
		mb_1_layer_28_attn_norm [label="MB1 L28\nAttention Norm\nGPU: R@2"]
		mb_1_layer_28_attn_qkv [label="MB1 L28\nAttention QKV\nGPU: R@2"]
		mb_1_layer_28_attn_out [label="MB1 L28\nAttention Out\nGPU: R@2"]
		mb_1_layer_28_attn_residual [label="MB1 L28\nAttn Residual\nGPU: R@2"]
		mb_1_layer_28_ffn_norm [label="MB1 L28\nFFN Norm\nGPU: R@2"]
		mb_1_layer_28_ffn_up [label="MB1 L28\nFFN Up\nGPU: R@2"]
		mb_1_layer_28_ffn_down [label="MB1 L28\nFFN Down\nGPU: R@2"]
		mb_1_layer_28_ffn_residual [label="MB1 L28\nFFN Residual\nGPU: R@2"]
		mb_1_layer_27_ffn_residual -> mb_1_layer_28_attn_norm
		mb_1_layer_28_attn_norm -> mb_1_layer_28_attn_qkv
		mb_1_layer_28_attn_qkv -> mb_1_layer_28_attn_out
		mb_1_layer_28_attn_out -> mb_1_layer_28_attn_residual
		mb_1_layer_28_attn_residual -> mb_1_layer_28_ffn_norm
		mb_1_layer_28_ffn_norm -> mb_1_layer_28_ffn_up
		mb_1_layer_28_ffn_up -> mb_1_layer_28_ffn_down
		mb_1_layer_28_ffn_down -> mb_1_layer_28_ffn_residual
		mb_1_layer_29_attn_norm [label="MB1 L29\nAttention Norm\nGPU: R@2"]
		mb_1_layer_29_attn_qkv [label="MB1 L29\nAttention QKV\nGPU: R@2"]
		mb_1_layer_29_attn_out [label="MB1 L29\nAttention Out\nGPU: R@2"]
		mb_1_layer_29_attn_residual [label="MB1 L29\nAttn Residual\nGPU: R@2"]
		mb_1_layer_29_ffn_norm [label="MB1 L29\nFFN Norm\nGPU: R@2"]
		mb_1_layer_29_ffn_up [label="MB1 L29\nFFN Up\nGPU: R@2"]
		mb_1_layer_29_ffn_down [label="MB1 L29\nFFN Down\nGPU: R@2"]
		mb_1_layer_29_ffn_residual [label="MB1 L29\nFFN Residual\nGPU: R@2"]
		mb_1_layer_28_ffn_residual -> mb_1_layer_29_attn_norm
		mb_1_layer_29_attn_norm -> mb_1_layer_29_attn_qkv
		mb_1_layer_29_attn_qkv -> mb_1_layer_29_attn_out
		mb_1_layer_29_attn_out -> mb_1_layer_29_attn_residual
		mb_1_layer_29_attn_residual -> mb_1_layer_29_ffn_norm
		mb_1_layer_29_ffn_norm -> mb_1_layer_29_ffn_up
		mb_1_layer_29_ffn_up -> mb_1_layer_29_ffn_down
		mb_1_layer_29_ffn_down -> mb_1_layer_29_ffn_residual
		mb_1_layer_30_attn_norm [label="MB1 L30\nAttention Norm\nGPU: R@2"]
		mb_1_layer_30_attn_qkv [label="MB1 L30\nAttention QKV\nGPU: R@2"]
		mb_1_layer_30_attn_out [label="MB1 L30\nAttention Out\nGPU: R@2"]
		mb_1_layer_30_attn_residual [label="MB1 L30\nAttn Residual\nGPU: R@2"]
		mb_1_layer_30_ffn_norm [label="MB1 L30\nFFN Norm\nGPU: R@2"]
		mb_1_layer_30_ffn_up [label="MB1 L30\nFFN Up\nGPU: R@2"]
		mb_1_layer_30_ffn_down [label="MB1 L30\nFFN Down\nGPU: R@2"]
		mb_1_layer_30_ffn_residual [label="MB1 L30\nFFN Residual\nGPU: R@2"]
		mb_1_layer_29_ffn_residual -> mb_1_layer_30_attn_norm
		mb_1_layer_30_attn_norm -> mb_1_layer_30_attn_qkv
		mb_1_layer_30_attn_qkv -> mb_1_layer_30_attn_out
		mb_1_layer_30_attn_out -> mb_1_layer_30_attn_residual
		mb_1_layer_30_attn_residual -> mb_1_layer_30_ffn_norm
		mb_1_layer_30_ffn_norm -> mb_1_layer_30_ffn_up
		mb_1_layer_30_ffn_up -> mb_1_layer_30_ffn_down
		mb_1_layer_30_ffn_down -> mb_1_layer_30_ffn_residual
		mb_1_layer_31_attn_norm [label="MB1 L31\nAttention Norm\nGPU: R@2"]
		mb_1_layer_31_attn_qkv [label="MB1 L31\nAttention QKV\nGPU: R@2"]
		mb_1_layer_31_attn_out [label="MB1 L31\nAttention Out\nGPU: R@2"]
		mb_1_layer_31_attn_residual [label="MB1 L31\nAttn Residual\nGPU: R@2"]
		mb_1_layer_31_ffn_norm [label="MB1 L31\nFFN Norm\nGPU: R@2"]
		mb_1_layer_31_ffn_up [label="MB1 L31\nFFN Up\nGPU: R@2"]
		mb_1_layer_31_ffn_down [label="MB1 L31\nFFN Down\nGPU: R@2"]
		mb_1_layer_31_ffn_residual [label="MB1 L31\nFFN Residual\nGPU: R@2"]
		mb_1_layer_30_ffn_residual -> mb_1_layer_31_attn_norm
		mb_1_layer_31_attn_norm -> mb_1_layer_31_attn_qkv
		mb_1_layer_31_attn_qkv -> mb_1_layer_31_attn_out
		mb_1_layer_31_attn_out -> mb_1_layer_31_attn_residual
		mb_1_layer_31_attn_residual -> mb_1_layer_31_ffn_norm
		mb_1_layer_31_ffn_norm -> mb_1_layer_31_ffn_up
		mb_1_layer_31_ffn_up -> mb_1_layer_31_ffn_down
		mb_1_layer_31_ffn_down -> mb_1_layer_31_ffn_residual
		mb_1_layer_32_attn_norm [label="MB1 L32\nAttention Norm\nGPU: R@2"]
		mb_1_layer_32_attn_qkv [label="MB1 L32\nAttention QKV\nGPU: R@2"]
		mb_1_layer_32_attn_out [label="MB1 L32\nAttention Out\nGPU: R@2"]
		mb_1_layer_32_attn_residual [label="MB1 L32\nAttn Residual\nGPU: R@2"]
		mb_1_layer_32_ffn_norm [label="MB1 L32\nFFN Norm\nGPU: R@2"]
		mb_1_layer_32_ffn_up [label="MB1 L32\nFFN Up\nGPU: R@2"]
		mb_1_layer_32_ffn_down [label="MB1 L32\nFFN Down\nGPU: R@2"]
		mb_1_layer_32_ffn_residual [label="MB1 L32\nFFN Residual\nGPU: R@2"]
		mb_1_layer_31_ffn_residual -> mb_1_layer_32_attn_norm
		mb_1_layer_32_attn_norm -> mb_1_layer_32_attn_qkv
		mb_1_layer_32_attn_qkv -> mb_1_layer_32_attn_out
		mb_1_layer_32_attn_out -> mb_1_layer_32_attn_residual
		mb_1_layer_32_attn_residual -> mb_1_layer_32_ffn_norm
		mb_1_layer_32_ffn_norm -> mb_1_layer_32_ffn_up
		mb_1_layer_32_ffn_up -> mb_1_layer_32_ffn_down
		mb_1_layer_32_ffn_down -> mb_1_layer_32_ffn_residual
		mb_1_stage_5_output [label="MB1\nStage 6\nOutput\nGPU: R@2"]
		mb_1_layer_32_ffn_residual -> mb_1_stage_5_output
		mb_2_comm_stage_4 [label="Micro-Batch 2\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: R@1 To: R@2" fillcolor=lightyellow shape=parallelogram]
		mb_2_layer_26_attn_norm [label="MB2 L26\nAttention Norm\nGPU: R@2"]
		mb_2_layer_26_attn_qkv [label="MB2 L26\nAttention QKV\nGPU: R@2"]
		mb_2_layer_26_attn_out [label="MB2 L26\nAttention Out\nGPU: R@2"]
		mb_2_layer_26_attn_residual [label="MB2 L26\nAttn Residual\nGPU: R@2"]
		mb_2_layer_26_ffn_norm [label="MB2 L26\nFFN Norm\nGPU: R@2"]
		mb_2_layer_26_ffn_up [label="MB2 L26\nFFN Up\nGPU: R@2"]
		mb_2_layer_26_ffn_down [label="MB2 L26\nFFN Down\nGPU: R@2"]
		mb_2_layer_26_ffn_residual [label="MB2 L26\nFFN Residual\nGPU: R@2"]
		mb_2_comm_stage_4 -> mb_2_layer_26_attn_norm
		mb_2_layer_26_attn_norm -> mb_2_layer_26_attn_qkv
		mb_2_layer_26_attn_qkv -> mb_2_layer_26_attn_out
		mb_2_layer_26_attn_out -> mb_2_layer_26_attn_residual
		mb_2_layer_26_attn_residual -> mb_2_layer_26_ffn_norm
		mb_2_layer_26_ffn_norm -> mb_2_layer_26_ffn_up
		mb_2_layer_26_ffn_up -> mb_2_layer_26_ffn_down
		mb_2_layer_26_ffn_down -> mb_2_layer_26_ffn_residual
		mb_2_layer_27_attn_norm [label="MB2 L27\nAttention Norm\nGPU: R@2"]
		mb_2_layer_27_attn_qkv [label="MB2 L27\nAttention QKV\nGPU: R@2"]
		mb_2_layer_27_attn_out [label="MB2 L27\nAttention Out\nGPU: R@2"]
		mb_2_layer_27_attn_residual [label="MB2 L27\nAttn Residual\nGPU: R@2"]
		mb_2_layer_27_ffn_norm [label="MB2 L27\nFFN Norm\nGPU: R@2"]
		mb_2_layer_27_ffn_up [label="MB2 L27\nFFN Up\nGPU: R@2"]
		mb_2_layer_27_ffn_down [label="MB2 L27\nFFN Down\nGPU: R@2"]
		mb_2_layer_27_ffn_residual [label="MB2 L27\nFFN Residual\nGPU: R@2"]
		mb_2_layer_26_ffn_residual -> mb_2_layer_27_attn_norm
		mb_2_layer_27_attn_norm -> mb_2_layer_27_attn_qkv
		mb_2_layer_27_attn_qkv -> mb_2_layer_27_attn_out
		mb_2_layer_27_attn_out -> mb_2_layer_27_attn_residual
		mb_2_layer_27_attn_residual -> mb_2_layer_27_ffn_norm
		mb_2_layer_27_ffn_norm -> mb_2_layer_27_ffn_up
		mb_2_layer_27_ffn_up -> mb_2_layer_27_ffn_down
		mb_2_layer_27_ffn_down -> mb_2_layer_27_ffn_residual
		mb_2_layer_28_attn_norm [label="MB2 L28\nAttention Norm\nGPU: R@2"]
		mb_2_layer_28_attn_qkv [label="MB2 L28\nAttention QKV\nGPU: R@2"]
		mb_2_layer_28_attn_out [label="MB2 L28\nAttention Out\nGPU: R@2"]
		mb_2_layer_28_attn_residual [label="MB2 L28\nAttn Residual\nGPU: R@2"]
		mb_2_layer_28_ffn_norm [label="MB2 L28\nFFN Norm\nGPU: R@2"]
		mb_2_layer_28_ffn_up [label="MB2 L28\nFFN Up\nGPU: R@2"]
		mb_2_layer_28_ffn_down [label="MB2 L28\nFFN Down\nGPU: R@2"]
		mb_2_layer_28_ffn_residual [label="MB2 L28\nFFN Residual\nGPU: R@2"]
		mb_2_layer_27_ffn_residual -> mb_2_layer_28_attn_norm
		mb_2_layer_28_attn_norm -> mb_2_layer_28_attn_qkv
		mb_2_layer_28_attn_qkv -> mb_2_layer_28_attn_out
		mb_2_layer_28_attn_out -> mb_2_layer_28_attn_residual
		mb_2_layer_28_attn_residual -> mb_2_layer_28_ffn_norm
		mb_2_layer_28_ffn_norm -> mb_2_layer_28_ffn_up
		mb_2_layer_28_ffn_up -> mb_2_layer_28_ffn_down
		mb_2_layer_28_ffn_down -> mb_2_layer_28_ffn_residual
		mb_2_layer_29_attn_norm [label="MB2 L29\nAttention Norm\nGPU: R@2"]
		mb_2_layer_29_attn_qkv [label="MB2 L29\nAttention QKV\nGPU: R@2"]
		mb_2_layer_29_attn_out [label="MB2 L29\nAttention Out\nGPU: R@2"]
		mb_2_layer_29_attn_residual [label="MB2 L29\nAttn Residual\nGPU: R@2"]
		mb_2_layer_29_ffn_norm [label="MB2 L29\nFFN Norm\nGPU: R@2"]
		mb_2_layer_29_ffn_up [label="MB2 L29\nFFN Up\nGPU: R@2"]
		mb_2_layer_29_ffn_down [label="MB2 L29\nFFN Down\nGPU: R@2"]
		mb_2_layer_29_ffn_residual [label="MB2 L29\nFFN Residual\nGPU: R@2"]
		mb_2_layer_28_ffn_residual -> mb_2_layer_29_attn_norm
		mb_2_layer_29_attn_norm -> mb_2_layer_29_attn_qkv
		mb_2_layer_29_attn_qkv -> mb_2_layer_29_attn_out
		mb_2_layer_29_attn_out -> mb_2_layer_29_attn_residual
		mb_2_layer_29_attn_residual -> mb_2_layer_29_ffn_norm
		mb_2_layer_29_ffn_norm -> mb_2_layer_29_ffn_up
		mb_2_layer_29_ffn_up -> mb_2_layer_29_ffn_down
		mb_2_layer_29_ffn_down -> mb_2_layer_29_ffn_residual
		mb_2_layer_30_attn_norm [label="MB2 L30\nAttention Norm\nGPU: R@2"]
		mb_2_layer_30_attn_qkv [label="MB2 L30\nAttention QKV\nGPU: R@2"]
		mb_2_layer_30_attn_out [label="MB2 L30\nAttention Out\nGPU: R@2"]
		mb_2_layer_30_attn_residual [label="MB2 L30\nAttn Residual\nGPU: R@2"]
		mb_2_layer_30_ffn_norm [label="MB2 L30\nFFN Norm\nGPU: R@2"]
		mb_2_layer_30_ffn_up [label="MB2 L30\nFFN Up\nGPU: R@2"]
		mb_2_layer_30_ffn_down [label="MB2 L30\nFFN Down\nGPU: R@2"]
		mb_2_layer_30_ffn_residual [label="MB2 L30\nFFN Residual\nGPU: R@2"]
		mb_2_layer_29_ffn_residual -> mb_2_layer_30_attn_norm
		mb_2_layer_30_attn_norm -> mb_2_layer_30_attn_qkv
		mb_2_layer_30_attn_qkv -> mb_2_layer_30_attn_out
		mb_2_layer_30_attn_out -> mb_2_layer_30_attn_residual
		mb_2_layer_30_attn_residual -> mb_2_layer_30_ffn_norm
		mb_2_layer_30_ffn_norm -> mb_2_layer_30_ffn_up
		mb_2_layer_30_ffn_up -> mb_2_layer_30_ffn_down
		mb_2_layer_30_ffn_down -> mb_2_layer_30_ffn_residual
		mb_2_layer_31_attn_norm [label="MB2 L31\nAttention Norm\nGPU: R@2"]
		mb_2_layer_31_attn_qkv [label="MB2 L31\nAttention QKV\nGPU: R@2"]
		mb_2_layer_31_attn_out [label="MB2 L31\nAttention Out\nGPU: R@2"]
		mb_2_layer_31_attn_residual [label="MB2 L31\nAttn Residual\nGPU: R@2"]
		mb_2_layer_31_ffn_norm [label="MB2 L31\nFFN Norm\nGPU: R@2"]
		mb_2_layer_31_ffn_up [label="MB2 L31\nFFN Up\nGPU: R@2"]
		mb_2_layer_31_ffn_down [label="MB2 L31\nFFN Down\nGPU: R@2"]
		mb_2_layer_31_ffn_residual [label="MB2 L31\nFFN Residual\nGPU: R@2"]
		mb_2_layer_30_ffn_residual -> mb_2_layer_31_attn_norm
		mb_2_layer_31_attn_norm -> mb_2_layer_31_attn_qkv
		mb_2_layer_31_attn_qkv -> mb_2_layer_31_attn_out
		mb_2_layer_31_attn_out -> mb_2_layer_31_attn_residual
		mb_2_layer_31_attn_residual -> mb_2_layer_31_ffn_norm
		mb_2_layer_31_ffn_norm -> mb_2_layer_31_ffn_up
		mb_2_layer_31_ffn_up -> mb_2_layer_31_ffn_down
		mb_2_layer_31_ffn_down -> mb_2_layer_31_ffn_residual
		mb_2_layer_32_attn_norm [label="MB2 L32\nAttention Norm\nGPU: R@2"]
		mb_2_layer_32_attn_qkv [label="MB2 L32\nAttention QKV\nGPU: R@2"]
		mb_2_layer_32_attn_out [label="MB2 L32\nAttention Out\nGPU: R@2"]
		mb_2_layer_32_attn_residual [label="MB2 L32\nAttn Residual\nGPU: R@2"]
		mb_2_layer_32_ffn_norm [label="MB2 L32\nFFN Norm\nGPU: R@2"]
		mb_2_layer_32_ffn_up [label="MB2 L32\nFFN Up\nGPU: R@2"]
		mb_2_layer_32_ffn_down [label="MB2 L32\nFFN Down\nGPU: R@2"]
		mb_2_layer_32_ffn_residual [label="MB2 L32\nFFN Residual\nGPU: R@2"]
		mb_2_layer_31_ffn_residual -> mb_2_layer_32_attn_norm
		mb_2_layer_32_attn_norm -> mb_2_layer_32_attn_qkv
		mb_2_layer_32_attn_qkv -> mb_2_layer_32_attn_out
		mb_2_layer_32_attn_out -> mb_2_layer_32_attn_residual
		mb_2_layer_32_attn_residual -> mb_2_layer_32_ffn_norm
		mb_2_layer_32_ffn_norm -> mb_2_layer_32_ffn_up
		mb_2_layer_32_ffn_up -> mb_2_layer_32_ffn_down
		mb_2_layer_32_ffn_down -> mb_2_layer_32_ffn_residual
		mb_2_stage_5_output [label="MB2\nStage 6\nOutput\nGPU: R@2"]
		mb_2_layer_32_ffn_residual -> mb_2_stage_5_output
		mb_3_comm_stage_4 [label="Micro-Batch 3\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: R@1 To: R@2" fillcolor=lightyellow shape=parallelogram]
		mb_3_layer_26_attn_norm [label="MB3 L26\nAttention Norm\nGPU: R@2"]
		mb_3_layer_26_attn_qkv [label="MB3 L26\nAttention QKV\nGPU: R@2"]
		mb_3_layer_26_attn_out [label="MB3 L26\nAttention Out\nGPU: R@2"]
		mb_3_layer_26_attn_residual [label="MB3 L26\nAttn Residual\nGPU: R@2"]
		mb_3_layer_26_ffn_norm [label="MB3 L26\nFFN Norm\nGPU: R@2"]
		mb_3_layer_26_ffn_up [label="MB3 L26\nFFN Up\nGPU: R@2"]
		mb_3_layer_26_ffn_down [label="MB3 L26\nFFN Down\nGPU: R@2"]
		mb_3_layer_26_ffn_residual [label="MB3 L26\nFFN Residual\nGPU: R@2"]
		mb_3_comm_stage_4 -> mb_3_layer_26_attn_norm
		mb_3_layer_26_attn_norm -> mb_3_layer_26_attn_qkv
		mb_3_layer_26_attn_qkv -> mb_3_layer_26_attn_out
		mb_3_layer_26_attn_out -> mb_3_layer_26_attn_residual
		mb_3_layer_26_attn_residual -> mb_3_layer_26_ffn_norm
		mb_3_layer_26_ffn_norm -> mb_3_layer_26_ffn_up
		mb_3_layer_26_ffn_up -> mb_3_layer_26_ffn_down
		mb_3_layer_26_ffn_down -> mb_3_layer_26_ffn_residual
		mb_3_layer_27_attn_norm [label="MB3 L27\nAttention Norm\nGPU: R@2"]
		mb_3_layer_27_attn_qkv [label="MB3 L27\nAttention QKV\nGPU: R@2"]
		mb_3_layer_27_attn_out [label="MB3 L27\nAttention Out\nGPU: R@2"]
		mb_3_layer_27_attn_residual [label="MB3 L27\nAttn Residual\nGPU: R@2"]
		mb_3_layer_27_ffn_norm [label="MB3 L27\nFFN Norm\nGPU: R@2"]
		mb_3_layer_27_ffn_up [label="MB3 L27\nFFN Up\nGPU: R@2"]
		mb_3_layer_27_ffn_down [label="MB3 L27\nFFN Down\nGPU: R@2"]
		mb_3_layer_27_ffn_residual [label="MB3 L27\nFFN Residual\nGPU: R@2"]
		mb_3_layer_26_ffn_residual -> mb_3_layer_27_attn_norm
		mb_3_layer_27_attn_norm -> mb_3_layer_27_attn_qkv
		mb_3_layer_27_attn_qkv -> mb_3_layer_27_attn_out
		mb_3_layer_27_attn_out -> mb_3_layer_27_attn_residual
		mb_3_layer_27_attn_residual -> mb_3_layer_27_ffn_norm
		mb_3_layer_27_ffn_norm -> mb_3_layer_27_ffn_up
		mb_3_layer_27_ffn_up -> mb_3_layer_27_ffn_down
		mb_3_layer_27_ffn_down -> mb_3_layer_27_ffn_residual
		mb_3_layer_28_attn_norm [label="MB3 L28\nAttention Norm\nGPU: R@2"]
		mb_3_layer_28_attn_qkv [label="MB3 L28\nAttention QKV\nGPU: R@2"]
		mb_3_layer_28_attn_out [label="MB3 L28\nAttention Out\nGPU: R@2"]
		mb_3_layer_28_attn_residual [label="MB3 L28\nAttn Residual\nGPU: R@2"]
		mb_3_layer_28_ffn_norm [label="MB3 L28\nFFN Norm\nGPU: R@2"]
		mb_3_layer_28_ffn_up [label="MB3 L28\nFFN Up\nGPU: R@2"]
		mb_3_layer_28_ffn_down [label="MB3 L28\nFFN Down\nGPU: R@2"]
		mb_3_layer_28_ffn_residual [label="MB3 L28\nFFN Residual\nGPU: R@2"]
		mb_3_layer_27_ffn_residual -> mb_3_layer_28_attn_norm
		mb_3_layer_28_attn_norm -> mb_3_layer_28_attn_qkv
		mb_3_layer_28_attn_qkv -> mb_3_layer_28_attn_out
		mb_3_layer_28_attn_out -> mb_3_layer_28_attn_residual
		mb_3_layer_28_attn_residual -> mb_3_layer_28_ffn_norm
		mb_3_layer_28_ffn_norm -> mb_3_layer_28_ffn_up
		mb_3_layer_28_ffn_up -> mb_3_layer_28_ffn_down
		mb_3_layer_28_ffn_down -> mb_3_layer_28_ffn_residual
		mb_3_layer_29_attn_norm [label="MB3 L29\nAttention Norm\nGPU: R@2"]
		mb_3_layer_29_attn_qkv [label="MB3 L29\nAttention QKV\nGPU: R@2"]
		mb_3_layer_29_attn_out [label="MB3 L29\nAttention Out\nGPU: R@2"]
		mb_3_layer_29_attn_residual [label="MB3 L29\nAttn Residual\nGPU: R@2"]
		mb_3_layer_29_ffn_norm [label="MB3 L29\nFFN Norm\nGPU: R@2"]
		mb_3_layer_29_ffn_up [label="MB3 L29\nFFN Up\nGPU: R@2"]
		mb_3_layer_29_ffn_down [label="MB3 L29\nFFN Down\nGPU: R@2"]
		mb_3_layer_29_ffn_residual [label="MB3 L29\nFFN Residual\nGPU: R@2"]
		mb_3_layer_28_ffn_residual -> mb_3_layer_29_attn_norm
		mb_3_layer_29_attn_norm -> mb_3_layer_29_attn_qkv
		mb_3_layer_29_attn_qkv -> mb_3_layer_29_attn_out
		mb_3_layer_29_attn_out -> mb_3_layer_29_attn_residual
		mb_3_layer_29_attn_residual -> mb_3_layer_29_ffn_norm
		mb_3_layer_29_ffn_norm -> mb_3_layer_29_ffn_up
		mb_3_layer_29_ffn_up -> mb_3_layer_29_ffn_down
		mb_3_layer_29_ffn_down -> mb_3_layer_29_ffn_residual
		mb_3_layer_30_attn_norm [label="MB3 L30\nAttention Norm\nGPU: R@2"]
		mb_3_layer_30_attn_qkv [label="MB3 L30\nAttention QKV\nGPU: R@2"]
		mb_3_layer_30_attn_out [label="MB3 L30\nAttention Out\nGPU: R@2"]
		mb_3_layer_30_attn_residual [label="MB3 L30\nAttn Residual\nGPU: R@2"]
		mb_3_layer_30_ffn_norm [label="MB3 L30\nFFN Norm\nGPU: R@2"]
		mb_3_layer_30_ffn_up [label="MB3 L30\nFFN Up\nGPU: R@2"]
		mb_3_layer_30_ffn_down [label="MB3 L30\nFFN Down\nGPU: R@2"]
		mb_3_layer_30_ffn_residual [label="MB3 L30\nFFN Residual\nGPU: R@2"]
		mb_3_layer_29_ffn_residual -> mb_3_layer_30_attn_norm
		mb_3_layer_30_attn_norm -> mb_3_layer_30_attn_qkv
		mb_3_layer_30_attn_qkv -> mb_3_layer_30_attn_out
		mb_3_layer_30_attn_out -> mb_3_layer_30_attn_residual
		mb_3_layer_30_attn_residual -> mb_3_layer_30_ffn_norm
		mb_3_layer_30_ffn_norm -> mb_3_layer_30_ffn_up
		mb_3_layer_30_ffn_up -> mb_3_layer_30_ffn_down
		mb_3_layer_30_ffn_down -> mb_3_layer_30_ffn_residual
		mb_3_layer_31_attn_norm [label="MB3 L31\nAttention Norm\nGPU: R@2"]
		mb_3_layer_31_attn_qkv [label="MB3 L31\nAttention QKV\nGPU: R@2"]
		mb_3_layer_31_attn_out [label="MB3 L31\nAttention Out\nGPU: R@2"]
		mb_3_layer_31_attn_residual [label="MB3 L31\nAttn Residual\nGPU: R@2"]
		mb_3_layer_31_ffn_norm [label="MB3 L31\nFFN Norm\nGPU: R@2"]
		mb_3_layer_31_ffn_up [label="MB3 L31\nFFN Up\nGPU: R@2"]
		mb_3_layer_31_ffn_down [label="MB3 L31\nFFN Down\nGPU: R@2"]
		mb_3_layer_31_ffn_residual [label="MB3 L31\nFFN Residual\nGPU: R@2"]
		mb_3_layer_30_ffn_residual -> mb_3_layer_31_attn_norm
		mb_3_layer_31_attn_norm -> mb_3_layer_31_attn_qkv
		mb_3_layer_31_attn_qkv -> mb_3_layer_31_attn_out
		mb_3_layer_31_attn_out -> mb_3_layer_31_attn_residual
		mb_3_layer_31_attn_residual -> mb_3_layer_31_ffn_norm
		mb_3_layer_31_ffn_norm -> mb_3_layer_31_ffn_up
		mb_3_layer_31_ffn_up -> mb_3_layer_31_ffn_down
		mb_3_layer_31_ffn_down -> mb_3_layer_31_ffn_residual
		mb_3_layer_32_attn_norm [label="MB3 L32\nAttention Norm\nGPU: R@2"]
		mb_3_layer_32_attn_qkv [label="MB3 L32\nAttention QKV\nGPU: R@2"]
		mb_3_layer_32_attn_out [label="MB3 L32\nAttention Out\nGPU: R@2"]
		mb_3_layer_32_attn_residual [label="MB3 L32\nAttn Residual\nGPU: R@2"]
		mb_3_layer_32_ffn_norm [label="MB3 L32\nFFN Norm\nGPU: R@2"]
		mb_3_layer_32_ffn_up [label="MB3 L32\nFFN Up\nGPU: R@2"]
		mb_3_layer_32_ffn_down [label="MB3 L32\nFFN Down\nGPU: R@2"]
		mb_3_layer_32_ffn_residual [label="MB3 L32\nFFN Residual\nGPU: R@2"]
		mb_3_layer_31_ffn_residual -> mb_3_layer_32_attn_norm
		mb_3_layer_32_attn_norm -> mb_3_layer_32_attn_qkv
		mb_3_layer_32_attn_qkv -> mb_3_layer_32_attn_out
		mb_3_layer_32_attn_out -> mb_3_layer_32_attn_residual
		mb_3_layer_32_attn_residual -> mb_3_layer_32_ffn_norm
		mb_3_layer_32_ffn_norm -> mb_3_layer_32_ffn_up
		mb_3_layer_32_ffn_up -> mb_3_layer_32_ffn_down
		mb_3_layer_32_ffn_down -> mb_3_layer_32_ffn_residual
		mb_3_stage_5_output [label="MB3\nStage 6\nOutput\nGPU: R@2"]
		mb_3_layer_32_ffn_residual -> mb_3_stage_5_output
		mb_4_comm_stage_4 [label="Micro-Batch 4\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: R@1 To: R@2" fillcolor=lightyellow shape=parallelogram]
		mb_4_layer_26_attn_norm [label="MB4 L26\nAttention Norm\nGPU: R@2"]
		mb_4_layer_26_attn_qkv [label="MB4 L26\nAttention QKV\nGPU: R@2"]
		mb_4_layer_26_attn_out [label="MB4 L26\nAttention Out\nGPU: R@2"]
		mb_4_layer_26_attn_residual [label="MB4 L26\nAttn Residual\nGPU: R@2"]
		mb_4_layer_26_ffn_norm [label="MB4 L26\nFFN Norm\nGPU: R@2"]
		mb_4_layer_26_ffn_up [label="MB4 L26\nFFN Up\nGPU: R@2"]
		mb_4_layer_26_ffn_down [label="MB4 L26\nFFN Down\nGPU: R@2"]
		mb_4_layer_26_ffn_residual [label="MB4 L26\nFFN Residual\nGPU: R@2"]
		mb_4_comm_stage_4 -> mb_4_layer_26_attn_norm
		mb_4_layer_26_attn_norm -> mb_4_layer_26_attn_qkv
		mb_4_layer_26_attn_qkv -> mb_4_layer_26_attn_out
		mb_4_layer_26_attn_out -> mb_4_layer_26_attn_residual
		mb_4_layer_26_attn_residual -> mb_4_layer_26_ffn_norm
		mb_4_layer_26_ffn_norm -> mb_4_layer_26_ffn_up
		mb_4_layer_26_ffn_up -> mb_4_layer_26_ffn_down
		mb_4_layer_26_ffn_down -> mb_4_layer_26_ffn_residual
		mb_4_layer_27_attn_norm [label="MB4 L27\nAttention Norm\nGPU: R@2"]
		mb_4_layer_27_attn_qkv [label="MB4 L27\nAttention QKV\nGPU: R@2"]
		mb_4_layer_27_attn_out [label="MB4 L27\nAttention Out\nGPU: R@2"]
		mb_4_layer_27_attn_residual [label="MB4 L27\nAttn Residual\nGPU: R@2"]
		mb_4_layer_27_ffn_norm [label="MB4 L27\nFFN Norm\nGPU: R@2"]
		mb_4_layer_27_ffn_up [label="MB4 L27\nFFN Up\nGPU: R@2"]
		mb_4_layer_27_ffn_down [label="MB4 L27\nFFN Down\nGPU: R@2"]
		mb_4_layer_27_ffn_residual [label="MB4 L27\nFFN Residual\nGPU: R@2"]
		mb_4_layer_26_ffn_residual -> mb_4_layer_27_attn_norm
		mb_4_layer_27_attn_norm -> mb_4_layer_27_attn_qkv
		mb_4_layer_27_attn_qkv -> mb_4_layer_27_attn_out
		mb_4_layer_27_attn_out -> mb_4_layer_27_attn_residual
		mb_4_layer_27_attn_residual -> mb_4_layer_27_ffn_norm
		mb_4_layer_27_ffn_norm -> mb_4_layer_27_ffn_up
		mb_4_layer_27_ffn_up -> mb_4_layer_27_ffn_down
		mb_4_layer_27_ffn_down -> mb_4_layer_27_ffn_residual
		mb_4_layer_28_attn_norm [label="MB4 L28\nAttention Norm\nGPU: R@2"]
		mb_4_layer_28_attn_qkv [label="MB4 L28\nAttention QKV\nGPU: R@2"]
		mb_4_layer_28_attn_out [label="MB4 L28\nAttention Out\nGPU: R@2"]
		mb_4_layer_28_attn_residual [label="MB4 L28\nAttn Residual\nGPU: R@2"]
		mb_4_layer_28_ffn_norm [label="MB4 L28\nFFN Norm\nGPU: R@2"]
		mb_4_layer_28_ffn_up [label="MB4 L28\nFFN Up\nGPU: R@2"]
		mb_4_layer_28_ffn_down [label="MB4 L28\nFFN Down\nGPU: R@2"]
		mb_4_layer_28_ffn_residual [label="MB4 L28\nFFN Residual\nGPU: R@2"]
		mb_4_layer_27_ffn_residual -> mb_4_layer_28_attn_norm
		mb_4_layer_28_attn_norm -> mb_4_layer_28_attn_qkv
		mb_4_layer_28_attn_qkv -> mb_4_layer_28_attn_out
		mb_4_layer_28_attn_out -> mb_4_layer_28_attn_residual
		mb_4_layer_28_attn_residual -> mb_4_layer_28_ffn_norm
		mb_4_layer_28_ffn_norm -> mb_4_layer_28_ffn_up
		mb_4_layer_28_ffn_up -> mb_4_layer_28_ffn_down
		mb_4_layer_28_ffn_down -> mb_4_layer_28_ffn_residual
		mb_4_layer_29_attn_norm [label="MB4 L29\nAttention Norm\nGPU: R@2"]
		mb_4_layer_29_attn_qkv [label="MB4 L29\nAttention QKV\nGPU: R@2"]
		mb_4_layer_29_attn_out [label="MB4 L29\nAttention Out\nGPU: R@2"]
		mb_4_layer_29_attn_residual [label="MB4 L29\nAttn Residual\nGPU: R@2"]
		mb_4_layer_29_ffn_norm [label="MB4 L29\nFFN Norm\nGPU: R@2"]
		mb_4_layer_29_ffn_up [label="MB4 L29\nFFN Up\nGPU: R@2"]
		mb_4_layer_29_ffn_down [label="MB4 L29\nFFN Down\nGPU: R@2"]
		mb_4_layer_29_ffn_residual [label="MB4 L29\nFFN Residual\nGPU: R@2"]
		mb_4_layer_28_ffn_residual -> mb_4_layer_29_attn_norm
		mb_4_layer_29_attn_norm -> mb_4_layer_29_attn_qkv
		mb_4_layer_29_attn_qkv -> mb_4_layer_29_attn_out
		mb_4_layer_29_attn_out -> mb_4_layer_29_attn_residual
		mb_4_layer_29_attn_residual -> mb_4_layer_29_ffn_norm
		mb_4_layer_29_ffn_norm -> mb_4_layer_29_ffn_up
		mb_4_layer_29_ffn_up -> mb_4_layer_29_ffn_down
		mb_4_layer_29_ffn_down -> mb_4_layer_29_ffn_residual
		mb_4_layer_30_attn_norm [label="MB4 L30\nAttention Norm\nGPU: R@2"]
		mb_4_layer_30_attn_qkv [label="MB4 L30\nAttention QKV\nGPU: R@2"]
		mb_4_layer_30_attn_out [label="MB4 L30\nAttention Out\nGPU: R@2"]
		mb_4_layer_30_attn_residual [label="MB4 L30\nAttn Residual\nGPU: R@2"]
		mb_4_layer_30_ffn_norm [label="MB4 L30\nFFN Norm\nGPU: R@2"]
		mb_4_layer_30_ffn_up [label="MB4 L30\nFFN Up\nGPU: R@2"]
		mb_4_layer_30_ffn_down [label="MB4 L30\nFFN Down\nGPU: R@2"]
		mb_4_layer_30_ffn_residual [label="MB4 L30\nFFN Residual\nGPU: R@2"]
		mb_4_layer_29_ffn_residual -> mb_4_layer_30_attn_norm
		mb_4_layer_30_attn_norm -> mb_4_layer_30_attn_qkv
		mb_4_layer_30_attn_qkv -> mb_4_layer_30_attn_out
		mb_4_layer_30_attn_out -> mb_4_layer_30_attn_residual
		mb_4_layer_30_attn_residual -> mb_4_layer_30_ffn_norm
		mb_4_layer_30_ffn_norm -> mb_4_layer_30_ffn_up
		mb_4_layer_30_ffn_up -> mb_4_layer_30_ffn_down
		mb_4_layer_30_ffn_down -> mb_4_layer_30_ffn_residual
		mb_4_layer_31_attn_norm [label="MB4 L31\nAttention Norm\nGPU: R@2"]
		mb_4_layer_31_attn_qkv [label="MB4 L31\nAttention QKV\nGPU: R@2"]
		mb_4_layer_31_attn_out [label="MB4 L31\nAttention Out\nGPU: R@2"]
		mb_4_layer_31_attn_residual [label="MB4 L31\nAttn Residual\nGPU: R@2"]
		mb_4_layer_31_ffn_norm [label="MB4 L31\nFFN Norm\nGPU: R@2"]
		mb_4_layer_31_ffn_up [label="MB4 L31\nFFN Up\nGPU: R@2"]
		mb_4_layer_31_ffn_down [label="MB4 L31\nFFN Down\nGPU: R@2"]
		mb_4_layer_31_ffn_residual [label="MB4 L31\nFFN Residual\nGPU: R@2"]
		mb_4_layer_30_ffn_residual -> mb_4_layer_31_attn_norm
		mb_4_layer_31_attn_norm -> mb_4_layer_31_attn_qkv
		mb_4_layer_31_attn_qkv -> mb_4_layer_31_attn_out
		mb_4_layer_31_attn_out -> mb_4_layer_31_attn_residual
		mb_4_layer_31_attn_residual -> mb_4_layer_31_ffn_norm
		mb_4_layer_31_ffn_norm -> mb_4_layer_31_ffn_up
		mb_4_layer_31_ffn_up -> mb_4_layer_31_ffn_down
		mb_4_layer_31_ffn_down -> mb_4_layer_31_ffn_residual
		mb_4_layer_32_attn_norm [label="MB4 L32\nAttention Norm\nGPU: R@2"]
		mb_4_layer_32_attn_qkv [label="MB4 L32\nAttention QKV\nGPU: R@2"]
		mb_4_layer_32_attn_out [label="MB4 L32\nAttention Out\nGPU: R@2"]
		mb_4_layer_32_attn_residual [label="MB4 L32\nAttn Residual\nGPU: R@2"]
		mb_4_layer_32_ffn_norm [label="MB4 L32\nFFN Norm\nGPU: R@2"]
		mb_4_layer_32_ffn_up [label="MB4 L32\nFFN Up\nGPU: R@2"]
		mb_4_layer_32_ffn_down [label="MB4 L32\nFFN Down\nGPU: R@2"]
		mb_4_layer_32_ffn_residual [label="MB4 L32\nFFN Residual\nGPU: R@2"]
		mb_4_layer_31_ffn_residual -> mb_4_layer_32_attn_norm
		mb_4_layer_32_attn_norm -> mb_4_layer_32_attn_qkv
		mb_4_layer_32_attn_qkv -> mb_4_layer_32_attn_out
		mb_4_layer_32_attn_out -> mb_4_layer_32_attn_residual
		mb_4_layer_32_attn_residual -> mb_4_layer_32_ffn_norm
		mb_4_layer_32_ffn_norm -> mb_4_layer_32_ffn_up
		mb_4_layer_32_ffn_up -> mb_4_layer_32_ffn_down
		mb_4_layer_32_ffn_down -> mb_4_layer_32_ffn_residual
		mb_4_stage_5_output [label="MB4\nStage 6\nOutput\nGPU: R@2"]
		mb_4_layer_32_ffn_residual -> mb_4_stage_5_output
		mb_5_comm_stage_4 [label="Micro-Batch 5\nBatch Transfer\nInput: [batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=1, seq_len=2048, hidden_size=4096]\nFrom: R@1 To: R@2" fillcolor=lightyellow shape=parallelogram]
		mb_5_layer_26_attn_norm [label="MB5 L26\nAttention Norm\nGPU: R@2"]
		mb_5_layer_26_attn_qkv [label="MB5 L26\nAttention QKV\nGPU: R@2"]
		mb_5_layer_26_attn_out [label="MB5 L26\nAttention Out\nGPU: R@2"]
		mb_5_layer_26_attn_residual [label="MB5 L26\nAttn Residual\nGPU: R@2"]
		mb_5_layer_26_ffn_norm [label="MB5 L26\nFFN Norm\nGPU: R@2"]
		mb_5_layer_26_ffn_up [label="MB5 L26\nFFN Up\nGPU: R@2"]
		mb_5_layer_26_ffn_down [label="MB5 L26\nFFN Down\nGPU: R@2"]
		mb_5_layer_26_ffn_residual [label="MB5 L26\nFFN Residual\nGPU: R@2"]
		mb_5_comm_stage_4 -> mb_5_layer_26_attn_norm
		mb_5_layer_26_attn_norm -> mb_5_layer_26_attn_qkv
		mb_5_layer_26_attn_qkv -> mb_5_layer_26_attn_out
		mb_5_layer_26_attn_out -> mb_5_layer_26_attn_residual
		mb_5_layer_26_attn_residual -> mb_5_layer_26_ffn_norm
		mb_5_layer_26_ffn_norm -> mb_5_layer_26_ffn_up
		mb_5_layer_26_ffn_up -> mb_5_layer_26_ffn_down
		mb_5_layer_26_ffn_down -> mb_5_layer_26_ffn_residual
		mb_5_layer_27_attn_norm [label="MB5 L27\nAttention Norm\nGPU: R@2"]
		mb_5_layer_27_attn_qkv [label="MB5 L27\nAttention QKV\nGPU: R@2"]
		mb_5_layer_27_attn_out [label="MB5 L27\nAttention Out\nGPU: R@2"]
		mb_5_layer_27_attn_residual [label="MB5 L27\nAttn Residual\nGPU: R@2"]
		mb_5_layer_27_ffn_norm [label="MB5 L27\nFFN Norm\nGPU: R@2"]
		mb_5_layer_27_ffn_up [label="MB5 L27\nFFN Up\nGPU: R@2"]
		mb_5_layer_27_ffn_down [label="MB5 L27\nFFN Down\nGPU: R@2"]
		mb_5_layer_27_ffn_residual [label="MB5 L27\nFFN Residual\nGPU: R@2"]
		mb_5_layer_26_ffn_residual -> mb_5_layer_27_attn_norm
		mb_5_layer_27_attn_norm -> mb_5_layer_27_attn_qkv
		mb_5_layer_27_attn_qkv -> mb_5_layer_27_attn_out
		mb_5_layer_27_attn_out -> mb_5_layer_27_attn_residual
		mb_5_layer_27_attn_residual -> mb_5_layer_27_ffn_norm
		mb_5_layer_27_ffn_norm -> mb_5_layer_27_ffn_up
		mb_5_layer_27_ffn_up -> mb_5_layer_27_ffn_down
		mb_5_layer_27_ffn_down -> mb_5_layer_27_ffn_residual
		mb_5_layer_28_attn_norm [label="MB5 L28\nAttention Norm\nGPU: R@2"]
		mb_5_layer_28_attn_qkv [label="MB5 L28\nAttention QKV\nGPU: R@2"]
		mb_5_layer_28_attn_out [label="MB5 L28\nAttention Out\nGPU: R@2"]
		mb_5_layer_28_attn_residual [label="MB5 L28\nAttn Residual\nGPU: R@2"]
		mb_5_layer_28_ffn_norm [label="MB5 L28\nFFN Norm\nGPU: R@2"]
		mb_5_layer_28_ffn_up [label="MB5 L28\nFFN Up\nGPU: R@2"]
		mb_5_layer_28_ffn_down [label="MB5 L28\nFFN Down\nGPU: R@2"]
		mb_5_layer_28_ffn_residual [label="MB5 L28\nFFN Residual\nGPU: R@2"]
		mb_5_layer_27_ffn_residual -> mb_5_layer_28_attn_norm
		mb_5_layer_28_attn_norm -> mb_5_layer_28_attn_qkv
		mb_5_layer_28_attn_qkv -> mb_5_layer_28_attn_out
		mb_5_layer_28_attn_out -> mb_5_layer_28_attn_residual
		mb_5_layer_28_attn_residual -> mb_5_layer_28_ffn_norm
		mb_5_layer_28_ffn_norm -> mb_5_layer_28_ffn_up
		mb_5_layer_28_ffn_up -> mb_5_layer_28_ffn_down
		mb_5_layer_28_ffn_down -> mb_5_layer_28_ffn_residual
		mb_5_layer_29_attn_norm [label="MB5 L29\nAttention Norm\nGPU: R@2"]
		mb_5_layer_29_attn_qkv [label="MB5 L29\nAttention QKV\nGPU: R@2"]
		mb_5_layer_29_attn_out [label="MB5 L29\nAttention Out\nGPU: R@2"]
		mb_5_layer_29_attn_residual [label="MB5 L29\nAttn Residual\nGPU: R@2"]
		mb_5_layer_29_ffn_norm [label="MB5 L29\nFFN Norm\nGPU: R@2"]
		mb_5_layer_29_ffn_up [label="MB5 L29\nFFN Up\nGPU: R@2"]
		mb_5_layer_29_ffn_down [label="MB5 L29\nFFN Down\nGPU: R@2"]
		mb_5_layer_29_ffn_residual [label="MB5 L29\nFFN Residual\nGPU: R@2"]
		mb_5_layer_28_ffn_residual -> mb_5_layer_29_attn_norm
		mb_5_layer_29_attn_norm -> mb_5_layer_29_attn_qkv
		mb_5_layer_29_attn_qkv -> mb_5_layer_29_attn_out
		mb_5_layer_29_attn_out -> mb_5_layer_29_attn_residual
		mb_5_layer_29_attn_residual -> mb_5_layer_29_ffn_norm
		mb_5_layer_29_ffn_norm -> mb_5_layer_29_ffn_up
		mb_5_layer_29_ffn_up -> mb_5_layer_29_ffn_down
		mb_5_layer_29_ffn_down -> mb_5_layer_29_ffn_residual
		mb_5_layer_30_attn_norm [label="MB5 L30\nAttention Norm\nGPU: R@2"]
		mb_5_layer_30_attn_qkv [label="MB5 L30\nAttention QKV\nGPU: R@2"]
		mb_5_layer_30_attn_out [label="MB5 L30\nAttention Out\nGPU: R@2"]
		mb_5_layer_30_attn_residual [label="MB5 L30\nAttn Residual\nGPU: R@2"]
		mb_5_layer_30_ffn_norm [label="MB5 L30\nFFN Norm\nGPU: R@2"]
		mb_5_layer_30_ffn_up [label="MB5 L30\nFFN Up\nGPU: R@2"]
		mb_5_layer_30_ffn_down [label="MB5 L30\nFFN Down\nGPU: R@2"]
		mb_5_layer_30_ffn_residual [label="MB5 L30\nFFN Residual\nGPU: R@2"]
		mb_5_layer_29_ffn_residual -> mb_5_layer_30_attn_norm
		mb_5_layer_30_attn_norm -> mb_5_layer_30_attn_qkv
		mb_5_layer_30_attn_qkv -> mb_5_layer_30_attn_out
		mb_5_layer_30_attn_out -> mb_5_layer_30_attn_residual
		mb_5_layer_30_attn_residual -> mb_5_layer_30_ffn_norm
		mb_5_layer_30_ffn_norm -> mb_5_layer_30_ffn_up
		mb_5_layer_30_ffn_up -> mb_5_layer_30_ffn_down
		mb_5_layer_30_ffn_down -> mb_5_layer_30_ffn_residual
		mb_5_layer_31_attn_norm [label="MB5 L31\nAttention Norm\nGPU: R@2"]
		mb_5_layer_31_attn_qkv [label="MB5 L31\nAttention QKV\nGPU: R@2"]
		mb_5_layer_31_attn_out [label="MB5 L31\nAttention Out\nGPU: R@2"]
		mb_5_layer_31_attn_residual [label="MB5 L31\nAttn Residual\nGPU: R@2"]
		mb_5_layer_31_ffn_norm [label="MB5 L31\nFFN Norm\nGPU: R@2"]
		mb_5_layer_31_ffn_up [label="MB5 L31\nFFN Up\nGPU: R@2"]
		mb_5_layer_31_ffn_down [label="MB5 L31\nFFN Down\nGPU: R@2"]
		mb_5_layer_31_ffn_residual [label="MB5 L31\nFFN Residual\nGPU: R@2"]
		mb_5_layer_30_ffn_residual -> mb_5_layer_31_attn_norm
		mb_5_layer_31_attn_norm -> mb_5_layer_31_attn_qkv
		mb_5_layer_31_attn_qkv -> mb_5_layer_31_attn_out
		mb_5_layer_31_attn_out -> mb_5_layer_31_attn_residual
		mb_5_layer_31_attn_residual -> mb_5_layer_31_ffn_norm
		mb_5_layer_31_ffn_norm -> mb_5_layer_31_ffn_up
		mb_5_layer_31_ffn_up -> mb_5_layer_31_ffn_down
		mb_5_layer_31_ffn_down -> mb_5_layer_31_ffn_residual
		mb_5_layer_32_attn_norm [label="MB5 L32\nAttention Norm\nGPU: R@2"]
		mb_5_layer_32_attn_qkv [label="MB5 L32\nAttention QKV\nGPU: R@2"]
		mb_5_layer_32_attn_out [label="MB5 L32\nAttention Out\nGPU: R@2"]
		mb_5_layer_32_attn_residual [label="MB5 L32\nAttn Residual\nGPU: R@2"]
		mb_5_layer_32_ffn_norm [label="MB5 L32\nFFN Norm\nGPU: R@2"]
		mb_5_layer_32_ffn_up [label="MB5 L32\nFFN Up\nGPU: R@2"]
		mb_5_layer_32_ffn_down [label="MB5 L32\nFFN Down\nGPU: R@2"]
		mb_5_layer_32_ffn_residual [label="MB5 L32\nFFN Residual\nGPU: R@2"]
		mb_5_layer_31_ffn_residual -> mb_5_layer_32_attn_norm
		mb_5_layer_32_attn_norm -> mb_5_layer_32_attn_qkv
		mb_5_layer_32_attn_qkv -> mb_5_layer_32_attn_out
		mb_5_layer_32_attn_out -> mb_5_layer_32_attn_residual
		mb_5_layer_32_attn_residual -> mb_5_layer_32_ffn_norm
		mb_5_layer_32_ffn_norm -> mb_5_layer_32_ffn_up
		mb_5_layer_32_ffn_up -> mb_5_layer_32_ffn_down
		mb_5_layer_32_ffn_down -> mb_5_layer_32_ffn_residual
		mb_5_stage_5_output [label="MB5\nStage 6\nOutput\nGPU: R@2"]
		mb_5_layer_32_ffn_residual -> mb_5_stage_5_output
	}
	final_comm [label="Gather Batches\nInput: [micro_batch_size=1, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=6, seq_len=2048, hidden_size=4096]\nGPU: R@2" fillcolor=lightyellow shape=parallelogram]
	lm_head [label="LM Head\nInput: [batch_size=6, seq_len=2048, hidden_size=4096]\nOutput: [batch_size=6, seq_len=2048, vocab_size=32000]\nGPU: R@2" fillcolor=lightblue shape=rectangle]
	output [label="Output\nInput: [batch_size=6, seq_len=2048, vocab_size=32000]\nOutput: [batch_size=6, seq_len=2048, vocab_size=32000]\nGPU: all GPUs" fillcolor=lightgreen shape=ellipse]
	mb_0_stage_5_output -> final_comm
	mb_1_stage_5_output -> final_comm
	mb_2_stage_5_output -> final_comm
	mb_3_stage_5_output -> final_comm
	mb_4_stage_5_output -> final_comm
	mb_5_stage_5_output -> final_comm
	final_comm -> lm_head
	lm_head -> output
}
