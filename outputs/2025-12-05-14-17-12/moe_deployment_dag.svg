<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="115436pt" height="8536pt"
 viewBox="0.00 0.00 115436.00 8536.08" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 8532.08)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-8532.08 115432,-8532.08 115432,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_input</title>
<path fill="#f0f0f0" stroke="black" d="M112287,-8423.1C112287,-8423.1 112553,-8423.1 112553,-8423.1 112559,-8423.1 112565,-8429.1 112565,-8435.1 112565,-8435.1 112565,-8508.08 112565,-8508.08 112565,-8514.08 112559,-8520.08 112553,-8520.08 112553,-8520.08 112287,-8520.08 112287,-8520.08 112281,-8520.08 112275,-8514.08 112275,-8508.08 112275,-8508.08 112275,-8435.1 112275,-8435.1 112275,-8429.1 112281,-8423.1 112287,-8423.1"/>
<text text-anchor="middle" x="112420" y="-8504.88" font-family="Times,serif" font-size="14.00">Input Layer</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_stage0</title>
<path fill="#ffcccc" stroke="black" d="M20,-7413.1C20,-7413.1 112680,-7413.1 112680,-7413.1 112686,-7413.1 112692,-7419.1 112692,-7425.1 112692,-7425.1 112692,-8403.1 112692,-8403.1 112692,-8409.1 112686,-8415.1 112680,-8415.1 112680,-8415.1 20,-8415.1 20,-8415.1 14,-8415.1 8,-8409.1 8,-8403.1 8,-8403.1 8,-7425.1 8,-7425.1 8,-7419.1 14,-7413.1 20,-7413.1"/>
<text text-anchor="middle" x="56350" y="-8399.9" font-family="Times,serif" font-size="14.00">Pipeline Stage 0 (Layers 0&#45;1)</text>
<text text-anchor="middle" x="56350" y="-8384.9" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;127</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_stage1</title>
<path fill="#ccffcc" stroke="black" d="M20,-6264C20,-6264 112680,-6264 112680,-6264 112686,-6264 112692,-6270 112692,-6276 112692,-6276 112692,-7276 112692,-7276 112692,-7282 112686,-7288 112680,-7288 112680,-7288 20,-7288 20,-7288 14,-7288 8,-7282 8,-7276 8,-7276 8,-6276 8,-6276 8,-6270 14,-6264 20,-6264"/>
<text text-anchor="middle" x="56350" y="-7272.8" font-family="Times,serif" font-size="14.00">Pipeline Stage 1 (Layers 2&#45;3)</text>
<text text-anchor="middle" x="56350" y="-7257.8" font-family="Times,serif" font-size="14.00">GPUs: 128&#45;255</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_stage2</title>
<path fill="#ccccff" stroke="black" d="M106626,-5168C106626,-5168 112680,-5168 112680,-5168 112686,-5168 112692,-5174 112692,-5180 112692,-5180 112692,-6180 112692,-6180 112692,-6186 112686,-6192 112680,-6192 112680,-6192 106626,-6192 106626,-6192 106620,-6192 106614,-6186 106614,-6180 106614,-6180 106614,-5180 106614,-5180 106614,-5174 106620,-5168 106626,-5168"/>
<text text-anchor="middle" x="109653" y="-6176.8" font-family="Times,serif" font-size="14.00">Pipeline Stage 2 (Layers 4&#45;5)</text>
<text text-anchor="middle" x="109653" y="-6161.8" font-family="Times,serif" font-size="14.00">GPUs: 256&#45;383</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_stage3</title>
<path fill="#ffffcc" stroke="black" d="M107087,-4136C107087,-4136 113141,-4136 113141,-4136 113147,-4136 113153,-4142 113153,-4148 113153,-4148 113153,-5148 113153,-5148 113153,-5154 113147,-5160 113141,-5160 113141,-5160 107087,-5160 107087,-5160 107081,-5160 107075,-5154 107075,-5148 107075,-5148 107075,-4148 107075,-4148 107075,-4142 107081,-4136 107087,-4136"/>
<text text-anchor="middle" x="110114" y="-5144.8" font-family="Times,serif" font-size="14.00">Pipeline Stage 3 (Layers 6&#45;7)</text>
<text text-anchor="middle" x="110114" y="-5129.8" font-family="Times,serif" font-size="14.00">GPUs: 384&#45;511</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_stage4</title>
<path fill="#ffccff" stroke="black" d="M107548,-3104C107548,-3104 113602,-3104 113602,-3104 113608,-3104 113614,-3110 113614,-3116 113614,-3116 113614,-4116 113614,-4116 113614,-4122 113608,-4128 113602,-4128 113602,-4128 107548,-4128 107548,-4128 107542,-4128 107536,-4122 107536,-4116 107536,-4116 107536,-3116 107536,-3116 107536,-3110 107542,-3104 107548,-3104"/>
<text text-anchor="middle" x="110575" y="-4112.8" font-family="Times,serif" font-size="14.00">Pipeline Stage 4 (Layers 8&#45;9)</text>
<text text-anchor="middle" x="110575" y="-4097.8" font-family="Times,serif" font-size="14.00">GPUs: 512&#45;639</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_stage5</title>
<path fill="#ccffff" stroke="black" d="M108009,-2072C108009,-2072 114063,-2072 114063,-2072 114069,-2072 114075,-2078 114075,-2084 114075,-2084 114075,-3084 114075,-3084 114075,-3090 114069,-3096 114063,-3096 114063,-3096 108009,-3096 108009,-3096 108003,-3096 107997,-3090 107997,-3084 107997,-3084 107997,-2084 107997,-2084 107997,-2078 108003,-2072 108009,-2072"/>
<text text-anchor="middle" x="111036" y="-3080.8" font-family="Times,serif" font-size="14.00">Pipeline Stage 5 (Layers 10&#45;11)</text>
<text text-anchor="middle" x="111036" y="-3065.8" font-family="Times,serif" font-size="14.00">GPUs: 640&#45;767</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_stage6</title>
<path fill="#ffeecc" stroke="black" d="M108470,-1040C108470,-1040 114524,-1040 114524,-1040 114530,-1040 114536,-1046 114536,-1052 114536,-1052 114536,-2052 114536,-2052 114536,-2058 114530,-2064 114524,-2064 114524,-2064 108470,-2064 108470,-2064 108464,-2064 108458,-2058 108458,-2052 108458,-2052 108458,-1052 108458,-1052 108458,-1046 108464,-1040 108470,-1040"/>
<text text-anchor="middle" x="111497" y="-2048.8" font-family="Times,serif" font-size="14.00">Pipeline Stage 6 (Layers 12&#45;13)</text>
<text text-anchor="middle" x="111497" y="-2033.8" font-family="Times,serif" font-size="14.00">GPUs: 768&#45;895</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_stage7</title>
<path fill="#eeccff" stroke="black" d="M108927,-8C108927,-8 114986,-8 114986,-8 114992,-8 114998,-14 114998,-20 114998,-20 114998,-1020 114998,-1020 114998,-1026 114992,-1032 114986,-1032 114986,-1032 108927,-1032 108927,-1032 108921,-1032 108915,-1026 108915,-1020 108915,-1020 108915,-20 108915,-20 108915,-14 108921,-8 108927,-8"/>
<text text-anchor="middle" x="111956.5" y="-1016.8" font-family="Times,serif" font-size="14.00">Pipeline Stage 7 (Layers 14&#45;15)</text>
<text text-anchor="middle" x="111956.5" y="-1001.8" font-family="Times,serif" font-size="14.00">GPUs: 896&#45;1023</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_output</title>
<path fill="#f0f0f0" stroke="black" d="M115018,-31.01C115018,-31.01 115408,-31.01 115408,-31.01 115414,-31.01 115420,-37.01 115420,-43.01 115420,-43.01 115420,-115.99 115420,-115.99 115420,-121.99 115414,-127.99 115408,-127.99 115408,-127.99 115018,-127.99 115018,-127.99 115012,-127.99 115006,-121.99 115006,-115.99 115006,-115.99 115006,-43.01 115006,-43.01 115006,-37.01 115012,-31.01 115018,-31.01"/>
<text text-anchor="middle" x="115213" y="-112.79" font-family="Times,serif" font-size="14.00">Output Layer</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightblue" stroke="black" cx="112420" cy="-8460.09" rx="137.36" ry="28.98"/>
<text text-anchor="middle" x="112420" y="-8468.59" font-family="Arial" font-size="10.00">Input Tokens</text>
<text text-anchor="middle" x="112420" y="-8457.59" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024]</text>
<text text-anchor="middle" x="112420" y="-8446.59" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024]</text>
</g>
<!-- stage0_routing -->
<g id="node2" class="node">
<title>stage0_routing</title>
<polygon fill="lightyellow" stroke="black" points="112684.24,-8369.1 112263.89,-8369.1 112155.76,-8265.1 112576.11,-8265.1 112684.24,-8369.1"/>
<text text-anchor="middle" x="112420" y="-8331.1" font-family="Arial" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="112420" y="-8320.1" font-family="Arial" font-size="10.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="112420" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- input&#45;&gt;stage0_routing -->
<g id="edge1" class="edge">
<title>input&#45;&gt;stage0_routing</title>
<path fill="none" stroke="black" d="M112420,-8430.81C112420,-8430.81 112420,-8379.18 112420,-8379.18"/>
<polygon fill="black" stroke="black" points="112423.5,-8379.18 112420,-8369.18 112416.5,-8379.18 112423.5,-8379.18"/>
</g>
<!-- stage0_expert0_qkv -->
<g id="node3" class="node">
<title>stage0_expert0_qkv</title>
<polygon fill="lightgreen" stroke="black" points="112563,-8229.1 112277,-8229.1 112277,-8177.1 112563,-8177.1 112563,-8229.1"/>
<text text-anchor="middle" x="112420" y="-8217.1" font-family="Arial" font-size="10.00">Expert 0 QKV Proj (TP)</text>
<text text-anchor="middle" x="112420" y="-8206.1" font-family="Arial" font-size="10.00">GPUs: 0,1</text>
<text text-anchor="middle" x="112420" y="-8195.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-8184.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_routing&#45;&gt;stage0_expert0_qkv -->
<g id="edge2" class="edge">
<title>stage0_routing&#45;&gt;stage0_expert0_qkv</title>
<path fill="none" stroke="black" d="M112420,-8264.77C112420,-8264.77 112420,-8239.32 112420,-8239.32"/>
<polygon fill="black" stroke="black" points="112423.5,-8239.32 112420,-8229.32 112416.5,-8239.32 112423.5,-8239.32"/>
</g>
<!-- stage0_expert0_attn -->
<g id="node4" class="node">
<title>stage0_expert0_attn</title>
<polygon fill="lightgreen" stroke="black" points="112563,-8141.1 112277,-8141.1 112277,-8089.1 112563,-8089.1 112563,-8141.1"/>
<text text-anchor="middle" x="112420" y="-8129.1" font-family="Arial" font-size="10.00">Expert 0 Attention (TP)</text>
<text text-anchor="middle" x="112420" y="-8118.1" font-family="Arial" font-size="10.00">GPUs: 0,1</text>
<text text-anchor="middle" x="112420" y="-8107.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="112420" y="-8096.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert0_qkv&#45;&gt;stage0_expert0_attn -->
<g id="edge3" class="edge">
<title>stage0_expert0_qkv&#45;&gt;stage0_expert0_attn</title>
<path fill="none" stroke="black" d="M112420,-8176.69C112420,-8176.69 112420,-8151.18 112420,-8151.18"/>
<polygon fill="black" stroke="black" points="112423.5,-8151.18 112420,-8141.18 112416.5,-8151.18 112423.5,-8151.18"/>
</g>
<!-- stage0_expert0_attn_out -->
<g id="node5" class="node">
<title>stage0_expert0_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="112559,-8053.1 112281,-8053.1 112281,-8001.1 112559,-8001.1 112559,-8053.1"/>
<text text-anchor="middle" x="112420" y="-8041.1" font-family="Arial" font-size="10.00">Expert 0 Attn Output (TP)</text>
<text text-anchor="middle" x="112420" y="-8030.1" font-family="Arial" font-size="10.00">GPUs: 0,1</text>
<text text-anchor="middle" x="112420" y="-8019.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="112420" y="-8008.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert0_attn&#45;&gt;stage0_expert0_attn_out -->
<g id="edge4" class="edge">
<title>stage0_expert0_attn&#45;&gt;stage0_expert0_attn_out</title>
<path fill="none" stroke="black" d="M112420,-8088.69C112420,-8088.69 112420,-8063.18 112420,-8063.18"/>
<polygon fill="black" stroke="black" points="112423.5,-8063.18 112420,-8053.18 112416.5,-8063.18 112423.5,-8063.18"/>
</g>
<!-- stage0_layernorm1 -->
<g id="node388" class="node">
<title>stage0_layernorm1</title>
<polygon fill="lightblue" stroke="black" points="112547.5,-7965.1 112292.5,-7965.1 112292.5,-7913.1 112547.5,-7913.1 112547.5,-7965.1"/>
<text text-anchor="middle" x="112420" y="-7953.1" font-family="Arial" font-size="10.00">LayerNorm 1</text>
<text text-anchor="middle" x="112420" y="-7942.1" font-family="Arial" font-size="10.00">GPUs: 0&#45;127</text>
<text text-anchor="middle" x="112420" y="-7931.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-7920.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert0_attn_out&#45;&gt;stage0_layernorm1 -->
<g id="edge5" class="edge">
<title>stage0_expert0_attn_out&#45;&gt;stage0_layernorm1</title>
<path fill="none" stroke="black" d="M112420,-8000.69C112420,-8000.69 112420,-7975.18 112420,-7975.18"/>
<polygon fill="black" stroke="black" points="112423.5,-7975.18 112420,-7965.18 112416.5,-7975.18 112423.5,-7975.18"/>
</g>
<!-- stage0_expert0_mlp1 -->
<g id="node6" class="node">
<title>stage0_expert0_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="112558,-7877.1 112282,-7877.1 112282,-7825.1 112558,-7825.1 112558,-7877.1"/>
<text text-anchor="middle" x="112420" y="-7865.1" font-family="Arial" font-size="10.00">Expert 0 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="112420" y="-7854.1" font-family="Arial" font-size="10.00">GPUs: 0,1</text>
<text text-anchor="middle" x="112420" y="-7843.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-7832.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert0_mlp_act -->
<g id="node7" class="node">
<title>stage0_expert0_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="112558,-7789.1 112282,-7789.1 112282,-7737.1 112558,-7737.1 112558,-7789.1"/>
<text text-anchor="middle" x="112420" y="-7777.1" font-family="Arial" font-size="10.00">Expert 0 MLP GELU (TP)</text>
<text text-anchor="middle" x="112420" y="-7766.1" font-family="Arial" font-size="10.00">GPUs: 0,1</text>
<text text-anchor="middle" x="112420" y="-7755.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="112420" y="-7744.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert0_mlp1&#45;&gt;stage0_expert0_mlp_act -->
<g id="edge7" class="edge">
<title>stage0_expert0_mlp1&#45;&gt;stage0_expert0_mlp_act</title>
<path fill="none" stroke="black" d="M112420,-7824.69C112420,-7824.69 112420,-7799.18 112420,-7799.18"/>
<polygon fill="black" stroke="black" points="112423.5,-7799.18 112420,-7789.18 112416.5,-7799.18 112423.5,-7799.18"/>
</g>
<!-- stage0_expert0_mlp2 -->
<g id="node8" class="node">
<title>stage0_expert0_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="112554.5,-7701.1 112285.5,-7701.1 112285.5,-7649.1 112554.5,-7649.1 112554.5,-7701.1"/>
<text text-anchor="middle" x="112420" y="-7689.1" font-family="Arial" font-size="10.00">Expert 0 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="112420" y="-7678.1" font-family="Arial" font-size="10.00">GPUs: 0,1</text>
<text text-anchor="middle" x="112420" y="-7667.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="112420" y="-7656.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert0_mlp_act&#45;&gt;stage0_expert0_mlp2 -->
<g id="edge8" class="edge">
<title>stage0_expert0_mlp_act&#45;&gt;stage0_expert0_mlp2</title>
<path fill="none" stroke="black" d="M112420,-7736.69C112420,-7736.69 112420,-7711.18 112420,-7711.18"/>
<polygon fill="black" stroke="black" points="112423.5,-7711.18 112420,-7701.18 112416.5,-7711.18 112423.5,-7711.18"/>
</g>
<!-- stage0_layernorm2 -->
<g id="node389" class="node">
<title>stage0_layernorm2</title>
<polygon fill="lightblue" stroke="black" points="112547.5,-7613.1 112292.5,-7613.1 112292.5,-7561.1 112547.5,-7561.1 112547.5,-7613.1"/>
<text text-anchor="middle" x="112420" y="-7601.1" font-family="Arial" font-size="10.00">LayerNorm 2</text>
<text text-anchor="middle" x="112420" y="-7590.1" font-family="Arial" font-size="10.00">GPUs: 0&#45;127</text>
<text text-anchor="middle" x="112420" y="-7579.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-7568.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert0_mlp2&#45;&gt;stage0_layernorm2 -->
<g id="edge9" class="edge">
<title>stage0_expert0_mlp2&#45;&gt;stage0_layernorm2</title>
<path fill="none" stroke="black" d="M112420,-7648.69C112420,-7648.69 112420,-7623.18 112420,-7623.18"/>
<polygon fill="black" stroke="black" points="112423.5,-7623.18 112420,-7613.18 112416.5,-7623.18 112423.5,-7623.18"/>
</g>
<!-- stage0_expert1_qkv -->
<g id="node9" class="node">
<title>stage0_expert1_qkv</title>
<polygon fill="lightgreen" stroke="black" points="112138,-8343.1 111852,-8343.1 111852,-8291.1 112138,-8291.1 112138,-8343.1"/>
<text text-anchor="middle" x="111995" y="-8331.1" font-family="Arial" font-size="10.00">Expert 1 QKV Proj (TP)</text>
<text text-anchor="middle" x="111995" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 2,3</text>
<text text-anchor="middle" x="111995" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="111995" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert1_attn -->
<g id="node10" class="node">
<title>stage0_expert1_attn</title>
<polygon fill="lightgreen" stroke="black" points="111834,-8343.1 111548,-8343.1 111548,-8291.1 111834,-8291.1 111834,-8343.1"/>
<text text-anchor="middle" x="111691" y="-8331.1" font-family="Arial" font-size="10.00">Expert 1 Attention (TP)</text>
<text text-anchor="middle" x="111691" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 2,3</text>
<text text-anchor="middle" x="111691" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="111691" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert1_attn_out -->
<g id="node11" class="node">
<title>stage0_expert1_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="111530,-8343.1 111252,-8343.1 111252,-8291.1 111530,-8291.1 111530,-8343.1"/>
<text text-anchor="middle" x="111391" y="-8331.1" font-family="Arial" font-size="10.00">Expert 1 Attn Output (TP)</text>
<text text-anchor="middle" x="111391" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 2,3</text>
<text text-anchor="middle" x="111391" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="111391" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert1_mlp1 -->
<g id="node12" class="node">
<title>stage0_expert1_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="111234,-8343.1 110958,-8343.1 110958,-8291.1 111234,-8291.1 111234,-8343.1"/>
<text text-anchor="middle" x="111096" y="-8331.1" font-family="Arial" font-size="10.00">Expert 1 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="111096" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 2,3</text>
<text text-anchor="middle" x="111096" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="111096" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert1_mlp_act -->
<g id="node13" class="node">
<title>stage0_expert1_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="110940,-8343.1 110664,-8343.1 110664,-8291.1 110940,-8291.1 110940,-8343.1"/>
<text text-anchor="middle" x="110802" y="-8331.1" font-family="Arial" font-size="10.00">Expert 1 MLP GELU (TP)</text>
<text text-anchor="middle" x="110802" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 2,3</text>
<text text-anchor="middle" x="110802" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="110802" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert1_mlp2 -->
<g id="node14" class="node">
<title>stage0_expert1_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="110645.5,-8343.1 110376.5,-8343.1 110376.5,-8291.1 110645.5,-8291.1 110645.5,-8343.1"/>
<text text-anchor="middle" x="110511" y="-8331.1" font-family="Arial" font-size="10.00">Expert 1 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="110511" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 2,3</text>
<text text-anchor="middle" x="110511" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="110511" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert2_qkv -->
<g id="node15" class="node">
<title>stage0_expert2_qkv</title>
<polygon fill="lightgreen" stroke="black" points="110358,-8343.1 110072,-8343.1 110072,-8291.1 110358,-8291.1 110358,-8343.1"/>
<text text-anchor="middle" x="110215" y="-8331.1" font-family="Arial" font-size="10.00">Expert 2 QKV Proj (TP)</text>
<text text-anchor="middle" x="110215" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 4,5</text>
<text text-anchor="middle" x="110215" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="110215" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert2_attn -->
<g id="node16" class="node">
<title>stage0_expert2_attn</title>
<polygon fill="lightgreen" stroke="black" points="110054,-8343.1 109768,-8343.1 109768,-8291.1 110054,-8291.1 110054,-8343.1"/>
<text text-anchor="middle" x="109911" y="-8331.1" font-family="Arial" font-size="10.00">Expert 2 Attention (TP)</text>
<text text-anchor="middle" x="109911" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 4,5</text>
<text text-anchor="middle" x="109911" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="109911" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert2_attn_out -->
<g id="node17" class="node">
<title>stage0_expert2_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="109750,-8343.1 109472,-8343.1 109472,-8291.1 109750,-8291.1 109750,-8343.1"/>
<text text-anchor="middle" x="109611" y="-8331.1" font-family="Arial" font-size="10.00">Expert 2 Attn Output (TP)</text>
<text text-anchor="middle" x="109611" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 4,5</text>
<text text-anchor="middle" x="109611" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="109611" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert2_mlp1 -->
<g id="node18" class="node">
<title>stage0_expert2_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="109454,-8343.1 109178,-8343.1 109178,-8291.1 109454,-8291.1 109454,-8343.1"/>
<text text-anchor="middle" x="109316" y="-8331.1" font-family="Arial" font-size="10.00">Expert 2 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="109316" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 4,5</text>
<text text-anchor="middle" x="109316" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="109316" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert2_mlp_act -->
<g id="node19" class="node">
<title>stage0_expert2_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="109160,-8343.1 108884,-8343.1 108884,-8291.1 109160,-8291.1 109160,-8343.1"/>
<text text-anchor="middle" x="109022" y="-8331.1" font-family="Arial" font-size="10.00">Expert 2 MLP GELU (TP)</text>
<text text-anchor="middle" x="109022" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 4,5</text>
<text text-anchor="middle" x="109022" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="109022" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert2_mlp2 -->
<g id="node20" class="node">
<title>stage0_expert2_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="108865.5,-8343.1 108596.5,-8343.1 108596.5,-8291.1 108865.5,-8291.1 108865.5,-8343.1"/>
<text text-anchor="middle" x="108731" y="-8331.1" font-family="Arial" font-size="10.00">Expert 2 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="108731" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 4,5</text>
<text text-anchor="middle" x="108731" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="108731" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert3_qkv -->
<g id="node21" class="node">
<title>stage0_expert3_qkv</title>
<polygon fill="lightgreen" stroke="black" points="108578,-8343.1 108292,-8343.1 108292,-8291.1 108578,-8291.1 108578,-8343.1"/>
<text text-anchor="middle" x="108435" y="-8331.1" font-family="Arial" font-size="10.00">Expert 3 QKV Proj (TP)</text>
<text text-anchor="middle" x="108435" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 6,7</text>
<text text-anchor="middle" x="108435" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="108435" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert3_attn -->
<g id="node22" class="node">
<title>stage0_expert3_attn</title>
<polygon fill="lightgreen" stroke="black" points="108274,-8343.1 107988,-8343.1 107988,-8291.1 108274,-8291.1 108274,-8343.1"/>
<text text-anchor="middle" x="108131" y="-8331.1" font-family="Arial" font-size="10.00">Expert 3 Attention (TP)</text>
<text text-anchor="middle" x="108131" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 6,7</text>
<text text-anchor="middle" x="108131" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="108131" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert3_attn_out -->
<g id="node23" class="node">
<title>stage0_expert3_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="107970,-8343.1 107692,-8343.1 107692,-8291.1 107970,-8291.1 107970,-8343.1"/>
<text text-anchor="middle" x="107831" y="-8331.1" font-family="Arial" font-size="10.00">Expert 3 Attn Output (TP)</text>
<text text-anchor="middle" x="107831" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 6,7</text>
<text text-anchor="middle" x="107831" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="107831" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert3_mlp1 -->
<g id="node24" class="node">
<title>stage0_expert3_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="107674,-8343.1 107398,-8343.1 107398,-8291.1 107674,-8291.1 107674,-8343.1"/>
<text text-anchor="middle" x="107536" y="-8331.1" font-family="Arial" font-size="10.00">Expert 3 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="107536" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 6,7</text>
<text text-anchor="middle" x="107536" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="107536" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert3_mlp_act -->
<g id="node25" class="node">
<title>stage0_expert3_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="107380,-8343.1 107104,-8343.1 107104,-8291.1 107380,-8291.1 107380,-8343.1"/>
<text text-anchor="middle" x="107242" y="-8331.1" font-family="Arial" font-size="10.00">Expert 3 MLP GELU (TP)</text>
<text text-anchor="middle" x="107242" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 6,7</text>
<text text-anchor="middle" x="107242" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="107242" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert3_mlp2 -->
<g id="node26" class="node">
<title>stage0_expert3_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="107085.5,-8343.1 106816.5,-8343.1 106816.5,-8291.1 107085.5,-8291.1 107085.5,-8343.1"/>
<text text-anchor="middle" x="106951" y="-8331.1" font-family="Arial" font-size="10.00">Expert 3 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="106951" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 6,7</text>
<text text-anchor="middle" x="106951" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="106951" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert4_qkv -->
<g id="node27" class="node">
<title>stage0_expert4_qkv</title>
<polygon fill="lightgreen" stroke="black" points="106798,-8343.1 106512,-8343.1 106512,-8291.1 106798,-8291.1 106798,-8343.1"/>
<text text-anchor="middle" x="106655" y="-8331.1" font-family="Arial" font-size="10.00">Expert 4 QKV Proj (TP)</text>
<text text-anchor="middle" x="106655" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 8,9</text>
<text text-anchor="middle" x="106655" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="106655" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert4_attn -->
<g id="node28" class="node">
<title>stage0_expert4_attn</title>
<polygon fill="lightgreen" stroke="black" points="106494,-8343.1 106208,-8343.1 106208,-8291.1 106494,-8291.1 106494,-8343.1"/>
<text text-anchor="middle" x="106351" y="-8331.1" font-family="Arial" font-size="10.00">Expert 4 Attention (TP)</text>
<text text-anchor="middle" x="106351" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 8,9</text>
<text text-anchor="middle" x="106351" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="106351" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert4_attn_out -->
<g id="node29" class="node">
<title>stage0_expert4_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="106190,-8343.1 105912,-8343.1 105912,-8291.1 106190,-8291.1 106190,-8343.1"/>
<text text-anchor="middle" x="106051" y="-8331.1" font-family="Arial" font-size="10.00">Expert 4 Attn Output (TP)</text>
<text text-anchor="middle" x="106051" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 8,9</text>
<text text-anchor="middle" x="106051" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="106051" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert4_mlp1 -->
<g id="node30" class="node">
<title>stage0_expert4_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="105894,-8343.1 105618,-8343.1 105618,-8291.1 105894,-8291.1 105894,-8343.1"/>
<text text-anchor="middle" x="105756" y="-8331.1" font-family="Arial" font-size="10.00">Expert 4 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="105756" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 8,9</text>
<text text-anchor="middle" x="105756" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="105756" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert4_mlp_act -->
<g id="node31" class="node">
<title>stage0_expert4_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="105600,-8343.1 105324,-8343.1 105324,-8291.1 105600,-8291.1 105600,-8343.1"/>
<text text-anchor="middle" x="105462" y="-8331.1" font-family="Arial" font-size="10.00">Expert 4 MLP GELU (TP)</text>
<text text-anchor="middle" x="105462" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 8,9</text>
<text text-anchor="middle" x="105462" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="105462" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert4_mlp2 -->
<g id="node32" class="node">
<title>stage0_expert4_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="105305.5,-8343.1 105036.5,-8343.1 105036.5,-8291.1 105305.5,-8291.1 105305.5,-8343.1"/>
<text text-anchor="middle" x="105171" y="-8331.1" font-family="Arial" font-size="10.00">Expert 4 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="105171" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 8,9</text>
<text text-anchor="middle" x="105171" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="105171" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert5_qkv -->
<g id="node33" class="node">
<title>stage0_expert5_qkv</title>
<polygon fill="lightgreen" stroke="black" points="105018,-8343.1 104732,-8343.1 104732,-8291.1 105018,-8291.1 105018,-8343.1"/>
<text text-anchor="middle" x="104875" y="-8331.1" font-family="Arial" font-size="10.00">Expert 5 QKV Proj (TP)</text>
<text text-anchor="middle" x="104875" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 10,11</text>
<text text-anchor="middle" x="104875" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="104875" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert5_attn -->
<g id="node34" class="node">
<title>stage0_expert5_attn</title>
<polygon fill="lightgreen" stroke="black" points="104714,-8343.1 104428,-8343.1 104428,-8291.1 104714,-8291.1 104714,-8343.1"/>
<text text-anchor="middle" x="104571" y="-8331.1" font-family="Arial" font-size="10.00">Expert 5 Attention (TP)</text>
<text text-anchor="middle" x="104571" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 10,11</text>
<text text-anchor="middle" x="104571" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="104571" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert5_attn_out -->
<g id="node35" class="node">
<title>stage0_expert5_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="104410,-8343.1 104132,-8343.1 104132,-8291.1 104410,-8291.1 104410,-8343.1"/>
<text text-anchor="middle" x="104271" y="-8331.1" font-family="Arial" font-size="10.00">Expert 5 Attn Output (TP)</text>
<text text-anchor="middle" x="104271" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 10,11</text>
<text text-anchor="middle" x="104271" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="104271" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert5_mlp1 -->
<g id="node36" class="node">
<title>stage0_expert5_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="104114,-8343.1 103838,-8343.1 103838,-8291.1 104114,-8291.1 104114,-8343.1"/>
<text text-anchor="middle" x="103976" y="-8331.1" font-family="Arial" font-size="10.00">Expert 5 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="103976" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 10,11</text>
<text text-anchor="middle" x="103976" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="103976" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert5_mlp_act -->
<g id="node37" class="node">
<title>stage0_expert5_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="103820,-8343.1 103544,-8343.1 103544,-8291.1 103820,-8291.1 103820,-8343.1"/>
<text text-anchor="middle" x="103682" y="-8331.1" font-family="Arial" font-size="10.00">Expert 5 MLP GELU (TP)</text>
<text text-anchor="middle" x="103682" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 10,11</text>
<text text-anchor="middle" x="103682" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="103682" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert5_mlp2 -->
<g id="node38" class="node">
<title>stage0_expert5_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="103525.5,-8343.1 103256.5,-8343.1 103256.5,-8291.1 103525.5,-8291.1 103525.5,-8343.1"/>
<text text-anchor="middle" x="103391" y="-8331.1" font-family="Arial" font-size="10.00">Expert 5 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="103391" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 10,11</text>
<text text-anchor="middle" x="103391" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="103391" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert6_qkv -->
<g id="node39" class="node">
<title>stage0_expert6_qkv</title>
<polygon fill="lightgreen" stroke="black" points="103238,-8343.1 102952,-8343.1 102952,-8291.1 103238,-8291.1 103238,-8343.1"/>
<text text-anchor="middle" x="103095" y="-8331.1" font-family="Arial" font-size="10.00">Expert 6 QKV Proj (TP)</text>
<text text-anchor="middle" x="103095" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 12,13</text>
<text text-anchor="middle" x="103095" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="103095" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert6_attn -->
<g id="node40" class="node">
<title>stage0_expert6_attn</title>
<polygon fill="lightgreen" stroke="black" points="102934,-8343.1 102648,-8343.1 102648,-8291.1 102934,-8291.1 102934,-8343.1"/>
<text text-anchor="middle" x="102791" y="-8331.1" font-family="Arial" font-size="10.00">Expert 6 Attention (TP)</text>
<text text-anchor="middle" x="102791" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 12,13</text>
<text text-anchor="middle" x="102791" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="102791" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert6_attn_out -->
<g id="node41" class="node">
<title>stage0_expert6_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="102630,-8343.1 102352,-8343.1 102352,-8291.1 102630,-8291.1 102630,-8343.1"/>
<text text-anchor="middle" x="102491" y="-8331.1" font-family="Arial" font-size="10.00">Expert 6 Attn Output (TP)</text>
<text text-anchor="middle" x="102491" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 12,13</text>
<text text-anchor="middle" x="102491" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="102491" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert6_mlp1 -->
<g id="node42" class="node">
<title>stage0_expert6_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="102334,-8343.1 102058,-8343.1 102058,-8291.1 102334,-8291.1 102334,-8343.1"/>
<text text-anchor="middle" x="102196" y="-8331.1" font-family="Arial" font-size="10.00">Expert 6 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="102196" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 12,13</text>
<text text-anchor="middle" x="102196" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="102196" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert6_mlp_act -->
<g id="node43" class="node">
<title>stage0_expert6_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="102040,-8343.1 101764,-8343.1 101764,-8291.1 102040,-8291.1 102040,-8343.1"/>
<text text-anchor="middle" x="101902" y="-8331.1" font-family="Arial" font-size="10.00">Expert 6 MLP GELU (TP)</text>
<text text-anchor="middle" x="101902" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 12,13</text>
<text text-anchor="middle" x="101902" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="101902" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert6_mlp2 -->
<g id="node44" class="node">
<title>stage0_expert6_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="101745.5,-8343.1 101476.5,-8343.1 101476.5,-8291.1 101745.5,-8291.1 101745.5,-8343.1"/>
<text text-anchor="middle" x="101611" y="-8331.1" font-family="Arial" font-size="10.00">Expert 6 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="101611" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 12,13</text>
<text text-anchor="middle" x="101611" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="101611" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert7_qkv -->
<g id="node45" class="node">
<title>stage0_expert7_qkv</title>
<polygon fill="lightgreen" stroke="black" points="101458,-8343.1 101172,-8343.1 101172,-8291.1 101458,-8291.1 101458,-8343.1"/>
<text text-anchor="middle" x="101315" y="-8331.1" font-family="Arial" font-size="10.00">Expert 7 QKV Proj (TP)</text>
<text text-anchor="middle" x="101315" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 14,15</text>
<text text-anchor="middle" x="101315" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="101315" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert7_attn -->
<g id="node46" class="node">
<title>stage0_expert7_attn</title>
<polygon fill="lightgreen" stroke="black" points="101154,-8343.1 100868,-8343.1 100868,-8291.1 101154,-8291.1 101154,-8343.1"/>
<text text-anchor="middle" x="101011" y="-8331.1" font-family="Arial" font-size="10.00">Expert 7 Attention (TP)</text>
<text text-anchor="middle" x="101011" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 14,15</text>
<text text-anchor="middle" x="101011" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="101011" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert7_attn_out -->
<g id="node47" class="node">
<title>stage0_expert7_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="100850,-8343.1 100572,-8343.1 100572,-8291.1 100850,-8291.1 100850,-8343.1"/>
<text text-anchor="middle" x="100711" y="-8331.1" font-family="Arial" font-size="10.00">Expert 7 Attn Output (TP)</text>
<text text-anchor="middle" x="100711" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 14,15</text>
<text text-anchor="middle" x="100711" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="100711" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert7_mlp1 -->
<g id="node48" class="node">
<title>stage0_expert7_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="100554,-8343.1 100278,-8343.1 100278,-8291.1 100554,-8291.1 100554,-8343.1"/>
<text text-anchor="middle" x="100416" y="-8331.1" font-family="Arial" font-size="10.00">Expert 7 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="100416" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 14,15</text>
<text text-anchor="middle" x="100416" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="100416" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert7_mlp_act -->
<g id="node49" class="node">
<title>stage0_expert7_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="100260,-8343.1 99984,-8343.1 99984,-8291.1 100260,-8291.1 100260,-8343.1"/>
<text text-anchor="middle" x="100122" y="-8331.1" font-family="Arial" font-size="10.00">Expert 7 MLP GELU (TP)</text>
<text text-anchor="middle" x="100122" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 14,15</text>
<text text-anchor="middle" x="100122" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="100122" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert7_mlp2 -->
<g id="node50" class="node">
<title>stage0_expert7_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="99965.5,-8343.1 99696.5,-8343.1 99696.5,-8291.1 99965.5,-8291.1 99965.5,-8343.1"/>
<text text-anchor="middle" x="99831" y="-8331.1" font-family="Arial" font-size="10.00">Expert 7 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="99831" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 14,15</text>
<text text-anchor="middle" x="99831" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="99831" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert8_qkv -->
<g id="node51" class="node">
<title>stage0_expert8_qkv</title>
<polygon fill="lightgreen" stroke="black" points="99678,-8343.1 99392,-8343.1 99392,-8291.1 99678,-8291.1 99678,-8343.1"/>
<text text-anchor="middle" x="99535" y="-8331.1" font-family="Arial" font-size="10.00">Expert 8 QKV Proj (TP)</text>
<text text-anchor="middle" x="99535" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 16,17</text>
<text text-anchor="middle" x="99535" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="99535" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert8_attn -->
<g id="node52" class="node">
<title>stage0_expert8_attn</title>
<polygon fill="lightgreen" stroke="black" points="99374,-8343.1 99088,-8343.1 99088,-8291.1 99374,-8291.1 99374,-8343.1"/>
<text text-anchor="middle" x="99231" y="-8331.1" font-family="Arial" font-size="10.00">Expert 8 Attention (TP)</text>
<text text-anchor="middle" x="99231" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 16,17</text>
<text text-anchor="middle" x="99231" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="99231" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert8_attn_out -->
<g id="node53" class="node">
<title>stage0_expert8_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="99070,-8343.1 98792,-8343.1 98792,-8291.1 99070,-8291.1 99070,-8343.1"/>
<text text-anchor="middle" x="98931" y="-8331.1" font-family="Arial" font-size="10.00">Expert 8 Attn Output (TP)</text>
<text text-anchor="middle" x="98931" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 16,17</text>
<text text-anchor="middle" x="98931" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="98931" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert8_mlp1 -->
<g id="node54" class="node">
<title>stage0_expert8_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="98774,-8343.1 98498,-8343.1 98498,-8291.1 98774,-8291.1 98774,-8343.1"/>
<text text-anchor="middle" x="98636" y="-8331.1" font-family="Arial" font-size="10.00">Expert 8 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="98636" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 16,17</text>
<text text-anchor="middle" x="98636" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="98636" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert8_mlp_act -->
<g id="node55" class="node">
<title>stage0_expert8_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="98480,-8343.1 98204,-8343.1 98204,-8291.1 98480,-8291.1 98480,-8343.1"/>
<text text-anchor="middle" x="98342" y="-8331.1" font-family="Arial" font-size="10.00">Expert 8 MLP GELU (TP)</text>
<text text-anchor="middle" x="98342" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 16,17</text>
<text text-anchor="middle" x="98342" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="98342" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert8_mlp2 -->
<g id="node56" class="node">
<title>stage0_expert8_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="98185.5,-8343.1 97916.5,-8343.1 97916.5,-8291.1 98185.5,-8291.1 98185.5,-8343.1"/>
<text text-anchor="middle" x="98051" y="-8331.1" font-family="Arial" font-size="10.00">Expert 8 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="98051" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 16,17</text>
<text text-anchor="middle" x="98051" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="98051" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert9_qkv -->
<g id="node57" class="node">
<title>stage0_expert9_qkv</title>
<polygon fill="lightgreen" stroke="black" points="97898,-8343.1 97612,-8343.1 97612,-8291.1 97898,-8291.1 97898,-8343.1"/>
<text text-anchor="middle" x="97755" y="-8331.1" font-family="Arial" font-size="10.00">Expert 9 QKV Proj (TP)</text>
<text text-anchor="middle" x="97755" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 18,19</text>
<text text-anchor="middle" x="97755" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="97755" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert9_attn -->
<g id="node58" class="node">
<title>stage0_expert9_attn</title>
<polygon fill="lightgreen" stroke="black" points="97594,-8343.1 97308,-8343.1 97308,-8291.1 97594,-8291.1 97594,-8343.1"/>
<text text-anchor="middle" x="97451" y="-8331.1" font-family="Arial" font-size="10.00">Expert 9 Attention (TP)</text>
<text text-anchor="middle" x="97451" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 18,19</text>
<text text-anchor="middle" x="97451" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="97451" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert9_attn_out -->
<g id="node59" class="node">
<title>stage0_expert9_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="97290,-8343.1 97012,-8343.1 97012,-8291.1 97290,-8291.1 97290,-8343.1"/>
<text text-anchor="middle" x="97151" y="-8331.1" font-family="Arial" font-size="10.00">Expert 9 Attn Output (TP)</text>
<text text-anchor="middle" x="97151" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 18,19</text>
<text text-anchor="middle" x="97151" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="97151" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert9_mlp1 -->
<g id="node60" class="node">
<title>stage0_expert9_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="96994,-8343.1 96718,-8343.1 96718,-8291.1 96994,-8291.1 96994,-8343.1"/>
<text text-anchor="middle" x="96856" y="-8331.1" font-family="Arial" font-size="10.00">Expert 9 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="96856" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 18,19</text>
<text text-anchor="middle" x="96856" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="96856" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert9_mlp_act -->
<g id="node61" class="node">
<title>stage0_expert9_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="96700,-8343.1 96424,-8343.1 96424,-8291.1 96700,-8291.1 96700,-8343.1"/>
<text text-anchor="middle" x="96562" y="-8331.1" font-family="Arial" font-size="10.00">Expert 9 MLP GELU (TP)</text>
<text text-anchor="middle" x="96562" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 18,19</text>
<text text-anchor="middle" x="96562" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="96562" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert9_mlp2 -->
<g id="node62" class="node">
<title>stage0_expert9_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="96405.5,-8343.1 96136.5,-8343.1 96136.5,-8291.1 96405.5,-8291.1 96405.5,-8343.1"/>
<text text-anchor="middle" x="96271" y="-8331.1" font-family="Arial" font-size="10.00">Expert 9 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="96271" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 18,19</text>
<text text-anchor="middle" x="96271" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="96271" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert10_qkv -->
<g id="node63" class="node">
<title>stage0_expert10_qkv</title>
<polygon fill="lightgreen" stroke="black" points="96118,-8343.1 95832,-8343.1 95832,-8291.1 96118,-8291.1 96118,-8343.1"/>
<text text-anchor="middle" x="95975" y="-8331.1" font-family="Arial" font-size="10.00">Expert 10 QKV Proj (TP)</text>
<text text-anchor="middle" x="95975" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 20,21</text>
<text text-anchor="middle" x="95975" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="95975" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert10_attn -->
<g id="node64" class="node">
<title>stage0_expert10_attn</title>
<polygon fill="lightgreen" stroke="black" points="95814,-8343.1 95528,-8343.1 95528,-8291.1 95814,-8291.1 95814,-8343.1"/>
<text text-anchor="middle" x="95671" y="-8331.1" font-family="Arial" font-size="10.00">Expert 10 Attention (TP)</text>
<text text-anchor="middle" x="95671" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 20,21</text>
<text text-anchor="middle" x="95671" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="95671" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert10_attn_out -->
<g id="node65" class="node">
<title>stage0_expert10_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="95510,-8343.1 95232,-8343.1 95232,-8291.1 95510,-8291.1 95510,-8343.1"/>
<text text-anchor="middle" x="95371" y="-8331.1" font-family="Arial" font-size="10.00">Expert 10 Attn Output (TP)</text>
<text text-anchor="middle" x="95371" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 20,21</text>
<text text-anchor="middle" x="95371" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="95371" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert10_mlp1 -->
<g id="node66" class="node">
<title>stage0_expert10_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="95214,-8343.1 94938,-8343.1 94938,-8291.1 95214,-8291.1 95214,-8343.1"/>
<text text-anchor="middle" x="95076" y="-8331.1" font-family="Arial" font-size="10.00">Expert 10 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="95076" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 20,21</text>
<text text-anchor="middle" x="95076" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="95076" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert10_mlp_act -->
<g id="node67" class="node">
<title>stage0_expert10_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="94920,-8343.1 94644,-8343.1 94644,-8291.1 94920,-8291.1 94920,-8343.1"/>
<text text-anchor="middle" x="94782" y="-8331.1" font-family="Arial" font-size="10.00">Expert 10 MLP GELU (TP)</text>
<text text-anchor="middle" x="94782" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 20,21</text>
<text text-anchor="middle" x="94782" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="94782" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert10_mlp2 -->
<g id="node68" class="node">
<title>stage0_expert10_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="94625.5,-8343.1 94356.5,-8343.1 94356.5,-8291.1 94625.5,-8291.1 94625.5,-8343.1"/>
<text text-anchor="middle" x="94491" y="-8331.1" font-family="Arial" font-size="10.00">Expert 10 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="94491" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 20,21</text>
<text text-anchor="middle" x="94491" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="94491" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert11_qkv -->
<g id="node69" class="node">
<title>stage0_expert11_qkv</title>
<polygon fill="lightgreen" stroke="black" points="94338,-8343.1 94052,-8343.1 94052,-8291.1 94338,-8291.1 94338,-8343.1"/>
<text text-anchor="middle" x="94195" y="-8331.1" font-family="Arial" font-size="10.00">Expert 11 QKV Proj (TP)</text>
<text text-anchor="middle" x="94195" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 22,23</text>
<text text-anchor="middle" x="94195" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="94195" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert11_attn -->
<g id="node70" class="node">
<title>stage0_expert11_attn</title>
<polygon fill="lightgreen" stroke="black" points="94034,-8343.1 93748,-8343.1 93748,-8291.1 94034,-8291.1 94034,-8343.1"/>
<text text-anchor="middle" x="93891" y="-8331.1" font-family="Arial" font-size="10.00">Expert 11 Attention (TP)</text>
<text text-anchor="middle" x="93891" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 22,23</text>
<text text-anchor="middle" x="93891" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="93891" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert11_attn_out -->
<g id="node71" class="node">
<title>stage0_expert11_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="93730,-8343.1 93452,-8343.1 93452,-8291.1 93730,-8291.1 93730,-8343.1"/>
<text text-anchor="middle" x="93591" y="-8331.1" font-family="Arial" font-size="10.00">Expert 11 Attn Output (TP)</text>
<text text-anchor="middle" x="93591" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 22,23</text>
<text text-anchor="middle" x="93591" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="93591" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert11_mlp1 -->
<g id="node72" class="node">
<title>stage0_expert11_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="93434,-8343.1 93158,-8343.1 93158,-8291.1 93434,-8291.1 93434,-8343.1"/>
<text text-anchor="middle" x="93296" y="-8331.1" font-family="Arial" font-size="10.00">Expert 11 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="93296" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 22,23</text>
<text text-anchor="middle" x="93296" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="93296" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert11_mlp_act -->
<g id="node73" class="node">
<title>stage0_expert11_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="93140,-8343.1 92864,-8343.1 92864,-8291.1 93140,-8291.1 93140,-8343.1"/>
<text text-anchor="middle" x="93002" y="-8331.1" font-family="Arial" font-size="10.00">Expert 11 MLP GELU (TP)</text>
<text text-anchor="middle" x="93002" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 22,23</text>
<text text-anchor="middle" x="93002" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="93002" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert11_mlp2 -->
<g id="node74" class="node">
<title>stage0_expert11_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="92845.5,-8343.1 92576.5,-8343.1 92576.5,-8291.1 92845.5,-8291.1 92845.5,-8343.1"/>
<text text-anchor="middle" x="92711" y="-8331.1" font-family="Arial" font-size="10.00">Expert 11 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="92711" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 22,23</text>
<text text-anchor="middle" x="92711" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="92711" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert12_qkv -->
<g id="node75" class="node">
<title>stage0_expert12_qkv</title>
<polygon fill="lightgreen" stroke="black" points="92558,-8343.1 92272,-8343.1 92272,-8291.1 92558,-8291.1 92558,-8343.1"/>
<text text-anchor="middle" x="92415" y="-8331.1" font-family="Arial" font-size="10.00">Expert 12 QKV Proj (TP)</text>
<text text-anchor="middle" x="92415" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 24,25</text>
<text text-anchor="middle" x="92415" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="92415" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert12_attn -->
<g id="node76" class="node">
<title>stage0_expert12_attn</title>
<polygon fill="lightgreen" stroke="black" points="92254,-8343.1 91968,-8343.1 91968,-8291.1 92254,-8291.1 92254,-8343.1"/>
<text text-anchor="middle" x="92111" y="-8331.1" font-family="Arial" font-size="10.00">Expert 12 Attention (TP)</text>
<text text-anchor="middle" x="92111" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 24,25</text>
<text text-anchor="middle" x="92111" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="92111" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert12_attn_out -->
<g id="node77" class="node">
<title>stage0_expert12_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="91950,-8343.1 91672,-8343.1 91672,-8291.1 91950,-8291.1 91950,-8343.1"/>
<text text-anchor="middle" x="91811" y="-8331.1" font-family="Arial" font-size="10.00">Expert 12 Attn Output (TP)</text>
<text text-anchor="middle" x="91811" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 24,25</text>
<text text-anchor="middle" x="91811" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="91811" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert12_mlp1 -->
<g id="node78" class="node">
<title>stage0_expert12_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="91654,-8343.1 91378,-8343.1 91378,-8291.1 91654,-8291.1 91654,-8343.1"/>
<text text-anchor="middle" x="91516" y="-8331.1" font-family="Arial" font-size="10.00">Expert 12 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="91516" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 24,25</text>
<text text-anchor="middle" x="91516" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="91516" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert12_mlp_act -->
<g id="node79" class="node">
<title>stage0_expert12_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="91360,-8343.1 91084,-8343.1 91084,-8291.1 91360,-8291.1 91360,-8343.1"/>
<text text-anchor="middle" x="91222" y="-8331.1" font-family="Arial" font-size="10.00">Expert 12 MLP GELU (TP)</text>
<text text-anchor="middle" x="91222" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 24,25</text>
<text text-anchor="middle" x="91222" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="91222" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert12_mlp2 -->
<g id="node80" class="node">
<title>stage0_expert12_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="91065.5,-8343.1 90796.5,-8343.1 90796.5,-8291.1 91065.5,-8291.1 91065.5,-8343.1"/>
<text text-anchor="middle" x="90931" y="-8331.1" font-family="Arial" font-size="10.00">Expert 12 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="90931" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 24,25</text>
<text text-anchor="middle" x="90931" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="90931" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert13_qkv -->
<g id="node81" class="node">
<title>stage0_expert13_qkv</title>
<polygon fill="lightgreen" stroke="black" points="90778,-8343.1 90492,-8343.1 90492,-8291.1 90778,-8291.1 90778,-8343.1"/>
<text text-anchor="middle" x="90635" y="-8331.1" font-family="Arial" font-size="10.00">Expert 13 QKV Proj (TP)</text>
<text text-anchor="middle" x="90635" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 26,27</text>
<text text-anchor="middle" x="90635" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="90635" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert13_attn -->
<g id="node82" class="node">
<title>stage0_expert13_attn</title>
<polygon fill="lightgreen" stroke="black" points="90474,-8343.1 90188,-8343.1 90188,-8291.1 90474,-8291.1 90474,-8343.1"/>
<text text-anchor="middle" x="90331" y="-8331.1" font-family="Arial" font-size="10.00">Expert 13 Attention (TP)</text>
<text text-anchor="middle" x="90331" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 26,27</text>
<text text-anchor="middle" x="90331" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="90331" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert13_attn_out -->
<g id="node83" class="node">
<title>stage0_expert13_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="90170,-8343.1 89892,-8343.1 89892,-8291.1 90170,-8291.1 90170,-8343.1"/>
<text text-anchor="middle" x="90031" y="-8331.1" font-family="Arial" font-size="10.00">Expert 13 Attn Output (TP)</text>
<text text-anchor="middle" x="90031" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 26,27</text>
<text text-anchor="middle" x="90031" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="90031" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert13_mlp1 -->
<g id="node84" class="node">
<title>stage0_expert13_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="89874,-8343.1 89598,-8343.1 89598,-8291.1 89874,-8291.1 89874,-8343.1"/>
<text text-anchor="middle" x="89736" y="-8331.1" font-family="Arial" font-size="10.00">Expert 13 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="89736" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 26,27</text>
<text text-anchor="middle" x="89736" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="89736" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert13_mlp_act -->
<g id="node85" class="node">
<title>stage0_expert13_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="89580,-8343.1 89304,-8343.1 89304,-8291.1 89580,-8291.1 89580,-8343.1"/>
<text text-anchor="middle" x="89442" y="-8331.1" font-family="Arial" font-size="10.00">Expert 13 MLP GELU (TP)</text>
<text text-anchor="middle" x="89442" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 26,27</text>
<text text-anchor="middle" x="89442" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="89442" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert13_mlp2 -->
<g id="node86" class="node">
<title>stage0_expert13_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="89285.5,-8343.1 89016.5,-8343.1 89016.5,-8291.1 89285.5,-8291.1 89285.5,-8343.1"/>
<text text-anchor="middle" x="89151" y="-8331.1" font-family="Arial" font-size="10.00">Expert 13 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="89151" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 26,27</text>
<text text-anchor="middle" x="89151" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="89151" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert14_qkv -->
<g id="node87" class="node">
<title>stage0_expert14_qkv</title>
<polygon fill="lightgreen" stroke="black" points="88998,-8343.1 88712,-8343.1 88712,-8291.1 88998,-8291.1 88998,-8343.1"/>
<text text-anchor="middle" x="88855" y="-8331.1" font-family="Arial" font-size="10.00">Expert 14 QKV Proj (TP)</text>
<text text-anchor="middle" x="88855" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 28,29</text>
<text text-anchor="middle" x="88855" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="88855" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert14_attn -->
<g id="node88" class="node">
<title>stage0_expert14_attn</title>
<polygon fill="lightgreen" stroke="black" points="88694,-8343.1 88408,-8343.1 88408,-8291.1 88694,-8291.1 88694,-8343.1"/>
<text text-anchor="middle" x="88551" y="-8331.1" font-family="Arial" font-size="10.00">Expert 14 Attention (TP)</text>
<text text-anchor="middle" x="88551" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 28,29</text>
<text text-anchor="middle" x="88551" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="88551" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert14_attn_out -->
<g id="node89" class="node">
<title>stage0_expert14_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="88390,-8343.1 88112,-8343.1 88112,-8291.1 88390,-8291.1 88390,-8343.1"/>
<text text-anchor="middle" x="88251" y="-8331.1" font-family="Arial" font-size="10.00">Expert 14 Attn Output (TP)</text>
<text text-anchor="middle" x="88251" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 28,29</text>
<text text-anchor="middle" x="88251" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="88251" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert14_mlp1 -->
<g id="node90" class="node">
<title>stage0_expert14_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="88094,-8343.1 87818,-8343.1 87818,-8291.1 88094,-8291.1 88094,-8343.1"/>
<text text-anchor="middle" x="87956" y="-8331.1" font-family="Arial" font-size="10.00">Expert 14 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="87956" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 28,29</text>
<text text-anchor="middle" x="87956" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="87956" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert14_mlp_act -->
<g id="node91" class="node">
<title>stage0_expert14_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="87800,-8343.1 87524,-8343.1 87524,-8291.1 87800,-8291.1 87800,-8343.1"/>
<text text-anchor="middle" x="87662" y="-8331.1" font-family="Arial" font-size="10.00">Expert 14 MLP GELU (TP)</text>
<text text-anchor="middle" x="87662" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 28,29</text>
<text text-anchor="middle" x="87662" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="87662" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert14_mlp2 -->
<g id="node92" class="node">
<title>stage0_expert14_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="87505.5,-8343.1 87236.5,-8343.1 87236.5,-8291.1 87505.5,-8291.1 87505.5,-8343.1"/>
<text text-anchor="middle" x="87371" y="-8331.1" font-family="Arial" font-size="10.00">Expert 14 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="87371" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 28,29</text>
<text text-anchor="middle" x="87371" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="87371" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert15_qkv -->
<g id="node93" class="node">
<title>stage0_expert15_qkv</title>
<polygon fill="lightgreen" stroke="black" points="87218,-8343.1 86932,-8343.1 86932,-8291.1 87218,-8291.1 87218,-8343.1"/>
<text text-anchor="middle" x="87075" y="-8331.1" font-family="Arial" font-size="10.00">Expert 15 QKV Proj (TP)</text>
<text text-anchor="middle" x="87075" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 30,31</text>
<text text-anchor="middle" x="87075" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="87075" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert15_attn -->
<g id="node94" class="node">
<title>stage0_expert15_attn</title>
<polygon fill="lightgreen" stroke="black" points="86914,-8343.1 86628,-8343.1 86628,-8291.1 86914,-8291.1 86914,-8343.1"/>
<text text-anchor="middle" x="86771" y="-8331.1" font-family="Arial" font-size="10.00">Expert 15 Attention (TP)</text>
<text text-anchor="middle" x="86771" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 30,31</text>
<text text-anchor="middle" x="86771" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="86771" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert15_attn_out -->
<g id="node95" class="node">
<title>stage0_expert15_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="86610,-8343.1 86332,-8343.1 86332,-8291.1 86610,-8291.1 86610,-8343.1"/>
<text text-anchor="middle" x="86471" y="-8331.1" font-family="Arial" font-size="10.00">Expert 15 Attn Output (TP)</text>
<text text-anchor="middle" x="86471" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 30,31</text>
<text text-anchor="middle" x="86471" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="86471" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert15_mlp1 -->
<g id="node96" class="node">
<title>stage0_expert15_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="86314,-8343.1 86038,-8343.1 86038,-8291.1 86314,-8291.1 86314,-8343.1"/>
<text text-anchor="middle" x="86176" y="-8331.1" font-family="Arial" font-size="10.00">Expert 15 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="86176" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 30,31</text>
<text text-anchor="middle" x="86176" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="86176" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert15_mlp_act -->
<g id="node97" class="node">
<title>stage0_expert15_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="86020,-8343.1 85744,-8343.1 85744,-8291.1 86020,-8291.1 86020,-8343.1"/>
<text text-anchor="middle" x="85882" y="-8331.1" font-family="Arial" font-size="10.00">Expert 15 MLP GELU (TP)</text>
<text text-anchor="middle" x="85882" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 30,31</text>
<text text-anchor="middle" x="85882" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="85882" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert15_mlp2 -->
<g id="node98" class="node">
<title>stage0_expert15_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="85725.5,-8343.1 85456.5,-8343.1 85456.5,-8291.1 85725.5,-8291.1 85725.5,-8343.1"/>
<text text-anchor="middle" x="85591" y="-8331.1" font-family="Arial" font-size="10.00">Expert 15 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="85591" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 30,31</text>
<text text-anchor="middle" x="85591" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="85591" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert16_qkv -->
<g id="node99" class="node">
<title>stage0_expert16_qkv</title>
<polygon fill="lightgreen" stroke="black" points="85438,-8343.1 85152,-8343.1 85152,-8291.1 85438,-8291.1 85438,-8343.1"/>
<text text-anchor="middle" x="85295" y="-8331.1" font-family="Arial" font-size="10.00">Expert 16 QKV Proj (TP)</text>
<text text-anchor="middle" x="85295" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 32,33</text>
<text text-anchor="middle" x="85295" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="85295" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert16_attn -->
<g id="node100" class="node">
<title>stage0_expert16_attn</title>
<polygon fill="lightgreen" stroke="black" points="85134,-8343.1 84848,-8343.1 84848,-8291.1 85134,-8291.1 85134,-8343.1"/>
<text text-anchor="middle" x="84991" y="-8331.1" font-family="Arial" font-size="10.00">Expert 16 Attention (TP)</text>
<text text-anchor="middle" x="84991" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 32,33</text>
<text text-anchor="middle" x="84991" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="84991" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert16_attn_out -->
<g id="node101" class="node">
<title>stage0_expert16_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="84830,-8343.1 84552,-8343.1 84552,-8291.1 84830,-8291.1 84830,-8343.1"/>
<text text-anchor="middle" x="84691" y="-8331.1" font-family="Arial" font-size="10.00">Expert 16 Attn Output (TP)</text>
<text text-anchor="middle" x="84691" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 32,33</text>
<text text-anchor="middle" x="84691" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="84691" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert16_mlp1 -->
<g id="node102" class="node">
<title>stage0_expert16_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="84534,-8343.1 84258,-8343.1 84258,-8291.1 84534,-8291.1 84534,-8343.1"/>
<text text-anchor="middle" x="84396" y="-8331.1" font-family="Arial" font-size="10.00">Expert 16 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="84396" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 32,33</text>
<text text-anchor="middle" x="84396" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="84396" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert16_mlp_act -->
<g id="node103" class="node">
<title>stage0_expert16_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="84240,-8343.1 83964,-8343.1 83964,-8291.1 84240,-8291.1 84240,-8343.1"/>
<text text-anchor="middle" x="84102" y="-8331.1" font-family="Arial" font-size="10.00">Expert 16 MLP GELU (TP)</text>
<text text-anchor="middle" x="84102" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 32,33</text>
<text text-anchor="middle" x="84102" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="84102" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert16_mlp2 -->
<g id="node104" class="node">
<title>stage0_expert16_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="83945.5,-8343.1 83676.5,-8343.1 83676.5,-8291.1 83945.5,-8291.1 83945.5,-8343.1"/>
<text text-anchor="middle" x="83811" y="-8331.1" font-family="Arial" font-size="10.00">Expert 16 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="83811" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 32,33</text>
<text text-anchor="middle" x="83811" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="83811" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert17_qkv -->
<g id="node105" class="node">
<title>stage0_expert17_qkv</title>
<polygon fill="lightgreen" stroke="black" points="83658,-8343.1 83372,-8343.1 83372,-8291.1 83658,-8291.1 83658,-8343.1"/>
<text text-anchor="middle" x="83515" y="-8331.1" font-family="Arial" font-size="10.00">Expert 17 QKV Proj (TP)</text>
<text text-anchor="middle" x="83515" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 34,35</text>
<text text-anchor="middle" x="83515" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="83515" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert17_attn -->
<g id="node106" class="node">
<title>stage0_expert17_attn</title>
<polygon fill="lightgreen" stroke="black" points="83354,-8343.1 83068,-8343.1 83068,-8291.1 83354,-8291.1 83354,-8343.1"/>
<text text-anchor="middle" x="83211" y="-8331.1" font-family="Arial" font-size="10.00">Expert 17 Attention (TP)</text>
<text text-anchor="middle" x="83211" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 34,35</text>
<text text-anchor="middle" x="83211" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="83211" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert17_attn_out -->
<g id="node107" class="node">
<title>stage0_expert17_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="83050,-8343.1 82772,-8343.1 82772,-8291.1 83050,-8291.1 83050,-8343.1"/>
<text text-anchor="middle" x="82911" y="-8331.1" font-family="Arial" font-size="10.00">Expert 17 Attn Output (TP)</text>
<text text-anchor="middle" x="82911" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 34,35</text>
<text text-anchor="middle" x="82911" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="82911" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert17_mlp1 -->
<g id="node108" class="node">
<title>stage0_expert17_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="82754,-8343.1 82478,-8343.1 82478,-8291.1 82754,-8291.1 82754,-8343.1"/>
<text text-anchor="middle" x="82616" y="-8331.1" font-family="Arial" font-size="10.00">Expert 17 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="82616" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 34,35</text>
<text text-anchor="middle" x="82616" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="82616" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert17_mlp_act -->
<g id="node109" class="node">
<title>stage0_expert17_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="82460,-8343.1 82184,-8343.1 82184,-8291.1 82460,-8291.1 82460,-8343.1"/>
<text text-anchor="middle" x="82322" y="-8331.1" font-family="Arial" font-size="10.00">Expert 17 MLP GELU (TP)</text>
<text text-anchor="middle" x="82322" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 34,35</text>
<text text-anchor="middle" x="82322" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="82322" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert17_mlp2 -->
<g id="node110" class="node">
<title>stage0_expert17_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="82165.5,-8343.1 81896.5,-8343.1 81896.5,-8291.1 82165.5,-8291.1 82165.5,-8343.1"/>
<text text-anchor="middle" x="82031" y="-8331.1" font-family="Arial" font-size="10.00">Expert 17 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="82031" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 34,35</text>
<text text-anchor="middle" x="82031" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="82031" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert18_qkv -->
<g id="node111" class="node">
<title>stage0_expert18_qkv</title>
<polygon fill="lightgreen" stroke="black" points="81878,-8343.1 81592,-8343.1 81592,-8291.1 81878,-8291.1 81878,-8343.1"/>
<text text-anchor="middle" x="81735" y="-8331.1" font-family="Arial" font-size="10.00">Expert 18 QKV Proj (TP)</text>
<text text-anchor="middle" x="81735" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 36,37</text>
<text text-anchor="middle" x="81735" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="81735" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert18_attn -->
<g id="node112" class="node">
<title>stage0_expert18_attn</title>
<polygon fill="lightgreen" stroke="black" points="81574,-8343.1 81288,-8343.1 81288,-8291.1 81574,-8291.1 81574,-8343.1"/>
<text text-anchor="middle" x="81431" y="-8331.1" font-family="Arial" font-size="10.00">Expert 18 Attention (TP)</text>
<text text-anchor="middle" x="81431" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 36,37</text>
<text text-anchor="middle" x="81431" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="81431" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert18_attn_out -->
<g id="node113" class="node">
<title>stage0_expert18_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="81270,-8343.1 80992,-8343.1 80992,-8291.1 81270,-8291.1 81270,-8343.1"/>
<text text-anchor="middle" x="81131" y="-8331.1" font-family="Arial" font-size="10.00">Expert 18 Attn Output (TP)</text>
<text text-anchor="middle" x="81131" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 36,37</text>
<text text-anchor="middle" x="81131" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="81131" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert18_mlp1 -->
<g id="node114" class="node">
<title>stage0_expert18_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="80974,-8343.1 80698,-8343.1 80698,-8291.1 80974,-8291.1 80974,-8343.1"/>
<text text-anchor="middle" x="80836" y="-8331.1" font-family="Arial" font-size="10.00">Expert 18 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="80836" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 36,37</text>
<text text-anchor="middle" x="80836" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="80836" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert18_mlp_act -->
<g id="node115" class="node">
<title>stage0_expert18_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="80680,-8343.1 80404,-8343.1 80404,-8291.1 80680,-8291.1 80680,-8343.1"/>
<text text-anchor="middle" x="80542" y="-8331.1" font-family="Arial" font-size="10.00">Expert 18 MLP GELU (TP)</text>
<text text-anchor="middle" x="80542" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 36,37</text>
<text text-anchor="middle" x="80542" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="80542" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert18_mlp2 -->
<g id="node116" class="node">
<title>stage0_expert18_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="80385.5,-8343.1 80116.5,-8343.1 80116.5,-8291.1 80385.5,-8291.1 80385.5,-8343.1"/>
<text text-anchor="middle" x="80251" y="-8331.1" font-family="Arial" font-size="10.00">Expert 18 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="80251" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 36,37</text>
<text text-anchor="middle" x="80251" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="80251" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert19_qkv -->
<g id="node117" class="node">
<title>stage0_expert19_qkv</title>
<polygon fill="lightgreen" stroke="black" points="80098,-8343.1 79812,-8343.1 79812,-8291.1 80098,-8291.1 80098,-8343.1"/>
<text text-anchor="middle" x="79955" y="-8331.1" font-family="Arial" font-size="10.00">Expert 19 QKV Proj (TP)</text>
<text text-anchor="middle" x="79955" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 38,39</text>
<text text-anchor="middle" x="79955" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="79955" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert19_attn -->
<g id="node118" class="node">
<title>stage0_expert19_attn</title>
<polygon fill="lightgreen" stroke="black" points="79794,-8343.1 79508,-8343.1 79508,-8291.1 79794,-8291.1 79794,-8343.1"/>
<text text-anchor="middle" x="79651" y="-8331.1" font-family="Arial" font-size="10.00">Expert 19 Attention (TP)</text>
<text text-anchor="middle" x="79651" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 38,39</text>
<text text-anchor="middle" x="79651" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="79651" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert19_attn_out -->
<g id="node119" class="node">
<title>stage0_expert19_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="79490,-8343.1 79212,-8343.1 79212,-8291.1 79490,-8291.1 79490,-8343.1"/>
<text text-anchor="middle" x="79351" y="-8331.1" font-family="Arial" font-size="10.00">Expert 19 Attn Output (TP)</text>
<text text-anchor="middle" x="79351" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 38,39</text>
<text text-anchor="middle" x="79351" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="79351" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert19_mlp1 -->
<g id="node120" class="node">
<title>stage0_expert19_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="79194,-8343.1 78918,-8343.1 78918,-8291.1 79194,-8291.1 79194,-8343.1"/>
<text text-anchor="middle" x="79056" y="-8331.1" font-family="Arial" font-size="10.00">Expert 19 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="79056" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 38,39</text>
<text text-anchor="middle" x="79056" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="79056" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert19_mlp_act -->
<g id="node121" class="node">
<title>stage0_expert19_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="78900,-8343.1 78624,-8343.1 78624,-8291.1 78900,-8291.1 78900,-8343.1"/>
<text text-anchor="middle" x="78762" y="-8331.1" font-family="Arial" font-size="10.00">Expert 19 MLP GELU (TP)</text>
<text text-anchor="middle" x="78762" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 38,39</text>
<text text-anchor="middle" x="78762" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="78762" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert19_mlp2 -->
<g id="node122" class="node">
<title>stage0_expert19_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="78605.5,-8343.1 78336.5,-8343.1 78336.5,-8291.1 78605.5,-8291.1 78605.5,-8343.1"/>
<text text-anchor="middle" x="78471" y="-8331.1" font-family="Arial" font-size="10.00">Expert 19 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="78471" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 38,39</text>
<text text-anchor="middle" x="78471" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="78471" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert20_qkv -->
<g id="node123" class="node">
<title>stage0_expert20_qkv</title>
<polygon fill="lightgreen" stroke="black" points="78318,-8343.1 78032,-8343.1 78032,-8291.1 78318,-8291.1 78318,-8343.1"/>
<text text-anchor="middle" x="78175" y="-8331.1" font-family="Arial" font-size="10.00">Expert 20 QKV Proj (TP)</text>
<text text-anchor="middle" x="78175" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 40,41</text>
<text text-anchor="middle" x="78175" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="78175" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert20_attn -->
<g id="node124" class="node">
<title>stage0_expert20_attn</title>
<polygon fill="lightgreen" stroke="black" points="78014,-8343.1 77728,-8343.1 77728,-8291.1 78014,-8291.1 78014,-8343.1"/>
<text text-anchor="middle" x="77871" y="-8331.1" font-family="Arial" font-size="10.00">Expert 20 Attention (TP)</text>
<text text-anchor="middle" x="77871" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 40,41</text>
<text text-anchor="middle" x="77871" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="77871" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert20_attn_out -->
<g id="node125" class="node">
<title>stage0_expert20_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="77710,-8343.1 77432,-8343.1 77432,-8291.1 77710,-8291.1 77710,-8343.1"/>
<text text-anchor="middle" x="77571" y="-8331.1" font-family="Arial" font-size="10.00">Expert 20 Attn Output (TP)</text>
<text text-anchor="middle" x="77571" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 40,41</text>
<text text-anchor="middle" x="77571" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="77571" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert20_mlp1 -->
<g id="node126" class="node">
<title>stage0_expert20_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="77414,-8343.1 77138,-8343.1 77138,-8291.1 77414,-8291.1 77414,-8343.1"/>
<text text-anchor="middle" x="77276" y="-8331.1" font-family="Arial" font-size="10.00">Expert 20 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="77276" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 40,41</text>
<text text-anchor="middle" x="77276" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="77276" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert20_mlp_act -->
<g id="node127" class="node">
<title>stage0_expert20_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="77120,-8343.1 76844,-8343.1 76844,-8291.1 77120,-8291.1 77120,-8343.1"/>
<text text-anchor="middle" x="76982" y="-8331.1" font-family="Arial" font-size="10.00">Expert 20 MLP GELU (TP)</text>
<text text-anchor="middle" x="76982" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 40,41</text>
<text text-anchor="middle" x="76982" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="76982" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert20_mlp2 -->
<g id="node128" class="node">
<title>stage0_expert20_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="76825.5,-8343.1 76556.5,-8343.1 76556.5,-8291.1 76825.5,-8291.1 76825.5,-8343.1"/>
<text text-anchor="middle" x="76691" y="-8331.1" font-family="Arial" font-size="10.00">Expert 20 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="76691" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 40,41</text>
<text text-anchor="middle" x="76691" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="76691" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert21_qkv -->
<g id="node129" class="node">
<title>stage0_expert21_qkv</title>
<polygon fill="lightgreen" stroke="black" points="76538,-8343.1 76252,-8343.1 76252,-8291.1 76538,-8291.1 76538,-8343.1"/>
<text text-anchor="middle" x="76395" y="-8331.1" font-family="Arial" font-size="10.00">Expert 21 QKV Proj (TP)</text>
<text text-anchor="middle" x="76395" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 42,43</text>
<text text-anchor="middle" x="76395" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="76395" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert21_attn -->
<g id="node130" class="node">
<title>stage0_expert21_attn</title>
<polygon fill="lightgreen" stroke="black" points="76234,-8343.1 75948,-8343.1 75948,-8291.1 76234,-8291.1 76234,-8343.1"/>
<text text-anchor="middle" x="76091" y="-8331.1" font-family="Arial" font-size="10.00">Expert 21 Attention (TP)</text>
<text text-anchor="middle" x="76091" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 42,43</text>
<text text-anchor="middle" x="76091" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="76091" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert21_attn_out -->
<g id="node131" class="node">
<title>stage0_expert21_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="75930,-8343.1 75652,-8343.1 75652,-8291.1 75930,-8291.1 75930,-8343.1"/>
<text text-anchor="middle" x="75791" y="-8331.1" font-family="Arial" font-size="10.00">Expert 21 Attn Output (TP)</text>
<text text-anchor="middle" x="75791" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 42,43</text>
<text text-anchor="middle" x="75791" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="75791" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert21_mlp1 -->
<g id="node132" class="node">
<title>stage0_expert21_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="75634,-8343.1 75358,-8343.1 75358,-8291.1 75634,-8291.1 75634,-8343.1"/>
<text text-anchor="middle" x="75496" y="-8331.1" font-family="Arial" font-size="10.00">Expert 21 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="75496" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 42,43</text>
<text text-anchor="middle" x="75496" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="75496" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert21_mlp_act -->
<g id="node133" class="node">
<title>stage0_expert21_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="75340,-8343.1 75064,-8343.1 75064,-8291.1 75340,-8291.1 75340,-8343.1"/>
<text text-anchor="middle" x="75202" y="-8331.1" font-family="Arial" font-size="10.00">Expert 21 MLP GELU (TP)</text>
<text text-anchor="middle" x="75202" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 42,43</text>
<text text-anchor="middle" x="75202" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="75202" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert21_mlp2 -->
<g id="node134" class="node">
<title>stage0_expert21_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="75045.5,-8343.1 74776.5,-8343.1 74776.5,-8291.1 75045.5,-8291.1 75045.5,-8343.1"/>
<text text-anchor="middle" x="74911" y="-8331.1" font-family="Arial" font-size="10.00">Expert 21 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="74911" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 42,43</text>
<text text-anchor="middle" x="74911" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="74911" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert22_qkv -->
<g id="node135" class="node">
<title>stage0_expert22_qkv</title>
<polygon fill="lightgreen" stroke="black" points="74758,-8343.1 74472,-8343.1 74472,-8291.1 74758,-8291.1 74758,-8343.1"/>
<text text-anchor="middle" x="74615" y="-8331.1" font-family="Arial" font-size="10.00">Expert 22 QKV Proj (TP)</text>
<text text-anchor="middle" x="74615" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 44,45</text>
<text text-anchor="middle" x="74615" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="74615" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert22_attn -->
<g id="node136" class="node">
<title>stage0_expert22_attn</title>
<polygon fill="lightgreen" stroke="black" points="74454,-8343.1 74168,-8343.1 74168,-8291.1 74454,-8291.1 74454,-8343.1"/>
<text text-anchor="middle" x="74311" y="-8331.1" font-family="Arial" font-size="10.00">Expert 22 Attention (TP)</text>
<text text-anchor="middle" x="74311" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 44,45</text>
<text text-anchor="middle" x="74311" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="74311" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert22_attn_out -->
<g id="node137" class="node">
<title>stage0_expert22_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="74150,-8343.1 73872,-8343.1 73872,-8291.1 74150,-8291.1 74150,-8343.1"/>
<text text-anchor="middle" x="74011" y="-8331.1" font-family="Arial" font-size="10.00">Expert 22 Attn Output (TP)</text>
<text text-anchor="middle" x="74011" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 44,45</text>
<text text-anchor="middle" x="74011" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="74011" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert22_mlp1 -->
<g id="node138" class="node">
<title>stage0_expert22_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="73854,-8343.1 73578,-8343.1 73578,-8291.1 73854,-8291.1 73854,-8343.1"/>
<text text-anchor="middle" x="73716" y="-8331.1" font-family="Arial" font-size="10.00">Expert 22 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="73716" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 44,45</text>
<text text-anchor="middle" x="73716" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="73716" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert22_mlp_act -->
<g id="node139" class="node">
<title>stage0_expert22_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="73560,-8343.1 73284,-8343.1 73284,-8291.1 73560,-8291.1 73560,-8343.1"/>
<text text-anchor="middle" x="73422" y="-8331.1" font-family="Arial" font-size="10.00">Expert 22 MLP GELU (TP)</text>
<text text-anchor="middle" x="73422" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 44,45</text>
<text text-anchor="middle" x="73422" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="73422" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert22_mlp2 -->
<g id="node140" class="node">
<title>stage0_expert22_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="73265.5,-8343.1 72996.5,-8343.1 72996.5,-8291.1 73265.5,-8291.1 73265.5,-8343.1"/>
<text text-anchor="middle" x="73131" y="-8331.1" font-family="Arial" font-size="10.00">Expert 22 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="73131" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 44,45</text>
<text text-anchor="middle" x="73131" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="73131" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert23_qkv -->
<g id="node141" class="node">
<title>stage0_expert23_qkv</title>
<polygon fill="lightgreen" stroke="black" points="72978,-8343.1 72692,-8343.1 72692,-8291.1 72978,-8291.1 72978,-8343.1"/>
<text text-anchor="middle" x="72835" y="-8331.1" font-family="Arial" font-size="10.00">Expert 23 QKV Proj (TP)</text>
<text text-anchor="middle" x="72835" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 46,47</text>
<text text-anchor="middle" x="72835" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="72835" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert23_attn -->
<g id="node142" class="node">
<title>stage0_expert23_attn</title>
<polygon fill="lightgreen" stroke="black" points="72674,-8343.1 72388,-8343.1 72388,-8291.1 72674,-8291.1 72674,-8343.1"/>
<text text-anchor="middle" x="72531" y="-8331.1" font-family="Arial" font-size="10.00">Expert 23 Attention (TP)</text>
<text text-anchor="middle" x="72531" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 46,47</text>
<text text-anchor="middle" x="72531" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="72531" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert23_attn_out -->
<g id="node143" class="node">
<title>stage0_expert23_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="72370,-8343.1 72092,-8343.1 72092,-8291.1 72370,-8291.1 72370,-8343.1"/>
<text text-anchor="middle" x="72231" y="-8331.1" font-family="Arial" font-size="10.00">Expert 23 Attn Output (TP)</text>
<text text-anchor="middle" x="72231" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 46,47</text>
<text text-anchor="middle" x="72231" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="72231" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert23_mlp1 -->
<g id="node144" class="node">
<title>stage0_expert23_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="72074,-8343.1 71798,-8343.1 71798,-8291.1 72074,-8291.1 72074,-8343.1"/>
<text text-anchor="middle" x="71936" y="-8331.1" font-family="Arial" font-size="10.00">Expert 23 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="71936" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 46,47</text>
<text text-anchor="middle" x="71936" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="71936" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert23_mlp_act -->
<g id="node145" class="node">
<title>stage0_expert23_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="71780,-8343.1 71504,-8343.1 71504,-8291.1 71780,-8291.1 71780,-8343.1"/>
<text text-anchor="middle" x="71642" y="-8331.1" font-family="Arial" font-size="10.00">Expert 23 MLP GELU (TP)</text>
<text text-anchor="middle" x="71642" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 46,47</text>
<text text-anchor="middle" x="71642" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="71642" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert23_mlp2 -->
<g id="node146" class="node">
<title>stage0_expert23_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="71485.5,-8343.1 71216.5,-8343.1 71216.5,-8291.1 71485.5,-8291.1 71485.5,-8343.1"/>
<text text-anchor="middle" x="71351" y="-8331.1" font-family="Arial" font-size="10.00">Expert 23 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="71351" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 46,47</text>
<text text-anchor="middle" x="71351" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="71351" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert24_qkv -->
<g id="node147" class="node">
<title>stage0_expert24_qkv</title>
<polygon fill="lightgreen" stroke="black" points="71198,-8343.1 70912,-8343.1 70912,-8291.1 71198,-8291.1 71198,-8343.1"/>
<text text-anchor="middle" x="71055" y="-8331.1" font-family="Arial" font-size="10.00">Expert 24 QKV Proj (TP)</text>
<text text-anchor="middle" x="71055" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 48,49</text>
<text text-anchor="middle" x="71055" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="71055" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert24_attn -->
<g id="node148" class="node">
<title>stage0_expert24_attn</title>
<polygon fill="lightgreen" stroke="black" points="70894,-8343.1 70608,-8343.1 70608,-8291.1 70894,-8291.1 70894,-8343.1"/>
<text text-anchor="middle" x="70751" y="-8331.1" font-family="Arial" font-size="10.00">Expert 24 Attention (TP)</text>
<text text-anchor="middle" x="70751" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 48,49</text>
<text text-anchor="middle" x="70751" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="70751" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert24_attn_out -->
<g id="node149" class="node">
<title>stage0_expert24_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="70590,-8343.1 70312,-8343.1 70312,-8291.1 70590,-8291.1 70590,-8343.1"/>
<text text-anchor="middle" x="70451" y="-8331.1" font-family="Arial" font-size="10.00">Expert 24 Attn Output (TP)</text>
<text text-anchor="middle" x="70451" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 48,49</text>
<text text-anchor="middle" x="70451" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="70451" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert24_mlp1 -->
<g id="node150" class="node">
<title>stage0_expert24_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="70294,-8343.1 70018,-8343.1 70018,-8291.1 70294,-8291.1 70294,-8343.1"/>
<text text-anchor="middle" x="70156" y="-8331.1" font-family="Arial" font-size="10.00">Expert 24 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="70156" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 48,49</text>
<text text-anchor="middle" x="70156" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="70156" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert24_mlp_act -->
<g id="node151" class="node">
<title>stage0_expert24_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="70000,-8343.1 69724,-8343.1 69724,-8291.1 70000,-8291.1 70000,-8343.1"/>
<text text-anchor="middle" x="69862" y="-8331.1" font-family="Arial" font-size="10.00">Expert 24 MLP GELU (TP)</text>
<text text-anchor="middle" x="69862" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 48,49</text>
<text text-anchor="middle" x="69862" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="69862" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert24_mlp2 -->
<g id="node152" class="node">
<title>stage0_expert24_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="69705.5,-8343.1 69436.5,-8343.1 69436.5,-8291.1 69705.5,-8291.1 69705.5,-8343.1"/>
<text text-anchor="middle" x="69571" y="-8331.1" font-family="Arial" font-size="10.00">Expert 24 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="69571" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 48,49</text>
<text text-anchor="middle" x="69571" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="69571" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert25_qkv -->
<g id="node153" class="node">
<title>stage0_expert25_qkv</title>
<polygon fill="lightgreen" stroke="black" points="69418,-8343.1 69132,-8343.1 69132,-8291.1 69418,-8291.1 69418,-8343.1"/>
<text text-anchor="middle" x="69275" y="-8331.1" font-family="Arial" font-size="10.00">Expert 25 QKV Proj (TP)</text>
<text text-anchor="middle" x="69275" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 50,51</text>
<text text-anchor="middle" x="69275" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="69275" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert25_attn -->
<g id="node154" class="node">
<title>stage0_expert25_attn</title>
<polygon fill="lightgreen" stroke="black" points="69114,-8343.1 68828,-8343.1 68828,-8291.1 69114,-8291.1 69114,-8343.1"/>
<text text-anchor="middle" x="68971" y="-8331.1" font-family="Arial" font-size="10.00">Expert 25 Attention (TP)</text>
<text text-anchor="middle" x="68971" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 50,51</text>
<text text-anchor="middle" x="68971" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="68971" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert25_attn_out -->
<g id="node155" class="node">
<title>stage0_expert25_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="68810,-8343.1 68532,-8343.1 68532,-8291.1 68810,-8291.1 68810,-8343.1"/>
<text text-anchor="middle" x="68671" y="-8331.1" font-family="Arial" font-size="10.00">Expert 25 Attn Output (TP)</text>
<text text-anchor="middle" x="68671" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 50,51</text>
<text text-anchor="middle" x="68671" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="68671" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert25_mlp1 -->
<g id="node156" class="node">
<title>stage0_expert25_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="68514,-8343.1 68238,-8343.1 68238,-8291.1 68514,-8291.1 68514,-8343.1"/>
<text text-anchor="middle" x="68376" y="-8331.1" font-family="Arial" font-size="10.00">Expert 25 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="68376" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 50,51</text>
<text text-anchor="middle" x="68376" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="68376" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert25_mlp_act -->
<g id="node157" class="node">
<title>stage0_expert25_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="68220,-8343.1 67944,-8343.1 67944,-8291.1 68220,-8291.1 68220,-8343.1"/>
<text text-anchor="middle" x="68082" y="-8331.1" font-family="Arial" font-size="10.00">Expert 25 MLP GELU (TP)</text>
<text text-anchor="middle" x="68082" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 50,51</text>
<text text-anchor="middle" x="68082" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="68082" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert25_mlp2 -->
<g id="node158" class="node">
<title>stage0_expert25_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="67925.5,-8343.1 67656.5,-8343.1 67656.5,-8291.1 67925.5,-8291.1 67925.5,-8343.1"/>
<text text-anchor="middle" x="67791" y="-8331.1" font-family="Arial" font-size="10.00">Expert 25 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="67791" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 50,51</text>
<text text-anchor="middle" x="67791" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="67791" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert26_qkv -->
<g id="node159" class="node">
<title>stage0_expert26_qkv</title>
<polygon fill="lightgreen" stroke="black" points="67638,-8343.1 67352,-8343.1 67352,-8291.1 67638,-8291.1 67638,-8343.1"/>
<text text-anchor="middle" x="67495" y="-8331.1" font-family="Arial" font-size="10.00">Expert 26 QKV Proj (TP)</text>
<text text-anchor="middle" x="67495" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 52,53</text>
<text text-anchor="middle" x="67495" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="67495" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert26_attn -->
<g id="node160" class="node">
<title>stage0_expert26_attn</title>
<polygon fill="lightgreen" stroke="black" points="67334,-8343.1 67048,-8343.1 67048,-8291.1 67334,-8291.1 67334,-8343.1"/>
<text text-anchor="middle" x="67191" y="-8331.1" font-family="Arial" font-size="10.00">Expert 26 Attention (TP)</text>
<text text-anchor="middle" x="67191" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 52,53</text>
<text text-anchor="middle" x="67191" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="67191" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert26_attn_out -->
<g id="node161" class="node">
<title>stage0_expert26_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="67030,-8343.1 66752,-8343.1 66752,-8291.1 67030,-8291.1 67030,-8343.1"/>
<text text-anchor="middle" x="66891" y="-8331.1" font-family="Arial" font-size="10.00">Expert 26 Attn Output (TP)</text>
<text text-anchor="middle" x="66891" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 52,53</text>
<text text-anchor="middle" x="66891" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="66891" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert26_mlp1 -->
<g id="node162" class="node">
<title>stage0_expert26_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="66734,-8343.1 66458,-8343.1 66458,-8291.1 66734,-8291.1 66734,-8343.1"/>
<text text-anchor="middle" x="66596" y="-8331.1" font-family="Arial" font-size="10.00">Expert 26 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="66596" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 52,53</text>
<text text-anchor="middle" x="66596" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="66596" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert26_mlp_act -->
<g id="node163" class="node">
<title>stage0_expert26_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="66440,-8343.1 66164,-8343.1 66164,-8291.1 66440,-8291.1 66440,-8343.1"/>
<text text-anchor="middle" x="66302" y="-8331.1" font-family="Arial" font-size="10.00">Expert 26 MLP GELU (TP)</text>
<text text-anchor="middle" x="66302" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 52,53</text>
<text text-anchor="middle" x="66302" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="66302" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert26_mlp2 -->
<g id="node164" class="node">
<title>stage0_expert26_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="66145.5,-8343.1 65876.5,-8343.1 65876.5,-8291.1 66145.5,-8291.1 66145.5,-8343.1"/>
<text text-anchor="middle" x="66011" y="-8331.1" font-family="Arial" font-size="10.00">Expert 26 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="66011" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 52,53</text>
<text text-anchor="middle" x="66011" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="66011" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert27_qkv -->
<g id="node165" class="node">
<title>stage0_expert27_qkv</title>
<polygon fill="lightgreen" stroke="black" points="65858,-8343.1 65572,-8343.1 65572,-8291.1 65858,-8291.1 65858,-8343.1"/>
<text text-anchor="middle" x="65715" y="-8331.1" font-family="Arial" font-size="10.00">Expert 27 QKV Proj (TP)</text>
<text text-anchor="middle" x="65715" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 54,55</text>
<text text-anchor="middle" x="65715" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="65715" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert27_attn -->
<g id="node166" class="node">
<title>stage0_expert27_attn</title>
<polygon fill="lightgreen" stroke="black" points="65554,-8343.1 65268,-8343.1 65268,-8291.1 65554,-8291.1 65554,-8343.1"/>
<text text-anchor="middle" x="65411" y="-8331.1" font-family="Arial" font-size="10.00">Expert 27 Attention (TP)</text>
<text text-anchor="middle" x="65411" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 54,55</text>
<text text-anchor="middle" x="65411" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="65411" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert27_attn_out -->
<g id="node167" class="node">
<title>stage0_expert27_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="65250,-8343.1 64972,-8343.1 64972,-8291.1 65250,-8291.1 65250,-8343.1"/>
<text text-anchor="middle" x="65111" y="-8331.1" font-family="Arial" font-size="10.00">Expert 27 Attn Output (TP)</text>
<text text-anchor="middle" x="65111" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 54,55</text>
<text text-anchor="middle" x="65111" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="65111" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert27_mlp1 -->
<g id="node168" class="node">
<title>stage0_expert27_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="64954,-8343.1 64678,-8343.1 64678,-8291.1 64954,-8291.1 64954,-8343.1"/>
<text text-anchor="middle" x="64816" y="-8331.1" font-family="Arial" font-size="10.00">Expert 27 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="64816" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 54,55</text>
<text text-anchor="middle" x="64816" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="64816" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert27_mlp_act -->
<g id="node169" class="node">
<title>stage0_expert27_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="64660,-8343.1 64384,-8343.1 64384,-8291.1 64660,-8291.1 64660,-8343.1"/>
<text text-anchor="middle" x="64522" y="-8331.1" font-family="Arial" font-size="10.00">Expert 27 MLP GELU (TP)</text>
<text text-anchor="middle" x="64522" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 54,55</text>
<text text-anchor="middle" x="64522" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="64522" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert27_mlp2 -->
<g id="node170" class="node">
<title>stage0_expert27_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="64365.5,-8343.1 64096.5,-8343.1 64096.5,-8291.1 64365.5,-8291.1 64365.5,-8343.1"/>
<text text-anchor="middle" x="64231" y="-8331.1" font-family="Arial" font-size="10.00">Expert 27 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="64231" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 54,55</text>
<text text-anchor="middle" x="64231" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="64231" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert28_qkv -->
<g id="node171" class="node">
<title>stage0_expert28_qkv</title>
<polygon fill="lightgreen" stroke="black" points="64078,-8343.1 63792,-8343.1 63792,-8291.1 64078,-8291.1 64078,-8343.1"/>
<text text-anchor="middle" x="63935" y="-8331.1" font-family="Arial" font-size="10.00">Expert 28 QKV Proj (TP)</text>
<text text-anchor="middle" x="63935" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 56,57</text>
<text text-anchor="middle" x="63935" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="63935" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert28_attn -->
<g id="node172" class="node">
<title>stage0_expert28_attn</title>
<polygon fill="lightgreen" stroke="black" points="63774,-8343.1 63488,-8343.1 63488,-8291.1 63774,-8291.1 63774,-8343.1"/>
<text text-anchor="middle" x="63631" y="-8331.1" font-family="Arial" font-size="10.00">Expert 28 Attention (TP)</text>
<text text-anchor="middle" x="63631" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 56,57</text>
<text text-anchor="middle" x="63631" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="63631" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert28_attn_out -->
<g id="node173" class="node">
<title>stage0_expert28_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="63470,-8343.1 63192,-8343.1 63192,-8291.1 63470,-8291.1 63470,-8343.1"/>
<text text-anchor="middle" x="63331" y="-8331.1" font-family="Arial" font-size="10.00">Expert 28 Attn Output (TP)</text>
<text text-anchor="middle" x="63331" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 56,57</text>
<text text-anchor="middle" x="63331" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="63331" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert28_mlp1 -->
<g id="node174" class="node">
<title>stage0_expert28_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="63174,-8343.1 62898,-8343.1 62898,-8291.1 63174,-8291.1 63174,-8343.1"/>
<text text-anchor="middle" x="63036" y="-8331.1" font-family="Arial" font-size="10.00">Expert 28 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="63036" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 56,57</text>
<text text-anchor="middle" x="63036" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="63036" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert28_mlp_act -->
<g id="node175" class="node">
<title>stage0_expert28_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="62880,-8343.1 62604,-8343.1 62604,-8291.1 62880,-8291.1 62880,-8343.1"/>
<text text-anchor="middle" x="62742" y="-8331.1" font-family="Arial" font-size="10.00">Expert 28 MLP GELU (TP)</text>
<text text-anchor="middle" x="62742" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 56,57</text>
<text text-anchor="middle" x="62742" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="62742" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert28_mlp2 -->
<g id="node176" class="node">
<title>stage0_expert28_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="62585.5,-8343.1 62316.5,-8343.1 62316.5,-8291.1 62585.5,-8291.1 62585.5,-8343.1"/>
<text text-anchor="middle" x="62451" y="-8331.1" font-family="Arial" font-size="10.00">Expert 28 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="62451" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 56,57</text>
<text text-anchor="middle" x="62451" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="62451" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert29_qkv -->
<g id="node177" class="node">
<title>stage0_expert29_qkv</title>
<polygon fill="lightgreen" stroke="black" points="62298,-8343.1 62012,-8343.1 62012,-8291.1 62298,-8291.1 62298,-8343.1"/>
<text text-anchor="middle" x="62155" y="-8331.1" font-family="Arial" font-size="10.00">Expert 29 QKV Proj (TP)</text>
<text text-anchor="middle" x="62155" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 58,59</text>
<text text-anchor="middle" x="62155" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="62155" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert29_attn -->
<g id="node178" class="node">
<title>stage0_expert29_attn</title>
<polygon fill="lightgreen" stroke="black" points="61994,-8343.1 61708,-8343.1 61708,-8291.1 61994,-8291.1 61994,-8343.1"/>
<text text-anchor="middle" x="61851" y="-8331.1" font-family="Arial" font-size="10.00">Expert 29 Attention (TP)</text>
<text text-anchor="middle" x="61851" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 58,59</text>
<text text-anchor="middle" x="61851" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="61851" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert29_attn_out -->
<g id="node179" class="node">
<title>stage0_expert29_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="61690,-8343.1 61412,-8343.1 61412,-8291.1 61690,-8291.1 61690,-8343.1"/>
<text text-anchor="middle" x="61551" y="-8331.1" font-family="Arial" font-size="10.00">Expert 29 Attn Output (TP)</text>
<text text-anchor="middle" x="61551" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 58,59</text>
<text text-anchor="middle" x="61551" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="61551" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert29_mlp1 -->
<g id="node180" class="node">
<title>stage0_expert29_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="61394,-8343.1 61118,-8343.1 61118,-8291.1 61394,-8291.1 61394,-8343.1"/>
<text text-anchor="middle" x="61256" y="-8331.1" font-family="Arial" font-size="10.00">Expert 29 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="61256" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 58,59</text>
<text text-anchor="middle" x="61256" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="61256" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert29_mlp_act -->
<g id="node181" class="node">
<title>stage0_expert29_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="61100,-8343.1 60824,-8343.1 60824,-8291.1 61100,-8291.1 61100,-8343.1"/>
<text text-anchor="middle" x="60962" y="-8331.1" font-family="Arial" font-size="10.00">Expert 29 MLP GELU (TP)</text>
<text text-anchor="middle" x="60962" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 58,59</text>
<text text-anchor="middle" x="60962" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="60962" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert29_mlp2 -->
<g id="node182" class="node">
<title>stage0_expert29_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="60805.5,-8343.1 60536.5,-8343.1 60536.5,-8291.1 60805.5,-8291.1 60805.5,-8343.1"/>
<text text-anchor="middle" x="60671" y="-8331.1" font-family="Arial" font-size="10.00">Expert 29 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="60671" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 58,59</text>
<text text-anchor="middle" x="60671" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="60671" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert30_qkv -->
<g id="node183" class="node">
<title>stage0_expert30_qkv</title>
<polygon fill="lightgreen" stroke="black" points="60518,-8343.1 60232,-8343.1 60232,-8291.1 60518,-8291.1 60518,-8343.1"/>
<text text-anchor="middle" x="60375" y="-8331.1" font-family="Arial" font-size="10.00">Expert 30 QKV Proj (TP)</text>
<text text-anchor="middle" x="60375" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 60,61</text>
<text text-anchor="middle" x="60375" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="60375" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert30_attn -->
<g id="node184" class="node">
<title>stage0_expert30_attn</title>
<polygon fill="lightgreen" stroke="black" points="60214,-8343.1 59928,-8343.1 59928,-8291.1 60214,-8291.1 60214,-8343.1"/>
<text text-anchor="middle" x="60071" y="-8331.1" font-family="Arial" font-size="10.00">Expert 30 Attention (TP)</text>
<text text-anchor="middle" x="60071" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 60,61</text>
<text text-anchor="middle" x="60071" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="60071" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert30_attn_out -->
<g id="node185" class="node">
<title>stage0_expert30_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="59910,-8343.1 59632,-8343.1 59632,-8291.1 59910,-8291.1 59910,-8343.1"/>
<text text-anchor="middle" x="59771" y="-8331.1" font-family="Arial" font-size="10.00">Expert 30 Attn Output (TP)</text>
<text text-anchor="middle" x="59771" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 60,61</text>
<text text-anchor="middle" x="59771" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="59771" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert30_mlp1 -->
<g id="node186" class="node">
<title>stage0_expert30_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="59614,-8343.1 59338,-8343.1 59338,-8291.1 59614,-8291.1 59614,-8343.1"/>
<text text-anchor="middle" x="59476" y="-8331.1" font-family="Arial" font-size="10.00">Expert 30 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="59476" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 60,61</text>
<text text-anchor="middle" x="59476" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="59476" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert30_mlp_act -->
<g id="node187" class="node">
<title>stage0_expert30_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="59320,-8343.1 59044,-8343.1 59044,-8291.1 59320,-8291.1 59320,-8343.1"/>
<text text-anchor="middle" x="59182" y="-8331.1" font-family="Arial" font-size="10.00">Expert 30 MLP GELU (TP)</text>
<text text-anchor="middle" x="59182" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 60,61</text>
<text text-anchor="middle" x="59182" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="59182" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert30_mlp2 -->
<g id="node188" class="node">
<title>stage0_expert30_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="59025.5,-8343.1 58756.5,-8343.1 58756.5,-8291.1 59025.5,-8291.1 59025.5,-8343.1"/>
<text text-anchor="middle" x="58891" y="-8331.1" font-family="Arial" font-size="10.00">Expert 30 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="58891" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 60,61</text>
<text text-anchor="middle" x="58891" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="58891" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert31_qkv -->
<g id="node189" class="node">
<title>stage0_expert31_qkv</title>
<polygon fill="lightgreen" stroke="black" points="58738,-8343.1 58452,-8343.1 58452,-8291.1 58738,-8291.1 58738,-8343.1"/>
<text text-anchor="middle" x="58595" y="-8331.1" font-family="Arial" font-size="10.00">Expert 31 QKV Proj (TP)</text>
<text text-anchor="middle" x="58595" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 62,63</text>
<text text-anchor="middle" x="58595" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="58595" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert31_attn -->
<g id="node190" class="node">
<title>stage0_expert31_attn</title>
<polygon fill="lightgreen" stroke="black" points="58434,-8343.1 58148,-8343.1 58148,-8291.1 58434,-8291.1 58434,-8343.1"/>
<text text-anchor="middle" x="58291" y="-8331.1" font-family="Arial" font-size="10.00">Expert 31 Attention (TP)</text>
<text text-anchor="middle" x="58291" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 62,63</text>
<text text-anchor="middle" x="58291" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="58291" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert31_attn_out -->
<g id="node191" class="node">
<title>stage0_expert31_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="58130,-8343.1 57852,-8343.1 57852,-8291.1 58130,-8291.1 58130,-8343.1"/>
<text text-anchor="middle" x="57991" y="-8331.1" font-family="Arial" font-size="10.00">Expert 31 Attn Output (TP)</text>
<text text-anchor="middle" x="57991" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 62,63</text>
<text text-anchor="middle" x="57991" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="57991" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert31_mlp1 -->
<g id="node192" class="node">
<title>stage0_expert31_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="57834,-8343.1 57558,-8343.1 57558,-8291.1 57834,-8291.1 57834,-8343.1"/>
<text text-anchor="middle" x="57696" y="-8331.1" font-family="Arial" font-size="10.00">Expert 31 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="57696" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 62,63</text>
<text text-anchor="middle" x="57696" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="57696" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert31_mlp_act -->
<g id="node193" class="node">
<title>stage0_expert31_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="57540,-8343.1 57264,-8343.1 57264,-8291.1 57540,-8291.1 57540,-8343.1"/>
<text text-anchor="middle" x="57402" y="-8331.1" font-family="Arial" font-size="10.00">Expert 31 MLP GELU (TP)</text>
<text text-anchor="middle" x="57402" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 62,63</text>
<text text-anchor="middle" x="57402" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="57402" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert31_mlp2 -->
<g id="node194" class="node">
<title>stage0_expert31_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="57245.5,-8343.1 56976.5,-8343.1 56976.5,-8291.1 57245.5,-8291.1 57245.5,-8343.1"/>
<text text-anchor="middle" x="57111" y="-8331.1" font-family="Arial" font-size="10.00">Expert 31 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="57111" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 62,63</text>
<text text-anchor="middle" x="57111" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="57111" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert32_qkv -->
<g id="node195" class="node">
<title>stage0_expert32_qkv</title>
<polygon fill="lightgreen" stroke="black" points="56958,-8343.1 56672,-8343.1 56672,-8291.1 56958,-8291.1 56958,-8343.1"/>
<text text-anchor="middle" x="56815" y="-8331.1" font-family="Arial" font-size="10.00">Expert 32 QKV Proj (TP)</text>
<text text-anchor="middle" x="56815" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 64,65</text>
<text text-anchor="middle" x="56815" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="56815" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert32_attn -->
<g id="node196" class="node">
<title>stage0_expert32_attn</title>
<polygon fill="lightgreen" stroke="black" points="56654,-8343.1 56368,-8343.1 56368,-8291.1 56654,-8291.1 56654,-8343.1"/>
<text text-anchor="middle" x="56511" y="-8331.1" font-family="Arial" font-size="10.00">Expert 32 Attention (TP)</text>
<text text-anchor="middle" x="56511" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 64,65</text>
<text text-anchor="middle" x="56511" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="56511" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert32_attn_out -->
<g id="node197" class="node">
<title>stage0_expert32_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="56350,-8343.1 56072,-8343.1 56072,-8291.1 56350,-8291.1 56350,-8343.1"/>
<text text-anchor="middle" x="56211" y="-8331.1" font-family="Arial" font-size="10.00">Expert 32 Attn Output (TP)</text>
<text text-anchor="middle" x="56211" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 64,65</text>
<text text-anchor="middle" x="56211" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="56211" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert32_mlp1 -->
<g id="node198" class="node">
<title>stage0_expert32_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="56054,-8343.1 55778,-8343.1 55778,-8291.1 56054,-8291.1 56054,-8343.1"/>
<text text-anchor="middle" x="55916" y="-8331.1" font-family="Arial" font-size="10.00">Expert 32 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="55916" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 64,65</text>
<text text-anchor="middle" x="55916" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="55916" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert32_mlp_act -->
<g id="node199" class="node">
<title>stage0_expert32_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="55760,-8343.1 55484,-8343.1 55484,-8291.1 55760,-8291.1 55760,-8343.1"/>
<text text-anchor="middle" x="55622" y="-8331.1" font-family="Arial" font-size="10.00">Expert 32 MLP GELU (TP)</text>
<text text-anchor="middle" x="55622" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 64,65</text>
<text text-anchor="middle" x="55622" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="55622" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert32_mlp2 -->
<g id="node200" class="node">
<title>stage0_expert32_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="55465.5,-8343.1 55196.5,-8343.1 55196.5,-8291.1 55465.5,-8291.1 55465.5,-8343.1"/>
<text text-anchor="middle" x="55331" y="-8331.1" font-family="Arial" font-size="10.00">Expert 32 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="55331" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 64,65</text>
<text text-anchor="middle" x="55331" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="55331" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert33_qkv -->
<g id="node201" class="node">
<title>stage0_expert33_qkv</title>
<polygon fill="lightgreen" stroke="black" points="55178,-8343.1 54892,-8343.1 54892,-8291.1 55178,-8291.1 55178,-8343.1"/>
<text text-anchor="middle" x="55035" y="-8331.1" font-family="Arial" font-size="10.00">Expert 33 QKV Proj (TP)</text>
<text text-anchor="middle" x="55035" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 66,67</text>
<text text-anchor="middle" x="55035" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="55035" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert33_attn -->
<g id="node202" class="node">
<title>stage0_expert33_attn</title>
<polygon fill="lightgreen" stroke="black" points="54874,-8343.1 54588,-8343.1 54588,-8291.1 54874,-8291.1 54874,-8343.1"/>
<text text-anchor="middle" x="54731" y="-8331.1" font-family="Arial" font-size="10.00">Expert 33 Attention (TP)</text>
<text text-anchor="middle" x="54731" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 66,67</text>
<text text-anchor="middle" x="54731" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="54731" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert33_attn_out -->
<g id="node203" class="node">
<title>stage0_expert33_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="54570,-8343.1 54292,-8343.1 54292,-8291.1 54570,-8291.1 54570,-8343.1"/>
<text text-anchor="middle" x="54431" y="-8331.1" font-family="Arial" font-size="10.00">Expert 33 Attn Output (TP)</text>
<text text-anchor="middle" x="54431" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 66,67</text>
<text text-anchor="middle" x="54431" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="54431" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert33_mlp1 -->
<g id="node204" class="node">
<title>stage0_expert33_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="54274,-8343.1 53998,-8343.1 53998,-8291.1 54274,-8291.1 54274,-8343.1"/>
<text text-anchor="middle" x="54136" y="-8331.1" font-family="Arial" font-size="10.00">Expert 33 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="54136" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 66,67</text>
<text text-anchor="middle" x="54136" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="54136" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert33_mlp_act -->
<g id="node205" class="node">
<title>stage0_expert33_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="53980,-8343.1 53704,-8343.1 53704,-8291.1 53980,-8291.1 53980,-8343.1"/>
<text text-anchor="middle" x="53842" y="-8331.1" font-family="Arial" font-size="10.00">Expert 33 MLP GELU (TP)</text>
<text text-anchor="middle" x="53842" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 66,67</text>
<text text-anchor="middle" x="53842" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="53842" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert33_mlp2 -->
<g id="node206" class="node">
<title>stage0_expert33_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="53685.5,-8343.1 53416.5,-8343.1 53416.5,-8291.1 53685.5,-8291.1 53685.5,-8343.1"/>
<text text-anchor="middle" x="53551" y="-8331.1" font-family="Arial" font-size="10.00">Expert 33 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="53551" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 66,67</text>
<text text-anchor="middle" x="53551" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="53551" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert34_qkv -->
<g id="node207" class="node">
<title>stage0_expert34_qkv</title>
<polygon fill="lightgreen" stroke="black" points="53398,-8343.1 53112,-8343.1 53112,-8291.1 53398,-8291.1 53398,-8343.1"/>
<text text-anchor="middle" x="53255" y="-8331.1" font-family="Arial" font-size="10.00">Expert 34 QKV Proj (TP)</text>
<text text-anchor="middle" x="53255" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 68,69</text>
<text text-anchor="middle" x="53255" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="53255" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert34_attn -->
<g id="node208" class="node">
<title>stage0_expert34_attn</title>
<polygon fill="lightgreen" stroke="black" points="53094,-8343.1 52808,-8343.1 52808,-8291.1 53094,-8291.1 53094,-8343.1"/>
<text text-anchor="middle" x="52951" y="-8331.1" font-family="Arial" font-size="10.00">Expert 34 Attention (TP)</text>
<text text-anchor="middle" x="52951" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 68,69</text>
<text text-anchor="middle" x="52951" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="52951" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert34_attn_out -->
<g id="node209" class="node">
<title>stage0_expert34_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="52790,-8343.1 52512,-8343.1 52512,-8291.1 52790,-8291.1 52790,-8343.1"/>
<text text-anchor="middle" x="52651" y="-8331.1" font-family="Arial" font-size="10.00">Expert 34 Attn Output (TP)</text>
<text text-anchor="middle" x="52651" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 68,69</text>
<text text-anchor="middle" x="52651" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="52651" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert34_mlp1 -->
<g id="node210" class="node">
<title>stage0_expert34_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="52494,-8343.1 52218,-8343.1 52218,-8291.1 52494,-8291.1 52494,-8343.1"/>
<text text-anchor="middle" x="52356" y="-8331.1" font-family="Arial" font-size="10.00">Expert 34 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="52356" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 68,69</text>
<text text-anchor="middle" x="52356" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="52356" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert34_mlp_act -->
<g id="node211" class="node">
<title>stage0_expert34_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="52200,-8343.1 51924,-8343.1 51924,-8291.1 52200,-8291.1 52200,-8343.1"/>
<text text-anchor="middle" x="52062" y="-8331.1" font-family="Arial" font-size="10.00">Expert 34 MLP GELU (TP)</text>
<text text-anchor="middle" x="52062" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 68,69</text>
<text text-anchor="middle" x="52062" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="52062" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert34_mlp2 -->
<g id="node212" class="node">
<title>stage0_expert34_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="51905.5,-8343.1 51636.5,-8343.1 51636.5,-8291.1 51905.5,-8291.1 51905.5,-8343.1"/>
<text text-anchor="middle" x="51771" y="-8331.1" font-family="Arial" font-size="10.00">Expert 34 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="51771" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 68,69</text>
<text text-anchor="middle" x="51771" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="51771" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert35_qkv -->
<g id="node213" class="node">
<title>stage0_expert35_qkv</title>
<polygon fill="lightgreen" stroke="black" points="51618,-8343.1 51332,-8343.1 51332,-8291.1 51618,-8291.1 51618,-8343.1"/>
<text text-anchor="middle" x="51475" y="-8331.1" font-family="Arial" font-size="10.00">Expert 35 QKV Proj (TP)</text>
<text text-anchor="middle" x="51475" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 70,71</text>
<text text-anchor="middle" x="51475" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="51475" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert35_attn -->
<g id="node214" class="node">
<title>stage0_expert35_attn</title>
<polygon fill="lightgreen" stroke="black" points="51314,-8343.1 51028,-8343.1 51028,-8291.1 51314,-8291.1 51314,-8343.1"/>
<text text-anchor="middle" x="51171" y="-8331.1" font-family="Arial" font-size="10.00">Expert 35 Attention (TP)</text>
<text text-anchor="middle" x="51171" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 70,71</text>
<text text-anchor="middle" x="51171" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="51171" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert35_attn_out -->
<g id="node215" class="node">
<title>stage0_expert35_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="51010,-8343.1 50732,-8343.1 50732,-8291.1 51010,-8291.1 51010,-8343.1"/>
<text text-anchor="middle" x="50871" y="-8331.1" font-family="Arial" font-size="10.00">Expert 35 Attn Output (TP)</text>
<text text-anchor="middle" x="50871" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 70,71</text>
<text text-anchor="middle" x="50871" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="50871" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert35_mlp1 -->
<g id="node216" class="node">
<title>stage0_expert35_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="50714,-8343.1 50438,-8343.1 50438,-8291.1 50714,-8291.1 50714,-8343.1"/>
<text text-anchor="middle" x="50576" y="-8331.1" font-family="Arial" font-size="10.00">Expert 35 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="50576" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 70,71</text>
<text text-anchor="middle" x="50576" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="50576" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert35_mlp_act -->
<g id="node217" class="node">
<title>stage0_expert35_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="50420,-8343.1 50144,-8343.1 50144,-8291.1 50420,-8291.1 50420,-8343.1"/>
<text text-anchor="middle" x="50282" y="-8331.1" font-family="Arial" font-size="10.00">Expert 35 MLP GELU (TP)</text>
<text text-anchor="middle" x="50282" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 70,71</text>
<text text-anchor="middle" x="50282" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="50282" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert35_mlp2 -->
<g id="node218" class="node">
<title>stage0_expert35_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="50125.5,-8343.1 49856.5,-8343.1 49856.5,-8291.1 50125.5,-8291.1 50125.5,-8343.1"/>
<text text-anchor="middle" x="49991" y="-8331.1" font-family="Arial" font-size="10.00">Expert 35 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="49991" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 70,71</text>
<text text-anchor="middle" x="49991" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="49991" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert36_qkv -->
<g id="node219" class="node">
<title>stage0_expert36_qkv</title>
<polygon fill="lightgreen" stroke="black" points="49838,-8343.1 49552,-8343.1 49552,-8291.1 49838,-8291.1 49838,-8343.1"/>
<text text-anchor="middle" x="49695" y="-8331.1" font-family="Arial" font-size="10.00">Expert 36 QKV Proj (TP)</text>
<text text-anchor="middle" x="49695" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 72,73</text>
<text text-anchor="middle" x="49695" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="49695" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert36_attn -->
<g id="node220" class="node">
<title>stage0_expert36_attn</title>
<polygon fill="lightgreen" stroke="black" points="49534,-8343.1 49248,-8343.1 49248,-8291.1 49534,-8291.1 49534,-8343.1"/>
<text text-anchor="middle" x="49391" y="-8331.1" font-family="Arial" font-size="10.00">Expert 36 Attention (TP)</text>
<text text-anchor="middle" x="49391" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 72,73</text>
<text text-anchor="middle" x="49391" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="49391" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert36_attn_out -->
<g id="node221" class="node">
<title>stage0_expert36_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="49230,-8343.1 48952,-8343.1 48952,-8291.1 49230,-8291.1 49230,-8343.1"/>
<text text-anchor="middle" x="49091" y="-8331.1" font-family="Arial" font-size="10.00">Expert 36 Attn Output (TP)</text>
<text text-anchor="middle" x="49091" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 72,73</text>
<text text-anchor="middle" x="49091" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="49091" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert36_mlp1 -->
<g id="node222" class="node">
<title>stage0_expert36_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="48934,-8343.1 48658,-8343.1 48658,-8291.1 48934,-8291.1 48934,-8343.1"/>
<text text-anchor="middle" x="48796" y="-8331.1" font-family="Arial" font-size="10.00">Expert 36 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="48796" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 72,73</text>
<text text-anchor="middle" x="48796" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="48796" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert36_mlp_act -->
<g id="node223" class="node">
<title>stage0_expert36_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="48640,-8343.1 48364,-8343.1 48364,-8291.1 48640,-8291.1 48640,-8343.1"/>
<text text-anchor="middle" x="48502" y="-8331.1" font-family="Arial" font-size="10.00">Expert 36 MLP GELU (TP)</text>
<text text-anchor="middle" x="48502" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 72,73</text>
<text text-anchor="middle" x="48502" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="48502" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert36_mlp2 -->
<g id="node224" class="node">
<title>stage0_expert36_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="48345.5,-8343.1 48076.5,-8343.1 48076.5,-8291.1 48345.5,-8291.1 48345.5,-8343.1"/>
<text text-anchor="middle" x="48211" y="-8331.1" font-family="Arial" font-size="10.00">Expert 36 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="48211" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 72,73</text>
<text text-anchor="middle" x="48211" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="48211" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert37_qkv -->
<g id="node225" class="node">
<title>stage0_expert37_qkv</title>
<polygon fill="lightgreen" stroke="black" points="48058,-8343.1 47772,-8343.1 47772,-8291.1 48058,-8291.1 48058,-8343.1"/>
<text text-anchor="middle" x="47915" y="-8331.1" font-family="Arial" font-size="10.00">Expert 37 QKV Proj (TP)</text>
<text text-anchor="middle" x="47915" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 74,75</text>
<text text-anchor="middle" x="47915" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="47915" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert37_attn -->
<g id="node226" class="node">
<title>stage0_expert37_attn</title>
<polygon fill="lightgreen" stroke="black" points="47754,-8343.1 47468,-8343.1 47468,-8291.1 47754,-8291.1 47754,-8343.1"/>
<text text-anchor="middle" x="47611" y="-8331.1" font-family="Arial" font-size="10.00">Expert 37 Attention (TP)</text>
<text text-anchor="middle" x="47611" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 74,75</text>
<text text-anchor="middle" x="47611" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="47611" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert37_attn_out -->
<g id="node227" class="node">
<title>stage0_expert37_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="47450,-8343.1 47172,-8343.1 47172,-8291.1 47450,-8291.1 47450,-8343.1"/>
<text text-anchor="middle" x="47311" y="-8331.1" font-family="Arial" font-size="10.00">Expert 37 Attn Output (TP)</text>
<text text-anchor="middle" x="47311" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 74,75</text>
<text text-anchor="middle" x="47311" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="47311" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert37_mlp1 -->
<g id="node228" class="node">
<title>stage0_expert37_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="47154,-8343.1 46878,-8343.1 46878,-8291.1 47154,-8291.1 47154,-8343.1"/>
<text text-anchor="middle" x="47016" y="-8331.1" font-family="Arial" font-size="10.00">Expert 37 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="47016" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 74,75</text>
<text text-anchor="middle" x="47016" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="47016" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert37_mlp_act -->
<g id="node229" class="node">
<title>stage0_expert37_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="46860,-8343.1 46584,-8343.1 46584,-8291.1 46860,-8291.1 46860,-8343.1"/>
<text text-anchor="middle" x="46722" y="-8331.1" font-family="Arial" font-size="10.00">Expert 37 MLP GELU (TP)</text>
<text text-anchor="middle" x="46722" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 74,75</text>
<text text-anchor="middle" x="46722" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="46722" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert37_mlp2 -->
<g id="node230" class="node">
<title>stage0_expert37_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="46565.5,-8343.1 46296.5,-8343.1 46296.5,-8291.1 46565.5,-8291.1 46565.5,-8343.1"/>
<text text-anchor="middle" x="46431" y="-8331.1" font-family="Arial" font-size="10.00">Expert 37 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="46431" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 74,75</text>
<text text-anchor="middle" x="46431" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="46431" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert38_qkv -->
<g id="node231" class="node">
<title>stage0_expert38_qkv</title>
<polygon fill="lightgreen" stroke="black" points="46278,-8343.1 45992,-8343.1 45992,-8291.1 46278,-8291.1 46278,-8343.1"/>
<text text-anchor="middle" x="46135" y="-8331.1" font-family="Arial" font-size="10.00">Expert 38 QKV Proj (TP)</text>
<text text-anchor="middle" x="46135" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 76,77</text>
<text text-anchor="middle" x="46135" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="46135" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert38_attn -->
<g id="node232" class="node">
<title>stage0_expert38_attn</title>
<polygon fill="lightgreen" stroke="black" points="45974,-8343.1 45688,-8343.1 45688,-8291.1 45974,-8291.1 45974,-8343.1"/>
<text text-anchor="middle" x="45831" y="-8331.1" font-family="Arial" font-size="10.00">Expert 38 Attention (TP)</text>
<text text-anchor="middle" x="45831" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 76,77</text>
<text text-anchor="middle" x="45831" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="45831" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert38_attn_out -->
<g id="node233" class="node">
<title>stage0_expert38_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="45670,-8343.1 45392,-8343.1 45392,-8291.1 45670,-8291.1 45670,-8343.1"/>
<text text-anchor="middle" x="45531" y="-8331.1" font-family="Arial" font-size="10.00">Expert 38 Attn Output (TP)</text>
<text text-anchor="middle" x="45531" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 76,77</text>
<text text-anchor="middle" x="45531" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="45531" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert38_mlp1 -->
<g id="node234" class="node">
<title>stage0_expert38_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="45374,-8343.1 45098,-8343.1 45098,-8291.1 45374,-8291.1 45374,-8343.1"/>
<text text-anchor="middle" x="45236" y="-8331.1" font-family="Arial" font-size="10.00">Expert 38 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="45236" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 76,77</text>
<text text-anchor="middle" x="45236" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="45236" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert38_mlp_act -->
<g id="node235" class="node">
<title>stage0_expert38_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="45080,-8343.1 44804,-8343.1 44804,-8291.1 45080,-8291.1 45080,-8343.1"/>
<text text-anchor="middle" x="44942" y="-8331.1" font-family="Arial" font-size="10.00">Expert 38 MLP GELU (TP)</text>
<text text-anchor="middle" x="44942" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 76,77</text>
<text text-anchor="middle" x="44942" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="44942" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert38_mlp2 -->
<g id="node236" class="node">
<title>stage0_expert38_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="44785.5,-8343.1 44516.5,-8343.1 44516.5,-8291.1 44785.5,-8291.1 44785.5,-8343.1"/>
<text text-anchor="middle" x="44651" y="-8331.1" font-family="Arial" font-size="10.00">Expert 38 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="44651" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 76,77</text>
<text text-anchor="middle" x="44651" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="44651" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert39_qkv -->
<g id="node237" class="node">
<title>stage0_expert39_qkv</title>
<polygon fill="lightgreen" stroke="black" points="44498,-8343.1 44212,-8343.1 44212,-8291.1 44498,-8291.1 44498,-8343.1"/>
<text text-anchor="middle" x="44355" y="-8331.1" font-family="Arial" font-size="10.00">Expert 39 QKV Proj (TP)</text>
<text text-anchor="middle" x="44355" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 78,79</text>
<text text-anchor="middle" x="44355" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="44355" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert39_attn -->
<g id="node238" class="node">
<title>stage0_expert39_attn</title>
<polygon fill="lightgreen" stroke="black" points="44194,-8343.1 43908,-8343.1 43908,-8291.1 44194,-8291.1 44194,-8343.1"/>
<text text-anchor="middle" x="44051" y="-8331.1" font-family="Arial" font-size="10.00">Expert 39 Attention (TP)</text>
<text text-anchor="middle" x="44051" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 78,79</text>
<text text-anchor="middle" x="44051" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="44051" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert39_attn_out -->
<g id="node239" class="node">
<title>stage0_expert39_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="43890,-8343.1 43612,-8343.1 43612,-8291.1 43890,-8291.1 43890,-8343.1"/>
<text text-anchor="middle" x="43751" y="-8331.1" font-family="Arial" font-size="10.00">Expert 39 Attn Output (TP)</text>
<text text-anchor="middle" x="43751" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 78,79</text>
<text text-anchor="middle" x="43751" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="43751" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert39_mlp1 -->
<g id="node240" class="node">
<title>stage0_expert39_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="43594,-8343.1 43318,-8343.1 43318,-8291.1 43594,-8291.1 43594,-8343.1"/>
<text text-anchor="middle" x="43456" y="-8331.1" font-family="Arial" font-size="10.00">Expert 39 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="43456" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 78,79</text>
<text text-anchor="middle" x="43456" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="43456" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert39_mlp_act -->
<g id="node241" class="node">
<title>stage0_expert39_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="43300,-8343.1 43024,-8343.1 43024,-8291.1 43300,-8291.1 43300,-8343.1"/>
<text text-anchor="middle" x="43162" y="-8331.1" font-family="Arial" font-size="10.00">Expert 39 MLP GELU (TP)</text>
<text text-anchor="middle" x="43162" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 78,79</text>
<text text-anchor="middle" x="43162" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="43162" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert39_mlp2 -->
<g id="node242" class="node">
<title>stage0_expert39_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="43005.5,-8343.1 42736.5,-8343.1 42736.5,-8291.1 43005.5,-8291.1 43005.5,-8343.1"/>
<text text-anchor="middle" x="42871" y="-8331.1" font-family="Arial" font-size="10.00">Expert 39 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="42871" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 78,79</text>
<text text-anchor="middle" x="42871" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="42871" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert40_qkv -->
<g id="node243" class="node">
<title>stage0_expert40_qkv</title>
<polygon fill="lightgreen" stroke="black" points="42718,-8343.1 42432,-8343.1 42432,-8291.1 42718,-8291.1 42718,-8343.1"/>
<text text-anchor="middle" x="42575" y="-8331.1" font-family="Arial" font-size="10.00">Expert 40 QKV Proj (TP)</text>
<text text-anchor="middle" x="42575" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 80,81</text>
<text text-anchor="middle" x="42575" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="42575" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert40_attn -->
<g id="node244" class="node">
<title>stage0_expert40_attn</title>
<polygon fill="lightgreen" stroke="black" points="42414,-8343.1 42128,-8343.1 42128,-8291.1 42414,-8291.1 42414,-8343.1"/>
<text text-anchor="middle" x="42271" y="-8331.1" font-family="Arial" font-size="10.00">Expert 40 Attention (TP)</text>
<text text-anchor="middle" x="42271" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 80,81</text>
<text text-anchor="middle" x="42271" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="42271" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert40_attn_out -->
<g id="node245" class="node">
<title>stage0_expert40_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="42110,-8343.1 41832,-8343.1 41832,-8291.1 42110,-8291.1 42110,-8343.1"/>
<text text-anchor="middle" x="41971" y="-8331.1" font-family="Arial" font-size="10.00">Expert 40 Attn Output (TP)</text>
<text text-anchor="middle" x="41971" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 80,81</text>
<text text-anchor="middle" x="41971" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="41971" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert40_mlp1 -->
<g id="node246" class="node">
<title>stage0_expert40_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="41814,-8343.1 41538,-8343.1 41538,-8291.1 41814,-8291.1 41814,-8343.1"/>
<text text-anchor="middle" x="41676" y="-8331.1" font-family="Arial" font-size="10.00">Expert 40 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="41676" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 80,81</text>
<text text-anchor="middle" x="41676" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="41676" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert40_mlp_act -->
<g id="node247" class="node">
<title>stage0_expert40_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="41520,-8343.1 41244,-8343.1 41244,-8291.1 41520,-8291.1 41520,-8343.1"/>
<text text-anchor="middle" x="41382" y="-8331.1" font-family="Arial" font-size="10.00">Expert 40 MLP GELU (TP)</text>
<text text-anchor="middle" x="41382" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 80,81</text>
<text text-anchor="middle" x="41382" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="41382" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert40_mlp2 -->
<g id="node248" class="node">
<title>stage0_expert40_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="41225.5,-8343.1 40956.5,-8343.1 40956.5,-8291.1 41225.5,-8291.1 41225.5,-8343.1"/>
<text text-anchor="middle" x="41091" y="-8331.1" font-family="Arial" font-size="10.00">Expert 40 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="41091" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 80,81</text>
<text text-anchor="middle" x="41091" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="41091" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert41_qkv -->
<g id="node249" class="node">
<title>stage0_expert41_qkv</title>
<polygon fill="lightgreen" stroke="black" points="40938,-8343.1 40652,-8343.1 40652,-8291.1 40938,-8291.1 40938,-8343.1"/>
<text text-anchor="middle" x="40795" y="-8331.1" font-family="Arial" font-size="10.00">Expert 41 QKV Proj (TP)</text>
<text text-anchor="middle" x="40795" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 82,83</text>
<text text-anchor="middle" x="40795" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="40795" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert41_attn -->
<g id="node250" class="node">
<title>stage0_expert41_attn</title>
<polygon fill="lightgreen" stroke="black" points="40634,-8343.1 40348,-8343.1 40348,-8291.1 40634,-8291.1 40634,-8343.1"/>
<text text-anchor="middle" x="40491" y="-8331.1" font-family="Arial" font-size="10.00">Expert 41 Attention (TP)</text>
<text text-anchor="middle" x="40491" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 82,83</text>
<text text-anchor="middle" x="40491" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="40491" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert41_attn_out -->
<g id="node251" class="node">
<title>stage0_expert41_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="40330,-8343.1 40052,-8343.1 40052,-8291.1 40330,-8291.1 40330,-8343.1"/>
<text text-anchor="middle" x="40191" y="-8331.1" font-family="Arial" font-size="10.00">Expert 41 Attn Output (TP)</text>
<text text-anchor="middle" x="40191" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 82,83</text>
<text text-anchor="middle" x="40191" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="40191" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert41_mlp1 -->
<g id="node252" class="node">
<title>stage0_expert41_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="40034,-8343.1 39758,-8343.1 39758,-8291.1 40034,-8291.1 40034,-8343.1"/>
<text text-anchor="middle" x="39896" y="-8331.1" font-family="Arial" font-size="10.00">Expert 41 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="39896" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 82,83</text>
<text text-anchor="middle" x="39896" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="39896" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert41_mlp_act -->
<g id="node253" class="node">
<title>stage0_expert41_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="39740,-8343.1 39464,-8343.1 39464,-8291.1 39740,-8291.1 39740,-8343.1"/>
<text text-anchor="middle" x="39602" y="-8331.1" font-family="Arial" font-size="10.00">Expert 41 MLP GELU (TP)</text>
<text text-anchor="middle" x="39602" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 82,83</text>
<text text-anchor="middle" x="39602" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="39602" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert41_mlp2 -->
<g id="node254" class="node">
<title>stage0_expert41_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="39445.5,-8343.1 39176.5,-8343.1 39176.5,-8291.1 39445.5,-8291.1 39445.5,-8343.1"/>
<text text-anchor="middle" x="39311" y="-8331.1" font-family="Arial" font-size="10.00">Expert 41 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="39311" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 82,83</text>
<text text-anchor="middle" x="39311" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="39311" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert42_qkv -->
<g id="node255" class="node">
<title>stage0_expert42_qkv</title>
<polygon fill="lightgreen" stroke="black" points="39158,-8343.1 38872,-8343.1 38872,-8291.1 39158,-8291.1 39158,-8343.1"/>
<text text-anchor="middle" x="39015" y="-8331.1" font-family="Arial" font-size="10.00">Expert 42 QKV Proj (TP)</text>
<text text-anchor="middle" x="39015" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 84,85</text>
<text text-anchor="middle" x="39015" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="39015" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert42_attn -->
<g id="node256" class="node">
<title>stage0_expert42_attn</title>
<polygon fill="lightgreen" stroke="black" points="38854,-8343.1 38568,-8343.1 38568,-8291.1 38854,-8291.1 38854,-8343.1"/>
<text text-anchor="middle" x="38711" y="-8331.1" font-family="Arial" font-size="10.00">Expert 42 Attention (TP)</text>
<text text-anchor="middle" x="38711" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 84,85</text>
<text text-anchor="middle" x="38711" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="38711" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert42_attn_out -->
<g id="node257" class="node">
<title>stage0_expert42_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="38550,-8343.1 38272,-8343.1 38272,-8291.1 38550,-8291.1 38550,-8343.1"/>
<text text-anchor="middle" x="38411" y="-8331.1" font-family="Arial" font-size="10.00">Expert 42 Attn Output (TP)</text>
<text text-anchor="middle" x="38411" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 84,85</text>
<text text-anchor="middle" x="38411" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="38411" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert42_mlp1 -->
<g id="node258" class="node">
<title>stage0_expert42_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="38254,-8343.1 37978,-8343.1 37978,-8291.1 38254,-8291.1 38254,-8343.1"/>
<text text-anchor="middle" x="38116" y="-8331.1" font-family="Arial" font-size="10.00">Expert 42 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="38116" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 84,85</text>
<text text-anchor="middle" x="38116" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="38116" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert42_mlp_act -->
<g id="node259" class="node">
<title>stage0_expert42_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="37960,-8343.1 37684,-8343.1 37684,-8291.1 37960,-8291.1 37960,-8343.1"/>
<text text-anchor="middle" x="37822" y="-8331.1" font-family="Arial" font-size="10.00">Expert 42 MLP GELU (TP)</text>
<text text-anchor="middle" x="37822" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 84,85</text>
<text text-anchor="middle" x="37822" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="37822" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert42_mlp2 -->
<g id="node260" class="node">
<title>stage0_expert42_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="37665.5,-8343.1 37396.5,-8343.1 37396.5,-8291.1 37665.5,-8291.1 37665.5,-8343.1"/>
<text text-anchor="middle" x="37531" y="-8331.1" font-family="Arial" font-size="10.00">Expert 42 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="37531" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 84,85</text>
<text text-anchor="middle" x="37531" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="37531" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert43_qkv -->
<g id="node261" class="node">
<title>stage0_expert43_qkv</title>
<polygon fill="lightgreen" stroke="black" points="37378,-8343.1 37092,-8343.1 37092,-8291.1 37378,-8291.1 37378,-8343.1"/>
<text text-anchor="middle" x="37235" y="-8331.1" font-family="Arial" font-size="10.00">Expert 43 QKV Proj (TP)</text>
<text text-anchor="middle" x="37235" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 86,87</text>
<text text-anchor="middle" x="37235" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="37235" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert43_attn -->
<g id="node262" class="node">
<title>stage0_expert43_attn</title>
<polygon fill="lightgreen" stroke="black" points="37074,-8343.1 36788,-8343.1 36788,-8291.1 37074,-8291.1 37074,-8343.1"/>
<text text-anchor="middle" x="36931" y="-8331.1" font-family="Arial" font-size="10.00">Expert 43 Attention (TP)</text>
<text text-anchor="middle" x="36931" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 86,87</text>
<text text-anchor="middle" x="36931" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="36931" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert43_attn_out -->
<g id="node263" class="node">
<title>stage0_expert43_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="36770,-8343.1 36492,-8343.1 36492,-8291.1 36770,-8291.1 36770,-8343.1"/>
<text text-anchor="middle" x="36631" y="-8331.1" font-family="Arial" font-size="10.00">Expert 43 Attn Output (TP)</text>
<text text-anchor="middle" x="36631" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 86,87</text>
<text text-anchor="middle" x="36631" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="36631" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert43_mlp1 -->
<g id="node264" class="node">
<title>stage0_expert43_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="36474,-8343.1 36198,-8343.1 36198,-8291.1 36474,-8291.1 36474,-8343.1"/>
<text text-anchor="middle" x="36336" y="-8331.1" font-family="Arial" font-size="10.00">Expert 43 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="36336" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 86,87</text>
<text text-anchor="middle" x="36336" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="36336" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert43_mlp_act -->
<g id="node265" class="node">
<title>stage0_expert43_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="36180,-8343.1 35904,-8343.1 35904,-8291.1 36180,-8291.1 36180,-8343.1"/>
<text text-anchor="middle" x="36042" y="-8331.1" font-family="Arial" font-size="10.00">Expert 43 MLP GELU (TP)</text>
<text text-anchor="middle" x="36042" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 86,87</text>
<text text-anchor="middle" x="36042" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="36042" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert43_mlp2 -->
<g id="node266" class="node">
<title>stage0_expert43_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="35885.5,-8343.1 35616.5,-8343.1 35616.5,-8291.1 35885.5,-8291.1 35885.5,-8343.1"/>
<text text-anchor="middle" x="35751" y="-8331.1" font-family="Arial" font-size="10.00">Expert 43 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="35751" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 86,87</text>
<text text-anchor="middle" x="35751" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="35751" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert44_qkv -->
<g id="node267" class="node">
<title>stage0_expert44_qkv</title>
<polygon fill="lightgreen" stroke="black" points="35598,-8343.1 35312,-8343.1 35312,-8291.1 35598,-8291.1 35598,-8343.1"/>
<text text-anchor="middle" x="35455" y="-8331.1" font-family="Arial" font-size="10.00">Expert 44 QKV Proj (TP)</text>
<text text-anchor="middle" x="35455" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 88,89</text>
<text text-anchor="middle" x="35455" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="35455" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert44_attn -->
<g id="node268" class="node">
<title>stage0_expert44_attn</title>
<polygon fill="lightgreen" stroke="black" points="35294,-8343.1 35008,-8343.1 35008,-8291.1 35294,-8291.1 35294,-8343.1"/>
<text text-anchor="middle" x="35151" y="-8331.1" font-family="Arial" font-size="10.00">Expert 44 Attention (TP)</text>
<text text-anchor="middle" x="35151" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 88,89</text>
<text text-anchor="middle" x="35151" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="35151" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert44_attn_out -->
<g id="node269" class="node">
<title>stage0_expert44_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="34990,-8343.1 34712,-8343.1 34712,-8291.1 34990,-8291.1 34990,-8343.1"/>
<text text-anchor="middle" x="34851" y="-8331.1" font-family="Arial" font-size="10.00">Expert 44 Attn Output (TP)</text>
<text text-anchor="middle" x="34851" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 88,89</text>
<text text-anchor="middle" x="34851" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="34851" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert44_mlp1 -->
<g id="node270" class="node">
<title>stage0_expert44_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="34694,-8343.1 34418,-8343.1 34418,-8291.1 34694,-8291.1 34694,-8343.1"/>
<text text-anchor="middle" x="34556" y="-8331.1" font-family="Arial" font-size="10.00">Expert 44 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="34556" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 88,89</text>
<text text-anchor="middle" x="34556" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="34556" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert44_mlp_act -->
<g id="node271" class="node">
<title>stage0_expert44_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="34400,-8343.1 34124,-8343.1 34124,-8291.1 34400,-8291.1 34400,-8343.1"/>
<text text-anchor="middle" x="34262" y="-8331.1" font-family="Arial" font-size="10.00">Expert 44 MLP GELU (TP)</text>
<text text-anchor="middle" x="34262" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 88,89</text>
<text text-anchor="middle" x="34262" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="34262" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert44_mlp2 -->
<g id="node272" class="node">
<title>stage0_expert44_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="34105.5,-8343.1 33836.5,-8343.1 33836.5,-8291.1 34105.5,-8291.1 34105.5,-8343.1"/>
<text text-anchor="middle" x="33971" y="-8331.1" font-family="Arial" font-size="10.00">Expert 44 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="33971" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 88,89</text>
<text text-anchor="middle" x="33971" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="33971" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert45_qkv -->
<g id="node273" class="node">
<title>stage0_expert45_qkv</title>
<polygon fill="lightgreen" stroke="black" points="33818,-8343.1 33532,-8343.1 33532,-8291.1 33818,-8291.1 33818,-8343.1"/>
<text text-anchor="middle" x="33675" y="-8331.1" font-family="Arial" font-size="10.00">Expert 45 QKV Proj (TP)</text>
<text text-anchor="middle" x="33675" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 90,91</text>
<text text-anchor="middle" x="33675" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="33675" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert45_attn -->
<g id="node274" class="node">
<title>stage0_expert45_attn</title>
<polygon fill="lightgreen" stroke="black" points="33514,-8343.1 33228,-8343.1 33228,-8291.1 33514,-8291.1 33514,-8343.1"/>
<text text-anchor="middle" x="33371" y="-8331.1" font-family="Arial" font-size="10.00">Expert 45 Attention (TP)</text>
<text text-anchor="middle" x="33371" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 90,91</text>
<text text-anchor="middle" x="33371" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="33371" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert45_attn_out -->
<g id="node275" class="node">
<title>stage0_expert45_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="33210,-8343.1 32932,-8343.1 32932,-8291.1 33210,-8291.1 33210,-8343.1"/>
<text text-anchor="middle" x="33071" y="-8331.1" font-family="Arial" font-size="10.00">Expert 45 Attn Output (TP)</text>
<text text-anchor="middle" x="33071" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 90,91</text>
<text text-anchor="middle" x="33071" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="33071" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert45_mlp1 -->
<g id="node276" class="node">
<title>stage0_expert45_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="32914,-8343.1 32638,-8343.1 32638,-8291.1 32914,-8291.1 32914,-8343.1"/>
<text text-anchor="middle" x="32776" y="-8331.1" font-family="Arial" font-size="10.00">Expert 45 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="32776" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 90,91</text>
<text text-anchor="middle" x="32776" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="32776" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert45_mlp_act -->
<g id="node277" class="node">
<title>stage0_expert45_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="32620,-8343.1 32344,-8343.1 32344,-8291.1 32620,-8291.1 32620,-8343.1"/>
<text text-anchor="middle" x="32482" y="-8331.1" font-family="Arial" font-size="10.00">Expert 45 MLP GELU (TP)</text>
<text text-anchor="middle" x="32482" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 90,91</text>
<text text-anchor="middle" x="32482" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="32482" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert45_mlp2 -->
<g id="node278" class="node">
<title>stage0_expert45_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="32325.5,-8343.1 32056.5,-8343.1 32056.5,-8291.1 32325.5,-8291.1 32325.5,-8343.1"/>
<text text-anchor="middle" x="32191" y="-8331.1" font-family="Arial" font-size="10.00">Expert 45 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="32191" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 90,91</text>
<text text-anchor="middle" x="32191" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="32191" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert46_qkv -->
<g id="node279" class="node">
<title>stage0_expert46_qkv</title>
<polygon fill="lightgreen" stroke="black" points="32038,-8343.1 31752,-8343.1 31752,-8291.1 32038,-8291.1 32038,-8343.1"/>
<text text-anchor="middle" x="31895" y="-8331.1" font-family="Arial" font-size="10.00">Expert 46 QKV Proj (TP)</text>
<text text-anchor="middle" x="31895" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 92,93</text>
<text text-anchor="middle" x="31895" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="31895" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert46_attn -->
<g id="node280" class="node">
<title>stage0_expert46_attn</title>
<polygon fill="lightgreen" stroke="black" points="31734,-8343.1 31448,-8343.1 31448,-8291.1 31734,-8291.1 31734,-8343.1"/>
<text text-anchor="middle" x="31591" y="-8331.1" font-family="Arial" font-size="10.00">Expert 46 Attention (TP)</text>
<text text-anchor="middle" x="31591" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 92,93</text>
<text text-anchor="middle" x="31591" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="31591" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert46_attn_out -->
<g id="node281" class="node">
<title>stage0_expert46_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="31430,-8343.1 31152,-8343.1 31152,-8291.1 31430,-8291.1 31430,-8343.1"/>
<text text-anchor="middle" x="31291" y="-8331.1" font-family="Arial" font-size="10.00">Expert 46 Attn Output (TP)</text>
<text text-anchor="middle" x="31291" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 92,93</text>
<text text-anchor="middle" x="31291" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="31291" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert46_mlp1 -->
<g id="node282" class="node">
<title>stage0_expert46_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="31134,-8343.1 30858,-8343.1 30858,-8291.1 31134,-8291.1 31134,-8343.1"/>
<text text-anchor="middle" x="30996" y="-8331.1" font-family="Arial" font-size="10.00">Expert 46 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="30996" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 92,93</text>
<text text-anchor="middle" x="30996" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="30996" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert46_mlp_act -->
<g id="node283" class="node">
<title>stage0_expert46_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="30840,-8343.1 30564,-8343.1 30564,-8291.1 30840,-8291.1 30840,-8343.1"/>
<text text-anchor="middle" x="30702" y="-8331.1" font-family="Arial" font-size="10.00">Expert 46 MLP GELU (TP)</text>
<text text-anchor="middle" x="30702" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 92,93</text>
<text text-anchor="middle" x="30702" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="30702" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert46_mlp2 -->
<g id="node284" class="node">
<title>stage0_expert46_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="30545.5,-8343.1 30276.5,-8343.1 30276.5,-8291.1 30545.5,-8291.1 30545.5,-8343.1"/>
<text text-anchor="middle" x="30411" y="-8331.1" font-family="Arial" font-size="10.00">Expert 46 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="30411" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 92,93</text>
<text text-anchor="middle" x="30411" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="30411" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert47_qkv -->
<g id="node285" class="node">
<title>stage0_expert47_qkv</title>
<polygon fill="lightgreen" stroke="black" points="30258,-8343.1 29972,-8343.1 29972,-8291.1 30258,-8291.1 30258,-8343.1"/>
<text text-anchor="middle" x="30115" y="-8331.1" font-family="Arial" font-size="10.00">Expert 47 QKV Proj (TP)</text>
<text text-anchor="middle" x="30115" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 94,95</text>
<text text-anchor="middle" x="30115" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="30115" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert47_attn -->
<g id="node286" class="node">
<title>stage0_expert47_attn</title>
<polygon fill="lightgreen" stroke="black" points="29954,-8343.1 29668,-8343.1 29668,-8291.1 29954,-8291.1 29954,-8343.1"/>
<text text-anchor="middle" x="29811" y="-8331.1" font-family="Arial" font-size="10.00">Expert 47 Attention (TP)</text>
<text text-anchor="middle" x="29811" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 94,95</text>
<text text-anchor="middle" x="29811" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="29811" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert47_attn_out -->
<g id="node287" class="node">
<title>stage0_expert47_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="29650,-8343.1 29372,-8343.1 29372,-8291.1 29650,-8291.1 29650,-8343.1"/>
<text text-anchor="middle" x="29511" y="-8331.1" font-family="Arial" font-size="10.00">Expert 47 Attn Output (TP)</text>
<text text-anchor="middle" x="29511" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 94,95</text>
<text text-anchor="middle" x="29511" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="29511" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert47_mlp1 -->
<g id="node288" class="node">
<title>stage0_expert47_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="29354,-8343.1 29078,-8343.1 29078,-8291.1 29354,-8291.1 29354,-8343.1"/>
<text text-anchor="middle" x="29216" y="-8331.1" font-family="Arial" font-size="10.00">Expert 47 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="29216" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 94,95</text>
<text text-anchor="middle" x="29216" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="29216" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert47_mlp_act -->
<g id="node289" class="node">
<title>stage0_expert47_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="29060,-8343.1 28784,-8343.1 28784,-8291.1 29060,-8291.1 29060,-8343.1"/>
<text text-anchor="middle" x="28922" y="-8331.1" font-family="Arial" font-size="10.00">Expert 47 MLP GELU (TP)</text>
<text text-anchor="middle" x="28922" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 94,95</text>
<text text-anchor="middle" x="28922" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="28922" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert47_mlp2 -->
<g id="node290" class="node">
<title>stage0_expert47_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="28765.5,-8343.1 28496.5,-8343.1 28496.5,-8291.1 28765.5,-8291.1 28765.5,-8343.1"/>
<text text-anchor="middle" x="28631" y="-8331.1" font-family="Arial" font-size="10.00">Expert 47 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="28631" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 94,95</text>
<text text-anchor="middle" x="28631" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="28631" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert48_qkv -->
<g id="node291" class="node">
<title>stage0_expert48_qkv</title>
<polygon fill="lightgreen" stroke="black" points="28478,-8343.1 28192,-8343.1 28192,-8291.1 28478,-8291.1 28478,-8343.1"/>
<text text-anchor="middle" x="28335" y="-8331.1" font-family="Arial" font-size="10.00">Expert 48 QKV Proj (TP)</text>
<text text-anchor="middle" x="28335" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 96,97</text>
<text text-anchor="middle" x="28335" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="28335" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert48_attn -->
<g id="node292" class="node">
<title>stage0_expert48_attn</title>
<polygon fill="lightgreen" stroke="black" points="28174,-8343.1 27888,-8343.1 27888,-8291.1 28174,-8291.1 28174,-8343.1"/>
<text text-anchor="middle" x="28031" y="-8331.1" font-family="Arial" font-size="10.00">Expert 48 Attention (TP)</text>
<text text-anchor="middle" x="28031" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 96,97</text>
<text text-anchor="middle" x="28031" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="28031" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert48_attn_out -->
<g id="node293" class="node">
<title>stage0_expert48_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="27870,-8343.1 27592,-8343.1 27592,-8291.1 27870,-8291.1 27870,-8343.1"/>
<text text-anchor="middle" x="27731" y="-8331.1" font-family="Arial" font-size="10.00">Expert 48 Attn Output (TP)</text>
<text text-anchor="middle" x="27731" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 96,97</text>
<text text-anchor="middle" x="27731" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="27731" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert48_mlp1 -->
<g id="node294" class="node">
<title>stage0_expert48_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="27574,-8343.1 27298,-8343.1 27298,-8291.1 27574,-8291.1 27574,-8343.1"/>
<text text-anchor="middle" x="27436" y="-8331.1" font-family="Arial" font-size="10.00">Expert 48 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="27436" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 96,97</text>
<text text-anchor="middle" x="27436" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="27436" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert48_mlp_act -->
<g id="node295" class="node">
<title>stage0_expert48_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="27280,-8343.1 27004,-8343.1 27004,-8291.1 27280,-8291.1 27280,-8343.1"/>
<text text-anchor="middle" x="27142" y="-8331.1" font-family="Arial" font-size="10.00">Expert 48 MLP GELU (TP)</text>
<text text-anchor="middle" x="27142" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 96,97</text>
<text text-anchor="middle" x="27142" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="27142" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert48_mlp2 -->
<g id="node296" class="node">
<title>stage0_expert48_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="26985.5,-8343.1 26716.5,-8343.1 26716.5,-8291.1 26985.5,-8291.1 26985.5,-8343.1"/>
<text text-anchor="middle" x="26851" y="-8331.1" font-family="Arial" font-size="10.00">Expert 48 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="26851" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 96,97</text>
<text text-anchor="middle" x="26851" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="26851" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert49_qkv -->
<g id="node297" class="node">
<title>stage0_expert49_qkv</title>
<polygon fill="lightgreen" stroke="black" points="26698,-8343.1 26412,-8343.1 26412,-8291.1 26698,-8291.1 26698,-8343.1"/>
<text text-anchor="middle" x="26555" y="-8331.1" font-family="Arial" font-size="10.00">Expert 49 QKV Proj (TP)</text>
<text text-anchor="middle" x="26555" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 98,99</text>
<text text-anchor="middle" x="26555" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="26555" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert49_attn -->
<g id="node298" class="node">
<title>stage0_expert49_attn</title>
<polygon fill="lightgreen" stroke="black" points="26394,-8343.1 26108,-8343.1 26108,-8291.1 26394,-8291.1 26394,-8343.1"/>
<text text-anchor="middle" x="26251" y="-8331.1" font-family="Arial" font-size="10.00">Expert 49 Attention (TP)</text>
<text text-anchor="middle" x="26251" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 98,99</text>
<text text-anchor="middle" x="26251" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="26251" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert49_attn_out -->
<g id="node299" class="node">
<title>stage0_expert49_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="26090,-8343.1 25812,-8343.1 25812,-8291.1 26090,-8291.1 26090,-8343.1"/>
<text text-anchor="middle" x="25951" y="-8331.1" font-family="Arial" font-size="10.00">Expert 49 Attn Output (TP)</text>
<text text-anchor="middle" x="25951" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 98,99</text>
<text text-anchor="middle" x="25951" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="25951" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert49_mlp1 -->
<g id="node300" class="node">
<title>stage0_expert49_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="25794,-8343.1 25518,-8343.1 25518,-8291.1 25794,-8291.1 25794,-8343.1"/>
<text text-anchor="middle" x="25656" y="-8331.1" font-family="Arial" font-size="10.00">Expert 49 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="25656" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 98,99</text>
<text text-anchor="middle" x="25656" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="25656" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert49_mlp_act -->
<g id="node301" class="node">
<title>stage0_expert49_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="25500,-8343.1 25224,-8343.1 25224,-8291.1 25500,-8291.1 25500,-8343.1"/>
<text text-anchor="middle" x="25362" y="-8331.1" font-family="Arial" font-size="10.00">Expert 49 MLP GELU (TP)</text>
<text text-anchor="middle" x="25362" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 98,99</text>
<text text-anchor="middle" x="25362" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="25362" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert49_mlp2 -->
<g id="node302" class="node">
<title>stage0_expert49_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="25205.5,-8343.1 24936.5,-8343.1 24936.5,-8291.1 25205.5,-8291.1 25205.5,-8343.1"/>
<text text-anchor="middle" x="25071" y="-8331.1" font-family="Arial" font-size="10.00">Expert 49 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="25071" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 98,99</text>
<text text-anchor="middle" x="25071" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="25071" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert50_qkv -->
<g id="node303" class="node">
<title>stage0_expert50_qkv</title>
<polygon fill="lightgreen" stroke="black" points="24918,-8343.1 24632,-8343.1 24632,-8291.1 24918,-8291.1 24918,-8343.1"/>
<text text-anchor="middle" x="24775" y="-8331.1" font-family="Arial" font-size="10.00">Expert 50 QKV Proj (TP)</text>
<text text-anchor="middle" x="24775" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 100,101</text>
<text text-anchor="middle" x="24775" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="24775" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert50_attn -->
<g id="node304" class="node">
<title>stage0_expert50_attn</title>
<polygon fill="lightgreen" stroke="black" points="24614,-8343.1 24328,-8343.1 24328,-8291.1 24614,-8291.1 24614,-8343.1"/>
<text text-anchor="middle" x="24471" y="-8331.1" font-family="Arial" font-size="10.00">Expert 50 Attention (TP)</text>
<text text-anchor="middle" x="24471" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 100,101</text>
<text text-anchor="middle" x="24471" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="24471" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert50_attn_out -->
<g id="node305" class="node">
<title>stage0_expert50_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="24310,-8343.1 24032,-8343.1 24032,-8291.1 24310,-8291.1 24310,-8343.1"/>
<text text-anchor="middle" x="24171" y="-8331.1" font-family="Arial" font-size="10.00">Expert 50 Attn Output (TP)</text>
<text text-anchor="middle" x="24171" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 100,101</text>
<text text-anchor="middle" x="24171" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="24171" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert50_mlp1 -->
<g id="node306" class="node">
<title>stage0_expert50_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="24014,-8343.1 23738,-8343.1 23738,-8291.1 24014,-8291.1 24014,-8343.1"/>
<text text-anchor="middle" x="23876" y="-8331.1" font-family="Arial" font-size="10.00">Expert 50 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="23876" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 100,101</text>
<text text-anchor="middle" x="23876" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="23876" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert50_mlp_act -->
<g id="node307" class="node">
<title>stage0_expert50_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="23720,-8343.1 23444,-8343.1 23444,-8291.1 23720,-8291.1 23720,-8343.1"/>
<text text-anchor="middle" x="23582" y="-8331.1" font-family="Arial" font-size="10.00">Expert 50 MLP GELU (TP)</text>
<text text-anchor="middle" x="23582" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 100,101</text>
<text text-anchor="middle" x="23582" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="23582" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert50_mlp2 -->
<g id="node308" class="node">
<title>stage0_expert50_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="23425.5,-8343.1 23156.5,-8343.1 23156.5,-8291.1 23425.5,-8291.1 23425.5,-8343.1"/>
<text text-anchor="middle" x="23291" y="-8331.1" font-family="Arial" font-size="10.00">Expert 50 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="23291" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 100,101</text>
<text text-anchor="middle" x="23291" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="23291" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert51_qkv -->
<g id="node309" class="node">
<title>stage0_expert51_qkv</title>
<polygon fill="lightgreen" stroke="black" points="23138,-8343.1 22852,-8343.1 22852,-8291.1 23138,-8291.1 23138,-8343.1"/>
<text text-anchor="middle" x="22995" y="-8331.1" font-family="Arial" font-size="10.00">Expert 51 QKV Proj (TP)</text>
<text text-anchor="middle" x="22995" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 102,103</text>
<text text-anchor="middle" x="22995" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="22995" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert51_attn -->
<g id="node310" class="node">
<title>stage0_expert51_attn</title>
<polygon fill="lightgreen" stroke="black" points="22834,-8343.1 22548,-8343.1 22548,-8291.1 22834,-8291.1 22834,-8343.1"/>
<text text-anchor="middle" x="22691" y="-8331.1" font-family="Arial" font-size="10.00">Expert 51 Attention (TP)</text>
<text text-anchor="middle" x="22691" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 102,103</text>
<text text-anchor="middle" x="22691" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="22691" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert51_attn_out -->
<g id="node311" class="node">
<title>stage0_expert51_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="22530,-8343.1 22252,-8343.1 22252,-8291.1 22530,-8291.1 22530,-8343.1"/>
<text text-anchor="middle" x="22391" y="-8331.1" font-family="Arial" font-size="10.00">Expert 51 Attn Output (TP)</text>
<text text-anchor="middle" x="22391" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 102,103</text>
<text text-anchor="middle" x="22391" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="22391" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert51_mlp1 -->
<g id="node312" class="node">
<title>stage0_expert51_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="22234,-8343.1 21958,-8343.1 21958,-8291.1 22234,-8291.1 22234,-8343.1"/>
<text text-anchor="middle" x="22096" y="-8331.1" font-family="Arial" font-size="10.00">Expert 51 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="22096" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 102,103</text>
<text text-anchor="middle" x="22096" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="22096" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert51_mlp_act -->
<g id="node313" class="node">
<title>stage0_expert51_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="21940,-8343.1 21664,-8343.1 21664,-8291.1 21940,-8291.1 21940,-8343.1"/>
<text text-anchor="middle" x="21802" y="-8331.1" font-family="Arial" font-size="10.00">Expert 51 MLP GELU (TP)</text>
<text text-anchor="middle" x="21802" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 102,103</text>
<text text-anchor="middle" x="21802" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="21802" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert51_mlp2 -->
<g id="node314" class="node">
<title>stage0_expert51_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="21645.5,-8343.1 21376.5,-8343.1 21376.5,-8291.1 21645.5,-8291.1 21645.5,-8343.1"/>
<text text-anchor="middle" x="21511" y="-8331.1" font-family="Arial" font-size="10.00">Expert 51 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="21511" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 102,103</text>
<text text-anchor="middle" x="21511" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="21511" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert52_qkv -->
<g id="node315" class="node">
<title>stage0_expert52_qkv</title>
<polygon fill="lightgreen" stroke="black" points="21358,-8343.1 21072,-8343.1 21072,-8291.1 21358,-8291.1 21358,-8343.1"/>
<text text-anchor="middle" x="21215" y="-8331.1" font-family="Arial" font-size="10.00">Expert 52 QKV Proj (TP)</text>
<text text-anchor="middle" x="21215" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 104,105</text>
<text text-anchor="middle" x="21215" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="21215" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert52_attn -->
<g id="node316" class="node">
<title>stage0_expert52_attn</title>
<polygon fill="lightgreen" stroke="black" points="21054,-8343.1 20768,-8343.1 20768,-8291.1 21054,-8291.1 21054,-8343.1"/>
<text text-anchor="middle" x="20911" y="-8331.1" font-family="Arial" font-size="10.00">Expert 52 Attention (TP)</text>
<text text-anchor="middle" x="20911" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 104,105</text>
<text text-anchor="middle" x="20911" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="20911" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert52_attn_out -->
<g id="node317" class="node">
<title>stage0_expert52_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="20750,-8343.1 20472,-8343.1 20472,-8291.1 20750,-8291.1 20750,-8343.1"/>
<text text-anchor="middle" x="20611" y="-8331.1" font-family="Arial" font-size="10.00">Expert 52 Attn Output (TP)</text>
<text text-anchor="middle" x="20611" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 104,105</text>
<text text-anchor="middle" x="20611" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="20611" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert52_mlp1 -->
<g id="node318" class="node">
<title>stage0_expert52_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="20454,-8343.1 20178,-8343.1 20178,-8291.1 20454,-8291.1 20454,-8343.1"/>
<text text-anchor="middle" x="20316" y="-8331.1" font-family="Arial" font-size="10.00">Expert 52 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="20316" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 104,105</text>
<text text-anchor="middle" x="20316" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="20316" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert52_mlp_act -->
<g id="node319" class="node">
<title>stage0_expert52_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="20160,-8343.1 19884,-8343.1 19884,-8291.1 20160,-8291.1 20160,-8343.1"/>
<text text-anchor="middle" x="20022" y="-8331.1" font-family="Arial" font-size="10.00">Expert 52 MLP GELU (TP)</text>
<text text-anchor="middle" x="20022" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 104,105</text>
<text text-anchor="middle" x="20022" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="20022" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert52_mlp2 -->
<g id="node320" class="node">
<title>stage0_expert52_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="19865.5,-8343.1 19596.5,-8343.1 19596.5,-8291.1 19865.5,-8291.1 19865.5,-8343.1"/>
<text text-anchor="middle" x="19731" y="-8331.1" font-family="Arial" font-size="10.00">Expert 52 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="19731" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 104,105</text>
<text text-anchor="middle" x="19731" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="19731" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert53_qkv -->
<g id="node321" class="node">
<title>stage0_expert53_qkv</title>
<polygon fill="lightgreen" stroke="black" points="19578,-8343.1 19292,-8343.1 19292,-8291.1 19578,-8291.1 19578,-8343.1"/>
<text text-anchor="middle" x="19435" y="-8331.1" font-family="Arial" font-size="10.00">Expert 53 QKV Proj (TP)</text>
<text text-anchor="middle" x="19435" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 106,107</text>
<text text-anchor="middle" x="19435" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="19435" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert53_attn -->
<g id="node322" class="node">
<title>stage0_expert53_attn</title>
<polygon fill="lightgreen" stroke="black" points="19274,-8343.1 18988,-8343.1 18988,-8291.1 19274,-8291.1 19274,-8343.1"/>
<text text-anchor="middle" x="19131" y="-8331.1" font-family="Arial" font-size="10.00">Expert 53 Attention (TP)</text>
<text text-anchor="middle" x="19131" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 106,107</text>
<text text-anchor="middle" x="19131" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="19131" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert53_attn_out -->
<g id="node323" class="node">
<title>stage0_expert53_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="18970,-8343.1 18692,-8343.1 18692,-8291.1 18970,-8291.1 18970,-8343.1"/>
<text text-anchor="middle" x="18831" y="-8331.1" font-family="Arial" font-size="10.00">Expert 53 Attn Output (TP)</text>
<text text-anchor="middle" x="18831" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 106,107</text>
<text text-anchor="middle" x="18831" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="18831" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert53_mlp1 -->
<g id="node324" class="node">
<title>stage0_expert53_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="18674,-8343.1 18398,-8343.1 18398,-8291.1 18674,-8291.1 18674,-8343.1"/>
<text text-anchor="middle" x="18536" y="-8331.1" font-family="Arial" font-size="10.00">Expert 53 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="18536" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 106,107</text>
<text text-anchor="middle" x="18536" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="18536" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert53_mlp_act -->
<g id="node325" class="node">
<title>stage0_expert53_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="18380,-8343.1 18104,-8343.1 18104,-8291.1 18380,-8291.1 18380,-8343.1"/>
<text text-anchor="middle" x="18242" y="-8331.1" font-family="Arial" font-size="10.00">Expert 53 MLP GELU (TP)</text>
<text text-anchor="middle" x="18242" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 106,107</text>
<text text-anchor="middle" x="18242" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="18242" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert53_mlp2 -->
<g id="node326" class="node">
<title>stage0_expert53_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="18085.5,-8343.1 17816.5,-8343.1 17816.5,-8291.1 18085.5,-8291.1 18085.5,-8343.1"/>
<text text-anchor="middle" x="17951" y="-8331.1" font-family="Arial" font-size="10.00">Expert 53 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="17951" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 106,107</text>
<text text-anchor="middle" x="17951" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="17951" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert54_qkv -->
<g id="node327" class="node">
<title>stage0_expert54_qkv</title>
<polygon fill="lightgreen" stroke="black" points="17798,-8343.1 17512,-8343.1 17512,-8291.1 17798,-8291.1 17798,-8343.1"/>
<text text-anchor="middle" x="17655" y="-8331.1" font-family="Arial" font-size="10.00">Expert 54 QKV Proj (TP)</text>
<text text-anchor="middle" x="17655" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 108,109</text>
<text text-anchor="middle" x="17655" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="17655" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert54_attn -->
<g id="node328" class="node">
<title>stage0_expert54_attn</title>
<polygon fill="lightgreen" stroke="black" points="17494,-8343.1 17208,-8343.1 17208,-8291.1 17494,-8291.1 17494,-8343.1"/>
<text text-anchor="middle" x="17351" y="-8331.1" font-family="Arial" font-size="10.00">Expert 54 Attention (TP)</text>
<text text-anchor="middle" x="17351" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 108,109</text>
<text text-anchor="middle" x="17351" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="17351" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert54_attn_out -->
<g id="node329" class="node">
<title>stage0_expert54_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="17190,-8343.1 16912,-8343.1 16912,-8291.1 17190,-8291.1 17190,-8343.1"/>
<text text-anchor="middle" x="17051" y="-8331.1" font-family="Arial" font-size="10.00">Expert 54 Attn Output (TP)</text>
<text text-anchor="middle" x="17051" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 108,109</text>
<text text-anchor="middle" x="17051" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="17051" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert54_mlp1 -->
<g id="node330" class="node">
<title>stage0_expert54_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="16894,-8343.1 16618,-8343.1 16618,-8291.1 16894,-8291.1 16894,-8343.1"/>
<text text-anchor="middle" x="16756" y="-8331.1" font-family="Arial" font-size="10.00">Expert 54 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="16756" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 108,109</text>
<text text-anchor="middle" x="16756" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="16756" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert54_mlp_act -->
<g id="node331" class="node">
<title>stage0_expert54_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="16600,-8343.1 16324,-8343.1 16324,-8291.1 16600,-8291.1 16600,-8343.1"/>
<text text-anchor="middle" x="16462" y="-8331.1" font-family="Arial" font-size="10.00">Expert 54 MLP GELU (TP)</text>
<text text-anchor="middle" x="16462" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 108,109</text>
<text text-anchor="middle" x="16462" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="16462" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert54_mlp2 -->
<g id="node332" class="node">
<title>stage0_expert54_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="16305.5,-8343.1 16036.5,-8343.1 16036.5,-8291.1 16305.5,-8291.1 16305.5,-8343.1"/>
<text text-anchor="middle" x="16171" y="-8331.1" font-family="Arial" font-size="10.00">Expert 54 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="16171" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 108,109</text>
<text text-anchor="middle" x="16171" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="16171" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert55_qkv -->
<g id="node333" class="node">
<title>stage0_expert55_qkv</title>
<polygon fill="lightgreen" stroke="black" points="16018,-8343.1 15732,-8343.1 15732,-8291.1 16018,-8291.1 16018,-8343.1"/>
<text text-anchor="middle" x="15875" y="-8331.1" font-family="Arial" font-size="10.00">Expert 55 QKV Proj (TP)</text>
<text text-anchor="middle" x="15875" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 110,111</text>
<text text-anchor="middle" x="15875" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="15875" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert55_attn -->
<g id="node334" class="node">
<title>stage0_expert55_attn</title>
<polygon fill="lightgreen" stroke="black" points="15714,-8343.1 15428,-8343.1 15428,-8291.1 15714,-8291.1 15714,-8343.1"/>
<text text-anchor="middle" x="15571" y="-8331.1" font-family="Arial" font-size="10.00">Expert 55 Attention (TP)</text>
<text text-anchor="middle" x="15571" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 110,111</text>
<text text-anchor="middle" x="15571" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="15571" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert55_attn_out -->
<g id="node335" class="node">
<title>stage0_expert55_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="15410,-8343.1 15132,-8343.1 15132,-8291.1 15410,-8291.1 15410,-8343.1"/>
<text text-anchor="middle" x="15271" y="-8331.1" font-family="Arial" font-size="10.00">Expert 55 Attn Output (TP)</text>
<text text-anchor="middle" x="15271" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 110,111</text>
<text text-anchor="middle" x="15271" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="15271" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert55_mlp1 -->
<g id="node336" class="node">
<title>stage0_expert55_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="15114,-8343.1 14838,-8343.1 14838,-8291.1 15114,-8291.1 15114,-8343.1"/>
<text text-anchor="middle" x="14976" y="-8331.1" font-family="Arial" font-size="10.00">Expert 55 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="14976" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 110,111</text>
<text text-anchor="middle" x="14976" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="14976" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert55_mlp_act -->
<g id="node337" class="node">
<title>stage0_expert55_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="14820,-8343.1 14544,-8343.1 14544,-8291.1 14820,-8291.1 14820,-8343.1"/>
<text text-anchor="middle" x="14682" y="-8331.1" font-family="Arial" font-size="10.00">Expert 55 MLP GELU (TP)</text>
<text text-anchor="middle" x="14682" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 110,111</text>
<text text-anchor="middle" x="14682" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="14682" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert55_mlp2 -->
<g id="node338" class="node">
<title>stage0_expert55_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="14525.5,-8343.1 14256.5,-8343.1 14256.5,-8291.1 14525.5,-8291.1 14525.5,-8343.1"/>
<text text-anchor="middle" x="14391" y="-8331.1" font-family="Arial" font-size="10.00">Expert 55 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="14391" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 110,111</text>
<text text-anchor="middle" x="14391" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="14391" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert56_qkv -->
<g id="node339" class="node">
<title>stage0_expert56_qkv</title>
<polygon fill="lightgreen" stroke="black" points="14238,-8343.1 13952,-8343.1 13952,-8291.1 14238,-8291.1 14238,-8343.1"/>
<text text-anchor="middle" x="14095" y="-8331.1" font-family="Arial" font-size="10.00">Expert 56 QKV Proj (TP)</text>
<text text-anchor="middle" x="14095" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 112,113</text>
<text text-anchor="middle" x="14095" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="14095" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert56_attn -->
<g id="node340" class="node">
<title>stage0_expert56_attn</title>
<polygon fill="lightgreen" stroke="black" points="13934,-8343.1 13648,-8343.1 13648,-8291.1 13934,-8291.1 13934,-8343.1"/>
<text text-anchor="middle" x="13791" y="-8331.1" font-family="Arial" font-size="10.00">Expert 56 Attention (TP)</text>
<text text-anchor="middle" x="13791" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 112,113</text>
<text text-anchor="middle" x="13791" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="13791" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert56_attn_out -->
<g id="node341" class="node">
<title>stage0_expert56_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="13630,-8343.1 13352,-8343.1 13352,-8291.1 13630,-8291.1 13630,-8343.1"/>
<text text-anchor="middle" x="13491" y="-8331.1" font-family="Arial" font-size="10.00">Expert 56 Attn Output (TP)</text>
<text text-anchor="middle" x="13491" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 112,113</text>
<text text-anchor="middle" x="13491" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="13491" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert56_mlp1 -->
<g id="node342" class="node">
<title>stage0_expert56_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="13334,-8343.1 13058,-8343.1 13058,-8291.1 13334,-8291.1 13334,-8343.1"/>
<text text-anchor="middle" x="13196" y="-8331.1" font-family="Arial" font-size="10.00">Expert 56 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="13196" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 112,113</text>
<text text-anchor="middle" x="13196" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="13196" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert56_mlp_act -->
<g id="node343" class="node">
<title>stage0_expert56_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="13040,-8343.1 12764,-8343.1 12764,-8291.1 13040,-8291.1 13040,-8343.1"/>
<text text-anchor="middle" x="12902" y="-8331.1" font-family="Arial" font-size="10.00">Expert 56 MLP GELU (TP)</text>
<text text-anchor="middle" x="12902" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 112,113</text>
<text text-anchor="middle" x="12902" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="12902" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert56_mlp2 -->
<g id="node344" class="node">
<title>stage0_expert56_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="12745.5,-8343.1 12476.5,-8343.1 12476.5,-8291.1 12745.5,-8291.1 12745.5,-8343.1"/>
<text text-anchor="middle" x="12611" y="-8331.1" font-family="Arial" font-size="10.00">Expert 56 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="12611" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 112,113</text>
<text text-anchor="middle" x="12611" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="12611" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert57_qkv -->
<g id="node345" class="node">
<title>stage0_expert57_qkv</title>
<polygon fill="lightgreen" stroke="black" points="12458,-8343.1 12172,-8343.1 12172,-8291.1 12458,-8291.1 12458,-8343.1"/>
<text text-anchor="middle" x="12315" y="-8331.1" font-family="Arial" font-size="10.00">Expert 57 QKV Proj (TP)</text>
<text text-anchor="middle" x="12315" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 114,115</text>
<text text-anchor="middle" x="12315" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="12315" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert57_attn -->
<g id="node346" class="node">
<title>stage0_expert57_attn</title>
<polygon fill="lightgreen" stroke="black" points="12154,-8343.1 11868,-8343.1 11868,-8291.1 12154,-8291.1 12154,-8343.1"/>
<text text-anchor="middle" x="12011" y="-8331.1" font-family="Arial" font-size="10.00">Expert 57 Attention (TP)</text>
<text text-anchor="middle" x="12011" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 114,115</text>
<text text-anchor="middle" x="12011" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="12011" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert57_attn_out -->
<g id="node347" class="node">
<title>stage0_expert57_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="11850,-8343.1 11572,-8343.1 11572,-8291.1 11850,-8291.1 11850,-8343.1"/>
<text text-anchor="middle" x="11711" y="-8331.1" font-family="Arial" font-size="10.00">Expert 57 Attn Output (TP)</text>
<text text-anchor="middle" x="11711" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 114,115</text>
<text text-anchor="middle" x="11711" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="11711" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert57_mlp1 -->
<g id="node348" class="node">
<title>stage0_expert57_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="11554,-8343.1 11278,-8343.1 11278,-8291.1 11554,-8291.1 11554,-8343.1"/>
<text text-anchor="middle" x="11416" y="-8331.1" font-family="Arial" font-size="10.00">Expert 57 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="11416" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 114,115</text>
<text text-anchor="middle" x="11416" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="11416" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert57_mlp_act -->
<g id="node349" class="node">
<title>stage0_expert57_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="11260,-8343.1 10984,-8343.1 10984,-8291.1 11260,-8291.1 11260,-8343.1"/>
<text text-anchor="middle" x="11122" y="-8331.1" font-family="Arial" font-size="10.00">Expert 57 MLP GELU (TP)</text>
<text text-anchor="middle" x="11122" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 114,115</text>
<text text-anchor="middle" x="11122" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="11122" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert57_mlp2 -->
<g id="node350" class="node">
<title>stage0_expert57_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="10965.5,-8343.1 10696.5,-8343.1 10696.5,-8291.1 10965.5,-8291.1 10965.5,-8343.1"/>
<text text-anchor="middle" x="10831" y="-8331.1" font-family="Arial" font-size="10.00">Expert 57 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="10831" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 114,115</text>
<text text-anchor="middle" x="10831" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="10831" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert58_qkv -->
<g id="node351" class="node">
<title>stage0_expert58_qkv</title>
<polygon fill="lightgreen" stroke="black" points="10678,-8343.1 10392,-8343.1 10392,-8291.1 10678,-8291.1 10678,-8343.1"/>
<text text-anchor="middle" x="10535" y="-8331.1" font-family="Arial" font-size="10.00">Expert 58 QKV Proj (TP)</text>
<text text-anchor="middle" x="10535" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 116,117</text>
<text text-anchor="middle" x="10535" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="10535" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert58_attn -->
<g id="node352" class="node">
<title>stage0_expert58_attn</title>
<polygon fill="lightgreen" stroke="black" points="10374,-8343.1 10088,-8343.1 10088,-8291.1 10374,-8291.1 10374,-8343.1"/>
<text text-anchor="middle" x="10231" y="-8331.1" font-family="Arial" font-size="10.00">Expert 58 Attention (TP)</text>
<text text-anchor="middle" x="10231" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 116,117</text>
<text text-anchor="middle" x="10231" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="10231" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert58_attn_out -->
<g id="node353" class="node">
<title>stage0_expert58_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="10070,-8343.1 9792,-8343.1 9792,-8291.1 10070,-8291.1 10070,-8343.1"/>
<text text-anchor="middle" x="9931" y="-8331.1" font-family="Arial" font-size="10.00">Expert 58 Attn Output (TP)</text>
<text text-anchor="middle" x="9931" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 116,117</text>
<text text-anchor="middle" x="9931" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="9931" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert58_mlp1 -->
<g id="node354" class="node">
<title>stage0_expert58_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="9774,-8343.1 9498,-8343.1 9498,-8291.1 9774,-8291.1 9774,-8343.1"/>
<text text-anchor="middle" x="9636" y="-8331.1" font-family="Arial" font-size="10.00">Expert 58 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="9636" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 116,117</text>
<text text-anchor="middle" x="9636" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="9636" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert58_mlp_act -->
<g id="node355" class="node">
<title>stage0_expert58_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="9480,-8343.1 9204,-8343.1 9204,-8291.1 9480,-8291.1 9480,-8343.1"/>
<text text-anchor="middle" x="9342" y="-8331.1" font-family="Arial" font-size="10.00">Expert 58 MLP GELU (TP)</text>
<text text-anchor="middle" x="9342" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 116,117</text>
<text text-anchor="middle" x="9342" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="9342" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert58_mlp2 -->
<g id="node356" class="node">
<title>stage0_expert58_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="9185.5,-8343.1 8916.5,-8343.1 8916.5,-8291.1 9185.5,-8291.1 9185.5,-8343.1"/>
<text text-anchor="middle" x="9051" y="-8331.1" font-family="Arial" font-size="10.00">Expert 58 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="9051" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 116,117</text>
<text text-anchor="middle" x="9051" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="9051" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert59_qkv -->
<g id="node357" class="node">
<title>stage0_expert59_qkv</title>
<polygon fill="lightgreen" stroke="black" points="8898,-8343.1 8612,-8343.1 8612,-8291.1 8898,-8291.1 8898,-8343.1"/>
<text text-anchor="middle" x="8755" y="-8331.1" font-family="Arial" font-size="10.00">Expert 59 QKV Proj (TP)</text>
<text text-anchor="middle" x="8755" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 118,119</text>
<text text-anchor="middle" x="8755" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="8755" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert59_attn -->
<g id="node358" class="node">
<title>stage0_expert59_attn</title>
<polygon fill="lightgreen" stroke="black" points="8594,-8343.1 8308,-8343.1 8308,-8291.1 8594,-8291.1 8594,-8343.1"/>
<text text-anchor="middle" x="8451" y="-8331.1" font-family="Arial" font-size="10.00">Expert 59 Attention (TP)</text>
<text text-anchor="middle" x="8451" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 118,119</text>
<text text-anchor="middle" x="8451" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="8451" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert59_attn_out -->
<g id="node359" class="node">
<title>stage0_expert59_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="8290,-8343.1 8012,-8343.1 8012,-8291.1 8290,-8291.1 8290,-8343.1"/>
<text text-anchor="middle" x="8151" y="-8331.1" font-family="Arial" font-size="10.00">Expert 59 Attn Output (TP)</text>
<text text-anchor="middle" x="8151" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 118,119</text>
<text text-anchor="middle" x="8151" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="8151" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert59_mlp1 -->
<g id="node360" class="node">
<title>stage0_expert59_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="7994,-8343.1 7718,-8343.1 7718,-8291.1 7994,-8291.1 7994,-8343.1"/>
<text text-anchor="middle" x="7856" y="-8331.1" font-family="Arial" font-size="10.00">Expert 59 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="7856" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 118,119</text>
<text text-anchor="middle" x="7856" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="7856" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert59_mlp_act -->
<g id="node361" class="node">
<title>stage0_expert59_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="7700,-8343.1 7424,-8343.1 7424,-8291.1 7700,-8291.1 7700,-8343.1"/>
<text text-anchor="middle" x="7562" y="-8331.1" font-family="Arial" font-size="10.00">Expert 59 MLP GELU (TP)</text>
<text text-anchor="middle" x="7562" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 118,119</text>
<text text-anchor="middle" x="7562" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="7562" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert59_mlp2 -->
<g id="node362" class="node">
<title>stage0_expert59_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="7405.5,-8343.1 7136.5,-8343.1 7136.5,-8291.1 7405.5,-8291.1 7405.5,-8343.1"/>
<text text-anchor="middle" x="7271" y="-8331.1" font-family="Arial" font-size="10.00">Expert 59 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="7271" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 118,119</text>
<text text-anchor="middle" x="7271" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="7271" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert60_qkv -->
<g id="node363" class="node">
<title>stage0_expert60_qkv</title>
<polygon fill="lightgreen" stroke="black" points="7118,-8343.1 6832,-8343.1 6832,-8291.1 7118,-8291.1 7118,-8343.1"/>
<text text-anchor="middle" x="6975" y="-8331.1" font-family="Arial" font-size="10.00">Expert 60 QKV Proj (TP)</text>
<text text-anchor="middle" x="6975" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 120,121</text>
<text text-anchor="middle" x="6975" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="6975" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert60_attn -->
<g id="node364" class="node">
<title>stage0_expert60_attn</title>
<polygon fill="lightgreen" stroke="black" points="6814,-8343.1 6528,-8343.1 6528,-8291.1 6814,-8291.1 6814,-8343.1"/>
<text text-anchor="middle" x="6671" y="-8331.1" font-family="Arial" font-size="10.00">Expert 60 Attention (TP)</text>
<text text-anchor="middle" x="6671" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 120,121</text>
<text text-anchor="middle" x="6671" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="6671" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert60_attn_out -->
<g id="node365" class="node">
<title>stage0_expert60_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="6510,-8343.1 6232,-8343.1 6232,-8291.1 6510,-8291.1 6510,-8343.1"/>
<text text-anchor="middle" x="6371" y="-8331.1" font-family="Arial" font-size="10.00">Expert 60 Attn Output (TP)</text>
<text text-anchor="middle" x="6371" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 120,121</text>
<text text-anchor="middle" x="6371" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="6371" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert60_mlp1 -->
<g id="node366" class="node">
<title>stage0_expert60_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="6214,-8343.1 5938,-8343.1 5938,-8291.1 6214,-8291.1 6214,-8343.1"/>
<text text-anchor="middle" x="6076" y="-8331.1" font-family="Arial" font-size="10.00">Expert 60 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="6076" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 120,121</text>
<text text-anchor="middle" x="6076" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="6076" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert60_mlp_act -->
<g id="node367" class="node">
<title>stage0_expert60_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="5920,-8343.1 5644,-8343.1 5644,-8291.1 5920,-8291.1 5920,-8343.1"/>
<text text-anchor="middle" x="5782" y="-8331.1" font-family="Arial" font-size="10.00">Expert 60 MLP GELU (TP)</text>
<text text-anchor="middle" x="5782" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 120,121</text>
<text text-anchor="middle" x="5782" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="5782" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert60_mlp2 -->
<g id="node368" class="node">
<title>stage0_expert60_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="5625.5,-8343.1 5356.5,-8343.1 5356.5,-8291.1 5625.5,-8291.1 5625.5,-8343.1"/>
<text text-anchor="middle" x="5491" y="-8331.1" font-family="Arial" font-size="10.00">Expert 60 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="5491" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 120,121</text>
<text text-anchor="middle" x="5491" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="5491" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert61_qkv -->
<g id="node369" class="node">
<title>stage0_expert61_qkv</title>
<polygon fill="lightgreen" stroke="black" points="5338,-8343.1 5052,-8343.1 5052,-8291.1 5338,-8291.1 5338,-8343.1"/>
<text text-anchor="middle" x="5195" y="-8331.1" font-family="Arial" font-size="10.00">Expert 61 QKV Proj (TP)</text>
<text text-anchor="middle" x="5195" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 122,123</text>
<text text-anchor="middle" x="5195" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="5195" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert61_attn -->
<g id="node370" class="node">
<title>stage0_expert61_attn</title>
<polygon fill="lightgreen" stroke="black" points="5034,-8343.1 4748,-8343.1 4748,-8291.1 5034,-8291.1 5034,-8343.1"/>
<text text-anchor="middle" x="4891" y="-8331.1" font-family="Arial" font-size="10.00">Expert 61 Attention (TP)</text>
<text text-anchor="middle" x="4891" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 122,123</text>
<text text-anchor="middle" x="4891" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="4891" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert61_attn_out -->
<g id="node371" class="node">
<title>stage0_expert61_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="4730,-8343.1 4452,-8343.1 4452,-8291.1 4730,-8291.1 4730,-8343.1"/>
<text text-anchor="middle" x="4591" y="-8331.1" font-family="Arial" font-size="10.00">Expert 61 Attn Output (TP)</text>
<text text-anchor="middle" x="4591" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 122,123</text>
<text text-anchor="middle" x="4591" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="4591" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert61_mlp1 -->
<g id="node372" class="node">
<title>stage0_expert61_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="4434,-8343.1 4158,-8343.1 4158,-8291.1 4434,-8291.1 4434,-8343.1"/>
<text text-anchor="middle" x="4296" y="-8331.1" font-family="Arial" font-size="10.00">Expert 61 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="4296" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 122,123</text>
<text text-anchor="middle" x="4296" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="4296" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert61_mlp_act -->
<g id="node373" class="node">
<title>stage0_expert61_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="4140,-8343.1 3864,-8343.1 3864,-8291.1 4140,-8291.1 4140,-8343.1"/>
<text text-anchor="middle" x="4002" y="-8331.1" font-family="Arial" font-size="10.00">Expert 61 MLP GELU (TP)</text>
<text text-anchor="middle" x="4002" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 122,123</text>
<text text-anchor="middle" x="4002" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="4002" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert61_mlp2 -->
<g id="node374" class="node">
<title>stage0_expert61_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="3845.5,-8343.1 3576.5,-8343.1 3576.5,-8291.1 3845.5,-8291.1 3845.5,-8343.1"/>
<text text-anchor="middle" x="3711" y="-8331.1" font-family="Arial" font-size="10.00">Expert 61 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="3711" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 122,123</text>
<text text-anchor="middle" x="3711" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="3711" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert62_qkv -->
<g id="node375" class="node">
<title>stage0_expert62_qkv</title>
<polygon fill="lightgreen" stroke="black" points="3558,-8343.1 3272,-8343.1 3272,-8291.1 3558,-8291.1 3558,-8343.1"/>
<text text-anchor="middle" x="3415" y="-8331.1" font-family="Arial" font-size="10.00">Expert 62 QKV Proj (TP)</text>
<text text-anchor="middle" x="3415" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 124,125</text>
<text text-anchor="middle" x="3415" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="3415" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert62_attn -->
<g id="node376" class="node">
<title>stage0_expert62_attn</title>
<polygon fill="lightgreen" stroke="black" points="3254,-8343.1 2968,-8343.1 2968,-8291.1 3254,-8291.1 3254,-8343.1"/>
<text text-anchor="middle" x="3111" y="-8331.1" font-family="Arial" font-size="10.00">Expert 62 Attention (TP)</text>
<text text-anchor="middle" x="3111" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 124,125</text>
<text text-anchor="middle" x="3111" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="3111" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert62_attn_out -->
<g id="node377" class="node">
<title>stage0_expert62_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="2950,-8343.1 2672,-8343.1 2672,-8291.1 2950,-8291.1 2950,-8343.1"/>
<text text-anchor="middle" x="2811" y="-8331.1" font-family="Arial" font-size="10.00">Expert 62 Attn Output (TP)</text>
<text text-anchor="middle" x="2811" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 124,125</text>
<text text-anchor="middle" x="2811" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="2811" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert62_mlp1 -->
<g id="node378" class="node">
<title>stage0_expert62_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="2654,-8343.1 2378,-8343.1 2378,-8291.1 2654,-8291.1 2654,-8343.1"/>
<text text-anchor="middle" x="2516" y="-8331.1" font-family="Arial" font-size="10.00">Expert 62 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="2516" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 124,125</text>
<text text-anchor="middle" x="2516" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="2516" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert62_mlp_act -->
<g id="node379" class="node">
<title>stage0_expert62_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="2360,-8343.1 2084,-8343.1 2084,-8291.1 2360,-8291.1 2360,-8343.1"/>
<text text-anchor="middle" x="2222" y="-8331.1" font-family="Arial" font-size="10.00">Expert 62 MLP GELU (TP)</text>
<text text-anchor="middle" x="2222" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 124,125</text>
<text text-anchor="middle" x="2222" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="2222" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert62_mlp2 -->
<g id="node380" class="node">
<title>stage0_expert62_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="2065.5,-8343.1 1796.5,-8343.1 1796.5,-8291.1 2065.5,-8291.1 2065.5,-8343.1"/>
<text text-anchor="middle" x="1931" y="-8331.1" font-family="Arial" font-size="10.00">Expert 62 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="1931" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 124,125</text>
<text text-anchor="middle" x="1931" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="1931" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert63_qkv -->
<g id="node381" class="node">
<title>stage0_expert63_qkv</title>
<polygon fill="lightgreen" stroke="black" points="1778,-8343.1 1492,-8343.1 1492,-8291.1 1778,-8291.1 1778,-8343.1"/>
<text text-anchor="middle" x="1635" y="-8331.1" font-family="Arial" font-size="10.00">Expert 63 QKV Proj (TP)</text>
<text text-anchor="middle" x="1635" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 126,127</text>
<text text-anchor="middle" x="1635" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="1635" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert63_attn -->
<g id="node382" class="node">
<title>stage0_expert63_attn</title>
<polygon fill="lightgreen" stroke="black" points="1474,-8343.1 1188,-8343.1 1188,-8291.1 1474,-8291.1 1474,-8343.1"/>
<text text-anchor="middle" x="1331" y="-8331.1" font-family="Arial" font-size="10.00">Expert 63 Attention (TP)</text>
<text text-anchor="middle" x="1331" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 126,127</text>
<text text-anchor="middle" x="1331" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="1331" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage0_expert63_attn_out -->
<g id="node383" class="node">
<title>stage0_expert63_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1170,-8343.1 892,-8343.1 892,-8291.1 1170,-8291.1 1170,-8343.1"/>
<text text-anchor="middle" x="1031" y="-8331.1" font-family="Arial" font-size="10.00">Expert 63 Attn Output (TP)</text>
<text text-anchor="middle" x="1031" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 126,127</text>
<text text-anchor="middle" x="1031" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="1031" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_expert63_mlp1 -->
<g id="node384" class="node">
<title>stage0_expert63_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="874,-8343.1 598,-8343.1 598,-8291.1 874,-8291.1 874,-8343.1"/>
<text text-anchor="middle" x="736" y="-8331.1" font-family="Arial" font-size="10.00">Expert 63 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="736" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 126,127</text>
<text text-anchor="middle" x="736" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="736" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert63_mlp_act -->
<g id="node385" class="node">
<title>stage0_expert63_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="580,-8343.1 304,-8343.1 304,-8291.1 580,-8291.1 580,-8343.1"/>
<text text-anchor="middle" x="442" y="-8331.1" font-family="Arial" font-size="10.00">Expert 63 MLP GELU (TP)</text>
<text text-anchor="middle" x="442" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 126,127</text>
<text text-anchor="middle" x="442" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="442" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage0_expert63_mlp2 -->
<g id="node386" class="node">
<title>stage0_expert63_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="285.5,-8343.1 16.5,-8343.1 16.5,-8291.1 285.5,-8291.1 285.5,-8343.1"/>
<text text-anchor="middle" x="151" y="-8331.1" font-family="Arial" font-size="10.00">Expert 63 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="151" y="-8320.1" font-family="Arial" font-size="10.00">GPUs: 126,127</text>
<text text-anchor="middle" x="151" y="-8309.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="151" y="-8298.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_aggregate -->
<g id="node387" class="node">
<title>stage0_aggregate</title>
<polygon fill="lightyellow" stroke="black" points="112684.24,-7525.1 112263.89,-7525.1 112155.76,-7421.1 112576.11,-7421.1 112684.24,-7525.1"/>
<text text-anchor="middle" x="112420" y="-7487.1" font-family="Arial" font-size="10.00">Expert Output Aggregation</text>
<text text-anchor="middle" x="112420" y="-7476.1" font-family="Arial" font-size="10.00">GPUs: 0&#45;127</text>
<text text-anchor="middle" x="112420" y="-7465.1" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-7454.1" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- pipe_comm_0_1 -->
<g id="node390" class="node">
<title>pipe_comm_0_1</title>
<ellipse fill="orange" stroke="black" cx="112420" cy="-7340.55" rx="180.12" ry="44.6"/>
<text text-anchor="middle" x="112420" y="-7360.05" font-family="Arial" font-size="10.00">Pipeline Communication</text>
<text text-anchor="middle" x="112420" y="-7349.05" font-family="Arial" font-size="10.00">Stage 0  Stage 1</text>
<text text-anchor="middle" x="112420" y="-7338.05" font-family="Arial" font-size="10.00">GPUs: 0&#45;127  128&#45;255</text>
<text text-anchor="middle" x="112420" y="-7327.05" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-7316.05" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage0_aggregate&#45;&gt;pipe_comm_0_1 -->
<g id="edge11" class="edge">
<title>stage0_aggregate&#45;&gt;pipe_comm_0_1</title>
<path fill="none" stroke="black" d="M112420,-7421.09C112420,-7421.09 112420,-7395.11 112420,-7395.11"/>
<polygon fill="black" stroke="black" points="112423.5,-7395.11 112420,-7385.11 112416.5,-7395.11 112423.5,-7395.11"/>
</g>
<!-- stage0_layernorm1&#45;&gt;stage0_expert0_mlp1 -->
<g id="edge6" class="edge">
<title>stage0_layernorm1&#45;&gt;stage0_expert0_mlp1</title>
<path fill="none" stroke="black" d="M112420,-7912.69C112420,-7912.69 112420,-7887.18 112420,-7887.18"/>
<polygon fill="black" stroke="black" points="112423.5,-7887.18 112420,-7877.18 112416.5,-7887.18 112423.5,-7887.18"/>
</g>
<!-- stage0_layernorm2&#45;&gt;stage0_aggregate -->
<g id="edge10" class="edge">
<title>stage0_layernorm2&#45;&gt;stage0_aggregate</title>
<path fill="none" stroke="black" d="M112420,-7560.94C112420,-7560.94 112420,-7535.19 112420,-7535.19"/>
<polygon fill="black" stroke="black" points="112423.5,-7535.19 112420,-7525.19 112416.5,-7535.19 112423.5,-7535.19"/>
</g>
<!-- stage1_routing -->
<g id="node391" class="node">
<title>stage1_routing</title>
<polygon fill="lightyellow" stroke="black" points="112684.24,-7242 112263.89,-7242 112155.76,-7116 112576.11,-7116 112684.24,-7242"/>
<text text-anchor="middle" x="112420" y="-7198.5" font-family="Arial" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="112420" y="-7187.5" font-family="Arial" font-size="10.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="112420" y="-7176.5" font-family="Arial" font-size="10.00">GPUs: 128&#45;255</text>
<text text-anchor="middle" x="112420" y="-7165.5" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-7154.5" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- pipe_comm_0_1&#45;&gt;stage1_routing -->
<g id="edge12" class="edge">
<title>pipe_comm_0_1&#45;&gt;stage1_routing</title>
<path fill="none" stroke="black" d="M112420,-7295.98C112420,-7295.98 112420,-7252.17 112420,-7252.17"/>
<polygon fill="black" stroke="black" points="112423.5,-7252.17 112420,-7242.17 112416.5,-7252.17 112423.5,-7252.17"/>
</g>
<!-- stage1_expert0_qkv -->
<g id="node392" class="node">
<title>stage1_expert0_qkv</title>
<polygon fill="lightgreen" stroke="black" points="112563,-7080 112277,-7080 112277,-7028 112563,-7028 112563,-7080"/>
<text text-anchor="middle" x="112420" y="-7068" font-family="Arial" font-size="10.00">Expert 0 QKV Proj (TP)</text>
<text text-anchor="middle" x="112420" y="-7057" font-family="Arial" font-size="10.00">GPUs: 128,129</text>
<text text-anchor="middle" x="112420" y="-7046" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-7035" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_routing&#45;&gt;stage1_expert0_qkv -->
<g id="edge13" class="edge">
<title>stage1_routing&#45;&gt;stage1_expert0_qkv</title>
<path fill="none" stroke="black" d="M112420,-7115.77C112420,-7115.77 112420,-7090.15 112420,-7090.15"/>
<polygon fill="black" stroke="black" points="112423.5,-7090.15 112420,-7080.15 112416.5,-7090.15 112423.5,-7090.15"/>
</g>
<!-- stage1_expert0_attn -->
<g id="node393" class="node">
<title>stage1_expert0_attn</title>
<polygon fill="lightgreen" stroke="black" points="112563,-6992 112277,-6992 112277,-6940 112563,-6940 112563,-6992"/>
<text text-anchor="middle" x="112420" y="-6980" font-family="Arial" font-size="10.00">Expert 0 Attention (TP)</text>
<text text-anchor="middle" x="112420" y="-6969" font-family="Arial" font-size="10.00">GPUs: 128,129</text>
<text text-anchor="middle" x="112420" y="-6958" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="112420" y="-6947" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert0_qkv&#45;&gt;stage1_expert0_attn -->
<g id="edge14" class="edge">
<title>stage1_expert0_qkv&#45;&gt;stage1_expert0_attn</title>
<path fill="none" stroke="black" d="M112420,-7027.6C112420,-7027.6 112420,-7002.08 112420,-7002.08"/>
<polygon fill="black" stroke="black" points="112423.5,-7002.08 112420,-6992.08 112416.5,-7002.08 112423.5,-7002.08"/>
</g>
<!-- stage1_expert0_attn_out -->
<g id="node394" class="node">
<title>stage1_expert0_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="112559,-6904 112281,-6904 112281,-6852 112559,-6852 112559,-6904"/>
<text text-anchor="middle" x="112420" y="-6892" font-family="Arial" font-size="10.00">Expert 0 Attn Output (TP)</text>
<text text-anchor="middle" x="112420" y="-6881" font-family="Arial" font-size="10.00">GPUs: 128,129</text>
<text text-anchor="middle" x="112420" y="-6870" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="112420" y="-6859" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert0_attn&#45;&gt;stage1_expert0_attn_out -->
<g id="edge15" class="edge">
<title>stage1_expert0_attn&#45;&gt;stage1_expert0_attn_out</title>
<path fill="none" stroke="black" d="M112420,-6939.6C112420,-6939.6 112420,-6914.08 112420,-6914.08"/>
<polygon fill="black" stroke="black" points="112423.5,-6914.08 112420,-6904.08 112416.5,-6914.08 112423.5,-6914.08"/>
</g>
<!-- stage1_layernorm1 -->
<g id="node777" class="node">
<title>stage1_layernorm1</title>
<polygon fill="lightblue" stroke="black" points="112547.5,-6816 112292.5,-6816 112292.5,-6764 112547.5,-6764 112547.5,-6816"/>
<text text-anchor="middle" x="112420" y="-6804" font-family="Arial" font-size="10.00">LayerNorm 1</text>
<text text-anchor="middle" x="112420" y="-6793" font-family="Arial" font-size="10.00">GPUs: 128&#45;255</text>
<text text-anchor="middle" x="112420" y="-6782" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-6771" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert0_attn_out&#45;&gt;stage1_layernorm1 -->
<g id="edge16" class="edge">
<title>stage1_expert0_attn_out&#45;&gt;stage1_layernorm1</title>
<path fill="none" stroke="black" d="M112420,-6851.6C112420,-6851.6 112420,-6826.08 112420,-6826.08"/>
<polygon fill="black" stroke="black" points="112423.5,-6826.08 112420,-6816.08 112416.5,-6826.08 112423.5,-6826.08"/>
</g>
<!-- stage1_expert0_mlp1 -->
<g id="node395" class="node">
<title>stage1_expert0_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="112558,-6728 112282,-6728 112282,-6676 112558,-6676 112558,-6728"/>
<text text-anchor="middle" x="112420" y="-6716" font-family="Arial" font-size="10.00">Expert 0 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="112420" y="-6705" font-family="Arial" font-size="10.00">GPUs: 128,129</text>
<text text-anchor="middle" x="112420" y="-6694" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-6683" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert0_mlp_act -->
<g id="node396" class="node">
<title>stage1_expert0_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="112558,-6640 112282,-6640 112282,-6588 112558,-6588 112558,-6640"/>
<text text-anchor="middle" x="112420" y="-6628" font-family="Arial" font-size="10.00">Expert 0 MLP GELU (TP)</text>
<text text-anchor="middle" x="112420" y="-6617" font-family="Arial" font-size="10.00">GPUs: 128,129</text>
<text text-anchor="middle" x="112420" y="-6606" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="112420" y="-6595" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert0_mlp1&#45;&gt;stage1_expert0_mlp_act -->
<g id="edge18" class="edge">
<title>stage1_expert0_mlp1&#45;&gt;stage1_expert0_mlp_act</title>
<path fill="none" stroke="black" d="M112420,-6675.6C112420,-6675.6 112420,-6650.08 112420,-6650.08"/>
<polygon fill="black" stroke="black" points="112423.5,-6650.08 112420,-6640.08 112416.5,-6650.08 112423.5,-6650.08"/>
</g>
<!-- stage1_expert0_mlp2 -->
<g id="node397" class="node">
<title>stage1_expert0_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="112554.5,-6552 112285.5,-6552 112285.5,-6500 112554.5,-6500 112554.5,-6552"/>
<text text-anchor="middle" x="112420" y="-6540" font-family="Arial" font-size="10.00">Expert 0 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="112420" y="-6529" font-family="Arial" font-size="10.00">GPUs: 128,129</text>
<text text-anchor="middle" x="112420" y="-6518" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="112420" y="-6507" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert0_mlp_act&#45;&gt;stage1_expert0_mlp2 -->
<g id="edge19" class="edge">
<title>stage1_expert0_mlp_act&#45;&gt;stage1_expert0_mlp2</title>
<path fill="none" stroke="black" d="M112420,-6587.6C112420,-6587.6 112420,-6562.08 112420,-6562.08"/>
<polygon fill="black" stroke="black" points="112423.5,-6562.08 112420,-6552.08 112416.5,-6562.08 112423.5,-6562.08"/>
</g>
<!-- stage1_layernorm2 -->
<g id="node778" class="node">
<title>stage1_layernorm2</title>
<polygon fill="lightblue" stroke="black" points="112547.5,-6464 112292.5,-6464 112292.5,-6412 112547.5,-6412 112547.5,-6464"/>
<text text-anchor="middle" x="112420" y="-6452" font-family="Arial" font-size="10.00">LayerNorm 2</text>
<text text-anchor="middle" x="112420" y="-6441" font-family="Arial" font-size="10.00">GPUs: 128&#45;255</text>
<text text-anchor="middle" x="112420" y="-6430" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-6419" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert0_mlp2&#45;&gt;stage1_layernorm2 -->
<g id="edge20" class="edge">
<title>stage1_expert0_mlp2&#45;&gt;stage1_layernorm2</title>
<path fill="none" stroke="black" d="M112420,-6499.6C112420,-6499.6 112420,-6474.08 112420,-6474.08"/>
<polygon fill="black" stroke="black" points="112423.5,-6474.08 112420,-6464.08 112416.5,-6474.08 112423.5,-6474.08"/>
</g>
<!-- stage1_expert1_qkv -->
<g id="node398" class="node">
<title>stage1_expert1_qkv</title>
<polygon fill="lightgreen" stroke="black" points="112138,-7205 111852,-7205 111852,-7153 112138,-7153 112138,-7205"/>
<text text-anchor="middle" x="111995" y="-7193" font-family="Arial" font-size="10.00">Expert 1 QKV Proj (TP)</text>
<text text-anchor="middle" x="111995" y="-7182" font-family="Arial" font-size="10.00">GPUs: 130,131</text>
<text text-anchor="middle" x="111995" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="111995" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert1_attn -->
<g id="node399" class="node">
<title>stage1_expert1_attn</title>
<polygon fill="lightgreen" stroke="black" points="111834,-7205 111548,-7205 111548,-7153 111834,-7153 111834,-7205"/>
<text text-anchor="middle" x="111691" y="-7193" font-family="Arial" font-size="10.00">Expert 1 Attention (TP)</text>
<text text-anchor="middle" x="111691" y="-7182" font-family="Arial" font-size="10.00">GPUs: 130,131</text>
<text text-anchor="middle" x="111691" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="111691" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert1_attn_out -->
<g id="node400" class="node">
<title>stage1_expert1_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="111530,-7205 111252,-7205 111252,-7153 111530,-7153 111530,-7205"/>
<text text-anchor="middle" x="111391" y="-7193" font-family="Arial" font-size="10.00">Expert 1 Attn Output (TP)</text>
<text text-anchor="middle" x="111391" y="-7182" font-family="Arial" font-size="10.00">GPUs: 130,131</text>
<text text-anchor="middle" x="111391" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="111391" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert1_mlp1 -->
<g id="node401" class="node">
<title>stage1_expert1_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="111234,-7205 110958,-7205 110958,-7153 111234,-7153 111234,-7205"/>
<text text-anchor="middle" x="111096" y="-7193" font-family="Arial" font-size="10.00">Expert 1 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="111096" y="-7182" font-family="Arial" font-size="10.00">GPUs: 130,131</text>
<text text-anchor="middle" x="111096" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="111096" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert1_mlp_act -->
<g id="node402" class="node">
<title>stage1_expert1_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="110940,-7205 110664,-7205 110664,-7153 110940,-7153 110940,-7205"/>
<text text-anchor="middle" x="110802" y="-7193" font-family="Arial" font-size="10.00">Expert 1 MLP GELU (TP)</text>
<text text-anchor="middle" x="110802" y="-7182" font-family="Arial" font-size="10.00">GPUs: 130,131</text>
<text text-anchor="middle" x="110802" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="110802" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert1_mlp2 -->
<g id="node403" class="node">
<title>stage1_expert1_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="110645.5,-7205 110376.5,-7205 110376.5,-7153 110645.5,-7153 110645.5,-7205"/>
<text text-anchor="middle" x="110511" y="-7193" font-family="Arial" font-size="10.00">Expert 1 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="110511" y="-7182" font-family="Arial" font-size="10.00">GPUs: 130,131</text>
<text text-anchor="middle" x="110511" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="110511" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert2_qkv -->
<g id="node404" class="node">
<title>stage1_expert2_qkv</title>
<polygon fill="lightgreen" stroke="black" points="110358,-7205 110072,-7205 110072,-7153 110358,-7153 110358,-7205"/>
<text text-anchor="middle" x="110215" y="-7193" font-family="Arial" font-size="10.00">Expert 2 QKV Proj (TP)</text>
<text text-anchor="middle" x="110215" y="-7182" font-family="Arial" font-size="10.00">GPUs: 132,133</text>
<text text-anchor="middle" x="110215" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="110215" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert2_attn -->
<g id="node405" class="node">
<title>stage1_expert2_attn</title>
<polygon fill="lightgreen" stroke="black" points="110054,-7205 109768,-7205 109768,-7153 110054,-7153 110054,-7205"/>
<text text-anchor="middle" x="109911" y="-7193" font-family="Arial" font-size="10.00">Expert 2 Attention (TP)</text>
<text text-anchor="middle" x="109911" y="-7182" font-family="Arial" font-size="10.00">GPUs: 132,133</text>
<text text-anchor="middle" x="109911" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="109911" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert2_attn_out -->
<g id="node406" class="node">
<title>stage1_expert2_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="109750,-7205 109472,-7205 109472,-7153 109750,-7153 109750,-7205"/>
<text text-anchor="middle" x="109611" y="-7193" font-family="Arial" font-size="10.00">Expert 2 Attn Output (TP)</text>
<text text-anchor="middle" x="109611" y="-7182" font-family="Arial" font-size="10.00">GPUs: 132,133</text>
<text text-anchor="middle" x="109611" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="109611" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert2_mlp1 -->
<g id="node407" class="node">
<title>stage1_expert2_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="109454,-7205 109178,-7205 109178,-7153 109454,-7153 109454,-7205"/>
<text text-anchor="middle" x="109316" y="-7193" font-family="Arial" font-size="10.00">Expert 2 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="109316" y="-7182" font-family="Arial" font-size="10.00">GPUs: 132,133</text>
<text text-anchor="middle" x="109316" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="109316" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert2_mlp_act -->
<g id="node408" class="node">
<title>stage1_expert2_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="109160,-7205 108884,-7205 108884,-7153 109160,-7153 109160,-7205"/>
<text text-anchor="middle" x="109022" y="-7193" font-family="Arial" font-size="10.00">Expert 2 MLP GELU (TP)</text>
<text text-anchor="middle" x="109022" y="-7182" font-family="Arial" font-size="10.00">GPUs: 132,133</text>
<text text-anchor="middle" x="109022" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="109022" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert2_mlp2 -->
<g id="node409" class="node">
<title>stage1_expert2_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="108865.5,-7205 108596.5,-7205 108596.5,-7153 108865.5,-7153 108865.5,-7205"/>
<text text-anchor="middle" x="108731" y="-7193" font-family="Arial" font-size="10.00">Expert 2 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="108731" y="-7182" font-family="Arial" font-size="10.00">GPUs: 132,133</text>
<text text-anchor="middle" x="108731" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="108731" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert3_qkv -->
<g id="node410" class="node">
<title>stage1_expert3_qkv</title>
<polygon fill="lightgreen" stroke="black" points="108578,-7205 108292,-7205 108292,-7153 108578,-7153 108578,-7205"/>
<text text-anchor="middle" x="108435" y="-7193" font-family="Arial" font-size="10.00">Expert 3 QKV Proj (TP)</text>
<text text-anchor="middle" x="108435" y="-7182" font-family="Arial" font-size="10.00">GPUs: 134,135</text>
<text text-anchor="middle" x="108435" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="108435" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert3_attn -->
<g id="node411" class="node">
<title>stage1_expert3_attn</title>
<polygon fill="lightgreen" stroke="black" points="108274,-7205 107988,-7205 107988,-7153 108274,-7153 108274,-7205"/>
<text text-anchor="middle" x="108131" y="-7193" font-family="Arial" font-size="10.00">Expert 3 Attention (TP)</text>
<text text-anchor="middle" x="108131" y="-7182" font-family="Arial" font-size="10.00">GPUs: 134,135</text>
<text text-anchor="middle" x="108131" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="108131" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert3_attn_out -->
<g id="node412" class="node">
<title>stage1_expert3_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="107970,-7205 107692,-7205 107692,-7153 107970,-7153 107970,-7205"/>
<text text-anchor="middle" x="107831" y="-7193" font-family="Arial" font-size="10.00">Expert 3 Attn Output (TP)</text>
<text text-anchor="middle" x="107831" y="-7182" font-family="Arial" font-size="10.00">GPUs: 134,135</text>
<text text-anchor="middle" x="107831" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="107831" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert3_mlp1 -->
<g id="node413" class="node">
<title>stage1_expert3_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="107674,-7205 107398,-7205 107398,-7153 107674,-7153 107674,-7205"/>
<text text-anchor="middle" x="107536" y="-7193" font-family="Arial" font-size="10.00">Expert 3 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="107536" y="-7182" font-family="Arial" font-size="10.00">GPUs: 134,135</text>
<text text-anchor="middle" x="107536" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="107536" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert3_mlp_act -->
<g id="node414" class="node">
<title>stage1_expert3_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="107380,-7205 107104,-7205 107104,-7153 107380,-7153 107380,-7205"/>
<text text-anchor="middle" x="107242" y="-7193" font-family="Arial" font-size="10.00">Expert 3 MLP GELU (TP)</text>
<text text-anchor="middle" x="107242" y="-7182" font-family="Arial" font-size="10.00">GPUs: 134,135</text>
<text text-anchor="middle" x="107242" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="107242" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert3_mlp2 -->
<g id="node415" class="node">
<title>stage1_expert3_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="107085.5,-7205 106816.5,-7205 106816.5,-7153 107085.5,-7153 107085.5,-7205"/>
<text text-anchor="middle" x="106951" y="-7193" font-family="Arial" font-size="10.00">Expert 3 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="106951" y="-7182" font-family="Arial" font-size="10.00">GPUs: 134,135</text>
<text text-anchor="middle" x="106951" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="106951" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert4_qkv -->
<g id="node416" class="node">
<title>stage1_expert4_qkv</title>
<polygon fill="lightgreen" stroke="black" points="106798,-7205 106512,-7205 106512,-7153 106798,-7153 106798,-7205"/>
<text text-anchor="middle" x="106655" y="-7193" font-family="Arial" font-size="10.00">Expert 4 QKV Proj (TP)</text>
<text text-anchor="middle" x="106655" y="-7182" font-family="Arial" font-size="10.00">GPUs: 136,137</text>
<text text-anchor="middle" x="106655" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="106655" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert4_attn -->
<g id="node417" class="node">
<title>stage1_expert4_attn</title>
<polygon fill="lightgreen" stroke="black" points="106494,-7205 106208,-7205 106208,-7153 106494,-7153 106494,-7205"/>
<text text-anchor="middle" x="106351" y="-7193" font-family="Arial" font-size="10.00">Expert 4 Attention (TP)</text>
<text text-anchor="middle" x="106351" y="-7182" font-family="Arial" font-size="10.00">GPUs: 136,137</text>
<text text-anchor="middle" x="106351" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="106351" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert4_attn_out -->
<g id="node418" class="node">
<title>stage1_expert4_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="106190,-7205 105912,-7205 105912,-7153 106190,-7153 106190,-7205"/>
<text text-anchor="middle" x="106051" y="-7193" font-family="Arial" font-size="10.00">Expert 4 Attn Output (TP)</text>
<text text-anchor="middle" x="106051" y="-7182" font-family="Arial" font-size="10.00">GPUs: 136,137</text>
<text text-anchor="middle" x="106051" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="106051" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert4_mlp1 -->
<g id="node419" class="node">
<title>stage1_expert4_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="105894,-7205 105618,-7205 105618,-7153 105894,-7153 105894,-7205"/>
<text text-anchor="middle" x="105756" y="-7193" font-family="Arial" font-size="10.00">Expert 4 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="105756" y="-7182" font-family="Arial" font-size="10.00">GPUs: 136,137</text>
<text text-anchor="middle" x="105756" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="105756" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert4_mlp_act -->
<g id="node420" class="node">
<title>stage1_expert4_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="105600,-7205 105324,-7205 105324,-7153 105600,-7153 105600,-7205"/>
<text text-anchor="middle" x="105462" y="-7193" font-family="Arial" font-size="10.00">Expert 4 MLP GELU (TP)</text>
<text text-anchor="middle" x="105462" y="-7182" font-family="Arial" font-size="10.00">GPUs: 136,137</text>
<text text-anchor="middle" x="105462" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="105462" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert4_mlp2 -->
<g id="node421" class="node">
<title>stage1_expert4_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="105305.5,-7205 105036.5,-7205 105036.5,-7153 105305.5,-7153 105305.5,-7205"/>
<text text-anchor="middle" x="105171" y="-7193" font-family="Arial" font-size="10.00">Expert 4 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="105171" y="-7182" font-family="Arial" font-size="10.00">GPUs: 136,137</text>
<text text-anchor="middle" x="105171" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="105171" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert5_qkv -->
<g id="node422" class="node">
<title>stage1_expert5_qkv</title>
<polygon fill="lightgreen" stroke="black" points="105018,-7205 104732,-7205 104732,-7153 105018,-7153 105018,-7205"/>
<text text-anchor="middle" x="104875" y="-7193" font-family="Arial" font-size="10.00">Expert 5 QKV Proj (TP)</text>
<text text-anchor="middle" x="104875" y="-7182" font-family="Arial" font-size="10.00">GPUs: 138,139</text>
<text text-anchor="middle" x="104875" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="104875" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert5_attn -->
<g id="node423" class="node">
<title>stage1_expert5_attn</title>
<polygon fill="lightgreen" stroke="black" points="104714,-7205 104428,-7205 104428,-7153 104714,-7153 104714,-7205"/>
<text text-anchor="middle" x="104571" y="-7193" font-family="Arial" font-size="10.00">Expert 5 Attention (TP)</text>
<text text-anchor="middle" x="104571" y="-7182" font-family="Arial" font-size="10.00">GPUs: 138,139</text>
<text text-anchor="middle" x="104571" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="104571" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert5_attn_out -->
<g id="node424" class="node">
<title>stage1_expert5_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="104410,-7205 104132,-7205 104132,-7153 104410,-7153 104410,-7205"/>
<text text-anchor="middle" x="104271" y="-7193" font-family="Arial" font-size="10.00">Expert 5 Attn Output (TP)</text>
<text text-anchor="middle" x="104271" y="-7182" font-family="Arial" font-size="10.00">GPUs: 138,139</text>
<text text-anchor="middle" x="104271" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="104271" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert5_mlp1 -->
<g id="node425" class="node">
<title>stage1_expert5_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="104114,-7205 103838,-7205 103838,-7153 104114,-7153 104114,-7205"/>
<text text-anchor="middle" x="103976" y="-7193" font-family="Arial" font-size="10.00">Expert 5 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="103976" y="-7182" font-family="Arial" font-size="10.00">GPUs: 138,139</text>
<text text-anchor="middle" x="103976" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="103976" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert5_mlp_act -->
<g id="node426" class="node">
<title>stage1_expert5_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="103820,-7205 103544,-7205 103544,-7153 103820,-7153 103820,-7205"/>
<text text-anchor="middle" x="103682" y="-7193" font-family="Arial" font-size="10.00">Expert 5 MLP GELU (TP)</text>
<text text-anchor="middle" x="103682" y="-7182" font-family="Arial" font-size="10.00">GPUs: 138,139</text>
<text text-anchor="middle" x="103682" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="103682" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert5_mlp2 -->
<g id="node427" class="node">
<title>stage1_expert5_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="103525.5,-7205 103256.5,-7205 103256.5,-7153 103525.5,-7153 103525.5,-7205"/>
<text text-anchor="middle" x="103391" y="-7193" font-family="Arial" font-size="10.00">Expert 5 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="103391" y="-7182" font-family="Arial" font-size="10.00">GPUs: 138,139</text>
<text text-anchor="middle" x="103391" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="103391" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert6_qkv -->
<g id="node428" class="node">
<title>stage1_expert6_qkv</title>
<polygon fill="lightgreen" stroke="black" points="103238,-7205 102952,-7205 102952,-7153 103238,-7153 103238,-7205"/>
<text text-anchor="middle" x="103095" y="-7193" font-family="Arial" font-size="10.00">Expert 6 QKV Proj (TP)</text>
<text text-anchor="middle" x="103095" y="-7182" font-family="Arial" font-size="10.00">GPUs: 140,141</text>
<text text-anchor="middle" x="103095" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="103095" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert6_attn -->
<g id="node429" class="node">
<title>stage1_expert6_attn</title>
<polygon fill="lightgreen" stroke="black" points="102934,-7205 102648,-7205 102648,-7153 102934,-7153 102934,-7205"/>
<text text-anchor="middle" x="102791" y="-7193" font-family="Arial" font-size="10.00">Expert 6 Attention (TP)</text>
<text text-anchor="middle" x="102791" y="-7182" font-family="Arial" font-size="10.00">GPUs: 140,141</text>
<text text-anchor="middle" x="102791" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="102791" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert6_attn_out -->
<g id="node430" class="node">
<title>stage1_expert6_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="102630,-7205 102352,-7205 102352,-7153 102630,-7153 102630,-7205"/>
<text text-anchor="middle" x="102491" y="-7193" font-family="Arial" font-size="10.00">Expert 6 Attn Output (TP)</text>
<text text-anchor="middle" x="102491" y="-7182" font-family="Arial" font-size="10.00">GPUs: 140,141</text>
<text text-anchor="middle" x="102491" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="102491" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert6_mlp1 -->
<g id="node431" class="node">
<title>stage1_expert6_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="102334,-7205 102058,-7205 102058,-7153 102334,-7153 102334,-7205"/>
<text text-anchor="middle" x="102196" y="-7193" font-family="Arial" font-size="10.00">Expert 6 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="102196" y="-7182" font-family="Arial" font-size="10.00">GPUs: 140,141</text>
<text text-anchor="middle" x="102196" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="102196" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert6_mlp_act -->
<g id="node432" class="node">
<title>stage1_expert6_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="102040,-7205 101764,-7205 101764,-7153 102040,-7153 102040,-7205"/>
<text text-anchor="middle" x="101902" y="-7193" font-family="Arial" font-size="10.00">Expert 6 MLP GELU (TP)</text>
<text text-anchor="middle" x="101902" y="-7182" font-family="Arial" font-size="10.00">GPUs: 140,141</text>
<text text-anchor="middle" x="101902" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="101902" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert6_mlp2 -->
<g id="node433" class="node">
<title>stage1_expert6_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="101745.5,-7205 101476.5,-7205 101476.5,-7153 101745.5,-7153 101745.5,-7205"/>
<text text-anchor="middle" x="101611" y="-7193" font-family="Arial" font-size="10.00">Expert 6 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="101611" y="-7182" font-family="Arial" font-size="10.00">GPUs: 140,141</text>
<text text-anchor="middle" x="101611" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="101611" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert7_qkv -->
<g id="node434" class="node">
<title>stage1_expert7_qkv</title>
<polygon fill="lightgreen" stroke="black" points="101458,-7205 101172,-7205 101172,-7153 101458,-7153 101458,-7205"/>
<text text-anchor="middle" x="101315" y="-7193" font-family="Arial" font-size="10.00">Expert 7 QKV Proj (TP)</text>
<text text-anchor="middle" x="101315" y="-7182" font-family="Arial" font-size="10.00">GPUs: 142,143</text>
<text text-anchor="middle" x="101315" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="101315" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert7_attn -->
<g id="node435" class="node">
<title>stage1_expert7_attn</title>
<polygon fill="lightgreen" stroke="black" points="101154,-7205 100868,-7205 100868,-7153 101154,-7153 101154,-7205"/>
<text text-anchor="middle" x="101011" y="-7193" font-family="Arial" font-size="10.00">Expert 7 Attention (TP)</text>
<text text-anchor="middle" x="101011" y="-7182" font-family="Arial" font-size="10.00">GPUs: 142,143</text>
<text text-anchor="middle" x="101011" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="101011" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert7_attn_out -->
<g id="node436" class="node">
<title>stage1_expert7_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="100850,-7205 100572,-7205 100572,-7153 100850,-7153 100850,-7205"/>
<text text-anchor="middle" x="100711" y="-7193" font-family="Arial" font-size="10.00">Expert 7 Attn Output (TP)</text>
<text text-anchor="middle" x="100711" y="-7182" font-family="Arial" font-size="10.00">GPUs: 142,143</text>
<text text-anchor="middle" x="100711" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="100711" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert7_mlp1 -->
<g id="node437" class="node">
<title>stage1_expert7_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="100554,-7205 100278,-7205 100278,-7153 100554,-7153 100554,-7205"/>
<text text-anchor="middle" x="100416" y="-7193" font-family="Arial" font-size="10.00">Expert 7 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="100416" y="-7182" font-family="Arial" font-size="10.00">GPUs: 142,143</text>
<text text-anchor="middle" x="100416" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="100416" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert7_mlp_act -->
<g id="node438" class="node">
<title>stage1_expert7_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="100260,-7205 99984,-7205 99984,-7153 100260,-7153 100260,-7205"/>
<text text-anchor="middle" x="100122" y="-7193" font-family="Arial" font-size="10.00">Expert 7 MLP GELU (TP)</text>
<text text-anchor="middle" x="100122" y="-7182" font-family="Arial" font-size="10.00">GPUs: 142,143</text>
<text text-anchor="middle" x="100122" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="100122" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert7_mlp2 -->
<g id="node439" class="node">
<title>stage1_expert7_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="99965.5,-7205 99696.5,-7205 99696.5,-7153 99965.5,-7153 99965.5,-7205"/>
<text text-anchor="middle" x="99831" y="-7193" font-family="Arial" font-size="10.00">Expert 7 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="99831" y="-7182" font-family="Arial" font-size="10.00">GPUs: 142,143</text>
<text text-anchor="middle" x="99831" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="99831" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert8_qkv -->
<g id="node440" class="node">
<title>stage1_expert8_qkv</title>
<polygon fill="lightgreen" stroke="black" points="99678,-7205 99392,-7205 99392,-7153 99678,-7153 99678,-7205"/>
<text text-anchor="middle" x="99535" y="-7193" font-family="Arial" font-size="10.00">Expert 8 QKV Proj (TP)</text>
<text text-anchor="middle" x="99535" y="-7182" font-family="Arial" font-size="10.00">GPUs: 144,145</text>
<text text-anchor="middle" x="99535" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="99535" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert8_attn -->
<g id="node441" class="node">
<title>stage1_expert8_attn</title>
<polygon fill="lightgreen" stroke="black" points="99374,-7205 99088,-7205 99088,-7153 99374,-7153 99374,-7205"/>
<text text-anchor="middle" x="99231" y="-7193" font-family="Arial" font-size="10.00">Expert 8 Attention (TP)</text>
<text text-anchor="middle" x="99231" y="-7182" font-family="Arial" font-size="10.00">GPUs: 144,145</text>
<text text-anchor="middle" x="99231" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="99231" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert8_attn_out -->
<g id="node442" class="node">
<title>stage1_expert8_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="99070,-7205 98792,-7205 98792,-7153 99070,-7153 99070,-7205"/>
<text text-anchor="middle" x="98931" y="-7193" font-family="Arial" font-size="10.00">Expert 8 Attn Output (TP)</text>
<text text-anchor="middle" x="98931" y="-7182" font-family="Arial" font-size="10.00">GPUs: 144,145</text>
<text text-anchor="middle" x="98931" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="98931" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert8_mlp1 -->
<g id="node443" class="node">
<title>stage1_expert8_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="98774,-7205 98498,-7205 98498,-7153 98774,-7153 98774,-7205"/>
<text text-anchor="middle" x="98636" y="-7193" font-family="Arial" font-size="10.00">Expert 8 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="98636" y="-7182" font-family="Arial" font-size="10.00">GPUs: 144,145</text>
<text text-anchor="middle" x="98636" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="98636" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert8_mlp_act -->
<g id="node444" class="node">
<title>stage1_expert8_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="98480,-7205 98204,-7205 98204,-7153 98480,-7153 98480,-7205"/>
<text text-anchor="middle" x="98342" y="-7193" font-family="Arial" font-size="10.00">Expert 8 MLP GELU (TP)</text>
<text text-anchor="middle" x="98342" y="-7182" font-family="Arial" font-size="10.00">GPUs: 144,145</text>
<text text-anchor="middle" x="98342" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="98342" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert8_mlp2 -->
<g id="node445" class="node">
<title>stage1_expert8_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="98185.5,-7205 97916.5,-7205 97916.5,-7153 98185.5,-7153 98185.5,-7205"/>
<text text-anchor="middle" x="98051" y="-7193" font-family="Arial" font-size="10.00">Expert 8 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="98051" y="-7182" font-family="Arial" font-size="10.00">GPUs: 144,145</text>
<text text-anchor="middle" x="98051" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="98051" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert9_qkv -->
<g id="node446" class="node">
<title>stage1_expert9_qkv</title>
<polygon fill="lightgreen" stroke="black" points="97898,-7205 97612,-7205 97612,-7153 97898,-7153 97898,-7205"/>
<text text-anchor="middle" x="97755" y="-7193" font-family="Arial" font-size="10.00">Expert 9 QKV Proj (TP)</text>
<text text-anchor="middle" x="97755" y="-7182" font-family="Arial" font-size="10.00">GPUs: 146,147</text>
<text text-anchor="middle" x="97755" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="97755" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert9_attn -->
<g id="node447" class="node">
<title>stage1_expert9_attn</title>
<polygon fill="lightgreen" stroke="black" points="97594,-7205 97308,-7205 97308,-7153 97594,-7153 97594,-7205"/>
<text text-anchor="middle" x="97451" y="-7193" font-family="Arial" font-size="10.00">Expert 9 Attention (TP)</text>
<text text-anchor="middle" x="97451" y="-7182" font-family="Arial" font-size="10.00">GPUs: 146,147</text>
<text text-anchor="middle" x="97451" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="97451" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert9_attn_out -->
<g id="node448" class="node">
<title>stage1_expert9_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="97290,-7205 97012,-7205 97012,-7153 97290,-7153 97290,-7205"/>
<text text-anchor="middle" x="97151" y="-7193" font-family="Arial" font-size="10.00">Expert 9 Attn Output (TP)</text>
<text text-anchor="middle" x="97151" y="-7182" font-family="Arial" font-size="10.00">GPUs: 146,147</text>
<text text-anchor="middle" x="97151" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="97151" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert9_mlp1 -->
<g id="node449" class="node">
<title>stage1_expert9_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="96994,-7205 96718,-7205 96718,-7153 96994,-7153 96994,-7205"/>
<text text-anchor="middle" x="96856" y="-7193" font-family="Arial" font-size="10.00">Expert 9 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="96856" y="-7182" font-family="Arial" font-size="10.00">GPUs: 146,147</text>
<text text-anchor="middle" x="96856" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="96856" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert9_mlp_act -->
<g id="node450" class="node">
<title>stage1_expert9_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="96700,-7205 96424,-7205 96424,-7153 96700,-7153 96700,-7205"/>
<text text-anchor="middle" x="96562" y="-7193" font-family="Arial" font-size="10.00">Expert 9 MLP GELU (TP)</text>
<text text-anchor="middle" x="96562" y="-7182" font-family="Arial" font-size="10.00">GPUs: 146,147</text>
<text text-anchor="middle" x="96562" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="96562" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert9_mlp2 -->
<g id="node451" class="node">
<title>stage1_expert9_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="96405.5,-7205 96136.5,-7205 96136.5,-7153 96405.5,-7153 96405.5,-7205"/>
<text text-anchor="middle" x="96271" y="-7193" font-family="Arial" font-size="10.00">Expert 9 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="96271" y="-7182" font-family="Arial" font-size="10.00">GPUs: 146,147</text>
<text text-anchor="middle" x="96271" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="96271" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert10_qkv -->
<g id="node452" class="node">
<title>stage1_expert10_qkv</title>
<polygon fill="lightgreen" stroke="black" points="96118,-7205 95832,-7205 95832,-7153 96118,-7153 96118,-7205"/>
<text text-anchor="middle" x="95975" y="-7193" font-family="Arial" font-size="10.00">Expert 10 QKV Proj (TP)</text>
<text text-anchor="middle" x="95975" y="-7182" font-family="Arial" font-size="10.00">GPUs: 148,149</text>
<text text-anchor="middle" x="95975" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="95975" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert10_attn -->
<g id="node453" class="node">
<title>stage1_expert10_attn</title>
<polygon fill="lightgreen" stroke="black" points="95814,-7205 95528,-7205 95528,-7153 95814,-7153 95814,-7205"/>
<text text-anchor="middle" x="95671" y="-7193" font-family="Arial" font-size="10.00">Expert 10 Attention (TP)</text>
<text text-anchor="middle" x="95671" y="-7182" font-family="Arial" font-size="10.00">GPUs: 148,149</text>
<text text-anchor="middle" x="95671" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="95671" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert10_attn_out -->
<g id="node454" class="node">
<title>stage1_expert10_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="95510,-7205 95232,-7205 95232,-7153 95510,-7153 95510,-7205"/>
<text text-anchor="middle" x="95371" y="-7193" font-family="Arial" font-size="10.00">Expert 10 Attn Output (TP)</text>
<text text-anchor="middle" x="95371" y="-7182" font-family="Arial" font-size="10.00">GPUs: 148,149</text>
<text text-anchor="middle" x="95371" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="95371" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert10_mlp1 -->
<g id="node455" class="node">
<title>stage1_expert10_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="95214,-7205 94938,-7205 94938,-7153 95214,-7153 95214,-7205"/>
<text text-anchor="middle" x="95076" y="-7193" font-family="Arial" font-size="10.00">Expert 10 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="95076" y="-7182" font-family="Arial" font-size="10.00">GPUs: 148,149</text>
<text text-anchor="middle" x="95076" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="95076" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert10_mlp_act -->
<g id="node456" class="node">
<title>stage1_expert10_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="94920,-7205 94644,-7205 94644,-7153 94920,-7153 94920,-7205"/>
<text text-anchor="middle" x="94782" y="-7193" font-family="Arial" font-size="10.00">Expert 10 MLP GELU (TP)</text>
<text text-anchor="middle" x="94782" y="-7182" font-family="Arial" font-size="10.00">GPUs: 148,149</text>
<text text-anchor="middle" x="94782" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="94782" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert10_mlp2 -->
<g id="node457" class="node">
<title>stage1_expert10_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="94625.5,-7205 94356.5,-7205 94356.5,-7153 94625.5,-7153 94625.5,-7205"/>
<text text-anchor="middle" x="94491" y="-7193" font-family="Arial" font-size="10.00">Expert 10 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="94491" y="-7182" font-family="Arial" font-size="10.00">GPUs: 148,149</text>
<text text-anchor="middle" x="94491" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="94491" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert11_qkv -->
<g id="node458" class="node">
<title>stage1_expert11_qkv</title>
<polygon fill="lightgreen" stroke="black" points="94338,-7205 94052,-7205 94052,-7153 94338,-7153 94338,-7205"/>
<text text-anchor="middle" x="94195" y="-7193" font-family="Arial" font-size="10.00">Expert 11 QKV Proj (TP)</text>
<text text-anchor="middle" x="94195" y="-7182" font-family="Arial" font-size="10.00">GPUs: 150,151</text>
<text text-anchor="middle" x="94195" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="94195" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert11_attn -->
<g id="node459" class="node">
<title>stage1_expert11_attn</title>
<polygon fill="lightgreen" stroke="black" points="94034,-7205 93748,-7205 93748,-7153 94034,-7153 94034,-7205"/>
<text text-anchor="middle" x="93891" y="-7193" font-family="Arial" font-size="10.00">Expert 11 Attention (TP)</text>
<text text-anchor="middle" x="93891" y="-7182" font-family="Arial" font-size="10.00">GPUs: 150,151</text>
<text text-anchor="middle" x="93891" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="93891" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert11_attn_out -->
<g id="node460" class="node">
<title>stage1_expert11_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="93730,-7205 93452,-7205 93452,-7153 93730,-7153 93730,-7205"/>
<text text-anchor="middle" x="93591" y="-7193" font-family="Arial" font-size="10.00">Expert 11 Attn Output (TP)</text>
<text text-anchor="middle" x="93591" y="-7182" font-family="Arial" font-size="10.00">GPUs: 150,151</text>
<text text-anchor="middle" x="93591" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="93591" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert11_mlp1 -->
<g id="node461" class="node">
<title>stage1_expert11_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="93434,-7205 93158,-7205 93158,-7153 93434,-7153 93434,-7205"/>
<text text-anchor="middle" x="93296" y="-7193" font-family="Arial" font-size="10.00">Expert 11 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="93296" y="-7182" font-family="Arial" font-size="10.00">GPUs: 150,151</text>
<text text-anchor="middle" x="93296" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="93296" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert11_mlp_act -->
<g id="node462" class="node">
<title>stage1_expert11_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="93140,-7205 92864,-7205 92864,-7153 93140,-7153 93140,-7205"/>
<text text-anchor="middle" x="93002" y="-7193" font-family="Arial" font-size="10.00">Expert 11 MLP GELU (TP)</text>
<text text-anchor="middle" x="93002" y="-7182" font-family="Arial" font-size="10.00">GPUs: 150,151</text>
<text text-anchor="middle" x="93002" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="93002" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert11_mlp2 -->
<g id="node463" class="node">
<title>stage1_expert11_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="92845.5,-7205 92576.5,-7205 92576.5,-7153 92845.5,-7153 92845.5,-7205"/>
<text text-anchor="middle" x="92711" y="-7193" font-family="Arial" font-size="10.00">Expert 11 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="92711" y="-7182" font-family="Arial" font-size="10.00">GPUs: 150,151</text>
<text text-anchor="middle" x="92711" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="92711" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert12_qkv -->
<g id="node464" class="node">
<title>stage1_expert12_qkv</title>
<polygon fill="lightgreen" stroke="black" points="92558,-7205 92272,-7205 92272,-7153 92558,-7153 92558,-7205"/>
<text text-anchor="middle" x="92415" y="-7193" font-family="Arial" font-size="10.00">Expert 12 QKV Proj (TP)</text>
<text text-anchor="middle" x="92415" y="-7182" font-family="Arial" font-size="10.00">GPUs: 152,153</text>
<text text-anchor="middle" x="92415" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="92415" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert12_attn -->
<g id="node465" class="node">
<title>stage1_expert12_attn</title>
<polygon fill="lightgreen" stroke="black" points="92254,-7205 91968,-7205 91968,-7153 92254,-7153 92254,-7205"/>
<text text-anchor="middle" x="92111" y="-7193" font-family="Arial" font-size="10.00">Expert 12 Attention (TP)</text>
<text text-anchor="middle" x="92111" y="-7182" font-family="Arial" font-size="10.00">GPUs: 152,153</text>
<text text-anchor="middle" x="92111" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="92111" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert12_attn_out -->
<g id="node466" class="node">
<title>stage1_expert12_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="91950,-7205 91672,-7205 91672,-7153 91950,-7153 91950,-7205"/>
<text text-anchor="middle" x="91811" y="-7193" font-family="Arial" font-size="10.00">Expert 12 Attn Output (TP)</text>
<text text-anchor="middle" x="91811" y="-7182" font-family="Arial" font-size="10.00">GPUs: 152,153</text>
<text text-anchor="middle" x="91811" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="91811" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert12_mlp1 -->
<g id="node467" class="node">
<title>stage1_expert12_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="91654,-7205 91378,-7205 91378,-7153 91654,-7153 91654,-7205"/>
<text text-anchor="middle" x="91516" y="-7193" font-family="Arial" font-size="10.00">Expert 12 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="91516" y="-7182" font-family="Arial" font-size="10.00">GPUs: 152,153</text>
<text text-anchor="middle" x="91516" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="91516" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert12_mlp_act -->
<g id="node468" class="node">
<title>stage1_expert12_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="91360,-7205 91084,-7205 91084,-7153 91360,-7153 91360,-7205"/>
<text text-anchor="middle" x="91222" y="-7193" font-family="Arial" font-size="10.00">Expert 12 MLP GELU (TP)</text>
<text text-anchor="middle" x="91222" y="-7182" font-family="Arial" font-size="10.00">GPUs: 152,153</text>
<text text-anchor="middle" x="91222" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="91222" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert12_mlp2 -->
<g id="node469" class="node">
<title>stage1_expert12_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="91065.5,-7205 90796.5,-7205 90796.5,-7153 91065.5,-7153 91065.5,-7205"/>
<text text-anchor="middle" x="90931" y="-7193" font-family="Arial" font-size="10.00">Expert 12 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="90931" y="-7182" font-family="Arial" font-size="10.00">GPUs: 152,153</text>
<text text-anchor="middle" x="90931" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="90931" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert13_qkv -->
<g id="node470" class="node">
<title>stage1_expert13_qkv</title>
<polygon fill="lightgreen" stroke="black" points="90778,-7205 90492,-7205 90492,-7153 90778,-7153 90778,-7205"/>
<text text-anchor="middle" x="90635" y="-7193" font-family="Arial" font-size="10.00">Expert 13 QKV Proj (TP)</text>
<text text-anchor="middle" x="90635" y="-7182" font-family="Arial" font-size="10.00">GPUs: 154,155</text>
<text text-anchor="middle" x="90635" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="90635" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert13_attn -->
<g id="node471" class="node">
<title>stage1_expert13_attn</title>
<polygon fill="lightgreen" stroke="black" points="90474,-7205 90188,-7205 90188,-7153 90474,-7153 90474,-7205"/>
<text text-anchor="middle" x="90331" y="-7193" font-family="Arial" font-size="10.00">Expert 13 Attention (TP)</text>
<text text-anchor="middle" x="90331" y="-7182" font-family="Arial" font-size="10.00">GPUs: 154,155</text>
<text text-anchor="middle" x="90331" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="90331" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert13_attn_out -->
<g id="node472" class="node">
<title>stage1_expert13_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="90170,-7205 89892,-7205 89892,-7153 90170,-7153 90170,-7205"/>
<text text-anchor="middle" x="90031" y="-7193" font-family="Arial" font-size="10.00">Expert 13 Attn Output (TP)</text>
<text text-anchor="middle" x="90031" y="-7182" font-family="Arial" font-size="10.00">GPUs: 154,155</text>
<text text-anchor="middle" x="90031" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="90031" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert13_mlp1 -->
<g id="node473" class="node">
<title>stage1_expert13_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="89874,-7205 89598,-7205 89598,-7153 89874,-7153 89874,-7205"/>
<text text-anchor="middle" x="89736" y="-7193" font-family="Arial" font-size="10.00">Expert 13 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="89736" y="-7182" font-family="Arial" font-size="10.00">GPUs: 154,155</text>
<text text-anchor="middle" x="89736" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="89736" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert13_mlp_act -->
<g id="node474" class="node">
<title>stage1_expert13_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="89580,-7205 89304,-7205 89304,-7153 89580,-7153 89580,-7205"/>
<text text-anchor="middle" x="89442" y="-7193" font-family="Arial" font-size="10.00">Expert 13 MLP GELU (TP)</text>
<text text-anchor="middle" x="89442" y="-7182" font-family="Arial" font-size="10.00">GPUs: 154,155</text>
<text text-anchor="middle" x="89442" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="89442" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert13_mlp2 -->
<g id="node475" class="node">
<title>stage1_expert13_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="89285.5,-7205 89016.5,-7205 89016.5,-7153 89285.5,-7153 89285.5,-7205"/>
<text text-anchor="middle" x="89151" y="-7193" font-family="Arial" font-size="10.00">Expert 13 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="89151" y="-7182" font-family="Arial" font-size="10.00">GPUs: 154,155</text>
<text text-anchor="middle" x="89151" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="89151" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert14_qkv -->
<g id="node476" class="node">
<title>stage1_expert14_qkv</title>
<polygon fill="lightgreen" stroke="black" points="88998,-7205 88712,-7205 88712,-7153 88998,-7153 88998,-7205"/>
<text text-anchor="middle" x="88855" y="-7193" font-family="Arial" font-size="10.00">Expert 14 QKV Proj (TP)</text>
<text text-anchor="middle" x="88855" y="-7182" font-family="Arial" font-size="10.00">GPUs: 156,157</text>
<text text-anchor="middle" x="88855" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="88855" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert14_attn -->
<g id="node477" class="node">
<title>stage1_expert14_attn</title>
<polygon fill="lightgreen" stroke="black" points="88694,-7205 88408,-7205 88408,-7153 88694,-7153 88694,-7205"/>
<text text-anchor="middle" x="88551" y="-7193" font-family="Arial" font-size="10.00">Expert 14 Attention (TP)</text>
<text text-anchor="middle" x="88551" y="-7182" font-family="Arial" font-size="10.00">GPUs: 156,157</text>
<text text-anchor="middle" x="88551" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="88551" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert14_attn_out -->
<g id="node478" class="node">
<title>stage1_expert14_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="88390,-7205 88112,-7205 88112,-7153 88390,-7153 88390,-7205"/>
<text text-anchor="middle" x="88251" y="-7193" font-family="Arial" font-size="10.00">Expert 14 Attn Output (TP)</text>
<text text-anchor="middle" x="88251" y="-7182" font-family="Arial" font-size="10.00">GPUs: 156,157</text>
<text text-anchor="middle" x="88251" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="88251" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert14_mlp1 -->
<g id="node479" class="node">
<title>stage1_expert14_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="88094,-7205 87818,-7205 87818,-7153 88094,-7153 88094,-7205"/>
<text text-anchor="middle" x="87956" y="-7193" font-family="Arial" font-size="10.00">Expert 14 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="87956" y="-7182" font-family="Arial" font-size="10.00">GPUs: 156,157</text>
<text text-anchor="middle" x="87956" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="87956" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert14_mlp_act -->
<g id="node480" class="node">
<title>stage1_expert14_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="87800,-7205 87524,-7205 87524,-7153 87800,-7153 87800,-7205"/>
<text text-anchor="middle" x="87662" y="-7193" font-family="Arial" font-size="10.00">Expert 14 MLP GELU (TP)</text>
<text text-anchor="middle" x="87662" y="-7182" font-family="Arial" font-size="10.00">GPUs: 156,157</text>
<text text-anchor="middle" x="87662" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="87662" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert14_mlp2 -->
<g id="node481" class="node">
<title>stage1_expert14_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="87505.5,-7205 87236.5,-7205 87236.5,-7153 87505.5,-7153 87505.5,-7205"/>
<text text-anchor="middle" x="87371" y="-7193" font-family="Arial" font-size="10.00">Expert 14 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="87371" y="-7182" font-family="Arial" font-size="10.00">GPUs: 156,157</text>
<text text-anchor="middle" x="87371" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="87371" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert15_qkv -->
<g id="node482" class="node">
<title>stage1_expert15_qkv</title>
<polygon fill="lightgreen" stroke="black" points="87218,-7205 86932,-7205 86932,-7153 87218,-7153 87218,-7205"/>
<text text-anchor="middle" x="87075" y="-7193" font-family="Arial" font-size="10.00">Expert 15 QKV Proj (TP)</text>
<text text-anchor="middle" x="87075" y="-7182" font-family="Arial" font-size="10.00">GPUs: 158,159</text>
<text text-anchor="middle" x="87075" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="87075" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert15_attn -->
<g id="node483" class="node">
<title>stage1_expert15_attn</title>
<polygon fill="lightgreen" stroke="black" points="86914,-7205 86628,-7205 86628,-7153 86914,-7153 86914,-7205"/>
<text text-anchor="middle" x="86771" y="-7193" font-family="Arial" font-size="10.00">Expert 15 Attention (TP)</text>
<text text-anchor="middle" x="86771" y="-7182" font-family="Arial" font-size="10.00">GPUs: 158,159</text>
<text text-anchor="middle" x="86771" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="86771" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert15_attn_out -->
<g id="node484" class="node">
<title>stage1_expert15_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="86610,-7205 86332,-7205 86332,-7153 86610,-7153 86610,-7205"/>
<text text-anchor="middle" x="86471" y="-7193" font-family="Arial" font-size="10.00">Expert 15 Attn Output (TP)</text>
<text text-anchor="middle" x="86471" y="-7182" font-family="Arial" font-size="10.00">GPUs: 158,159</text>
<text text-anchor="middle" x="86471" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="86471" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert15_mlp1 -->
<g id="node485" class="node">
<title>stage1_expert15_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="86314,-7205 86038,-7205 86038,-7153 86314,-7153 86314,-7205"/>
<text text-anchor="middle" x="86176" y="-7193" font-family="Arial" font-size="10.00">Expert 15 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="86176" y="-7182" font-family="Arial" font-size="10.00">GPUs: 158,159</text>
<text text-anchor="middle" x="86176" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="86176" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert15_mlp_act -->
<g id="node486" class="node">
<title>stage1_expert15_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="86020,-7205 85744,-7205 85744,-7153 86020,-7153 86020,-7205"/>
<text text-anchor="middle" x="85882" y="-7193" font-family="Arial" font-size="10.00">Expert 15 MLP GELU (TP)</text>
<text text-anchor="middle" x="85882" y="-7182" font-family="Arial" font-size="10.00">GPUs: 158,159</text>
<text text-anchor="middle" x="85882" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="85882" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert15_mlp2 -->
<g id="node487" class="node">
<title>stage1_expert15_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="85725.5,-7205 85456.5,-7205 85456.5,-7153 85725.5,-7153 85725.5,-7205"/>
<text text-anchor="middle" x="85591" y="-7193" font-family="Arial" font-size="10.00">Expert 15 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="85591" y="-7182" font-family="Arial" font-size="10.00">GPUs: 158,159</text>
<text text-anchor="middle" x="85591" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="85591" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert16_qkv -->
<g id="node488" class="node">
<title>stage1_expert16_qkv</title>
<polygon fill="lightgreen" stroke="black" points="85438,-7205 85152,-7205 85152,-7153 85438,-7153 85438,-7205"/>
<text text-anchor="middle" x="85295" y="-7193" font-family="Arial" font-size="10.00">Expert 16 QKV Proj (TP)</text>
<text text-anchor="middle" x="85295" y="-7182" font-family="Arial" font-size="10.00">GPUs: 160,161</text>
<text text-anchor="middle" x="85295" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="85295" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert16_attn -->
<g id="node489" class="node">
<title>stage1_expert16_attn</title>
<polygon fill="lightgreen" stroke="black" points="85134,-7205 84848,-7205 84848,-7153 85134,-7153 85134,-7205"/>
<text text-anchor="middle" x="84991" y="-7193" font-family="Arial" font-size="10.00">Expert 16 Attention (TP)</text>
<text text-anchor="middle" x="84991" y="-7182" font-family="Arial" font-size="10.00">GPUs: 160,161</text>
<text text-anchor="middle" x="84991" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="84991" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert16_attn_out -->
<g id="node490" class="node">
<title>stage1_expert16_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="84830,-7205 84552,-7205 84552,-7153 84830,-7153 84830,-7205"/>
<text text-anchor="middle" x="84691" y="-7193" font-family="Arial" font-size="10.00">Expert 16 Attn Output (TP)</text>
<text text-anchor="middle" x="84691" y="-7182" font-family="Arial" font-size="10.00">GPUs: 160,161</text>
<text text-anchor="middle" x="84691" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="84691" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert16_mlp1 -->
<g id="node491" class="node">
<title>stage1_expert16_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="84534,-7205 84258,-7205 84258,-7153 84534,-7153 84534,-7205"/>
<text text-anchor="middle" x="84396" y="-7193" font-family="Arial" font-size="10.00">Expert 16 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="84396" y="-7182" font-family="Arial" font-size="10.00">GPUs: 160,161</text>
<text text-anchor="middle" x="84396" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="84396" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert16_mlp_act -->
<g id="node492" class="node">
<title>stage1_expert16_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="84240,-7205 83964,-7205 83964,-7153 84240,-7153 84240,-7205"/>
<text text-anchor="middle" x="84102" y="-7193" font-family="Arial" font-size="10.00">Expert 16 MLP GELU (TP)</text>
<text text-anchor="middle" x="84102" y="-7182" font-family="Arial" font-size="10.00">GPUs: 160,161</text>
<text text-anchor="middle" x="84102" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="84102" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert16_mlp2 -->
<g id="node493" class="node">
<title>stage1_expert16_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="83945.5,-7205 83676.5,-7205 83676.5,-7153 83945.5,-7153 83945.5,-7205"/>
<text text-anchor="middle" x="83811" y="-7193" font-family="Arial" font-size="10.00">Expert 16 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="83811" y="-7182" font-family="Arial" font-size="10.00">GPUs: 160,161</text>
<text text-anchor="middle" x="83811" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="83811" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert17_qkv -->
<g id="node494" class="node">
<title>stage1_expert17_qkv</title>
<polygon fill="lightgreen" stroke="black" points="83658,-7205 83372,-7205 83372,-7153 83658,-7153 83658,-7205"/>
<text text-anchor="middle" x="83515" y="-7193" font-family="Arial" font-size="10.00">Expert 17 QKV Proj (TP)</text>
<text text-anchor="middle" x="83515" y="-7182" font-family="Arial" font-size="10.00">GPUs: 162,163</text>
<text text-anchor="middle" x="83515" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="83515" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert17_attn -->
<g id="node495" class="node">
<title>stage1_expert17_attn</title>
<polygon fill="lightgreen" stroke="black" points="83354,-7205 83068,-7205 83068,-7153 83354,-7153 83354,-7205"/>
<text text-anchor="middle" x="83211" y="-7193" font-family="Arial" font-size="10.00">Expert 17 Attention (TP)</text>
<text text-anchor="middle" x="83211" y="-7182" font-family="Arial" font-size="10.00">GPUs: 162,163</text>
<text text-anchor="middle" x="83211" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="83211" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert17_attn_out -->
<g id="node496" class="node">
<title>stage1_expert17_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="83050,-7205 82772,-7205 82772,-7153 83050,-7153 83050,-7205"/>
<text text-anchor="middle" x="82911" y="-7193" font-family="Arial" font-size="10.00">Expert 17 Attn Output (TP)</text>
<text text-anchor="middle" x="82911" y="-7182" font-family="Arial" font-size="10.00">GPUs: 162,163</text>
<text text-anchor="middle" x="82911" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="82911" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert17_mlp1 -->
<g id="node497" class="node">
<title>stage1_expert17_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="82754,-7205 82478,-7205 82478,-7153 82754,-7153 82754,-7205"/>
<text text-anchor="middle" x="82616" y="-7193" font-family="Arial" font-size="10.00">Expert 17 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="82616" y="-7182" font-family="Arial" font-size="10.00">GPUs: 162,163</text>
<text text-anchor="middle" x="82616" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="82616" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert17_mlp_act -->
<g id="node498" class="node">
<title>stage1_expert17_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="82460,-7205 82184,-7205 82184,-7153 82460,-7153 82460,-7205"/>
<text text-anchor="middle" x="82322" y="-7193" font-family="Arial" font-size="10.00">Expert 17 MLP GELU (TP)</text>
<text text-anchor="middle" x="82322" y="-7182" font-family="Arial" font-size="10.00">GPUs: 162,163</text>
<text text-anchor="middle" x="82322" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="82322" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert17_mlp2 -->
<g id="node499" class="node">
<title>stage1_expert17_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="82165.5,-7205 81896.5,-7205 81896.5,-7153 82165.5,-7153 82165.5,-7205"/>
<text text-anchor="middle" x="82031" y="-7193" font-family="Arial" font-size="10.00">Expert 17 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="82031" y="-7182" font-family="Arial" font-size="10.00">GPUs: 162,163</text>
<text text-anchor="middle" x="82031" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="82031" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert18_qkv -->
<g id="node500" class="node">
<title>stage1_expert18_qkv</title>
<polygon fill="lightgreen" stroke="black" points="81878,-7205 81592,-7205 81592,-7153 81878,-7153 81878,-7205"/>
<text text-anchor="middle" x="81735" y="-7193" font-family="Arial" font-size="10.00">Expert 18 QKV Proj (TP)</text>
<text text-anchor="middle" x="81735" y="-7182" font-family="Arial" font-size="10.00">GPUs: 164,165</text>
<text text-anchor="middle" x="81735" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="81735" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert18_attn -->
<g id="node501" class="node">
<title>stage1_expert18_attn</title>
<polygon fill="lightgreen" stroke="black" points="81574,-7205 81288,-7205 81288,-7153 81574,-7153 81574,-7205"/>
<text text-anchor="middle" x="81431" y="-7193" font-family="Arial" font-size="10.00">Expert 18 Attention (TP)</text>
<text text-anchor="middle" x="81431" y="-7182" font-family="Arial" font-size="10.00">GPUs: 164,165</text>
<text text-anchor="middle" x="81431" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="81431" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert18_attn_out -->
<g id="node502" class="node">
<title>stage1_expert18_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="81270,-7205 80992,-7205 80992,-7153 81270,-7153 81270,-7205"/>
<text text-anchor="middle" x="81131" y="-7193" font-family="Arial" font-size="10.00">Expert 18 Attn Output (TP)</text>
<text text-anchor="middle" x="81131" y="-7182" font-family="Arial" font-size="10.00">GPUs: 164,165</text>
<text text-anchor="middle" x="81131" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="81131" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert18_mlp1 -->
<g id="node503" class="node">
<title>stage1_expert18_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="80974,-7205 80698,-7205 80698,-7153 80974,-7153 80974,-7205"/>
<text text-anchor="middle" x="80836" y="-7193" font-family="Arial" font-size="10.00">Expert 18 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="80836" y="-7182" font-family="Arial" font-size="10.00">GPUs: 164,165</text>
<text text-anchor="middle" x="80836" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="80836" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert18_mlp_act -->
<g id="node504" class="node">
<title>stage1_expert18_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="80680,-7205 80404,-7205 80404,-7153 80680,-7153 80680,-7205"/>
<text text-anchor="middle" x="80542" y="-7193" font-family="Arial" font-size="10.00">Expert 18 MLP GELU (TP)</text>
<text text-anchor="middle" x="80542" y="-7182" font-family="Arial" font-size="10.00">GPUs: 164,165</text>
<text text-anchor="middle" x="80542" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="80542" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert18_mlp2 -->
<g id="node505" class="node">
<title>stage1_expert18_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="80385.5,-7205 80116.5,-7205 80116.5,-7153 80385.5,-7153 80385.5,-7205"/>
<text text-anchor="middle" x="80251" y="-7193" font-family="Arial" font-size="10.00">Expert 18 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="80251" y="-7182" font-family="Arial" font-size="10.00">GPUs: 164,165</text>
<text text-anchor="middle" x="80251" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="80251" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert19_qkv -->
<g id="node506" class="node">
<title>stage1_expert19_qkv</title>
<polygon fill="lightgreen" stroke="black" points="80098,-7205 79812,-7205 79812,-7153 80098,-7153 80098,-7205"/>
<text text-anchor="middle" x="79955" y="-7193" font-family="Arial" font-size="10.00">Expert 19 QKV Proj (TP)</text>
<text text-anchor="middle" x="79955" y="-7182" font-family="Arial" font-size="10.00">GPUs: 166,167</text>
<text text-anchor="middle" x="79955" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="79955" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert19_attn -->
<g id="node507" class="node">
<title>stage1_expert19_attn</title>
<polygon fill="lightgreen" stroke="black" points="79794,-7205 79508,-7205 79508,-7153 79794,-7153 79794,-7205"/>
<text text-anchor="middle" x="79651" y="-7193" font-family="Arial" font-size="10.00">Expert 19 Attention (TP)</text>
<text text-anchor="middle" x="79651" y="-7182" font-family="Arial" font-size="10.00">GPUs: 166,167</text>
<text text-anchor="middle" x="79651" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="79651" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert19_attn_out -->
<g id="node508" class="node">
<title>stage1_expert19_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="79490,-7205 79212,-7205 79212,-7153 79490,-7153 79490,-7205"/>
<text text-anchor="middle" x="79351" y="-7193" font-family="Arial" font-size="10.00">Expert 19 Attn Output (TP)</text>
<text text-anchor="middle" x="79351" y="-7182" font-family="Arial" font-size="10.00">GPUs: 166,167</text>
<text text-anchor="middle" x="79351" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="79351" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert19_mlp1 -->
<g id="node509" class="node">
<title>stage1_expert19_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="79194,-7205 78918,-7205 78918,-7153 79194,-7153 79194,-7205"/>
<text text-anchor="middle" x="79056" y="-7193" font-family="Arial" font-size="10.00">Expert 19 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="79056" y="-7182" font-family="Arial" font-size="10.00">GPUs: 166,167</text>
<text text-anchor="middle" x="79056" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="79056" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert19_mlp_act -->
<g id="node510" class="node">
<title>stage1_expert19_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="78900,-7205 78624,-7205 78624,-7153 78900,-7153 78900,-7205"/>
<text text-anchor="middle" x="78762" y="-7193" font-family="Arial" font-size="10.00">Expert 19 MLP GELU (TP)</text>
<text text-anchor="middle" x="78762" y="-7182" font-family="Arial" font-size="10.00">GPUs: 166,167</text>
<text text-anchor="middle" x="78762" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="78762" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert19_mlp2 -->
<g id="node511" class="node">
<title>stage1_expert19_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="78605.5,-7205 78336.5,-7205 78336.5,-7153 78605.5,-7153 78605.5,-7205"/>
<text text-anchor="middle" x="78471" y="-7193" font-family="Arial" font-size="10.00">Expert 19 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="78471" y="-7182" font-family="Arial" font-size="10.00">GPUs: 166,167</text>
<text text-anchor="middle" x="78471" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="78471" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert20_qkv -->
<g id="node512" class="node">
<title>stage1_expert20_qkv</title>
<polygon fill="lightgreen" stroke="black" points="78318,-7205 78032,-7205 78032,-7153 78318,-7153 78318,-7205"/>
<text text-anchor="middle" x="78175" y="-7193" font-family="Arial" font-size="10.00">Expert 20 QKV Proj (TP)</text>
<text text-anchor="middle" x="78175" y="-7182" font-family="Arial" font-size="10.00">GPUs: 168,169</text>
<text text-anchor="middle" x="78175" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="78175" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert20_attn -->
<g id="node513" class="node">
<title>stage1_expert20_attn</title>
<polygon fill="lightgreen" stroke="black" points="78014,-7205 77728,-7205 77728,-7153 78014,-7153 78014,-7205"/>
<text text-anchor="middle" x="77871" y="-7193" font-family="Arial" font-size="10.00">Expert 20 Attention (TP)</text>
<text text-anchor="middle" x="77871" y="-7182" font-family="Arial" font-size="10.00">GPUs: 168,169</text>
<text text-anchor="middle" x="77871" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="77871" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert20_attn_out -->
<g id="node514" class="node">
<title>stage1_expert20_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="77710,-7205 77432,-7205 77432,-7153 77710,-7153 77710,-7205"/>
<text text-anchor="middle" x="77571" y="-7193" font-family="Arial" font-size="10.00">Expert 20 Attn Output (TP)</text>
<text text-anchor="middle" x="77571" y="-7182" font-family="Arial" font-size="10.00">GPUs: 168,169</text>
<text text-anchor="middle" x="77571" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="77571" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert20_mlp1 -->
<g id="node515" class="node">
<title>stage1_expert20_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="77414,-7205 77138,-7205 77138,-7153 77414,-7153 77414,-7205"/>
<text text-anchor="middle" x="77276" y="-7193" font-family="Arial" font-size="10.00">Expert 20 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="77276" y="-7182" font-family="Arial" font-size="10.00">GPUs: 168,169</text>
<text text-anchor="middle" x="77276" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="77276" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert20_mlp_act -->
<g id="node516" class="node">
<title>stage1_expert20_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="77120,-7205 76844,-7205 76844,-7153 77120,-7153 77120,-7205"/>
<text text-anchor="middle" x="76982" y="-7193" font-family="Arial" font-size="10.00">Expert 20 MLP GELU (TP)</text>
<text text-anchor="middle" x="76982" y="-7182" font-family="Arial" font-size="10.00">GPUs: 168,169</text>
<text text-anchor="middle" x="76982" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="76982" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert20_mlp2 -->
<g id="node517" class="node">
<title>stage1_expert20_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="76825.5,-7205 76556.5,-7205 76556.5,-7153 76825.5,-7153 76825.5,-7205"/>
<text text-anchor="middle" x="76691" y="-7193" font-family="Arial" font-size="10.00">Expert 20 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="76691" y="-7182" font-family="Arial" font-size="10.00">GPUs: 168,169</text>
<text text-anchor="middle" x="76691" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="76691" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert21_qkv -->
<g id="node518" class="node">
<title>stage1_expert21_qkv</title>
<polygon fill="lightgreen" stroke="black" points="76538,-7205 76252,-7205 76252,-7153 76538,-7153 76538,-7205"/>
<text text-anchor="middle" x="76395" y="-7193" font-family="Arial" font-size="10.00">Expert 21 QKV Proj (TP)</text>
<text text-anchor="middle" x="76395" y="-7182" font-family="Arial" font-size="10.00">GPUs: 170,171</text>
<text text-anchor="middle" x="76395" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="76395" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert21_attn -->
<g id="node519" class="node">
<title>stage1_expert21_attn</title>
<polygon fill="lightgreen" stroke="black" points="76234,-7205 75948,-7205 75948,-7153 76234,-7153 76234,-7205"/>
<text text-anchor="middle" x="76091" y="-7193" font-family="Arial" font-size="10.00">Expert 21 Attention (TP)</text>
<text text-anchor="middle" x="76091" y="-7182" font-family="Arial" font-size="10.00">GPUs: 170,171</text>
<text text-anchor="middle" x="76091" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="76091" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert21_attn_out -->
<g id="node520" class="node">
<title>stage1_expert21_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="75930,-7205 75652,-7205 75652,-7153 75930,-7153 75930,-7205"/>
<text text-anchor="middle" x="75791" y="-7193" font-family="Arial" font-size="10.00">Expert 21 Attn Output (TP)</text>
<text text-anchor="middle" x="75791" y="-7182" font-family="Arial" font-size="10.00">GPUs: 170,171</text>
<text text-anchor="middle" x="75791" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="75791" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert21_mlp1 -->
<g id="node521" class="node">
<title>stage1_expert21_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="75634,-7205 75358,-7205 75358,-7153 75634,-7153 75634,-7205"/>
<text text-anchor="middle" x="75496" y="-7193" font-family="Arial" font-size="10.00">Expert 21 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="75496" y="-7182" font-family="Arial" font-size="10.00">GPUs: 170,171</text>
<text text-anchor="middle" x="75496" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="75496" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert21_mlp_act -->
<g id="node522" class="node">
<title>stage1_expert21_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="75340,-7205 75064,-7205 75064,-7153 75340,-7153 75340,-7205"/>
<text text-anchor="middle" x="75202" y="-7193" font-family="Arial" font-size="10.00">Expert 21 MLP GELU (TP)</text>
<text text-anchor="middle" x="75202" y="-7182" font-family="Arial" font-size="10.00">GPUs: 170,171</text>
<text text-anchor="middle" x="75202" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="75202" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert21_mlp2 -->
<g id="node523" class="node">
<title>stage1_expert21_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="75045.5,-7205 74776.5,-7205 74776.5,-7153 75045.5,-7153 75045.5,-7205"/>
<text text-anchor="middle" x="74911" y="-7193" font-family="Arial" font-size="10.00">Expert 21 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="74911" y="-7182" font-family="Arial" font-size="10.00">GPUs: 170,171</text>
<text text-anchor="middle" x="74911" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="74911" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert22_qkv -->
<g id="node524" class="node">
<title>stage1_expert22_qkv</title>
<polygon fill="lightgreen" stroke="black" points="74758,-7205 74472,-7205 74472,-7153 74758,-7153 74758,-7205"/>
<text text-anchor="middle" x="74615" y="-7193" font-family="Arial" font-size="10.00">Expert 22 QKV Proj (TP)</text>
<text text-anchor="middle" x="74615" y="-7182" font-family="Arial" font-size="10.00">GPUs: 172,173</text>
<text text-anchor="middle" x="74615" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="74615" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert22_attn -->
<g id="node525" class="node">
<title>stage1_expert22_attn</title>
<polygon fill="lightgreen" stroke="black" points="74454,-7205 74168,-7205 74168,-7153 74454,-7153 74454,-7205"/>
<text text-anchor="middle" x="74311" y="-7193" font-family="Arial" font-size="10.00">Expert 22 Attention (TP)</text>
<text text-anchor="middle" x="74311" y="-7182" font-family="Arial" font-size="10.00">GPUs: 172,173</text>
<text text-anchor="middle" x="74311" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="74311" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert22_attn_out -->
<g id="node526" class="node">
<title>stage1_expert22_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="74150,-7205 73872,-7205 73872,-7153 74150,-7153 74150,-7205"/>
<text text-anchor="middle" x="74011" y="-7193" font-family="Arial" font-size="10.00">Expert 22 Attn Output (TP)</text>
<text text-anchor="middle" x="74011" y="-7182" font-family="Arial" font-size="10.00">GPUs: 172,173</text>
<text text-anchor="middle" x="74011" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="74011" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert22_mlp1 -->
<g id="node527" class="node">
<title>stage1_expert22_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="73854,-7205 73578,-7205 73578,-7153 73854,-7153 73854,-7205"/>
<text text-anchor="middle" x="73716" y="-7193" font-family="Arial" font-size="10.00">Expert 22 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="73716" y="-7182" font-family="Arial" font-size="10.00">GPUs: 172,173</text>
<text text-anchor="middle" x="73716" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="73716" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert22_mlp_act -->
<g id="node528" class="node">
<title>stage1_expert22_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="73560,-7205 73284,-7205 73284,-7153 73560,-7153 73560,-7205"/>
<text text-anchor="middle" x="73422" y="-7193" font-family="Arial" font-size="10.00">Expert 22 MLP GELU (TP)</text>
<text text-anchor="middle" x="73422" y="-7182" font-family="Arial" font-size="10.00">GPUs: 172,173</text>
<text text-anchor="middle" x="73422" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="73422" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert22_mlp2 -->
<g id="node529" class="node">
<title>stage1_expert22_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="73265.5,-7205 72996.5,-7205 72996.5,-7153 73265.5,-7153 73265.5,-7205"/>
<text text-anchor="middle" x="73131" y="-7193" font-family="Arial" font-size="10.00">Expert 22 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="73131" y="-7182" font-family="Arial" font-size="10.00">GPUs: 172,173</text>
<text text-anchor="middle" x="73131" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="73131" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert23_qkv -->
<g id="node530" class="node">
<title>stage1_expert23_qkv</title>
<polygon fill="lightgreen" stroke="black" points="72978,-7205 72692,-7205 72692,-7153 72978,-7153 72978,-7205"/>
<text text-anchor="middle" x="72835" y="-7193" font-family="Arial" font-size="10.00">Expert 23 QKV Proj (TP)</text>
<text text-anchor="middle" x="72835" y="-7182" font-family="Arial" font-size="10.00">GPUs: 174,175</text>
<text text-anchor="middle" x="72835" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="72835" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert23_attn -->
<g id="node531" class="node">
<title>stage1_expert23_attn</title>
<polygon fill="lightgreen" stroke="black" points="72674,-7205 72388,-7205 72388,-7153 72674,-7153 72674,-7205"/>
<text text-anchor="middle" x="72531" y="-7193" font-family="Arial" font-size="10.00">Expert 23 Attention (TP)</text>
<text text-anchor="middle" x="72531" y="-7182" font-family="Arial" font-size="10.00">GPUs: 174,175</text>
<text text-anchor="middle" x="72531" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="72531" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert23_attn_out -->
<g id="node532" class="node">
<title>stage1_expert23_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="72370,-7205 72092,-7205 72092,-7153 72370,-7153 72370,-7205"/>
<text text-anchor="middle" x="72231" y="-7193" font-family="Arial" font-size="10.00">Expert 23 Attn Output (TP)</text>
<text text-anchor="middle" x="72231" y="-7182" font-family="Arial" font-size="10.00">GPUs: 174,175</text>
<text text-anchor="middle" x="72231" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="72231" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert23_mlp1 -->
<g id="node533" class="node">
<title>stage1_expert23_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="72074,-7205 71798,-7205 71798,-7153 72074,-7153 72074,-7205"/>
<text text-anchor="middle" x="71936" y="-7193" font-family="Arial" font-size="10.00">Expert 23 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="71936" y="-7182" font-family="Arial" font-size="10.00">GPUs: 174,175</text>
<text text-anchor="middle" x="71936" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="71936" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert23_mlp_act -->
<g id="node534" class="node">
<title>stage1_expert23_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="71780,-7205 71504,-7205 71504,-7153 71780,-7153 71780,-7205"/>
<text text-anchor="middle" x="71642" y="-7193" font-family="Arial" font-size="10.00">Expert 23 MLP GELU (TP)</text>
<text text-anchor="middle" x="71642" y="-7182" font-family="Arial" font-size="10.00">GPUs: 174,175</text>
<text text-anchor="middle" x="71642" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="71642" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert23_mlp2 -->
<g id="node535" class="node">
<title>stage1_expert23_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="71485.5,-7205 71216.5,-7205 71216.5,-7153 71485.5,-7153 71485.5,-7205"/>
<text text-anchor="middle" x="71351" y="-7193" font-family="Arial" font-size="10.00">Expert 23 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="71351" y="-7182" font-family="Arial" font-size="10.00">GPUs: 174,175</text>
<text text-anchor="middle" x="71351" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="71351" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert24_qkv -->
<g id="node536" class="node">
<title>stage1_expert24_qkv</title>
<polygon fill="lightgreen" stroke="black" points="71198,-7205 70912,-7205 70912,-7153 71198,-7153 71198,-7205"/>
<text text-anchor="middle" x="71055" y="-7193" font-family="Arial" font-size="10.00">Expert 24 QKV Proj (TP)</text>
<text text-anchor="middle" x="71055" y="-7182" font-family="Arial" font-size="10.00">GPUs: 176,177</text>
<text text-anchor="middle" x="71055" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="71055" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert24_attn -->
<g id="node537" class="node">
<title>stage1_expert24_attn</title>
<polygon fill="lightgreen" stroke="black" points="70894,-7205 70608,-7205 70608,-7153 70894,-7153 70894,-7205"/>
<text text-anchor="middle" x="70751" y="-7193" font-family="Arial" font-size="10.00">Expert 24 Attention (TP)</text>
<text text-anchor="middle" x="70751" y="-7182" font-family="Arial" font-size="10.00">GPUs: 176,177</text>
<text text-anchor="middle" x="70751" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="70751" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert24_attn_out -->
<g id="node538" class="node">
<title>stage1_expert24_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="70590,-7205 70312,-7205 70312,-7153 70590,-7153 70590,-7205"/>
<text text-anchor="middle" x="70451" y="-7193" font-family="Arial" font-size="10.00">Expert 24 Attn Output (TP)</text>
<text text-anchor="middle" x="70451" y="-7182" font-family="Arial" font-size="10.00">GPUs: 176,177</text>
<text text-anchor="middle" x="70451" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="70451" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert24_mlp1 -->
<g id="node539" class="node">
<title>stage1_expert24_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="70294,-7205 70018,-7205 70018,-7153 70294,-7153 70294,-7205"/>
<text text-anchor="middle" x="70156" y="-7193" font-family="Arial" font-size="10.00">Expert 24 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="70156" y="-7182" font-family="Arial" font-size="10.00">GPUs: 176,177</text>
<text text-anchor="middle" x="70156" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="70156" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert24_mlp_act -->
<g id="node540" class="node">
<title>stage1_expert24_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="70000,-7205 69724,-7205 69724,-7153 70000,-7153 70000,-7205"/>
<text text-anchor="middle" x="69862" y="-7193" font-family="Arial" font-size="10.00">Expert 24 MLP GELU (TP)</text>
<text text-anchor="middle" x="69862" y="-7182" font-family="Arial" font-size="10.00">GPUs: 176,177</text>
<text text-anchor="middle" x="69862" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="69862" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert24_mlp2 -->
<g id="node541" class="node">
<title>stage1_expert24_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="69705.5,-7205 69436.5,-7205 69436.5,-7153 69705.5,-7153 69705.5,-7205"/>
<text text-anchor="middle" x="69571" y="-7193" font-family="Arial" font-size="10.00">Expert 24 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="69571" y="-7182" font-family="Arial" font-size="10.00">GPUs: 176,177</text>
<text text-anchor="middle" x="69571" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="69571" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert25_qkv -->
<g id="node542" class="node">
<title>stage1_expert25_qkv</title>
<polygon fill="lightgreen" stroke="black" points="69418,-7205 69132,-7205 69132,-7153 69418,-7153 69418,-7205"/>
<text text-anchor="middle" x="69275" y="-7193" font-family="Arial" font-size="10.00">Expert 25 QKV Proj (TP)</text>
<text text-anchor="middle" x="69275" y="-7182" font-family="Arial" font-size="10.00">GPUs: 178,179</text>
<text text-anchor="middle" x="69275" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="69275" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert25_attn -->
<g id="node543" class="node">
<title>stage1_expert25_attn</title>
<polygon fill="lightgreen" stroke="black" points="69114,-7205 68828,-7205 68828,-7153 69114,-7153 69114,-7205"/>
<text text-anchor="middle" x="68971" y="-7193" font-family="Arial" font-size="10.00">Expert 25 Attention (TP)</text>
<text text-anchor="middle" x="68971" y="-7182" font-family="Arial" font-size="10.00">GPUs: 178,179</text>
<text text-anchor="middle" x="68971" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="68971" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert25_attn_out -->
<g id="node544" class="node">
<title>stage1_expert25_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="68810,-7205 68532,-7205 68532,-7153 68810,-7153 68810,-7205"/>
<text text-anchor="middle" x="68671" y="-7193" font-family="Arial" font-size="10.00">Expert 25 Attn Output (TP)</text>
<text text-anchor="middle" x="68671" y="-7182" font-family="Arial" font-size="10.00">GPUs: 178,179</text>
<text text-anchor="middle" x="68671" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="68671" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert25_mlp1 -->
<g id="node545" class="node">
<title>stage1_expert25_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="68514,-7205 68238,-7205 68238,-7153 68514,-7153 68514,-7205"/>
<text text-anchor="middle" x="68376" y="-7193" font-family="Arial" font-size="10.00">Expert 25 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="68376" y="-7182" font-family="Arial" font-size="10.00">GPUs: 178,179</text>
<text text-anchor="middle" x="68376" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="68376" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert25_mlp_act -->
<g id="node546" class="node">
<title>stage1_expert25_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="68220,-7205 67944,-7205 67944,-7153 68220,-7153 68220,-7205"/>
<text text-anchor="middle" x="68082" y="-7193" font-family="Arial" font-size="10.00">Expert 25 MLP GELU (TP)</text>
<text text-anchor="middle" x="68082" y="-7182" font-family="Arial" font-size="10.00">GPUs: 178,179</text>
<text text-anchor="middle" x="68082" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="68082" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert25_mlp2 -->
<g id="node547" class="node">
<title>stage1_expert25_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="67925.5,-7205 67656.5,-7205 67656.5,-7153 67925.5,-7153 67925.5,-7205"/>
<text text-anchor="middle" x="67791" y="-7193" font-family="Arial" font-size="10.00">Expert 25 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="67791" y="-7182" font-family="Arial" font-size="10.00">GPUs: 178,179</text>
<text text-anchor="middle" x="67791" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="67791" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert26_qkv -->
<g id="node548" class="node">
<title>stage1_expert26_qkv</title>
<polygon fill="lightgreen" stroke="black" points="67638,-7205 67352,-7205 67352,-7153 67638,-7153 67638,-7205"/>
<text text-anchor="middle" x="67495" y="-7193" font-family="Arial" font-size="10.00">Expert 26 QKV Proj (TP)</text>
<text text-anchor="middle" x="67495" y="-7182" font-family="Arial" font-size="10.00">GPUs: 180,181</text>
<text text-anchor="middle" x="67495" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="67495" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert26_attn -->
<g id="node549" class="node">
<title>stage1_expert26_attn</title>
<polygon fill="lightgreen" stroke="black" points="67334,-7205 67048,-7205 67048,-7153 67334,-7153 67334,-7205"/>
<text text-anchor="middle" x="67191" y="-7193" font-family="Arial" font-size="10.00">Expert 26 Attention (TP)</text>
<text text-anchor="middle" x="67191" y="-7182" font-family="Arial" font-size="10.00">GPUs: 180,181</text>
<text text-anchor="middle" x="67191" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="67191" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert26_attn_out -->
<g id="node550" class="node">
<title>stage1_expert26_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="67030,-7205 66752,-7205 66752,-7153 67030,-7153 67030,-7205"/>
<text text-anchor="middle" x="66891" y="-7193" font-family="Arial" font-size="10.00">Expert 26 Attn Output (TP)</text>
<text text-anchor="middle" x="66891" y="-7182" font-family="Arial" font-size="10.00">GPUs: 180,181</text>
<text text-anchor="middle" x="66891" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="66891" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert26_mlp1 -->
<g id="node551" class="node">
<title>stage1_expert26_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="66734,-7205 66458,-7205 66458,-7153 66734,-7153 66734,-7205"/>
<text text-anchor="middle" x="66596" y="-7193" font-family="Arial" font-size="10.00">Expert 26 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="66596" y="-7182" font-family="Arial" font-size="10.00">GPUs: 180,181</text>
<text text-anchor="middle" x="66596" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="66596" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert26_mlp_act -->
<g id="node552" class="node">
<title>stage1_expert26_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="66440,-7205 66164,-7205 66164,-7153 66440,-7153 66440,-7205"/>
<text text-anchor="middle" x="66302" y="-7193" font-family="Arial" font-size="10.00">Expert 26 MLP GELU (TP)</text>
<text text-anchor="middle" x="66302" y="-7182" font-family="Arial" font-size="10.00">GPUs: 180,181</text>
<text text-anchor="middle" x="66302" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="66302" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert26_mlp2 -->
<g id="node553" class="node">
<title>stage1_expert26_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="66145.5,-7205 65876.5,-7205 65876.5,-7153 66145.5,-7153 66145.5,-7205"/>
<text text-anchor="middle" x="66011" y="-7193" font-family="Arial" font-size="10.00">Expert 26 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="66011" y="-7182" font-family="Arial" font-size="10.00">GPUs: 180,181</text>
<text text-anchor="middle" x="66011" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="66011" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert27_qkv -->
<g id="node554" class="node">
<title>stage1_expert27_qkv</title>
<polygon fill="lightgreen" stroke="black" points="65858,-7205 65572,-7205 65572,-7153 65858,-7153 65858,-7205"/>
<text text-anchor="middle" x="65715" y="-7193" font-family="Arial" font-size="10.00">Expert 27 QKV Proj (TP)</text>
<text text-anchor="middle" x="65715" y="-7182" font-family="Arial" font-size="10.00">GPUs: 182,183</text>
<text text-anchor="middle" x="65715" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="65715" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert27_attn -->
<g id="node555" class="node">
<title>stage1_expert27_attn</title>
<polygon fill="lightgreen" stroke="black" points="65554,-7205 65268,-7205 65268,-7153 65554,-7153 65554,-7205"/>
<text text-anchor="middle" x="65411" y="-7193" font-family="Arial" font-size="10.00">Expert 27 Attention (TP)</text>
<text text-anchor="middle" x="65411" y="-7182" font-family="Arial" font-size="10.00">GPUs: 182,183</text>
<text text-anchor="middle" x="65411" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="65411" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert27_attn_out -->
<g id="node556" class="node">
<title>stage1_expert27_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="65250,-7205 64972,-7205 64972,-7153 65250,-7153 65250,-7205"/>
<text text-anchor="middle" x="65111" y="-7193" font-family="Arial" font-size="10.00">Expert 27 Attn Output (TP)</text>
<text text-anchor="middle" x="65111" y="-7182" font-family="Arial" font-size="10.00">GPUs: 182,183</text>
<text text-anchor="middle" x="65111" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="65111" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert27_mlp1 -->
<g id="node557" class="node">
<title>stage1_expert27_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="64954,-7205 64678,-7205 64678,-7153 64954,-7153 64954,-7205"/>
<text text-anchor="middle" x="64816" y="-7193" font-family="Arial" font-size="10.00">Expert 27 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="64816" y="-7182" font-family="Arial" font-size="10.00">GPUs: 182,183</text>
<text text-anchor="middle" x="64816" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="64816" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert27_mlp_act -->
<g id="node558" class="node">
<title>stage1_expert27_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="64660,-7205 64384,-7205 64384,-7153 64660,-7153 64660,-7205"/>
<text text-anchor="middle" x="64522" y="-7193" font-family="Arial" font-size="10.00">Expert 27 MLP GELU (TP)</text>
<text text-anchor="middle" x="64522" y="-7182" font-family="Arial" font-size="10.00">GPUs: 182,183</text>
<text text-anchor="middle" x="64522" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="64522" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert27_mlp2 -->
<g id="node559" class="node">
<title>stage1_expert27_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="64365.5,-7205 64096.5,-7205 64096.5,-7153 64365.5,-7153 64365.5,-7205"/>
<text text-anchor="middle" x="64231" y="-7193" font-family="Arial" font-size="10.00">Expert 27 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="64231" y="-7182" font-family="Arial" font-size="10.00">GPUs: 182,183</text>
<text text-anchor="middle" x="64231" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="64231" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert28_qkv -->
<g id="node560" class="node">
<title>stage1_expert28_qkv</title>
<polygon fill="lightgreen" stroke="black" points="64078,-7205 63792,-7205 63792,-7153 64078,-7153 64078,-7205"/>
<text text-anchor="middle" x="63935" y="-7193" font-family="Arial" font-size="10.00">Expert 28 QKV Proj (TP)</text>
<text text-anchor="middle" x="63935" y="-7182" font-family="Arial" font-size="10.00">GPUs: 184,185</text>
<text text-anchor="middle" x="63935" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="63935" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert28_attn -->
<g id="node561" class="node">
<title>stage1_expert28_attn</title>
<polygon fill="lightgreen" stroke="black" points="63774,-7205 63488,-7205 63488,-7153 63774,-7153 63774,-7205"/>
<text text-anchor="middle" x="63631" y="-7193" font-family="Arial" font-size="10.00">Expert 28 Attention (TP)</text>
<text text-anchor="middle" x="63631" y="-7182" font-family="Arial" font-size="10.00">GPUs: 184,185</text>
<text text-anchor="middle" x="63631" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="63631" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert28_attn_out -->
<g id="node562" class="node">
<title>stage1_expert28_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="63470,-7205 63192,-7205 63192,-7153 63470,-7153 63470,-7205"/>
<text text-anchor="middle" x="63331" y="-7193" font-family="Arial" font-size="10.00">Expert 28 Attn Output (TP)</text>
<text text-anchor="middle" x="63331" y="-7182" font-family="Arial" font-size="10.00">GPUs: 184,185</text>
<text text-anchor="middle" x="63331" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="63331" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert28_mlp1 -->
<g id="node563" class="node">
<title>stage1_expert28_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="63174,-7205 62898,-7205 62898,-7153 63174,-7153 63174,-7205"/>
<text text-anchor="middle" x="63036" y="-7193" font-family="Arial" font-size="10.00">Expert 28 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="63036" y="-7182" font-family="Arial" font-size="10.00">GPUs: 184,185</text>
<text text-anchor="middle" x="63036" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="63036" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert28_mlp_act -->
<g id="node564" class="node">
<title>stage1_expert28_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="62880,-7205 62604,-7205 62604,-7153 62880,-7153 62880,-7205"/>
<text text-anchor="middle" x="62742" y="-7193" font-family="Arial" font-size="10.00">Expert 28 MLP GELU (TP)</text>
<text text-anchor="middle" x="62742" y="-7182" font-family="Arial" font-size="10.00">GPUs: 184,185</text>
<text text-anchor="middle" x="62742" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="62742" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert28_mlp2 -->
<g id="node565" class="node">
<title>stage1_expert28_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="62585.5,-7205 62316.5,-7205 62316.5,-7153 62585.5,-7153 62585.5,-7205"/>
<text text-anchor="middle" x="62451" y="-7193" font-family="Arial" font-size="10.00">Expert 28 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="62451" y="-7182" font-family="Arial" font-size="10.00">GPUs: 184,185</text>
<text text-anchor="middle" x="62451" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="62451" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert29_qkv -->
<g id="node566" class="node">
<title>stage1_expert29_qkv</title>
<polygon fill="lightgreen" stroke="black" points="62298,-7205 62012,-7205 62012,-7153 62298,-7153 62298,-7205"/>
<text text-anchor="middle" x="62155" y="-7193" font-family="Arial" font-size="10.00">Expert 29 QKV Proj (TP)</text>
<text text-anchor="middle" x="62155" y="-7182" font-family="Arial" font-size="10.00">GPUs: 186,187</text>
<text text-anchor="middle" x="62155" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="62155" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert29_attn -->
<g id="node567" class="node">
<title>stage1_expert29_attn</title>
<polygon fill="lightgreen" stroke="black" points="61994,-7205 61708,-7205 61708,-7153 61994,-7153 61994,-7205"/>
<text text-anchor="middle" x="61851" y="-7193" font-family="Arial" font-size="10.00">Expert 29 Attention (TP)</text>
<text text-anchor="middle" x="61851" y="-7182" font-family="Arial" font-size="10.00">GPUs: 186,187</text>
<text text-anchor="middle" x="61851" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="61851" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert29_attn_out -->
<g id="node568" class="node">
<title>stage1_expert29_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="61690,-7205 61412,-7205 61412,-7153 61690,-7153 61690,-7205"/>
<text text-anchor="middle" x="61551" y="-7193" font-family="Arial" font-size="10.00">Expert 29 Attn Output (TP)</text>
<text text-anchor="middle" x="61551" y="-7182" font-family="Arial" font-size="10.00">GPUs: 186,187</text>
<text text-anchor="middle" x="61551" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="61551" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert29_mlp1 -->
<g id="node569" class="node">
<title>stage1_expert29_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="61394,-7205 61118,-7205 61118,-7153 61394,-7153 61394,-7205"/>
<text text-anchor="middle" x="61256" y="-7193" font-family="Arial" font-size="10.00">Expert 29 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="61256" y="-7182" font-family="Arial" font-size="10.00">GPUs: 186,187</text>
<text text-anchor="middle" x="61256" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="61256" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert29_mlp_act -->
<g id="node570" class="node">
<title>stage1_expert29_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="61100,-7205 60824,-7205 60824,-7153 61100,-7153 61100,-7205"/>
<text text-anchor="middle" x="60962" y="-7193" font-family="Arial" font-size="10.00">Expert 29 MLP GELU (TP)</text>
<text text-anchor="middle" x="60962" y="-7182" font-family="Arial" font-size="10.00">GPUs: 186,187</text>
<text text-anchor="middle" x="60962" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="60962" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert29_mlp2 -->
<g id="node571" class="node">
<title>stage1_expert29_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="60805.5,-7205 60536.5,-7205 60536.5,-7153 60805.5,-7153 60805.5,-7205"/>
<text text-anchor="middle" x="60671" y="-7193" font-family="Arial" font-size="10.00">Expert 29 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="60671" y="-7182" font-family="Arial" font-size="10.00">GPUs: 186,187</text>
<text text-anchor="middle" x="60671" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="60671" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert30_qkv -->
<g id="node572" class="node">
<title>stage1_expert30_qkv</title>
<polygon fill="lightgreen" stroke="black" points="60518,-7205 60232,-7205 60232,-7153 60518,-7153 60518,-7205"/>
<text text-anchor="middle" x="60375" y="-7193" font-family="Arial" font-size="10.00">Expert 30 QKV Proj (TP)</text>
<text text-anchor="middle" x="60375" y="-7182" font-family="Arial" font-size="10.00">GPUs: 188,189</text>
<text text-anchor="middle" x="60375" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="60375" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert30_attn -->
<g id="node573" class="node">
<title>stage1_expert30_attn</title>
<polygon fill="lightgreen" stroke="black" points="60214,-7205 59928,-7205 59928,-7153 60214,-7153 60214,-7205"/>
<text text-anchor="middle" x="60071" y="-7193" font-family="Arial" font-size="10.00">Expert 30 Attention (TP)</text>
<text text-anchor="middle" x="60071" y="-7182" font-family="Arial" font-size="10.00">GPUs: 188,189</text>
<text text-anchor="middle" x="60071" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="60071" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert30_attn_out -->
<g id="node574" class="node">
<title>stage1_expert30_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="59910,-7205 59632,-7205 59632,-7153 59910,-7153 59910,-7205"/>
<text text-anchor="middle" x="59771" y="-7193" font-family="Arial" font-size="10.00">Expert 30 Attn Output (TP)</text>
<text text-anchor="middle" x="59771" y="-7182" font-family="Arial" font-size="10.00">GPUs: 188,189</text>
<text text-anchor="middle" x="59771" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="59771" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert30_mlp1 -->
<g id="node575" class="node">
<title>stage1_expert30_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="59614,-7205 59338,-7205 59338,-7153 59614,-7153 59614,-7205"/>
<text text-anchor="middle" x="59476" y="-7193" font-family="Arial" font-size="10.00">Expert 30 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="59476" y="-7182" font-family="Arial" font-size="10.00">GPUs: 188,189</text>
<text text-anchor="middle" x="59476" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="59476" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert30_mlp_act -->
<g id="node576" class="node">
<title>stage1_expert30_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="59320,-7205 59044,-7205 59044,-7153 59320,-7153 59320,-7205"/>
<text text-anchor="middle" x="59182" y="-7193" font-family="Arial" font-size="10.00">Expert 30 MLP GELU (TP)</text>
<text text-anchor="middle" x="59182" y="-7182" font-family="Arial" font-size="10.00">GPUs: 188,189</text>
<text text-anchor="middle" x="59182" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="59182" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert30_mlp2 -->
<g id="node577" class="node">
<title>stage1_expert30_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="59025.5,-7205 58756.5,-7205 58756.5,-7153 59025.5,-7153 59025.5,-7205"/>
<text text-anchor="middle" x="58891" y="-7193" font-family="Arial" font-size="10.00">Expert 30 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="58891" y="-7182" font-family="Arial" font-size="10.00">GPUs: 188,189</text>
<text text-anchor="middle" x="58891" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="58891" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert31_qkv -->
<g id="node578" class="node">
<title>stage1_expert31_qkv</title>
<polygon fill="lightgreen" stroke="black" points="58738,-7205 58452,-7205 58452,-7153 58738,-7153 58738,-7205"/>
<text text-anchor="middle" x="58595" y="-7193" font-family="Arial" font-size="10.00">Expert 31 QKV Proj (TP)</text>
<text text-anchor="middle" x="58595" y="-7182" font-family="Arial" font-size="10.00">GPUs: 190,191</text>
<text text-anchor="middle" x="58595" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="58595" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert31_attn -->
<g id="node579" class="node">
<title>stage1_expert31_attn</title>
<polygon fill="lightgreen" stroke="black" points="58434,-7205 58148,-7205 58148,-7153 58434,-7153 58434,-7205"/>
<text text-anchor="middle" x="58291" y="-7193" font-family="Arial" font-size="10.00">Expert 31 Attention (TP)</text>
<text text-anchor="middle" x="58291" y="-7182" font-family="Arial" font-size="10.00">GPUs: 190,191</text>
<text text-anchor="middle" x="58291" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="58291" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert31_attn_out -->
<g id="node580" class="node">
<title>stage1_expert31_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="58130,-7205 57852,-7205 57852,-7153 58130,-7153 58130,-7205"/>
<text text-anchor="middle" x="57991" y="-7193" font-family="Arial" font-size="10.00">Expert 31 Attn Output (TP)</text>
<text text-anchor="middle" x="57991" y="-7182" font-family="Arial" font-size="10.00">GPUs: 190,191</text>
<text text-anchor="middle" x="57991" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="57991" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert31_mlp1 -->
<g id="node581" class="node">
<title>stage1_expert31_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="57834,-7205 57558,-7205 57558,-7153 57834,-7153 57834,-7205"/>
<text text-anchor="middle" x="57696" y="-7193" font-family="Arial" font-size="10.00">Expert 31 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="57696" y="-7182" font-family="Arial" font-size="10.00">GPUs: 190,191</text>
<text text-anchor="middle" x="57696" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="57696" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert31_mlp_act -->
<g id="node582" class="node">
<title>stage1_expert31_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="57540,-7205 57264,-7205 57264,-7153 57540,-7153 57540,-7205"/>
<text text-anchor="middle" x="57402" y="-7193" font-family="Arial" font-size="10.00">Expert 31 MLP GELU (TP)</text>
<text text-anchor="middle" x="57402" y="-7182" font-family="Arial" font-size="10.00">GPUs: 190,191</text>
<text text-anchor="middle" x="57402" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="57402" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert31_mlp2 -->
<g id="node583" class="node">
<title>stage1_expert31_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="57245.5,-7205 56976.5,-7205 56976.5,-7153 57245.5,-7153 57245.5,-7205"/>
<text text-anchor="middle" x="57111" y="-7193" font-family="Arial" font-size="10.00">Expert 31 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="57111" y="-7182" font-family="Arial" font-size="10.00">GPUs: 190,191</text>
<text text-anchor="middle" x="57111" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="57111" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert32_qkv -->
<g id="node584" class="node">
<title>stage1_expert32_qkv</title>
<polygon fill="lightgreen" stroke="black" points="56958,-7205 56672,-7205 56672,-7153 56958,-7153 56958,-7205"/>
<text text-anchor="middle" x="56815" y="-7193" font-family="Arial" font-size="10.00">Expert 32 QKV Proj (TP)</text>
<text text-anchor="middle" x="56815" y="-7182" font-family="Arial" font-size="10.00">GPUs: 192,193</text>
<text text-anchor="middle" x="56815" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="56815" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert32_attn -->
<g id="node585" class="node">
<title>stage1_expert32_attn</title>
<polygon fill="lightgreen" stroke="black" points="56654,-7205 56368,-7205 56368,-7153 56654,-7153 56654,-7205"/>
<text text-anchor="middle" x="56511" y="-7193" font-family="Arial" font-size="10.00">Expert 32 Attention (TP)</text>
<text text-anchor="middle" x="56511" y="-7182" font-family="Arial" font-size="10.00">GPUs: 192,193</text>
<text text-anchor="middle" x="56511" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="56511" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert32_attn_out -->
<g id="node586" class="node">
<title>stage1_expert32_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="56350,-7205 56072,-7205 56072,-7153 56350,-7153 56350,-7205"/>
<text text-anchor="middle" x="56211" y="-7193" font-family="Arial" font-size="10.00">Expert 32 Attn Output (TP)</text>
<text text-anchor="middle" x="56211" y="-7182" font-family="Arial" font-size="10.00">GPUs: 192,193</text>
<text text-anchor="middle" x="56211" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="56211" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert32_mlp1 -->
<g id="node587" class="node">
<title>stage1_expert32_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="56054,-7205 55778,-7205 55778,-7153 56054,-7153 56054,-7205"/>
<text text-anchor="middle" x="55916" y="-7193" font-family="Arial" font-size="10.00">Expert 32 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="55916" y="-7182" font-family="Arial" font-size="10.00">GPUs: 192,193</text>
<text text-anchor="middle" x="55916" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="55916" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert32_mlp_act -->
<g id="node588" class="node">
<title>stage1_expert32_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="55760,-7205 55484,-7205 55484,-7153 55760,-7153 55760,-7205"/>
<text text-anchor="middle" x="55622" y="-7193" font-family="Arial" font-size="10.00">Expert 32 MLP GELU (TP)</text>
<text text-anchor="middle" x="55622" y="-7182" font-family="Arial" font-size="10.00">GPUs: 192,193</text>
<text text-anchor="middle" x="55622" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="55622" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert32_mlp2 -->
<g id="node589" class="node">
<title>stage1_expert32_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="55465.5,-7205 55196.5,-7205 55196.5,-7153 55465.5,-7153 55465.5,-7205"/>
<text text-anchor="middle" x="55331" y="-7193" font-family="Arial" font-size="10.00">Expert 32 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="55331" y="-7182" font-family="Arial" font-size="10.00">GPUs: 192,193</text>
<text text-anchor="middle" x="55331" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="55331" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert33_qkv -->
<g id="node590" class="node">
<title>stage1_expert33_qkv</title>
<polygon fill="lightgreen" stroke="black" points="55178,-7205 54892,-7205 54892,-7153 55178,-7153 55178,-7205"/>
<text text-anchor="middle" x="55035" y="-7193" font-family="Arial" font-size="10.00">Expert 33 QKV Proj (TP)</text>
<text text-anchor="middle" x="55035" y="-7182" font-family="Arial" font-size="10.00">GPUs: 194,195</text>
<text text-anchor="middle" x="55035" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="55035" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert33_attn -->
<g id="node591" class="node">
<title>stage1_expert33_attn</title>
<polygon fill="lightgreen" stroke="black" points="54874,-7205 54588,-7205 54588,-7153 54874,-7153 54874,-7205"/>
<text text-anchor="middle" x="54731" y="-7193" font-family="Arial" font-size="10.00">Expert 33 Attention (TP)</text>
<text text-anchor="middle" x="54731" y="-7182" font-family="Arial" font-size="10.00">GPUs: 194,195</text>
<text text-anchor="middle" x="54731" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="54731" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert33_attn_out -->
<g id="node592" class="node">
<title>stage1_expert33_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="54570,-7205 54292,-7205 54292,-7153 54570,-7153 54570,-7205"/>
<text text-anchor="middle" x="54431" y="-7193" font-family="Arial" font-size="10.00">Expert 33 Attn Output (TP)</text>
<text text-anchor="middle" x="54431" y="-7182" font-family="Arial" font-size="10.00">GPUs: 194,195</text>
<text text-anchor="middle" x="54431" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="54431" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert33_mlp1 -->
<g id="node593" class="node">
<title>stage1_expert33_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="54274,-7205 53998,-7205 53998,-7153 54274,-7153 54274,-7205"/>
<text text-anchor="middle" x="54136" y="-7193" font-family="Arial" font-size="10.00">Expert 33 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="54136" y="-7182" font-family="Arial" font-size="10.00">GPUs: 194,195</text>
<text text-anchor="middle" x="54136" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="54136" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert33_mlp_act -->
<g id="node594" class="node">
<title>stage1_expert33_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="53980,-7205 53704,-7205 53704,-7153 53980,-7153 53980,-7205"/>
<text text-anchor="middle" x="53842" y="-7193" font-family="Arial" font-size="10.00">Expert 33 MLP GELU (TP)</text>
<text text-anchor="middle" x="53842" y="-7182" font-family="Arial" font-size="10.00">GPUs: 194,195</text>
<text text-anchor="middle" x="53842" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="53842" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert33_mlp2 -->
<g id="node595" class="node">
<title>stage1_expert33_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="53685.5,-7205 53416.5,-7205 53416.5,-7153 53685.5,-7153 53685.5,-7205"/>
<text text-anchor="middle" x="53551" y="-7193" font-family="Arial" font-size="10.00">Expert 33 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="53551" y="-7182" font-family="Arial" font-size="10.00">GPUs: 194,195</text>
<text text-anchor="middle" x="53551" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="53551" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert34_qkv -->
<g id="node596" class="node">
<title>stage1_expert34_qkv</title>
<polygon fill="lightgreen" stroke="black" points="53398,-7205 53112,-7205 53112,-7153 53398,-7153 53398,-7205"/>
<text text-anchor="middle" x="53255" y="-7193" font-family="Arial" font-size="10.00">Expert 34 QKV Proj (TP)</text>
<text text-anchor="middle" x="53255" y="-7182" font-family="Arial" font-size="10.00">GPUs: 196,197</text>
<text text-anchor="middle" x="53255" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="53255" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert34_attn -->
<g id="node597" class="node">
<title>stage1_expert34_attn</title>
<polygon fill="lightgreen" stroke="black" points="53094,-7205 52808,-7205 52808,-7153 53094,-7153 53094,-7205"/>
<text text-anchor="middle" x="52951" y="-7193" font-family="Arial" font-size="10.00">Expert 34 Attention (TP)</text>
<text text-anchor="middle" x="52951" y="-7182" font-family="Arial" font-size="10.00">GPUs: 196,197</text>
<text text-anchor="middle" x="52951" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="52951" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert34_attn_out -->
<g id="node598" class="node">
<title>stage1_expert34_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="52790,-7205 52512,-7205 52512,-7153 52790,-7153 52790,-7205"/>
<text text-anchor="middle" x="52651" y="-7193" font-family="Arial" font-size="10.00">Expert 34 Attn Output (TP)</text>
<text text-anchor="middle" x="52651" y="-7182" font-family="Arial" font-size="10.00">GPUs: 196,197</text>
<text text-anchor="middle" x="52651" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="52651" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert34_mlp1 -->
<g id="node599" class="node">
<title>stage1_expert34_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="52494,-7205 52218,-7205 52218,-7153 52494,-7153 52494,-7205"/>
<text text-anchor="middle" x="52356" y="-7193" font-family="Arial" font-size="10.00">Expert 34 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="52356" y="-7182" font-family="Arial" font-size="10.00">GPUs: 196,197</text>
<text text-anchor="middle" x="52356" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="52356" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert34_mlp_act -->
<g id="node600" class="node">
<title>stage1_expert34_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="52200,-7205 51924,-7205 51924,-7153 52200,-7153 52200,-7205"/>
<text text-anchor="middle" x="52062" y="-7193" font-family="Arial" font-size="10.00">Expert 34 MLP GELU (TP)</text>
<text text-anchor="middle" x="52062" y="-7182" font-family="Arial" font-size="10.00">GPUs: 196,197</text>
<text text-anchor="middle" x="52062" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="52062" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert34_mlp2 -->
<g id="node601" class="node">
<title>stage1_expert34_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="51905.5,-7205 51636.5,-7205 51636.5,-7153 51905.5,-7153 51905.5,-7205"/>
<text text-anchor="middle" x="51771" y="-7193" font-family="Arial" font-size="10.00">Expert 34 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="51771" y="-7182" font-family="Arial" font-size="10.00">GPUs: 196,197</text>
<text text-anchor="middle" x="51771" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="51771" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert35_qkv -->
<g id="node602" class="node">
<title>stage1_expert35_qkv</title>
<polygon fill="lightgreen" stroke="black" points="51618,-7205 51332,-7205 51332,-7153 51618,-7153 51618,-7205"/>
<text text-anchor="middle" x="51475" y="-7193" font-family="Arial" font-size="10.00">Expert 35 QKV Proj (TP)</text>
<text text-anchor="middle" x="51475" y="-7182" font-family="Arial" font-size="10.00">GPUs: 198,199</text>
<text text-anchor="middle" x="51475" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="51475" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert35_attn -->
<g id="node603" class="node">
<title>stage1_expert35_attn</title>
<polygon fill="lightgreen" stroke="black" points="51314,-7205 51028,-7205 51028,-7153 51314,-7153 51314,-7205"/>
<text text-anchor="middle" x="51171" y="-7193" font-family="Arial" font-size="10.00">Expert 35 Attention (TP)</text>
<text text-anchor="middle" x="51171" y="-7182" font-family="Arial" font-size="10.00">GPUs: 198,199</text>
<text text-anchor="middle" x="51171" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="51171" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert35_attn_out -->
<g id="node604" class="node">
<title>stage1_expert35_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="51010,-7205 50732,-7205 50732,-7153 51010,-7153 51010,-7205"/>
<text text-anchor="middle" x="50871" y="-7193" font-family="Arial" font-size="10.00">Expert 35 Attn Output (TP)</text>
<text text-anchor="middle" x="50871" y="-7182" font-family="Arial" font-size="10.00">GPUs: 198,199</text>
<text text-anchor="middle" x="50871" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="50871" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert35_mlp1 -->
<g id="node605" class="node">
<title>stage1_expert35_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="50714,-7205 50438,-7205 50438,-7153 50714,-7153 50714,-7205"/>
<text text-anchor="middle" x="50576" y="-7193" font-family="Arial" font-size="10.00">Expert 35 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="50576" y="-7182" font-family="Arial" font-size="10.00">GPUs: 198,199</text>
<text text-anchor="middle" x="50576" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="50576" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert35_mlp_act -->
<g id="node606" class="node">
<title>stage1_expert35_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="50420,-7205 50144,-7205 50144,-7153 50420,-7153 50420,-7205"/>
<text text-anchor="middle" x="50282" y="-7193" font-family="Arial" font-size="10.00">Expert 35 MLP GELU (TP)</text>
<text text-anchor="middle" x="50282" y="-7182" font-family="Arial" font-size="10.00">GPUs: 198,199</text>
<text text-anchor="middle" x="50282" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="50282" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert35_mlp2 -->
<g id="node607" class="node">
<title>stage1_expert35_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="50125.5,-7205 49856.5,-7205 49856.5,-7153 50125.5,-7153 50125.5,-7205"/>
<text text-anchor="middle" x="49991" y="-7193" font-family="Arial" font-size="10.00">Expert 35 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="49991" y="-7182" font-family="Arial" font-size="10.00">GPUs: 198,199</text>
<text text-anchor="middle" x="49991" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="49991" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert36_qkv -->
<g id="node608" class="node">
<title>stage1_expert36_qkv</title>
<polygon fill="lightgreen" stroke="black" points="49838,-7205 49552,-7205 49552,-7153 49838,-7153 49838,-7205"/>
<text text-anchor="middle" x="49695" y="-7193" font-family="Arial" font-size="10.00">Expert 36 QKV Proj (TP)</text>
<text text-anchor="middle" x="49695" y="-7182" font-family="Arial" font-size="10.00">GPUs: 200,201</text>
<text text-anchor="middle" x="49695" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="49695" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert36_attn -->
<g id="node609" class="node">
<title>stage1_expert36_attn</title>
<polygon fill="lightgreen" stroke="black" points="49534,-7205 49248,-7205 49248,-7153 49534,-7153 49534,-7205"/>
<text text-anchor="middle" x="49391" y="-7193" font-family="Arial" font-size="10.00">Expert 36 Attention (TP)</text>
<text text-anchor="middle" x="49391" y="-7182" font-family="Arial" font-size="10.00">GPUs: 200,201</text>
<text text-anchor="middle" x="49391" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="49391" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert36_attn_out -->
<g id="node610" class="node">
<title>stage1_expert36_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="49230,-7205 48952,-7205 48952,-7153 49230,-7153 49230,-7205"/>
<text text-anchor="middle" x="49091" y="-7193" font-family="Arial" font-size="10.00">Expert 36 Attn Output (TP)</text>
<text text-anchor="middle" x="49091" y="-7182" font-family="Arial" font-size="10.00">GPUs: 200,201</text>
<text text-anchor="middle" x="49091" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="49091" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert36_mlp1 -->
<g id="node611" class="node">
<title>stage1_expert36_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="48934,-7205 48658,-7205 48658,-7153 48934,-7153 48934,-7205"/>
<text text-anchor="middle" x="48796" y="-7193" font-family="Arial" font-size="10.00">Expert 36 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="48796" y="-7182" font-family="Arial" font-size="10.00">GPUs: 200,201</text>
<text text-anchor="middle" x="48796" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="48796" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert36_mlp_act -->
<g id="node612" class="node">
<title>stage1_expert36_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="48640,-7205 48364,-7205 48364,-7153 48640,-7153 48640,-7205"/>
<text text-anchor="middle" x="48502" y="-7193" font-family="Arial" font-size="10.00">Expert 36 MLP GELU (TP)</text>
<text text-anchor="middle" x="48502" y="-7182" font-family="Arial" font-size="10.00">GPUs: 200,201</text>
<text text-anchor="middle" x="48502" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="48502" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert36_mlp2 -->
<g id="node613" class="node">
<title>stage1_expert36_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="48345.5,-7205 48076.5,-7205 48076.5,-7153 48345.5,-7153 48345.5,-7205"/>
<text text-anchor="middle" x="48211" y="-7193" font-family="Arial" font-size="10.00">Expert 36 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="48211" y="-7182" font-family="Arial" font-size="10.00">GPUs: 200,201</text>
<text text-anchor="middle" x="48211" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="48211" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert37_qkv -->
<g id="node614" class="node">
<title>stage1_expert37_qkv</title>
<polygon fill="lightgreen" stroke="black" points="48058,-7205 47772,-7205 47772,-7153 48058,-7153 48058,-7205"/>
<text text-anchor="middle" x="47915" y="-7193" font-family="Arial" font-size="10.00">Expert 37 QKV Proj (TP)</text>
<text text-anchor="middle" x="47915" y="-7182" font-family="Arial" font-size="10.00">GPUs: 202,203</text>
<text text-anchor="middle" x="47915" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="47915" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert37_attn -->
<g id="node615" class="node">
<title>stage1_expert37_attn</title>
<polygon fill="lightgreen" stroke="black" points="47754,-7205 47468,-7205 47468,-7153 47754,-7153 47754,-7205"/>
<text text-anchor="middle" x="47611" y="-7193" font-family="Arial" font-size="10.00">Expert 37 Attention (TP)</text>
<text text-anchor="middle" x="47611" y="-7182" font-family="Arial" font-size="10.00">GPUs: 202,203</text>
<text text-anchor="middle" x="47611" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="47611" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert37_attn_out -->
<g id="node616" class="node">
<title>stage1_expert37_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="47450,-7205 47172,-7205 47172,-7153 47450,-7153 47450,-7205"/>
<text text-anchor="middle" x="47311" y="-7193" font-family="Arial" font-size="10.00">Expert 37 Attn Output (TP)</text>
<text text-anchor="middle" x="47311" y="-7182" font-family="Arial" font-size="10.00">GPUs: 202,203</text>
<text text-anchor="middle" x="47311" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="47311" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert37_mlp1 -->
<g id="node617" class="node">
<title>stage1_expert37_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="47154,-7205 46878,-7205 46878,-7153 47154,-7153 47154,-7205"/>
<text text-anchor="middle" x="47016" y="-7193" font-family="Arial" font-size="10.00">Expert 37 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="47016" y="-7182" font-family="Arial" font-size="10.00">GPUs: 202,203</text>
<text text-anchor="middle" x="47016" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="47016" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert37_mlp_act -->
<g id="node618" class="node">
<title>stage1_expert37_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="46860,-7205 46584,-7205 46584,-7153 46860,-7153 46860,-7205"/>
<text text-anchor="middle" x="46722" y="-7193" font-family="Arial" font-size="10.00">Expert 37 MLP GELU (TP)</text>
<text text-anchor="middle" x="46722" y="-7182" font-family="Arial" font-size="10.00">GPUs: 202,203</text>
<text text-anchor="middle" x="46722" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="46722" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert37_mlp2 -->
<g id="node619" class="node">
<title>stage1_expert37_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="46565.5,-7205 46296.5,-7205 46296.5,-7153 46565.5,-7153 46565.5,-7205"/>
<text text-anchor="middle" x="46431" y="-7193" font-family="Arial" font-size="10.00">Expert 37 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="46431" y="-7182" font-family="Arial" font-size="10.00">GPUs: 202,203</text>
<text text-anchor="middle" x="46431" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="46431" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert38_qkv -->
<g id="node620" class="node">
<title>stage1_expert38_qkv</title>
<polygon fill="lightgreen" stroke="black" points="46278,-7205 45992,-7205 45992,-7153 46278,-7153 46278,-7205"/>
<text text-anchor="middle" x="46135" y="-7193" font-family="Arial" font-size="10.00">Expert 38 QKV Proj (TP)</text>
<text text-anchor="middle" x="46135" y="-7182" font-family="Arial" font-size="10.00">GPUs: 204,205</text>
<text text-anchor="middle" x="46135" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="46135" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert38_attn -->
<g id="node621" class="node">
<title>stage1_expert38_attn</title>
<polygon fill="lightgreen" stroke="black" points="45974,-7205 45688,-7205 45688,-7153 45974,-7153 45974,-7205"/>
<text text-anchor="middle" x="45831" y="-7193" font-family="Arial" font-size="10.00">Expert 38 Attention (TP)</text>
<text text-anchor="middle" x="45831" y="-7182" font-family="Arial" font-size="10.00">GPUs: 204,205</text>
<text text-anchor="middle" x="45831" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="45831" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert38_attn_out -->
<g id="node622" class="node">
<title>stage1_expert38_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="45670,-7205 45392,-7205 45392,-7153 45670,-7153 45670,-7205"/>
<text text-anchor="middle" x="45531" y="-7193" font-family="Arial" font-size="10.00">Expert 38 Attn Output (TP)</text>
<text text-anchor="middle" x="45531" y="-7182" font-family="Arial" font-size="10.00">GPUs: 204,205</text>
<text text-anchor="middle" x="45531" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="45531" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert38_mlp1 -->
<g id="node623" class="node">
<title>stage1_expert38_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="45374,-7205 45098,-7205 45098,-7153 45374,-7153 45374,-7205"/>
<text text-anchor="middle" x="45236" y="-7193" font-family="Arial" font-size="10.00">Expert 38 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="45236" y="-7182" font-family="Arial" font-size="10.00">GPUs: 204,205</text>
<text text-anchor="middle" x="45236" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="45236" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert38_mlp_act -->
<g id="node624" class="node">
<title>stage1_expert38_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="45080,-7205 44804,-7205 44804,-7153 45080,-7153 45080,-7205"/>
<text text-anchor="middle" x="44942" y="-7193" font-family="Arial" font-size="10.00">Expert 38 MLP GELU (TP)</text>
<text text-anchor="middle" x="44942" y="-7182" font-family="Arial" font-size="10.00">GPUs: 204,205</text>
<text text-anchor="middle" x="44942" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="44942" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert38_mlp2 -->
<g id="node625" class="node">
<title>stage1_expert38_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="44785.5,-7205 44516.5,-7205 44516.5,-7153 44785.5,-7153 44785.5,-7205"/>
<text text-anchor="middle" x="44651" y="-7193" font-family="Arial" font-size="10.00">Expert 38 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="44651" y="-7182" font-family="Arial" font-size="10.00">GPUs: 204,205</text>
<text text-anchor="middle" x="44651" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="44651" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert39_qkv -->
<g id="node626" class="node">
<title>stage1_expert39_qkv</title>
<polygon fill="lightgreen" stroke="black" points="44498,-7205 44212,-7205 44212,-7153 44498,-7153 44498,-7205"/>
<text text-anchor="middle" x="44355" y="-7193" font-family="Arial" font-size="10.00">Expert 39 QKV Proj (TP)</text>
<text text-anchor="middle" x="44355" y="-7182" font-family="Arial" font-size="10.00">GPUs: 206,207</text>
<text text-anchor="middle" x="44355" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="44355" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert39_attn -->
<g id="node627" class="node">
<title>stage1_expert39_attn</title>
<polygon fill="lightgreen" stroke="black" points="44194,-7205 43908,-7205 43908,-7153 44194,-7153 44194,-7205"/>
<text text-anchor="middle" x="44051" y="-7193" font-family="Arial" font-size="10.00">Expert 39 Attention (TP)</text>
<text text-anchor="middle" x="44051" y="-7182" font-family="Arial" font-size="10.00">GPUs: 206,207</text>
<text text-anchor="middle" x="44051" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="44051" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert39_attn_out -->
<g id="node628" class="node">
<title>stage1_expert39_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="43890,-7205 43612,-7205 43612,-7153 43890,-7153 43890,-7205"/>
<text text-anchor="middle" x="43751" y="-7193" font-family="Arial" font-size="10.00">Expert 39 Attn Output (TP)</text>
<text text-anchor="middle" x="43751" y="-7182" font-family="Arial" font-size="10.00">GPUs: 206,207</text>
<text text-anchor="middle" x="43751" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="43751" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert39_mlp1 -->
<g id="node629" class="node">
<title>stage1_expert39_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="43594,-7205 43318,-7205 43318,-7153 43594,-7153 43594,-7205"/>
<text text-anchor="middle" x="43456" y="-7193" font-family="Arial" font-size="10.00">Expert 39 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="43456" y="-7182" font-family="Arial" font-size="10.00">GPUs: 206,207</text>
<text text-anchor="middle" x="43456" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="43456" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert39_mlp_act -->
<g id="node630" class="node">
<title>stage1_expert39_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="43300,-7205 43024,-7205 43024,-7153 43300,-7153 43300,-7205"/>
<text text-anchor="middle" x="43162" y="-7193" font-family="Arial" font-size="10.00">Expert 39 MLP GELU (TP)</text>
<text text-anchor="middle" x="43162" y="-7182" font-family="Arial" font-size="10.00">GPUs: 206,207</text>
<text text-anchor="middle" x="43162" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="43162" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert39_mlp2 -->
<g id="node631" class="node">
<title>stage1_expert39_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="43005.5,-7205 42736.5,-7205 42736.5,-7153 43005.5,-7153 43005.5,-7205"/>
<text text-anchor="middle" x="42871" y="-7193" font-family="Arial" font-size="10.00">Expert 39 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="42871" y="-7182" font-family="Arial" font-size="10.00">GPUs: 206,207</text>
<text text-anchor="middle" x="42871" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="42871" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert40_qkv -->
<g id="node632" class="node">
<title>stage1_expert40_qkv</title>
<polygon fill="lightgreen" stroke="black" points="42718,-7205 42432,-7205 42432,-7153 42718,-7153 42718,-7205"/>
<text text-anchor="middle" x="42575" y="-7193" font-family="Arial" font-size="10.00">Expert 40 QKV Proj (TP)</text>
<text text-anchor="middle" x="42575" y="-7182" font-family="Arial" font-size="10.00">GPUs: 208,209</text>
<text text-anchor="middle" x="42575" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="42575" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert40_attn -->
<g id="node633" class="node">
<title>stage1_expert40_attn</title>
<polygon fill="lightgreen" stroke="black" points="42414,-7205 42128,-7205 42128,-7153 42414,-7153 42414,-7205"/>
<text text-anchor="middle" x="42271" y="-7193" font-family="Arial" font-size="10.00">Expert 40 Attention (TP)</text>
<text text-anchor="middle" x="42271" y="-7182" font-family="Arial" font-size="10.00">GPUs: 208,209</text>
<text text-anchor="middle" x="42271" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="42271" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert40_attn_out -->
<g id="node634" class="node">
<title>stage1_expert40_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="42110,-7205 41832,-7205 41832,-7153 42110,-7153 42110,-7205"/>
<text text-anchor="middle" x="41971" y="-7193" font-family="Arial" font-size="10.00">Expert 40 Attn Output (TP)</text>
<text text-anchor="middle" x="41971" y="-7182" font-family="Arial" font-size="10.00">GPUs: 208,209</text>
<text text-anchor="middle" x="41971" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="41971" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert40_mlp1 -->
<g id="node635" class="node">
<title>stage1_expert40_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="41814,-7205 41538,-7205 41538,-7153 41814,-7153 41814,-7205"/>
<text text-anchor="middle" x="41676" y="-7193" font-family="Arial" font-size="10.00">Expert 40 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="41676" y="-7182" font-family="Arial" font-size="10.00">GPUs: 208,209</text>
<text text-anchor="middle" x="41676" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="41676" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert40_mlp_act -->
<g id="node636" class="node">
<title>stage1_expert40_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="41520,-7205 41244,-7205 41244,-7153 41520,-7153 41520,-7205"/>
<text text-anchor="middle" x="41382" y="-7193" font-family="Arial" font-size="10.00">Expert 40 MLP GELU (TP)</text>
<text text-anchor="middle" x="41382" y="-7182" font-family="Arial" font-size="10.00">GPUs: 208,209</text>
<text text-anchor="middle" x="41382" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="41382" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert40_mlp2 -->
<g id="node637" class="node">
<title>stage1_expert40_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="41225.5,-7205 40956.5,-7205 40956.5,-7153 41225.5,-7153 41225.5,-7205"/>
<text text-anchor="middle" x="41091" y="-7193" font-family="Arial" font-size="10.00">Expert 40 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="41091" y="-7182" font-family="Arial" font-size="10.00">GPUs: 208,209</text>
<text text-anchor="middle" x="41091" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="41091" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert41_qkv -->
<g id="node638" class="node">
<title>stage1_expert41_qkv</title>
<polygon fill="lightgreen" stroke="black" points="40938,-7205 40652,-7205 40652,-7153 40938,-7153 40938,-7205"/>
<text text-anchor="middle" x="40795" y="-7193" font-family="Arial" font-size="10.00">Expert 41 QKV Proj (TP)</text>
<text text-anchor="middle" x="40795" y="-7182" font-family="Arial" font-size="10.00">GPUs: 210,211</text>
<text text-anchor="middle" x="40795" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="40795" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert41_attn -->
<g id="node639" class="node">
<title>stage1_expert41_attn</title>
<polygon fill="lightgreen" stroke="black" points="40634,-7205 40348,-7205 40348,-7153 40634,-7153 40634,-7205"/>
<text text-anchor="middle" x="40491" y="-7193" font-family="Arial" font-size="10.00">Expert 41 Attention (TP)</text>
<text text-anchor="middle" x="40491" y="-7182" font-family="Arial" font-size="10.00">GPUs: 210,211</text>
<text text-anchor="middle" x="40491" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="40491" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert41_attn_out -->
<g id="node640" class="node">
<title>stage1_expert41_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="40330,-7205 40052,-7205 40052,-7153 40330,-7153 40330,-7205"/>
<text text-anchor="middle" x="40191" y="-7193" font-family="Arial" font-size="10.00">Expert 41 Attn Output (TP)</text>
<text text-anchor="middle" x="40191" y="-7182" font-family="Arial" font-size="10.00">GPUs: 210,211</text>
<text text-anchor="middle" x="40191" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="40191" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert41_mlp1 -->
<g id="node641" class="node">
<title>stage1_expert41_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="40034,-7205 39758,-7205 39758,-7153 40034,-7153 40034,-7205"/>
<text text-anchor="middle" x="39896" y="-7193" font-family="Arial" font-size="10.00">Expert 41 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="39896" y="-7182" font-family="Arial" font-size="10.00">GPUs: 210,211</text>
<text text-anchor="middle" x="39896" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="39896" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert41_mlp_act -->
<g id="node642" class="node">
<title>stage1_expert41_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="39740,-7205 39464,-7205 39464,-7153 39740,-7153 39740,-7205"/>
<text text-anchor="middle" x="39602" y="-7193" font-family="Arial" font-size="10.00">Expert 41 MLP GELU (TP)</text>
<text text-anchor="middle" x="39602" y="-7182" font-family="Arial" font-size="10.00">GPUs: 210,211</text>
<text text-anchor="middle" x="39602" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="39602" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert41_mlp2 -->
<g id="node643" class="node">
<title>stage1_expert41_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="39445.5,-7205 39176.5,-7205 39176.5,-7153 39445.5,-7153 39445.5,-7205"/>
<text text-anchor="middle" x="39311" y="-7193" font-family="Arial" font-size="10.00">Expert 41 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="39311" y="-7182" font-family="Arial" font-size="10.00">GPUs: 210,211</text>
<text text-anchor="middle" x="39311" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="39311" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert42_qkv -->
<g id="node644" class="node">
<title>stage1_expert42_qkv</title>
<polygon fill="lightgreen" stroke="black" points="39158,-7205 38872,-7205 38872,-7153 39158,-7153 39158,-7205"/>
<text text-anchor="middle" x="39015" y="-7193" font-family="Arial" font-size="10.00">Expert 42 QKV Proj (TP)</text>
<text text-anchor="middle" x="39015" y="-7182" font-family="Arial" font-size="10.00">GPUs: 212,213</text>
<text text-anchor="middle" x="39015" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="39015" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert42_attn -->
<g id="node645" class="node">
<title>stage1_expert42_attn</title>
<polygon fill="lightgreen" stroke="black" points="38854,-7205 38568,-7205 38568,-7153 38854,-7153 38854,-7205"/>
<text text-anchor="middle" x="38711" y="-7193" font-family="Arial" font-size="10.00">Expert 42 Attention (TP)</text>
<text text-anchor="middle" x="38711" y="-7182" font-family="Arial" font-size="10.00">GPUs: 212,213</text>
<text text-anchor="middle" x="38711" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="38711" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert42_attn_out -->
<g id="node646" class="node">
<title>stage1_expert42_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="38550,-7205 38272,-7205 38272,-7153 38550,-7153 38550,-7205"/>
<text text-anchor="middle" x="38411" y="-7193" font-family="Arial" font-size="10.00">Expert 42 Attn Output (TP)</text>
<text text-anchor="middle" x="38411" y="-7182" font-family="Arial" font-size="10.00">GPUs: 212,213</text>
<text text-anchor="middle" x="38411" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="38411" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert42_mlp1 -->
<g id="node647" class="node">
<title>stage1_expert42_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="38254,-7205 37978,-7205 37978,-7153 38254,-7153 38254,-7205"/>
<text text-anchor="middle" x="38116" y="-7193" font-family="Arial" font-size="10.00">Expert 42 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="38116" y="-7182" font-family="Arial" font-size="10.00">GPUs: 212,213</text>
<text text-anchor="middle" x="38116" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="38116" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert42_mlp_act -->
<g id="node648" class="node">
<title>stage1_expert42_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="37960,-7205 37684,-7205 37684,-7153 37960,-7153 37960,-7205"/>
<text text-anchor="middle" x="37822" y="-7193" font-family="Arial" font-size="10.00">Expert 42 MLP GELU (TP)</text>
<text text-anchor="middle" x="37822" y="-7182" font-family="Arial" font-size="10.00">GPUs: 212,213</text>
<text text-anchor="middle" x="37822" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="37822" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert42_mlp2 -->
<g id="node649" class="node">
<title>stage1_expert42_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="37665.5,-7205 37396.5,-7205 37396.5,-7153 37665.5,-7153 37665.5,-7205"/>
<text text-anchor="middle" x="37531" y="-7193" font-family="Arial" font-size="10.00">Expert 42 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="37531" y="-7182" font-family="Arial" font-size="10.00">GPUs: 212,213</text>
<text text-anchor="middle" x="37531" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="37531" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert43_qkv -->
<g id="node650" class="node">
<title>stage1_expert43_qkv</title>
<polygon fill="lightgreen" stroke="black" points="37378,-7205 37092,-7205 37092,-7153 37378,-7153 37378,-7205"/>
<text text-anchor="middle" x="37235" y="-7193" font-family="Arial" font-size="10.00">Expert 43 QKV Proj (TP)</text>
<text text-anchor="middle" x="37235" y="-7182" font-family="Arial" font-size="10.00">GPUs: 214,215</text>
<text text-anchor="middle" x="37235" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="37235" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert43_attn -->
<g id="node651" class="node">
<title>stage1_expert43_attn</title>
<polygon fill="lightgreen" stroke="black" points="37074,-7205 36788,-7205 36788,-7153 37074,-7153 37074,-7205"/>
<text text-anchor="middle" x="36931" y="-7193" font-family="Arial" font-size="10.00">Expert 43 Attention (TP)</text>
<text text-anchor="middle" x="36931" y="-7182" font-family="Arial" font-size="10.00">GPUs: 214,215</text>
<text text-anchor="middle" x="36931" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="36931" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert43_attn_out -->
<g id="node652" class="node">
<title>stage1_expert43_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="36770,-7205 36492,-7205 36492,-7153 36770,-7153 36770,-7205"/>
<text text-anchor="middle" x="36631" y="-7193" font-family="Arial" font-size="10.00">Expert 43 Attn Output (TP)</text>
<text text-anchor="middle" x="36631" y="-7182" font-family="Arial" font-size="10.00">GPUs: 214,215</text>
<text text-anchor="middle" x="36631" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="36631" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert43_mlp1 -->
<g id="node653" class="node">
<title>stage1_expert43_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="36474,-7205 36198,-7205 36198,-7153 36474,-7153 36474,-7205"/>
<text text-anchor="middle" x="36336" y="-7193" font-family="Arial" font-size="10.00">Expert 43 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="36336" y="-7182" font-family="Arial" font-size="10.00">GPUs: 214,215</text>
<text text-anchor="middle" x="36336" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="36336" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert43_mlp_act -->
<g id="node654" class="node">
<title>stage1_expert43_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="36180,-7205 35904,-7205 35904,-7153 36180,-7153 36180,-7205"/>
<text text-anchor="middle" x="36042" y="-7193" font-family="Arial" font-size="10.00">Expert 43 MLP GELU (TP)</text>
<text text-anchor="middle" x="36042" y="-7182" font-family="Arial" font-size="10.00">GPUs: 214,215</text>
<text text-anchor="middle" x="36042" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="36042" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert43_mlp2 -->
<g id="node655" class="node">
<title>stage1_expert43_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="35885.5,-7205 35616.5,-7205 35616.5,-7153 35885.5,-7153 35885.5,-7205"/>
<text text-anchor="middle" x="35751" y="-7193" font-family="Arial" font-size="10.00">Expert 43 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="35751" y="-7182" font-family="Arial" font-size="10.00">GPUs: 214,215</text>
<text text-anchor="middle" x="35751" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="35751" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert44_qkv -->
<g id="node656" class="node">
<title>stage1_expert44_qkv</title>
<polygon fill="lightgreen" stroke="black" points="35598,-7205 35312,-7205 35312,-7153 35598,-7153 35598,-7205"/>
<text text-anchor="middle" x="35455" y="-7193" font-family="Arial" font-size="10.00">Expert 44 QKV Proj (TP)</text>
<text text-anchor="middle" x="35455" y="-7182" font-family="Arial" font-size="10.00">GPUs: 216,217</text>
<text text-anchor="middle" x="35455" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="35455" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert44_attn -->
<g id="node657" class="node">
<title>stage1_expert44_attn</title>
<polygon fill="lightgreen" stroke="black" points="35294,-7205 35008,-7205 35008,-7153 35294,-7153 35294,-7205"/>
<text text-anchor="middle" x="35151" y="-7193" font-family="Arial" font-size="10.00">Expert 44 Attention (TP)</text>
<text text-anchor="middle" x="35151" y="-7182" font-family="Arial" font-size="10.00">GPUs: 216,217</text>
<text text-anchor="middle" x="35151" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="35151" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert44_attn_out -->
<g id="node658" class="node">
<title>stage1_expert44_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="34990,-7205 34712,-7205 34712,-7153 34990,-7153 34990,-7205"/>
<text text-anchor="middle" x="34851" y="-7193" font-family="Arial" font-size="10.00">Expert 44 Attn Output (TP)</text>
<text text-anchor="middle" x="34851" y="-7182" font-family="Arial" font-size="10.00">GPUs: 216,217</text>
<text text-anchor="middle" x="34851" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="34851" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert44_mlp1 -->
<g id="node659" class="node">
<title>stage1_expert44_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="34694,-7205 34418,-7205 34418,-7153 34694,-7153 34694,-7205"/>
<text text-anchor="middle" x="34556" y="-7193" font-family="Arial" font-size="10.00">Expert 44 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="34556" y="-7182" font-family="Arial" font-size="10.00">GPUs: 216,217</text>
<text text-anchor="middle" x="34556" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="34556" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert44_mlp_act -->
<g id="node660" class="node">
<title>stage1_expert44_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="34400,-7205 34124,-7205 34124,-7153 34400,-7153 34400,-7205"/>
<text text-anchor="middle" x="34262" y="-7193" font-family="Arial" font-size="10.00">Expert 44 MLP GELU (TP)</text>
<text text-anchor="middle" x="34262" y="-7182" font-family="Arial" font-size="10.00">GPUs: 216,217</text>
<text text-anchor="middle" x="34262" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="34262" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert44_mlp2 -->
<g id="node661" class="node">
<title>stage1_expert44_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="34105.5,-7205 33836.5,-7205 33836.5,-7153 34105.5,-7153 34105.5,-7205"/>
<text text-anchor="middle" x="33971" y="-7193" font-family="Arial" font-size="10.00">Expert 44 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="33971" y="-7182" font-family="Arial" font-size="10.00">GPUs: 216,217</text>
<text text-anchor="middle" x="33971" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="33971" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert45_qkv -->
<g id="node662" class="node">
<title>stage1_expert45_qkv</title>
<polygon fill="lightgreen" stroke="black" points="33818,-7205 33532,-7205 33532,-7153 33818,-7153 33818,-7205"/>
<text text-anchor="middle" x="33675" y="-7193" font-family="Arial" font-size="10.00">Expert 45 QKV Proj (TP)</text>
<text text-anchor="middle" x="33675" y="-7182" font-family="Arial" font-size="10.00">GPUs: 218,219</text>
<text text-anchor="middle" x="33675" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="33675" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert45_attn -->
<g id="node663" class="node">
<title>stage1_expert45_attn</title>
<polygon fill="lightgreen" stroke="black" points="33514,-7205 33228,-7205 33228,-7153 33514,-7153 33514,-7205"/>
<text text-anchor="middle" x="33371" y="-7193" font-family="Arial" font-size="10.00">Expert 45 Attention (TP)</text>
<text text-anchor="middle" x="33371" y="-7182" font-family="Arial" font-size="10.00">GPUs: 218,219</text>
<text text-anchor="middle" x="33371" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="33371" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert45_attn_out -->
<g id="node664" class="node">
<title>stage1_expert45_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="33210,-7205 32932,-7205 32932,-7153 33210,-7153 33210,-7205"/>
<text text-anchor="middle" x="33071" y="-7193" font-family="Arial" font-size="10.00">Expert 45 Attn Output (TP)</text>
<text text-anchor="middle" x="33071" y="-7182" font-family="Arial" font-size="10.00">GPUs: 218,219</text>
<text text-anchor="middle" x="33071" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="33071" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert45_mlp1 -->
<g id="node665" class="node">
<title>stage1_expert45_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="32914,-7205 32638,-7205 32638,-7153 32914,-7153 32914,-7205"/>
<text text-anchor="middle" x="32776" y="-7193" font-family="Arial" font-size="10.00">Expert 45 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="32776" y="-7182" font-family="Arial" font-size="10.00">GPUs: 218,219</text>
<text text-anchor="middle" x="32776" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="32776" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert45_mlp_act -->
<g id="node666" class="node">
<title>stage1_expert45_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="32620,-7205 32344,-7205 32344,-7153 32620,-7153 32620,-7205"/>
<text text-anchor="middle" x="32482" y="-7193" font-family="Arial" font-size="10.00">Expert 45 MLP GELU (TP)</text>
<text text-anchor="middle" x="32482" y="-7182" font-family="Arial" font-size="10.00">GPUs: 218,219</text>
<text text-anchor="middle" x="32482" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="32482" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert45_mlp2 -->
<g id="node667" class="node">
<title>stage1_expert45_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="32325.5,-7205 32056.5,-7205 32056.5,-7153 32325.5,-7153 32325.5,-7205"/>
<text text-anchor="middle" x="32191" y="-7193" font-family="Arial" font-size="10.00">Expert 45 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="32191" y="-7182" font-family="Arial" font-size="10.00">GPUs: 218,219</text>
<text text-anchor="middle" x="32191" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="32191" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert46_qkv -->
<g id="node668" class="node">
<title>stage1_expert46_qkv</title>
<polygon fill="lightgreen" stroke="black" points="32038,-7205 31752,-7205 31752,-7153 32038,-7153 32038,-7205"/>
<text text-anchor="middle" x="31895" y="-7193" font-family="Arial" font-size="10.00">Expert 46 QKV Proj (TP)</text>
<text text-anchor="middle" x="31895" y="-7182" font-family="Arial" font-size="10.00">GPUs: 220,221</text>
<text text-anchor="middle" x="31895" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="31895" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert46_attn -->
<g id="node669" class="node">
<title>stage1_expert46_attn</title>
<polygon fill="lightgreen" stroke="black" points="31734,-7205 31448,-7205 31448,-7153 31734,-7153 31734,-7205"/>
<text text-anchor="middle" x="31591" y="-7193" font-family="Arial" font-size="10.00">Expert 46 Attention (TP)</text>
<text text-anchor="middle" x="31591" y="-7182" font-family="Arial" font-size="10.00">GPUs: 220,221</text>
<text text-anchor="middle" x="31591" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="31591" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert46_attn_out -->
<g id="node670" class="node">
<title>stage1_expert46_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="31430,-7205 31152,-7205 31152,-7153 31430,-7153 31430,-7205"/>
<text text-anchor="middle" x="31291" y="-7193" font-family="Arial" font-size="10.00">Expert 46 Attn Output (TP)</text>
<text text-anchor="middle" x="31291" y="-7182" font-family="Arial" font-size="10.00">GPUs: 220,221</text>
<text text-anchor="middle" x="31291" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="31291" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert46_mlp1 -->
<g id="node671" class="node">
<title>stage1_expert46_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="31134,-7205 30858,-7205 30858,-7153 31134,-7153 31134,-7205"/>
<text text-anchor="middle" x="30996" y="-7193" font-family="Arial" font-size="10.00">Expert 46 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="30996" y="-7182" font-family="Arial" font-size="10.00">GPUs: 220,221</text>
<text text-anchor="middle" x="30996" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="30996" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert46_mlp_act -->
<g id="node672" class="node">
<title>stage1_expert46_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="30840,-7205 30564,-7205 30564,-7153 30840,-7153 30840,-7205"/>
<text text-anchor="middle" x="30702" y="-7193" font-family="Arial" font-size="10.00">Expert 46 MLP GELU (TP)</text>
<text text-anchor="middle" x="30702" y="-7182" font-family="Arial" font-size="10.00">GPUs: 220,221</text>
<text text-anchor="middle" x="30702" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="30702" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert46_mlp2 -->
<g id="node673" class="node">
<title>stage1_expert46_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="30545.5,-7205 30276.5,-7205 30276.5,-7153 30545.5,-7153 30545.5,-7205"/>
<text text-anchor="middle" x="30411" y="-7193" font-family="Arial" font-size="10.00">Expert 46 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="30411" y="-7182" font-family="Arial" font-size="10.00">GPUs: 220,221</text>
<text text-anchor="middle" x="30411" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="30411" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert47_qkv -->
<g id="node674" class="node">
<title>stage1_expert47_qkv</title>
<polygon fill="lightgreen" stroke="black" points="30258,-7205 29972,-7205 29972,-7153 30258,-7153 30258,-7205"/>
<text text-anchor="middle" x="30115" y="-7193" font-family="Arial" font-size="10.00">Expert 47 QKV Proj (TP)</text>
<text text-anchor="middle" x="30115" y="-7182" font-family="Arial" font-size="10.00">GPUs: 222,223</text>
<text text-anchor="middle" x="30115" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="30115" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert47_attn -->
<g id="node675" class="node">
<title>stage1_expert47_attn</title>
<polygon fill="lightgreen" stroke="black" points="29954,-7205 29668,-7205 29668,-7153 29954,-7153 29954,-7205"/>
<text text-anchor="middle" x="29811" y="-7193" font-family="Arial" font-size="10.00">Expert 47 Attention (TP)</text>
<text text-anchor="middle" x="29811" y="-7182" font-family="Arial" font-size="10.00">GPUs: 222,223</text>
<text text-anchor="middle" x="29811" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="29811" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert47_attn_out -->
<g id="node676" class="node">
<title>stage1_expert47_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="29650,-7205 29372,-7205 29372,-7153 29650,-7153 29650,-7205"/>
<text text-anchor="middle" x="29511" y="-7193" font-family="Arial" font-size="10.00">Expert 47 Attn Output (TP)</text>
<text text-anchor="middle" x="29511" y="-7182" font-family="Arial" font-size="10.00">GPUs: 222,223</text>
<text text-anchor="middle" x="29511" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="29511" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert47_mlp1 -->
<g id="node677" class="node">
<title>stage1_expert47_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="29354,-7205 29078,-7205 29078,-7153 29354,-7153 29354,-7205"/>
<text text-anchor="middle" x="29216" y="-7193" font-family="Arial" font-size="10.00">Expert 47 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="29216" y="-7182" font-family="Arial" font-size="10.00">GPUs: 222,223</text>
<text text-anchor="middle" x="29216" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="29216" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert47_mlp_act -->
<g id="node678" class="node">
<title>stage1_expert47_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="29060,-7205 28784,-7205 28784,-7153 29060,-7153 29060,-7205"/>
<text text-anchor="middle" x="28922" y="-7193" font-family="Arial" font-size="10.00">Expert 47 MLP GELU (TP)</text>
<text text-anchor="middle" x="28922" y="-7182" font-family="Arial" font-size="10.00">GPUs: 222,223</text>
<text text-anchor="middle" x="28922" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="28922" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert47_mlp2 -->
<g id="node679" class="node">
<title>stage1_expert47_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="28765.5,-7205 28496.5,-7205 28496.5,-7153 28765.5,-7153 28765.5,-7205"/>
<text text-anchor="middle" x="28631" y="-7193" font-family="Arial" font-size="10.00">Expert 47 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="28631" y="-7182" font-family="Arial" font-size="10.00">GPUs: 222,223</text>
<text text-anchor="middle" x="28631" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="28631" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert48_qkv -->
<g id="node680" class="node">
<title>stage1_expert48_qkv</title>
<polygon fill="lightgreen" stroke="black" points="28478,-7205 28192,-7205 28192,-7153 28478,-7153 28478,-7205"/>
<text text-anchor="middle" x="28335" y="-7193" font-family="Arial" font-size="10.00">Expert 48 QKV Proj (TP)</text>
<text text-anchor="middle" x="28335" y="-7182" font-family="Arial" font-size="10.00">GPUs: 224,225</text>
<text text-anchor="middle" x="28335" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="28335" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert48_attn -->
<g id="node681" class="node">
<title>stage1_expert48_attn</title>
<polygon fill="lightgreen" stroke="black" points="28174,-7205 27888,-7205 27888,-7153 28174,-7153 28174,-7205"/>
<text text-anchor="middle" x="28031" y="-7193" font-family="Arial" font-size="10.00">Expert 48 Attention (TP)</text>
<text text-anchor="middle" x="28031" y="-7182" font-family="Arial" font-size="10.00">GPUs: 224,225</text>
<text text-anchor="middle" x="28031" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="28031" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert48_attn_out -->
<g id="node682" class="node">
<title>stage1_expert48_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="27870,-7205 27592,-7205 27592,-7153 27870,-7153 27870,-7205"/>
<text text-anchor="middle" x="27731" y="-7193" font-family="Arial" font-size="10.00">Expert 48 Attn Output (TP)</text>
<text text-anchor="middle" x="27731" y="-7182" font-family="Arial" font-size="10.00">GPUs: 224,225</text>
<text text-anchor="middle" x="27731" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="27731" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert48_mlp1 -->
<g id="node683" class="node">
<title>stage1_expert48_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="27574,-7205 27298,-7205 27298,-7153 27574,-7153 27574,-7205"/>
<text text-anchor="middle" x="27436" y="-7193" font-family="Arial" font-size="10.00">Expert 48 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="27436" y="-7182" font-family="Arial" font-size="10.00">GPUs: 224,225</text>
<text text-anchor="middle" x="27436" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="27436" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert48_mlp_act -->
<g id="node684" class="node">
<title>stage1_expert48_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="27280,-7205 27004,-7205 27004,-7153 27280,-7153 27280,-7205"/>
<text text-anchor="middle" x="27142" y="-7193" font-family="Arial" font-size="10.00">Expert 48 MLP GELU (TP)</text>
<text text-anchor="middle" x="27142" y="-7182" font-family="Arial" font-size="10.00">GPUs: 224,225</text>
<text text-anchor="middle" x="27142" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="27142" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert48_mlp2 -->
<g id="node685" class="node">
<title>stage1_expert48_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="26985.5,-7205 26716.5,-7205 26716.5,-7153 26985.5,-7153 26985.5,-7205"/>
<text text-anchor="middle" x="26851" y="-7193" font-family="Arial" font-size="10.00">Expert 48 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="26851" y="-7182" font-family="Arial" font-size="10.00">GPUs: 224,225</text>
<text text-anchor="middle" x="26851" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="26851" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert49_qkv -->
<g id="node686" class="node">
<title>stage1_expert49_qkv</title>
<polygon fill="lightgreen" stroke="black" points="26698,-7205 26412,-7205 26412,-7153 26698,-7153 26698,-7205"/>
<text text-anchor="middle" x="26555" y="-7193" font-family="Arial" font-size="10.00">Expert 49 QKV Proj (TP)</text>
<text text-anchor="middle" x="26555" y="-7182" font-family="Arial" font-size="10.00">GPUs: 226,227</text>
<text text-anchor="middle" x="26555" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="26555" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert49_attn -->
<g id="node687" class="node">
<title>stage1_expert49_attn</title>
<polygon fill="lightgreen" stroke="black" points="26394,-7205 26108,-7205 26108,-7153 26394,-7153 26394,-7205"/>
<text text-anchor="middle" x="26251" y="-7193" font-family="Arial" font-size="10.00">Expert 49 Attention (TP)</text>
<text text-anchor="middle" x="26251" y="-7182" font-family="Arial" font-size="10.00">GPUs: 226,227</text>
<text text-anchor="middle" x="26251" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="26251" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert49_attn_out -->
<g id="node688" class="node">
<title>stage1_expert49_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="26090,-7205 25812,-7205 25812,-7153 26090,-7153 26090,-7205"/>
<text text-anchor="middle" x="25951" y="-7193" font-family="Arial" font-size="10.00">Expert 49 Attn Output (TP)</text>
<text text-anchor="middle" x="25951" y="-7182" font-family="Arial" font-size="10.00">GPUs: 226,227</text>
<text text-anchor="middle" x="25951" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="25951" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert49_mlp1 -->
<g id="node689" class="node">
<title>stage1_expert49_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="25794,-7205 25518,-7205 25518,-7153 25794,-7153 25794,-7205"/>
<text text-anchor="middle" x="25656" y="-7193" font-family="Arial" font-size="10.00">Expert 49 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="25656" y="-7182" font-family="Arial" font-size="10.00">GPUs: 226,227</text>
<text text-anchor="middle" x="25656" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="25656" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert49_mlp_act -->
<g id="node690" class="node">
<title>stage1_expert49_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="25500,-7205 25224,-7205 25224,-7153 25500,-7153 25500,-7205"/>
<text text-anchor="middle" x="25362" y="-7193" font-family="Arial" font-size="10.00">Expert 49 MLP GELU (TP)</text>
<text text-anchor="middle" x="25362" y="-7182" font-family="Arial" font-size="10.00">GPUs: 226,227</text>
<text text-anchor="middle" x="25362" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="25362" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert49_mlp2 -->
<g id="node691" class="node">
<title>stage1_expert49_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="25205.5,-7205 24936.5,-7205 24936.5,-7153 25205.5,-7153 25205.5,-7205"/>
<text text-anchor="middle" x="25071" y="-7193" font-family="Arial" font-size="10.00">Expert 49 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="25071" y="-7182" font-family="Arial" font-size="10.00">GPUs: 226,227</text>
<text text-anchor="middle" x="25071" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="25071" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert50_qkv -->
<g id="node692" class="node">
<title>stage1_expert50_qkv</title>
<polygon fill="lightgreen" stroke="black" points="24918,-7205 24632,-7205 24632,-7153 24918,-7153 24918,-7205"/>
<text text-anchor="middle" x="24775" y="-7193" font-family="Arial" font-size="10.00">Expert 50 QKV Proj (TP)</text>
<text text-anchor="middle" x="24775" y="-7182" font-family="Arial" font-size="10.00">GPUs: 228,229</text>
<text text-anchor="middle" x="24775" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="24775" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert50_attn -->
<g id="node693" class="node">
<title>stage1_expert50_attn</title>
<polygon fill="lightgreen" stroke="black" points="24614,-7205 24328,-7205 24328,-7153 24614,-7153 24614,-7205"/>
<text text-anchor="middle" x="24471" y="-7193" font-family="Arial" font-size="10.00">Expert 50 Attention (TP)</text>
<text text-anchor="middle" x="24471" y="-7182" font-family="Arial" font-size="10.00">GPUs: 228,229</text>
<text text-anchor="middle" x="24471" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="24471" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert50_attn_out -->
<g id="node694" class="node">
<title>stage1_expert50_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="24310,-7205 24032,-7205 24032,-7153 24310,-7153 24310,-7205"/>
<text text-anchor="middle" x="24171" y="-7193" font-family="Arial" font-size="10.00">Expert 50 Attn Output (TP)</text>
<text text-anchor="middle" x="24171" y="-7182" font-family="Arial" font-size="10.00">GPUs: 228,229</text>
<text text-anchor="middle" x="24171" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="24171" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert50_mlp1 -->
<g id="node695" class="node">
<title>stage1_expert50_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="24014,-7205 23738,-7205 23738,-7153 24014,-7153 24014,-7205"/>
<text text-anchor="middle" x="23876" y="-7193" font-family="Arial" font-size="10.00">Expert 50 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="23876" y="-7182" font-family="Arial" font-size="10.00">GPUs: 228,229</text>
<text text-anchor="middle" x="23876" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="23876" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert50_mlp_act -->
<g id="node696" class="node">
<title>stage1_expert50_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="23720,-7205 23444,-7205 23444,-7153 23720,-7153 23720,-7205"/>
<text text-anchor="middle" x="23582" y="-7193" font-family="Arial" font-size="10.00">Expert 50 MLP GELU (TP)</text>
<text text-anchor="middle" x="23582" y="-7182" font-family="Arial" font-size="10.00">GPUs: 228,229</text>
<text text-anchor="middle" x="23582" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="23582" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert50_mlp2 -->
<g id="node697" class="node">
<title>stage1_expert50_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="23425.5,-7205 23156.5,-7205 23156.5,-7153 23425.5,-7153 23425.5,-7205"/>
<text text-anchor="middle" x="23291" y="-7193" font-family="Arial" font-size="10.00">Expert 50 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="23291" y="-7182" font-family="Arial" font-size="10.00">GPUs: 228,229</text>
<text text-anchor="middle" x="23291" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="23291" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert51_qkv -->
<g id="node698" class="node">
<title>stage1_expert51_qkv</title>
<polygon fill="lightgreen" stroke="black" points="23138,-7205 22852,-7205 22852,-7153 23138,-7153 23138,-7205"/>
<text text-anchor="middle" x="22995" y="-7193" font-family="Arial" font-size="10.00">Expert 51 QKV Proj (TP)</text>
<text text-anchor="middle" x="22995" y="-7182" font-family="Arial" font-size="10.00">GPUs: 230,231</text>
<text text-anchor="middle" x="22995" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="22995" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert51_attn -->
<g id="node699" class="node">
<title>stage1_expert51_attn</title>
<polygon fill="lightgreen" stroke="black" points="22834,-7205 22548,-7205 22548,-7153 22834,-7153 22834,-7205"/>
<text text-anchor="middle" x="22691" y="-7193" font-family="Arial" font-size="10.00">Expert 51 Attention (TP)</text>
<text text-anchor="middle" x="22691" y="-7182" font-family="Arial" font-size="10.00">GPUs: 230,231</text>
<text text-anchor="middle" x="22691" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="22691" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert51_attn_out -->
<g id="node700" class="node">
<title>stage1_expert51_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="22530,-7205 22252,-7205 22252,-7153 22530,-7153 22530,-7205"/>
<text text-anchor="middle" x="22391" y="-7193" font-family="Arial" font-size="10.00">Expert 51 Attn Output (TP)</text>
<text text-anchor="middle" x="22391" y="-7182" font-family="Arial" font-size="10.00">GPUs: 230,231</text>
<text text-anchor="middle" x="22391" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="22391" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert51_mlp1 -->
<g id="node701" class="node">
<title>stage1_expert51_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="22234,-7205 21958,-7205 21958,-7153 22234,-7153 22234,-7205"/>
<text text-anchor="middle" x="22096" y="-7193" font-family="Arial" font-size="10.00">Expert 51 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="22096" y="-7182" font-family="Arial" font-size="10.00">GPUs: 230,231</text>
<text text-anchor="middle" x="22096" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="22096" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert51_mlp_act -->
<g id="node702" class="node">
<title>stage1_expert51_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="21940,-7205 21664,-7205 21664,-7153 21940,-7153 21940,-7205"/>
<text text-anchor="middle" x="21802" y="-7193" font-family="Arial" font-size="10.00">Expert 51 MLP GELU (TP)</text>
<text text-anchor="middle" x="21802" y="-7182" font-family="Arial" font-size="10.00">GPUs: 230,231</text>
<text text-anchor="middle" x="21802" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="21802" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert51_mlp2 -->
<g id="node703" class="node">
<title>stage1_expert51_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="21645.5,-7205 21376.5,-7205 21376.5,-7153 21645.5,-7153 21645.5,-7205"/>
<text text-anchor="middle" x="21511" y="-7193" font-family="Arial" font-size="10.00">Expert 51 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="21511" y="-7182" font-family="Arial" font-size="10.00">GPUs: 230,231</text>
<text text-anchor="middle" x="21511" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="21511" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert52_qkv -->
<g id="node704" class="node">
<title>stage1_expert52_qkv</title>
<polygon fill="lightgreen" stroke="black" points="21358,-7205 21072,-7205 21072,-7153 21358,-7153 21358,-7205"/>
<text text-anchor="middle" x="21215" y="-7193" font-family="Arial" font-size="10.00">Expert 52 QKV Proj (TP)</text>
<text text-anchor="middle" x="21215" y="-7182" font-family="Arial" font-size="10.00">GPUs: 232,233</text>
<text text-anchor="middle" x="21215" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="21215" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert52_attn -->
<g id="node705" class="node">
<title>stage1_expert52_attn</title>
<polygon fill="lightgreen" stroke="black" points="21054,-7205 20768,-7205 20768,-7153 21054,-7153 21054,-7205"/>
<text text-anchor="middle" x="20911" y="-7193" font-family="Arial" font-size="10.00">Expert 52 Attention (TP)</text>
<text text-anchor="middle" x="20911" y="-7182" font-family="Arial" font-size="10.00">GPUs: 232,233</text>
<text text-anchor="middle" x="20911" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="20911" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert52_attn_out -->
<g id="node706" class="node">
<title>stage1_expert52_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="20750,-7205 20472,-7205 20472,-7153 20750,-7153 20750,-7205"/>
<text text-anchor="middle" x="20611" y="-7193" font-family="Arial" font-size="10.00">Expert 52 Attn Output (TP)</text>
<text text-anchor="middle" x="20611" y="-7182" font-family="Arial" font-size="10.00">GPUs: 232,233</text>
<text text-anchor="middle" x="20611" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="20611" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert52_mlp1 -->
<g id="node707" class="node">
<title>stage1_expert52_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="20454,-7205 20178,-7205 20178,-7153 20454,-7153 20454,-7205"/>
<text text-anchor="middle" x="20316" y="-7193" font-family="Arial" font-size="10.00">Expert 52 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="20316" y="-7182" font-family="Arial" font-size="10.00">GPUs: 232,233</text>
<text text-anchor="middle" x="20316" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="20316" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert52_mlp_act -->
<g id="node708" class="node">
<title>stage1_expert52_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="20160,-7205 19884,-7205 19884,-7153 20160,-7153 20160,-7205"/>
<text text-anchor="middle" x="20022" y="-7193" font-family="Arial" font-size="10.00">Expert 52 MLP GELU (TP)</text>
<text text-anchor="middle" x="20022" y="-7182" font-family="Arial" font-size="10.00">GPUs: 232,233</text>
<text text-anchor="middle" x="20022" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="20022" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert52_mlp2 -->
<g id="node709" class="node">
<title>stage1_expert52_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="19865.5,-7205 19596.5,-7205 19596.5,-7153 19865.5,-7153 19865.5,-7205"/>
<text text-anchor="middle" x="19731" y="-7193" font-family="Arial" font-size="10.00">Expert 52 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="19731" y="-7182" font-family="Arial" font-size="10.00">GPUs: 232,233</text>
<text text-anchor="middle" x="19731" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="19731" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert53_qkv -->
<g id="node710" class="node">
<title>stage1_expert53_qkv</title>
<polygon fill="lightgreen" stroke="black" points="19578,-7205 19292,-7205 19292,-7153 19578,-7153 19578,-7205"/>
<text text-anchor="middle" x="19435" y="-7193" font-family="Arial" font-size="10.00">Expert 53 QKV Proj (TP)</text>
<text text-anchor="middle" x="19435" y="-7182" font-family="Arial" font-size="10.00">GPUs: 234,235</text>
<text text-anchor="middle" x="19435" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="19435" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert53_attn -->
<g id="node711" class="node">
<title>stage1_expert53_attn</title>
<polygon fill="lightgreen" stroke="black" points="19274,-7205 18988,-7205 18988,-7153 19274,-7153 19274,-7205"/>
<text text-anchor="middle" x="19131" y="-7193" font-family="Arial" font-size="10.00">Expert 53 Attention (TP)</text>
<text text-anchor="middle" x="19131" y="-7182" font-family="Arial" font-size="10.00">GPUs: 234,235</text>
<text text-anchor="middle" x="19131" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="19131" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert53_attn_out -->
<g id="node712" class="node">
<title>stage1_expert53_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="18970,-7205 18692,-7205 18692,-7153 18970,-7153 18970,-7205"/>
<text text-anchor="middle" x="18831" y="-7193" font-family="Arial" font-size="10.00">Expert 53 Attn Output (TP)</text>
<text text-anchor="middle" x="18831" y="-7182" font-family="Arial" font-size="10.00">GPUs: 234,235</text>
<text text-anchor="middle" x="18831" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="18831" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert53_mlp1 -->
<g id="node713" class="node">
<title>stage1_expert53_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="18674,-7205 18398,-7205 18398,-7153 18674,-7153 18674,-7205"/>
<text text-anchor="middle" x="18536" y="-7193" font-family="Arial" font-size="10.00">Expert 53 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="18536" y="-7182" font-family="Arial" font-size="10.00">GPUs: 234,235</text>
<text text-anchor="middle" x="18536" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="18536" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert53_mlp_act -->
<g id="node714" class="node">
<title>stage1_expert53_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="18380,-7205 18104,-7205 18104,-7153 18380,-7153 18380,-7205"/>
<text text-anchor="middle" x="18242" y="-7193" font-family="Arial" font-size="10.00">Expert 53 MLP GELU (TP)</text>
<text text-anchor="middle" x="18242" y="-7182" font-family="Arial" font-size="10.00">GPUs: 234,235</text>
<text text-anchor="middle" x="18242" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="18242" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert53_mlp2 -->
<g id="node715" class="node">
<title>stage1_expert53_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="18085.5,-7205 17816.5,-7205 17816.5,-7153 18085.5,-7153 18085.5,-7205"/>
<text text-anchor="middle" x="17951" y="-7193" font-family="Arial" font-size="10.00">Expert 53 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="17951" y="-7182" font-family="Arial" font-size="10.00">GPUs: 234,235</text>
<text text-anchor="middle" x="17951" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="17951" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert54_qkv -->
<g id="node716" class="node">
<title>stage1_expert54_qkv</title>
<polygon fill="lightgreen" stroke="black" points="17798,-7205 17512,-7205 17512,-7153 17798,-7153 17798,-7205"/>
<text text-anchor="middle" x="17655" y="-7193" font-family="Arial" font-size="10.00">Expert 54 QKV Proj (TP)</text>
<text text-anchor="middle" x="17655" y="-7182" font-family="Arial" font-size="10.00">GPUs: 236,237</text>
<text text-anchor="middle" x="17655" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="17655" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert54_attn -->
<g id="node717" class="node">
<title>stage1_expert54_attn</title>
<polygon fill="lightgreen" stroke="black" points="17494,-7205 17208,-7205 17208,-7153 17494,-7153 17494,-7205"/>
<text text-anchor="middle" x="17351" y="-7193" font-family="Arial" font-size="10.00">Expert 54 Attention (TP)</text>
<text text-anchor="middle" x="17351" y="-7182" font-family="Arial" font-size="10.00">GPUs: 236,237</text>
<text text-anchor="middle" x="17351" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="17351" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert54_attn_out -->
<g id="node718" class="node">
<title>stage1_expert54_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="17190,-7205 16912,-7205 16912,-7153 17190,-7153 17190,-7205"/>
<text text-anchor="middle" x="17051" y="-7193" font-family="Arial" font-size="10.00">Expert 54 Attn Output (TP)</text>
<text text-anchor="middle" x="17051" y="-7182" font-family="Arial" font-size="10.00">GPUs: 236,237</text>
<text text-anchor="middle" x="17051" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="17051" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert54_mlp1 -->
<g id="node719" class="node">
<title>stage1_expert54_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="16894,-7205 16618,-7205 16618,-7153 16894,-7153 16894,-7205"/>
<text text-anchor="middle" x="16756" y="-7193" font-family="Arial" font-size="10.00">Expert 54 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="16756" y="-7182" font-family="Arial" font-size="10.00">GPUs: 236,237</text>
<text text-anchor="middle" x="16756" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="16756" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert54_mlp_act -->
<g id="node720" class="node">
<title>stage1_expert54_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="16600,-7205 16324,-7205 16324,-7153 16600,-7153 16600,-7205"/>
<text text-anchor="middle" x="16462" y="-7193" font-family="Arial" font-size="10.00">Expert 54 MLP GELU (TP)</text>
<text text-anchor="middle" x="16462" y="-7182" font-family="Arial" font-size="10.00">GPUs: 236,237</text>
<text text-anchor="middle" x="16462" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="16462" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert54_mlp2 -->
<g id="node721" class="node">
<title>stage1_expert54_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="16305.5,-7205 16036.5,-7205 16036.5,-7153 16305.5,-7153 16305.5,-7205"/>
<text text-anchor="middle" x="16171" y="-7193" font-family="Arial" font-size="10.00">Expert 54 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="16171" y="-7182" font-family="Arial" font-size="10.00">GPUs: 236,237</text>
<text text-anchor="middle" x="16171" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="16171" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert55_qkv -->
<g id="node722" class="node">
<title>stage1_expert55_qkv</title>
<polygon fill="lightgreen" stroke="black" points="16018,-7205 15732,-7205 15732,-7153 16018,-7153 16018,-7205"/>
<text text-anchor="middle" x="15875" y="-7193" font-family="Arial" font-size="10.00">Expert 55 QKV Proj (TP)</text>
<text text-anchor="middle" x="15875" y="-7182" font-family="Arial" font-size="10.00">GPUs: 238,239</text>
<text text-anchor="middle" x="15875" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="15875" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert55_attn -->
<g id="node723" class="node">
<title>stage1_expert55_attn</title>
<polygon fill="lightgreen" stroke="black" points="15714,-7205 15428,-7205 15428,-7153 15714,-7153 15714,-7205"/>
<text text-anchor="middle" x="15571" y="-7193" font-family="Arial" font-size="10.00">Expert 55 Attention (TP)</text>
<text text-anchor="middle" x="15571" y="-7182" font-family="Arial" font-size="10.00">GPUs: 238,239</text>
<text text-anchor="middle" x="15571" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="15571" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert55_attn_out -->
<g id="node724" class="node">
<title>stage1_expert55_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="15410,-7205 15132,-7205 15132,-7153 15410,-7153 15410,-7205"/>
<text text-anchor="middle" x="15271" y="-7193" font-family="Arial" font-size="10.00">Expert 55 Attn Output (TP)</text>
<text text-anchor="middle" x="15271" y="-7182" font-family="Arial" font-size="10.00">GPUs: 238,239</text>
<text text-anchor="middle" x="15271" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="15271" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert55_mlp1 -->
<g id="node725" class="node">
<title>stage1_expert55_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="15114,-7205 14838,-7205 14838,-7153 15114,-7153 15114,-7205"/>
<text text-anchor="middle" x="14976" y="-7193" font-family="Arial" font-size="10.00">Expert 55 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="14976" y="-7182" font-family="Arial" font-size="10.00">GPUs: 238,239</text>
<text text-anchor="middle" x="14976" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="14976" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert55_mlp_act -->
<g id="node726" class="node">
<title>stage1_expert55_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="14820,-7205 14544,-7205 14544,-7153 14820,-7153 14820,-7205"/>
<text text-anchor="middle" x="14682" y="-7193" font-family="Arial" font-size="10.00">Expert 55 MLP GELU (TP)</text>
<text text-anchor="middle" x="14682" y="-7182" font-family="Arial" font-size="10.00">GPUs: 238,239</text>
<text text-anchor="middle" x="14682" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="14682" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert55_mlp2 -->
<g id="node727" class="node">
<title>stage1_expert55_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="14525.5,-7205 14256.5,-7205 14256.5,-7153 14525.5,-7153 14525.5,-7205"/>
<text text-anchor="middle" x="14391" y="-7193" font-family="Arial" font-size="10.00">Expert 55 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="14391" y="-7182" font-family="Arial" font-size="10.00">GPUs: 238,239</text>
<text text-anchor="middle" x="14391" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="14391" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert56_qkv -->
<g id="node728" class="node">
<title>stage1_expert56_qkv</title>
<polygon fill="lightgreen" stroke="black" points="14238,-7205 13952,-7205 13952,-7153 14238,-7153 14238,-7205"/>
<text text-anchor="middle" x="14095" y="-7193" font-family="Arial" font-size="10.00">Expert 56 QKV Proj (TP)</text>
<text text-anchor="middle" x="14095" y="-7182" font-family="Arial" font-size="10.00">GPUs: 240,241</text>
<text text-anchor="middle" x="14095" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="14095" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert56_attn -->
<g id="node729" class="node">
<title>stage1_expert56_attn</title>
<polygon fill="lightgreen" stroke="black" points="13934,-7205 13648,-7205 13648,-7153 13934,-7153 13934,-7205"/>
<text text-anchor="middle" x="13791" y="-7193" font-family="Arial" font-size="10.00">Expert 56 Attention (TP)</text>
<text text-anchor="middle" x="13791" y="-7182" font-family="Arial" font-size="10.00">GPUs: 240,241</text>
<text text-anchor="middle" x="13791" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="13791" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert56_attn_out -->
<g id="node730" class="node">
<title>stage1_expert56_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="13630,-7205 13352,-7205 13352,-7153 13630,-7153 13630,-7205"/>
<text text-anchor="middle" x="13491" y="-7193" font-family="Arial" font-size="10.00">Expert 56 Attn Output (TP)</text>
<text text-anchor="middle" x="13491" y="-7182" font-family="Arial" font-size="10.00">GPUs: 240,241</text>
<text text-anchor="middle" x="13491" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="13491" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert56_mlp1 -->
<g id="node731" class="node">
<title>stage1_expert56_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="13334,-7205 13058,-7205 13058,-7153 13334,-7153 13334,-7205"/>
<text text-anchor="middle" x="13196" y="-7193" font-family="Arial" font-size="10.00">Expert 56 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="13196" y="-7182" font-family="Arial" font-size="10.00">GPUs: 240,241</text>
<text text-anchor="middle" x="13196" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="13196" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert56_mlp_act -->
<g id="node732" class="node">
<title>stage1_expert56_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="13040,-7205 12764,-7205 12764,-7153 13040,-7153 13040,-7205"/>
<text text-anchor="middle" x="12902" y="-7193" font-family="Arial" font-size="10.00">Expert 56 MLP GELU (TP)</text>
<text text-anchor="middle" x="12902" y="-7182" font-family="Arial" font-size="10.00">GPUs: 240,241</text>
<text text-anchor="middle" x="12902" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="12902" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert56_mlp2 -->
<g id="node733" class="node">
<title>stage1_expert56_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="12745.5,-7205 12476.5,-7205 12476.5,-7153 12745.5,-7153 12745.5,-7205"/>
<text text-anchor="middle" x="12611" y="-7193" font-family="Arial" font-size="10.00">Expert 56 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="12611" y="-7182" font-family="Arial" font-size="10.00">GPUs: 240,241</text>
<text text-anchor="middle" x="12611" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="12611" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert57_qkv -->
<g id="node734" class="node">
<title>stage1_expert57_qkv</title>
<polygon fill="lightgreen" stroke="black" points="12458,-7205 12172,-7205 12172,-7153 12458,-7153 12458,-7205"/>
<text text-anchor="middle" x="12315" y="-7193" font-family="Arial" font-size="10.00">Expert 57 QKV Proj (TP)</text>
<text text-anchor="middle" x="12315" y="-7182" font-family="Arial" font-size="10.00">GPUs: 242,243</text>
<text text-anchor="middle" x="12315" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="12315" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert57_attn -->
<g id="node735" class="node">
<title>stage1_expert57_attn</title>
<polygon fill="lightgreen" stroke="black" points="12154,-7205 11868,-7205 11868,-7153 12154,-7153 12154,-7205"/>
<text text-anchor="middle" x="12011" y="-7193" font-family="Arial" font-size="10.00">Expert 57 Attention (TP)</text>
<text text-anchor="middle" x="12011" y="-7182" font-family="Arial" font-size="10.00">GPUs: 242,243</text>
<text text-anchor="middle" x="12011" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="12011" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert57_attn_out -->
<g id="node736" class="node">
<title>stage1_expert57_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="11850,-7205 11572,-7205 11572,-7153 11850,-7153 11850,-7205"/>
<text text-anchor="middle" x="11711" y="-7193" font-family="Arial" font-size="10.00">Expert 57 Attn Output (TP)</text>
<text text-anchor="middle" x="11711" y="-7182" font-family="Arial" font-size="10.00">GPUs: 242,243</text>
<text text-anchor="middle" x="11711" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="11711" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert57_mlp1 -->
<g id="node737" class="node">
<title>stage1_expert57_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="11554,-7205 11278,-7205 11278,-7153 11554,-7153 11554,-7205"/>
<text text-anchor="middle" x="11416" y="-7193" font-family="Arial" font-size="10.00">Expert 57 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="11416" y="-7182" font-family="Arial" font-size="10.00">GPUs: 242,243</text>
<text text-anchor="middle" x="11416" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="11416" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert57_mlp_act -->
<g id="node738" class="node">
<title>stage1_expert57_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="11260,-7205 10984,-7205 10984,-7153 11260,-7153 11260,-7205"/>
<text text-anchor="middle" x="11122" y="-7193" font-family="Arial" font-size="10.00">Expert 57 MLP GELU (TP)</text>
<text text-anchor="middle" x="11122" y="-7182" font-family="Arial" font-size="10.00">GPUs: 242,243</text>
<text text-anchor="middle" x="11122" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="11122" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert57_mlp2 -->
<g id="node739" class="node">
<title>stage1_expert57_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="10965.5,-7205 10696.5,-7205 10696.5,-7153 10965.5,-7153 10965.5,-7205"/>
<text text-anchor="middle" x="10831" y="-7193" font-family="Arial" font-size="10.00">Expert 57 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="10831" y="-7182" font-family="Arial" font-size="10.00">GPUs: 242,243</text>
<text text-anchor="middle" x="10831" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="10831" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert58_qkv -->
<g id="node740" class="node">
<title>stage1_expert58_qkv</title>
<polygon fill="lightgreen" stroke="black" points="10678,-7205 10392,-7205 10392,-7153 10678,-7153 10678,-7205"/>
<text text-anchor="middle" x="10535" y="-7193" font-family="Arial" font-size="10.00">Expert 58 QKV Proj (TP)</text>
<text text-anchor="middle" x="10535" y="-7182" font-family="Arial" font-size="10.00">GPUs: 244,245</text>
<text text-anchor="middle" x="10535" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="10535" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert58_attn -->
<g id="node741" class="node">
<title>stage1_expert58_attn</title>
<polygon fill="lightgreen" stroke="black" points="10374,-7205 10088,-7205 10088,-7153 10374,-7153 10374,-7205"/>
<text text-anchor="middle" x="10231" y="-7193" font-family="Arial" font-size="10.00">Expert 58 Attention (TP)</text>
<text text-anchor="middle" x="10231" y="-7182" font-family="Arial" font-size="10.00">GPUs: 244,245</text>
<text text-anchor="middle" x="10231" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="10231" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert58_attn_out -->
<g id="node742" class="node">
<title>stage1_expert58_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="10070,-7205 9792,-7205 9792,-7153 10070,-7153 10070,-7205"/>
<text text-anchor="middle" x="9931" y="-7193" font-family="Arial" font-size="10.00">Expert 58 Attn Output (TP)</text>
<text text-anchor="middle" x="9931" y="-7182" font-family="Arial" font-size="10.00">GPUs: 244,245</text>
<text text-anchor="middle" x="9931" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="9931" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert58_mlp1 -->
<g id="node743" class="node">
<title>stage1_expert58_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="9774,-7205 9498,-7205 9498,-7153 9774,-7153 9774,-7205"/>
<text text-anchor="middle" x="9636" y="-7193" font-family="Arial" font-size="10.00">Expert 58 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="9636" y="-7182" font-family="Arial" font-size="10.00">GPUs: 244,245</text>
<text text-anchor="middle" x="9636" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="9636" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert58_mlp_act -->
<g id="node744" class="node">
<title>stage1_expert58_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="9480,-7205 9204,-7205 9204,-7153 9480,-7153 9480,-7205"/>
<text text-anchor="middle" x="9342" y="-7193" font-family="Arial" font-size="10.00">Expert 58 MLP GELU (TP)</text>
<text text-anchor="middle" x="9342" y="-7182" font-family="Arial" font-size="10.00">GPUs: 244,245</text>
<text text-anchor="middle" x="9342" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="9342" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert58_mlp2 -->
<g id="node745" class="node">
<title>stage1_expert58_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="9185.5,-7205 8916.5,-7205 8916.5,-7153 9185.5,-7153 9185.5,-7205"/>
<text text-anchor="middle" x="9051" y="-7193" font-family="Arial" font-size="10.00">Expert 58 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="9051" y="-7182" font-family="Arial" font-size="10.00">GPUs: 244,245</text>
<text text-anchor="middle" x="9051" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="9051" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert59_qkv -->
<g id="node746" class="node">
<title>stage1_expert59_qkv</title>
<polygon fill="lightgreen" stroke="black" points="8898,-7205 8612,-7205 8612,-7153 8898,-7153 8898,-7205"/>
<text text-anchor="middle" x="8755" y="-7193" font-family="Arial" font-size="10.00">Expert 59 QKV Proj (TP)</text>
<text text-anchor="middle" x="8755" y="-7182" font-family="Arial" font-size="10.00">GPUs: 246,247</text>
<text text-anchor="middle" x="8755" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="8755" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert59_attn -->
<g id="node747" class="node">
<title>stage1_expert59_attn</title>
<polygon fill="lightgreen" stroke="black" points="8594,-7205 8308,-7205 8308,-7153 8594,-7153 8594,-7205"/>
<text text-anchor="middle" x="8451" y="-7193" font-family="Arial" font-size="10.00">Expert 59 Attention (TP)</text>
<text text-anchor="middle" x="8451" y="-7182" font-family="Arial" font-size="10.00">GPUs: 246,247</text>
<text text-anchor="middle" x="8451" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="8451" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert59_attn_out -->
<g id="node748" class="node">
<title>stage1_expert59_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="8290,-7205 8012,-7205 8012,-7153 8290,-7153 8290,-7205"/>
<text text-anchor="middle" x="8151" y="-7193" font-family="Arial" font-size="10.00">Expert 59 Attn Output (TP)</text>
<text text-anchor="middle" x="8151" y="-7182" font-family="Arial" font-size="10.00">GPUs: 246,247</text>
<text text-anchor="middle" x="8151" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="8151" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert59_mlp1 -->
<g id="node749" class="node">
<title>stage1_expert59_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="7994,-7205 7718,-7205 7718,-7153 7994,-7153 7994,-7205"/>
<text text-anchor="middle" x="7856" y="-7193" font-family="Arial" font-size="10.00">Expert 59 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="7856" y="-7182" font-family="Arial" font-size="10.00">GPUs: 246,247</text>
<text text-anchor="middle" x="7856" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="7856" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert59_mlp_act -->
<g id="node750" class="node">
<title>stage1_expert59_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="7700,-7205 7424,-7205 7424,-7153 7700,-7153 7700,-7205"/>
<text text-anchor="middle" x="7562" y="-7193" font-family="Arial" font-size="10.00">Expert 59 MLP GELU (TP)</text>
<text text-anchor="middle" x="7562" y="-7182" font-family="Arial" font-size="10.00">GPUs: 246,247</text>
<text text-anchor="middle" x="7562" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="7562" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert59_mlp2 -->
<g id="node751" class="node">
<title>stage1_expert59_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="7405.5,-7205 7136.5,-7205 7136.5,-7153 7405.5,-7153 7405.5,-7205"/>
<text text-anchor="middle" x="7271" y="-7193" font-family="Arial" font-size="10.00">Expert 59 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="7271" y="-7182" font-family="Arial" font-size="10.00">GPUs: 246,247</text>
<text text-anchor="middle" x="7271" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="7271" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert60_qkv -->
<g id="node752" class="node">
<title>stage1_expert60_qkv</title>
<polygon fill="lightgreen" stroke="black" points="7118,-7205 6832,-7205 6832,-7153 7118,-7153 7118,-7205"/>
<text text-anchor="middle" x="6975" y="-7193" font-family="Arial" font-size="10.00">Expert 60 QKV Proj (TP)</text>
<text text-anchor="middle" x="6975" y="-7182" font-family="Arial" font-size="10.00">GPUs: 248,249</text>
<text text-anchor="middle" x="6975" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="6975" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert60_attn -->
<g id="node753" class="node">
<title>stage1_expert60_attn</title>
<polygon fill="lightgreen" stroke="black" points="6814,-7205 6528,-7205 6528,-7153 6814,-7153 6814,-7205"/>
<text text-anchor="middle" x="6671" y="-7193" font-family="Arial" font-size="10.00">Expert 60 Attention (TP)</text>
<text text-anchor="middle" x="6671" y="-7182" font-family="Arial" font-size="10.00">GPUs: 248,249</text>
<text text-anchor="middle" x="6671" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="6671" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert60_attn_out -->
<g id="node754" class="node">
<title>stage1_expert60_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="6510,-7205 6232,-7205 6232,-7153 6510,-7153 6510,-7205"/>
<text text-anchor="middle" x="6371" y="-7193" font-family="Arial" font-size="10.00">Expert 60 Attn Output (TP)</text>
<text text-anchor="middle" x="6371" y="-7182" font-family="Arial" font-size="10.00">GPUs: 248,249</text>
<text text-anchor="middle" x="6371" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="6371" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert60_mlp1 -->
<g id="node755" class="node">
<title>stage1_expert60_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="6214,-7205 5938,-7205 5938,-7153 6214,-7153 6214,-7205"/>
<text text-anchor="middle" x="6076" y="-7193" font-family="Arial" font-size="10.00">Expert 60 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="6076" y="-7182" font-family="Arial" font-size="10.00">GPUs: 248,249</text>
<text text-anchor="middle" x="6076" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="6076" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert60_mlp_act -->
<g id="node756" class="node">
<title>stage1_expert60_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="5920,-7205 5644,-7205 5644,-7153 5920,-7153 5920,-7205"/>
<text text-anchor="middle" x="5782" y="-7193" font-family="Arial" font-size="10.00">Expert 60 MLP GELU (TP)</text>
<text text-anchor="middle" x="5782" y="-7182" font-family="Arial" font-size="10.00">GPUs: 248,249</text>
<text text-anchor="middle" x="5782" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="5782" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert60_mlp2 -->
<g id="node757" class="node">
<title>stage1_expert60_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="5625.5,-7205 5356.5,-7205 5356.5,-7153 5625.5,-7153 5625.5,-7205"/>
<text text-anchor="middle" x="5491" y="-7193" font-family="Arial" font-size="10.00">Expert 60 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="5491" y="-7182" font-family="Arial" font-size="10.00">GPUs: 248,249</text>
<text text-anchor="middle" x="5491" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="5491" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert61_qkv -->
<g id="node758" class="node">
<title>stage1_expert61_qkv</title>
<polygon fill="lightgreen" stroke="black" points="5338,-7205 5052,-7205 5052,-7153 5338,-7153 5338,-7205"/>
<text text-anchor="middle" x="5195" y="-7193" font-family="Arial" font-size="10.00">Expert 61 QKV Proj (TP)</text>
<text text-anchor="middle" x="5195" y="-7182" font-family="Arial" font-size="10.00">GPUs: 250,251</text>
<text text-anchor="middle" x="5195" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="5195" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert61_attn -->
<g id="node759" class="node">
<title>stage1_expert61_attn</title>
<polygon fill="lightgreen" stroke="black" points="5034,-7205 4748,-7205 4748,-7153 5034,-7153 5034,-7205"/>
<text text-anchor="middle" x="4891" y="-7193" font-family="Arial" font-size="10.00">Expert 61 Attention (TP)</text>
<text text-anchor="middle" x="4891" y="-7182" font-family="Arial" font-size="10.00">GPUs: 250,251</text>
<text text-anchor="middle" x="4891" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="4891" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert61_attn_out -->
<g id="node760" class="node">
<title>stage1_expert61_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="4730,-7205 4452,-7205 4452,-7153 4730,-7153 4730,-7205"/>
<text text-anchor="middle" x="4591" y="-7193" font-family="Arial" font-size="10.00">Expert 61 Attn Output (TP)</text>
<text text-anchor="middle" x="4591" y="-7182" font-family="Arial" font-size="10.00">GPUs: 250,251</text>
<text text-anchor="middle" x="4591" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="4591" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert61_mlp1 -->
<g id="node761" class="node">
<title>stage1_expert61_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="4434,-7205 4158,-7205 4158,-7153 4434,-7153 4434,-7205"/>
<text text-anchor="middle" x="4296" y="-7193" font-family="Arial" font-size="10.00">Expert 61 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="4296" y="-7182" font-family="Arial" font-size="10.00">GPUs: 250,251</text>
<text text-anchor="middle" x="4296" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="4296" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert61_mlp_act -->
<g id="node762" class="node">
<title>stage1_expert61_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="4140,-7205 3864,-7205 3864,-7153 4140,-7153 4140,-7205"/>
<text text-anchor="middle" x="4002" y="-7193" font-family="Arial" font-size="10.00">Expert 61 MLP GELU (TP)</text>
<text text-anchor="middle" x="4002" y="-7182" font-family="Arial" font-size="10.00">GPUs: 250,251</text>
<text text-anchor="middle" x="4002" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="4002" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert61_mlp2 -->
<g id="node763" class="node">
<title>stage1_expert61_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="3845.5,-7205 3576.5,-7205 3576.5,-7153 3845.5,-7153 3845.5,-7205"/>
<text text-anchor="middle" x="3711" y="-7193" font-family="Arial" font-size="10.00">Expert 61 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="3711" y="-7182" font-family="Arial" font-size="10.00">GPUs: 250,251</text>
<text text-anchor="middle" x="3711" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="3711" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert62_qkv -->
<g id="node764" class="node">
<title>stage1_expert62_qkv</title>
<polygon fill="lightgreen" stroke="black" points="3558,-7205 3272,-7205 3272,-7153 3558,-7153 3558,-7205"/>
<text text-anchor="middle" x="3415" y="-7193" font-family="Arial" font-size="10.00">Expert 62 QKV Proj (TP)</text>
<text text-anchor="middle" x="3415" y="-7182" font-family="Arial" font-size="10.00">GPUs: 252,253</text>
<text text-anchor="middle" x="3415" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="3415" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert62_attn -->
<g id="node765" class="node">
<title>stage1_expert62_attn</title>
<polygon fill="lightgreen" stroke="black" points="3254,-7205 2968,-7205 2968,-7153 3254,-7153 3254,-7205"/>
<text text-anchor="middle" x="3111" y="-7193" font-family="Arial" font-size="10.00">Expert 62 Attention (TP)</text>
<text text-anchor="middle" x="3111" y="-7182" font-family="Arial" font-size="10.00">GPUs: 252,253</text>
<text text-anchor="middle" x="3111" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="3111" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert62_attn_out -->
<g id="node766" class="node">
<title>stage1_expert62_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="2950,-7205 2672,-7205 2672,-7153 2950,-7153 2950,-7205"/>
<text text-anchor="middle" x="2811" y="-7193" font-family="Arial" font-size="10.00">Expert 62 Attn Output (TP)</text>
<text text-anchor="middle" x="2811" y="-7182" font-family="Arial" font-size="10.00">GPUs: 252,253</text>
<text text-anchor="middle" x="2811" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="2811" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert62_mlp1 -->
<g id="node767" class="node">
<title>stage1_expert62_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="2654,-7205 2378,-7205 2378,-7153 2654,-7153 2654,-7205"/>
<text text-anchor="middle" x="2516" y="-7193" font-family="Arial" font-size="10.00">Expert 62 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="2516" y="-7182" font-family="Arial" font-size="10.00">GPUs: 252,253</text>
<text text-anchor="middle" x="2516" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="2516" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert62_mlp_act -->
<g id="node768" class="node">
<title>stage1_expert62_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="2360,-7205 2084,-7205 2084,-7153 2360,-7153 2360,-7205"/>
<text text-anchor="middle" x="2222" y="-7193" font-family="Arial" font-size="10.00">Expert 62 MLP GELU (TP)</text>
<text text-anchor="middle" x="2222" y="-7182" font-family="Arial" font-size="10.00">GPUs: 252,253</text>
<text text-anchor="middle" x="2222" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="2222" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert62_mlp2 -->
<g id="node769" class="node">
<title>stage1_expert62_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="2065.5,-7205 1796.5,-7205 1796.5,-7153 2065.5,-7153 2065.5,-7205"/>
<text text-anchor="middle" x="1931" y="-7193" font-family="Arial" font-size="10.00">Expert 62 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="1931" y="-7182" font-family="Arial" font-size="10.00">GPUs: 252,253</text>
<text text-anchor="middle" x="1931" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="1931" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert63_qkv -->
<g id="node770" class="node">
<title>stage1_expert63_qkv</title>
<polygon fill="lightgreen" stroke="black" points="1778,-7205 1492,-7205 1492,-7153 1778,-7153 1778,-7205"/>
<text text-anchor="middle" x="1635" y="-7193" font-family="Arial" font-size="10.00">Expert 63 QKV Proj (TP)</text>
<text text-anchor="middle" x="1635" y="-7182" font-family="Arial" font-size="10.00">GPUs: 254,255</text>
<text text-anchor="middle" x="1635" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="1635" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert63_attn -->
<g id="node771" class="node">
<title>stage1_expert63_attn</title>
<polygon fill="lightgreen" stroke="black" points="1474,-7205 1188,-7205 1188,-7153 1474,-7153 1474,-7205"/>
<text text-anchor="middle" x="1331" y="-7193" font-family="Arial" font-size="10.00">Expert 63 Attention (TP)</text>
<text text-anchor="middle" x="1331" y="-7182" font-family="Arial" font-size="10.00">GPUs: 254,255</text>
<text text-anchor="middle" x="1331" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="1331" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage1_expert63_attn_out -->
<g id="node772" class="node">
<title>stage1_expert63_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="1170,-7205 892,-7205 892,-7153 1170,-7153 1170,-7205"/>
<text text-anchor="middle" x="1031" y="-7193" font-family="Arial" font-size="10.00">Expert 63 Attn Output (TP)</text>
<text text-anchor="middle" x="1031" y="-7182" font-family="Arial" font-size="10.00">GPUs: 254,255</text>
<text text-anchor="middle" x="1031" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="1031" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_expert63_mlp1 -->
<g id="node773" class="node">
<title>stage1_expert63_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="874,-7205 598,-7205 598,-7153 874,-7153 874,-7205"/>
<text text-anchor="middle" x="736" y="-7193" font-family="Arial" font-size="10.00">Expert 63 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="736" y="-7182" font-family="Arial" font-size="10.00">GPUs: 254,255</text>
<text text-anchor="middle" x="736" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="736" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert63_mlp_act -->
<g id="node774" class="node">
<title>stage1_expert63_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="580,-7205 304,-7205 304,-7153 580,-7153 580,-7205"/>
<text text-anchor="middle" x="442" y="-7193" font-family="Arial" font-size="10.00">Expert 63 MLP GELU (TP)</text>
<text text-anchor="middle" x="442" y="-7182" font-family="Arial" font-size="10.00">GPUs: 254,255</text>
<text text-anchor="middle" x="442" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="442" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage1_expert63_mlp2 -->
<g id="node775" class="node">
<title>stage1_expert63_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="285.5,-7205 16.5,-7205 16.5,-7153 285.5,-7153 285.5,-7205"/>
<text text-anchor="middle" x="151" y="-7193" font-family="Arial" font-size="10.00">Expert 63 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="151" y="-7182" font-family="Arial" font-size="10.00">GPUs: 254,255</text>
<text text-anchor="middle" x="151" y="-7171" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="151" y="-7160" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage1_aggregate -->
<g id="node776" class="node">
<title>stage1_aggregate</title>
<polygon fill="lightyellow" stroke="black" points="112684.24,-6376 112263.89,-6376 112155.76,-6272 112576.11,-6272 112684.24,-6376"/>
<text text-anchor="middle" x="112420" y="-6338" font-family="Arial" font-size="10.00">Expert Output Aggregation</text>
<text text-anchor="middle" x="112420" y="-6327" font-family="Arial" font-size="10.00">GPUs: 128&#45;255</text>
<text text-anchor="middle" x="112420" y="-6316" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-6305" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- pipe_comm_1_2 -->
<g id="node959" class="node">
<title>pipe_comm_1_2</title>
<polygon fill="lightgrey" stroke="black" points="112495.9,-6236 112375.16,-6236 112344.1,-6200 112464.84,-6200 112495.9,-6236"/>
<text text-anchor="middle" x="112420" y="-6215.5" font-family="Arial" font-size="10.00">pipe_comm_1_2</text>
</g>
<!-- stage1_aggregate&#45;&gt;pipe_comm_1_2 -->
<g id="edge22" class="edge">
<title>stage1_aggregate&#45;&gt;pipe_comm_1_2</title>
<path fill="none" stroke="black" d="M112420,-6271.93C112420,-6271.93 112420,-6246.36 112420,-6246.36"/>
<polygon fill="black" stroke="black" points="112423.5,-6246.36 112420,-6236.36 112416.5,-6246.36 112423.5,-6246.36"/>
</g>
<!-- stage1_layernorm1&#45;&gt;stage1_expert0_mlp1 -->
<g id="edge17" class="edge">
<title>stage1_layernorm1&#45;&gt;stage1_expert0_mlp1</title>
<path fill="none" stroke="black" d="M112420,-6763.6C112420,-6763.6 112420,-6738.08 112420,-6738.08"/>
<polygon fill="black" stroke="black" points="112423.5,-6738.08 112420,-6728.08 112416.5,-6738.08 112423.5,-6738.08"/>
</g>
<!-- stage1_layernorm2&#45;&gt;stage1_aggregate -->
<g id="edge21" class="edge">
<title>stage1_layernorm2&#45;&gt;stage1_aggregate</title>
<path fill="none" stroke="black" d="M112420,-6411.85C112420,-6411.85 112420,-6386.1 112420,-6386.1"/>
<polygon fill="black" stroke="black" points="112423.5,-6386.1 112420,-6376.1 112416.5,-6386.1 112423.5,-6386.1"/>
</g>
<!-- stage2_routing -->
<g id="node779" class="node">
<title>stage2_routing</title>
<polygon fill="lightyellow" stroke="black" points="112684.24,-6146 112263.89,-6146 112155.76,-6020 112576.11,-6020 112684.24,-6146"/>
<text text-anchor="middle" x="112420" y="-6102.5" font-family="Arial" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="112420" y="-6091.5" font-family="Arial" font-size="10.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="112420" y="-6080.5" font-family="Arial" font-size="10.00">GPUs: 256&#45;383</text>
<text text-anchor="middle" x="112420" y="-6069.5" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-6058.5" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage2_expert0_qkv -->
<g id="node780" class="node">
<title>stage2_expert0_qkv</title>
<polygon fill="lightgreen" stroke="black" points="112563,-5984 112277,-5984 112277,-5932 112563,-5932 112563,-5984"/>
<text text-anchor="middle" x="112420" y="-5972" font-family="Arial" font-size="10.00">Expert 0 QKV Proj (TP)</text>
<text text-anchor="middle" x="112420" y="-5961" font-family="Arial" font-size="10.00">GPUs: 256,257</text>
<text text-anchor="middle" x="112420" y="-5950" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-5939" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage2_routing&#45;&gt;stage2_expert0_qkv -->
<g id="edge24" class="edge">
<title>stage2_routing&#45;&gt;stage2_expert0_qkv</title>
<path fill="none" stroke="black" d="M112420,-6019.77C112420,-6019.77 112420,-5994.15 112420,-5994.15"/>
<polygon fill="black" stroke="black" points="112423.5,-5994.15 112420,-5984.15 112416.5,-5994.15 112423.5,-5994.15"/>
</g>
<!-- stage2_expert0_attn -->
<g id="node781" class="node">
<title>stage2_expert0_attn</title>
<polygon fill="lightgreen" stroke="black" points="112563,-5896 112277,-5896 112277,-5844 112563,-5844 112563,-5896"/>
<text text-anchor="middle" x="112420" y="-5884" font-family="Arial" font-size="10.00">Expert 0 Attention (TP)</text>
<text text-anchor="middle" x="112420" y="-5873" font-family="Arial" font-size="10.00">GPUs: 256,257</text>
<text text-anchor="middle" x="112420" y="-5862" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="112420" y="-5851" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage2_expert0_qkv&#45;&gt;stage2_expert0_attn -->
<g id="edge25" class="edge">
<title>stage2_expert0_qkv&#45;&gt;stage2_expert0_attn</title>
<path fill="none" stroke="black" d="M112420,-5931.6C112420,-5931.6 112420,-5906.08 112420,-5906.08"/>
<polygon fill="black" stroke="black" points="112423.5,-5906.08 112420,-5896.08 112416.5,-5906.08 112423.5,-5906.08"/>
</g>
<!-- stage2_expert0_attn_out -->
<g id="node782" class="node">
<title>stage2_expert0_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="112559,-5808 112281,-5808 112281,-5756 112559,-5756 112559,-5808"/>
<text text-anchor="middle" x="112420" y="-5796" font-family="Arial" font-size="10.00">Expert 0 Attn Output (TP)</text>
<text text-anchor="middle" x="112420" y="-5785" font-family="Arial" font-size="10.00">GPUs: 256,257</text>
<text text-anchor="middle" x="112420" y="-5774" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="112420" y="-5763" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage2_expert0_attn&#45;&gt;stage2_expert0_attn_out -->
<g id="edge26" class="edge">
<title>stage2_expert0_attn&#45;&gt;stage2_expert0_attn_out</title>
<path fill="none" stroke="black" d="M112420,-5843.6C112420,-5843.6 112420,-5818.08 112420,-5818.08"/>
<polygon fill="black" stroke="black" points="112423.5,-5818.08 112420,-5808.08 112416.5,-5818.08 112423.5,-5818.08"/>
</g>
<!-- stage2_layernorm1 -->
<g id="node806" class="node">
<title>stage2_layernorm1</title>
<polygon fill="lightblue" stroke="black" points="112547.5,-5720 112292.5,-5720 112292.5,-5668 112547.5,-5668 112547.5,-5720"/>
<text text-anchor="middle" x="112420" y="-5708" font-family="Arial" font-size="10.00">LayerNorm 1</text>
<text text-anchor="middle" x="112420" y="-5697" font-family="Arial" font-size="10.00">GPUs: 256&#45;383</text>
<text text-anchor="middle" x="112420" y="-5686" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-5675" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage2_expert0_attn_out&#45;&gt;stage2_layernorm1 -->
<g id="edge27" class="edge">
<title>stage2_expert0_attn_out&#45;&gt;stage2_layernorm1</title>
<path fill="none" stroke="black" d="M112420,-5755.6C112420,-5755.6 112420,-5730.08 112420,-5730.08"/>
<polygon fill="black" stroke="black" points="112423.5,-5730.08 112420,-5720.08 112416.5,-5730.08 112423.5,-5730.08"/>
</g>
<!-- stage2_expert0_mlp1 -->
<g id="node783" class="node">
<title>stage2_expert0_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="112558,-5632 112282,-5632 112282,-5580 112558,-5580 112558,-5632"/>
<text text-anchor="middle" x="112420" y="-5620" font-family="Arial" font-size="10.00">Expert 0 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="112420" y="-5609" font-family="Arial" font-size="10.00">GPUs: 256,257</text>
<text text-anchor="middle" x="112420" y="-5598" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-5587" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage2_expert0_mlp_act -->
<g id="node784" class="node">
<title>stage2_expert0_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="112558,-5544 112282,-5544 112282,-5492 112558,-5492 112558,-5544"/>
<text text-anchor="middle" x="112420" y="-5532" font-family="Arial" font-size="10.00">Expert 0 MLP GELU (TP)</text>
<text text-anchor="middle" x="112420" y="-5521" font-family="Arial" font-size="10.00">GPUs: 256,257</text>
<text text-anchor="middle" x="112420" y="-5510" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="112420" y="-5499" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage2_expert0_mlp1&#45;&gt;stage2_expert0_mlp_act -->
<g id="edge29" class="edge">
<title>stage2_expert0_mlp1&#45;&gt;stage2_expert0_mlp_act</title>
<path fill="none" stroke="black" d="M112420,-5579.6C112420,-5579.6 112420,-5554.08 112420,-5554.08"/>
<polygon fill="black" stroke="black" points="112423.5,-5554.08 112420,-5544.08 112416.5,-5554.08 112423.5,-5554.08"/>
</g>
<!-- stage2_expert0_mlp2 -->
<g id="node785" class="node">
<title>stage2_expert0_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="112554.5,-5456 112285.5,-5456 112285.5,-5404 112554.5,-5404 112554.5,-5456"/>
<text text-anchor="middle" x="112420" y="-5444" font-family="Arial" font-size="10.00">Expert 0 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="112420" y="-5433" font-family="Arial" font-size="10.00">GPUs: 256,257</text>
<text text-anchor="middle" x="112420" y="-5422" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="112420" y="-5411" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage2_expert0_mlp_act&#45;&gt;stage2_expert0_mlp2 -->
<g id="edge30" class="edge">
<title>stage2_expert0_mlp_act&#45;&gt;stage2_expert0_mlp2</title>
<path fill="none" stroke="black" d="M112420,-5491.6C112420,-5491.6 112420,-5466.08 112420,-5466.08"/>
<polygon fill="black" stroke="black" points="112423.5,-5466.08 112420,-5456.08 112416.5,-5466.08 112423.5,-5466.08"/>
</g>
<!-- stage2_layernorm2 -->
<g id="node807" class="node">
<title>stage2_layernorm2</title>
<polygon fill="lightblue" stroke="black" points="112547.5,-5368 112292.5,-5368 112292.5,-5316 112547.5,-5316 112547.5,-5368"/>
<text text-anchor="middle" x="112420" y="-5356" font-family="Arial" font-size="10.00">LayerNorm 2</text>
<text text-anchor="middle" x="112420" y="-5345" font-family="Arial" font-size="10.00">GPUs: 256&#45;383</text>
<text text-anchor="middle" x="112420" y="-5334" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112420" y="-5323" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage2_expert0_mlp2&#45;&gt;stage2_layernorm2 -->
<g id="edge31" class="edge">
<title>stage2_expert0_mlp2&#45;&gt;stage2_layernorm2</title>
<path fill="none" stroke="black" d="M112420,-5403.6C112420,-5403.6 112420,-5378.08 112420,-5378.08"/>
<polygon fill="black" stroke="black" points="112423.5,-5378.08 112420,-5368.08 112416.5,-5378.08 112423.5,-5378.08"/>
</g>
<!-- stage2_expert1_qkv -->
<g id="node786" class="node">
<title>stage2_expert1_qkv</title>
<polygon fill="lightgreen" stroke="black" points="112138,-6109 111852,-6109 111852,-6057 112138,-6057 112138,-6109"/>
<text text-anchor="middle" x="111995" y="-6097" font-family="Arial" font-size="10.00">Expert 1 QKV Proj (TP)</text>
<text text-anchor="middle" x="111995" y="-6086" font-family="Arial" font-size="10.00">GPUs: 258,259</text>
<text text-anchor="middle" x="111995" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="111995" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage2_expert1_attn -->
<g id="node787" class="node">
<title>stage2_expert1_attn</title>
<polygon fill="lightgreen" stroke="black" points="111834,-6109 111548,-6109 111548,-6057 111834,-6057 111834,-6109"/>
<text text-anchor="middle" x="111691" y="-6097" font-family="Arial" font-size="10.00">Expert 1 Attention (TP)</text>
<text text-anchor="middle" x="111691" y="-6086" font-family="Arial" font-size="10.00">GPUs: 258,259</text>
<text text-anchor="middle" x="111691" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="111691" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage2_expert1_attn_out -->
<g id="node788" class="node">
<title>stage2_expert1_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="111530,-6109 111252,-6109 111252,-6057 111530,-6057 111530,-6109"/>
<text text-anchor="middle" x="111391" y="-6097" font-family="Arial" font-size="10.00">Expert 1 Attn Output (TP)</text>
<text text-anchor="middle" x="111391" y="-6086" font-family="Arial" font-size="10.00">GPUs: 258,259</text>
<text text-anchor="middle" x="111391" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="111391" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage2_expert1_mlp1 -->
<g id="node789" class="node">
<title>stage2_expert1_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="111234,-6109 110958,-6109 110958,-6057 111234,-6057 111234,-6109"/>
<text text-anchor="middle" x="111096" y="-6097" font-family="Arial" font-size="10.00">Expert 1 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="111096" y="-6086" font-family="Arial" font-size="10.00">GPUs: 258,259</text>
<text text-anchor="middle" x="111096" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="111096" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage2_expert1_mlp_act -->
<g id="node790" class="node">
<title>stage2_expert1_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="110940,-6109 110664,-6109 110664,-6057 110940,-6057 110940,-6109"/>
<text text-anchor="middle" x="110802" y="-6097" font-family="Arial" font-size="10.00">Expert 1 MLP GELU (TP)</text>
<text text-anchor="middle" x="110802" y="-6086" font-family="Arial" font-size="10.00">GPUs: 258,259</text>
<text text-anchor="middle" x="110802" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="110802" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage2_expert1_mlp2 -->
<g id="node791" class="node">
<title>stage2_expert1_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="110645.5,-6109 110376.5,-6109 110376.5,-6057 110645.5,-6057 110645.5,-6109"/>
<text text-anchor="middle" x="110511" y="-6097" font-family="Arial" font-size="10.00">Expert 1 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="110511" y="-6086" font-family="Arial" font-size="10.00">GPUs: 258,259</text>
<text text-anchor="middle" x="110511" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="110511" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage2_expert2_qkv -->
<g id="node792" class="node">
<title>stage2_expert2_qkv</title>
<polygon fill="lightgreen" stroke="black" points="110358,-6109 110072,-6109 110072,-6057 110358,-6057 110358,-6109"/>
<text text-anchor="middle" x="110215" y="-6097" font-family="Arial" font-size="10.00">Expert 2 QKV Proj (TP)</text>
<text text-anchor="middle" x="110215" y="-6086" font-family="Arial" font-size="10.00">GPUs: 260,261</text>
<text text-anchor="middle" x="110215" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="110215" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage2_expert2_attn -->
<g id="node793" class="node">
<title>stage2_expert2_attn</title>
<polygon fill="lightgreen" stroke="black" points="110054,-6109 109768,-6109 109768,-6057 110054,-6057 110054,-6109"/>
<text text-anchor="middle" x="109911" y="-6097" font-family="Arial" font-size="10.00">Expert 2 Attention (TP)</text>
<text text-anchor="middle" x="109911" y="-6086" font-family="Arial" font-size="10.00">GPUs: 260,261</text>
<text text-anchor="middle" x="109911" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="109911" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage2_expert2_attn_out -->
<g id="node794" class="node">
<title>stage2_expert2_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="109750,-6109 109472,-6109 109472,-6057 109750,-6057 109750,-6109"/>
<text text-anchor="middle" x="109611" y="-6097" font-family="Arial" font-size="10.00">Expert 2 Attn Output (TP)</text>
<text text-anchor="middle" x="109611" y="-6086" font-family="Arial" font-size="10.00">GPUs: 260,261</text>
<text text-anchor="middle" x="109611" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="109611" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage2_expert2_mlp1 -->
<g id="node795" class="node">
<title>stage2_expert2_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="109454,-6109 109178,-6109 109178,-6057 109454,-6057 109454,-6109"/>
<text text-anchor="middle" x="109316" y="-6097" font-family="Arial" font-size="10.00">Expert 2 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="109316" y="-6086" font-family="Arial" font-size="10.00">GPUs: 260,261</text>
<text text-anchor="middle" x="109316" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="109316" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage2_expert2_mlp_act -->
<g id="node796" class="node">
<title>stage2_expert2_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="109160,-6109 108884,-6109 108884,-6057 109160,-6057 109160,-6109"/>
<text text-anchor="middle" x="109022" y="-6097" font-family="Arial" font-size="10.00">Expert 2 MLP GELU (TP)</text>
<text text-anchor="middle" x="109022" y="-6086" font-family="Arial" font-size="10.00">GPUs: 260,261</text>
<text text-anchor="middle" x="109022" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="109022" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage2_expert2_mlp2 -->
<g id="node797" class="node">
<title>stage2_expert2_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="108865.5,-6109 108596.5,-6109 108596.5,-6057 108865.5,-6057 108865.5,-6109"/>
<text text-anchor="middle" x="108731" y="-6097" font-family="Arial" font-size="10.00">Expert 2 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="108731" y="-6086" font-family="Arial" font-size="10.00">GPUs: 260,261</text>
<text text-anchor="middle" x="108731" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="108731" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage2_expert3_qkv -->
<g id="node798" class="node">
<title>stage2_expert3_qkv</title>
<polygon fill="lightgreen" stroke="black" points="108578,-6109 108292,-6109 108292,-6057 108578,-6057 108578,-6109"/>
<text text-anchor="middle" x="108435" y="-6097" font-family="Arial" font-size="10.00">Expert 3 QKV Proj (TP)</text>
<text text-anchor="middle" x="108435" y="-6086" font-family="Arial" font-size="10.00">GPUs: 262,263</text>
<text text-anchor="middle" x="108435" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="108435" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage2_expert3_attn -->
<g id="node799" class="node">
<title>stage2_expert3_attn</title>
<polygon fill="lightgreen" stroke="black" points="108274,-6109 107988,-6109 107988,-6057 108274,-6057 108274,-6109"/>
<text text-anchor="middle" x="108131" y="-6097" font-family="Arial" font-size="10.00">Expert 3 Attention (TP)</text>
<text text-anchor="middle" x="108131" y="-6086" font-family="Arial" font-size="10.00">GPUs: 262,263</text>
<text text-anchor="middle" x="108131" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="108131" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage2_expert3_attn_out -->
<g id="node800" class="node">
<title>stage2_expert3_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="107970,-6109 107692,-6109 107692,-6057 107970,-6057 107970,-6109"/>
<text text-anchor="middle" x="107831" y="-6097" font-family="Arial" font-size="10.00">Expert 3 Attn Output (TP)</text>
<text text-anchor="middle" x="107831" y="-6086" font-family="Arial" font-size="10.00">GPUs: 262,263</text>
<text text-anchor="middle" x="107831" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="107831" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage2_expert3_mlp1 -->
<g id="node801" class="node">
<title>stage2_expert3_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="107674,-6109 107398,-6109 107398,-6057 107674,-6057 107674,-6109"/>
<text text-anchor="middle" x="107536" y="-6097" font-family="Arial" font-size="10.00">Expert 3 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="107536" y="-6086" font-family="Arial" font-size="10.00">GPUs: 262,263</text>
<text text-anchor="middle" x="107536" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="107536" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage2_expert3_mlp_act -->
<g id="node802" class="node">
<title>stage2_expert3_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="107380,-6109 107104,-6109 107104,-6057 107380,-6057 107380,-6109"/>
<text text-anchor="middle" x="107242" y="-6097" font-family="Arial" font-size="10.00">Expert 3 MLP GELU (TP)</text>
<text text-anchor="middle" x="107242" y="-6086" font-family="Arial" font-size="10.00">GPUs: 262,263</text>
<text text-anchor="middle" x="107242" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="107242" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage2_expert3_mlp2 -->
<g id="node803" class="node">
<title>stage2_expert3_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="107085.5,-6109 106816.5,-6109 106816.5,-6057 107085.5,-6057 107085.5,-6109"/>
<text text-anchor="middle" x="106951" y="-6097" font-family="Arial" font-size="10.00">Expert 3 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="106951" y="-6086" font-family="Arial" font-size="10.00">GPUs: 262,263</text>
<text text-anchor="middle" x="106951" y="-6075" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="106951" y="-6064" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage2_experts_ellipsis -->
<g id="node804" class="node">
<title>stage2_experts_ellipsis</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="106798,-6101 106622,-6101 106622,-6065 106798,-6065 106798,-6101"/>
<text text-anchor="middle" x="106710" y="-6086" font-family="Arial" font-size="10.00">... (Experts 4&#45;63)</text>
<text text-anchor="middle" x="106710" y="-6075" font-family="Arial" font-size="10.00">Similar operations on GPUs 264&#45;383</text>
</g>
<!-- stage2_aggregate -->
<g id="node805" class="node">
<title>stage2_aggregate</title>
<polygon fill="lightyellow" stroke="black" points="112682.24,-5280 112261.89,-5280 112153.76,-5176 112574.11,-5176 112682.24,-5280"/>
<text text-anchor="middle" x="112418" y="-5242" font-family="Arial" font-size="10.00">Expert Output Aggregation</text>
<text text-anchor="middle" x="112418" y="-5231" font-family="Arial" font-size="10.00">GPUs: 256&#45;383</text>
<text text-anchor="middle" x="112418" y="-5220" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112418" y="-5209" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage2_layernorm1&#45;&gt;stage2_expert0_mlp1 -->
<g id="edge28" class="edge">
<title>stage2_layernorm1&#45;&gt;stage2_expert0_mlp1</title>
<path fill="none" stroke="black" d="M112420,-5667.6C112420,-5667.6 112420,-5642.08 112420,-5642.08"/>
<polygon fill="black" stroke="black" points="112423.5,-5642.08 112420,-5632.08 112416.5,-5642.08 112423.5,-5642.08"/>
</g>
<!-- stage2_layernorm2&#45;&gt;stage2_aggregate -->
<g id="edge32" class="edge">
<title>stage2_layernorm2&#45;&gt;stage2_aggregate</title>
<path fill="none" stroke="black" d="M112420,-5315.85C112420,-5315.85 112420,-5290.1 112420,-5290.1"/>
<polygon fill="black" stroke="black" points="112423.5,-5290.1 112420,-5280.1 112416.5,-5290.1 112423.5,-5290.1"/>
</g>
<!-- pipe_comm_2_3 -->
<g id="node808" class="node">
<title>pipe_comm_2_3</title>
<ellipse fill="orange" stroke="black" cx="112881" cy="-5228" rx="180.12" ry="44.6"/>
<text text-anchor="middle" x="112881" y="-5247.5" font-family="Arial" font-size="10.00">Pipeline Communication</text>
<text text-anchor="middle" x="112881" y="-5236.5" font-family="Arial" font-size="10.00">Stage 2  Stage 3</text>
<text text-anchor="middle" x="112881" y="-5225.5" font-family="Arial" font-size="10.00">GPUs: 256&#45;383  384&#45;511</text>
<text text-anchor="middle" x="112881" y="-5214.5" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112881" y="-5203.5" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage2_layernorm2&#45;&gt;pipe_comm_2_3 -->
<g id="edge33" class="edge">
<title>stage2_layernorm2&#45;&gt;pipe_comm_2_3</title>
<path fill="none" stroke="black" d="M112547.8,-5342C112684.23,-5342 112881,-5342 112881,-5342 112881,-5342 112881,-5282.73 112881,-5282.73"/>
<polygon fill="black" stroke="black" points="112884.5,-5282.73 112881,-5272.73 112877.5,-5282.73 112884.5,-5282.73"/>
</g>
<!-- stage3_routing -->
<g id="node809" class="node">
<title>stage3_routing</title>
<polygon fill="lightyellow" stroke="black" points="113145.24,-5114 112724.89,-5114 112616.76,-4988 113037.11,-4988 113145.24,-5114"/>
<text text-anchor="middle" x="112881" y="-5070.5" font-family="Arial" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="112881" y="-5059.5" font-family="Arial" font-size="10.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="112881" y="-5048.5" font-family="Arial" font-size="10.00">GPUs: 384&#45;511</text>
<text text-anchor="middle" x="112881" y="-5037.5" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112881" y="-5026.5" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- pipe_comm_2_3&#45;&gt;stage3_routing -->
<g id="edge34" class="edge">
<title>pipe_comm_2_3&#45;&gt;stage3_routing</title>
<path fill="none" stroke="black" d="M112881,-5183.34C112881,-5183.34 112881,-5124.03 112881,-5124.03"/>
<polygon fill="black" stroke="black" points="112884.5,-5124.03 112881,-5114.03 112877.5,-5124.03 112884.5,-5124.03"/>
</g>
<!-- stage3_expert0_qkv -->
<g id="node810" class="node">
<title>stage3_expert0_qkv</title>
<polygon fill="lightgreen" stroke="black" points="113024,-4952 112738,-4952 112738,-4900 113024,-4900 113024,-4952"/>
<text text-anchor="middle" x="112881" y="-4940" font-family="Arial" font-size="10.00">Expert 0 QKV Proj (TP)</text>
<text text-anchor="middle" x="112881" y="-4929" font-family="Arial" font-size="10.00">GPUs: 384,385</text>
<text text-anchor="middle" x="112881" y="-4918" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112881" y="-4907" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage3_routing&#45;&gt;stage3_expert0_qkv -->
<g id="edge35" class="edge">
<title>stage3_routing&#45;&gt;stage3_expert0_qkv</title>
<path fill="none" stroke="black" d="M112881,-4987.77C112881,-4987.77 112881,-4962.15 112881,-4962.15"/>
<polygon fill="black" stroke="black" points="112884.5,-4962.15 112881,-4952.15 112877.5,-4962.15 112884.5,-4962.15"/>
</g>
<!-- stage3_expert0_attn -->
<g id="node811" class="node">
<title>stage3_expert0_attn</title>
<polygon fill="lightgreen" stroke="black" points="113024,-4864 112738,-4864 112738,-4812 113024,-4812 113024,-4864"/>
<text text-anchor="middle" x="112881" y="-4852" font-family="Arial" font-size="10.00">Expert 0 Attention (TP)</text>
<text text-anchor="middle" x="112881" y="-4841" font-family="Arial" font-size="10.00">GPUs: 384,385</text>
<text text-anchor="middle" x="112881" y="-4830" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="112881" y="-4819" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage3_expert0_qkv&#45;&gt;stage3_expert0_attn -->
<g id="edge36" class="edge">
<title>stage3_expert0_qkv&#45;&gt;stage3_expert0_attn</title>
<path fill="none" stroke="black" d="M112881,-4899.6C112881,-4899.6 112881,-4874.08 112881,-4874.08"/>
<polygon fill="black" stroke="black" points="112884.5,-4874.08 112881,-4864.08 112877.5,-4874.08 112884.5,-4874.08"/>
</g>
<!-- stage3_expert0_attn_out -->
<g id="node812" class="node">
<title>stage3_expert0_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="113020,-4776 112742,-4776 112742,-4724 113020,-4724 113020,-4776"/>
<text text-anchor="middle" x="112881" y="-4764" font-family="Arial" font-size="10.00">Expert 0 Attn Output (TP)</text>
<text text-anchor="middle" x="112881" y="-4753" font-family="Arial" font-size="10.00">GPUs: 384,385</text>
<text text-anchor="middle" x="112881" y="-4742" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="112881" y="-4731" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage3_expert0_attn&#45;&gt;stage3_expert0_attn_out -->
<g id="edge37" class="edge">
<title>stage3_expert0_attn&#45;&gt;stage3_expert0_attn_out</title>
<path fill="none" stroke="black" d="M112881,-4811.6C112881,-4811.6 112881,-4786.08 112881,-4786.08"/>
<polygon fill="black" stroke="black" points="112884.5,-4786.08 112881,-4776.08 112877.5,-4786.08 112884.5,-4786.08"/>
</g>
<!-- stage3_layernorm1 -->
<g id="node836" class="node">
<title>stage3_layernorm1</title>
<polygon fill="lightblue" stroke="black" points="113008.5,-4688 112753.5,-4688 112753.5,-4636 113008.5,-4636 113008.5,-4688"/>
<text text-anchor="middle" x="112881" y="-4676" font-family="Arial" font-size="10.00">LayerNorm 1</text>
<text text-anchor="middle" x="112881" y="-4665" font-family="Arial" font-size="10.00">GPUs: 384&#45;511</text>
<text text-anchor="middle" x="112881" y="-4654" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112881" y="-4643" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage3_expert0_attn_out&#45;&gt;stage3_layernorm1 -->
<g id="edge38" class="edge">
<title>stage3_expert0_attn_out&#45;&gt;stage3_layernorm1</title>
<path fill="none" stroke="black" d="M112881,-4723.6C112881,-4723.6 112881,-4698.08 112881,-4698.08"/>
<polygon fill="black" stroke="black" points="112884.5,-4698.08 112881,-4688.08 112877.5,-4698.08 112884.5,-4698.08"/>
</g>
<!-- stage3_expert0_mlp1 -->
<g id="node813" class="node">
<title>stage3_expert0_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="113019,-4600 112743,-4600 112743,-4548 113019,-4548 113019,-4600"/>
<text text-anchor="middle" x="112881" y="-4588" font-family="Arial" font-size="10.00">Expert 0 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="112881" y="-4577" font-family="Arial" font-size="10.00">GPUs: 384,385</text>
<text text-anchor="middle" x="112881" y="-4566" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112881" y="-4555" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage3_expert0_mlp_act -->
<g id="node814" class="node">
<title>stage3_expert0_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="113019,-4512 112743,-4512 112743,-4460 113019,-4460 113019,-4512"/>
<text text-anchor="middle" x="112881" y="-4500" font-family="Arial" font-size="10.00">Expert 0 MLP GELU (TP)</text>
<text text-anchor="middle" x="112881" y="-4489" font-family="Arial" font-size="10.00">GPUs: 384,385</text>
<text text-anchor="middle" x="112881" y="-4478" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="112881" y="-4467" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage3_expert0_mlp1&#45;&gt;stage3_expert0_mlp_act -->
<g id="edge40" class="edge">
<title>stage3_expert0_mlp1&#45;&gt;stage3_expert0_mlp_act</title>
<path fill="none" stroke="black" d="M112881,-4547.6C112881,-4547.6 112881,-4522.08 112881,-4522.08"/>
<polygon fill="black" stroke="black" points="112884.5,-4522.08 112881,-4512.08 112877.5,-4522.08 112884.5,-4522.08"/>
</g>
<!-- stage3_expert0_mlp2 -->
<g id="node815" class="node">
<title>stage3_expert0_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="113015.5,-4424 112746.5,-4424 112746.5,-4372 113015.5,-4372 113015.5,-4424"/>
<text text-anchor="middle" x="112881" y="-4412" font-family="Arial" font-size="10.00">Expert 0 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="112881" y="-4401" font-family="Arial" font-size="10.00">GPUs: 384,385</text>
<text text-anchor="middle" x="112881" y="-4390" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="112881" y="-4379" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage3_expert0_mlp_act&#45;&gt;stage3_expert0_mlp2 -->
<g id="edge41" class="edge">
<title>stage3_expert0_mlp_act&#45;&gt;stage3_expert0_mlp2</title>
<path fill="none" stroke="black" d="M112881,-4459.6C112881,-4459.6 112881,-4434.08 112881,-4434.08"/>
<polygon fill="black" stroke="black" points="112884.5,-4434.08 112881,-4424.08 112877.5,-4434.08 112884.5,-4434.08"/>
</g>
<!-- stage3_layernorm2 -->
<g id="node837" class="node">
<title>stage3_layernorm2</title>
<polygon fill="lightblue" stroke="black" points="113008.5,-4336 112753.5,-4336 112753.5,-4284 113008.5,-4284 113008.5,-4336"/>
<text text-anchor="middle" x="112881" y="-4324" font-family="Arial" font-size="10.00">LayerNorm 2</text>
<text text-anchor="middle" x="112881" y="-4313" font-family="Arial" font-size="10.00">GPUs: 384&#45;511</text>
<text text-anchor="middle" x="112881" y="-4302" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112881" y="-4291" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage3_expert0_mlp2&#45;&gt;stage3_layernorm2 -->
<g id="edge42" class="edge">
<title>stage3_expert0_mlp2&#45;&gt;stage3_layernorm2</title>
<path fill="none" stroke="black" d="M112881,-4371.6C112881,-4371.6 112881,-4346.08 112881,-4346.08"/>
<polygon fill="black" stroke="black" points="112884.5,-4346.08 112881,-4336.08 112877.5,-4346.08 112884.5,-4346.08"/>
</g>
<!-- stage3_expert1_qkv -->
<g id="node816" class="node">
<title>stage3_expert1_qkv</title>
<polygon fill="lightgreen" stroke="black" points="112599,-5077 112313,-5077 112313,-5025 112599,-5025 112599,-5077"/>
<text text-anchor="middle" x="112456" y="-5065" font-family="Arial" font-size="10.00">Expert 1 QKV Proj (TP)</text>
<text text-anchor="middle" x="112456" y="-5054" font-family="Arial" font-size="10.00">GPUs: 386,387</text>
<text text-anchor="middle" x="112456" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112456" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage3_expert1_attn -->
<g id="node817" class="node">
<title>stage3_expert1_attn</title>
<polygon fill="lightgreen" stroke="black" points="112295,-5077 112009,-5077 112009,-5025 112295,-5025 112295,-5077"/>
<text text-anchor="middle" x="112152" y="-5065" font-family="Arial" font-size="10.00">Expert 1 Attention (TP)</text>
<text text-anchor="middle" x="112152" y="-5054" font-family="Arial" font-size="10.00">GPUs: 386,387</text>
<text text-anchor="middle" x="112152" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="112152" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage3_expert1_attn_out -->
<g id="node818" class="node">
<title>stage3_expert1_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="111991,-5077 111713,-5077 111713,-5025 111991,-5025 111991,-5077"/>
<text text-anchor="middle" x="111852" y="-5065" font-family="Arial" font-size="10.00">Expert 1 Attn Output (TP)</text>
<text text-anchor="middle" x="111852" y="-5054" font-family="Arial" font-size="10.00">GPUs: 386,387</text>
<text text-anchor="middle" x="111852" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="111852" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage3_expert1_mlp1 -->
<g id="node819" class="node">
<title>stage3_expert1_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="111695,-5077 111419,-5077 111419,-5025 111695,-5025 111695,-5077"/>
<text text-anchor="middle" x="111557" y="-5065" font-family="Arial" font-size="10.00">Expert 1 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="111557" y="-5054" font-family="Arial" font-size="10.00">GPUs: 386,387</text>
<text text-anchor="middle" x="111557" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="111557" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage3_expert1_mlp_act -->
<g id="node820" class="node">
<title>stage3_expert1_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="111401,-5077 111125,-5077 111125,-5025 111401,-5025 111401,-5077"/>
<text text-anchor="middle" x="111263" y="-5065" font-family="Arial" font-size="10.00">Expert 1 MLP GELU (TP)</text>
<text text-anchor="middle" x="111263" y="-5054" font-family="Arial" font-size="10.00">GPUs: 386,387</text>
<text text-anchor="middle" x="111263" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="111263" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage3_expert1_mlp2 -->
<g id="node821" class="node">
<title>stage3_expert1_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="111106.5,-5077 110837.5,-5077 110837.5,-5025 111106.5,-5025 111106.5,-5077"/>
<text text-anchor="middle" x="110972" y="-5065" font-family="Arial" font-size="10.00">Expert 1 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="110972" y="-5054" font-family="Arial" font-size="10.00">GPUs: 386,387</text>
<text text-anchor="middle" x="110972" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="110972" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage3_expert2_qkv -->
<g id="node822" class="node">
<title>stage3_expert2_qkv</title>
<polygon fill="lightgreen" stroke="black" points="110819,-5077 110533,-5077 110533,-5025 110819,-5025 110819,-5077"/>
<text text-anchor="middle" x="110676" y="-5065" font-family="Arial" font-size="10.00">Expert 2 QKV Proj (TP)</text>
<text text-anchor="middle" x="110676" y="-5054" font-family="Arial" font-size="10.00">GPUs: 388,389</text>
<text text-anchor="middle" x="110676" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="110676" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage3_expert2_attn -->
<g id="node823" class="node">
<title>stage3_expert2_attn</title>
<polygon fill="lightgreen" stroke="black" points="110515,-5077 110229,-5077 110229,-5025 110515,-5025 110515,-5077"/>
<text text-anchor="middle" x="110372" y="-5065" font-family="Arial" font-size="10.00">Expert 2 Attention (TP)</text>
<text text-anchor="middle" x="110372" y="-5054" font-family="Arial" font-size="10.00">GPUs: 388,389</text>
<text text-anchor="middle" x="110372" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="110372" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage3_expert2_attn_out -->
<g id="node824" class="node">
<title>stage3_expert2_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="110211,-5077 109933,-5077 109933,-5025 110211,-5025 110211,-5077"/>
<text text-anchor="middle" x="110072" y="-5065" font-family="Arial" font-size="10.00">Expert 2 Attn Output (TP)</text>
<text text-anchor="middle" x="110072" y="-5054" font-family="Arial" font-size="10.00">GPUs: 388,389</text>
<text text-anchor="middle" x="110072" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="110072" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage3_expert2_mlp1 -->
<g id="node825" class="node">
<title>stage3_expert2_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="109915,-5077 109639,-5077 109639,-5025 109915,-5025 109915,-5077"/>
<text text-anchor="middle" x="109777" y="-5065" font-family="Arial" font-size="10.00">Expert 2 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="109777" y="-5054" font-family="Arial" font-size="10.00">GPUs: 388,389</text>
<text text-anchor="middle" x="109777" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="109777" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage3_expert2_mlp_act -->
<g id="node826" class="node">
<title>stage3_expert2_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="109621,-5077 109345,-5077 109345,-5025 109621,-5025 109621,-5077"/>
<text text-anchor="middle" x="109483" y="-5065" font-family="Arial" font-size="10.00">Expert 2 MLP GELU (TP)</text>
<text text-anchor="middle" x="109483" y="-5054" font-family="Arial" font-size="10.00">GPUs: 388,389</text>
<text text-anchor="middle" x="109483" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="109483" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage3_expert2_mlp2 -->
<g id="node827" class="node">
<title>stage3_expert2_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="109326.5,-5077 109057.5,-5077 109057.5,-5025 109326.5,-5025 109326.5,-5077"/>
<text text-anchor="middle" x="109192" y="-5065" font-family="Arial" font-size="10.00">Expert 2 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="109192" y="-5054" font-family="Arial" font-size="10.00">GPUs: 388,389</text>
<text text-anchor="middle" x="109192" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="109192" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage3_expert3_qkv -->
<g id="node828" class="node">
<title>stage3_expert3_qkv</title>
<polygon fill="lightgreen" stroke="black" points="109039,-5077 108753,-5077 108753,-5025 109039,-5025 109039,-5077"/>
<text text-anchor="middle" x="108896" y="-5065" font-family="Arial" font-size="10.00">Expert 3 QKV Proj (TP)</text>
<text text-anchor="middle" x="108896" y="-5054" font-family="Arial" font-size="10.00">GPUs: 390,391</text>
<text text-anchor="middle" x="108896" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="108896" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage3_expert3_attn -->
<g id="node829" class="node">
<title>stage3_expert3_attn</title>
<polygon fill="lightgreen" stroke="black" points="108735,-5077 108449,-5077 108449,-5025 108735,-5025 108735,-5077"/>
<text text-anchor="middle" x="108592" y="-5065" font-family="Arial" font-size="10.00">Expert 3 Attention (TP)</text>
<text text-anchor="middle" x="108592" y="-5054" font-family="Arial" font-size="10.00">GPUs: 390,391</text>
<text text-anchor="middle" x="108592" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="108592" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage3_expert3_attn_out -->
<g id="node830" class="node">
<title>stage3_expert3_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="108431,-5077 108153,-5077 108153,-5025 108431,-5025 108431,-5077"/>
<text text-anchor="middle" x="108292" y="-5065" font-family="Arial" font-size="10.00">Expert 3 Attn Output (TP)</text>
<text text-anchor="middle" x="108292" y="-5054" font-family="Arial" font-size="10.00">GPUs: 390,391</text>
<text text-anchor="middle" x="108292" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="108292" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage3_expert3_mlp1 -->
<g id="node831" class="node">
<title>stage3_expert3_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="108135,-5077 107859,-5077 107859,-5025 108135,-5025 108135,-5077"/>
<text text-anchor="middle" x="107997" y="-5065" font-family="Arial" font-size="10.00">Expert 3 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="107997" y="-5054" font-family="Arial" font-size="10.00">GPUs: 390,391</text>
<text text-anchor="middle" x="107997" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="107997" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage3_expert3_mlp_act -->
<g id="node832" class="node">
<title>stage3_expert3_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="107841,-5077 107565,-5077 107565,-5025 107841,-5025 107841,-5077"/>
<text text-anchor="middle" x="107703" y="-5065" font-family="Arial" font-size="10.00">Expert 3 MLP GELU (TP)</text>
<text text-anchor="middle" x="107703" y="-5054" font-family="Arial" font-size="10.00">GPUs: 390,391</text>
<text text-anchor="middle" x="107703" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="107703" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage3_expert3_mlp2 -->
<g id="node833" class="node">
<title>stage3_expert3_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="107546.5,-5077 107277.5,-5077 107277.5,-5025 107546.5,-5025 107546.5,-5077"/>
<text text-anchor="middle" x="107412" y="-5065" font-family="Arial" font-size="10.00">Expert 3 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="107412" y="-5054" font-family="Arial" font-size="10.00">GPUs: 390,391</text>
<text text-anchor="middle" x="107412" y="-5043" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="107412" y="-5032" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage3_experts_ellipsis -->
<g id="node834" class="node">
<title>stage3_experts_ellipsis</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="107259,-5069 107083,-5069 107083,-5033 107259,-5033 107259,-5069"/>
<text text-anchor="middle" x="107171" y="-5054" font-family="Arial" font-size="10.00">... (Experts 4&#45;63)</text>
<text text-anchor="middle" x="107171" y="-5043" font-family="Arial" font-size="10.00">Similar operations on GPUs 392&#45;511</text>
</g>
<!-- stage3_aggregate -->
<g id="node835" class="node">
<title>stage3_aggregate</title>
<polygon fill="lightyellow" stroke="black" points="113143.24,-4248 112722.89,-4248 112614.76,-4144 113035.11,-4144 113143.24,-4248"/>
<text text-anchor="middle" x="112879" y="-4210" font-family="Arial" font-size="10.00">Expert Output Aggregation</text>
<text text-anchor="middle" x="112879" y="-4199" font-family="Arial" font-size="10.00">GPUs: 384&#45;511</text>
<text text-anchor="middle" x="112879" y="-4188" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112879" y="-4177" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage3_layernorm1&#45;&gt;stage3_expert0_mlp1 -->
<g id="edge39" class="edge">
<title>stage3_layernorm1&#45;&gt;stage3_expert0_mlp1</title>
<path fill="none" stroke="black" d="M112881,-4635.6C112881,-4635.6 112881,-4610.08 112881,-4610.08"/>
<polygon fill="black" stroke="black" points="112884.5,-4610.08 112881,-4600.08 112877.5,-4610.08 112884.5,-4610.08"/>
</g>
<!-- stage3_layernorm2&#45;&gt;stage3_aggregate -->
<g id="edge43" class="edge">
<title>stage3_layernorm2&#45;&gt;stage3_aggregate</title>
<path fill="none" stroke="black" d="M112881,-4283.85C112881,-4283.85 112881,-4258.1 112881,-4258.1"/>
<polygon fill="black" stroke="black" points="112884.5,-4258.1 112881,-4248.1 112877.5,-4258.1 112884.5,-4258.1"/>
</g>
<!-- pipe_comm_3_4 -->
<g id="node838" class="node">
<title>pipe_comm_3_4</title>
<ellipse fill="orange" stroke="black" cx="113342" cy="-4196" rx="180.12" ry="44.6"/>
<text text-anchor="middle" x="113342" y="-4215.5" font-family="Arial" font-size="10.00">Pipeline Communication</text>
<text text-anchor="middle" x="113342" y="-4204.5" font-family="Arial" font-size="10.00">Stage 3  Stage 4</text>
<text text-anchor="middle" x="113342" y="-4193.5" font-family="Arial" font-size="10.00">GPUs: 384&#45;511  512&#45;639</text>
<text text-anchor="middle" x="113342" y="-4182.5" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="113342" y="-4171.5" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage3_layernorm2&#45;&gt;pipe_comm_3_4 -->
<g id="edge44" class="edge">
<title>stage3_layernorm2&#45;&gt;pipe_comm_3_4</title>
<path fill="none" stroke="black" d="M113008.8,-4310C113145.23,-4310 113342,-4310 113342,-4310 113342,-4310 113342,-4250.73 113342,-4250.73"/>
<polygon fill="black" stroke="black" points="113345.5,-4250.73 113342,-4240.73 113338.5,-4250.73 113345.5,-4250.73"/>
</g>
<!-- stage4_routing -->
<g id="node839" class="node">
<title>stage4_routing</title>
<polygon fill="lightyellow" stroke="black" points="113606.24,-4082 113185.89,-4082 113077.76,-3956 113498.11,-3956 113606.24,-4082"/>
<text text-anchor="middle" x="113342" y="-4038.5" font-family="Arial" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="113342" y="-4027.5" font-family="Arial" font-size="10.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="113342" y="-4016.5" font-family="Arial" font-size="10.00">GPUs: 512&#45;639</text>
<text text-anchor="middle" x="113342" y="-4005.5" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="113342" y="-3994.5" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- pipe_comm_3_4&#45;&gt;stage4_routing -->
<g id="edge45" class="edge">
<title>pipe_comm_3_4&#45;&gt;stage4_routing</title>
<path fill="none" stroke="black" d="M113342,-4151.34C113342,-4151.34 113342,-4092.03 113342,-4092.03"/>
<polygon fill="black" stroke="black" points="113345.5,-4092.03 113342,-4082.03 113338.5,-4092.03 113345.5,-4092.03"/>
</g>
<!-- stage4_expert0_qkv -->
<g id="node840" class="node">
<title>stage4_expert0_qkv</title>
<polygon fill="lightgreen" stroke="black" points="113485,-3920 113199,-3920 113199,-3868 113485,-3868 113485,-3920"/>
<text text-anchor="middle" x="113342" y="-3908" font-family="Arial" font-size="10.00">Expert 0 QKV Proj (TP)</text>
<text text-anchor="middle" x="113342" y="-3897" font-family="Arial" font-size="10.00">GPUs: 512,513</text>
<text text-anchor="middle" x="113342" y="-3886" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="113342" y="-3875" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage4_routing&#45;&gt;stage4_expert0_qkv -->
<g id="edge46" class="edge">
<title>stage4_routing&#45;&gt;stage4_expert0_qkv</title>
<path fill="none" stroke="black" d="M113342,-3955.77C113342,-3955.77 113342,-3930.15 113342,-3930.15"/>
<polygon fill="black" stroke="black" points="113345.5,-3930.15 113342,-3920.15 113338.5,-3930.15 113345.5,-3930.15"/>
</g>
<!-- stage4_expert0_attn -->
<g id="node841" class="node">
<title>stage4_expert0_attn</title>
<polygon fill="lightgreen" stroke="black" points="113485,-3832 113199,-3832 113199,-3780 113485,-3780 113485,-3832"/>
<text text-anchor="middle" x="113342" y="-3820" font-family="Arial" font-size="10.00">Expert 0 Attention (TP)</text>
<text text-anchor="middle" x="113342" y="-3809" font-family="Arial" font-size="10.00">GPUs: 512,513</text>
<text text-anchor="middle" x="113342" y="-3798" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="113342" y="-3787" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage4_expert0_qkv&#45;&gt;stage4_expert0_attn -->
<g id="edge47" class="edge">
<title>stage4_expert0_qkv&#45;&gt;stage4_expert0_attn</title>
<path fill="none" stroke="black" d="M113342,-3867.6C113342,-3867.6 113342,-3842.08 113342,-3842.08"/>
<polygon fill="black" stroke="black" points="113345.5,-3842.08 113342,-3832.08 113338.5,-3842.08 113345.5,-3842.08"/>
</g>
<!-- stage4_expert0_attn_out -->
<g id="node842" class="node">
<title>stage4_expert0_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="113481,-3744 113203,-3744 113203,-3692 113481,-3692 113481,-3744"/>
<text text-anchor="middle" x="113342" y="-3732" font-family="Arial" font-size="10.00">Expert 0 Attn Output (TP)</text>
<text text-anchor="middle" x="113342" y="-3721" font-family="Arial" font-size="10.00">GPUs: 512,513</text>
<text text-anchor="middle" x="113342" y="-3710" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="113342" y="-3699" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage4_expert0_attn&#45;&gt;stage4_expert0_attn_out -->
<g id="edge48" class="edge">
<title>stage4_expert0_attn&#45;&gt;stage4_expert0_attn_out</title>
<path fill="none" stroke="black" d="M113342,-3779.6C113342,-3779.6 113342,-3754.08 113342,-3754.08"/>
<polygon fill="black" stroke="black" points="113345.5,-3754.08 113342,-3744.08 113338.5,-3754.08 113345.5,-3754.08"/>
</g>
<!-- stage4_layernorm1 -->
<g id="node866" class="node">
<title>stage4_layernorm1</title>
<polygon fill="lightblue" stroke="black" points="113469.5,-3656 113214.5,-3656 113214.5,-3604 113469.5,-3604 113469.5,-3656"/>
<text text-anchor="middle" x="113342" y="-3644" font-family="Arial" font-size="10.00">LayerNorm 1</text>
<text text-anchor="middle" x="113342" y="-3633" font-family="Arial" font-size="10.00">GPUs: 512&#45;639</text>
<text text-anchor="middle" x="113342" y="-3622" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="113342" y="-3611" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage4_expert0_attn_out&#45;&gt;stage4_layernorm1 -->
<g id="edge49" class="edge">
<title>stage4_expert0_attn_out&#45;&gt;stage4_layernorm1</title>
<path fill="none" stroke="black" d="M113342,-3691.6C113342,-3691.6 113342,-3666.08 113342,-3666.08"/>
<polygon fill="black" stroke="black" points="113345.5,-3666.08 113342,-3656.08 113338.5,-3666.08 113345.5,-3666.08"/>
</g>
<!-- stage4_expert0_mlp1 -->
<g id="node843" class="node">
<title>stage4_expert0_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="113480,-3568 113204,-3568 113204,-3516 113480,-3516 113480,-3568"/>
<text text-anchor="middle" x="113342" y="-3556" font-family="Arial" font-size="10.00">Expert 0 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="113342" y="-3545" font-family="Arial" font-size="10.00">GPUs: 512,513</text>
<text text-anchor="middle" x="113342" y="-3534" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="113342" y="-3523" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage4_expert0_mlp_act -->
<g id="node844" class="node">
<title>stage4_expert0_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="113480,-3480 113204,-3480 113204,-3428 113480,-3428 113480,-3480"/>
<text text-anchor="middle" x="113342" y="-3468" font-family="Arial" font-size="10.00">Expert 0 MLP GELU (TP)</text>
<text text-anchor="middle" x="113342" y="-3457" font-family="Arial" font-size="10.00">GPUs: 512,513</text>
<text text-anchor="middle" x="113342" y="-3446" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="113342" y="-3435" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage4_expert0_mlp1&#45;&gt;stage4_expert0_mlp_act -->
<g id="edge51" class="edge">
<title>stage4_expert0_mlp1&#45;&gt;stage4_expert0_mlp_act</title>
<path fill="none" stroke="black" d="M113342,-3515.6C113342,-3515.6 113342,-3490.08 113342,-3490.08"/>
<polygon fill="black" stroke="black" points="113345.5,-3490.08 113342,-3480.08 113338.5,-3490.08 113345.5,-3490.08"/>
</g>
<!-- stage4_expert0_mlp2 -->
<g id="node845" class="node">
<title>stage4_expert0_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="113476.5,-3392 113207.5,-3392 113207.5,-3340 113476.5,-3340 113476.5,-3392"/>
<text text-anchor="middle" x="113342" y="-3380" font-family="Arial" font-size="10.00">Expert 0 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="113342" y="-3369" font-family="Arial" font-size="10.00">GPUs: 512,513</text>
<text text-anchor="middle" x="113342" y="-3358" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="113342" y="-3347" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage4_expert0_mlp_act&#45;&gt;stage4_expert0_mlp2 -->
<g id="edge52" class="edge">
<title>stage4_expert0_mlp_act&#45;&gt;stage4_expert0_mlp2</title>
<path fill="none" stroke="black" d="M113342,-3427.6C113342,-3427.6 113342,-3402.08 113342,-3402.08"/>
<polygon fill="black" stroke="black" points="113345.5,-3402.08 113342,-3392.08 113338.5,-3402.08 113345.5,-3402.08"/>
</g>
<!-- stage4_layernorm2 -->
<g id="node867" class="node">
<title>stage4_layernorm2</title>
<polygon fill="lightblue" stroke="black" points="113469.5,-3304 113214.5,-3304 113214.5,-3252 113469.5,-3252 113469.5,-3304"/>
<text text-anchor="middle" x="113342" y="-3292" font-family="Arial" font-size="10.00">LayerNorm 2</text>
<text text-anchor="middle" x="113342" y="-3281" font-family="Arial" font-size="10.00">GPUs: 512&#45;639</text>
<text text-anchor="middle" x="113342" y="-3270" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="113342" y="-3259" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage4_expert0_mlp2&#45;&gt;stage4_layernorm2 -->
<g id="edge53" class="edge">
<title>stage4_expert0_mlp2&#45;&gt;stage4_layernorm2</title>
<path fill="none" stroke="black" d="M113342,-3339.6C113342,-3339.6 113342,-3314.08 113342,-3314.08"/>
<polygon fill="black" stroke="black" points="113345.5,-3314.08 113342,-3304.08 113338.5,-3314.08 113345.5,-3314.08"/>
</g>
<!-- stage4_expert1_qkv -->
<g id="node846" class="node">
<title>stage4_expert1_qkv</title>
<polygon fill="lightgreen" stroke="black" points="113060,-4045 112774,-4045 112774,-3993 113060,-3993 113060,-4045"/>
<text text-anchor="middle" x="112917" y="-4033" font-family="Arial" font-size="10.00">Expert 1 QKV Proj (TP)</text>
<text text-anchor="middle" x="112917" y="-4022" font-family="Arial" font-size="10.00">GPUs: 514,515</text>
<text text-anchor="middle" x="112917" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112917" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage4_expert1_attn -->
<g id="node847" class="node">
<title>stage4_expert1_attn</title>
<polygon fill="lightgreen" stroke="black" points="112756,-4045 112470,-4045 112470,-3993 112756,-3993 112756,-4045"/>
<text text-anchor="middle" x="112613" y="-4033" font-family="Arial" font-size="10.00">Expert 1 Attention (TP)</text>
<text text-anchor="middle" x="112613" y="-4022" font-family="Arial" font-size="10.00">GPUs: 514,515</text>
<text text-anchor="middle" x="112613" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="112613" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage4_expert1_attn_out -->
<g id="node848" class="node">
<title>stage4_expert1_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="112452,-4045 112174,-4045 112174,-3993 112452,-3993 112452,-4045"/>
<text text-anchor="middle" x="112313" y="-4033" font-family="Arial" font-size="10.00">Expert 1 Attn Output (TP)</text>
<text text-anchor="middle" x="112313" y="-4022" font-family="Arial" font-size="10.00">GPUs: 514,515</text>
<text text-anchor="middle" x="112313" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="112313" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage4_expert1_mlp1 -->
<g id="node849" class="node">
<title>stage4_expert1_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="112156,-4045 111880,-4045 111880,-3993 112156,-3993 112156,-4045"/>
<text text-anchor="middle" x="112018" y="-4033" font-family="Arial" font-size="10.00">Expert 1 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="112018" y="-4022" font-family="Arial" font-size="10.00">GPUs: 514,515</text>
<text text-anchor="middle" x="112018" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112018" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage4_expert1_mlp_act -->
<g id="node850" class="node">
<title>stage4_expert1_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="111862,-4045 111586,-4045 111586,-3993 111862,-3993 111862,-4045"/>
<text text-anchor="middle" x="111724" y="-4033" font-family="Arial" font-size="10.00">Expert 1 MLP GELU (TP)</text>
<text text-anchor="middle" x="111724" y="-4022" font-family="Arial" font-size="10.00">GPUs: 514,515</text>
<text text-anchor="middle" x="111724" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="111724" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage4_expert1_mlp2 -->
<g id="node851" class="node">
<title>stage4_expert1_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="111567.5,-4045 111298.5,-4045 111298.5,-3993 111567.5,-3993 111567.5,-4045"/>
<text text-anchor="middle" x="111433" y="-4033" font-family="Arial" font-size="10.00">Expert 1 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="111433" y="-4022" font-family="Arial" font-size="10.00">GPUs: 514,515</text>
<text text-anchor="middle" x="111433" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="111433" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage4_expert2_qkv -->
<g id="node852" class="node">
<title>stage4_expert2_qkv</title>
<polygon fill="lightgreen" stroke="black" points="111280,-4045 110994,-4045 110994,-3993 111280,-3993 111280,-4045"/>
<text text-anchor="middle" x="111137" y="-4033" font-family="Arial" font-size="10.00">Expert 2 QKV Proj (TP)</text>
<text text-anchor="middle" x="111137" y="-4022" font-family="Arial" font-size="10.00">GPUs: 516,517</text>
<text text-anchor="middle" x="111137" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="111137" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage4_expert2_attn -->
<g id="node853" class="node">
<title>stage4_expert2_attn</title>
<polygon fill="lightgreen" stroke="black" points="110976,-4045 110690,-4045 110690,-3993 110976,-3993 110976,-4045"/>
<text text-anchor="middle" x="110833" y="-4033" font-family="Arial" font-size="10.00">Expert 2 Attention (TP)</text>
<text text-anchor="middle" x="110833" y="-4022" font-family="Arial" font-size="10.00">GPUs: 516,517</text>
<text text-anchor="middle" x="110833" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="110833" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage4_expert2_attn_out -->
<g id="node854" class="node">
<title>stage4_expert2_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="110672,-4045 110394,-4045 110394,-3993 110672,-3993 110672,-4045"/>
<text text-anchor="middle" x="110533" y="-4033" font-family="Arial" font-size="10.00">Expert 2 Attn Output (TP)</text>
<text text-anchor="middle" x="110533" y="-4022" font-family="Arial" font-size="10.00">GPUs: 516,517</text>
<text text-anchor="middle" x="110533" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="110533" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage4_expert2_mlp1 -->
<g id="node855" class="node">
<title>stage4_expert2_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="110376,-4045 110100,-4045 110100,-3993 110376,-3993 110376,-4045"/>
<text text-anchor="middle" x="110238" y="-4033" font-family="Arial" font-size="10.00">Expert 2 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="110238" y="-4022" font-family="Arial" font-size="10.00">GPUs: 516,517</text>
<text text-anchor="middle" x="110238" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="110238" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage4_expert2_mlp_act -->
<g id="node856" class="node">
<title>stage4_expert2_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="110082,-4045 109806,-4045 109806,-3993 110082,-3993 110082,-4045"/>
<text text-anchor="middle" x="109944" y="-4033" font-family="Arial" font-size="10.00">Expert 2 MLP GELU (TP)</text>
<text text-anchor="middle" x="109944" y="-4022" font-family="Arial" font-size="10.00">GPUs: 516,517</text>
<text text-anchor="middle" x="109944" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="109944" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage4_expert2_mlp2 -->
<g id="node857" class="node">
<title>stage4_expert2_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="109787.5,-4045 109518.5,-4045 109518.5,-3993 109787.5,-3993 109787.5,-4045"/>
<text text-anchor="middle" x="109653" y="-4033" font-family="Arial" font-size="10.00">Expert 2 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="109653" y="-4022" font-family="Arial" font-size="10.00">GPUs: 516,517</text>
<text text-anchor="middle" x="109653" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="109653" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage4_expert3_qkv -->
<g id="node858" class="node">
<title>stage4_expert3_qkv</title>
<polygon fill="lightgreen" stroke="black" points="109500,-4045 109214,-4045 109214,-3993 109500,-3993 109500,-4045"/>
<text text-anchor="middle" x="109357" y="-4033" font-family="Arial" font-size="10.00">Expert 3 QKV Proj (TP)</text>
<text text-anchor="middle" x="109357" y="-4022" font-family="Arial" font-size="10.00">GPUs: 518,519</text>
<text text-anchor="middle" x="109357" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="109357" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage4_expert3_attn -->
<g id="node859" class="node">
<title>stage4_expert3_attn</title>
<polygon fill="lightgreen" stroke="black" points="109196,-4045 108910,-4045 108910,-3993 109196,-3993 109196,-4045"/>
<text text-anchor="middle" x="109053" y="-4033" font-family="Arial" font-size="10.00">Expert 3 Attention (TP)</text>
<text text-anchor="middle" x="109053" y="-4022" font-family="Arial" font-size="10.00">GPUs: 518,519</text>
<text text-anchor="middle" x="109053" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="109053" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage4_expert3_attn_out -->
<g id="node860" class="node">
<title>stage4_expert3_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="108892,-4045 108614,-4045 108614,-3993 108892,-3993 108892,-4045"/>
<text text-anchor="middle" x="108753" y="-4033" font-family="Arial" font-size="10.00">Expert 3 Attn Output (TP)</text>
<text text-anchor="middle" x="108753" y="-4022" font-family="Arial" font-size="10.00">GPUs: 518,519</text>
<text text-anchor="middle" x="108753" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="108753" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage4_expert3_mlp1 -->
<g id="node861" class="node">
<title>stage4_expert3_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="108596,-4045 108320,-4045 108320,-3993 108596,-3993 108596,-4045"/>
<text text-anchor="middle" x="108458" y="-4033" font-family="Arial" font-size="10.00">Expert 3 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="108458" y="-4022" font-family="Arial" font-size="10.00">GPUs: 518,519</text>
<text text-anchor="middle" x="108458" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="108458" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage4_expert3_mlp_act -->
<g id="node862" class="node">
<title>stage4_expert3_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="108302,-4045 108026,-4045 108026,-3993 108302,-3993 108302,-4045"/>
<text text-anchor="middle" x="108164" y="-4033" font-family="Arial" font-size="10.00">Expert 3 MLP GELU (TP)</text>
<text text-anchor="middle" x="108164" y="-4022" font-family="Arial" font-size="10.00">GPUs: 518,519</text>
<text text-anchor="middle" x="108164" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="108164" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage4_expert3_mlp2 -->
<g id="node863" class="node">
<title>stage4_expert3_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="108007.5,-4045 107738.5,-4045 107738.5,-3993 108007.5,-3993 108007.5,-4045"/>
<text text-anchor="middle" x="107873" y="-4033" font-family="Arial" font-size="10.00">Expert 3 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="107873" y="-4022" font-family="Arial" font-size="10.00">GPUs: 518,519</text>
<text text-anchor="middle" x="107873" y="-4011" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="107873" y="-4000" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage4_experts_ellipsis -->
<g id="node864" class="node">
<title>stage4_experts_ellipsis</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="107720,-4037 107544,-4037 107544,-4001 107720,-4001 107720,-4037"/>
<text text-anchor="middle" x="107632" y="-4022" font-family="Arial" font-size="10.00">... (Experts 4&#45;63)</text>
<text text-anchor="middle" x="107632" y="-4011" font-family="Arial" font-size="10.00">Similar operations on GPUs 520&#45;639</text>
</g>
<!-- stage4_aggregate -->
<g id="node865" class="node">
<title>stage4_aggregate</title>
<polygon fill="lightyellow" stroke="black" points="113604.24,-3216 113183.89,-3216 113075.76,-3112 113496.11,-3112 113604.24,-3216"/>
<text text-anchor="middle" x="113340" y="-3178" font-family="Arial" font-size="10.00">Expert Output Aggregation</text>
<text text-anchor="middle" x="113340" y="-3167" font-family="Arial" font-size="10.00">GPUs: 512&#45;639</text>
<text text-anchor="middle" x="113340" y="-3156" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="113340" y="-3145" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage4_layernorm1&#45;&gt;stage4_expert0_mlp1 -->
<g id="edge50" class="edge">
<title>stage4_layernorm1&#45;&gt;stage4_expert0_mlp1</title>
<path fill="none" stroke="black" d="M113342,-3603.6C113342,-3603.6 113342,-3578.08 113342,-3578.08"/>
<polygon fill="black" stroke="black" points="113345.5,-3578.08 113342,-3568.08 113338.5,-3578.08 113345.5,-3578.08"/>
</g>
<!-- stage4_layernorm2&#45;&gt;stage4_aggregate -->
<g id="edge54" class="edge">
<title>stage4_layernorm2&#45;&gt;stage4_aggregate</title>
<path fill="none" stroke="black" d="M113342,-3251.85C113342,-3251.85 113342,-3226.1 113342,-3226.1"/>
<polygon fill="black" stroke="black" points="113345.5,-3226.1 113342,-3216.1 113338.5,-3226.1 113345.5,-3226.1"/>
</g>
<!-- pipe_comm_4_5 -->
<g id="node868" class="node">
<title>pipe_comm_4_5</title>
<ellipse fill="orange" stroke="black" cx="113803" cy="-3164" rx="180.12" ry="44.6"/>
<text text-anchor="middle" x="113803" y="-3183.5" font-family="Arial" font-size="10.00">Pipeline Communication</text>
<text text-anchor="middle" x="113803" y="-3172.5" font-family="Arial" font-size="10.00">Stage 4  Stage 5</text>
<text text-anchor="middle" x="113803" y="-3161.5" font-family="Arial" font-size="10.00">GPUs: 512&#45;639  640&#45;767</text>
<text text-anchor="middle" x="113803" y="-3150.5" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="113803" y="-3139.5" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage4_layernorm2&#45;&gt;pipe_comm_4_5 -->
<g id="edge55" class="edge">
<title>stage4_layernorm2&#45;&gt;pipe_comm_4_5</title>
<path fill="none" stroke="black" d="M113469.8,-3278C113606.23,-3278 113803,-3278 113803,-3278 113803,-3278 113803,-3218.73 113803,-3218.73"/>
<polygon fill="black" stroke="black" points="113806.5,-3218.73 113803,-3208.73 113799.5,-3218.73 113806.5,-3218.73"/>
</g>
<!-- stage5_routing -->
<g id="node869" class="node">
<title>stage5_routing</title>
<polygon fill="lightyellow" stroke="black" points="114067.24,-3050 113646.89,-3050 113538.76,-2924 113959.11,-2924 114067.24,-3050"/>
<text text-anchor="middle" x="113803" y="-3006.5" font-family="Arial" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="113803" y="-2995.5" font-family="Arial" font-size="10.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="113803" y="-2984.5" font-family="Arial" font-size="10.00">GPUs: 640&#45;767</text>
<text text-anchor="middle" x="113803" y="-2973.5" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="113803" y="-2962.5" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- pipe_comm_4_5&#45;&gt;stage5_routing -->
<g id="edge56" class="edge">
<title>pipe_comm_4_5&#45;&gt;stage5_routing</title>
<path fill="none" stroke="black" d="M113803,-3119.34C113803,-3119.34 113803,-3060.03 113803,-3060.03"/>
<polygon fill="black" stroke="black" points="113806.5,-3060.03 113803,-3050.03 113799.5,-3060.03 113806.5,-3060.03"/>
</g>
<!-- stage5_expert0_qkv -->
<g id="node870" class="node">
<title>stage5_expert0_qkv</title>
<polygon fill="lightgreen" stroke="black" points="113946,-2888 113660,-2888 113660,-2836 113946,-2836 113946,-2888"/>
<text text-anchor="middle" x="113803" y="-2876" font-family="Arial" font-size="10.00">Expert 0 QKV Proj (TP)</text>
<text text-anchor="middle" x="113803" y="-2865" font-family="Arial" font-size="10.00">GPUs: 640,641</text>
<text text-anchor="middle" x="113803" y="-2854" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="113803" y="-2843" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage5_routing&#45;&gt;stage5_expert0_qkv -->
<g id="edge57" class="edge">
<title>stage5_routing&#45;&gt;stage5_expert0_qkv</title>
<path fill="none" stroke="black" d="M113803,-2923.77C113803,-2923.77 113803,-2898.15 113803,-2898.15"/>
<polygon fill="black" stroke="black" points="113806.5,-2898.15 113803,-2888.15 113799.5,-2898.15 113806.5,-2898.15"/>
</g>
<!-- stage5_expert0_attn -->
<g id="node871" class="node">
<title>stage5_expert0_attn</title>
<polygon fill="lightgreen" stroke="black" points="113946,-2800 113660,-2800 113660,-2748 113946,-2748 113946,-2800"/>
<text text-anchor="middle" x="113803" y="-2788" font-family="Arial" font-size="10.00">Expert 0 Attention (TP)</text>
<text text-anchor="middle" x="113803" y="-2777" font-family="Arial" font-size="10.00">GPUs: 640,641</text>
<text text-anchor="middle" x="113803" y="-2766" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="113803" y="-2755" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage5_expert0_qkv&#45;&gt;stage5_expert0_attn -->
<g id="edge58" class="edge">
<title>stage5_expert0_qkv&#45;&gt;stage5_expert0_attn</title>
<path fill="none" stroke="black" d="M113803,-2835.6C113803,-2835.6 113803,-2810.08 113803,-2810.08"/>
<polygon fill="black" stroke="black" points="113806.5,-2810.08 113803,-2800.08 113799.5,-2810.08 113806.5,-2810.08"/>
</g>
<!-- stage5_expert0_attn_out -->
<g id="node872" class="node">
<title>stage5_expert0_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="113942,-2712 113664,-2712 113664,-2660 113942,-2660 113942,-2712"/>
<text text-anchor="middle" x="113803" y="-2700" font-family="Arial" font-size="10.00">Expert 0 Attn Output (TP)</text>
<text text-anchor="middle" x="113803" y="-2689" font-family="Arial" font-size="10.00">GPUs: 640,641</text>
<text text-anchor="middle" x="113803" y="-2678" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="113803" y="-2667" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage5_expert0_attn&#45;&gt;stage5_expert0_attn_out -->
<g id="edge59" class="edge">
<title>stage5_expert0_attn&#45;&gt;stage5_expert0_attn_out</title>
<path fill="none" stroke="black" d="M113803,-2747.6C113803,-2747.6 113803,-2722.08 113803,-2722.08"/>
<polygon fill="black" stroke="black" points="113806.5,-2722.08 113803,-2712.08 113799.5,-2722.08 113806.5,-2722.08"/>
</g>
<!-- stage5_layernorm1 -->
<g id="node896" class="node">
<title>stage5_layernorm1</title>
<polygon fill="lightblue" stroke="black" points="113930.5,-2624 113675.5,-2624 113675.5,-2572 113930.5,-2572 113930.5,-2624"/>
<text text-anchor="middle" x="113803" y="-2612" font-family="Arial" font-size="10.00">LayerNorm 1</text>
<text text-anchor="middle" x="113803" y="-2601" font-family="Arial" font-size="10.00">GPUs: 640&#45;767</text>
<text text-anchor="middle" x="113803" y="-2590" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="113803" y="-2579" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage5_expert0_attn_out&#45;&gt;stage5_layernorm1 -->
<g id="edge60" class="edge">
<title>stage5_expert0_attn_out&#45;&gt;stage5_layernorm1</title>
<path fill="none" stroke="black" d="M113803,-2659.6C113803,-2659.6 113803,-2634.08 113803,-2634.08"/>
<polygon fill="black" stroke="black" points="113806.5,-2634.08 113803,-2624.08 113799.5,-2634.08 113806.5,-2634.08"/>
</g>
<!-- stage5_expert0_mlp1 -->
<g id="node873" class="node">
<title>stage5_expert0_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="113941,-2536 113665,-2536 113665,-2484 113941,-2484 113941,-2536"/>
<text text-anchor="middle" x="113803" y="-2524" font-family="Arial" font-size="10.00">Expert 0 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="113803" y="-2513" font-family="Arial" font-size="10.00">GPUs: 640,641</text>
<text text-anchor="middle" x="113803" y="-2502" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="113803" y="-2491" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage5_expert0_mlp_act -->
<g id="node874" class="node">
<title>stage5_expert0_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="113941,-2448 113665,-2448 113665,-2396 113941,-2396 113941,-2448"/>
<text text-anchor="middle" x="113803" y="-2436" font-family="Arial" font-size="10.00">Expert 0 MLP GELU (TP)</text>
<text text-anchor="middle" x="113803" y="-2425" font-family="Arial" font-size="10.00">GPUs: 640,641</text>
<text text-anchor="middle" x="113803" y="-2414" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="113803" y="-2403" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage5_expert0_mlp1&#45;&gt;stage5_expert0_mlp_act -->
<g id="edge62" class="edge">
<title>stage5_expert0_mlp1&#45;&gt;stage5_expert0_mlp_act</title>
<path fill="none" stroke="black" d="M113803,-2483.6C113803,-2483.6 113803,-2458.08 113803,-2458.08"/>
<polygon fill="black" stroke="black" points="113806.5,-2458.08 113803,-2448.08 113799.5,-2458.08 113806.5,-2458.08"/>
</g>
<!-- stage5_expert0_mlp2 -->
<g id="node875" class="node">
<title>stage5_expert0_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="113937.5,-2360 113668.5,-2360 113668.5,-2308 113937.5,-2308 113937.5,-2360"/>
<text text-anchor="middle" x="113803" y="-2348" font-family="Arial" font-size="10.00">Expert 0 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="113803" y="-2337" font-family="Arial" font-size="10.00">GPUs: 640,641</text>
<text text-anchor="middle" x="113803" y="-2326" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="113803" y="-2315" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage5_expert0_mlp_act&#45;&gt;stage5_expert0_mlp2 -->
<g id="edge63" class="edge">
<title>stage5_expert0_mlp_act&#45;&gt;stage5_expert0_mlp2</title>
<path fill="none" stroke="black" d="M113803,-2395.6C113803,-2395.6 113803,-2370.08 113803,-2370.08"/>
<polygon fill="black" stroke="black" points="113806.5,-2370.08 113803,-2360.08 113799.5,-2370.08 113806.5,-2370.08"/>
</g>
<!-- stage5_layernorm2 -->
<g id="node897" class="node">
<title>stage5_layernorm2</title>
<polygon fill="lightblue" stroke="black" points="113930.5,-2272 113675.5,-2272 113675.5,-2220 113930.5,-2220 113930.5,-2272"/>
<text text-anchor="middle" x="113803" y="-2260" font-family="Arial" font-size="10.00">LayerNorm 2</text>
<text text-anchor="middle" x="113803" y="-2249" font-family="Arial" font-size="10.00">GPUs: 640&#45;767</text>
<text text-anchor="middle" x="113803" y="-2238" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="113803" y="-2227" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage5_expert0_mlp2&#45;&gt;stage5_layernorm2 -->
<g id="edge64" class="edge">
<title>stage5_expert0_mlp2&#45;&gt;stage5_layernorm2</title>
<path fill="none" stroke="black" d="M113803,-2307.6C113803,-2307.6 113803,-2282.08 113803,-2282.08"/>
<polygon fill="black" stroke="black" points="113806.5,-2282.08 113803,-2272.08 113799.5,-2282.08 113806.5,-2282.08"/>
</g>
<!-- stage5_expert1_qkv -->
<g id="node876" class="node">
<title>stage5_expert1_qkv</title>
<polygon fill="lightgreen" stroke="black" points="113521,-3013 113235,-3013 113235,-2961 113521,-2961 113521,-3013"/>
<text text-anchor="middle" x="113378" y="-3001" font-family="Arial" font-size="10.00">Expert 1 QKV Proj (TP)</text>
<text text-anchor="middle" x="113378" y="-2990" font-family="Arial" font-size="10.00">GPUs: 642,643</text>
<text text-anchor="middle" x="113378" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="113378" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage5_expert1_attn -->
<g id="node877" class="node">
<title>stage5_expert1_attn</title>
<polygon fill="lightgreen" stroke="black" points="113217,-3013 112931,-3013 112931,-2961 113217,-2961 113217,-3013"/>
<text text-anchor="middle" x="113074" y="-3001" font-family="Arial" font-size="10.00">Expert 1 Attention (TP)</text>
<text text-anchor="middle" x="113074" y="-2990" font-family="Arial" font-size="10.00">GPUs: 642,643</text>
<text text-anchor="middle" x="113074" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="113074" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage5_expert1_attn_out -->
<g id="node878" class="node">
<title>stage5_expert1_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="112913,-3013 112635,-3013 112635,-2961 112913,-2961 112913,-3013"/>
<text text-anchor="middle" x="112774" y="-3001" font-family="Arial" font-size="10.00">Expert 1 Attn Output (TP)</text>
<text text-anchor="middle" x="112774" y="-2990" font-family="Arial" font-size="10.00">GPUs: 642,643</text>
<text text-anchor="middle" x="112774" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="112774" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage5_expert1_mlp1 -->
<g id="node879" class="node">
<title>stage5_expert1_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="112617,-3013 112341,-3013 112341,-2961 112617,-2961 112617,-3013"/>
<text text-anchor="middle" x="112479" y="-3001" font-family="Arial" font-size="10.00">Expert 1 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="112479" y="-2990" font-family="Arial" font-size="10.00">GPUs: 642,643</text>
<text text-anchor="middle" x="112479" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112479" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage5_expert1_mlp_act -->
<g id="node880" class="node">
<title>stage5_expert1_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="112323,-3013 112047,-3013 112047,-2961 112323,-2961 112323,-3013"/>
<text text-anchor="middle" x="112185" y="-3001" font-family="Arial" font-size="10.00">Expert 1 MLP GELU (TP)</text>
<text text-anchor="middle" x="112185" y="-2990" font-family="Arial" font-size="10.00">GPUs: 642,643</text>
<text text-anchor="middle" x="112185" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="112185" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage5_expert1_mlp2 -->
<g id="node881" class="node">
<title>stage5_expert1_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="112028.5,-3013 111759.5,-3013 111759.5,-2961 112028.5,-2961 112028.5,-3013"/>
<text text-anchor="middle" x="111894" y="-3001" font-family="Arial" font-size="10.00">Expert 1 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="111894" y="-2990" font-family="Arial" font-size="10.00">GPUs: 642,643</text>
<text text-anchor="middle" x="111894" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="111894" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage5_expert2_qkv -->
<g id="node882" class="node">
<title>stage5_expert2_qkv</title>
<polygon fill="lightgreen" stroke="black" points="111741,-3013 111455,-3013 111455,-2961 111741,-2961 111741,-3013"/>
<text text-anchor="middle" x="111598" y="-3001" font-family="Arial" font-size="10.00">Expert 2 QKV Proj (TP)</text>
<text text-anchor="middle" x="111598" y="-2990" font-family="Arial" font-size="10.00">GPUs: 644,645</text>
<text text-anchor="middle" x="111598" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="111598" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage5_expert2_attn -->
<g id="node883" class="node">
<title>stage5_expert2_attn</title>
<polygon fill="lightgreen" stroke="black" points="111437,-3013 111151,-3013 111151,-2961 111437,-2961 111437,-3013"/>
<text text-anchor="middle" x="111294" y="-3001" font-family="Arial" font-size="10.00">Expert 2 Attention (TP)</text>
<text text-anchor="middle" x="111294" y="-2990" font-family="Arial" font-size="10.00">GPUs: 644,645</text>
<text text-anchor="middle" x="111294" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="111294" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage5_expert2_attn_out -->
<g id="node884" class="node">
<title>stage5_expert2_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="111133,-3013 110855,-3013 110855,-2961 111133,-2961 111133,-3013"/>
<text text-anchor="middle" x="110994" y="-3001" font-family="Arial" font-size="10.00">Expert 2 Attn Output (TP)</text>
<text text-anchor="middle" x="110994" y="-2990" font-family="Arial" font-size="10.00">GPUs: 644,645</text>
<text text-anchor="middle" x="110994" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="110994" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage5_expert2_mlp1 -->
<g id="node885" class="node">
<title>stage5_expert2_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="110837,-3013 110561,-3013 110561,-2961 110837,-2961 110837,-3013"/>
<text text-anchor="middle" x="110699" y="-3001" font-family="Arial" font-size="10.00">Expert 2 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="110699" y="-2990" font-family="Arial" font-size="10.00">GPUs: 644,645</text>
<text text-anchor="middle" x="110699" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="110699" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage5_expert2_mlp_act -->
<g id="node886" class="node">
<title>stage5_expert2_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="110543,-3013 110267,-3013 110267,-2961 110543,-2961 110543,-3013"/>
<text text-anchor="middle" x="110405" y="-3001" font-family="Arial" font-size="10.00">Expert 2 MLP GELU (TP)</text>
<text text-anchor="middle" x="110405" y="-2990" font-family="Arial" font-size="10.00">GPUs: 644,645</text>
<text text-anchor="middle" x="110405" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="110405" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage5_expert2_mlp2 -->
<g id="node887" class="node">
<title>stage5_expert2_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="110248.5,-3013 109979.5,-3013 109979.5,-2961 110248.5,-2961 110248.5,-3013"/>
<text text-anchor="middle" x="110114" y="-3001" font-family="Arial" font-size="10.00">Expert 2 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="110114" y="-2990" font-family="Arial" font-size="10.00">GPUs: 644,645</text>
<text text-anchor="middle" x="110114" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="110114" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage5_expert3_qkv -->
<g id="node888" class="node">
<title>stage5_expert3_qkv</title>
<polygon fill="lightgreen" stroke="black" points="109961,-3013 109675,-3013 109675,-2961 109961,-2961 109961,-3013"/>
<text text-anchor="middle" x="109818" y="-3001" font-family="Arial" font-size="10.00">Expert 3 QKV Proj (TP)</text>
<text text-anchor="middle" x="109818" y="-2990" font-family="Arial" font-size="10.00">GPUs: 646,647</text>
<text text-anchor="middle" x="109818" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="109818" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage5_expert3_attn -->
<g id="node889" class="node">
<title>stage5_expert3_attn</title>
<polygon fill="lightgreen" stroke="black" points="109657,-3013 109371,-3013 109371,-2961 109657,-2961 109657,-3013"/>
<text text-anchor="middle" x="109514" y="-3001" font-family="Arial" font-size="10.00">Expert 3 Attention (TP)</text>
<text text-anchor="middle" x="109514" y="-2990" font-family="Arial" font-size="10.00">GPUs: 646,647</text>
<text text-anchor="middle" x="109514" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="109514" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage5_expert3_attn_out -->
<g id="node890" class="node">
<title>stage5_expert3_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="109353,-3013 109075,-3013 109075,-2961 109353,-2961 109353,-3013"/>
<text text-anchor="middle" x="109214" y="-3001" font-family="Arial" font-size="10.00">Expert 3 Attn Output (TP)</text>
<text text-anchor="middle" x="109214" y="-2990" font-family="Arial" font-size="10.00">GPUs: 646,647</text>
<text text-anchor="middle" x="109214" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="109214" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage5_expert3_mlp1 -->
<g id="node891" class="node">
<title>stage5_expert3_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="109057,-3013 108781,-3013 108781,-2961 109057,-2961 109057,-3013"/>
<text text-anchor="middle" x="108919" y="-3001" font-family="Arial" font-size="10.00">Expert 3 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="108919" y="-2990" font-family="Arial" font-size="10.00">GPUs: 646,647</text>
<text text-anchor="middle" x="108919" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="108919" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage5_expert3_mlp_act -->
<g id="node892" class="node">
<title>stage5_expert3_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="108763,-3013 108487,-3013 108487,-2961 108763,-2961 108763,-3013"/>
<text text-anchor="middle" x="108625" y="-3001" font-family="Arial" font-size="10.00">Expert 3 MLP GELU (TP)</text>
<text text-anchor="middle" x="108625" y="-2990" font-family="Arial" font-size="10.00">GPUs: 646,647</text>
<text text-anchor="middle" x="108625" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="108625" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage5_expert3_mlp2 -->
<g id="node893" class="node">
<title>stage5_expert3_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="108468.5,-3013 108199.5,-3013 108199.5,-2961 108468.5,-2961 108468.5,-3013"/>
<text text-anchor="middle" x="108334" y="-3001" font-family="Arial" font-size="10.00">Expert 3 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="108334" y="-2990" font-family="Arial" font-size="10.00">GPUs: 646,647</text>
<text text-anchor="middle" x="108334" y="-2979" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="108334" y="-2968" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage5_experts_ellipsis -->
<g id="node894" class="node">
<title>stage5_experts_ellipsis</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="108181,-3005 108005,-3005 108005,-2969 108181,-2969 108181,-3005"/>
<text text-anchor="middle" x="108093" y="-2990" font-family="Arial" font-size="10.00">... (Experts 4&#45;63)</text>
<text text-anchor="middle" x="108093" y="-2979" font-family="Arial" font-size="10.00">Similar operations on GPUs 648&#45;767</text>
</g>
<!-- stage5_aggregate -->
<g id="node895" class="node">
<title>stage5_aggregate</title>
<polygon fill="lightyellow" stroke="black" points="114065.24,-2184 113644.89,-2184 113536.76,-2080 113957.11,-2080 114065.24,-2184"/>
<text text-anchor="middle" x="113801" y="-2146" font-family="Arial" font-size="10.00">Expert Output Aggregation</text>
<text text-anchor="middle" x="113801" y="-2135" font-family="Arial" font-size="10.00">GPUs: 640&#45;767</text>
<text text-anchor="middle" x="113801" y="-2124" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="113801" y="-2113" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage5_layernorm1&#45;&gt;stage5_expert0_mlp1 -->
<g id="edge61" class="edge">
<title>stage5_layernorm1&#45;&gt;stage5_expert0_mlp1</title>
<path fill="none" stroke="black" d="M113803,-2571.6C113803,-2571.6 113803,-2546.08 113803,-2546.08"/>
<polygon fill="black" stroke="black" points="113806.5,-2546.08 113803,-2536.08 113799.5,-2546.08 113806.5,-2546.08"/>
</g>
<!-- stage5_layernorm2&#45;&gt;stage5_aggregate -->
<g id="edge65" class="edge">
<title>stage5_layernorm2&#45;&gt;stage5_aggregate</title>
<path fill="none" stroke="black" d="M113803,-2219.85C113803,-2219.85 113803,-2194.1 113803,-2194.1"/>
<polygon fill="black" stroke="black" points="113806.5,-2194.1 113803,-2184.1 113799.5,-2194.1 113806.5,-2194.1"/>
</g>
<!-- pipe_comm_5_6 -->
<g id="node898" class="node">
<title>pipe_comm_5_6</title>
<ellipse fill="orange" stroke="black" cx="114264" cy="-2132" rx="180.12" ry="44.6"/>
<text text-anchor="middle" x="114264" y="-2151.5" font-family="Arial" font-size="10.00">Pipeline Communication</text>
<text text-anchor="middle" x="114264" y="-2140.5" font-family="Arial" font-size="10.00">Stage 5  Stage 6</text>
<text text-anchor="middle" x="114264" y="-2129.5" font-family="Arial" font-size="10.00">GPUs: 640&#45;767  768&#45;895</text>
<text text-anchor="middle" x="114264" y="-2118.5" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="114264" y="-2107.5" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage5_layernorm2&#45;&gt;pipe_comm_5_6 -->
<g id="edge66" class="edge">
<title>stage5_layernorm2&#45;&gt;pipe_comm_5_6</title>
<path fill="none" stroke="black" d="M113930.8,-2246C114067.23,-2246 114264,-2246 114264,-2246 114264,-2246 114264,-2186.73 114264,-2186.73"/>
<polygon fill="black" stroke="black" points="114267.5,-2186.73 114264,-2176.73 114260.5,-2186.73 114267.5,-2186.73"/>
</g>
<!-- stage6_routing -->
<g id="node899" class="node">
<title>stage6_routing</title>
<polygon fill="lightyellow" stroke="black" points="114528.24,-2018 114107.89,-2018 113999.76,-1892 114420.11,-1892 114528.24,-2018"/>
<text text-anchor="middle" x="114264" y="-1974.5" font-family="Arial" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="114264" y="-1963.5" font-family="Arial" font-size="10.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="114264" y="-1952.5" font-family="Arial" font-size="10.00">GPUs: 768&#45;895</text>
<text text-anchor="middle" x="114264" y="-1941.5" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="114264" y="-1930.5" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- pipe_comm_5_6&#45;&gt;stage6_routing -->
<g id="edge67" class="edge">
<title>pipe_comm_5_6&#45;&gt;stage6_routing</title>
<path fill="none" stroke="black" d="M114264,-2087.34C114264,-2087.34 114264,-2028.03 114264,-2028.03"/>
<polygon fill="black" stroke="black" points="114267.5,-2028.03 114264,-2018.03 114260.5,-2028.03 114267.5,-2028.03"/>
</g>
<!-- stage6_expert0_qkv -->
<g id="node900" class="node">
<title>stage6_expert0_qkv</title>
<polygon fill="lightgreen" stroke="black" points="114407,-1856 114121,-1856 114121,-1804 114407,-1804 114407,-1856"/>
<text text-anchor="middle" x="114264" y="-1844" font-family="Arial" font-size="10.00">Expert 0 QKV Proj (TP)</text>
<text text-anchor="middle" x="114264" y="-1833" font-family="Arial" font-size="10.00">GPUs: 768,769</text>
<text text-anchor="middle" x="114264" y="-1822" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="114264" y="-1811" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage6_routing&#45;&gt;stage6_expert0_qkv -->
<g id="edge68" class="edge">
<title>stage6_routing&#45;&gt;stage6_expert0_qkv</title>
<path fill="none" stroke="black" d="M114264,-1891.77C114264,-1891.77 114264,-1866.15 114264,-1866.15"/>
<polygon fill="black" stroke="black" points="114267.5,-1866.15 114264,-1856.15 114260.5,-1866.15 114267.5,-1866.15"/>
</g>
<!-- stage6_expert0_attn -->
<g id="node901" class="node">
<title>stage6_expert0_attn</title>
<polygon fill="lightgreen" stroke="black" points="114407,-1768 114121,-1768 114121,-1716 114407,-1716 114407,-1768"/>
<text text-anchor="middle" x="114264" y="-1756" font-family="Arial" font-size="10.00">Expert 0 Attention (TP)</text>
<text text-anchor="middle" x="114264" y="-1745" font-family="Arial" font-size="10.00">GPUs: 768,769</text>
<text text-anchor="middle" x="114264" y="-1734" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="114264" y="-1723" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage6_expert0_qkv&#45;&gt;stage6_expert0_attn -->
<g id="edge69" class="edge">
<title>stage6_expert0_qkv&#45;&gt;stage6_expert0_attn</title>
<path fill="none" stroke="black" d="M114264,-1803.6C114264,-1803.6 114264,-1778.08 114264,-1778.08"/>
<polygon fill="black" stroke="black" points="114267.5,-1778.08 114264,-1768.08 114260.5,-1778.08 114267.5,-1778.08"/>
</g>
<!-- stage6_expert0_attn_out -->
<g id="node902" class="node">
<title>stage6_expert0_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="114403,-1680 114125,-1680 114125,-1628 114403,-1628 114403,-1680"/>
<text text-anchor="middle" x="114264" y="-1668" font-family="Arial" font-size="10.00">Expert 0 Attn Output (TP)</text>
<text text-anchor="middle" x="114264" y="-1657" font-family="Arial" font-size="10.00">GPUs: 768,769</text>
<text text-anchor="middle" x="114264" y="-1646" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="114264" y="-1635" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage6_expert0_attn&#45;&gt;stage6_expert0_attn_out -->
<g id="edge70" class="edge">
<title>stage6_expert0_attn&#45;&gt;stage6_expert0_attn_out</title>
<path fill="none" stroke="black" d="M114264,-1715.6C114264,-1715.6 114264,-1690.08 114264,-1690.08"/>
<polygon fill="black" stroke="black" points="114267.5,-1690.08 114264,-1680.08 114260.5,-1690.08 114267.5,-1690.08"/>
</g>
<!-- stage6_layernorm1 -->
<g id="node926" class="node">
<title>stage6_layernorm1</title>
<polygon fill="lightblue" stroke="black" points="114391.5,-1592 114136.5,-1592 114136.5,-1540 114391.5,-1540 114391.5,-1592"/>
<text text-anchor="middle" x="114264" y="-1580" font-family="Arial" font-size="10.00">LayerNorm 1</text>
<text text-anchor="middle" x="114264" y="-1569" font-family="Arial" font-size="10.00">GPUs: 768&#45;895</text>
<text text-anchor="middle" x="114264" y="-1558" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="114264" y="-1547" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage6_expert0_attn_out&#45;&gt;stage6_layernorm1 -->
<g id="edge71" class="edge">
<title>stage6_expert0_attn_out&#45;&gt;stage6_layernorm1</title>
<path fill="none" stroke="black" d="M114264,-1627.6C114264,-1627.6 114264,-1602.08 114264,-1602.08"/>
<polygon fill="black" stroke="black" points="114267.5,-1602.08 114264,-1592.08 114260.5,-1602.08 114267.5,-1602.08"/>
</g>
<!-- stage6_expert0_mlp1 -->
<g id="node903" class="node">
<title>stage6_expert0_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="114402,-1504 114126,-1504 114126,-1452 114402,-1452 114402,-1504"/>
<text text-anchor="middle" x="114264" y="-1492" font-family="Arial" font-size="10.00">Expert 0 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="114264" y="-1481" font-family="Arial" font-size="10.00">GPUs: 768,769</text>
<text text-anchor="middle" x="114264" y="-1470" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="114264" y="-1459" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage6_expert0_mlp_act -->
<g id="node904" class="node">
<title>stage6_expert0_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="114402,-1416 114126,-1416 114126,-1364 114402,-1364 114402,-1416"/>
<text text-anchor="middle" x="114264" y="-1404" font-family="Arial" font-size="10.00">Expert 0 MLP GELU (TP)</text>
<text text-anchor="middle" x="114264" y="-1393" font-family="Arial" font-size="10.00">GPUs: 768,769</text>
<text text-anchor="middle" x="114264" y="-1382" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="114264" y="-1371" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage6_expert0_mlp1&#45;&gt;stage6_expert0_mlp_act -->
<g id="edge73" class="edge">
<title>stage6_expert0_mlp1&#45;&gt;stage6_expert0_mlp_act</title>
<path fill="none" stroke="black" d="M114264,-1451.6C114264,-1451.6 114264,-1426.08 114264,-1426.08"/>
<polygon fill="black" stroke="black" points="114267.5,-1426.08 114264,-1416.08 114260.5,-1426.08 114267.5,-1426.08"/>
</g>
<!-- stage6_expert0_mlp2 -->
<g id="node905" class="node">
<title>stage6_expert0_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="114398.5,-1328 114129.5,-1328 114129.5,-1276 114398.5,-1276 114398.5,-1328"/>
<text text-anchor="middle" x="114264" y="-1316" font-family="Arial" font-size="10.00">Expert 0 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="114264" y="-1305" font-family="Arial" font-size="10.00">GPUs: 768,769</text>
<text text-anchor="middle" x="114264" y="-1294" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="114264" y="-1283" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage6_expert0_mlp_act&#45;&gt;stage6_expert0_mlp2 -->
<g id="edge74" class="edge">
<title>stage6_expert0_mlp_act&#45;&gt;stage6_expert0_mlp2</title>
<path fill="none" stroke="black" d="M114264,-1363.6C114264,-1363.6 114264,-1338.08 114264,-1338.08"/>
<polygon fill="black" stroke="black" points="114267.5,-1338.08 114264,-1328.08 114260.5,-1338.08 114267.5,-1338.08"/>
</g>
<!-- stage6_layernorm2 -->
<g id="node927" class="node">
<title>stage6_layernorm2</title>
<polygon fill="lightblue" stroke="black" points="114391.5,-1240 114136.5,-1240 114136.5,-1188 114391.5,-1188 114391.5,-1240"/>
<text text-anchor="middle" x="114264" y="-1228" font-family="Arial" font-size="10.00">LayerNorm 2</text>
<text text-anchor="middle" x="114264" y="-1217" font-family="Arial" font-size="10.00">GPUs: 768&#45;895</text>
<text text-anchor="middle" x="114264" y="-1206" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="114264" y="-1195" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage6_expert0_mlp2&#45;&gt;stage6_layernorm2 -->
<g id="edge75" class="edge">
<title>stage6_expert0_mlp2&#45;&gt;stage6_layernorm2</title>
<path fill="none" stroke="black" d="M114264,-1275.6C114264,-1275.6 114264,-1250.08 114264,-1250.08"/>
<polygon fill="black" stroke="black" points="114267.5,-1250.08 114264,-1240.08 114260.5,-1250.08 114267.5,-1250.08"/>
</g>
<!-- stage6_expert1_qkv -->
<g id="node906" class="node">
<title>stage6_expert1_qkv</title>
<polygon fill="lightgreen" stroke="black" points="113982,-1981 113696,-1981 113696,-1929 113982,-1929 113982,-1981"/>
<text text-anchor="middle" x="113839" y="-1969" font-family="Arial" font-size="10.00">Expert 1 QKV Proj (TP)</text>
<text text-anchor="middle" x="113839" y="-1958" font-family="Arial" font-size="10.00">GPUs: 770,771</text>
<text text-anchor="middle" x="113839" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="113839" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage6_expert1_attn -->
<g id="node907" class="node">
<title>stage6_expert1_attn</title>
<polygon fill="lightgreen" stroke="black" points="113678,-1981 113392,-1981 113392,-1929 113678,-1929 113678,-1981"/>
<text text-anchor="middle" x="113535" y="-1969" font-family="Arial" font-size="10.00">Expert 1 Attention (TP)</text>
<text text-anchor="middle" x="113535" y="-1958" font-family="Arial" font-size="10.00">GPUs: 770,771</text>
<text text-anchor="middle" x="113535" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="113535" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage6_expert1_attn_out -->
<g id="node908" class="node">
<title>stage6_expert1_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="113374,-1981 113096,-1981 113096,-1929 113374,-1929 113374,-1981"/>
<text text-anchor="middle" x="113235" y="-1969" font-family="Arial" font-size="10.00">Expert 1 Attn Output (TP)</text>
<text text-anchor="middle" x="113235" y="-1958" font-family="Arial" font-size="10.00">GPUs: 770,771</text>
<text text-anchor="middle" x="113235" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="113235" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage6_expert1_mlp1 -->
<g id="node909" class="node">
<title>stage6_expert1_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="113078,-1981 112802,-1981 112802,-1929 113078,-1929 113078,-1981"/>
<text text-anchor="middle" x="112940" y="-1969" font-family="Arial" font-size="10.00">Expert 1 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="112940" y="-1958" font-family="Arial" font-size="10.00">GPUs: 770,771</text>
<text text-anchor="middle" x="112940" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112940" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage6_expert1_mlp_act -->
<g id="node910" class="node">
<title>stage6_expert1_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="112784,-1981 112508,-1981 112508,-1929 112784,-1929 112784,-1981"/>
<text text-anchor="middle" x="112646" y="-1969" font-family="Arial" font-size="10.00">Expert 1 MLP GELU (TP)</text>
<text text-anchor="middle" x="112646" y="-1958" font-family="Arial" font-size="10.00">GPUs: 770,771</text>
<text text-anchor="middle" x="112646" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="112646" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage6_expert1_mlp2 -->
<g id="node911" class="node">
<title>stage6_expert1_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="112489.5,-1981 112220.5,-1981 112220.5,-1929 112489.5,-1929 112489.5,-1981"/>
<text text-anchor="middle" x="112355" y="-1969" font-family="Arial" font-size="10.00">Expert 1 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="112355" y="-1958" font-family="Arial" font-size="10.00">GPUs: 770,771</text>
<text text-anchor="middle" x="112355" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="112355" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage6_expert2_qkv -->
<g id="node912" class="node">
<title>stage6_expert2_qkv</title>
<polygon fill="lightgreen" stroke="black" points="112202,-1981 111916,-1981 111916,-1929 112202,-1929 112202,-1981"/>
<text text-anchor="middle" x="112059" y="-1969" font-family="Arial" font-size="10.00">Expert 2 QKV Proj (TP)</text>
<text text-anchor="middle" x="112059" y="-1958" font-family="Arial" font-size="10.00">GPUs: 772,773</text>
<text text-anchor="middle" x="112059" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112059" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage6_expert2_attn -->
<g id="node913" class="node">
<title>stage6_expert2_attn</title>
<polygon fill="lightgreen" stroke="black" points="111898,-1981 111612,-1981 111612,-1929 111898,-1929 111898,-1981"/>
<text text-anchor="middle" x="111755" y="-1969" font-family="Arial" font-size="10.00">Expert 2 Attention (TP)</text>
<text text-anchor="middle" x="111755" y="-1958" font-family="Arial" font-size="10.00">GPUs: 772,773</text>
<text text-anchor="middle" x="111755" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="111755" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage6_expert2_attn_out -->
<g id="node914" class="node">
<title>stage6_expert2_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="111594,-1981 111316,-1981 111316,-1929 111594,-1929 111594,-1981"/>
<text text-anchor="middle" x="111455" y="-1969" font-family="Arial" font-size="10.00">Expert 2 Attn Output (TP)</text>
<text text-anchor="middle" x="111455" y="-1958" font-family="Arial" font-size="10.00">GPUs: 772,773</text>
<text text-anchor="middle" x="111455" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="111455" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage6_expert2_mlp1 -->
<g id="node915" class="node">
<title>stage6_expert2_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="111298,-1981 111022,-1981 111022,-1929 111298,-1929 111298,-1981"/>
<text text-anchor="middle" x="111160" y="-1969" font-family="Arial" font-size="10.00">Expert 2 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="111160" y="-1958" font-family="Arial" font-size="10.00">GPUs: 772,773</text>
<text text-anchor="middle" x="111160" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="111160" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage6_expert2_mlp_act -->
<g id="node916" class="node">
<title>stage6_expert2_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="111004,-1981 110728,-1981 110728,-1929 111004,-1929 111004,-1981"/>
<text text-anchor="middle" x="110866" y="-1969" font-family="Arial" font-size="10.00">Expert 2 MLP GELU (TP)</text>
<text text-anchor="middle" x="110866" y="-1958" font-family="Arial" font-size="10.00">GPUs: 772,773</text>
<text text-anchor="middle" x="110866" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="110866" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage6_expert2_mlp2 -->
<g id="node917" class="node">
<title>stage6_expert2_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="110709.5,-1981 110440.5,-1981 110440.5,-1929 110709.5,-1929 110709.5,-1981"/>
<text text-anchor="middle" x="110575" y="-1969" font-family="Arial" font-size="10.00">Expert 2 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="110575" y="-1958" font-family="Arial" font-size="10.00">GPUs: 772,773</text>
<text text-anchor="middle" x="110575" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="110575" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage6_expert3_qkv -->
<g id="node918" class="node">
<title>stage6_expert3_qkv</title>
<polygon fill="lightgreen" stroke="black" points="110422,-1981 110136,-1981 110136,-1929 110422,-1929 110422,-1981"/>
<text text-anchor="middle" x="110279" y="-1969" font-family="Arial" font-size="10.00">Expert 3 QKV Proj (TP)</text>
<text text-anchor="middle" x="110279" y="-1958" font-family="Arial" font-size="10.00">GPUs: 774,775</text>
<text text-anchor="middle" x="110279" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="110279" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage6_expert3_attn -->
<g id="node919" class="node">
<title>stage6_expert3_attn</title>
<polygon fill="lightgreen" stroke="black" points="110118,-1981 109832,-1981 109832,-1929 110118,-1929 110118,-1981"/>
<text text-anchor="middle" x="109975" y="-1969" font-family="Arial" font-size="10.00">Expert 3 Attention (TP)</text>
<text text-anchor="middle" x="109975" y="-1958" font-family="Arial" font-size="10.00">GPUs: 774,775</text>
<text text-anchor="middle" x="109975" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="109975" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage6_expert3_attn_out -->
<g id="node920" class="node">
<title>stage6_expert3_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="109814,-1981 109536,-1981 109536,-1929 109814,-1929 109814,-1981"/>
<text text-anchor="middle" x="109675" y="-1969" font-family="Arial" font-size="10.00">Expert 3 Attn Output (TP)</text>
<text text-anchor="middle" x="109675" y="-1958" font-family="Arial" font-size="10.00">GPUs: 774,775</text>
<text text-anchor="middle" x="109675" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="109675" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage6_expert3_mlp1 -->
<g id="node921" class="node">
<title>stage6_expert3_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="109518,-1981 109242,-1981 109242,-1929 109518,-1929 109518,-1981"/>
<text text-anchor="middle" x="109380" y="-1969" font-family="Arial" font-size="10.00">Expert 3 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="109380" y="-1958" font-family="Arial" font-size="10.00">GPUs: 774,775</text>
<text text-anchor="middle" x="109380" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="109380" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage6_expert3_mlp_act -->
<g id="node922" class="node">
<title>stage6_expert3_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="109224,-1981 108948,-1981 108948,-1929 109224,-1929 109224,-1981"/>
<text text-anchor="middle" x="109086" y="-1969" font-family="Arial" font-size="10.00">Expert 3 MLP GELU (TP)</text>
<text text-anchor="middle" x="109086" y="-1958" font-family="Arial" font-size="10.00">GPUs: 774,775</text>
<text text-anchor="middle" x="109086" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="109086" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage6_expert3_mlp2 -->
<g id="node923" class="node">
<title>stage6_expert3_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="108929.5,-1981 108660.5,-1981 108660.5,-1929 108929.5,-1929 108929.5,-1981"/>
<text text-anchor="middle" x="108795" y="-1969" font-family="Arial" font-size="10.00">Expert 3 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="108795" y="-1958" font-family="Arial" font-size="10.00">GPUs: 774,775</text>
<text text-anchor="middle" x="108795" y="-1947" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="108795" y="-1936" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage6_experts_ellipsis -->
<g id="node924" class="node">
<title>stage6_experts_ellipsis</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="108642,-1973 108466,-1973 108466,-1937 108642,-1937 108642,-1973"/>
<text text-anchor="middle" x="108554" y="-1958" font-family="Arial" font-size="10.00">... (Experts 4&#45;63)</text>
<text text-anchor="middle" x="108554" y="-1947" font-family="Arial" font-size="10.00">Similar operations on GPUs 776&#45;895</text>
</g>
<!-- stage6_aggregate -->
<g id="node925" class="node">
<title>stage6_aggregate</title>
<polygon fill="lightyellow" stroke="black" points="114527.24,-1152 114106.89,-1152 113998.76,-1048 114419.11,-1048 114527.24,-1152"/>
<text text-anchor="middle" x="114263" y="-1114" font-family="Arial" font-size="10.00">Expert Output Aggregation</text>
<text text-anchor="middle" x="114263" y="-1103" font-family="Arial" font-size="10.00">GPUs: 768&#45;895</text>
<text text-anchor="middle" x="114263" y="-1092" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="114263" y="-1081" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage6_layernorm1&#45;&gt;stage6_expert0_mlp1 -->
<g id="edge72" class="edge">
<title>stage6_layernorm1&#45;&gt;stage6_expert0_mlp1</title>
<path fill="none" stroke="black" d="M114264,-1539.6C114264,-1539.6 114264,-1514.08 114264,-1514.08"/>
<polygon fill="black" stroke="black" points="114267.5,-1514.08 114264,-1504.08 114260.5,-1514.08 114267.5,-1514.08"/>
</g>
<!-- stage6_layernorm2&#45;&gt;stage6_aggregate -->
<g id="edge76" class="edge">
<title>stage6_layernorm2&#45;&gt;stage6_aggregate</title>
<path fill="none" stroke="black" d="M114264,-1187.85C114264,-1187.85 114264,-1162.1 114264,-1162.1"/>
<polygon fill="black" stroke="black" points="114267.5,-1162.1 114264,-1152.1 114260.5,-1162.1 114267.5,-1162.1"/>
</g>
<!-- pipe_comm_6_7 -->
<g id="node928" class="node">
<title>pipe_comm_6_7</title>
<ellipse fill="orange" stroke="black" cx="114726" cy="-1100" rx="180.12" ry="44.6"/>
<text text-anchor="middle" x="114726" y="-1119.5" font-family="Arial" font-size="10.00">Pipeline Communication</text>
<text text-anchor="middle" x="114726" y="-1108.5" font-family="Arial" font-size="10.00">Stage 6  Stage 7</text>
<text text-anchor="middle" x="114726" y="-1097.5" font-family="Arial" font-size="10.00">GPUs: 768&#45;895  896&#45;1023</text>
<text text-anchor="middle" x="114726" y="-1086.5" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="114726" y="-1075.5" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage6_layernorm2&#45;&gt;pipe_comm_6_7 -->
<g id="edge77" class="edge">
<title>stage6_layernorm2&#45;&gt;pipe_comm_6_7</title>
<path fill="none" stroke="black" d="M114391.77,-1214C114528.51,-1214 114726,-1214 114726,-1214 114726,-1214 114726,-1154.73 114726,-1154.73"/>
<polygon fill="black" stroke="black" points="114729.5,-1154.73 114726,-1144.73 114722.5,-1154.73 114729.5,-1154.73"/>
</g>
<!-- stage7_routing -->
<g id="node929" class="node">
<title>stage7_routing</title>
<polygon fill="lightyellow" stroke="black" points="114990.24,-986 114569.89,-986 114461.76,-860 114882.11,-860 114990.24,-986"/>
<text text-anchor="middle" x="114726" y="-942.5" font-family="Arial" font-size="10.00">Expert Routing</text>
<text text-anchor="middle" x="114726" y="-931.5" font-family="Arial" font-size="10.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="114726" y="-920.5" font-family="Arial" font-size="10.00">GPUs: 896&#45;1023</text>
<text text-anchor="middle" x="114726" y="-909.5" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="114726" y="-898.5" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- pipe_comm_6_7&#45;&gt;stage7_routing -->
<g id="edge78" class="edge">
<title>pipe_comm_6_7&#45;&gt;stage7_routing</title>
<path fill="none" stroke="black" d="M114726,-1055.34C114726,-1055.34 114726,-996.03 114726,-996.03"/>
<polygon fill="black" stroke="black" points="114729.5,-996.03 114726,-986.03 114722.5,-996.03 114729.5,-996.03"/>
</g>
<!-- stage7_expert0_qkv -->
<g id="node930" class="node">
<title>stage7_expert0_qkv</title>
<polygon fill="lightgreen" stroke="black" points="114869,-824 114583,-824 114583,-772 114869,-772 114869,-824"/>
<text text-anchor="middle" x="114726" y="-812" font-family="Arial" font-size="10.00">Expert 0 QKV Proj (TP)</text>
<text text-anchor="middle" x="114726" y="-801" font-family="Arial" font-size="10.00">GPUs: 896,897</text>
<text text-anchor="middle" x="114726" y="-790" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="114726" y="-779" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage7_routing&#45;&gt;stage7_expert0_qkv -->
<g id="edge79" class="edge">
<title>stage7_routing&#45;&gt;stage7_expert0_qkv</title>
<path fill="none" stroke="black" d="M114726,-859.77C114726,-859.77 114726,-834.15 114726,-834.15"/>
<polygon fill="black" stroke="black" points="114729.5,-834.15 114726,-824.15 114722.5,-834.15 114729.5,-834.15"/>
</g>
<!-- stage7_expert0_attn -->
<g id="node931" class="node">
<title>stage7_expert0_attn</title>
<polygon fill="lightgreen" stroke="black" points="114869,-736 114583,-736 114583,-684 114869,-684 114869,-736"/>
<text text-anchor="middle" x="114726" y="-724" font-family="Arial" font-size="10.00">Expert 0 Attention (TP)</text>
<text text-anchor="middle" x="114726" y="-713" font-family="Arial" font-size="10.00">GPUs: 896,897</text>
<text text-anchor="middle" x="114726" y="-702" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="114726" y="-691" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage7_expert0_qkv&#45;&gt;stage7_expert0_attn -->
<g id="edge80" class="edge">
<title>stage7_expert0_qkv&#45;&gt;stage7_expert0_attn</title>
<path fill="none" stroke="black" d="M114726,-771.6C114726,-771.6 114726,-746.08 114726,-746.08"/>
<polygon fill="black" stroke="black" points="114729.5,-746.08 114726,-736.08 114722.5,-746.08 114729.5,-746.08"/>
</g>
<!-- stage7_expert0_attn_out -->
<g id="node932" class="node">
<title>stage7_expert0_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="114865,-648 114587,-648 114587,-596 114865,-596 114865,-648"/>
<text text-anchor="middle" x="114726" y="-636" font-family="Arial" font-size="10.00">Expert 0 Attn Output (TP)</text>
<text text-anchor="middle" x="114726" y="-625" font-family="Arial" font-size="10.00">GPUs: 896,897</text>
<text text-anchor="middle" x="114726" y="-614" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="114726" y="-603" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage7_expert0_attn&#45;&gt;stage7_expert0_attn_out -->
<g id="edge81" class="edge">
<title>stage7_expert0_attn&#45;&gt;stage7_expert0_attn_out</title>
<path fill="none" stroke="black" d="M114726,-683.6C114726,-683.6 114726,-658.08 114726,-658.08"/>
<polygon fill="black" stroke="black" points="114729.5,-658.08 114726,-648.08 114722.5,-658.08 114729.5,-658.08"/>
</g>
<!-- stage7_layernorm1 -->
<g id="node956" class="node">
<title>stage7_layernorm1</title>
<polygon fill="lightblue" stroke="black" points="114853.5,-560 114598.5,-560 114598.5,-508 114853.5,-508 114853.5,-560"/>
<text text-anchor="middle" x="114726" y="-548" font-family="Arial" font-size="10.00">LayerNorm 1</text>
<text text-anchor="middle" x="114726" y="-537" font-family="Arial" font-size="10.00">GPUs: 896&#45;1023</text>
<text text-anchor="middle" x="114726" y="-526" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="114726" y="-515" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage7_expert0_attn_out&#45;&gt;stage7_layernorm1 -->
<g id="edge82" class="edge">
<title>stage7_expert0_attn_out&#45;&gt;stage7_layernorm1</title>
<path fill="none" stroke="black" d="M114726,-595.6C114726,-595.6 114726,-570.08 114726,-570.08"/>
<polygon fill="black" stroke="black" points="114729.5,-570.08 114726,-560.08 114722.5,-570.08 114729.5,-570.08"/>
</g>
<!-- stage7_expert0_mlp1 -->
<g id="node933" class="node">
<title>stage7_expert0_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="114864,-472 114588,-472 114588,-420 114864,-420 114864,-472"/>
<text text-anchor="middle" x="114726" y="-460" font-family="Arial" font-size="10.00">Expert 0 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="114726" y="-449" font-family="Arial" font-size="10.00">GPUs: 896,897</text>
<text text-anchor="middle" x="114726" y="-438" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="114726" y="-427" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage7_expert0_mlp_act -->
<g id="node934" class="node">
<title>stage7_expert0_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="114864,-384 114588,-384 114588,-332 114864,-332 114864,-384"/>
<text text-anchor="middle" x="114726" y="-372" font-family="Arial" font-size="10.00">Expert 0 MLP GELU (TP)</text>
<text text-anchor="middle" x="114726" y="-361" font-family="Arial" font-size="10.00">GPUs: 896,897</text>
<text text-anchor="middle" x="114726" y="-350" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="114726" y="-339" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage7_expert0_mlp1&#45;&gt;stage7_expert0_mlp_act -->
<g id="edge84" class="edge">
<title>stage7_expert0_mlp1&#45;&gt;stage7_expert0_mlp_act</title>
<path fill="none" stroke="black" d="M114726,-419.6C114726,-419.6 114726,-394.08 114726,-394.08"/>
<polygon fill="black" stroke="black" points="114729.5,-394.08 114726,-384.08 114722.5,-394.08 114729.5,-394.08"/>
</g>
<!-- stage7_expert0_mlp2 -->
<g id="node935" class="node">
<title>stage7_expert0_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="114860.5,-296 114591.5,-296 114591.5,-244 114860.5,-244 114860.5,-296"/>
<text text-anchor="middle" x="114726" y="-284" font-family="Arial" font-size="10.00">Expert 0 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="114726" y="-273" font-family="Arial" font-size="10.00">GPUs: 896,897</text>
<text text-anchor="middle" x="114726" y="-262" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="114726" y="-251" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage7_expert0_mlp_act&#45;&gt;stage7_expert0_mlp2 -->
<g id="edge85" class="edge">
<title>stage7_expert0_mlp_act&#45;&gt;stage7_expert0_mlp2</title>
<path fill="none" stroke="black" d="M114726,-331.6C114726,-331.6 114726,-306.08 114726,-306.08"/>
<polygon fill="black" stroke="black" points="114729.5,-306.08 114726,-296.08 114722.5,-306.08 114729.5,-306.08"/>
</g>
<!-- stage7_layernorm2 -->
<g id="node957" class="node">
<title>stage7_layernorm2</title>
<polygon fill="lightblue" stroke="black" points="114853.5,-208 114598.5,-208 114598.5,-156 114853.5,-156 114853.5,-208"/>
<text text-anchor="middle" x="114726" y="-196" font-family="Arial" font-size="10.00">LayerNorm 2</text>
<text text-anchor="middle" x="114726" y="-185" font-family="Arial" font-size="10.00">GPUs: 896&#45;1023</text>
<text text-anchor="middle" x="114726" y="-174" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="114726" y="-163" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage7_expert0_mlp2&#45;&gt;stage7_layernorm2 -->
<g id="edge86" class="edge">
<title>stage7_expert0_mlp2&#45;&gt;stage7_layernorm2</title>
<path fill="none" stroke="black" d="M114726,-243.6C114726,-243.6 114726,-218.08 114726,-218.08"/>
<polygon fill="black" stroke="black" points="114729.5,-218.08 114726,-208.08 114722.5,-218.08 114729.5,-218.08"/>
</g>
<!-- stage7_expert1_qkv -->
<g id="node936" class="node">
<title>stage7_expert1_qkv</title>
<polygon fill="lightgreen" stroke="black" points="114444,-949 114158,-949 114158,-897 114444,-897 114444,-949"/>
<text text-anchor="middle" x="114301" y="-937" font-family="Arial" font-size="10.00">Expert 1 QKV Proj (TP)</text>
<text text-anchor="middle" x="114301" y="-926" font-family="Arial" font-size="10.00">GPUs: 898,899</text>
<text text-anchor="middle" x="114301" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="114301" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage7_expert1_attn -->
<g id="node937" class="node">
<title>stage7_expert1_attn</title>
<polygon fill="lightgreen" stroke="black" points="114140,-949 113854,-949 113854,-897 114140,-897 114140,-949"/>
<text text-anchor="middle" x="113997" y="-937" font-family="Arial" font-size="10.00">Expert 1 Attention (TP)</text>
<text text-anchor="middle" x="113997" y="-926" font-family="Arial" font-size="10.00">GPUs: 898,899</text>
<text text-anchor="middle" x="113997" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="113997" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage7_expert1_attn_out -->
<g id="node938" class="node">
<title>stage7_expert1_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="113836,-949 113558,-949 113558,-897 113836,-897 113836,-949"/>
<text text-anchor="middle" x="113697" y="-937" font-family="Arial" font-size="10.00">Expert 1 Attn Output (TP)</text>
<text text-anchor="middle" x="113697" y="-926" font-family="Arial" font-size="10.00">GPUs: 898,899</text>
<text text-anchor="middle" x="113697" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="113697" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage7_expert1_mlp1 -->
<g id="node939" class="node">
<title>stage7_expert1_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="113540,-949 113264,-949 113264,-897 113540,-897 113540,-949"/>
<text text-anchor="middle" x="113402" y="-937" font-family="Arial" font-size="10.00">Expert 1 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="113402" y="-926" font-family="Arial" font-size="10.00">GPUs: 898,899</text>
<text text-anchor="middle" x="113402" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="113402" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage7_expert1_mlp_act -->
<g id="node940" class="node">
<title>stage7_expert1_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="113246,-949 112970,-949 112970,-897 113246,-897 113246,-949"/>
<text text-anchor="middle" x="113108" y="-937" font-family="Arial" font-size="10.00">Expert 1 MLP GELU (TP)</text>
<text text-anchor="middle" x="113108" y="-926" font-family="Arial" font-size="10.00">GPUs: 898,899</text>
<text text-anchor="middle" x="113108" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="113108" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage7_expert1_mlp2 -->
<g id="node941" class="node">
<title>stage7_expert1_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="112951.5,-949 112682.5,-949 112682.5,-897 112951.5,-897 112951.5,-949"/>
<text text-anchor="middle" x="112817" y="-937" font-family="Arial" font-size="10.00">Expert 1 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="112817" y="-926" font-family="Arial" font-size="10.00">GPUs: 898,899</text>
<text text-anchor="middle" x="112817" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="112817" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage7_expert2_qkv -->
<g id="node942" class="node">
<title>stage7_expert2_qkv</title>
<polygon fill="lightgreen" stroke="black" points="112664,-949 112378,-949 112378,-897 112664,-897 112664,-949"/>
<text text-anchor="middle" x="112521" y="-937" font-family="Arial" font-size="10.00">Expert 2 QKV Proj (TP)</text>
<text text-anchor="middle" x="112521" y="-926" font-family="Arial" font-size="10.00">GPUs: 900,901</text>
<text text-anchor="middle" x="112521" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="112521" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage7_expert2_attn -->
<g id="node943" class="node">
<title>stage7_expert2_attn</title>
<polygon fill="lightgreen" stroke="black" points="112360,-949 112074,-949 112074,-897 112360,-897 112360,-949"/>
<text text-anchor="middle" x="112217" y="-937" font-family="Arial" font-size="10.00">Expert 2 Attention (TP)</text>
<text text-anchor="middle" x="112217" y="-926" font-family="Arial" font-size="10.00">GPUs: 900,901</text>
<text text-anchor="middle" x="112217" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="112217" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage7_expert2_attn_out -->
<g id="node944" class="node">
<title>stage7_expert2_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="112056,-949 111778,-949 111778,-897 112056,-897 112056,-949"/>
<text text-anchor="middle" x="111917" y="-937" font-family="Arial" font-size="10.00">Expert 2 Attn Output (TP)</text>
<text text-anchor="middle" x="111917" y="-926" font-family="Arial" font-size="10.00">GPUs: 900,901</text>
<text text-anchor="middle" x="111917" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="111917" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage7_expert2_mlp1 -->
<g id="node945" class="node">
<title>stage7_expert2_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="111760,-949 111484,-949 111484,-897 111760,-897 111760,-949"/>
<text text-anchor="middle" x="111622" y="-937" font-family="Arial" font-size="10.00">Expert 2 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="111622" y="-926" font-family="Arial" font-size="10.00">GPUs: 900,901</text>
<text text-anchor="middle" x="111622" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="111622" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage7_expert2_mlp_act -->
<g id="node946" class="node">
<title>stage7_expert2_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="111466,-949 111190,-949 111190,-897 111466,-897 111466,-949"/>
<text text-anchor="middle" x="111328" y="-937" font-family="Arial" font-size="10.00">Expert 2 MLP GELU (TP)</text>
<text text-anchor="middle" x="111328" y="-926" font-family="Arial" font-size="10.00">GPUs: 900,901</text>
<text text-anchor="middle" x="111328" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="111328" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage7_expert2_mlp2 -->
<g id="node947" class="node">
<title>stage7_expert2_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="111171.5,-949 110902.5,-949 110902.5,-897 111171.5,-897 111171.5,-949"/>
<text text-anchor="middle" x="111037" y="-937" font-family="Arial" font-size="10.00">Expert 2 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="111037" y="-926" font-family="Arial" font-size="10.00">GPUs: 900,901</text>
<text text-anchor="middle" x="111037" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="111037" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage7_expert3_qkv -->
<g id="node948" class="node">
<title>stage7_expert3_qkv</title>
<polygon fill="lightgreen" stroke="black" points="110884,-949 110598,-949 110598,-897 110884,-897 110884,-949"/>
<text text-anchor="middle" x="110741" y="-937" font-family="Arial" font-size="10.00">Expert 3 QKV Proj (TP)</text>
<text text-anchor="middle" x="110741" y="-926" font-family="Arial" font-size="10.00">GPUs: 902,903</text>
<text text-anchor="middle" x="110741" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="110741" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage7_expert3_attn -->
<g id="node949" class="node">
<title>stage7_expert3_attn</title>
<polygon fill="lightgreen" stroke="black" points="110580,-949 110294,-949 110294,-897 110580,-897 110580,-949"/>
<text text-anchor="middle" x="110437" y="-937" font-family="Arial" font-size="10.00">Expert 3 Attention (TP)</text>
<text text-anchor="middle" x="110437" y="-926" font-family="Arial" font-size="10.00">GPUs: 902,903</text>
<text text-anchor="middle" x="110437" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="110437" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
</g>
<!-- stage7_expert3_attn_out -->
<g id="node950" class="node">
<title>stage7_expert3_attn_out</title>
<polygon fill="lightgreen" stroke="black" points="110276,-949 109998,-949 109998,-897 110276,-897 110276,-949"/>
<text text-anchor="middle" x="110137" y="-937" font-family="Arial" font-size="10.00">Expert 3 Attn Output (TP)</text>
<text text-anchor="middle" x="110137" y="-926" font-family="Arial" font-size="10.00">GPUs: 902,903</text>
<text text-anchor="middle" x="110137" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, heads=32, d_k=128]</text>
<text text-anchor="middle" x="110137" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage7_expert3_mlp1 -->
<g id="node951" class="node">
<title>stage7_expert3_mlp1</title>
<polygon fill="lightcoral" stroke="black" points="109980,-949 109704,-949 109704,-897 109980,-897 109980,-949"/>
<text text-anchor="middle" x="109842" y="-937" font-family="Arial" font-size="10.00">Expert 3 MLP Layer1 (TP)</text>
<text text-anchor="middle" x="109842" y="-926" font-family="Arial" font-size="10.00">GPUs: 902,903</text>
<text text-anchor="middle" x="109842" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="109842" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage7_expert3_mlp_act -->
<g id="node952" class="node">
<title>stage7_expert3_mlp_act</title>
<polygon fill="lightcoral" stroke="black" points="109686,-949 109410,-949 109410,-897 109686,-897 109686,-949"/>
<text text-anchor="middle" x="109548" y="-937" font-family="Arial" font-size="10.00">Expert 3 MLP GELU (TP)</text>
<text text-anchor="middle" x="109548" y="-926" font-family="Arial" font-size="10.00">GPUs: 902,903</text>
<text text-anchor="middle" x="109548" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="109548" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
</g>
<!-- stage7_expert3_mlp2 -->
<g id="node953" class="node">
<title>stage7_expert3_mlp2</title>
<polygon fill="lightcoral" stroke="black" points="109391.5,-949 109122.5,-949 109122.5,-897 109391.5,-897 109391.5,-949"/>
<text text-anchor="middle" x="109257" y="-937" font-family="Arial" font-size="10.00">Expert 3 MLP Layer2 (TP)</text>
<text text-anchor="middle" x="109257" y="-926" font-family="Arial" font-size="10.00">GPUs: 902,903</text>
<text text-anchor="middle" x="109257" y="-915" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, ffn_hidden=16384]</text>
<text text-anchor="middle" x="109257" y="-904" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage7_experts_ellipsis -->
<g id="node954" class="node">
<title>stage7_experts_ellipsis</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="109104.5,-941 108923.5,-941 108923.5,-905 109104.5,-905 109104.5,-941"/>
<text text-anchor="middle" x="109014" y="-926" font-family="Arial" font-size="10.00">... (Experts 4&#45;63)</text>
<text text-anchor="middle" x="109014" y="-915" font-family="Arial" font-size="10.00">Similar operations on GPUs 904&#45;1023</text>
</g>
<!-- stage7_aggregate -->
<g id="node955" class="node">
<title>stage7_aggregate</title>
<polygon fill="lightyellow" stroke="black" points="114990.24,-120 114569.89,-120 114461.76,-16 114882.11,-16 114990.24,-120"/>
<text text-anchor="middle" x="114726" y="-82" font-family="Arial" font-size="10.00">Expert Output Aggregation</text>
<text text-anchor="middle" x="114726" y="-71" font-family="Arial" font-size="10.00">GPUs: 896&#45;1023</text>
<text text-anchor="middle" x="114726" y="-60" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="114726" y="-49" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=4096]</text>
</g>
<!-- stage7_layernorm1&#45;&gt;stage7_expert0_mlp1 -->
<g id="edge83" class="edge">
<title>stage7_layernorm1&#45;&gt;stage7_expert0_mlp1</title>
<path fill="none" stroke="black" d="M114726,-507.6C114726,-507.6 114726,-482.08 114726,-482.08"/>
<polygon fill="black" stroke="black" points="114729.5,-482.08 114726,-472.08 114722.5,-482.08 114729.5,-482.08"/>
</g>
<!-- stage7_layernorm2&#45;&gt;stage7_aggregate -->
<g id="edge87" class="edge">
<title>stage7_layernorm2&#45;&gt;stage7_aggregate</title>
<path fill="none" stroke="black" d="M114726,-155.85C114726,-155.85 114726,-130.1 114726,-130.1"/>
<polygon fill="black" stroke="black" points="114729.5,-130.1 114726,-120.1 114722.5,-130.1 114729.5,-130.1"/>
</g>
<!-- output -->
<g id="node958" class="node">
<title>output</title>
<ellipse fill="lightblue" stroke="black" cx="115213" cy="-68" rx="198.89" ry="28.98"/>
<text text-anchor="middle" x="115213" y="-76.5" font-family="Arial" font-size="10.00">Output Logits</text>
<text text-anchor="middle" x="115213" y="-65.5" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=4096]</text>
<text text-anchor="middle" x="115213" y="-54.5" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, vocab_size=32000]</text>
</g>
<!-- stage7_layernorm2&#45;&gt;output -->
<g id="edge88" class="edge">
<title>stage7_layernorm2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M114853.64,-182C114997.93,-182 115213,-182 115213,-182 115213,-182 115213,-107.06 115213,-107.06"/>
<polygon fill="black" stroke="black" points="115216.5,-107.06 115213,-97.06 115209.5,-107.06 115216.5,-107.06"/>
</g>
<!-- pipe_comm_1_2&#45;&gt;stage2_routing -->
<g id="edge23" class="edge">
<title>pipe_comm_1_2&#45;&gt;stage2_routing</title>
<path fill="none" stroke="black" d="M112420,-6199.79C112420,-6199.79 112420,-6156.04 112420,-6156.04"/>
<polygon fill="black" stroke="black" points="112423.5,-6156.04 112420,-6146.04 112416.5,-6156.04 112423.5,-6156.04"/>
</g>
</g>
</svg>
