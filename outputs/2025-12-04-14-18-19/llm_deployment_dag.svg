<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1440pt" height="1711pt"
 viewBox="0.00 0.00 1440.00 1711.20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.93 0.93) rotate(0) translate(4 1829.27)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1829.27 1538.73,-1829.27 1538.73,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightpink" stroke="black" cx="1183.73" cy="-1798.4" rx="185.94" ry="26.74"/>
<text text-anchor="middle" x="1183.73" y="-1806.2" font-family="Times,serif" font-size="9.00">Input</text>
<text text-anchor="middle" x="1183.73" y="-1796.2" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="1183.73" y="-1786.2" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- token_embedding -->
<g id="node2" class="node">
<title>token_embedding</title>
<polygon fill="lightblue" stroke="black" points="1315.23,-1735.53 1052.23,-1735.53 1052.23,-1687.53 1315.23,-1687.53 1315.23,-1735.53"/>
<text text-anchor="middle" x="1183.73" y="-1724.33" font-family="Times,serif" font-size="9.00">Token Embedding</text>
<text text-anchor="middle" x="1183.73" y="-1714.33" font-family="Times,serif" font-size="9.00">Vocab:32K→Hidden:1024</text>
<text text-anchor="middle" x="1183.73" y="-1704.33" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=1, d_k=1]</text>
<text text-anchor="middle" x="1183.73" y="-1694.33" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- input&#45;&gt;token_embedding -->
<g id="edge1" class="edge">
<title>input&#45;&gt;token_embedding</title>
<path fill="none" stroke="black" d="M1183.73,-1771.47C1183.73,-1763.36 1183.73,-1754.3 1183.73,-1745.76"/>
<polygon fill="black" stroke="black" points="1187.23,-1745.7 1183.73,-1735.7 1180.23,-1745.7 1187.23,-1745.7"/>
</g>
<!-- position_embedding -->
<g id="node3" class="node">
<title>position_embedding</title>
<polygon fill="lightblue" stroke="black" points="1315.23,-1651.53 1052.23,-1651.53 1052.23,-1603.53 1315.23,-1603.53 1315.23,-1651.53"/>
<text text-anchor="middle" x="1183.73" y="-1640.33" font-family="Times,serif" font-size="9.00">Position Embedding</text>
<text text-anchor="middle" x="1183.73" y="-1630.33" font-family="Times,serif" font-size="9.00">Seq:1024→Hidden:1024</text>
<text text-anchor="middle" x="1183.73" y="-1620.33" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="1183.73" y="-1610.33" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- token_embedding&#45;&gt;position_embedding -->
<g id="edge2" class="edge">
<title>token_embedding&#45;&gt;position_embedding</title>
<path fill="none" stroke="black" d="M1183.73,-1687.25C1183.73,-1679.31 1183.73,-1670.26 1183.73,-1661.69"/>
<polygon fill="black" stroke="black" points="1187.23,-1661.58 1183.73,-1651.58 1180.23,-1661.58 1187.23,-1661.58"/>
</g>
<!-- layer_norm_1 -->
<g id="node4" class="node">
<title>layer_norm_1</title>
<polygon fill="lightblue" stroke="black" points="1235.23,-1567.53 972.23,-1567.53 972.23,-1519.53 1235.23,-1519.53 1235.23,-1567.53"/>
<text text-anchor="middle" x="1103.73" y="-1556.33" font-family="Times,serif" font-size="9.00">Layer Norm</text>
<text text-anchor="middle" x="1103.73" y="-1546.33" font-family="Times,serif" font-size="9.00">Hidden:1024</text>
<text text-anchor="middle" x="1103.73" y="-1536.33" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="1103.73" y="-1526.33" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- position_embedding&#45;&gt;layer_norm_1 -->
<g id="edge3" class="edge">
<title>position_embedding&#45;&gt;layer_norm_1</title>
<path fill="none" stroke="black" d="M1161.02,-1603.25C1152.41,-1594.43 1142.49,-1584.26 1133.34,-1574.89"/>
<polygon fill="black" stroke="black" points="1135.71,-1572.3 1126.22,-1567.58 1130.7,-1577.18 1135.71,-1572.3"/>
</g>
<!-- residual_1 -->
<g id="node11" class="node">
<title>residual_1</title>
<polygon fill="lightblue" stroke="black" points="1371.23,-1127.65 1108.23,-1127.65 1108.23,-1079.65 1371.23,-1079.65 1371.23,-1127.65"/>
<text text-anchor="middle" x="1239.73" y="-1116.45" font-family="Times,serif" font-size="9.00">Residual Add</text>
<text text-anchor="middle" x="1239.73" y="-1106.45" font-family="Times,serif" font-size="9.00">Hidden:1024</text>
<text text-anchor="middle" x="1239.73" y="-1096.45" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="1239.73" y="-1086.45" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- position_embedding&#45;&gt;residual_1 -->
<g id="edge13" class="edge">
<title>position_embedding&#45;&gt;residual_1</title>
<path fill="none" stroke="black" d="M1260.98,-1603.45C1324.37,-1579.17 1403.73,-1534.09 1403.73,-1460.53 1403.73,-1460.53 1403.73,-1460.53 1403.73,-1290.53 1403.73,-1220.9 1338.23,-1165.04 1290.01,-1133.35"/>
<polygon fill="black" stroke="black" points="1291.84,-1130.37 1281.53,-1127.91 1288.06,-1136.26 1291.84,-1130.37"/>
</g>
<!-- q_projection -->
<g id="node5" class="node">
<title>q_projection</title>
<polygon fill="lightblue" stroke="black" points="813.23,-1483.53 550.23,-1483.53 550.23,-1435.53 813.23,-1435.53 813.23,-1483.53"/>
<text text-anchor="middle" x="681.73" y="-1472.33" font-family="Times,serif" font-size="9.00">Q Projection</text>
<text text-anchor="middle" x="681.73" y="-1462.33" font-family="Times,serif" font-size="9.00">TP: Hidden:1024→Heads:2×64</text>
<text text-anchor="middle" x="681.73" y="-1452.33" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="681.73" y="-1442.33" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=2, d_k=64]</text>
</g>
<!-- layer_norm_1&#45;&gt;q_projection -->
<g id="edge4" class="edge">
<title>layer_norm_1&#45;&gt;q_projection</title>
<path fill="none" stroke="black" d="M985.33,-1519.52C930.82,-1508.93 866.03,-1496.34 810.32,-1485.52"/>
<polygon fill="black" stroke="black" points="810.87,-1482.06 800.39,-1483.59 809.54,-1488.93 810.87,-1482.06"/>
</g>
<!-- k_projection -->
<g id="node6" class="node">
<title>k_projection</title>
<polygon fill="lightblue" stroke="black" points="1094.23,-1483.53 831.23,-1483.53 831.23,-1435.53 1094.23,-1435.53 1094.23,-1483.53"/>
<text text-anchor="middle" x="962.73" y="-1472.33" font-family="Times,serif" font-size="9.00">K Projection</text>
<text text-anchor="middle" x="962.73" y="-1462.33" font-family="Times,serif" font-size="9.00">TP: Hidden:1024→Heads:2×64</text>
<text text-anchor="middle" x="962.73" y="-1452.33" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="962.73" y="-1442.33" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=2, d_k=64]</text>
</g>
<!-- layer_norm_1&#45;&gt;k_projection -->
<g id="edge5" class="edge">
<title>layer_norm_1&#45;&gt;k_projection</title>
<path fill="none" stroke="black" d="M1064.07,-1519.47C1047.71,-1509.95 1028.57,-1498.82 1011.37,-1488.82"/>
<polygon fill="black" stroke="black" points="1012.97,-1485.7 1002.57,-1483.7 1009.45,-1491.75 1012.97,-1485.7"/>
</g>
<!-- v_projection -->
<g id="node7" class="node">
<title>v_projection</title>
<polygon fill="lightblue" stroke="black" points="1375.23,-1483.53 1112.23,-1483.53 1112.23,-1435.53 1375.23,-1435.53 1375.23,-1483.53"/>
<text text-anchor="middle" x="1243.73" y="-1472.33" font-family="Times,serif" font-size="9.00">V Projection</text>
<text text-anchor="middle" x="1243.73" y="-1462.33" font-family="Times,serif" font-size="9.00">TP: Hidden:1024→Heads:2×64</text>
<text text-anchor="middle" x="1243.73" y="-1452.33" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="1243.73" y="-1442.33" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=2, d_k=64]</text>
</g>
<!-- layer_norm_1&#45;&gt;v_projection -->
<g id="edge6" class="edge">
<title>layer_norm_1&#45;&gt;v_projection</title>
<path fill="none" stroke="black" d="M1143.1,-1519.47C1159.35,-1509.95 1178.35,-1498.82 1195.43,-1488.82"/>
<polygon fill="black" stroke="black" points="1197.31,-1491.77 1204.17,-1483.7 1193.77,-1485.73 1197.31,-1491.77"/>
</g>
<!-- attention -->
<g id="node8" class="node">
<title>attention</title>
<polygon fill="lightblue" stroke="black" points="1119.23,-1399.53 862.23,-1399.53 862.23,-1351.53 1119.23,-1351.53 1119.23,-1399.53"/>
<text text-anchor="middle" x="990.73" y="-1388.33" font-family="Times,serif" font-size="9.00">Attention</text>
<text text-anchor="middle" x="990.73" y="-1378.33" font-family="Times,serif" font-size="9.00">QK^T V: Softmax</text>
<text text-anchor="middle" x="990.73" y="-1368.33" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=2, d_k=64]</text>
<text text-anchor="middle" x="990.73" y="-1358.33" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=2, d_k=64]</text>
</g>
<!-- q_projection&#45;&gt;attention -->
<g id="edge7" class="edge">
<title>q_projection&#45;&gt;attention</title>
<path fill="none" stroke="black" d="M768.62,-1435.47C807.71,-1425.1 853.98,-1412.82 894.14,-1402.16"/>
<polygon fill="black" stroke="black" points="895.18,-1405.51 903.95,-1399.56 893.38,-1398.74 895.18,-1405.51"/>
</g>
<!-- k_projection&#45;&gt;attention -->
<g id="edge8" class="edge">
<title>k_projection&#45;&gt;attention</title>
<path fill="none" stroke="black" d="M970.68,-1435.25C973.45,-1427.13 976.61,-1417.86 979.59,-1409.13"/>
<polygon fill="black" stroke="black" points="982.94,-1410.18 982.85,-1399.58 976.31,-1407.91 982.94,-1410.18"/>
</g>
<!-- v_projection&#45;&gt;attention -->
<g id="edge9" class="edge">
<title>v_projection&#45;&gt;attention</title>
<path fill="none" stroke="black" d="M1172.58,-1435.47C1141.19,-1425.29 1104.13,-1413.28 1071.69,-1402.77"/>
<polygon fill="black" stroke="black" points="1072.37,-1399.31 1061.78,-1399.56 1070.21,-1405.97 1072.37,-1399.31"/>
</g>
<!-- attention_output -->
<g id="node9" class="node">
<title>attention_output</title>
<polygon fill="lightblue" stroke="black" points="1151.23,-1315.53 888.23,-1315.53 888.23,-1267.53 1151.23,-1267.53 1151.23,-1315.53"/>
<text text-anchor="middle" x="1019.73" y="-1304.33" font-family="Times,serif" font-size="9.00">Attention Output</text>
<text text-anchor="middle" x="1019.73" y="-1294.33" font-family="Times,serif" font-size="9.00">TP: Heads:2×64→Hidden:1024</text>
<text text-anchor="middle" x="1019.73" y="-1284.33" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=2, d_k=64]</text>
<text text-anchor="middle" x="1019.73" y="-1274.33" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- attention&#45;&gt;attention_output -->
<g id="edge10" class="edge">
<title>attention&#45;&gt;attention_output</title>
<path fill="none" stroke="black" d="M998.96,-1351.25C1001.83,-1343.13 1005.11,-1333.86 1008.2,-1325.13"/>
<polygon fill="black" stroke="black" points="1011.54,-1326.18 1011.57,-1315.58 1004.94,-1323.84 1011.54,-1326.18"/>
</g>
<!-- attention_allreduce -->
<g id="node10" class="node">
<title>attention_allreduce</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1132.73" cy="-1197.59" rx="185.94" ry="33.88"/>
<text text-anchor="middle" x="1132.73" y="-1210.39" font-family="Times,serif" font-size="9.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1132.73" y="-1200.39" font-family="Times,serif" font-size="9.00">Attention Output</text>
<text text-anchor="middle" x="1132.73" y="-1190.39" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="1132.73" y="-1180.39" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- attention_output&#45;&gt;attention_allreduce -->
<g id="edge11" class="edge">
<title>attention_output&#45;&gt;attention_allreduce</title>
<path fill="none" stroke="black" d="M1048.24,-1267.33C1059.4,-1258.25 1072.5,-1247.59 1085.01,-1237.41"/>
<polygon fill="black" stroke="black" points="1087.58,-1239.84 1093.13,-1230.81 1083.16,-1234.41 1087.58,-1239.84"/>
</g>
<!-- attention_allreduce&#45;&gt;residual_1 -->
<g id="edge12" class="edge">
<title>attention_allreduce&#45;&gt;residual_1</title>
<path fill="none" stroke="black" d="M1170.45,-1164.17C1181.68,-1154.52 1193.93,-1143.99 1204.97,-1134.51"/>
<polygon fill="black" stroke="black" points="1207.45,-1136.99 1212.76,-1127.82 1202.89,-1131.68 1207.45,-1136.99"/>
</g>
<!-- layer_norm_2 -->
<g id="node12" class="node">
<title>layer_norm_2</title>
<polygon fill="lightblue" stroke="black" points="1291.23,-1043.65 1028.23,-1043.65 1028.23,-995.65 1291.23,-995.65 1291.23,-1043.65"/>
<text text-anchor="middle" x="1159.73" y="-1032.45" font-family="Times,serif" font-size="9.00">Layer Norm</text>
<text text-anchor="middle" x="1159.73" y="-1022.45" font-family="Times,serif" font-size="9.00">Hidden:1024</text>
<text text-anchor="middle" x="1159.73" y="-1012.45" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="1159.73" y="-1002.45" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- residual_1&#45;&gt;layer_norm_2 -->
<g id="edge14" class="edge">
<title>residual_1&#45;&gt;layer_norm_2</title>
<path fill="none" stroke="black" d="M1217.02,-1079.37C1208.41,-1070.55 1198.49,-1060.38 1189.34,-1051.01"/>
<polygon fill="black" stroke="black" points="1191.71,-1048.41 1182.22,-1043.7 1186.7,-1053.3 1191.71,-1048.41"/>
</g>
<!-- residual_2 -->
<g id="node25" class="node">
<title>residual_2</title>
<polygon fill="lightblue" stroke="black" points="1465.23,-319.88 1202.23,-319.88 1202.23,-271.88 1465.23,-271.88 1465.23,-319.88"/>
<text text-anchor="middle" x="1333.73" y="-308.68" font-family="Times,serif" font-size="9.00">Residual Add</text>
<text text-anchor="middle" x="1333.73" y="-298.68" font-family="Times,serif" font-size="9.00">Hidden:1024</text>
<text text-anchor="middle" x="1333.73" y="-288.68" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="1333.73" y="-278.68" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- residual_1&#45;&gt;residual_2 -->
<g id="edge31" class="edge">
<title>residual_1&#45;&gt;residual_2</title>
<path fill="none" stroke="black" d="M1347.48,-1079.53C1431.75,-1054.37 1534.73,-1004.79 1534.73,-912.65 1534.73,-912.65 1534.73,-912.65 1534.73,-482.76 1534.73,-407.53 1457.89,-354.27 1399.23,-324.57"/>
<polygon fill="black" stroke="black" points="1400.5,-321.3 1389.98,-320.01 1397.4,-327.57 1400.5,-321.3"/>
</g>
<!-- expert_router -->
<g id="node13" class="node">
<title>expert_router</title>
<polygon fill="lightgreen" stroke="black" points="1216.56,-959.65 782.54,-959.65 670.89,-863.65 1104.91,-863.65 1216.56,-959.65"/>
<text text-anchor="middle" x="943.73" y="-924.45" font-family="Times,serif" font-size="9.00">Expert Router</text>
<text text-anchor="middle" x="943.73" y="-914.45" font-family="Times,serif" font-size="9.00">Top&#45;K:2 Selection</text>
<text text-anchor="middle" x="943.73" y="-904.45" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="943.73" y="-894.45" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- layer_norm_2&#45;&gt;expert_router -->
<g id="edge15" class="edge">
<title>layer_norm_2&#45;&gt;expert_router</title>
<path fill="none" stroke="black" d="M1112.86,-995.65C1093.99,-986.39 1071.41,-975.31 1049,-964.31"/>
<polygon fill="black" stroke="black" points="1050.27,-961.03 1039.75,-959.77 1047.18,-967.32 1050.27,-961.03"/>
</g>
<!-- expert_0 -->
<g id="node14" class="node">
<title>expert_0</title>
<polygon fill="lightblue" stroke="black" points="416.23,-827.65 159.23,-827.65 159.23,-779.65 416.23,-779.65 416.23,-827.65"/>
<text text-anchor="middle" x="287.73" y="-816.45" font-family="Times,serif" font-size="9.00">Expert 0</text>
<text text-anchor="middle" x="287.73" y="-806.45" font-family="Times,serif" font-size="9.00">MLP: 1024→2048→1024</text>
<text text-anchor="middle" x="287.73" y="-796.45" font-family="Times,serif" font-size="9.00">[batch_size=32, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="287.73" y="-786.45" font-family="Times,serif" font-size="9.00">[batch_size=32, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- expert_router&#45;&gt;expert_0 -->
<g id="edge16" class="edge">
<title>expert_router&#45;&gt;expert_0</title>
<path fill="none" stroke="black" d="M675.01,-867.23C589.68,-853.44 498.82,-838.76 426.56,-827.08"/>
<polygon fill="black" stroke="black" points="426.92,-823.59 416.49,-825.45 425.8,-830.5 426.92,-823.59"/>
</g>
<!-- expert_1 -->
<g id="node16" class="node">
<title>expert_1</title>
<polygon fill="lightblue" stroke="black" points="744.23,-827.65 487.23,-827.65 487.23,-779.65 744.23,-779.65 744.23,-827.65"/>
<text text-anchor="middle" x="615.73" y="-816.45" font-family="Times,serif" font-size="9.00">Expert 1</text>
<text text-anchor="middle" x="615.73" y="-806.45" font-family="Times,serif" font-size="9.00">MLP: 1024→2048→1024</text>
<text text-anchor="middle" x="615.73" y="-796.45" font-family="Times,serif" font-size="9.00">[batch_size=32, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="615.73" y="-786.45" font-family="Times,serif" font-size="9.00">[batch_size=32, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- expert_router&#45;&gt;expert_1 -->
<g id="edge18" class="edge">
<title>expert_router&#45;&gt;expert_1</title>
<path fill="none" stroke="black" d="M797.95,-863.54C763.21,-852.31 727.37,-840.73 696.76,-830.84"/>
<polygon fill="black" stroke="black" points="697.61,-827.43 687.02,-827.69 695.46,-834.09 697.61,-827.43"/>
</g>
<!-- expert_2 -->
<g id="node18" class="node">
<title>expert_2</title>
<polygon fill="lightblue" stroke="black" points="1072.23,-827.65 815.23,-827.65 815.23,-779.65 1072.23,-779.65 1072.23,-827.65"/>
<text text-anchor="middle" x="943.73" y="-816.45" font-family="Times,serif" font-size="9.00">Expert 2</text>
<text text-anchor="middle" x="943.73" y="-806.45" font-family="Times,serif" font-size="9.00">MLP: 1024→2048→1024</text>
<text text-anchor="middle" x="943.73" y="-796.45" font-family="Times,serif" font-size="9.00">[batch_size=32, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="943.73" y="-786.45" font-family="Times,serif" font-size="9.00">[batch_size=32, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- expert_router&#45;&gt;expert_2 -->
<g id="edge20" class="edge">
<title>expert_router&#45;&gt;expert_2</title>
<path fill="none" stroke="black" d="M943.73,-863.54C943.73,-854.92 943.73,-846.1 943.73,-838"/>
<polygon fill="black" stroke="black" points="947.23,-837.83 943.73,-827.83 940.23,-837.83 947.23,-837.83"/>
</g>
<!-- expert_3 -->
<g id="node20" class="node">
<title>expert_3</title>
<polygon fill="lightblue" stroke="black" points="1400.23,-827.65 1143.23,-827.65 1143.23,-779.65 1400.23,-779.65 1400.23,-827.65"/>
<text text-anchor="middle" x="1271.73" y="-816.45" font-family="Times,serif" font-size="9.00">Expert 3</text>
<text text-anchor="middle" x="1271.73" y="-806.45" font-family="Times,serif" font-size="9.00">MLP: 1024→2048→1024</text>
<text text-anchor="middle" x="1271.73" y="-796.45" font-family="Times,serif" font-size="9.00">[batch_size=32, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="1271.73" y="-786.45" font-family="Times,serif" font-size="9.00">[batch_size=32, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- expert_router&#45;&gt;expert_3 -->
<g id="edge22" class="edge">
<title>expert_router&#45;&gt;expert_3</title>
<path fill="none" stroke="black" d="M1089.5,-863.54C1124.24,-852.31 1160.08,-840.73 1190.69,-830.84"/>
<polygon fill="black" stroke="black" points="1191.99,-834.09 1200.43,-827.69 1189.84,-827.43 1191.99,-834.09"/>
</g>
<!-- expert_all2all_0 -->
<g id="node15" class="node">
<title>expert_all2all_0</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="181.73" cy="-709.71" rx="181.95" ry="33.88"/>
<text text-anchor="middle" x="181.73" y="-722.51" font-family="Times,serif" font-size="9.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="181.73" y="-712.51" font-family="Times,serif" font-size="9.00">Expert 0</text>
<text text-anchor="middle" x="181.73" y="-702.51" font-family="Times,serif" font-size="9.00">[batch_size=32, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="181.73" y="-692.51" font-family="Times,serif" font-size="9.00">[batch_size=32, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- expert_0&#45;&gt;expert_all2all_0 -->
<g id="edge17" class="edge">
<title>expert_0&#45;&gt;expert_all2all_0</title>
<path fill="none" stroke="black" d="M260.98,-779.45C250.71,-770.54 238.69,-760.11 227.16,-750.11"/>
<polygon fill="black" stroke="black" points="229.12,-747.18 219.28,-743.27 224.54,-752.47 229.12,-747.18"/>
</g>
<!-- expert_aggregation -->
<g id="node22" class="node">
<title>expert_aggregation</title>
<polygon fill="lightgreen" stroke="black" points="1216.56,-639.76 782.54,-639.76 670.89,-543.76 1104.91,-543.76 1216.56,-639.76"/>
<text text-anchor="middle" x="943.73" y="-604.56" font-family="Times,serif" font-size="9.00">Expert Aggregation</text>
<text text-anchor="middle" x="943.73" y="-594.56" font-family="Times,serif" font-size="9.00">Weighted Sum</text>
<text text-anchor="middle" x="943.73" y="-584.56" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="943.73" y="-574.56" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- expert_all2all_0&#45;&gt;expert_aggregation -->
<g id="edge24" class="edge">
<title>expert_all2all_0&#45;&gt;expert_aggregation</title>
<path fill="none" stroke="black" d="M310.94,-685.81C331.26,-682.35 352.05,-678.9 371.73,-675.76 496.66,-655.87 637.26,-635.45 747.8,-619.83"/>
<polygon fill="black" stroke="black" points="748.32,-623.29 757.73,-618.43 747.34,-616.36 748.32,-623.29"/>
</g>
<!-- expert_all2all_1 -->
<g id="node17" class="node">
<title>expert_all2all_1</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="562.73" cy="-709.71" rx="181.95" ry="33.88"/>
<text text-anchor="middle" x="562.73" y="-722.51" font-family="Times,serif" font-size="9.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="562.73" y="-712.51" font-family="Times,serif" font-size="9.00">Expert 1</text>
<text text-anchor="middle" x="562.73" y="-702.51" font-family="Times,serif" font-size="9.00">[batch_size=32, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="562.73" y="-692.51" font-family="Times,serif" font-size="9.00">[batch_size=32, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- expert_1&#45;&gt;expert_all2all_1 -->
<g id="edge19" class="edge">
<title>expert_1&#45;&gt;expert_all2all_1</title>
<path fill="none" stroke="black" d="M602.35,-779.45C597.61,-771.22 592.12,-761.7 586.77,-752.41"/>
<polygon fill="black" stroke="black" points="589.73,-750.54 581.7,-743.62 583.66,-754.03 589.73,-750.54"/>
</g>
<!-- expert_all2all_1&#45;&gt;expert_aggregation -->
<g id="edge25" class="edge">
<title>expert_all2all_1&#45;&gt;expert_aggregation</title>
<path fill="none" stroke="black" d="M655.44,-680.49C692.81,-669.12 737.08,-655.65 779.56,-642.72"/>
<polygon fill="black" stroke="black" points="780.61,-646.06 789.16,-639.8 778.57,-639.36 780.61,-646.06"/>
</g>
<!-- expert_all2all_2 -->
<g id="node19" class="node">
<title>expert_all2all_2</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="943.73" cy="-709.71" rx="181.95" ry="33.88"/>
<text text-anchor="middle" x="943.73" y="-722.51" font-family="Times,serif" font-size="9.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="943.73" y="-712.51" font-family="Times,serif" font-size="9.00">Expert 2</text>
<text text-anchor="middle" x="943.73" y="-702.51" font-family="Times,serif" font-size="9.00">[batch_size=32, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="943.73" y="-692.51" font-family="Times,serif" font-size="9.00">[batch_size=32, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- expert_2&#45;&gt;expert_all2all_2 -->
<g id="edge21" class="edge">
<title>expert_2&#45;&gt;expert_all2all_2</title>
<path fill="none" stroke="black" d="M943.73,-779.45C943.73,-771.72 943.73,-762.85 943.73,-754.11"/>
<polygon fill="black" stroke="black" points="947.23,-753.97 943.73,-743.97 940.23,-753.97 947.23,-753.97"/>
</g>
<!-- expert_all2all_2&#45;&gt;expert_aggregation -->
<g id="edge26" class="edge">
<title>expert_all2all_2&#45;&gt;expert_aggregation</title>
<path fill="none" stroke="black" d="M943.73,-675.48C943.73,-667.5 943.73,-658.74 943.73,-650.01"/>
<polygon fill="black" stroke="black" points="947.23,-649.82 943.73,-639.82 940.23,-649.82 947.23,-649.82"/>
</g>
<!-- expert_all2all_3 -->
<g id="node21" class="node">
<title>expert_all2all_3</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1324.73" cy="-709.71" rx="181.95" ry="33.88"/>
<text text-anchor="middle" x="1324.73" y="-722.51" font-family="Times,serif" font-size="9.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="1324.73" y="-712.51" font-family="Times,serif" font-size="9.00">Expert 3</text>
<text text-anchor="middle" x="1324.73" y="-702.51" font-family="Times,serif" font-size="9.00">[batch_size=32, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="1324.73" y="-692.51" font-family="Times,serif" font-size="9.00">[batch_size=32, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- expert_3&#45;&gt;expert_all2all_3 -->
<g id="edge23" class="edge">
<title>expert_3&#45;&gt;expert_all2all_3</title>
<path fill="none" stroke="black" d="M1285.1,-779.45C1289.84,-771.22 1295.33,-761.7 1300.69,-752.41"/>
<polygon fill="black" stroke="black" points="1303.79,-754.03 1305.75,-743.62 1297.72,-750.54 1303.79,-754.03"/>
</g>
<!-- expert_all2all_3&#45;&gt;expert_aggregation -->
<g id="edge27" class="edge">
<title>expert_all2all_3&#45;&gt;expert_aggregation</title>
<path fill="none" stroke="black" d="M1232.01,-680.49C1194.64,-669.12 1150.38,-655.65 1107.9,-642.72"/>
<polygon fill="black" stroke="black" points="1108.88,-639.36 1098.29,-639.8 1106.84,-646.06 1108.88,-639.36"/>
</g>
<!-- mlp_output -->
<g id="node23" class="node">
<title>mlp_output</title>
<polygon fill="lightblue" stroke="black" points="1170.23,-507.76 907.23,-507.76 907.23,-459.76 1170.23,-459.76 1170.23,-507.76"/>
<text text-anchor="middle" x="1038.73" y="-496.56" font-family="Times,serif" font-size="9.00">MLP Output</text>
<text text-anchor="middle" x="1038.73" y="-486.56" font-family="Times,serif" font-size="9.00">TP: Hidden:1024→Hidden:1024</text>
<text text-anchor="middle" x="1038.73" y="-476.56" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="1038.73" y="-466.56" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- expert_aggregation&#45;&gt;mlp_output -->
<g id="edge28" class="edge">
<title>expert_aggregation&#45;&gt;mlp_output</title>
<path fill="none" stroke="black" d="M985.95,-543.65C994.53,-534.07 1003.35,-524.24 1011.26,-515.41"/>
<polygon fill="black" stroke="black" points="1013.88,-517.73 1017.95,-507.94 1008.67,-513.06 1013.88,-517.73"/>
</g>
<!-- mlp_allreduce -->
<g id="node24" class="node">
<title>mlp_allreduce</title>
<ellipse fill="none" stroke="black" stroke-dasharray="5,2" cx="1226.73" cy="-389.82" rx="185.94" ry="33.88"/>
<text text-anchor="middle" x="1226.73" y="-402.62" font-family="Times,serif" font-size="9.00">All&#45;Reduce</text>
<text text-anchor="middle" x="1226.73" y="-392.62" font-family="Times,serif" font-size="9.00">MLP Output</text>
<text text-anchor="middle" x="1226.73" y="-382.62" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="1226.73" y="-372.62" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- mlp_output&#45;&gt;mlp_allreduce -->
<g id="edge29" class="edge">
<title>mlp_output&#45;&gt;mlp_allreduce</title>
<path fill="none" stroke="black" d="M1086.17,-459.56C1106.81,-449.47 1131.47,-437.41 1154.32,-426.23"/>
<polygon fill="black" stroke="black" points="1155.87,-429.37 1163.32,-421.83 1152.79,-423.08 1155.87,-429.37"/>
</g>
<!-- mlp_allreduce&#45;&gt;residual_2 -->
<g id="edge30" class="edge">
<title>mlp_allreduce&#45;&gt;residual_2</title>
<path fill="none" stroke="black" d="M1264.45,-356.41C1275.68,-346.76 1287.93,-336.23 1298.97,-326.75"/>
<polygon fill="black" stroke="black" points="1301.45,-329.23 1306.76,-320.06 1296.89,-323.92 1301.45,-329.23"/>
</g>
<!-- final_layer_norm -->
<g id="node26" class="node">
<title>final_layer_norm</title>
<polygon fill="lightblue" stroke="black" points="1465.23,-235.88 1202.23,-235.88 1202.23,-187.88 1465.23,-187.88 1465.23,-235.88"/>
<text text-anchor="middle" x="1333.73" y="-224.68" font-family="Times,serif" font-size="9.00">Final Layer Norm</text>
<text text-anchor="middle" x="1333.73" y="-214.68" font-family="Times,serif" font-size="9.00">Hidden:1024</text>
<text text-anchor="middle" x="1333.73" y="-204.68" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="1333.73" y="-194.68" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
</g>
<!-- residual_2&#45;&gt;final_layer_norm -->
<g id="edge32" class="edge">
<title>residual_2&#45;&gt;final_layer_norm</title>
<path fill="none" stroke="black" d="M1333.73,-271.6C1333.73,-263.66 1333.73,-254.62 1333.73,-246.05"/>
<polygon fill="black" stroke="black" points="1337.23,-245.94 1333.73,-235.94 1330.23,-245.94 1337.23,-245.94"/>
</g>
<!-- output_projection -->
<g id="node27" class="node">
<title>output_projection</title>
<polygon fill="lightblue" stroke="black" points="1471.23,-151.88 1196.23,-151.88 1196.23,-103.88 1471.23,-103.88 1471.23,-151.88"/>
<text text-anchor="middle" x="1333.73" y="-140.68" font-family="Times,serif" font-size="9.00">Output Projection</text>
<text text-anchor="middle" x="1333.73" y="-130.68" font-family="Times,serif" font-size="9.00">Hidden:1024→Vocab:32K</text>
<text text-anchor="middle" x="1333.73" y="-120.68" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=16, d_k=64]</text>
<text text-anchor="middle" x="1333.73" y="-110.68" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=1, d_k=32000]</text>
</g>
<!-- final_layer_norm&#45;&gt;output_projection -->
<g id="edge33" class="edge">
<title>final_layer_norm&#45;&gt;output_projection</title>
<path fill="none" stroke="black" d="M1333.73,-187.6C1333.73,-179.66 1333.73,-170.62 1333.73,-162.05"/>
<polygon fill="black" stroke="black" points="1337.23,-161.94 1333.73,-151.94 1330.23,-161.94 1337.23,-161.94"/>
</g>
<!-- output -->
<g id="node28" class="node">
<title>output</title>
<ellipse fill="orange" stroke="black" cx="1333.73" cy="-33.94" rx="194.41" ry="33.88"/>
<text text-anchor="middle" x="1333.73" y="-46.74" font-family="Times,serif" font-size="9.00">Output</text>
<text text-anchor="middle" x="1333.73" y="-36.74" font-family="Times,serif" font-size="9.00">Logits:32K</text>
<text text-anchor="middle" x="1333.73" y="-26.74" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=1, d_k=32000]</text>
<text text-anchor="middle" x="1333.73" y="-16.74" font-family="Times,serif" font-size="9.00">[batch_size=128, seq_len=1024, heads=1, d_k=32000]</text>
</g>
<!-- output_projection&#45;&gt;output -->
<g id="edge34" class="edge">
<title>output_projection&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1333.73,-103.68C1333.73,-95.96 1333.73,-87.09 1333.73,-78.34"/>
<polygon fill="black" stroke="black" points="1337.23,-78.21 1333.73,-68.21 1330.23,-78.21 1337.23,-78.21"/>
</g>
</g>
</svg>
