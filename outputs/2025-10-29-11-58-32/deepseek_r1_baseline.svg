<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: DeepSeek_R1_TP_Baseline Pages: 1 -->
<svg width="1080pt" height="575pt"
 viewBox="0.00 0.00 1080.00 574.98" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.53 0.53) rotate(0) translate(4 1081)">
<title>DeepSeek_R1_TP_Baseline</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1081 2034,-1081 2034,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_attention</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="219,-586 219,-1011 1801,-1011 1801,-586 219,-586"/>
<text text-anchor="middle" x="1010" y="-995.8" font-family="Times,serif" font-size="14.00">Attention Phase (TP=8)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_ffn</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="8,-86 8,-578 2022,-578 2022,-86 8,-86"/>
<text text-anchor="middle" x="1015" y="-562.8" font-family="Times,serif" font-size="14.00">FFN Phase (TP=8Ã—EP=1)</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightblue" stroke="black" cx="1010" cy="-1048" rx="170.02" ry="29"/>
<text text-anchor="middle" x="1010" y="-1051" font-family="Times,serif" font-size="10.00">Input</text>
<text text-anchor="middle" x="1010" y="-1040" font-family="Times,serif" font-size="10.00">Input: [batch_size=B, seq_len=1, hidden_dim=16384]</text>
</g>
<!-- qkv_0 -->
<g id="node2" class="node">
<title>qkv_0</title>
<polygon fill="lightyellow" stroke="black" points="1793,-980 1613,-980 1613,-922 1793,-922 1793,-980"/>
<text text-anchor="middle" x="1703" y="-965" font-family="Times,serif" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="1703" y="-954" font-family="Times,serif" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1703" y="-943" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16384]</text>
<text text-anchor="middle" x="1703" y="-932" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16, 128]</text>
</g>
<!-- input&#45;&gt;qkv_0 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;qkv_0</title>
<path fill="none" stroke="black" d="M1179.76,-1045.6C1326.84,-1042.77 1527.67,-1034.53 1604,-1011 1622.39,-1005.33 1640.94,-995.59 1656.93,-985.64"/>
<polygon fill="black" stroke="black" points="1659.01,-988.47 1665.53,-980.12 1655.23,-982.58 1659.01,-988.47"/>
</g>
<!-- qkv_1 -->
<g id="node3" class="node">
<title>qkv_1</title>
<polygon fill="lightyellow" stroke="black" points="1595,-980 1415,-980 1415,-922 1595,-922 1595,-980"/>
<text text-anchor="middle" x="1505" y="-965" font-family="Times,serif" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="1505" y="-954" font-family="Times,serif" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1505" y="-943" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16384]</text>
<text text-anchor="middle" x="1505" y="-932" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16, 128]</text>
</g>
<!-- input&#45;&gt;qkv_1 -->
<g id="edge9" class="edge">
<title>input&#45;&gt;qkv_1</title>
<path fill="none" stroke="black" d="M1172.6,-1039.48C1262.07,-1033.91 1363.36,-1024.85 1406,-1011 1424.14,-1005.11 1442.5,-995.42 1458.4,-985.58"/>
<polygon fill="black" stroke="black" points="1460.42,-988.45 1466.97,-980.12 1456.65,-982.55 1460.42,-988.45"/>
</g>
<!-- qkv_2 -->
<g id="node4" class="node">
<title>qkv_2</title>
<polygon fill="lightyellow" stroke="black" points="1397,-980 1217,-980 1217,-922 1397,-922 1397,-980"/>
<text text-anchor="middle" x="1307" y="-965" font-family="Times,serif" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="1307" y="-954" font-family="Times,serif" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="1307" y="-943" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16384]</text>
<text text-anchor="middle" x="1307" y="-932" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16, 128]</text>
</g>
<!-- input&#45;&gt;qkv_2 -->
<g id="edge17" class="edge">
<title>input&#45;&gt;qkv_2</title>
<path fill="none" stroke="black" d="M1142.26,-1029.76C1164.57,-1024.93 1187.23,-1018.79 1208,-1011 1225.23,-1004.54 1242.85,-995.11 1258.37,-985.68"/>
<polygon fill="black" stroke="black" points="1260.6,-988.41 1267.24,-980.14 1256.9,-982.47 1260.6,-988.41"/>
</g>
<!-- qkv_3 -->
<g id="node5" class="node">
<title>qkv_3</title>
<polygon fill="lightyellow" stroke="black" points="1199,-980 1019,-980 1019,-922 1199,-922 1199,-980"/>
<text text-anchor="middle" x="1109" y="-965" font-family="Times,serif" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="1109" y="-954" font-family="Times,serif" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1109" y="-943" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16384]</text>
<text text-anchor="middle" x="1109" y="-932" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16, 128]</text>
</g>
<!-- input&#45;&gt;qkv_3 -->
<g id="edge25" class="edge">
<title>input&#45;&gt;qkv_3</title>
<path fill="none" stroke="black" d="M1038.9,-1019.27C1049.29,-1009.3 1061.15,-997.92 1072.12,-987.39"/>
<polygon fill="black" stroke="black" points="1074.76,-989.71 1079.55,-980.26 1069.91,-984.66 1074.76,-989.71"/>
</g>
<!-- qkv_4 -->
<g id="node6" class="node">
<title>qkv_4</title>
<polygon fill="lightyellow" stroke="black" points="1001,-980 821,-980 821,-922 1001,-922 1001,-980"/>
<text text-anchor="middle" x="911" y="-965" font-family="Times,serif" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="911" y="-954" font-family="Times,serif" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="911" y="-943" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16384]</text>
<text text-anchor="middle" x="911" y="-932" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16, 128]</text>
</g>
<!-- input&#45;&gt;qkv_4 -->
<g id="edge33" class="edge">
<title>input&#45;&gt;qkv_4</title>
<path fill="none" stroke="black" d="M981.1,-1019.27C970.71,-1009.3 958.85,-997.92 947.88,-987.39"/>
<polygon fill="black" stroke="black" points="950.09,-984.66 940.45,-980.26 945.24,-989.71 950.09,-984.66"/>
</g>
<!-- qkv_5 -->
<g id="node7" class="node">
<title>qkv_5</title>
<polygon fill="lightyellow" stroke="black" points="803,-980 623,-980 623,-922 803,-922 803,-980"/>
<text text-anchor="middle" x="713" y="-965" font-family="Times,serif" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="713" y="-954" font-family="Times,serif" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="713" y="-943" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16384]</text>
<text text-anchor="middle" x="713" y="-932" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16, 128]</text>
</g>
<!-- input&#45;&gt;qkv_5 -->
<g id="edge41" class="edge">
<title>input&#45;&gt;qkv_5</title>
<path fill="none" stroke="black" d="M877.74,-1029.76C855.43,-1024.93 832.77,-1018.79 812,-1011 794.77,-1004.54 777.15,-995.11 761.63,-985.68"/>
<polygon fill="black" stroke="black" points="763.1,-982.47 752.76,-980.14 759.4,-988.41 763.1,-982.47"/>
</g>
<!-- qkv_6 -->
<g id="node8" class="node">
<title>qkv_6</title>
<polygon fill="lightyellow" stroke="black" points="605,-980 425,-980 425,-922 605,-922 605,-980"/>
<text text-anchor="middle" x="515" y="-965" font-family="Times,serif" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="515" y="-954" font-family="Times,serif" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="515" y="-943" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16384]</text>
<text text-anchor="middle" x="515" y="-932" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16, 128]</text>
</g>
<!-- input&#45;&gt;qkv_6 -->
<g id="edge49" class="edge">
<title>input&#45;&gt;qkv_6</title>
<path fill="none" stroke="black" d="M847.4,-1039.48C757.93,-1033.91 656.64,-1024.85 614,-1011 595.86,-1005.11 577.5,-995.42 561.6,-985.58"/>
<polygon fill="black" stroke="black" points="563.35,-982.55 553.03,-980.12 559.58,-988.45 563.35,-982.55"/>
</g>
<!-- qkv_7 -->
<g id="node9" class="node">
<title>qkv_7</title>
<polygon fill="lightyellow" stroke="black" points="407,-980 227,-980 227,-922 407,-922 407,-980"/>
<text text-anchor="middle" x="317" y="-965" font-family="Times,serif" font-size="10.00">QKV Projection</text>
<text text-anchor="middle" x="317" y="-954" font-family="Times,serif" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="317" y="-943" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16384]</text>
<text text-anchor="middle" x="317" y="-932" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16, 128]</text>
</g>
<!-- input&#45;&gt;qkv_7 -->
<g id="edge57" class="edge">
<title>input&#45;&gt;qkv_7</title>
<path fill="none" stroke="black" d="M840.24,-1045.6C693.16,-1042.77 492.33,-1034.53 416,-1011 397.61,-1005.33 379.06,-995.59 363.07,-985.64"/>
<polygon fill="black" stroke="black" points="364.77,-982.58 354.47,-980.12 360.99,-988.47 364.77,-982.58"/>
</g>
<!-- kv_cache_0 -->
<g id="node10" class="node">
<title>kv_cache_0</title>
<polygon fill="lightgray" stroke="black" points="1793,-886 1613,-886 1613,-828 1793,-828 1793,-886"/>
<text text-anchor="middle" x="1703" y="-871" font-family="Times,serif" font-size="10.00">KV Cache</text>
<text text-anchor="middle" x="1703" y="-860" font-family="Times,serif" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1703" y="-849" font-family="Times,serif" font-size="10.00">Full cache: [B, S, 8, 128]</text>
<text text-anchor="middle" x="1703" y="-838" font-family="Times,serif" font-size="10.00">(duplicated)</text>
</g>
<!-- qkv_0&#45;&gt;kv_cache_0 -->
<g id="edge2" class="edge">
<title>qkv_0&#45;&gt;kv_cache_0</title>
<path fill="none" stroke="black" d="M1703,-921.9C1703,-913.86 1703,-904.95 1703,-896.41"/>
<polygon fill="black" stroke="black" points="1706.5,-896.25 1703,-886.25 1699.5,-896.25 1706.5,-896.25"/>
</g>
<!-- kv_cache_1 -->
<g id="node11" class="node">
<title>kv_cache_1</title>
<polygon fill="lightgray" stroke="black" points="1595,-886 1415,-886 1415,-828 1595,-828 1595,-886"/>
<text text-anchor="middle" x="1505" y="-871" font-family="Times,serif" font-size="10.00">KV Cache</text>
<text text-anchor="middle" x="1505" y="-860" font-family="Times,serif" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1505" y="-849" font-family="Times,serif" font-size="10.00">Full cache: [B, S, 8, 128]</text>
<text text-anchor="middle" x="1505" y="-838" font-family="Times,serif" font-size="10.00">(duplicated)</text>
</g>
<!-- qkv_1&#45;&gt;kv_cache_1 -->
<g id="edge10" class="edge">
<title>qkv_1&#45;&gt;kv_cache_1</title>
<path fill="none" stroke="black" d="M1505,-921.9C1505,-913.86 1505,-904.95 1505,-896.41"/>
<polygon fill="black" stroke="black" points="1508.5,-896.25 1505,-886.25 1501.5,-896.25 1508.5,-896.25"/>
</g>
<!-- kv_cache_2 -->
<g id="node12" class="node">
<title>kv_cache_2</title>
<polygon fill="lightgray" stroke="black" points="1397,-886 1217,-886 1217,-828 1397,-828 1397,-886"/>
<text text-anchor="middle" x="1307" y="-871" font-family="Times,serif" font-size="10.00">KV Cache</text>
<text text-anchor="middle" x="1307" y="-860" font-family="Times,serif" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="1307" y="-849" font-family="Times,serif" font-size="10.00">Full cache: [B, S, 8, 128]</text>
<text text-anchor="middle" x="1307" y="-838" font-family="Times,serif" font-size="10.00">(duplicated)</text>
</g>
<!-- qkv_2&#45;&gt;kv_cache_2 -->
<g id="edge18" class="edge">
<title>qkv_2&#45;&gt;kv_cache_2</title>
<path fill="none" stroke="black" d="M1307,-921.9C1307,-913.86 1307,-904.95 1307,-896.41"/>
<polygon fill="black" stroke="black" points="1310.5,-896.25 1307,-886.25 1303.5,-896.25 1310.5,-896.25"/>
</g>
<!-- kv_cache_3 -->
<g id="node13" class="node">
<title>kv_cache_3</title>
<polygon fill="lightgray" stroke="black" points="1199,-886 1019,-886 1019,-828 1199,-828 1199,-886"/>
<text text-anchor="middle" x="1109" y="-871" font-family="Times,serif" font-size="10.00">KV Cache</text>
<text text-anchor="middle" x="1109" y="-860" font-family="Times,serif" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1109" y="-849" font-family="Times,serif" font-size="10.00">Full cache: [B, S, 8, 128]</text>
<text text-anchor="middle" x="1109" y="-838" font-family="Times,serif" font-size="10.00">(duplicated)</text>
</g>
<!-- qkv_3&#45;&gt;kv_cache_3 -->
<g id="edge26" class="edge">
<title>qkv_3&#45;&gt;kv_cache_3</title>
<path fill="none" stroke="black" d="M1109,-921.9C1109,-913.86 1109,-904.95 1109,-896.41"/>
<polygon fill="black" stroke="black" points="1112.5,-896.25 1109,-886.25 1105.5,-896.25 1112.5,-896.25"/>
</g>
<!-- kv_cache_4 -->
<g id="node14" class="node">
<title>kv_cache_4</title>
<polygon fill="lightgray" stroke="black" points="1001,-886 821,-886 821,-828 1001,-828 1001,-886"/>
<text text-anchor="middle" x="911" y="-871" font-family="Times,serif" font-size="10.00">KV Cache</text>
<text text-anchor="middle" x="911" y="-860" font-family="Times,serif" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="911" y="-849" font-family="Times,serif" font-size="10.00">Full cache: [B, S, 8, 128]</text>
<text text-anchor="middle" x="911" y="-838" font-family="Times,serif" font-size="10.00">(duplicated)</text>
</g>
<!-- qkv_4&#45;&gt;kv_cache_4 -->
<g id="edge34" class="edge">
<title>qkv_4&#45;&gt;kv_cache_4</title>
<path fill="none" stroke="black" d="M911,-921.9C911,-913.86 911,-904.95 911,-896.41"/>
<polygon fill="black" stroke="black" points="914.5,-896.25 911,-886.25 907.5,-896.25 914.5,-896.25"/>
</g>
<!-- kv_cache_5 -->
<g id="node15" class="node">
<title>kv_cache_5</title>
<polygon fill="lightgray" stroke="black" points="803,-886 623,-886 623,-828 803,-828 803,-886"/>
<text text-anchor="middle" x="713" y="-871" font-family="Times,serif" font-size="10.00">KV Cache</text>
<text text-anchor="middle" x="713" y="-860" font-family="Times,serif" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="713" y="-849" font-family="Times,serif" font-size="10.00">Full cache: [B, S, 8, 128]</text>
<text text-anchor="middle" x="713" y="-838" font-family="Times,serif" font-size="10.00">(duplicated)</text>
</g>
<!-- qkv_5&#45;&gt;kv_cache_5 -->
<g id="edge42" class="edge">
<title>qkv_5&#45;&gt;kv_cache_5</title>
<path fill="none" stroke="black" d="M713,-921.9C713,-913.86 713,-904.95 713,-896.41"/>
<polygon fill="black" stroke="black" points="716.5,-896.25 713,-886.25 709.5,-896.25 716.5,-896.25"/>
</g>
<!-- kv_cache_6 -->
<g id="node16" class="node">
<title>kv_cache_6</title>
<polygon fill="lightgray" stroke="black" points="605,-886 425,-886 425,-828 605,-828 605,-886"/>
<text text-anchor="middle" x="515" y="-871" font-family="Times,serif" font-size="10.00">KV Cache</text>
<text text-anchor="middle" x="515" y="-860" font-family="Times,serif" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="515" y="-849" font-family="Times,serif" font-size="10.00">Full cache: [B, S, 8, 128]</text>
<text text-anchor="middle" x="515" y="-838" font-family="Times,serif" font-size="10.00">(duplicated)</text>
</g>
<!-- qkv_6&#45;&gt;kv_cache_6 -->
<g id="edge50" class="edge">
<title>qkv_6&#45;&gt;kv_cache_6</title>
<path fill="none" stroke="black" d="M515,-921.9C515,-913.86 515,-904.95 515,-896.41"/>
<polygon fill="black" stroke="black" points="518.5,-896.25 515,-886.25 511.5,-896.25 518.5,-896.25"/>
</g>
<!-- kv_cache_7 -->
<g id="node17" class="node">
<title>kv_cache_7</title>
<polygon fill="lightgray" stroke="black" points="407,-886 227,-886 227,-828 407,-828 407,-886"/>
<text text-anchor="middle" x="317" y="-871" font-family="Times,serif" font-size="10.00">KV Cache</text>
<text text-anchor="middle" x="317" y="-860" font-family="Times,serif" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="317" y="-849" font-family="Times,serif" font-size="10.00">Full cache: [B, S, 8, 128]</text>
<text text-anchor="middle" x="317" y="-838" font-family="Times,serif" font-size="10.00">(duplicated)</text>
</g>
<!-- qkv_7&#45;&gt;kv_cache_7 -->
<g id="edge58" class="edge">
<title>qkv_7&#45;&gt;kv_cache_7</title>
<path fill="none" stroke="black" d="M317,-921.9C317,-913.86 317,-904.95 317,-896.41"/>
<polygon fill="black" stroke="black" points="320.5,-896.25 317,-886.25 313.5,-896.25 320.5,-896.25"/>
</g>
<!-- attn_0 -->
<g id="node18" class="node">
<title>attn_0</title>
<polygon fill="lightgreen" stroke="black" points="1793,-792 1613,-792 1613,-734 1793,-734 1793,-792"/>
<text text-anchor="middle" x="1703" y="-777" font-family="Times,serif" font-size="10.00">Attention</text>
<text text-anchor="middle" x="1703" y="-766" font-family="Times,serif" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1703" y="-755" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16, 128]</text>
<text text-anchor="middle" x="1703" y="-744" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16, 128]</text>
</g>
<!-- kv_cache_0&#45;&gt;attn_0 -->
<g id="edge3" class="edge">
<title>kv_cache_0&#45;&gt;attn_0</title>
<path fill="none" stroke="black" d="M1703,-827.9C1703,-819.86 1703,-810.95 1703,-802.41"/>
<polygon fill="black" stroke="black" points="1706.5,-802.25 1703,-792.25 1699.5,-802.25 1706.5,-802.25"/>
</g>
<!-- attn_1 -->
<g id="node19" class="node">
<title>attn_1</title>
<polygon fill="lightgreen" stroke="black" points="1595,-792 1415,-792 1415,-734 1595,-734 1595,-792"/>
<text text-anchor="middle" x="1505" y="-777" font-family="Times,serif" font-size="10.00">Attention</text>
<text text-anchor="middle" x="1505" y="-766" font-family="Times,serif" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1505" y="-755" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16, 128]</text>
<text text-anchor="middle" x="1505" y="-744" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16, 128]</text>
</g>
<!-- kv_cache_1&#45;&gt;attn_1 -->
<g id="edge11" class="edge">
<title>kv_cache_1&#45;&gt;attn_1</title>
<path fill="none" stroke="black" d="M1505,-827.9C1505,-819.86 1505,-810.95 1505,-802.41"/>
<polygon fill="black" stroke="black" points="1508.5,-802.25 1505,-792.25 1501.5,-802.25 1508.5,-802.25"/>
</g>
<!-- attn_2 -->
<g id="node20" class="node">
<title>attn_2</title>
<polygon fill="lightgreen" stroke="black" points="1397,-792 1217,-792 1217,-734 1397,-734 1397,-792"/>
<text text-anchor="middle" x="1307" y="-777" font-family="Times,serif" font-size="10.00">Attention</text>
<text text-anchor="middle" x="1307" y="-766" font-family="Times,serif" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="1307" y="-755" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16, 128]</text>
<text text-anchor="middle" x="1307" y="-744" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16, 128]</text>
</g>
<!-- kv_cache_2&#45;&gt;attn_2 -->
<g id="edge19" class="edge">
<title>kv_cache_2&#45;&gt;attn_2</title>
<path fill="none" stroke="black" d="M1307,-827.9C1307,-819.86 1307,-810.95 1307,-802.41"/>
<polygon fill="black" stroke="black" points="1310.5,-802.25 1307,-792.25 1303.5,-802.25 1310.5,-802.25"/>
</g>
<!-- attn_3 -->
<g id="node21" class="node">
<title>attn_3</title>
<polygon fill="lightgreen" stroke="black" points="1199,-792 1019,-792 1019,-734 1199,-734 1199,-792"/>
<text text-anchor="middle" x="1109" y="-777" font-family="Times,serif" font-size="10.00">Attention</text>
<text text-anchor="middle" x="1109" y="-766" font-family="Times,serif" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1109" y="-755" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16, 128]</text>
<text text-anchor="middle" x="1109" y="-744" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16, 128]</text>
</g>
<!-- kv_cache_3&#45;&gt;attn_3 -->
<g id="edge27" class="edge">
<title>kv_cache_3&#45;&gt;attn_3</title>
<path fill="none" stroke="black" d="M1109,-827.9C1109,-819.86 1109,-810.95 1109,-802.41"/>
<polygon fill="black" stroke="black" points="1112.5,-802.25 1109,-792.25 1105.5,-802.25 1112.5,-802.25"/>
</g>
<!-- attn_4 -->
<g id="node22" class="node">
<title>attn_4</title>
<polygon fill="lightgreen" stroke="black" points="1001,-792 821,-792 821,-734 1001,-734 1001,-792"/>
<text text-anchor="middle" x="911" y="-777" font-family="Times,serif" font-size="10.00">Attention</text>
<text text-anchor="middle" x="911" y="-766" font-family="Times,serif" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="911" y="-755" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16, 128]</text>
<text text-anchor="middle" x="911" y="-744" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16, 128]</text>
</g>
<!-- kv_cache_4&#45;&gt;attn_4 -->
<g id="edge35" class="edge">
<title>kv_cache_4&#45;&gt;attn_4</title>
<path fill="none" stroke="black" d="M911,-827.9C911,-819.86 911,-810.95 911,-802.41"/>
<polygon fill="black" stroke="black" points="914.5,-802.25 911,-792.25 907.5,-802.25 914.5,-802.25"/>
</g>
<!-- attn_5 -->
<g id="node23" class="node">
<title>attn_5</title>
<polygon fill="lightgreen" stroke="black" points="803,-792 623,-792 623,-734 803,-734 803,-792"/>
<text text-anchor="middle" x="713" y="-777" font-family="Times,serif" font-size="10.00">Attention</text>
<text text-anchor="middle" x="713" y="-766" font-family="Times,serif" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="713" y="-755" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16, 128]</text>
<text text-anchor="middle" x="713" y="-744" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16, 128]</text>
</g>
<!-- kv_cache_5&#45;&gt;attn_5 -->
<g id="edge43" class="edge">
<title>kv_cache_5&#45;&gt;attn_5</title>
<path fill="none" stroke="black" d="M713,-827.9C713,-819.86 713,-810.95 713,-802.41"/>
<polygon fill="black" stroke="black" points="716.5,-802.25 713,-792.25 709.5,-802.25 716.5,-802.25"/>
</g>
<!-- attn_6 -->
<g id="node24" class="node">
<title>attn_6</title>
<polygon fill="lightgreen" stroke="black" points="605,-792 425,-792 425,-734 605,-734 605,-792"/>
<text text-anchor="middle" x="515" y="-777" font-family="Times,serif" font-size="10.00">Attention</text>
<text text-anchor="middle" x="515" y="-766" font-family="Times,serif" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="515" y="-755" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16, 128]</text>
<text text-anchor="middle" x="515" y="-744" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16, 128]</text>
</g>
<!-- kv_cache_6&#45;&gt;attn_6 -->
<g id="edge51" class="edge">
<title>kv_cache_6&#45;&gt;attn_6</title>
<path fill="none" stroke="black" d="M515,-827.9C515,-819.86 515,-810.95 515,-802.41"/>
<polygon fill="black" stroke="black" points="518.5,-802.25 515,-792.25 511.5,-802.25 518.5,-802.25"/>
</g>
<!-- attn_7 -->
<g id="node25" class="node">
<title>attn_7</title>
<polygon fill="lightgreen" stroke="black" points="407,-792 227,-792 227,-734 407,-734 407,-792"/>
<text text-anchor="middle" x="317" y="-777" font-family="Times,serif" font-size="10.00">Attention</text>
<text text-anchor="middle" x="317" y="-766" font-family="Times,serif" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="317" y="-755" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16, 128]</text>
<text text-anchor="middle" x="317" y="-744" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16, 128]</text>
</g>
<!-- kv_cache_7&#45;&gt;attn_7 -->
<g id="edge59" class="edge">
<title>kv_cache_7&#45;&gt;attn_7</title>
<path fill="none" stroke="black" d="M317,-827.9C317,-819.86 317,-810.95 317,-802.41"/>
<polygon fill="black" stroke="black" points="320.5,-802.25 317,-792.25 313.5,-802.25 320.5,-802.25"/>
</g>
<!-- attn_allreduce -->
<g id="node26" class="node">
<title>attn_allreduce</title>
<polygon fill="gold" stroke="black" points="1148.85,-698 927.97,-698 871.15,-594 1092.03,-594 1148.85,-698"/>
<text text-anchor="middle" x="1010" y="-660" font-family="Times,serif" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1010" y="-649" font-family="Times,serif" font-size="10.00">TP=8</text>
<text text-anchor="middle" x="1010" y="-638" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16, 128]Ã—8</text>
<text text-anchor="middle" x="1010" y="-627" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16384]</text>
</g>
<!-- attn_0&#45;&gt;attn_allreduce -->
<g id="edge4" class="edge">
<title>attn_0&#45;&gt;attn_allreduce</title>
<path fill="none" stroke="black" d="M1612.75,-735.95C1609.8,-735.27 1606.88,-734.62 1604,-734 1444.89,-700 1258.94,-675.11 1138.06,-660.87"/>
<polygon fill="black" stroke="black" points="1138.36,-657.38 1128.02,-659.69 1137.54,-664.33 1138.36,-657.38"/>
</g>
<!-- attn_1&#45;&gt;attn_allreduce -->
<g id="edge12" class="edge">
<title>attn_1&#45;&gt;attn_allreduce</title>
<path fill="none" stroke="black" d="M1414.95,-736.29C1411.94,-735.5 1408.95,-734.74 1406,-734 1319.75,-712.35 1222.2,-690.88 1145.49,-674.69"/>
<polygon fill="black" stroke="black" points="1145.8,-671.18 1135.29,-672.54 1144.36,-678.02 1145.8,-671.18"/>
</g>
<!-- attn_2&#45;&gt;attn_allreduce -->
<g id="edge20" class="edge">
<title>attn_2&#45;&gt;attn_allreduce</title>
<path fill="none" stroke="black" d="M1234.35,-733.87C1209.16,-724.12 1180.01,-712.83 1151.21,-701.68"/>
<polygon fill="black" stroke="black" points="1152.47,-698.41 1141.88,-698.07 1149.95,-704.94 1152.47,-698.41"/>
</g>
<!-- attn_3&#45;&gt;attn_allreduce -->
<g id="edge28" class="edge">
<title>attn_3&#45;&gt;attn_allreduce</title>
<path fill="none" stroke="black" d="M1084.78,-733.87C1077.46,-725.37 1069.14,-715.7 1060.77,-705.97"/>
<polygon fill="black" stroke="black" points="1063.24,-703.47 1054.06,-698.18 1057.93,-708.04 1063.24,-703.47"/>
</g>
<!-- attn_4&#45;&gt;attn_allreduce -->
<g id="edge36" class="edge">
<title>attn_4&#45;&gt;attn_allreduce</title>
<path fill="none" stroke="black" d="M935.22,-733.87C942.54,-725.37 950.86,-715.7 959.23,-705.97"/>
<polygon fill="black" stroke="black" points="962.07,-708.04 965.94,-698.18 956.76,-703.47 962.07,-708.04"/>
</g>
<!-- attn_5&#45;&gt;attn_allreduce -->
<g id="edge44" class="edge">
<title>attn_5&#45;&gt;attn_allreduce</title>
<path fill="none" stroke="black" d="M785.65,-733.87C823.02,-719.4 869.13,-701.55 909.82,-685.79"/>
<polygon fill="black" stroke="black" points="911.16,-689.03 919.22,-682.15 908.63,-682.5 911.16,-689.03"/>
</g>
<!-- attn_6&#45;&gt;attn_allreduce -->
<g id="edge52" class="edge">
<title>attn_6&#45;&gt;attn_allreduce</title>
<path fill="none" stroke="black" d="M605.05,-736.29C608.06,-735.5 611.05,-734.74 614,-734 710.41,-709.8 820.95,-685.83 900.69,-669.19"/>
<polygon fill="black" stroke="black" points="901.68,-672.56 910.75,-667.1 900.25,-665.71 901.68,-672.56"/>
</g>
<!-- attn_7&#45;&gt;attn_allreduce -->
<g id="edge60" class="edge">
<title>attn_7&#45;&gt;attn_allreduce</title>
<path fill="none" stroke="black" d="M407.25,-735.95C410.2,-735.27 413.12,-734.62 416,-734 581.43,-698.65 775.87,-673.15 896.03,-659.22"/>
<polygon fill="black" stroke="black" points="896.45,-662.7 905.99,-658.08 895.65,-655.74 896.45,-662.7"/>
</g>
<!-- gate_0 -->
<g id="node27" class="node">
<title>gate_0</title>
<polygon fill="lightpink" stroke="black" points="2014.31,-547 1827.7,-547 1779.69,-443 1966.3,-443 2014.31,-547"/>
<text text-anchor="middle" x="1897" y="-509" font-family="Times,serif" font-size="10.00">Gate</text>
<text text-anchor="middle" x="1897" y="-498" font-family="Times,serif" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1897" y="-487" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16384]</text>
<text text-anchor="middle" x="1897" y="-476" font-family="Times,serif" font-size="10.00">Output: [B, 1, 256]</text>
</g>
<!-- attn_allreduce&#45;&gt;gate_0 -->
<g id="edge5" class="edge">
<title>attn_allreduce&#45;&gt;gate_0</title>
<path fill="none" stroke="black" d="M1118.33,-641.92C1294.16,-635.86 1634.74,-619.52 1761.2,-581.16"/>
<polygon fill="black" stroke="black" points="1762.56,-584.4 1771,-578 1760.41,-577.74 1762.56,-584.4"/>
</g>
<!-- gate_1 -->
<g id="node28" class="node">
<title>gate_1</title>
<polygon fill="lightpink" stroke="black" points="1762.31,-547 1575.7,-547 1527.69,-443 1714.3,-443 1762.31,-547"/>
<text text-anchor="middle" x="1645" y="-509" font-family="Times,serif" font-size="10.00">Gate</text>
<text text-anchor="middle" x="1645" y="-498" font-family="Times,serif" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1645" y="-487" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16384]</text>
<text text-anchor="middle" x="1645" y="-476" font-family="Times,serif" font-size="10.00">Output: [B, 1, 256]</text>
</g>
<!-- attn_allreduce&#45;&gt;gate_1 -->
<g id="edge13" class="edge">
<title>attn_allreduce&#45;&gt;gate_1</title>
<path fill="none" stroke="black" d="M1119.84,-644.47C1222.69,-640.87 1379.54,-627.3 1509.31,-581.5"/>
<polygon fill="black" stroke="black" points="1510.78,-584.69 1519,-578 1508.41,-578.1 1510.78,-584.69"/>
</g>
<!-- gate_2 -->
<g id="node29" class="node">
<title>gate_2</title>
<polygon fill="lightpink" stroke="black" points="1510.31,-547 1323.7,-547 1275.69,-443 1462.3,-443 1510.31,-547"/>
<text text-anchor="middle" x="1393" y="-509" font-family="Times,serif" font-size="10.00">Gate</text>
<text text-anchor="middle" x="1393" y="-498" font-family="Times,serif" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="1393" y="-487" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16384]</text>
<text text-anchor="middle" x="1393" y="-476" font-family="Times,serif" font-size="10.00">Output: [B, 1, 256]</text>
</g>
<!-- attn_allreduce&#45;&gt;gate_2 -->
<g id="edge21" class="edge">
<title>attn_allreduce&#45;&gt;gate_2</title>
<path fill="none" stroke="black" d="M1110.14,-626.75C1155.7,-616.61 1209.96,-601.96 1257.57,-582.05"/>
<polygon fill="black" stroke="black" points="1259.19,-585.16 1267,-578 1256.43,-578.73 1259.19,-585.16"/>
</g>
<!-- gate_3 -->
<g id="node30" class="node">
<title>gate_3</title>
<polygon fill="lightpink" stroke="black" points="1258.31,-547 1071.7,-547 1023.69,-443 1210.3,-443 1258.31,-547"/>
<text text-anchor="middle" x="1141" y="-509" font-family="Times,serif" font-size="10.00">Gate</text>
<text text-anchor="middle" x="1141" y="-498" font-family="Times,serif" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1141" y="-487" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16384]</text>
<text text-anchor="middle" x="1141" y="-476" font-family="Times,serif" font-size="10.00">Output: [B, 1, 256]</text>
</g>
<!-- attn_allreduce&#45;&gt;gate_3 -->
<g id="edge29" class="edge">
<title>attn_allreduce&#45;&gt;gate_3</title>
<path fill="none" stroke="black" d="M1055.08,-593.72C1057.33,-591.16 1059.62,-588.57 1061.92,-585.94"/>
<polygon fill="black" stroke="black" points="1064.93,-587.82 1068.91,-578 1059.68,-583.2 1064.93,-587.82"/>
</g>
<!-- gate_4 -->
<g id="node31" class="node">
<title>gate_4</title>
<polygon fill="lightpink" stroke="black" points="1006.31,-547 819.7,-547 771.69,-443 958.3,-443 1006.31,-547"/>
<text text-anchor="middle" x="889" y="-509" font-family="Times,serif" font-size="10.00">Gate</text>
<text text-anchor="middle" x="889" y="-498" font-family="Times,serif" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="889" y="-487" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16384]</text>
<text text-anchor="middle" x="889" y="-476" font-family="Times,serif" font-size="10.00">Output: [B, 1, 256]</text>
</g>
<!-- attn_allreduce&#45;&gt;gate_4 -->
<g id="edge37" class="edge">
<title>attn_allreduce&#45;&gt;gate_4</title>
<path fill="none" stroke="black" d="M968.36,-593.72C966.28,-591.16 964.17,-588.57 962.04,-585.94"/>
<polygon fill="black" stroke="black" points="964.61,-583.55 955.59,-578 959.17,-587.97 964.61,-583.55"/>
</g>
<!-- gate_5 -->
<g id="node32" class="node">
<title>gate_5</title>
<polygon fill="lightpink" stroke="black" points="754.31,-547 567.7,-547 519.69,-443 706.3,-443 754.31,-547"/>
<text text-anchor="middle" x="637" y="-509" font-family="Times,serif" font-size="10.00">Gate</text>
<text text-anchor="middle" x="637" y="-498" font-family="Times,serif" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="637" y="-487" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16384]</text>
<text text-anchor="middle" x="637" y="-476" font-family="Times,serif" font-size="10.00">Output: [B, 1, 256]</text>
</g>
<!-- attn_allreduce&#45;&gt;gate_5 -->
<g id="edge45" class="edge">
<title>attn_allreduce&#45;&gt;gate_5</title>
<path fill="none" stroke="black" d="M884.88,-619.13C848.28,-609.63 808.46,-597.37 772.53,-582.15"/>
<polygon fill="black" stroke="black" points="773.57,-578.78 763,-578 770.77,-585.2 773.57,-578.78"/>
</g>
<!-- gate_6 -->
<g id="node33" class="node">
<title>gate_6</title>
<polygon fill="lightpink" stroke="black" points="502.31,-547 315.7,-547 267.69,-443 454.3,-443 502.31,-547"/>
<text text-anchor="middle" x="385" y="-509" font-family="Times,serif" font-size="10.00">Gate</text>
<text text-anchor="middle" x="385" y="-498" font-family="Times,serif" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="385" y="-487" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16384]</text>
<text text-anchor="middle" x="385" y="-476" font-family="Times,serif" font-size="10.00">Output: [B, 1, 256]</text>
</g>
<!-- attn_allreduce&#45;&gt;gate_6 -->
<g id="edge53" class="edge">
<title>attn_allreduce&#45;&gt;gate_6</title>
<path fill="none" stroke="black" d="M898.09,-643.97C797.29,-639.89 646.14,-625.93 520.75,-581.53"/>
<polygon fill="black" stroke="black" points="521.59,-578.12 511,-578 519.21,-584.7 521.59,-578.12"/>
</g>
<!-- gate_7 -->
<g id="node34" class="node">
<title>gate_7</title>
<polygon fill="lightpink" stroke="black" points="250.31,-547 63.7,-547 15.69,-443 202.3,-443 250.31,-547"/>
<text text-anchor="middle" x="133" y="-509" font-family="Times,serif" font-size="10.00">Gate</text>
<text text-anchor="middle" x="133" y="-498" font-family="Times,serif" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="133" y="-487" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16384]</text>
<text text-anchor="middle" x="133" y="-476" font-family="Times,serif" font-size="10.00">Output: [B, 1, 256]</text>
</g>
<!-- attn_allreduce&#45;&gt;gate_7 -->
<g id="edge61" class="edge">
<title>attn_allreduce&#45;&gt;gate_7</title>
<path fill="none" stroke="black" d="M896.97,-641.6C721.72,-635.23 391.8,-618.62 268.55,-581.09"/>
<polygon fill="black" stroke="black" points="269.59,-577.75 259,-578 267.43,-584.41 269.59,-577.75"/>
</g>
<!-- expert_0 -->
<g id="node35" class="node">
<title>expert_0</title>
<polygon fill="lightcyan" stroke="black" points="1949,-407 1769,-407 1769,-344 1949,-344 1949,-407"/>
<text text-anchor="middle" x="1859" y="-395" font-family="Times,serif" font-size="10.00">All Experts</text>
<text text-anchor="middle" x="1859" y="-384" font-family="Times,serif" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1859" y="-373" font-family="Times,serif" font-size="10.00">Experts: [0:255]</text>
<text text-anchor="middle" x="1859" y="-362" font-family="Times,serif" font-size="10.00">Input: [B, 8, 2048]</text>
<text text-anchor="middle" x="1859" y="-351" font-family="Times,serif" font-size="10.00">Output: [B, 8, 2048]</text>
</g>
<!-- gate_0&#45;&gt;expert_0 -->
<g id="edge6" class="edge">
<title>gate_0&#45;&gt;expert_0</title>
<path fill="none" stroke="black" d="M1880.44,-442.8C1877.63,-434.09 1874.74,-425.15 1872.03,-416.78"/>
<polygon fill="black" stroke="black" points="1875.35,-415.68 1868.94,-407.24 1868.69,-417.83 1875.35,-415.68"/>
</g>
<!-- expert_1 -->
<g id="node36" class="node">
<title>expert_1</title>
<polygon fill="lightcyan" stroke="black" points="1700,-407 1520,-407 1520,-344 1700,-344 1700,-407"/>
<text text-anchor="middle" x="1610" y="-395" font-family="Times,serif" font-size="10.00">All Experts</text>
<text text-anchor="middle" x="1610" y="-384" font-family="Times,serif" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1610" y="-373" font-family="Times,serif" font-size="10.00">Experts: [0:255]</text>
<text text-anchor="middle" x="1610" y="-362" font-family="Times,serif" font-size="10.00">Input: [B, 8, 2048]</text>
<text text-anchor="middle" x="1610" y="-351" font-family="Times,serif" font-size="10.00">Output: [B, 8, 2048]</text>
</g>
<!-- gate_1&#45;&gt;expert_1 -->
<g id="edge14" class="edge">
<title>gate_1&#45;&gt;expert_1</title>
<path fill="none" stroke="black" d="M1629.75,-442.8C1627.18,-434.19 1624.55,-425.35 1622.08,-417.05"/>
<polygon fill="black" stroke="black" points="1625.37,-415.83 1619.16,-407.24 1618.66,-417.83 1625.37,-415.83"/>
</g>
<!-- expert_2 -->
<g id="node37" class="node">
<title>expert_2</title>
<polygon fill="lightcyan" stroke="black" points="1455,-407 1275,-407 1275,-344 1455,-344 1455,-407"/>
<text text-anchor="middle" x="1365" y="-395" font-family="Times,serif" font-size="10.00">All Experts</text>
<text text-anchor="middle" x="1365" y="-384" font-family="Times,serif" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="1365" y="-373" font-family="Times,serif" font-size="10.00">Experts: [0:255]</text>
<text text-anchor="middle" x="1365" y="-362" font-family="Times,serif" font-size="10.00">Input: [B, 8, 2048]</text>
<text text-anchor="middle" x="1365" y="-351" font-family="Times,serif" font-size="10.00">Output: [B, 8, 2048]</text>
</g>
<!-- gate_2&#45;&gt;expert_2 -->
<g id="edge22" class="edge">
<title>gate_2&#45;&gt;expert_2</title>
<path fill="none" stroke="black" d="M1380.8,-442.8C1378.75,-434.19 1376.64,-425.35 1374.66,-417.05"/>
<polygon fill="black" stroke="black" points="1378.05,-416.16 1372.33,-407.24 1371.24,-417.78 1378.05,-416.16"/>
</g>
<!-- expert_3 -->
<g id="node38" class="node">
<title>expert_3</title>
<polygon fill="lightcyan" stroke="black" points="1217,-407 1037,-407 1037,-344 1217,-344 1217,-407"/>
<text text-anchor="middle" x="1127" y="-395" font-family="Times,serif" font-size="10.00">All Experts</text>
<text text-anchor="middle" x="1127" y="-384" font-family="Times,serif" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1127" y="-373" font-family="Times,serif" font-size="10.00">Experts: [0:255]</text>
<text text-anchor="middle" x="1127" y="-362" font-family="Times,serif" font-size="10.00">Input: [B, 8, 2048]</text>
<text text-anchor="middle" x="1127" y="-351" font-family="Times,serif" font-size="10.00">Output: [B, 8, 2048]</text>
</g>
<!-- gate_3&#45;&gt;expert_3 -->
<g id="edge30" class="edge">
<title>gate_3&#45;&gt;expert_3</title>
<path fill="none" stroke="black" d="M1134.9,-442.8C1133.88,-434.28 1132.84,-425.54 1131.86,-417.32"/>
<polygon fill="black" stroke="black" points="1135.32,-416.76 1130.66,-407.24 1128.37,-417.59 1135.32,-416.76"/>
</g>
<!-- expert_4 -->
<g id="node39" class="node">
<title>expert_4</title>
<polygon fill="lightcyan" stroke="black" points="992,-407 812,-407 812,-344 992,-344 992,-407"/>
<text text-anchor="middle" x="902" y="-395" font-family="Times,serif" font-size="10.00">All Experts</text>
<text text-anchor="middle" x="902" y="-384" font-family="Times,serif" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="902" y="-373" font-family="Times,serif" font-size="10.00">Experts: [0:255]</text>
<text text-anchor="middle" x="902" y="-362" font-family="Times,serif" font-size="10.00">Input: [B, 8, 2048]</text>
<text text-anchor="middle" x="902" y="-351" font-family="Times,serif" font-size="10.00">Output: [B, 8, 2048]</text>
</g>
<!-- gate_4&#45;&gt;expert_4 -->
<g id="edge38" class="edge">
<title>gate_4&#45;&gt;expert_4</title>
<path fill="none" stroke="black" d="M894.66,-442.8C895.61,-434.28 896.57,-425.54 897.48,-417.32"/>
<polygon fill="black" stroke="black" points="900.98,-417.57 898.6,-407.24 894.02,-416.8 900.98,-417.57"/>
</g>
<!-- expert_5 -->
<g id="node40" class="node">
<title>expert_5</title>
<polygon fill="lightcyan" stroke="black" points="753,-407 573,-407 573,-344 753,-344 753,-407"/>
<text text-anchor="middle" x="663" y="-395" font-family="Times,serif" font-size="10.00">All Experts</text>
<text text-anchor="middle" x="663" y="-384" font-family="Times,serif" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="663" y="-373" font-family="Times,serif" font-size="10.00">Experts: [0:255]</text>
<text text-anchor="middle" x="663" y="-362" font-family="Times,serif" font-size="10.00">Input: [B, 8, 2048]</text>
<text text-anchor="middle" x="663" y="-351" font-family="Times,serif" font-size="10.00">Output: [B, 8, 2048]</text>
</g>
<!-- gate_5&#45;&gt;expert_5 -->
<g id="edge46" class="edge">
<title>gate_5&#45;&gt;expert_5</title>
<path fill="none" stroke="black" d="M648.33,-442.8C650.24,-434.19 652.19,-425.35 654.03,-417.05"/>
<polygon fill="black" stroke="black" points="657.45,-417.76 656.2,-407.24 650.62,-416.25 657.45,-417.76"/>
</g>
<!-- expert_6 -->
<g id="node41" class="node">
<title>expert_6</title>
<polygon fill="lightcyan" stroke="black" points="501,-407 321,-407 321,-344 501,-344 501,-407"/>
<text text-anchor="middle" x="411" y="-395" font-family="Times,serif" font-size="10.00">All Experts</text>
<text text-anchor="middle" x="411" y="-384" font-family="Times,serif" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="411" y="-373" font-family="Times,serif" font-size="10.00">Experts: [0:255]</text>
<text text-anchor="middle" x="411" y="-362" font-family="Times,serif" font-size="10.00">Input: [B, 8, 2048]</text>
<text text-anchor="middle" x="411" y="-351" font-family="Times,serif" font-size="10.00">Output: [B, 8, 2048]</text>
</g>
<!-- gate_6&#45;&gt;expert_6 -->
<g id="edge54" class="edge">
<title>gate_6&#45;&gt;expert_6</title>
<path fill="none" stroke="black" d="M396.33,-442.8C398.24,-434.19 400.19,-425.35 402.03,-417.05"/>
<polygon fill="black" stroke="black" points="405.45,-417.76 404.2,-407.24 398.62,-416.25 405.45,-417.76"/>
</g>
<!-- expert_7 -->
<g id="node42" class="node">
<title>expert_7</title>
<polygon fill="lightcyan" stroke="black" points="253,-407 73,-407 73,-344 253,-344 253,-407"/>
<text text-anchor="middle" x="163" y="-395" font-family="Times,serif" font-size="10.00">All Experts</text>
<text text-anchor="middle" x="163" y="-384" font-family="Times,serif" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="163" y="-373" font-family="Times,serif" font-size="10.00">Experts: [0:255]</text>
<text text-anchor="middle" x="163" y="-362" font-family="Times,serif" font-size="10.00">Input: [B, 8, 2048]</text>
<text text-anchor="middle" x="163" y="-351" font-family="Times,serif" font-size="10.00">Output: [B, 8, 2048]</text>
</g>
<!-- gate_7&#45;&gt;expert_7 -->
<g id="edge62" class="edge">
<title>gate_7&#45;&gt;expert_7</title>
<path fill="none" stroke="black" d="M146.07,-442.8C148.27,-434.19 150.53,-425.35 152.65,-417.05"/>
<polygon fill="black" stroke="black" points="156.07,-417.8 155.15,-407.24 149.29,-416.07 156.07,-417.8"/>
</g>
<!-- ffn_0 -->
<g id="node43" class="node">
<title>ffn_0</title>
<polygon fill="lightsteelblue" stroke="black" points="1924,-308 1744,-308 1744,-234 1924,-234 1924,-308"/>
<text text-anchor="middle" x="1834" y="-296" font-family="Times,serif" font-size="10.00">FFN</text>
<text text-anchor="middle" x="1834" y="-285" font-family="Times,serif" font-size="10.00">GPU 0</text>
<text text-anchor="middle" x="1834" y="-274" font-family="Times,serif" font-size="10.00">UP: [B, 8, 2048, 16384/8]</text>
<text text-anchor="middle" x="1834" y="-263" font-family="Times,serif" font-size="10.00">Gate: [B, 8, 2048, 16384/8]</text>
<text text-anchor="middle" x="1834" y="-252" font-family="Times,serif" font-size="10.00">Down: [B, 8, 16384/8, 2048]</text>
<text text-anchor="middle" x="1834" y="-241" font-family="Times,serif" font-size="10.00">Output: [B, 8, 2048]</text>
</g>
<!-- expert_0&#45;&gt;ffn_0 -->
<g id="edge7" class="edge">
<title>expert_0&#45;&gt;ffn_0</title>
<path fill="none" stroke="black" d="M1851.5,-343.75C1849.51,-335.61 1847.33,-326.64 1845.19,-317.88"/>
<polygon fill="black" stroke="black" points="1848.59,-317.03 1842.82,-308.14 1841.79,-318.69 1848.59,-317.03"/>
</g>
<!-- ffn_1 -->
<g id="node44" class="node">
<title>ffn_1</title>
<polygon fill="lightsteelblue" stroke="black" points="1677,-308 1497,-308 1497,-234 1677,-234 1677,-308"/>
<text text-anchor="middle" x="1587" y="-296" font-family="Times,serif" font-size="10.00">FFN</text>
<text text-anchor="middle" x="1587" y="-285" font-family="Times,serif" font-size="10.00">GPU 1</text>
<text text-anchor="middle" x="1587" y="-274" font-family="Times,serif" font-size="10.00">UP: [B, 8, 2048, 16384/8]</text>
<text text-anchor="middle" x="1587" y="-263" font-family="Times,serif" font-size="10.00">Gate: [B, 8, 2048, 16384/8]</text>
<text text-anchor="middle" x="1587" y="-252" font-family="Times,serif" font-size="10.00">Down: [B, 8, 16384/8, 2048]</text>
<text text-anchor="middle" x="1587" y="-241" font-family="Times,serif" font-size="10.00">Output: [B, 8, 2048]</text>
</g>
<!-- expert_1&#45;&gt;ffn_1 -->
<g id="edge15" class="edge">
<title>expert_1&#45;&gt;ffn_1</title>
<path fill="none" stroke="black" d="M1603.1,-343.75C1601.29,-335.69 1599.3,-326.83 1597.36,-318.17"/>
<polygon fill="black" stroke="black" points="1600.72,-317.14 1595.11,-308.14 1593.88,-318.67 1600.72,-317.14"/>
</g>
<!-- ffn_2 -->
<g id="node45" class="node">
<title>ffn_2</title>
<polygon fill="lightsteelblue" stroke="black" points="1435,-308 1255,-308 1255,-234 1435,-234 1435,-308"/>
<text text-anchor="middle" x="1345" y="-296" font-family="Times,serif" font-size="10.00">FFN</text>
<text text-anchor="middle" x="1345" y="-285" font-family="Times,serif" font-size="10.00">GPU 2</text>
<text text-anchor="middle" x="1345" y="-274" font-family="Times,serif" font-size="10.00">UP: [B, 8, 2048, 16384/8]</text>
<text text-anchor="middle" x="1345" y="-263" font-family="Times,serif" font-size="10.00">Gate: [B, 8, 2048, 16384/8]</text>
<text text-anchor="middle" x="1345" y="-252" font-family="Times,serif" font-size="10.00">Down: [B, 8, 16384/8, 2048]</text>
<text text-anchor="middle" x="1345" y="-241" font-family="Times,serif" font-size="10.00">Output: [B, 8, 2048]</text>
</g>
<!-- expert_2&#45;&gt;ffn_2 -->
<g id="edge23" class="edge">
<title>expert_2&#45;&gt;ffn_2</title>
<path fill="none" stroke="black" d="M1359,-343.75C1357.43,-335.69 1355.7,-326.83 1354.01,-318.17"/>
<polygon fill="black" stroke="black" points="1357.4,-317.29 1352.05,-308.14 1350.53,-318.63 1357.4,-317.29"/>
</g>
<!-- ffn_3 -->
<g id="node46" class="node">
<title>ffn_3</title>
<polygon fill="lightsteelblue" stroke="black" points="1210,-308 1030,-308 1030,-234 1210,-234 1210,-308"/>
<text text-anchor="middle" x="1120" y="-296" font-family="Times,serif" font-size="10.00">FFN</text>
<text text-anchor="middle" x="1120" y="-285" font-family="Times,serif" font-size="10.00">GPU 3</text>
<text text-anchor="middle" x="1120" y="-274" font-family="Times,serif" font-size="10.00">UP: [B, 8, 2048, 16384/8]</text>
<text text-anchor="middle" x="1120" y="-263" font-family="Times,serif" font-size="10.00">Gate: [B, 8, 2048, 16384/8]</text>
<text text-anchor="middle" x="1120" y="-252" font-family="Times,serif" font-size="10.00">Down: [B, 8, 16384/8, 2048]</text>
<text text-anchor="middle" x="1120" y="-241" font-family="Times,serif" font-size="10.00">Output: [B, 8, 2048]</text>
</g>
<!-- expert_3&#45;&gt;ffn_3 -->
<g id="edge31" class="edge">
<title>expert_3&#45;&gt;ffn_3</title>
<path fill="none" stroke="black" d="M1124.9,-343.75C1124.35,-335.69 1123.74,-326.83 1123.15,-318.17"/>
<polygon fill="black" stroke="black" points="1126.64,-317.88 1122.47,-308.14 1119.66,-318.36 1126.64,-317.88"/>
</g>
<!-- ffn_4 -->
<g id="node47" class="node">
<title>ffn_4</title>
<polygon fill="lightsteelblue" stroke="black" points="1005,-308 825,-308 825,-234 1005,-234 1005,-308"/>
<text text-anchor="middle" x="915" y="-296" font-family="Times,serif" font-size="10.00">FFN</text>
<text text-anchor="middle" x="915" y="-285" font-family="Times,serif" font-size="10.00">GPU 4</text>
<text text-anchor="middle" x="915" y="-274" font-family="Times,serif" font-size="10.00">UP: [B, 8, 2048, 16384/8]</text>
<text text-anchor="middle" x="915" y="-263" font-family="Times,serif" font-size="10.00">Gate: [B, 8, 2048, 16384/8]</text>
<text text-anchor="middle" x="915" y="-252" font-family="Times,serif" font-size="10.00">Down: [B, 8, 16384/8, 2048]</text>
<text text-anchor="middle" x="915" y="-241" font-family="Times,serif" font-size="10.00">Output: [B, 8, 2048]</text>
</g>
<!-- expert_4&#45;&gt;ffn_4 -->
<g id="edge39" class="edge">
<title>expert_4&#45;&gt;ffn_4</title>
<path fill="none" stroke="black" d="M905.9,-343.75C906.92,-335.69 908.05,-326.83 909.14,-318.17"/>
<polygon fill="black" stroke="black" points="912.63,-318.51 910.42,-308.14 905.69,-317.62 912.63,-318.51"/>
</g>
<!-- ffn_5 -->
<g id="node48" class="node">
<title>ffn_5</title>
<polygon fill="lightsteelblue" stroke="black" points="780,-308 600,-308 600,-234 780,-234 780,-308"/>
<text text-anchor="middle" x="690" y="-296" font-family="Times,serif" font-size="10.00">FFN</text>
<text text-anchor="middle" x="690" y="-285" font-family="Times,serif" font-size="10.00">GPU 5</text>
<text text-anchor="middle" x="690" y="-274" font-family="Times,serif" font-size="10.00">UP: [B, 8, 2048, 16384/8]</text>
<text text-anchor="middle" x="690" y="-263" font-family="Times,serif" font-size="10.00">Gate: [B, 8, 2048, 16384/8]</text>
<text text-anchor="middle" x="690" y="-252" font-family="Times,serif" font-size="10.00">Down: [B, 8, 16384/8, 2048]</text>
<text text-anchor="middle" x="690" y="-241" font-family="Times,serif" font-size="10.00">Output: [B, 8, 2048]</text>
</g>
<!-- expert_5&#45;&gt;ffn_5 -->
<g id="edge47" class="edge">
<title>expert_5&#45;&gt;ffn_5</title>
<path fill="none" stroke="black" d="M671.1,-343.75C673.25,-335.61 675.61,-326.64 677.91,-317.88"/>
<polygon fill="black" stroke="black" points="681.32,-318.71 680.48,-308.14 674.55,-316.92 681.32,-318.71"/>
</g>
<!-- ffn_6 -->
<g id="node49" class="node">
<title>ffn_6</title>
<polygon fill="lightsteelblue" stroke="black" points="528,-308 348,-308 348,-234 528,-234 528,-308"/>
<text text-anchor="middle" x="438" y="-296" font-family="Times,serif" font-size="10.00">FFN</text>
<text text-anchor="middle" x="438" y="-285" font-family="Times,serif" font-size="10.00">GPU 6</text>
<text text-anchor="middle" x="438" y="-274" font-family="Times,serif" font-size="10.00">UP: [B, 8, 2048, 16384/8]</text>
<text text-anchor="middle" x="438" y="-263" font-family="Times,serif" font-size="10.00">Gate: [B, 8, 2048, 16384/8]</text>
<text text-anchor="middle" x="438" y="-252" font-family="Times,serif" font-size="10.00">Down: [B, 8, 16384/8, 2048]</text>
<text text-anchor="middle" x="438" y="-241" font-family="Times,serif" font-size="10.00">Output: [B, 8, 2048]</text>
</g>
<!-- expert_6&#45;&gt;ffn_6 -->
<g id="edge55" class="edge">
<title>expert_6&#45;&gt;ffn_6</title>
<path fill="none" stroke="black" d="M419.1,-343.75C421.25,-335.61 423.61,-326.64 425.91,-317.88"/>
<polygon fill="black" stroke="black" points="429.32,-318.71 428.48,-308.14 422.55,-316.92 429.32,-318.71"/>
</g>
<!-- ffn_7 -->
<g id="node50" class="node">
<title>ffn_7</title>
<polygon fill="lightsteelblue" stroke="black" points="300,-308 120,-308 120,-234 300,-234 300,-308"/>
<text text-anchor="middle" x="210" y="-296" font-family="Times,serif" font-size="10.00">FFN</text>
<text text-anchor="middle" x="210" y="-285" font-family="Times,serif" font-size="10.00">GPU 7</text>
<text text-anchor="middle" x="210" y="-274" font-family="Times,serif" font-size="10.00">UP: [B, 8, 2048, 16384/8]</text>
<text text-anchor="middle" x="210" y="-263" font-family="Times,serif" font-size="10.00">Gate: [B, 8, 2048, 16384/8]</text>
<text text-anchor="middle" x="210" y="-252" font-family="Times,serif" font-size="10.00">Down: [B, 8, 16384/8, 2048]</text>
<text text-anchor="middle" x="210" y="-241" font-family="Times,serif" font-size="10.00">Output: [B, 8, 2048]</text>
</g>
<!-- expert_7&#45;&gt;ffn_7 -->
<g id="edge63" class="edge">
<title>expert_7&#45;&gt;ffn_7</title>
<path fill="none" stroke="black" d="M177.1,-343.75C180.91,-335.43 185.12,-326.25 189.22,-317.32"/>
<polygon fill="black" stroke="black" points="192.44,-318.69 193.43,-308.14 186.08,-315.78 192.44,-318.69"/>
</g>
<!-- ffn_allreduce -->
<g id="node51" class="node">
<title>ffn_allreduce</title>
<polygon fill="gold" stroke="black" points="1147.47,-198 946.29,-198 894.53,-94 1095.71,-94 1147.47,-198"/>
<text text-anchor="middle" x="1021" y="-160" font-family="Times,serif" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1021" y="-149" font-family="Times,serif" font-size="10.00">TP=8</text>
<text text-anchor="middle" x="1021" y="-138" font-family="Times,serif" font-size="10.00">Input: [B, 8, 2048]Ã—8</text>
<text text-anchor="middle" x="1021" y="-127" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16384]</text>
</g>
<!-- ffn_0&#45;&gt;ffn_allreduce -->
<g id="edge8" class="edge">
<title>ffn_0&#45;&gt;ffn_allreduce</title>
<path fill="none" stroke="black" d="M1743.94,-246.44C1724.89,-241.93 1704.85,-237.51 1686,-234 1495.1,-198.4 1270.69,-172.26 1137.46,-158.37"/>
<polygon fill="black" stroke="black" points="1137.54,-154.86 1127.23,-157.3 1136.82,-161.82 1137.54,-154.86"/>
</g>
<!-- ffn_1&#45;&gt;ffn_allreduce -->
<g id="edge16" class="edge">
<title>ffn_1&#45;&gt;ffn_allreduce</title>
<path fill="none" stroke="black" d="M1496.75,-246.64C1479.28,-242.3 1461.1,-237.91 1444,-234 1342.94,-210.9 1227.64,-187.37 1142.97,-170.62"/>
<polygon fill="black" stroke="black" points="1143.55,-167.16 1133.06,-168.66 1142.19,-174.03 1143.55,-167.16"/>
</g>
<!-- ffn_2&#45;&gt;ffn_allreduce -->
<g id="edge24" class="edge">
<title>ffn_2&#45;&gt;ffn_allreduce</title>
<path fill="none" stroke="black" d="M1254.75,-235.74C1223.94,-224.04 1188.79,-210.7 1155.28,-197.98"/>
<polygon fill="black" stroke="black" points="1156.47,-194.68 1145.88,-194.41 1153.98,-201.23 1156.47,-194.68"/>
</g>
<!-- ffn_3&#45;&gt;ffn_allreduce -->
<g id="edge32" class="edge">
<title>ffn_3&#45;&gt;ffn_allreduce</title>
<path fill="none" stroke="black" d="M1090.83,-233.76C1083.79,-225.01 1076.09,-215.44 1068.45,-205.95"/>
<polygon fill="black" stroke="black" points="1071.06,-203.61 1062.06,-198.02 1065.61,-208 1071.06,-203.61"/>
</g>
<!-- ffn_4&#45;&gt;ffn_allreduce -->
<g id="edge40" class="edge">
<title>ffn_4&#45;&gt;ffn_allreduce</title>
<path fill="none" stroke="black" d="M946.23,-233.76C953.84,-224.93 962.18,-215.25 970.44,-205.67"/>
<polygon fill="black" stroke="black" points="973.16,-207.88 977.03,-198.02 967.85,-203.31 973.16,-207.88"/>
</g>
<!-- ffn_5&#45;&gt;ffn_allreduce -->
<g id="edge48" class="edge">
<title>ffn_5&#45;&gt;ffn_allreduce</title>
<path fill="none" stroke="black" d="M780.01,-236.55C825.59,-219.61 880.89,-199.06 927.02,-181.92"/>
<polygon fill="black" stroke="black" points="928.26,-185.2 936.42,-178.43 925.82,-178.63 928.26,-185.2"/>
</g>
<!-- ffn_6&#45;&gt;ffn_allreduce -->
<g id="edge56" class="edge">
<title>ffn_6&#45;&gt;ffn_allreduce</title>
<path fill="none" stroke="black" d="M528.1,-248.3C548.74,-243.47 570.61,-238.46 591,-234 703.12,-209.47 832.24,-183.68 919.49,-166.6"/>
<polygon fill="black" stroke="black" points="920.25,-170.02 929.39,-164.67 918.91,-163.15 920.25,-170.02"/>
</g>
<!-- ffn_7&#45;&gt;ffn_allreduce -->
<g id="edge64" class="edge">
<title>ffn_7&#45;&gt;ffn_allreduce</title>
<path fill="none" stroke="black" d="M300.16,-243.05C313.12,-239.7 326.35,-236.56 339,-234 540.39,-193.28 779.31,-167.98 914.23,-155.78"/>
<polygon fill="black" stroke="black" points="914.91,-159.23 924.56,-154.85 914.29,-152.26 914.91,-159.23"/>
</g>
<!-- output -->
<g id="node52" class="node">
<title>output</title>
<ellipse fill="lightgreen" stroke="black" cx="1021" cy="-29" rx="90" ry="29"/>
<text text-anchor="middle" x="1021" y="-37.5" font-family="Times,serif" font-size="10.00">Output</text>
<text text-anchor="middle" x="1021" y="-26.5" font-family="Times,serif" font-size="10.00">Input: [B, 1, 16384]</text>
<text text-anchor="middle" x="1021" y="-15.5" font-family="Times,serif" font-size="10.00">Output: [B, 1, 16384]</text>
</g>
<!-- ffn_allreduce&#45;&gt;output -->
<g id="edge65" class="edge">
<title>ffn_allreduce&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1021,-93.89C1021,-85.29 1021,-76.49 1021,-68.28"/>
<polygon fill="black" stroke="black" points="1024.5,-68.26 1021,-58.26 1017.5,-68.26 1024.5,-68.26"/>
</g>
</g>
</svg>
