// MA Separation: 12 Attention GPUs, 4 MoE GPUs
digraph ma_separation_dag {
	graph [bgcolor=white compound=true fontname=Arial fontsize=12 rankdir=TB]
	node [fontname=Arial fontsize=10]
	input [label="Input\n[batch_size=1024, seq_len=2048, hidden_dim=4096]" fillcolor="#D0E8FF" shape=ellipse style=filled]
	embeddings [label="Token + Position\nEmbedding\n[Input: [1024,2048], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	input -> embeddings
	subgraph layer_0 {
		rank=same
		label="Layer 0"
		layer0_pre_attn_norm [label="LayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		subgraph layer0_attention_group {
			label="Attention Parallelization (GPUs 0-11)" rank=same style=dotted
			layer0_qkv_gpu0 [label="GPU0\nQKV Projection\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_qkv_gpu1 [label="GPU1\nQKV Projection\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_qkv_gpu2 [label="GPU2\nQKV Projection\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_qkv_gpu3 [label="GPU3\nQKV Projection\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_qkv_gpu4 [label="GPU4\nQKV Projection\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_qkv_gpu5 [label="GPU5\nQKV Projection\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_qkv_gpu6 [label="GPU6\nQKV Projection\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_qkv_gpu7 [label="GPU7\nQKV Projection\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_qkv_gpu8 [label="GPU8\nQKV Projection\n[Input: [1024,2048,4096], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_qkv_gpu9 [label="GPU9\nQKV Projection\n[Input: [1024,2048,4096], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_qkv_gpu10 [label="GPU10\nQKV Projection\n[Input: [1024,2048,4096], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_qkv_gpu11 [label="GPU11\nQKV Projection\n[Input: [1024,2048,4096], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_attn_gpu0 [label="GPU0\nMulti-Head Attention\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_attn_gpu1 [label="GPU1\nMulti-Head Attention\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_attn_gpu2 [label="GPU2\nMulti-Head Attention\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_attn_gpu3 [label="GPU3\nMulti-Head Attention\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_attn_gpu4 [label="GPU4\nMulti-Head Attention\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_attn_gpu5 [label="GPU5\nMulti-Head Attention\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_attn_gpu6 [label="GPU6\nMulti-Head Attention\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_attn_gpu7 [label="GPU7\nMulti-Head Attention\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_attn_gpu8 [label="GPU8\nMulti-Head Attention\n[Input: [1024,2048,256], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_attn_gpu9 [label="GPU9\nMulti-Head Attention\n[Input: [1024,2048,256], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_attn_gpu10 [label="GPU10\nMulti-Head Attention\n[Input: [1024,2048,256], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_attn_gpu11 [label="GPU11\nMulti-Head Attention\n[Input: [1024,2048,256], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_out_proj_gpu0 [label="GPU0\nOutput Projection\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_out_proj_gpu1 [label="GPU1\nOutput Projection\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_out_proj_gpu2 [label="GPU2\nOutput Projection\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_out_proj_gpu3 [label="GPU3\nOutput Projection\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_out_proj_gpu4 [label="GPU4\nOutput Projection\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_out_proj_gpu5 [label="GPU5\nOutput Projection\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_out_proj_gpu6 [label="GPU6\nOutput Projection\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_out_proj_gpu7 [label="GPU7\nOutput Projection\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_out_proj_gpu8 [label="GPU8\nOutput Projection\n[Input: [1024,2048,256], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_out_proj_gpu9 [label="GPU9\nOutput Projection\n[Input: [1024,2048,256], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_out_proj_gpu10 [label="GPU10\nOutput Projection\n[Input: [1024,2048,256], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
			layer0_out_proj_gpu11 [label="GPU11\nOutput Projection\n[Input: [1024,2048,256], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		}
		layer0_attn_agg [label="Attention\nAggregation\nAll-Reduce\n[Input: 12Ã—[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FFF4E8" shape=parallelogram style="filled,rounded"]
		layer0_residual1 [label="Residual Add\n[Input1: [1024,2048,4096], Input2: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FFF4E8" shape=parallelogram style="filled,rounded"]
		layer0_post_attn_norm [label="LayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
	}
	subgraph layer0_moe_group {
		label="MoE Parallelization (GPUs 12-15)" rank=same style=dotted
		layer0_gate_gpu12 [label="GPU12\nGating Network\n[Input: [1024,2048,4096], Output: [1024,2048,16] (routing)]" fillcolor="#FDE8E8" shape=parallelogram style=filled]
		layer0_gate_gpu13 [label="GPU13\nGating Network\n[Input: [1024,2048,4096], Output: [1024,2048,16] (routing)]" fillcolor="#FDE8E8" shape=parallelogram style=filled]
		layer0_gate_gpu14 [label="GPU14\nGating Network\n[Input: [1024,2048,4096], Output: [1024,2048,16] (routing)]" fillcolor="#FDE8E8" shape=parallelogram style=filled]
		layer0_gate_gpu15 [label="GPU15\nGating Network\n[Input: [1024,2048,4096], Output: [1024,2048,16] (routing)]" fillcolor="#FDE8E8" shape=parallelogram style=filled]
		layer0_experts_gpu12 [label="GPU12\nExperts 0-3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		layer0_experts_gpu13 [label="GPU13\nExperts 4-7\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		layer0_experts_gpu14 [label="GPU14\nExperts 8-11\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		layer0_experts_gpu15 [label="GPU15\nExperts 12-15\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		layer0_moe_agg [label="Expert\nAggregation\n[Input: 4Ã—[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FFF4E8" shape=parallelogram style="filled,rounded"]
	}
	layer0_residual2 [label="Residual Add\n[Input1: [1024,2048,4096], Input2: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FFF4E8" shape=parallelogram style="filled,rounded"]
	embeddings -> layer0_pre_attn_norm
	layer0_pre_attn_norm -> layer0_qkv_gpu0
	layer0_qkv_gpu0 -> layer0_attn_gpu0
	layer0_attn_gpu0 -> layer0_out_proj_gpu0
	layer0_out_proj_gpu0 -> layer0_attn_agg
	layer0_pre_attn_norm -> layer0_qkv_gpu1
	layer0_qkv_gpu1 -> layer0_attn_gpu1
	layer0_attn_gpu1 -> layer0_out_proj_gpu1
	layer0_out_proj_gpu1 -> layer0_attn_agg
	layer0_pre_attn_norm -> layer0_qkv_gpu2
	layer0_qkv_gpu2 -> layer0_attn_gpu2
	layer0_attn_gpu2 -> layer0_out_proj_gpu2
	layer0_out_proj_gpu2 -> layer0_attn_agg
	layer0_pre_attn_norm -> layer0_qkv_gpu3
	layer0_qkv_gpu3 -> layer0_attn_gpu3
	layer0_attn_gpu3 -> layer0_out_proj_gpu3
	layer0_out_proj_gpu3 -> layer0_attn_agg
	layer0_pre_attn_norm -> layer0_qkv_gpu4
	layer0_qkv_gpu4 -> layer0_attn_gpu4
	layer0_attn_gpu4 -> layer0_out_proj_gpu4
	layer0_out_proj_gpu4 -> layer0_attn_agg
	layer0_pre_attn_norm -> layer0_qkv_gpu5
	layer0_qkv_gpu5 -> layer0_attn_gpu5
	layer0_attn_gpu5 -> layer0_out_proj_gpu5
	layer0_out_proj_gpu5 -> layer0_attn_agg
	layer0_pre_attn_norm -> layer0_qkv_gpu6
	layer0_qkv_gpu6 -> layer0_attn_gpu6
	layer0_attn_gpu6 -> layer0_out_proj_gpu6
	layer0_out_proj_gpu6 -> layer0_attn_agg
	layer0_pre_attn_norm -> layer0_qkv_gpu7
	layer0_qkv_gpu7 -> layer0_attn_gpu7
	layer0_attn_gpu7 -> layer0_out_proj_gpu7
	layer0_out_proj_gpu7 -> layer0_attn_agg
	layer0_pre_attn_norm -> layer0_qkv_gpu8
	layer0_qkv_gpu8 -> layer0_attn_gpu8
	layer0_attn_gpu8 -> layer0_out_proj_gpu8
	layer0_out_proj_gpu8 -> layer0_attn_agg
	layer0_pre_attn_norm -> layer0_qkv_gpu9
	layer0_qkv_gpu9 -> layer0_attn_gpu9
	layer0_attn_gpu9 -> layer0_out_proj_gpu9
	layer0_out_proj_gpu9 -> layer0_attn_agg
	layer0_pre_attn_norm -> layer0_qkv_gpu10
	layer0_qkv_gpu10 -> layer0_attn_gpu10
	layer0_attn_gpu10 -> layer0_out_proj_gpu10
	layer0_out_proj_gpu10 -> layer0_attn_agg
	layer0_pre_attn_norm -> layer0_qkv_gpu11
	layer0_qkv_gpu11 -> layer0_attn_gpu11
	layer0_attn_gpu11 -> layer0_out_proj_gpu11
	layer0_out_proj_gpu11 -> layer0_attn_agg
	layer0_attn_agg -> layer0_residual1
	embeddings -> layer0_residual1
	layer0_residual1 -> layer0_post_attn_norm
	layer0_post_attn_norm -> layer0_gate_gpu12 [color=blue style=dashed]
	layer0_post_attn_norm -> layer0_gate_gpu13 [color=blue style=dashed]
	layer0_post_attn_norm -> layer0_gate_gpu14 [color=blue style=dashed]
	layer0_post_attn_norm -> layer0_gate_gpu15 [color=blue style=dashed]
	layer0_post_attn_norm -> layer0_experts_gpu12
	layer0_gate_gpu12 -> layer0_experts_gpu12 [color=red style=dashed]
	layer0_experts_gpu12 -> layer0_moe_agg
	layer0_post_attn_norm -> layer0_experts_gpu13
	layer0_gate_gpu13 -> layer0_experts_gpu13 [color=red style=dashed]
	layer0_experts_gpu13 -> layer0_moe_agg
	layer0_post_attn_norm -> layer0_experts_gpu14
	layer0_gate_gpu14 -> layer0_experts_gpu14 [color=red style=dashed]
	layer0_experts_gpu14 -> layer0_moe_agg
	layer0_post_attn_norm -> layer0_experts_gpu15
	layer0_gate_gpu15 -> layer0_experts_gpu15 [color=red style=dashed]
	layer0_experts_gpu15 -> layer0_moe_agg
	layer0_moe_agg -> layer0_residual2
	layer0_residual1 -> layer0_residual2
	layer1_pre_attn_norm [label="Layer 1\nLayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu0 [label="GPU0\nQKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu0 [label="GPU0\nAttn Layer1\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_out_proj_gpu0 [label="GPU0\nOutProj Layer1\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu1 [label="GPU1\nQKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu1 [label="GPU1\nAttn Layer1\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_out_proj_gpu1 [label="GPU1\nOutProj Layer1\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu2 [label="GPU2\nQKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu2 [label="GPU2\nAttn Layer1\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_out_proj_gpu2 [label="GPU2\nOutProj Layer1\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu3 [label="GPU3\nQKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu3 [label="GPU3\nAttn Layer1\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_out_proj_gpu3 [label="GPU3\nOutProj Layer1\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu4 [label="GPU4\nQKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu4 [label="GPU4\nAttn Layer1\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_out_proj_gpu4 [label="GPU4\nOutProj Layer1\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu5 [label="GPU5\nQKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu5 [label="GPU5\nAttn Layer1\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_out_proj_gpu5 [label="GPU5\nOutProj Layer1\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu6 [label="GPU6\nQKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu6 [label="GPU6\nAttn Layer1\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_out_proj_gpu6 [label="GPU6\nOutProj Layer1\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu7 [label="GPU7\nQKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu7 [label="GPU7\nAttn Layer1\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_out_proj_gpu7 [label="GPU7\nOutProj Layer1\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu8 [label="GPU8\nQKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu8 [label="GPU8\nAttn Layer1\n[Input: [1024,2048,256], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_out_proj_gpu8 [label="GPU8\nOutProj Layer1\n[Input: [1024,2048,256], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu9 [label="GPU9\nQKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu9 [label="GPU9\nAttn Layer1\n[Input: [1024,2048,256], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_out_proj_gpu9 [label="GPU9\nOutProj Layer1\n[Input: [1024,2048,256], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu10 [label="GPU10\nQKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu10 [label="GPU10\nAttn Layer1\n[Input: [1024,2048,256], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_out_proj_gpu10 [label="GPU10\nOutProj Layer1\n[Input: [1024,2048,256], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu11 [label="GPU11\nQKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu11 [label="GPU11\nAttn Layer1\n[Input: [1024,2048,256], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_out_proj_gpu11 [label="GPU11\nOutProj Layer1\n[Input: [1024,2048,256], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_agg [label="Layer 1\nAttention\nAggregation\n[Input: 12Ã—[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FFF4E8" shape=parallelogram style="filled,rounded"]
	layer1_residual1 [label="Layer 1\nResidual Add\n[Input: 2Ã—[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FFF4E8" shape=parallelogram style="filled,rounded"]
	layer1_post_attn_norm [label="Layer 1\nPost-Attn LayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
	layer1_gate_gpu12 [label="GPU12\nGating Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,16]]" fillcolor="#FDE8E8" shape=parallelogram style=filled]
	layer1_experts_gpu12 [label="GPU12\nExperts 0-3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
	layer1_gate_gpu13 [label="GPU13\nGating Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,16]]" fillcolor="#FDE8E8" shape=parallelogram style=filled]
	layer1_experts_gpu13 [label="GPU13\nExperts 4-7\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
	layer1_gate_gpu14 [label="GPU14\nGating Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,16]]" fillcolor="#FDE8E8" shape=parallelogram style=filled]
	layer1_experts_gpu14 [label="GPU14\nExperts 8-11\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
	layer1_gate_gpu15 [label="GPU15\nGating Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,16]]" fillcolor="#FDE8E8" shape=parallelogram style=filled]
	layer1_experts_gpu15 [label="GPU15\nExperts 12-15\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
	layer1_moe_agg [label="Layer 1\nMoE\nAggregation\n[Input: 4Ã—[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FFF4E8" shape=parallelogram style="filled,rounded"]
	layer1_residual2 [label="Layer 1\nResidual Add\n[Input: 2Ã—[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FFF4E8" shape=parallelogram style="filled,rounded"]
	layer0_residual2 -> layer1_pre_attn_norm
	layer1_pre_attn_norm -> layer1_qkv_gpu0
	layer1_qkv_gpu0 -> layer1_attn_gpu0
	layer1_attn_gpu0 -> layer1_out_proj_gpu0
	layer1_out_proj_gpu0 -> layer1_attn_agg
	layer1_pre_attn_norm -> layer1_qkv_gpu1
	layer1_qkv_gpu1 -> layer1_attn_gpu1
	layer1_attn_gpu1 -> layer1_out_proj_gpu1
	layer1_out_proj_gpu1 -> layer1_attn_agg
	layer1_pre_attn_norm -> layer1_qkv_gpu2
	layer1_qkv_gpu2 -> layer1_attn_gpu2
	layer1_attn_gpu2 -> layer1_out_proj_gpu2
	layer1_out_proj_gpu2 -> layer1_attn_agg
	layer1_pre_attn_norm -> layer1_qkv_gpu3
	layer1_qkv_gpu3 -> layer1_attn_gpu3
	layer1_attn_gpu3 -> layer1_out_proj_gpu3
	layer1_out_proj_gpu3 -> layer1_attn_agg
	layer1_pre_attn_norm -> layer1_qkv_gpu4
	layer1_qkv_gpu4 -> layer1_attn_gpu4
	layer1_attn_gpu4 -> layer1_out_proj_gpu4
	layer1_out_proj_gpu4 -> layer1_attn_agg
	layer1_pre_attn_norm -> layer1_qkv_gpu5
	layer1_qkv_gpu5 -> layer1_attn_gpu5
	layer1_attn_gpu5 -> layer1_out_proj_gpu5
	layer1_out_proj_gpu5 -> layer1_attn_agg
	layer1_pre_attn_norm -> layer1_qkv_gpu6
	layer1_qkv_gpu6 -> layer1_attn_gpu6
	layer1_attn_gpu6 -> layer1_out_proj_gpu6
	layer1_out_proj_gpu6 -> layer1_attn_agg
	layer1_pre_attn_norm -> layer1_qkv_gpu7
	layer1_qkv_gpu7 -> layer1_attn_gpu7
	layer1_attn_gpu7 -> layer1_out_proj_gpu7
	layer1_out_proj_gpu7 -> layer1_attn_agg
	layer1_pre_attn_norm -> layer1_qkv_gpu8
	layer1_qkv_gpu8 -> layer1_attn_gpu8
	layer1_attn_gpu8 -> layer1_out_proj_gpu8
	layer1_out_proj_gpu8 -> layer1_attn_agg
	layer1_pre_attn_norm -> layer1_qkv_gpu9
	layer1_qkv_gpu9 -> layer1_attn_gpu9
	layer1_attn_gpu9 -> layer1_out_proj_gpu9
	layer1_out_proj_gpu9 -> layer1_attn_agg
	layer1_pre_attn_norm -> layer1_qkv_gpu10
	layer1_qkv_gpu10 -> layer1_attn_gpu10
	layer1_attn_gpu10 -> layer1_out_proj_gpu10
	layer1_out_proj_gpu10 -> layer1_attn_agg
	layer1_pre_attn_norm -> layer1_qkv_gpu11
	layer1_qkv_gpu11 -> layer1_attn_gpu11
	layer1_attn_gpu11 -> layer1_out_proj_gpu11
	layer1_out_proj_gpu11 -> layer1_attn_agg
	layer1_attn_agg -> layer1_residual1
	layer0_residual2 -> layer1_residual1
	layer1_residual1 -> layer1_post_attn_norm
	layer1_post_attn_norm -> layer1_gate_gpu12 [color=blue style=dashed]
	layer1_post_attn_norm -> layer1_experts_gpu12
	layer1_gate_gpu12 -> layer1_experts_gpu12 [color=red style=dashed]
	layer1_experts_gpu12 -> layer1_moe_agg
	layer1_post_attn_norm -> layer1_gate_gpu13 [color=blue style=dashed]
	layer1_post_attn_norm -> layer1_experts_gpu13
	layer1_gate_gpu13 -> layer1_experts_gpu13 [color=red style=dashed]
	layer1_experts_gpu13 -> layer1_moe_agg
	layer1_post_attn_norm -> layer1_gate_gpu14 [color=blue style=dashed]
	layer1_post_attn_norm -> layer1_experts_gpu14
	layer1_gate_gpu14 -> layer1_experts_gpu14 [color=red style=dashed]
	layer1_experts_gpu14 -> layer1_moe_agg
	layer1_post_attn_norm -> layer1_gate_gpu15 [color=blue style=dashed]
	layer1_post_attn_norm -> layer1_experts_gpu15
	layer1_gate_gpu15 -> layer1_experts_gpu15 [color=red style=dashed]
	layer1_experts_gpu15 -> layer1_moe_agg
	layer1_moe_agg -> layer1_residual2
	layer1_residual1 -> layer1_residual2
	layer2_pre_attn_norm [label="Layer 2\nLayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu0 [label="GPU0\nQKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu0 [label="GPU0\nAttn Layer2\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_out_proj_gpu0 [label="GPU0\nOutProj Layer2\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu1 [label="GPU1\nQKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu1 [label="GPU1\nAttn Layer2\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_out_proj_gpu1 [label="GPU1\nOutProj Layer2\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu2 [label="GPU2\nQKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu2 [label="GPU2\nAttn Layer2\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_out_proj_gpu2 [label="GPU2\nOutProj Layer2\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu3 [label="GPU3\nQKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu3 [label="GPU3\nAttn Layer2\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_out_proj_gpu3 [label="GPU3\nOutProj Layer2\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu4 [label="GPU4\nQKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu4 [label="GPU4\nAttn Layer2\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_out_proj_gpu4 [label="GPU4\nOutProj Layer2\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu5 [label="GPU5\nQKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu5 [label="GPU5\nAttn Layer2\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_out_proj_gpu5 [label="GPU5\nOutProj Layer2\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu6 [label="GPU6\nQKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu6 [label="GPU6\nAttn Layer2\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_out_proj_gpu6 [label="GPU6\nOutProj Layer2\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu7 [label="GPU7\nQKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu7 [label="GPU7\nAttn Layer2\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_out_proj_gpu7 [label="GPU7\nOutProj Layer2\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu8 [label="GPU8\nQKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu8 [label="GPU8\nAttn Layer2\n[Input: [1024,2048,256], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_out_proj_gpu8 [label="GPU8\nOutProj Layer2\n[Input: [1024,2048,256], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu9 [label="GPU9\nQKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu9 [label="GPU9\nAttn Layer2\n[Input: [1024,2048,256], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_out_proj_gpu9 [label="GPU9\nOutProj Layer2\n[Input: [1024,2048,256], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu10 [label="GPU10\nQKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu10 [label="GPU10\nAttn Layer2\n[Input: [1024,2048,256], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_out_proj_gpu10 [label="GPU10\nOutProj Layer2\n[Input: [1024,2048,256], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu11 [label="GPU11\nQKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu11 [label="GPU11\nAttn Layer2\n[Input: [1024,2048,256], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_out_proj_gpu11 [label="GPU11\nOutProj Layer2\n[Input: [1024,2048,256], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_agg [label="Layer 2\nAttention\nAggregation\n[Input: 12Ã—[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FFF4E8" shape=parallelogram style="filled,rounded"]
	layer2_residual1 [label="Layer 2\nResidual Add\n[Input: 2Ã—[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FFF4E8" shape=parallelogram style="filled,rounded"]
	layer2_post_attn_norm [label="Layer 2\nPost-Attn LayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
	layer2_gate_gpu12 [label="GPU12\nGating Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,16]]" fillcolor="#FDE8E8" shape=parallelogram style=filled]
	layer2_experts_gpu12 [label="GPU12\nExperts 0-3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
	layer2_gate_gpu13 [label="GPU13\nGating Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,16]]" fillcolor="#FDE8E8" shape=parallelogram style=filled]
	layer2_experts_gpu13 [label="GPU13\nExperts 4-7\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
	layer2_gate_gpu14 [label="GPU14\nGating Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,16]]" fillcolor="#FDE8E8" shape=parallelogram style=filled]
	layer2_experts_gpu14 [label="GPU14\nExperts 8-11\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
	layer2_gate_gpu15 [label="GPU15\nGating Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,16]]" fillcolor="#FDE8E8" shape=parallelogram style=filled]
	layer2_experts_gpu15 [label="GPU15\nExperts 12-15\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
	layer2_moe_agg [label="Layer 2\nMoE\nAggregation\n[Input: 4Ã—[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FFF4E8" shape=parallelogram style="filled,rounded"]
	layer2_residual2 [label="Layer 2\nResidual Add\n[Input: 2Ã—[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FFF4E8" shape=parallelogram style="filled,rounded"]
	layer1_residual2 -> layer2_pre_attn_norm
	layer2_pre_attn_norm -> layer2_qkv_gpu0
	layer2_qkv_gpu0 -> layer2_attn_gpu0
	layer2_attn_gpu0 -> layer2_out_proj_gpu0
	layer2_out_proj_gpu0 -> layer2_attn_agg
	layer2_pre_attn_norm -> layer2_qkv_gpu1
	layer2_qkv_gpu1 -> layer2_attn_gpu1
	layer2_attn_gpu1 -> layer2_out_proj_gpu1
	layer2_out_proj_gpu1 -> layer2_attn_agg
	layer2_pre_attn_norm -> layer2_qkv_gpu2
	layer2_qkv_gpu2 -> layer2_attn_gpu2
	layer2_attn_gpu2 -> layer2_out_proj_gpu2
	layer2_out_proj_gpu2 -> layer2_attn_agg
	layer2_pre_attn_norm -> layer2_qkv_gpu3
	layer2_qkv_gpu3 -> layer2_attn_gpu3
	layer2_attn_gpu3 -> layer2_out_proj_gpu3
	layer2_out_proj_gpu3 -> layer2_attn_agg
	layer2_pre_attn_norm -> layer2_qkv_gpu4
	layer2_qkv_gpu4 -> layer2_attn_gpu4
	layer2_attn_gpu4 -> layer2_out_proj_gpu4
	layer2_out_proj_gpu4 -> layer2_attn_agg
	layer2_pre_attn_norm -> layer2_qkv_gpu5
	layer2_qkv_gpu5 -> layer2_attn_gpu5
	layer2_attn_gpu5 -> layer2_out_proj_gpu5
	layer2_out_proj_gpu5 -> layer2_attn_agg
	layer2_pre_attn_norm -> layer2_qkv_gpu6
	layer2_qkv_gpu6 -> layer2_attn_gpu6
	layer2_attn_gpu6 -> layer2_out_proj_gpu6
	layer2_out_proj_gpu6 -> layer2_attn_agg
	layer2_pre_attn_norm -> layer2_qkv_gpu7
	layer2_qkv_gpu7 -> layer2_attn_gpu7
	layer2_attn_gpu7 -> layer2_out_proj_gpu7
	layer2_out_proj_gpu7 -> layer2_attn_agg
	layer2_pre_attn_norm -> layer2_qkv_gpu8
	layer2_qkv_gpu8 -> layer2_attn_gpu8
	layer2_attn_gpu8 -> layer2_out_proj_gpu8
	layer2_out_proj_gpu8 -> layer2_attn_agg
	layer2_pre_attn_norm -> layer2_qkv_gpu9
	layer2_qkv_gpu9 -> layer2_attn_gpu9
	layer2_attn_gpu9 -> layer2_out_proj_gpu9
	layer2_out_proj_gpu9 -> layer2_attn_agg
	layer2_pre_attn_norm -> layer2_qkv_gpu10
	layer2_qkv_gpu10 -> layer2_attn_gpu10
	layer2_attn_gpu10 -> layer2_out_proj_gpu10
	layer2_out_proj_gpu10 -> layer2_attn_agg
	layer2_pre_attn_norm -> layer2_qkv_gpu11
	layer2_qkv_gpu11 -> layer2_attn_gpu11
	layer2_attn_gpu11 -> layer2_out_proj_gpu11
	layer2_out_proj_gpu11 -> layer2_attn_agg
	layer2_attn_agg -> layer2_residual1
	layer1_residual2 -> layer2_residual1
	layer2_residual1 -> layer2_post_attn_norm
	layer2_post_attn_norm -> layer2_gate_gpu12 [color=blue style=dashed]
	layer2_post_attn_norm -> layer2_experts_gpu12
	layer2_gate_gpu12 -> layer2_experts_gpu12 [color=red style=dashed]
	layer2_experts_gpu12 -> layer2_moe_agg
	layer2_post_attn_norm -> layer2_gate_gpu13 [color=blue style=dashed]
	layer2_post_attn_norm -> layer2_experts_gpu13
	layer2_gate_gpu13 -> layer2_experts_gpu13 [color=red style=dashed]
	layer2_experts_gpu13 -> layer2_moe_agg
	layer2_post_attn_norm -> layer2_gate_gpu14 [color=blue style=dashed]
	layer2_post_attn_norm -> layer2_experts_gpu14
	layer2_gate_gpu14 -> layer2_experts_gpu14 [color=red style=dashed]
	layer2_experts_gpu14 -> layer2_moe_agg
	layer2_post_attn_norm -> layer2_gate_gpu15 [color=blue style=dashed]
	layer2_post_attn_norm -> layer2_experts_gpu15
	layer2_gate_gpu15 -> layer2_experts_gpu15 [color=red style=dashed]
	layer2_experts_gpu15 -> layer2_moe_agg
	layer2_moe_agg -> layer2_residual2
	layer2_residual1 -> layer2_residual2
	layer3_pre_attn_norm [label="Layer 3\nLayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu0 [label="GPU0\nQKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu0 [label="GPU0\nAttn Layer3\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_out_proj_gpu0 [label="GPU0\nOutProj Layer3\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu1 [label="GPU1\nQKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu1 [label="GPU1\nAttn Layer3\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_out_proj_gpu1 [label="GPU1\nOutProj Layer3\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu2 [label="GPU2\nQKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu2 [label="GPU2\nAttn Layer3\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_out_proj_gpu2 [label="GPU2\nOutProj Layer3\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu3 [label="GPU3\nQKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu3 [label="GPU3\nAttn Layer3\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_out_proj_gpu3 [label="GPU3\nOutProj Layer3\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu4 [label="GPU4\nQKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu4 [label="GPU4\nAttn Layer3\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_out_proj_gpu4 [label="GPU4\nOutProj Layer3\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu5 [label="GPU5\nQKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu5 [label="GPU5\nAttn Layer3\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_out_proj_gpu5 [label="GPU5\nOutProj Layer3\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu6 [label="GPU6\nQKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu6 [label="GPU6\nAttn Layer3\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_out_proj_gpu6 [label="GPU6\nOutProj Layer3\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu7 [label="GPU7\nQKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu7 [label="GPU7\nAttn Layer3\n[Input: [1024,2048,384], Output: [1024,2048,384]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_out_proj_gpu7 [label="GPU7\nOutProj Layer3\n[Input: [1024,2048,384], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu8 [label="GPU8\nQKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu8 [label="GPU8\nAttn Layer3\n[Input: [1024,2048,256], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_out_proj_gpu8 [label="GPU8\nOutProj Layer3\n[Input: [1024,2048,256], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu9 [label="GPU9\nQKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu9 [label="GPU9\nAttn Layer3\n[Input: [1024,2048,256], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_out_proj_gpu9 [label="GPU9\nOutProj Layer3\n[Input: [1024,2048,256], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu10 [label="GPU10\nQKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu10 [label="GPU10\nAttn Layer3\n[Input: [1024,2048,256], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_out_proj_gpu10 [label="GPU10\nOutProj Layer3\n[Input: [1024,2048,256], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu11 [label="GPU11\nQKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu11 [label="GPU11\nAttn Layer3\n[Input: [1024,2048,256], Output: [1024,2048,256]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_out_proj_gpu11 [label="GPU11\nOutProj Layer3\n[Input: [1024,2048,256], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_agg [label="Layer 3\nAttention\nAggregation\n[Input: 12Ã—[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FFF4E8" shape=parallelogram style="filled,rounded"]
	layer3_residual1 [label="Layer 3\nResidual Add\n[Input: 2Ã—[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FFF4E8" shape=parallelogram style="filled,rounded"]
	layer3_post_attn_norm [label="Layer 3\nPost-Attn LayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
	layer3_gate_gpu12 [label="GPU12\nGating Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,16]]" fillcolor="#FDE8E8" shape=parallelogram style=filled]
	layer3_experts_gpu12 [label="GPU12\nExperts 0-3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
	layer3_gate_gpu13 [label="GPU13\nGating Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,16]]" fillcolor="#FDE8E8" shape=parallelogram style=filled]
	layer3_experts_gpu13 [label="GPU13\nExperts 4-7\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
	layer3_gate_gpu14 [label="GPU14\nGating Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,16]]" fillcolor="#FDE8E8" shape=parallelogram style=filled]
	layer3_experts_gpu14 [label="GPU14\nExperts 8-11\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
	layer3_gate_gpu15 [label="GPU15\nGating Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,16]]" fillcolor="#FDE8E8" shape=parallelogram style=filled]
	layer3_experts_gpu15 [label="GPU15\nExperts 12-15\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
	layer3_moe_agg [label="Layer 3\nMoE\nAggregation\n[Input: 4Ã—[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FFF4E8" shape=parallelogram style="filled,rounded"]
	layer3_residual2 [label="Layer 3\nResidual Add\n[Input: 2Ã—[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FFF4E8" shape=parallelogram style="filled,rounded"]
	layer2_residual2 -> layer3_pre_attn_norm
	layer3_pre_attn_norm -> layer3_qkv_gpu0
	layer3_qkv_gpu0 -> layer3_attn_gpu0
	layer3_attn_gpu0 -> layer3_out_proj_gpu0
	layer3_out_proj_gpu0 -> layer3_attn_agg
	layer3_pre_attn_norm -> layer3_qkv_gpu1
	layer3_qkv_gpu1 -> layer3_attn_gpu1
	layer3_attn_gpu1 -> layer3_out_proj_gpu1
	layer3_out_proj_gpu1 -> layer3_attn_agg
	layer3_pre_attn_norm -> layer3_qkv_gpu2
	layer3_qkv_gpu2 -> layer3_attn_gpu2
	layer3_attn_gpu2 -> layer3_out_proj_gpu2
	layer3_out_proj_gpu2 -> layer3_attn_agg
	layer3_pre_attn_norm -> layer3_qkv_gpu3
	layer3_qkv_gpu3 -> layer3_attn_gpu3
	layer3_attn_gpu3 -> layer3_out_proj_gpu3
	layer3_out_proj_gpu3 -> layer3_attn_agg
	layer3_pre_attn_norm -> layer3_qkv_gpu4
	layer3_qkv_gpu4 -> layer3_attn_gpu4
	layer3_attn_gpu4 -> layer3_out_proj_gpu4
	layer3_out_proj_gpu4 -> layer3_attn_agg
	layer3_pre_attn_norm -> layer3_qkv_gpu5
	layer3_qkv_gpu5 -> layer3_attn_gpu5
	layer3_attn_gpu5 -> layer3_out_proj_gpu5
	layer3_out_proj_gpu5 -> layer3_attn_agg
	layer3_pre_attn_norm -> layer3_qkv_gpu6
	layer3_qkv_gpu6 -> layer3_attn_gpu6
	layer3_attn_gpu6 -> layer3_out_proj_gpu6
	layer3_out_proj_gpu6 -> layer3_attn_agg
	layer3_pre_attn_norm -> layer3_qkv_gpu7
	layer3_qkv_gpu7 -> layer3_attn_gpu7
	layer3_attn_gpu7 -> layer3_out_proj_gpu7
	layer3_out_proj_gpu7 -> layer3_attn_agg
	layer3_pre_attn_norm -> layer3_qkv_gpu8
	layer3_qkv_gpu8 -> layer3_attn_gpu8
	layer3_attn_gpu8 -> layer3_out_proj_gpu8
	layer3_out_proj_gpu8 -> layer3_attn_agg
	layer3_pre_attn_norm -> layer3_qkv_gpu9
	layer3_qkv_gpu9 -> layer3_attn_gpu9
	layer3_attn_gpu9 -> layer3_out_proj_gpu9
	layer3_out_proj_gpu9 -> layer3_attn_agg
	layer3_pre_attn_norm -> layer3_qkv_gpu10
	layer3_qkv_gpu10 -> layer3_attn_gpu10
	layer3_attn_gpu10 -> layer3_out_proj_gpu10
	layer3_out_proj_gpu10 -> layer3_attn_agg
	layer3_pre_attn_norm -> layer3_qkv_gpu11
	layer3_qkv_gpu11 -> layer3_attn_gpu11
	layer3_attn_gpu11 -> layer3_out_proj_gpu11
	layer3_out_proj_gpu11 -> layer3_attn_agg
	layer3_attn_agg -> layer3_residual1
	layer2_residual2 -> layer3_residual1
	layer3_residual1 -> layer3_post_attn_norm
	layer3_post_attn_norm -> layer3_gate_gpu12 [color=blue style=dashed]
	layer3_post_attn_norm -> layer3_experts_gpu12
	layer3_gate_gpu12 -> layer3_experts_gpu12 [color=red style=dashed]
	layer3_experts_gpu12 -> layer3_moe_agg
	layer3_post_attn_norm -> layer3_gate_gpu13 [color=blue style=dashed]
	layer3_post_attn_norm -> layer3_experts_gpu13
	layer3_gate_gpu13 -> layer3_experts_gpu13 [color=red style=dashed]
	layer3_experts_gpu13 -> layer3_moe_agg
	layer3_post_attn_norm -> layer3_gate_gpu14 [color=blue style=dashed]
	layer3_post_attn_norm -> layer3_experts_gpu14
	layer3_gate_gpu14 -> layer3_experts_gpu14 [color=red style=dashed]
	layer3_experts_gpu14 -> layer3_moe_agg
	layer3_post_attn_norm -> layer3_gate_gpu15 [color=blue style=dashed]
	layer3_post_attn_norm -> layer3_experts_gpu15
	layer3_gate_gpu15 -> layer3_experts_gpu15 [color=red style=dashed]
	layer3_experts_gpu15 -> layer3_moe_agg
	layer3_moe_agg -> layer3_residual2
	layer3_residual1 -> layer3_residual2
	output [label="Output\n[batch_size=1024, seq_len=2048, hidden_dim=4096]" fillcolor="#D0E8FF" shape=ellipse style=filled]
	layer3_residual2 -> output
}
