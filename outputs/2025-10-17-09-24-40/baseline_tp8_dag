// Baseline TP=8: Tensor parallelism across 8 GPUs
digraph baseline_tp8_dag {
	graph [bgcolor=white fontname=Arial fontsize=12 rankdir=TB]
	node [fontname=Arial fontsize=10]
	input [label="Input\n[batch_size=1024, seq_len=2048, hidden_dim=4096]" fillcolor="#D0E8FF" shape=ellipse style=filled]
	embeddings [label="Token+Pos Embedding\n[Input: [1024,2048], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	input -> embeddings
	layer0_norm1 [label="Layer 0\nLayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_qkv_gpu0 [label="GPU0\nQKV Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_attn_gpu0 [label="GPU0\nAttn Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_output_gpu0 [label="GPU0\nOutput Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_qkv_gpu1 [label="GPU1\nQKV Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_attn_gpu1 [label="GPU1\nAttn Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_output_gpu1 [label="GPU1\nOutput Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_qkv_gpu2 [label="GPU2\nQKV Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_attn_gpu2 [label="GPU2\nAttn Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_output_gpu2 [label="GPU2\nOutput Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_qkv_gpu3 [label="GPU3\nQKV Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_attn_gpu3 [label="GPU3\nAttn Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_output_gpu3 [label="GPU3\nOutput Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_qkv_gpu4 [label="GPU4\nQKV Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_attn_gpu4 [label="GPU4\nAttn Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_output_gpu4 [label="GPU4\nOutput Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_qkv_gpu5 [label="GPU5\nQKV Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_attn_gpu5 [label="GPU5\nAttn Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_output_gpu5 [label="GPU5\nOutput Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_qkv_gpu6 [label="GPU6\nQKV Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_attn_gpu6 [label="GPU6\nAttn Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_output_gpu6 [label="GPU6\nOutput Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_qkv_gpu7 [label="GPU7\nQKV Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_attn_gpu7 [label="GPU7\nAttn Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_output_gpu7 [label="GPU7\nOutput Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_attn_allreduce [label="Layer 0\nAttention All-Reduce\n[Input: 8×[1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
	layer0_moe_qkv_gpu0 [label="GPU0\nMoE QKV Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_experts_gpu0 [label="GPU0\n2 Experts Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_output_gpu0 [label="GPU0\nMoE Output Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_qkv_gpu1 [label="GPU1\nMoE QKV Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_experts_gpu1 [label="GPU1\n2 Experts Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_output_gpu1 [label="GPU1\nMoE Output Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_qkv_gpu2 [label="GPU2\nMoE QKV Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_experts_gpu2 [label="GPU2\n2 Experts Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_output_gpu2 [label="GPU2\nMoE Output Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_qkv_gpu3 [label="GPU3\nMoE QKV Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_experts_gpu3 [label="GPU3\n2 Experts Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_output_gpu3 [label="GPU3\nMoE Output Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_qkv_gpu4 [label="GPU4\nMoE QKV Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_experts_gpu4 [label="GPU4\n2 Experts Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_output_gpu4 [label="GPU4\nMoE Output Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_qkv_gpu5 [label="GPU5\nMoE QKV Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_experts_gpu5 [label="GPU5\n2 Experts Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_output_gpu5 [label="GPU5\nMoE Output Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_qkv_gpu6 [label="GPU6\nMoE QKV Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_experts_gpu6 [label="GPU6\n2 Experts Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_output_gpu6 [label="GPU6\nMoE Output Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_qkv_gpu7 [label="GPU7\nMoE QKV Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_experts_gpu7 [label="GPU7\n2 Experts Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_output_gpu7 [label="GPU7\nMoE Output Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer0_moe_allreduce [label="Layer 0\nMoE All-Reduce\n[Input: 8×[1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
	layer1_norm1 [label="Layer 1\nLayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu0 [label="GPU0\nQKV Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu0 [label="GPU0\nAttn Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_output_gpu0 [label="GPU0\nOutput Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu1 [label="GPU1\nQKV Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu1 [label="GPU1\nAttn Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_output_gpu1 [label="GPU1\nOutput Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu2 [label="GPU2\nQKV Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu2 [label="GPU2\nAttn Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_output_gpu2 [label="GPU2\nOutput Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu3 [label="GPU3\nQKV Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu3 [label="GPU3\nAttn Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_output_gpu3 [label="GPU3\nOutput Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu4 [label="GPU4\nQKV Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu4 [label="GPU4\nAttn Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_output_gpu4 [label="GPU4\nOutput Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu5 [label="GPU5\nQKV Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu5 [label="GPU5\nAttn Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_output_gpu5 [label="GPU5\nOutput Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu6 [label="GPU6\nQKV Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu6 [label="GPU6\nAttn Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_output_gpu6 [label="GPU6\nOutput Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_qkv_gpu7 [label="GPU7\nQKV Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_gpu7 [label="GPU7\nAttn Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_output_gpu7 [label="GPU7\nOutput Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_attn_allreduce [label="Layer 1\nAttention All-Reduce\n[Input: 8×[1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
	layer1_moe_qkv_gpu0 [label="GPU0\nMoE QKV Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_experts_gpu0 [label="GPU0\n2 Experts Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_output_gpu0 [label="GPU0\nMoE Output Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_qkv_gpu1 [label="GPU1\nMoE QKV Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_experts_gpu1 [label="GPU1\n2 Experts Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_output_gpu1 [label="GPU1\nMoE Output Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_qkv_gpu2 [label="GPU2\nMoE QKV Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_experts_gpu2 [label="GPU2\n2 Experts Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_output_gpu2 [label="GPU2\nMoE Output Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_qkv_gpu3 [label="GPU3\nMoE QKV Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_experts_gpu3 [label="GPU3\n2 Experts Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_output_gpu3 [label="GPU3\nMoE Output Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_qkv_gpu4 [label="GPU4\nMoE QKV Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_experts_gpu4 [label="GPU4\n2 Experts Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_output_gpu4 [label="GPU4\nMoE Output Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_qkv_gpu5 [label="GPU5\nMoE QKV Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_experts_gpu5 [label="GPU5\n2 Experts Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_output_gpu5 [label="GPU5\nMoE Output Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_qkv_gpu6 [label="GPU6\nMoE QKV Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_experts_gpu6 [label="GPU6\n2 Experts Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_output_gpu6 [label="GPU6\nMoE Output Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_qkv_gpu7 [label="GPU7\nMoE QKV Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_experts_gpu7 [label="GPU7\n2 Experts Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_output_gpu7 [label="GPU7\nMoE Output Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer1_moe_allreduce [label="Layer 1\nMoE All-Reduce\n[Input: 8×[1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
	layer2_norm1 [label="Layer 2\nLayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu0 [label="GPU0\nQKV Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu0 [label="GPU0\nAttn Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_output_gpu0 [label="GPU0\nOutput Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu1 [label="GPU1\nQKV Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu1 [label="GPU1\nAttn Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_output_gpu1 [label="GPU1\nOutput Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu2 [label="GPU2\nQKV Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu2 [label="GPU2\nAttn Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_output_gpu2 [label="GPU2\nOutput Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu3 [label="GPU3\nQKV Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu3 [label="GPU3\nAttn Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_output_gpu3 [label="GPU3\nOutput Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu4 [label="GPU4\nQKV Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu4 [label="GPU4\nAttn Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_output_gpu4 [label="GPU4\nOutput Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu5 [label="GPU5\nQKV Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu5 [label="GPU5\nAttn Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_output_gpu5 [label="GPU5\nOutput Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu6 [label="GPU6\nQKV Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu6 [label="GPU6\nAttn Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_output_gpu6 [label="GPU6\nOutput Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_qkv_gpu7 [label="GPU7\nQKV Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_gpu7 [label="GPU7\nAttn Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_output_gpu7 [label="GPU7\nOutput Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_attn_allreduce [label="Layer 2\nAttention All-Reduce\n[Input: 8×[1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
	layer2_moe_qkv_gpu0 [label="GPU0\nMoE QKV Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_experts_gpu0 [label="GPU0\n2 Experts Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_output_gpu0 [label="GPU0\nMoE Output Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_qkv_gpu1 [label="GPU1\nMoE QKV Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_experts_gpu1 [label="GPU1\n2 Experts Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_output_gpu1 [label="GPU1\nMoE Output Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_qkv_gpu2 [label="GPU2\nMoE QKV Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_experts_gpu2 [label="GPU2\n2 Experts Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_output_gpu2 [label="GPU2\nMoE Output Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_qkv_gpu3 [label="GPU3\nMoE QKV Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_experts_gpu3 [label="GPU3\n2 Experts Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_output_gpu3 [label="GPU3\nMoE Output Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_qkv_gpu4 [label="GPU4\nMoE QKV Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_experts_gpu4 [label="GPU4\n2 Experts Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_output_gpu4 [label="GPU4\nMoE Output Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_qkv_gpu5 [label="GPU5\nMoE QKV Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_experts_gpu5 [label="GPU5\n2 Experts Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_output_gpu5 [label="GPU5\nMoE Output Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_qkv_gpu6 [label="GPU6\nMoE QKV Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_experts_gpu6 [label="GPU6\n2 Experts Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_output_gpu6 [label="GPU6\nMoE Output Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_qkv_gpu7 [label="GPU7\nMoE QKV Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_experts_gpu7 [label="GPU7\n2 Experts Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_output_gpu7 [label="GPU7\nMoE Output Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer2_moe_allreduce [label="Layer 2\nMoE All-Reduce\n[Input: 8×[1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
	layer3_norm1 [label="Layer 3\nLayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu0 [label="GPU0\nQKV Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu0 [label="GPU0\nAttn Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_output_gpu0 [label="GPU0\nOutput Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu1 [label="GPU1\nQKV Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu1 [label="GPU1\nAttn Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_output_gpu1 [label="GPU1\nOutput Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu2 [label="GPU2\nQKV Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu2 [label="GPU2\nAttn Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_output_gpu2 [label="GPU2\nOutput Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu3 [label="GPU3\nQKV Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu3 [label="GPU3\nAttn Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_output_gpu3 [label="GPU3\nOutput Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu4 [label="GPU4\nQKV Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu4 [label="GPU4\nAttn Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_output_gpu4 [label="GPU4\nOutput Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu5 [label="GPU5\nQKV Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu5 [label="GPU5\nAttn Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_output_gpu5 [label="GPU5\nOutput Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu6 [label="GPU6\nQKV Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu6 [label="GPU6\nAttn Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_output_gpu6 [label="GPU6\nOutput Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_qkv_gpu7 [label="GPU7\nQKV Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_gpu7 [label="GPU7\nAttn Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_output_gpu7 [label="GPU7\nOutput Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_attn_allreduce [label="Layer 3\nAttention All-Reduce\n[Input: 8×[1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
	layer3_moe_qkv_gpu0 [label="GPU0\nMoE QKV Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_experts_gpu0 [label="GPU0\n2 Experts Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_output_gpu0 [label="GPU0\nMoE Output Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_qkv_gpu1 [label="GPU1\nMoE QKV Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_experts_gpu1 [label="GPU1\n2 Experts Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_output_gpu1 [label="GPU1\nMoE Output Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_qkv_gpu2 [label="GPU2\nMoE QKV Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_experts_gpu2 [label="GPU2\n2 Experts Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_output_gpu2 [label="GPU2\nMoE Output Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_qkv_gpu3 [label="GPU3\nMoE QKV Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_experts_gpu3 [label="GPU3\n2 Experts Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_output_gpu3 [label="GPU3\nMoE Output Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_qkv_gpu4 [label="GPU4\nMoE QKV Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_experts_gpu4 [label="GPU4\n2 Experts Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_output_gpu4 [label="GPU4\nMoE Output Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_qkv_gpu5 [label="GPU5\nMoE QKV Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_experts_gpu5 [label="GPU5\n2 Experts Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_output_gpu5 [label="GPU5\nMoE Output Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_qkv_gpu6 [label="GPU6\nMoE QKV Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_experts_gpu6 [label="GPU6\n2 Experts Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_output_gpu6 [label="GPU6\nMoE Output Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_qkv_gpu7 [label="GPU7\nMoE QKV Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_experts_gpu7 [label="GPU7\n2 Experts Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_output_gpu7 [label="GPU7\nMoE Output Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
	layer3_moe_allreduce [label="Layer 3\nMoE All-Reduce\n[Input: 8×[1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
	output [label="Output\n[batch_size=1024, seq_len=2048, hidden_dim=4096]" fillcolor="#D0E8FF" shape=ellipse style=filled]
	embeddings -> layer0_norm1
	layer3_moe_allreduce -> output
}
