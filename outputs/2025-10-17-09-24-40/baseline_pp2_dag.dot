digraph baseline_pp2_dag {
	graph [bb="0,0,9364.2,160.43",
		bgcolor=white,
		fontname=Arial,
		fontsize=12,
		rankdir=TB
	];
	node [fontname=Arial,
		fontsize=10,
		label="\N"
	];
	subgraph stage0 {
		graph [label="Stage 0: GPUs 0-3, Layers 0-1"];
		s0_embedding	[fillcolor="#E8F4FD",
			height=0.5,
			label="Embedding\n[Input: [1024,2048], Output: [1024,2048,4096]]",
			pos="173.95,21.213",
			shape=rectangle,
			style=filled,
			width=3.0278];
		s0_layer0_norm1	[fillcolor="#E8F4FD",
			height=0.56944,
			label="Layer 0\nLayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]",
			pos="486.95,119.43",
			shape=rectangle,
			style=filled,
			width=3.3611];
		s0_layer0_attn	[fillcolor="#E8F4FD",
			height=0.56944,
			label="Layer 0\nAttention\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]",
			pos="746.95,119.43",
			shape=rectangle,
			style=filled,
			width=3.3611];
		s0_layer0_residual1	[fillcolor="#E8FDE8",
			height=1.1389,
			label="Layer 0\nResidual Add\n[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]",
			pos="1147.9,119.43",
			shape=parallelogram,
			style="filled,rounded",
			width=7.2861];
		s0_layer0_norm2	[fillcolor="#E8F4FD",
			height=0.56944,
			label="Layer 0\nLayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]",
			pos="1548.9,119.43",
			shape=rectangle,
			style=filled,
			width=3.3611];
		s0_layer0_moe	[fillcolor="#E8F4FD",
			height=0.56944,
			label="Layer 0\nMoE (8 experts)\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]",
			pos="1808.9,119.43",
			shape=rectangle,
			style=filled,
			width=3.3611];
		s0_layer0_residual2	[fillcolor="#E8FDE8",
			height=1.1389,
			label="Layer 0\nResidual Add\n[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]",
			pos="2209.9,119.43",
			shape=parallelogram,
			style="filled,rounded",
			width=7.2861];
		s0_layer1_norm1	[fillcolor="#E8F4FD",
			height=0.56944,
			label="Layer 1\nLayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]",
			pos="2610.9,119.43",
			shape=rectangle,
			style=filled,
			width=3.3611];
		s0_layer1_attn	[fillcolor="#E8F4FD",
			height=0.56944,
			label="Layer 1\nAttention\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]",
			pos="2870.9,119.43",
			shape=rectangle,
			style=filled,
			width=3.3611];
		s0_layer1_residual1	[fillcolor="#E8FDE8",
			height=1.1389,
			label="Layer 1\nResidual Add\n[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]",
			pos="3271.9,119.43",
			shape=parallelogram,
			style="filled,rounded",
			width=7.2861];
		s0_layer1_norm2	[fillcolor="#E8F4FD",
			height=0.56944,
			label="Layer 1\nLayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]",
			pos="3672.9,119.43",
			shape=rectangle,
			style=filled,
			width=3.3611];
		s0_layer1_moe	[fillcolor="#E8F4FD",
			height=0.56944,
			label="Layer 1\nMoE (8 experts)\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]",
			pos="3932.9,119.43",
			shape=rectangle,
			style=filled,
			width=3.3611];
		s0_layer1_residual2	[fillcolor="#E8FDE8",
			height=1.1389,
			label="Layer 1\nResidual Add\n[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]",
			pos="4333.9,119.43",
			shape=parallelogram,
			style="filled,rounded",
			width=7.2861];
	}
	subgraph stage1 {
		graph [label="Stage 1: GPUs 4-7, Layers 2-3"];
		s1_layer2_norm1	[fillcolor="#FDE8E8",
			height=0.56944,
			label="Layer 2\nLayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]",
			pos="5254.9,119.43",
			shape=rectangle,
			style=filled,
			width=3.3611];
		s1_layer2_attn	[fillcolor="#FDE8E8",
			height=0.56944,
			label="Layer 2\nAttention\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]",
			pos="5514.9,119.43",
			shape=rectangle,
			style=filled,
			width=3.3611];
		s1_layer2_residual1	[fillcolor="#E8FDE8",
			height=1.1389,
			label="Layer 2\nResidual Add\n[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]",
			pos="5915.9,119.43",
			shape=parallelogram,
			style="filled,rounded",
			width=7.2861];
		s1_layer2_norm2	[fillcolor="#FDE8E8",
			height=0.56944,
			label="Layer 2\nLayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]",
			pos="6316.9,119.43",
			shape=rectangle,
			style=filled,
			width=3.3611];
		s1_layer2_moe	[fillcolor="#FDE8E8",
			height=0.56944,
			label="Layer 2\nMoE (8 experts)\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]",
			pos="6576.9,119.43",
			shape=rectangle,
			style=filled,
			width=3.3611];
		s1_layer2_residual2	[fillcolor="#E8FDE8",
			height=1.1389,
			label="Layer 2\nResidual Add\n[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]",
			pos="6977.9,119.43",
			shape=parallelogram,
			style="filled,rounded",
			width=7.2861];
		s1_layer3_norm1	[fillcolor="#FDE8E8",
			height=0.56944,
			label="Layer 3\nLayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]",
			pos="7378.9,119.43",
			shape=rectangle,
			style=filled,
			width=3.3611];
		s1_layer3_attn	[fillcolor="#FDE8E8",
			height=0.56944,
			label="Layer 3\nAttention\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]",
			pos="7638.9,119.43",
			shape=rectangle,
			style=filled,
			width=3.3611];
		s1_layer3_residual1	[fillcolor="#E8FDE8",
			height=1.1389,
			label="Layer 3\nResidual Add\n[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]",
			pos="8039.9,119.43",
			shape=parallelogram,
			style="filled,rounded",
			width=7.2861];
		s1_layer3_norm2	[fillcolor="#FDE8E8",
			height=0.56944,
			label="Layer 3\nLayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]",
			pos="8440.9,119.43",
			shape=rectangle,
			style=filled,
			width=3.3611];
		s1_layer3_moe	[fillcolor="#FDE8E8",
			height=0.56944,
			label="Layer 3\nMoE (8 experts)\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]",
			pos="8700.9,119.43",
			shape=rectangle,
			style=filled,
			width=3.3611];
		s1_layer3_residual2	[fillcolor="#E8FDE8",
			height=1.1389,
			label="Layer 3\nResidual Add\n[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]",
			pos="9101.9,119.43",
			shape=parallelogram,
			style="filled,rounded",
			width=7.2861];
	}
	input	[fillcolor="#D0E8FF",
		height=0.58926,
		label="Input\n[batch_size=1024, seq_len=2048, hidden_dim=4096]",
		pos="173.95,119.43",
		shape=ellipse,
		style=filled,
		width=4.8319];
	input -> s0_embedding	[pos="e,173.95,39.373 173.95,98.022 173.95,83.859 173.95,64.837 173.95,49.391"];
	pipeline_send	[fillcolor="#E8FDE8",
		height=0.83333,
		label="Pipeline Send\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]",
		pos="4864.9,119.43",
		shape=parallelogram,
		style="filled,rounded",
		width=6.9693];
	output	[fillcolor="#D0E8FF",
		height=0.58926,
		label="Output\n[batch_size=1024, seq_len=2048, hidden_dim=4096]",
		pos="9101.9,21.213",
		shape=ellipse,
		style=filled,
		width=4.8319];
	s1_layer3_residual2 -> output	[pos="e,9101.9,42.614 9101.9,78.181 9101.9,69.659 9101.9,60.8 9101.9,52.711"];
}
