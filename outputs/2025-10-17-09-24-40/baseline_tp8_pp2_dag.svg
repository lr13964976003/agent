<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: baseline_tp8_pp2_dag Pages: 1 -->
<svg width="54857pt" height="712pt"
 viewBox="0.00 0.00 54857.30 712.43" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 708.43)">
<title>baseline_tp8_pp2_dag</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-708.43 54853.3,-708.43 54853.3,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="#d0e8ff" stroke="black" cx="1588" cy="-663.43" rx="173.9" ry="21.43"/>
<text text-anchor="middle" x="1588" y="-666.43" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="1588" y="-655.43" font-family="Arial" font-size="10.00">[batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- stage0_embedding -->
<g id="node2" class="node">
<title>stage0_embedding</title>
<polygon fill="#e8f4fd" stroke="black" points="1697,-583.21 1479,-583.21 1479,-547.21 1697,-547.21 1697,-583.21"/>
<text text-anchor="middle" x="1588" y="-568.21" font-family="Arial" font-size="10.00">Token+Pos Embedding</text>
<text text-anchor="middle" x="1588" y="-557.21" font-family="Arial" font-size="10.00">[Input: [1024,2048], Output: [1024,2048,4096]]</text>
</g>
<!-- input&#45;&gt;stage0_embedding -->
<g id="edge1" class="edge">
<title>input&#45;&gt;stage0_embedding</title>
<path fill="none" stroke="black" d="M1588,-642.02C1588,-627.86 1588,-608.84 1588,-593.39"/>
<polygon fill="black" stroke="black" points="1591.5,-593.37 1588,-583.37 1584.5,-593.37 1591.5,-593.37"/>
</g>
<!-- stage0_layer0_norm1 -->
<g id="node3" class="node">
<title>stage0_layer0_norm1</title>
<polygon fill="#e8f4fd" stroke="black" points="1255,-508 1013,-508 1013,-467 1255,-467 1255,-508"/>
<text text-anchor="middle" x="1134" y="-496" font-family="Arial" font-size="10.00">Layer 0</text>
<text text-anchor="middle" x="1134" y="-485" font-family="Arial" font-size="10.00">Pre&#45;Attn LayerNorm</text>
<text text-anchor="middle" x="1134" y="-474" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_embedding&#45;&gt;stage0_layer0_norm1 -->
<g id="edge2" class="edge">
<title>stage0_embedding&#45;&gt;stage0_layer0_norm1</title>
<path fill="none" stroke="black" d="M1485.83,-547.17C1419.28,-536.08 1331.94,-521.51 1260.94,-509.67"/>
<polygon fill="black" stroke="black" points="1261.47,-506.21 1251.03,-508.02 1260.32,-513.12 1261.47,-506.21"/>
</g>
<!-- stage0_layer0_residual1 -->
<g id="node29" class="node">
<title>stage0_layer0_residual1</title>
<path fill="#e8fde8" stroke="black" d="M1838.1,-82C1838.1,-82 1445.16,-82 1445.16,-82 1439.16,-82 1428.39,-78.36 1423.63,-74.71 1423.63,-74.71 1335.44,-7.29 1335.44,-7.29 1330.67,-3.64 1331.9,0 1337.9,0 1337.9,0 1730.84,0 1730.84,0 1736.84,0 1747.61,-3.64 1752.37,-7.29 1752.37,-7.29 1840.56,-74.71 1840.56,-74.71 1845.33,-78.36 1844.1,-82 1838.1,-82"/>
<text text-anchor="middle" x="1588" y="-49.5" font-family="Arial" font-size="10.00">Layer 0</text>
<text text-anchor="middle" x="1588" y="-38.5" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="1588" y="-27.5" font-family="Arial" font-size="10.00">[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_embedding&#45;&gt;stage0_layer0_residual1 -->
<g id="edge36" class="edge">
<title>stage0_embedding&#45;&gt;stage0_layer0_residual1</title>
<path fill="none" stroke="black" d="M1697.03,-549.65C1831.36,-528.59 2042,-484 2042,-411.5 2042,-411.5 2042,-411.5 2042,-255.5 2042,-153.51 1947.02,-100.15 1843.94,-72.28"/>
<polygon fill="black" stroke="black" points="1844.83,-68.89 1834.27,-69.74 1843.05,-75.66 1844.83,-68.89"/>
</g>
<!-- stage0_layer0_qkv_gpu0 -->
<g id="node4" class="node">
<title>stage0_layer0_qkv_gpu0</title>
<polygon fill="#e8f4fd" stroke="black" points="236,-431 0,-431 0,-390 236,-390 236,-431"/>
<text text-anchor="middle" x="118" y="-419" font-family="Arial" font-size="10.00">GPU0</text>
<text text-anchor="middle" x="118" y="-408" font-family="Arial" font-size="10.00">QKV Proj Layer0</text>
<text text-anchor="middle" x="118" y="-397" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer0_norm1&#45;&gt;stage0_layer0_qkv_gpu0 -->
<g id="edge3" class="edge">
<title>stage0_layer0_norm1&#45;&gt;stage0_layer0_qkv_gpu0</title>
<path fill="none" stroke="black" d="M1012.92,-482.4C843.57,-475.88 526.22,-460.85 246.2,-431.08"/>
<polygon fill="black" stroke="black" points="246.57,-427.6 236.26,-430.01 245.83,-434.56 246.57,-427.6"/>
</g>
<!-- stage0_layer0_qkv_gpu1 -->
<g id="node7" class="node">
<title>stage0_layer0_qkv_gpu1</title>
<polygon fill="#e8f4fd" stroke="black" points="490,-431 254,-431 254,-390 490,-390 490,-431"/>
<text text-anchor="middle" x="372" y="-419" font-family="Arial" font-size="10.00">GPU1</text>
<text text-anchor="middle" x="372" y="-408" font-family="Arial" font-size="10.00">QKV Proj Layer0</text>
<text text-anchor="middle" x="372" y="-397" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer0_norm1&#45;&gt;stage0_layer0_qkv_gpu1 -->
<g id="edge7" class="edge">
<title>stage0_layer0_norm1&#45;&gt;stage0_layer0_qkv_gpu1</title>
<path fill="none" stroke="black" d="M1012.91,-478.27C887.27,-469.2 684.88,-453.07 500.43,-431.13"/>
<polygon fill="black" stroke="black" points="500.61,-427.63 490.27,-429.92 499.78,-434.58 500.61,-427.63"/>
</g>
<!-- stage0_layer0_qkv_gpu2 -->
<g id="node10" class="node">
<title>stage0_layer0_qkv_gpu2</title>
<polygon fill="#e8f4fd" stroke="black" points="744,-431 508,-431 508,-390 744,-390 744,-431"/>
<text text-anchor="middle" x="626" y="-419" font-family="Arial" font-size="10.00">GPU2</text>
<text text-anchor="middle" x="626" y="-408" font-family="Arial" font-size="10.00">QKV Proj Layer0</text>
<text text-anchor="middle" x="626" y="-397" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer0_norm1&#45;&gt;stage0_layer0_qkv_gpu2 -->
<g id="edge11" class="edge">
<title>stage0_layer0_norm1&#45;&gt;stage0_layer0_qkv_gpu2</title>
<path fill="none" stroke="black" d="M1012.99,-469.12C940.72,-458.67 846.8,-445.01 754.39,-431.2"/>
<polygon fill="black" stroke="black" points="754.71,-427.71 744.3,-429.69 753.67,-434.63 754.71,-427.71"/>
</g>
<!-- stage0_layer0_qkv_gpu3 -->
<g id="node13" class="node">
<title>stage0_layer0_qkv_gpu3</title>
<polygon fill="#e8f4fd" stroke="black" points="998,-431 762,-431 762,-390 998,-390 998,-431"/>
<text text-anchor="middle" x="880" y="-419" font-family="Arial" font-size="10.00">GPU3</text>
<text text-anchor="middle" x="880" y="-408" font-family="Arial" font-size="10.00">QKV Proj Layer0</text>
<text text-anchor="middle" x="880" y="-397" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer0_norm1&#45;&gt;stage0_layer0_qkv_gpu3 -->
<g id="edge15" class="edge">
<title>stage0_layer0_norm1&#45;&gt;stage0_layer0_qkv_gpu3</title>
<path fill="none" stroke="black" d="M1067.93,-466.99C1033.67,-456.87 991.65,-444.47 956.04,-433.95"/>
<polygon fill="black" stroke="black" points="956.76,-430.52 946.18,-431.04 954.78,-437.23 956.76,-430.52"/>
</g>
<!-- stage0_layer0_qkv_gpu4 -->
<g id="node16" class="node">
<title>stage0_layer0_qkv_gpu4</title>
<polygon fill="#e8f4fd" stroke="black" points="1252,-431 1016,-431 1016,-390 1252,-390 1252,-431"/>
<text text-anchor="middle" x="1134" y="-419" font-family="Arial" font-size="10.00">GPU4</text>
<text text-anchor="middle" x="1134" y="-408" font-family="Arial" font-size="10.00">QKV Proj Layer0</text>
<text text-anchor="middle" x="1134" y="-397" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer0_norm1&#45;&gt;stage0_layer0_qkv_gpu4 -->
<g id="edge19" class="edge">
<title>stage0_layer0_norm1&#45;&gt;stage0_layer0_qkv_gpu4</title>
<path fill="none" stroke="black" d="M1134,-466.79C1134,-458.96 1134,-449.77 1134,-441.16"/>
<polygon fill="black" stroke="black" points="1137.5,-441.07 1134,-431.07 1130.5,-441.07 1137.5,-441.07"/>
</g>
<!-- stage0_layer0_qkv_gpu5 -->
<g id="node19" class="node">
<title>stage0_layer0_qkv_gpu5</title>
<polygon fill="#e8f4fd" stroke="black" points="1506,-431 1270,-431 1270,-390 1506,-390 1506,-431"/>
<text text-anchor="middle" x="1388" y="-419" font-family="Arial" font-size="10.00">GPU5</text>
<text text-anchor="middle" x="1388" y="-408" font-family="Arial" font-size="10.00">QKV Proj Layer0</text>
<text text-anchor="middle" x="1388" y="-397" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer0_norm1&#45;&gt;stage0_layer0_qkv_gpu5 -->
<g id="edge23" class="edge">
<title>stage0_layer0_norm1&#45;&gt;stage0_layer0_qkv_gpu5</title>
<path fill="none" stroke="black" d="M1200.07,-466.99C1234.33,-456.87 1276.35,-444.47 1311.96,-433.95"/>
<polygon fill="black" stroke="black" points="1313.22,-437.23 1321.82,-431.04 1311.24,-430.52 1313.22,-437.23"/>
</g>
<!-- stage0_layer0_qkv_gpu6 -->
<g id="node22" class="node">
<title>stage0_layer0_qkv_gpu6</title>
<polygon fill="#e8f4fd" stroke="black" points="1760,-431 1524,-431 1524,-390 1760,-390 1760,-431"/>
<text text-anchor="middle" x="1642" y="-419" font-family="Arial" font-size="10.00">GPU6</text>
<text text-anchor="middle" x="1642" y="-408" font-family="Arial" font-size="10.00">QKV Proj Layer0</text>
<text text-anchor="middle" x="1642" y="-397" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer0_norm1&#45;&gt;stage0_layer0_qkv_gpu6 -->
<g id="edge27" class="edge">
<title>stage0_layer0_norm1&#45;&gt;stage0_layer0_qkv_gpu6</title>
<path fill="none" stroke="black" d="M1255.01,-469.12C1327.28,-458.67 1421.2,-445.01 1513.61,-431.2"/>
<polygon fill="black" stroke="black" points="1514.33,-434.63 1523.7,-429.69 1513.29,-427.71 1514.33,-434.63"/>
</g>
<!-- stage0_layer0_qkv_gpu7 -->
<g id="node25" class="node">
<title>stage0_layer0_qkv_gpu7</title>
<polygon fill="#e8f4fd" stroke="black" points="2014,-431 1778,-431 1778,-390 2014,-390 2014,-431"/>
<text text-anchor="middle" x="1896" y="-419" font-family="Arial" font-size="10.00">GPU7</text>
<text text-anchor="middle" x="1896" y="-408" font-family="Arial" font-size="10.00">QKV Proj Layer0</text>
<text text-anchor="middle" x="1896" y="-397" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer0_norm1&#45;&gt;stage0_layer0_qkv_gpu7 -->
<g id="edge31" class="edge">
<title>stage0_layer0_norm1&#45;&gt;stage0_layer0_qkv_gpu7</title>
<path fill="none" stroke="black" d="M1255.09,-478.27C1380.73,-469.2 1583.12,-453.07 1767.57,-431.13"/>
<polygon fill="black" stroke="black" points="1768.22,-434.58 1777.73,-429.92 1767.39,-427.63 1768.22,-434.58"/>
</g>
<!-- stage0_layer0_attn_gpu0 -->
<g id="node5" class="node">
<title>stage0_layer0_attn_gpu0</title>
<polygon fill="#e8f4fd" stroke="black" points="233.5,-354 2.5,-354 2.5,-313 233.5,-313 233.5,-354"/>
<text text-anchor="middle" x="118" y="-342" font-family="Arial" font-size="10.00">GPU0</text>
<text text-anchor="middle" x="118" y="-331" font-family="Arial" font-size="10.00">Attn Layer0</text>
<text text-anchor="middle" x="118" y="-320" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer0_qkv_gpu0&#45;&gt;stage0_layer0_attn_gpu0 -->
<g id="edge4" class="edge">
<title>stage0_layer0_qkv_gpu0&#45;&gt;stage0_layer0_attn_gpu0</title>
<path fill="none" stroke="black" d="M118,-389.79C118,-381.96 118,-372.77 118,-364.16"/>
<polygon fill="black" stroke="black" points="121.5,-364.07 118,-354.07 114.5,-364.07 121.5,-364.07"/>
</g>
<!-- stage0_layer0_out_gpu0 -->
<g id="node6" class="node">
<title>stage0_layer0_out_gpu0</title>
<polygon fill="#e8f4fd" stroke="black" points="236,-277 0,-277 0,-236 236,-236 236,-277"/>
<text text-anchor="middle" x="118" y="-265" font-family="Arial" font-size="10.00">GPU0</text>
<text text-anchor="middle" x="118" y="-254" font-family="Arial" font-size="10.00">Output Proj Layer0</text>
<text text-anchor="middle" x="118" y="-243" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_attn_gpu0&#45;&gt;stage0_layer0_out_gpu0 -->
<g id="edge5" class="edge">
<title>stage0_layer0_attn_gpu0&#45;&gt;stage0_layer0_out_gpu0</title>
<path fill="none" stroke="black" d="M118,-312.79C118,-304.96 118,-295.77 118,-287.16"/>
<polygon fill="black" stroke="black" points="121.5,-287.07 118,-277.07 114.5,-287.07 121.5,-287.07"/>
</g>
<!-- stage0_layer0_attn_allreduce -->
<g id="node28" class="node">
<title>stage0_layer0_attn_allreduce</title>
<path fill="#e8fde8" stroke="black" d="M1384.1,-200C1384.1,-200 991.16,-200 991.16,-200 985.16,-200 974.39,-196.36 969.63,-192.71 969.63,-192.71 881.44,-125.29 881.44,-125.29 876.67,-121.64 877.9,-118 883.9,-118 883.9,-118 1276.84,-118 1276.84,-118 1282.84,-118 1293.61,-121.64 1298.37,-125.29 1298.37,-125.29 1386.56,-192.71 1386.56,-192.71 1391.33,-196.36 1390.1,-200 1384.1,-200"/>
<text text-anchor="middle" x="1134" y="-167.5" font-family="Arial" font-size="10.00">Layer 0</text>
<text text-anchor="middle" x="1134" y="-156.5" font-family="Arial" font-size="10.00">Attention All&#45;Reduce</text>
<text text-anchor="middle" x="1134" y="-145.5" font-family="Arial" font-size="10.00">[Input: 8×[1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_out_gpu0&#45;&gt;stage0_layer0_attn_allreduce -->
<g id="edge6" class="edge">
<title>stage0_layer0_out_gpu0&#45;&gt;stage0_layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M236.27,-237.07C239.21,-236.7 242.12,-236.34 245,-236 480.68,-207.86 752.72,-186.18 933.16,-173.31"/>
<polygon fill="black" stroke="black" points="933.57,-176.79 943.3,-172.59 933.07,-169.81 933.57,-176.79"/>
</g>
<!-- stage0_layer0_attn_gpu1 -->
<g id="node8" class="node">
<title>stage0_layer0_attn_gpu1</title>
<polygon fill="#e8f4fd" stroke="black" points="487.5,-354 256.5,-354 256.5,-313 487.5,-313 487.5,-354"/>
<text text-anchor="middle" x="372" y="-342" font-family="Arial" font-size="10.00">GPU1</text>
<text text-anchor="middle" x="372" y="-331" font-family="Arial" font-size="10.00">Attn Layer0</text>
<text text-anchor="middle" x="372" y="-320" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer0_qkv_gpu1&#45;&gt;stage0_layer0_attn_gpu1 -->
<g id="edge8" class="edge">
<title>stage0_layer0_qkv_gpu1&#45;&gt;stage0_layer0_attn_gpu1</title>
<path fill="none" stroke="black" d="M372,-389.79C372,-381.96 372,-372.77 372,-364.16"/>
<polygon fill="black" stroke="black" points="375.5,-364.07 372,-354.07 368.5,-364.07 375.5,-364.07"/>
</g>
<!-- stage0_layer0_out_gpu1 -->
<g id="node9" class="node">
<title>stage0_layer0_out_gpu1</title>
<polygon fill="#e8f4fd" stroke="black" points="490,-277 254,-277 254,-236 490,-236 490,-277"/>
<text text-anchor="middle" x="372" y="-265" font-family="Arial" font-size="10.00">GPU1</text>
<text text-anchor="middle" x="372" y="-254" font-family="Arial" font-size="10.00">Output Proj Layer0</text>
<text text-anchor="middle" x="372" y="-243" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_attn_gpu1&#45;&gt;stage0_layer0_out_gpu1 -->
<g id="edge9" class="edge">
<title>stage0_layer0_attn_gpu1&#45;&gt;stage0_layer0_out_gpu1</title>
<path fill="none" stroke="black" d="M372,-312.79C372,-304.96 372,-295.77 372,-287.16"/>
<polygon fill="black" stroke="black" points="375.5,-287.07 372,-277.07 368.5,-287.07 375.5,-287.07"/>
</g>
<!-- stage0_layer0_out_gpu1&#45;&gt;stage0_layer0_attn_allreduce -->
<g id="edge10" class="edge">
<title>stage0_layer0_out_gpu1&#45;&gt;stage0_layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M490.28,-237.21C493.22,-236.8 496.13,-236.39 499,-236 647.75,-215.68 816.51,-195.63 942.65,-181.22"/>
<polygon fill="black" stroke="black" points="943.26,-184.68 952.8,-180.07 942.47,-177.72 943.26,-184.68"/>
</g>
<!-- stage0_layer0_attn_gpu2 -->
<g id="node11" class="node">
<title>stage0_layer0_attn_gpu2</title>
<polygon fill="#e8f4fd" stroke="black" points="741.5,-354 510.5,-354 510.5,-313 741.5,-313 741.5,-354"/>
<text text-anchor="middle" x="626" y="-342" font-family="Arial" font-size="10.00">GPU2</text>
<text text-anchor="middle" x="626" y="-331" font-family="Arial" font-size="10.00">Attn Layer0</text>
<text text-anchor="middle" x="626" y="-320" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer0_qkv_gpu2&#45;&gt;stage0_layer0_attn_gpu2 -->
<g id="edge12" class="edge">
<title>stage0_layer0_qkv_gpu2&#45;&gt;stage0_layer0_attn_gpu2</title>
<path fill="none" stroke="black" d="M626,-389.79C626,-381.96 626,-372.77 626,-364.16"/>
<polygon fill="black" stroke="black" points="629.5,-364.07 626,-354.07 622.5,-364.07 629.5,-364.07"/>
</g>
<!-- stage0_layer0_out_gpu2 -->
<g id="node12" class="node">
<title>stage0_layer0_out_gpu2</title>
<polygon fill="#e8f4fd" stroke="black" points="744,-277 508,-277 508,-236 744,-236 744,-277"/>
<text text-anchor="middle" x="626" y="-265" font-family="Arial" font-size="10.00">GPU2</text>
<text text-anchor="middle" x="626" y="-254" font-family="Arial" font-size="10.00">Output Proj Layer0</text>
<text text-anchor="middle" x="626" y="-243" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_attn_gpu2&#45;&gt;stage0_layer0_out_gpu2 -->
<g id="edge13" class="edge">
<title>stage0_layer0_attn_gpu2&#45;&gt;stage0_layer0_out_gpu2</title>
<path fill="none" stroke="black" d="M626,-312.79C626,-304.96 626,-295.77 626,-287.16"/>
<polygon fill="black" stroke="black" points="629.5,-287.07 626,-277.07 622.5,-287.07 629.5,-287.07"/>
</g>
<!-- stage0_layer0_out_gpu2&#45;&gt;stage0_layer0_attn_allreduce -->
<g id="edge14" class="edge">
<title>stage0_layer0_out_gpu2&#45;&gt;stage0_layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M730.03,-235.94C795.45,-223.64 881.55,-207.46 957.45,-193.19"/>
<polygon fill="black" stroke="black" points="958.43,-196.57 967.61,-191.28 957.14,-189.69 958.43,-196.57"/>
</g>
<!-- stage0_layer0_attn_gpu3 -->
<g id="node14" class="node">
<title>stage0_layer0_attn_gpu3</title>
<polygon fill="#e8f4fd" stroke="black" points="995.5,-354 764.5,-354 764.5,-313 995.5,-313 995.5,-354"/>
<text text-anchor="middle" x="880" y="-342" font-family="Arial" font-size="10.00">GPU3</text>
<text text-anchor="middle" x="880" y="-331" font-family="Arial" font-size="10.00">Attn Layer0</text>
<text text-anchor="middle" x="880" y="-320" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer0_qkv_gpu3&#45;&gt;stage0_layer0_attn_gpu3 -->
<g id="edge16" class="edge">
<title>stage0_layer0_qkv_gpu3&#45;&gt;stage0_layer0_attn_gpu3</title>
<path fill="none" stroke="black" d="M880,-389.79C880,-381.96 880,-372.77 880,-364.16"/>
<polygon fill="black" stroke="black" points="883.5,-364.07 880,-354.07 876.5,-364.07 883.5,-364.07"/>
</g>
<!-- stage0_layer0_out_gpu3 -->
<g id="node15" class="node">
<title>stage0_layer0_out_gpu3</title>
<polygon fill="#e8f4fd" stroke="black" points="998,-277 762,-277 762,-236 998,-236 998,-277"/>
<text text-anchor="middle" x="880" y="-265" font-family="Arial" font-size="10.00">GPU3</text>
<text text-anchor="middle" x="880" y="-254" font-family="Arial" font-size="10.00">Output Proj Layer0</text>
<text text-anchor="middle" x="880" y="-243" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_attn_gpu3&#45;&gt;stage0_layer0_out_gpu3 -->
<g id="edge17" class="edge">
<title>stage0_layer0_attn_gpu3&#45;&gt;stage0_layer0_out_gpu3</title>
<path fill="none" stroke="black" d="M880,-312.79C880,-304.96 880,-295.77 880,-287.16"/>
<polygon fill="black" stroke="black" points="883.5,-287.07 880,-277.07 876.5,-287.07 883.5,-287.07"/>
</g>
<!-- stage0_layer0_out_gpu3&#45;&gt;stage0_layer0_attn_allreduce -->
<g id="edge18" class="edge">
<title>stage0_layer0_out_gpu3&#45;&gt;stage0_layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M932.01,-235.94C956.9,-226.59 987.76,-214.98 1017.82,-203.68"/>
<polygon fill="black" stroke="black" points="1019.41,-206.82 1027.54,-200.03 1016.95,-200.27 1019.41,-206.82"/>
</g>
<!-- stage0_layer0_attn_gpu4 -->
<g id="node17" class="node">
<title>stage0_layer0_attn_gpu4</title>
<polygon fill="#e8f4fd" stroke="black" points="1249.5,-354 1018.5,-354 1018.5,-313 1249.5,-313 1249.5,-354"/>
<text text-anchor="middle" x="1134" y="-342" font-family="Arial" font-size="10.00">GPU4</text>
<text text-anchor="middle" x="1134" y="-331" font-family="Arial" font-size="10.00">Attn Layer0</text>
<text text-anchor="middle" x="1134" y="-320" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer0_qkv_gpu4&#45;&gt;stage0_layer0_attn_gpu4 -->
<g id="edge20" class="edge">
<title>stage0_layer0_qkv_gpu4&#45;&gt;stage0_layer0_attn_gpu4</title>
<path fill="none" stroke="black" d="M1134,-389.79C1134,-381.96 1134,-372.77 1134,-364.16"/>
<polygon fill="black" stroke="black" points="1137.5,-364.07 1134,-354.07 1130.5,-364.07 1137.5,-364.07"/>
</g>
<!-- stage0_layer0_out_gpu4 -->
<g id="node18" class="node">
<title>stage0_layer0_out_gpu4</title>
<polygon fill="#e8f4fd" stroke="black" points="1252,-277 1016,-277 1016,-236 1252,-236 1252,-277"/>
<text text-anchor="middle" x="1134" y="-265" font-family="Arial" font-size="10.00">GPU4</text>
<text text-anchor="middle" x="1134" y="-254" font-family="Arial" font-size="10.00">Output Proj Layer0</text>
<text text-anchor="middle" x="1134" y="-243" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_attn_gpu4&#45;&gt;stage0_layer0_out_gpu4 -->
<g id="edge21" class="edge">
<title>stage0_layer0_attn_gpu4&#45;&gt;stage0_layer0_out_gpu4</title>
<path fill="none" stroke="black" d="M1134,-312.79C1134,-304.96 1134,-295.77 1134,-287.16"/>
<polygon fill="black" stroke="black" points="1137.5,-287.07 1134,-277.07 1130.5,-287.07 1137.5,-287.07"/>
</g>
<!-- stage0_layer0_out_gpu4&#45;&gt;stage0_layer0_attn_allreduce -->
<g id="edge22" class="edge">
<title>stage0_layer0_out_gpu4&#45;&gt;stage0_layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M1134,-235.71C1134,-228.25 1134,-219.38 1134,-210.39"/>
<polygon fill="black" stroke="black" points="1137.5,-210.25 1134,-200.25 1130.5,-210.25 1137.5,-210.25"/>
</g>
<!-- stage0_layer0_attn_gpu5 -->
<g id="node20" class="node">
<title>stage0_layer0_attn_gpu5</title>
<polygon fill="#e8f4fd" stroke="black" points="1503.5,-354 1272.5,-354 1272.5,-313 1503.5,-313 1503.5,-354"/>
<text text-anchor="middle" x="1388" y="-342" font-family="Arial" font-size="10.00">GPU5</text>
<text text-anchor="middle" x="1388" y="-331" font-family="Arial" font-size="10.00">Attn Layer0</text>
<text text-anchor="middle" x="1388" y="-320" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer0_qkv_gpu5&#45;&gt;stage0_layer0_attn_gpu5 -->
<g id="edge24" class="edge">
<title>stage0_layer0_qkv_gpu5&#45;&gt;stage0_layer0_attn_gpu5</title>
<path fill="none" stroke="black" d="M1388,-389.79C1388,-381.96 1388,-372.77 1388,-364.16"/>
<polygon fill="black" stroke="black" points="1391.5,-364.07 1388,-354.07 1384.5,-364.07 1391.5,-364.07"/>
</g>
<!-- stage0_layer0_out_gpu5 -->
<g id="node21" class="node">
<title>stage0_layer0_out_gpu5</title>
<polygon fill="#e8f4fd" stroke="black" points="1506,-277 1270,-277 1270,-236 1506,-236 1506,-277"/>
<text text-anchor="middle" x="1388" y="-265" font-family="Arial" font-size="10.00">GPU5</text>
<text text-anchor="middle" x="1388" y="-254" font-family="Arial" font-size="10.00">Output Proj Layer0</text>
<text text-anchor="middle" x="1388" y="-243" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_attn_gpu5&#45;&gt;stage0_layer0_out_gpu5 -->
<g id="edge25" class="edge">
<title>stage0_layer0_attn_gpu5&#45;&gt;stage0_layer0_out_gpu5</title>
<path fill="none" stroke="black" d="M1388,-312.79C1388,-304.96 1388,-295.77 1388,-287.16"/>
<polygon fill="black" stroke="black" points="1391.5,-287.07 1388,-277.07 1384.5,-287.07 1391.5,-287.07"/>
</g>
<!-- stage0_layer0_out_gpu5&#45;&gt;stage0_layer0_attn_allreduce -->
<g id="edge26" class="edge">
<title>stage0_layer0_out_gpu5&#45;&gt;stage0_layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M1335.99,-235.94C1311.1,-226.59 1280.24,-214.98 1250.18,-203.68"/>
<polygon fill="black" stroke="black" points="1251.05,-200.27 1240.46,-200.03 1248.59,-206.82 1251.05,-200.27"/>
</g>
<!-- stage0_layer0_attn_gpu6 -->
<g id="node23" class="node">
<title>stage0_layer0_attn_gpu6</title>
<polygon fill="#e8f4fd" stroke="black" points="1757.5,-354 1526.5,-354 1526.5,-313 1757.5,-313 1757.5,-354"/>
<text text-anchor="middle" x="1642" y="-342" font-family="Arial" font-size="10.00">GPU6</text>
<text text-anchor="middle" x="1642" y="-331" font-family="Arial" font-size="10.00">Attn Layer0</text>
<text text-anchor="middle" x="1642" y="-320" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer0_qkv_gpu6&#45;&gt;stage0_layer0_attn_gpu6 -->
<g id="edge28" class="edge">
<title>stage0_layer0_qkv_gpu6&#45;&gt;stage0_layer0_attn_gpu6</title>
<path fill="none" stroke="black" d="M1642,-389.79C1642,-381.96 1642,-372.77 1642,-364.16"/>
<polygon fill="black" stroke="black" points="1645.5,-364.07 1642,-354.07 1638.5,-364.07 1645.5,-364.07"/>
</g>
<!-- stage0_layer0_out_gpu6 -->
<g id="node24" class="node">
<title>stage0_layer0_out_gpu6</title>
<polygon fill="#e8f4fd" stroke="black" points="1760,-277 1524,-277 1524,-236 1760,-236 1760,-277"/>
<text text-anchor="middle" x="1642" y="-265" font-family="Arial" font-size="10.00">GPU6</text>
<text text-anchor="middle" x="1642" y="-254" font-family="Arial" font-size="10.00">Output Proj Layer0</text>
<text text-anchor="middle" x="1642" y="-243" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_attn_gpu6&#45;&gt;stage0_layer0_out_gpu6 -->
<g id="edge29" class="edge">
<title>stage0_layer0_attn_gpu6&#45;&gt;stage0_layer0_out_gpu6</title>
<path fill="none" stroke="black" d="M1642,-312.79C1642,-304.96 1642,-295.77 1642,-287.16"/>
<polygon fill="black" stroke="black" points="1645.5,-287.07 1642,-277.07 1638.5,-287.07 1645.5,-287.07"/>
</g>
<!-- stage0_layer0_out_gpu6&#45;&gt;stage0_layer0_attn_allreduce -->
<g id="edge30" class="edge">
<title>stage0_layer0_out_gpu6&#45;&gt;stage0_layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M1537.97,-235.94C1485.62,-226.1 1420.03,-213.77 1357.01,-201.92"/>
<polygon fill="black" stroke="black" points="1357.4,-198.44 1346.93,-200.03 1356.11,-205.32 1357.4,-198.44"/>
</g>
<!-- stage0_layer0_attn_gpu7 -->
<g id="node26" class="node">
<title>stage0_layer0_attn_gpu7</title>
<polygon fill="#e8f4fd" stroke="black" points="2011.5,-354 1780.5,-354 1780.5,-313 2011.5,-313 2011.5,-354"/>
<text text-anchor="middle" x="1896" y="-342" font-family="Arial" font-size="10.00">GPU7</text>
<text text-anchor="middle" x="1896" y="-331" font-family="Arial" font-size="10.00">Attn Layer0</text>
<text text-anchor="middle" x="1896" y="-320" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer0_qkv_gpu7&#45;&gt;stage0_layer0_attn_gpu7 -->
<g id="edge32" class="edge">
<title>stage0_layer0_qkv_gpu7&#45;&gt;stage0_layer0_attn_gpu7</title>
<path fill="none" stroke="black" d="M1896,-389.79C1896,-381.96 1896,-372.77 1896,-364.16"/>
<polygon fill="black" stroke="black" points="1899.5,-364.07 1896,-354.07 1892.5,-364.07 1899.5,-364.07"/>
</g>
<!-- stage0_layer0_out_gpu7 -->
<g id="node27" class="node">
<title>stage0_layer0_out_gpu7</title>
<polygon fill="#e8f4fd" stroke="black" points="2014,-277 1778,-277 1778,-236 2014,-236 2014,-277"/>
<text text-anchor="middle" x="1896" y="-265" font-family="Arial" font-size="10.00">GPU7</text>
<text text-anchor="middle" x="1896" y="-254" font-family="Arial" font-size="10.00">Output Proj Layer0</text>
<text text-anchor="middle" x="1896" y="-243" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_attn_gpu7&#45;&gt;stage0_layer0_out_gpu7 -->
<g id="edge33" class="edge">
<title>stage0_layer0_attn_gpu7&#45;&gt;stage0_layer0_out_gpu7</title>
<path fill="none" stroke="black" d="M1896,-312.79C1896,-304.96 1896,-295.77 1896,-287.16"/>
<polygon fill="black" stroke="black" points="1899.5,-287.07 1896,-277.07 1892.5,-287.07 1899.5,-287.07"/>
</g>
<!-- stage0_layer0_out_gpu7&#45;&gt;stage0_layer0_attn_allreduce -->
<g id="edge34" class="edge">
<title>stage0_layer0_out_gpu7&#45;&gt;stage0_layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M1777.72,-237.21C1774.78,-236.8 1771.87,-236.39 1769,-236 1644.47,-218.99 1505.91,-202.17 1390.07,-188.68"/>
<polygon fill="black" stroke="black" points="1390.34,-185.19 1380.01,-187.51 1389.53,-192.15 1390.34,-185.19"/>
</g>
<!-- stage0_layer0_attn_allreduce&#45;&gt;stage0_layer0_residual1 -->
<g id="edge35" class="edge">
<title>stage0_layer0_attn_allreduce&#45;&gt;stage0_layer0_residual1</title>
<path fill="none" stroke="black" d="M1289.29,-118.32C1332.26,-107.34 1379.05,-95.39 1422.58,-84.27"/>
<polygon fill="black" stroke="black" points="1423.57,-87.63 1432.39,-81.76 1421.84,-80.84 1423.57,-87.63"/>
</g>
<!-- stage0_layer0_norm2 -->
<g id="node30" class="node">
<title>stage0_layer0_norm2</title>
<polygon fill="#e8f4fd" stroke="black" points="2022,-683.93 1780,-683.93 1780,-642.93 2022,-642.93 2022,-683.93"/>
<text text-anchor="middle" x="1901" y="-671.93" font-family="Arial" font-size="10.00">Layer 0</text>
<text text-anchor="middle" x="1901" y="-660.93" font-family="Arial" font-size="10.00">Pre&#45;MoE LayerNorm</text>
<text text-anchor="middle" x="1901" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_qkv_gpu0 -->
<g id="node31" class="node">
<title>stage0_layer0_moe_qkv_gpu0</title>
<polygon fill="#e8f4fd" stroke="black" points="2282,-683.93 2040,-683.93 2040,-642.93 2282,-642.93 2282,-683.93"/>
<text text-anchor="middle" x="2161" y="-671.93" font-family="Arial" font-size="10.00">GPU0</text>
<text text-anchor="middle" x="2161" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer0</text>
<text text-anchor="middle" x="2161" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_experts_gpu0 -->
<g id="node32" class="node">
<title>stage0_layer0_moe_experts_gpu0</title>
<polygon fill="#e8f4fd" stroke="black" points="2542,-683.93 2300,-683.93 2300,-642.93 2542,-642.93 2542,-683.93"/>
<text text-anchor="middle" x="2421" y="-671.93" font-family="Arial" font-size="10.00">GPU0</text>
<text text-anchor="middle" x="2421" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer0</text>
<text text-anchor="middle" x="2421" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_out_gpu0 -->
<g id="node33" class="node">
<title>stage0_layer0_moe_out_gpu0</title>
<polygon fill="#e8f4fd" stroke="black" points="2802,-683.93 2560,-683.93 2560,-642.93 2802,-642.93 2802,-683.93"/>
<text text-anchor="middle" x="2681" y="-671.93" font-family="Arial" font-size="10.00">GPU0</text>
<text text-anchor="middle" x="2681" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer0</text>
<text text-anchor="middle" x="2681" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_qkv_gpu1 -->
<g id="node34" class="node">
<title>stage0_layer0_moe_qkv_gpu1</title>
<polygon fill="#e8f4fd" stroke="black" points="3062,-683.93 2820,-683.93 2820,-642.93 3062,-642.93 3062,-683.93"/>
<text text-anchor="middle" x="2941" y="-671.93" font-family="Arial" font-size="10.00">GPU1</text>
<text text-anchor="middle" x="2941" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer0</text>
<text text-anchor="middle" x="2941" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_experts_gpu1 -->
<g id="node35" class="node">
<title>stage0_layer0_moe_experts_gpu1</title>
<polygon fill="#e8f4fd" stroke="black" points="3322,-683.93 3080,-683.93 3080,-642.93 3322,-642.93 3322,-683.93"/>
<text text-anchor="middle" x="3201" y="-671.93" font-family="Arial" font-size="10.00">GPU1</text>
<text text-anchor="middle" x="3201" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer0</text>
<text text-anchor="middle" x="3201" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_out_gpu1 -->
<g id="node36" class="node">
<title>stage0_layer0_moe_out_gpu1</title>
<polygon fill="#e8f4fd" stroke="black" points="3582,-683.93 3340,-683.93 3340,-642.93 3582,-642.93 3582,-683.93"/>
<text text-anchor="middle" x="3461" y="-671.93" font-family="Arial" font-size="10.00">GPU1</text>
<text text-anchor="middle" x="3461" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer0</text>
<text text-anchor="middle" x="3461" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_qkv_gpu2 -->
<g id="node37" class="node">
<title>stage0_layer0_moe_qkv_gpu2</title>
<polygon fill="#e8f4fd" stroke="black" points="3842,-683.93 3600,-683.93 3600,-642.93 3842,-642.93 3842,-683.93"/>
<text text-anchor="middle" x="3721" y="-671.93" font-family="Arial" font-size="10.00">GPU2</text>
<text text-anchor="middle" x="3721" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer0</text>
<text text-anchor="middle" x="3721" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_experts_gpu2 -->
<g id="node38" class="node">
<title>stage0_layer0_moe_experts_gpu2</title>
<polygon fill="#e8f4fd" stroke="black" points="4102,-683.93 3860,-683.93 3860,-642.93 4102,-642.93 4102,-683.93"/>
<text text-anchor="middle" x="3981" y="-671.93" font-family="Arial" font-size="10.00">GPU2</text>
<text text-anchor="middle" x="3981" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer0</text>
<text text-anchor="middle" x="3981" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_out_gpu2 -->
<g id="node39" class="node">
<title>stage0_layer0_moe_out_gpu2</title>
<polygon fill="#e8f4fd" stroke="black" points="4362,-683.93 4120,-683.93 4120,-642.93 4362,-642.93 4362,-683.93"/>
<text text-anchor="middle" x="4241" y="-671.93" font-family="Arial" font-size="10.00">GPU2</text>
<text text-anchor="middle" x="4241" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer0</text>
<text text-anchor="middle" x="4241" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_qkv_gpu3 -->
<g id="node40" class="node">
<title>stage0_layer0_moe_qkv_gpu3</title>
<polygon fill="#e8f4fd" stroke="black" points="4622,-683.93 4380,-683.93 4380,-642.93 4622,-642.93 4622,-683.93"/>
<text text-anchor="middle" x="4501" y="-671.93" font-family="Arial" font-size="10.00">GPU3</text>
<text text-anchor="middle" x="4501" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer0</text>
<text text-anchor="middle" x="4501" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_experts_gpu3 -->
<g id="node41" class="node">
<title>stage0_layer0_moe_experts_gpu3</title>
<polygon fill="#e8f4fd" stroke="black" points="4882,-683.93 4640,-683.93 4640,-642.93 4882,-642.93 4882,-683.93"/>
<text text-anchor="middle" x="4761" y="-671.93" font-family="Arial" font-size="10.00">GPU3</text>
<text text-anchor="middle" x="4761" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer0</text>
<text text-anchor="middle" x="4761" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_out_gpu3 -->
<g id="node42" class="node">
<title>stage0_layer0_moe_out_gpu3</title>
<polygon fill="#e8f4fd" stroke="black" points="5142,-683.93 4900,-683.93 4900,-642.93 5142,-642.93 5142,-683.93"/>
<text text-anchor="middle" x="5021" y="-671.93" font-family="Arial" font-size="10.00">GPU3</text>
<text text-anchor="middle" x="5021" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer0</text>
<text text-anchor="middle" x="5021" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_qkv_gpu4 -->
<g id="node43" class="node">
<title>stage0_layer0_moe_qkv_gpu4</title>
<polygon fill="#e8f4fd" stroke="black" points="5402,-683.93 5160,-683.93 5160,-642.93 5402,-642.93 5402,-683.93"/>
<text text-anchor="middle" x="5281" y="-671.93" font-family="Arial" font-size="10.00">GPU4</text>
<text text-anchor="middle" x="5281" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer0</text>
<text text-anchor="middle" x="5281" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_experts_gpu4 -->
<g id="node44" class="node">
<title>stage0_layer0_moe_experts_gpu4</title>
<polygon fill="#e8f4fd" stroke="black" points="5662,-683.93 5420,-683.93 5420,-642.93 5662,-642.93 5662,-683.93"/>
<text text-anchor="middle" x="5541" y="-671.93" font-family="Arial" font-size="10.00">GPU4</text>
<text text-anchor="middle" x="5541" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer0</text>
<text text-anchor="middle" x="5541" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_out_gpu4 -->
<g id="node45" class="node">
<title>stage0_layer0_moe_out_gpu4</title>
<polygon fill="#e8f4fd" stroke="black" points="5922,-683.93 5680,-683.93 5680,-642.93 5922,-642.93 5922,-683.93"/>
<text text-anchor="middle" x="5801" y="-671.93" font-family="Arial" font-size="10.00">GPU4</text>
<text text-anchor="middle" x="5801" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer0</text>
<text text-anchor="middle" x="5801" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_qkv_gpu5 -->
<g id="node46" class="node">
<title>stage0_layer0_moe_qkv_gpu5</title>
<polygon fill="#e8f4fd" stroke="black" points="6182,-683.93 5940,-683.93 5940,-642.93 6182,-642.93 6182,-683.93"/>
<text text-anchor="middle" x="6061" y="-671.93" font-family="Arial" font-size="10.00">GPU5</text>
<text text-anchor="middle" x="6061" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer0</text>
<text text-anchor="middle" x="6061" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_experts_gpu5 -->
<g id="node47" class="node">
<title>stage0_layer0_moe_experts_gpu5</title>
<polygon fill="#e8f4fd" stroke="black" points="6442,-683.93 6200,-683.93 6200,-642.93 6442,-642.93 6442,-683.93"/>
<text text-anchor="middle" x="6321" y="-671.93" font-family="Arial" font-size="10.00">GPU5</text>
<text text-anchor="middle" x="6321" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer0</text>
<text text-anchor="middle" x="6321" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_out_gpu5 -->
<g id="node48" class="node">
<title>stage0_layer0_moe_out_gpu5</title>
<polygon fill="#e8f4fd" stroke="black" points="6702,-683.93 6460,-683.93 6460,-642.93 6702,-642.93 6702,-683.93"/>
<text text-anchor="middle" x="6581" y="-671.93" font-family="Arial" font-size="10.00">GPU5</text>
<text text-anchor="middle" x="6581" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer0</text>
<text text-anchor="middle" x="6581" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_qkv_gpu6 -->
<g id="node49" class="node">
<title>stage0_layer0_moe_qkv_gpu6</title>
<polygon fill="#e8f4fd" stroke="black" points="6962,-683.93 6720,-683.93 6720,-642.93 6962,-642.93 6962,-683.93"/>
<text text-anchor="middle" x="6841" y="-671.93" font-family="Arial" font-size="10.00">GPU6</text>
<text text-anchor="middle" x="6841" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer0</text>
<text text-anchor="middle" x="6841" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_experts_gpu6 -->
<g id="node50" class="node">
<title>stage0_layer0_moe_experts_gpu6</title>
<polygon fill="#e8f4fd" stroke="black" points="7222,-683.93 6980,-683.93 6980,-642.93 7222,-642.93 7222,-683.93"/>
<text text-anchor="middle" x="7101" y="-671.93" font-family="Arial" font-size="10.00">GPU6</text>
<text text-anchor="middle" x="7101" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer0</text>
<text text-anchor="middle" x="7101" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_out_gpu6 -->
<g id="node51" class="node">
<title>stage0_layer0_moe_out_gpu6</title>
<polygon fill="#e8f4fd" stroke="black" points="7482,-683.93 7240,-683.93 7240,-642.93 7482,-642.93 7482,-683.93"/>
<text text-anchor="middle" x="7361" y="-671.93" font-family="Arial" font-size="10.00">GPU6</text>
<text text-anchor="middle" x="7361" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer0</text>
<text text-anchor="middle" x="7361" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_qkv_gpu7 -->
<g id="node52" class="node">
<title>stage0_layer0_moe_qkv_gpu7</title>
<polygon fill="#e8f4fd" stroke="black" points="7742,-683.93 7500,-683.93 7500,-642.93 7742,-642.93 7742,-683.93"/>
<text text-anchor="middle" x="7621" y="-671.93" font-family="Arial" font-size="10.00">GPU7</text>
<text text-anchor="middle" x="7621" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer0</text>
<text text-anchor="middle" x="7621" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_experts_gpu7 -->
<g id="node53" class="node">
<title>stage0_layer0_moe_experts_gpu7</title>
<polygon fill="#e8f4fd" stroke="black" points="8002,-683.93 7760,-683.93 7760,-642.93 8002,-642.93 8002,-683.93"/>
<text text-anchor="middle" x="7881" y="-671.93" font-family="Arial" font-size="10.00">GPU7</text>
<text text-anchor="middle" x="7881" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer0</text>
<text text-anchor="middle" x="7881" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_out_gpu7 -->
<g id="node54" class="node">
<title>stage0_layer0_moe_out_gpu7</title>
<polygon fill="#e8f4fd" stroke="black" points="8262,-683.93 8020,-683.93 8020,-642.93 8262,-642.93 8262,-683.93"/>
<text text-anchor="middle" x="8141" y="-671.93" font-family="Arial" font-size="10.00">GPU7</text>
<text text-anchor="middle" x="8141" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer0</text>
<text text-anchor="middle" x="8141" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_moe_allreduce -->
<g id="node55" class="node">
<title>stage0_layer0_moe_allreduce</title>
<path fill="#e8fde8" stroke="black" d="M8792.1,-704.43C8792.1,-704.43 8399.16,-704.43 8399.16,-704.43 8393.16,-704.43 8382.39,-700.78 8377.63,-697.14 8377.63,-697.14 8289.44,-629.71 8289.44,-629.71 8284.67,-626.07 8285.9,-622.43 8291.9,-622.43 8291.9,-622.43 8684.84,-622.43 8684.84,-622.43 8690.84,-622.43 8701.61,-626.07 8706.37,-629.71 8706.37,-629.71 8794.56,-697.14 8794.56,-697.14 8799.33,-700.78 8798.1,-704.43 8792.1,-704.43"/>
<text text-anchor="middle" x="8542" y="-671.93" font-family="Arial" font-size="10.00">Layer 0</text>
<text text-anchor="middle" x="8542" y="-660.93" font-family="Arial" font-size="10.00">MoE All&#45;Reduce</text>
<text text-anchor="middle" x="8542" y="-649.93" font-family="Arial" font-size="10.00">[Input: 8×[1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer0_residual2 -->
<g id="node56" class="node">
<title>stage0_layer0_residual2</title>
<path fill="#e8fde8" stroke="black" d="M9335.1,-704.43C9335.1,-704.43 8942.16,-704.43 8942.16,-704.43 8936.16,-704.43 8925.39,-700.78 8920.63,-697.14 8920.63,-697.14 8832.44,-629.71 8832.44,-629.71 8827.67,-626.07 8828.9,-622.43 8834.9,-622.43 8834.9,-622.43 9227.84,-622.43 9227.84,-622.43 9233.84,-622.43 9244.61,-626.07 9249.37,-629.71 9249.37,-629.71 9337.56,-697.14 9337.56,-697.14 9342.33,-700.78 9341.1,-704.43 9335.1,-704.43"/>
<text text-anchor="middle" x="9085" y="-671.93" font-family="Arial" font-size="10.00">Layer 0</text>
<text text-anchor="middle" x="9085" y="-660.93" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="9085" y="-649.93" font-family="Arial" font-size="10.00">[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_norm1 -->
<g id="node57" class="node">
<title>stage0_layer1_norm1</title>
<polygon fill="#e8f4fd" stroke="black" points="9607,-683.93 9365,-683.93 9365,-642.93 9607,-642.93 9607,-683.93"/>
<text text-anchor="middle" x="9486" y="-671.93" font-family="Arial" font-size="10.00">Layer 1</text>
<text text-anchor="middle" x="9486" y="-660.93" font-family="Arial" font-size="10.00">Pre&#45;Attn LayerNorm</text>
<text text-anchor="middle" x="9486" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_qkv_gpu0 -->
<g id="node58" class="node">
<title>stage0_layer1_qkv_gpu0</title>
<polygon fill="#e8f4fd" stroke="black" points="9861,-683.93 9625,-683.93 9625,-642.93 9861,-642.93 9861,-683.93"/>
<text text-anchor="middle" x="9743" y="-671.93" font-family="Arial" font-size="10.00">GPU0</text>
<text text-anchor="middle" x="9743" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer1</text>
<text text-anchor="middle" x="9743" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer1_attn_gpu0 -->
<g id="node59" class="node">
<title>stage0_layer1_attn_gpu0</title>
<polygon fill="#e8f4fd" stroke="black" points="10110.5,-683.93 9879.5,-683.93 9879.5,-642.93 10110.5,-642.93 10110.5,-683.93"/>
<text text-anchor="middle" x="9995" y="-671.93" font-family="Arial" font-size="10.00">GPU0</text>
<text text-anchor="middle" x="9995" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer1</text>
<text text-anchor="middle" x="9995" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer1_out_gpu0 -->
<g id="node60" class="node">
<title>stage0_layer1_out_gpu0</title>
<polygon fill="#e8f4fd" stroke="black" points="10365,-683.93 10129,-683.93 10129,-642.93 10365,-642.93 10365,-683.93"/>
<text text-anchor="middle" x="10247" y="-671.93" font-family="Arial" font-size="10.00">GPU0</text>
<text text-anchor="middle" x="10247" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer1</text>
<text text-anchor="middle" x="10247" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_qkv_gpu1 -->
<g id="node61" class="node">
<title>stage0_layer1_qkv_gpu1</title>
<polygon fill="#e8f4fd" stroke="black" points="10619,-683.93 10383,-683.93 10383,-642.93 10619,-642.93 10619,-683.93"/>
<text text-anchor="middle" x="10501" y="-671.93" font-family="Arial" font-size="10.00">GPU1</text>
<text text-anchor="middle" x="10501" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer1</text>
<text text-anchor="middle" x="10501" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer1_attn_gpu1 -->
<g id="node62" class="node">
<title>stage0_layer1_attn_gpu1</title>
<polygon fill="#e8f4fd" stroke="black" points="10868.5,-683.93 10637.5,-683.93 10637.5,-642.93 10868.5,-642.93 10868.5,-683.93"/>
<text text-anchor="middle" x="10753" y="-671.93" font-family="Arial" font-size="10.00">GPU1</text>
<text text-anchor="middle" x="10753" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer1</text>
<text text-anchor="middle" x="10753" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer1_out_gpu1 -->
<g id="node63" class="node">
<title>stage0_layer1_out_gpu1</title>
<polygon fill="#e8f4fd" stroke="black" points="11123,-683.93 10887,-683.93 10887,-642.93 11123,-642.93 11123,-683.93"/>
<text text-anchor="middle" x="11005" y="-671.93" font-family="Arial" font-size="10.00">GPU1</text>
<text text-anchor="middle" x="11005" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer1</text>
<text text-anchor="middle" x="11005" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_qkv_gpu2 -->
<g id="node64" class="node">
<title>stage0_layer1_qkv_gpu2</title>
<polygon fill="#e8f4fd" stroke="black" points="11377,-683.93 11141,-683.93 11141,-642.93 11377,-642.93 11377,-683.93"/>
<text text-anchor="middle" x="11259" y="-671.93" font-family="Arial" font-size="10.00">GPU2</text>
<text text-anchor="middle" x="11259" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer1</text>
<text text-anchor="middle" x="11259" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer1_attn_gpu2 -->
<g id="node65" class="node">
<title>stage0_layer1_attn_gpu2</title>
<polygon fill="#e8f4fd" stroke="black" points="11626.5,-683.93 11395.5,-683.93 11395.5,-642.93 11626.5,-642.93 11626.5,-683.93"/>
<text text-anchor="middle" x="11511" y="-671.93" font-family="Arial" font-size="10.00">GPU2</text>
<text text-anchor="middle" x="11511" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer1</text>
<text text-anchor="middle" x="11511" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer1_out_gpu2 -->
<g id="node66" class="node">
<title>stage0_layer1_out_gpu2</title>
<polygon fill="#e8f4fd" stroke="black" points="11881,-683.93 11645,-683.93 11645,-642.93 11881,-642.93 11881,-683.93"/>
<text text-anchor="middle" x="11763" y="-671.93" font-family="Arial" font-size="10.00">GPU2</text>
<text text-anchor="middle" x="11763" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer1</text>
<text text-anchor="middle" x="11763" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_qkv_gpu3 -->
<g id="node67" class="node">
<title>stage0_layer1_qkv_gpu3</title>
<polygon fill="#e8f4fd" stroke="black" points="12135,-683.93 11899,-683.93 11899,-642.93 12135,-642.93 12135,-683.93"/>
<text text-anchor="middle" x="12017" y="-671.93" font-family="Arial" font-size="10.00">GPU3</text>
<text text-anchor="middle" x="12017" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer1</text>
<text text-anchor="middle" x="12017" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer1_attn_gpu3 -->
<g id="node68" class="node">
<title>stage0_layer1_attn_gpu3</title>
<polygon fill="#e8f4fd" stroke="black" points="12384.5,-683.93 12153.5,-683.93 12153.5,-642.93 12384.5,-642.93 12384.5,-683.93"/>
<text text-anchor="middle" x="12269" y="-671.93" font-family="Arial" font-size="10.00">GPU3</text>
<text text-anchor="middle" x="12269" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer1</text>
<text text-anchor="middle" x="12269" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer1_out_gpu3 -->
<g id="node69" class="node">
<title>stage0_layer1_out_gpu3</title>
<polygon fill="#e8f4fd" stroke="black" points="12639,-683.93 12403,-683.93 12403,-642.93 12639,-642.93 12639,-683.93"/>
<text text-anchor="middle" x="12521" y="-671.93" font-family="Arial" font-size="10.00">GPU3</text>
<text text-anchor="middle" x="12521" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer1</text>
<text text-anchor="middle" x="12521" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_qkv_gpu4 -->
<g id="node70" class="node">
<title>stage0_layer1_qkv_gpu4</title>
<polygon fill="#e8f4fd" stroke="black" points="12893,-683.93 12657,-683.93 12657,-642.93 12893,-642.93 12893,-683.93"/>
<text text-anchor="middle" x="12775" y="-671.93" font-family="Arial" font-size="10.00">GPU4</text>
<text text-anchor="middle" x="12775" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer1</text>
<text text-anchor="middle" x="12775" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer1_attn_gpu4 -->
<g id="node71" class="node">
<title>stage0_layer1_attn_gpu4</title>
<polygon fill="#e8f4fd" stroke="black" points="13142.5,-683.93 12911.5,-683.93 12911.5,-642.93 13142.5,-642.93 13142.5,-683.93"/>
<text text-anchor="middle" x="13027" y="-671.93" font-family="Arial" font-size="10.00">GPU4</text>
<text text-anchor="middle" x="13027" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer1</text>
<text text-anchor="middle" x="13027" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer1_out_gpu4 -->
<g id="node72" class="node">
<title>stage0_layer1_out_gpu4</title>
<polygon fill="#e8f4fd" stroke="black" points="13397,-683.93 13161,-683.93 13161,-642.93 13397,-642.93 13397,-683.93"/>
<text text-anchor="middle" x="13279" y="-671.93" font-family="Arial" font-size="10.00">GPU4</text>
<text text-anchor="middle" x="13279" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer1</text>
<text text-anchor="middle" x="13279" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_qkv_gpu5 -->
<g id="node73" class="node">
<title>stage0_layer1_qkv_gpu5</title>
<polygon fill="#e8f4fd" stroke="black" points="13651,-683.93 13415,-683.93 13415,-642.93 13651,-642.93 13651,-683.93"/>
<text text-anchor="middle" x="13533" y="-671.93" font-family="Arial" font-size="10.00">GPU5</text>
<text text-anchor="middle" x="13533" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer1</text>
<text text-anchor="middle" x="13533" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer1_attn_gpu5 -->
<g id="node74" class="node">
<title>stage0_layer1_attn_gpu5</title>
<polygon fill="#e8f4fd" stroke="black" points="13900.5,-683.93 13669.5,-683.93 13669.5,-642.93 13900.5,-642.93 13900.5,-683.93"/>
<text text-anchor="middle" x="13785" y="-671.93" font-family="Arial" font-size="10.00">GPU5</text>
<text text-anchor="middle" x="13785" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer1</text>
<text text-anchor="middle" x="13785" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer1_out_gpu5 -->
<g id="node75" class="node">
<title>stage0_layer1_out_gpu5</title>
<polygon fill="#e8f4fd" stroke="black" points="14155,-683.93 13919,-683.93 13919,-642.93 14155,-642.93 14155,-683.93"/>
<text text-anchor="middle" x="14037" y="-671.93" font-family="Arial" font-size="10.00">GPU5</text>
<text text-anchor="middle" x="14037" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer1</text>
<text text-anchor="middle" x="14037" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_qkv_gpu6 -->
<g id="node76" class="node">
<title>stage0_layer1_qkv_gpu6</title>
<polygon fill="#e8f4fd" stroke="black" points="14409,-683.93 14173,-683.93 14173,-642.93 14409,-642.93 14409,-683.93"/>
<text text-anchor="middle" x="14291" y="-671.93" font-family="Arial" font-size="10.00">GPU6</text>
<text text-anchor="middle" x="14291" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer1</text>
<text text-anchor="middle" x="14291" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer1_attn_gpu6 -->
<g id="node77" class="node">
<title>stage0_layer1_attn_gpu6</title>
<polygon fill="#e8f4fd" stroke="black" points="14658.5,-683.93 14427.5,-683.93 14427.5,-642.93 14658.5,-642.93 14658.5,-683.93"/>
<text text-anchor="middle" x="14543" y="-671.93" font-family="Arial" font-size="10.00">GPU6</text>
<text text-anchor="middle" x="14543" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer1</text>
<text text-anchor="middle" x="14543" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer1_out_gpu6 -->
<g id="node78" class="node">
<title>stage0_layer1_out_gpu6</title>
<polygon fill="#e8f4fd" stroke="black" points="14913,-683.93 14677,-683.93 14677,-642.93 14913,-642.93 14913,-683.93"/>
<text text-anchor="middle" x="14795" y="-671.93" font-family="Arial" font-size="10.00">GPU6</text>
<text text-anchor="middle" x="14795" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer1</text>
<text text-anchor="middle" x="14795" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_qkv_gpu7 -->
<g id="node79" class="node">
<title>stage0_layer1_qkv_gpu7</title>
<polygon fill="#e8f4fd" stroke="black" points="15167,-683.93 14931,-683.93 14931,-642.93 15167,-642.93 15167,-683.93"/>
<text text-anchor="middle" x="15049" y="-671.93" font-family="Arial" font-size="10.00">GPU7</text>
<text text-anchor="middle" x="15049" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer1</text>
<text text-anchor="middle" x="15049" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer1_attn_gpu7 -->
<g id="node80" class="node">
<title>stage0_layer1_attn_gpu7</title>
<polygon fill="#e8f4fd" stroke="black" points="15416.5,-683.93 15185.5,-683.93 15185.5,-642.93 15416.5,-642.93 15416.5,-683.93"/>
<text text-anchor="middle" x="15301" y="-671.93" font-family="Arial" font-size="10.00">GPU7</text>
<text text-anchor="middle" x="15301" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer1</text>
<text text-anchor="middle" x="15301" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage0_layer1_out_gpu7 -->
<g id="node81" class="node">
<title>stage0_layer1_out_gpu7</title>
<polygon fill="#e8f4fd" stroke="black" points="15671,-683.93 15435,-683.93 15435,-642.93 15671,-642.93 15671,-683.93"/>
<text text-anchor="middle" x="15553" y="-671.93" font-family="Arial" font-size="10.00">GPU7</text>
<text text-anchor="middle" x="15553" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer1</text>
<text text-anchor="middle" x="15553" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_attn_allreduce -->
<g id="node82" class="node">
<title>stage0_layer1_attn_allreduce</title>
<path fill="#e8fde8" stroke="black" d="M16201.1,-704.43C16201.1,-704.43 15808.16,-704.43 15808.16,-704.43 15802.16,-704.43 15791.39,-700.78 15786.63,-697.14 15786.63,-697.14 15698.44,-629.71 15698.44,-629.71 15693.67,-626.07 15694.9,-622.43 15700.9,-622.43 15700.9,-622.43 16093.84,-622.43 16093.84,-622.43 16099.84,-622.43 16110.61,-626.07 16115.37,-629.71 16115.37,-629.71 16203.56,-697.14 16203.56,-697.14 16208.33,-700.78 16207.1,-704.43 16201.1,-704.43"/>
<text text-anchor="middle" x="15951" y="-671.93" font-family="Arial" font-size="10.00">Layer 1</text>
<text text-anchor="middle" x="15951" y="-660.93" font-family="Arial" font-size="10.00">Attention All&#45;Reduce</text>
<text text-anchor="middle" x="15951" y="-649.93" font-family="Arial" font-size="10.00">[Input: 8×[1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_residual1 -->
<g id="node83" class="node">
<title>stage0_layer1_residual1</title>
<path fill="#e8fde8" stroke="black" d="M16744.1,-704.43C16744.1,-704.43 16351.16,-704.43 16351.16,-704.43 16345.16,-704.43 16334.39,-700.78 16329.63,-697.14 16329.63,-697.14 16241.44,-629.71 16241.44,-629.71 16236.67,-626.07 16237.9,-622.43 16243.9,-622.43 16243.9,-622.43 16636.84,-622.43 16636.84,-622.43 16642.84,-622.43 16653.61,-626.07 16658.37,-629.71 16658.37,-629.71 16746.56,-697.14 16746.56,-697.14 16751.33,-700.78 16750.1,-704.43 16744.1,-704.43"/>
<text text-anchor="middle" x="16494" y="-671.93" font-family="Arial" font-size="10.00">Layer 1</text>
<text text-anchor="middle" x="16494" y="-660.93" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="16494" y="-649.93" font-family="Arial" font-size="10.00">[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_norm2 -->
<g id="node84" class="node">
<title>stage0_layer1_norm2</title>
<polygon fill="#e8f4fd" stroke="black" points="17016,-683.93 16774,-683.93 16774,-642.93 17016,-642.93 17016,-683.93"/>
<text text-anchor="middle" x="16895" y="-671.93" font-family="Arial" font-size="10.00">Layer 1</text>
<text text-anchor="middle" x="16895" y="-660.93" font-family="Arial" font-size="10.00">Pre&#45;MoE LayerNorm</text>
<text text-anchor="middle" x="16895" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_qkv_gpu0 -->
<g id="node85" class="node">
<title>stage0_layer1_moe_qkv_gpu0</title>
<polygon fill="#e8f4fd" stroke="black" points="17276,-683.93 17034,-683.93 17034,-642.93 17276,-642.93 17276,-683.93"/>
<text text-anchor="middle" x="17155" y="-671.93" font-family="Arial" font-size="10.00">GPU0</text>
<text text-anchor="middle" x="17155" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer1</text>
<text text-anchor="middle" x="17155" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_experts_gpu0 -->
<g id="node86" class="node">
<title>stage0_layer1_moe_experts_gpu0</title>
<polygon fill="#e8f4fd" stroke="black" points="17536,-683.93 17294,-683.93 17294,-642.93 17536,-642.93 17536,-683.93"/>
<text text-anchor="middle" x="17415" y="-671.93" font-family="Arial" font-size="10.00">GPU0</text>
<text text-anchor="middle" x="17415" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer1</text>
<text text-anchor="middle" x="17415" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_out_gpu0 -->
<g id="node87" class="node">
<title>stage0_layer1_moe_out_gpu0</title>
<polygon fill="#e8f4fd" stroke="black" points="17796,-683.93 17554,-683.93 17554,-642.93 17796,-642.93 17796,-683.93"/>
<text text-anchor="middle" x="17675" y="-671.93" font-family="Arial" font-size="10.00">GPU0</text>
<text text-anchor="middle" x="17675" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer1</text>
<text text-anchor="middle" x="17675" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_qkv_gpu1 -->
<g id="node88" class="node">
<title>stage0_layer1_moe_qkv_gpu1</title>
<polygon fill="#e8f4fd" stroke="black" points="18056,-683.93 17814,-683.93 17814,-642.93 18056,-642.93 18056,-683.93"/>
<text text-anchor="middle" x="17935" y="-671.93" font-family="Arial" font-size="10.00">GPU1</text>
<text text-anchor="middle" x="17935" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer1</text>
<text text-anchor="middle" x="17935" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_experts_gpu1 -->
<g id="node89" class="node">
<title>stage0_layer1_moe_experts_gpu1</title>
<polygon fill="#e8f4fd" stroke="black" points="18316,-683.93 18074,-683.93 18074,-642.93 18316,-642.93 18316,-683.93"/>
<text text-anchor="middle" x="18195" y="-671.93" font-family="Arial" font-size="10.00">GPU1</text>
<text text-anchor="middle" x="18195" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer1</text>
<text text-anchor="middle" x="18195" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_out_gpu1 -->
<g id="node90" class="node">
<title>stage0_layer1_moe_out_gpu1</title>
<polygon fill="#e8f4fd" stroke="black" points="18576,-683.93 18334,-683.93 18334,-642.93 18576,-642.93 18576,-683.93"/>
<text text-anchor="middle" x="18455" y="-671.93" font-family="Arial" font-size="10.00">GPU1</text>
<text text-anchor="middle" x="18455" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer1</text>
<text text-anchor="middle" x="18455" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_qkv_gpu2 -->
<g id="node91" class="node">
<title>stage0_layer1_moe_qkv_gpu2</title>
<polygon fill="#e8f4fd" stroke="black" points="18836,-683.93 18594,-683.93 18594,-642.93 18836,-642.93 18836,-683.93"/>
<text text-anchor="middle" x="18715" y="-671.93" font-family="Arial" font-size="10.00">GPU2</text>
<text text-anchor="middle" x="18715" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer1</text>
<text text-anchor="middle" x="18715" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_experts_gpu2 -->
<g id="node92" class="node">
<title>stage0_layer1_moe_experts_gpu2</title>
<polygon fill="#e8f4fd" stroke="black" points="19096,-683.93 18854,-683.93 18854,-642.93 19096,-642.93 19096,-683.93"/>
<text text-anchor="middle" x="18975" y="-671.93" font-family="Arial" font-size="10.00">GPU2</text>
<text text-anchor="middle" x="18975" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer1</text>
<text text-anchor="middle" x="18975" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_out_gpu2 -->
<g id="node93" class="node">
<title>stage0_layer1_moe_out_gpu2</title>
<polygon fill="#e8f4fd" stroke="black" points="19356,-683.93 19114,-683.93 19114,-642.93 19356,-642.93 19356,-683.93"/>
<text text-anchor="middle" x="19235" y="-671.93" font-family="Arial" font-size="10.00">GPU2</text>
<text text-anchor="middle" x="19235" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer1</text>
<text text-anchor="middle" x="19235" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_qkv_gpu3 -->
<g id="node94" class="node">
<title>stage0_layer1_moe_qkv_gpu3</title>
<polygon fill="#e8f4fd" stroke="black" points="19616,-683.93 19374,-683.93 19374,-642.93 19616,-642.93 19616,-683.93"/>
<text text-anchor="middle" x="19495" y="-671.93" font-family="Arial" font-size="10.00">GPU3</text>
<text text-anchor="middle" x="19495" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer1</text>
<text text-anchor="middle" x="19495" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_experts_gpu3 -->
<g id="node95" class="node">
<title>stage0_layer1_moe_experts_gpu3</title>
<polygon fill="#e8f4fd" stroke="black" points="19876,-683.93 19634,-683.93 19634,-642.93 19876,-642.93 19876,-683.93"/>
<text text-anchor="middle" x="19755" y="-671.93" font-family="Arial" font-size="10.00">GPU3</text>
<text text-anchor="middle" x="19755" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer1</text>
<text text-anchor="middle" x="19755" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_out_gpu3 -->
<g id="node96" class="node">
<title>stage0_layer1_moe_out_gpu3</title>
<polygon fill="#e8f4fd" stroke="black" points="20136,-683.93 19894,-683.93 19894,-642.93 20136,-642.93 20136,-683.93"/>
<text text-anchor="middle" x="20015" y="-671.93" font-family="Arial" font-size="10.00">GPU3</text>
<text text-anchor="middle" x="20015" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer1</text>
<text text-anchor="middle" x="20015" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_qkv_gpu4 -->
<g id="node97" class="node">
<title>stage0_layer1_moe_qkv_gpu4</title>
<polygon fill="#e8f4fd" stroke="black" points="20396,-683.93 20154,-683.93 20154,-642.93 20396,-642.93 20396,-683.93"/>
<text text-anchor="middle" x="20275" y="-671.93" font-family="Arial" font-size="10.00">GPU4</text>
<text text-anchor="middle" x="20275" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer1</text>
<text text-anchor="middle" x="20275" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_experts_gpu4 -->
<g id="node98" class="node">
<title>stage0_layer1_moe_experts_gpu4</title>
<polygon fill="#e8f4fd" stroke="black" points="20656,-683.93 20414,-683.93 20414,-642.93 20656,-642.93 20656,-683.93"/>
<text text-anchor="middle" x="20535" y="-671.93" font-family="Arial" font-size="10.00">GPU4</text>
<text text-anchor="middle" x="20535" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer1</text>
<text text-anchor="middle" x="20535" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_out_gpu4 -->
<g id="node99" class="node">
<title>stage0_layer1_moe_out_gpu4</title>
<polygon fill="#e8f4fd" stroke="black" points="20916,-683.93 20674,-683.93 20674,-642.93 20916,-642.93 20916,-683.93"/>
<text text-anchor="middle" x="20795" y="-671.93" font-family="Arial" font-size="10.00">GPU4</text>
<text text-anchor="middle" x="20795" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer1</text>
<text text-anchor="middle" x="20795" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_qkv_gpu5 -->
<g id="node100" class="node">
<title>stage0_layer1_moe_qkv_gpu5</title>
<polygon fill="#e8f4fd" stroke="black" points="21176,-683.93 20934,-683.93 20934,-642.93 21176,-642.93 21176,-683.93"/>
<text text-anchor="middle" x="21055" y="-671.93" font-family="Arial" font-size="10.00">GPU5</text>
<text text-anchor="middle" x="21055" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer1</text>
<text text-anchor="middle" x="21055" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_experts_gpu5 -->
<g id="node101" class="node">
<title>stage0_layer1_moe_experts_gpu5</title>
<polygon fill="#e8f4fd" stroke="black" points="21436,-683.93 21194,-683.93 21194,-642.93 21436,-642.93 21436,-683.93"/>
<text text-anchor="middle" x="21315" y="-671.93" font-family="Arial" font-size="10.00">GPU5</text>
<text text-anchor="middle" x="21315" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer1</text>
<text text-anchor="middle" x="21315" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_out_gpu5 -->
<g id="node102" class="node">
<title>stage0_layer1_moe_out_gpu5</title>
<polygon fill="#e8f4fd" stroke="black" points="21696,-683.93 21454,-683.93 21454,-642.93 21696,-642.93 21696,-683.93"/>
<text text-anchor="middle" x="21575" y="-671.93" font-family="Arial" font-size="10.00">GPU5</text>
<text text-anchor="middle" x="21575" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer1</text>
<text text-anchor="middle" x="21575" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_qkv_gpu6 -->
<g id="node103" class="node">
<title>stage0_layer1_moe_qkv_gpu6</title>
<polygon fill="#e8f4fd" stroke="black" points="21956,-683.93 21714,-683.93 21714,-642.93 21956,-642.93 21956,-683.93"/>
<text text-anchor="middle" x="21835" y="-671.93" font-family="Arial" font-size="10.00">GPU6</text>
<text text-anchor="middle" x="21835" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer1</text>
<text text-anchor="middle" x="21835" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_experts_gpu6 -->
<g id="node104" class="node">
<title>stage0_layer1_moe_experts_gpu6</title>
<polygon fill="#e8f4fd" stroke="black" points="22216,-683.93 21974,-683.93 21974,-642.93 22216,-642.93 22216,-683.93"/>
<text text-anchor="middle" x="22095" y="-671.93" font-family="Arial" font-size="10.00">GPU6</text>
<text text-anchor="middle" x="22095" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer1</text>
<text text-anchor="middle" x="22095" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_out_gpu6 -->
<g id="node105" class="node">
<title>stage0_layer1_moe_out_gpu6</title>
<polygon fill="#e8f4fd" stroke="black" points="22476,-683.93 22234,-683.93 22234,-642.93 22476,-642.93 22476,-683.93"/>
<text text-anchor="middle" x="22355" y="-671.93" font-family="Arial" font-size="10.00">GPU6</text>
<text text-anchor="middle" x="22355" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer1</text>
<text text-anchor="middle" x="22355" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_qkv_gpu7 -->
<g id="node106" class="node">
<title>stage0_layer1_moe_qkv_gpu7</title>
<polygon fill="#e8f4fd" stroke="black" points="22736,-683.93 22494,-683.93 22494,-642.93 22736,-642.93 22736,-683.93"/>
<text text-anchor="middle" x="22615" y="-671.93" font-family="Arial" font-size="10.00">GPU7</text>
<text text-anchor="middle" x="22615" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer1</text>
<text text-anchor="middle" x="22615" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_experts_gpu7 -->
<g id="node107" class="node">
<title>stage0_layer1_moe_experts_gpu7</title>
<polygon fill="#e8f4fd" stroke="black" points="22996,-683.93 22754,-683.93 22754,-642.93 22996,-642.93 22996,-683.93"/>
<text text-anchor="middle" x="22875" y="-671.93" font-family="Arial" font-size="10.00">GPU7</text>
<text text-anchor="middle" x="22875" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer1</text>
<text text-anchor="middle" x="22875" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_out_gpu7 -->
<g id="node108" class="node">
<title>stage0_layer1_moe_out_gpu7</title>
<polygon fill="#e8f4fd" stroke="black" points="23256,-683.93 23014,-683.93 23014,-642.93 23256,-642.93 23256,-683.93"/>
<text text-anchor="middle" x="23135" y="-671.93" font-family="Arial" font-size="10.00">GPU7</text>
<text text-anchor="middle" x="23135" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer1</text>
<text text-anchor="middle" x="23135" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_moe_allreduce -->
<g id="node109" class="node">
<title>stage0_layer1_moe_allreduce</title>
<path fill="#e8fde8" stroke="black" d="M23786.1,-704.43C23786.1,-704.43 23393.16,-704.43 23393.16,-704.43 23387.16,-704.43 23376.39,-700.78 23371.63,-697.14 23371.63,-697.14 23283.44,-629.71 23283.44,-629.71 23278.67,-626.07 23279.9,-622.43 23285.9,-622.43 23285.9,-622.43 23678.84,-622.43 23678.84,-622.43 23684.84,-622.43 23695.61,-626.07 23700.37,-629.71 23700.37,-629.71 23788.56,-697.14 23788.56,-697.14 23793.33,-700.78 23792.1,-704.43 23786.1,-704.43"/>
<text text-anchor="middle" x="23536" y="-671.93" font-family="Arial" font-size="10.00">Layer 1</text>
<text text-anchor="middle" x="23536" y="-660.93" font-family="Arial" font-size="10.00">MoE All&#45;Reduce</text>
<text text-anchor="middle" x="23536" y="-649.93" font-family="Arial" font-size="10.00">[Input: 8×[1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage0_layer1_residual2 -->
<g id="node110" class="node">
<title>stage0_layer1_residual2</title>
<path fill="#e8fde8" stroke="black" d="M24329.1,-704.43C24329.1,-704.43 23936.16,-704.43 23936.16,-704.43 23930.16,-704.43 23919.39,-700.78 23914.63,-697.14 23914.63,-697.14 23826.44,-629.71 23826.44,-629.71 23821.67,-626.07 23822.9,-622.43 23828.9,-622.43 23828.9,-622.43 24221.84,-622.43 24221.84,-622.43 24227.84,-622.43 24238.61,-626.07 24243.37,-629.71 24243.37,-629.71 24331.56,-697.14 24331.56,-697.14 24336.33,-700.78 24335.1,-704.43 24329.1,-704.43"/>
<text text-anchor="middle" x="24079" y="-671.93" font-family="Arial" font-size="10.00">Layer 1</text>
<text text-anchor="middle" x="24079" y="-660.93" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="24079" y="-649.93" font-family="Arial" font-size="10.00">[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- pipeline_comm -->
<g id="node111" class="node">
<title>pipeline_comm</title>
<path fill="#e8fde8" stroke="black" d="M24848.79,-704.43C24848.79,-704.43 24473.84,-704.43 24473.84,-704.43 24467.84,-704.43 24457.15,-700.68 24452.47,-696.94 24452.47,-696.94 24368.59,-629.92 24368.59,-629.92 24363.9,-626.17 24365.21,-622.43 24371.21,-622.43 24371.21,-622.43 24746.16,-622.43 24746.16,-622.43 24752.16,-622.43 24762.85,-626.17 24767.53,-629.92 24767.53,-629.92 24851.41,-696.94 24851.41,-696.94 24856.1,-700.68 24854.79,-704.43 24848.79,-704.43"/>
<text text-anchor="middle" x="24610" y="-671.93" font-family="Arial" font-size="10.00">Pipeline Communication</text>
<text text-anchor="middle" x="24610" y="-660.93" font-family="Arial" font-size="10.00">Send/Recv</text>
<text text-anchor="middle" x="24610" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_norm1 -->
<g id="node112" class="node">
<title>stage1_layer2_norm1</title>
<polygon fill="#fde8e8" stroke="black" points="25121,-683.93 24879,-683.93 24879,-642.93 25121,-642.93 25121,-683.93"/>
<text text-anchor="middle" x="25000" y="-671.93" font-family="Arial" font-size="10.00">Layer 2</text>
<text text-anchor="middle" x="25000" y="-660.93" font-family="Arial" font-size="10.00">Pre&#45;Attn LayerNorm</text>
<text text-anchor="middle" x="25000" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_qkv_gpu8 -->
<g id="node113" class="node">
<title>stage1_layer2_qkv_gpu8</title>
<polygon fill="#fde8e8" stroke="black" points="25375,-683.93 25139,-683.93 25139,-642.93 25375,-642.93 25375,-683.93"/>
<text text-anchor="middle" x="25257" y="-671.93" font-family="Arial" font-size="10.00">GPU8</text>
<text text-anchor="middle" x="25257" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer2</text>
<text text-anchor="middle" x="25257" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer2_attn_gpu8 -->
<g id="node114" class="node">
<title>stage1_layer2_attn_gpu8</title>
<polygon fill="#fde8e8" stroke="black" points="25624.5,-683.93 25393.5,-683.93 25393.5,-642.93 25624.5,-642.93 25624.5,-683.93"/>
<text text-anchor="middle" x="25509" y="-671.93" font-family="Arial" font-size="10.00">GPU8</text>
<text text-anchor="middle" x="25509" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer2</text>
<text text-anchor="middle" x="25509" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer2_out_gpu8 -->
<g id="node115" class="node">
<title>stage1_layer2_out_gpu8</title>
<polygon fill="#fde8e8" stroke="black" points="25879,-683.93 25643,-683.93 25643,-642.93 25879,-642.93 25879,-683.93"/>
<text text-anchor="middle" x="25761" y="-671.93" font-family="Arial" font-size="10.00">GPU8</text>
<text text-anchor="middle" x="25761" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer2</text>
<text text-anchor="middle" x="25761" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_qkv_gpu9 -->
<g id="node116" class="node">
<title>stage1_layer2_qkv_gpu9</title>
<polygon fill="#fde8e8" stroke="black" points="26133,-683.93 25897,-683.93 25897,-642.93 26133,-642.93 26133,-683.93"/>
<text text-anchor="middle" x="26015" y="-671.93" font-family="Arial" font-size="10.00">GPU9</text>
<text text-anchor="middle" x="26015" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer2</text>
<text text-anchor="middle" x="26015" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer2_attn_gpu9 -->
<g id="node117" class="node">
<title>stage1_layer2_attn_gpu9</title>
<polygon fill="#fde8e8" stroke="black" points="26382.5,-683.93 26151.5,-683.93 26151.5,-642.93 26382.5,-642.93 26382.5,-683.93"/>
<text text-anchor="middle" x="26267" y="-671.93" font-family="Arial" font-size="10.00">GPU9</text>
<text text-anchor="middle" x="26267" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer2</text>
<text text-anchor="middle" x="26267" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer2_out_gpu9 -->
<g id="node118" class="node">
<title>stage1_layer2_out_gpu9</title>
<polygon fill="#fde8e8" stroke="black" points="26637,-683.93 26401,-683.93 26401,-642.93 26637,-642.93 26637,-683.93"/>
<text text-anchor="middle" x="26519" y="-671.93" font-family="Arial" font-size="10.00">GPU9</text>
<text text-anchor="middle" x="26519" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer2</text>
<text text-anchor="middle" x="26519" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_qkv_gpu10 -->
<g id="node119" class="node">
<title>stage1_layer2_qkv_gpu10</title>
<polygon fill="#fde8e8" stroke="black" points="26891,-683.93 26655,-683.93 26655,-642.93 26891,-642.93 26891,-683.93"/>
<text text-anchor="middle" x="26773" y="-671.93" font-family="Arial" font-size="10.00">GPU10</text>
<text text-anchor="middle" x="26773" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer2</text>
<text text-anchor="middle" x="26773" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer2_attn_gpu10 -->
<g id="node120" class="node">
<title>stage1_layer2_attn_gpu10</title>
<polygon fill="#fde8e8" stroke="black" points="27140.5,-683.93 26909.5,-683.93 26909.5,-642.93 27140.5,-642.93 27140.5,-683.93"/>
<text text-anchor="middle" x="27025" y="-671.93" font-family="Arial" font-size="10.00">GPU10</text>
<text text-anchor="middle" x="27025" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer2</text>
<text text-anchor="middle" x="27025" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer2_out_gpu10 -->
<g id="node121" class="node">
<title>stage1_layer2_out_gpu10</title>
<polygon fill="#fde8e8" stroke="black" points="27395,-683.93 27159,-683.93 27159,-642.93 27395,-642.93 27395,-683.93"/>
<text text-anchor="middle" x="27277" y="-671.93" font-family="Arial" font-size="10.00">GPU10</text>
<text text-anchor="middle" x="27277" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer2</text>
<text text-anchor="middle" x="27277" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_qkv_gpu11 -->
<g id="node122" class="node">
<title>stage1_layer2_qkv_gpu11</title>
<polygon fill="#fde8e8" stroke="black" points="27649,-683.93 27413,-683.93 27413,-642.93 27649,-642.93 27649,-683.93"/>
<text text-anchor="middle" x="27531" y="-671.93" font-family="Arial" font-size="10.00">GPU11</text>
<text text-anchor="middle" x="27531" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer2</text>
<text text-anchor="middle" x="27531" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer2_attn_gpu11 -->
<g id="node123" class="node">
<title>stage1_layer2_attn_gpu11</title>
<polygon fill="#fde8e8" stroke="black" points="27898.5,-683.93 27667.5,-683.93 27667.5,-642.93 27898.5,-642.93 27898.5,-683.93"/>
<text text-anchor="middle" x="27783" y="-671.93" font-family="Arial" font-size="10.00">GPU11</text>
<text text-anchor="middle" x="27783" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer2</text>
<text text-anchor="middle" x="27783" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer2_out_gpu11 -->
<g id="node124" class="node">
<title>stage1_layer2_out_gpu11</title>
<polygon fill="#fde8e8" stroke="black" points="28153,-683.93 27917,-683.93 27917,-642.93 28153,-642.93 28153,-683.93"/>
<text text-anchor="middle" x="28035" y="-671.93" font-family="Arial" font-size="10.00">GPU11</text>
<text text-anchor="middle" x="28035" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer2</text>
<text text-anchor="middle" x="28035" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_qkv_gpu12 -->
<g id="node125" class="node">
<title>stage1_layer2_qkv_gpu12</title>
<polygon fill="#fde8e8" stroke="black" points="28407,-683.93 28171,-683.93 28171,-642.93 28407,-642.93 28407,-683.93"/>
<text text-anchor="middle" x="28289" y="-671.93" font-family="Arial" font-size="10.00">GPU12</text>
<text text-anchor="middle" x="28289" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer2</text>
<text text-anchor="middle" x="28289" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer2_attn_gpu12 -->
<g id="node126" class="node">
<title>stage1_layer2_attn_gpu12</title>
<polygon fill="#fde8e8" stroke="black" points="28656.5,-683.93 28425.5,-683.93 28425.5,-642.93 28656.5,-642.93 28656.5,-683.93"/>
<text text-anchor="middle" x="28541" y="-671.93" font-family="Arial" font-size="10.00">GPU12</text>
<text text-anchor="middle" x="28541" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer2</text>
<text text-anchor="middle" x="28541" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer2_out_gpu12 -->
<g id="node127" class="node">
<title>stage1_layer2_out_gpu12</title>
<polygon fill="#fde8e8" stroke="black" points="28911,-683.93 28675,-683.93 28675,-642.93 28911,-642.93 28911,-683.93"/>
<text text-anchor="middle" x="28793" y="-671.93" font-family="Arial" font-size="10.00">GPU12</text>
<text text-anchor="middle" x="28793" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer2</text>
<text text-anchor="middle" x="28793" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_qkv_gpu13 -->
<g id="node128" class="node">
<title>stage1_layer2_qkv_gpu13</title>
<polygon fill="#fde8e8" stroke="black" points="29165,-683.93 28929,-683.93 28929,-642.93 29165,-642.93 29165,-683.93"/>
<text text-anchor="middle" x="29047" y="-671.93" font-family="Arial" font-size="10.00">GPU13</text>
<text text-anchor="middle" x="29047" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer2</text>
<text text-anchor="middle" x="29047" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer2_attn_gpu13 -->
<g id="node129" class="node">
<title>stage1_layer2_attn_gpu13</title>
<polygon fill="#fde8e8" stroke="black" points="29414.5,-683.93 29183.5,-683.93 29183.5,-642.93 29414.5,-642.93 29414.5,-683.93"/>
<text text-anchor="middle" x="29299" y="-671.93" font-family="Arial" font-size="10.00">GPU13</text>
<text text-anchor="middle" x="29299" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer2</text>
<text text-anchor="middle" x="29299" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer2_out_gpu13 -->
<g id="node130" class="node">
<title>stage1_layer2_out_gpu13</title>
<polygon fill="#fde8e8" stroke="black" points="29669,-683.93 29433,-683.93 29433,-642.93 29669,-642.93 29669,-683.93"/>
<text text-anchor="middle" x="29551" y="-671.93" font-family="Arial" font-size="10.00">GPU13</text>
<text text-anchor="middle" x="29551" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer2</text>
<text text-anchor="middle" x="29551" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_qkv_gpu14 -->
<g id="node131" class="node">
<title>stage1_layer2_qkv_gpu14</title>
<polygon fill="#fde8e8" stroke="black" points="29923,-683.93 29687,-683.93 29687,-642.93 29923,-642.93 29923,-683.93"/>
<text text-anchor="middle" x="29805" y="-671.93" font-family="Arial" font-size="10.00">GPU14</text>
<text text-anchor="middle" x="29805" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer2</text>
<text text-anchor="middle" x="29805" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer2_attn_gpu14 -->
<g id="node132" class="node">
<title>stage1_layer2_attn_gpu14</title>
<polygon fill="#fde8e8" stroke="black" points="30172.5,-683.93 29941.5,-683.93 29941.5,-642.93 30172.5,-642.93 30172.5,-683.93"/>
<text text-anchor="middle" x="30057" y="-671.93" font-family="Arial" font-size="10.00">GPU14</text>
<text text-anchor="middle" x="30057" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer2</text>
<text text-anchor="middle" x="30057" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer2_out_gpu14 -->
<g id="node133" class="node">
<title>stage1_layer2_out_gpu14</title>
<polygon fill="#fde8e8" stroke="black" points="30427,-683.93 30191,-683.93 30191,-642.93 30427,-642.93 30427,-683.93"/>
<text text-anchor="middle" x="30309" y="-671.93" font-family="Arial" font-size="10.00">GPU14</text>
<text text-anchor="middle" x="30309" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer2</text>
<text text-anchor="middle" x="30309" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_qkv_gpu15 -->
<g id="node134" class="node">
<title>stage1_layer2_qkv_gpu15</title>
<polygon fill="#fde8e8" stroke="black" points="30681,-683.93 30445,-683.93 30445,-642.93 30681,-642.93 30681,-683.93"/>
<text text-anchor="middle" x="30563" y="-671.93" font-family="Arial" font-size="10.00">GPU15</text>
<text text-anchor="middle" x="30563" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer2</text>
<text text-anchor="middle" x="30563" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer2_attn_gpu15 -->
<g id="node135" class="node">
<title>stage1_layer2_attn_gpu15</title>
<polygon fill="#fde8e8" stroke="black" points="30930.5,-683.93 30699.5,-683.93 30699.5,-642.93 30930.5,-642.93 30930.5,-683.93"/>
<text text-anchor="middle" x="30815" y="-671.93" font-family="Arial" font-size="10.00">GPU15</text>
<text text-anchor="middle" x="30815" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer2</text>
<text text-anchor="middle" x="30815" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer2_out_gpu15 -->
<g id="node136" class="node">
<title>stage1_layer2_out_gpu15</title>
<polygon fill="#fde8e8" stroke="black" points="31185,-683.93 30949,-683.93 30949,-642.93 31185,-642.93 31185,-683.93"/>
<text text-anchor="middle" x="31067" y="-671.93" font-family="Arial" font-size="10.00">GPU15</text>
<text text-anchor="middle" x="31067" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer2</text>
<text text-anchor="middle" x="31067" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_attn_allreduce -->
<g id="node137" class="node">
<title>stage1_layer2_attn_allreduce</title>
<path fill="#e8fde8" stroke="black" d="M31715.1,-704.43C31715.1,-704.43 31322.16,-704.43 31322.16,-704.43 31316.16,-704.43 31305.39,-700.78 31300.63,-697.14 31300.63,-697.14 31212.44,-629.71 31212.44,-629.71 31207.67,-626.07 31208.9,-622.43 31214.9,-622.43 31214.9,-622.43 31607.84,-622.43 31607.84,-622.43 31613.84,-622.43 31624.61,-626.07 31629.37,-629.71 31629.37,-629.71 31717.56,-697.14 31717.56,-697.14 31722.33,-700.78 31721.1,-704.43 31715.1,-704.43"/>
<text text-anchor="middle" x="31465" y="-671.93" font-family="Arial" font-size="10.00">Layer 2</text>
<text text-anchor="middle" x="31465" y="-660.93" font-family="Arial" font-size="10.00">Attention All&#45;Reduce</text>
<text text-anchor="middle" x="31465" y="-649.93" font-family="Arial" font-size="10.00">[Input: 8×[1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_residual1 -->
<g id="node138" class="node">
<title>stage1_layer2_residual1</title>
<path fill="#e8fde8" stroke="black" d="M32258.1,-704.43C32258.1,-704.43 31865.16,-704.43 31865.16,-704.43 31859.16,-704.43 31848.39,-700.78 31843.63,-697.14 31843.63,-697.14 31755.44,-629.71 31755.44,-629.71 31750.67,-626.07 31751.9,-622.43 31757.9,-622.43 31757.9,-622.43 32150.84,-622.43 32150.84,-622.43 32156.84,-622.43 32167.61,-626.07 32172.37,-629.71 32172.37,-629.71 32260.56,-697.14 32260.56,-697.14 32265.33,-700.78 32264.1,-704.43 32258.1,-704.43"/>
<text text-anchor="middle" x="32008" y="-671.93" font-family="Arial" font-size="10.00">Layer 2</text>
<text text-anchor="middle" x="32008" y="-660.93" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="32008" y="-649.93" font-family="Arial" font-size="10.00">[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_norm2 -->
<g id="node139" class="node">
<title>stage1_layer2_norm2</title>
<polygon fill="#fde8e8" stroke="black" points="32530,-683.93 32288,-683.93 32288,-642.93 32530,-642.93 32530,-683.93"/>
<text text-anchor="middle" x="32409" y="-671.93" font-family="Arial" font-size="10.00">Layer 2</text>
<text text-anchor="middle" x="32409" y="-660.93" font-family="Arial" font-size="10.00">Pre&#45;MoE LayerNorm</text>
<text text-anchor="middle" x="32409" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_qkv_gpu8 -->
<g id="node140" class="node">
<title>stage1_layer2_moe_qkv_gpu8</title>
<polygon fill="#fde8e8" stroke="black" points="32790,-683.93 32548,-683.93 32548,-642.93 32790,-642.93 32790,-683.93"/>
<text text-anchor="middle" x="32669" y="-671.93" font-family="Arial" font-size="10.00">GPU8</text>
<text text-anchor="middle" x="32669" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer2</text>
<text text-anchor="middle" x="32669" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_experts_gpu8 -->
<g id="node141" class="node">
<title>stage1_layer2_moe_experts_gpu8</title>
<polygon fill="#fde8e8" stroke="black" points="33050,-683.93 32808,-683.93 32808,-642.93 33050,-642.93 33050,-683.93"/>
<text text-anchor="middle" x="32929" y="-671.93" font-family="Arial" font-size="10.00">GPU8</text>
<text text-anchor="middle" x="32929" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer2</text>
<text text-anchor="middle" x="32929" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_out_gpu8 -->
<g id="node142" class="node">
<title>stage1_layer2_moe_out_gpu8</title>
<polygon fill="#fde8e8" stroke="black" points="33310,-683.93 33068,-683.93 33068,-642.93 33310,-642.93 33310,-683.93"/>
<text text-anchor="middle" x="33189" y="-671.93" font-family="Arial" font-size="10.00">GPU8</text>
<text text-anchor="middle" x="33189" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer2</text>
<text text-anchor="middle" x="33189" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_qkv_gpu9 -->
<g id="node143" class="node">
<title>stage1_layer2_moe_qkv_gpu9</title>
<polygon fill="#fde8e8" stroke="black" points="33570,-683.93 33328,-683.93 33328,-642.93 33570,-642.93 33570,-683.93"/>
<text text-anchor="middle" x="33449" y="-671.93" font-family="Arial" font-size="10.00">GPU9</text>
<text text-anchor="middle" x="33449" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer2</text>
<text text-anchor="middle" x="33449" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_experts_gpu9 -->
<g id="node144" class="node">
<title>stage1_layer2_moe_experts_gpu9</title>
<polygon fill="#fde8e8" stroke="black" points="33830,-683.93 33588,-683.93 33588,-642.93 33830,-642.93 33830,-683.93"/>
<text text-anchor="middle" x="33709" y="-671.93" font-family="Arial" font-size="10.00">GPU9</text>
<text text-anchor="middle" x="33709" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer2</text>
<text text-anchor="middle" x="33709" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_out_gpu9 -->
<g id="node145" class="node">
<title>stage1_layer2_moe_out_gpu9</title>
<polygon fill="#fde8e8" stroke="black" points="34090,-683.93 33848,-683.93 33848,-642.93 34090,-642.93 34090,-683.93"/>
<text text-anchor="middle" x="33969" y="-671.93" font-family="Arial" font-size="10.00">GPU9</text>
<text text-anchor="middle" x="33969" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer2</text>
<text text-anchor="middle" x="33969" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_qkv_gpu10 -->
<g id="node146" class="node">
<title>stage1_layer2_moe_qkv_gpu10</title>
<polygon fill="#fde8e8" stroke="black" points="34350,-683.93 34108,-683.93 34108,-642.93 34350,-642.93 34350,-683.93"/>
<text text-anchor="middle" x="34229" y="-671.93" font-family="Arial" font-size="10.00">GPU10</text>
<text text-anchor="middle" x="34229" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer2</text>
<text text-anchor="middle" x="34229" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_experts_gpu10 -->
<g id="node147" class="node">
<title>stage1_layer2_moe_experts_gpu10</title>
<polygon fill="#fde8e8" stroke="black" points="34610,-683.93 34368,-683.93 34368,-642.93 34610,-642.93 34610,-683.93"/>
<text text-anchor="middle" x="34489" y="-671.93" font-family="Arial" font-size="10.00">GPU10</text>
<text text-anchor="middle" x="34489" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer2</text>
<text text-anchor="middle" x="34489" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_out_gpu10 -->
<g id="node148" class="node">
<title>stage1_layer2_moe_out_gpu10</title>
<polygon fill="#fde8e8" stroke="black" points="34870,-683.93 34628,-683.93 34628,-642.93 34870,-642.93 34870,-683.93"/>
<text text-anchor="middle" x="34749" y="-671.93" font-family="Arial" font-size="10.00">GPU10</text>
<text text-anchor="middle" x="34749" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer2</text>
<text text-anchor="middle" x="34749" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_qkv_gpu11 -->
<g id="node149" class="node">
<title>stage1_layer2_moe_qkv_gpu11</title>
<polygon fill="#fde8e8" stroke="black" points="35130,-683.93 34888,-683.93 34888,-642.93 35130,-642.93 35130,-683.93"/>
<text text-anchor="middle" x="35009" y="-671.93" font-family="Arial" font-size="10.00">GPU11</text>
<text text-anchor="middle" x="35009" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer2</text>
<text text-anchor="middle" x="35009" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_experts_gpu11 -->
<g id="node150" class="node">
<title>stage1_layer2_moe_experts_gpu11</title>
<polygon fill="#fde8e8" stroke="black" points="35390,-683.93 35148,-683.93 35148,-642.93 35390,-642.93 35390,-683.93"/>
<text text-anchor="middle" x="35269" y="-671.93" font-family="Arial" font-size="10.00">GPU11</text>
<text text-anchor="middle" x="35269" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer2</text>
<text text-anchor="middle" x="35269" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_out_gpu11 -->
<g id="node151" class="node">
<title>stage1_layer2_moe_out_gpu11</title>
<polygon fill="#fde8e8" stroke="black" points="35650,-683.93 35408,-683.93 35408,-642.93 35650,-642.93 35650,-683.93"/>
<text text-anchor="middle" x="35529" y="-671.93" font-family="Arial" font-size="10.00">GPU11</text>
<text text-anchor="middle" x="35529" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer2</text>
<text text-anchor="middle" x="35529" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_qkv_gpu12 -->
<g id="node152" class="node">
<title>stage1_layer2_moe_qkv_gpu12</title>
<polygon fill="#fde8e8" stroke="black" points="35910,-683.93 35668,-683.93 35668,-642.93 35910,-642.93 35910,-683.93"/>
<text text-anchor="middle" x="35789" y="-671.93" font-family="Arial" font-size="10.00">GPU12</text>
<text text-anchor="middle" x="35789" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer2</text>
<text text-anchor="middle" x="35789" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_experts_gpu12 -->
<g id="node153" class="node">
<title>stage1_layer2_moe_experts_gpu12</title>
<polygon fill="#fde8e8" stroke="black" points="36170,-683.93 35928,-683.93 35928,-642.93 36170,-642.93 36170,-683.93"/>
<text text-anchor="middle" x="36049" y="-671.93" font-family="Arial" font-size="10.00">GPU12</text>
<text text-anchor="middle" x="36049" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer2</text>
<text text-anchor="middle" x="36049" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_out_gpu12 -->
<g id="node154" class="node">
<title>stage1_layer2_moe_out_gpu12</title>
<polygon fill="#fde8e8" stroke="black" points="36430,-683.93 36188,-683.93 36188,-642.93 36430,-642.93 36430,-683.93"/>
<text text-anchor="middle" x="36309" y="-671.93" font-family="Arial" font-size="10.00">GPU12</text>
<text text-anchor="middle" x="36309" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer2</text>
<text text-anchor="middle" x="36309" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_qkv_gpu13 -->
<g id="node155" class="node">
<title>stage1_layer2_moe_qkv_gpu13</title>
<polygon fill="#fde8e8" stroke="black" points="36690,-683.93 36448,-683.93 36448,-642.93 36690,-642.93 36690,-683.93"/>
<text text-anchor="middle" x="36569" y="-671.93" font-family="Arial" font-size="10.00">GPU13</text>
<text text-anchor="middle" x="36569" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer2</text>
<text text-anchor="middle" x="36569" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_experts_gpu13 -->
<g id="node156" class="node">
<title>stage1_layer2_moe_experts_gpu13</title>
<polygon fill="#fde8e8" stroke="black" points="36950,-683.93 36708,-683.93 36708,-642.93 36950,-642.93 36950,-683.93"/>
<text text-anchor="middle" x="36829" y="-671.93" font-family="Arial" font-size="10.00">GPU13</text>
<text text-anchor="middle" x="36829" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer2</text>
<text text-anchor="middle" x="36829" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_out_gpu13 -->
<g id="node157" class="node">
<title>stage1_layer2_moe_out_gpu13</title>
<polygon fill="#fde8e8" stroke="black" points="37210,-683.93 36968,-683.93 36968,-642.93 37210,-642.93 37210,-683.93"/>
<text text-anchor="middle" x="37089" y="-671.93" font-family="Arial" font-size="10.00">GPU13</text>
<text text-anchor="middle" x="37089" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer2</text>
<text text-anchor="middle" x="37089" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_qkv_gpu14 -->
<g id="node158" class="node">
<title>stage1_layer2_moe_qkv_gpu14</title>
<polygon fill="#fde8e8" stroke="black" points="37470,-683.93 37228,-683.93 37228,-642.93 37470,-642.93 37470,-683.93"/>
<text text-anchor="middle" x="37349" y="-671.93" font-family="Arial" font-size="10.00">GPU14</text>
<text text-anchor="middle" x="37349" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer2</text>
<text text-anchor="middle" x="37349" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_experts_gpu14 -->
<g id="node159" class="node">
<title>stage1_layer2_moe_experts_gpu14</title>
<polygon fill="#fde8e8" stroke="black" points="37730,-683.93 37488,-683.93 37488,-642.93 37730,-642.93 37730,-683.93"/>
<text text-anchor="middle" x="37609" y="-671.93" font-family="Arial" font-size="10.00">GPU14</text>
<text text-anchor="middle" x="37609" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer2</text>
<text text-anchor="middle" x="37609" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_out_gpu14 -->
<g id="node160" class="node">
<title>stage1_layer2_moe_out_gpu14</title>
<polygon fill="#fde8e8" stroke="black" points="37990,-683.93 37748,-683.93 37748,-642.93 37990,-642.93 37990,-683.93"/>
<text text-anchor="middle" x="37869" y="-671.93" font-family="Arial" font-size="10.00">GPU14</text>
<text text-anchor="middle" x="37869" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer2</text>
<text text-anchor="middle" x="37869" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_qkv_gpu15 -->
<g id="node161" class="node">
<title>stage1_layer2_moe_qkv_gpu15</title>
<polygon fill="#fde8e8" stroke="black" points="38250,-683.93 38008,-683.93 38008,-642.93 38250,-642.93 38250,-683.93"/>
<text text-anchor="middle" x="38129" y="-671.93" font-family="Arial" font-size="10.00">GPU15</text>
<text text-anchor="middle" x="38129" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer2</text>
<text text-anchor="middle" x="38129" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_experts_gpu15 -->
<g id="node162" class="node">
<title>stage1_layer2_moe_experts_gpu15</title>
<polygon fill="#fde8e8" stroke="black" points="38510,-683.93 38268,-683.93 38268,-642.93 38510,-642.93 38510,-683.93"/>
<text text-anchor="middle" x="38389" y="-671.93" font-family="Arial" font-size="10.00">GPU15</text>
<text text-anchor="middle" x="38389" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer2</text>
<text text-anchor="middle" x="38389" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_out_gpu15 -->
<g id="node163" class="node">
<title>stage1_layer2_moe_out_gpu15</title>
<polygon fill="#fde8e8" stroke="black" points="38770,-683.93 38528,-683.93 38528,-642.93 38770,-642.93 38770,-683.93"/>
<text text-anchor="middle" x="38649" y="-671.93" font-family="Arial" font-size="10.00">GPU15</text>
<text text-anchor="middle" x="38649" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer2</text>
<text text-anchor="middle" x="38649" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_moe_allreduce -->
<g id="node164" class="node">
<title>stage1_layer2_moe_allreduce</title>
<path fill="#e8fde8" stroke="black" d="M39300.1,-704.43C39300.1,-704.43 38907.16,-704.43 38907.16,-704.43 38901.16,-704.43 38890.39,-700.78 38885.63,-697.14 38885.63,-697.14 38797.44,-629.71 38797.44,-629.71 38792.67,-626.07 38793.9,-622.43 38799.9,-622.43 38799.9,-622.43 39192.84,-622.43 39192.84,-622.43 39198.84,-622.43 39209.61,-626.07 39214.37,-629.71 39214.37,-629.71 39302.56,-697.14 39302.56,-697.14 39307.33,-700.78 39306.1,-704.43 39300.1,-704.43"/>
<text text-anchor="middle" x="39050" y="-671.93" font-family="Arial" font-size="10.00">Layer 2</text>
<text text-anchor="middle" x="39050" y="-660.93" font-family="Arial" font-size="10.00">MoE All&#45;Reduce</text>
<text text-anchor="middle" x="39050" y="-649.93" font-family="Arial" font-size="10.00">[Input: 8×[1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer2_residual2 -->
<g id="node165" class="node">
<title>stage1_layer2_residual2</title>
<path fill="#e8fde8" stroke="black" d="M39843.1,-704.43C39843.1,-704.43 39450.16,-704.43 39450.16,-704.43 39444.16,-704.43 39433.39,-700.78 39428.63,-697.14 39428.63,-697.14 39340.44,-629.71 39340.44,-629.71 39335.67,-626.07 39336.9,-622.43 39342.9,-622.43 39342.9,-622.43 39735.84,-622.43 39735.84,-622.43 39741.84,-622.43 39752.61,-626.07 39757.37,-629.71 39757.37,-629.71 39845.56,-697.14 39845.56,-697.14 39850.33,-700.78 39849.1,-704.43 39843.1,-704.43"/>
<text text-anchor="middle" x="39593" y="-671.93" font-family="Arial" font-size="10.00">Layer 2</text>
<text text-anchor="middle" x="39593" y="-660.93" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="39593" y="-649.93" font-family="Arial" font-size="10.00">[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_norm1 -->
<g id="node166" class="node">
<title>stage1_layer3_norm1</title>
<polygon fill="#fde8e8" stroke="black" points="40115,-683.93 39873,-683.93 39873,-642.93 40115,-642.93 40115,-683.93"/>
<text text-anchor="middle" x="39994" y="-671.93" font-family="Arial" font-size="10.00">Layer 3</text>
<text text-anchor="middle" x="39994" y="-660.93" font-family="Arial" font-size="10.00">Pre&#45;Attn LayerNorm</text>
<text text-anchor="middle" x="39994" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_qkv_gpu8 -->
<g id="node167" class="node">
<title>stage1_layer3_qkv_gpu8</title>
<polygon fill="#fde8e8" stroke="black" points="40369,-683.93 40133,-683.93 40133,-642.93 40369,-642.93 40369,-683.93"/>
<text text-anchor="middle" x="40251" y="-671.93" font-family="Arial" font-size="10.00">GPU8</text>
<text text-anchor="middle" x="40251" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer3</text>
<text text-anchor="middle" x="40251" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer3_attn_gpu8 -->
<g id="node168" class="node">
<title>stage1_layer3_attn_gpu8</title>
<polygon fill="#fde8e8" stroke="black" points="40618.5,-683.93 40387.5,-683.93 40387.5,-642.93 40618.5,-642.93 40618.5,-683.93"/>
<text text-anchor="middle" x="40503" y="-671.93" font-family="Arial" font-size="10.00">GPU8</text>
<text text-anchor="middle" x="40503" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer3</text>
<text text-anchor="middle" x="40503" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer3_out_gpu8 -->
<g id="node169" class="node">
<title>stage1_layer3_out_gpu8</title>
<polygon fill="#fde8e8" stroke="black" points="40873,-683.93 40637,-683.93 40637,-642.93 40873,-642.93 40873,-683.93"/>
<text text-anchor="middle" x="40755" y="-671.93" font-family="Arial" font-size="10.00">GPU8</text>
<text text-anchor="middle" x="40755" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer3</text>
<text text-anchor="middle" x="40755" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_qkv_gpu9 -->
<g id="node170" class="node">
<title>stage1_layer3_qkv_gpu9</title>
<polygon fill="#fde8e8" stroke="black" points="41127,-683.93 40891,-683.93 40891,-642.93 41127,-642.93 41127,-683.93"/>
<text text-anchor="middle" x="41009" y="-671.93" font-family="Arial" font-size="10.00">GPU9</text>
<text text-anchor="middle" x="41009" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer3</text>
<text text-anchor="middle" x="41009" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer3_attn_gpu9 -->
<g id="node171" class="node">
<title>stage1_layer3_attn_gpu9</title>
<polygon fill="#fde8e8" stroke="black" points="41376.5,-683.93 41145.5,-683.93 41145.5,-642.93 41376.5,-642.93 41376.5,-683.93"/>
<text text-anchor="middle" x="41261" y="-671.93" font-family="Arial" font-size="10.00">GPU9</text>
<text text-anchor="middle" x="41261" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer3</text>
<text text-anchor="middle" x="41261" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer3_out_gpu9 -->
<g id="node172" class="node">
<title>stage1_layer3_out_gpu9</title>
<polygon fill="#fde8e8" stroke="black" points="41631,-683.93 41395,-683.93 41395,-642.93 41631,-642.93 41631,-683.93"/>
<text text-anchor="middle" x="41513" y="-671.93" font-family="Arial" font-size="10.00">GPU9</text>
<text text-anchor="middle" x="41513" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer3</text>
<text text-anchor="middle" x="41513" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_qkv_gpu10 -->
<g id="node173" class="node">
<title>stage1_layer3_qkv_gpu10</title>
<polygon fill="#fde8e8" stroke="black" points="41885,-683.93 41649,-683.93 41649,-642.93 41885,-642.93 41885,-683.93"/>
<text text-anchor="middle" x="41767" y="-671.93" font-family="Arial" font-size="10.00">GPU10</text>
<text text-anchor="middle" x="41767" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer3</text>
<text text-anchor="middle" x="41767" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer3_attn_gpu10 -->
<g id="node174" class="node">
<title>stage1_layer3_attn_gpu10</title>
<polygon fill="#fde8e8" stroke="black" points="42134.5,-683.93 41903.5,-683.93 41903.5,-642.93 42134.5,-642.93 42134.5,-683.93"/>
<text text-anchor="middle" x="42019" y="-671.93" font-family="Arial" font-size="10.00">GPU10</text>
<text text-anchor="middle" x="42019" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer3</text>
<text text-anchor="middle" x="42019" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer3_out_gpu10 -->
<g id="node175" class="node">
<title>stage1_layer3_out_gpu10</title>
<polygon fill="#fde8e8" stroke="black" points="42389,-683.93 42153,-683.93 42153,-642.93 42389,-642.93 42389,-683.93"/>
<text text-anchor="middle" x="42271" y="-671.93" font-family="Arial" font-size="10.00">GPU10</text>
<text text-anchor="middle" x="42271" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer3</text>
<text text-anchor="middle" x="42271" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_qkv_gpu11 -->
<g id="node176" class="node">
<title>stage1_layer3_qkv_gpu11</title>
<polygon fill="#fde8e8" stroke="black" points="42643,-683.93 42407,-683.93 42407,-642.93 42643,-642.93 42643,-683.93"/>
<text text-anchor="middle" x="42525" y="-671.93" font-family="Arial" font-size="10.00">GPU11</text>
<text text-anchor="middle" x="42525" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer3</text>
<text text-anchor="middle" x="42525" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer3_attn_gpu11 -->
<g id="node177" class="node">
<title>stage1_layer3_attn_gpu11</title>
<polygon fill="#fde8e8" stroke="black" points="42892.5,-683.93 42661.5,-683.93 42661.5,-642.93 42892.5,-642.93 42892.5,-683.93"/>
<text text-anchor="middle" x="42777" y="-671.93" font-family="Arial" font-size="10.00">GPU11</text>
<text text-anchor="middle" x="42777" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer3</text>
<text text-anchor="middle" x="42777" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer3_out_gpu11 -->
<g id="node178" class="node">
<title>stage1_layer3_out_gpu11</title>
<polygon fill="#fde8e8" stroke="black" points="43147,-683.93 42911,-683.93 42911,-642.93 43147,-642.93 43147,-683.93"/>
<text text-anchor="middle" x="43029" y="-671.93" font-family="Arial" font-size="10.00">GPU11</text>
<text text-anchor="middle" x="43029" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer3</text>
<text text-anchor="middle" x="43029" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_qkv_gpu12 -->
<g id="node179" class="node">
<title>stage1_layer3_qkv_gpu12</title>
<polygon fill="#fde8e8" stroke="black" points="43401,-683.93 43165,-683.93 43165,-642.93 43401,-642.93 43401,-683.93"/>
<text text-anchor="middle" x="43283" y="-671.93" font-family="Arial" font-size="10.00">GPU12</text>
<text text-anchor="middle" x="43283" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer3</text>
<text text-anchor="middle" x="43283" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer3_attn_gpu12 -->
<g id="node180" class="node">
<title>stage1_layer3_attn_gpu12</title>
<polygon fill="#fde8e8" stroke="black" points="43650.5,-683.93 43419.5,-683.93 43419.5,-642.93 43650.5,-642.93 43650.5,-683.93"/>
<text text-anchor="middle" x="43535" y="-671.93" font-family="Arial" font-size="10.00">GPU12</text>
<text text-anchor="middle" x="43535" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer3</text>
<text text-anchor="middle" x="43535" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer3_out_gpu12 -->
<g id="node181" class="node">
<title>stage1_layer3_out_gpu12</title>
<polygon fill="#fde8e8" stroke="black" points="43905,-683.93 43669,-683.93 43669,-642.93 43905,-642.93 43905,-683.93"/>
<text text-anchor="middle" x="43787" y="-671.93" font-family="Arial" font-size="10.00">GPU12</text>
<text text-anchor="middle" x="43787" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer3</text>
<text text-anchor="middle" x="43787" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_qkv_gpu13 -->
<g id="node182" class="node">
<title>stage1_layer3_qkv_gpu13</title>
<polygon fill="#fde8e8" stroke="black" points="44159,-683.93 43923,-683.93 43923,-642.93 44159,-642.93 44159,-683.93"/>
<text text-anchor="middle" x="44041" y="-671.93" font-family="Arial" font-size="10.00">GPU13</text>
<text text-anchor="middle" x="44041" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer3</text>
<text text-anchor="middle" x="44041" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer3_attn_gpu13 -->
<g id="node183" class="node">
<title>stage1_layer3_attn_gpu13</title>
<polygon fill="#fde8e8" stroke="black" points="44408.5,-683.93 44177.5,-683.93 44177.5,-642.93 44408.5,-642.93 44408.5,-683.93"/>
<text text-anchor="middle" x="44293" y="-671.93" font-family="Arial" font-size="10.00">GPU13</text>
<text text-anchor="middle" x="44293" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer3</text>
<text text-anchor="middle" x="44293" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer3_out_gpu13 -->
<g id="node184" class="node">
<title>stage1_layer3_out_gpu13</title>
<polygon fill="#fde8e8" stroke="black" points="44663,-683.93 44427,-683.93 44427,-642.93 44663,-642.93 44663,-683.93"/>
<text text-anchor="middle" x="44545" y="-671.93" font-family="Arial" font-size="10.00">GPU13</text>
<text text-anchor="middle" x="44545" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer3</text>
<text text-anchor="middle" x="44545" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_qkv_gpu14 -->
<g id="node185" class="node">
<title>stage1_layer3_qkv_gpu14</title>
<polygon fill="#fde8e8" stroke="black" points="44917,-683.93 44681,-683.93 44681,-642.93 44917,-642.93 44917,-683.93"/>
<text text-anchor="middle" x="44799" y="-671.93" font-family="Arial" font-size="10.00">GPU14</text>
<text text-anchor="middle" x="44799" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer3</text>
<text text-anchor="middle" x="44799" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer3_attn_gpu14 -->
<g id="node186" class="node">
<title>stage1_layer3_attn_gpu14</title>
<polygon fill="#fde8e8" stroke="black" points="45166.5,-683.93 44935.5,-683.93 44935.5,-642.93 45166.5,-642.93 45166.5,-683.93"/>
<text text-anchor="middle" x="45051" y="-671.93" font-family="Arial" font-size="10.00">GPU14</text>
<text text-anchor="middle" x="45051" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer3</text>
<text text-anchor="middle" x="45051" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer3_out_gpu14 -->
<g id="node187" class="node">
<title>stage1_layer3_out_gpu14</title>
<polygon fill="#fde8e8" stroke="black" points="45421,-683.93 45185,-683.93 45185,-642.93 45421,-642.93 45421,-683.93"/>
<text text-anchor="middle" x="45303" y="-671.93" font-family="Arial" font-size="10.00">GPU14</text>
<text text-anchor="middle" x="45303" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer3</text>
<text text-anchor="middle" x="45303" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_qkv_gpu15 -->
<g id="node188" class="node">
<title>stage1_layer3_qkv_gpu15</title>
<polygon fill="#fde8e8" stroke="black" points="45675,-683.93 45439,-683.93 45439,-642.93 45675,-642.93 45675,-683.93"/>
<text text-anchor="middle" x="45557" y="-671.93" font-family="Arial" font-size="10.00">GPU15</text>
<text text-anchor="middle" x="45557" y="-660.93" font-family="Arial" font-size="10.00">QKV Proj Layer3</text>
<text text-anchor="middle" x="45557" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer3_attn_gpu15 -->
<g id="node189" class="node">
<title>stage1_layer3_attn_gpu15</title>
<polygon fill="#fde8e8" stroke="black" points="45924.5,-683.93 45693.5,-683.93 45693.5,-642.93 45924.5,-642.93 45924.5,-683.93"/>
<text text-anchor="middle" x="45809" y="-671.93" font-family="Arial" font-size="10.00">GPU15</text>
<text text-anchor="middle" x="45809" y="-660.93" font-family="Arial" font-size="10.00">Attn Layer3</text>
<text text-anchor="middle" x="45809" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,512]]</text>
</g>
<!-- stage1_layer3_out_gpu15 -->
<g id="node190" class="node">
<title>stage1_layer3_out_gpu15</title>
<polygon fill="#fde8e8" stroke="black" points="46179,-683.93 45943,-683.93 45943,-642.93 46179,-642.93 46179,-683.93"/>
<text text-anchor="middle" x="46061" y="-671.93" font-family="Arial" font-size="10.00">GPU15</text>
<text text-anchor="middle" x="46061" y="-660.93" font-family="Arial" font-size="10.00">Output Proj Layer3</text>
<text text-anchor="middle" x="46061" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,512], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_attn_allreduce -->
<g id="node191" class="node">
<title>stage1_layer3_attn_allreduce</title>
<path fill="#e8fde8" stroke="black" d="M46709.1,-704.43C46709.1,-704.43 46316.16,-704.43 46316.16,-704.43 46310.16,-704.43 46299.39,-700.78 46294.63,-697.14 46294.63,-697.14 46206.44,-629.71 46206.44,-629.71 46201.67,-626.07 46202.9,-622.43 46208.9,-622.43 46208.9,-622.43 46601.84,-622.43 46601.84,-622.43 46607.84,-622.43 46618.61,-626.07 46623.37,-629.71 46623.37,-629.71 46711.56,-697.14 46711.56,-697.14 46716.33,-700.78 46715.1,-704.43 46709.1,-704.43"/>
<text text-anchor="middle" x="46459" y="-671.93" font-family="Arial" font-size="10.00">Layer 3</text>
<text text-anchor="middle" x="46459" y="-660.93" font-family="Arial" font-size="10.00">Attention All&#45;Reduce</text>
<text text-anchor="middle" x="46459" y="-649.93" font-family="Arial" font-size="10.00">[Input: 8×[1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_residual1 -->
<g id="node192" class="node">
<title>stage1_layer3_residual1</title>
<path fill="#e8fde8" stroke="black" d="M47252.1,-704.43C47252.1,-704.43 46859.16,-704.43 46859.16,-704.43 46853.16,-704.43 46842.39,-700.78 46837.63,-697.14 46837.63,-697.14 46749.44,-629.71 46749.44,-629.71 46744.67,-626.07 46745.9,-622.43 46751.9,-622.43 46751.9,-622.43 47144.84,-622.43 47144.84,-622.43 47150.84,-622.43 47161.61,-626.07 47166.37,-629.71 47166.37,-629.71 47254.56,-697.14 47254.56,-697.14 47259.33,-700.78 47258.1,-704.43 47252.1,-704.43"/>
<text text-anchor="middle" x="47002" y="-671.93" font-family="Arial" font-size="10.00">Layer 3</text>
<text text-anchor="middle" x="47002" y="-660.93" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="47002" y="-649.93" font-family="Arial" font-size="10.00">[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_norm2 -->
<g id="node193" class="node">
<title>stage1_layer3_norm2</title>
<polygon fill="#fde8e8" stroke="black" points="47524,-683.93 47282,-683.93 47282,-642.93 47524,-642.93 47524,-683.93"/>
<text text-anchor="middle" x="47403" y="-671.93" font-family="Arial" font-size="10.00">Layer 3</text>
<text text-anchor="middle" x="47403" y="-660.93" font-family="Arial" font-size="10.00">Pre&#45;MoE LayerNorm</text>
<text text-anchor="middle" x="47403" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_qkv_gpu8 -->
<g id="node194" class="node">
<title>stage1_layer3_moe_qkv_gpu8</title>
<polygon fill="#fde8e8" stroke="black" points="47784,-683.93 47542,-683.93 47542,-642.93 47784,-642.93 47784,-683.93"/>
<text text-anchor="middle" x="47663" y="-671.93" font-family="Arial" font-size="10.00">GPU8</text>
<text text-anchor="middle" x="47663" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer3</text>
<text text-anchor="middle" x="47663" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_experts_gpu8 -->
<g id="node195" class="node">
<title>stage1_layer3_moe_experts_gpu8</title>
<polygon fill="#fde8e8" stroke="black" points="48044,-683.93 47802,-683.93 47802,-642.93 48044,-642.93 48044,-683.93"/>
<text text-anchor="middle" x="47923" y="-671.93" font-family="Arial" font-size="10.00">GPU8</text>
<text text-anchor="middle" x="47923" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer3</text>
<text text-anchor="middle" x="47923" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_out_gpu8 -->
<g id="node196" class="node">
<title>stage1_layer3_moe_out_gpu8</title>
<polygon fill="#fde8e8" stroke="black" points="48304,-683.93 48062,-683.93 48062,-642.93 48304,-642.93 48304,-683.93"/>
<text text-anchor="middle" x="48183" y="-671.93" font-family="Arial" font-size="10.00">GPU8</text>
<text text-anchor="middle" x="48183" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer3</text>
<text text-anchor="middle" x="48183" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_qkv_gpu9 -->
<g id="node197" class="node">
<title>stage1_layer3_moe_qkv_gpu9</title>
<polygon fill="#fde8e8" stroke="black" points="48564,-683.93 48322,-683.93 48322,-642.93 48564,-642.93 48564,-683.93"/>
<text text-anchor="middle" x="48443" y="-671.93" font-family="Arial" font-size="10.00">GPU9</text>
<text text-anchor="middle" x="48443" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer3</text>
<text text-anchor="middle" x="48443" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_experts_gpu9 -->
<g id="node198" class="node">
<title>stage1_layer3_moe_experts_gpu9</title>
<polygon fill="#fde8e8" stroke="black" points="48824,-683.93 48582,-683.93 48582,-642.93 48824,-642.93 48824,-683.93"/>
<text text-anchor="middle" x="48703" y="-671.93" font-family="Arial" font-size="10.00">GPU9</text>
<text text-anchor="middle" x="48703" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer3</text>
<text text-anchor="middle" x="48703" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_out_gpu9 -->
<g id="node199" class="node">
<title>stage1_layer3_moe_out_gpu9</title>
<polygon fill="#fde8e8" stroke="black" points="49084,-683.93 48842,-683.93 48842,-642.93 49084,-642.93 49084,-683.93"/>
<text text-anchor="middle" x="48963" y="-671.93" font-family="Arial" font-size="10.00">GPU9</text>
<text text-anchor="middle" x="48963" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer3</text>
<text text-anchor="middle" x="48963" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_qkv_gpu10 -->
<g id="node200" class="node">
<title>stage1_layer3_moe_qkv_gpu10</title>
<polygon fill="#fde8e8" stroke="black" points="49344,-683.93 49102,-683.93 49102,-642.93 49344,-642.93 49344,-683.93"/>
<text text-anchor="middle" x="49223" y="-671.93" font-family="Arial" font-size="10.00">GPU10</text>
<text text-anchor="middle" x="49223" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer3</text>
<text text-anchor="middle" x="49223" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_experts_gpu10 -->
<g id="node201" class="node">
<title>stage1_layer3_moe_experts_gpu10</title>
<polygon fill="#fde8e8" stroke="black" points="49604,-683.93 49362,-683.93 49362,-642.93 49604,-642.93 49604,-683.93"/>
<text text-anchor="middle" x="49483" y="-671.93" font-family="Arial" font-size="10.00">GPU10</text>
<text text-anchor="middle" x="49483" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer3</text>
<text text-anchor="middle" x="49483" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_out_gpu10 -->
<g id="node202" class="node">
<title>stage1_layer3_moe_out_gpu10</title>
<polygon fill="#fde8e8" stroke="black" points="49864,-683.93 49622,-683.93 49622,-642.93 49864,-642.93 49864,-683.93"/>
<text text-anchor="middle" x="49743" y="-671.93" font-family="Arial" font-size="10.00">GPU10</text>
<text text-anchor="middle" x="49743" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer3</text>
<text text-anchor="middle" x="49743" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_qkv_gpu11 -->
<g id="node203" class="node">
<title>stage1_layer3_moe_qkv_gpu11</title>
<polygon fill="#fde8e8" stroke="black" points="50124,-683.93 49882,-683.93 49882,-642.93 50124,-642.93 50124,-683.93"/>
<text text-anchor="middle" x="50003" y="-671.93" font-family="Arial" font-size="10.00">GPU11</text>
<text text-anchor="middle" x="50003" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer3</text>
<text text-anchor="middle" x="50003" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_experts_gpu11 -->
<g id="node204" class="node">
<title>stage1_layer3_moe_experts_gpu11</title>
<polygon fill="#fde8e8" stroke="black" points="50384,-683.93 50142,-683.93 50142,-642.93 50384,-642.93 50384,-683.93"/>
<text text-anchor="middle" x="50263" y="-671.93" font-family="Arial" font-size="10.00">GPU11</text>
<text text-anchor="middle" x="50263" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer3</text>
<text text-anchor="middle" x="50263" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_out_gpu11 -->
<g id="node205" class="node">
<title>stage1_layer3_moe_out_gpu11</title>
<polygon fill="#fde8e8" stroke="black" points="50644,-683.93 50402,-683.93 50402,-642.93 50644,-642.93 50644,-683.93"/>
<text text-anchor="middle" x="50523" y="-671.93" font-family="Arial" font-size="10.00">GPU11</text>
<text text-anchor="middle" x="50523" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer3</text>
<text text-anchor="middle" x="50523" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_qkv_gpu12 -->
<g id="node206" class="node">
<title>stage1_layer3_moe_qkv_gpu12</title>
<polygon fill="#fde8e8" stroke="black" points="50904,-683.93 50662,-683.93 50662,-642.93 50904,-642.93 50904,-683.93"/>
<text text-anchor="middle" x="50783" y="-671.93" font-family="Arial" font-size="10.00">GPU12</text>
<text text-anchor="middle" x="50783" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer3</text>
<text text-anchor="middle" x="50783" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_experts_gpu12 -->
<g id="node207" class="node">
<title>stage1_layer3_moe_experts_gpu12</title>
<polygon fill="#fde8e8" stroke="black" points="51164,-683.93 50922,-683.93 50922,-642.93 51164,-642.93 51164,-683.93"/>
<text text-anchor="middle" x="51043" y="-671.93" font-family="Arial" font-size="10.00">GPU12</text>
<text text-anchor="middle" x="51043" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer3</text>
<text text-anchor="middle" x="51043" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_out_gpu12 -->
<g id="node208" class="node">
<title>stage1_layer3_moe_out_gpu12</title>
<polygon fill="#fde8e8" stroke="black" points="51424,-683.93 51182,-683.93 51182,-642.93 51424,-642.93 51424,-683.93"/>
<text text-anchor="middle" x="51303" y="-671.93" font-family="Arial" font-size="10.00">GPU12</text>
<text text-anchor="middle" x="51303" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer3</text>
<text text-anchor="middle" x="51303" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_qkv_gpu13 -->
<g id="node209" class="node">
<title>stage1_layer3_moe_qkv_gpu13</title>
<polygon fill="#fde8e8" stroke="black" points="51684,-683.93 51442,-683.93 51442,-642.93 51684,-642.93 51684,-683.93"/>
<text text-anchor="middle" x="51563" y="-671.93" font-family="Arial" font-size="10.00">GPU13</text>
<text text-anchor="middle" x="51563" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer3</text>
<text text-anchor="middle" x="51563" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_experts_gpu13 -->
<g id="node210" class="node">
<title>stage1_layer3_moe_experts_gpu13</title>
<polygon fill="#fde8e8" stroke="black" points="51944,-683.93 51702,-683.93 51702,-642.93 51944,-642.93 51944,-683.93"/>
<text text-anchor="middle" x="51823" y="-671.93" font-family="Arial" font-size="10.00">GPU13</text>
<text text-anchor="middle" x="51823" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer3</text>
<text text-anchor="middle" x="51823" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_out_gpu13 -->
<g id="node211" class="node">
<title>stage1_layer3_moe_out_gpu13</title>
<polygon fill="#fde8e8" stroke="black" points="52204,-683.93 51962,-683.93 51962,-642.93 52204,-642.93 52204,-683.93"/>
<text text-anchor="middle" x="52083" y="-671.93" font-family="Arial" font-size="10.00">GPU13</text>
<text text-anchor="middle" x="52083" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer3</text>
<text text-anchor="middle" x="52083" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_qkv_gpu14 -->
<g id="node212" class="node">
<title>stage1_layer3_moe_qkv_gpu14</title>
<polygon fill="#fde8e8" stroke="black" points="52464,-683.93 52222,-683.93 52222,-642.93 52464,-642.93 52464,-683.93"/>
<text text-anchor="middle" x="52343" y="-671.93" font-family="Arial" font-size="10.00">GPU14</text>
<text text-anchor="middle" x="52343" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer3</text>
<text text-anchor="middle" x="52343" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_experts_gpu14 -->
<g id="node213" class="node">
<title>stage1_layer3_moe_experts_gpu14</title>
<polygon fill="#fde8e8" stroke="black" points="52724,-683.93 52482,-683.93 52482,-642.93 52724,-642.93 52724,-683.93"/>
<text text-anchor="middle" x="52603" y="-671.93" font-family="Arial" font-size="10.00">GPU14</text>
<text text-anchor="middle" x="52603" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer3</text>
<text text-anchor="middle" x="52603" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_out_gpu14 -->
<g id="node214" class="node">
<title>stage1_layer3_moe_out_gpu14</title>
<polygon fill="#fde8e8" stroke="black" points="52984,-683.93 52742,-683.93 52742,-642.93 52984,-642.93 52984,-683.93"/>
<text text-anchor="middle" x="52863" y="-671.93" font-family="Arial" font-size="10.00">GPU14</text>
<text text-anchor="middle" x="52863" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer3</text>
<text text-anchor="middle" x="52863" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_qkv_gpu15 -->
<g id="node215" class="node">
<title>stage1_layer3_moe_qkv_gpu15</title>
<polygon fill="#fde8e8" stroke="black" points="53244,-683.93 53002,-683.93 53002,-642.93 53244,-642.93 53244,-683.93"/>
<text text-anchor="middle" x="53123" y="-671.93" font-family="Arial" font-size="10.00">GPU15</text>
<text text-anchor="middle" x="53123" y="-660.93" font-family="Arial" font-size="10.00">MoE QKV Layer3</text>
<text text-anchor="middle" x="53123" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_experts_gpu15 -->
<g id="node216" class="node">
<title>stage1_layer3_moe_experts_gpu15</title>
<polygon fill="#fde8e8" stroke="black" points="53504,-683.93 53262,-683.93 53262,-642.93 53504,-642.93 53504,-683.93"/>
<text text-anchor="middle" x="53383" y="-671.93" font-family="Arial" font-size="10.00">GPU15</text>
<text text-anchor="middle" x="53383" y="-660.93" font-family="Arial" font-size="10.00">2 Experts Layer3</text>
<text text-anchor="middle" x="53383" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_out_gpu15 -->
<g id="node217" class="node">
<title>stage1_layer3_moe_out_gpu15</title>
<polygon fill="#fde8e8" stroke="black" points="53764,-683.93 53522,-683.93 53522,-642.93 53764,-642.93 53764,-683.93"/>
<text text-anchor="middle" x="53643" y="-671.93" font-family="Arial" font-size="10.00">GPU15</text>
<text text-anchor="middle" x="53643" y="-660.93" font-family="Arial" font-size="10.00">MoE Output Layer3</text>
<text text-anchor="middle" x="53643" y="-649.93" font-family="Arial" font-size="10.00">[Input: [1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_moe_allreduce -->
<g id="node218" class="node">
<title>stage1_layer3_moe_allreduce</title>
<path fill="#e8fde8" stroke="black" d="M54294.1,-704.43C54294.1,-704.43 53901.16,-704.43 53901.16,-704.43 53895.16,-704.43 53884.39,-700.78 53879.63,-697.14 53879.63,-697.14 53791.44,-629.71 53791.44,-629.71 53786.67,-626.07 53787.9,-622.43 53793.9,-622.43 53793.9,-622.43 54186.84,-622.43 54186.84,-622.43 54192.84,-622.43 54203.61,-626.07 54208.37,-629.71 54208.37,-629.71 54296.56,-697.14 54296.56,-697.14 54301.33,-700.78 54300.1,-704.43 54294.1,-704.43"/>
<text text-anchor="middle" x="54044" y="-671.93" font-family="Arial" font-size="10.00">Layer 3</text>
<text text-anchor="middle" x="54044" y="-660.93" font-family="Arial" font-size="10.00">MoE All&#45;Reduce</text>
<text text-anchor="middle" x="54044" y="-649.93" font-family="Arial" font-size="10.00">[Input: 8×[1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- stage1_layer3_residual2 -->
<g id="node219" class="node">
<title>stage1_layer3_residual2</title>
<path fill="#e8fde8" stroke="black" d="M54837.1,-704.43C54837.1,-704.43 54444.16,-704.43 54444.16,-704.43 54438.16,-704.43 54427.39,-700.78 54422.63,-697.14 54422.63,-697.14 54334.44,-629.71 54334.44,-629.71 54329.67,-626.07 54330.9,-622.43 54336.9,-622.43 54336.9,-622.43 54729.84,-622.43 54729.84,-622.43 54735.84,-622.43 54746.61,-626.07 54751.37,-629.71 54751.37,-629.71 54839.56,-697.14 54839.56,-697.14 54844.33,-700.78 54843.1,-704.43 54837.1,-704.43"/>
<text text-anchor="middle" x="54587" y="-671.93" font-family="Arial" font-size="10.00">Layer 3</text>
<text text-anchor="middle" x="54587" y="-660.93" font-family="Arial" font-size="10.00">Residual Add</text>
<text text-anchor="middle" x="54587" y="-649.93" font-family="Arial" font-size="10.00">[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]</text>
</g>
<!-- output -->
<g id="node220" class="node">
<title>output</title>
<ellipse fill="#d0e8ff" stroke="black" cx="54587" cy="-565.21" rx="173.9" ry="21.43"/>
<text text-anchor="middle" x="54587" y="-568.21" font-family="Arial" font-size="10.00">Output</text>
<text text-anchor="middle" x="54587" y="-557.21" font-family="Arial" font-size="10.00">[batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- stage1_layer3_residual2&#45;&gt;output -->
<g id="edge37" class="edge">
<title>stage1_layer3_residual2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M54587,-622.18C54587,-613.66 54587,-604.8 54587,-596.71"/>
<polygon fill="black" stroke="black" points="54590.5,-596.61 54587,-586.61 54583.5,-596.61 54590.5,-596.61"/>
</g>
</g>
</svg>
