// Baseline TP=8, PP=2: 2 stages, 8 GPUs each
digraph baseline_tp8_pp2_dag {
	graph [bgcolor=white compound=true fontname=Arial fontsize=12 rankdir=TB]
	node [fontname=Arial fontsize=10]
	input [label="Input\n[batch_size=1024, seq_len=2048, hidden_dim=4096]" fillcolor="#D0E8FF" shape=ellipse style=filled]
	subgraph stage0 {
		label="Stage 0: GPUs 0-7 (TP=8), Layers 0-1"
		stage0_embedding [label="Token+Pos Embedding\n[Input: [1024,2048], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_norm1 [label="Layer 0\nPre-Attn LayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_qkv_gpu0 [label="GPU0\nQKV Proj Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_attn_gpu0 [label="GPU0\nAttn Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_out_gpu0 [label="GPU0\nOutput Proj Layer0\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_qkv_gpu1 [label="GPU1\nQKV Proj Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_attn_gpu1 [label="GPU1\nAttn Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_out_gpu1 [label="GPU1\nOutput Proj Layer0\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_qkv_gpu2 [label="GPU2\nQKV Proj Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_attn_gpu2 [label="GPU2\nAttn Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_out_gpu2 [label="GPU2\nOutput Proj Layer0\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_qkv_gpu3 [label="GPU3\nQKV Proj Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_attn_gpu3 [label="GPU3\nAttn Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_out_gpu3 [label="GPU3\nOutput Proj Layer0\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_qkv_gpu4 [label="GPU4\nQKV Proj Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_attn_gpu4 [label="GPU4\nAttn Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_out_gpu4 [label="GPU4\nOutput Proj Layer0\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_qkv_gpu5 [label="GPU5\nQKV Proj Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_attn_gpu5 [label="GPU5\nAttn Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_out_gpu5 [label="GPU5\nOutput Proj Layer0\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_qkv_gpu6 [label="GPU6\nQKV Proj Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_attn_gpu6 [label="GPU6\nAttn Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_out_gpu6 [label="GPU6\nOutput Proj Layer0\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_qkv_gpu7 [label="GPU7\nQKV Proj Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_attn_gpu7 [label="GPU7\nAttn Layer0\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_out_gpu7 [label="GPU7\nOutput Proj Layer0\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_attn_allreduce [label="Layer 0\nAttention All-Reduce\n[Input: 8×[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
		stage0_layer0_residual1 [label="Layer 0\nResidual Add\n[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
		stage0_layer0_norm2 [label="Layer 0\nPre-MoE LayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_qkv_gpu0 [label="GPU0\nMoE QKV Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_experts_gpu0 [label="GPU0\n2 Experts Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_out_gpu0 [label="GPU0\nMoE Output Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_qkv_gpu1 [label="GPU1\nMoE QKV Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_experts_gpu1 [label="GPU1\n2 Experts Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_out_gpu1 [label="GPU1\nMoE Output Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_qkv_gpu2 [label="GPU2\nMoE QKV Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_experts_gpu2 [label="GPU2\n2 Experts Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_out_gpu2 [label="GPU2\nMoE Output Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_qkv_gpu3 [label="GPU3\nMoE QKV Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_experts_gpu3 [label="GPU3\n2 Experts Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_out_gpu3 [label="GPU3\nMoE Output Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_qkv_gpu4 [label="GPU4\nMoE QKV Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_experts_gpu4 [label="GPU4\n2 Experts Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_out_gpu4 [label="GPU4\nMoE Output Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_qkv_gpu5 [label="GPU5\nMoE QKV Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_experts_gpu5 [label="GPU5\n2 Experts Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_out_gpu5 [label="GPU5\nMoE Output Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_qkv_gpu6 [label="GPU6\nMoE QKV Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_experts_gpu6 [label="GPU6\n2 Experts Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_out_gpu6 [label="GPU6\nMoE Output Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_qkv_gpu7 [label="GPU7\nMoE QKV Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_experts_gpu7 [label="GPU7\n2 Experts Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_out_gpu7 [label="GPU7\nMoE Output Layer0\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer0_moe_allreduce [label="Layer 0\nMoE All-Reduce\n[Input: 8×[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
		stage0_layer0_residual2 [label="Layer 0\nResidual Add\n[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
		stage0_layer1_norm1 [label="Layer 1\nPre-Attn LayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_qkv_gpu0 [label="GPU0\nQKV Proj Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_attn_gpu0 [label="GPU0\nAttn Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_out_gpu0 [label="GPU0\nOutput Proj Layer1\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_qkv_gpu1 [label="GPU1\nQKV Proj Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_attn_gpu1 [label="GPU1\nAttn Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_out_gpu1 [label="GPU1\nOutput Proj Layer1\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_qkv_gpu2 [label="GPU2\nQKV Proj Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_attn_gpu2 [label="GPU2\nAttn Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_out_gpu2 [label="GPU2\nOutput Proj Layer1\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_qkv_gpu3 [label="GPU3\nQKV Proj Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_attn_gpu3 [label="GPU3\nAttn Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_out_gpu3 [label="GPU3\nOutput Proj Layer1\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_qkv_gpu4 [label="GPU4\nQKV Proj Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_attn_gpu4 [label="GPU4\nAttn Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_out_gpu4 [label="GPU4\nOutput Proj Layer1\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_qkv_gpu5 [label="GPU5\nQKV Proj Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_attn_gpu5 [label="GPU5\nAttn Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_out_gpu5 [label="GPU5\nOutput Proj Layer1\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_qkv_gpu6 [label="GPU6\nQKV Proj Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_attn_gpu6 [label="GPU6\nAttn Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_out_gpu6 [label="GPU6\nOutput Proj Layer1\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_qkv_gpu7 [label="GPU7\nQKV Proj Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_attn_gpu7 [label="GPU7\nAttn Layer1\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_out_gpu7 [label="GPU7\nOutput Proj Layer1\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_attn_allreduce [label="Layer 1\nAttention All-Reduce\n[Input: 8×[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
		stage0_layer1_residual1 [label="Layer 1\nResidual Add\n[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
		stage0_layer1_norm2 [label="Layer 1\nPre-MoE LayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_qkv_gpu0 [label="GPU0\nMoE QKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_experts_gpu0 [label="GPU0\n2 Experts Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_out_gpu0 [label="GPU0\nMoE Output Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_qkv_gpu1 [label="GPU1\nMoE QKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_experts_gpu1 [label="GPU1\n2 Experts Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_out_gpu1 [label="GPU1\nMoE Output Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_qkv_gpu2 [label="GPU2\nMoE QKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_experts_gpu2 [label="GPU2\n2 Experts Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_out_gpu2 [label="GPU2\nMoE Output Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_qkv_gpu3 [label="GPU3\nMoE QKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_experts_gpu3 [label="GPU3\n2 Experts Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_out_gpu3 [label="GPU3\nMoE Output Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_qkv_gpu4 [label="GPU4\nMoE QKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_experts_gpu4 [label="GPU4\n2 Experts Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_out_gpu4 [label="GPU4\nMoE Output Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_qkv_gpu5 [label="GPU5\nMoE QKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_experts_gpu5 [label="GPU5\n2 Experts Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_out_gpu5 [label="GPU5\nMoE Output Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_qkv_gpu6 [label="GPU6\nMoE QKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_experts_gpu6 [label="GPU6\n2 Experts Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_out_gpu6 [label="GPU6\nMoE Output Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_qkv_gpu7 [label="GPU7\nMoE QKV Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_experts_gpu7 [label="GPU7\n2 Experts Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_out_gpu7 [label="GPU7\nMoE Output Layer1\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8F4FD" shape=rectangle style=filled]
		stage0_layer1_moe_allreduce [label="Layer 1\nMoE All-Reduce\n[Input: 8×[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
		stage0_layer1_residual2 [label="Layer 1\nResidual Add\n[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
	}
	pipeline_comm [label="Pipeline Communication\nSend/Recv\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
	subgraph stage1 {
		label="Stage 1: GPUs 8-15 (TP=8), Layers 2-3"
		stage1_layer2_norm1 [label="Layer 2\nPre-Attn LayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_qkv_gpu8 [label="GPU8\nQKV Proj Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_attn_gpu8 [label="GPU8\nAttn Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_out_gpu8 [label="GPU8\nOutput Proj Layer2\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_qkv_gpu9 [label="GPU9\nQKV Proj Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_attn_gpu9 [label="GPU9\nAttn Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_out_gpu9 [label="GPU9\nOutput Proj Layer2\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_qkv_gpu10 [label="GPU10\nQKV Proj Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_attn_gpu10 [label="GPU10\nAttn Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_out_gpu10 [label="GPU10\nOutput Proj Layer2\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_qkv_gpu11 [label="GPU11\nQKV Proj Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_attn_gpu11 [label="GPU11\nAttn Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_out_gpu11 [label="GPU11\nOutput Proj Layer2\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_qkv_gpu12 [label="GPU12\nQKV Proj Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_attn_gpu12 [label="GPU12\nAttn Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_out_gpu12 [label="GPU12\nOutput Proj Layer2\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_qkv_gpu13 [label="GPU13\nQKV Proj Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_attn_gpu13 [label="GPU13\nAttn Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_out_gpu13 [label="GPU13\nOutput Proj Layer2\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_qkv_gpu14 [label="GPU14\nQKV Proj Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_attn_gpu14 [label="GPU14\nAttn Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_out_gpu14 [label="GPU14\nOutput Proj Layer2\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_qkv_gpu15 [label="GPU15\nQKV Proj Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_attn_gpu15 [label="GPU15\nAttn Layer2\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_out_gpu15 [label="GPU15\nOutput Proj Layer2\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_attn_allreduce [label="Layer 2\nAttention All-Reduce\n[Input: 8×[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
		stage1_layer2_residual1 [label="Layer 2\nResidual Add\n[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
		stage1_layer2_norm2 [label="Layer 2\nPre-MoE LayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_qkv_gpu8 [label="GPU8\nMoE QKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_experts_gpu8 [label="GPU8\n2 Experts Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_out_gpu8 [label="GPU8\nMoE Output Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_qkv_gpu9 [label="GPU9\nMoE QKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_experts_gpu9 [label="GPU9\n2 Experts Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_out_gpu9 [label="GPU9\nMoE Output Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_qkv_gpu10 [label="GPU10\nMoE QKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_experts_gpu10 [label="GPU10\n2 Experts Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_out_gpu10 [label="GPU10\nMoE Output Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_qkv_gpu11 [label="GPU11\nMoE QKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_experts_gpu11 [label="GPU11\n2 Experts Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_out_gpu11 [label="GPU11\nMoE Output Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_qkv_gpu12 [label="GPU12\nMoE QKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_experts_gpu12 [label="GPU12\n2 Experts Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_out_gpu12 [label="GPU12\nMoE Output Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_qkv_gpu13 [label="GPU13\nMoE QKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_experts_gpu13 [label="GPU13\n2 Experts Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_out_gpu13 [label="GPU13\nMoE Output Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_qkv_gpu14 [label="GPU14\nMoE QKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_experts_gpu14 [label="GPU14\n2 Experts Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_out_gpu14 [label="GPU14\nMoE Output Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_qkv_gpu15 [label="GPU15\nMoE QKV Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_experts_gpu15 [label="GPU15\n2 Experts Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_out_gpu15 [label="GPU15\nMoE Output Layer2\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer2_moe_allreduce [label="Layer 2\nMoE All-Reduce\n[Input: 8×[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
		stage1_layer2_residual2 [label="Layer 2\nResidual Add\n[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
		stage1_layer3_norm1 [label="Layer 3\nPre-Attn LayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_qkv_gpu8 [label="GPU8\nQKV Proj Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_attn_gpu8 [label="GPU8\nAttn Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_out_gpu8 [label="GPU8\nOutput Proj Layer3\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_qkv_gpu9 [label="GPU9\nQKV Proj Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_attn_gpu9 [label="GPU9\nAttn Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_out_gpu9 [label="GPU9\nOutput Proj Layer3\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_qkv_gpu10 [label="GPU10\nQKV Proj Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_attn_gpu10 [label="GPU10\nAttn Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_out_gpu10 [label="GPU10\nOutput Proj Layer3\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_qkv_gpu11 [label="GPU11\nQKV Proj Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_attn_gpu11 [label="GPU11\nAttn Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_out_gpu11 [label="GPU11\nOutput Proj Layer3\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_qkv_gpu12 [label="GPU12\nQKV Proj Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_attn_gpu12 [label="GPU12\nAttn Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_out_gpu12 [label="GPU12\nOutput Proj Layer3\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_qkv_gpu13 [label="GPU13\nQKV Proj Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_attn_gpu13 [label="GPU13\nAttn Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_out_gpu13 [label="GPU13\nOutput Proj Layer3\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_qkv_gpu14 [label="GPU14\nQKV Proj Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_attn_gpu14 [label="GPU14\nAttn Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_out_gpu14 [label="GPU14\nOutput Proj Layer3\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_qkv_gpu15 [label="GPU15\nQKV Proj Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_attn_gpu15 [label="GPU15\nAttn Layer3\n[Input: [1024,2048,512], Output: [1024,2048,512]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_out_gpu15 [label="GPU15\nOutput Proj Layer3\n[Input: [1024,2048,512], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_attn_allreduce [label="Layer 3\nAttention All-Reduce\n[Input: 8×[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
		stage1_layer3_residual1 [label="Layer 3\nResidual Add\n[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
		stage1_layer3_norm2 [label="Layer 3\nPre-MoE LayerNorm\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_qkv_gpu8 [label="GPU8\nMoE QKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_experts_gpu8 [label="GPU8\n2 Experts Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_out_gpu8 [label="GPU8\nMoE Output Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_qkv_gpu9 [label="GPU9\nMoE QKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_experts_gpu9 [label="GPU9\n2 Experts Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_out_gpu9 [label="GPU9\nMoE Output Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_qkv_gpu10 [label="GPU10\nMoE QKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_experts_gpu10 [label="GPU10\n2 Experts Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_out_gpu10 [label="GPU10\nMoE Output Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_qkv_gpu11 [label="GPU11\nMoE QKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_experts_gpu11 [label="GPU11\n2 Experts Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_out_gpu11 [label="GPU11\nMoE Output Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_qkv_gpu12 [label="GPU12\nMoE QKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_experts_gpu12 [label="GPU12\n2 Experts Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_out_gpu12 [label="GPU12\nMoE Output Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_qkv_gpu13 [label="GPU13\nMoE QKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_experts_gpu13 [label="GPU13\n2 Experts Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_out_gpu13 [label="GPU13\nMoE Output Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_qkv_gpu14 [label="GPU14\nMoE QKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_experts_gpu14 [label="GPU14\n2 Experts Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_out_gpu14 [label="GPU14\nMoE Output Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_qkv_gpu15 [label="GPU15\nMoE QKV Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_experts_gpu15 [label="GPU15\n2 Experts Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_out_gpu15 [label="GPU15\nMoE Output Layer3\n[Input: [1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#FDE8E8" shape=rectangle style=filled]
		stage1_layer3_moe_allreduce [label="Layer 3\nMoE All-Reduce\n[Input: 8×[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
		stage1_layer3_residual2 [label="Layer 3\nResidual Add\n[Input: 2×[1024,2048,4096], Output: [1024,2048,4096]]" fillcolor="#E8FDE8" shape=parallelogram style="filled,rounded"]
	}
	input -> stage0_embedding
	stage0_embedding -> stage0_layer0_norm1
	stage0_layer0_norm1 -> stage0_layer0_qkv_gpu0
	stage0_layer0_qkv_gpu0 -> stage0_layer0_attn_gpu0
	stage0_layer0_attn_gpu0 -> stage0_layer0_out_gpu0
	stage0_layer0_out_gpu0 -> stage0_layer0_attn_allreduce
	stage0_layer0_norm1 -> stage0_layer0_qkv_gpu1
	stage0_layer0_qkv_gpu1 -> stage0_layer0_attn_gpu1
	stage0_layer0_attn_gpu1 -> stage0_layer0_out_gpu1
	stage0_layer0_out_gpu1 -> stage0_layer0_attn_allreduce
	stage0_layer0_norm1 -> stage0_layer0_qkv_gpu2
	stage0_layer0_qkv_gpu2 -> stage0_layer0_attn_gpu2
	stage0_layer0_attn_gpu2 -> stage0_layer0_out_gpu2
	stage0_layer0_out_gpu2 -> stage0_layer0_attn_allreduce
	stage0_layer0_norm1 -> stage0_layer0_qkv_gpu3
	stage0_layer0_qkv_gpu3 -> stage0_layer0_attn_gpu3
	stage0_layer0_attn_gpu3 -> stage0_layer0_out_gpu3
	stage0_layer0_out_gpu3 -> stage0_layer0_attn_allreduce
	stage0_layer0_norm1 -> stage0_layer0_qkv_gpu4
	stage0_layer0_qkv_gpu4 -> stage0_layer0_attn_gpu4
	stage0_layer0_attn_gpu4 -> stage0_layer0_out_gpu4
	stage0_layer0_out_gpu4 -> stage0_layer0_attn_allreduce
	stage0_layer0_norm1 -> stage0_layer0_qkv_gpu5
	stage0_layer0_qkv_gpu5 -> stage0_layer0_attn_gpu5
	stage0_layer0_attn_gpu5 -> stage0_layer0_out_gpu5
	stage0_layer0_out_gpu5 -> stage0_layer0_attn_allreduce
	stage0_layer0_norm1 -> stage0_layer0_qkv_gpu6
	stage0_layer0_qkv_gpu6 -> stage0_layer0_attn_gpu6
	stage0_layer0_attn_gpu6 -> stage0_layer0_out_gpu6
	stage0_layer0_out_gpu6 -> stage0_layer0_attn_allreduce
	stage0_layer0_norm1 -> stage0_layer0_qkv_gpu7
	stage0_layer0_qkv_gpu7 -> stage0_layer0_attn_gpu7
	stage0_layer0_attn_gpu7 -> stage0_layer0_out_gpu7
	stage0_layer0_out_gpu7 -> stage0_layer0_attn_allreduce
	stage0_layer0_attn_allreduce -> stage0_layer0_residual1
	stage0_embedding -> stage0_layer0_residual1
	output [label="Output\n[batch_size=1024, seq_len=2048, hidden_dim=4096]" fillcolor="#D0E8FF" shape=ellipse style=filled]
	stage1_layer3_residual2 -> output
}
