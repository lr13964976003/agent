// Baseline DAG: TP=8, PP=2 (Corrected - No Cycles)
digraph {
    nodesep=0.5 rankdir=TB ranksep=1.0 size="30,20"
    node [fontname=Arial fontsize=10]
    edge [fontname=Arial fontsize=8]
    
    // Input node
    input [label="Input\nBatch:128, Seq:10000\nDim:4096" fillcolor=lightcoral shape=ellipse]
    
    // Pipeline Stage 0 (GPUs 0-7)
    subgraph cluster_stage0 {
        fillcolor=lightgray label="Pipeline Stage 0 (GPUs 0-7)" style=rounded
        
        // Layer 0
        split_tp_l0 [label="Split TP\nLayer 0" fillcolor=lightyellow shape=parallelogram]
                attn_l0_g0 [label="Attention L0\nGPU 0\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
        attn_l0_g1 [label="Attention L0\nGPU 1\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
        attn_l0_g2 [label="Attention L0\nGPU 2\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
        attn_l0_g3 [label="Attention L0\nGPU 3\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
        attn_l0_g4 [label="Attention L0\nGPU 4\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
        attn_l0_g5 [label="Attention L0\nGPU 5\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
        attn_l0_g6 [label="Attention L0\nGPU 6\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
        attn_l0_g7 [label="Attention L0\nGPU 7\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
        ar_attn_l0 [label="All-Reduce\nAttention L0" fillcolor=lightblue shape=ellipse]
        
        // MLP nodes for layer 0
        mlp1_l0_g0 [label="MLP1 L0\nGPU 0\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
        mlp2_l0_g0 [label="MLP2 L0\nGPU 0\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
        mlp1_l0_g1 [label="MLP1 L0\nGPU 1\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
        mlp2_l0_g1 [label="MLP2 L0\nGPU 1\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
        mlp1_l0_g2 [label="MLP1 L0\nGPU 2\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
        mlp2_l0_g2 [label="MLP2 L0\nGPU 2\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
        mlp1_l0_g3 [label="MLP1 L0\nGPU 3\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
        mlp2_l0_g3 [label="MLP2 L0\nGPU 3\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
        mlp1_l0_g4 [label="MLP1 L0\nGPU 4\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
        mlp2_l0_g4 [label="MLP2 L0\nGPU 4\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
        mlp1_l0_g5 [label="MLP1 L0\nGPU 5\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
        mlp2_l0_g5 [label="MLP2 L0\nGPU 5\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
        mlp1_l0_g6 [label="MLP1 L0\nGPU 6\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
        mlp2_l0_g6 [label="MLP2 L0\nGPU 6\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
        mlp1_l0_g7 [label="MLP1 L0\nGPU 7\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
        mlp2_l0_g7 [label="MLP2 L0\nGPU 7\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
        ar_mlp_l0 [label="All-Reduce\nMLP L0" fillcolor=lightblue shape=ellipse]
        
        // LayerNorm for layer 0
        norm_l0_g0 [label="LayerNorm L0\nGPU 0" fillcolor=lightgreen shape=rectangle]
        norm_l0_g1 [label="LayerNorm L0\nGPU 1" fillcolor=lightgreen shape=rectangle]
        norm_l0_g2 [label="LayerNorm L0\nGPU 2" fillcolor=lightgreen shape=rectangle]
        norm_l0_g3 [label="LayerNorm L0\nGPU 3" fillcolor=lightgreen shape=rectangle]
        norm_l0_g4 [label="LayerNorm L0\nGPU 4" fillcolor=lightgreen shape=rectangle]
        norm_l0_g5 [label="LayerNorm L0\nGPU 5" fillcolor=lightgreen shape=rectangle]
        norm_l0_g6 [label="LayerNorm L0\nGPU 6" fillcolor=lightgreen shape=rectangle]
        norm_l0_g7 [label="LayerNorm L0\nGPU 7" fillcolor=lightgreen shape=rectangle]
        
        // Connections for layer 0
        split_tp_l0 -> attn_l0_g0
        split_tp_l0 -> attn_l0_g1
        split_tp_l0 -> attn_l0_g2
        split_tp_l0 -> attn_l0_g3
        split_tp_l0 -> attn_l0_g4
        split_tp_l0 -> attn_l0_g5
        split_tp_l0 -> attn_l0_g6
        split_tp_l0 -> attn_l0_g7
        
        attn_l0_g0 -> ar_attn_l0
        attn_l0_g1 -> ar_attn_l0
        attn_l0_g2 -> ar_attn_l0
        attn_l0_g3 -> ar_attn_l0
        attn_l0_g4 -> ar_attn_l0
        attn_l0_g5 -> ar_attn_l0
        attn_l0_g6 -> ar_attn_l0
        attn_l0_g7 -> ar_attn_l0
        
        ar_attn_l0 -> mlp1_l0_g0
        ar_attn_l0 -> mlp1_l0_g1
        ar_attn_l0 -> mlp1_l0_g2
        ar_attn_l0 -> mlp1_l0_g3
        ar_attn_l0 -> mlp1_l0_g4
        ar_attn_l0 -> mlp1_l0_g5
        ar_attn_l0 -> mlp1_l0_g6
        ar_attn_l0 -> mlp1_l0_g7
        
        mlp1_l0_g0 -> mlp2_l0_g0
        mlp1_l0_g1 -> mlp2_l0_g1
        mlp1_l0_g2 -> mlp2_l0_g2
        mlp1_l0_g3 -> mlp2_l0_g3
        mlp1_l0_g4 -> mlp2_l0_g4
        mlp1_l0_g5 -> mlp2_l0_g5
        mlp1_l0_g6 -> mlp2_l0_g6
        mlp1_l0_g7 -> mlp2_l0_g7
        
        mlp2_l0_g0 -> ar_mlp_l0
        mlp2_l0_g1 -> ar_mlp_l0
        mlp2_l0_g2 -> ar_mlp_l0
        mlp2_l0_g3 -> ar_mlp_l0
        mlp2_l0_g4 -> ar_mlp_l0
        mlp2_l0_g5 -> ar_mlp_l0
        mlp2_l0_g6 -> ar_mlp_l0
        mlp2_l0_g7 -> ar_mlp_l0
        
        ar_mlp_l0 -> norm_l0_g0
        ar_mlp_l0 -> norm_l0_g1
        ar_mlp_l0 -> norm_l0_g2
        ar_mlp_l0 -> norm_l0_g3
        ar_mlp_l0 -> norm_l0_g4
        ar_mlp_l0 -> norm_l0_g5
        ar_mlp_l0 -> norm_l0_g6
        ar_mlp_l0 -> norm_l0_g7
    }
    
    // Add remaining layers (1-15) following same pattern but without duplicate edges
    
    // Layer 1
    split_tp_l1 [label="Split TP\nLayer 1" fillcolor=lightyellow shape=parallelogram]
    ar_attn_l1 [label="All-Reduce\nAttention L1" fillcolor=lightblue shape=ellipse]
    ar_mlp_l1 [label="All-Reduce\nMLP L1" fillcolor=lightblue shape=ellipse]
    attn_l1_g0 [label="Attention L1\nGPU 0\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l1_g0 [label="MLP1 L1\nGPU 0\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l1_g0 [label="MLP2 L1\nGPU 0\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l1_g0 [label="LayerNorm L1\nGPU 0" fillcolor=lightgreen shape=rectangle]
    attn_l1_g1 [label="Attention L1\nGPU 1\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l1_g1 [label="MLP1 L1\nGPU 1\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l1_g1 [label="MLP2 L1\nGPU 1\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l1_g1 [label="LayerNorm L1\nGPU 1" fillcolor=lightgreen shape=rectangle]
    attn_l1_g2 [label="Attention L1\nGPU 2\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l1_g2 [label="MLP1 L1\nGPU 2\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l1_g2 [label="MLP2 L1\nGPU 2\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l1_g2 [label="LayerNorm L1\nGPU 2" fillcolor=lightgreen shape=rectangle]
    attn_l1_g3 [label="Attention L1\nGPU 3\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l1_g3 [label="MLP1 L1\nGPU 3\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l1_g3 [label="MLP2 L1\nGPU 3\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l1_g3 [label="LayerNorm L1\nGPU 3" fillcolor=lightgreen shape=rectangle]
    attn_l1_g4 [label="Attention L1\nGPU 4\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l1_g4 [label="MLP1 L1\nGPU 4\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l1_g4 [label="MLP2 L1\nGPU 4\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l1_g4 [label="LayerNorm L1\nGPU 4" fillcolor=lightgreen shape=rectangle]
    attn_l1_g5 [label="Attention L1\nGPU 5\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l1_g5 [label="MLP1 L1\nGPU 5\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l1_g5 [label="MLP2 L1\nGPU 5\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l1_g5 [label="LayerNorm L1\nGPU 5" fillcolor=lightgreen shape=rectangle]
    attn_l1_g6 [label="Attention L1\nGPU 6\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l1_g6 [label="MLP1 L1\nGPU 6\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l1_g6 [label="MLP2 L1\nGPU 6\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l1_g6 [label="LayerNorm L1\nGPU 6" fillcolor=lightgreen shape=rectangle]
    attn_l1_g7 [label="Attention L1\nGPU 7\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l1_g7 [label="MLP1 L1\nGPU 7\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l1_g7 [label="MLP2 L1\nGPU 7\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l1_g7 [label="LayerNorm L1\nGPU 7" fillcolor=lightgreen shape=rectangle]
    split_tp_l1 -> attn_l1_g0
    attn_l1_g0 -> ar_attn_l1
    ar_attn_l1 -> mlp1_l1_g0
    mlp1_l1_g0 -> mlp2_l1_g0
    mlp2_l1_g0 -> ar_mlp_l1
    ar_mlp_l1 -> norm_l1_g0
    split_tp_l1 -> attn_l1_g1
    attn_l1_g1 -> ar_attn_l1
    ar_attn_l1 -> mlp1_l1_g1
    mlp1_l1_g1 -> mlp2_l1_g1
    mlp2_l1_g1 -> ar_mlp_l1
    ar_mlp_l1 -> norm_l1_g1
    split_tp_l1 -> attn_l1_g2
    attn_l1_g2 -> ar_attn_l1
    ar_attn_l1 -> mlp1_l1_g2
    mlp1_l1_g2 -> mlp2_l1_g2
    mlp2_l1_g2 -> ar_mlp_l1
    ar_mlp_l1 -> norm_l1_g2
    split_tp_l1 -> attn_l1_g3
    attn_l1_g3 -> ar_attn_l1
    ar_attn_l1 -> mlp1_l1_g3
    mlp1_l1_g3 -> mlp2_l1_g3
    mlp2_l1_g3 -> ar_mlp_l1
    ar_mlp_l1 -> norm_l1_g3
    split_tp_l1 -> attn_l1_g4
    attn_l1_g4 -> ar_attn_l1
    ar_attn_l1 -> mlp1_l1_g4
    mlp1_l1_g4 -> mlp2_l1_g4
    mlp2_l1_g4 -> ar_mlp_l1
    ar_mlp_l1 -> norm_l1_g4
    split_tp_l1 -> attn_l1_g5
    attn_l1_g5 -> ar_attn_l1
    ar_attn_l1 -> mlp1_l1_g5
    mlp1_l1_g5 -> mlp2_l1_g5
    mlp2_l1_g5 -> ar_mlp_l1
    ar_mlp_l1 -> norm_l1_g5
    split_tp_l1 -> attn_l1_g6
    attn_l1_g6 -> ar_attn_l1
    ar_attn_l1 -> mlp1_l1_g6
    mlp1_l1_g6 -> mlp2_l1_g6
    mlp2_l1_g6 -> ar_mlp_l1
    ar_mlp_l1 -> norm_l1_g6
    split_tp_l1 -> attn_l1_g7
    attn_l1_g7 -> ar_attn_l1
    ar_attn_l1 -> mlp1_l1_g7
    mlp1_l1_g7 -> mlp2_l1_g7
    mlp2_l1_g7 -> ar_mlp_l1
    ar_mlp_l1 -> norm_l1_g7
    
    // Layer 2
    split_tp_l2 [label="Split TP\nLayer 2" fillcolor=lightyellow shape=parallelogram]
    ar_attn_l2 [label="All-Reduce\nAttention L2" fillcolor=lightblue shape=ellipse]
    ar_mlp_l2 [label="All-Reduce\nMLP L2" fillcolor=lightblue shape=ellipse]
    attn_l2_g0 [label="Attention L2\nGPU 0\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l2_g0 [label="MLP1 L2\nGPU 0\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l2_g0 [label="MLP2 L2\nGPU 0\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l2_g0 [label="LayerNorm L2\nGPU 0" fillcolor=lightgreen shape=rectangle]
    attn_l2_g1 [label="Attention L2\nGPU 1\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l2_g1 [label="MLP1 L2\nGPU 1\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l2_g1 [label="MLP2 L2\nGPU 1\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l2_g1 [label="LayerNorm L2\nGPU 1" fillcolor=lightgreen shape=rectangle]
    attn_l2_g2 [label="Attention L2\nGPU 2\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l2_g2 [label="MLP1 L2\nGPU 2\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l2_g2 [label="MLP2 L2\nGPU 2\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l2_g2 [label="LayerNorm L2\nGPU 2" fillcolor=lightgreen shape=rectangle]
    attn_l2_g3 [label="Attention L2\nGPU 3\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l2_g3 [label="MLP1 L2\nGPU 3\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l2_g3 [label="MLP2 L2\nGPU 3\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l2_g3 [label="LayerNorm L2\nGPU 3" fillcolor=lightgreen shape=rectangle]
    attn_l2_g4 [label="Attention L2\nGPU 4\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l2_g4 [label="MLP1 L2\nGPU 4\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l2_g4 [label="MLP2 L2\nGPU 4\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l2_g4 [label="LayerNorm L2\nGPU 4" fillcolor=lightgreen shape=rectangle]
    attn_l2_g5 [label="Attention L2\nGPU 5\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l2_g5 [label="MLP1 L2\nGPU 5\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l2_g5 [label="MLP2 L2\nGPU 5\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l2_g5 [label="LayerNorm L2\nGPU 5" fillcolor=lightgreen shape=rectangle]
    attn_l2_g6 [label="Attention L2\nGPU 6\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l2_g6 [label="MLP1 L2\nGPU 6\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l2_g6 [label="MLP2 L2\nGPU 6\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l2_g6 [label="LayerNorm L2\nGPU 6" fillcolor=lightgreen shape=rectangle]
    attn_l2_g7 [label="Attention L2\nGPU 7\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l2_g7 [label="MLP1 L2\nGPU 7\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l2_g7 [label="MLP2 L2\nGPU 7\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l2_g7 [label="LayerNorm L2\nGPU 7" fillcolor=lightgreen shape=rectangle]
    split_tp_l2 -> attn_l2_g0
    attn_l2_g0 -> ar_attn_l2
    ar_attn_l2 -> mlp1_l2_g0
    mlp1_l2_g0 -> mlp2_l2_g0
    mlp2_l2_g0 -> ar_mlp_l2
    ar_mlp_l2 -> norm_l2_g0
    split_tp_l2 -> attn_l2_g1
    attn_l2_g1 -> ar_attn_l2
    ar_attn_l2 -> mlp1_l2_g1
    mlp1_l2_g1 -> mlp2_l2_g1
    mlp2_l2_g1 -> ar_mlp_l2
    ar_mlp_l2 -> norm_l2_g1
    split_tp_l2 -> attn_l2_g2
    attn_l2_g2 -> ar_attn_l2
    ar_attn_l2 -> mlp1_l2_g2
    mlp1_l2_g2 -> mlp2_l2_g2
    mlp2_l2_g2 -> ar_mlp_l2
    ar_mlp_l2 -> norm_l2_g2
    split_tp_l2 -> attn_l2_g3
    attn_l2_g3 -> ar_attn_l2
    ar_attn_l2 -> mlp1_l2_g3
    mlp1_l2_g3 -> mlp2_l2_g3
    mlp2_l2_g3 -> ar_mlp_l2
    ar_mlp_l2 -> norm_l2_g3
    split_tp_l2 -> attn_l2_g4
    attn_l2_g4 -> ar_attn_l2
    ar_attn_l2 -> mlp1_l2_g4
    mlp1_l2_g4 -> mlp2_l2_g4
    mlp2_l2_g4 -> ar_mlp_l2
    ar_mlp_l2 -> norm_l2_g4
    split_tp_l2 -> attn_l2_g5
    attn_l2_g5 -> ar_attn_l2
    ar_attn_l2 -> mlp1_l2_g5
    mlp1_l2_g5 -> mlp2_l2_g5
    mlp2_l2_g5 -> ar_mlp_l2
    ar_mlp_l2 -> norm_l2_g5
    split_tp_l2 -> attn_l2_g6
    attn_l2_g6 -> ar_attn_l2
    ar_attn_l2 -> mlp1_l2_g6
    mlp1_l2_g6 -> mlp2_l2_g6
    mlp2_l2_g6 -> ar_mlp_l2
    ar_mlp_l2 -> norm_l2_g6
    split_tp_l2 -> attn_l2_g7
    attn_l2_g7 -> ar_attn_l2
    ar_attn_l2 -> mlp1_l2_g7
    mlp1_l2_g7 -> mlp2_l2_g7
    mlp2_l2_g7 -> ar_mlp_l2
    ar_mlp_l2 -> norm_l2_g7
    
    // Layer 3
    split_tp_l3 [label="Split TP\nLayer 3" fillcolor=lightyellow shape=parallelogram]
    ar_attn_l3 [label="All-Reduce\nAttention L3" fillcolor=lightblue shape=ellipse]
    ar_mlp_l3 [label="All-Reduce\nMLP L3" fillcolor=lightblue shape=ellipse]
    attn_l3_g0 [label="Attention L3\nGPU 0\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l3_g0 [label="MLP1 L3\nGPU 0\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l3_g0 [label="MLP2 L3\nGPU 0\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l3_g0 [label="LayerNorm L3\nGPU 0" fillcolor=lightgreen shape=rectangle]
    attn_l3_g1 [label="Attention L3\nGPU 1\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l3_g1 [label="MLP1 L3\nGPU 1\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l3_g1 [label="MLP2 L3\nGPU 1\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l3_g1 [label="LayerNorm L3\nGPU 1" fillcolor=lightgreen shape=rectangle]
    attn_l3_g2 [label="Attention L3\nGPU 2\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l3_g2 [label="MLP1 L3\nGPU 2\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l3_g2 [label="MLP2 L3\nGPU 2\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l3_g2 [label="LayerNorm L3\nGPU 2" fillcolor=lightgreen shape=rectangle]
    attn_l3_g3 [label="Attention L3\nGPU 3\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l3_g3 [label="MLP1 L3\nGPU 3\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l3_g3 [label="MLP2 L3\nGPU 3\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l3_g3 [label="LayerNorm L3\nGPU 3" fillcolor=lightgreen shape=rectangle]
    attn_l3_g4 [label="Attention L3\nGPU 4\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l3_g4 [label="MLP1 L3\nGPU 4\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l3_g4 [label="MLP2 L3\nGPU 4\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l3_g4 [label="LayerNorm L3\nGPU 4" fillcolor=lightgreen shape=rectangle]
    attn_l3_g5 [label="Attention L3\nGPU 5\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l3_g5 [label="MLP1 L3\nGPU 5\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l3_g5 [label="MLP2 L3\nGPU 5\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l3_g5 [label="LayerNorm L3\nGPU 5" fillcolor=lightgreen shape=rectangle]
    attn_l3_g6 [label="Attention L3\nGPU 6\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l3_g6 [label="MLP1 L3\nGPU 6\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l3_g6 [label="MLP2 L3\nGPU 6\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l3_g6 [label="LayerNorm L3\nGPU 6" fillcolor=lightgreen shape=rectangle]
    attn_l3_g7 [label="Attention L3\nGPU 7\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l3_g7 [label="MLP1 L3\nGPU 7\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l3_g7 [label="MLP2 L3\nGPU 7\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l3_g7 [label="LayerNorm L3\nGPU 7" fillcolor=lightgreen shape=rectangle]
    split_tp_l3 -> attn_l3_g0
    attn_l3_g0 -> ar_attn_l3
    ar_attn_l3 -> mlp1_l3_g0
    mlp1_l3_g0 -> mlp2_l3_g0
    mlp2_l3_g0 -> ar_mlp_l3
    ar_mlp_l3 -> norm_l3_g0
    split_tp_l3 -> attn_l3_g1
    attn_l3_g1 -> ar_attn_l3
    ar_attn_l3 -> mlp1_l3_g1
    mlp1_l3_g1 -> mlp2_l3_g1
    mlp2_l3_g1 -> ar_mlp_l3
    ar_mlp_l3 -> norm_l3_g1
    split_tp_l3 -> attn_l3_g2
    attn_l3_g2 -> ar_attn_l3
    ar_attn_l3 -> mlp1_l3_g2
    mlp1_l3_g2 -> mlp2_l3_g2
    mlp2_l3_g2 -> ar_mlp_l3
    ar_mlp_l3 -> norm_l3_g2
    split_tp_l3 -> attn_l3_g3
    attn_l3_g3 -> ar_attn_l3
    ar_attn_l3 -> mlp1_l3_g3
    mlp1_l3_g3 -> mlp2_l3_g3
    mlp2_l3_g3 -> ar_mlp_l3
    ar_mlp_l3 -> norm_l3_g3
    split_tp_l3 -> attn_l3_g4
    attn_l3_g4 -> ar_attn_l3
    ar_attn_l3 -> mlp1_l3_g4
    mlp1_l3_g4 -> mlp2_l3_g4
    mlp2_l3_g4 -> ar_mlp_l3
    ar_mlp_l3 -> norm_l3_g4
    split_tp_l3 -> attn_l3_g5
    attn_l3_g5 -> ar_attn_l3
    ar_attn_l3 -> mlp1_l3_g5
    mlp1_l3_g5 -> mlp2_l3_g5
    mlp2_l3_g5 -> ar_mlp_l3
    ar_mlp_l3 -> norm_l3_g5
    split_tp_l3 -> attn_l3_g6
    attn_l3_g6 -> ar_attn_l3
    ar_attn_l3 -> mlp1_l3_g6
    mlp1_l3_g6 -> mlp2_l3_g6
    mlp2_l3_g6 -> ar_mlp_l3
    ar_mlp_l3 -> norm_l3_g6
    split_tp_l3 -> attn_l3_g7
    attn_l3_g7 -> ar_attn_l3
    ar_attn_l3 -> mlp1_l3_g7
    mlp1_l3_g7 -> mlp2_l3_g7
    mlp2_l3_g7 -> ar_mlp_l3
    ar_mlp_l3 -> norm_l3_g7
    
    // Layer 4
    split_tp_l4 [label="Split TP\nLayer 4" fillcolor=lightyellow shape=parallelogram]
    ar_attn_l4 [label="All-Reduce\nAttention L4" fillcolor=lightblue shape=ellipse]
    ar_mlp_l4 [label="All-Reduce\nMLP L4" fillcolor=lightblue shape=ellipse]
    attn_l4_g0 [label="Attention L4\nGPU 0\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l4_g0 [label="MLP1 L4\nGPU 0\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l4_g0 [label="MLP2 L4\nGPU 0\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l4_g0 [label="LayerNorm L4\nGPU 0" fillcolor=lightgreen shape=rectangle]
    attn_l4_g1 [label="Attention L4\nGPU 1\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l4_g1 [label="MLP1 L4\nGPU 1\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l4_g1 [label="MLP2 L4\nGPU 1\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l4_g1 [label="LayerNorm L4\nGPU 1" fillcolor=lightgreen shape=rectangle]
    attn_l4_g2 [label="Attention L4\nGPU 2\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l4_g2 [label="MLP1 L4\nGPU 2\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l4_g2 [label="MLP2 L4\nGPU 2\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l4_g2 [label="LayerNorm L4\nGPU 2" fillcolor=lightgreen shape=rectangle]
    attn_l4_g3 [label="Attention L4\nGPU 3\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l4_g3 [label="MLP1 L4\nGPU 3\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l4_g3 [label="MLP2 L4\nGPU 3\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l4_g3 [label="LayerNorm L4\nGPU 3" fillcolor=lightgreen shape=rectangle]
    attn_l4_g4 [label="Attention L4\nGPU 4\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l4_g4 [label="MLP1 L4\nGPU 4\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l4_g4 [label="MLP2 L4\nGPU 4\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l4_g4 [label="LayerNorm L4\nGPU 4" fillcolor=lightgreen shape=rectangle]
    attn_l4_g5 [label="Attention L4\nGPU 5\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l4_g5 [label="MLP1 L4\nGPU 5\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l4_g5 [label="MLP2 L4\nGPU 5\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l4_g5 [label="LayerNorm L4\nGPU 5" fillcolor=lightgreen shape=rectangle]
    attn_l4_g6 [label="Attention L4\nGPU 6\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l4_g6 [label="MLP1 L4\nGPU 6\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l4_g6 [label="MLP2 L4\nGPU 6\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l4_g6 [label="LayerNorm L4\nGPU 6" fillcolor=lightgreen shape=rectangle]
    attn_l4_g7 [label="Attention L4\nGPU 7\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l4_g7 [label="MLP1 L4\nGPU 7\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l4_g7 [label="MLP2 L4\nGPU 7\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l4_g7 [label="LayerNorm L4\nGPU 7" fillcolor=lightgreen shape=rectangle]
    split_tp_l4 -> attn_l4_g0
    attn_l4_g0 -> ar_attn_l4
    ar_attn_l4 -> mlp1_l4_g0
    mlp1_l4_g0 -> mlp2_l4_g0
    mlp2_l4_g0 -> ar_mlp_l4
    ar_mlp_l4 -> norm_l4_g0
    split_tp_l4 -> attn_l4_g1
    attn_l4_g1 -> ar_attn_l4
    ar_attn_l4 -> mlp1_l4_g1
    mlp1_l4_g1 -> mlp2_l4_g1
    mlp2_l4_g1 -> ar_mlp_l4
    ar_mlp_l4 -> norm_l4_g1
    split_tp_l4 -> attn_l4_g2
    attn_l4_g2 -> ar_attn_l4
    ar_attn_l4 -> mlp1_l4_g2
    mlp1_l4_g2 -> mlp2_l4_g2
    mlp2_l4_g2 -> ar_mlp_l4
    ar_mlp_l4 -> norm_l4_g2
    split_tp_l4 -> attn_l4_g3
    attn_l4_g3 -> ar_attn_l4
    ar_attn_l4 -> mlp1_l4_g3
    mlp1_l4_g3 -> mlp2_l4_g3
    mlp2_l4_g3 -> ar_mlp_l4
    ar_mlp_l4 -> norm_l4_g3
    split_tp_l4 -> attn_l4_g4
    attn_l4_g4 -> ar_attn_l4
    ar_attn_l4 -> mlp1_l4_g4
    mlp1_l4_g4 -> mlp2_l4_g4
    mlp2_l4_g4 -> ar_mlp_l4
    ar_mlp_l4 -> norm_l4_g4
    split_tp_l4 -> attn_l4_g5
    attn_l4_g5 -> ar_attn_l4
    ar_attn_l4 -> mlp1_l4_g5
    mlp1_l4_g5 -> mlp2_l4_g5
    mlp2_l4_g5 -> ar_mlp_l4
    ar_mlp_l4 -> norm_l4_g5
    split_tp_l4 -> attn_l4_g6
    attn_l4_g6 -> ar_attn_l4
    ar_attn_l4 -> mlp1_l4_g6
    mlp1_l4_g6 -> mlp2_l4_g6
    mlp2_l4_g6 -> ar_mlp_l4
    ar_mlp_l4 -> norm_l4_g6
    split_tp_l4 -> attn_l4_g7
    attn_l4_g7 -> ar_attn_l4
    ar_attn_l4 -> mlp1_l4_g7
    mlp1_l4_g7 -> mlp2_l4_g7
    mlp2_l4_g7 -> ar_mlp_l4
    ar_mlp_l4 -> norm_l4_g7
    
    // Layer 5
    split_tp_l5 [label="Split TP\nLayer 5" fillcolor=lightyellow shape=parallelogram]
    ar_attn_l5 [label="All-Reduce\nAttention L5" fillcolor=lightblue shape=ellipse]
    ar_mlp_l5 [label="All-Reduce\nMLP L5" fillcolor=lightblue shape=ellipse]
    attn_l5_g0 [label="Attention L5\nGPU 0\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l5_g0 [label="MLP1 L5\nGPU 0\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l5_g0 [label="MLP2 L5\nGPU 0\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l5_g0 [label="LayerNorm L5\nGPU 0" fillcolor=lightgreen shape=rectangle]
    attn_l5_g1 [label="Attention L5\nGPU 1\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l5_g1 [label="MLP1 L5\nGPU 1\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l5_g1 [label="MLP2 L5\nGPU 1\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l5_g1 [label="LayerNorm L5\nGPU 1" fillcolor=lightgreen shape=rectangle]
    attn_l5_g2 [label="Attention L5\nGPU 2\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l5_g2 [label="MLP1 L5\nGPU 2\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l5_g2 [label="MLP2 L5\nGPU 2\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l5_g2 [label="LayerNorm L5\nGPU 2" fillcolor=lightgreen shape=rectangle]
    attn_l5_g3 [label="Attention L5\nGPU 3\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l5_g3 [label="MLP1 L5\nGPU 3\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l5_g3 [label="MLP2 L5\nGPU 3\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l5_g3 [label="LayerNorm L5\nGPU 3" fillcolor=lightgreen shape=rectangle]
    attn_l5_g4 [label="Attention L5\nGPU 4\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l5_g4 [label="MLP1 L5\nGPU 4\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l5_g4 [label="MLP2 L5\nGPU 4\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l5_g4 [label="LayerNorm L5\nGPU 4" fillcolor=lightgreen shape=rectangle]
    attn_l5_g5 [label="Attention L5\nGPU 5\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l5_g5 [label="MLP1 L5\nGPU 5\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l5_g5 [label="MLP2 L5\nGPU 5\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l5_g5 [label="LayerNorm L5\nGPU 5" fillcolor=lightgreen shape=rectangle]
    attn_l5_g6 [label="Attention L5\nGPU 6\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l5_g6 [label="MLP1 L5\nGPU 6\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l5_g6 [label="MLP2 L5\nGPU 6\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l5_g6 [label="LayerNorm L5\nGPU 6" fillcolor=lightgreen shape=rectangle]
    attn_l5_g7 [label="Attention L5\nGPU 7\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l5_g7 [label="MLP1 L5\nGPU 7\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l5_g7 [label="MLP2 L5\nGPU 7\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l5_g7 [label="LayerNorm L5\nGPU 7" fillcolor=lightgreen shape=rectangle]
    split_tp_l5 -> attn_l5_g0
    attn_l5_g0 -> ar_attn_l5
    ar_attn_l5 -> mlp1_l5_g0
    mlp1_l5_g0 -> mlp2_l5_g0
    mlp2_l5_g0 -> ar_mlp_l5
    ar_mlp_l5 -> norm_l5_g0
    split_tp_l5 -> attn_l5_g1
    attn_l5_g1 -> ar_attn_l5
    ar_attn_l5 -> mlp1_l5_g1
    mlp1_l5_g1 -> mlp2_l5_g1
    mlp2_l5_g1 -> ar_mlp_l5
    ar_mlp_l5 -> norm_l5_g1
    split_tp_l5 -> attn_l5_g2
    attn_l5_g2 -> ar_attn_l5
    ar_attn_l5 -> mlp1_l5_g2
    mlp1_l5_g2 -> mlp2_l5_g2
    mlp2_l5_g2 -> ar_mlp_l5
    ar_mlp_l5 -> norm_l5_g2
    split_tp_l5 -> attn_l5_g3
    attn_l5_g3 -> ar_attn_l5
    ar_attn_l5 -> mlp1_l5_g3
    mlp1_l5_g3 -> mlp2_l5_g3
    mlp2_l5_g3 -> ar_mlp_l5
    ar_mlp_l5 -> norm_l5_g3
    split_tp_l5 -> attn_l5_g4
    attn_l5_g4 -> ar_attn_l5
    ar_attn_l5 -> mlp1_l5_g4
    mlp1_l5_g4 -> mlp2_l5_g4
    mlp2_l5_g4 -> ar_mlp_l5
    ar_mlp_l5 -> norm_l5_g4
    split_tp_l5 -> attn_l5_g5
    attn_l5_g5 -> ar_attn_l5
    ar_attn_l5 -> mlp1_l5_g5
    mlp1_l5_g5 -> mlp2_l5_g5
    mlp2_l5_g5 -> ar_mlp_l5
    ar_mlp_l5 -> norm_l5_g5
    split_tp_l5 -> attn_l5_g6
    attn_l5_g6 -> ar_attn_l5
    ar_attn_l5 -> mlp1_l5_g6
    mlp1_l5_g6 -> mlp2_l5_g6
    mlp2_l5_g6 -> ar_mlp_l5
    ar_mlp_l5 -> norm_l5_g6
    split_tp_l5 -> attn_l5_g7
    attn_l5_g7 -> ar_attn_l5
    ar_attn_l5 -> mlp1_l5_g7
    mlp1_l5_g7 -> mlp2_l5_g7
    mlp2_l5_g7 -> ar_mlp_l5
    ar_mlp_l5 -> norm_l5_g7
    
    // Layer 6
    split_tp_l6 [label="Split TP\nLayer 6" fillcolor=lightyellow shape=parallelogram]
    ar_attn_l6 [label="All-Reduce\nAttention L6" fillcolor=lightblue shape=ellipse]
    ar_mlp_l6 [label="All-Reduce\nMLP L6" fillcolor=lightblue shape=ellipse]
    attn_l6_g0 [label="Attention L6\nGPU 0\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l6_g0 [label="MLP1 L6\nGPU 0\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l6_g0 [label="MLP2 L6\nGPU 0\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l6_g0 [label="LayerNorm L6\nGPU 0" fillcolor=lightgreen shape=rectangle]
    attn_l6_g1 [label="Attention L6\nGPU 1\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l6_g1 [label="MLP1 L6\nGPU 1\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l6_g1 [label="MLP2 L6\nGPU 1\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l6_g1 [label="LayerNorm L6\nGPU 1" fillcolor=lightgreen shape=rectangle]
    attn_l6_g2 [label="Attention L6\nGPU 2\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l6_g2 [label="MLP1 L6\nGPU 2\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l6_g2 [label="MLP2 L6\nGPU 2\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l6_g2 [label="LayerNorm L6\nGPU 2" fillcolor=lightgreen shape=rectangle]
    attn_l6_g3 [label="Attention L6\nGPU 3\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l6_g3 [label="MLP1 L6\nGPU 3\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l6_g3 [label="MLP2 L6\nGPU 3\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l6_g3 [label="LayerNorm L6\nGPU 3" fillcolor=lightgreen shape=rectangle]
    attn_l6_g4 [label="Attention L6\nGPU 4\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l6_g4 [label="MLP1 L6\nGPU 4\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l6_g4 [label="MLP2 L6\nGPU 4\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l6_g4 [label="LayerNorm L6\nGPU 4" fillcolor=lightgreen shape=rectangle]
    attn_l6_g5 [label="Attention L6\nGPU 5\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l6_g5 [label="MLP1 L6\nGPU 5\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l6_g5 [label="MLP2 L6\nGPU 5\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l6_g5 [label="LayerNorm L6\nGPU 5" fillcolor=lightgreen shape=rectangle]
    attn_l6_g6 [label="Attention L6\nGPU 6\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l6_g6 [label="MLP1 L6\nGPU 6\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l6_g6 [label="MLP2 L6\nGPU 6\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l6_g6 [label="LayerNorm L6\nGPU 6" fillcolor=lightgreen shape=rectangle]
    attn_l6_g7 [label="Attention L6\nGPU 7\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l6_g7 [label="MLP1 L6\nGPU 7\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l6_g7 [label="MLP2 L6\nGPU 7\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l6_g7 [label="LayerNorm L6\nGPU 7" fillcolor=lightgreen shape=rectangle]
    split_tp_l6 -> attn_l6_g0
    attn_l6_g0 -> ar_attn_l6
    ar_attn_l6 -> mlp1_l6_g0
    mlp1_l6_g0 -> mlp2_l6_g0
    mlp2_l6_g0 -> ar_mlp_l6
    ar_mlp_l6 -> norm_l6_g0
    split_tp_l6 -> attn_l6_g1
    attn_l6_g1 -> ar_attn_l6
    ar_attn_l6 -> mlp1_l6_g1
    mlp1_l6_g1 -> mlp2_l6_g1
    mlp2_l6_g1 -> ar_mlp_l6
    ar_mlp_l6 -> norm_l6_g1
    split_tp_l6 -> attn_l6_g2
    attn_l6_g2 -> ar_attn_l6
    ar_attn_l6 -> mlp1_l6_g2
    mlp1_l6_g2 -> mlp2_l6_g2
    mlp2_l6_g2 -> ar_mlp_l6
    ar_mlp_l6 -> norm_l6_g2
    split_tp_l6 -> attn_l6_g3
    attn_l6_g3 -> ar_attn_l6
    ar_attn_l6 -> mlp1_l6_g3
    mlp1_l6_g3 -> mlp2_l6_g3
    mlp2_l6_g3 -> ar_mlp_l6
    ar_mlp_l6 -> norm_l6_g3
    split_tp_l6 -> attn_l6_g4
    attn_l6_g4 -> ar_attn_l6
    ar_attn_l6 -> mlp1_l6_g4
    mlp1_l6_g4 -> mlp2_l6_g4
    mlp2_l6_g4 -> ar_mlp_l6
    ar_mlp_l6 -> norm_l6_g4
    split_tp_l6 -> attn_l6_g5
    attn_l6_g5 -> ar_attn_l6
    ar_attn_l6 -> mlp1_l6_g5
    mlp1_l6_g5 -> mlp2_l6_g5
    mlp2_l6_g5 -> ar_mlp_l6
    ar_mlp_l6 -> norm_l6_g5
    split_tp_l6 -> attn_l6_g6
    attn_l6_g6 -> ar_attn_l6
    ar_attn_l6 -> mlp1_l6_g6
    mlp1_l6_g6 -> mlp2_l6_g6
    mlp2_l6_g6 -> ar_mlp_l6
    ar_mlp_l6 -> norm_l6_g6
    split_tp_l6 -> attn_l6_g7
    attn_l6_g7 -> ar_attn_l6
    ar_attn_l6 -> mlp1_l6_g7
    mlp1_l6_g7 -> mlp2_l6_g7
    mlp2_l6_g7 -> ar_mlp_l6
    ar_mlp_l6 -> norm_l6_g7
    
    // Layer 7
    split_tp_l7 [label="Split TP\nLayer 7" fillcolor=lightyellow shape=parallelogram]
    ar_attn_l7 [label="All-Reduce\nAttention L7" fillcolor=lightblue shape=ellipse]
    ar_mlp_l7 [label="All-Reduce\nMLP L7" fillcolor=lightblue shape=ellipse]
    attn_l7_g0 [label="Attention L7\nGPU 0\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l7_g0 [label="MLP1 L7\nGPU 0\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l7_g0 [label="MLP2 L7\nGPU 0\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l7_g0 [label="LayerNorm L7\nGPU 0" fillcolor=lightgreen shape=rectangle]
    attn_l7_g1 [label="Attention L7\nGPU 1\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l7_g1 [label="MLP1 L7\nGPU 1\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l7_g1 [label="MLP2 L7\nGPU 1\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l7_g1 [label="LayerNorm L7\nGPU 1" fillcolor=lightgreen shape=rectangle]
    attn_l7_g2 [label="Attention L7\nGPU 2\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l7_g2 [label="MLP1 L7\nGPU 2\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l7_g2 [label="MLP2 L7\nGPU 2\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l7_g2 [label="LayerNorm L7\nGPU 2" fillcolor=lightgreen shape=rectangle]
    attn_l7_g3 [label="Attention L7\nGPU 3\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l7_g3 [label="MLP1 L7\nGPU 3\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l7_g3 [label="MLP2 L7\nGPU 3\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l7_g3 [label="LayerNorm L7\nGPU 3" fillcolor=lightgreen shape=rectangle]
    attn_l7_g4 [label="Attention L7\nGPU 4\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l7_g4 [label="MLP1 L7\nGPU 4\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l7_g4 [label="MLP2 L7\nGPU 4\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l7_g4 [label="LayerNorm L7\nGPU 4" fillcolor=lightgreen shape=rectangle]
    attn_l7_g5 [label="Attention L7\nGPU 5\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l7_g5 [label="MLP1 L7\nGPU 5\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l7_g5 [label="MLP2 L7\nGPU 5\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l7_g5 [label="LayerNorm L7\nGPU 5" fillcolor=lightgreen shape=rectangle]
    attn_l7_g6 [label="Attention L7\nGPU 6\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l7_g6 [label="MLP1 L7\nGPU 6\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l7_g6 [label="MLP2 L7\nGPU 6\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l7_g6 [label="LayerNorm L7\nGPU 6" fillcolor=lightgreen shape=rectangle]
    attn_l7_g7 [label="Attention L7\nGPU 7\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l7_g7 [label="MLP1 L7\nGPU 7\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l7_g7 [label="MLP2 L7\nGPU 7\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l7_g7 [label="LayerNorm L7\nGPU 7" fillcolor=lightgreen shape=rectangle]
    split_tp_l7 -> attn_l7_g0
    attn_l7_g0 -> ar_attn_l7
    ar_attn_l7 -> mlp1_l7_g0
    mlp1_l7_g0 -> mlp2_l7_g0
    mlp2_l7_g0 -> ar_mlp_l7
    ar_mlp_l7 -> norm_l7_g0
    split_tp_l7 -> attn_l7_g1
    attn_l7_g1 -> ar_attn_l7
    ar_attn_l7 -> mlp1_l7_g1
    mlp1_l7_g1 -> mlp2_l7_g1
    mlp2_l7_g1 -> ar_mlp_l7
    ar_mlp_l7 -> norm_l7_g1
    split_tp_l7 -> attn_l7_g2
    attn_l7_g2 -> ar_attn_l7
    ar_attn_l7 -> mlp1_l7_g2
    mlp1_l7_g2 -> mlp2_l7_g2
    mlp2_l7_g2 -> ar_mlp_l7
    ar_mlp_l7 -> norm_l7_g2
    split_tp_l7 -> attn_l7_g3
    attn_l7_g3 -> ar_attn_l7
    ar_attn_l7 -> mlp1_l7_g3
    mlp1_l7_g3 -> mlp2_l7_g3
    mlp2_l7_g3 -> ar_mlp_l7
    ar_mlp_l7 -> norm_l7_g3
    split_tp_l7 -> attn_l7_g4
    attn_l7_g4 -> ar_attn_l7
    ar_attn_l7 -> mlp1_l7_g4
    mlp1_l7_g4 -> mlp2_l7_g4
    mlp2_l7_g4 -> ar_mlp_l7
    ar_mlp_l7 -> norm_l7_g4
    split_tp_l7 -> attn_l7_g5
    attn_l7_g5 -> ar_attn_l7
    ar_attn_l7 -> mlp1_l7_g5
    mlp1_l7_g5 -> mlp2_l7_g5
    mlp2_l7_g5 -> ar_mlp_l7
    ar_mlp_l7 -> norm_l7_g5
    split_tp_l7 -> attn_l7_g6
    attn_l7_g6 -> ar_attn_l7
    ar_attn_l7 -> mlp1_l7_g6
    mlp1_l7_g6 -> mlp2_l7_g6
    mlp2_l7_g6 -> ar_mlp_l7
    ar_mlp_l7 -> norm_l7_g6
    split_tp_l7 -> attn_l7_g7
    attn_l7_g7 -> ar_attn_l7
    ar_attn_l7 -> mlp1_l7_g7
    mlp1_l7_g7 -> mlp2_l7_g7
    mlp2_l7_g7 -> ar_mlp_l7
    ar_mlp_l7 -> norm_l7_g7
    
    // Layer 8
    split_tp_l8 [label="Split TP\nLayer 8" fillcolor=lightyellow shape=parallelogram]
    ar_attn_l8 [label="All-Reduce\nAttention L8" fillcolor=lightblue shape=ellipse]
    ar_mlp_l8 [label="All-Reduce\nMLP L8" fillcolor=lightblue shape=ellipse]
    attn_l8_g8 [label="Attention L8\nGPU 8\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l8_g8 [label="MLP1 L8\nGPU 8\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l8_g8 [label="MLP2 L8\nGPU 8\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l8_g8 [label="LayerNorm L8\nGPU 8" fillcolor=lightgreen shape=rectangle]
    attn_l8_g9 [label="Attention L8\nGPU 9\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l8_g9 [label="MLP1 L8\nGPU 9\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l8_g9 [label="MLP2 L8\nGPU 9\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l8_g9 [label="LayerNorm L8\nGPU 9" fillcolor=lightgreen shape=rectangle]
    attn_l8_g10 [label="Attention L8\nGPU 10\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l8_g10 [label="MLP1 L8\nGPU 10\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l8_g10 [label="MLP2 L8\nGPU 10\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l8_g10 [label="LayerNorm L8\nGPU 10" fillcolor=lightgreen shape=rectangle]
    attn_l8_g11 [label="Attention L8\nGPU 11\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l8_g11 [label="MLP1 L8\nGPU 11\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l8_g11 [label="MLP2 L8\nGPU 11\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l8_g11 [label="LayerNorm L8\nGPU 11" fillcolor=lightgreen shape=rectangle]
    attn_l8_g12 [label="Attention L8\nGPU 12\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l8_g12 [label="MLP1 L8\nGPU 12\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l8_g12 [label="MLP2 L8\nGPU 12\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l8_g12 [label="LayerNorm L8\nGPU 12" fillcolor=lightgreen shape=rectangle]
    attn_l8_g13 [label="Attention L8\nGPU 13\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l8_g13 [label="MLP1 L8\nGPU 13\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l8_g13 [label="MLP2 L8\nGPU 13\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l8_g13 [label="LayerNorm L8\nGPU 13" fillcolor=lightgreen shape=rectangle]
    attn_l8_g14 [label="Attention L8\nGPU 14\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l8_g14 [label="MLP1 L8\nGPU 14\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l8_g14 [label="MLP2 L8\nGPU 14\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l8_g14 [label="LayerNorm L8\nGPU 14" fillcolor=lightgreen shape=rectangle]
    attn_l8_g15 [label="Attention L8\nGPU 15\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l8_g15 [label="MLP1 L8\nGPU 15\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l8_g15 [label="MLP2 L8\nGPU 15\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l8_g15 [label="LayerNorm L8\nGPU 15" fillcolor=lightgreen shape=rectangle]
    split_tp_l8 -> attn_l8_g8
    attn_l8_g8 -> ar_attn_l8
    ar_attn_l8 -> mlp1_l8_g8
    mlp1_l8_g8 -> mlp2_l8_g8
    mlp2_l8_g8 -> ar_mlp_l8
    ar_mlp_l8 -> norm_l8_g8
    split_tp_l8 -> attn_l8_g9
    attn_l8_g9 -> ar_attn_l8
    ar_attn_l8 -> mlp1_l8_g9
    mlp1_l8_g9 -> mlp2_l8_g9
    mlp2_l8_g9 -> ar_mlp_l8
    ar_mlp_l8 -> norm_l8_g9
    split_tp_l8 -> attn_l8_g10
    attn_l8_g10 -> ar_attn_l8
    ar_attn_l8 -> mlp1_l8_g10
    mlp1_l8_g10 -> mlp2_l8_g10
    mlp2_l8_g10 -> ar_mlp_l8
    ar_mlp_l8 -> norm_l8_g10
    split_tp_l8 -> attn_l8_g11
    attn_l8_g11 -> ar_attn_l8
    ar_attn_l8 -> mlp1_l8_g11
    mlp1_l8_g11 -> mlp2_l8_g11
    mlp2_l8_g11 -> ar_mlp_l8
    ar_mlp_l8 -> norm_l8_g11
    split_tp_l8 -> attn_l8_g12
    attn_l8_g12 -> ar_attn_l8
    ar_attn_l8 -> mlp1_l8_g12
    mlp1_l8_g12 -> mlp2_l8_g12
    mlp2_l8_g12 -> ar_mlp_l8
    ar_mlp_l8 -> norm_l8_g12
    split_tp_l8 -> attn_l8_g13
    attn_l8_g13 -> ar_attn_l8
    ar_attn_l8 -> mlp1_l8_g13
    mlp1_l8_g13 -> mlp2_l8_g13
    mlp2_l8_g13 -> ar_mlp_l8
    ar_mlp_l8 -> norm_l8_g13
    split_tp_l8 -> attn_l8_g14
    attn_l8_g14 -> ar_attn_l8
    ar_attn_l8 -> mlp1_l8_g14
    mlp1_l8_g14 -> mlp2_l8_g14
    mlp2_l8_g14 -> ar_mlp_l8
    ar_mlp_l8 -> norm_l8_g14
    split_tp_l8 -> attn_l8_g15
    attn_l8_g15 -> ar_attn_l8
    ar_attn_l8 -> mlp1_l8_g15
    mlp1_l8_g15 -> mlp2_l8_g15
    mlp2_l8_g15 -> ar_mlp_l8
    ar_mlp_l8 -> norm_l8_g15
    
    // Layer 9
    split_tp_l9 [label="Split TP\nLayer 9" fillcolor=lightyellow shape=parallelogram]
    ar_attn_l9 [label="All-Reduce\nAttention L9" fillcolor=lightblue shape=ellipse]
    ar_mlp_l9 [label="All-Reduce\nMLP L9" fillcolor=lightblue shape=ellipse]
    attn_l9_g8 [label="Attention L9\nGPU 8\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l9_g8 [label="MLP1 L9\nGPU 8\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l9_g8 [label="MLP2 L9\nGPU 8\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l9_g8 [label="LayerNorm L9\nGPU 8" fillcolor=lightgreen shape=rectangle]
    attn_l9_g9 [label="Attention L9\nGPU 9\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l9_g9 [label="MLP1 L9\nGPU 9\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l9_g9 [label="MLP2 L9\nGPU 9\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l9_g9 [label="LayerNorm L9\nGPU 9" fillcolor=lightgreen shape=rectangle]
    attn_l9_g10 [label="Attention L9\nGPU 10\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l9_g10 [label="MLP1 L9\nGPU 10\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l9_g10 [label="MLP2 L9\nGPU 10\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l9_g10 [label="LayerNorm L9\nGPU 10" fillcolor=lightgreen shape=rectangle]
    attn_l9_g11 [label="Attention L9\nGPU 11\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l9_g11 [label="MLP1 L9\nGPU 11\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l9_g11 [label="MLP2 L9\nGPU 11\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l9_g11 [label="LayerNorm L9\nGPU 11" fillcolor=lightgreen shape=rectangle]
    attn_l9_g12 [label="Attention L9\nGPU 12\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l9_g12 [label="MLP1 L9\nGPU 12\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l9_g12 [label="MLP2 L9\nGPU 12\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l9_g12 [label="LayerNorm L9\nGPU 12" fillcolor=lightgreen shape=rectangle]
    attn_l9_g13 [label="Attention L9\nGPU 13\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l9_g13 [label="MLP1 L9\nGPU 13\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l9_g13 [label="MLP2 L9\nGPU 13\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l9_g13 [label="LayerNorm L9\nGPU 13" fillcolor=lightgreen shape=rectangle]
    attn_l9_g14 [label="Attention L9\nGPU 14\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l9_g14 [label="MLP1 L9\nGPU 14\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l9_g14 [label="MLP2 L9\nGPU 14\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l9_g14 [label="LayerNorm L9\nGPU 14" fillcolor=lightgreen shape=rectangle]
    attn_l9_g15 [label="Attention L9\nGPU 15\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l9_g15 [label="MLP1 L9\nGPU 15\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l9_g15 [label="MLP2 L9\nGPU 15\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l9_g15 [label="LayerNorm L9\nGPU 15" fillcolor=lightgreen shape=rectangle]
    split_tp_l9 -> attn_l9_g8
    attn_l9_g8 -> ar_attn_l9
    ar_attn_l9 -> mlp1_l9_g8
    mlp1_l9_g8 -> mlp2_l9_g8
    mlp2_l9_g8 -> ar_mlp_l9
    ar_mlp_l9 -> norm_l9_g8
    split_tp_l9 -> attn_l9_g9
    attn_l9_g9 -> ar_attn_l9
    ar_attn_l9 -> mlp1_l9_g9
    mlp1_l9_g9 -> mlp2_l9_g9
    mlp2_l9_g9 -> ar_mlp_l9
    ar_mlp_l9 -> norm_l9_g9
    split_tp_l9 -> attn_l9_g10
    attn_l9_g10 -> ar_attn_l9
    ar_attn_l9 -> mlp1_l9_g10
    mlp1_l9_g10 -> mlp2_l9_g10
    mlp2_l9_g10 -> ar_mlp_l9
    ar_mlp_l9 -> norm_l9_g10
    split_tp_l9 -> attn_l9_g11
    attn_l9_g11 -> ar_attn_l9
    ar_attn_l9 -> mlp1_l9_g11
    mlp1_l9_g11 -> mlp2_l9_g11
    mlp2_l9_g11 -> ar_mlp_l9
    ar_mlp_l9 -> norm_l9_g11
    split_tp_l9 -> attn_l9_g12
    attn_l9_g12 -> ar_attn_l9
    ar_attn_l9 -> mlp1_l9_g12
    mlp1_l9_g12 -> mlp2_l9_g12
    mlp2_l9_g12 -> ar_mlp_l9
    ar_mlp_l9 -> norm_l9_g12
    split_tp_l9 -> attn_l9_g13
    attn_l9_g13 -> ar_attn_l9
    ar_attn_l9 -> mlp1_l9_g13
    mlp1_l9_g13 -> mlp2_l9_g13
    mlp2_l9_g13 -> ar_mlp_l9
    ar_mlp_l9 -> norm_l9_g13
    split_tp_l9 -> attn_l9_g14
    attn_l9_g14 -> ar_attn_l9
    ar_attn_l9 -> mlp1_l9_g14
    mlp1_l9_g14 -> mlp2_l9_g14
    mlp2_l9_g14 -> ar_mlp_l9
    ar_mlp_l9 -> norm_l9_g14
    split_tp_l9 -> attn_l9_g15
    attn_l9_g15 -> ar_attn_l9
    ar_attn_l9 -> mlp1_l9_g15
    mlp1_l9_g15 -> mlp2_l9_g15
    mlp2_l9_g15 -> ar_mlp_l9
    ar_mlp_l9 -> norm_l9_g15
    
    // Layer 10
    split_tp_l10 [label="Split TP\nLayer 10" fillcolor=lightyellow shape=parallelogram]
    ar_attn_l10 [label="All-Reduce\nAttention L10" fillcolor=lightblue shape=ellipse]
    ar_mlp_l10 [label="All-Reduce\nMLP L10" fillcolor=lightblue shape=ellipse]
    attn_l10_g8 [label="Attention L10\nGPU 8\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l10_g8 [label="MLP1 L10\nGPU 8\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l10_g8 [label="MLP2 L10\nGPU 8\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l10_g8 [label="LayerNorm L10\nGPU 8" fillcolor=lightgreen shape=rectangle]
    attn_l10_g9 [label="Attention L10\nGPU 9\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l10_g9 [label="MLP1 L10\nGPU 9\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l10_g9 [label="MLP2 L10\nGPU 9\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l10_g9 [label="LayerNorm L10\nGPU 9" fillcolor=lightgreen shape=rectangle]
    attn_l10_g10 [label="Attention L10\nGPU 10\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l10_g10 [label="MLP1 L10\nGPU 10\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l10_g10 [label="MLP2 L10\nGPU 10\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l10_g10 [label="LayerNorm L10\nGPU 10" fillcolor=lightgreen shape=rectangle]
    attn_l10_g11 [label="Attention L10\nGPU 11\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l10_g11 [label="MLP1 L10\nGPU 11\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l10_g11 [label="MLP2 L10\nGPU 11\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l10_g11 [label="LayerNorm L10\nGPU 11" fillcolor=lightgreen shape=rectangle]
    attn_l10_g12 [label="Attention L10\nGPU 12\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l10_g12 [label="MLP1 L10\nGPU 12\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l10_g12 [label="MLP2 L10\nGPU 12\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l10_g12 [label="LayerNorm L10\nGPU 12" fillcolor=lightgreen shape=rectangle]
    attn_l10_g13 [label="Attention L10\nGPU 13\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l10_g13 [label="MLP1 L10\nGPU 13\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l10_g13 [label="MLP2 L10\nGPU 13\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l10_g13 [label="LayerNorm L10\nGPU 13" fillcolor=lightgreen shape=rectangle]
    attn_l10_g14 [label="Attention L10\nGPU 14\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l10_g14 [label="MLP1 L10\nGPU 14\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l10_g14 [label="MLP2 L10\nGPU 14\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l10_g14 [label="LayerNorm L10\nGPU 14" fillcolor=lightgreen shape=rectangle]
    attn_l10_g15 [label="Attention L10\nGPU 15\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l10_g15 [label="MLP1 L10\nGPU 15\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l10_g15 [label="MLP2 L10\nGPU 15\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l10_g15 [label="LayerNorm L10\nGPU 15" fillcolor=lightgreen shape=rectangle]
    split_tp_l10 -> attn_l10_g8
    attn_l10_g8 -> ar_attn_l10
    ar_attn_l10 -> mlp1_l10_g8
    mlp1_l10_g8 -> mlp2_l10_g8
    mlp2_l10_g8 -> ar_mlp_l10
    ar_mlp_l10 -> norm_l10_g8
    split_tp_l10 -> attn_l10_g9
    attn_l10_g9 -> ar_attn_l10
    ar_attn_l10 -> mlp1_l10_g9
    mlp1_l10_g9 -> mlp2_l10_g9
    mlp2_l10_g9 -> ar_mlp_l10
    ar_mlp_l10 -> norm_l10_g9
    split_tp_l10 -> attn_l10_g10
    attn_l10_g10 -> ar_attn_l10
    ar_attn_l10 -> mlp1_l10_g10
    mlp1_l10_g10 -> mlp2_l10_g10
    mlp2_l10_g10 -> ar_mlp_l10
    ar_mlp_l10 -> norm_l10_g10
    split_tp_l10 -> attn_l10_g11
    attn_l10_g11 -> ar_attn_l10
    ar_attn_l10 -> mlp1_l10_g11
    mlp1_l10_g11 -> mlp2_l10_g11
    mlp2_l10_g11 -> ar_mlp_l10
    ar_mlp_l10 -> norm_l10_g11
    split_tp_l10 -> attn_l10_g12
    attn_l10_g12 -> ar_attn_l10
    ar_attn_l10 -> mlp1_l10_g12
    mlp1_l10_g12 -> mlp2_l10_g12
    mlp2_l10_g12 -> ar_mlp_l10
    ar_mlp_l10 -> norm_l10_g12
    split_tp_l10 -> attn_l10_g13
    attn_l10_g13 -> ar_attn_l10
    ar_attn_l10 -> mlp1_l10_g13
    mlp1_l10_g13 -> mlp2_l10_g13
    mlp2_l10_g13 -> ar_mlp_l10
    ar_mlp_l10 -> norm_l10_g13
    split_tp_l10 -> attn_l10_g14
    attn_l10_g14 -> ar_attn_l10
    ar_attn_l10 -> mlp1_l10_g14
    mlp1_l10_g14 -> mlp2_l10_g14
    mlp2_l10_g14 -> ar_mlp_l10
    ar_mlp_l10 -> norm_l10_g14
    split_tp_l10 -> attn_l10_g15
    attn_l10_g15 -> ar_attn_l10
    ar_attn_l10 -> mlp1_l10_g15
    mlp1_l10_g15 -> mlp2_l10_g15
    mlp2_l10_g15 -> ar_mlp_l10
    ar_mlp_l10 -> norm_l10_g15
    
    // Layer 11
    split_tp_l11 [label="Split TP\nLayer 11" fillcolor=lightyellow shape=parallelogram]
    ar_attn_l11 [label="All-Reduce\nAttention L11" fillcolor=lightblue shape=ellipse]
    ar_mlp_l11 [label="All-Reduce\nMLP L11" fillcolor=lightblue shape=ellipse]
    attn_l11_g8 [label="Attention L11\nGPU 8\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l11_g8 [label="MLP1 L11\nGPU 8\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l11_g8 [label="MLP2 L11\nGPU 8\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l11_g8 [label="LayerNorm L11\nGPU 8" fillcolor=lightgreen shape=rectangle]
    attn_l11_g9 [label="Attention L11\nGPU 9\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l11_g9 [label="MLP1 L11\nGPU 9\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l11_g9 [label="MLP2 L11\nGPU 9\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l11_g9 [label="LayerNorm L11\nGPU 9" fillcolor=lightgreen shape=rectangle]
    attn_l11_g10 [label="Attention L11\nGPU 10\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l11_g10 [label="MLP1 L11\nGPU 10\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l11_g10 [label="MLP2 L11\nGPU 10\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l11_g10 [label="LayerNorm L11\nGPU 10" fillcolor=lightgreen shape=rectangle]
    attn_l11_g11 [label="Attention L11\nGPU 11\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l11_g11 [label="MLP1 L11\nGPU 11\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l11_g11 [label="MLP2 L11\nGPU 11\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l11_g11 [label="LayerNorm L11\nGPU 11" fillcolor=lightgreen shape=rectangle]
    attn_l11_g12 [label="Attention L11\nGPU 12\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l11_g12 [label="MLP1 L11\nGPU 12\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l11_g12 [label="MLP2 L11\nGPU 12\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l11_g12 [label="LayerNorm L11\nGPU 12" fillcolor=lightgreen shape=rectangle]
    attn_l11_g13 [label="Attention L11\nGPU 13\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l11_g13 [label="MLP1 L11\nGPU 13\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l11_g13 [label="MLP2 L11\nGPU 13\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l11_g13 [label="LayerNorm L11\nGPU 13" fillcolor=lightgreen shape=rectangle]
    attn_l11_g14 [label="Attention L11\nGPU 14\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l11_g14 [label="MLP1 L11\nGPU 14\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l11_g14 [label="MLP2 L11\nGPU 14\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l11_g14 [label="LayerNorm L11\nGPU 14" fillcolor=lightgreen shape=rectangle]
    attn_l11_g15 [label="Attention L11\nGPU 15\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l11_g15 [label="MLP1 L11\nGPU 15\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l11_g15 [label="MLP2 L11\nGPU 15\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l11_g15 [label="LayerNorm L11\nGPU 15" fillcolor=lightgreen shape=rectangle]
    split_tp_l11 -> attn_l11_g8
    attn_l11_g8 -> ar_attn_l11
    ar_attn_l11 -> mlp1_l11_g8
    mlp1_l11_g8 -> mlp2_l11_g8
    mlp2_l11_g8 -> ar_mlp_l11
    ar_mlp_l11 -> norm_l11_g8
    split_tp_l11 -> attn_l11_g9
    attn_l11_g9 -> ar_attn_l11
    ar_attn_l11 -> mlp1_l11_g9
    mlp1_l11_g9 -> mlp2_l11_g9
    mlp2_l11_g9 -> ar_mlp_l11
    ar_mlp_l11 -> norm_l11_g9
    split_tp_l11 -> attn_l11_g10
    attn_l11_g10 -> ar_attn_l11
    ar_attn_l11 -> mlp1_l11_g10
    mlp1_l11_g10 -> mlp2_l11_g10
    mlp2_l11_g10 -> ar_mlp_l11
    ar_mlp_l11 -> norm_l11_g10
    split_tp_l11 -> attn_l11_g11
    attn_l11_g11 -> ar_attn_l11
    ar_attn_l11 -> mlp1_l11_g11
    mlp1_l11_g11 -> mlp2_l11_g11
    mlp2_l11_g11 -> ar_mlp_l11
    ar_mlp_l11 -> norm_l11_g11
    split_tp_l11 -> attn_l11_g12
    attn_l11_g12 -> ar_attn_l11
    ar_attn_l11 -> mlp1_l11_g12
    mlp1_l11_g12 -> mlp2_l11_g12
    mlp2_l11_g12 -> ar_mlp_l11
    ar_mlp_l11 -> norm_l11_g12
    split_tp_l11 -> attn_l11_g13
    attn_l11_g13 -> ar_attn_l11
    ar_attn_l11 -> mlp1_l11_g13
    mlp1_l11_g13 -> mlp2_l11_g13
    mlp2_l11_g13 -> ar_mlp_l11
    ar_mlp_l11 -> norm_l11_g13
    split_tp_l11 -> attn_l11_g14
    attn_l11_g14 -> ar_attn_l11
    ar_attn_l11 -> mlp1_l11_g14
    mlp1_l11_g14 -> mlp2_l11_g14
    mlp2_l11_g14 -> ar_mlp_l11
    ar_mlp_l11 -> norm_l11_g14
    split_tp_l11 -> attn_l11_g15
    attn_l11_g15 -> ar_attn_l11
    ar_attn_l11 -> mlp1_l11_g15
    mlp1_l11_g15 -> mlp2_l11_g15
    mlp2_l11_g15 -> ar_mlp_l11
    ar_mlp_l11 -> norm_l11_g15
    
    // Layer 12
    split_tp_l12 [label="Split TP\nLayer 12" fillcolor=lightyellow shape=parallelogram]
    ar_attn_l12 [label="All-Reduce\nAttention L12" fillcolor=lightblue shape=ellipse]
    ar_mlp_l12 [label="All-Reduce\nMLP L12" fillcolor=lightblue shape=ellipse]
    attn_l12_g8 [label="Attention L12\nGPU 8\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l12_g8 [label="MLP1 L12\nGPU 8\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l12_g8 [label="MLP2 L12\nGPU 8\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l12_g8 [label="LayerNorm L12\nGPU 8" fillcolor=lightgreen shape=rectangle]
    attn_l12_g9 [label="Attention L12\nGPU 9\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l12_g9 [label="MLP1 L12\nGPU 9\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l12_g9 [label="MLP2 L12\nGPU 9\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l12_g9 [label="LayerNorm L12\nGPU 9" fillcolor=lightgreen shape=rectangle]
    attn_l12_g10 [label="Attention L12\nGPU 10\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l12_g10 [label="MLP1 L12\nGPU 10\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l12_g10 [label="MLP2 L12\nGPU 10\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l12_g10 [label="LayerNorm L12\nGPU 10" fillcolor=lightgreen shape=rectangle]
    attn_l12_g11 [label="Attention L12\nGPU 11\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l12_g11 [label="MLP1 L12\nGPU 11\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l12_g11 [label="MLP2 L12\nGPU 11\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l12_g11 [label="LayerNorm L12\nGPU 11" fillcolor=lightgreen shape=rectangle]
    attn_l12_g12 [label="Attention L12\nGPU 12\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l12_g12 [label="MLP1 L12\nGPU 12\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l12_g12 [label="MLP2 L12\nGPU 12\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l12_g12 [label="LayerNorm L12\nGPU 12" fillcolor=lightgreen shape=rectangle]
    attn_l12_g13 [label="Attention L12\nGPU 13\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l12_g13 [label="MLP1 L12\nGPU 13\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l12_g13 [label="MLP2 L12\nGPU 13\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l12_g13 [label="LayerNorm L12\nGPU 13" fillcolor=lightgreen shape=rectangle]
    attn_l12_g14 [label="Attention L12\nGPU 14\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l12_g14 [label="MLP1 L12\nGPU 14\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l12_g14 [label="MLP2 L12\nGPU 14\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l12_g14 [label="LayerNorm L12\nGPU 14" fillcolor=lightgreen shape=rectangle]
    attn_l12_g15 [label="Attention L12\nGPU 15\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l12_g15 [label="MLP1 L12\nGPU 15\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l12_g15 [label="MLP2 L12\nGPU 15\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l12_g15 [label="LayerNorm L12\nGPU 15" fillcolor=lightgreen shape=rectangle]
    split_tp_l12 -> attn_l12_g8
    attn_l12_g8 -> ar_attn_l12
    ar_attn_l12 -> mlp1_l12_g8
    mlp1_l12_g8 -> mlp2_l12_g8
    mlp2_l12_g8 -> ar_mlp_l12
    ar_mlp_l12 -> norm_l12_g8
    split_tp_l12 -> attn_l12_g9
    attn_l12_g9 -> ar_attn_l12
    ar_attn_l12 -> mlp1_l12_g9
    mlp1_l12_g9 -> mlp2_l12_g9
    mlp2_l12_g9 -> ar_mlp_l12
    ar_mlp_l12 -> norm_l12_g9
    split_tp_l12 -> attn_l12_g10
    attn_l12_g10 -> ar_attn_l12
    ar_attn_l12 -> mlp1_l12_g10
    mlp1_l12_g10 -> mlp2_l12_g10
    mlp2_l12_g10 -> ar_mlp_l12
    ar_mlp_l12 -> norm_l12_g10
    split_tp_l12 -> attn_l12_g11
    attn_l12_g11 -> ar_attn_l12
    ar_attn_l12 -> mlp1_l12_g11
    mlp1_l12_g11 -> mlp2_l12_g11
    mlp2_l12_g11 -> ar_mlp_l12
    ar_mlp_l12 -> norm_l12_g11
    split_tp_l12 -> attn_l12_g12
    attn_l12_g12 -> ar_attn_l12
    ar_attn_l12 -> mlp1_l12_g12
    mlp1_l12_g12 -> mlp2_l12_g12
    mlp2_l12_g12 -> ar_mlp_l12
    ar_mlp_l12 -> norm_l12_g12
    split_tp_l12 -> attn_l12_g13
    attn_l12_g13 -> ar_attn_l12
    ar_attn_l12 -> mlp1_l12_g13
    mlp1_l12_g13 -> mlp2_l12_g13
    mlp2_l12_g13 -> ar_mlp_l12
    ar_mlp_l12 -> norm_l12_g13
    split_tp_l12 -> attn_l12_g14
    attn_l12_g14 -> ar_attn_l12
    ar_attn_l12 -> mlp1_l12_g14
    mlp1_l12_g14 -> mlp2_l12_g14
    mlp2_l12_g14 -> ar_mlp_l12
    ar_mlp_l12 -> norm_l12_g14
    split_tp_l12 -> attn_l12_g15
    attn_l12_g15 -> ar_attn_l12
    ar_attn_l12 -> mlp1_l12_g15
    mlp1_l12_g15 -> mlp2_l12_g15
    mlp2_l12_g15 -> ar_mlp_l12
    ar_mlp_l12 -> norm_l12_g15
    
    // Layer 13
    split_tp_l13 [label="Split TP\nLayer 13" fillcolor=lightyellow shape=parallelogram]
    ar_attn_l13 [label="All-Reduce\nAttention L13" fillcolor=lightblue shape=ellipse]
    ar_mlp_l13 [label="All-Reduce\nMLP L13" fillcolor=lightblue shape=ellipse]
    attn_l13_g8 [label="Attention L13\nGPU 8\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l13_g8 [label="MLP1 L13\nGPU 8\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l13_g8 [label="MLP2 L13\nGPU 8\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l13_g8 [label="LayerNorm L13\nGPU 8" fillcolor=lightgreen shape=rectangle]
    attn_l13_g9 [label="Attention L13\nGPU 9\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l13_g9 [label="MLP1 L13\nGPU 9\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l13_g9 [label="MLP2 L13\nGPU 9\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l13_g9 [label="LayerNorm L13\nGPU 9" fillcolor=lightgreen shape=rectangle]
    attn_l13_g10 [label="Attention L13\nGPU 10\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l13_g10 [label="MLP1 L13\nGPU 10\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l13_g10 [label="MLP2 L13\nGPU 10\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l13_g10 [label="LayerNorm L13\nGPU 10" fillcolor=lightgreen shape=rectangle]
    attn_l13_g11 [label="Attention L13\nGPU 11\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l13_g11 [label="MLP1 L13\nGPU 11\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l13_g11 [label="MLP2 L13\nGPU 11\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l13_g11 [label="LayerNorm L13\nGPU 11" fillcolor=lightgreen shape=rectangle]
    attn_l13_g12 [label="Attention L13\nGPU 12\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l13_g12 [label="MLP1 L13\nGPU 12\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l13_g12 [label="MLP2 L13\nGPU 12\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l13_g12 [label="LayerNorm L13\nGPU 12" fillcolor=lightgreen shape=rectangle]
    attn_l13_g13 [label="Attention L13\nGPU 13\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l13_g13 [label="MLP1 L13\nGPU 13\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l13_g13 [label="MLP2 L13\nGPU 13\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l13_g13 [label="LayerNorm L13\nGPU 13" fillcolor=lightgreen shape=rectangle]
    attn_l13_g14 [label="Attention L13\nGPU 14\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l13_g14 [label="MLP1 L13\nGPU 14\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l13_g14 [label="MLP2 L13\nGPU 14\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l13_g14 [label="LayerNorm L13\nGPU 14" fillcolor=lightgreen shape=rectangle]
    attn_l13_g15 [label="Attention L13\nGPU 15\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l13_g15 [label="MLP1 L13\nGPU 15\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l13_g15 [label="MLP2 L13\nGPU 15\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l13_g15 [label="LayerNorm L13\nGPU 15" fillcolor=lightgreen shape=rectangle]
    split_tp_l13 -> attn_l13_g8
    attn_l13_g8 -> ar_attn_l13
    ar_attn_l13 -> mlp1_l13_g8
    mlp1_l13_g8 -> mlp2_l13_g8
    mlp2_l13_g8 -> ar_mlp_l13
    ar_mlp_l13 -> norm_l13_g8
    split_tp_l13 -> attn_l13_g9
    attn_l13_g9 -> ar_attn_l13
    ar_attn_l13 -> mlp1_l13_g9
    mlp1_l13_g9 -> mlp2_l13_g9
    mlp2_l13_g9 -> ar_mlp_l13
    ar_mlp_l13 -> norm_l13_g9
    split_tp_l13 -> attn_l13_g10
    attn_l13_g10 -> ar_attn_l13
    ar_attn_l13 -> mlp1_l13_g10
    mlp1_l13_g10 -> mlp2_l13_g10
    mlp2_l13_g10 -> ar_mlp_l13
    ar_mlp_l13 -> norm_l13_g10
    split_tp_l13 -> attn_l13_g11
    attn_l13_g11 -> ar_attn_l13
    ar_attn_l13 -> mlp1_l13_g11
    mlp1_l13_g11 -> mlp2_l13_g11
    mlp2_l13_g11 -> ar_mlp_l13
    ar_mlp_l13 -> norm_l13_g11
    split_tp_l13 -> attn_l13_g12
    attn_l13_g12 -> ar_attn_l13
    ar_attn_l13 -> mlp1_l13_g12
    mlp1_l13_g12 -> mlp2_l13_g12
    mlp2_l13_g12 -> ar_mlp_l13
    ar_mlp_l13 -> norm_l13_g12
    split_tp_l13 -> attn_l13_g13
    attn_l13_g13 -> ar_attn_l13
    ar_attn_l13 -> mlp1_l13_g13
    mlp1_l13_g13 -> mlp2_l13_g13
    mlp2_l13_g13 -> ar_mlp_l13
    ar_mlp_l13 -> norm_l13_g13
    split_tp_l13 -> attn_l13_g14
    attn_l13_g14 -> ar_attn_l13
    ar_attn_l13 -> mlp1_l13_g14
    mlp1_l13_g14 -> mlp2_l13_g14
    mlp2_l13_g14 -> ar_mlp_l13
    ar_mlp_l13 -> norm_l13_g14
    split_tp_l13 -> attn_l13_g15
    attn_l13_g15 -> ar_attn_l13
    ar_attn_l13 -> mlp1_l13_g15
    mlp1_l13_g15 -> mlp2_l13_g15
    mlp2_l13_g15 -> ar_mlp_l13
    ar_mlp_l13 -> norm_l13_g15
    
    // Layer 14
    split_tp_l14 [label="Split TP\nLayer 14" fillcolor=lightyellow shape=parallelogram]
    ar_attn_l14 [label="All-Reduce\nAttention L14" fillcolor=lightblue shape=ellipse]
    ar_mlp_l14 [label="All-Reduce\nMLP L14" fillcolor=lightblue shape=ellipse]
    attn_l14_g8 [label="Attention L14\nGPU 8\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l14_g8 [label="MLP1 L14\nGPU 8\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l14_g8 [label="MLP2 L14\nGPU 8\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l14_g8 [label="LayerNorm L14\nGPU 8" fillcolor=lightgreen shape=rectangle]
    attn_l14_g9 [label="Attention L14\nGPU 9\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l14_g9 [label="MLP1 L14\nGPU 9\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l14_g9 [label="MLP2 L14\nGPU 9\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l14_g9 [label="LayerNorm L14\nGPU 9" fillcolor=lightgreen shape=rectangle]
    attn_l14_g10 [label="Attention L14\nGPU 10\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l14_g10 [label="MLP1 L14\nGPU 10\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l14_g10 [label="MLP2 L14\nGPU 10\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l14_g10 [label="LayerNorm L14\nGPU 10" fillcolor=lightgreen shape=rectangle]
    attn_l14_g11 [label="Attention L14\nGPU 11\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l14_g11 [label="MLP1 L14\nGPU 11\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l14_g11 [label="MLP2 L14\nGPU 11\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l14_g11 [label="LayerNorm L14\nGPU 11" fillcolor=lightgreen shape=rectangle]
    attn_l14_g12 [label="Attention L14\nGPU 12\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l14_g12 [label="MLP1 L14\nGPU 12\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l14_g12 [label="MLP2 L14\nGPU 12\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l14_g12 [label="LayerNorm L14\nGPU 12" fillcolor=lightgreen shape=rectangle]
    attn_l14_g13 [label="Attention L14\nGPU 13\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l14_g13 [label="MLP1 L14\nGPU 13\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l14_g13 [label="MLP2 L14\nGPU 13\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l14_g13 [label="LayerNorm L14\nGPU 13" fillcolor=lightgreen shape=rectangle]
    attn_l14_g14 [label="Attention L14\nGPU 14\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l14_g14 [label="MLP1 L14\nGPU 14\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l14_g14 [label="MLP2 L14\nGPU 14\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l14_g14 [label="LayerNorm L14\nGPU 14" fillcolor=lightgreen shape=rectangle]
    attn_l14_g15 [label="Attention L14\nGPU 15\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l14_g15 [label="MLP1 L14\nGPU 15\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l14_g15 [label="MLP2 L14\nGPU 15\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l14_g15 [label="LayerNorm L14\nGPU 15" fillcolor=lightgreen shape=rectangle]
    split_tp_l14 -> attn_l14_g8
    attn_l14_g8 -> ar_attn_l14
    ar_attn_l14 -> mlp1_l14_g8
    mlp1_l14_g8 -> mlp2_l14_g8
    mlp2_l14_g8 -> ar_mlp_l14
    ar_mlp_l14 -> norm_l14_g8
    split_tp_l14 -> attn_l14_g9
    attn_l14_g9 -> ar_attn_l14
    ar_attn_l14 -> mlp1_l14_g9
    mlp1_l14_g9 -> mlp2_l14_g9
    mlp2_l14_g9 -> ar_mlp_l14
    ar_mlp_l14 -> norm_l14_g9
    split_tp_l14 -> attn_l14_g10
    attn_l14_g10 -> ar_attn_l14
    ar_attn_l14 -> mlp1_l14_g10
    mlp1_l14_g10 -> mlp2_l14_g10
    mlp2_l14_g10 -> ar_mlp_l14
    ar_mlp_l14 -> norm_l14_g10
    split_tp_l14 -> attn_l14_g11
    attn_l14_g11 -> ar_attn_l14
    ar_attn_l14 -> mlp1_l14_g11
    mlp1_l14_g11 -> mlp2_l14_g11
    mlp2_l14_g11 -> ar_mlp_l14
    ar_mlp_l14 -> norm_l14_g11
    split_tp_l14 -> attn_l14_g12
    attn_l14_g12 -> ar_attn_l14
    ar_attn_l14 -> mlp1_l14_g12
    mlp1_l14_g12 -> mlp2_l14_g12
    mlp2_l14_g12 -> ar_mlp_l14
    ar_mlp_l14 -> norm_l14_g12
    split_tp_l14 -> attn_l14_g13
    attn_l14_g13 -> ar_attn_l14
    ar_attn_l14 -> mlp1_l14_g13
    mlp1_l14_g13 -> mlp2_l14_g13
    mlp2_l14_g13 -> ar_mlp_l14
    ar_mlp_l14 -> norm_l14_g13
    split_tp_l14 -> attn_l14_g14
    attn_l14_g14 -> ar_attn_l14
    ar_attn_l14 -> mlp1_l14_g14
    mlp1_l14_g14 -> mlp2_l14_g14
    mlp2_l14_g14 -> ar_mlp_l14
    ar_mlp_l14 -> norm_l14_g14
    split_tp_l14 -> attn_l14_g15
    attn_l14_g15 -> ar_attn_l14
    ar_attn_l14 -> mlp1_l14_g15
    mlp1_l14_g15 -> mlp2_l14_g15
    mlp2_l14_g15 -> ar_mlp_l14
    ar_mlp_l14 -> norm_l14_g15
    
    // Layer 15
    split_tp_l15 [label="Split TP\nLayer 15" fillcolor=lightyellow shape=parallelogram]
    ar_attn_l15 [label="All-Reduce\nAttention L15" fillcolor=lightblue shape=ellipse]
    ar_mlp_l15 [label="All-Reduce\nMLP L15" fillcolor=lightblue shape=ellipse]
    attn_l15_g8 [label="Attention L15\nGPU 8\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l15_g8 [label="MLP1 L15\nGPU 8\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l15_g8 [label="MLP2 L15\nGPU 8\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l15_g8 [label="LayerNorm L15\nGPU 8" fillcolor=lightgreen shape=rectangle]
    attn_l15_g9 [label="Attention L15\nGPU 9\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l15_g9 [label="MLP1 L15\nGPU 9\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l15_g9 [label="MLP2 L15\nGPU 9\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l15_g9 [label="LayerNorm L15\nGPU 9" fillcolor=lightgreen shape=rectangle]
    attn_l15_g10 [label="Attention L15\nGPU 10\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l15_g10 [label="MLP1 L15\nGPU 10\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l15_g10 [label="MLP2 L15\nGPU 10\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l15_g10 [label="LayerNorm L15\nGPU 10" fillcolor=lightgreen shape=rectangle]
    attn_l15_g11 [label="Attention L15\nGPU 11\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l15_g11 [label="MLP1 L15\nGPU 11\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l15_g11 [label="MLP2 L15\nGPU 11\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l15_g11 [label="LayerNorm L15\nGPU 11" fillcolor=lightgreen shape=rectangle]
    attn_l15_g12 [label="Attention L15\nGPU 12\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l15_g12 [label="MLP1 L15\nGPU 12\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l15_g12 [label="MLP2 L15\nGPU 12\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l15_g12 [label="LayerNorm L15\nGPU 12" fillcolor=lightgreen shape=rectangle]
    attn_l15_g13 [label="Attention L15\nGPU 13\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l15_g13 [label="MLP1 L15\nGPU 13\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l15_g13 [label="MLP2 L15\nGPU 13\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l15_g13 [label="LayerNorm L15\nGPU 13" fillcolor=lightgreen shape=rectangle]
    attn_l15_g14 [label="Attention L15\nGPU 14\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l15_g14 [label="MLP1 L15\nGPU 14\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l15_g14 [label="MLP2 L15\nGPU 14\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l15_g14 [label="LayerNorm L15\nGPU 14" fillcolor=lightgreen shape=rectangle]
    attn_l15_g15 [label="Attention L15\nGPU 15\nQKV Proj+Attn+Output" fillcolor=lightgreen shape=rectangle]
    mlp1_l15_g15 [label="MLP1 L15\nGPU 15\nColParallel\n16384->8192" fillcolor=lightgreen shape=rectangle]
    mlp2_l15_g15 [label="MLP2 L15\nGPU 15\nRowParallel\n8192->16384" fillcolor=lightgreen shape=rectangle]
    norm_l15_g15 [label="LayerNorm L15\nGPU 15" fillcolor=lightgreen shape=rectangle]
    split_tp_l15 -> attn_l15_g8
    attn_l15_g8 -> ar_attn_l15
    ar_attn_l15 -> mlp1_l15_g8
    mlp1_l15_g8 -> mlp2_l15_g8
    mlp2_l15_g8 -> ar_mlp_l15
    ar_mlp_l15 -> norm_l15_g8
    split_tp_l15 -> attn_l15_g9
    attn_l15_g9 -> ar_attn_l15
    ar_attn_l15 -> mlp1_l15_g9
    mlp1_l15_g9 -> mlp2_l15_g9
    mlp2_l15_g9 -> ar_mlp_l15
    ar_mlp_l15 -> norm_l15_g9
    split_tp_l15 -> attn_l15_g10
    attn_l15_g10 -> ar_attn_l15
    ar_attn_l15 -> mlp1_l15_g10
    mlp1_l15_g10 -> mlp2_l15_g10
    mlp2_l15_g10 -> ar_mlp_l15
    ar_mlp_l15 -> norm_l15_g10
    split_tp_l15 -> attn_l15_g11
    attn_l15_g11 -> ar_attn_l15
    ar_attn_l15 -> mlp1_l15_g11
    mlp1_l15_g11 -> mlp2_l15_g11
    mlp2_l15_g11 -> ar_mlp_l15
    ar_mlp_l15 -> norm_l15_g11
    split_tp_l15 -> attn_l15_g12
    attn_l15_g12 -> ar_attn_l15
    ar_attn_l15 -> mlp1_l15_g12
    mlp1_l15_g12 -> mlp2_l15_g12
    mlp2_l15_g12 -> ar_mlp_l15
    ar_mlp_l15 -> norm_l15_g12
    split_tp_l15 -> attn_l15_g13
    attn_l15_g13 -> ar_attn_l15
    ar_attn_l15 -> mlp1_l15_g13
    mlp1_l15_g13 -> mlp2_l15_g13
    mlp2_l15_g13 -> ar_mlp_l15
    ar_mlp_l15 -> norm_l15_g13
    split_tp_l15 -> attn_l15_g14
    attn_l15_g14 -> ar_attn_l15
    ar_attn_l15 -> mlp1_l15_g14
    mlp1_l15_g14 -> mlp2_l15_g14
    mlp2_l15_g14 -> ar_mlp_l15
    ar_mlp_l15 -> norm_l15_g14
    split_tp_l15 -> attn_l15_g15
    attn_l15_g15 -> ar_attn_l15
    ar_attn_l15 -> mlp1_l15_g15
    mlp1_l15_g15 -> mlp2_l15_g15
    mlp2_l15_g15 -> ar_mlp_l15
    ar_mlp_l15 -> norm_l15_g15
    norm_l0_g0 -> split_tp_l1
    norm_l0_g1 -> split_tp_l1
    norm_l0_g2 -> split_tp_l1
    norm_l0_g3 -> split_tp_l1
    norm_l0_g4 -> split_tp_l1
    norm_l0_g5 -> split_tp_l1
    norm_l0_g6 -> split_tp_l1
    norm_l0_g7 -> split_tp_l1
    norm_l1_g0 -> split_tp_l2
    norm_l1_g1 -> split_tp_l2
    norm_l1_g2 -> split_tp_l2
    norm_l1_g3 -> split_tp_l2
    norm_l1_g4 -> split_tp_l2
    norm_l1_g5 -> split_tp_l2
    norm_l1_g6 -> split_tp_l2
    norm_l1_g7 -> split_tp_l2
    norm_l2_g0 -> split_tp_l3
    norm_l2_g1 -> split_tp_l3
    norm_l2_g2 -> split_tp_l3
    norm_l2_g3 -> split_tp_l3
    norm_l2_g4 -> split_tp_l3
    norm_l2_g5 -> split_tp_l3
    norm_l2_g6 -> split_tp_l3
    norm_l2_g7 -> split_tp_l3
    norm_l3_g0 -> split_tp_l4
    norm_l3_g1 -> split_tp_l4
    norm_l3_g2 -> split_tp_l4
    norm_l3_g3 -> split_tp_l4
    norm_l3_g4 -> split_tp_l4
    norm_l3_g5 -> split_tp_l4
    norm_l3_g6 -> split_tp_l4
    norm_l3_g7 -> split_tp_l4
    norm_l4_g0 -> split_tp_l5
    norm_l4_g1 -> split_tp_l5
    norm_l4_g2 -> split_tp_l5
    norm_l4_g3 -> split_tp_l5
    norm_l4_g4 -> split_tp_l5
    norm_l4_g5 -> split_tp_l5
    norm_l4_g6 -> split_tp_l5
    norm_l4_g7 -> split_tp_l5
    norm_l5_g0 -> split_tp_l6
    norm_l5_g1 -> split_tp_l6
    norm_l5_g2 -> split_tp_l6
    norm_l5_g3 -> split_tp_l6
    norm_l5_g4 -> split_tp_l6
    norm_l5_g5 -> split_tp_l6
    norm_l5_g6 -> split_tp_l6
    norm_l5_g7 -> split_tp_l6
    norm_l6_g0 -> split_tp_l7
    norm_l6_g1 -> split_tp_l7
    norm_l6_g2 -> split_tp_l7
    norm_l6_g3 -> split_tp_l7
    norm_l6_g4 -> split_tp_l7
    norm_l6_g5 -> split_tp_l7
    norm_l6_g6 -> split_tp_l7
    norm_l6_g7 -> split_tp_l7
    norm_l7_g0 -> split_tp_l8
    norm_l7_g1 -> split_tp_l8
    norm_l7_g2 -> split_tp_l8
    norm_l7_g3 -> split_tp_l8
    norm_l7_g4 -> split_tp_l8
    norm_l7_g5 -> split_tp_l8
    norm_l7_g6 -> split_tp_l8
    norm_l7_g7 -> split_tp_l8
    norm_l8_g8 -> split_tp_l9
    norm_l8_g9 -> split_tp_l9
    norm_l8_g10 -> split_tp_l9
    norm_l8_g11 -> split_tp_l9
    norm_l8_g12 -> split_tp_l9
    norm_l8_g13 -> split_tp_l9
    norm_l8_g14 -> split_tp_l9
    norm_l8_g15 -> split_tp_l9
    norm_l9_g8 -> split_tp_l10
    norm_l9_g9 -> split_tp_l10
    norm_l9_g10 -> split_tp_l10
    norm_l9_g11 -> split_tp_l10
    norm_l9_g12 -> split_tp_l10
    norm_l9_g13 -> split_tp_l10
    norm_l9_g14 -> split_tp_l10
    norm_l9_g15 -> split_tp_l10
    norm_l10_g8 -> split_tp_l11
    norm_l10_g9 -> split_tp_l11
    norm_l10_g10 -> split_tp_l11
    norm_l10_g11 -> split_tp_l11
    norm_l10_g12 -> split_tp_l11
    norm_l10_g13 -> split_tp_l11
    norm_l10_g14 -> split_tp_l11
    norm_l10_g15 -> split_tp_l11
    norm_l11_g8 -> split_tp_l12
    norm_l11_g9 -> split_tp_l12
    norm_l11_g10 -> split_tp_l12
    norm_l11_g11 -> split_tp_l12
    norm_l11_g12 -> split_tp_l12
    norm_l11_g13 -> split_tp_l12
    norm_l11_g14 -> split_tp_l12
    norm_l11_g15 -> split_tp_l12
    norm_l12_g8 -> split_tp_l13
    norm_l12_g9 -> split_tp_l13
    norm_l12_g10 -> split_tp_l13
    norm_l12_g11 -> split_tp_l13
    norm_l12_g12 -> split_tp_l13
    norm_l12_g13 -> split_tp_l13
    norm_l12_g14 -> split_tp_l13
    norm_l12_g15 -> split_tp_l13
    norm_l13_g8 -> split_tp_l14
    norm_l13_g9 -> split_tp_l14
    norm_l13_g10 -> split_tp_l14
    norm_l13_g11 -> split_tp_l14
    norm_l13_g12 -> split_tp_l14
    norm_l13_g13 -> split_tp_l14
    norm_l13_g14 -> split_tp_l14
    norm_l13_g15 -> split_tp_l14
    norm_l14_g8 -> split_tp_l15
    norm_l14_g9 -> split_tp_l15
    norm_l14_g10 -> split_tp_l15
    norm_l14_g11 -> split_tp_l15
    norm_l14_g12 -> split_tp_l15
    norm_l14_g13 -> split_tp_l15
    norm_l14_g14 -> split_tp_l15
    norm_l14_g15 -> split_tp_l15
    norm_l15_g8 -> output
    norm_l15_g9 -> output
    norm_l15_g10 -> output
    norm_l15_g11 -> output
    norm_l15_g12 -> output
    norm_l15_g13 -> output
    norm_l15_g14 -> output
    norm_l15_g15 -> output
    
    // Output node
    output [label="Output\nBatch:128, Seq:10000\nDim:4096" fillcolor=lightcoral shape=ellipse]
    
    // Input connections
    input -> split_tp_l0
}
