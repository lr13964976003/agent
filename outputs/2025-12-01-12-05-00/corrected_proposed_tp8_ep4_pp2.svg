<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Corrected_Proposed_TP8_EP4_PP2 Pages: 1 -->
<svg width="6200pt" height="1481pt"
 viewBox="0.00 0.00 6200.00 1480.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1476.6)">
<title>Corrected_Proposed_TP8_EP4_PP2</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1476.6 6196,-1476.6 6196,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightgreen" stroke="black" cx="2669.5" cy="-1431.6" rx="161.44" ry="28.98"/>
<text text-anchor="middle" x="2669.5" y="-1440.1" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="2669.5" y="-1429.1" font-family="Arial" font-size="10.00">[batch_size=128, seq_len=1024, d_model=1024]</text>
<text text-anchor="middle" x="2669.5" y="-1418.1" font-family="Arial" font-size="10.00">GPU: All</text>
</g>
<!-- layer_0_input_opt -->
<g id="node6" class="node">
<title>layer_0_input_opt</title>
<polygon fill="yellow" stroke="black" points="2334.23,-1353.6 1757.21,-1353.6 1608.77,-1271.6 2185.79,-1271.6 2334.23,-1353.6"/>
<text text-anchor="middle" x="1971.5" y="-1321.1" font-family="Arial" font-size="10.00">Optimized Input Split</text>
<text text-anchor="middle" x="1971.5" y="-1310.1" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=128]</text>
<text text-anchor="middle" x="1971.5" y="-1299.1" font-family="Arial" font-size="10.00">GPU: Per TP group</text>
</g>
<!-- input&#45;&gt;layer_0_input_opt -->
<g id="edge1" class="edge">
<title>input&#45;&gt;layer_0_input_opt</title>
<path fill="none" stroke="black" d="M2520.14,-1420.67C2520.14,-1395 2520.14,-1333 2520.14,-1333 2520.14,-1333 2306.99,-1333 2306.99,-1333"/>
<polygon fill="black" stroke="black" points="2306.99,-1329.5 2296.99,-1333 2306.99,-1336.5 2306.99,-1329.5"/>
</g>
<!-- layer_0_add_norm1_opt -->
<g id="node32" class="node">
<title>layer_0_add_norm1_opt</title>
<polygon fill="lightgreen" stroke="black" points="2847,-890.06 2492,-890.06 2492,-849.06 2847,-849.06 2847,-890.06"/>
<text text-anchor="middle" x="2669.5" y="-878.06" font-family="Arial" font-size="10.00">Fused Add+Residual+Norm</text>
<text text-anchor="middle" x="2669.5" y="-867.06" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="2669.5" y="-856.06" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
</g>
<!-- input&#45;&gt;layer_0_add_norm1_opt -->
<g id="edge35" class="edge">
<title>input&#45;&gt;layer_0_add_norm1_opt</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2554,-1411.26C2554,-1411.26 2554,-900.16 2554,-900.16"/>
<polygon fill="black" stroke="black" points="2557.5,-900.16 2554,-890.16 2550.5,-900.16 2557.5,-900.16"/>
<text text-anchor="middle" x="3396.5" y="-1132.4" font-family="Times,serif" font-size="14.00">residual</text>
</g>
<!-- output -->
<g id="node2" class="node">
<title>output</title>
<ellipse fill="lightgreen" stroke="black" cx="177.5" cy="-28.99" rx="161.44" ry="28.98"/>
<text text-anchor="middle" x="177.5" y="-37.49" font-family="Arial" font-size="10.00">Output</text>
<text text-anchor="middle" x="177.5" y="-26.49" font-family="Arial" font-size="10.00">[batch_size=128, seq_len=1024, d_model=1024]</text>
<text text-anchor="middle" x="177.5" y="-15.49" font-family="Arial" font-size="10.00">GPU: All</text>
</g>
<!-- comm_tp_allreduce -->
<g id="node3" class="node">
<title>comm_tp_allreduce</title>
<ellipse fill="lightgray" stroke="black" cx="2934.5" cy="-1431.6" rx="86.03" ry="28.98"/>
<text text-anchor="middle" x="2934.5" y="-1440.1" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="2934.5" y="-1429.1" font-family="Arial" font-size="10.00">Optimized ring algorithm</text>
<text text-anchor="middle" x="2934.5" y="-1418.1" font-family="Arial" font-size="10.00">GPU: Per TP group</text>
</g>
<!-- comm_ep_hierarchical -->
<g id="node4" class="node">
<title>comm_ep_hierarchical</title>
<ellipse fill="lightgray" stroke="black" cx="3126.5" cy="-1431.6" rx="87.86" ry="28.98"/>
<text text-anchor="middle" x="3126.5" y="-1440.1" font-family="Arial" font-size="10.00">EP Hierarchical All&#45;to&#45;All</text>
<text text-anchor="middle" x="3126.5" y="-1429.1" font-family="Arial" font-size="10.00">NVLink + InfiniBand</text>
<text text-anchor="middle" x="3126.5" y="-1418.1" font-family="Arial" font-size="10.00">GPU: Per EP group</text>
</g>
<!-- comm_pp_async -->
<g id="node5" class="node">
<title>comm_pp_async</title>
<polygon fill="orange" stroke="black" points="3363.5,-1472.6 3232.5,-1431.6 3363.5,-1390.6 3494.5,-1431.6 3363.5,-1472.6"/>
<text text-anchor="middle" x="3363.5" y="-1440.1" font-family="Arial" font-size="10.00">PP Async Communication</text>
<text text-anchor="middle" x="3363.5" y="-1429.1" font-family="Arial" font-size="10.00">Double buffered</text>
<text text-anchor="middle" x="3363.5" y="-1418.1" font-family="Arial" font-size="10.00">GPU: 31→32</text>
</g>
<!-- layer_0_qkv_fused_gpu0 -->
<g id="node7" class="node">
<title>layer_0_qkv_fused_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="2918,-1234.6 2559,-1234.6 2559,-1193.6 2918,-1193.6 2918,-1234.6"/>
<text text-anchor="middle" x="2738.5" y="-1222.6" font-family="Arial" font-size="10.00">Fused QKV</text>
<text text-anchor="middle" x="2738.5" y="-1211.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=128]→[batch=128,seq=1024,heads=2,d_k=64]</text>
<text text-anchor="middle" x="2738.5" y="-1200.6" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- layer_0_input_opt&#45;&gt;layer_0_qkv_fused_gpu0 -->
<g id="edge2" class="edge">
<title>layer_0_input_opt&#45;&gt;layer_0_qkv_fused_gpu0</title>
<path fill="none" stroke="black" d="M2222.72,-1292C2431.6,-1292 2694.86,-1292 2694.86,-1292 2694.86,-1292 2694.86,-1244.98 2694.86,-1244.98"/>
<polygon fill="black" stroke="black" points="2698.36,-1244.98 2694.86,-1234.98 2691.36,-1244.98 2698.36,-1244.98"/>
</g>
<!-- layer_0_qkv_fused_gpu1 -->
<g id="node8" class="node">
<title>layer_0_qkv_fused_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="3304,-1234.6 2945,-1234.6 2945,-1193.6 3304,-1193.6 3304,-1234.6"/>
<text text-anchor="middle" x="3124.5" y="-1222.6" font-family="Arial" font-size="10.00">Fused QKV</text>
<text text-anchor="middle" x="3124.5" y="-1211.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=128]→[batch=128,seq=1024,heads=2,d_k=64]</text>
<text text-anchor="middle" x="3124.5" y="-1200.6" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- layer_0_input_opt&#45;&gt;layer_0_qkv_fused_gpu1 -->
<g id="edge3" class="edge">
<title>layer_0_input_opt&#45;&gt;layer_0_qkv_fused_gpu1</title>
<path fill="none" stroke="black" d="M2258.95,-1312C2557.95,-1312 2982.88,-1312 2982.88,-1312 2982.88,-1312 2982.88,-1244.86 2982.88,-1244.86"/>
<polygon fill="black" stroke="black" points="2986.38,-1244.86 2982.88,-1234.86 2979.38,-1244.86 2986.38,-1244.86"/>
</g>
<!-- layer_0_qkv_fused_gpu2 -->
<g id="node9" class="node">
<title>layer_0_qkv_fused_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="620,-1234.6 261,-1234.6 261,-1193.6 620,-1193.6 620,-1234.6"/>
<text text-anchor="middle" x="440.5" y="-1222.6" font-family="Arial" font-size="10.00">Fused QKV</text>
<text text-anchor="middle" x="440.5" y="-1211.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=128]→[batch=128,seq=1024,heads=2,d_k=64]</text>
<text text-anchor="middle" x="440.5" y="-1200.6" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- layer_0_input_opt&#45;&gt;layer_0_qkv_fused_gpu2 -->
<g id="edge4" class="edge">
<title>layer_0_input_opt&#45;&gt;layer_0_qkv_fused_gpu2</title>
<path fill="none" stroke="black" d="M1719.54,-1333C1284.95,-1333 440.5,-1333 440.5,-1333 440.5,-1333 440.5,-1244.81 440.5,-1244.81"/>
<polygon fill="black" stroke="black" points="444,-1244.81 440.5,-1234.81 437,-1244.81 444,-1244.81"/>
</g>
<!-- layer_0_qkv_fused_gpu3 -->
<g id="node10" class="node">
<title>layer_0_qkv_fused_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="1004,-1234.6 645,-1234.6 645,-1193.6 1004,-1193.6 1004,-1234.6"/>
<text text-anchor="middle" x="824.5" y="-1222.6" font-family="Arial" font-size="10.00">Fused QKV</text>
<text text-anchor="middle" x="824.5" y="-1211.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=128]→[batch=128,seq=1024,heads=2,d_k=64]</text>
<text text-anchor="middle" x="824.5" y="-1200.6" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- layer_0_input_opt&#45;&gt;layer_0_qkv_fused_gpu3 -->
<g id="edge5" class="edge">
<title>layer_0_input_opt&#45;&gt;layer_0_qkv_fused_gpu3</title>
<path fill="none" stroke="black" d="M1681.69,-1312C1341.9,-1312 824.5,-1312 824.5,-1312 824.5,-1312 824.5,-1244.86 824.5,-1244.86"/>
<polygon fill="black" stroke="black" points="828,-1244.86 824.5,-1234.86 821,-1244.86 828,-1244.86"/>
</g>
<!-- layer_0_qkv_fused_gpu4 -->
<g id="node11" class="node">
<title>layer_0_qkv_fused_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1384,-1234.6 1025,-1234.6 1025,-1193.6 1384,-1193.6 1384,-1234.6"/>
<text text-anchor="middle" x="1204.5" y="-1222.6" font-family="Arial" font-size="10.00">Fused QKV</text>
<text text-anchor="middle" x="1204.5" y="-1211.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=128]→[batch=128,seq=1024,heads=2,d_k=64]</text>
<text text-anchor="middle" x="1204.5" y="-1200.6" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- layer_0_input_opt&#45;&gt;layer_0_qkv_fused_gpu4 -->
<g id="edge6" class="edge">
<title>layer_0_input_opt&#45;&gt;layer_0_qkv_fused_gpu4</title>
<path fill="none" stroke="black" d="M1645.67,-1292C1436.76,-1292 1204.5,-1292 1204.5,-1292 1204.5,-1292 1204.5,-1244.98 1204.5,-1244.98"/>
<polygon fill="black" stroke="black" points="1208,-1244.98 1204.5,-1234.98 1201,-1244.98 1208,-1244.98"/>
</g>
<!-- layer_0_qkv_fused_gpu5 -->
<g id="node12" class="node">
<title>layer_0_qkv_fused_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1767,-1234.6 1408,-1234.6 1408,-1193.6 1767,-1193.6 1767,-1234.6"/>
<text text-anchor="middle" x="1587.5" y="-1222.6" font-family="Arial" font-size="10.00">Fused QKV</text>
<text text-anchor="middle" x="1587.5" y="-1211.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=128]→[batch=128,seq=1024,heads=2,d_k=64]</text>
<text text-anchor="middle" x="1587.5" y="-1200.6" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- layer_0_input_opt&#45;&gt;layer_0_qkv_fused_gpu5 -->
<g id="edge7" class="edge">
<title>layer_0_input_opt&#45;&gt;layer_0_qkv_fused_gpu5</title>
<path fill="none" stroke="black" d="M1687.82,-1271.4C1687.82,-1271.4 1687.82,-1244.72 1687.82,-1244.72"/>
<polygon fill="black" stroke="black" points="1691.32,-1244.72 1687.82,-1234.72 1684.32,-1244.72 1691.32,-1244.72"/>
</g>
<!-- layer_0_qkv_fused_gpu6 -->
<g id="node13" class="node">
<title>layer_0_qkv_fused_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="2151,-1234.6 1792,-1234.6 1792,-1193.6 2151,-1193.6 2151,-1234.6"/>
<text text-anchor="middle" x="1971.5" y="-1222.6" font-family="Arial" font-size="10.00">Fused QKV</text>
<text text-anchor="middle" x="1971.5" y="-1211.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=128]→[batch=128,seq=1024,heads=2,d_k=64]</text>
<text text-anchor="middle" x="1971.5" y="-1200.6" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- layer_0_input_opt&#45;&gt;layer_0_qkv_fused_gpu6 -->
<g id="edge8" class="edge">
<title>layer_0_input_opt&#45;&gt;layer_0_qkv_fused_gpu6</title>
<path fill="none" stroke="black" d="M1971.5,-1271.4C1971.5,-1271.4 1971.5,-1244.72 1971.5,-1244.72"/>
<polygon fill="black" stroke="black" points="1975,-1244.72 1971.5,-1234.72 1968,-1244.72 1975,-1244.72"/>
</g>
<!-- layer_0_qkv_fused_gpu7 -->
<g id="node14" class="node">
<title>layer_0_qkv_fused_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="2532,-1234.6 2173,-1234.6 2173,-1193.6 2532,-1193.6 2532,-1234.6"/>
<text text-anchor="middle" x="2352.5" y="-1222.6" font-family="Arial" font-size="10.00">Fused QKV</text>
<text text-anchor="middle" x="2352.5" y="-1211.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=128]→[batch=128,seq=1024,heads=2,d_k=64]</text>
<text text-anchor="middle" x="2352.5" y="-1200.6" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- layer_0_input_opt&#45;&gt;layer_0_qkv_fused_gpu7 -->
<g id="edge9" class="edge">
<title>layer_0_input_opt&#45;&gt;layer_0_qkv_fused_gpu7</title>
<path fill="none" stroke="black" d="M2253.68,-1308.86C2253.68,-1308.86 2253.68,-1244.95 2253.68,-1244.95"/>
<polygon fill="black" stroke="black" points="2257.18,-1244.95 2253.68,-1234.95 2250.18,-1244.95 2257.18,-1244.95"/>
</g>
<!-- layer_0_flash_attn_gpu0 -->
<g id="node15" class="node">
<title>layer_0_flash_attn_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="2940,-1156.6 2567,-1156.6 2567,-1115.6 2940,-1115.6 2940,-1156.6"/>
<text text-anchor="middle" x="2753.5" y="-1144.6" font-family="Arial" font-size="10.00">Flash Attention</text>
<text text-anchor="middle" x="2753.5" y="-1133.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,heads=2,d_k=64]→[batch=128,seq=1024,heads=2,d_k=64]</text>
<text text-anchor="middle" x="2753.5" y="-1122.6" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- layer_0_qkv_fused_gpu0&#45;&gt;layer_0_flash_attn_gpu0 -->
<g id="edge10" class="edge">
<title>layer_0_qkv_fused_gpu0&#45;&gt;layer_0_flash_attn_gpu0</title>
<path fill="none" stroke="black" d="M2742.5,-1193.2C2742.5,-1193.2 2742.5,-1166.79 2742.5,-1166.79"/>
<polygon fill="black" stroke="black" points="2746,-1166.79 2742.5,-1156.79 2739,-1166.79 2746,-1166.79"/>
</g>
<!-- layer_0_flash_attn_gpu1 -->
<g id="node16" class="node">
<title>layer_0_flash_attn_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="3331,-1156.6 2958,-1156.6 2958,-1115.6 3331,-1115.6 3331,-1156.6"/>
<text text-anchor="middle" x="3144.5" y="-1144.6" font-family="Arial" font-size="10.00">Flash Attention</text>
<text text-anchor="middle" x="3144.5" y="-1133.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,heads=2,d_k=64]→[batch=128,seq=1024,heads=2,d_k=64]</text>
<text text-anchor="middle" x="3144.5" y="-1122.6" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- layer_0_qkv_fused_gpu1&#45;&gt;layer_0_flash_attn_gpu1 -->
<g id="edge11" class="edge">
<title>layer_0_qkv_fused_gpu1&#45;&gt;layer_0_flash_attn_gpu1</title>
<path fill="none" stroke="black" d="M3131,-1193.2C3131,-1193.2 3131,-1166.79 3131,-1166.79"/>
<polygon fill="black" stroke="black" points="3134.5,-1166.79 3131,-1156.79 3127.5,-1166.79 3134.5,-1166.79"/>
</g>
<!-- layer_0_flash_attn_gpu2 -->
<g id="node17" class="node">
<title>layer_0_flash_attn_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="594,-1156.6 221,-1156.6 221,-1115.6 594,-1115.6 594,-1156.6"/>
<text text-anchor="middle" x="407.5" y="-1144.6" font-family="Arial" font-size="10.00">Flash Attention</text>
<text text-anchor="middle" x="407.5" y="-1133.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,heads=2,d_k=64]→[batch=128,seq=1024,heads=2,d_k=64]</text>
<text text-anchor="middle" x="407.5" y="-1122.6" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- layer_0_qkv_fused_gpu2&#45;&gt;layer_0_flash_attn_gpu2 -->
<g id="edge12" class="edge">
<title>layer_0_qkv_fused_gpu2&#45;&gt;layer_0_flash_attn_gpu2</title>
<path fill="none" stroke="black" d="M427.5,-1193.2C427.5,-1193.2 427.5,-1166.79 427.5,-1166.79"/>
<polygon fill="black" stroke="black" points="431,-1166.79 427.5,-1156.79 424,-1166.79 431,-1166.79"/>
</g>
<!-- layer_0_flash_attn_gpu3 -->
<g id="node18" class="node">
<title>layer_0_flash_attn_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="985,-1156.6 612,-1156.6 612,-1115.6 985,-1115.6 985,-1156.6"/>
<text text-anchor="middle" x="798.5" y="-1144.6" font-family="Arial" font-size="10.00">Flash Attention</text>
<text text-anchor="middle" x="798.5" y="-1133.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,heads=2,d_k=64]→[batch=128,seq=1024,heads=2,d_k=64]</text>
<text text-anchor="middle" x="798.5" y="-1122.6" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- layer_0_qkv_fused_gpu3&#45;&gt;layer_0_flash_attn_gpu3 -->
<g id="edge13" class="edge">
<title>layer_0_qkv_fused_gpu3&#45;&gt;layer_0_flash_attn_gpu3</title>
<path fill="none" stroke="black" d="M815,-1193.2C815,-1193.2 815,-1166.79 815,-1166.79"/>
<polygon fill="black" stroke="black" points="818.5,-1166.79 815,-1156.79 811.5,-1166.79 818.5,-1166.79"/>
</g>
<!-- layer_0_flash_attn_gpu4 -->
<g id="node19" class="node">
<title>layer_0_flash_attn_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1376,-1156.6 1003,-1156.6 1003,-1115.6 1376,-1115.6 1376,-1156.6"/>
<text text-anchor="middle" x="1189.5" y="-1144.6" font-family="Arial" font-size="10.00">Flash Attention</text>
<text text-anchor="middle" x="1189.5" y="-1133.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,heads=2,d_k=64]→[batch=128,seq=1024,heads=2,d_k=64]</text>
<text text-anchor="middle" x="1189.5" y="-1122.6" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- layer_0_qkv_fused_gpu4&#45;&gt;layer_0_flash_attn_gpu4 -->
<g id="edge14" class="edge">
<title>layer_0_qkv_fused_gpu4&#45;&gt;layer_0_flash_attn_gpu4</title>
<path fill="none" stroke="black" d="M1200.5,-1193.2C1200.5,-1193.2 1200.5,-1166.79 1200.5,-1166.79"/>
<polygon fill="black" stroke="black" points="1204,-1166.79 1200.5,-1156.79 1197,-1166.79 1204,-1166.79"/>
</g>
<!-- layer_0_flash_attn_gpu5 -->
<g id="node20" class="node">
<title>layer_0_flash_attn_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1767,-1156.6 1394,-1156.6 1394,-1115.6 1767,-1115.6 1767,-1156.6"/>
<text text-anchor="middle" x="1580.5" y="-1144.6" font-family="Arial" font-size="10.00">Flash Attention</text>
<text text-anchor="middle" x="1580.5" y="-1133.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,heads=2,d_k=64]→[batch=128,seq=1024,heads=2,d_k=64]</text>
<text text-anchor="middle" x="1580.5" y="-1122.6" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- layer_0_qkv_fused_gpu5&#45;&gt;layer_0_flash_attn_gpu5 -->
<g id="edge15" class="edge">
<title>layer_0_qkv_fused_gpu5&#45;&gt;layer_0_flash_attn_gpu5</title>
<path fill="none" stroke="black" d="M1587.5,-1193.2C1587.5,-1193.2 1587.5,-1166.79 1587.5,-1166.79"/>
<polygon fill="black" stroke="black" points="1591,-1166.79 1587.5,-1156.79 1584,-1166.79 1591,-1166.79"/>
</g>
<!-- layer_0_flash_attn_gpu6 -->
<g id="node21" class="node">
<title>layer_0_flash_attn_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="2158,-1156.6 1785,-1156.6 1785,-1115.6 2158,-1115.6 2158,-1156.6"/>
<text text-anchor="middle" x="1971.5" y="-1144.6" font-family="Arial" font-size="10.00">Flash Attention</text>
<text text-anchor="middle" x="1971.5" y="-1133.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,heads=2,d_k=64]→[batch=128,seq=1024,heads=2,d_k=64]</text>
<text text-anchor="middle" x="1971.5" y="-1122.6" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- layer_0_qkv_fused_gpu6&#45;&gt;layer_0_flash_attn_gpu6 -->
<g id="edge16" class="edge">
<title>layer_0_qkv_fused_gpu6&#45;&gt;layer_0_flash_attn_gpu6</title>
<path fill="none" stroke="black" d="M1971.5,-1193.2C1971.5,-1193.2 1971.5,-1166.79 1971.5,-1166.79"/>
<polygon fill="black" stroke="black" points="1975,-1166.79 1971.5,-1156.79 1968,-1166.79 1975,-1166.79"/>
</g>
<!-- layer_0_flash_attn_gpu7 -->
<g id="node22" class="node">
<title>layer_0_flash_attn_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="2549,-1156.6 2176,-1156.6 2176,-1115.6 2549,-1115.6 2549,-1156.6"/>
<text text-anchor="middle" x="2362.5" y="-1144.6" font-family="Arial" font-size="10.00">Flash Attention</text>
<text text-anchor="middle" x="2362.5" y="-1133.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,heads=2,d_k=64]→[batch=128,seq=1024,heads=2,d_k=64]</text>
<text text-anchor="middle" x="2362.5" y="-1122.6" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- layer_0_qkv_fused_gpu7&#45;&gt;layer_0_flash_attn_gpu7 -->
<g id="edge17" class="edge">
<title>layer_0_qkv_fused_gpu7&#45;&gt;layer_0_flash_attn_gpu7</title>
<path fill="none" stroke="black" d="M2354,-1193.2C2354,-1193.2 2354,-1166.79 2354,-1166.79"/>
<polygon fill="black" stroke="black" points="2357.5,-1166.79 2354,-1156.79 2350.5,-1166.79 2357.5,-1166.79"/>
</g>
<!-- layer_0_proj_opt_gpu0 -->
<g id="node23" class="node">
<title>layer_0_proj_opt_gpu0</title>
<polygon fill="lightgreen" stroke="black" points="2918,-1078.6 2559,-1078.6 2559,-1037.6 2918,-1037.6 2918,-1078.6"/>
<text text-anchor="middle" x="2738.5" y="-1066.6" font-family="Arial" font-size="10.00">Optimized Projection</text>
<text text-anchor="middle" x="2738.5" y="-1055.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,heads=2,d_k=64]→[batch=128,seq=1024,d_model=128]</text>
<text text-anchor="middle" x="2738.5" y="-1044.6" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- layer_0_flash_attn_gpu0&#45;&gt;layer_0_proj_opt_gpu0 -->
<g id="edge18" class="edge">
<title>layer_0_flash_attn_gpu0&#45;&gt;layer_0_proj_opt_gpu0</title>
<path fill="none" stroke="black" d="M2742.5,-1115.2C2742.5,-1115.2 2742.5,-1088.79 2742.5,-1088.79"/>
<polygon fill="black" stroke="black" points="2746,-1088.79 2742.5,-1078.79 2739,-1088.79 2746,-1088.79"/>
</g>
<!-- layer_0_proj_opt_gpu1 -->
<g id="node24" class="node">
<title>layer_0_proj_opt_gpu1</title>
<polygon fill="lightgreen" stroke="black" points="3304,-1078.6 2945,-1078.6 2945,-1037.6 3304,-1037.6 3304,-1078.6"/>
<text text-anchor="middle" x="3124.5" y="-1066.6" font-family="Arial" font-size="10.00">Optimized Projection</text>
<text text-anchor="middle" x="3124.5" y="-1055.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,heads=2,d_k=64]→[batch=128,seq=1024,d_model=128]</text>
<text text-anchor="middle" x="3124.5" y="-1044.6" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- layer_0_flash_attn_gpu1&#45;&gt;layer_0_proj_opt_gpu1 -->
<g id="edge19" class="edge">
<title>layer_0_flash_attn_gpu1&#45;&gt;layer_0_proj_opt_gpu1</title>
<path fill="none" stroke="black" d="M3131,-1115.2C3131,-1115.2 3131,-1088.79 3131,-1088.79"/>
<polygon fill="black" stroke="black" points="3134.5,-1088.79 3131,-1078.79 3127.5,-1088.79 3134.5,-1088.79"/>
</g>
<!-- layer_0_proj_opt_gpu2 -->
<g id="node25" class="node">
<title>layer_0_proj_opt_gpu2</title>
<polygon fill="lightgreen" stroke="black" points="617,-1078.6 258,-1078.6 258,-1037.6 617,-1037.6 617,-1078.6"/>
<text text-anchor="middle" x="437.5" y="-1066.6" font-family="Arial" font-size="10.00">Optimized Projection</text>
<text text-anchor="middle" x="437.5" y="-1055.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,heads=2,d_k=64]→[batch=128,seq=1024,d_model=128]</text>
<text text-anchor="middle" x="437.5" y="-1044.6" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- layer_0_flash_attn_gpu2&#45;&gt;layer_0_proj_opt_gpu2 -->
<g id="edge20" class="edge">
<title>layer_0_flash_attn_gpu2&#45;&gt;layer_0_proj_opt_gpu2</title>
<path fill="none" stroke="black" d="M426,-1115.2C426,-1115.2 426,-1088.79 426,-1088.79"/>
<polygon fill="black" stroke="black" points="429.5,-1088.79 426,-1078.79 422.5,-1088.79 429.5,-1088.79"/>
</g>
<!-- layer_0_proj_opt_gpu3 -->
<g id="node26" class="node">
<title>layer_0_proj_opt_gpu3</title>
<polygon fill="lightgreen" stroke="black" points="1008,-1078.6 649,-1078.6 649,-1037.6 1008,-1037.6 1008,-1078.6"/>
<text text-anchor="middle" x="828.5" y="-1066.6" font-family="Arial" font-size="10.00">Optimized Projection</text>
<text text-anchor="middle" x="828.5" y="-1055.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,heads=2,d_k=64]→[batch=128,seq=1024,d_model=128]</text>
<text text-anchor="middle" x="828.5" y="-1044.6" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- layer_0_flash_attn_gpu3&#45;&gt;layer_0_proj_opt_gpu3 -->
<g id="edge21" class="edge">
<title>layer_0_flash_attn_gpu3&#45;&gt;layer_0_proj_opt_gpu3</title>
<path fill="none" stroke="black" d="M817,-1115.2C817,-1115.2 817,-1088.79 817,-1088.79"/>
<polygon fill="black" stroke="black" points="820.5,-1088.79 817,-1078.79 813.5,-1088.79 820.5,-1088.79"/>
</g>
<!-- layer_0_proj_opt_gpu4 -->
<g id="node27" class="node">
<title>layer_0_proj_opt_gpu4</title>
<polygon fill="lightgreen" stroke="black" points="1392,-1078.6 1033,-1078.6 1033,-1037.6 1392,-1037.6 1392,-1078.6"/>
<text text-anchor="middle" x="1212.5" y="-1066.6" font-family="Arial" font-size="10.00">Optimized Projection</text>
<text text-anchor="middle" x="1212.5" y="-1055.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,heads=2,d_k=64]→[batch=128,seq=1024,d_model=128]</text>
<text text-anchor="middle" x="1212.5" y="-1044.6" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- layer_0_flash_attn_gpu4&#45;&gt;layer_0_proj_opt_gpu4 -->
<g id="edge22" class="edge">
<title>layer_0_flash_attn_gpu4&#45;&gt;layer_0_proj_opt_gpu4</title>
<path fill="none" stroke="black" d="M1204.5,-1115.2C1204.5,-1115.2 1204.5,-1088.79 1204.5,-1088.79"/>
<polygon fill="black" stroke="black" points="1208,-1088.79 1204.5,-1078.79 1201,-1088.79 1208,-1088.79"/>
</g>
<!-- layer_0_proj_opt_gpu5 -->
<g id="node28" class="node">
<title>layer_0_proj_opt_gpu5</title>
<polygon fill="lightgreen" stroke="black" points="1772,-1078.6 1413,-1078.6 1413,-1037.6 1772,-1037.6 1772,-1078.6"/>
<text text-anchor="middle" x="1592.5" y="-1066.6" font-family="Arial" font-size="10.00">Optimized Projection</text>
<text text-anchor="middle" x="1592.5" y="-1055.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,heads=2,d_k=64]→[batch=128,seq=1024,d_model=128]</text>
<text text-anchor="middle" x="1592.5" y="-1044.6" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- layer_0_flash_attn_gpu5&#45;&gt;layer_0_proj_opt_gpu5 -->
<g id="edge23" class="edge">
<title>layer_0_flash_attn_gpu5&#45;&gt;layer_0_proj_opt_gpu5</title>
<path fill="none" stroke="black" d="M1590,-1115.2C1590,-1115.2 1590,-1088.79 1590,-1088.79"/>
<polygon fill="black" stroke="black" points="1593.5,-1088.79 1590,-1078.79 1586.5,-1088.79 1593.5,-1088.79"/>
</g>
<!-- layer_0_proj_opt_gpu6 -->
<g id="node29" class="node">
<title>layer_0_proj_opt_gpu6</title>
<polygon fill="lightgreen" stroke="black" points="2151,-1078.6 1792,-1078.6 1792,-1037.6 2151,-1037.6 2151,-1078.6"/>
<text text-anchor="middle" x="1971.5" y="-1066.6" font-family="Arial" font-size="10.00">Optimized Projection</text>
<text text-anchor="middle" x="1971.5" y="-1055.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,heads=2,d_k=64]→[batch=128,seq=1024,d_model=128]</text>
<text text-anchor="middle" x="1971.5" y="-1044.6" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- layer_0_flash_attn_gpu6&#45;&gt;layer_0_proj_opt_gpu6 -->
<g id="edge24" class="edge">
<title>layer_0_flash_attn_gpu6&#45;&gt;layer_0_proj_opt_gpu6</title>
<path fill="none" stroke="black" d="M1971.5,-1115.2C1971.5,-1115.2 1971.5,-1088.79 1971.5,-1088.79"/>
<polygon fill="black" stroke="black" points="1975,-1088.79 1971.5,-1078.79 1968,-1088.79 1975,-1088.79"/>
</g>
<!-- layer_0_proj_opt_gpu7 -->
<g id="node30" class="node">
<title>layer_0_proj_opt_gpu7</title>
<polygon fill="lightgreen" stroke="black" points="2532,-1078.6 2173,-1078.6 2173,-1037.6 2532,-1037.6 2532,-1078.6"/>
<text text-anchor="middle" x="2352.5" y="-1066.6" font-family="Arial" font-size="10.00">Optimized Projection</text>
<text text-anchor="middle" x="2352.5" y="-1055.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,heads=2,d_k=64]→[batch=128,seq=1024,d_model=128]</text>
<text text-anchor="middle" x="2352.5" y="-1044.6" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- layer_0_flash_attn_gpu7&#45;&gt;layer_0_proj_opt_gpu7 -->
<g id="edge25" class="edge">
<title>layer_0_flash_attn_gpu7&#45;&gt;layer_0_proj_opt_gpu7</title>
<path fill="none" stroke="black" d="M2354,-1115.2C2354,-1115.2 2354,-1088.79 2354,-1088.79"/>
<polygon fill="black" stroke="black" points="2357.5,-1088.79 2354,-1078.79 2350.5,-1088.79 2357.5,-1088.79"/>
</g>
<!-- layer_0_attn_allreduce_opt -->
<g id="node31" class="node">
<title>layer_0_attn_allreduce_opt</title>
<ellipse fill="lightgray" stroke="black" cx="1971.5" cy="-963.83" rx="247.47" ry="36.54"/>
<text text-anchor="middle" x="1971.5" y="-977.83" font-family="Arial" font-size="10.00">Optimized All&#45;Reduce</text>
<text text-anchor="middle" x="1971.5" y="-966.83" font-family="Arial" font-size="10.00">Ring algorithm, 2ms latency</text>
<text text-anchor="middle" x="1971.5" y="-955.83" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=128]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="1971.5" y="-944.83" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
</g>
<!-- layer_0_proj_opt_gpu0&#45;&gt;layer_0_attn_allreduce_opt -->
<g id="edge26" class="edge">
<title>layer_0_proj_opt_gpu0&#45;&gt;layer_0_attn_allreduce_opt</title>
<path fill="none" stroke="black" d="M2703,-1037.31C2703,-1014.77 2703,-982 2703,-982 2703,-982 2197.02,-982 2197.02,-982"/>
<polygon fill="black" stroke="black" points="2197.02,-978.5 2187.02,-982 2197.02,-985.5 2197.02,-978.5"/>
</g>
<!-- layer_0_proj_opt_gpu1&#45;&gt;layer_0_attn_allreduce_opt -->
<g id="edge27" class="edge">
<title>layer_0_proj_opt_gpu1&#45;&gt;layer_0_attn_allreduce_opt</title>
<path fill="none" stroke="black" d="M3124.5,-1037.46C3124.5,-1009.5 3124.5,-963 3124.5,-963 3124.5,-963 2229.2,-963 2229.2,-963"/>
<polygon fill="black" stroke="black" points="2229.2,-959.5 2219.2,-963 2229.2,-966.5 2229.2,-959.5"/>
</g>
<!-- layer_0_proj_opt_gpu2&#45;&gt;layer_0_attn_allreduce_opt -->
<g id="edge28" class="edge">
<title>layer_0_proj_opt_gpu2&#45;&gt;layer_0_attn_allreduce_opt</title>
<path fill="none" stroke="black" d="M606,-1037.36C606,-1004.7 606,-945 606,-945 606,-945 1748.89,-945 1748.89,-945"/>
<polygon fill="black" stroke="black" points="1748.89,-948.5 1758.89,-945 1748.89,-941.5 1748.89,-948.5"/>
</g>
<!-- layer_0_proj_opt_gpu3&#45;&gt;layer_0_attn_allreduce_opt -->
<g id="edge29" class="edge">
<title>layer_0_proj_opt_gpu3&#45;&gt;layer_0_attn_allreduce_opt</title>
<path fill="none" stroke="black" d="M998,-1037.46C998,-1009.5 998,-963 998,-963 998,-963 1713.96,-963 1713.96,-963"/>
<polygon fill="black" stroke="black" points="1713.96,-966.5 1723.96,-963 1713.96,-959.5 1713.96,-966.5"/>
</g>
<!-- layer_0_proj_opt_gpu4&#45;&gt;layer_0_attn_allreduce_opt -->
<g id="edge30" class="edge">
<title>layer_0_proj_opt_gpu4&#45;&gt;layer_0_attn_allreduce_opt</title>
<path fill="none" stroke="black" d="M1376.5,-1037.31C1376.5,-1014.77 1376.5,-982 1376.5,-982 1376.5,-982 1746.27,-982 1746.27,-982"/>
<polygon fill="black" stroke="black" points="1746.27,-985.5 1756.27,-982 1746.27,-978.5 1746.27,-985.5"/>
</g>
<!-- layer_0_proj_opt_gpu5&#45;&gt;layer_0_attn_allreduce_opt -->
<g id="edge31" class="edge">
<title>layer_0_proj_opt_gpu5&#45;&gt;layer_0_attn_allreduce_opt</title>
<path fill="none" stroke="black" d="M1748.01,-1037.18C1748.01,-1037.18 1748.01,-989.72 1748.01,-989.72"/>
<polygon fill="black" stroke="black" points="1751.51,-989.72 1748.01,-979.72 1744.51,-989.72 1751.51,-989.72"/>
</g>
<!-- layer_0_proj_opt_gpu6&#45;&gt;layer_0_attn_allreduce_opt -->
<g id="edge32" class="edge">
<title>layer_0_proj_opt_gpu6&#45;&gt;layer_0_attn_allreduce_opt</title>
<path fill="none" stroke="black" d="M1971.5,-1037.18C1971.5,-1037.18 1971.5,-1010.64 1971.5,-1010.64"/>
<polygon fill="black" stroke="black" points="1975,-1010.64 1971.5,-1000.64 1968,-1010.64 1975,-1010.64"/>
</g>
<!-- layer_0_proj_opt_gpu7&#45;&gt;layer_0_attn_allreduce_opt -->
<g id="edge33" class="edge">
<title>layer_0_proj_opt_gpu7&#45;&gt;layer_0_attn_allreduce_opt</title>
<path fill="none" stroke="black" d="M2195.99,-1037.18C2195.99,-1037.18 2195.99,-989.42 2195.99,-989.42"/>
<polygon fill="black" stroke="black" points="2199.49,-989.42 2195.99,-979.42 2192.49,-989.42 2199.49,-989.42"/>
</g>
<!-- layer_0_attn_allreduce_opt&#45;&gt;layer_0_add_norm1_opt -->
<g id="edge34" class="edge">
<title>layer_0_attn_allreduce_opt&#45;&gt;layer_0_add_norm1_opt</title>
<path fill="none" stroke="black" d="M2184.34,-945C2335.6,-945 2512,-945 2512,-945 2512,-945 2512,-900.18 2512,-900.18"/>
<polygon fill="black" stroke="black" points="2515.5,-900.17 2512,-890.18 2508.5,-900.18 2515.5,-900.17"/>
</g>
<!-- layer_0_gate_opt -->
<g id="node33" class="node">
<title>layer_0_gate_opt</title>
<polygon fill="yellow" stroke="black" points="3363.1,-812.06 2834.01,-812.06 2697.9,-730.06 3226.99,-730.06 3363.1,-812.06"/>
<text text-anchor="middle" x="3030.5" y="-779.56" font-family="Arial" font-size="10.00">Load&#45;Balanced Gate</text>
<text text-anchor="middle" x="3030.5" y="-768.56" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,topk=2]</text>
<text text-anchor="middle" x="3030.5" y="-757.56" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
</g>
<!-- layer_0_add_norm1_opt&#45;&gt;layer_0_gate_opt -->
<g id="edge36" class="edge">
<title>layer_0_add_norm1_opt&#45;&gt;layer_0_gate_opt</title>
<path fill="none" stroke="black" d="M2772.35,-848.67C2772.35,-848.67 2772.35,-785.03 2772.35,-785.03"/>
<polygon fill="black" stroke="black" points="2775.85,-785.03 2772.35,-775.03 2768.85,-785.03 2775.85,-785.03"/>
</g>
<!-- layer_0_ep0_scatter_opt -->
<g id="node34" class="node">
<title>layer_0_ep0_scatter_opt</title>
<ellipse fill="lightgray" stroke="black" cx="3030.5" cy="-642.29" rx="251.05" ry="36.54"/>
<text text-anchor="middle" x="3030.5" y="-656.29" font-family="Arial" font-size="10.00">Hierarchical EP Scatter</text>
<text text-anchor="middle" x="3030.5" y="-645.29" font-family="Arial" font-size="10.00">NVLink优先</text>
<text text-anchor="middle" x="3030.5" y="-634.29" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="3030.5" y="-623.29" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
</g>
<!-- layer_0_add_norm1_opt&#45;&gt;layer_0_ep0_scatter_opt -->
<g id="edge37" class="edge">
<title>layer_0_add_norm1_opt&#45;&gt;layer_0_ep0_scatter_opt</title>
<path fill="none" stroke="black" d="M2594.85,-848.85C2594.85,-797.61 2594.85,-669 2594.85,-669 2594.85,-669 2847.69,-669 2847.69,-669"/>
<polygon fill="black" stroke="black" points="2847.69,-672.5 2857.69,-669 2847.69,-665.5 2847.69,-672.5"/>
</g>
<!-- layer_0_add_norm2_opt -->
<g id="node59" class="node">
<title>layer_0_add_norm2_opt</title>
<polygon fill="lightgreen" stroke="black" points="355,-238.98 0,-238.98 0,-197.98 355,-197.98 355,-238.98"/>
<text text-anchor="middle" x="177.5" y="-226.98" font-family="Arial" font-size="10.00">Fused Add+Residual+Norm</text>
<text text-anchor="middle" x="177.5" y="-215.98" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="177.5" y="-204.98" font-family="Arial" font-size="10.00">GPU: 0&#45;31</text>
</g>
<!-- layer_0_add_norm1_opt&#45;&gt;layer_0_add_norm2_opt -->
<g id="edge76" class="edge">
<title>layer_0_add_norm1_opt&#45;&gt;layer_0_add_norm2_opt</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2491.71,-869C1930.18,-869 231.5,-869 231.5,-869 231.5,-869 231.5,-249.03 231.5,-249.03"/>
<polygon fill="black" stroke="black" points="235,-249.03 231.5,-239.03 228,-249.03 235,-249.03"/>
<text text-anchor="middle" x="194.5" y="-544.32" font-family="Times,serif" font-size="14.00">residual</text>
</g>
<!-- layer_0_gate_opt&#45;&gt;layer_0_ep0_scatter_opt -->
<g id="edge38" class="edge">
<title>layer_0_gate_opt&#45;&gt;layer_0_ep0_scatter_opt</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3030.5,-729.96C3030.5,-729.96 3030.5,-689.08 3030.5,-689.08"/>
<polygon fill="black" stroke="black" points="3034,-689.08 3030.5,-679.08 3027,-689.08 3034,-689.08"/>
<text text-anchor="middle" x="3057" y="-700.86" font-family="Times,serif" font-size="14.00">routing</text>
</g>
<!-- layer_0_exp0_opt_gpu0 -->
<g id="node38" class="node">
<title>layer_0_exp0_opt_gpu0</title>
<polygon fill="lightcoral" stroke="black" points="5819,-568.52 5464,-568.52 5464,-527.52 5819,-527.52 5819,-568.52"/>
<text text-anchor="middle" x="5641.5" y="-556.52" font-family="Arial" font-size="10.00">Expert 0 (Optimized)</text>
<text text-anchor="middle" x="5641.5" y="-545.52" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="5641.5" y="-534.52" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp0_opt_gpu0 -->
<g id="edge39" class="edge">
<title>layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp0_opt_gpu0</title>
<path fill="none" stroke="black" d="M3250.58,-660C3879.82,-660 5641.5,-660 5641.5,-660 5641.5,-660 5641.5,-578.56 5641.5,-578.56"/>
<polygon fill="black" stroke="black" points="5645,-578.56 5641.5,-568.56 5638,-578.56 5645,-578.56"/>
</g>
<!-- layer_0_exp1_opt_gpu0 -->
<g id="node39" class="node">
<title>layer_0_exp1_opt_gpu0</title>
<polygon fill="lightcoral" stroke="black" points="6192,-568.52 5837,-568.52 5837,-527.52 6192,-527.52 6192,-568.52"/>
<text text-anchor="middle" x="6014.5" y="-556.52" font-family="Arial" font-size="10.00">Expert 1 (Optimized)</text>
<text text-anchor="middle" x="6014.5" y="-545.52" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="6014.5" y="-534.52" font-family="Arial" font-size="10.00">GPU: 0</text>
</g>
<!-- layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp1_opt_gpu0 -->
<g id="edge40" class="edge">
<title>layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp1_opt_gpu0</title>
<path fill="none" stroke="black" d="M3203.28,-669C3839.45,-669 6014.5,-669 6014.5,-669 6014.5,-669 6014.5,-578.54 6014.5,-578.54"/>
<polygon fill="black" stroke="black" points="6018,-578.54 6014.5,-568.54 6011,-578.54 6018,-578.54"/>
</g>
<!-- layer_0_exp2_opt_gpu1 -->
<g id="node40" class="node">
<title>layer_0_exp2_opt_gpu1</title>
<polygon fill="lightcoral" stroke="black" points="597,-568.52 242,-568.52 242,-527.52 597,-527.52 597,-568.52"/>
<text text-anchor="middle" x="419.5" y="-556.52" font-family="Arial" font-size="10.00">Expert 2 (Optimized)</text>
<text text-anchor="middle" x="419.5" y="-545.52" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="419.5" y="-534.52" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp2_opt_gpu1 -->
<g id="edge41" class="edge">
<title>layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp2_opt_gpu1</title>
<path fill="none" stroke="black" d="M2810.25,-660C2182.22,-660 427.5,-660 427.5,-660 427.5,-660 427.5,-578.56 427.5,-578.56"/>
<polygon fill="black" stroke="black" points="431,-578.56 427.5,-568.56 424,-578.56 431,-578.56"/>
</g>
<!-- layer_0_exp3_opt_gpu1 -->
<g id="node41" class="node">
<title>layer_0_exp3_opt_gpu1</title>
<polygon fill="lightcoral" stroke="black" points="970,-568.52 615,-568.52 615,-527.52 970,-527.52 970,-568.52"/>
<text text-anchor="middle" x="792.5" y="-556.52" font-family="Arial" font-size="10.00">Expert 3 (Optimized)</text>
<text text-anchor="middle" x="792.5" y="-545.52" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="792.5" y="-534.52" font-family="Arial" font-size="10.00">GPU: 1</text>
</g>
<!-- layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp3_opt_gpu1 -->
<g id="edge42" class="edge">
<title>layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp3_opt_gpu1</title>
<path fill="none" stroke="black" d="M2786.46,-651C2209.51,-651 809.5,-651 809.5,-651 809.5,-651 809.5,-578.86 809.5,-578.86"/>
<polygon fill="black" stroke="black" points="813,-578.86 809.5,-568.86 806,-578.86 813,-578.86"/>
</g>
<!-- layer_0_exp4_opt_gpu2 -->
<g id="node42" class="node">
<title>layer_0_exp4_opt_gpu2</title>
<polygon fill="lightcoral" stroke="black" points="1343,-568.52 988,-568.52 988,-527.52 1343,-527.52 1343,-568.52"/>
<text text-anchor="middle" x="1165.5" y="-556.52" font-family="Arial" font-size="10.00">Expert 4 (Optimized)</text>
<text text-anchor="middle" x="1165.5" y="-545.52" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="1165.5" y="-534.52" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp4_opt_gpu2 -->
<g id="edge43" class="edge">
<title>layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp4_opt_gpu2</title>
<path fill="none" stroke="black" d="M2779.13,-642C2274.94,-642 1188,-642 1188,-642 1188,-642 1188,-578.88 1188,-578.88"/>
<polygon fill="black" stroke="black" points="1191.5,-578.88 1188,-568.88 1184.5,-578.88 1191.5,-578.88"/>
</g>
<!-- layer_0_exp5_opt_gpu2 -->
<g id="node43" class="node">
<title>layer_0_exp5_opt_gpu2</title>
<polygon fill="lightcoral" stroke="black" points="1716,-568.52 1361,-568.52 1361,-527.52 1716,-527.52 1716,-568.52"/>
<text text-anchor="middle" x="1538.5" y="-556.52" font-family="Arial" font-size="10.00">Expert 5 (Optimized)</text>
<text text-anchor="middle" x="1538.5" y="-545.52" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="1538.5" y="-534.52" font-family="Arial" font-size="10.00">GPU: 2</text>
</g>
<!-- layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp5_opt_gpu2 -->
<g id="edge44" class="edge">
<title>layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp5_opt_gpu2</title>
<path fill="none" stroke="black" d="M2787.6,-633C2370.97,-633 1564.5,-633 1564.5,-633 1564.5,-633 1564.5,-578.59 1564.5,-578.59"/>
<polygon fill="black" stroke="black" points="1568,-578.59 1564.5,-568.59 1561,-578.59 1568,-578.59"/>
</g>
<!-- layer_0_exp6_opt_gpu3 -->
<g id="node44" class="node">
<title>layer_0_exp6_opt_gpu3</title>
<polygon fill="lightcoral" stroke="black" points="2089,-568.52 1734,-568.52 1734,-527.52 2089,-527.52 2089,-568.52"/>
<text text-anchor="middle" x="1911.5" y="-556.52" font-family="Arial" font-size="10.00">Expert 6 (Optimized)</text>
<text text-anchor="middle" x="1911.5" y="-545.52" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="1911.5" y="-534.52" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp6_opt_gpu3 -->
<g id="edge45" class="edge">
<title>layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp6_opt_gpu3</title>
<path fill="none" stroke="black" d="M2816.73,-623C2491.94,-623 1911.5,-623 1911.5,-623 1911.5,-623 1911.5,-578.91 1911.5,-578.91"/>
<polygon fill="black" stroke="black" points="1915,-578.91 1911.5,-568.91 1908,-578.91 1915,-578.91"/>
</g>
<!-- layer_0_exp7_opt_gpu3 -->
<g id="node45" class="node">
<title>layer_0_exp7_opt_gpu3</title>
<polygon fill="lightcoral" stroke="black" points="2462,-568.52 2107,-568.52 2107,-527.52 2462,-527.52 2462,-568.52"/>
<text text-anchor="middle" x="2284.5" y="-556.52" font-family="Arial" font-size="10.00">Expert 7 (Optimized)</text>
<text text-anchor="middle" x="2284.5" y="-545.52" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="2284.5" y="-534.52" font-family="Arial" font-size="10.00">GPU: 3</text>
</g>
<!-- layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp7_opt_gpu3 -->
<g id="edge46" class="edge">
<title>layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp7_opt_gpu3</title>
<path fill="none" stroke="black" d="M2870.03,-614C2666.17,-614 2340.49,-614 2340.49,-614 2340.49,-614 2340.49,-578.54 2340.49,-578.54"/>
<polygon fill="black" stroke="black" points="2343.99,-578.54 2340.49,-568.54 2336.99,-578.54 2343.99,-578.54"/>
</g>
<!-- layer_0_exp8_opt_gpu4 -->
<g id="node46" class="node">
<title>layer_0_exp8_opt_gpu4</title>
<polygon fill="lightcoral" stroke="black" points="2835,-568.52 2480,-568.52 2480,-527.52 2835,-527.52 2835,-568.52"/>
<text text-anchor="middle" x="2657.5" y="-556.52" font-family="Arial" font-size="10.00">Expert 8 (Optimized)</text>
<text text-anchor="middle" x="2657.5" y="-545.52" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="2657.5" y="-534.52" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp8_opt_gpu4 -->
<g id="edge47" class="edge">
<title>layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp8_opt_gpu4</title>
<path fill="none" stroke="black" d="M2807.24,-625.44C2807.24,-625.44 2807.24,-578.68 2807.24,-578.68"/>
<polygon fill="black" stroke="black" points="2810.74,-578.68 2807.24,-568.68 2803.74,-578.68 2810.74,-578.68"/>
</g>
<!-- layer_0_exp9_opt_gpu4 -->
<g id="node47" class="node">
<title>layer_0_exp9_opt_gpu4</title>
<polygon fill="lightcoral" stroke="black" points="3208,-568.52 2853,-568.52 2853,-527.52 3208,-527.52 3208,-568.52"/>
<text text-anchor="middle" x="3030.5" y="-556.52" font-family="Arial" font-size="10.00">Expert 9 (Optimized)</text>
<text text-anchor="middle" x="3030.5" y="-545.52" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="3030.5" y="-534.52" font-family="Arial" font-size="10.00">GPU: 4</text>
</g>
<!-- layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp9_opt_gpu4 -->
<g id="edge48" class="edge">
<title>layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp9_opt_gpu4</title>
<path fill="none" stroke="black" d="M3030.5,-605.3C3030.5,-605.3 3030.5,-578.6 3030.5,-578.6"/>
<polygon fill="black" stroke="black" points="3034,-578.6 3030.5,-568.6 3027,-578.6 3034,-578.6"/>
</g>
<!-- layer_0_exp10_opt_gpu5 -->
<g id="node48" class="node">
<title>layer_0_exp10_opt_gpu5</title>
<polygon fill="lightcoral" stroke="black" points="3581,-568.52 3226,-568.52 3226,-527.52 3581,-527.52 3581,-568.52"/>
<text text-anchor="middle" x="3403.5" y="-556.52" font-family="Arial" font-size="10.00">Expert 10 (Optimized)</text>
<text text-anchor="middle" x="3403.5" y="-545.52" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="3403.5" y="-534.52" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp10_opt_gpu5 -->
<g id="edge49" class="edge">
<title>layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp10_opt_gpu5</title>
<path fill="none" stroke="black" d="M3253.76,-625.44C3253.76,-625.44 3253.76,-578.68 3253.76,-578.68"/>
<polygon fill="black" stroke="black" points="3257.26,-578.68 3253.76,-568.68 3250.26,-578.68 3257.26,-578.68"/>
</g>
<!-- layer_0_exp11_opt_gpu5 -->
<g id="node49" class="node">
<title>layer_0_exp11_opt_gpu5</title>
<polygon fill="lightcoral" stroke="black" points="3954,-568.52 3599,-568.52 3599,-527.52 3954,-527.52 3954,-568.52"/>
<text text-anchor="middle" x="3776.5" y="-556.52" font-family="Arial" font-size="10.00">Expert 11 (Optimized)</text>
<text text-anchor="middle" x="3776.5" y="-545.52" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="3776.5" y="-534.52" font-family="Arial" font-size="10.00">GPU: 5</text>
</g>
<!-- layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp11_opt_gpu5 -->
<g id="edge50" class="edge">
<title>layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp11_opt_gpu5</title>
<path fill="none" stroke="black" d="M3190.99,-614C3410.25,-614 3776.5,-614 3776.5,-614 3776.5,-614 3776.5,-578.54 3776.5,-578.54"/>
<polygon fill="black" stroke="black" points="3780,-578.54 3776.5,-568.54 3773,-578.54 3780,-578.54"/>
</g>
<!-- layer_0_exp12_opt_gpu6 -->
<g id="node50" class="node">
<title>layer_0_exp12_opt_gpu6</title>
<polygon fill="lightcoral" stroke="black" points="4327,-568.52 3972,-568.52 3972,-527.52 4327,-527.52 4327,-568.52"/>
<text text-anchor="middle" x="4149.5" y="-556.52" font-family="Arial" font-size="10.00">Expert 12 (Optimized)</text>
<text text-anchor="middle" x="4149.5" y="-545.52" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="4149.5" y="-534.52" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp12_opt_gpu6 -->
<g id="edge51" class="edge">
<title>layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp12_opt_gpu6</title>
<path fill="none" stroke="black" d="M3244.47,-623C3528.13,-623 3993.26,-623 3993.26,-623 3993.26,-623 3993.26,-578.91 3993.26,-578.91"/>
<polygon fill="black" stroke="black" points="3996.76,-578.91 3993.26,-568.91 3989.76,-578.91 3996.76,-578.91"/>
</g>
<!-- layer_0_exp13_opt_gpu6 -->
<g id="node51" class="node">
<title>layer_0_exp13_opt_gpu6</title>
<polygon fill="lightcoral" stroke="black" points="4700,-568.52 4345,-568.52 4345,-527.52 4700,-527.52 4700,-568.52"/>
<text text-anchor="middle" x="4522.5" y="-556.52" font-family="Arial" font-size="10.00">Expert 13 (Optimized)</text>
<text text-anchor="middle" x="4522.5" y="-545.52" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="4522.5" y="-534.52" font-family="Arial" font-size="10.00">GPU: 6</text>
</g>
<!-- layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp13_opt_gpu6 -->
<g id="edge52" class="edge">
<title>layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp13_opt_gpu6</title>
<path fill="none" stroke="black" d="M3273.56,-633C3676.7,-633 4439.76,-633 4439.76,-633 4439.76,-633 4439.76,-578.59 4439.76,-578.59"/>
<polygon fill="black" stroke="black" points="4443.26,-578.59 4439.76,-568.59 4436.26,-578.59 4443.26,-578.59"/>
</g>
<!-- layer_0_exp14_opt_gpu7 -->
<g id="node52" class="node">
<title>layer_0_exp14_opt_gpu7</title>
<polygon fill="lightcoral" stroke="black" points="5073,-568.52 4718,-568.52 4718,-527.52 5073,-527.52 5073,-568.52"/>
<text text-anchor="middle" x="4895.5" y="-556.52" font-family="Arial" font-size="10.00">Expert 14 (Optimized)</text>
<text text-anchor="middle" x="4895.5" y="-545.52" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="4895.5" y="-534.52" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp14_opt_gpu7 -->
<g id="edge53" class="edge">
<title>layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp14_opt_gpu7</title>
<path fill="none" stroke="black" d="M3281.74,-642C3788.71,-642 4886.26,-642 4886.26,-642 4886.26,-642 4886.26,-578.88 4886.26,-578.88"/>
<polygon fill="black" stroke="black" points="4889.76,-578.88 4886.26,-568.88 4882.76,-578.88 4889.76,-578.88"/>
</g>
<!-- layer_0_exp15_opt_gpu7 -->
<g id="node53" class="node">
<title>layer_0_exp15_opt_gpu7</title>
<polygon fill="lightcoral" stroke="black" points="5446,-568.52 5091,-568.52 5091,-527.52 5446,-527.52 5446,-568.52"/>
<text text-anchor="middle" x="5268.5" y="-556.52" font-family="Arial" font-size="10.00">Expert 15 (Optimized)</text>
<text text-anchor="middle" x="5268.5" y="-545.52" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="5268.5" y="-534.52" font-family="Arial" font-size="10.00">GPU: 7</text>
</g>
<!-- layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp15_opt_gpu7 -->
<g id="edge54" class="edge">
<title>layer_0_ep0_scatter_opt&#45;&gt;layer_0_exp15_opt_gpu7</title>
<path fill="none" stroke="black" d="M3274.53,-651C3854.74,-651 5268.5,-651 5268.5,-651 5268.5,-651 5268.5,-578.86 5268.5,-578.86"/>
<polygon fill="black" stroke="black" points="5272,-578.86 5268.5,-568.86 5265,-578.86 5272,-578.86"/>
</g>
<!-- layer_0_ep1_scatter_opt -->
<g id="node35" class="node">
<title>layer_0_ep1_scatter_opt</title>
<ellipse fill="lightgray" stroke="black" cx="3763.5" cy="-1431.6" rx="251.05" ry="36.54"/>
<text text-anchor="middle" x="3763.5" y="-1445.6" font-family="Arial" font-size="10.00">Hierarchical EP Scatter</text>
<text text-anchor="middle" x="3763.5" y="-1434.6" font-family="Arial" font-size="10.00">NVLink优先</text>
<text text-anchor="middle" x="3763.5" y="-1423.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="3763.5" y="-1412.6" font-family="Arial" font-size="10.00">GPU: 8&#45;15</text>
</g>
<!-- layer_0_ep2_scatter_opt -->
<g id="node36" class="node">
<title>layer_0_ep2_scatter_opt</title>
<ellipse fill="lightgray" stroke="black" cx="4283.5" cy="-1431.6" rx="251.05" ry="36.54"/>
<text text-anchor="middle" x="4283.5" y="-1445.6" font-family="Arial" font-size="10.00">Hierarchical EP Scatter</text>
<text text-anchor="middle" x="4283.5" y="-1434.6" font-family="Arial" font-size="10.00">NVLink优先</text>
<text text-anchor="middle" x="4283.5" y="-1423.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="4283.5" y="-1412.6" font-family="Arial" font-size="10.00">GPU: 16&#45;23</text>
</g>
<!-- layer_0_ep3_scatter_opt -->
<g id="node37" class="node">
<title>layer_0_ep3_scatter_opt</title>
<ellipse fill="lightgray" stroke="black" cx="4803.5" cy="-1431.6" rx="251.05" ry="36.54"/>
<text text-anchor="middle" x="4803.5" y="-1445.6" font-family="Arial" font-size="10.00">Hierarchical EP Scatter</text>
<text text-anchor="middle" x="4803.5" y="-1434.6" font-family="Arial" font-size="10.00">NVLink优先</text>
<text text-anchor="middle" x="4803.5" y="-1423.6" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="4803.5" y="-1412.6" font-family="Arial" font-size="10.00">GPU: 24&#45;31</text>
</g>
<!-- layer_0_ep0_gather_opt -->
<g id="node54" class="node">
<title>layer_0_ep0_gather_opt</title>
<ellipse fill="lightgray" stroke="black" cx="3030.5" cy="-453.75" rx="251.05" ry="36.54"/>
<text text-anchor="middle" x="3030.5" y="-467.75" font-family="Arial" font-size="10.00">Hierarchical EP Gather</text>
<text text-anchor="middle" x="3030.5" y="-456.75" font-family="Arial" font-size="10.00">NVLink优先</text>
<text text-anchor="middle" x="3030.5" y="-445.75" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="3030.5" y="-434.75" font-family="Arial" font-size="10.00">GPU: 0&#45;7</text>
</g>
<!-- layer_0_exp0_opt_gpu0&#45;&gt;layer_0_ep0_gather_opt -->
<g id="edge55" class="edge">
<title>layer_0_exp0_opt_gpu0&#45;&gt;layer_0_ep0_gather_opt</title>
<path fill="none" stroke="black" d="M5641.5,-527.29C5641.5,-494.66 5641.5,-435 5641.5,-435 5641.5,-435 3256.67,-435 3256.67,-435"/>
<polygon fill="black" stroke="black" points="3256.67,-431.5 3246.67,-435 3256.67,-438.5 3256.67,-431.5"/>
</g>
<!-- layer_0_exp1_opt_gpu0&#45;&gt;layer_0_ep0_gather_opt -->
<g id="edge56" class="edge">
<title>layer_0_exp1_opt_gpu0&#45;&gt;layer_0_ep0_gather_opt</title>
<path fill="none" stroke="black" d="M6014.5,-527.32C6014.5,-492.51 6014.5,-426 6014.5,-426 6014.5,-426 3205.18,-426 3205.18,-426"/>
<polygon fill="black" stroke="black" points="3205.18,-422.5 3195.18,-426 3205.18,-429.5 3205.18,-422.5"/>
</g>
<!-- layer_0_exp2_opt_gpu1&#45;&gt;layer_0_ep0_gather_opt -->
<g id="edge57" class="edge">
<title>layer_0_exp2_opt_gpu1&#45;&gt;layer_0_ep0_gather_opt</title>
<path fill="none" stroke="black" d="M476,-527.46C476,-512.92 476,-496 476,-496 476,-496 2787.41,-496 2787.41,-496 2787.41,-496 2787.41,-473.13 2787.41,-473.13"/>
<polygon fill="black" stroke="black" points="2790.91,-473.13 2787.41,-463.13 2783.91,-473.13 2790.91,-473.13"/>
</g>
<!-- layer_0_exp3_opt_gpu1&#45;&gt;layer_0_ep0_gather_opt -->
<g id="edge58" class="edge">
<title>layer_0_exp3_opt_gpu1&#45;&gt;layer_0_ep0_gather_opt</title>
<path fill="none" stroke="black" d="M869.74,-527.43C869.74,-515.18 869.74,-502 869.74,-502 869.74,-502 2795.34,-502 2795.34,-502 2795.34,-502 2795.34,-476.68 2795.34,-476.68"/>
<polygon fill="black" stroke="black" points="2798.84,-476.68 2795.34,-466.68 2791.84,-476.68 2798.84,-476.68"/>
</g>
<!-- layer_0_exp4_opt_gpu2&#45;&gt;layer_0_ep0_gather_opt -->
<g id="edge59" class="edge">
<title>layer_0_exp4_opt_gpu2&#45;&gt;layer_0_ep0_gather_opt</title>
<path fill="none" stroke="black" d="M1316.24,-527.14C1316.24,-517.86 1316.24,-509 1316.24,-509 1316.24,-509 2803.27,-509 2803.27,-509 2803.27,-509 2803.27,-479.44 2803.27,-479.44"/>
<polygon fill="black" stroke="black" points="2806.77,-479.44 2803.27,-469.44 2799.77,-479.44 2806.77,-479.44"/>
</g>
<!-- layer_0_exp5_opt_gpu2&#45;&gt;layer_0_ep0_gather_opt -->
<g id="edge60" class="edge">
<title>layer_0_exp5_opt_gpu2&#45;&gt;layer_0_ep0_gather_opt</title>
<path fill="none" stroke="black" d="M1538.5,-527.3C1538.5,-520.66 1538.5,-515 1538.5,-515 1538.5,-515 2811.2,-515 2811.2,-515 2811.2,-515 2811.2,-481.8 2811.2,-481.8"/>
<polygon fill="black" stroke="black" points="2814.7,-481.8 2811.2,-471.8 2807.7,-481.8 2814.7,-481.8"/>
</g>
<!-- layer_0_exp6_opt_gpu3&#45;&gt;layer_0_ep0_gather_opt -->
<g id="edge61" class="edge">
<title>layer_0_exp6_opt_gpu3&#45;&gt;layer_0_ep0_gather_opt</title>
<path fill="none" stroke="black" d="M1949.24,-527.27C1949.24,-523.64 1949.24,-521 1949.24,-521 1949.24,-521 2819.14,-521 2819.14,-521 2819.14,-521 2819.14,-483.93 2819.14,-483.93"/>
<polygon fill="black" stroke="black" points="2822.64,-483.93 2819.14,-473.93 2815.64,-483.93 2822.64,-483.93"/>
</g>
<!-- layer_0_exp7_opt_gpu3&#45;&gt;layer_0_ep0_gather_opt -->
<g id="edge62" class="edge">
<title>layer_0_exp7_opt_gpu3&#45;&gt;layer_0_ep0_gather_opt</title>
<path fill="none" stroke="black" d="M2386.76,-527.4C2386.76,-499.46 2386.76,-453 2386.76,-453 2386.76,-453 2769.31,-453 2769.31,-453"/>
<polygon fill="black" stroke="black" points="2769.31,-456.5 2779.31,-453 2769.31,-449.5 2769.31,-456.5"/>
</g>
<!-- layer_0_exp8_opt_gpu4&#45;&gt;layer_0_ep0_gather_opt -->
<g id="edge63" class="edge">
<title>layer_0_exp8_opt_gpu4&#45;&gt;layer_0_ep0_gather_opt</title>
<path fill="none" stroke="black" d="M2827.07,-527.1C2827.07,-527.1 2827.07,-485.6 2827.07,-485.6"/>
<polygon fill="black" stroke="black" points="2830.57,-485.6 2827.07,-475.6 2823.57,-485.6 2830.57,-485.6"/>
</g>
<!-- layer_0_exp9_opt_gpu4&#45;&gt;layer_0_ep0_gather_opt -->
<g id="edge64" class="edge">
<title>layer_0_exp9_opt_gpu4&#45;&gt;layer_0_ep0_gather_opt</title>
<path fill="none" stroke="black" d="M3030.5,-527.1C3030.5,-527.1 3030.5,-500.56 3030.5,-500.56"/>
<polygon fill="black" stroke="black" points="3034,-500.56 3030.5,-490.56 3027,-500.56 3034,-500.56"/>
</g>
<!-- layer_0_exp10_opt_gpu5&#45;&gt;layer_0_ep0_gather_opt -->
<g id="edge65" class="edge">
<title>layer_0_exp10_opt_gpu5&#45;&gt;layer_0_ep0_gather_opt</title>
<path fill="none" stroke="black" d="M3253.76,-527.1C3253.76,-527.1 3253.76,-480.84 3253.76,-480.84"/>
<polygon fill="black" stroke="black" points="3257.26,-480.84 3253.76,-470.84 3250.26,-480.84 3257.26,-480.84"/>
</g>
<!-- layer_0_exp11_opt_gpu5&#45;&gt;layer_0_ep0_gather_opt -->
<g id="edge66" class="edge">
<title>layer_0_exp11_opt_gpu5&#45;&gt;layer_0_ep0_gather_opt</title>
<path fill="none" stroke="black" d="M3776.5,-527.18C3776.5,-507.51 3776.5,-481 3776.5,-481 3776.5,-481 3209.31,-481 3209.31,-481"/>
<polygon fill="black" stroke="black" points="3209.31,-477.5 3199.31,-481 3209.31,-484.5 3209.31,-477.5"/>
</g>
<!-- layer_0_exp12_opt_gpu6&#45;&gt;layer_0_ep0_gather_opt -->
<g id="edge67" class="edge">
<title>layer_0_exp12_opt_gpu6&#45;&gt;layer_0_ep0_gather_opt</title>
<path fill="none" stroke="black" d="M4149.5,-527.25C4149.5,-504.74 4149.5,-472 4149.5,-472 4149.5,-472 3258.58,-472 3258.58,-472"/>
<polygon fill="black" stroke="black" points="3258.58,-468.5 3248.58,-472 3258.58,-475.5 3258.58,-468.5"/>
</g>
<!-- layer_0_exp13_opt_gpu6&#45;&gt;layer_0_ep0_gather_opt -->
<g id="edge68" class="edge">
<title>layer_0_exp13_opt_gpu6&#45;&gt;layer_0_ep0_gather_opt</title>
<path fill="none" stroke="black" d="M4522.5,-527.2C4522.5,-501.74 4522.5,-462 4522.5,-462 4522.5,-462 3285.2,-462 3285.2,-462"/>
<polygon fill="black" stroke="black" points="3285.2,-458.5 3275.2,-462 3285.2,-465.5 3285.2,-458.5"/>
</g>
<!-- layer_0_exp14_opt_gpu7&#45;&gt;layer_0_ep0_gather_opt -->
<g id="edge69" class="edge">
<title>layer_0_exp14_opt_gpu7&#45;&gt;layer_0_ep0_gather_opt</title>
<path fill="none" stroke="black" d="M4895.5,-527.4C4895.5,-499.46 4895.5,-453 4895.5,-453 4895.5,-453 3291.54,-453 3291.54,-453"/>
<polygon fill="black" stroke="black" points="3291.54,-449.5 3281.54,-453 3291.54,-456.5 3291.54,-449.5"/>
</g>
<!-- layer_0_exp15_opt_gpu7&#45;&gt;layer_0_ep0_gather_opt -->
<g id="edge70" class="edge">
<title>layer_0_exp15_opt_gpu7&#45;&gt;layer_0_ep0_gather_opt</title>
<path fill="none" stroke="black" d="M5268.5,-527.47C5268.5,-497.16 5268.5,-444 5268.5,-444 5268.5,-444 3282.66,-444 3282.66,-444"/>
<polygon fill="black" stroke="black" points="3282.66,-440.5 3272.66,-444 3282.66,-447.5 3282.66,-440.5"/>
</g>
<!-- layer_0_moe_agg_opt -->
<g id="node58" class="node">
<title>layer_0_moe_agg_opt</title>
<polygon fill="yellow" stroke="black" points="1908.59,-379.98 1323.04,-379.98 1172.41,-275.98 1757.96,-275.98 1908.59,-379.98"/>
<text text-anchor="middle" x="1540.5" y="-341.98" font-family="Arial" font-size="10.00">Optimized MoE Aggregation</text>
<text text-anchor="middle" x="1540.5" y="-330.98" font-family="Arial" font-size="10.00">Load balanced</text>
<text text-anchor="middle" x="1540.5" y="-319.98" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="1540.5" y="-308.98" font-family="Arial" font-size="10.00">GPU: 0&#45;31</text>
</g>
<!-- layer_0_ep0_gather_opt&#45;&gt;layer_0_moe_agg_opt -->
<g id="edge71" class="edge">
<title>layer_0_ep0_gather_opt&#45;&gt;layer_0_moe_agg_opt</title>
<path fill="none" stroke="black" d="M3030.5,-416.75C3030.5,-379.34 3030.5,-327 3030.5,-327 3030.5,-327 1842.21,-327 1842.21,-327"/>
<polygon fill="black" stroke="black" points="1842.21,-323.5 1832.21,-327 1842.21,-330.5 1842.21,-323.5"/>
</g>
<!-- layer_0_ep1_gather_opt -->
<g id="node55" class="node">
<title>layer_0_ep1_gather_opt</title>
<ellipse fill="lightgray" stroke="black" cx="1020.5" cy="-453.75" rx="251.05" ry="36.54"/>
<text text-anchor="middle" x="1020.5" y="-467.75" font-family="Arial" font-size="10.00">Hierarchical EP Gather</text>
<text text-anchor="middle" x="1020.5" y="-456.75" font-family="Arial" font-size="10.00">NVLink优先</text>
<text text-anchor="middle" x="1020.5" y="-445.75" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="1020.5" y="-434.75" font-family="Arial" font-size="10.00">GPU: 8&#45;15</text>
</g>
<!-- layer_0_ep1_gather_opt&#45;&gt;layer_0_moe_agg_opt -->
<g id="edge72" class="edge">
<title>layer_0_ep1_gather_opt&#45;&gt;layer_0_moe_agg_opt</title>
<path fill="none" stroke="black" d="M1221.99,-431.56C1221.99,-431.56 1221.99,-338.03 1221.99,-338.03"/>
<polygon fill="black" stroke="black" points="1225.49,-338.03 1221.99,-328.03 1218.49,-338.03 1225.49,-338.03"/>
</g>
<!-- layer_0_ep2_gather_opt -->
<g id="node56" class="node">
<title>layer_0_ep2_gather_opt</title>
<ellipse fill="lightgray" stroke="black" cx="1540.5" cy="-453.75" rx="251.05" ry="36.54"/>
<text text-anchor="middle" x="1540.5" y="-467.75" font-family="Arial" font-size="10.00">Hierarchical EP Gather</text>
<text text-anchor="middle" x="1540.5" y="-456.75" font-family="Arial" font-size="10.00">NVLink优先</text>
<text text-anchor="middle" x="1540.5" y="-445.75" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="1540.5" y="-434.75" font-family="Arial" font-size="10.00">GPU: 16&#45;23</text>
</g>
<!-- layer_0_ep2_gather_opt&#45;&gt;layer_0_moe_agg_opt -->
<g id="edge73" class="edge">
<title>layer_0_ep2_gather_opt&#45;&gt;layer_0_moe_agg_opt</title>
<path fill="none" stroke="black" d="M1540.5,-416.7C1540.5,-416.7 1540.5,-390.15 1540.5,-390.15"/>
<polygon fill="black" stroke="black" points="1544,-390.15 1540.5,-380.15 1537,-390.15 1544,-390.15"/>
</g>
<!-- layer_0_ep3_gather_opt -->
<g id="node57" class="node">
<title>layer_0_ep3_gather_opt</title>
<ellipse fill="lightgray" stroke="black" cx="2060.5" cy="-453.75" rx="251.05" ry="36.54"/>
<text text-anchor="middle" x="2060.5" y="-467.75" font-family="Arial" font-size="10.00">Hierarchical EP Gather</text>
<text text-anchor="middle" x="2060.5" y="-456.75" font-family="Arial" font-size="10.00">NVLink优先</text>
<text text-anchor="middle" x="2060.5" y="-445.75" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="2060.5" y="-434.75" font-family="Arial" font-size="10.00">GPU: 24&#45;31</text>
</g>
<!-- layer_0_ep3_gather_opt&#45;&gt;layer_0_moe_agg_opt -->
<g id="edge74" class="edge">
<title>layer_0_ep3_gather_opt&#45;&gt;layer_0_moe_agg_opt</title>
<path fill="none" stroke="black" d="M1859.01,-431.56C1859.01,-431.56 1859.01,-390.25 1859.01,-390.25"/>
<polygon fill="black" stroke="black" points="1862.51,-390.25 1859.01,-380.25 1855.51,-390.25 1862.51,-390.25"/>
</g>
<!-- layer_0_moe_agg_opt&#45;&gt;layer_0_add_norm2_opt -->
<g id="edge75" class="edge">
<title>layer_0_moe_agg_opt&#45;&gt;layer_0_add_norm2_opt</title>
<path fill="none" stroke="black" d="M1246.16,-327C878.89,-327 298.5,-327 298.5,-327 298.5,-327 298.5,-249.15 298.5,-249.15"/>
<polygon fill="black" stroke="black" points="302,-249.15 298.5,-239.15 295,-249.15 302,-249.15"/>
</g>
<!-- layer_15_add_norm2_opt -->
<g id="node60" class="node">
<title>layer_15_add_norm2_opt</title>
<polygon fill="lightgreen" stroke="black" points="355,-146.98 0,-146.98 0,-94.98 355,-94.98 355,-146.98"/>
<text text-anchor="middle" x="177.5" y="-134.98" font-family="Arial" font-size="10.00">Optimized Layer 15</text>
<text text-anchor="middle" x="177.5" y="-123.98" font-family="Arial" font-size="10.00">Add+Residual+Norm</text>
<text text-anchor="middle" x="177.5" y="-112.98" font-family="Arial" font-size="10.00">[batch=128,seq=1024,d_model=1024]→[batch=128,seq=1024,d_model=1024]</text>
<text text-anchor="middle" x="177.5" y="-101.98" font-family="Arial" font-size="10.00">GPU: 32&#45;63</text>
</g>
<!-- layer_0_add_norm2_opt&#45;&gt;layer_15_add_norm2_opt -->
<g id="edge77" class="edge">
<title>layer_0_add_norm2_opt&#45;&gt;layer_15_add_norm2_opt</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M177.5,-197.81C177.5,-197.81 177.5,-157.21 177.5,-157.21"/>
<polygon fill="black" stroke="black" points="181,-157.21 177.5,-147.21 174,-157.21 181,-157.21"/>
<text text-anchor="middle" x="255" y="-168.78" font-family="Times,serif" font-size="14.00">layers 1&#45;14 optimized</text>
</g>
<!-- layer_15_add_norm2_opt&#45;&gt;output -->
<g id="edge78" class="edge">
<title>layer_15_add_norm2_opt&#45;&gt;output</title>
<path fill="none" stroke="black" d="M177.5,-94.87C177.5,-94.87 177.5,-68.08 177.5,-68.08"/>
<polygon fill="black" stroke="black" points="181,-68.08 177.5,-58.08 174,-68.08 181,-68.08"/>
</g>
</g>
</svg>
