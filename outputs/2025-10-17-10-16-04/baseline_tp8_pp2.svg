<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Baseline_TP8_PP2 Pages: 1 -->
<svg width="8540pt" height="7722pt"
 viewBox="0.00 0.00 8540.00 7722.33" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 7718.33)">
<title>Baseline_TP8_PP2</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-7718.33 8536,-7718.33 8536,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage0</title>
<path fill="none" stroke="black" d="M918,-3945.17C918,-3945.17 8512,-3945.17 8512,-3945.17 8518,-3945.17 8524,-3951.17 8524,-3957.17 8524,-3957.17 8524,-7598.17 8524,-7598.17 8524,-7604.17 8518,-7610.17 8512,-7610.17 8512,-7610.17 918,-7610.17 918,-7610.17 912,-7610.17 906,-7604.17 906,-7598.17 906,-7598.17 906,-3957.17 906,-3957.17 906,-3951.17 912,-3945.17 918,-3945.17"/>
<text text-anchor="middle" x="4715" y="-7594.97" font-family="Times,serif" font-size="14.00">Pipeline Stage 0 (GPUs 0&#45;7)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_stage0_layer0</title>
<path fill="none" stroke="black" d="M926,-5770.17C926,-5770.17 8504,-5770.17 8504,-5770.17 8510,-5770.17 8516,-5776.17 8516,-5782.17 8516,-5782.17 8516,-7567.17 8516,-7567.17 8516,-7573.17 8510,-7579.17 8504,-7579.17 8504,-7579.17 926,-7579.17 926,-7579.17 920,-7579.17 914,-7573.17 914,-7567.17 914,-7567.17 914,-5782.17 914,-5782.17 914,-5776.17 920,-5770.17 926,-5770.17"/>
<text text-anchor="middle" x="4715" y="-7563.97" font-family="Times,serif" font-size="14.00">Stage 0 Layer 0</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_stage0_layer1</title>
<path fill="none" stroke="black" d="M926,-3953.17C926,-3953.17 8504,-3953.17 8504,-3953.17 8510,-3953.17 8516,-3959.17 8516,-3965.17 8516,-3965.17 8516,-5750.17 8516,-5750.17 8516,-5756.17 8510,-5762.17 8504,-5762.17 8504,-5762.17 926,-5762.17 926,-5762.17 920,-5762.17 914,-5756.17 914,-5750.17 914,-5750.17 914,-3965.17 914,-3965.17 914,-3959.17 920,-3953.17 926,-3953.17"/>
<text text-anchor="middle" x="4715" y="-5746.97" font-family="Times,serif" font-size="14.00">Stage 0 Layer 1</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_stage1</title>
<path fill="none" stroke="black" d="M20,-116.17C20,-116.17 7614,-116.17 7614,-116.17 7620,-116.17 7626,-122.17 7626,-128.17 7626,-128.17 7626,-3769.17 7626,-3769.17 7626,-3775.17 7620,-3781.17 7614,-3781.17 7614,-3781.17 20,-3781.17 20,-3781.17 14,-3781.17 8,-3775.17 8,-3769.17 8,-3769.17 8,-128.17 8,-128.17 8,-122.17 14,-116.17 20,-116.17"/>
<text text-anchor="middle" x="3817" y="-3765.97" font-family="Times,serif" font-size="14.00">Pipeline Stage 1 (GPUs 8&#45;15)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_stage1_layer2</title>
<path fill="none" stroke="black" d="M28,-1941.17C28,-1941.17 7606,-1941.17 7606,-1941.17 7612,-1941.17 7618,-1947.17 7618,-1953.17 7618,-1953.17 7618,-3738.17 7618,-3738.17 7618,-3744.17 7612,-3750.17 7606,-3750.17 7606,-3750.17 28,-3750.17 28,-3750.17 22,-3750.17 16,-3744.17 16,-3738.17 16,-3738.17 16,-1953.17 16,-1953.17 16,-1947.17 22,-1941.17 28,-1941.17"/>
<text text-anchor="middle" x="3817" y="-3734.97" font-family="Times,serif" font-size="14.00">Stage 1 Layer 2</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_stage1_layer3</title>
<path fill="none" stroke="black" d="M28,-124.17C28,-124.17 7606,-124.17 7606,-124.17 7612,-124.17 7618,-130.17 7618,-136.17 7618,-136.17 7618,-1921.17 7618,-1921.17 7618,-1927.17 7612,-1933.17 7606,-1933.17 7606,-1933.17 28,-1933.17 28,-1933.17 22,-1933.17 16,-1927.17 16,-1921.17 16,-1921.17 16,-136.17 16,-136.17 16,-130.17 22,-124.17 28,-124.17"/>
<text text-anchor="middle" x="3817" y="-1917.97" font-family="Times,serif" font-size="14.00">Stage 1 Layer 3</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightblue" stroke="black" cx="7364" cy="-7666.25" rx="323.71" ry="48.17"/>
<text text-anchor="middle" x="7364" y="-7685.05" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="7364" y="-7670.05" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7364" y="-7655.05" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7364" y="-7640.05" font-family="Times,serif" font-size="14.00">GPUs: stage0</text>
</g>
<!-- stage0_layer0_ln1 -->
<g id="node2" class="node">
<title>stage0_layer0_ln1</title>
<polygon fill="lightgreen" stroke="black" points="6665,-7548.17 6207,-7548.17 6207,-7480.17 6665,-7480.17 6665,-7548.17"/>
<text text-anchor="middle" x="6436" y="-7532.97" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="6436" y="-7517.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6436" y="-7502.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6436" y="-7487.97" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- input&#45;&gt;stage0_layer0_ln1 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;stage0_layer0_ln1</title>
<path fill="none" stroke="black" d="M7127.32,-7633.22C7127.32,-7594.05 7127.32,-7534 7127.32,-7534 7127.32,-7534 6675.24,-7534 6675.24,-7534"/>
<polygon fill="black" stroke="black" points="6675.24,-7530.5 6665.24,-7534 6675.24,-7537.5 6675.24,-7530.5"/>
</g>
<!-- stage0_layer0_residual1 -->
<g id="node28" class="node">
<title>stage0_layer0_residual1</title>
<polygon fill="lightpink" stroke="black" points="7273,-6885.17 6815,-6802.17 7273,-6719.17 7731,-6802.17 7273,-6885.17"/>
<text text-anchor="middle" x="7273" y="-6828.47" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="7273" y="-6813.47" font-family="Times,serif" font-size="14.00">Input1: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7273" y="-6798.47" font-family="Times,serif" font-size="14.00">Input2: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7273" y="-6783.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7273" y="-6768.47" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- input&#45;&gt;stage0_layer0_residual1 -->
<g id="edge35" class="edge">
<title>input&#45;&gt;stage0_layer0_residual1</title>
<path fill="none" stroke="black" d="M7222,-7622.81C7222,-7622.81 7222,-6886.23 7222,-6886.23"/>
<polygon fill="black" stroke="black" points="7225.5,-6886.23 7222,-6876.23 7218.5,-6886.23 7225.5,-6886.23"/>
</g>
<!-- stage0_layer0_qkv_tp_0 -->
<g id="node3" class="node">
<title>stage0_layer0_qkv_tp_0</title>
<polygon fill="lightcoral" stroke="black" points="4589.5,-7444.17 4082.5,-7444.17 4082.5,-7346.17 4589.5,-7346.17 4589.5,-7444.17"/>
<text text-anchor="middle" x="4336" y="-7428.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4336" y="-7413.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="4336" y="-7398.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="4336" y="-7383.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4336" y="-7368.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4336" y="-7353.97" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- stage0_layer0_ln1&#45;&gt;stage0_layer0_qkv_tp_0 -->
<g id="edge2" class="edge">
<title>stage0_layer0_ln1&#45;&gt;stage0_layer0_qkv_tp_0</title>
<path fill="none" stroke="black" d="M6206.76,-7534C5662.18,-7534 4336,-7534 4336,-7534 4336,-7534 4336,-7454.5 4336,-7454.5"/>
<polygon fill="black" stroke="black" points="4339.5,-7454.5 4336,-7444.5 4332.5,-7454.5 4339.5,-7454.5"/>
</g>
<!-- stage0_layer0_qkv_tp_1 -->
<g id="node4" class="node">
<title>stage0_layer0_qkv_tp_1</title>
<polygon fill="lightcoral" stroke="black" points="5114.5,-7444.17 4607.5,-7444.17 4607.5,-7346.17 5114.5,-7346.17 5114.5,-7444.17"/>
<text text-anchor="middle" x="4861" y="-7428.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4861" y="-7413.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="4861" y="-7398.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="4861" y="-7383.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4861" y="-7368.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4861" y="-7353.97" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- stage0_layer0_ln1&#45;&gt;stage0_layer0_qkv_tp_1 -->
<g id="edge6" class="edge">
<title>stage0_layer0_ln1&#45;&gt;stage0_layer0_qkv_tp_1</title>
<path fill="none" stroke="black" d="M6206.98,-7520C5770.16,-7520 4861,-7520 4861,-7520 4861,-7520 4861,-7454.5 4861,-7454.5"/>
<polygon fill="black" stroke="black" points="4864.5,-7454.5 4861,-7444.5 4857.5,-7454.5 4864.5,-7454.5"/>
</g>
<!-- stage0_layer0_qkv_tp_2 -->
<g id="node5" class="node">
<title>stage0_layer0_qkv_tp_2</title>
<polygon fill="lightcoral" stroke="black" points="5639.5,-7444.17 5132.5,-7444.17 5132.5,-7346.17 5639.5,-7346.17 5639.5,-7444.17"/>
<text text-anchor="middle" x="5386" y="-7428.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5386" y="-7413.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="5386" y="-7398.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="5386" y="-7383.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5386" y="-7368.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5386" y="-7353.97" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- stage0_layer0_ln1&#45;&gt;stage0_layer0_qkv_tp_2 -->
<g id="edge10" class="edge">
<title>stage0_layer0_ln1&#45;&gt;stage0_layer0_qkv_tp_2</title>
<path fill="none" stroke="black" d="M6206.87,-7507C5897.92,-7507 5386,-7507 5386,-7507 5386,-7507 5386,-7454.22 5386,-7454.22"/>
<polygon fill="black" stroke="black" points="5389.5,-7454.22 5386,-7444.22 5382.5,-7454.22 5389.5,-7454.22"/>
</g>
<!-- stage0_layer0_qkv_tp_3 -->
<g id="node6" class="node">
<title>stage0_layer0_qkv_tp_3</title>
<polygon fill="lightcoral" stroke="black" points="6164.5,-7444.17 5657.5,-7444.17 5657.5,-7346.17 6164.5,-7346.17 6164.5,-7444.17"/>
<text text-anchor="middle" x="5911" y="-7428.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5911" y="-7413.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="5911" y="-7398.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="5911" y="-7383.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5911" y="-7368.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5911" y="-7353.97" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- stage0_layer0_ln1&#45;&gt;stage0_layer0_qkv_tp_3 -->
<g id="edge14" class="edge">
<title>stage0_layer0_ln1&#45;&gt;stage0_layer0_qkv_tp_3</title>
<path fill="none" stroke="black" d="M6206.87,-7493C6065.5,-7493 5911,-7493 5911,-7493 5911,-7493 5911,-7454.37 5911,-7454.37"/>
<polygon fill="black" stroke="black" points="5914.5,-7454.37 5911,-7444.37 5907.5,-7454.37 5914.5,-7454.37"/>
</g>
<!-- stage0_layer0_qkv_tp_4 -->
<g id="node7" class="node">
<title>stage0_layer0_qkv_tp_4</title>
<polygon fill="lightcoral" stroke="black" points="6689.5,-7444.17 6182.5,-7444.17 6182.5,-7346.17 6689.5,-7346.17 6689.5,-7444.17"/>
<text text-anchor="middle" x="6436" y="-7428.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="6436" y="-7413.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="6436" y="-7398.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="6436" y="-7383.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6436" y="-7368.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6436" y="-7353.97" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- stage0_layer0_ln1&#45;&gt;stage0_layer0_qkv_tp_4 -->
<g id="edge18" class="edge">
<title>stage0_layer0_ln1&#45;&gt;stage0_layer0_qkv_tp_4</title>
<path fill="none" stroke="black" d="M6436,-7480.07C6436,-7480.07 6436,-7454.35 6436,-7454.35"/>
<polygon fill="black" stroke="black" points="6439.5,-7454.35 6436,-7444.35 6432.5,-7454.35 6439.5,-7454.35"/>
</g>
<!-- stage0_layer0_qkv_tp_5 -->
<g id="node8" class="node">
<title>stage0_layer0_qkv_tp_5</title>
<polygon fill="lightcoral" stroke="black" points="7214.5,-7444.17 6707.5,-7444.17 6707.5,-7346.17 7214.5,-7346.17 7214.5,-7444.17"/>
<text text-anchor="middle" x="6961" y="-7428.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="6961" y="-7413.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="6961" y="-7398.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="6961" y="-7383.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6961" y="-7368.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6961" y="-7353.97" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- stage0_layer0_ln1&#45;&gt;stage0_layer0_qkv_tp_5 -->
<g id="edge22" class="edge">
<title>stage0_layer0_ln1&#45;&gt;stage0_layer0_qkv_tp_5</title>
<path fill="none" stroke="black" d="M6665.17,-7493C6771.1,-7493 6873.82,-7493 6873.82,-7493 6873.82,-7493 6873.82,-7454.37 6873.82,-7454.37"/>
<polygon fill="black" stroke="black" points="6877.32,-7454.37 6873.82,-7444.37 6870.32,-7454.37 6877.32,-7454.37"/>
</g>
<!-- stage0_layer0_qkv_tp_6 -->
<g id="node9" class="node">
<title>stage0_layer0_qkv_tp_6</title>
<polygon fill="lightcoral" stroke="black" points="7739.5,-7444.17 7232.5,-7444.17 7232.5,-7346.17 7739.5,-7346.17 7739.5,-7444.17"/>
<text text-anchor="middle" x="7486" y="-7428.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="7486" y="-7413.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="7486" y="-7398.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="7486" y="-7383.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7486" y="-7368.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="7486" y="-7353.97" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- stage0_layer0_ln1&#45;&gt;stage0_layer0_qkv_tp_6 -->
<g id="edge26" class="edge">
<title>stage0_layer0_ln1&#45;&gt;stage0_layer0_qkv_tp_6</title>
<path fill="none" stroke="black" d="M6665.21,-7507C6967.11,-7507 7460.18,-7507 7460.18,-7507 7460.18,-7507 7460.18,-7454.22 7460.18,-7454.22"/>
<polygon fill="black" stroke="black" points="7463.68,-7454.22 7460.18,-7444.22 7456.68,-7454.22 7463.68,-7454.22"/>
</g>
<!-- stage0_layer0_qkv_tp_7 -->
<g id="node10" class="node">
<title>stage0_layer0_qkv_tp_7</title>
<polygon fill="lightcoral" stroke="black" points="8264.5,-7444.17 7757.5,-7444.17 7757.5,-7346.17 8264.5,-7346.17 8264.5,-7444.17"/>
<text text-anchor="middle" x="8011" y="-7428.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="8011" y="-7413.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="8011" y="-7398.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="8011" y="-7383.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="8011" y="-7368.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="8011" y="-7353.97" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- stage0_layer0_ln1&#45;&gt;stage0_layer0_qkv_tp_7 -->
<g id="edge30" class="edge">
<title>stage0_layer0_ln1&#45;&gt;stage0_layer0_qkv_tp_7</title>
<path fill="none" stroke="black" d="M6665.02,-7520C7101.84,-7520 8011,-7520 8011,-7520 8011,-7520 8011,-7454.5 8011,-7454.5"/>
<polygon fill="black" stroke="black" points="8014.5,-7454.5 8011,-7444.5 8007.5,-7454.5 8014.5,-7454.5"/>
</g>
<!-- stage0_layer0_attn_tp_0 -->
<g id="node11" class="node">
<title>stage0_layer0_attn_tp_0</title>
<polygon fill="lightcoral" stroke="black" points="4589.5,-7310.17 4082.5,-7310.17 4082.5,-7212.17 4589.5,-7212.17 4589.5,-7310.17"/>
<text text-anchor="middle" x="4336" y="-7294.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="4336" y="-7279.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="4336" y="-7264.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="4336" y="-7249.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4336" y="-7234.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4336" y="-7219.97" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- stage0_layer0_qkv_tp_0&#45;&gt;stage0_layer0_attn_tp_0 -->
<g id="edge3" class="edge">
<title>stage0_layer0_qkv_tp_0&#45;&gt;stage0_layer0_attn_tp_0</title>
<path fill="none" stroke="black" d="M4336,-7346.03C4336,-7346.03 4336,-7320.3 4336,-7320.3"/>
<polygon fill="black" stroke="black" points="4339.5,-7320.3 4336,-7310.3 4332.5,-7320.3 4339.5,-7320.3"/>
</g>
<!-- stage0_layer0_attn_tp_1 -->
<g id="node12" class="node">
<title>stage0_layer0_attn_tp_1</title>
<polygon fill="lightcoral" stroke="black" points="5114.5,-7310.17 4607.5,-7310.17 4607.5,-7212.17 5114.5,-7212.17 5114.5,-7310.17"/>
<text text-anchor="middle" x="4861" y="-7294.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="4861" y="-7279.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="4861" y="-7264.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="4861" y="-7249.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4861" y="-7234.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4861" y="-7219.97" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- stage0_layer0_qkv_tp_1&#45;&gt;stage0_layer0_attn_tp_1 -->
<g id="edge7" class="edge">
<title>stage0_layer0_qkv_tp_1&#45;&gt;stage0_layer0_attn_tp_1</title>
<path fill="none" stroke="black" d="M4861,-7346.03C4861,-7346.03 4861,-7320.3 4861,-7320.3"/>
<polygon fill="black" stroke="black" points="4864.5,-7320.3 4861,-7310.3 4857.5,-7320.3 4864.5,-7320.3"/>
</g>
<!-- stage0_layer0_attn_tp_2 -->
<g id="node13" class="node">
<title>stage0_layer0_attn_tp_2</title>
<polygon fill="lightcoral" stroke="black" points="5639.5,-7310.17 5132.5,-7310.17 5132.5,-7212.17 5639.5,-7212.17 5639.5,-7310.17"/>
<text text-anchor="middle" x="5386" y="-7294.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="5386" y="-7279.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="5386" y="-7264.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="5386" y="-7249.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5386" y="-7234.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5386" y="-7219.97" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- stage0_layer0_qkv_tp_2&#45;&gt;stage0_layer0_attn_tp_2 -->
<g id="edge11" class="edge">
<title>stage0_layer0_qkv_tp_2&#45;&gt;stage0_layer0_attn_tp_2</title>
<path fill="none" stroke="black" d="M5386,-7346.03C5386,-7346.03 5386,-7320.3 5386,-7320.3"/>
<polygon fill="black" stroke="black" points="5389.5,-7320.3 5386,-7310.3 5382.5,-7320.3 5389.5,-7320.3"/>
</g>
<!-- stage0_layer0_attn_tp_3 -->
<g id="node14" class="node">
<title>stage0_layer0_attn_tp_3</title>
<polygon fill="lightcoral" stroke="black" points="6164.5,-7310.17 5657.5,-7310.17 5657.5,-7212.17 6164.5,-7212.17 6164.5,-7310.17"/>
<text text-anchor="middle" x="5911" y="-7294.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="5911" y="-7279.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="5911" y="-7264.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="5911" y="-7249.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5911" y="-7234.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5911" y="-7219.97" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- stage0_layer0_qkv_tp_3&#45;&gt;stage0_layer0_attn_tp_3 -->
<g id="edge15" class="edge">
<title>stage0_layer0_qkv_tp_3&#45;&gt;stage0_layer0_attn_tp_3</title>
<path fill="none" stroke="black" d="M5911,-7346.03C5911,-7346.03 5911,-7320.3 5911,-7320.3"/>
<polygon fill="black" stroke="black" points="5914.5,-7320.3 5911,-7310.3 5907.5,-7320.3 5914.5,-7320.3"/>
</g>
<!-- stage0_layer0_attn_tp_4 -->
<g id="node15" class="node">
<title>stage0_layer0_attn_tp_4</title>
<polygon fill="lightcoral" stroke="black" points="6689.5,-7310.17 6182.5,-7310.17 6182.5,-7212.17 6689.5,-7212.17 6689.5,-7310.17"/>
<text text-anchor="middle" x="6436" y="-7294.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="6436" y="-7279.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="6436" y="-7264.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="6436" y="-7249.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6436" y="-7234.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6436" y="-7219.97" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- stage0_layer0_qkv_tp_4&#45;&gt;stage0_layer0_attn_tp_4 -->
<g id="edge19" class="edge">
<title>stage0_layer0_qkv_tp_4&#45;&gt;stage0_layer0_attn_tp_4</title>
<path fill="none" stroke="black" d="M6436,-7346.03C6436,-7346.03 6436,-7320.3 6436,-7320.3"/>
<polygon fill="black" stroke="black" points="6439.5,-7320.3 6436,-7310.3 6432.5,-7320.3 6439.5,-7320.3"/>
</g>
<!-- stage0_layer0_attn_tp_5 -->
<g id="node16" class="node">
<title>stage0_layer0_attn_tp_5</title>
<polygon fill="lightcoral" stroke="black" points="7214.5,-7310.17 6707.5,-7310.17 6707.5,-7212.17 7214.5,-7212.17 7214.5,-7310.17"/>
<text text-anchor="middle" x="6961" y="-7294.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="6961" y="-7279.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="6961" y="-7264.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="6961" y="-7249.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6961" y="-7234.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6961" y="-7219.97" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- stage0_layer0_qkv_tp_5&#45;&gt;stage0_layer0_attn_tp_5 -->
<g id="edge23" class="edge">
<title>stage0_layer0_qkv_tp_5&#45;&gt;stage0_layer0_attn_tp_5</title>
<path fill="none" stroke="black" d="M6961,-7346.03C6961,-7346.03 6961,-7320.3 6961,-7320.3"/>
<polygon fill="black" stroke="black" points="6964.5,-7320.3 6961,-7310.3 6957.5,-7320.3 6964.5,-7320.3"/>
</g>
<!-- stage0_layer0_attn_tp_6 -->
<g id="node17" class="node">
<title>stage0_layer0_attn_tp_6</title>
<polygon fill="lightcoral" stroke="black" points="7739.5,-7310.17 7232.5,-7310.17 7232.5,-7212.17 7739.5,-7212.17 7739.5,-7310.17"/>
<text text-anchor="middle" x="7486" y="-7294.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="7486" y="-7279.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="7486" y="-7264.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="7486" y="-7249.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="7486" y="-7234.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="7486" y="-7219.97" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- stage0_layer0_qkv_tp_6&#45;&gt;stage0_layer0_attn_tp_6 -->
<g id="edge27" class="edge">
<title>stage0_layer0_qkv_tp_6&#45;&gt;stage0_layer0_attn_tp_6</title>
<path fill="none" stroke="black" d="M7486,-7346.03C7486,-7346.03 7486,-7320.3 7486,-7320.3"/>
<polygon fill="black" stroke="black" points="7489.5,-7320.3 7486,-7310.3 7482.5,-7320.3 7489.5,-7320.3"/>
</g>
<!-- stage0_layer0_attn_tp_7 -->
<g id="node18" class="node">
<title>stage0_layer0_attn_tp_7</title>
<polygon fill="lightcoral" stroke="black" points="8264.5,-7310.17 7757.5,-7310.17 7757.5,-7212.17 8264.5,-7212.17 8264.5,-7310.17"/>
<text text-anchor="middle" x="8011" y="-7294.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="8011" y="-7279.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="8011" y="-7264.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="8011" y="-7249.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="8011" y="-7234.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="8011" y="-7219.97" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- stage0_layer0_qkv_tp_7&#45;&gt;stage0_layer0_attn_tp_7 -->
<g id="edge31" class="edge">
<title>stage0_layer0_qkv_tp_7&#45;&gt;stage0_layer0_attn_tp_7</title>
<path fill="none" stroke="black" d="M8011,-7346.03C8011,-7346.03 8011,-7320.3 8011,-7320.3"/>
<polygon fill="black" stroke="black" points="8014.5,-7320.3 8011,-7310.3 8007.5,-7320.3 8014.5,-7320.3"/>
</g>
<!-- stage0_layer0_attn_out_tp_0 -->
<g id="node19" class="node">
<title>stage0_layer0_attn_out_tp_0</title>
<polygon fill="lightcoral" stroke="black" points="4596.5,-7176.17 4101.5,-7176.17 4101.5,-7093.17 4596.5,-7093.17 4596.5,-7176.17"/>
<text text-anchor="middle" x="4349" y="-7160.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4349" y="-7145.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="4349" y="-7130.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4349" y="-7115.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4349" y="-7100.97" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- stage0_layer0_attn_tp_0&#45;&gt;stage0_layer0_attn_out_tp_0 -->
<g id="edge4" class="edge">
<title>stage0_layer0_attn_tp_0&#45;&gt;stage0_layer0_attn_out_tp_0</title>
<path fill="none" stroke="black" d="M4345.5,-7211.9C4345.5,-7211.9 4345.5,-7186.22 4345.5,-7186.22"/>
<polygon fill="black" stroke="black" points="4349,-7186.22 4345.5,-7176.22 4342,-7186.22 4349,-7186.22"/>
</g>
<!-- stage0_layer0_attn_out_tp_1 -->
<g id="node20" class="node">
<title>stage0_layer0_attn_out_tp_1</title>
<polygon fill="lightcoral" stroke="black" points="5123.5,-7176.17 4628.5,-7176.17 4628.5,-7093.17 5123.5,-7093.17 5123.5,-7176.17"/>
<text text-anchor="middle" x="4876" y="-7160.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4876" y="-7145.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="4876" y="-7130.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4876" y="-7115.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4876" y="-7100.97" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- stage0_layer0_attn_tp_1&#45;&gt;stage0_layer0_attn_out_tp_1 -->
<g id="edge8" class="edge">
<title>stage0_layer0_attn_tp_1&#45;&gt;stage0_layer0_attn_out_tp_1</title>
<path fill="none" stroke="black" d="M4871.5,-7211.9C4871.5,-7211.9 4871.5,-7186.22 4871.5,-7186.22"/>
<polygon fill="black" stroke="black" points="4875,-7186.22 4871.5,-7176.22 4868,-7186.22 4875,-7186.22"/>
</g>
<!-- stage0_layer0_attn_out_tp_2 -->
<g id="node21" class="node">
<title>stage0_layer0_attn_out_tp_2</title>
<polygon fill="lightcoral" stroke="black" points="5642.5,-7176.17 5147.5,-7176.17 5147.5,-7093.17 5642.5,-7093.17 5642.5,-7176.17"/>
<text text-anchor="middle" x="5395" y="-7160.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="5395" y="-7145.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="5395" y="-7130.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5395" y="-7115.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5395" y="-7100.97" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- stage0_layer0_attn_tp_2&#45;&gt;stage0_layer0_attn_out_tp_2 -->
<g id="edge12" class="edge">
<title>stage0_layer0_attn_tp_2&#45;&gt;stage0_layer0_attn_out_tp_2</title>
<path fill="none" stroke="black" d="M5393.5,-7211.9C5393.5,-7211.9 5393.5,-7186.22 5393.5,-7186.22"/>
<polygon fill="black" stroke="black" points="5397,-7186.22 5393.5,-7176.22 5390,-7186.22 5397,-7186.22"/>
</g>
<!-- stage0_layer0_attn_out_tp_3 -->
<g id="node22" class="node">
<title>stage0_layer0_attn_out_tp_3</title>
<polygon fill="lightcoral" stroke="black" points="6164.5,-7176.17 5669.5,-7176.17 5669.5,-7093.17 6164.5,-7093.17 6164.5,-7176.17"/>
<text text-anchor="middle" x="5917" y="-7160.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="5917" y="-7145.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="5917" y="-7130.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5917" y="-7115.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5917" y="-7100.97" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- stage0_layer0_attn_tp_3&#45;&gt;stage0_layer0_attn_out_tp_3 -->
<g id="edge16" class="edge">
<title>stage0_layer0_attn_tp_3&#45;&gt;stage0_layer0_attn_out_tp_3</title>
<path fill="none" stroke="black" d="M5917,-7211.9C5917,-7211.9 5917,-7186.22 5917,-7186.22"/>
<polygon fill="black" stroke="black" points="5920.5,-7186.22 5917,-7176.22 5913.5,-7186.22 5920.5,-7186.22"/>
</g>
<!-- stage0_layer0_attn_out_tp_4 -->
<g id="node23" class="node">
<title>stage0_layer0_attn_out_tp_4</title>
<polygon fill="lightcoral" stroke="black" points="6683.5,-7176.17 6188.5,-7176.17 6188.5,-7093.17 6683.5,-7093.17 6683.5,-7176.17"/>
<text text-anchor="middle" x="6436" y="-7160.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="6436" y="-7145.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="6436" y="-7130.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6436" y="-7115.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6436" y="-7100.97" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- stage0_layer0_attn_tp_4&#45;&gt;stage0_layer0_attn_out_tp_4 -->
<g id="edge20" class="edge">
<title>stage0_layer0_attn_tp_4&#45;&gt;stage0_layer0_attn_out_tp_4</title>
<path fill="none" stroke="black" d="M6436,-7211.9C6436,-7211.9 6436,-7186.22 6436,-7186.22"/>
<polygon fill="black" stroke="black" points="6439.5,-7186.22 6436,-7176.22 6432.5,-7186.22 6439.5,-7186.22"/>
</g>
<!-- stage0_layer0_attn_out_tp_5 -->
<g id="node24" class="node">
<title>stage0_layer0_attn_out_tp_5</title>
<polygon fill="lightcoral" stroke="black" points="7202.5,-7176.17 6707.5,-7176.17 6707.5,-7093.17 7202.5,-7093.17 7202.5,-7176.17"/>
<text text-anchor="middle" x="6955" y="-7160.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="6955" y="-7145.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="6955" y="-7130.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6955" y="-7115.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6955" y="-7100.97" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- stage0_layer0_attn_tp_5&#45;&gt;stage0_layer0_attn_out_tp_5 -->
<g id="edge24" class="edge">
<title>stage0_layer0_attn_tp_5&#45;&gt;stage0_layer0_attn_out_tp_5</title>
<path fill="none" stroke="black" d="M6955,-7211.9C6955,-7211.9 6955,-7186.22 6955,-7186.22"/>
<polygon fill="black" stroke="black" points="6958.5,-7186.22 6955,-7176.22 6951.5,-7186.22 6958.5,-7186.22"/>
</g>
<!-- stage0_layer0_attn_out_tp_6 -->
<g id="node25" class="node">
<title>stage0_layer0_attn_out_tp_6</title>
<polygon fill="lightcoral" stroke="black" points="7724.5,-7176.17 7229.5,-7176.17 7229.5,-7093.17 7724.5,-7093.17 7724.5,-7176.17"/>
<text text-anchor="middle" x="7477" y="-7160.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="7477" y="-7145.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="7477" y="-7130.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="7477" y="-7115.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7477" y="-7100.97" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- stage0_layer0_attn_tp_6&#45;&gt;stage0_layer0_attn_out_tp_6 -->
<g id="edge28" class="edge">
<title>stage0_layer0_attn_tp_6&#45;&gt;stage0_layer0_attn_out_tp_6</title>
<path fill="none" stroke="black" d="M7478.5,-7211.9C7478.5,-7211.9 7478.5,-7186.22 7478.5,-7186.22"/>
<polygon fill="black" stroke="black" points="7482,-7186.22 7478.5,-7176.22 7475,-7186.22 7482,-7186.22"/>
</g>
<!-- stage0_layer0_attn_out_tp_7 -->
<g id="node26" class="node">
<title>stage0_layer0_attn_out_tp_7</title>
<polygon fill="lightcoral" stroke="black" points="8247.5,-7176.17 7752.5,-7176.17 7752.5,-7093.17 8247.5,-7093.17 8247.5,-7176.17"/>
<text text-anchor="middle" x="8000" y="-7160.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="8000" y="-7145.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="8000" y="-7130.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="8000" y="-7115.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="8000" y="-7100.97" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- stage0_layer0_attn_tp_7&#45;&gt;stage0_layer0_attn_out_tp_7 -->
<g id="edge32" class="edge">
<title>stage0_layer0_attn_tp_7&#45;&gt;stage0_layer0_attn_out_tp_7</title>
<path fill="none" stroke="black" d="M8002.5,-7211.9C8002.5,-7211.9 8002.5,-7186.22 8002.5,-7186.22"/>
<polygon fill="black" stroke="black" points="8006,-7186.22 8002.5,-7176.22 7999,-7186.22 8006,-7186.22"/>
</g>
<!-- stage0_layer0_attn_allreduce -->
<g id="node27" class="node">
<title>stage0_layer0_attn_allreduce</title>
<polygon fill="lightyellow" stroke="black" points="6910.67,-7057.17 6155.58,-7057.17 5961.33,-6921.17 6716.42,-6921.17 6910.67,-7057.17"/>
<text text-anchor="middle" x="6436" y="-7007.97" font-family="Times,serif" font-size="14.00">Attention All&#45;Reduce</text>
<text text-anchor="middle" x="6436" y="-6992.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6436" y="-6977.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6436" y="-6962.97" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- stage0_layer0_attn_out_tp_0&#45;&gt;stage0_layer0_attn_allreduce -->
<g id="edge5" class="edge">
<title>stage0_layer0_attn_out_tp_0&#45;&gt;stage0_layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M4535.98,-7093C4535.98,-7039.92 4535.98,-6955 4535.98,-6955 4535.98,-6955 5999.6,-6955 5999.6,-6955"/>
<polygon fill="black" stroke="black" points="5999.6,-6958.5 6009.6,-6955 5999.6,-6951.5 5999.6,-6958.5"/>
</g>
<!-- stage0_layer0_attn_out_tp_1&#45;&gt;stage0_layer0_attn_allreduce -->
<g id="edge9" class="edge">
<title>stage0_layer0_attn_out_tp_1&#45;&gt;stage0_layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M4876,-7092.92C4876,-7049.88 4876,-6989 4876,-6989 4876,-6989 6047.87,-6989 6047.87,-6989"/>
<polygon fill="black" stroke="black" points="6047.87,-6992.5 6057.87,-6989 6047.87,-6985.5 6047.87,-6992.5"/>
</g>
<!-- stage0_layer0_attn_out_tp_2&#45;&gt;stage0_layer0_attn_allreduce -->
<g id="edge13" class="edge">
<title>stage0_layer0_attn_out_tp_2&#45;&gt;stage0_layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M5566.25,-7093.09C5566.25,-7061.34 5566.25,-7023 5566.25,-7023 5566.25,-7023 6096.56,-7023 6096.56,-7023"/>
<polygon fill="black" stroke="black" points="6096.56,-7026.5 6106.56,-7023 6096.56,-7019.5 6096.56,-7026.5"/>
</g>
<!-- stage0_layer0_attn_out_tp_3&#45;&gt;stage0_layer0_attn_allreduce -->
<g id="edge17" class="edge">
<title>stage0_layer0_attn_out_tp_3&#45;&gt;stage0_layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M6062.83,-7092.97C6062.83,-7092.97 6062.83,-7002.56 6062.83,-7002.56"/>
<polygon fill="black" stroke="black" points="6066.33,-7002.56 6062.83,-6992.56 6059.33,-7002.56 6066.33,-7002.56"/>
</g>
<!-- stage0_layer0_attn_out_tp_4&#45;&gt;stage0_layer0_attn_allreduce -->
<g id="edge21" class="edge">
<title>stage0_layer0_attn_out_tp_4&#45;&gt;stage0_layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M6436,-7092.97C6436,-7092.97 6436,-7067.24 6436,-7067.24"/>
<polygon fill="black" stroke="black" points="6439.5,-7067.24 6436,-7057.24 6432.5,-7067.24 6439.5,-7067.24"/>
</g>
<!-- stage0_layer0_attn_out_tp_5&#45;&gt;stage0_layer0_attn_allreduce -->
<g id="edge25" class="edge">
<title>stage0_layer0_attn_out_tp_5&#45;&gt;stage0_layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M6809.17,-7092.97C6809.17,-7092.97 6809.17,-7067.24 6809.17,-7067.24"/>
<polygon fill="black" stroke="black" points="6812.67,-7067.24 6809.17,-7057.24 6805.67,-7067.24 6812.67,-7067.24"/>
</g>
<!-- stage0_layer0_attn_out_tp_6&#45;&gt;stage0_layer0_attn_allreduce -->
<g id="edge29" class="edge">
<title>stage0_layer0_attn_out_tp_6&#45;&gt;stage0_layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M7477,-7093.14C7477,-7057.22 7477,-7011 7477,-7011 7477,-7011 6854.82,-7011 6854.82,-7011"/>
<polygon fill="black" stroke="black" points="6854.82,-7007.5 6844.82,-7011 6854.82,-7014.5 6854.82,-7007.5"/>
</g>
<!-- stage0_layer0_attn_out_tp_7&#45;&gt;stage0_layer0_attn_allreduce -->
<g id="edge33" class="edge">
<title>stage0_layer0_attn_out_tp_7&#45;&gt;stage0_layer0_attn_allreduce</title>
<path fill="none" stroke="black" d="M7883.25,-7092.97C7883.25,-7043.03 7883.25,-6966 7883.25,-6966 7883.25,-6966 6790.81,-6966 6790.81,-6966"/>
<polygon fill="black" stroke="black" points="6790.81,-6962.5 6780.81,-6966 6790.81,-6969.5 6790.81,-6962.5"/>
</g>
<!-- stage0_layer0_attn_allreduce&#45;&gt;stage0_layer0_residual1 -->
<g id="edge34" class="edge">
<title>stage0_layer0_attn_allreduce&#45;&gt;stage0_layer0_residual1</title>
<path fill="none" stroke="black" d="M6862.92,-6989.03C6862.92,-6989.03 6862.92,-6820.92 6862.92,-6820.92"/>
<polygon fill="black" stroke="black" points="6866.42,-6820.92 6862.92,-6810.92 6859.42,-6820.92 6866.42,-6820.92"/>
</g>
<!-- stage0_layer0_ln2 -->
<g id="node29" class="node">
<title>stage0_layer0_ln2</title>
<polygon fill="lightgreen" stroke="black" points="5948,-6683.17 5490,-6683.17 5490,-6615.17 5948,-6615.17 5948,-6683.17"/>
<text text-anchor="middle" x="5719" y="-6667.97" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="5719" y="-6652.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5719" y="-6637.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5719" y="-6622.97" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- stage0_layer0_residual1&#45;&gt;stage0_layer0_ln2 -->
<g id="edge36" class="edge">
<title>stage0_layer0_residual1&#45;&gt;stage0_layer0_ln2</title>
<path fill="none" stroke="black" d="M6940.5,-6779.24C6940.5,-6736.51 6940.5,-6649 6940.5,-6649 6940.5,-6649 5958.04,-6649 5958.04,-6649"/>
<polygon fill="black" stroke="black" points="5958.04,-6645.5 5948.04,-6649 5958.04,-6652.5 5958.04,-6645.5"/>
</g>
<!-- stage0_layer0_residual2 -->
<g id="node49" class="node">
<title>stage0_layer0_residual2</title>
<polygon fill="lightpink" stroke="black" points="7574,-5944.17 7116,-5861.17 7574,-5778.17 8032,-5861.17 7574,-5944.17"/>
<text text-anchor="middle" x="7574" y="-5887.47" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="7574" y="-5872.47" font-family="Times,serif" font-size="14.00">Input1: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7574" y="-5857.47" font-family="Times,serif" font-size="14.00">Input2: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7574" y="-5842.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7574" y="-5827.47" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- stage0_layer0_residual1&#45;&gt;stage0_layer0_residual2 -->
<g id="edge72" class="edge">
<title>stage0_layer0_residual1&#45;&gt;stage0_layer0_residual2</title>
<path fill="none" stroke="black" d="M7730.35,-6802C7886.72,-6802 8023,-6802 8023,-6802 8023,-6802 8023,-5872.96 8023,-5872.96"/>
<polygon fill="black" stroke="black" points="8026.5,-5872.96 8023,-5862.96 8019.5,-5872.96 8026.5,-5872.96"/>
</g>
<!-- stage0_layer0_gate -->
<g id="node30" class="node">
<title>stage0_layer0_gate</title>
<polygon fill="lightblue" stroke="black" points="5408.58,-6579.17 4666.36,-6579.17 4475.42,-6443.17 5217.64,-6443.17 5408.58,-6579.17"/>
<text text-anchor="middle" x="4942" y="-6529.97" font-family="Times,serif" font-size="14.00">Gate Computation</text>
<text text-anchor="middle" x="4942" y="-6514.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4942" y="-6499.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, num_experts=16]</text>
<text text-anchor="middle" x="4942" y="-6484.97" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- stage0_layer0_ln2&#45;&gt;stage0_layer0_gate -->
<g id="edge37" class="edge">
<title>stage0_layer0_ln2&#45;&gt;stage0_layer0_gate</title>
<path fill="none" stroke="black" d="M5567,-6614.97C5567,-6590.55 5567,-6562 5567,-6562 5567,-6562 5394.54,-6562 5394.54,-6562"/>
<polygon fill="black" stroke="black" points="5394.54,-6558.5 5384.54,-6562 5394.54,-6565.5 5394.54,-6558.5"/>
</g>
<!-- stage0_layer0_expert_0_tp_0 -->
<g id="node31" class="node">
<title>stage0_layer0_expert_0_tp_0</title>
<polygon fill="lightsteelblue" stroke="black" points="1378,-6407.17 922,-6407.17 922,-6324.17 1378,-6324.17 1378,-6407.17"/>
<text text-anchor="middle" x="1150" y="-6391.97" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1150" y="-6376.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="1150" y="-6361.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="1150" y="-6346.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="1150" y="-6331.97" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- stage0_layer0_gate&#45;&gt;stage0_layer0_expert_0_tp_0 -->
<g id="edge38" class="edge">
<title>stage0_layer0_gate&#45;&gt;stage0_layer0_expert_0_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4642.07,-6562C3745.92,-6562 1150,-6562 1150,-6562 1150,-6562 1150,-6417.3 1150,-6417.3"/>
<polygon fill="black" stroke="black" points="1153.5,-6417.3 1150,-6407.3 1146.5,-6417.3 1153.5,-6417.3"/>
</g>
<!-- stage0_layer0_expert_1_tp_0 -->
<g id="node32" class="node">
<title>stage0_layer0_expert_1_tp_0</title>
<polygon fill="lightsteelblue" stroke="black" points="1852,-6407.17 1396,-6407.17 1396,-6324.17 1852,-6324.17 1852,-6407.17"/>
<text text-anchor="middle" x="1624" y="-6391.97" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1624" y="-6376.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="1624" y="-6361.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="1624" y="-6346.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="1624" y="-6331.97" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- stage0_layer0_gate&#45;&gt;stage0_layer0_expert_1_tp_0 -->
<g id="edge39" class="edge">
<title>stage0_layer0_gate&#45;&gt;stage0_layer0_expert_1_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4618.19,-6545C3783.57,-6545 1624,-6545 1624,-6545 1624,-6545 1624,-6417.26 1624,-6417.26"/>
<polygon fill="black" stroke="black" points="1627.5,-6417.26 1624,-6407.26 1620.5,-6417.26 1627.5,-6417.26"/>
</g>
<!-- stage0_layer0_expert_2_tp_1 -->
<g id="node33" class="node">
<title>stage0_layer0_expert_2_tp_1</title>
<polygon fill="lightsteelblue" stroke="black" points="2326,-6407.17 1870,-6407.17 1870,-6324.17 2326,-6324.17 2326,-6407.17"/>
<text text-anchor="middle" x="2098" y="-6391.97" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2098" y="-6376.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="2098" y="-6361.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="2098" y="-6346.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="2098" y="-6331.97" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- stage0_layer0_gate&#45;&gt;stage0_layer0_expert_2_tp_1 -->
<g id="edge42" class="edge">
<title>stage0_layer0_gate&#45;&gt;stage0_layer0_expert_2_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4594.34,-6528C3835.47,-6528 2098,-6528 2098,-6528 2098,-6528 2098,-6417.47 2098,-6417.47"/>
<polygon fill="black" stroke="black" points="2101.5,-6417.47 2098,-6407.47 2094.5,-6417.47 2101.5,-6417.47"/>
</g>
<!-- stage0_layer0_expert_3_tp_1 -->
<g id="node34" class="node">
<title>stage0_layer0_expert_3_tp_1</title>
<polygon fill="lightsteelblue" stroke="black" points="2800,-6407.17 2344,-6407.17 2344,-6324.17 2800,-6324.17 2800,-6407.17"/>
<text text-anchor="middle" x="2572" y="-6391.97" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2572" y="-6376.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="2572" y="-6361.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="2572" y="-6346.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="2572" y="-6331.97" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- stage0_layer0_gate&#45;&gt;stage0_layer0_expert_3_tp_1 -->
<g id="edge43" class="edge">
<title>stage0_layer0_gate&#45;&gt;stage0_layer0_expert_3_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4570.38,-6511C3903.39,-6511 2572,-6511 2572,-6511 2572,-6511 2572,-6417.31 2572,-6417.31"/>
<polygon fill="black" stroke="black" points="2575.5,-6417.31 2572,-6407.31 2568.5,-6417.31 2575.5,-6417.31"/>
</g>
<!-- stage0_layer0_expert_4_tp_2 -->
<g id="node35" class="node">
<title>stage0_layer0_expert_4_tp_2</title>
<polygon fill="lightsteelblue" stroke="black" points="3274,-6407.17 2818,-6407.17 2818,-6324.17 3274,-6324.17 3274,-6407.17"/>
<text text-anchor="middle" x="3046" y="-6391.97" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="3046" y="-6376.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="3046" y="-6361.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3046" y="-6346.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="3046" y="-6331.97" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- stage0_layer0_gate&#45;&gt;stage0_layer0_expert_4_tp_2 -->
<g id="edge46" class="edge">
<title>stage0_layer0_gate&#45;&gt;stage0_layer0_expert_4_tp_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4546.56,-6494C3990.85,-6494 3046,-6494 3046,-6494 3046,-6494 3046,-6417.33 3046,-6417.33"/>
<polygon fill="black" stroke="black" points="3049.5,-6417.33 3046,-6407.33 3042.5,-6417.33 3049.5,-6417.33"/>
</g>
<!-- stage0_layer0_expert_5_tp_2 -->
<g id="node36" class="node">
<title>stage0_layer0_expert_5_tp_2</title>
<polygon fill="lightsteelblue" stroke="black" points="3748,-6407.17 3292,-6407.17 3292,-6324.17 3748,-6324.17 3748,-6407.17"/>
<text text-anchor="middle" x="3520" y="-6391.97" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="3520" y="-6376.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="3520" y="-6361.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3520" y="-6346.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="3520" y="-6331.97" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- stage0_layer0_gate&#45;&gt;stage0_layer0_expert_5_tp_2 -->
<g id="edge47" class="edge">
<title>stage0_layer0_gate&#45;&gt;stage0_layer0_expert_5_tp_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4522.56,-6477C4103.14,-6477 3520,-6477 3520,-6477 3520,-6477 3520,-6417.44 3520,-6417.44"/>
<polygon fill="black" stroke="black" points="3523.5,-6417.44 3520,-6407.44 3516.5,-6417.44 3523.5,-6417.44"/>
</g>
<!-- stage0_layer0_expert_6_tp_3 -->
<g id="node37" class="node">
<title>stage0_layer0_expert_6_tp_3</title>
<polygon fill="lightsteelblue" stroke="black" points="4222,-6407.17 3766,-6407.17 3766,-6324.17 4222,-6324.17 4222,-6407.17"/>
<text text-anchor="middle" x="3994" y="-6391.97" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="3994" y="-6376.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="3994" y="-6361.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3994" y="-6346.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="3994" y="-6331.97" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- stage0_layer0_gate&#45;&gt;stage0_layer0_expert_6_tp_3 -->
<g id="edge50" class="edge">
<title>stage0_layer0_gate&#45;&gt;stage0_layer0_expert_6_tp_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4498.87,-6460C4322.99,-6460 4161.75,-6460 4161.75,-6460 4161.75,-6460 4161.75,-6417.32 4161.75,-6417.32"/>
<polygon fill="black" stroke="black" points="4165.25,-6417.32 4161.75,-6407.32 4158.25,-6417.32 4165.25,-6417.32"/>
</g>
<!-- stage0_layer0_expert_7_tp_3 -->
<g id="node38" class="node">
<title>stage0_layer0_expert_7_tp_3</title>
<polygon fill="lightsteelblue" stroke="black" points="4696,-6407.17 4240,-6407.17 4240,-6324.17 4696,-6324.17 4696,-6407.17"/>
<text text-anchor="middle" x="4468" y="-6391.97" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="4468" y="-6376.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="4468" y="-6361.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4468" y="-6346.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="4468" y="-6331.97" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- stage0_layer0_gate&#45;&gt;stage0_layer0_expert_7_tp_3 -->
<g id="edge51" class="edge">
<title>stage0_layer0_gate&#45;&gt;stage0_layer0_expert_7_tp_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4585.73,-6443.1C4585.73,-6443.1 4585.73,-6417.55 4585.73,-6417.55"/>
<polygon fill="black" stroke="black" points="4589.23,-6417.55 4585.73,-6407.55 4582.23,-6417.55 4589.23,-6417.55"/>
</g>
<!-- stage0_layer0_expert_8_tp_4 -->
<g id="node39" class="node">
<title>stage0_layer0_expert_8_tp_4</title>
<polygon fill="lightsteelblue" stroke="black" points="5170,-6407.17 4714,-6407.17 4714,-6324.17 5170,-6324.17 5170,-6407.17"/>
<text text-anchor="middle" x="4942" y="-6391.97" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="4942" y="-6376.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="4942" y="-6361.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4942" y="-6346.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="4942" y="-6331.97" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- stage0_layer0_gate&#45;&gt;stage0_layer0_expert_8_tp_4 -->
<g id="edge54" class="edge">
<title>stage0_layer0_gate&#45;&gt;stage0_layer0_expert_8_tp_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4942,-6443.1C4942,-6443.1 4942,-6417.55 4942,-6417.55"/>
<polygon fill="black" stroke="black" points="4945.5,-6417.55 4942,-6407.55 4938.5,-6417.55 4945.5,-6417.55"/>
</g>
<!-- stage0_layer0_expert_9_tp_4 -->
<g id="node40" class="node">
<title>stage0_layer0_expert_9_tp_4</title>
<polygon fill="lightsteelblue" stroke="black" points="5644,-6407.17 5188,-6407.17 5188,-6324.17 5644,-6324.17 5644,-6407.17"/>
<text text-anchor="middle" x="5416" y="-6391.97" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="5416" y="-6376.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="5416" y="-6361.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5416" y="-6346.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="5416" y="-6331.97" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- stage0_layer0_gate&#45;&gt;stage0_layer0_expert_9_tp_4 -->
<g id="edge55" class="edge">
<title>stage0_layer0_gate&#45;&gt;stage0_layer0_expert_9_tp_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5298.27,-6500.23C5298.27,-6500.23 5298.27,-6417.19 5298.27,-6417.19"/>
<polygon fill="black" stroke="black" points="5301.77,-6417.19 5298.27,-6407.19 5294.77,-6417.19 5301.77,-6417.19"/>
</g>
<!-- stage0_layer0_expert_10_tp_5 -->
<g id="node41" class="node">
<title>stage0_layer0_expert_10_tp_5</title>
<polygon fill="lightsteelblue" stroke="black" points="6118,-6407.17 5662,-6407.17 5662,-6324.17 6118,-6324.17 6118,-6407.17"/>
<text text-anchor="middle" x="5890" y="-6391.97" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="5890" y="-6376.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="5890" y="-6361.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5890" y="-6346.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="5890" y="-6331.97" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- stage0_layer0_gate&#45;&gt;stage0_layer0_expert_10_tp_5 -->
<g id="edge58" class="edge">
<title>stage0_layer0_gate&#45;&gt;stage0_layer0_expert_10_tp_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5241.41,-6460C5490.67,-6460 5805,-6460 5805,-6460 5805,-6460 5805,-6417.32 5805,-6417.32"/>
<polygon fill="black" stroke="black" points="5808.5,-6417.32 5805,-6407.32 5801.5,-6417.32 5808.5,-6417.32"/>
</g>
<!-- stage0_layer0_expert_11_tp_5 -->
<g id="node42" class="node">
<title>stage0_layer0_expert_11_tp_5</title>
<polygon fill="lightsteelblue" stroke="black" points="6592,-6407.17 6136,-6407.17 6136,-6324.17 6592,-6324.17 6592,-6407.17"/>
<text text-anchor="middle" x="6364" y="-6391.97" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="6364" y="-6376.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="6364" y="-6361.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6364" y="-6346.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="6364" y="-6331.97" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- stage0_layer0_gate&#45;&gt;stage0_layer0_expert_11_tp_5 -->
<g id="edge59" class="edge">
<title>stage0_layer0_gate&#45;&gt;stage0_layer0_expert_11_tp_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5265.56,-6477C5685.18,-6477 6364,-6477 6364,-6477 6364,-6477 6364,-6417.44 6364,-6417.44"/>
<polygon fill="black" stroke="black" points="6367.5,-6417.44 6364,-6407.44 6360.5,-6417.44 6367.5,-6417.44"/>
</g>
<!-- stage0_layer0_expert_12_tp_6 -->
<g id="node43" class="node">
<title>stage0_layer0_expert_12_tp_6</title>
<polygon fill="lightsteelblue" stroke="black" points="7066,-6407.17 6610,-6407.17 6610,-6324.17 7066,-6324.17 7066,-6407.17"/>
<text text-anchor="middle" x="6838" y="-6391.97" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="6838" y="-6376.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="6838" y="-6361.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6838" y="-6346.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="6838" y="-6331.97" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- stage0_layer0_gate&#45;&gt;stage0_layer0_expert_12_tp_6 -->
<g id="edge62" class="edge">
<title>stage0_layer0_gate&#45;&gt;stage0_layer0_expert_12_tp_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5289.15,-6494C5804.68,-6494 6712.5,-6494 6712.5,-6494 6712.5,-6494 6712.5,-6417.33 6712.5,-6417.33"/>
<polygon fill="black" stroke="black" points="6716,-6417.33 6712.5,-6407.33 6709,-6417.33 6716,-6417.33"/>
</g>
<!-- stage0_layer0_expert_13_tp_6 -->
<g id="node44" class="node">
<title>stage0_layer0_expert_13_tp_6</title>
<polygon fill="lightsteelblue" stroke="black" points="7540,-6407.17 7084,-6407.17 7084,-6324.17 7540,-6324.17 7540,-6407.17"/>
<text text-anchor="middle" x="7312" y="-6391.97" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="7312" y="-6376.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="7312" y="-6361.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7312" y="-6346.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="7312" y="-6331.97" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- stage0_layer0_gate&#45;&gt;stage0_layer0_expert_13_tp_6 -->
<g id="edge63" class="edge">
<title>stage0_layer0_gate&#45;&gt;stage0_layer0_expert_13_tp_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5312.96,-6511C5979.74,-6511 7312,-6511 7312,-6511 7312,-6511 7312,-6417.31 7312,-6417.31"/>
<polygon fill="black" stroke="black" points="7315.5,-6417.31 7312,-6407.31 7308.5,-6417.31 7315.5,-6417.31"/>
</g>
<!-- stage0_layer0_expert_14_tp_7 -->
<g id="node45" class="node">
<title>stage0_layer0_expert_14_tp_7</title>
<polygon fill="lightsteelblue" stroke="black" points="8014,-6407.17 7558,-6407.17 7558,-6324.17 8014,-6324.17 8014,-6407.17"/>
<text text-anchor="middle" x="7786" y="-6391.97" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="7786" y="-6376.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="7786" y="-6361.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7786" y="-6346.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="7786" y="-6331.97" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- stage0_layer0_gate&#45;&gt;stage0_layer0_expert_14_tp_7 -->
<g id="edge66" class="edge">
<title>stage0_layer0_gate&#45;&gt;stage0_layer0_expert_14_tp_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5336.77,-6528C6087,-6528 7644.5,-6528 7644.5,-6528 7644.5,-6528 7644.5,-6417.47 7644.5,-6417.47"/>
<polygon fill="black" stroke="black" points="7648,-6417.47 7644.5,-6407.47 7641,-6417.47 7648,-6417.47"/>
</g>
<!-- stage0_layer0_expert_15_tp_7 -->
<g id="node46" class="node">
<title>stage0_layer0_expert_15_tp_7</title>
<polygon fill="lightsteelblue" stroke="black" points="8488,-6407.17 8032,-6407.17 8032,-6324.17 8488,-6324.17 8488,-6407.17"/>
<text text-anchor="middle" x="8260" y="-6391.97" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="8260" y="-6376.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="8260" y="-6361.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="8260" y="-6346.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="8260" y="-6331.97" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- stage0_layer0_gate&#45;&gt;stage0_layer0_expert_15_tp_7 -->
<g id="edge67" class="edge">
<title>stage0_layer0_gate&#45;&gt;stage0_layer0_expert_15_tp_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5360.87,-6545C6228.05,-6545 8139.75,-6545 8139.75,-6545 8139.75,-6545 8139.75,-6417.26 8139.75,-6417.26"/>
<polygon fill="black" stroke="black" points="8143.25,-6417.26 8139.75,-6407.26 8136.25,-6417.26 8143.25,-6417.26"/>
</g>
<!-- stage0_layer0_expert_agg -->
<g id="node47" class="node">
<title>stage0_layer0_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="5416.67,-6288.17 4661.58,-6288.17 4467.33,-6152.17 5222.42,-6152.17 5416.67,-6288.17"/>
<text text-anchor="middle" x="4942" y="-6238.97" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4942" y="-6223.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, expert_dim=16384]</text>
<text text-anchor="middle" x="4942" y="-6208.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4942" y="-6193.97" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- stage0_layer0_expert_0_tp_0&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge40" class="edge">
<title>stage0_layer0_expert_0_tp_0&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M1226,-6323.96C1226,-6266.23 1226,-6169 1226,-6169 1226,-6169 4480.99,-6169 4480.99,-6169"/>
<polygon fill="black" stroke="black" points="4480.99,-6172.5 4490.99,-6169 4480.99,-6165.5 4480.99,-6172.5"/>
</g>
<!-- stage0_layer0_expert_1_tp_0&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge41" class="edge">
<title>stage0_layer0_expert_1_tp_0&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M1700,-6324C1700,-6270.92 1700,-6186 1700,-6186 1700,-6186 4505.25,-6186 4505.25,-6186"/>
<polygon fill="black" stroke="black" points="4505.25,-6189.5 4515.25,-6186 4505.25,-6182.5 4505.25,-6189.5"/>
</g>
<!-- stage0_layer0_expert_2_tp_1&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge44" class="edge">
<title>stage0_layer0_expert_2_tp_1&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M2174,-6323.78C2174,-6275.58 2174,-6203 2174,-6203 2174,-6203 4529.88,-6203 4529.88,-6203"/>
<polygon fill="black" stroke="black" points="4529.88,-6206.5 4539.88,-6203 4529.88,-6199.5 4529.88,-6206.5"/>
</g>
<!-- stage0_layer0_expert_3_tp_1&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge45" class="edge">
<title>stage0_layer0_expert_3_tp_1&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M2648,-6323.92C2648,-6280.88 2648,-6220 2648,-6220 2648,-6220 4554.16,-6220 4554.16,-6220"/>
<polygon fill="black" stroke="black" points="4554.16,-6223.5 4564.16,-6220 4554.16,-6216.5 4554.16,-6223.5"/>
</g>
<!-- stage0_layer0_expert_4_tp_2&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge48" class="edge">
<title>stage0_layer0_expert_4_tp_2&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M3122,-6323.89C3122,-6286.32 3122,-6237 3122,-6237 3122,-6237 4578.39,-6237 4578.39,-6237"/>
<polygon fill="black" stroke="black" points="4578.39,-6240.5 4588.39,-6237 4578.39,-6233.5 4578.39,-6240.5"/>
</g>
<!-- stage0_layer0_expert_5_tp_2&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge49" class="edge">
<title>stage0_layer0_expert_5_tp_2&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M3596,-6324.09C3596,-6292.34 3596,-6254 3596,-6254 3596,-6254 4602.73,-6254 4602.73,-6254"/>
<polygon fill="black" stroke="black" points="4602.73,-6257.5 4612.73,-6254 4602.73,-6250.5 4602.73,-6257.5"/>
</g>
<!-- stage0_layer0_expert_6_tp_3&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge52" class="edge">
<title>stage0_layer0_expert_6_tp_3&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M4146.75,-6324.14C4146.75,-6298.71 4146.75,-6271 4146.75,-6271 4146.75,-6271 4626.81,-6271 4626.81,-6271"/>
<polygon fill="black" stroke="black" points="4626.81,-6274.5 4636.81,-6271 4626.81,-6267.5 4626.81,-6274.5"/>
</g>
<!-- stage0_layer0_expert_7_tp_3&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge53" class="edge">
<title>stage0_layer0_expert_7_tp_3&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M4581.58,-6323.97C4581.58,-6323.97 4581.58,-6242.2 4581.58,-6242.2"/>
<polygon fill="black" stroke="black" points="4585.08,-6242.2 4581.58,-6232.2 4578.08,-6242.2 4585.08,-6242.2"/>
</g>
<!-- stage0_layer0_expert_8_tp_4&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge56" class="edge">
<title>stage0_layer0_expert_8_tp_4&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M4942,-6323.97C4942,-6323.97 4942,-6298.24 4942,-6298.24"/>
<polygon fill="black" stroke="black" points="4945.5,-6298.24 4942,-6288.24 4938.5,-6298.24 4945.5,-6298.24"/>
</g>
<!-- stage0_layer0_expert_9_tp_4&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge57" class="edge">
<title>stage0_layer0_expert_9_tp_4&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M5302.42,-6323.97C5302.42,-6323.97 5302.42,-6298.24 5302.42,-6298.24"/>
<polygon fill="black" stroke="black" points="5305.92,-6298.24 5302.42,-6288.24 5298.92,-6298.24 5305.92,-6298.24"/>
</g>
<!-- stage0_layer0_expert_10_tp_5&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge60" class="edge">
<title>stage0_layer0_expert_10_tp_5&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M5890,-6323.96C5890,-6297.42 5890,-6268 5890,-6268 5890,-6268 5397.89,-6268 5397.89,-6268"/>
<polygon fill="black" stroke="black" points="5397.89,-6264.5 5387.89,-6268 5397.89,-6271.5 5397.89,-6264.5"/>
</g>
<!-- stage0_layer0_expert_11_tp_5&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge61" class="edge">
<title>stage0_layer0_expert_11_tp_5&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M6141.83,-6323.88C6141.83,-6290.4 6141.83,-6249 6141.83,-6249 6141.83,-6249 5370.8,-6249 5370.8,-6249"/>
<polygon fill="black" stroke="black" points="5370.8,-6245.5 5360.8,-6249 5370.8,-6252.5 5370.8,-6245.5"/>
</g>
<!-- stage0_layer0_expert_12_tp_6&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge64" class="edge">
<title>stage0_layer0_expert_12_tp_6&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M6617.08,-6323.92C6617.08,-6283.73 6617.08,-6229 6617.08,-6229 6617.08,-6229 5342.35,-6229 5342.35,-6229"/>
<polygon fill="black" stroke="black" points="5342.35,-6225.5 5332.35,-6229 5342.35,-6232.5 5342.35,-6225.5"/>
</g>
<!-- stage0_layer0_expert_13_tp_6&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge65" class="edge">
<title>stage0_layer0_expert_13_tp_6&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M7312,-6323.95C7312,-6277.84 7312,-6210 7312,-6210 7312,-6210 5315.18,-6210 5315.18,-6210"/>
<polygon fill="black" stroke="black" points="5315.18,-6206.5 5305.18,-6210 5315.18,-6213.5 5315.18,-6206.5"/>
</g>
<!-- stage0_layer0_expert_14_tp_7&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge68" class="edge">
<title>stage0_layer0_expert_14_tp_7&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M7565.92,-6323.83C7565.92,-6272.16 7565.92,-6191 7565.92,-6191 7565.92,-6191 5287.99,-6191 5287.99,-6191"/>
<polygon fill="black" stroke="black" points="5287.99,-6187.5 5277.99,-6191 5287.99,-6194.5 5287.99,-6187.5"/>
</g>
<!-- stage0_layer0_expert_15_tp_7&#45;&gt;stage0_layer0_expert_agg -->
<g id="edge69" class="edge">
<title>stage0_layer0_expert_15_tp_7&#45;&gt;stage0_layer0_expert_agg</title>
<path fill="none" stroke="black" d="M8142.75,-6323.91C8142.75,-6266.71 8142.75,-6171 8142.75,-6171 8142.75,-6171 5259.63,-6171 5259.63,-6171"/>
<polygon fill="black" stroke="black" points="5259.63,-6167.5 5249.63,-6171 5259.63,-6174.5 5259.63,-6167.5"/>
</g>
<!-- stage0_layer0_expert_allreduce -->
<g id="node48" class="node">
<title>stage0_layer0_expert_allreduce</title>
<polygon fill="lightyellow" stroke="black" points="7573.67,-6116.17 6818.58,-6116.17 6624.33,-5980.17 7379.42,-5980.17 7573.67,-6116.17"/>
<text text-anchor="middle" x="7099" y="-6066.97" font-family="Times,serif" font-size="14.00">MoE All&#45;Reduce</text>
<text text-anchor="middle" x="7099" y="-6051.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7099" y="-6036.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="7099" y="-6021.97" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- stage0_layer0_expert_agg&#45;&gt;stage0_layer0_expert_allreduce -->
<g id="edge70" class="edge">
<title>stage0_layer0_expert_agg&#45;&gt;stage0_layer0_expert_allreduce</title>
<path fill="none" stroke="black" d="M5269.17,-6184.49C5269.17,-6134.06 5269.17,-6048 5269.17,-6048 5269.17,-6048 6710.97,-6048 6710.97,-6048"/>
<polygon fill="black" stroke="black" points="6710.97,-6051.5 6720.97,-6048 6710.97,-6044.5 6710.97,-6051.5"/>
</g>
<!-- stage0_layer0_expert_allreduce&#45;&gt;stage0_layer0_residual2 -->
<g id="edge71" class="edge">
<title>stage0_layer0_expert_allreduce&#45;&gt;stage0_layer0_residual2</title>
<path fill="none" stroke="black" d="M7344.92,-5980.13C7344.92,-5980.13 7344.92,-5912.78 7344.92,-5912.78"/>
<polygon fill="black" stroke="black" points="7348.42,-5912.78 7344.92,-5902.78 7341.42,-5912.78 7348.42,-5912.78"/>
</g>
<!-- stage0_layer1_ln1 -->
<g id="node50" class="node">
<title>stage0_layer1_ln1</title>
<polygon fill="lightgreen" stroke="black" points="6654,-5731.17 6196,-5731.17 6196,-5663.17 6654,-5663.17 6654,-5731.17"/>
<text text-anchor="middle" x="6425" y="-5715.97" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="6425" y="-5700.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6425" y="-5685.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6425" y="-5670.97" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- stage0_layer0_residual2&#45;&gt;stage0_layer1_ln1 -->
<g id="edge73" class="edge">
<title>stage0_layer0_residual2&#45;&gt;stage0_layer1_ln1</title>
<path fill="none" stroke="black" d="M7159.75,-5853C7159.75,-5822.5 7159.75,-5717 7159.75,-5717 7159.75,-5717 6664.21,-5717 6664.21,-5717"/>
<polygon fill="black" stroke="black" points="6664.21,-5713.5 6654.21,-5717 6664.21,-5720.5 6664.21,-5713.5"/>
</g>
<!-- stage0_layer1_residual1 -->
<g id="node76" class="node">
<title>stage0_layer1_residual1</title>
<polygon fill="lightpink" stroke="black" points="8032,-5068.17 7574,-4985.17 8032,-4902.17 8490,-4985.17 8032,-5068.17"/>
<text text-anchor="middle" x="8032" y="-5011.47" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="8032" y="-4996.47" font-family="Times,serif" font-size="14.00">Input1: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8032" y="-4981.47" font-family="Times,serif" font-size="14.00">Input2: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8032" y="-4966.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="8032" y="-4951.47" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- stage0_layer0_residual2&#45;&gt;stage0_layer1_residual1 -->
<g id="edge107" class="edge">
<title>stage0_layer0_residual2&#45;&gt;stage0_layer1_residual1</title>
<path fill="none" stroke="black" d="M7735.5,-5807.36C7735.5,-5807.36 7735.5,-5024.78 7735.5,-5024.78"/>
<polygon fill="black" stroke="black" points="7739,-5024.78 7735.5,-5014.78 7732,-5024.78 7739,-5024.78"/>
</g>
<!-- stage0_layer1_qkv_tp_0 -->
<g id="node51" class="node">
<title>stage0_layer1_qkv_tp_0</title>
<polygon fill="lightcoral" stroke="black" points="4578.5,-5627.17 4071.5,-5627.17 4071.5,-5529.17 4578.5,-5529.17 4578.5,-5627.17"/>
<text text-anchor="middle" x="4325" y="-5611.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4325" y="-5596.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="4325" y="-5581.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="4325" y="-5566.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4325" y="-5551.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4325" y="-5536.97" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- stage0_layer1_ln1&#45;&gt;stage0_layer1_qkv_tp_0 -->
<g id="edge74" class="edge">
<title>stage0_layer1_ln1&#45;&gt;stage0_layer1_qkv_tp_0</title>
<path fill="none" stroke="black" d="M6195.55,-5717C5689.64,-5717 4522.83,-5717 4522.83,-5717 4522.83,-5717 4522.83,-5637.5 4522.83,-5637.5"/>
<polygon fill="black" stroke="black" points="4526.33,-5637.5 4522.83,-5627.5 4519.33,-5637.5 4526.33,-5637.5"/>
</g>
<!-- stage0_layer1_qkv_tp_1 -->
<g id="node52" class="node">
<title>stage0_layer1_qkv_tp_1</title>
<polygon fill="lightcoral" stroke="black" points="5103.5,-5627.17 4596.5,-5627.17 4596.5,-5529.17 5103.5,-5529.17 5103.5,-5627.17"/>
<text text-anchor="middle" x="4850" y="-5611.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4850" y="-5596.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="4850" y="-5581.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="4850" y="-5566.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4850" y="-5551.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4850" y="-5536.97" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- stage0_layer1_ln1&#45;&gt;stage0_layer1_qkv_tp_1 -->
<g id="edge78" class="edge">
<title>stage0_layer1_ln1&#45;&gt;stage0_layer1_qkv_tp_1</title>
<path fill="none" stroke="black" d="M6195.98,-5703C5759.16,-5703 4850,-5703 4850,-5703 4850,-5703 4850,-5637.5 4850,-5637.5"/>
<polygon fill="black" stroke="black" points="4853.5,-5637.5 4850,-5627.5 4846.5,-5637.5 4853.5,-5637.5"/>
</g>
<!-- stage0_layer1_qkv_tp_2 -->
<g id="node53" class="node">
<title>stage0_layer1_qkv_tp_2</title>
<polygon fill="lightcoral" stroke="black" points="5628.5,-5627.17 5121.5,-5627.17 5121.5,-5529.17 5628.5,-5529.17 5628.5,-5627.17"/>
<text text-anchor="middle" x="5375" y="-5611.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5375" y="-5596.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="5375" y="-5581.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="5375" y="-5566.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5375" y="-5551.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5375" y="-5536.97" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- stage0_layer1_ln1&#45;&gt;stage0_layer1_qkv_tp_2 -->
<g id="edge82" class="edge">
<title>stage0_layer1_ln1&#45;&gt;stage0_layer1_qkv_tp_2</title>
<path fill="none" stroke="black" d="M6195.84,-5690C5928.52,-5690 5522.67,-5690 5522.67,-5690 5522.67,-5690 5522.67,-5637.22 5522.67,-5637.22"/>
<polygon fill="black" stroke="black" points="5526.17,-5637.22 5522.67,-5627.22 5519.17,-5637.22 5526.17,-5637.22"/>
</g>
<!-- stage0_layer1_qkv_tp_3 -->
<g id="node54" class="node">
<title>stage0_layer1_qkv_tp_3</title>
<polygon fill="lightcoral" stroke="black" points="6153.5,-5627.17 5646.5,-5627.17 5646.5,-5529.17 6153.5,-5529.17 6153.5,-5627.17"/>
<text text-anchor="middle" x="5900" y="-5611.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5900" y="-5596.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="5900" y="-5581.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="5900" y="-5566.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5900" y="-5551.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5900" y="-5536.97" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- stage0_layer1_ln1&#45;&gt;stage0_layer1_qkv_tp_3 -->
<g id="edge86" class="edge">
<title>stage0_layer1_ln1&#45;&gt;stage0_layer1_qkv_tp_3</title>
<path fill="none" stroke="black" d="M6195.97,-5676C6167.23,-5676 6147.67,-5676 6147.67,-5676 6147.67,-5676 6147.67,-5637.37 6147.67,-5637.37"/>
<polygon fill="black" stroke="black" points="6151.17,-5637.37 6147.67,-5627.37 6144.17,-5637.37 6151.17,-5637.37"/>
</g>
<!-- stage0_layer1_qkv_tp_4 -->
<g id="node55" class="node">
<title>stage0_layer1_qkv_tp_4</title>
<polygon fill="lightcoral" stroke="black" points="6678.5,-5627.17 6171.5,-5627.17 6171.5,-5529.17 6678.5,-5529.17 6678.5,-5627.17"/>
<text text-anchor="middle" x="6425" y="-5611.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="6425" y="-5596.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="6425" y="-5581.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="6425" y="-5566.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6425" y="-5551.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6425" y="-5536.97" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- stage0_layer1_ln1&#45;&gt;stage0_layer1_qkv_tp_4 -->
<g id="edge90" class="edge">
<title>stage0_layer1_ln1&#45;&gt;stage0_layer1_qkv_tp_4</title>
<path fill="none" stroke="black" d="M6425,-5663.07C6425,-5663.07 6425,-5637.35 6425,-5637.35"/>
<polygon fill="black" stroke="black" points="6428.5,-5637.35 6425,-5627.35 6421.5,-5637.35 6428.5,-5637.35"/>
</g>
<!-- stage0_layer1_qkv_tp_5 -->
<g id="node56" class="node">
<title>stage0_layer1_qkv_tp_5</title>
<polygon fill="lightcoral" stroke="black" points="7203.5,-5627.17 6696.5,-5627.17 6696.5,-5529.17 7203.5,-5529.17 7203.5,-5627.17"/>
<text text-anchor="middle" x="6950" y="-5611.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="6950" y="-5596.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="6950" y="-5581.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="6950" y="-5566.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6950" y="-5551.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6950" y="-5536.97" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- stage0_layer1_ln1&#45;&gt;stage0_layer1_qkv_tp_5 -->
<g id="edge94" class="edge">
<title>stage0_layer1_ln1&#45;&gt;stage0_layer1_qkv_tp_5</title>
<path fill="none" stroke="black" d="M6654.35,-5676C6778.3,-5676 6906.25,-5676 6906.25,-5676 6906.25,-5676 6906.25,-5637.37 6906.25,-5637.37"/>
<polygon fill="black" stroke="black" points="6909.75,-5637.37 6906.25,-5627.37 6902.75,-5637.37 6909.75,-5637.37"/>
</g>
<!-- stage0_layer1_qkv_tp_6 -->
<g id="node57" class="node">
<title>stage0_layer1_qkv_tp_6</title>
<polygon fill="lightcoral" stroke="black" points="7728.5,-5627.17 7221.5,-5627.17 7221.5,-5529.17 7728.5,-5529.17 7728.5,-5627.17"/>
<text text-anchor="middle" x="7475" y="-5611.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="7475" y="-5596.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="7475" y="-5581.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="7475" y="-5566.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7475" y="-5551.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="7475" y="-5536.97" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- stage0_layer1_ln1&#45;&gt;stage0_layer1_qkv_tp_6 -->
<g id="edge98" class="edge">
<title>stage0_layer1_ln1&#45;&gt;stage0_layer1_qkv_tp_6</title>
<path fill="none" stroke="black" d="M6654.13,-5690C6963.08,-5690 7475,-5690 7475,-5690 7475,-5690 7475,-5637.22 7475,-5637.22"/>
<polygon fill="black" stroke="black" points="7478.5,-5637.22 7475,-5627.22 7471.5,-5637.22 7478.5,-5637.22"/>
</g>
<!-- stage0_layer1_qkv_tp_7 -->
<g id="node58" class="node">
<title>stage0_layer1_qkv_tp_7</title>
<polygon fill="lightcoral" stroke="black" points="8253.5,-5627.17 7746.5,-5627.17 7746.5,-5529.17 8253.5,-5529.17 8253.5,-5627.17"/>
<text text-anchor="middle" x="8000" y="-5611.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="8000" y="-5596.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="8000" y="-5581.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="8000" y="-5566.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="8000" y="-5551.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="8000" y="-5536.97" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- stage0_layer1_ln1&#45;&gt;stage0_layer1_qkv_tp_7 -->
<g id="edge102" class="edge">
<title>stage0_layer1_ln1&#45;&gt;stage0_layer1_qkv_tp_7</title>
<path fill="none" stroke="black" d="M6654.19,-5703C7066.15,-5703 7889.25,-5703 7889.25,-5703 7889.25,-5703 7889.25,-5637.5 7889.25,-5637.5"/>
<polygon fill="black" stroke="black" points="7892.75,-5637.5 7889.25,-5627.5 7885.75,-5637.5 7892.75,-5637.5"/>
</g>
<!-- stage0_layer1_attn_tp_0 -->
<g id="node59" class="node">
<title>stage0_layer1_attn_tp_0</title>
<polygon fill="lightcoral" stroke="black" points="4578.5,-5493.17 4071.5,-5493.17 4071.5,-5395.17 4578.5,-5395.17 4578.5,-5493.17"/>
<text text-anchor="middle" x="4325" y="-5477.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="4325" y="-5462.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="4325" y="-5447.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="4325" y="-5432.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4325" y="-5417.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4325" y="-5402.97" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- stage0_layer1_qkv_tp_0&#45;&gt;stage0_layer1_attn_tp_0 -->
<g id="edge75" class="edge">
<title>stage0_layer1_qkv_tp_0&#45;&gt;stage0_layer1_attn_tp_0</title>
<path fill="none" stroke="black" d="M4325,-5529.03C4325,-5529.03 4325,-5503.3 4325,-5503.3"/>
<polygon fill="black" stroke="black" points="4328.5,-5503.3 4325,-5493.3 4321.5,-5503.3 4328.5,-5503.3"/>
</g>
<!-- stage0_layer1_attn_tp_1 -->
<g id="node60" class="node">
<title>stage0_layer1_attn_tp_1</title>
<polygon fill="lightcoral" stroke="black" points="5103.5,-5493.17 4596.5,-5493.17 4596.5,-5395.17 5103.5,-5395.17 5103.5,-5493.17"/>
<text text-anchor="middle" x="4850" y="-5477.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="4850" y="-5462.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="4850" y="-5447.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="4850" y="-5432.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4850" y="-5417.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4850" y="-5402.97" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- stage0_layer1_qkv_tp_1&#45;&gt;stage0_layer1_attn_tp_1 -->
<g id="edge79" class="edge">
<title>stage0_layer1_qkv_tp_1&#45;&gt;stage0_layer1_attn_tp_1</title>
<path fill="none" stroke="black" d="M4850,-5529.03C4850,-5529.03 4850,-5503.3 4850,-5503.3"/>
<polygon fill="black" stroke="black" points="4853.5,-5503.3 4850,-5493.3 4846.5,-5503.3 4853.5,-5503.3"/>
</g>
<!-- stage0_layer1_attn_tp_2 -->
<g id="node61" class="node">
<title>stage0_layer1_attn_tp_2</title>
<polygon fill="lightcoral" stroke="black" points="5628.5,-5493.17 5121.5,-5493.17 5121.5,-5395.17 5628.5,-5395.17 5628.5,-5493.17"/>
<text text-anchor="middle" x="5375" y="-5477.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="5375" y="-5462.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="5375" y="-5447.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="5375" y="-5432.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5375" y="-5417.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5375" y="-5402.97" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- stage0_layer1_qkv_tp_2&#45;&gt;stage0_layer1_attn_tp_2 -->
<g id="edge83" class="edge">
<title>stage0_layer1_qkv_tp_2&#45;&gt;stage0_layer1_attn_tp_2</title>
<path fill="none" stroke="black" d="M5375,-5529.03C5375,-5529.03 5375,-5503.3 5375,-5503.3"/>
<polygon fill="black" stroke="black" points="5378.5,-5503.3 5375,-5493.3 5371.5,-5503.3 5378.5,-5503.3"/>
</g>
<!-- stage0_layer1_attn_tp_3 -->
<g id="node62" class="node">
<title>stage0_layer1_attn_tp_3</title>
<polygon fill="lightcoral" stroke="black" points="6153.5,-5493.17 5646.5,-5493.17 5646.5,-5395.17 6153.5,-5395.17 6153.5,-5493.17"/>
<text text-anchor="middle" x="5900" y="-5477.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="5900" y="-5462.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="5900" y="-5447.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="5900" y="-5432.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5900" y="-5417.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5900" y="-5402.97" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- stage0_layer1_qkv_tp_3&#45;&gt;stage0_layer1_attn_tp_3 -->
<g id="edge87" class="edge">
<title>stage0_layer1_qkv_tp_3&#45;&gt;stage0_layer1_attn_tp_3</title>
<path fill="none" stroke="black" d="M5900,-5529.03C5900,-5529.03 5900,-5503.3 5900,-5503.3"/>
<polygon fill="black" stroke="black" points="5903.5,-5503.3 5900,-5493.3 5896.5,-5503.3 5903.5,-5503.3"/>
</g>
<!-- stage0_layer1_attn_tp_4 -->
<g id="node63" class="node">
<title>stage0_layer1_attn_tp_4</title>
<polygon fill="lightcoral" stroke="black" points="6678.5,-5493.17 6171.5,-5493.17 6171.5,-5395.17 6678.5,-5395.17 6678.5,-5493.17"/>
<text text-anchor="middle" x="6425" y="-5477.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="6425" y="-5462.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="6425" y="-5447.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="6425" y="-5432.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6425" y="-5417.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6425" y="-5402.97" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- stage0_layer1_qkv_tp_4&#45;&gt;stage0_layer1_attn_tp_4 -->
<g id="edge91" class="edge">
<title>stage0_layer1_qkv_tp_4&#45;&gt;stage0_layer1_attn_tp_4</title>
<path fill="none" stroke="black" d="M6425,-5529.03C6425,-5529.03 6425,-5503.3 6425,-5503.3"/>
<polygon fill="black" stroke="black" points="6428.5,-5503.3 6425,-5493.3 6421.5,-5503.3 6428.5,-5503.3"/>
</g>
<!-- stage0_layer1_attn_tp_5 -->
<g id="node64" class="node">
<title>stage0_layer1_attn_tp_5</title>
<polygon fill="lightcoral" stroke="black" points="7203.5,-5493.17 6696.5,-5493.17 6696.5,-5395.17 7203.5,-5395.17 7203.5,-5493.17"/>
<text text-anchor="middle" x="6950" y="-5477.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="6950" y="-5462.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="6950" y="-5447.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="6950" y="-5432.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6950" y="-5417.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6950" y="-5402.97" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- stage0_layer1_qkv_tp_5&#45;&gt;stage0_layer1_attn_tp_5 -->
<g id="edge95" class="edge">
<title>stage0_layer1_qkv_tp_5&#45;&gt;stage0_layer1_attn_tp_5</title>
<path fill="none" stroke="black" d="M6950,-5529.03C6950,-5529.03 6950,-5503.3 6950,-5503.3"/>
<polygon fill="black" stroke="black" points="6953.5,-5503.3 6950,-5493.3 6946.5,-5503.3 6953.5,-5503.3"/>
</g>
<!-- stage0_layer1_attn_tp_6 -->
<g id="node65" class="node">
<title>stage0_layer1_attn_tp_6</title>
<polygon fill="lightcoral" stroke="black" points="7728.5,-5493.17 7221.5,-5493.17 7221.5,-5395.17 7728.5,-5395.17 7728.5,-5493.17"/>
<text text-anchor="middle" x="7475" y="-5477.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="7475" y="-5462.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="7475" y="-5447.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="7475" y="-5432.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="7475" y="-5417.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="7475" y="-5402.97" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- stage0_layer1_qkv_tp_6&#45;&gt;stage0_layer1_attn_tp_6 -->
<g id="edge99" class="edge">
<title>stage0_layer1_qkv_tp_6&#45;&gt;stage0_layer1_attn_tp_6</title>
<path fill="none" stroke="black" d="M7475,-5529.03C7475,-5529.03 7475,-5503.3 7475,-5503.3"/>
<polygon fill="black" stroke="black" points="7478.5,-5503.3 7475,-5493.3 7471.5,-5503.3 7478.5,-5503.3"/>
</g>
<!-- stage0_layer1_attn_tp_7 -->
<g id="node66" class="node">
<title>stage0_layer1_attn_tp_7</title>
<polygon fill="lightcoral" stroke="black" points="8253.5,-5493.17 7746.5,-5493.17 7746.5,-5395.17 8253.5,-5395.17 8253.5,-5493.17"/>
<text text-anchor="middle" x="8000" y="-5477.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="8000" y="-5462.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="8000" y="-5447.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="8000" y="-5432.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="8000" y="-5417.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="8000" y="-5402.97" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- stage0_layer1_qkv_tp_7&#45;&gt;stage0_layer1_attn_tp_7 -->
<g id="edge103" class="edge">
<title>stage0_layer1_qkv_tp_7&#45;&gt;stage0_layer1_attn_tp_7</title>
<path fill="none" stroke="black" d="M8000,-5529.03C8000,-5529.03 8000,-5503.3 8000,-5503.3"/>
<polygon fill="black" stroke="black" points="8003.5,-5503.3 8000,-5493.3 7996.5,-5503.3 8003.5,-5503.3"/>
</g>
<!-- stage0_layer1_attn_out_tp_0 -->
<g id="node67" class="node">
<title>stage0_layer1_attn_out_tp_0</title>
<polygon fill="lightcoral" stroke="black" points="4583.5,-5359.17 4088.5,-5359.17 4088.5,-5276.17 4583.5,-5276.17 4583.5,-5359.17"/>
<text text-anchor="middle" x="4336" y="-5343.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4336" y="-5328.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="4336" y="-5313.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4336" y="-5298.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4336" y="-5283.97" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- stage0_layer1_attn_tp_0&#45;&gt;stage0_layer1_attn_out_tp_0 -->
<g id="edge76" class="edge">
<title>stage0_layer1_attn_tp_0&#45;&gt;stage0_layer1_attn_out_tp_0</title>
<path fill="none" stroke="black" d="M4333.5,-5394.9C4333.5,-5394.9 4333.5,-5369.22 4333.5,-5369.22"/>
<polygon fill="black" stroke="black" points="4337,-5369.22 4333.5,-5359.22 4330,-5369.22 4337,-5369.22"/>
</g>
<!-- stage0_layer1_attn_out_tp_1 -->
<g id="node68" class="node">
<title>stage0_layer1_attn_out_tp_1</title>
<polygon fill="lightcoral" stroke="black" points="5107.5,-5359.17 4612.5,-5359.17 4612.5,-5276.17 5107.5,-5276.17 5107.5,-5359.17"/>
<text text-anchor="middle" x="4860" y="-5343.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4860" y="-5328.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="4860" y="-5313.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4860" y="-5298.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4860" y="-5283.97" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- stage0_layer1_attn_tp_1&#45;&gt;stage0_layer1_attn_out_tp_1 -->
<g id="edge80" class="edge">
<title>stage0_layer1_attn_tp_1&#45;&gt;stage0_layer1_attn_out_tp_1</title>
<path fill="none" stroke="black" d="M4858,-5394.9C4858,-5394.9 4858,-5369.22 4858,-5369.22"/>
<polygon fill="black" stroke="black" points="4861.5,-5369.22 4858,-5359.22 4854.5,-5369.22 4861.5,-5369.22"/>
</g>
<!-- stage0_layer1_attn_out_tp_2 -->
<g id="node69" class="node">
<title>stage0_layer1_attn_out_tp_2</title>
<polygon fill="lightcoral" stroke="black" points="5631.5,-5359.17 5136.5,-5359.17 5136.5,-5276.17 5631.5,-5276.17 5631.5,-5359.17"/>
<text text-anchor="middle" x="5384" y="-5343.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="5384" y="-5328.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="5384" y="-5313.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5384" y="-5298.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5384" y="-5283.97" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- stage0_layer1_attn_tp_2&#45;&gt;stage0_layer1_attn_out_tp_2 -->
<g id="edge84" class="edge">
<title>stage0_layer1_attn_tp_2&#45;&gt;stage0_layer1_attn_out_tp_2</title>
<path fill="none" stroke="black" d="M5382.5,-5394.9C5382.5,-5394.9 5382.5,-5369.22 5382.5,-5369.22"/>
<polygon fill="black" stroke="black" points="5386,-5369.22 5382.5,-5359.22 5379,-5369.22 5386,-5369.22"/>
</g>
<!-- stage0_layer1_attn_out_tp_3 -->
<g id="node70" class="node">
<title>stage0_layer1_attn_out_tp_3</title>
<polygon fill="lightcoral" stroke="black" points="6153.5,-5359.17 5658.5,-5359.17 5658.5,-5276.17 6153.5,-5276.17 6153.5,-5359.17"/>
<text text-anchor="middle" x="5906" y="-5343.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="5906" y="-5328.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="5906" y="-5313.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5906" y="-5298.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5906" y="-5283.97" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- stage0_layer1_attn_tp_3&#45;&gt;stage0_layer1_attn_out_tp_3 -->
<g id="edge88" class="edge">
<title>stage0_layer1_attn_tp_3&#45;&gt;stage0_layer1_attn_out_tp_3</title>
<path fill="none" stroke="black" d="M5906,-5394.9C5906,-5394.9 5906,-5369.22 5906,-5369.22"/>
<polygon fill="black" stroke="black" points="5909.5,-5369.22 5906,-5359.22 5902.5,-5369.22 5909.5,-5369.22"/>
</g>
<!-- stage0_layer1_attn_out_tp_4 -->
<g id="node71" class="node">
<title>stage0_layer1_attn_out_tp_4</title>
<polygon fill="lightcoral" stroke="black" points="6672.5,-5359.17 6177.5,-5359.17 6177.5,-5276.17 6672.5,-5276.17 6672.5,-5359.17"/>
<text text-anchor="middle" x="6425" y="-5343.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="6425" y="-5328.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="6425" y="-5313.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6425" y="-5298.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6425" y="-5283.97" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- stage0_layer1_attn_tp_4&#45;&gt;stage0_layer1_attn_out_tp_4 -->
<g id="edge92" class="edge">
<title>stage0_layer1_attn_tp_4&#45;&gt;stage0_layer1_attn_out_tp_4</title>
<path fill="none" stroke="black" d="M6425,-5394.9C6425,-5394.9 6425,-5369.22 6425,-5369.22"/>
<polygon fill="black" stroke="black" points="6428.5,-5369.22 6425,-5359.22 6421.5,-5369.22 6428.5,-5369.22"/>
</g>
<!-- stage0_layer1_attn_out_tp_5 -->
<g id="node72" class="node">
<title>stage0_layer1_attn_out_tp_5</title>
<polygon fill="lightcoral" stroke="black" points="7191.5,-5359.17 6696.5,-5359.17 6696.5,-5276.17 7191.5,-5276.17 7191.5,-5359.17"/>
<text text-anchor="middle" x="6944" y="-5343.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="6944" y="-5328.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="6944" y="-5313.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6944" y="-5298.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6944" y="-5283.97" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- stage0_layer1_attn_tp_5&#45;&gt;stage0_layer1_attn_out_tp_5 -->
<g id="edge96" class="edge">
<title>stage0_layer1_attn_tp_5&#45;&gt;stage0_layer1_attn_out_tp_5</title>
<path fill="none" stroke="black" d="M6944,-5394.9C6944,-5394.9 6944,-5369.22 6944,-5369.22"/>
<polygon fill="black" stroke="black" points="6947.5,-5369.22 6944,-5359.22 6940.5,-5369.22 6947.5,-5369.22"/>
</g>
<!-- stage0_layer1_attn_out_tp_6 -->
<g id="node73" class="node">
<title>stage0_layer1_attn_out_tp_6</title>
<polygon fill="lightcoral" stroke="black" points="7713.5,-5359.17 7218.5,-5359.17 7218.5,-5276.17 7713.5,-5276.17 7713.5,-5359.17"/>
<text text-anchor="middle" x="7466" y="-5343.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="7466" y="-5328.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="7466" y="-5313.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="7466" y="-5298.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7466" y="-5283.97" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- stage0_layer1_attn_tp_6&#45;&gt;stage0_layer1_attn_out_tp_6 -->
<g id="edge100" class="edge">
<title>stage0_layer1_attn_tp_6&#45;&gt;stage0_layer1_attn_out_tp_6</title>
<path fill="none" stroke="black" d="M7467.5,-5394.9C7467.5,-5394.9 7467.5,-5369.22 7467.5,-5369.22"/>
<polygon fill="black" stroke="black" points="7471,-5369.22 7467.5,-5359.22 7464,-5369.22 7471,-5369.22"/>
</g>
<!-- stage0_layer1_attn_out_tp_7 -->
<g id="node74" class="node">
<title>stage0_layer1_attn_out_tp_7</title>
<polygon fill="lightcoral" stroke="black" points="8237.5,-5359.17 7742.5,-5359.17 7742.5,-5276.17 8237.5,-5276.17 8237.5,-5359.17"/>
<text text-anchor="middle" x="7990" y="-5343.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="7990" y="-5328.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="7990" y="-5313.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="7990" y="-5298.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7990" y="-5283.97" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- stage0_layer1_attn_tp_7&#45;&gt;stage0_layer1_attn_out_tp_7 -->
<g id="edge104" class="edge">
<title>stage0_layer1_attn_tp_7&#45;&gt;stage0_layer1_attn_out_tp_7</title>
<path fill="none" stroke="black" d="M7992,-5394.9C7992,-5394.9 7992,-5369.22 7992,-5369.22"/>
<polygon fill="black" stroke="black" points="7995.5,-5369.22 7992,-5359.22 7988.5,-5369.22 7995.5,-5369.22"/>
</g>
<!-- stage0_layer1_attn_allreduce -->
<g id="node75" class="node">
<title>stage0_layer1_attn_allreduce</title>
<polygon fill="lightyellow" stroke="black" points="6899.67,-5240.17 6144.58,-5240.17 5950.33,-5104.17 6705.42,-5104.17 6899.67,-5240.17"/>
<text text-anchor="middle" x="6425" y="-5190.97" font-family="Times,serif" font-size="14.00">Attention All&#45;Reduce</text>
<text text-anchor="middle" x="6425" y="-5175.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6425" y="-5160.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6425" y="-5145.97" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- stage0_layer1_attn_out_tp_0&#45;&gt;stage0_layer1_attn_allreduce -->
<g id="edge77" class="edge">
<title>stage0_layer1_attn_out_tp_0&#45;&gt;stage0_layer1_attn_allreduce</title>
<path fill="none" stroke="black" d="M4529.48,-5276C4529.48,-5222.92 4529.48,-5138 4529.48,-5138 4529.48,-5138 5988.43,-5138 5988.43,-5138"/>
<polygon fill="black" stroke="black" points="5988.43,-5141.5 5998.43,-5138 5988.43,-5134.5 5988.43,-5141.5"/>
</g>
<!-- stage0_layer1_attn_out_tp_1&#45;&gt;stage0_layer1_attn_allreduce -->
<g id="edge81" class="edge">
<title>stage0_layer1_attn_out_tp_1&#45;&gt;stage0_layer1_attn_allreduce</title>
<path fill="none" stroke="black" d="M4860,-5275.92C4860,-5232.88 4860,-5172 4860,-5172 4860,-5172 6037.15,-5172 6037.15,-5172"/>
<polygon fill="black" stroke="black" points="6037.15,-5175.5 6047.15,-5172 6037.15,-5168.5 6037.15,-5175.5"/>
</g>
<!-- stage0_layer1_attn_out_tp_2&#45;&gt;stage0_layer1_attn_allreduce -->
<g id="edge85" class="edge">
<title>stage0_layer1_attn_out_tp_2&#45;&gt;stage0_layer1_attn_allreduce</title>
<path fill="none" stroke="black" d="M5520.02,-5276.09C5520.02,-5244.34 5520.02,-5206 5520.02,-5206 5520.02,-5206 6085.72,-5206 6085.72,-5206"/>
<polygon fill="black" stroke="black" points="6085.72,-5209.5 6095.72,-5206 6085.72,-5202.5 6085.72,-5209.5"/>
</g>
<!-- stage0_layer1_attn_out_tp_3&#45;&gt;stage0_layer1_attn_allreduce -->
<g id="edge89" class="edge">
<title>stage0_layer1_attn_out_tp_3&#45;&gt;stage0_layer1_attn_allreduce</title>
<path fill="none" stroke="black" d="M6051.83,-5275.97C6051.83,-5275.97 6051.83,-5185.56 6051.83,-5185.56"/>
<polygon fill="black" stroke="black" points="6055.33,-5185.56 6051.83,-5175.56 6048.33,-5185.56 6055.33,-5185.56"/>
</g>
<!-- stage0_layer1_attn_out_tp_4&#45;&gt;stage0_layer1_attn_allreduce -->
<g id="edge93" class="edge">
<title>stage0_layer1_attn_out_tp_4&#45;&gt;stage0_layer1_attn_allreduce</title>
<path fill="none" stroke="black" d="M6425,-5275.97C6425,-5275.97 6425,-5250.24 6425,-5250.24"/>
<polygon fill="black" stroke="black" points="6428.5,-5250.24 6425,-5240.24 6421.5,-5250.24 6428.5,-5250.24"/>
</g>
<!-- stage0_layer1_attn_out_tp_5&#45;&gt;stage0_layer1_attn_allreduce -->
<g id="edge97" class="edge">
<title>stage0_layer1_attn_out_tp_5&#45;&gt;stage0_layer1_attn_allreduce</title>
<path fill="none" stroke="black" d="M6798.17,-5275.97C6798.17,-5275.97 6798.17,-5250.24 6798.17,-5250.24"/>
<polygon fill="black" stroke="black" points="6801.67,-5250.24 6798.17,-5240.24 6794.67,-5250.24 6801.67,-5250.24"/>
</g>
<!-- stage0_layer1_attn_out_tp_6&#45;&gt;stage0_layer1_attn_allreduce -->
<g id="edge101" class="edge">
<title>stage0_layer1_attn_out_tp_6&#45;&gt;stage0_layer1_attn_allreduce</title>
<path fill="none" stroke="black" d="M7379.25,-5276.09C7379.25,-5244.34 7379.25,-5206 7379.25,-5206 7379.25,-5206 6861.19,-5206 6861.19,-5206"/>
<polygon fill="black" stroke="black" points="6861.19,-5202.5 6851.19,-5206 6861.19,-5209.5 6861.19,-5202.5"/>
</g>
<!-- stage0_layer1_attn_out_tp_7&#45;&gt;stage0_layer1_attn_allreduce -->
<g id="edge105" class="edge">
<title>stage0_layer1_attn_out_tp_7&#45;&gt;stage0_layer1_attn_allreduce</title>
<path fill="none" stroke="black" d="M7990,-5275.92C7990,-5232.88 7990,-5172 7990,-5172 7990,-5172 6812.35,-5172 6812.35,-5172"/>
<polygon fill="black" stroke="black" points="6812.35,-5168.5 6802.35,-5172 6812.35,-5175.5 6812.35,-5168.5"/>
</g>
<!-- stage0_layer1_attn_allreduce&#45;&gt;stage0_layer1_residual1 -->
<g id="edge106" class="edge">
<title>stage0_layer1_attn_allreduce&#45;&gt;stage0_layer1_residual1</title>
<path fill="none" stroke="black" d="M6754.01,-5138C7114.97,-5138 7643.75,-5138 7643.75,-5138 7643.75,-5138 7643.75,-5007.93 7643.75,-5007.93"/>
<polygon fill="black" stroke="black" points="7647.25,-5007.93 7643.75,-4997.93 7640.25,-5007.93 7647.25,-5007.93"/>
</g>
<!-- stage0_layer1_ln2 -->
<g id="node77" class="node">
<title>stage0_layer1_ln2</title>
<polygon fill="lightgreen" stroke="black" points="6716,-4866.17 6258,-4866.17 6258,-4798.17 6716,-4798.17 6716,-4866.17"/>
<text text-anchor="middle" x="6487" y="-4850.97" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="6487" y="-4835.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6487" y="-4820.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6487" y="-4805.97" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- stage0_layer1_residual1&#45;&gt;stage0_layer1_ln2 -->
<g id="edge108" class="edge">
<title>stage0_layer1_residual1&#45;&gt;stage0_layer1_ln2</title>
<path fill="none" stroke="black" d="M7794,-4944.92C7794,-4899.54 7794,-4832 7794,-4832 7794,-4832 6726.16,-4832 6726.16,-4832"/>
<polygon fill="black" stroke="black" points="6726.16,-4828.5 6716.16,-4832 6726.16,-4835.5 6726.16,-4828.5"/>
</g>
<!-- stage0_layer1_residual2 -->
<g id="node97" class="node">
<title>stage0_layer1_residual2</title>
<polygon fill="lightpink" stroke="black" points="6153,-4127.17 5695,-4044.17 6153,-3961.17 6611,-4044.17 6153,-4127.17"/>
<text text-anchor="middle" x="6153" y="-4070.47" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="6153" y="-4055.47" font-family="Times,serif" font-size="14.00">Input1: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6153" y="-4040.47" font-family="Times,serif" font-size="14.00">Input2: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6153" y="-4025.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6153" y="-4010.47" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- stage0_layer1_residual1&#45;&gt;stage0_layer1_residual2 -->
<g id="edge144" class="edge">
<title>stage0_layer1_residual1&#45;&gt;stage0_layer1_residual2</title>
<path fill="none" stroke="black" d="M8023,-4903.7C8023,-4675.06 8023,-4044 8023,-4044 8023,-4044 6620.15,-4044 6620.15,-4044"/>
<polygon fill="black" stroke="black" points="6620.15,-4040.5 6610.15,-4044 6620.15,-4047.5 6620.15,-4040.5"/>
</g>
<!-- stage0_layer1_gate -->
<g id="node78" class="node">
<title>stage0_layer1_gate</title>
<polygon fill="lightblue" stroke="black" points="5408.58,-4762.17 4666.36,-4762.17 4475.42,-4626.17 5217.64,-4626.17 5408.58,-4762.17"/>
<text text-anchor="middle" x="4942" y="-4712.97" font-family="Times,serif" font-size="14.00">Gate Computation</text>
<text text-anchor="middle" x="4942" y="-4697.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4942" y="-4682.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, num_experts=16]</text>
<text text-anchor="middle" x="4942" y="-4667.97" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- stage0_layer1_ln2&#45;&gt;stage0_layer1_gate -->
<g id="edge109" class="edge">
<title>stage0_layer1_ln2&#45;&gt;stage0_layer1_gate</title>
<path fill="none" stroke="black" d="M6257.85,-4832C5905.9,-4832 5272.52,-4832 5272.52,-4832 5272.52,-4832 5272.52,-4772.28 5272.52,-4772.28"/>
<polygon fill="black" stroke="black" points="5276.02,-4772.28 5272.52,-4762.28 5269.02,-4772.28 5276.02,-4772.28"/>
</g>
<!-- stage0_layer1_expert_0_tp_0 -->
<g id="node79" class="node">
<title>stage0_layer1_expert_0_tp_0</title>
<polygon fill="lightsteelblue" stroke="black" points="1378,-4590.17 922,-4590.17 922,-4507.17 1378,-4507.17 1378,-4590.17"/>
<text text-anchor="middle" x="1150" y="-4574.97" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1150" y="-4559.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="1150" y="-4544.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="1150" y="-4529.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="1150" y="-4514.97" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- stage0_layer1_gate&#45;&gt;stage0_layer1_expert_0_tp_0 -->
<g id="edge110" class="edge">
<title>stage0_layer1_gate&#45;&gt;stage0_layer1_expert_0_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4642.1,-4745C3733.68,-4745 1074,-4745 1074,-4745 1074,-4745 1074,-4600.3 1074,-4600.3"/>
<polygon fill="black" stroke="black" points="1077.5,-4600.3 1074,-4590.3 1070.5,-4600.3 1077.5,-4600.3"/>
</g>
<!-- stage0_layer1_expert_1_tp_0 -->
<g id="node80" class="node">
<title>stage0_layer1_expert_1_tp_0</title>
<polygon fill="lightsteelblue" stroke="black" points="1852,-4590.17 1396,-4590.17 1396,-4507.17 1852,-4507.17 1852,-4590.17"/>
<text text-anchor="middle" x="1624" y="-4574.97" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1624" y="-4559.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="1624" y="-4544.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="1624" y="-4529.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="1624" y="-4514.97" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- stage0_layer1_gate&#45;&gt;stage0_layer1_expert_1_tp_0 -->
<g id="edge111" class="edge">
<title>stage0_layer1_gate&#45;&gt;stage0_layer1_expert_1_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4618.11,-4728C3769.76,-4728 1548,-4728 1548,-4728 1548,-4728 1548,-4600.26 1548,-4600.26"/>
<polygon fill="black" stroke="black" points="1551.5,-4600.26 1548,-4590.26 1544.5,-4600.26 1551.5,-4600.26"/>
</g>
<!-- stage0_layer1_expert_2_tp_1 -->
<g id="node81" class="node">
<title>stage0_layer1_expert_2_tp_1</title>
<polygon fill="lightsteelblue" stroke="black" points="2326,-4590.17 1870,-4590.17 1870,-4507.17 2326,-4507.17 2326,-4590.17"/>
<text text-anchor="middle" x="2098" y="-4574.97" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2098" y="-4559.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="2098" y="-4544.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="2098" y="-4529.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="2098" y="-4514.97" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- stage0_layer1_gate&#45;&gt;stage0_layer1_expert_2_tp_1 -->
<g id="edge114" class="edge">
<title>stage0_layer1_gate&#45;&gt;stage0_layer1_expert_2_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4594.49,-4711C3820.41,-4711 2022,-4711 2022,-4711 2022,-4711 2022,-4600.47 2022,-4600.47"/>
<polygon fill="black" stroke="black" points="2025.5,-4600.47 2022,-4590.47 2018.5,-4600.47 2025.5,-4600.47"/>
</g>
<!-- stage0_layer1_expert_3_tp_1 -->
<g id="node82" class="node">
<title>stage0_layer1_expert_3_tp_1</title>
<polygon fill="lightsteelblue" stroke="black" points="2800,-4590.17 2344,-4590.17 2344,-4507.17 2800,-4507.17 2800,-4590.17"/>
<text text-anchor="middle" x="2572" y="-4574.97" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2572" y="-4559.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="2572" y="-4544.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="2572" y="-4529.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="2572" y="-4514.97" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- stage0_layer1_gate&#45;&gt;stage0_layer1_expert_3_tp_1 -->
<g id="edge115" class="edge">
<title>stage0_layer1_gate&#45;&gt;stage0_layer1_expert_3_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4570.51,-4694C3886.24,-4694 2496,-4694 2496,-4694 2496,-4694 2496,-4600.31 2496,-4600.31"/>
<polygon fill="black" stroke="black" points="2499.5,-4600.31 2496,-4590.31 2492.5,-4600.31 2499.5,-4600.31"/>
</g>
<!-- stage0_layer1_expert_4_tp_2 -->
<g id="node83" class="node">
<title>stage0_layer1_expert_4_tp_2</title>
<polygon fill="lightsteelblue" stroke="black" points="3274,-4590.17 2818,-4590.17 2818,-4507.17 3274,-4507.17 3274,-4590.17"/>
<text text-anchor="middle" x="3046" y="-4574.97" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="3046" y="-4559.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="3046" y="-4544.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3046" y="-4529.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="3046" y="-4514.97" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- stage0_layer1_gate&#45;&gt;stage0_layer1_expert_4_tp_2 -->
<g id="edge118" class="edge">
<title>stage0_layer1_gate&#45;&gt;stage0_layer1_expert_4_tp_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4546.79,-4677C3971.17,-4677 2970,-4677 2970,-4677 2970,-4677 2970,-4600.33 2970,-4600.33"/>
<polygon fill="black" stroke="black" points="2973.5,-4600.33 2970,-4590.33 2966.5,-4600.33 2973.5,-4600.33"/>
</g>
<!-- stage0_layer1_expert_5_tp_2 -->
<g id="node84" class="node">
<title>stage0_layer1_expert_5_tp_2</title>
<polygon fill="lightsteelblue" stroke="black" points="3748,-4590.17 3292,-4590.17 3292,-4507.17 3748,-4507.17 3748,-4590.17"/>
<text text-anchor="middle" x="3520" y="-4574.97" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="3520" y="-4559.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="3520" y="-4544.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3520" y="-4529.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="3520" y="-4514.97" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- stage0_layer1_gate&#45;&gt;stage0_layer1_expert_5_tp_2 -->
<g id="edge119" class="edge">
<title>stage0_layer1_gate&#45;&gt;stage0_layer1_expert_5_tp_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4522.73,-4660C4079.57,-4660 3444,-4660 3444,-4660 3444,-4660 3444,-4600.44 3444,-4600.44"/>
<polygon fill="black" stroke="black" points="3447.5,-4600.44 3444,-4590.44 3440.5,-4600.44 3447.5,-4600.44"/>
</g>
<!-- stage0_layer1_expert_6_tp_3 -->
<g id="node85" class="node">
<title>stage0_layer1_expert_6_tp_3</title>
<polygon fill="lightsteelblue" stroke="black" points="4222,-4590.17 3766,-4590.17 3766,-4507.17 4222,-4507.17 4222,-4590.17"/>
<text text-anchor="middle" x="3994" y="-4574.97" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="3994" y="-4559.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="3994" y="-4544.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3994" y="-4529.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="3994" y="-4514.97" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- stage0_layer1_gate&#45;&gt;stage0_layer1_expert_6_tp_3 -->
<g id="edge122" class="edge">
<title>stage0_layer1_gate&#45;&gt;stage0_layer1_expert_6_tp_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4498.9,-4643C4320.11,-4643 4155.25,-4643 4155.25,-4643 4155.25,-4643 4155.25,-4600.32 4155.25,-4600.32"/>
<polygon fill="black" stroke="black" points="4158.75,-4600.32 4155.25,-4590.32 4151.75,-4600.32 4158.75,-4600.32"/>
</g>
<!-- stage0_layer1_expert_7_tp_3 -->
<g id="node86" class="node">
<title>stage0_layer1_expert_7_tp_3</title>
<polygon fill="lightsteelblue" stroke="black" points="4696,-4590.17 4240,-4590.17 4240,-4507.17 4696,-4507.17 4696,-4590.17"/>
<text text-anchor="middle" x="4468" y="-4574.97" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="4468" y="-4559.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="4468" y="-4544.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4468" y="-4529.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="4468" y="-4514.97" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- stage0_layer1_gate&#45;&gt;stage0_layer1_expert_7_tp_3 -->
<g id="edge123" class="edge">
<title>stage0_layer1_gate&#45;&gt;stage0_layer1_expert_7_tp_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4585.73,-4626.1C4585.73,-4626.1 4585.73,-4600.55 4585.73,-4600.55"/>
<polygon fill="black" stroke="black" points="4589.23,-4600.55 4585.73,-4590.55 4582.23,-4600.55 4589.23,-4600.55"/>
</g>
<!-- stage0_layer1_expert_8_tp_4 -->
<g id="node87" class="node">
<title>stage0_layer1_expert_8_tp_4</title>
<polygon fill="lightsteelblue" stroke="black" points="5170,-4590.17 4714,-4590.17 4714,-4507.17 5170,-4507.17 5170,-4590.17"/>
<text text-anchor="middle" x="4942" y="-4574.97" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="4942" y="-4559.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="4942" y="-4544.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4942" y="-4529.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="4942" y="-4514.97" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- stage0_layer1_gate&#45;&gt;stage0_layer1_expert_8_tp_4 -->
<g id="edge126" class="edge">
<title>stage0_layer1_gate&#45;&gt;stage0_layer1_expert_8_tp_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4942,-4626.1C4942,-4626.1 4942,-4600.55 4942,-4600.55"/>
<polygon fill="black" stroke="black" points="4945.5,-4600.55 4942,-4590.55 4938.5,-4600.55 4945.5,-4600.55"/>
</g>
<!-- stage0_layer1_expert_9_tp_4 -->
<g id="node88" class="node">
<title>stage0_layer1_expert_9_tp_4</title>
<polygon fill="lightsteelblue" stroke="black" points="5644,-4590.17 5188,-4590.17 5188,-4507.17 5644,-4507.17 5644,-4590.17"/>
<text text-anchor="middle" x="5416" y="-4574.97" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="5416" y="-4559.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="5416" y="-4544.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5416" y="-4529.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="5416" y="-4514.97" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- stage0_layer1_gate&#45;&gt;stage0_layer1_expert_9_tp_4 -->
<g id="edge127" class="edge">
<title>stage0_layer1_gate&#45;&gt;stage0_layer1_expert_9_tp_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5298.27,-4683.23C5298.27,-4683.23 5298.27,-4600.19 5298.27,-4600.19"/>
<polygon fill="black" stroke="black" points="5301.77,-4600.19 5298.27,-4590.19 5294.77,-4600.19 5301.77,-4600.19"/>
</g>
<!-- stage0_layer1_expert_10_tp_5 -->
<g id="node89" class="node">
<title>stage0_layer1_expert_10_tp_5</title>
<polygon fill="lightsteelblue" stroke="black" points="6118,-4590.17 5662,-4590.17 5662,-4507.17 6118,-4507.17 6118,-4590.17"/>
<text text-anchor="middle" x="5890" y="-4574.97" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="5890" y="-4559.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="5890" y="-4544.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5890" y="-4529.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="5890" y="-4514.97" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- stage0_layer1_gate&#45;&gt;stage0_layer1_expert_10_tp_5 -->
<g id="edge130" class="edge">
<title>stage0_layer1_gate&#45;&gt;stage0_layer1_expert_10_tp_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5244.21,-4645C5493.39,-4645 5806.08,-4645 5806.08,-4645 5806.08,-4645 5806.08,-4600.36 5806.08,-4600.36"/>
<polygon fill="black" stroke="black" points="5809.58,-4600.36 5806.08,-4590.36 5802.58,-4600.36 5809.58,-4600.36"/>
</g>
<!-- stage0_layer1_expert_11_tp_5 -->
<g id="node90" class="node">
<title>stage0_layer1_expert_11_tp_5</title>
<polygon fill="lightsteelblue" stroke="black" points="6592,-4590.17 6136,-4590.17 6136,-4507.17 6592,-4507.17 6592,-4590.17"/>
<text text-anchor="middle" x="6364" y="-4574.97" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="6364" y="-4559.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="6364" y="-4544.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6364" y="-4529.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="6364" y="-4514.97" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- stage0_layer1_gate&#45;&gt;stage0_layer1_expert_11_tp_5 -->
<g id="edge131" class="edge">
<title>stage0_layer1_gate&#45;&gt;stage0_layer1_expert_11_tp_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5272.56,-4665C5644.38,-4665 6197,-4665 6197,-4665 6197,-4665 6197,-4600.34 6197,-4600.34"/>
<polygon fill="black" stroke="black" points="6200.5,-4600.34 6197,-4590.34 6193.5,-4600.34 6200.5,-4600.34"/>
</g>
<!-- stage0_layer1_expert_12_tp_6 -->
<g id="node91" class="node">
<title>stage0_layer1_expert_12_tp_6</title>
<polygon fill="lightsteelblue" stroke="black" points="7066,-4590.17 6610,-4590.17 6610,-4507.17 7066,-4507.17 7066,-4590.17"/>
<text text-anchor="middle" x="6838" y="-4574.97" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="6838" y="-4559.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="6838" y="-4544.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6838" y="-4529.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="6838" y="-4514.97" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- stage0_layer1_gate&#45;&gt;stage0_layer1_expert_12_tp_6 -->
<g id="edge134" class="edge">
<title>stage0_layer1_gate&#45;&gt;stage0_layer1_expert_12_tp_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5298.85,-4684C5802.98,-4684 6663,-4684 6663,-4684 6663,-4684 6663,-4600.38 6663,-4600.38"/>
<polygon fill="black" stroke="black" points="6666.5,-4600.38 6663,-4590.38 6659.5,-4600.38 6666.5,-4600.38"/>
</g>
<!-- stage0_layer1_expert_13_tp_6 -->
<g id="node92" class="node">
<title>stage0_layer1_expert_13_tp_6</title>
<polygon fill="lightsteelblue" stroke="black" points="7540,-4590.17 7084,-4590.17 7084,-4507.17 7540,-4507.17 7540,-4590.17"/>
<text text-anchor="middle" x="7312" y="-4574.97" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="7312" y="-4559.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="7312" y="-4544.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7312" y="-4529.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="7312" y="-4514.97" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- stage0_layer1_gate&#45;&gt;stage0_layer1_expert_13_tp_6 -->
<g id="edge135" class="edge">
<title>stage0_layer1_gate&#45;&gt;stage0_layer1_expert_13_tp_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5325.73,-4703C5955.14,-4703 7137.75,-4703 7137.75,-4703 7137.75,-4703 7137.75,-4600.43 7137.75,-4600.43"/>
<polygon fill="black" stroke="black" points="7141.25,-4600.43 7137.75,-4590.43 7134.25,-4600.43 7141.25,-4600.43"/>
</g>
<!-- stage0_layer1_expert_14_tp_7 -->
<g id="node93" class="node">
<title>stage0_layer1_expert_14_tp_7</title>
<polygon fill="lightsteelblue" stroke="black" points="8014,-4590.17 7558,-4590.17 7558,-4507.17 8014,-4507.17 8014,-4590.17"/>
<text text-anchor="middle" x="7786" y="-4574.97" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="7786" y="-4559.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="7786" y="-4544.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7786" y="-4529.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="7786" y="-4514.97" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- stage0_layer1_gate&#45;&gt;stage0_layer1_expert_14_tp_7 -->
<g id="edge138" class="edge">
<title>stage0_layer1_gate&#45;&gt;stage0_layer1_expert_14_tp_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5353.8,-4723C6092.4,-4723 7566,-4723 7566,-4723 7566,-4723 7566,-4600.42 7566,-4600.42"/>
<polygon fill="black" stroke="black" points="7569.5,-4600.42 7566,-4590.42 7562.5,-4600.42 7569.5,-4600.42"/>
</g>
<!-- stage0_layer1_expert_15_tp_7 -->
<g id="node94" class="node">
<title>stage0_layer1_expert_15_tp_7</title>
<polygon fill="lightsteelblue" stroke="black" points="8488,-4590.17 8032,-4590.17 8032,-4507.17 8488,-4507.17 8488,-4590.17"/>
<text text-anchor="middle" x="8260" y="-4574.97" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="8260" y="-4559.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="8260" y="-4544.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="8260" y="-4529.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="8260" y="-4514.97" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- stage0_layer1_gate&#45;&gt;stage0_layer1_expert_15_tp_7 -->
<g id="edge139" class="edge">
<title>stage0_layer1_gate&#45;&gt;stage0_layer1_expert_15_tp_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5380.46,-4742C6282.04,-4742 8260,-4742 8260,-4742 8260,-4742 8260,-4600.62 8260,-4600.62"/>
<polygon fill="black" stroke="black" points="8263.5,-4600.62 8260,-4590.62 8256.5,-4600.62 8263.5,-4600.62"/>
</g>
<!-- stage0_layer1_expert_agg -->
<g id="node95" class="node">
<title>stage0_layer1_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="5416.67,-4471.17 4661.58,-4471.17 4467.33,-4335.17 5222.42,-4335.17 5416.67,-4471.17"/>
<text text-anchor="middle" x="4942" y="-4421.97" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4942" y="-4406.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, expert_dim=16384]</text>
<text text-anchor="middle" x="4942" y="-4391.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4942" y="-4376.97" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- stage0_layer1_expert_0_tp_0&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge112" class="edge">
<title>stage0_layer1_expert_0_tp_0&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M1175,-4506.96C1175,-4449.23 1175,-4352 1175,-4352 1175,-4352 4481.35,-4352 4481.35,-4352"/>
<polygon fill="black" stroke="black" points="4481.35,-4355.5 4491.35,-4352 4481.35,-4348.5 4481.35,-4355.5"/>
</g>
<!-- stage0_layer1_expert_1_tp_0&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge113" class="edge">
<title>stage0_layer1_expert_1_tp_0&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M1649,-4507C1649,-4453.92 1649,-4369 1649,-4369 1649,-4369 4505.29,-4369 4505.29,-4369"/>
<polygon fill="black" stroke="black" points="4505.29,-4372.5 4515.29,-4369 4505.29,-4365.5 4505.29,-4372.5"/>
</g>
<!-- stage0_layer1_expert_2_tp_1&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge116" class="edge">
<title>stage0_layer1_expert_2_tp_1&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M2123,-4506.78C2123,-4458.58 2123,-4386 2123,-4386 2123,-4386 4529.6,-4386 4529.6,-4386"/>
<polygon fill="black" stroke="black" points="4529.6,-4389.5 4539.6,-4386 4529.6,-4382.5 4529.6,-4389.5"/>
</g>
<!-- stage0_layer1_expert_3_tp_1&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge117" class="edge">
<title>stage0_layer1_expert_3_tp_1&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M2597,-4506.92C2597,-4463.88 2597,-4403 2597,-4403 2597,-4403 4553.93,-4403 4553.93,-4403"/>
<polygon fill="black" stroke="black" points="4553.93,-4406.5 4563.93,-4403 4553.93,-4399.5 4553.93,-4406.5"/>
</g>
<!-- stage0_layer1_expert_4_tp_2&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge120" class="edge">
<title>stage0_layer1_expert_4_tp_2&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M3072.75,-4506.89C3072.75,-4469.32 3072.75,-4420 3072.75,-4420 3072.75,-4420 4578.49,-4420 4578.49,-4420"/>
<polygon fill="black" stroke="black" points="4578.49,-4423.5 4588.49,-4420 4578.49,-4416.5 4578.49,-4423.5"/>
</g>
<!-- stage0_layer1_expert_5_tp_2&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge121" class="edge">
<title>stage0_layer1_expert_5_tp_2&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M3572.25,-4507.09C3572.25,-4475.34 3572.25,-4437 3572.25,-4437 3572.25,-4437 4602.6,-4437 4602.6,-4437"/>
<polygon fill="black" stroke="black" points="4602.6,-4440.5 4612.6,-4437 4602.6,-4433.5 4602.6,-4440.5"/>
</g>
<!-- stage0_layer1_expert_6_tp_3&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge124" class="edge">
<title>stage0_layer1_expert_6_tp_3&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M4071.75,-4507.14C4071.75,-4481.71 4071.75,-4454 4071.75,-4454 4071.75,-4454 4627.02,-4454 4627.02,-4454"/>
<polygon fill="black" stroke="black" points="4627.02,-4457.5 4637.02,-4454 4627.02,-4450.5 4627.02,-4457.5"/>
</g>
<!-- stage0_layer1_expert_7_tp_3&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge125" class="edge">
<title>stage0_layer1_expert_7_tp_3&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M4581.58,-4506.97C4581.58,-4506.97 4581.58,-4425.2 4581.58,-4425.2"/>
<polygon fill="black" stroke="black" points="4585.08,-4425.2 4581.58,-4415.2 4578.08,-4425.2 4585.08,-4425.2"/>
</g>
<!-- stage0_layer1_expert_8_tp_4&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge128" class="edge">
<title>stage0_layer1_expert_8_tp_4&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M4942,-4506.97C4942,-4506.97 4942,-4481.24 4942,-4481.24"/>
<polygon fill="black" stroke="black" points="4945.5,-4481.24 4942,-4471.24 4938.5,-4481.24 4945.5,-4481.24"/>
</g>
<!-- stage0_layer1_expert_9_tp_4&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge129" class="edge">
<title>stage0_layer1_expert_9_tp_4&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M5302.42,-4506.97C5302.42,-4506.97 5302.42,-4481.24 5302.42,-4481.24"/>
<polygon fill="black" stroke="black" points="5305.92,-4481.24 5302.42,-4471.24 5298.92,-4481.24 5305.92,-4481.24"/>
</g>
<!-- stage0_layer1_expert_10_tp_5&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge132" class="edge">
<title>stage0_layer1_expert_10_tp_5&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M5695.92,-4506.96C5695.92,-4480.42 5695.92,-4451 5695.92,-4451 5695.92,-4451 5397.91,-4451 5397.91,-4451"/>
<polygon fill="black" stroke="black" points="5397.91,-4447.5 5387.91,-4451 5397.91,-4454.5 5397.91,-4447.5"/>
</g>
<!-- stage0_layer1_expert_11_tp_5&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge133" class="edge">
<title>stage0_layer1_expert_11_tp_5&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M6364,-4506.88C6364,-4473.4 6364,-4432 6364,-4432 6364,-4432 5370.96,-4432 5370.96,-4432"/>
<polygon fill="black" stroke="black" points="5370.96,-4428.5 5360.96,-4432 5370.96,-4435.5 5370.96,-4428.5"/>
</g>
<!-- stage0_layer1_expert_12_tp_6&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge136" class="edge">
<title>stage0_layer1_expert_12_tp_6&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M6619.42,-4506.92C6619.42,-4466.73 6619.42,-4412 6619.42,-4412 6619.42,-4412 5342.37,-4412 5342.37,-4412"/>
<polygon fill="black" stroke="black" points="5342.37,-4408.5 5332.37,-4412 5342.37,-4415.5 5342.37,-4408.5"/>
</g>
<!-- stage0_layer1_expert_13_tp_6&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge137" class="edge">
<title>stage0_layer1_expert_13_tp_6&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M7100,-4506.95C7100,-4460.84 7100,-4393 7100,-4393 7100,-4393 5315.03,-4393 5315.03,-4393"/>
<polygon fill="black" stroke="black" points="5315.03,-4389.5 5305.03,-4393 5315.03,-4396.5 5315.03,-4389.5"/>
</g>
<!-- stage0_layer1_expert_14_tp_7&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge140" class="edge">
<title>stage0_layer1_expert_14_tp_7&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M7574,-4506.83C7574,-4455.16 7574,-4374 7574,-4374 7574,-4374 5288.02,-4374 5288.02,-4374"/>
<polygon fill="black" stroke="black" points="5288.02,-4370.5 5278.02,-4374 5288.02,-4377.5 5288.02,-4370.5"/>
</g>
<!-- stage0_layer1_expert_15_tp_7&#45;&gt;stage0_layer1_expert_agg -->
<g id="edge141" class="edge">
<title>stage0_layer1_expert_15_tp_7&#45;&gt;stage0_layer1_expert_agg</title>
<path fill="none" stroke="black" d="M8260,-4506.91C8260,-4449.71 8260,-4354 8260,-4354 8260,-4354 5259.68,-4354 5259.68,-4354"/>
<polygon fill="black" stroke="black" points="5259.68,-4350.5 5249.68,-4354 5259.68,-4357.5 5259.68,-4350.5"/>
</g>
<!-- stage0_layer1_expert_allreduce -->
<g id="node96" class="node">
<title>stage0_layer1_expert_allreduce</title>
<polygon fill="lightyellow" stroke="black" points="5729.67,-4299.17 4974.58,-4299.17 4780.33,-4163.17 5535.42,-4163.17 5729.67,-4299.17"/>
<text text-anchor="middle" x="5255" y="-4249.97" font-family="Times,serif" font-size="14.00">MoE All&#45;Reduce</text>
<text text-anchor="middle" x="5255" y="-4234.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5255" y="-4219.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5255" y="-4204.97" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- stage0_layer1_expert_agg&#45;&gt;stage0_layer1_expert_allreduce -->
<g id="edge142" class="edge">
<title>stage0_layer1_expert_agg&#45;&gt;stage0_layer1_expert_allreduce</title>
<path fill="none" stroke="black" d="M5098.5,-4334.69C5098.5,-4334.69 5098.5,-4309.4 5098.5,-4309.4"/>
<polygon fill="black" stroke="black" points="5102,-4309.4 5098.5,-4299.4 5095,-4309.4 5102,-4309.4"/>
</g>
<!-- stage0_layer1_expert_allreduce&#45;&gt;stage0_layer1_residual2 -->
<g id="edge143" class="edge">
<title>stage0_layer1_expert_allreduce&#45;&gt;stage0_layer1_residual2</title>
<path fill="none" stroke="black" d="M5712.42,-4231.03C5712.42,-4231.03 5712.42,-4057.63 5712.42,-4057.63"/>
<polygon fill="black" stroke="black" points="5715.92,-4057.63 5712.42,-4047.63 5708.92,-4057.63 5715.92,-4057.63"/>
</g>
<!-- pipeline_comm_stage0_to_stage1 -->
<g id="node98" class="node">
<title>pipeline_comm_stage0_to_stage1</title>
<polygon fill="orange" stroke="black" points="6627.67,-3925.17 5872.58,-3925.17 5678.33,-3789.17 6433.42,-3789.17 6627.67,-3925.17"/>
<text text-anchor="middle" x="6153" y="-3875.97" font-family="Times,serif" font-size="14.00">Pipeline Communication</text>
<text text-anchor="middle" x="6153" y="-3860.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6153" y="-3845.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6153" y="-3830.97" font-family="Times,serif" font-size="14.00">GPUs: 7→8</text>
</g>
<!-- stage0_layer1_residual2&#45;&gt;pipeline_comm_stage0_to_stage1 -->
<g id="edge145" class="edge">
<title>stage0_layer1_residual2&#45;&gt;pipeline_comm_stage0_to_stage1</title>
<path fill="none" stroke="black" d="M6153,-3961.06C6153,-3961.06 6153,-3935.17 6153,-3935.17"/>
<polygon fill="black" stroke="black" points="6156.5,-3935.17 6153,-3925.17 6149.5,-3935.17 6156.5,-3935.17"/>
</g>
<!-- stage1_layer2_ln1 -->
<g id="node99" class="node">
<title>stage1_layer2_ln1</title>
<polygon fill="lightgreen" stroke="black" points="5454,-3719.17 4996,-3719.17 4996,-3651.17 5454,-3651.17 5454,-3719.17"/>
<text text-anchor="middle" x="5225" y="-3703.97" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="5225" y="-3688.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5225" y="-3673.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5225" y="-3658.97" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- pipeline_comm_stage0_to_stage1&#45;&gt;stage1_layer2_ln1 -->
<g id="edge146" class="edge">
<title>pipeline_comm_stage0_to_stage1&#45;&gt;stage1_layer2_ln1</title>
<path fill="none" stroke="black" d="M5840.83,-3789.09C5840.83,-3748.58 5840.83,-3705 5840.83,-3705 5840.83,-3705 5464.31,-3705 5464.31,-3705"/>
<polygon fill="black" stroke="black" points="5464.31,-3701.5 5454.31,-3705 5464.31,-3708.5 5464.31,-3701.5"/>
</g>
<!-- stage1_layer2_residual1 -->
<g id="node125" class="node">
<title>stage1_layer2_residual1</title>
<polygon fill="lightpink" stroke="black" points="6527,-3056.17 6069,-2973.17 6527,-2890.17 6985,-2973.17 6527,-3056.17"/>
<text text-anchor="middle" x="6527" y="-2999.47" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="6527" y="-2984.47" font-family="Times,serif" font-size="14.00">Input1: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6527" y="-2969.47" font-family="Times,serif" font-size="14.00">Input2: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6527" y="-2954.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6527" y="-2939.47" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- pipeline_comm_stage0_to_stage1&#45;&gt;stage1_layer2_residual1 -->
<g id="edge180" class="edge">
<title>pipeline_comm_stage0_to_stage1&#45;&gt;stage1_layer2_residual1</title>
<path fill="none" stroke="black" d="M6535.5,-3857.01C6535.5,-3857.01 6535.5,-3064.74 6535.5,-3064.74"/>
<polygon fill="black" stroke="black" points="6539,-3064.74 6535.5,-3054.74 6532,-3064.74 6539,-3064.74"/>
</g>
<!-- stage1_layer2_qkv_tp_0 -->
<g id="node100" class="node">
<title>stage1_layer2_qkv_tp_0</title>
<polygon fill="lightcoral" stroke="black" points="3378.5,-3615.17 2871.5,-3615.17 2871.5,-3517.17 3378.5,-3517.17 3378.5,-3615.17"/>
<text text-anchor="middle" x="3125" y="-3599.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3125" y="-3584.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="3125" y="-3569.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="3125" y="-3554.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3125" y="-3539.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="3125" y="-3524.97" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- stage1_layer2_ln1&#45;&gt;stage1_layer2_qkv_tp_0 -->
<g id="edge147" class="edge">
<title>stage1_layer2_ln1&#45;&gt;stage1_layer2_qkv_tp_0</title>
<path fill="none" stroke="black" d="M4995.64,-3705C4492.27,-3705 3335.25,-3705 3335.25,-3705 3335.25,-3705 3335.25,-3625.5 3335.25,-3625.5"/>
<polygon fill="black" stroke="black" points="3338.75,-3625.5 3335.25,-3615.5 3331.75,-3625.5 3338.75,-3625.5"/>
</g>
<!-- stage1_layer2_qkv_tp_1 -->
<g id="node101" class="node">
<title>stage1_layer2_qkv_tp_1</title>
<polygon fill="lightcoral" stroke="black" points="3903.5,-3615.17 3396.5,-3615.17 3396.5,-3517.17 3903.5,-3517.17 3903.5,-3615.17"/>
<text text-anchor="middle" x="3650" y="-3599.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3650" y="-3584.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="3650" y="-3569.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="3650" y="-3554.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3650" y="-3539.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="3650" y="-3524.97" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- stage1_layer2_ln1&#45;&gt;stage1_layer2_qkv_tp_1 -->
<g id="edge151" class="edge">
<title>stage1_layer2_ln1&#45;&gt;stage1_layer2_qkv_tp_1</title>
<path fill="none" stroke="black" d="M4995.82,-3691C4601.06,-3691 3834.75,-3691 3834.75,-3691 3834.75,-3691 3834.75,-3625.5 3834.75,-3625.5"/>
<polygon fill="black" stroke="black" points="3838.25,-3625.5 3834.75,-3615.5 3831.25,-3625.5 3838.25,-3625.5"/>
</g>
<!-- stage1_layer2_qkv_tp_2 -->
<g id="node102" class="node">
<title>stage1_layer2_qkv_tp_2</title>
<polygon fill="lightcoral" stroke="black" points="4428.5,-3615.17 3921.5,-3615.17 3921.5,-3517.17 4428.5,-3517.17 4428.5,-3615.17"/>
<text text-anchor="middle" x="4175" y="-3599.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4175" y="-3584.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="4175" y="-3569.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="4175" y="-3554.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4175" y="-3539.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4175" y="-3524.97" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- stage1_layer2_ln1&#45;&gt;stage1_layer2_qkv_tp_2 -->
<g id="edge155" class="edge">
<title>stage1_layer2_ln1&#45;&gt;stage1_layer2_qkv_tp_2</title>
<path fill="none" stroke="black" d="M4995.9,-3678C4731.98,-3678 4334.25,-3678 4334.25,-3678 4334.25,-3678 4334.25,-3625.22 4334.25,-3625.22"/>
<polygon fill="black" stroke="black" points="4337.75,-3625.22 4334.25,-3615.22 4330.75,-3625.22 4337.75,-3625.22"/>
</g>
<!-- stage1_layer2_qkv_tp_3 -->
<g id="node103" class="node">
<title>stage1_layer2_qkv_tp_3</title>
<polygon fill="lightcoral" stroke="black" points="4953.5,-3615.17 4446.5,-3615.17 4446.5,-3517.17 4953.5,-3517.17 4953.5,-3615.17"/>
<text text-anchor="middle" x="4700" y="-3599.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4700" y="-3584.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="4700" y="-3569.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="4700" y="-3554.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4700" y="-3539.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4700" y="-3524.97" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- stage1_layer2_ln1&#45;&gt;stage1_layer2_qkv_tp_3 -->
<g id="edge159" class="edge">
<title>stage1_layer2_ln1&#45;&gt;stage1_layer2_qkv_tp_3</title>
<path fill="none" stroke="black" d="M4995.89,-3664C4925.8,-3664 4866.83,-3664 4866.83,-3664 4866.83,-3664 4866.83,-3625.37 4866.83,-3625.37"/>
<polygon fill="black" stroke="black" points="4870.33,-3625.37 4866.83,-3615.37 4863.33,-3625.37 4870.33,-3625.37"/>
</g>
<!-- stage1_layer2_qkv_tp_4 -->
<g id="node104" class="node">
<title>stage1_layer2_qkv_tp_4</title>
<polygon fill="lightcoral" stroke="black" points="5478.5,-3615.17 4971.5,-3615.17 4971.5,-3517.17 5478.5,-3517.17 5478.5,-3615.17"/>
<text text-anchor="middle" x="5225" y="-3599.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5225" y="-3584.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="5225" y="-3569.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="5225" y="-3554.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5225" y="-3539.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5225" y="-3524.97" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- stage1_layer2_ln1&#45;&gt;stage1_layer2_qkv_tp_4 -->
<g id="edge163" class="edge">
<title>stage1_layer2_ln1&#45;&gt;stage1_layer2_qkv_tp_4</title>
<path fill="none" stroke="black" d="M5225,-3651.07C5225,-3651.07 5225,-3625.35 5225,-3625.35"/>
<polygon fill="black" stroke="black" points="5228.5,-3625.35 5225,-3615.35 5221.5,-3625.35 5228.5,-3625.35"/>
</g>
<!-- stage1_layer2_qkv_tp_5 -->
<g id="node105" class="node">
<title>stage1_layer2_qkv_tp_5</title>
<polygon fill="lightcoral" stroke="black" points="6003.5,-3615.17 5496.5,-3615.17 5496.5,-3517.17 6003.5,-3517.17 6003.5,-3615.17"/>
<text text-anchor="middle" x="5750" y="-3599.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5750" y="-3584.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="5750" y="-3569.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="5750" y="-3554.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5750" y="-3539.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5750" y="-3524.97" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- stage1_layer2_ln1&#45;&gt;stage1_layer2_qkv_tp_5 -->
<g id="edge167" class="edge">
<title>stage1_layer2_ln1&#45;&gt;stage1_layer2_qkv_tp_5</title>
<path fill="none" stroke="black" d="M5454.21,-3664C5526.23,-3664 5587.33,-3664 5587.33,-3664 5587.33,-3664 5587.33,-3625.37 5587.33,-3625.37"/>
<polygon fill="black" stroke="black" points="5590.83,-3625.37 5587.33,-3615.37 5583.83,-3625.37 5590.83,-3625.37"/>
</g>
<!-- stage1_layer2_qkv_tp_6 -->
<g id="node106" class="node">
<title>stage1_layer2_qkv_tp_6</title>
<polygon fill="lightcoral" stroke="black" points="6528.5,-3615.17 6021.5,-3615.17 6021.5,-3517.17 6528.5,-3517.17 6528.5,-3615.17"/>
<text text-anchor="middle" x="6275" y="-3599.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="6275" y="-3584.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="6275" y="-3569.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="6275" y="-3554.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6275" y="-3539.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6275" y="-3524.97" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- stage1_layer2_ln1&#45;&gt;stage1_layer2_qkv_tp_6 -->
<g id="edge171" class="edge">
<title>stage1_layer2_ln1&#45;&gt;stage1_layer2_qkv_tp_6</title>
<path fill="none" stroke="black" d="M5454.13,-3678C5763.08,-3678 6275,-3678 6275,-3678 6275,-3678 6275,-3625.22 6275,-3625.22"/>
<polygon fill="black" stroke="black" points="6278.5,-3625.22 6275,-3615.22 6271.5,-3625.22 6278.5,-3625.22"/>
</g>
<!-- stage1_layer2_qkv_tp_7 -->
<g id="node107" class="node">
<title>stage1_layer2_qkv_tp_7</title>
<polygon fill="lightcoral" stroke="black" points="7053.5,-3615.17 6546.5,-3615.17 6546.5,-3517.17 7053.5,-3517.17 7053.5,-3615.17"/>
<text text-anchor="middle" x="6800" y="-3599.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="6800" y="-3584.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="6800" y="-3569.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="6800" y="-3554.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6800" y="-3539.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6800" y="-3524.97" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- stage1_layer2_ln1&#45;&gt;stage1_layer2_qkv_tp_7 -->
<g id="edge175" class="edge">
<title>stage1_layer2_ln1&#45;&gt;stage1_layer2_qkv_tp_7</title>
<path fill="none" stroke="black" d="M5454.15,-3691C5842.25,-3691 6587.17,-3691 6587.17,-3691 6587.17,-3691 6587.17,-3625.5 6587.17,-3625.5"/>
<polygon fill="black" stroke="black" points="6590.67,-3625.5 6587.17,-3615.5 6583.67,-3625.5 6590.67,-3625.5"/>
</g>
<!-- stage1_layer2_attn_tp_0 -->
<g id="node108" class="node">
<title>stage1_layer2_attn_tp_0</title>
<polygon fill="lightcoral" stroke="black" points="3378.5,-3481.17 2871.5,-3481.17 2871.5,-3383.17 3378.5,-3383.17 3378.5,-3481.17"/>
<text text-anchor="middle" x="3125" y="-3465.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="3125" y="-3450.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="3125" y="-3435.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="3125" y="-3420.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="3125" y="-3405.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="3125" y="-3390.97" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- stage1_layer2_qkv_tp_0&#45;&gt;stage1_layer2_attn_tp_0 -->
<g id="edge148" class="edge">
<title>stage1_layer2_qkv_tp_0&#45;&gt;stage1_layer2_attn_tp_0</title>
<path fill="none" stroke="black" d="M3125,-3517.03C3125,-3517.03 3125,-3491.3 3125,-3491.3"/>
<polygon fill="black" stroke="black" points="3128.5,-3491.3 3125,-3481.3 3121.5,-3491.3 3128.5,-3491.3"/>
</g>
<!-- stage1_layer2_attn_tp_1 -->
<g id="node109" class="node">
<title>stage1_layer2_attn_tp_1</title>
<polygon fill="lightcoral" stroke="black" points="3903.5,-3481.17 3396.5,-3481.17 3396.5,-3383.17 3903.5,-3383.17 3903.5,-3481.17"/>
<text text-anchor="middle" x="3650" y="-3465.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="3650" y="-3450.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="3650" y="-3435.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="3650" y="-3420.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="3650" y="-3405.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="3650" y="-3390.97" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- stage1_layer2_qkv_tp_1&#45;&gt;stage1_layer2_attn_tp_1 -->
<g id="edge152" class="edge">
<title>stage1_layer2_qkv_tp_1&#45;&gt;stage1_layer2_attn_tp_1</title>
<path fill="none" stroke="black" d="M3650,-3517.03C3650,-3517.03 3650,-3491.3 3650,-3491.3"/>
<polygon fill="black" stroke="black" points="3653.5,-3491.3 3650,-3481.3 3646.5,-3491.3 3653.5,-3491.3"/>
</g>
<!-- stage1_layer2_attn_tp_2 -->
<g id="node110" class="node">
<title>stage1_layer2_attn_tp_2</title>
<polygon fill="lightcoral" stroke="black" points="4428.5,-3481.17 3921.5,-3481.17 3921.5,-3383.17 4428.5,-3383.17 4428.5,-3481.17"/>
<text text-anchor="middle" x="4175" y="-3465.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="4175" y="-3450.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="4175" y="-3435.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="4175" y="-3420.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4175" y="-3405.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4175" y="-3390.97" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- stage1_layer2_qkv_tp_2&#45;&gt;stage1_layer2_attn_tp_2 -->
<g id="edge156" class="edge">
<title>stage1_layer2_qkv_tp_2&#45;&gt;stage1_layer2_attn_tp_2</title>
<path fill="none" stroke="black" d="M4175,-3517.03C4175,-3517.03 4175,-3491.3 4175,-3491.3"/>
<polygon fill="black" stroke="black" points="4178.5,-3491.3 4175,-3481.3 4171.5,-3491.3 4178.5,-3491.3"/>
</g>
<!-- stage1_layer2_attn_tp_3 -->
<g id="node111" class="node">
<title>stage1_layer2_attn_tp_3</title>
<polygon fill="lightcoral" stroke="black" points="4953.5,-3481.17 4446.5,-3481.17 4446.5,-3383.17 4953.5,-3383.17 4953.5,-3481.17"/>
<text text-anchor="middle" x="4700" y="-3465.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="4700" y="-3450.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="4700" y="-3435.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="4700" y="-3420.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4700" y="-3405.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4700" y="-3390.97" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- stage1_layer2_qkv_tp_3&#45;&gt;stage1_layer2_attn_tp_3 -->
<g id="edge160" class="edge">
<title>stage1_layer2_qkv_tp_3&#45;&gt;stage1_layer2_attn_tp_3</title>
<path fill="none" stroke="black" d="M4700,-3517.03C4700,-3517.03 4700,-3491.3 4700,-3491.3"/>
<polygon fill="black" stroke="black" points="4703.5,-3491.3 4700,-3481.3 4696.5,-3491.3 4703.5,-3491.3"/>
</g>
<!-- stage1_layer2_attn_tp_4 -->
<g id="node112" class="node">
<title>stage1_layer2_attn_tp_4</title>
<polygon fill="lightcoral" stroke="black" points="5478.5,-3481.17 4971.5,-3481.17 4971.5,-3383.17 5478.5,-3383.17 5478.5,-3481.17"/>
<text text-anchor="middle" x="5225" y="-3465.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="5225" y="-3450.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="5225" y="-3435.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="5225" y="-3420.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5225" y="-3405.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5225" y="-3390.97" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- stage1_layer2_qkv_tp_4&#45;&gt;stage1_layer2_attn_tp_4 -->
<g id="edge164" class="edge">
<title>stage1_layer2_qkv_tp_4&#45;&gt;stage1_layer2_attn_tp_4</title>
<path fill="none" stroke="black" d="M5225,-3517.03C5225,-3517.03 5225,-3491.3 5225,-3491.3"/>
<polygon fill="black" stroke="black" points="5228.5,-3491.3 5225,-3481.3 5221.5,-3491.3 5228.5,-3491.3"/>
</g>
<!-- stage1_layer2_attn_tp_5 -->
<g id="node113" class="node">
<title>stage1_layer2_attn_tp_5</title>
<polygon fill="lightcoral" stroke="black" points="6003.5,-3481.17 5496.5,-3481.17 5496.5,-3383.17 6003.5,-3383.17 6003.5,-3481.17"/>
<text text-anchor="middle" x="5750" y="-3465.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="5750" y="-3450.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="5750" y="-3435.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="5750" y="-3420.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5750" y="-3405.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5750" y="-3390.97" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- stage1_layer2_qkv_tp_5&#45;&gt;stage1_layer2_attn_tp_5 -->
<g id="edge168" class="edge">
<title>stage1_layer2_qkv_tp_5&#45;&gt;stage1_layer2_attn_tp_5</title>
<path fill="none" stroke="black" d="M5750,-3517.03C5750,-3517.03 5750,-3491.3 5750,-3491.3"/>
<polygon fill="black" stroke="black" points="5753.5,-3491.3 5750,-3481.3 5746.5,-3491.3 5753.5,-3491.3"/>
</g>
<!-- stage1_layer2_attn_tp_6 -->
<g id="node114" class="node">
<title>stage1_layer2_attn_tp_6</title>
<polygon fill="lightcoral" stroke="black" points="6528.5,-3481.17 6021.5,-3481.17 6021.5,-3383.17 6528.5,-3383.17 6528.5,-3481.17"/>
<text text-anchor="middle" x="6275" y="-3465.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="6275" y="-3450.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="6275" y="-3435.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="6275" y="-3420.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6275" y="-3405.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6275" y="-3390.97" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- stage1_layer2_qkv_tp_6&#45;&gt;stage1_layer2_attn_tp_6 -->
<g id="edge172" class="edge">
<title>stage1_layer2_qkv_tp_6&#45;&gt;stage1_layer2_attn_tp_6</title>
<path fill="none" stroke="black" d="M6275,-3517.03C6275,-3517.03 6275,-3491.3 6275,-3491.3"/>
<polygon fill="black" stroke="black" points="6278.5,-3491.3 6275,-3481.3 6271.5,-3491.3 6278.5,-3491.3"/>
</g>
<!-- stage1_layer2_attn_tp_7 -->
<g id="node115" class="node">
<title>stage1_layer2_attn_tp_7</title>
<polygon fill="lightcoral" stroke="black" points="7053.5,-3481.17 6546.5,-3481.17 6546.5,-3383.17 7053.5,-3383.17 7053.5,-3481.17"/>
<text text-anchor="middle" x="6800" y="-3465.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="6800" y="-3450.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="6800" y="-3435.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="6800" y="-3420.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6800" y="-3405.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6800" y="-3390.97" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- stage1_layer2_qkv_tp_7&#45;&gt;stage1_layer2_attn_tp_7 -->
<g id="edge176" class="edge">
<title>stage1_layer2_qkv_tp_7&#45;&gt;stage1_layer2_attn_tp_7</title>
<path fill="none" stroke="black" d="M6800,-3517.03C6800,-3517.03 6800,-3491.3 6800,-3491.3"/>
<polygon fill="black" stroke="black" points="6803.5,-3491.3 6800,-3481.3 6796.5,-3491.3 6803.5,-3491.3"/>
</g>
<!-- stage1_layer2_attn_out_tp_0 -->
<g id="node116" class="node">
<title>stage1_layer2_attn_out_tp_0</title>
<polygon fill="lightcoral" stroke="black" points="3385.5,-3347.17 2890.5,-3347.17 2890.5,-3264.17 3385.5,-3264.17 3385.5,-3347.17"/>
<text text-anchor="middle" x="3138" y="-3331.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3138" y="-3316.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="3138" y="-3301.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="3138" y="-3286.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3138" y="-3271.97" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- stage1_layer2_attn_tp_0&#45;&gt;stage1_layer2_attn_out_tp_0 -->
<g id="edge149" class="edge">
<title>stage1_layer2_attn_tp_0&#45;&gt;stage1_layer2_attn_out_tp_0</title>
<path fill="none" stroke="black" d="M3134.5,-3382.9C3134.5,-3382.9 3134.5,-3357.22 3134.5,-3357.22"/>
<polygon fill="black" stroke="black" points="3138,-3357.22 3134.5,-3347.22 3131,-3357.22 3138,-3357.22"/>
</g>
<!-- stage1_layer2_attn_out_tp_1 -->
<g id="node117" class="node">
<title>stage1_layer2_attn_out_tp_1</title>
<polygon fill="lightcoral" stroke="black" points="3912.5,-3347.17 3417.5,-3347.17 3417.5,-3264.17 3912.5,-3264.17 3912.5,-3347.17"/>
<text text-anchor="middle" x="3665" y="-3331.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3665" y="-3316.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="3665" y="-3301.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="3665" y="-3286.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3665" y="-3271.97" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- stage1_layer2_attn_tp_1&#45;&gt;stage1_layer2_attn_out_tp_1 -->
<g id="edge153" class="edge">
<title>stage1_layer2_attn_tp_1&#45;&gt;stage1_layer2_attn_out_tp_1</title>
<path fill="none" stroke="black" d="M3660.5,-3382.9C3660.5,-3382.9 3660.5,-3357.22 3660.5,-3357.22"/>
<polygon fill="black" stroke="black" points="3664,-3357.22 3660.5,-3347.22 3657,-3357.22 3664,-3357.22"/>
</g>
<!-- stage1_layer2_attn_out_tp_2 -->
<g id="node118" class="node">
<title>stage1_layer2_attn_out_tp_2</title>
<polygon fill="lightcoral" stroke="black" points="4431.5,-3347.17 3936.5,-3347.17 3936.5,-3264.17 4431.5,-3264.17 4431.5,-3347.17"/>
<text text-anchor="middle" x="4184" y="-3331.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4184" y="-3316.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="4184" y="-3301.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4184" y="-3286.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4184" y="-3271.97" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- stage1_layer2_attn_tp_2&#45;&gt;stage1_layer2_attn_out_tp_2 -->
<g id="edge157" class="edge">
<title>stage1_layer2_attn_tp_2&#45;&gt;stage1_layer2_attn_out_tp_2</title>
<path fill="none" stroke="black" d="M4182.5,-3382.9C4182.5,-3382.9 4182.5,-3357.22 4182.5,-3357.22"/>
<polygon fill="black" stroke="black" points="4186,-3357.22 4182.5,-3347.22 4179,-3357.22 4186,-3357.22"/>
</g>
<!-- stage1_layer2_attn_out_tp_3 -->
<g id="node119" class="node">
<title>stage1_layer2_attn_out_tp_3</title>
<polygon fill="lightcoral" stroke="black" points="4953.5,-3347.17 4458.5,-3347.17 4458.5,-3264.17 4953.5,-3264.17 4953.5,-3347.17"/>
<text text-anchor="middle" x="4706" y="-3331.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4706" y="-3316.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="4706" y="-3301.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4706" y="-3286.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4706" y="-3271.97" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- stage1_layer2_attn_tp_3&#45;&gt;stage1_layer2_attn_out_tp_3 -->
<g id="edge161" class="edge">
<title>stage1_layer2_attn_tp_3&#45;&gt;stage1_layer2_attn_out_tp_3</title>
<path fill="none" stroke="black" d="M4706,-3382.9C4706,-3382.9 4706,-3357.22 4706,-3357.22"/>
<polygon fill="black" stroke="black" points="4709.5,-3357.22 4706,-3347.22 4702.5,-3357.22 4709.5,-3357.22"/>
</g>
<!-- stage1_layer2_attn_out_tp_4 -->
<g id="node120" class="node">
<title>stage1_layer2_attn_out_tp_4</title>
<polygon fill="lightcoral" stroke="black" points="5472.5,-3347.17 4977.5,-3347.17 4977.5,-3264.17 5472.5,-3264.17 5472.5,-3347.17"/>
<text text-anchor="middle" x="5225" y="-3331.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="5225" y="-3316.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="5225" y="-3301.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5225" y="-3286.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5225" y="-3271.97" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- stage1_layer2_attn_tp_4&#45;&gt;stage1_layer2_attn_out_tp_4 -->
<g id="edge165" class="edge">
<title>stage1_layer2_attn_tp_4&#45;&gt;stage1_layer2_attn_out_tp_4</title>
<path fill="none" stroke="black" d="M5225,-3382.9C5225,-3382.9 5225,-3357.22 5225,-3357.22"/>
<polygon fill="black" stroke="black" points="5228.5,-3357.22 5225,-3347.22 5221.5,-3357.22 5228.5,-3357.22"/>
</g>
<!-- stage1_layer2_attn_out_tp_5 -->
<g id="node121" class="node">
<title>stage1_layer2_attn_out_tp_5</title>
<polygon fill="lightcoral" stroke="black" points="5991.5,-3347.17 5496.5,-3347.17 5496.5,-3264.17 5991.5,-3264.17 5991.5,-3347.17"/>
<text text-anchor="middle" x="5744" y="-3331.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="5744" y="-3316.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="5744" y="-3301.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5744" y="-3286.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5744" y="-3271.97" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- stage1_layer2_attn_tp_5&#45;&gt;stage1_layer2_attn_out_tp_5 -->
<g id="edge169" class="edge">
<title>stage1_layer2_attn_tp_5&#45;&gt;stage1_layer2_attn_out_tp_5</title>
<path fill="none" stroke="black" d="M5744,-3382.9C5744,-3382.9 5744,-3357.22 5744,-3357.22"/>
<polygon fill="black" stroke="black" points="5747.5,-3357.22 5744,-3347.22 5740.5,-3357.22 5747.5,-3357.22"/>
</g>
<!-- stage1_layer2_attn_out_tp_6 -->
<g id="node122" class="node">
<title>stage1_layer2_attn_out_tp_6</title>
<polygon fill="lightcoral" stroke="black" points="6513.5,-3347.17 6018.5,-3347.17 6018.5,-3264.17 6513.5,-3264.17 6513.5,-3347.17"/>
<text text-anchor="middle" x="6266" y="-3331.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="6266" y="-3316.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="6266" y="-3301.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6266" y="-3286.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6266" y="-3271.97" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- stage1_layer2_attn_tp_6&#45;&gt;stage1_layer2_attn_out_tp_6 -->
<g id="edge173" class="edge">
<title>stage1_layer2_attn_tp_6&#45;&gt;stage1_layer2_attn_out_tp_6</title>
<path fill="none" stroke="black" d="M6267.5,-3382.9C6267.5,-3382.9 6267.5,-3357.22 6267.5,-3357.22"/>
<polygon fill="black" stroke="black" points="6271,-3357.22 6267.5,-3347.22 6264,-3357.22 6271,-3357.22"/>
</g>
<!-- stage1_layer2_attn_out_tp_7 -->
<g id="node123" class="node">
<title>stage1_layer2_attn_out_tp_7</title>
<polygon fill="lightcoral" stroke="black" points="7037.5,-3347.17 6542.5,-3347.17 6542.5,-3264.17 7037.5,-3264.17 7037.5,-3347.17"/>
<text text-anchor="middle" x="6790" y="-3331.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="6790" y="-3316.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="6790" y="-3301.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6790" y="-3286.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6790" y="-3271.97" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- stage1_layer2_attn_tp_7&#45;&gt;stage1_layer2_attn_out_tp_7 -->
<g id="edge177" class="edge">
<title>stage1_layer2_attn_tp_7&#45;&gt;stage1_layer2_attn_out_tp_7</title>
<path fill="none" stroke="black" d="M6792,-3382.9C6792,-3382.9 6792,-3357.22 6792,-3357.22"/>
<polygon fill="black" stroke="black" points="6795.5,-3357.22 6792,-3347.22 6788.5,-3357.22 6795.5,-3357.22"/>
</g>
<!-- stage1_layer2_attn_allreduce -->
<g id="node124" class="node">
<title>stage1_layer2_attn_allreduce</title>
<polygon fill="lightyellow" stroke="black" points="5699.67,-3228.17 4944.58,-3228.17 4750.33,-3092.17 5505.42,-3092.17 5699.67,-3228.17"/>
<text text-anchor="middle" x="5225" y="-3178.97" font-family="Times,serif" font-size="14.00">Attention All&#45;Reduce</text>
<text text-anchor="middle" x="5225" y="-3163.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5225" y="-3148.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5225" y="-3133.97" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- stage1_layer2_attn_out_tp_0&#45;&gt;stage1_layer2_attn_allreduce -->
<g id="edge150" class="edge">
<title>stage1_layer2_attn_out_tp_0&#45;&gt;stage1_layer2_attn_allreduce</title>
<path fill="none" stroke="black" d="M3363.75,-3264C3363.75,-3210.92 3363.75,-3126 3363.75,-3126 3363.75,-3126 4788.58,-3126 4788.58,-3126"/>
<polygon fill="black" stroke="black" points="4788.58,-3129.5 4798.58,-3126 4788.58,-3122.5 4788.58,-3129.5"/>
</g>
<!-- stage1_layer2_attn_out_tp_1&#45;&gt;stage1_layer2_attn_allreduce -->
<g id="edge154" class="edge">
<title>stage1_layer2_attn_out_tp_1&#45;&gt;stage1_layer2_attn_allreduce</title>
<path fill="none" stroke="black" d="M3744.98,-3263.92C3744.98,-3220.88 3744.98,-3160 3744.98,-3160 3744.98,-3160 4836.74,-3160 4836.74,-3160"/>
<polygon fill="black" stroke="black" points="4836.74,-3163.5 4846.74,-3160 4836.74,-3156.5 4836.74,-3163.5"/>
</g>
<!-- stage1_layer2_attn_out_tp_2&#45;&gt;stage1_layer2_attn_allreduce -->
<g id="edge158" class="edge">
<title>stage1_layer2_attn_out_tp_2&#45;&gt;stage1_layer2_attn_allreduce</title>
<path fill="none" stroke="black" d="M4184,-3264.09C4184,-3232.34 4184,-3194 4184,-3194 4184,-3194 4885.62,-3194 4885.62,-3194"/>
<polygon fill="black" stroke="black" points="4885.62,-3197.5 4895.62,-3194 4885.62,-3190.5 4885.62,-3197.5"/>
</g>
<!-- stage1_layer2_attn_out_tp_3&#45;&gt;stage1_layer2_attn_allreduce -->
<g id="edge162" class="edge">
<title>stage1_layer2_attn_out_tp_3&#45;&gt;stage1_layer2_attn_allreduce</title>
<path fill="none" stroke="black" d="M4851.83,-3263.97C4851.83,-3263.97 4851.83,-3173.56 4851.83,-3173.56"/>
<polygon fill="black" stroke="black" points="4855.33,-3173.56 4851.83,-3163.56 4848.33,-3173.56 4855.33,-3173.56"/>
</g>
<!-- stage1_layer2_attn_out_tp_4&#45;&gt;stage1_layer2_attn_allreduce -->
<g id="edge166" class="edge">
<title>stage1_layer2_attn_out_tp_4&#45;&gt;stage1_layer2_attn_allreduce</title>
<path fill="none" stroke="black" d="M5225,-3263.97C5225,-3263.97 5225,-3238.24 5225,-3238.24"/>
<polygon fill="black" stroke="black" points="5228.5,-3238.24 5225,-3228.24 5221.5,-3238.24 5228.5,-3238.24"/>
</g>
<!-- stage1_layer2_attn_out_tp_5&#45;&gt;stage1_layer2_attn_allreduce -->
<g id="edge170" class="edge">
<title>stage1_layer2_attn_out_tp_5&#45;&gt;stage1_layer2_attn_allreduce</title>
<path fill="none" stroke="black" d="M5598.17,-3263.97C5598.17,-3263.97 5598.17,-3238.24 5598.17,-3238.24"/>
<polygon fill="black" stroke="black" points="5601.67,-3238.24 5598.17,-3228.24 5594.67,-3238.24 5601.67,-3238.24"/>
</g>
<!-- stage1_layer2_attn_out_tp_6&#45;&gt;stage1_layer2_attn_allreduce -->
<g id="edge174" class="edge">
<title>stage1_layer2_attn_out_tp_6&#45;&gt;stage1_layer2_attn_allreduce</title>
<path fill="none" stroke="black" d="M6043.75,-3264.14C6043.75,-3228.22 6043.75,-3182 6043.75,-3182 6043.75,-3182 5643.78,-3182 5643.78,-3182"/>
<polygon fill="black" stroke="black" points="5643.78,-3178.5 5633.78,-3182 5643.78,-3185.5 5643.78,-3178.5"/>
</g>
<!-- stage1_layer2_attn_out_tp_7&#45;&gt;stage1_layer2_attn_allreduce -->
<g id="edge178" class="edge">
<title>stage1_layer2_attn_out_tp_7&#45;&gt;stage1_layer2_attn_allreduce</title>
<path fill="none" stroke="black" d="M6763.75,-3263.97C6763.75,-3214.03 6763.75,-3137 6763.75,-3137 6763.75,-3137 5579.85,-3137 5579.85,-3137"/>
<polygon fill="black" stroke="black" points="5579.85,-3133.5 5569.85,-3137 5579.85,-3140.5 5579.85,-3133.5"/>
</g>
<!-- stage1_layer2_attn_allreduce&#45;&gt;stage1_layer2_residual1 -->
<g id="edge179" class="edge">
<title>stage1_layer2_attn_allreduce&#45;&gt;stage1_layer2_residual1</title>
<path fill="none" stroke="black" d="M5604.5,-3160.03C5604.5,-3154.36 5604.5,-2973 5604.5,-2973 5604.5,-2973 6059.8,-2973 6059.8,-2973"/>
<polygon fill="black" stroke="black" points="6059.8,-2976.5 6069.8,-2973 6059.8,-2969.5 6059.8,-2976.5"/>
</g>
<!-- stage1_layer2_ln2 -->
<g id="node126" class="node">
<title>stage1_layer2_ln2</title>
<polygon fill="lightgreen" stroke="black" points="5515,-2854.17 5057,-2854.17 5057,-2786.17 5515,-2786.17 5515,-2854.17"/>
<text text-anchor="middle" x="5286" y="-2838.97" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="5286" y="-2823.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5286" y="-2808.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5286" y="-2793.97" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- stage1_layer2_residual1&#45;&gt;stage1_layer2_ln2 -->
<g id="edge181" class="edge">
<title>stage1_layer2_residual1&#45;&gt;stage1_layer2_ln2</title>
<path fill="none" stroke="black" d="M6118.5,-2964.04C6118.5,-2931.07 6118.5,-2820 6118.5,-2820 6118.5,-2820 5525.14,-2820 5525.14,-2820"/>
<polygon fill="black" stroke="black" points="5525.14,-2816.5 5515.14,-2820 5525.14,-2823.5 5525.14,-2816.5"/>
</g>
<!-- stage1_layer2_residual2 -->
<g id="node146" class="node">
<title>stage1_layer2_residual2</title>
<polygon fill="lightpink" stroke="black" points="5567,-2115.17 5109,-2032.17 5567,-1949.17 6025,-2032.17 5567,-2115.17"/>
<text text-anchor="middle" x="5567" y="-2058.47" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5567" y="-2043.47" font-family="Times,serif" font-size="14.00">Input1: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5567" y="-2028.47" font-family="Times,serif" font-size="14.00">Input2: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5567" y="-2013.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5567" y="-1998.47" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- stage1_layer2_residual1&#45;&gt;stage1_layer2_residual2 -->
<g id="edge217" class="edge">
<title>stage1_layer2_residual1&#45;&gt;stage1_layer2_residual2</title>
<path fill="none" stroke="black" d="M6177,-2953.22C6177,-2819.53 6177,-2059 6177,-2059 6177,-2059 5887.36,-2059 5887.36,-2059"/>
<polygon fill="black" stroke="black" points="5887.36,-2055.5 5877.36,-2059 5887.36,-2062.5 5887.36,-2055.5"/>
</g>
<!-- stage1_layer2_gate -->
<g id="node127" class="node">
<title>stage1_layer2_gate</title>
<polygon fill="lightblue" stroke="black" points="4510.58,-2750.17 3768.36,-2750.17 3577.42,-2614.17 4319.64,-2614.17 4510.58,-2750.17"/>
<text text-anchor="middle" x="4044" y="-2700.97" font-family="Times,serif" font-size="14.00">Gate Computation</text>
<text text-anchor="middle" x="4044" y="-2685.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4044" y="-2670.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, num_experts=16]</text>
<text text-anchor="middle" x="4044" y="-2655.97" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- stage1_layer2_ln2&#45;&gt;stage1_layer2_gate -->
<g id="edge182" class="edge">
<title>stage1_layer2_ln2&#45;&gt;stage1_layer2_gate</title>
<path fill="none" stroke="black" d="M5056.86,-2820C4820,-2820 4484.52,-2820 4484.52,-2820 4484.52,-2820 4484.52,-2692.27 4484.52,-2692.27"/>
<polygon fill="black" stroke="black" points="4488.02,-2692.27 4484.52,-2682.27 4481.02,-2692.27 4488.02,-2692.27"/>
</g>
<!-- stage1_layer2_expert_0_tp_0 -->
<g id="node128" class="node">
<title>stage1_layer2_expert_0_tp_0</title>
<polygon fill="lightsteelblue" stroke="black" points="480,-2578.17 24,-2578.17 24,-2495.17 480,-2495.17 480,-2578.17"/>
<text text-anchor="middle" x="252" y="-2562.97" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="252" y="-2547.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="252" y="-2532.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="252" y="-2517.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="252" y="-2502.97" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- stage1_layer2_gate&#45;&gt;stage1_layer2_expert_0_tp_0 -->
<g id="edge183" class="edge">
<title>stage1_layer2_gate&#45;&gt;stage1_layer2_expert_0_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3744.07,-2733C2847.92,-2733 252,-2733 252,-2733 252,-2733 252,-2588.3 252,-2588.3"/>
<polygon fill="black" stroke="black" points="255.5,-2588.3 252,-2578.3 248.5,-2588.3 255.5,-2588.3"/>
</g>
<!-- stage1_layer2_expert_1_tp_0 -->
<g id="node129" class="node">
<title>stage1_layer2_expert_1_tp_0</title>
<polygon fill="lightsteelblue" stroke="black" points="954,-2578.17 498,-2578.17 498,-2495.17 954,-2495.17 954,-2578.17"/>
<text text-anchor="middle" x="726" y="-2562.97" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="726" y="-2547.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="726" y="-2532.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="726" y="-2517.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="726" y="-2502.97" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- stage1_layer2_gate&#45;&gt;stage1_layer2_expert_1_tp_0 -->
<g id="edge184" class="edge">
<title>stage1_layer2_gate&#45;&gt;stage1_layer2_expert_1_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3720.03,-2716C2924.26,-2716 938,-2716 938,-2716 938,-2716 938,-2588.26 938,-2588.26"/>
<polygon fill="black" stroke="black" points="941.5,-2588.26 938,-2578.26 934.5,-2588.26 941.5,-2588.26"/>
</g>
<!-- stage1_layer2_expert_2_tp_1 -->
<g id="node130" class="node">
<title>stage1_layer2_expert_2_tp_1</title>
<polygon fill="lightsteelblue" stroke="black" points="1428,-2578.17 972,-2578.17 972,-2495.17 1428,-2495.17 1428,-2578.17"/>
<text text-anchor="middle" x="1200" y="-2562.97" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1200" y="-2547.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="1200" y="-2532.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="1200" y="-2517.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="1200" y="-2502.97" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- stage1_layer2_gate&#45;&gt;stage1_layer2_expert_2_tp_1 -->
<g id="edge187" class="edge">
<title>stage1_layer2_gate&#45;&gt;stage1_layer2_expert_2_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3696.19,-2699C2981.01,-2699 1412,-2699 1412,-2699 1412,-2699 1412,-2588.47 1412,-2588.47"/>
<polygon fill="black" stroke="black" points="1415.5,-2588.47 1412,-2578.47 1408.5,-2588.47 1415.5,-2588.47"/>
</g>
<!-- stage1_layer2_expert_3_tp_1 -->
<g id="node131" class="node">
<title>stage1_layer2_expert_3_tp_1</title>
<polygon fill="lightsteelblue" stroke="black" points="1902,-2578.17 1446,-2578.17 1446,-2495.17 1902,-2495.17 1902,-2578.17"/>
<text text-anchor="middle" x="1674" y="-2562.97" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1674" y="-2547.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="1674" y="-2532.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="1674" y="-2517.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="1674" y="-2502.97" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- stage1_layer2_gate&#45;&gt;stage1_layer2_expert_3_tp_1 -->
<g id="edge188" class="edge">
<title>stage1_layer2_gate&#45;&gt;stage1_layer2_expert_3_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3672.41,-2682C3055.25,-2682 1886,-2682 1886,-2682 1886,-2682 1886,-2588.31 1886,-2588.31"/>
<polygon fill="black" stroke="black" points="1889.5,-2588.31 1886,-2578.31 1882.5,-2588.31 1889.5,-2588.31"/>
</g>
<!-- stage1_layer2_expert_4_tp_2 -->
<g id="node132" class="node">
<title>stage1_layer2_expert_4_tp_2</title>
<polygon fill="lightsteelblue" stroke="black" points="2376,-2578.17 1920,-2578.17 1920,-2495.17 2376,-2495.17 2376,-2578.17"/>
<text text-anchor="middle" x="2148" y="-2562.97" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="2148" y="-2547.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="2148" y="-2532.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="2148" y="-2517.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="2148" y="-2502.97" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- stage1_layer2_gate&#45;&gt;stage1_layer2_expert_4_tp_2 -->
<g id="edge191" class="edge">
<title>stage1_layer2_gate&#45;&gt;stage1_layer2_expert_4_tp_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3648.64,-2665C3150.87,-2665 2360,-2665 2360,-2665 2360,-2665 2360,-2588.33 2360,-2588.33"/>
<polygon fill="black" stroke="black" points="2363.5,-2588.33 2360,-2578.33 2356.5,-2588.33 2363.5,-2588.33"/>
</g>
<!-- stage1_layer2_expert_5_tp_2 -->
<g id="node133" class="node">
<title>stage1_layer2_expert_5_tp_2</title>
<polygon fill="lightsteelblue" stroke="black" points="2850,-2578.17 2394,-2578.17 2394,-2495.17 2850,-2495.17 2850,-2578.17"/>
<text text-anchor="middle" x="2622" y="-2562.97" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="2622" y="-2547.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="2622" y="-2532.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="2622" y="-2517.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="2622" y="-2502.97" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- stage1_layer2_gate&#45;&gt;stage1_layer2_expert_5_tp_2 -->
<g id="edge192" class="edge">
<title>stage1_layer2_gate&#45;&gt;stage1_layer2_expert_5_tp_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3624.62,-2648C3275.08,-2648 2834,-2648 2834,-2648 2834,-2648 2834,-2588.44 2834,-2588.44"/>
<polygon fill="black" stroke="black" points="2837.5,-2588.44 2834,-2578.44 2830.5,-2588.44 2837.5,-2588.44"/>
</g>
<!-- stage1_layer2_expert_6_tp_3 -->
<g id="node134" class="node">
<title>stage1_layer2_expert_6_tp_3</title>
<polygon fill="lightsteelblue" stroke="black" points="3324,-2578.17 2868,-2578.17 2868,-2495.17 3324,-2495.17 3324,-2578.17"/>
<text text-anchor="middle" x="3096" y="-2562.97" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="3096" y="-2547.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="3096" y="-2532.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3096" y="-2517.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="3096" y="-2502.97" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- stage1_layer2_gate&#45;&gt;stage1_layer2_expert_6_tp_3 -->
<g id="edge195" class="edge">
<title>stage1_layer2_gate&#45;&gt;stage1_layer2_expert_6_tp_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3601,-2631C3358.67,-2631 3107.25,-2631 3107.25,-2631 3107.25,-2631 3107.25,-2588.32 3107.25,-2588.32"/>
<polygon fill="black" stroke="black" points="3110.75,-2588.32 3107.25,-2578.32 3103.75,-2588.32 3110.75,-2588.32"/>
</g>
<!-- stage1_layer2_expert_7_tp_3 -->
<g id="node135" class="node">
<title>stage1_layer2_expert_7_tp_3</title>
<polygon fill="lightsteelblue" stroke="black" points="3798,-2578.17 3342,-2578.17 3342,-2495.17 3798,-2495.17 3798,-2578.17"/>
<text text-anchor="middle" x="3570" y="-2562.97" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="3570" y="-2547.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="3570" y="-2532.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3570" y="-2517.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="3570" y="-2502.97" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- stage1_layer2_gate&#45;&gt;stage1_layer2_expert_7_tp_3 -->
<g id="edge196" class="edge">
<title>stage1_layer2_gate&#45;&gt;stage1_layer2_expert_7_tp_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3687.73,-2614.1C3687.73,-2614.1 3687.73,-2588.55 3687.73,-2588.55"/>
<polygon fill="black" stroke="black" points="3691.23,-2588.55 3687.73,-2578.55 3684.23,-2588.55 3691.23,-2588.55"/>
</g>
<!-- stage1_layer2_expert_8_tp_4 -->
<g id="node136" class="node">
<title>stage1_layer2_expert_8_tp_4</title>
<polygon fill="lightsteelblue" stroke="black" points="4272,-2578.17 3816,-2578.17 3816,-2495.17 4272,-2495.17 4272,-2578.17"/>
<text text-anchor="middle" x="4044" y="-2562.97" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="4044" y="-2547.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="4044" y="-2532.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4044" y="-2517.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="4044" y="-2502.97" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- stage1_layer2_gate&#45;&gt;stage1_layer2_expert_8_tp_4 -->
<g id="edge199" class="edge">
<title>stage1_layer2_gate&#45;&gt;stage1_layer2_expert_8_tp_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4044,-2614.1C4044,-2614.1 4044,-2588.55 4044,-2588.55"/>
<polygon fill="black" stroke="black" points="4047.5,-2588.55 4044,-2578.55 4040.5,-2588.55 4047.5,-2588.55"/>
</g>
<!-- stage1_layer2_expert_9_tp_4 -->
<g id="node137" class="node">
<title>stage1_layer2_expert_9_tp_4</title>
<polygon fill="lightsteelblue" stroke="black" points="4746,-2578.17 4290,-2578.17 4290,-2495.17 4746,-2495.17 4746,-2578.17"/>
<text text-anchor="middle" x="4518" y="-2562.97" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="4518" y="-2547.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="4518" y="-2532.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4518" y="-2517.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="4518" y="-2502.97" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- stage1_layer2_gate&#45;&gt;stage1_layer2_expert_9_tp_4 -->
<g id="edge200" class="edge">
<title>stage1_layer2_gate&#45;&gt;stage1_layer2_expert_9_tp_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4400.27,-2671.23C4400.27,-2671.23 4400.27,-2588.19 4400.27,-2588.19"/>
<polygon fill="black" stroke="black" points="4403.77,-2588.19 4400.27,-2578.19 4396.77,-2588.19 4403.77,-2588.19"/>
</g>
<!-- stage1_layer2_expert_10_tp_5 -->
<g id="node138" class="node">
<title>stage1_layer2_expert_10_tp_5</title>
<polygon fill="lightsteelblue" stroke="black" points="5220,-2578.17 4764,-2578.17 4764,-2495.17 5220,-2495.17 5220,-2578.17"/>
<text text-anchor="middle" x="4992" y="-2562.97" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="4992" y="-2547.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="4992" y="-2532.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4992" y="-2517.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="4992" y="-2502.97" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- stage1_layer2_gate&#45;&gt;stage1_layer2_expert_10_tp_5 -->
<g id="edge203" class="edge">
<title>stage1_layer2_gate&#45;&gt;stage1_layer2_expert_10_tp_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4346.15,-2633C4596.17,-2633 4910.5,-2633 4910.5,-2633 4910.5,-2633 4910.5,-2588.36 4910.5,-2588.36"/>
<polygon fill="black" stroke="black" points="4914,-2588.36 4910.5,-2578.36 4907,-2588.36 4914,-2588.36"/>
</g>
<!-- stage1_layer2_expert_11_tp_5 -->
<g id="node139" class="node">
<title>stage1_layer2_expert_11_tp_5</title>
<polygon fill="lightsteelblue" stroke="black" points="5694,-2578.17 5238,-2578.17 5238,-2495.17 5694,-2495.17 5694,-2578.17"/>
<text text-anchor="middle" x="5466" y="-2562.97" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="5466" y="-2547.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="5466" y="-2532.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5466" y="-2517.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="5466" y="-2502.97" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- stage1_layer2_gate&#45;&gt;stage1_layer2_expert_11_tp_5 -->
<g id="edge204" class="edge">
<title>stage1_layer2_gate&#45;&gt;stage1_layer2_expert_11_tp_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4374.24,-2653C4768.85,-2653 5376.5,-2653 5376.5,-2653 5376.5,-2653 5376.5,-2588.34 5376.5,-2588.34"/>
<polygon fill="black" stroke="black" points="5380,-2588.34 5376.5,-2578.34 5373,-2588.34 5380,-2588.34"/>
</g>
<!-- stage1_layer2_expert_12_tp_6 -->
<g id="node140" class="node">
<title>stage1_layer2_expert_12_tp_6</title>
<polygon fill="lightsteelblue" stroke="black" points="6168,-2578.17 5712,-2578.17 5712,-2495.17 6168,-2495.17 6168,-2578.17"/>
<text text-anchor="middle" x="5940" y="-2562.97" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="5940" y="-2547.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="5940" y="-2532.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5940" y="-2517.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="5940" y="-2502.97" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- stage1_layer2_gate&#45;&gt;stage1_layer2_expert_12_tp_6 -->
<g id="edge207" class="edge">
<title>stage1_layer2_gate&#45;&gt;stage1_layer2_expert_12_tp_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4400.88,-2672C4927.67,-2672 5851.75,-2672 5851.75,-2672 5851.75,-2672 5851.75,-2588.38 5851.75,-2588.38"/>
<polygon fill="black" stroke="black" points="5855.25,-2588.38 5851.75,-2578.38 5848.25,-2588.38 5855.25,-2588.38"/>
</g>
<!-- stage1_layer2_expert_13_tp_6 -->
<g id="node141" class="node">
<title>stage1_layer2_expert_13_tp_6</title>
<polygon fill="lightsteelblue" stroke="black" points="6642,-2578.17 6186,-2578.17 6186,-2495.17 6642,-2495.17 6642,-2578.17"/>
<text text-anchor="middle" x="6414" y="-2562.97" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="6414" y="-2547.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="6414" y="-2532.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6414" y="-2517.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="6414" y="-2502.97" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- stage1_layer2_gate&#45;&gt;stage1_layer2_expert_13_tp_6 -->
<g id="edge208" class="edge">
<title>stage1_layer2_gate&#45;&gt;stage1_layer2_expert_13_tp_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4427.75,-2691C5098.61,-2691 6414,-2691 6414,-2691 6414,-2691 6414,-2588.43 6414,-2588.43"/>
<polygon fill="black" stroke="black" points="6417.5,-2588.43 6414,-2578.43 6410.5,-2588.43 6417.5,-2588.43"/>
</g>
<!-- stage1_layer2_expert_14_tp_7 -->
<g id="node142" class="node">
<title>stage1_layer2_expert_14_tp_7</title>
<polygon fill="lightsteelblue" stroke="black" points="7116,-2578.17 6660,-2578.17 6660,-2495.17 7116,-2495.17 7116,-2578.17"/>
<text text-anchor="middle" x="6888" y="-2562.97" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="6888" y="-2547.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="6888" y="-2532.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6888" y="-2517.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="6888" y="-2502.97" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- stage1_layer2_gate&#45;&gt;stage1_layer2_expert_14_tp_7 -->
<g id="edge211" class="edge">
<title>stage1_layer2_gate&#45;&gt;stage1_layer2_expert_14_tp_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4455.85,-2711C5229.43,-2711 6822.5,-2711 6822.5,-2711 6822.5,-2711 6822.5,-2588.42 6822.5,-2588.42"/>
<polygon fill="black" stroke="black" points="6826,-2588.42 6822.5,-2578.42 6819,-2588.42 6826,-2588.42"/>
</g>
<!-- stage1_layer2_expert_15_tp_7 -->
<g id="node143" class="node">
<title>stage1_layer2_expert_15_tp_7</title>
<polygon fill="lightsteelblue" stroke="black" points="7590,-2578.17 7134,-2578.17 7134,-2495.17 7590,-2495.17 7590,-2578.17"/>
<text text-anchor="middle" x="7362" y="-2562.97" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="7362" y="-2547.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="7362" y="-2532.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7362" y="-2517.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="7362" y="-2502.97" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- stage1_layer2_gate&#45;&gt;stage1_layer2_expert_15_tp_7 -->
<g id="edge212" class="edge">
<title>stage1_layer2_gate&#45;&gt;stage1_layer2_expert_15_tp_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4482.56,-2730C5378.91,-2730 7337,-2730 7337,-2730 7337,-2730 7337,-2588.62 7337,-2588.62"/>
<polygon fill="black" stroke="black" points="7340.5,-2588.62 7337,-2578.62 7333.5,-2588.62 7340.5,-2588.62"/>
</g>
<!-- stage1_layer2_expert_agg -->
<g id="node144" class="node">
<title>stage1_layer2_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="4518.67,-2459.17 3763.58,-2459.17 3569.33,-2323.17 4324.42,-2323.17 4518.67,-2459.17"/>
<text text-anchor="middle" x="4044" y="-2409.97" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4044" y="-2394.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, expert_dim=16384]</text>
<text text-anchor="middle" x="4044" y="-2379.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4044" y="-2364.97" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- stage1_layer2_expert_0_tp_0&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge185" class="edge">
<title>stage1_layer2_expert_0_tp_0&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M328,-2494.96C328,-2437.23 328,-2340 328,-2340 328,-2340 3582.99,-2340 3582.99,-2340"/>
<polygon fill="black" stroke="black" points="3582.99,-2343.5 3592.99,-2340 3582.99,-2336.5 3582.99,-2343.5"/>
</g>
<!-- stage1_layer2_expert_1_tp_0&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge186" class="edge">
<title>stage1_layer2_expert_1_tp_0&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M802,-2495C802,-2441.92 802,-2357 802,-2357 802,-2357 3607.25,-2357 3607.25,-2357"/>
<polygon fill="black" stroke="black" points="3607.25,-2360.5 3617.25,-2357 3607.25,-2353.5 3607.25,-2360.5"/>
</g>
<!-- stage1_layer2_expert_2_tp_1&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge189" class="edge">
<title>stage1_layer2_expert_2_tp_1&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M1276,-2494.78C1276,-2446.58 1276,-2374 1276,-2374 1276,-2374 3631.88,-2374 3631.88,-2374"/>
<polygon fill="black" stroke="black" points="3631.88,-2377.5 3641.88,-2374 3631.88,-2370.5 3631.88,-2377.5"/>
</g>
<!-- stage1_layer2_expert_3_tp_1&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge190" class="edge">
<title>stage1_layer2_expert_3_tp_1&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M1750,-2494.92C1750,-2451.88 1750,-2391 1750,-2391 1750,-2391 3656.16,-2391 3656.16,-2391"/>
<polygon fill="black" stroke="black" points="3656.16,-2394.5 3666.16,-2391 3656.16,-2387.5 3656.16,-2394.5"/>
</g>
<!-- stage1_layer2_expert_4_tp_2&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge193" class="edge">
<title>stage1_layer2_expert_4_tp_2&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M2224,-2494.89C2224,-2457.32 2224,-2408 2224,-2408 2224,-2408 3680.39,-2408 3680.39,-2408"/>
<polygon fill="black" stroke="black" points="3680.39,-2411.5 3690.39,-2408 3680.39,-2404.5 3680.39,-2411.5"/>
</g>
<!-- stage1_layer2_expert_5_tp_2&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge194" class="edge">
<title>stage1_layer2_expert_5_tp_2&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M2627.75,-2495.09C2627.75,-2463.34 2627.75,-2425 2627.75,-2425 2627.75,-2425 3704.63,-2425 3704.63,-2425"/>
<polygon fill="black" stroke="black" points="3704.63,-2428.5 3714.63,-2425 3704.63,-2421.5 3704.63,-2428.5"/>
</g>
<!-- stage1_layer2_expert_6_tp_3&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge197" class="edge">
<title>stage1_layer2_expert_6_tp_3&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M3127.25,-2495.14C3127.25,-2469.71 3127.25,-2442 3127.25,-2442 3127.25,-2442 3729.05,-2442 3729.05,-2442"/>
<polygon fill="black" stroke="black" points="3729.05,-2445.5 3739.05,-2442 3729.05,-2438.5 3729.05,-2445.5"/>
</g>
<!-- stage1_layer2_expert_7_tp_3&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge198" class="edge">
<title>stage1_layer2_expert_7_tp_3&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M3683.58,-2494.97C3683.58,-2494.97 3683.58,-2413.2 3683.58,-2413.2"/>
<polygon fill="black" stroke="black" points="3687.08,-2413.2 3683.58,-2403.2 3680.08,-2413.2 3687.08,-2413.2"/>
</g>
<!-- stage1_layer2_expert_8_tp_4&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge201" class="edge">
<title>stage1_layer2_expert_8_tp_4&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M4044,-2494.97C4044,-2494.97 4044,-2469.24 4044,-2469.24"/>
<polygon fill="black" stroke="black" points="4047.5,-2469.24 4044,-2459.24 4040.5,-2469.24 4047.5,-2469.24"/>
</g>
<!-- stage1_layer2_expert_9_tp_4&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge202" class="edge">
<title>stage1_layer2_expert_9_tp_4&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M4404.42,-2494.97C4404.42,-2494.97 4404.42,-2469.24 4404.42,-2469.24"/>
<polygon fill="black" stroke="black" points="4407.92,-2469.24 4404.42,-2459.24 4400.92,-2469.24 4407.92,-2469.24"/>
</g>
<!-- stage1_layer2_expert_10_tp_5&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge205" class="edge">
<title>stage1_layer2_expert_10_tp_5&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M4956.42,-2494.96C4956.42,-2468.42 4956.42,-2439 4956.42,-2439 4956.42,-2439 4500.18,-2439 4500.18,-2439"/>
<polygon fill="black" stroke="black" points="4500.18,-2435.5 4490.18,-2439 4500.18,-2442.5 4500.18,-2435.5"/>
</g>
<!-- stage1_layer2_expert_11_tp_5&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge206" class="edge">
<title>stage1_layer2_expert_11_tp_5&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M5466,-2494.88C5466,-2461.4 5466,-2420 5466,-2420 5466,-2420 4472.96,-2420 4472.96,-2420"/>
<polygon fill="black" stroke="black" points="4472.96,-2416.5 4462.96,-2420 4472.96,-2423.5 4472.96,-2416.5"/>
</g>
<!-- stage1_layer2_expert_12_tp_6&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge209" class="edge">
<title>stage1_layer2_expert_12_tp_6&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M5868.5,-2494.92C5868.5,-2454.73 5868.5,-2400 5868.5,-2400 5868.5,-2400 4444.28,-2400 4444.28,-2400"/>
<polygon fill="black" stroke="black" points="4444.28,-2396.5 4434.28,-2400 4444.28,-2403.5 4444.28,-2396.5"/>
</g>
<!-- stage1_layer2_expert_13_tp_6&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge210" class="edge">
<title>stage1_layer2_expert_13_tp_6&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M6386.75,-2494.95C6386.75,-2448.84 6386.75,-2381 6386.75,-2381 6386.75,-2381 4417.16,-2381 4417.16,-2381"/>
<polygon fill="black" stroke="black" points="4417.16,-2377.5 4407.16,-2381 4417.16,-2384.5 4417.16,-2377.5"/>
</g>
<!-- stage1_layer2_expert_14_tp_7&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge213" class="edge">
<title>stage1_layer2_expert_14_tp_7&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M6746.5,-2494.83C6746.5,-2443.16 6746.5,-2362 6746.5,-2362 6746.5,-2362 4390.13,-2362 4390.13,-2362"/>
<polygon fill="black" stroke="black" points="4390.13,-2358.5 4380.13,-2362 4390.13,-2365.5 4390.13,-2358.5"/>
</g>
<!-- stage1_layer2_expert_15_tp_7&#45;&gt;stage1_layer2_expert_agg -->
<g id="edge214" class="edge">
<title>stage1_layer2_expert_15_tp_7&#45;&gt;stage1_layer2_expert_agg</title>
<path fill="none" stroke="black" d="M7438,-2494.91C7438,-2437.71 7438,-2342 7438,-2342 7438,-2342 4361.56,-2342 4361.56,-2342"/>
<polygon fill="black" stroke="black" points="4361.56,-2338.5 4351.56,-2342 4361.56,-2345.5 4361.56,-2338.5"/>
</g>
<!-- stage1_layer2_expert_allreduce -->
<g id="node145" class="node">
<title>stage1_layer2_expert_allreduce</title>
<polygon fill="lightyellow" stroke="black" points="5148.67,-2287.17 4393.58,-2287.17 4199.33,-2151.17 4954.42,-2151.17 5148.67,-2287.17"/>
<text text-anchor="middle" x="4674" y="-2237.97" font-family="Times,serif" font-size="14.00">MoE All&#45;Reduce</text>
<text text-anchor="middle" x="4674" y="-2222.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4674" y="-2207.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4674" y="-2192.97" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- stage1_layer2_expert_agg&#45;&gt;stage1_layer2_expert_allreduce -->
<g id="edge215" class="edge">
<title>stage1_layer2_expert_agg&#45;&gt;stage1_layer2_expert_allreduce</title>
<path fill="none" stroke="black" d="M4359,-2347.32C4359,-2347.32 4359,-2273.23 4359,-2273.23"/>
<polygon fill="black" stroke="black" points="4362.5,-2273.23 4359,-2263.23 4355.5,-2273.23 4362.5,-2273.23"/>
</g>
<!-- stage1_layer2_expert_allreduce&#45;&gt;stage1_layer2_residual2 -->
<g id="edge216" class="edge">
<title>stage1_layer2_expert_allreduce&#45;&gt;stage1_layer2_residual2</title>
<path fill="none" stroke="black" d="M5128.92,-2219.03C5128.92,-2219.03 5128.92,-2045.95 5128.92,-2045.95"/>
<polygon fill="black" stroke="black" points="5132.42,-2045.95 5128.92,-2035.95 5125.42,-2045.95 5132.42,-2045.95"/>
</g>
<!-- stage1_layer3_ln1 -->
<g id="node147" class="node">
<title>stage1_layer3_ln1</title>
<polygon fill="lightgreen" stroke="black" points="4988,-1902.17 4530,-1902.17 4530,-1834.17 4988,-1834.17 4988,-1902.17"/>
<text text-anchor="middle" x="4759" y="-1886.97" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="4759" y="-1871.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4759" y="-1856.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4759" y="-1841.97" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- stage1_layer2_residual2&#45;&gt;stage1_layer3_ln1 -->
<g id="edge218" class="edge">
<title>stage1_layer2_residual2&#45;&gt;stage1_layer3_ln1</title>
<path fill="none" stroke="black" d="M5323.25,-1993.15C5323.25,-1950.46 5323.25,-1888 5323.25,-1888 5323.25,-1888 4998.1,-1888 4998.1,-1888"/>
<polygon fill="black" stroke="black" points="4998.1,-1884.5 4988.1,-1888 4998.1,-1891.5 4998.1,-1884.5"/>
</g>
<!-- stage1_layer3_residual1 -->
<g id="node173" class="node">
<title>stage1_layer3_residual1</title>
<polygon fill="lightpink" stroke="black" points="6375,-1239.17 5917,-1156.17 6375,-1073.17 6833,-1156.17 6375,-1239.17"/>
<text text-anchor="middle" x="6375" y="-1182.47" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="6375" y="-1167.47" font-family="Times,serif" font-size="14.00">Input1: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6375" y="-1152.47" font-family="Times,serif" font-size="14.00">Input2: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6375" y="-1137.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6375" y="-1122.47" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- stage1_layer2_residual2&#45;&gt;stage1_layer3_residual1 -->
<g id="edge252" class="edge">
<title>stage1_layer2_residual2&#45;&gt;stage1_layer3_residual1</title>
<path fill="none" stroke="black" d="M5869.88,-2004C5975.89,-2004 6069,-2004 6069,-2004 6069,-2004 6069,-1193.89 6069,-1193.89"/>
<polygon fill="black" stroke="black" points="6072.5,-1193.89 6069,-1183.89 6065.5,-1193.89 6072.5,-1193.89"/>
</g>
<!-- stage1_layer3_qkv_tp_0 -->
<g id="node148" class="node">
<title>stage1_layer3_qkv_tp_0</title>
<polygon fill="lightcoral" stroke="black" points="2912.5,-1798.17 2405.5,-1798.17 2405.5,-1700.17 2912.5,-1700.17 2912.5,-1798.17"/>
<text text-anchor="middle" x="2659" y="-1782.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="2659" y="-1767.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="2659" y="-1752.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="2659" y="-1737.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="2659" y="-1722.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="2659" y="-1707.97" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- stage1_layer3_ln1&#45;&gt;stage1_layer3_qkv_tp_0 -->
<g id="edge219" class="edge">
<title>stage1_layer3_ln1&#45;&gt;stage1_layer3_qkv_tp_0</title>
<path fill="none" stroke="black" d="M4529.85,-1888C4030.84,-1888 2890.25,-1888 2890.25,-1888 2890.25,-1888 2890.25,-1808.5 2890.25,-1808.5"/>
<polygon fill="black" stroke="black" points="2893.75,-1808.5 2890.25,-1798.5 2886.75,-1808.5 2893.75,-1808.5"/>
</g>
<!-- stage1_layer3_qkv_tp_1 -->
<g id="node149" class="node">
<title>stage1_layer3_qkv_tp_1</title>
<polygon fill="lightcoral" stroke="black" points="3437.5,-1798.17 2930.5,-1798.17 2930.5,-1700.17 3437.5,-1700.17 3437.5,-1798.17"/>
<text text-anchor="middle" x="3184" y="-1782.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3184" y="-1767.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="3184" y="-1752.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="3184" y="-1737.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3184" y="-1722.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="3184" y="-1707.97" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- stage1_layer3_ln1&#45;&gt;stage1_layer3_qkv_tp_1 -->
<g id="edge223" class="edge">
<title>stage1_layer3_ln1&#45;&gt;stage1_layer3_qkv_tp_1</title>
<path fill="none" stroke="black" d="M4529.82,-1874C4140.03,-1874 3389.75,-1874 3389.75,-1874 3389.75,-1874 3389.75,-1808.5 3389.75,-1808.5"/>
<polygon fill="black" stroke="black" points="3393.25,-1808.5 3389.75,-1798.5 3386.25,-1808.5 3393.25,-1808.5"/>
</g>
<!-- stage1_layer3_qkv_tp_2 -->
<g id="node150" class="node">
<title>stage1_layer3_qkv_tp_2</title>
<polygon fill="lightcoral" stroke="black" points="3962.5,-1798.17 3455.5,-1798.17 3455.5,-1700.17 3962.5,-1700.17 3962.5,-1798.17"/>
<text text-anchor="middle" x="3709" y="-1782.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3709" y="-1767.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="3709" y="-1752.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="3709" y="-1737.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3709" y="-1722.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="3709" y="-1707.97" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- stage1_layer3_ln1&#45;&gt;stage1_layer3_qkv_tp_2 -->
<g id="edge227" class="edge">
<title>stage1_layer3_ln1&#45;&gt;stage1_layer3_qkv_tp_2</title>
<path fill="none" stroke="black" d="M4529.9,-1861C4236.59,-1861 3765.83,-1861 3765.83,-1861 3765.83,-1861 3765.83,-1808.22 3765.83,-1808.22"/>
<polygon fill="black" stroke="black" points="3769.33,-1808.22 3765.83,-1798.22 3762.33,-1808.22 3769.33,-1808.22"/>
</g>
<!-- stage1_layer3_qkv_tp_3 -->
<g id="node151" class="node">
<title>stage1_layer3_qkv_tp_3</title>
<polygon fill="lightcoral" stroke="black" points="4487.5,-1798.17 3980.5,-1798.17 3980.5,-1700.17 4487.5,-1700.17 4487.5,-1798.17"/>
<text text-anchor="middle" x="4234" y="-1782.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4234" y="-1767.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="4234" y="-1752.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="4234" y="-1737.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4234" y="-1722.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4234" y="-1707.97" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- stage1_layer3_ln1&#45;&gt;stage1_layer3_qkv_tp_3 -->
<g id="edge231" class="edge">
<title>stage1_layer3_ln1&#45;&gt;stage1_layer3_qkv_tp_3</title>
<path fill="none" stroke="black" d="M4529.89,-1847C4433.53,-1847 4343.33,-1847 4343.33,-1847 4343.33,-1847 4343.33,-1808.37 4343.33,-1808.37"/>
<polygon fill="black" stroke="black" points="4346.83,-1808.37 4343.33,-1798.37 4339.83,-1808.37 4346.83,-1808.37"/>
</g>
<!-- stage1_layer3_qkv_tp_4 -->
<g id="node152" class="node">
<title>stage1_layer3_qkv_tp_4</title>
<polygon fill="lightcoral" stroke="black" points="5012.5,-1798.17 4505.5,-1798.17 4505.5,-1700.17 5012.5,-1700.17 5012.5,-1798.17"/>
<text text-anchor="middle" x="4759" y="-1782.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4759" y="-1767.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="4759" y="-1752.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="4759" y="-1737.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4759" y="-1722.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4759" y="-1707.97" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- stage1_layer3_ln1&#45;&gt;stage1_layer3_qkv_tp_4 -->
<g id="edge235" class="edge">
<title>stage1_layer3_ln1&#45;&gt;stage1_layer3_qkv_tp_4</title>
<path fill="none" stroke="black" d="M4759,-1834.07C4759,-1834.07 4759,-1808.35 4759,-1808.35"/>
<polygon fill="black" stroke="black" points="4762.5,-1808.35 4759,-1798.35 4755.5,-1808.35 4762.5,-1808.35"/>
</g>
<!-- stage1_layer3_qkv_tp_5 -->
<g id="node153" class="node">
<title>stage1_layer3_qkv_tp_5</title>
<polygon fill="lightcoral" stroke="black" points="5537.5,-1798.17 5030.5,-1798.17 5030.5,-1700.17 5537.5,-1700.17 5537.5,-1798.17"/>
<text text-anchor="middle" x="5284" y="-1782.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5284" y="-1767.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="5284" y="-1752.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="5284" y="-1737.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5284" y="-1722.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5284" y="-1707.97" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- stage1_layer3_ln1&#45;&gt;stage1_layer3_qkv_tp_5 -->
<g id="edge239" class="edge">
<title>stage1_layer3_ln1&#45;&gt;stage1_layer3_qkv_tp_5</title>
<path fill="none" stroke="black" d="M4988.1,-1847C5034.68,-1847 5069.75,-1847 5069.75,-1847 5069.75,-1847 5069.75,-1808.37 5069.75,-1808.37"/>
<polygon fill="black" stroke="black" points="5073.25,-1808.37 5069.75,-1798.37 5066.25,-1808.37 5073.25,-1808.37"/>
</g>
<!-- stage1_layer3_qkv_tp_6 -->
<g id="node154" class="node">
<title>stage1_layer3_qkv_tp_6</title>
<polygon fill="lightcoral" stroke="black" points="6062.5,-1798.17 5555.5,-1798.17 5555.5,-1700.17 6062.5,-1700.17 6062.5,-1798.17"/>
<text text-anchor="middle" x="5809" y="-1782.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5809" y="-1767.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="5809" y="-1752.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="5809" y="-1737.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5809" y="-1722.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5809" y="-1707.97" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- stage1_layer3_ln1&#45;&gt;stage1_layer3_qkv_tp_6 -->
<g id="edge243" class="edge">
<title>stage1_layer3_ln1&#45;&gt;stage1_layer3_qkv_tp_6</title>
<path fill="none" stroke="black" d="M4988.19,-1861C5292.03,-1861 5790.25,-1861 5790.25,-1861 5790.25,-1861 5790.25,-1808.22 5790.25,-1808.22"/>
<polygon fill="black" stroke="black" points="5793.75,-1808.22 5790.25,-1798.22 5786.75,-1808.22 5793.75,-1808.22"/>
</g>
<!-- stage1_layer3_qkv_tp_7 -->
<g id="node155" class="node">
<title>stage1_layer3_qkv_tp_7</title>
<polygon fill="lightcoral" stroke="black" points="6587.5,-1798.17 6080.5,-1798.17 6080.5,-1700.17 6587.5,-1700.17 6587.5,-1798.17"/>
<text text-anchor="middle" x="6334" y="-1782.97" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="6334" y="-1767.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="6334" y="-1752.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="6334" y="-1737.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6334" y="-1722.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6334" y="-1707.97" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- stage1_layer3_ln1&#45;&gt;stage1_layer3_qkv_tp_7 -->
<g id="edge247" class="edge">
<title>stage1_layer3_ln1&#45;&gt;stage1_layer3_qkv_tp_7</title>
<path fill="none" stroke="black" d="M4988.28,-1874C5377.15,-1874 6124.25,-1874 6124.25,-1874 6124.25,-1874 6124.25,-1808.5 6124.25,-1808.5"/>
<polygon fill="black" stroke="black" points="6127.75,-1808.5 6124.25,-1798.5 6120.75,-1808.5 6127.75,-1808.5"/>
</g>
<!-- stage1_layer3_attn_tp_0 -->
<g id="node156" class="node">
<title>stage1_layer3_attn_tp_0</title>
<polygon fill="lightcoral" stroke="black" points="2912.5,-1664.17 2405.5,-1664.17 2405.5,-1566.17 2912.5,-1566.17 2912.5,-1664.17"/>
<text text-anchor="middle" x="2659" y="-1648.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="2659" y="-1633.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="2659" y="-1618.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="2659" y="-1603.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="2659" y="-1588.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="2659" y="-1573.97" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- stage1_layer3_qkv_tp_0&#45;&gt;stage1_layer3_attn_tp_0 -->
<g id="edge220" class="edge">
<title>stage1_layer3_qkv_tp_0&#45;&gt;stage1_layer3_attn_tp_0</title>
<path fill="none" stroke="black" d="M2659,-1700.03C2659,-1700.03 2659,-1674.3 2659,-1674.3"/>
<polygon fill="black" stroke="black" points="2662.5,-1674.3 2659,-1664.3 2655.5,-1674.3 2662.5,-1674.3"/>
</g>
<!-- stage1_layer3_attn_tp_1 -->
<g id="node157" class="node">
<title>stage1_layer3_attn_tp_1</title>
<polygon fill="lightcoral" stroke="black" points="3437.5,-1664.17 2930.5,-1664.17 2930.5,-1566.17 3437.5,-1566.17 3437.5,-1664.17"/>
<text text-anchor="middle" x="3184" y="-1648.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="3184" y="-1633.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="3184" y="-1618.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="3184" y="-1603.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="3184" y="-1588.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="3184" y="-1573.97" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- stage1_layer3_qkv_tp_1&#45;&gt;stage1_layer3_attn_tp_1 -->
<g id="edge224" class="edge">
<title>stage1_layer3_qkv_tp_1&#45;&gt;stage1_layer3_attn_tp_1</title>
<path fill="none" stroke="black" d="M3184,-1700.03C3184,-1700.03 3184,-1674.3 3184,-1674.3"/>
<polygon fill="black" stroke="black" points="3187.5,-1674.3 3184,-1664.3 3180.5,-1674.3 3187.5,-1674.3"/>
</g>
<!-- stage1_layer3_attn_tp_2 -->
<g id="node158" class="node">
<title>stage1_layer3_attn_tp_2</title>
<polygon fill="lightcoral" stroke="black" points="3962.5,-1664.17 3455.5,-1664.17 3455.5,-1566.17 3962.5,-1566.17 3962.5,-1664.17"/>
<text text-anchor="middle" x="3709" y="-1648.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="3709" y="-1633.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="3709" y="-1618.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="3709" y="-1603.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="3709" y="-1588.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="3709" y="-1573.97" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- stage1_layer3_qkv_tp_2&#45;&gt;stage1_layer3_attn_tp_2 -->
<g id="edge228" class="edge">
<title>stage1_layer3_qkv_tp_2&#45;&gt;stage1_layer3_attn_tp_2</title>
<path fill="none" stroke="black" d="M3709,-1700.03C3709,-1700.03 3709,-1674.3 3709,-1674.3"/>
<polygon fill="black" stroke="black" points="3712.5,-1674.3 3709,-1664.3 3705.5,-1674.3 3712.5,-1674.3"/>
</g>
<!-- stage1_layer3_attn_tp_3 -->
<g id="node159" class="node">
<title>stage1_layer3_attn_tp_3</title>
<polygon fill="lightcoral" stroke="black" points="4487.5,-1664.17 3980.5,-1664.17 3980.5,-1566.17 4487.5,-1566.17 4487.5,-1664.17"/>
<text text-anchor="middle" x="4234" y="-1648.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="4234" y="-1633.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="4234" y="-1618.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="4234" y="-1603.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4234" y="-1588.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4234" y="-1573.97" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- stage1_layer3_qkv_tp_3&#45;&gt;stage1_layer3_attn_tp_3 -->
<g id="edge232" class="edge">
<title>stage1_layer3_qkv_tp_3&#45;&gt;stage1_layer3_attn_tp_3</title>
<path fill="none" stroke="black" d="M4234,-1700.03C4234,-1700.03 4234,-1674.3 4234,-1674.3"/>
<polygon fill="black" stroke="black" points="4237.5,-1674.3 4234,-1664.3 4230.5,-1674.3 4237.5,-1674.3"/>
</g>
<!-- stage1_layer3_attn_tp_4 -->
<g id="node160" class="node">
<title>stage1_layer3_attn_tp_4</title>
<polygon fill="lightcoral" stroke="black" points="5012.5,-1664.17 4505.5,-1664.17 4505.5,-1566.17 5012.5,-1566.17 5012.5,-1664.17"/>
<text text-anchor="middle" x="4759" y="-1648.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="4759" y="-1633.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="4759" y="-1618.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="4759" y="-1603.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4759" y="-1588.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4759" y="-1573.97" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- stage1_layer3_qkv_tp_4&#45;&gt;stage1_layer3_attn_tp_4 -->
<g id="edge236" class="edge">
<title>stage1_layer3_qkv_tp_4&#45;&gt;stage1_layer3_attn_tp_4</title>
<path fill="none" stroke="black" d="M4759,-1700.03C4759,-1700.03 4759,-1674.3 4759,-1674.3"/>
<polygon fill="black" stroke="black" points="4762.5,-1674.3 4759,-1664.3 4755.5,-1674.3 4762.5,-1674.3"/>
</g>
<!-- stage1_layer3_attn_tp_5 -->
<g id="node161" class="node">
<title>stage1_layer3_attn_tp_5</title>
<polygon fill="lightcoral" stroke="black" points="5537.5,-1664.17 5030.5,-1664.17 5030.5,-1566.17 5537.5,-1566.17 5537.5,-1664.17"/>
<text text-anchor="middle" x="5284" y="-1648.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="5284" y="-1633.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="5284" y="-1618.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="5284" y="-1603.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5284" y="-1588.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5284" y="-1573.97" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- stage1_layer3_qkv_tp_5&#45;&gt;stage1_layer3_attn_tp_5 -->
<g id="edge240" class="edge">
<title>stage1_layer3_qkv_tp_5&#45;&gt;stage1_layer3_attn_tp_5</title>
<path fill="none" stroke="black" d="M5284,-1700.03C5284,-1700.03 5284,-1674.3 5284,-1674.3"/>
<polygon fill="black" stroke="black" points="5287.5,-1674.3 5284,-1664.3 5280.5,-1674.3 5287.5,-1674.3"/>
</g>
<!-- stage1_layer3_attn_tp_6 -->
<g id="node162" class="node">
<title>stage1_layer3_attn_tp_6</title>
<polygon fill="lightcoral" stroke="black" points="6062.5,-1664.17 5555.5,-1664.17 5555.5,-1566.17 6062.5,-1566.17 6062.5,-1664.17"/>
<text text-anchor="middle" x="5809" y="-1648.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="5809" y="-1633.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="5809" y="-1618.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="5809" y="-1603.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5809" y="-1588.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5809" y="-1573.97" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- stage1_layer3_qkv_tp_6&#45;&gt;stage1_layer3_attn_tp_6 -->
<g id="edge244" class="edge">
<title>stage1_layer3_qkv_tp_6&#45;&gt;stage1_layer3_attn_tp_6</title>
<path fill="none" stroke="black" d="M5809,-1700.03C5809,-1700.03 5809,-1674.3 5809,-1674.3"/>
<polygon fill="black" stroke="black" points="5812.5,-1674.3 5809,-1664.3 5805.5,-1674.3 5812.5,-1674.3"/>
</g>
<!-- stage1_layer3_attn_tp_7 -->
<g id="node163" class="node">
<title>stage1_layer3_attn_tp_7</title>
<polygon fill="lightcoral" stroke="black" points="6587.5,-1664.17 6080.5,-1664.17 6080.5,-1566.17 6587.5,-1566.17 6587.5,-1664.17"/>
<text text-anchor="middle" x="6334" y="-1648.97" font-family="Times,serif" font-size="14.00">Attention Computation</text>
<text text-anchor="middle" x="6334" y="-1633.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="6334" y="-1618.97" font-family="Times,serif" font-size="14.00">Heads=4</text>
<text text-anchor="middle" x="6334" y="-1603.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6334" y="-1588.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6334" y="-1573.97" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- stage1_layer3_qkv_tp_7&#45;&gt;stage1_layer3_attn_tp_7 -->
<g id="edge248" class="edge">
<title>stage1_layer3_qkv_tp_7&#45;&gt;stage1_layer3_attn_tp_7</title>
<path fill="none" stroke="black" d="M6334,-1700.03C6334,-1700.03 6334,-1674.3 6334,-1674.3"/>
<polygon fill="black" stroke="black" points="6337.5,-1674.3 6334,-1664.3 6330.5,-1674.3 6337.5,-1674.3"/>
</g>
<!-- stage1_layer3_attn_out_tp_0 -->
<g id="node164" class="node">
<title>stage1_layer3_attn_out_tp_0</title>
<polygon fill="lightcoral" stroke="black" points="2919.5,-1530.17 2424.5,-1530.17 2424.5,-1447.17 2919.5,-1447.17 2919.5,-1530.17"/>
<text text-anchor="middle" x="2672" y="-1514.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="2672" y="-1499.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="2672" y="-1484.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="2672" y="-1469.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="2672" y="-1454.97" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- stage1_layer3_attn_tp_0&#45;&gt;stage1_layer3_attn_out_tp_0 -->
<g id="edge221" class="edge">
<title>stage1_layer3_attn_tp_0&#45;&gt;stage1_layer3_attn_out_tp_0</title>
<path fill="none" stroke="black" d="M2668.5,-1565.9C2668.5,-1565.9 2668.5,-1540.22 2668.5,-1540.22"/>
<polygon fill="black" stroke="black" points="2672,-1540.22 2668.5,-1530.22 2665,-1540.22 2672,-1540.22"/>
</g>
<!-- stage1_layer3_attn_out_tp_1 -->
<g id="node165" class="node">
<title>stage1_layer3_attn_out_tp_1</title>
<polygon fill="lightcoral" stroke="black" points="3446.5,-1530.17 2951.5,-1530.17 2951.5,-1447.17 3446.5,-1447.17 3446.5,-1530.17"/>
<text text-anchor="middle" x="3199" y="-1514.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3199" y="-1499.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="3199" y="-1484.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="3199" y="-1469.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3199" y="-1454.97" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- stage1_layer3_attn_tp_1&#45;&gt;stage1_layer3_attn_out_tp_1 -->
<g id="edge225" class="edge">
<title>stage1_layer3_attn_tp_1&#45;&gt;stage1_layer3_attn_out_tp_1</title>
<path fill="none" stroke="black" d="M3194.5,-1565.9C3194.5,-1565.9 3194.5,-1540.22 3194.5,-1540.22"/>
<polygon fill="black" stroke="black" points="3198,-1540.22 3194.5,-1530.22 3191,-1540.22 3198,-1540.22"/>
</g>
<!-- stage1_layer3_attn_out_tp_2 -->
<g id="node166" class="node">
<title>stage1_layer3_attn_out_tp_2</title>
<polygon fill="lightcoral" stroke="black" points="3965.5,-1530.17 3470.5,-1530.17 3470.5,-1447.17 3965.5,-1447.17 3965.5,-1530.17"/>
<text text-anchor="middle" x="3718" y="-1514.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3718" y="-1499.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="3718" y="-1484.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="3718" y="-1469.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3718" y="-1454.97" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- stage1_layer3_attn_tp_2&#45;&gt;stage1_layer3_attn_out_tp_2 -->
<g id="edge229" class="edge">
<title>stage1_layer3_attn_tp_2&#45;&gt;stage1_layer3_attn_out_tp_2</title>
<path fill="none" stroke="black" d="M3716.5,-1565.9C3716.5,-1565.9 3716.5,-1540.22 3716.5,-1540.22"/>
<polygon fill="black" stroke="black" points="3720,-1540.22 3716.5,-1530.22 3713,-1540.22 3720,-1540.22"/>
</g>
<!-- stage1_layer3_attn_out_tp_3 -->
<g id="node167" class="node">
<title>stage1_layer3_attn_out_tp_3</title>
<polygon fill="lightcoral" stroke="black" points="4487.5,-1530.17 3992.5,-1530.17 3992.5,-1447.17 4487.5,-1447.17 4487.5,-1530.17"/>
<text text-anchor="middle" x="4240" y="-1514.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4240" y="-1499.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="4240" y="-1484.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4240" y="-1469.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4240" y="-1454.97" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- stage1_layer3_attn_tp_3&#45;&gt;stage1_layer3_attn_out_tp_3 -->
<g id="edge233" class="edge">
<title>stage1_layer3_attn_tp_3&#45;&gt;stage1_layer3_attn_out_tp_3</title>
<path fill="none" stroke="black" d="M4240,-1565.9C4240,-1565.9 4240,-1540.22 4240,-1540.22"/>
<polygon fill="black" stroke="black" points="4243.5,-1540.22 4240,-1530.22 4236.5,-1540.22 4243.5,-1540.22"/>
</g>
<!-- stage1_layer3_attn_out_tp_4 -->
<g id="node168" class="node">
<title>stage1_layer3_attn_out_tp_4</title>
<polygon fill="lightcoral" stroke="black" points="5006.5,-1530.17 4511.5,-1530.17 4511.5,-1447.17 5006.5,-1447.17 5006.5,-1530.17"/>
<text text-anchor="middle" x="4759" y="-1514.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="4759" y="-1499.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="4759" y="-1484.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="4759" y="-1469.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4759" y="-1454.97" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- stage1_layer3_attn_tp_4&#45;&gt;stage1_layer3_attn_out_tp_4 -->
<g id="edge237" class="edge">
<title>stage1_layer3_attn_tp_4&#45;&gt;stage1_layer3_attn_out_tp_4</title>
<path fill="none" stroke="black" d="M4759,-1565.9C4759,-1565.9 4759,-1540.22 4759,-1540.22"/>
<polygon fill="black" stroke="black" points="4762.5,-1540.22 4759,-1530.22 4755.5,-1540.22 4762.5,-1540.22"/>
</g>
<!-- stage1_layer3_attn_out_tp_5 -->
<g id="node169" class="node">
<title>stage1_layer3_attn_out_tp_5</title>
<polygon fill="lightcoral" stroke="black" points="5525.5,-1530.17 5030.5,-1530.17 5030.5,-1447.17 5525.5,-1447.17 5525.5,-1530.17"/>
<text text-anchor="middle" x="5278" y="-1514.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="5278" y="-1499.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="5278" y="-1484.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5278" y="-1469.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5278" y="-1454.97" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- stage1_layer3_attn_tp_5&#45;&gt;stage1_layer3_attn_out_tp_5 -->
<g id="edge241" class="edge">
<title>stage1_layer3_attn_tp_5&#45;&gt;stage1_layer3_attn_out_tp_5</title>
<path fill="none" stroke="black" d="M5278,-1565.9C5278,-1565.9 5278,-1540.22 5278,-1540.22"/>
<polygon fill="black" stroke="black" points="5281.5,-1540.22 5278,-1530.22 5274.5,-1540.22 5281.5,-1540.22"/>
</g>
<!-- stage1_layer3_attn_out_tp_6 -->
<g id="node170" class="node">
<title>stage1_layer3_attn_out_tp_6</title>
<polygon fill="lightcoral" stroke="black" points="6047.5,-1530.17 5552.5,-1530.17 5552.5,-1447.17 6047.5,-1447.17 6047.5,-1530.17"/>
<text text-anchor="middle" x="5800" y="-1514.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="5800" y="-1499.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="5800" y="-1484.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="5800" y="-1469.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5800" y="-1454.97" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- stage1_layer3_attn_tp_6&#45;&gt;stage1_layer3_attn_out_tp_6 -->
<g id="edge245" class="edge">
<title>stage1_layer3_attn_tp_6&#45;&gt;stage1_layer3_attn_out_tp_6</title>
<path fill="none" stroke="black" d="M5801.5,-1565.9C5801.5,-1565.9 5801.5,-1540.22 5801.5,-1540.22"/>
<polygon fill="black" stroke="black" points="5805,-1540.22 5801.5,-1530.22 5798,-1540.22 5805,-1540.22"/>
</g>
<!-- stage1_layer3_attn_out_tp_7 -->
<g id="node171" class="node">
<title>stage1_layer3_attn_out_tp_7</title>
<polygon fill="lightcoral" stroke="black" points="6570.5,-1530.17 6075.5,-1530.17 6075.5,-1447.17 6570.5,-1447.17 6570.5,-1530.17"/>
<text text-anchor="middle" x="6323" y="-1514.97" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="6323" y="-1499.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="6323" y="-1484.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, heads=4, head_dim=128]</text>
<text text-anchor="middle" x="6323" y="-1469.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6323" y="-1454.97" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- stage1_layer3_attn_tp_7&#45;&gt;stage1_layer3_attn_out_tp_7 -->
<g id="edge249" class="edge">
<title>stage1_layer3_attn_tp_7&#45;&gt;stage1_layer3_attn_out_tp_7</title>
<path fill="none" stroke="black" d="M6325.5,-1565.9C6325.5,-1565.9 6325.5,-1540.22 6325.5,-1540.22"/>
<polygon fill="black" stroke="black" points="6329,-1540.22 6325.5,-1530.22 6322,-1540.22 6329,-1540.22"/>
</g>
<!-- stage1_layer3_attn_allreduce -->
<g id="node172" class="node">
<title>stage1_layer3_attn_allreduce</title>
<polygon fill="lightyellow" stroke="black" points="5233.67,-1411.17 4478.58,-1411.17 4284.33,-1275.17 5039.42,-1275.17 5233.67,-1411.17"/>
<text text-anchor="middle" x="4759" y="-1361.97" font-family="Times,serif" font-size="14.00">Attention All&#45;Reduce</text>
<text text-anchor="middle" x="4759" y="-1346.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4759" y="-1331.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4759" y="-1316.97" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- stage1_layer3_attn_out_tp_0&#45;&gt;stage1_layer3_attn_allreduce -->
<g id="edge222" class="edge">
<title>stage1_layer3_attn_out_tp_0&#45;&gt;stage1_layer3_attn_allreduce</title>
<path fill="none" stroke="black" d="M2893.75,-1447C2893.75,-1393.92 2893.75,-1309 2893.75,-1309 2893.75,-1309 4322.54,-1309 4322.54,-1309"/>
<polygon fill="black" stroke="black" points="4322.54,-1312.5 4332.54,-1309 4322.54,-1305.5 4322.54,-1312.5"/>
</g>
<!-- stage1_layer3_attn_out_tp_1&#45;&gt;stage1_layer3_attn_allreduce -->
<g id="edge226" class="edge">
<title>stage1_layer3_attn_out_tp_1&#45;&gt;stage1_layer3_attn_allreduce</title>
<path fill="none" stroke="black" d="M3394.25,-1446.92C3394.25,-1403.88 3394.25,-1343 3394.25,-1343 3394.25,-1343 4371.11,-1343 4371.11,-1343"/>
<polygon fill="black" stroke="black" points="4371.11,-1346.5 4381.11,-1343 4371.11,-1339.5 4371.11,-1346.5"/>
</g>
<!-- stage1_layer3_attn_out_tp_2&#45;&gt;stage1_layer3_attn_allreduce -->
<g id="edge230" class="edge">
<title>stage1_layer3_attn_out_tp_2&#45;&gt;stage1_layer3_attn_allreduce</title>
<path fill="none" stroke="black" d="M3771.48,-1447.09C3771.48,-1415.34 3771.48,-1377 3771.48,-1377 3771.48,-1377 4419.48,-1377 4419.48,-1377"/>
<polygon fill="black" stroke="black" points="4419.48,-1380.5 4429.48,-1377 4419.48,-1373.5 4419.48,-1380.5"/>
</g>
<!-- stage1_layer3_attn_out_tp_3&#45;&gt;stage1_layer3_attn_allreduce -->
<g id="edge234" class="edge">
<title>stage1_layer3_attn_out_tp_3&#45;&gt;stage1_layer3_attn_allreduce</title>
<path fill="none" stroke="black" d="M4385.83,-1446.97C4385.83,-1446.97 4385.83,-1356.56 4385.83,-1356.56"/>
<polygon fill="black" stroke="black" points="4389.33,-1356.56 4385.83,-1346.56 4382.33,-1356.56 4389.33,-1356.56"/>
</g>
<!-- stage1_layer3_attn_out_tp_4&#45;&gt;stage1_layer3_attn_allreduce -->
<g id="edge238" class="edge">
<title>stage1_layer3_attn_out_tp_4&#45;&gt;stage1_layer3_attn_allreduce</title>
<path fill="none" stroke="black" d="M4759,-1446.97C4759,-1446.97 4759,-1421.24 4759,-1421.24"/>
<polygon fill="black" stroke="black" points="4762.5,-1421.24 4759,-1411.24 4755.5,-1421.24 4762.5,-1421.24"/>
</g>
<!-- stage1_layer3_attn_out_tp_5&#45;&gt;stage1_layer3_attn_allreduce -->
<g id="edge242" class="edge">
<title>stage1_layer3_attn_out_tp_5&#45;&gt;stage1_layer3_attn_allreduce</title>
<path fill="none" stroke="black" d="M5132.17,-1446.97C5132.17,-1446.97 5132.17,-1421.24 5132.17,-1421.24"/>
<polygon fill="black" stroke="black" points="5135.67,-1421.24 5132.17,-1411.24 5128.67,-1421.24 5135.67,-1421.24"/>
</g>
<!-- stage1_layer3_attn_out_tp_6&#45;&gt;stage1_layer3_attn_allreduce -->
<g id="edge246" class="edge">
<title>stage1_layer3_attn_out_tp_6&#45;&gt;stage1_layer3_attn_allreduce</title>
<path fill="none" stroke="black" d="M5623.25,-1447.14C5623.25,-1411.22 5623.25,-1365 5623.25,-1365 5623.25,-1365 5178.03,-1365 5178.03,-1365"/>
<polygon fill="black" stroke="black" points="5178.03,-1361.5 5168.03,-1365 5178.03,-1368.5 5178.03,-1361.5"/>
</g>
<!-- stage1_layer3_attn_out_tp_7&#45;&gt;stage1_layer3_attn_allreduce -->
<g id="edge250" class="edge">
<title>stage1_layer3_attn_out_tp_7&#45;&gt;stage1_layer3_attn_allreduce</title>
<path fill="none" stroke="black" d="M6323,-1446.97C6323,-1397.03 6323,-1320 6323,-1320 6323,-1320 5113.68,-1320 5113.68,-1320"/>
<polygon fill="black" stroke="black" points="5113.68,-1316.5 5103.68,-1320 5113.68,-1323.5 5113.68,-1316.5"/>
</g>
<!-- stage1_layer3_attn_allreduce&#45;&gt;stage1_layer3_residual1 -->
<g id="edge251" class="edge">
<title>stage1_layer3_attn_allreduce&#45;&gt;stage1_layer3_residual1</title>
<path fill="none" stroke="black" d="M5226.92,-1343.03C5226.92,-1337.36 5226.92,-1156 5226.92,-1156 5226.92,-1156 5907.54,-1156 5907.54,-1156"/>
<polygon fill="black" stroke="black" points="5907.54,-1159.5 5917.54,-1156 5907.54,-1152.5 5907.54,-1159.5"/>
</g>
<!-- stage1_layer3_ln2 -->
<g id="node174" class="node">
<title>stage1_layer3_ln2</title>
<polygon fill="lightgreen" stroke="black" points="5050,-1037.17 4592,-1037.17 4592,-969.17 5050,-969.17 5050,-1037.17"/>
<text text-anchor="middle" x="4821" y="-1021.97" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="4821" y="-1006.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4821" y="-991.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4821" y="-976.97" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- stage1_layer3_residual1&#45;&gt;stage1_layer3_ln2 -->
<g id="edge253" class="edge">
<title>stage1_layer3_residual1&#45;&gt;stage1_layer3_ln2</title>
<path fill="none" stroke="black" d="M6042.5,-1133.24C6042.5,-1090.51 6042.5,-1003 6042.5,-1003 6042.5,-1003 5060.04,-1003 5060.04,-1003"/>
<polygon fill="black" stroke="black" points="5060.04,-999.5 5050.04,-1003 5060.04,-1006.5 5060.04,-999.5"/>
</g>
<!-- stage1_layer3_residual2 -->
<g id="node194" class="node">
<title>stage1_layer3_residual2</title>
<polygon fill="lightpink" stroke="black" points="6365,-298.17 5907,-215.17 6365,-132.17 6823,-215.17 6365,-298.17"/>
<text text-anchor="middle" x="6365" y="-241.47" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="6365" y="-226.47" font-family="Times,serif" font-size="14.00">Input1: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6365" y="-211.47" font-family="Times,serif" font-size="14.00">Input2: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6365" y="-196.47" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6365" y="-181.47" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- stage1_layer3_residual1&#45;&gt;stage1_layer3_residual2 -->
<g id="edge289" class="edge">
<title>stage1_layer3_residual1&#45;&gt;stage1_layer3_residual2</title>
<path fill="none" stroke="black" d="M6651,-1122.95C6651,-1122.95 6651,-256.36 6651,-256.36"/>
<polygon fill="black" stroke="black" points="6654.5,-256.36 6651,-246.36 6647.5,-256.36 6654.5,-256.36"/>
</g>
<!-- stage1_layer3_gate -->
<g id="node175" class="node">
<title>stage1_layer3_gate</title>
<polygon fill="lightblue" stroke="black" points="4510.58,-933.17 3768.36,-933.17 3577.42,-797.17 4319.64,-797.17 4510.58,-933.17"/>
<text text-anchor="middle" x="4044" y="-883.97" font-family="Times,serif" font-size="14.00">Gate Computation</text>
<text text-anchor="middle" x="4044" y="-868.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4044" y="-853.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, num_experts=16]</text>
<text text-anchor="middle" x="4044" y="-838.97" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- stage1_layer3_ln2&#45;&gt;stage1_layer3_gate -->
<g id="edge254" class="edge">
<title>stage1_layer3_ln2&#45;&gt;stage1_layer3_gate</title>
<path fill="none" stroke="black" d="M4669,-968.97C4669,-944.55 4669,-916 4669,-916 4669,-916 4496.54,-916 4496.54,-916"/>
<polygon fill="black" stroke="black" points="4496.54,-912.5 4486.54,-916 4496.54,-919.5 4496.54,-912.5"/>
</g>
<!-- stage1_layer3_expert_0_tp_0 -->
<g id="node176" class="node">
<title>stage1_layer3_expert_0_tp_0</title>
<polygon fill="lightsteelblue" stroke="black" points="480,-761.17 24,-761.17 24,-678.17 480,-678.17 480,-761.17"/>
<text text-anchor="middle" x="252" y="-745.97" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="252" y="-730.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="252" y="-715.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="252" y="-700.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="252" y="-685.97" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- stage1_layer3_gate&#45;&gt;stage1_layer3_expert_0_tp_0 -->
<g id="edge255" class="edge">
<title>stage1_layer3_gate&#45;&gt;stage1_layer3_expert_0_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3744.1,-916C2835.68,-916 176,-916 176,-916 176,-916 176,-771.3 176,-771.3"/>
<polygon fill="black" stroke="black" points="179.5,-771.3 176,-761.3 172.5,-771.3 179.5,-771.3"/>
</g>
<!-- stage1_layer3_expert_1_tp_0 -->
<g id="node177" class="node">
<title>stage1_layer3_expert_1_tp_0</title>
<polygon fill="lightsteelblue" stroke="black" points="954,-761.17 498,-761.17 498,-678.17 954,-678.17 954,-761.17"/>
<text text-anchor="middle" x="726" y="-745.97" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="726" y="-730.97" font-family="Times,serif" font-size="14.00">TP Rank 0</text>
<text text-anchor="middle" x="726" y="-715.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="726" y="-700.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="726" y="-685.97" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- stage1_layer3_gate&#45;&gt;stage1_layer3_expert_1_tp_0 -->
<g id="edge256" class="edge">
<title>stage1_layer3_gate&#45;&gt;stage1_layer3_expert_1_tp_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3720.11,-899C2871.76,-899 650,-899 650,-899 650,-899 650,-771.26 650,-771.26"/>
<polygon fill="black" stroke="black" points="653.5,-771.26 650,-761.26 646.5,-771.26 653.5,-771.26"/>
</g>
<!-- stage1_layer3_expert_2_tp_1 -->
<g id="node178" class="node">
<title>stage1_layer3_expert_2_tp_1</title>
<polygon fill="lightsteelblue" stroke="black" points="1428,-761.17 972,-761.17 972,-678.17 1428,-678.17 1428,-761.17"/>
<text text-anchor="middle" x="1200" y="-745.97" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1200" y="-730.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="1200" y="-715.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="1200" y="-700.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="1200" y="-685.97" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- stage1_layer3_gate&#45;&gt;stage1_layer3_expert_2_tp_1 -->
<g id="edge259" class="edge">
<title>stage1_layer3_gate&#45;&gt;stage1_layer3_expert_2_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3696.49,-882C2922.41,-882 1124,-882 1124,-882 1124,-882 1124,-771.47 1124,-771.47"/>
<polygon fill="black" stroke="black" points="1127.5,-771.47 1124,-761.47 1120.5,-771.47 1127.5,-771.47"/>
</g>
<!-- stage1_layer3_expert_3_tp_1 -->
<g id="node179" class="node">
<title>stage1_layer3_expert_3_tp_1</title>
<polygon fill="lightsteelblue" stroke="black" points="1902,-761.17 1446,-761.17 1446,-678.17 1902,-678.17 1902,-761.17"/>
<text text-anchor="middle" x="1674" y="-745.97" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1674" y="-730.97" font-family="Times,serif" font-size="14.00">TP Rank 1</text>
<text text-anchor="middle" x="1674" y="-715.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="1674" y="-700.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="1674" y="-685.97" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- stage1_layer3_gate&#45;&gt;stage1_layer3_expert_3_tp_1 -->
<g id="edge260" class="edge">
<title>stage1_layer3_gate&#45;&gt;stage1_layer3_expert_3_tp_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3672.51,-865C2988.24,-865 1598,-865 1598,-865 1598,-865 1598,-771.31 1598,-771.31"/>
<polygon fill="black" stroke="black" points="1601.5,-771.31 1598,-761.31 1594.5,-771.31 1601.5,-771.31"/>
</g>
<!-- stage1_layer3_expert_4_tp_2 -->
<g id="node180" class="node">
<title>stage1_layer3_expert_4_tp_2</title>
<polygon fill="lightsteelblue" stroke="black" points="2376,-761.17 1920,-761.17 1920,-678.17 2376,-678.17 2376,-761.17"/>
<text text-anchor="middle" x="2148" y="-745.97" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="2148" y="-730.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="2148" y="-715.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="2148" y="-700.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="2148" y="-685.97" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- stage1_layer3_gate&#45;&gt;stage1_layer3_expert_4_tp_2 -->
<g id="edge263" class="edge">
<title>stage1_layer3_gate&#45;&gt;stage1_layer3_expert_4_tp_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3648.79,-848C3073.17,-848 2072,-848 2072,-848 2072,-848 2072,-771.33 2072,-771.33"/>
<polygon fill="black" stroke="black" points="2075.5,-771.33 2072,-761.33 2068.5,-771.33 2075.5,-771.33"/>
</g>
<!-- stage1_layer3_expert_5_tp_2 -->
<g id="node181" class="node">
<title>stage1_layer3_expert_5_tp_2</title>
<polygon fill="lightsteelblue" stroke="black" points="2850,-761.17 2394,-761.17 2394,-678.17 2850,-678.17 2850,-761.17"/>
<text text-anchor="middle" x="2622" y="-745.97" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="2622" y="-730.97" font-family="Times,serif" font-size="14.00">TP Rank 2</text>
<text text-anchor="middle" x="2622" y="-715.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="2622" y="-700.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="2622" y="-685.97" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- stage1_layer3_gate&#45;&gt;stage1_layer3_expert_5_tp_2 -->
<g id="edge264" class="edge">
<title>stage1_layer3_gate&#45;&gt;stage1_layer3_expert_5_tp_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3624.79,-831C3210.19,-831 2637.25,-831 2637.25,-831 2637.25,-831 2637.25,-771.44 2637.25,-771.44"/>
<polygon fill="black" stroke="black" points="2640.75,-771.44 2637.25,-761.44 2633.75,-771.44 2640.75,-771.44"/>
</g>
<!-- stage1_layer3_expert_6_tp_3 -->
<g id="node182" class="node">
<title>stage1_layer3_expert_6_tp_3</title>
<polygon fill="lightsteelblue" stroke="black" points="3324,-761.17 2868,-761.17 2868,-678.17 3324,-678.17 3324,-761.17"/>
<text text-anchor="middle" x="3096" y="-745.97" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="3096" y="-730.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="3096" y="-715.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3096" y="-700.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="3096" y="-685.97" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- stage1_layer3_gate&#45;&gt;stage1_layer3_expert_6_tp_3 -->
<g id="edge267" class="edge">
<title>stage1_layer3_gate&#45;&gt;stage1_layer3_expert_6_tp_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3600.83,-814C3371,-814 3137.75,-814 3137.75,-814 3137.75,-814 3137.75,-771.32 3137.75,-771.32"/>
<polygon fill="black" stroke="black" points="3141.25,-771.32 3137.75,-761.32 3134.25,-771.32 3141.25,-771.32"/>
</g>
<!-- stage1_layer3_expert_7_tp_3 -->
<g id="node183" class="node">
<title>stage1_layer3_expert_7_tp_3</title>
<polygon fill="lightsteelblue" stroke="black" points="3798,-761.17 3342,-761.17 3342,-678.17 3798,-678.17 3798,-761.17"/>
<text text-anchor="middle" x="3570" y="-745.97" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="3570" y="-730.97" font-family="Times,serif" font-size="14.00">TP Rank 3</text>
<text text-anchor="middle" x="3570" y="-715.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="3570" y="-700.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="3570" y="-685.97" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- stage1_layer3_gate&#45;&gt;stage1_layer3_expert_7_tp_3 -->
<g id="edge268" class="edge">
<title>stage1_layer3_gate&#45;&gt;stage1_layer3_expert_7_tp_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3687.73,-797.1C3687.73,-797.1 3687.73,-771.55 3687.73,-771.55"/>
<polygon fill="black" stroke="black" points="3691.23,-771.55 3687.73,-761.55 3684.23,-771.55 3691.23,-771.55"/>
</g>
<!-- stage1_layer3_expert_8_tp_4 -->
<g id="node184" class="node">
<title>stage1_layer3_expert_8_tp_4</title>
<polygon fill="lightsteelblue" stroke="black" points="4272,-761.17 3816,-761.17 3816,-678.17 4272,-678.17 4272,-761.17"/>
<text text-anchor="middle" x="4044" y="-745.97" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="4044" y="-730.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="4044" y="-715.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4044" y="-700.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="4044" y="-685.97" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- stage1_layer3_gate&#45;&gt;stage1_layer3_expert_8_tp_4 -->
<g id="edge271" class="edge">
<title>stage1_layer3_gate&#45;&gt;stage1_layer3_expert_8_tp_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4044,-797.1C4044,-797.1 4044,-771.55 4044,-771.55"/>
<polygon fill="black" stroke="black" points="4047.5,-771.55 4044,-761.55 4040.5,-771.55 4047.5,-771.55"/>
</g>
<!-- stage1_layer3_expert_9_tp_4 -->
<g id="node185" class="node">
<title>stage1_layer3_expert_9_tp_4</title>
<polygon fill="lightsteelblue" stroke="black" points="4746,-761.17 4290,-761.17 4290,-678.17 4746,-678.17 4746,-761.17"/>
<text text-anchor="middle" x="4518" y="-745.97" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="4518" y="-730.97" font-family="Times,serif" font-size="14.00">TP Rank 4</text>
<text text-anchor="middle" x="4518" y="-715.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4518" y="-700.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="4518" y="-685.97" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- stage1_layer3_gate&#45;&gt;stage1_layer3_expert_9_tp_4 -->
<g id="edge272" class="edge">
<title>stage1_layer3_gate&#45;&gt;stage1_layer3_expert_9_tp_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4400.27,-854.23C4400.27,-854.23 4400.27,-771.19 4400.27,-771.19"/>
<polygon fill="black" stroke="black" points="4403.77,-771.19 4400.27,-761.19 4396.77,-771.19 4403.77,-771.19"/>
</g>
<!-- stage1_layer3_expert_10_tp_5 -->
<g id="node186" class="node">
<title>stage1_layer3_expert_10_tp_5</title>
<polygon fill="lightsteelblue" stroke="black" points="5220,-761.17 4764,-761.17 4764,-678.17 5220,-678.17 5220,-761.17"/>
<text text-anchor="middle" x="4992" y="-745.97" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="4992" y="-730.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="4992" y="-715.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="4992" y="-700.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="4992" y="-685.97" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- stage1_layer3_gate&#45;&gt;stage1_layer3_expert_10_tp_5 -->
<g id="edge275" class="edge">
<title>stage1_layer3_gate&#45;&gt;stage1_layer3_expert_10_tp_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4343.41,-814C4592.67,-814 4907,-814 4907,-814 4907,-814 4907,-771.32 4907,-771.32"/>
<polygon fill="black" stroke="black" points="4910.5,-771.32 4907,-761.32 4903.5,-771.32 4910.5,-771.32"/>
</g>
<!-- stage1_layer3_expert_11_tp_5 -->
<g id="node187" class="node">
<title>stage1_layer3_expert_11_tp_5</title>
<polygon fill="lightsteelblue" stroke="black" points="5694,-761.17 5238,-761.17 5238,-678.17 5694,-678.17 5694,-761.17"/>
<text text-anchor="middle" x="5466" y="-745.97" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="5466" y="-730.97" font-family="Times,serif" font-size="14.00">TP Rank 5</text>
<text text-anchor="middle" x="5466" y="-715.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5466" y="-700.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="5466" y="-685.97" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- stage1_layer3_gate&#45;&gt;stage1_layer3_expert_11_tp_5 -->
<g id="edge276" class="edge">
<title>stage1_layer3_gate&#45;&gt;stage1_layer3_expert_11_tp_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4367.41,-831C4763.3,-831 5381.75,-831 5381.75,-831 5381.75,-831 5381.75,-771.44 5381.75,-771.44"/>
<polygon fill="black" stroke="black" points="5385.25,-771.44 5381.75,-761.44 5378.25,-771.44 5385.25,-771.44"/>
</g>
<!-- stage1_layer3_expert_12_tp_6 -->
<g id="node188" class="node">
<title>stage1_layer3_expert_12_tp_6</title>
<polygon fill="lightsteelblue" stroke="black" points="6168,-761.17 5712,-761.17 5712,-678.17 6168,-678.17 6168,-761.17"/>
<text text-anchor="middle" x="5940" y="-745.97" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="5940" y="-730.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="5940" y="-715.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="5940" y="-700.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="5940" y="-685.97" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- stage1_layer3_gate&#45;&gt;stage1_layer3_expert_12_tp_6 -->
<g id="edge279" class="edge">
<title>stage1_layer3_gate&#45;&gt;stage1_layer3_expert_12_tp_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4391.15,-848C4906.68,-848 5814.5,-848 5814.5,-848 5814.5,-848 5814.5,-771.33 5814.5,-771.33"/>
<polygon fill="black" stroke="black" points="5818,-771.33 5814.5,-761.33 5811,-771.33 5818,-771.33"/>
</g>
<!-- stage1_layer3_expert_13_tp_6 -->
<g id="node189" class="node">
<title>stage1_layer3_expert_13_tp_6</title>
<polygon fill="lightsteelblue" stroke="black" points="6642,-761.17 6186,-761.17 6186,-678.17 6642,-678.17 6642,-761.17"/>
<text text-anchor="middle" x="6414" y="-745.97" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="6414" y="-730.97" font-family="Times,serif" font-size="14.00">TP Rank 6</text>
<text text-anchor="middle" x="6414" y="-715.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6414" y="-700.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="6414" y="-685.97" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- stage1_layer3_gate&#45;&gt;stage1_layer3_expert_13_tp_6 -->
<g id="edge280" class="edge">
<title>stage1_layer3_gate&#45;&gt;stage1_layer3_expert_13_tp_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4414.96,-865C5081.74,-865 6414,-865 6414,-865 6414,-865 6414,-771.31 6414,-771.31"/>
<polygon fill="black" stroke="black" points="6417.5,-771.31 6414,-761.31 6410.5,-771.31 6417.5,-771.31"/>
</g>
<!-- stage1_layer3_expert_14_tp_7 -->
<g id="node190" class="node">
<title>stage1_layer3_expert_14_tp_7</title>
<polygon fill="lightsteelblue" stroke="black" points="7116,-761.17 6660,-761.17 6660,-678.17 7116,-678.17 7116,-761.17"/>
<text text-anchor="middle" x="6888" y="-745.97" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="6888" y="-730.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="6888" y="-715.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="6888" y="-700.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="6888" y="-685.97" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- stage1_layer3_gate&#45;&gt;stage1_layer3_expert_14_tp_7 -->
<g id="edge283" class="edge">
<title>stage1_layer3_gate&#45;&gt;stage1_layer3_expert_14_tp_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4438.77,-882C5189,-882 6746.5,-882 6746.5,-882 6746.5,-882 6746.5,-771.47 6746.5,-771.47"/>
<polygon fill="black" stroke="black" points="6750,-771.47 6746.5,-761.47 6743,-771.47 6750,-771.47"/>
</g>
<!-- stage1_layer3_expert_15_tp_7 -->
<g id="node191" class="node">
<title>stage1_layer3_expert_15_tp_7</title>
<polygon fill="lightsteelblue" stroke="black" points="7590,-761.17 7134,-761.17 7134,-678.17 7590,-678.17 7590,-761.17"/>
<text text-anchor="middle" x="7362" y="-745.97" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="7362" y="-730.97" font-family="Times,serif" font-size="14.00">TP Rank 7</text>
<text text-anchor="middle" x="7362" y="-715.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=512]</text>
<text text-anchor="middle" x="7362" y="-700.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, expert_dim=2048]</text>
<text text-anchor="middle" x="7362" y="-685.97" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- stage1_layer3_gate&#45;&gt;stage1_layer3_expert_15_tp_7 -->
<g id="edge284" class="edge">
<title>stage1_layer3_gate&#45;&gt;stage1_layer3_expert_15_tp_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4462.85,-899C5339.26,-899 7286,-899 7286,-899 7286,-899 7286,-771.26 7286,-771.26"/>
<polygon fill="black" stroke="black" points="7289.5,-771.26 7286,-761.26 7282.5,-771.26 7289.5,-771.26"/>
</g>
<!-- stage1_layer3_expert_agg -->
<g id="node192" class="node">
<title>stage1_layer3_expert_agg</title>
<polygon fill="lightyellow" stroke="black" points="4518.67,-642.17 3763.58,-642.17 3569.33,-506.17 4324.42,-506.17 4518.67,-642.17"/>
<text text-anchor="middle" x="4044" y="-592.97" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4044" y="-577.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, expert_dim=16384]</text>
<text text-anchor="middle" x="4044" y="-562.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="4044" y="-547.97" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- stage1_layer3_expert_0_tp_0&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge257" class="edge">
<title>stage1_layer3_expert_0_tp_0&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M252,-677.96C252,-620.23 252,-523 252,-523 252,-523 3583.18,-523 3583.18,-523"/>
<polygon fill="black" stroke="black" points="3583.18,-526.5 3593.18,-523 3583.18,-519.5 3583.18,-526.5"/>
</g>
<!-- stage1_layer3_expert_1_tp_0&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge258" class="edge">
<title>stage1_layer3_expert_1_tp_0&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M726,-678C726,-624.92 726,-540 726,-540 726,-540 3607.45,-540 3607.45,-540"/>
<polygon fill="black" stroke="black" points="3607.45,-543.5 3617.45,-540 3607.45,-536.5 3607.45,-543.5"/>
</g>
<!-- stage1_layer3_expert_2_tp_1&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge261" class="edge">
<title>stage1_layer3_expert_2_tp_1&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M1200,-677.78C1200,-629.58 1200,-557 1200,-557 1200,-557 3631.8,-557 3631.8,-557"/>
<polygon fill="black" stroke="black" points="3631.8,-560.5 3641.8,-557 3631.8,-553.5 3631.8,-560.5"/>
</g>
<!-- stage1_layer3_expert_3_tp_1&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge262" class="edge">
<title>stage1_layer3_expert_3_tp_1&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M1674,-677.92C1674,-634.88 1674,-574 1674,-574 1674,-574 3656.17,-574 3656.17,-574"/>
<polygon fill="black" stroke="black" points="3656.17,-577.5 3666.17,-574 3656.17,-570.5 3656.17,-577.5"/>
</g>
<!-- stage1_layer3_expert_4_tp_2&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge265" class="edge">
<title>stage1_layer3_expert_4_tp_2&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M2148,-677.89C2148,-640.32 2148,-591 2148,-591 2148,-591 3680.43,-591 3680.43,-591"/>
<polygon fill="black" stroke="black" points="3680.43,-594.5 3690.43,-591 3680.43,-587.5 3680.43,-594.5"/>
</g>
<!-- stage1_layer3_expert_5_tp_2&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge266" class="edge">
<title>stage1_layer3_expert_5_tp_2&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M2622,-678.09C2622,-646.34 2622,-608 2622,-608 2622,-608 3704.64,-608 3704.64,-608"/>
<polygon fill="black" stroke="black" points="3704.64,-611.5 3714.64,-608 3704.64,-604.5 3704.64,-611.5"/>
</g>
<!-- stage1_layer3_expert_6_tp_3&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge269" class="edge">
<title>stage1_layer3_expert_6_tp_3&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M3096,-678.14C3096,-652.71 3096,-625 3096,-625 3096,-625 3728.83,-625 3728.83,-625"/>
<polygon fill="black" stroke="black" points="3728.83,-628.5 3738.83,-625 3728.83,-621.5 3728.83,-628.5"/>
</g>
<!-- stage1_layer3_expert_7_tp_3&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge270" class="edge">
<title>stage1_layer3_expert_7_tp_3&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M3683.58,-677.97C3683.58,-677.97 3683.58,-596.2 3683.58,-596.2"/>
<polygon fill="black" stroke="black" points="3687.08,-596.2 3683.58,-586.2 3680.08,-596.2 3687.08,-596.2"/>
</g>
<!-- stage1_layer3_expert_8_tp_4&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge273" class="edge">
<title>stage1_layer3_expert_8_tp_4&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M4044,-677.97C4044,-677.97 4044,-652.24 4044,-652.24"/>
<polygon fill="black" stroke="black" points="4047.5,-652.24 4044,-642.24 4040.5,-652.24 4047.5,-652.24"/>
</g>
<!-- stage1_layer3_expert_9_tp_4&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge274" class="edge">
<title>stage1_layer3_expert_9_tp_4&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M4404.42,-677.97C4404.42,-677.97 4404.42,-652.24 4404.42,-652.24"/>
<polygon fill="black" stroke="black" points="4407.92,-652.24 4404.42,-642.24 4400.92,-652.24 4407.92,-652.24"/>
</g>
<!-- stage1_layer3_expert_10_tp_5&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge277" class="edge">
<title>stage1_layer3_expert_10_tp_5&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M4934.08,-678.14C4934.08,-652.71 4934.08,-625 4934.08,-625 4934.08,-625 4504.26,-625 4504.26,-625"/>
<polygon fill="black" stroke="black" points="4504.26,-621.5 4494.26,-625 4504.26,-628.5 4504.26,-621.5"/>
</g>
<!-- stage1_layer3_expert_11_tp_5&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge278" class="edge">
<title>stage1_layer3_expert_11_tp_5&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M5466,-678.09C5466,-646.34 5466,-608 5466,-608 5466,-608 4480.17,-608 4480.17,-608"/>
<polygon fill="black" stroke="black" points="4480.17,-604.5 4470.17,-608 4480.17,-611.5 4480.17,-604.5"/>
</g>
<!-- stage1_layer3_expert_12_tp_6&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge281" class="edge">
<title>stage1_layer3_expert_12_tp_6&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M5882.92,-677.89C5882.92,-640.32 5882.92,-591 5882.92,-591 5882.92,-591 4455.85,-591 4455.85,-591"/>
<polygon fill="black" stroke="black" points="4455.85,-587.5 4445.85,-591 4455.85,-594.5 4455.85,-587.5"/>
</g>
<!-- stage1_layer3_expert_13_tp_6&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge282" class="edge">
<title>stage1_layer3_expert_13_tp_6&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M6414,-677.92C6414,-634.88 6414,-574 6414,-574 6414,-574 4431.5,-574 4431.5,-574"/>
<polygon fill="black" stroke="black" points="4431.5,-570.5 4421.5,-574 4431.5,-577.5 4431.5,-570.5"/>
</g>
<!-- stage1_layer3_expert_14_tp_7&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge285" class="edge">
<title>stage1_layer3_expert_14_tp_7&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M6741.5,-677.78C6741.5,-629.58 6741.5,-557 6741.5,-557 6741.5,-557 4407.34,-557 4407.34,-557"/>
<polygon fill="black" stroke="black" points="4407.34,-553.5 4397.34,-557 4407.34,-560.5 4407.34,-553.5"/>
</g>
<!-- stage1_layer3_expert_15_tp_7&#45;&gt;stage1_layer3_expert_agg -->
<g id="edge286" class="edge">
<title>stage1_layer3_expert_15_tp_7&#45;&gt;stage1_layer3_expert_agg</title>
<path fill="none" stroke="black" d="M7362,-678C7362,-624.92 7362,-540 7362,-540 7362,-540 4382.75,-540 4382.75,-540"/>
<polygon fill="black" stroke="black" points="4382.75,-536.5 4372.75,-540 4382.75,-543.5 4382.75,-536.5"/>
</g>
<!-- stage1_layer3_expert_allreduce -->
<g id="node193" class="node">
<title>stage1_layer3_expert_allreduce</title>
<polygon fill="lightyellow" stroke="black" points="6053.67,-470.17 5298.58,-470.17 5104.33,-334.17 5859.42,-334.17 6053.67,-470.17"/>
<text text-anchor="middle" x="5579" y="-420.97" font-family="Times,serif" font-size="14.00">MoE All&#45;Reduce</text>
<text text-anchor="middle" x="5579" y="-405.97" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5579" y="-390.97" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="5579" y="-375.97" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- stage1_layer3_expert_agg&#45;&gt;stage1_layer3_expert_allreduce -->
<g id="edge287" class="edge">
<title>stage1_layer3_expert_agg&#45;&gt;stage1_layer3_expert_allreduce</title>
<path fill="none" stroke="black" d="M4348.78,-523C4679.85,-523 5162.08,-523 5162.08,-523 5162.08,-523 5162.08,-412.25 5162.08,-412.25"/>
<polygon fill="black" stroke="black" points="5165.58,-412.25 5162.08,-402.25 5158.58,-412.25 5165.58,-412.25"/>
</g>
<!-- stage1_layer3_expert_allreduce&#45;&gt;stage1_layer3_residual2 -->
<g id="edge288" class="edge">
<title>stage1_layer3_expert_allreduce&#45;&gt;stage1_layer3_residual2</title>
<path fill="none" stroke="black" d="M5980.42,-402.03C5980.42,-402.03 5980.42,-238.52 5980.42,-238.52"/>
<polygon fill="black" stroke="black" points="5983.92,-238.52 5980.42,-228.52 5976.92,-238.52 5983.92,-238.52"/>
</g>
<!-- output -->
<g id="node195" class="node">
<title>output</title>
<ellipse fill="lightgreen" stroke="black" cx="6365" cy="-48.08" rx="323.71" ry="48.17"/>
<text text-anchor="middle" x="6365" y="-66.88" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="6365" y="-51.88" font-family="Times,serif" font-size="14.00">Input: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6365" y="-36.88" font-family="Times,serif" font-size="14.00">Output: [batch_size=1024, seq_len=2048, hidden_dim=4096]</text>
<text text-anchor="middle" x="6365" y="-21.88" font-family="Times,serif" font-size="14.00">GPUs: stage1</text>
</g>
<!-- stage1_layer3_residual2&#45;&gt;output -->
<g id="edge290" class="edge">
<title>stage1_layer3_residual2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M6365,-132.11C6365,-132.11 6365,-106.28 6365,-106.28"/>
<polygon fill="black" stroke="black" points="6368.5,-106.28 6365,-96.28 6361.5,-106.28 6368.5,-106.28"/>
</g>
</g>
</svg>
