<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: optimized_complete_moe Pages: 1 -->
<svg width="2685pt" height="4608pt"
 viewBox="0.00 0.00 2685.00 4608.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 4604)">
<title>optimized_complete_moe</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-4604 2681,-4604 2681,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_layer_0</title>
<polygon fill="none" stroke="red" stroke-dasharray="5,2" points="35,-3468 35,-4554 2541,-4554 2541,-3468 35,-3468"/>
<text text-anchor="middle" x="1288" y="-4538.8" font-family="Times,serif" font-size="14.00">Layer 0 (GPUs 0&#45;7)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_l0_attention</title>
<path fill="none" stroke="lightblue" d="M1809,-3908C1809,-3908 2191,-3908 2191,-3908 2197,-3908 2203,-3914 2203,-3920 2203,-3920 2203,-4511 2203,-4511 2203,-4517 2197,-4523 2191,-4523 2191,-4523 1809,-4523 1809,-4523 1803,-4523 1797,-4517 1797,-4511 1797,-4511 1797,-3920 1797,-3920 1797,-3914 1803,-3908 1809,-3908"/>
<text text-anchor="middle" x="2000" y="-4507.8" font-family="Times,serif" font-size="14.00">Attention Block</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_l0_moe</title>
<path fill="none" stroke="lightcoral" d="M55,-3476C55,-3476 2491,-3476 2491,-3476 2497,-3476 2503,-3482 2503,-3488 2503,-3488 2503,-3863 2503,-3863 2503,-3869 2497,-3875 2491,-3875 2491,-3875 55,-3875 55,-3875 49,-3875 43,-3869 43,-3863 43,-3863 43,-3488 43,-3488 43,-3482 49,-3476 55,-3476"/>
<text text-anchor="middle" x="1273" y="-3859.8" font-family="Times,serif" font-size="14.00">MoE Block</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_layer_1</title>
<polygon fill="none" stroke="red" stroke-dasharray="5,2" points="35,-2374 35,-3460 2541,-3460 2541,-2374 35,-2374"/>
<text text-anchor="middle" x="1288" y="-3444.8" font-family="Times,serif" font-size="14.00">Layer 1 (GPUs 0&#45;7)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_l1_attention</title>
<path fill="none" stroke="lightblue" d="M1759,-2814C1759,-2814 2141,-2814 2141,-2814 2147,-2814 2153,-2820 2153,-2826 2153,-2826 2153,-3417 2153,-3417 2153,-3423 2147,-3429 2141,-3429 2141,-3429 1759,-3429 1759,-3429 1753,-3429 1747,-3423 1747,-3417 1747,-3417 1747,-2826 1747,-2826 1747,-2820 1753,-2814 1759,-2814"/>
<text text-anchor="middle" x="1950" y="-3413.8" font-family="Times,serif" font-size="14.00">Attention Block</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_l1_moe</title>
<path fill="none" stroke="lightcoral" d="M55,-2382C55,-2382 2491,-2382 2491,-2382 2497,-2382 2503,-2388 2503,-2394 2503,-2394 2503,-2769 2503,-2769 2503,-2775 2497,-2781 2491,-2781 2491,-2781 55,-2781 55,-2781 49,-2781 43,-2775 43,-2769 43,-2769 43,-2394 43,-2394 43,-2388 49,-2382 55,-2382"/>
<text text-anchor="middle" x="1273" y="-2765.8" font-family="Times,serif" font-size="14.00">MoE Block</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_layer_2</title>
<polygon fill="none" stroke="blue" stroke-dasharray="5,2" points="108,-1186 108,-2272 2669,-2272 2669,-1186 108,-1186"/>
<text text-anchor="middle" x="1388.5" y="-2256.8" font-family="Times,serif" font-size="14.00">Layer 2 (GPUs 8&#45;15)</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_l2_attention</title>
<path fill="none" stroke="lightblue" d="M1675,-1626C1675,-1626 2065,-1626 2065,-1626 2071,-1626 2077,-1632 2077,-1638 2077,-1638 2077,-2229 2077,-2229 2077,-2235 2071,-2241 2065,-2241 2065,-2241 1675,-2241 1675,-2241 1669,-2241 1663,-2235 1663,-2229 1663,-2229 1663,-1638 1663,-1638 1663,-1632 1669,-1626 1675,-1626"/>
<text text-anchor="middle" x="1870" y="-2225.8" font-family="Times,serif" font-size="14.00">Attention Block</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_l2_moe</title>
<path fill="none" stroke="lightcoral" d="M128,-1194C128,-1194 2619,-1194 2619,-1194 2625,-1194 2631,-1200 2631,-1206 2631,-1206 2631,-1581 2631,-1581 2631,-1587 2625,-1593 2619,-1593 2619,-1593 128,-1593 128,-1593 122,-1593 116,-1587 116,-1581 116,-1581 116,-1206 116,-1206 116,-1200 122,-1194 128,-1194"/>
<text text-anchor="middle" x="1373.5" y="-1577.8" font-family="Times,serif" font-size="14.00">MoE Block</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_layer_3</title>
<polygon fill="none" stroke="blue" stroke-dasharray="5,2" points="8,-92 8,-1178 2569,-1178 2569,-92 8,-92"/>
<text text-anchor="middle" x="1288.5" y="-1162.8" font-family="Times,serif" font-size="14.00">Layer 3 (GPUs 8&#45;15)</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_l3_attention</title>
<path fill="none" stroke="lightblue" d="M1752,-532C1752,-532 2142,-532 2142,-532 2148,-532 2154,-538 2154,-544 2154,-544 2154,-1135 2154,-1135 2154,-1141 2148,-1147 2142,-1147 2142,-1147 1752,-1147 1752,-1147 1746,-1147 1740,-1141 1740,-1135 1740,-1135 1740,-544 1740,-544 1740,-538 1746,-532 1752,-532"/>
<text text-anchor="middle" x="1947" y="-1131.8" font-family="Times,serif" font-size="14.00">Attention Block</text>
</g>
<g id="clust12" class="cluster">
<title>cluster_l3_moe</title>
<path fill="none" stroke="lightcoral" d="M28,-100C28,-100 2519,-100 2519,-100 2525,-100 2531,-106 2531,-112 2531,-112 2531,-487 2531,-487 2531,-493 2525,-499 2519,-499 2519,-499 28,-499 28,-499 22,-499 16,-493 16,-487 16,-487 16,-112 16,-112 16,-106 22,-100 28,-100"/>
<text text-anchor="middle" x="1273.5" y="-483.8" font-family="Times,serif" font-size="14.00">MoE Block</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightgreen" stroke="black" cx="2136" cy="-4582" rx="127.28" ry="18"/>
<text text-anchor="middle" x="2136" y="-4578.3" font-family="Times,serif" font-size="14.00">Input\n[1024,2048,4096]</text>
</g>
<!-- l0_token_split -->
<g id="node3" class="node">
<title>l0_token_split</title>
<polygon fill="lightcyan" stroke="black" points="2186.72,-4492 1924.69,-4492 1857.28,-4456 2119.31,-4456 2186.72,-4492"/>
<text text-anchor="middle" x="2022" y="-4470.3" font-family="Times,serif" font-size="14.00">Token Split\nGPU: 0&#45;7</text>
</g>
<!-- input&#45;&gt;l0_token_split -->
<g id="edge1" class="edge">
<title>input&#45;&gt;l0_token_split</title>
<path fill="none" stroke="black" d="M2117.68,-4563.97C2098.85,-4546.46 2069.34,-4519.02 2048.08,-4499.25"/>
<polygon fill="black" stroke="black" points="2050.36,-4496.59 2040.65,-4492.34 2045.59,-4501.71 2050.36,-4496.59"/>
</g>
<!-- l0_attn_res -->
<g id="node8" class="node">
<title>l0_attn_res</title>
<polygon fill="orange" stroke="black" points="2164.5,-3952 1913.5,-3952 1913.5,-3916 2164.5,-3916 2164.5,-3952"/>
<text text-anchor="middle" x="2039" y="-3930.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]</text>
</g>
<!-- input&#45;&gt;l0_attn_res -->
<g id="edge7" class="edge">
<title>input&#45;&gt;l0_attn_res</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M2190.6,-4565.71C2195.98,-4562.51 2200.94,-4558.65 2205,-4554 2261.17,-4489.56 2250,-4452.48 2250,-4367 2250,-4367 2250,-4367 2250,-4149 2250,-4090.25 2245.18,-4068.65 2207,-4024 2179.84,-3992.24 2138.46,-3970.13 2103.56,-3955.89"/>
<polygon fill="red" stroke="red" points="2104.5,-3952.49 2093.91,-3952.08 2101.93,-3959.01 2104.5,-3952.49"/>
</g>
<!-- output -->
<g id="node2" class="node">
<title>output</title>
<ellipse fill="lightgreen" stroke="black" cx="1910" cy="-18" rx="135.38" ry="18"/>
<text text-anchor="middle" x="1910" y="-14.3" font-family="Times,serif" font-size="14.00">Output\n[1024,2048,4096]</text>
</g>
<!-- l0_qkv -->
<g id="node4" class="node">
<title>l0_qkv</title>
<polygon fill="yellow" stroke="black" points="2188,-4384 1826,-4384 1826,-4348 2188,-4348 2188,-4384"/>
<text text-anchor="middle" x="2007" y="-4362.3" font-family="Times,serif" font-size="14.00">QKV Projections\n8×[128,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l0_token_split&#45;&gt;l0_qkv -->
<g id="edge2" class="edge">
<title>l0_token_split&#45;&gt;l0_qkv</title>
<path fill="none" stroke="black" d="M2019.59,-4455.97C2017.24,-4439.38 2013.63,-4413.88 2010.88,-4394.43"/>
<polygon fill="black" stroke="black" points="2014.32,-4393.75 2009.45,-4384.34 2007.39,-4394.73 2014.32,-4393.75"/>
</g>
<!-- l0_attention -->
<g id="node5" class="node">
<title>l0_attention</title>
<polygon fill="yellow" stroke="black" points="2194.5,-4276 1805.5,-4276 1805.5,-4240 2194.5,-4240 2194.5,-4276"/>
<text text-anchor="middle" x="2000" y="-4254.3" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention\n8×[128,2048,512]\nGPU: 0&#45;7</text>
</g>
<!-- l0_qkv&#45;&gt;l0_attention -->
<g id="edge3" class="edge">
<title>l0_qkv&#45;&gt;l0_attention</title>
<path fill="none" stroke="black" d="M2005.88,-4347.97C2004.78,-4331.38 2003.1,-4305.88 2001.81,-4286.43"/>
<polygon fill="black" stroke="black" points="2005.3,-4286.09 2001.15,-4276.34 1998.31,-4286.55 2005.3,-4286.09"/>
</g>
<!-- l0_out_proj -->
<g id="node6" class="node">
<title>l0_out_proj</title>
<polygon fill="yellow" stroke="black" points="2193.5,-4168 1812.5,-4168 1812.5,-4132 2193.5,-4132 2193.5,-4168"/>
<text text-anchor="middle" x="2003" y="-4146.3" font-family="Times,serif" font-size="14.00">Output Projections\n8×[128,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l0_attention&#45;&gt;l0_out_proj -->
<g id="edge4" class="edge">
<title>l0_attention&#45;&gt;l0_out_proj</title>
<path fill="none" stroke="black" d="M2000.48,-4239.97C2000.95,-4223.38 2001.67,-4197.88 2002.22,-4178.43"/>
<polygon fill="black" stroke="black" points="2005.72,-4178.44 2002.51,-4168.34 1998.73,-4178.24 2005.72,-4178.44"/>
</g>
<!-- l0_gather -->
<g id="node7" class="node">
<title>l0_gather</title>
<polygon fill="lightcyan" stroke="black" points="2189.21,-4060 1902.54,-4060 1828.79,-4024 2115.46,-4024 2189.21,-4060"/>
<text text-anchor="middle" x="2009" y="-4038.3" font-family="Times,serif" font-size="14.00">Token Gather\nGPU: 0&#45;7</text>
</g>
<!-- l0_out_proj&#45;&gt;l0_gather -->
<g id="edge5" class="edge">
<title>l0_out_proj&#45;&gt;l0_gather</title>
<path fill="none" stroke="black" d="M2003.96,-4131.97C2004.9,-4115.38 2006.35,-4089.88 2007.45,-4070.43"/>
<polygon fill="black" stroke="black" points="2010.95,-4070.52 2008.02,-4060.34 2003.96,-4070.13 2010.95,-4070.52"/>
</g>
<!-- l0_gather&#45;&gt;l0_attn_res -->
<g id="edge6" class="edge">
<title>l0_gather&#45;&gt;l0_attn_res</title>
<path fill="none" stroke="black" d="M2013.82,-4023.97C2018.54,-4007.3 2025.8,-3981.65 2031.31,-3962.16"/>
<polygon fill="black" stroke="black" points="2034.74,-3962.92 2034.09,-3952.34 2028,-3961.01 2034.74,-3962.92"/>
</g>
<!-- l0_gate -->
<g id="node9" class="node">
<title>l0_gate</title>
<polygon fill="lightcoral" stroke="black" points="2197,-3844 1881,-3844 1881,-3808 2197,-3808 2197,-3844"/>
<text text-anchor="middle" x="2039" y="-3822.3" font-family="Times,serif" font-size="14.00">Gate Network\n[1024,2048,16]\nGPU: 0&#45;7</text>
</g>
<!-- l0_attn_res&#45;&gt;l0_gate -->
<g id="edge8" class="edge">
<title>l0_attn_res&#45;&gt;l0_gate</title>
<path fill="none" stroke="black" d="M2039,-3915.97C2039,-3899.38 2039,-3873.88 2039,-3854.43"/>
<polygon fill="black" stroke="black" points="2042.5,-3854.34 2039,-3844.34 2035.5,-3854.34 2042.5,-3854.34"/>
</g>
<!-- l0_expert_route -->
<g id="node10" class="node">
<title>l0_expert_route</title>
<polygon fill="lightcyan" stroke="black" points="1548.14,-3844 1357.02,-3844 1307.86,-3808 1498.98,-3808 1548.14,-3844"/>
<text text-anchor="middle" x="1428" y="-3822.3" font-family="Times,serif" font-size="14.00">Expert Routing</text>
</g>
<!-- l0_attn_res&#45;&gt;l0_expert_route -->
<g id="edge9" class="edge">
<title>l0_attn_res&#45;&gt;l0_expert_route</title>
<path fill="none" stroke="black" d="M1940.83,-3915.97C1830.24,-3896.78 1651,-3865.69 1536.38,-3845.8"/>
<polygon fill="black" stroke="black" points="1536.63,-3842.29 1526.18,-3844.03 1535.43,-3849.19 1536.63,-3842.29"/>
</g>
<!-- l0_moe_res -->
<g id="node20" class="node">
<title>l0_moe_res</title>
<polygon fill="orange" stroke="black" points="2343.5,-3520 2092.5,-3520 2092.5,-3484 2343.5,-3484 2343.5,-3520"/>
<text text-anchor="middle" x="2218" y="-3498.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]</text>
</g>
<!-- l0_attn_res&#45;&gt;l0_moe_res -->
<g id="edge27" class="edge">
<title>l0_attn_res&#45;&gt;l0_moe_res</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M2164.74,-3920.07C2278.12,-3900.91 2438.19,-3853.44 2513,-3736 2577.94,-3634.05 2394.49,-3557.66 2288.08,-3523.21"/>
<polygon fill="red" stroke="red" points="2288.94,-3519.81 2278.35,-3520.1 2286.81,-3526.47 2288.94,-3519.81"/>
</g>
<!-- l0_exp0 -->
<g id="node11" class="node">
<title>l0_exp0</title>
<polygon fill="lightpink" stroke="black" points="325,-3736 51,-3736 51,-3700 325,-3700 325,-3736"/>
<text text-anchor="middle" x="188" y="-3714.3" font-family="Times,serif" font-size="14.00">Expert 0\n[128,2048,4096]\nGPU: 0</text>
</g>
<!-- l0_expert_route&#45;&gt;l0_exp0 -->
<g id="edge10" class="edge">
<title>l0_expert_route&#45;&gt;l0_exp0</title>
<path fill="none" stroke="black" d="M1320.11,-3817.13C1124.98,-3802.69 700.46,-3770.26 343,-3736 340.47,-3735.76 337.91,-3735.51 335.33,-3735.26"/>
<polygon fill="black" stroke="black" points="335.62,-3731.77 325.32,-3734.26 334.92,-3738.73 335.62,-3731.77"/>
</g>
<!-- l0_exp1 -->
<g id="node12" class="node">
<title>l0_exp1</title>
<polygon fill="lightpink" stroke="black" points="635,-3736 361,-3736 361,-3700 635,-3700 635,-3736"/>
<text text-anchor="middle" x="498" y="-3714.3" font-family="Times,serif" font-size="14.00">Expert 1\n[128,2048,4096]\nGPU: 1</text>
</g>
<!-- l0_expert_route&#45;&gt;l0_exp1 -->
<g id="edge12" class="edge">
<title>l0_expert_route&#45;&gt;l0_exp1</title>
<path fill="none" stroke="black" d="M1313.03,-3811.9C1144.58,-3792.7 830.66,-3756.92 645.44,-3735.81"/>
<polygon fill="black" stroke="black" points="645.68,-3732.31 635.35,-3734.66 644.89,-3739.27 645.68,-3732.31"/>
</g>
<!-- l0_exp2 -->
<g id="node13" class="node">
<title>l0_exp2</title>
<polygon fill="lightpink" stroke="black" points="945,-3736 671,-3736 671,-3700 945,-3700 945,-3736"/>
<text text-anchor="middle" x="808" y="-3714.3" font-family="Times,serif" font-size="14.00">Expert 2\n[128,2048,4096]\nGPU: 2</text>
</g>
<!-- l0_expert_route&#45;&gt;l0_exp2 -->
<g id="edge14" class="edge">
<title>l0_expert_route&#45;&gt;l0_exp2</title>
<path fill="none" stroke="black" d="M1328.39,-3807.97C1216.05,-3788.76 1033.92,-3757.62 917.62,-3737.74"/>
<polygon fill="black" stroke="black" points="918.07,-3734.27 907.62,-3736.03 916.89,-3741.17 918.07,-3734.27"/>
</g>
<!-- l0_exp3 -->
<g id="node14" class="node">
<title>l0_exp3</title>
<polygon fill="lightpink" stroke="black" points="1255,-3736 981,-3736 981,-3700 1255,-3700 1255,-3736"/>
<text text-anchor="middle" x="1118" y="-3714.3" font-family="Times,serif" font-size="14.00">Expert 3\n[128,2048,4096]\nGPU: 3</text>
</g>
<!-- l0_expert_route&#45;&gt;l0_exp3 -->
<g id="edge16" class="edge">
<title>l0_expert_route&#45;&gt;l0_exp3</title>
<path fill="none" stroke="black" d="M1378.19,-3807.97C1323.59,-3789.3 1236,-3759.35 1177.74,-3739.43"/>
<polygon fill="black" stroke="black" points="1178.53,-3736 1167.94,-3736.08 1176.27,-3742.62 1178.53,-3736"/>
</g>
<!-- l0_exp4 -->
<g id="node15" class="node">
<title>l0_exp4</title>
<polygon fill="lightpink" stroke="black" points="1565,-3736 1291,-3736 1291,-3700 1565,-3700 1565,-3736"/>
<text text-anchor="middle" x="1428" y="-3714.3" font-family="Times,serif" font-size="14.00">Expert 4\n[128,2048,4096]\nGPU: 4</text>
</g>
<!-- l0_expert_route&#45;&gt;l0_exp4 -->
<g id="edge18" class="edge">
<title>l0_expert_route&#45;&gt;l0_exp4</title>
<path fill="none" stroke="black" d="M1428,-3807.97C1428,-3791.38 1428,-3765.88 1428,-3746.43"/>
<polygon fill="black" stroke="black" points="1431.5,-3746.34 1428,-3736.34 1424.5,-3746.34 1431.5,-3746.34"/>
</g>
<!-- l0_exp5 -->
<g id="node16" class="node">
<title>l0_exp5</title>
<polygon fill="lightpink" stroke="black" points="1875,-3736 1601,-3736 1601,-3700 1875,-3700 1875,-3736"/>
<text text-anchor="middle" x="1738" y="-3714.3" font-family="Times,serif" font-size="14.00">Expert 5\n[128,2048,4096]\nGPU: 5</text>
</g>
<!-- l0_expert_route&#45;&gt;l0_exp5 -->
<g id="edge20" class="edge">
<title>l0_expert_route&#45;&gt;l0_exp5</title>
<path fill="none" stroke="black" d="M1477.81,-3807.97C1532.41,-3789.3 1620,-3759.35 1678.26,-3739.43"/>
<polygon fill="black" stroke="black" points="1679.73,-3742.62 1688.06,-3736.08 1677.47,-3736 1679.73,-3742.62"/>
</g>
<!-- l0_exp6 -->
<g id="node17" class="node">
<title>l0_exp6</title>
<polygon fill="lightpink" stroke="black" points="2185,-3736 1911,-3736 1911,-3700 2185,-3700 2185,-3736"/>
<text text-anchor="middle" x="2048" y="-3714.3" font-family="Times,serif" font-size="14.00">Expert 6\n[128,2048,4096]\nGPU: 6</text>
</g>
<!-- l0_expert_route&#45;&gt;l0_exp6 -->
<g id="edge22" class="edge">
<title>l0_expert_route&#45;&gt;l0_exp6</title>
<path fill="none" stroke="black" d="M1504.65,-3811.9C1613.63,-3793.26 1813.95,-3759.01 1938.55,-3737.71"/>
<polygon fill="black" stroke="black" points="1939.24,-3741.15 1948.5,-3736.01 1938.06,-3734.25 1939.24,-3741.15"/>
</g>
<!-- l0_exp7 -->
<g id="node18" class="node">
<title>l0_exp7</title>
<polygon fill="lightpink" stroke="black" points="2495,-3736 2221,-3736 2221,-3700 2495,-3700 2495,-3736"/>
<text text-anchor="middle" x="2358" y="-3714.3" font-family="Times,serif" font-size="14.00">Expert 7\n[128,2048,4096]\nGPU: 7</text>
</g>
<!-- l0_expert_route&#45;&gt;l0_exp7 -->
<g id="edge24" class="edge">
<title>l0_expert_route&#45;&gt;l0_exp7</title>
<path fill="none" stroke="black" d="M1509.72,-3815.69C1666.66,-3797.8 2012.25,-3758.41 2210.49,-3735.81"/>
<polygon fill="black" stroke="black" points="2211.16,-3739.26 2220.7,-3734.65 2210.37,-3732.3 2211.16,-3739.26"/>
</g>
<!-- l0_expert_agg -->
<g id="node19" class="node">
<title>l0_expert_agg</title>
<polygon fill="lightcyan" stroke="black" points="1578.63,-3628 1339.01,-3628 1277.37,-3592 1516.99,-3592 1578.63,-3628"/>
<text text-anchor="middle" x="1428" y="-3606.3" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
</g>
<!-- l0_exp0&#45;&gt;l0_expert_agg -->
<g id="edge11" class="edge">
<title>l0_exp0&#45;&gt;l0_expert_agg</title>
<path fill="none" stroke="black" d="M325.32,-3701.74C331.29,-3701.14 337.21,-3700.56 343,-3700 695.97,-3666.17 1114.32,-3634.13 1312.65,-3619.42"/>
<polygon fill="black" stroke="black" points="1313.08,-3622.9 1322.79,-3618.67 1312.56,-3615.92 1313.08,-3622.9"/>
</g>
<!-- l0_exp1&#45;&gt;l0_expert_agg -->
<g id="edge13" class="edge">
<title>l0_exp1&#45;&gt;l0_expert_agg</title>
<path fill="none" stroke="black" d="M635.22,-3701.36C821.12,-3680.17 1149.22,-3642.77 1319.16,-3623.41"/>
<polygon fill="black" stroke="black" points="1319.58,-3626.88 1329.12,-3622.27 1318.79,-3619.92 1319.58,-3626.88"/>
</g>
<!-- l0_exp2&#45;&gt;l0_expert_agg -->
<g id="edge15" class="edge">
<title>l0_exp2&#45;&gt;l0_expert_agg</title>
<path fill="none" stroke="black" d="M907.61,-3699.97C1022.53,-3680.32 1210.48,-3648.19 1326.28,-3628.39"/>
<polygon fill="black" stroke="black" points="1326.95,-3631.83 1336.22,-3626.69 1325.77,-3624.93 1326.95,-3631.83"/>
</g>
<!-- l0_exp3&#45;&gt;l0_expert_agg -->
<g id="edge17" class="edge">
<title>l0_exp3&#45;&gt;l0_expert_agg</title>
<path fill="none" stroke="black" d="M1167.81,-3699.97C1222.41,-3681.3 1310,-3651.35 1368.26,-3631.43"/>
<polygon fill="black" stroke="black" points="1369.73,-3634.62 1378.06,-3628.08 1367.47,-3628 1369.73,-3634.62"/>
</g>
<!-- l0_exp4&#45;&gt;l0_expert_agg -->
<g id="edge19" class="edge">
<title>l0_exp4&#45;&gt;l0_expert_agg</title>
<path fill="none" stroke="black" d="M1428,-3699.97C1428,-3683.38 1428,-3657.88 1428,-3638.43"/>
<polygon fill="black" stroke="black" points="1431.5,-3638.34 1428,-3628.34 1424.5,-3638.34 1431.5,-3638.34"/>
</g>
<!-- l0_exp5&#45;&gt;l0_expert_agg -->
<g id="edge21" class="edge">
<title>l0_exp5&#45;&gt;l0_expert_agg</title>
<path fill="none" stroke="black" d="M1688.19,-3699.97C1633.59,-3681.3 1546,-3651.35 1487.74,-3631.43"/>
<polygon fill="black" stroke="black" points="1488.53,-3628 1477.94,-3628.08 1486.27,-3634.62 1488.53,-3628"/>
</g>
<!-- l0_exp6&#45;&gt;l0_expert_agg -->
<g id="edge23" class="edge">
<title>l0_exp6&#45;&gt;l0_expert_agg</title>
<path fill="none" stroke="black" d="M1948.39,-3699.97C1836.05,-3680.76 1653.92,-3649.62 1537.62,-3629.74"/>
<polygon fill="black" stroke="black" points="1538.07,-3626.27 1527.62,-3628.03 1536.89,-3633.17 1538.07,-3626.27"/>
</g>
<!-- l0_exp7&#45;&gt;l0_expert_agg -->
<g id="edge25" class="edge">
<title>l0_exp7&#45;&gt;l0_expert_agg</title>
<path fill="none" stroke="black" d="M2220.78,-3701.36C2051.93,-3682.11 1765.76,-3649.5 1587.35,-3629.16"/>
<polygon fill="black" stroke="black" points="1587.68,-3625.68 1577.35,-3628.02 1586.89,-3632.63 1587.68,-3625.68"/>
</g>
<!-- l0_expert_agg&#45;&gt;l0_moe_res -->
<g id="edge26" class="edge">
<title>l0_expert_agg&#45;&gt;l0_moe_res</title>
<path fill="none" stroke="black" d="M1524.08,-3596.11C1663.6,-3577.39 1922.95,-3542.59 2082.03,-3521.24"/>
<polygon fill="black" stroke="black" points="2082.92,-3524.66 2092.36,-3519.86 2081.99,-3517.72 2082.92,-3524.66"/>
</g>
<!-- l1_token_split -->
<g id="node21" class="node">
<title>l1_token_split</title>
<polygon fill="lightcyan" stroke="black" points="2136.72,-3398 1874.69,-3398 1807.28,-3362 2069.31,-3362 2136.72,-3398"/>
<text text-anchor="middle" x="1972" y="-3376.3" font-family="Times,serif" font-size="14.00">Token Split\nGPU: 0&#45;7</text>
</g>
<!-- l0_moe_res&#45;&gt;l1_token_split -->
<g id="edge28" class="edge">
<title>l0_moe_res&#45;&gt;l1_token_split</title>
<path fill="none" stroke="black" d="M2183.02,-3483.93C2139.12,-3462.52 2063.81,-3425.78 2016.03,-3402.48"/>
<polygon fill="black" stroke="black" points="2017.39,-3399.25 2006.86,-3398.01 2014.32,-3405.54 2017.39,-3399.25"/>
</g>
<!-- l1_attn_res -->
<g id="node26" class="node">
<title>l1_attn_res</title>
<polygon fill="orange" stroke="black" points="2144.5,-2858 1893.5,-2858 1893.5,-2822 2144.5,-2822 2144.5,-2858"/>
<text text-anchor="middle" x="2019" y="-2836.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]</text>
</g>
<!-- l0_moe_res&#45;&gt;l1_attn_res -->
<g id="edge29" class="edge">
<title>l0_moe_res&#45;&gt;l1_attn_res</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M2208.45,-3483.84C2200,-3445.85 2200,-3351.77 2200,-3273 2200,-3273 2200,-3273 2200,-3055 2200,-2993.18 2180.04,-2976.23 2139,-2930 2113.86,-2901.68 2077.65,-2878.79 2051.15,-2863.31"/>
<polygon fill="red" stroke="red" points="2052.62,-2860.12 2042.21,-2858.15 2049.12,-2866.18 2052.62,-2860.12"/>
</g>
<!-- l0_moe_res&#45;&gt;l1_attn_res -->
<g id="edge35" class="edge">
<title>l0_moe_res&#45;&gt;l1_attn_res</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M2227.55,-3483.84C2236,-3445.85 2236,-3351.77 2236,-3273 2236,-3273 2236,-3273 2236,-3055 2236,-2993.18 2216.04,-2976.23 2175,-2930 2149.42,-2901.18 2112.38,-2877.99 2080.47,-2862.51"/>
<polygon fill="red" stroke="red" points="2081.72,-2859.23 2071.18,-2858.15 2078.75,-2865.57 2081.72,-2859.23"/>
</g>
<!-- l1_qkv -->
<g id="node22" class="node">
<title>l1_qkv</title>
<polygon fill="yellow" stroke="black" points="2138,-3290 1776,-3290 1776,-3254 2138,-3254 2138,-3290"/>
<text text-anchor="middle" x="1957" y="-3268.3" font-family="Times,serif" font-size="14.00">QKV Projections\n8×[128,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l1_token_split&#45;&gt;l1_qkv -->
<g id="edge30" class="edge">
<title>l1_token_split&#45;&gt;l1_qkv</title>
<path fill="none" stroke="black" d="M1969.59,-3361.97C1967.24,-3345.38 1963.63,-3319.88 1960.88,-3300.43"/>
<polygon fill="black" stroke="black" points="1964.32,-3299.75 1959.45,-3290.34 1957.39,-3300.73 1964.32,-3299.75"/>
</g>
<!-- l1_attention -->
<g id="node23" class="node">
<title>l1_attention</title>
<polygon fill="yellow" stroke="black" points="2144.5,-3182 1755.5,-3182 1755.5,-3146 2144.5,-3146 2144.5,-3182"/>
<text text-anchor="middle" x="1950" y="-3160.3" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention\n8×[128,2048,512]\nGPU: 0&#45;7</text>
</g>
<!-- l1_qkv&#45;&gt;l1_attention -->
<g id="edge31" class="edge">
<title>l1_qkv&#45;&gt;l1_attention</title>
<path fill="none" stroke="black" d="M1955.88,-3253.97C1954.78,-3237.38 1953.1,-3211.88 1951.81,-3192.43"/>
<polygon fill="black" stroke="black" points="1955.3,-3192.09 1951.15,-3182.34 1948.31,-3192.55 1955.3,-3192.09"/>
</g>
<!-- l1_out_proj -->
<g id="node24" class="node">
<title>l1_out_proj</title>
<polygon fill="yellow" stroke="black" points="2142.5,-3074 1761.5,-3074 1761.5,-3038 2142.5,-3038 2142.5,-3074"/>
<text text-anchor="middle" x="1952" y="-3052.3" font-family="Times,serif" font-size="14.00">Output Projections\n8×[128,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l1_attention&#45;&gt;l1_out_proj -->
<g id="edge32" class="edge">
<title>l1_attention&#45;&gt;l1_out_proj</title>
<path fill="none" stroke="black" d="M1950.32,-3145.97C1950.63,-3129.38 1951.12,-3103.88 1951.48,-3084.43"/>
<polygon fill="black" stroke="black" points="1954.98,-3084.4 1951.67,-3074.34 1947.98,-3084.27 1954.98,-3084.4"/>
</g>
<!-- l1_gather -->
<g id="node25" class="node">
<title>l1_gather</title>
<polygon fill="lightcyan" stroke="black" points="2139.21,-2966 1852.54,-2966 1778.79,-2930 2065.46,-2930 2139.21,-2966"/>
<text text-anchor="middle" x="1959" y="-2944.3" font-family="Times,serif" font-size="14.00">Token Gather\nGPU: 0&#45;7</text>
</g>
<!-- l1_out_proj&#45;&gt;l1_gather -->
<g id="edge33" class="edge">
<title>l1_out_proj&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M1953.12,-3037.97C1954.22,-3021.38 1955.9,-2995.88 1957.19,-2976.43"/>
<polygon fill="black" stroke="black" points="1960.69,-2976.55 1957.85,-2966.34 1953.7,-2976.09 1960.69,-2976.55"/>
</g>
<!-- l1_gather&#45;&gt;l1_attn_res -->
<g id="edge34" class="edge">
<title>l1_gather&#45;&gt;l1_attn_res</title>
<path fill="none" stroke="black" d="M1968.64,-2929.97C1978.25,-2912.99 1993.13,-2886.7 2004.23,-2867.09"/>
<polygon fill="black" stroke="black" points="2007.3,-2868.77 2009.18,-2858.34 2001.21,-2865.32 2007.3,-2868.77"/>
</g>
<!-- l1_gate -->
<g id="node27" class="node">
<title>l1_gate</title>
<polygon fill="lightcoral" stroke="black" points="2177,-2750 1861,-2750 1861,-2714 2177,-2714 2177,-2750"/>
<text text-anchor="middle" x="2019" y="-2728.3" font-family="Times,serif" font-size="14.00">Gate Network\n[1024,2048,16]\nGPU: 0&#45;7</text>
</g>
<!-- l1_attn_res&#45;&gt;l1_gate -->
<g id="edge36" class="edge">
<title>l1_attn_res&#45;&gt;l1_gate</title>
<path fill="none" stroke="black" d="M2019,-2821.97C2019,-2805.38 2019,-2779.88 2019,-2760.43"/>
<polygon fill="black" stroke="black" points="2022.5,-2760.34 2019,-2750.34 2015.5,-2760.34 2022.5,-2760.34"/>
</g>
<!-- l1_expert_route -->
<g id="node28" class="node">
<title>l1_expert_route</title>
<polygon fill="lightcyan" stroke="black" points="1548.14,-2750 1357.02,-2750 1307.86,-2714 1498.98,-2714 1548.14,-2750"/>
<text text-anchor="middle" x="1428" y="-2728.3" font-family="Times,serif" font-size="14.00">Expert Routing</text>
</g>
<!-- l1_attn_res&#45;&gt;l1_expert_route -->
<g id="edge37" class="edge">
<title>l1_attn_res&#45;&gt;l1_expert_route</title>
<path fill="none" stroke="black" d="M1924.05,-2821.97C1817.15,-2802.8 1643.95,-2771.73 1533.07,-2751.85"/>
<polygon fill="black" stroke="black" points="1533.67,-2748.4 1523.21,-2750.08 1532.43,-2755.29 1533.67,-2748.4"/>
</g>
<!-- l1_moe_res -->
<g id="node38" class="node">
<title>l1_moe_res</title>
<polygon fill="orange" stroke="black" points="2267.5,-2426 2016.5,-2426 2016.5,-2390 2267.5,-2390 2267.5,-2426"/>
<text text-anchor="middle" x="2142" y="-2404.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]</text>
</g>
<!-- l1_attn_res&#45;&gt;l1_moe_res -->
<g id="edge55" class="edge">
<title>l1_attn_res&#45;&gt;l1_moe_res</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M2144.52,-2828.33C2262.6,-2810.8 2432.88,-2764.46 2513,-2642 2587.85,-2527.59 2374.68,-2458.98 2241.05,-2428.25"/>
<polygon fill="red" stroke="red" points="2241.7,-2424.81 2231.17,-2426.01 2240.15,-2431.63 2241.7,-2424.81"/>
</g>
<!-- l1_exp0 -->
<g id="node29" class="node">
<title>l1_exp0</title>
<polygon fill="lightpink" stroke="black" points="325,-2642 51,-2642 51,-2606 325,-2606 325,-2642"/>
<text text-anchor="middle" x="188" y="-2620.3" font-family="Times,serif" font-size="14.00">Expert 0\n[128,2048,4096]\nGPU: 0</text>
</g>
<!-- l1_expert_route&#45;&gt;l1_exp0 -->
<g id="edge38" class="edge">
<title>l1_expert_route&#45;&gt;l1_exp0</title>
<path fill="none" stroke="black" d="M1320.11,-2723.13C1124.98,-2708.69 700.46,-2676.26 343,-2642 340.47,-2641.76 337.91,-2641.51 335.33,-2641.26"/>
<polygon fill="black" stroke="black" points="335.62,-2637.77 325.32,-2640.26 334.92,-2644.73 335.62,-2637.77"/>
</g>
<!-- l1_exp1 -->
<g id="node30" class="node">
<title>l1_exp1</title>
<polygon fill="lightpink" stroke="black" points="635,-2642 361,-2642 361,-2606 635,-2606 635,-2642"/>
<text text-anchor="middle" x="498" y="-2620.3" font-family="Times,serif" font-size="14.00">Expert 1\n[128,2048,4096]\nGPU: 1</text>
</g>
<!-- l1_expert_route&#45;&gt;l1_exp1 -->
<g id="edge40" class="edge">
<title>l1_expert_route&#45;&gt;l1_exp1</title>
<path fill="none" stroke="black" d="M1313.03,-2717.9C1144.58,-2698.7 830.66,-2662.92 645.44,-2641.81"/>
<polygon fill="black" stroke="black" points="645.68,-2638.31 635.35,-2640.66 644.89,-2645.27 645.68,-2638.31"/>
</g>
<!-- l1_exp2 -->
<g id="node31" class="node">
<title>l1_exp2</title>
<polygon fill="lightpink" stroke="black" points="945,-2642 671,-2642 671,-2606 945,-2606 945,-2642"/>
<text text-anchor="middle" x="808" y="-2620.3" font-family="Times,serif" font-size="14.00">Expert 2\n[128,2048,4096]\nGPU: 2</text>
</g>
<!-- l1_expert_route&#45;&gt;l1_exp2 -->
<g id="edge42" class="edge">
<title>l1_expert_route&#45;&gt;l1_exp2</title>
<path fill="none" stroke="black" d="M1328.39,-2713.97C1216.05,-2694.76 1033.92,-2663.62 917.62,-2643.74"/>
<polygon fill="black" stroke="black" points="918.07,-2640.27 907.62,-2642.03 916.89,-2647.17 918.07,-2640.27"/>
</g>
<!-- l1_exp3 -->
<g id="node32" class="node">
<title>l1_exp3</title>
<polygon fill="lightpink" stroke="black" points="1255,-2642 981,-2642 981,-2606 1255,-2606 1255,-2642"/>
<text text-anchor="middle" x="1118" y="-2620.3" font-family="Times,serif" font-size="14.00">Expert 3\n[128,2048,4096]\nGPU: 3</text>
</g>
<!-- l1_expert_route&#45;&gt;l1_exp3 -->
<g id="edge44" class="edge">
<title>l1_expert_route&#45;&gt;l1_exp3</title>
<path fill="none" stroke="black" d="M1378.19,-2713.97C1323.59,-2695.3 1236,-2665.35 1177.74,-2645.43"/>
<polygon fill="black" stroke="black" points="1178.53,-2642 1167.94,-2642.08 1176.27,-2648.62 1178.53,-2642"/>
</g>
<!-- l1_exp4 -->
<g id="node33" class="node">
<title>l1_exp4</title>
<polygon fill="lightpink" stroke="black" points="1565,-2642 1291,-2642 1291,-2606 1565,-2606 1565,-2642"/>
<text text-anchor="middle" x="1428" y="-2620.3" font-family="Times,serif" font-size="14.00">Expert 4\n[128,2048,4096]\nGPU: 4</text>
</g>
<!-- l1_expert_route&#45;&gt;l1_exp4 -->
<g id="edge46" class="edge">
<title>l1_expert_route&#45;&gt;l1_exp4</title>
<path fill="none" stroke="black" d="M1428,-2713.97C1428,-2697.38 1428,-2671.88 1428,-2652.43"/>
<polygon fill="black" stroke="black" points="1431.5,-2652.34 1428,-2642.34 1424.5,-2652.34 1431.5,-2652.34"/>
</g>
<!-- l1_exp5 -->
<g id="node34" class="node">
<title>l1_exp5</title>
<polygon fill="lightpink" stroke="black" points="1875,-2642 1601,-2642 1601,-2606 1875,-2606 1875,-2642"/>
<text text-anchor="middle" x="1738" y="-2620.3" font-family="Times,serif" font-size="14.00">Expert 5\n[128,2048,4096]\nGPU: 5</text>
</g>
<!-- l1_expert_route&#45;&gt;l1_exp5 -->
<g id="edge48" class="edge">
<title>l1_expert_route&#45;&gt;l1_exp5</title>
<path fill="none" stroke="black" d="M1477.81,-2713.97C1532.41,-2695.3 1620,-2665.35 1678.26,-2645.43"/>
<polygon fill="black" stroke="black" points="1679.73,-2648.62 1688.06,-2642.08 1677.47,-2642 1679.73,-2648.62"/>
</g>
<!-- l1_exp6 -->
<g id="node35" class="node">
<title>l1_exp6</title>
<polygon fill="lightpink" stroke="black" points="2185,-2642 1911,-2642 1911,-2606 2185,-2606 2185,-2642"/>
<text text-anchor="middle" x="2048" y="-2620.3" font-family="Times,serif" font-size="14.00">Expert 6\n[128,2048,4096]\nGPU: 6</text>
</g>
<!-- l1_expert_route&#45;&gt;l1_exp6 -->
<g id="edge50" class="edge">
<title>l1_expert_route&#45;&gt;l1_exp6</title>
<path fill="none" stroke="black" d="M1504.65,-2717.9C1613.63,-2699.26 1813.95,-2665.01 1938.55,-2643.71"/>
<polygon fill="black" stroke="black" points="1939.24,-2647.15 1948.5,-2642.01 1938.06,-2640.25 1939.24,-2647.15"/>
</g>
<!-- l1_exp7 -->
<g id="node36" class="node">
<title>l1_exp7</title>
<polygon fill="lightpink" stroke="black" points="2495,-2642 2221,-2642 2221,-2606 2495,-2606 2495,-2642"/>
<text text-anchor="middle" x="2358" y="-2620.3" font-family="Times,serif" font-size="14.00">Expert 7\n[128,2048,4096]\nGPU: 7</text>
</g>
<!-- l1_expert_route&#45;&gt;l1_exp7 -->
<g id="edge52" class="edge">
<title>l1_expert_route&#45;&gt;l1_exp7</title>
<path fill="none" stroke="black" d="M1509.72,-2721.69C1666.66,-2703.8 2012.25,-2664.41 2210.49,-2641.81"/>
<polygon fill="black" stroke="black" points="2211.16,-2645.26 2220.7,-2640.65 2210.37,-2638.3 2211.16,-2645.26"/>
</g>
<!-- l1_expert_agg -->
<g id="node37" class="node">
<title>l1_expert_agg</title>
<polygon fill="lightcyan" stroke="black" points="1578.63,-2534 1339.01,-2534 1277.37,-2498 1516.99,-2498 1578.63,-2534"/>
<text text-anchor="middle" x="1428" y="-2512.3" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
</g>
<!-- l1_exp0&#45;&gt;l1_expert_agg -->
<g id="edge39" class="edge">
<title>l1_exp0&#45;&gt;l1_expert_agg</title>
<path fill="none" stroke="black" d="M325.32,-2607.74C331.29,-2607.14 337.21,-2606.56 343,-2606 695.97,-2572.17 1114.32,-2540.13 1312.65,-2525.42"/>
<polygon fill="black" stroke="black" points="1313.08,-2528.9 1322.79,-2524.67 1312.56,-2521.92 1313.08,-2528.9"/>
</g>
<!-- l1_exp1&#45;&gt;l1_expert_agg -->
<g id="edge41" class="edge">
<title>l1_exp1&#45;&gt;l1_expert_agg</title>
<path fill="none" stroke="black" d="M635.22,-2607.36C821.12,-2586.17 1149.22,-2548.77 1319.16,-2529.41"/>
<polygon fill="black" stroke="black" points="1319.58,-2532.88 1329.12,-2528.27 1318.79,-2525.92 1319.58,-2532.88"/>
</g>
<!-- l1_exp2&#45;&gt;l1_expert_agg -->
<g id="edge43" class="edge">
<title>l1_exp2&#45;&gt;l1_expert_agg</title>
<path fill="none" stroke="black" d="M907.61,-2605.97C1022.53,-2586.32 1210.48,-2554.19 1326.28,-2534.39"/>
<polygon fill="black" stroke="black" points="1326.95,-2537.83 1336.22,-2532.69 1325.77,-2530.93 1326.95,-2537.83"/>
</g>
<!-- l1_exp3&#45;&gt;l1_expert_agg -->
<g id="edge45" class="edge">
<title>l1_exp3&#45;&gt;l1_expert_agg</title>
<path fill="none" stroke="black" d="M1167.81,-2605.97C1222.41,-2587.3 1310,-2557.35 1368.26,-2537.43"/>
<polygon fill="black" stroke="black" points="1369.73,-2540.62 1378.06,-2534.08 1367.47,-2534 1369.73,-2540.62"/>
</g>
<!-- l1_exp4&#45;&gt;l1_expert_agg -->
<g id="edge47" class="edge">
<title>l1_exp4&#45;&gt;l1_expert_agg</title>
<path fill="none" stroke="black" d="M1428,-2605.97C1428,-2589.38 1428,-2563.88 1428,-2544.43"/>
<polygon fill="black" stroke="black" points="1431.5,-2544.34 1428,-2534.34 1424.5,-2544.34 1431.5,-2544.34"/>
</g>
<!-- l1_exp5&#45;&gt;l1_expert_agg -->
<g id="edge49" class="edge">
<title>l1_exp5&#45;&gt;l1_expert_agg</title>
<path fill="none" stroke="black" d="M1688.19,-2605.97C1633.59,-2587.3 1546,-2557.35 1487.74,-2537.43"/>
<polygon fill="black" stroke="black" points="1488.53,-2534 1477.94,-2534.08 1486.27,-2540.62 1488.53,-2534"/>
</g>
<!-- l1_exp6&#45;&gt;l1_expert_agg -->
<g id="edge51" class="edge">
<title>l1_exp6&#45;&gt;l1_expert_agg</title>
<path fill="none" stroke="black" d="M1948.39,-2605.97C1836.05,-2586.76 1653.92,-2555.62 1537.62,-2535.74"/>
<polygon fill="black" stroke="black" points="1538.07,-2532.27 1527.62,-2534.03 1536.89,-2539.17 1538.07,-2532.27"/>
</g>
<!-- l1_exp7&#45;&gt;l1_expert_agg -->
<g id="edge53" class="edge">
<title>l1_exp7&#45;&gt;l1_expert_agg</title>
<path fill="none" stroke="black" d="M2220.78,-2607.36C2051.93,-2588.11 1765.76,-2555.5 1587.35,-2535.16"/>
<polygon fill="black" stroke="black" points="1587.68,-2531.68 1577.35,-2534.02 1586.89,-2538.63 1587.68,-2531.68"/>
</g>
<!-- l1_expert_agg&#45;&gt;l1_moe_res -->
<g id="edge54" class="edge">
<title>l1_expert_agg&#45;&gt;l1_moe_res</title>
<path fill="none" stroke="black" d="M1522.45,-2500.98C1649.68,-2482.09 1876.4,-2448.43 2017.46,-2427.49"/>
<polygon fill="black" stroke="black" points="2018.09,-2430.93 2027.47,-2426 2017.06,-2424.01 2018.09,-2430.93"/>
</g>
<!-- stage0_to_stage1 -->
<g id="node75" class="node">
<title>stage0_to_stage1</title>
<polygon fill="gray" stroke="black" points="2461.47,-2318 1953.27,-2318 1822.53,-2282 2330.73,-2282 2461.47,-2318"/>
<text text-anchor="middle" x="2142" y="-2296.3" font-family="Times,serif" font-size="14.00">Pipeline Communication\nStage 0 → Stage 1</text>
</g>
<!-- l1_moe_res&#45;&gt;stage0_to_stage1 -->
<g id="edge56" class="edge">
<title>l1_moe_res&#45;&gt;stage0_to_stage1</title>
<path fill="none" stroke="black" d="M2142,-2389.97C2142,-2373.38 2142,-2347.88 2142,-2328.43"/>
<polygon fill="black" stroke="black" points="2145.5,-2328.34 2142,-2318.34 2138.5,-2328.34 2145.5,-2328.34"/>
</g>
<!-- l2_token_split -->
<g id="node39" class="node">
<title>l2_token_split</title>
<polygon fill="lightcyan" stroke="black" points="2063.37,-2210 1787.58,-2210 1716.63,-2174 1992.42,-2174 2063.37,-2210"/>
<text text-anchor="middle" x="1890" y="-2188.3" font-family="Times,serif" font-size="14.00">Token Split\nGPU: 8&#45;15</text>
</g>
<!-- l2_qkv -->
<g id="node40" class="node">
<title>l2_qkv</title>
<polygon fill="yellow" stroke="black" points="2062.5,-2102 1691.5,-2102 1691.5,-2066 2062.5,-2066 2062.5,-2102"/>
<text text-anchor="middle" x="1877" y="-2080.3" font-family="Times,serif" font-size="14.00">QKV Projections\n8×[128,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l2_token_split&#45;&gt;l2_qkv -->
<g id="edge59" class="edge">
<title>l2_token_split&#45;&gt;l2_qkv</title>
<path fill="none" stroke="black" d="M1887.91,-2173.97C1885.88,-2157.38 1882.75,-2131.88 1880.36,-2112.43"/>
<polygon fill="black" stroke="black" points="1883.82,-2111.84 1879.13,-2102.34 1876.87,-2112.69 1883.82,-2111.84"/>
</g>
<!-- l2_attention -->
<g id="node41" class="node">
<title>l2_attention</title>
<polygon fill="yellow" stroke="black" points="2069,-1994 1671,-1994 1671,-1958 2069,-1958 2069,-1994"/>
<text text-anchor="middle" x="1870" y="-1972.3" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention\n8×[128,2048,512]\nGPU: 8&#45;15</text>
</g>
<!-- l2_qkv&#45;&gt;l2_attention -->
<g id="edge60" class="edge">
<title>l2_qkv&#45;&gt;l2_attention</title>
<path fill="none" stroke="black" d="M1875.88,-2065.97C1874.78,-2049.38 1873.1,-2023.88 1871.81,-2004.43"/>
<polygon fill="black" stroke="black" points="1875.3,-2004.09 1871.15,-1994.34 1868.31,-2004.55 1875.3,-2004.09"/>
</g>
<!-- l2_out_proj -->
<g id="node42" class="node">
<title>l2_out_proj</title>
<polygon fill="yellow" stroke="black" points="2067,-1886 1677,-1886 1677,-1850 2067,-1850 2067,-1886"/>
<text text-anchor="middle" x="1872" y="-1864.3" font-family="Times,serif" font-size="14.00">Output Projections\n8×[128,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l2_attention&#45;&gt;l2_out_proj -->
<g id="edge61" class="edge">
<title>l2_attention&#45;&gt;l2_out_proj</title>
<path fill="none" stroke="black" d="M1870.32,-1957.97C1870.63,-1941.38 1871.12,-1915.88 1871.48,-1896.43"/>
<polygon fill="black" stroke="black" points="1874.98,-1896.4 1871.67,-1886.34 1867.98,-1896.27 1874.98,-1896.4"/>
</g>
<!-- l2_gather -->
<g id="node43" class="node">
<title>l2_gather</title>
<polygon fill="lightcyan" stroke="black" points="2063.86,-1778 1763.42,-1778 1686.14,-1742 1986.58,-1742 2063.86,-1778"/>
<text text-anchor="middle" x="1875" y="-1756.3" font-family="Times,serif" font-size="14.00">Token Gather\nGPU: 8&#45;15</text>
</g>
<!-- l2_out_proj&#45;&gt;l2_gather -->
<g id="edge62" class="edge">
<title>l2_out_proj&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M1872.48,-1849.97C1872.95,-1833.38 1873.67,-1807.88 1874.22,-1788.43"/>
<polygon fill="black" stroke="black" points="1877.72,-1788.44 1874.51,-1778.34 1870.73,-1788.24 1877.72,-1788.44"/>
</g>
<!-- l2_attn_res -->
<g id="node44" class="node">
<title>l2_attn_res</title>
<polygon fill="orange" stroke="black" points="2068.5,-1670 1817.5,-1670 1817.5,-1634 2068.5,-1634 2068.5,-1670"/>
<text text-anchor="middle" x="1943" y="-1648.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]</text>
</g>
<!-- l2_gather&#45;&gt;l2_attn_res -->
<g id="edge63" class="edge">
<title>l2_gather&#45;&gt;l2_attn_res</title>
<path fill="none" stroke="black" d="M1885.93,-1741.97C1896.86,-1724.92 1913.84,-1698.46 1926.43,-1678.82"/>
<polygon fill="black" stroke="black" points="1929.42,-1680.65 1931.88,-1670.34 1923.53,-1676.87 1929.42,-1680.65"/>
</g>
<!-- l2_gate -->
<g id="node45" class="node">
<title>l2_gate</title>
<polygon fill="lightcoral" stroke="black" points="2105.5,-1562 1780.5,-1562 1780.5,-1526 2105.5,-1526 2105.5,-1562"/>
<text text-anchor="middle" x="1943" y="-1540.3" font-family="Times,serif" font-size="14.00">Gate Network\n[1024,2048,16]\nGPU: 8&#45;15</text>
</g>
<!-- l2_attn_res&#45;&gt;l2_gate -->
<g id="edge65" class="edge">
<title>l2_attn_res&#45;&gt;l2_gate</title>
<path fill="none" stroke="black" d="M1943,-1633.97C1943,-1617.38 1943,-1591.88 1943,-1572.43"/>
<polygon fill="black" stroke="black" points="1946.5,-1572.34 1943,-1562.34 1939.5,-1572.34 1946.5,-1572.34"/>
</g>
<!-- l2_expert_route -->
<g id="node46" class="node">
<title>l2_expert_route</title>
<polygon fill="lightcyan" stroke="black" points="1644.14,-1562 1453.02,-1562 1403.86,-1526 1594.98,-1526 1644.14,-1562"/>
<text text-anchor="middle" x="1524" y="-1540.3" font-family="Times,serif" font-size="14.00">Expert Routing</text>
</g>
<!-- l2_attn_res&#45;&gt;l2_expert_route -->
<g id="edge66" class="edge">
<title>l2_attn_res&#45;&gt;l2_expert_route</title>
<path fill="none" stroke="black" d="M1875.68,-1633.97C1800.81,-1615.03 1680.06,-1584.48 1601.36,-1564.57"/>
<polygon fill="black" stroke="black" points="1602.05,-1561.14 1591.5,-1562.08 1600.34,-1567.92 1602.05,-1561.14"/>
</g>
<!-- l2_moe_res -->
<g id="node56" class="node">
<title>l2_moe_res</title>
<polygon fill="orange" stroke="black" points="2344.5,-1238 2093.5,-1238 2093.5,-1202 2344.5,-1202 2344.5,-1238"/>
<text text-anchor="middle" x="2219" y="-1216.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]</text>
</g>
<!-- l2_attn_res&#45;&gt;l2_moe_res -->
<g id="edge84" class="edge">
<title>l2_attn_res&#45;&gt;l2_moe_res</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M2067.29,-1633.98C2248.68,-1606.31 2571.9,-1545.3 2641,-1454 2730.57,-1335.65 2493.49,-1269.45 2339.37,-1239.95"/>
<polygon fill="blue" stroke="blue" points="2339.82,-1236.47 2329.34,-1238.06 2338.52,-1243.35 2339.82,-1236.47"/>
</g>
<!-- l2_exp0 -->
<g id="node47" class="node">
<title>l2_exp0</title>
<polygon fill="lightpink" stroke="black" points="398,-1454 124,-1454 124,-1418 398,-1418 398,-1454"/>
<text text-anchor="middle" x="261" y="-1432.3" font-family="Times,serif" font-size="14.00">Expert 0\n[128,2048,4096]\nGPU: 8</text>
</g>
<!-- l2_expert_route&#45;&gt;l2_exp0 -->
<g id="edge67" class="edge">
<title>l2_expert_route&#45;&gt;l2_exp0</title>
<path fill="none" stroke="black" d="M1416.56,-1535.41C1218.54,-1521.2 782.7,-1488.83 416,-1454 413.47,-1453.76 410.91,-1453.51 408.33,-1453.26"/>
<polygon fill="black" stroke="black" points="408.61,-1449.77 398.32,-1452.28 407.93,-1456.74 408.61,-1449.77"/>
</g>
<!-- l2_exp1 -->
<g id="node48" class="node">
<title>l2_exp1</title>
<polygon fill="lightpink" stroke="black" points="708,-1454 434,-1454 434,-1418 708,-1418 708,-1454"/>
<text text-anchor="middle" x="571" y="-1432.3" font-family="Times,serif" font-size="14.00">Expert 1\n[128,2048,4096]\nGPU: 9</text>
</g>
<!-- l2_expert_route&#45;&gt;l2_exp1 -->
<g id="edge69" class="edge">
<title>l2_expert_route&#45;&gt;l2_exp1</title>
<path fill="none" stroke="black" d="M1409.52,-1530.27C1236.55,-1511.03 908.63,-1474.55 718.15,-1453.37"/>
<polygon fill="black" stroke="black" points="718.39,-1449.87 708.06,-1452.24 717.61,-1456.83 718.39,-1449.87"/>
</g>
<!-- l2_exp2 -->
<g id="node49" class="node">
<title>l2_exp2</title>
<polygon fill="lightpink" stroke="black" points="1027.5,-1454 744.5,-1454 744.5,-1418 1027.5,-1418 1027.5,-1454"/>
<text text-anchor="middle" x="886" y="-1432.3" font-family="Times,serif" font-size="14.00">Expert 2\n[128,2048,4096]\nGPU: 10</text>
</g>
<!-- l2_expert_route&#45;&gt;l2_exp2 -->
<g id="edge71" class="edge">
<title>l2_expert_route&#45;&gt;l2_exp2</title>
<path fill="none" stroke="black" d="M1421.49,-1525.97C1305.78,-1506.74 1118.1,-1475.56 998.44,-1455.68"/>
<polygon fill="black" stroke="black" points="998.95,-1452.22 988.52,-1454.03 997.81,-1459.12 998.95,-1452.22"/>
</g>
<!-- l2_exp3 -->
<g id="node50" class="node">
<title>l2_exp3</title>
<polygon fill="lightpink" stroke="black" points="1346.5,-1454 1063.5,-1454 1063.5,-1418 1346.5,-1418 1346.5,-1454"/>
<text text-anchor="middle" x="1205" y="-1432.3" font-family="Times,serif" font-size="14.00">Expert 3\n[128,2048,4096]\nGPU: 11</text>
</g>
<!-- l2_expert_route&#45;&gt;l2_exp3 -->
<g id="edge73" class="edge">
<title>l2_expert_route&#45;&gt;l2_exp3</title>
<path fill="none" stroke="black" d="M1472.75,-1525.97C1416.44,-1507.26 1326.06,-1477.23 1266.11,-1457.31"/>
<polygon fill="black" stroke="black" points="1266.98,-1453.91 1256.39,-1454.08 1264.78,-1460.55 1266.98,-1453.91"/>
</g>
<!-- l2_exp4 -->
<g id="node51" class="node">
<title>l2_exp4</title>
<polygon fill="lightpink" stroke="black" points="1665.5,-1454 1382.5,-1454 1382.5,-1418 1665.5,-1418 1665.5,-1454"/>
<text text-anchor="middle" x="1524" y="-1432.3" font-family="Times,serif" font-size="14.00">Expert 4\n[128,2048,4096]\nGPU: 12</text>
</g>
<!-- l2_expert_route&#45;&gt;l2_exp4 -->
<g id="edge75" class="edge">
<title>l2_expert_route&#45;&gt;l2_exp4</title>
<path fill="none" stroke="black" d="M1524,-1525.97C1524,-1509.38 1524,-1483.88 1524,-1464.43"/>
<polygon fill="black" stroke="black" points="1527.5,-1464.34 1524,-1454.34 1520.5,-1464.34 1527.5,-1464.34"/>
</g>
<!-- l2_exp5 -->
<g id="node52" class="node">
<title>l2_exp5</title>
<polygon fill="lightpink" stroke="black" points="1984.5,-1454 1701.5,-1454 1701.5,-1418 1984.5,-1418 1984.5,-1454"/>
<text text-anchor="middle" x="1843" y="-1432.3" font-family="Times,serif" font-size="14.00">Expert 5\n[128,2048,4096]\nGPU: 13</text>
</g>
<!-- l2_expert_route&#45;&gt;l2_exp5 -->
<g id="edge77" class="edge">
<title>l2_expert_route&#45;&gt;l2_exp5</title>
<path fill="none" stroke="black" d="M1575.25,-1525.97C1631.56,-1507.26 1721.94,-1477.23 1781.89,-1457.31"/>
<polygon fill="black" stroke="black" points="1783.22,-1460.55 1791.61,-1454.08 1781.02,-1453.91 1783.22,-1460.55"/>
</g>
<!-- l2_exp6 -->
<g id="node53" class="node">
<title>l2_exp6</title>
<polygon fill="lightpink" stroke="black" points="2303.5,-1454 2020.5,-1454 2020.5,-1418 2303.5,-1418 2303.5,-1454"/>
<text text-anchor="middle" x="2162" y="-1432.3" font-family="Times,serif" font-size="14.00">Expert 6\n[128,2048,4096]\nGPU: 14</text>
</g>
<!-- l2_expert_route&#45;&gt;l2_exp6 -->
<g id="edge79" class="edge">
<title>l2_expert_route&#45;&gt;l2_exp6</title>
<path fill="none" stroke="black" d="M1600.96,-1530.21C1712.72,-1511.65 1920.63,-1477.1 2049.56,-1455.68"/>
<polygon fill="black" stroke="black" points="2050.19,-1459.13 2059.48,-1454.03 2049.04,-1452.22 2050.19,-1459.13"/>
</g>
<!-- l2_exp7 -->
<g id="node54" class="node">
<title>l2_exp7</title>
<polygon fill="lightpink" stroke="black" points="2622.5,-1454 2339.5,-1454 2339.5,-1418 2622.5,-1418 2622.5,-1454"/>
<text text-anchor="middle" x="2481" y="-1432.3" font-family="Times,serif" font-size="14.00">Expert 7\n[128,2048,4096]\nGPU: 15</text>
</g>
<!-- l2_expert_route&#45;&gt;l2_exp7 -->
<g id="edge81" class="edge">
<title>l2_expert_route&#45;&gt;l2_exp7</title>
<path fill="none" stroke="black" d="M1606.01,-1533.92C1766.58,-1516.13 2124.59,-1476.48 2329.43,-1453.79"/>
<polygon fill="black" stroke="black" points="2329.82,-1457.27 2339.37,-1452.69 2329.05,-1450.31 2329.82,-1457.27"/>
</g>
<!-- l2_expert_agg -->
<g id="node55" class="node">
<title>l2_expert_agg</title>
<polygon fill="lightcyan" stroke="black" points="1674.63,-1346 1435.01,-1346 1373.37,-1310 1612.99,-1310 1674.63,-1346"/>
<text text-anchor="middle" x="1524" y="-1324.3" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
</g>
<!-- l2_exp0&#45;&gt;l2_expert_agg -->
<g id="edge68" class="edge">
<title>l2_exp0&#45;&gt;l2_expert_agg</title>
<path fill="none" stroke="black" d="M398.32,-1419.72C404.29,-1419.13 410.21,-1418.55 416,-1418 777.79,-1383.64 1206.89,-1351.67 1408.48,-1337.17"/>
<polygon fill="black" stroke="black" points="1408.77,-1340.66 1418.5,-1336.45 1408.27,-1333.67 1408.77,-1340.66"/>
</g>
<!-- l2_exp1&#45;&gt;l2_expert_agg -->
<g id="edge70" class="edge">
<title>l2_exp1&#45;&gt;l2_expert_agg</title>
<path fill="none" stroke="black" d="M708.05,-1419.76C898.66,-1398.56 1240,-1360.59 1414.6,-1341.17"/>
<polygon fill="black" stroke="black" points="1415.02,-1344.64 1424.57,-1340.06 1414.25,-1337.69 1415.02,-1344.64"/>
</g>
<!-- l2_exp2&#45;&gt;l2_expert_agg -->
<g id="edge72" class="edge">
<title>l2_exp2&#45;&gt;l2_expert_agg</title>
<path fill="none" stroke="black" d="M988.51,-1417.97C1107.53,-1398.19 1302.69,-1365.77 1421.64,-1346.01"/>
<polygon fill="black" stroke="black" points="1422.56,-1349.4 1431.85,-1344.31 1421.41,-1342.5 1422.56,-1349.4"/>
</g>
<!-- l2_exp3&#45;&gt;l2_expert_agg -->
<g id="edge74" class="edge">
<title>l2_exp3&#45;&gt;l2_expert_agg</title>
<path fill="none" stroke="black" d="M1256.25,-1417.97C1312.56,-1399.26 1402.94,-1369.23 1462.89,-1349.31"/>
<polygon fill="black" stroke="black" points="1464.22,-1352.55 1472.61,-1346.08 1462.02,-1345.91 1464.22,-1352.55"/>
</g>
<!-- l2_exp4&#45;&gt;l2_expert_agg -->
<g id="edge76" class="edge">
<title>l2_exp4&#45;&gt;l2_expert_agg</title>
<path fill="none" stroke="black" d="M1524,-1417.97C1524,-1401.38 1524,-1375.88 1524,-1356.43"/>
<polygon fill="black" stroke="black" points="1527.5,-1356.34 1524,-1346.34 1520.5,-1356.34 1527.5,-1356.34"/>
</g>
<!-- l2_exp5&#45;&gt;l2_expert_agg -->
<g id="edge78" class="edge">
<title>l2_exp5&#45;&gt;l2_expert_agg</title>
<path fill="none" stroke="black" d="M1791.75,-1417.97C1735.44,-1399.26 1645.06,-1369.23 1585.11,-1349.31"/>
<polygon fill="black" stroke="black" points="1585.98,-1345.91 1575.39,-1346.08 1583.78,-1352.55 1585.98,-1345.91"/>
</g>
<!-- l2_exp6&#45;&gt;l2_expert_agg -->
<g id="edge80" class="edge">
<title>l2_exp6&#45;&gt;l2_expert_agg</title>
<path fill="none" stroke="black" d="M2059.49,-1417.97C1943.78,-1398.74 1756.1,-1367.56 1636.44,-1347.68"/>
<polygon fill="black" stroke="black" points="1636.95,-1344.22 1626.52,-1346.03 1635.81,-1351.12 1636.95,-1344.22"/>
</g>
<!-- l2_exp7&#45;&gt;l2_expert_agg -->
<g id="edge82" class="edge">
<title>l2_exp7&#45;&gt;l2_expert_agg</title>
<path fill="none" stroke="black" d="M2339.28,-1419.3C2164.29,-1399.92 1867.42,-1367.04 1684.29,-1346.75"/>
<polygon fill="black" stroke="black" points="1684.63,-1343.27 1674.3,-1345.65 1683.86,-1350.23 1684.63,-1343.27"/>
</g>
<!-- l2_expert_agg&#45;&gt;l2_moe_res -->
<g id="edge83" class="edge">
<title>l2_expert_agg&#45;&gt;l2_moe_res</title>
<path fill="none" stroke="black" d="M1617.73,-1312.7C1741.72,-1293.79 1960.47,-1260.43 2097.15,-1239.58"/>
<polygon fill="black" stroke="black" points="2097.9,-1243.01 2107.26,-1238.04 2096.84,-1236.09 2097.9,-1243.01"/>
</g>
<!-- l3_token_split -->
<g id="node57" class="node">
<title>l3_token_split</title>
<polygon fill="lightcyan" stroke="black" points="2140.37,-1116 1864.58,-1116 1793.63,-1080 2069.42,-1080 2140.37,-1116"/>
<text text-anchor="middle" x="1967" y="-1094.3" font-family="Times,serif" font-size="14.00">Token Split\nGPU: 8&#45;15</text>
</g>
<!-- l2_moe_res&#45;&gt;l3_token_split -->
<g id="edge85" class="edge">
<title>l2_moe_res&#45;&gt;l3_token_split</title>
<path fill="none" stroke="black" d="M2183.16,-1201.93C2138.1,-1180.48 2060.73,-1143.63 2011.8,-1120.33"/>
<polygon fill="black" stroke="black" points="2013.25,-1117.15 2002.71,-1116.01 2010.24,-1123.47 2013.25,-1117.15"/>
</g>
<!-- l3_attn_res -->
<g id="node62" class="node">
<title>l3_attn_res</title>
<polygon fill="orange" stroke="black" points="2145.5,-576 1894.5,-576 1894.5,-540 2145.5,-540 2145.5,-576"/>
<text text-anchor="middle" x="2020" y="-554.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]</text>
</g>
<!-- l2_moe_res&#45;&gt;l3_attn_res -->
<g id="edge86" class="edge">
<title>l2_moe_res&#45;&gt;l3_attn_res</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M2209.45,-1201.84C2201,-1163.85 2201,-1069.77 2201,-991 2201,-991 2201,-991 2201,-773 2201,-711.38 2181.84,-694.15 2141,-648 2115.78,-619.49 2079.3,-596.61 2052.56,-581.18"/>
<polygon fill="blue" stroke="blue" points="2053.96,-577.95 2043.54,-576.04 2050.5,-584.04 2053.96,-577.95"/>
</g>
<!-- l2_moe_res&#45;&gt;l3_attn_res -->
<g id="edge92" class="edge">
<title>l2_moe_res&#45;&gt;l3_attn_res</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M2228.55,-1201.84C2237,-1163.85 2237,-1069.77 2237,-991 2237,-991 2237,-991 2237,-773 2237,-711.38 2217.84,-694.15 2177,-648 2151.33,-619 2114.02,-595.81 2081.87,-580.38"/>
<polygon fill="blue" stroke="blue" points="2083.06,-577.08 2072.52,-576.04 2080.11,-583.43 2083.06,-577.08"/>
</g>
<!-- l3_qkv -->
<g id="node58" class="node">
<title>l3_qkv</title>
<polygon fill="yellow" stroke="black" points="2139.5,-1008 1768.5,-1008 1768.5,-972 2139.5,-972 2139.5,-1008"/>
<text text-anchor="middle" x="1954" y="-986.3" font-family="Times,serif" font-size="14.00">QKV Projections\n8×[128,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l3_token_split&#45;&gt;l3_qkv -->
<g id="edge87" class="edge">
<title>l3_token_split&#45;&gt;l3_qkv</title>
<path fill="none" stroke="black" d="M1964.91,-1079.97C1962.88,-1063.38 1959.75,-1037.88 1957.36,-1018.43"/>
<polygon fill="black" stroke="black" points="1960.82,-1017.84 1956.13,-1008.34 1953.87,-1018.69 1960.82,-1017.84"/>
</g>
<!-- l3_attention -->
<g id="node59" class="node">
<title>l3_attention</title>
<polygon fill="yellow" stroke="black" points="2146,-900 1748,-900 1748,-864 2146,-864 2146,-900"/>
<text text-anchor="middle" x="1947" y="-878.3" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention\n8×[128,2048,512]\nGPU: 8&#45;15</text>
</g>
<!-- l3_qkv&#45;&gt;l3_attention -->
<g id="edge88" class="edge">
<title>l3_qkv&#45;&gt;l3_attention</title>
<path fill="none" stroke="black" d="M1952.88,-971.97C1951.78,-955.38 1950.1,-929.88 1948.81,-910.43"/>
<polygon fill="black" stroke="black" points="1952.3,-910.09 1948.15,-900.34 1945.31,-910.55 1952.3,-910.09"/>
</g>
<!-- l3_out_proj -->
<g id="node60" class="node">
<title>l3_out_proj</title>
<polygon fill="yellow" stroke="black" points="2144,-792 1754,-792 1754,-756 2144,-756 2144,-792"/>
<text text-anchor="middle" x="1949" y="-770.3" font-family="Times,serif" font-size="14.00">Output Projections\n8×[128,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l3_attention&#45;&gt;l3_out_proj -->
<g id="edge89" class="edge">
<title>l3_attention&#45;&gt;l3_out_proj</title>
<path fill="none" stroke="black" d="M1947.32,-863.97C1947.63,-847.38 1948.12,-821.88 1948.48,-802.43"/>
<polygon fill="black" stroke="black" points="1951.98,-802.4 1948.67,-792.34 1944.98,-802.27 1951.98,-802.4"/>
</g>
<!-- l3_gather -->
<g id="node61" class="node">
<title>l3_gather</title>
<polygon fill="lightcyan" stroke="black" points="2140.86,-684 1840.42,-684 1763.14,-648 2063.58,-648 2140.86,-684"/>
<text text-anchor="middle" x="1952" y="-662.3" font-family="Times,serif" font-size="14.00">Token Gather\nGPU: 8&#45;15</text>
</g>
<!-- l3_out_proj&#45;&gt;l3_gather -->
<g id="edge90" class="edge">
<title>l3_out_proj&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M1949.48,-755.97C1949.95,-739.38 1950.67,-713.88 1951.22,-694.43"/>
<polygon fill="black" stroke="black" points="1954.72,-694.44 1951.51,-684.34 1947.73,-694.24 1954.72,-694.44"/>
</g>
<!-- l3_gather&#45;&gt;l3_attn_res -->
<g id="edge91" class="edge">
<title>l3_gather&#45;&gt;l3_attn_res</title>
<path fill="none" stroke="black" d="M1962.93,-647.97C1973.86,-630.92 1990.84,-604.46 2003.43,-584.82"/>
<polygon fill="black" stroke="black" points="2006.42,-586.65 2008.88,-576.34 2000.53,-582.87 2006.42,-586.65"/>
</g>
<!-- l3_gate -->
<g id="node63" class="node">
<title>l3_gate</title>
<polygon fill="lightcoral" stroke="black" points="2182.5,-468 1857.5,-468 1857.5,-432 2182.5,-432 2182.5,-468"/>
<text text-anchor="middle" x="2020" y="-446.3" font-family="Times,serif" font-size="14.00">Gate Network\n[1024,2048,16]\nGPU: 8&#45;15</text>
</g>
<!-- l3_attn_res&#45;&gt;l3_gate -->
<g id="edge93" class="edge">
<title>l3_attn_res&#45;&gt;l3_gate</title>
<path fill="none" stroke="black" d="M2020,-539.97C2020,-523.38 2020,-497.88 2020,-478.43"/>
<polygon fill="black" stroke="black" points="2023.5,-478.34 2020,-468.34 2016.5,-478.34 2023.5,-478.34"/>
</g>
<!-- l3_expert_route -->
<g id="node64" class="node">
<title>l3_expert_route</title>
<polygon fill="lightcyan" stroke="black" points="1544.14,-468 1353.02,-468 1303.86,-432 1494.98,-432 1544.14,-468"/>
<text text-anchor="middle" x="1424" y="-446.3" font-family="Times,serif" font-size="14.00">Expert Routing</text>
</g>
<!-- l3_attn_res&#45;&gt;l3_expert_route -->
<g id="edge94" class="edge">
<title>l3_attn_res&#45;&gt;l3_expert_route</title>
<path fill="none" stroke="black" d="M1924.24,-539.97C1816.44,-520.8 1641.78,-489.73 1529.96,-469.85"/>
<polygon fill="black" stroke="black" points="1530.47,-466.38 1520.01,-468.08 1529.25,-473.27 1530.47,-466.38"/>
</g>
<!-- l3_moe_res -->
<g id="node74" class="node">
<title>l3_moe_res</title>
<polygon fill="orange" stroke="black" points="2035.5,-144 1784.5,-144 1784.5,-108 2035.5,-108 2035.5,-144"/>
<text text-anchor="middle" x="1910" y="-122.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]</text>
</g>
<!-- l3_attn_res&#45;&gt;l3_moe_res -->
<g id="edge112" class="edge">
<title>l3_attn_res&#45;&gt;l3_moe_res</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M2145.71,-546.97C2332.18,-527.06 2649.09,-470.98 2541,-324 2479.19,-239.95 2186.89,-175.92 2022.67,-145.87"/>
<polygon fill="blue" stroke="blue" points="2023,-142.37 2012.53,-144.02 2021.75,-149.25 2023,-142.37"/>
</g>
<!-- l3_exp0 -->
<g id="node65" class="node">
<title>l3_exp0</title>
<polygon fill="lightpink" stroke="black" points="298,-360 24,-360 24,-324 298,-324 298,-360"/>
<text text-anchor="middle" x="161" y="-338.3" font-family="Times,serif" font-size="14.00">Expert 0\n[128,2048,4096]\nGPU: 8</text>
</g>
<!-- l3_expert_route&#45;&gt;l3_exp0 -->
<g id="edge95" class="edge">
<title>l3_expert_route&#45;&gt;l3_exp0</title>
<path fill="none" stroke="black" d="M1316.56,-441.41C1118.54,-427.2 682.7,-394.83 316,-360 313.47,-359.76 310.91,-359.51 308.33,-359.26"/>
<polygon fill="black" stroke="black" points="308.61,-355.77 298.32,-358.28 307.93,-362.74 308.61,-355.77"/>
</g>
<!-- l3_exp1 -->
<g id="node66" class="node">
<title>l3_exp1</title>
<polygon fill="lightpink" stroke="black" points="608,-360 334,-360 334,-324 608,-324 608,-360"/>
<text text-anchor="middle" x="471" y="-338.3" font-family="Times,serif" font-size="14.00">Expert 1\n[128,2048,4096]\nGPU: 9</text>
</g>
<!-- l3_expert_route&#45;&gt;l3_exp1 -->
<g id="edge97" class="edge">
<title>l3_expert_route&#45;&gt;l3_exp1</title>
<path fill="none" stroke="black" d="M1309.52,-436.27C1136.55,-417.03 808.63,-380.55 618.15,-359.37"/>
<polygon fill="black" stroke="black" points="618.39,-355.87 608.06,-358.24 617.61,-362.83 618.39,-355.87"/>
</g>
<!-- l3_exp2 -->
<g id="node67" class="node">
<title>l3_exp2</title>
<polygon fill="lightpink" stroke="black" points="927.5,-360 644.5,-360 644.5,-324 927.5,-324 927.5,-360"/>
<text text-anchor="middle" x="786" y="-338.3" font-family="Times,serif" font-size="14.00">Expert 2\n[128,2048,4096]\nGPU: 10</text>
</g>
<!-- l3_expert_route&#45;&gt;l3_exp2 -->
<g id="edge99" class="edge">
<title>l3_expert_route&#45;&gt;l3_exp2</title>
<path fill="none" stroke="black" d="M1321.49,-431.97C1205.78,-412.74 1018.1,-381.56 898.44,-361.68"/>
<polygon fill="black" stroke="black" points="898.95,-358.22 888.52,-360.03 897.81,-365.12 898.95,-358.22"/>
</g>
<!-- l3_exp3 -->
<g id="node68" class="node">
<title>l3_exp3</title>
<polygon fill="lightpink" stroke="black" points="1246.5,-360 963.5,-360 963.5,-324 1246.5,-324 1246.5,-360"/>
<text text-anchor="middle" x="1105" y="-338.3" font-family="Times,serif" font-size="14.00">Expert 3\n[128,2048,4096]\nGPU: 11</text>
</g>
<!-- l3_expert_route&#45;&gt;l3_exp3 -->
<g id="edge101" class="edge">
<title>l3_expert_route&#45;&gt;l3_exp3</title>
<path fill="none" stroke="black" d="M1372.75,-431.97C1316.44,-413.26 1226.06,-383.23 1166.11,-363.31"/>
<polygon fill="black" stroke="black" points="1166.98,-359.91 1156.39,-360.08 1164.78,-366.55 1166.98,-359.91"/>
</g>
<!-- l3_exp4 -->
<g id="node69" class="node">
<title>l3_exp4</title>
<polygon fill="lightpink" stroke="black" points="1565.5,-360 1282.5,-360 1282.5,-324 1565.5,-324 1565.5,-360"/>
<text text-anchor="middle" x="1424" y="-338.3" font-family="Times,serif" font-size="14.00">Expert 4\n[128,2048,4096]\nGPU: 12</text>
</g>
<!-- l3_expert_route&#45;&gt;l3_exp4 -->
<g id="edge103" class="edge">
<title>l3_expert_route&#45;&gt;l3_exp4</title>
<path fill="none" stroke="black" d="M1424,-431.97C1424,-415.38 1424,-389.88 1424,-370.43"/>
<polygon fill="black" stroke="black" points="1427.5,-370.34 1424,-360.34 1420.5,-370.34 1427.5,-370.34"/>
</g>
<!-- l3_exp5 -->
<g id="node70" class="node">
<title>l3_exp5</title>
<polygon fill="lightpink" stroke="black" points="1884.5,-360 1601.5,-360 1601.5,-324 1884.5,-324 1884.5,-360"/>
<text text-anchor="middle" x="1743" y="-338.3" font-family="Times,serif" font-size="14.00">Expert 5\n[128,2048,4096]\nGPU: 13</text>
</g>
<!-- l3_expert_route&#45;&gt;l3_exp5 -->
<g id="edge105" class="edge">
<title>l3_expert_route&#45;&gt;l3_exp5</title>
<path fill="none" stroke="black" d="M1475.25,-431.97C1531.56,-413.26 1621.94,-383.23 1681.89,-363.31"/>
<polygon fill="black" stroke="black" points="1683.22,-366.55 1691.61,-360.08 1681.02,-359.91 1683.22,-366.55"/>
</g>
<!-- l3_exp6 -->
<g id="node71" class="node">
<title>l3_exp6</title>
<polygon fill="lightpink" stroke="black" points="2203.5,-360 1920.5,-360 1920.5,-324 2203.5,-324 2203.5,-360"/>
<text text-anchor="middle" x="2062" y="-338.3" font-family="Times,serif" font-size="14.00">Expert 6\n[128,2048,4096]\nGPU: 14</text>
</g>
<!-- l3_expert_route&#45;&gt;l3_exp6 -->
<g id="edge107" class="edge">
<title>l3_expert_route&#45;&gt;l3_exp6</title>
<path fill="none" stroke="black" d="M1500.96,-436.21C1612.72,-417.65 1820.63,-383.1 1949.56,-361.68"/>
<polygon fill="black" stroke="black" points="1950.19,-365.13 1959.48,-360.03 1949.04,-358.22 1950.19,-365.13"/>
</g>
<!-- l3_exp7 -->
<g id="node72" class="node">
<title>l3_exp7</title>
<polygon fill="lightpink" stroke="black" points="2522.5,-360 2239.5,-360 2239.5,-324 2522.5,-324 2522.5,-360"/>
<text text-anchor="middle" x="2381" y="-338.3" font-family="Times,serif" font-size="14.00">Expert 7\n[128,2048,4096]\nGPU: 15</text>
</g>
<!-- l3_expert_route&#45;&gt;l3_exp7 -->
<g id="edge109" class="edge">
<title>l3_expert_route&#45;&gt;l3_exp7</title>
<path fill="none" stroke="black" d="M1506.01,-439.92C1666.58,-422.13 2024.59,-382.48 2229.43,-359.79"/>
<polygon fill="black" stroke="black" points="2229.82,-363.27 2239.37,-358.69 2229.05,-356.31 2229.82,-363.27"/>
</g>
<!-- l3_expert_agg -->
<g id="node73" class="node">
<title>l3_expert_agg</title>
<polygon fill="lightcyan" stroke="black" points="1574.63,-252 1335.01,-252 1273.37,-216 1512.99,-216 1574.63,-252"/>
<text text-anchor="middle" x="1424" y="-230.3" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
</g>
<!-- l3_exp0&#45;&gt;l3_expert_agg -->
<g id="edge96" class="edge">
<title>l3_exp0&#45;&gt;l3_expert_agg</title>
<path fill="none" stroke="black" d="M298.32,-325.72C304.29,-325.13 310.21,-324.55 316,-324 677.79,-289.64 1106.89,-257.67 1308.48,-243.17"/>
<polygon fill="black" stroke="black" points="1308.77,-246.66 1318.5,-242.45 1308.27,-239.67 1308.77,-246.66"/>
</g>
<!-- l3_exp1&#45;&gt;l3_expert_agg -->
<g id="edge98" class="edge">
<title>l3_exp1&#45;&gt;l3_expert_agg</title>
<path fill="none" stroke="black" d="M608.05,-325.76C798.66,-304.56 1140,-266.59 1314.6,-247.17"/>
<polygon fill="black" stroke="black" points="1315.02,-250.64 1324.57,-246.06 1314.25,-243.69 1315.02,-250.64"/>
</g>
<!-- l3_exp2&#45;&gt;l3_expert_agg -->
<g id="edge100" class="edge">
<title>l3_exp2&#45;&gt;l3_expert_agg</title>
<path fill="none" stroke="black" d="M888.51,-323.97C1007.53,-304.19 1202.69,-271.77 1321.64,-252.01"/>
<polygon fill="black" stroke="black" points="1322.56,-255.4 1331.85,-250.31 1321.41,-248.5 1322.56,-255.4"/>
</g>
<!-- l3_exp3&#45;&gt;l3_expert_agg -->
<g id="edge102" class="edge">
<title>l3_exp3&#45;&gt;l3_expert_agg</title>
<path fill="none" stroke="black" d="M1156.25,-323.97C1212.56,-305.26 1302.94,-275.23 1362.89,-255.31"/>
<polygon fill="black" stroke="black" points="1364.22,-258.55 1372.61,-252.08 1362.02,-251.91 1364.22,-258.55"/>
</g>
<!-- l3_exp4&#45;&gt;l3_expert_agg -->
<g id="edge104" class="edge">
<title>l3_exp4&#45;&gt;l3_expert_agg</title>
<path fill="none" stroke="black" d="M1424,-323.97C1424,-307.38 1424,-281.88 1424,-262.43"/>
<polygon fill="black" stroke="black" points="1427.5,-262.34 1424,-252.34 1420.5,-262.34 1427.5,-262.34"/>
</g>
<!-- l3_exp5&#45;&gt;l3_expert_agg -->
<g id="edge106" class="edge">
<title>l3_exp5&#45;&gt;l3_expert_agg</title>
<path fill="none" stroke="black" d="M1691.75,-323.97C1635.44,-305.26 1545.06,-275.23 1485.11,-255.31"/>
<polygon fill="black" stroke="black" points="1485.98,-251.91 1475.39,-252.08 1483.78,-258.55 1485.98,-251.91"/>
</g>
<!-- l3_exp6&#45;&gt;l3_expert_agg -->
<g id="edge108" class="edge">
<title>l3_exp6&#45;&gt;l3_expert_agg</title>
<path fill="none" stroke="black" d="M1959.49,-323.97C1843.78,-304.74 1656.1,-273.56 1536.44,-253.68"/>
<polygon fill="black" stroke="black" points="1536.95,-250.22 1526.52,-252.03 1535.81,-257.12 1536.95,-250.22"/>
</g>
<!-- l3_exp7&#45;&gt;l3_expert_agg -->
<g id="edge110" class="edge">
<title>l3_exp7&#45;&gt;l3_expert_agg</title>
<path fill="none" stroke="black" d="M2239.28,-325.3C2064.29,-305.92 1767.42,-273.04 1584.29,-252.75"/>
<polygon fill="black" stroke="black" points="1584.63,-249.27 1574.3,-251.65 1583.86,-256.23 1584.63,-249.27"/>
</g>
<!-- l3_expert_agg&#45;&gt;l3_moe_res -->
<g id="edge111" class="edge">
<title>l3_expert_agg&#45;&gt;l3_moe_res</title>
<path fill="none" stroke="black" d="M1502.08,-215.97C1589.37,-196.93 1730.41,-166.17 1821.66,-146.27"/>
<polygon fill="black" stroke="black" points="1822.68,-149.63 1831.71,-144.08 1821.19,-142.79 1822.68,-149.63"/>
</g>
<!-- l3_moe_res&#45;&gt;output -->
<g id="edge113" class="edge">
<title>l3_moe_res&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1910,-107.97C1910,-91.38 1910,-65.88 1910,-46.43"/>
<polygon fill="black" stroke="black" points="1913.5,-46.34 1910,-36.34 1906.5,-46.34 1913.5,-46.34"/>
</g>
<!-- stage0_to_stage1&#45;&gt;l2_token_split -->
<g id="edge57" class="edge">
<title>stage0_to_stage1&#45;&gt;l2_token_split</title>
<path fill="none" stroke="black" d="M2101.51,-2281.97C2057.65,-2263.52 1987.6,-2234.05 1940.25,-2214.14"/>
<polygon fill="black" stroke="black" points="1941.38,-2210.82 1930.81,-2210.16 1938.67,-2217.27 1941.38,-2210.82"/>
</g>
<!-- stage0_to_stage1&#45;&gt;l2_attn_res -->
<g id="edge58" class="edge">
<title>stage0_to_stage1&#45;&gt;l2_attn_res</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M2132.2,-2281.8C2124,-2245.46 2124,-2158.19 2124,-2085 2124,-2085 2124,-2085 2124,-1867 2124,-1805.38 2104.84,-1788.15 2064,-1742 2038.78,-1713.49 2002.3,-1690.61 1975.56,-1675.18"/>
<polygon fill="blue" stroke="blue" points="1976.96,-1671.95 1966.54,-1670.04 1973.5,-1678.04 1976.96,-1671.95"/>
</g>
<!-- stage0_to_stage1&#45;&gt;l2_attn_res -->
<g id="edge64" class="edge">
<title>stage0_to_stage1&#45;&gt;l2_attn_res</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M2151.8,-2281.8C2160,-2245.46 2160,-2158.19 2160,-2085 2160,-2085 2160,-2085 2160,-1867 2160,-1805.38 2140.84,-1788.15 2100,-1742 2074.33,-1713 2037.02,-1689.81 2004.87,-1674.38"/>
<polygon fill="blue" stroke="blue" points="2006.06,-1671.08 1995.52,-1670.04 2003.11,-1677.43 2006.06,-1671.08"/>
</g>
</g>
</svg>
