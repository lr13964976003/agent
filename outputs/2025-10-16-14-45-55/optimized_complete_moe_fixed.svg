<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: optimized_complete_moe Pages: 1 -->
<svg width="6060pt" height="4634pt"
 viewBox="0.00 0.00 6060.00 4634.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 4630)">
<title>optimized_complete_moe</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-4630 6056,-4630 6056,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_layer_0</title>
<polygon fill="none" stroke="red" stroke-dasharray="5,2" points="8,-3489 8,-4545 3498,-4545 3498,-3489 8,-3489"/>
<text text-anchor="middle" x="1753" y="-4529.8" font-family="Times,serif" font-size="14.00">Layer 0 (GPUs 0&#45;7)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_layer_1</title>
<polygon fill="none" stroke="red" stroke-dasharray="5,2" points="723,-2396 723,-3452 4213,-3452 4213,-2396 723,-2396"/>
<text text-anchor="middle" x="2468" y="-3436.8" font-family="Times,serif" font-size="14.00">Layer 1 (GPUs 0&#45;7)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_layer_2</title>
<polygon fill="none" stroke="blue" stroke-dasharray="5,2" points="1771,-1194 1771,-2250 5316,-2250 5316,-1194 1771,-1194"/>
<text text-anchor="middle" x="3543.5" y="-2234.8" font-family="Times,serif" font-size="14.00">Layer 2 (GPUs 8&#45;15)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_layer_3</title>
<polygon fill="none" stroke="blue" stroke-dasharray="5,2" points="2499,-101 2499,-1157 6044,-1157 6044,-101 2499,-101"/>
<text text-anchor="middle" x="4271.5" y="-1141.8" font-family="Times,serif" font-size="14.00">Layer 3 (GPUs 8&#45;15)</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightgreen" stroke="black" cx="1894" cy="-4608" rx="127.28" ry="18"/>
<text text-anchor="middle" x="1894" y="-4604.3" font-family="Times,serif" font-size="14.00">Input\n[1024,2048,4096]</text>
</g>
<!-- l0_token_split -->
<g id="node3" class="node">
<title>l0_token_split</title>
<polygon fill="lightcyan" stroke="black" points="1974.45,-4514 1240.39,-4514 1051.55,-4478 1785.61,-4478 1974.45,-4514"/>
<text text-anchor="middle" x="1513" y="-4492.3" font-family="Times,serif" font-size="14.00">Token Split\n[1024,2048,4096]\n→ 8×[128,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- input&#45;&gt;l0_token_split -->
<g id="edge1" class="edge">
<title>input&#45;&gt;l0_token_split</title>
<path fill="none" stroke="black" d="M1840.62,-4591.59C1772.91,-4572.04 1656.01,-4538.29 1581.7,-4516.84"/>
<polygon fill="black" stroke="black" points="1582.54,-4513.43 1571.96,-4514.02 1580.59,-4520.16 1582.54,-4513.43"/>
</g>
<!-- l0_attn_res -->
<g id="node8" class="node">
<title>l0_attn_res</title>
<polygon fill="orange" stroke="black" points="2061,-3969 1733,-3969 1733,-3933 2061,-3933 2061,-3969"/>
<text text-anchor="middle" x="1897" y="-3947.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- input&#45;&gt;l0_attn_res -->
<g id="edge7" class="edge">
<title>input&#45;&gt;l0_attn_res</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M1943.66,-4591.4C1984.61,-4575.08 2036,-4545.02 2036,-4497 2036,-4497 2036,-4497 2036,-4059 2036,-4017.59 1996.78,-3989.98 1960.01,-3973.2"/>
<polygon fill="red" stroke="red" points="1961.31,-3969.94 1950.74,-3969.16 1958.51,-3976.36 1961.31,-3969.94"/>
<text text-anchor="middle" x="2067" y="-4274.3" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- output -->
<g id="node2" class="node">
<title>output</title>
<ellipse fill="lightgreen" stroke="black" cx="5139" cy="-18" rx="135.38" ry="18"/>
<text text-anchor="middle" x="5139" y="-14.3" font-family="Times,serif" font-size="14.00">Output\n[1024,2048,4096]</text>
</g>
<!-- l0_qkv_proj -->
<g id="node4" class="node">
<title>l0_qkv_proj</title>
<polygon fill="yellow" stroke="black" points="1748.5,-4405 1273.5,-4405 1273.5,-4369 1748.5,-4369 1748.5,-4405"/>
<text text-anchor="middle" x="1511" y="-4383.3" font-family="Times,serif" font-size="14.00">QKV Projections\n8×[128,2048,4096]\n×[4096,1536]\nGPU: 0&#45;7</text>
</g>
<!-- l0_token_split&#45;&gt;l0_qkv_proj -->
<g id="edge2" class="edge">
<title>l0_token_split&#45;&gt;l0_qkv_proj</title>
<path fill="none" stroke="black" d="M1512.68,-4477.81C1512.36,-4460.96 1511.88,-4435.02 1511.51,-4415.34"/>
<polygon fill="black" stroke="black" points="1515.01,-4415.08 1511.32,-4405.15 1508.01,-4415.21 1515.01,-4415.08"/>
</g>
<!-- l0_attention -->
<g id="node5" class="node">
<title>l0_attention</title>
<polygon fill="yellow" stroke="black" points="1786,-4296 1228,-4296 1228,-4260 1786,-4260 1786,-4296"/>
<text text-anchor="middle" x="1507" y="-4274.3" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention\n8×[128,2048,1536]\n→ 8×[128,2048,512]\nGPU: 0&#45;7</text>
</g>
<!-- l0_qkv_proj&#45;&gt;l0_attention -->
<g id="edge3" class="edge">
<title>l0_qkv_proj&#45;&gt;l0_attention</title>
<path fill="none" stroke="black" d="M1510.36,-4368.81C1509.73,-4351.96 1508.76,-4326.02 1508.02,-4306.34"/>
<polygon fill="black" stroke="black" points="1511.51,-4306.01 1507.64,-4296.15 1504.52,-4306.27 1511.51,-4306.01"/>
</g>
<!-- l0_out_proj -->
<g id="node6" class="node">
<title>l0_out_proj</title>
<polygon fill="yellow" stroke="black" points="1744,-4187 1268,-4187 1268,-4151 1744,-4151 1744,-4187"/>
<text text-anchor="middle" x="1506" y="-4165.3" font-family="Times,serif" font-size="14.00">Output Projections\n8×[128,2048,512]\n×[512,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l0_attention&#45;&gt;l0_out_proj -->
<g id="edge4" class="edge">
<title>l0_attention&#45;&gt;l0_out_proj</title>
<path fill="none" stroke="black" d="M1506.84,-4259.81C1506.68,-4242.96 1506.44,-4217.02 1506.26,-4197.34"/>
<polygon fill="black" stroke="black" points="1509.75,-4197.12 1506.16,-4187.15 1502.75,-4197.18 1509.75,-4197.12"/>
</g>
<!-- l0_gather -->
<g id="node7" class="node">
<title>l0_gather</title>
<polygon fill="lightcyan" stroke="black" points="1981.44,-4078 1223.53,-4078 1028.56,-4042 1786.47,-4042 1981.44,-4078"/>
<text text-anchor="middle" x="1505" y="-4056.3" font-family="Times,serif" font-size="14.00">Token Gather\n8×[128,2048,4096]\n→ [1024,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l0_out_proj&#45;&gt;l0_gather -->
<g id="edge5" class="edge">
<title>l0_out_proj&#45;&gt;l0_gather</title>
<path fill="none" stroke="black" d="M1505.84,-4150.81C1505.68,-4133.96 1505.44,-4108.02 1505.26,-4088.34"/>
<polygon fill="black" stroke="black" points="1508.75,-4088.12 1505.16,-4078.15 1501.75,-4088.18 1508.75,-4088.12"/>
</g>
<!-- l0_gather&#45;&gt;l0_attn_res -->
<g id="edge6" class="edge">
<title>l0_gather&#45;&gt;l0_attn_res</title>
<path fill="none" stroke="black" d="M1567.55,-4041.93C1637.68,-4022.78 1751.21,-3991.79 1824.99,-3971.66"/>
<polygon fill="black" stroke="black" points="1825.95,-3975.02 1834.68,-3969.01 1824.11,-3968.27 1825.95,-3975.02"/>
</g>
<!-- l0_gate -->
<g id="node9" class="node">
<title>l0_gate</title>
<polygon fill="lightcoral" stroke="black" points="1385,-3860 957,-3860 957,-3824 1385,-3824 1385,-3860"/>
<text text-anchor="middle" x="1171" y="-3838.3" font-family="Times,serif" font-size="14.00">Gate Network\n[1024,2048,4096]\n×[4096,16]\nGPU: 0&#45;7</text>
</g>
<!-- l0_attn_res&#45;&gt;l0_gate -->
<g id="edge8" class="edge">
<title>l0_attn_res&#45;&gt;l0_gate</title>
<path fill="none" stroke="black" d="M1781.56,-3932.99C1649.25,-3913.49 1433.11,-3881.63 1296.66,-3861.52"/>
<polygon fill="black" stroke="black" points="1296.97,-3858.03 1286.56,-3860.03 1295.95,-3864.95 1296.97,-3858.03"/>
</g>
<!-- l0_router -->
<g id="node10" class="node">
<title>l0_router</title>
<polygon fill="lightcyan" stroke="black" points="2372.53,-3860 1616.07,-3860 1421.47,-3824 2177.93,-3824 2372.53,-3860"/>
<text text-anchor="middle" x="1897" y="-3838.3" font-family="Times,serif" font-size="14.00">Token Router\n[1024,2048,4096]\n→ 8×[128,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l0_attn_res&#45;&gt;l0_router -->
<g id="edge9" class="edge">
<title>l0_attn_res&#45;&gt;l0_router</title>
<path fill="none" stroke="black" d="M1897,-3932.81C1897,-3915.96 1897,-3890.02 1897,-3870.34"/>
<polygon fill="black" stroke="black" points="1900.5,-3870.15 1897,-3860.15 1893.5,-3870.15 1900.5,-3870.15"/>
</g>
<!-- l0_moe_res -->
<g id="node20" class="node">
<title>l0_moe_res</title>
<polygon fill="orange" stroke="black" points="2776,-3533 2448,-3533 2448,-3497 2776,-3497 2776,-3533"/>
<text text-anchor="middle" x="2612" y="-3511.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l0_attn_res&#45;&gt;l0_moe_res -->
<g id="edge27" class="edge">
<title>l0_attn_res&#45;&gt;l0_moe_res</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M2061.21,-3946.95C2456.4,-3938.53 3428,-3910.92 3428,-3843 3428,-3843 3428,-3843 3428,-3623 3428,-3558.82 3026.06,-3532.02 2786.37,-3521.75"/>
<polygon fill="red" stroke="red" points="2786.29,-3518.24 2776.15,-3521.32 2785.99,-3525.24 2786.29,-3518.24"/>
<text text-anchor="middle" x="3459" y="-3729.3" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- l0_exp0 -->
<g id="node11" class="node">
<title>l0_exp0</title>
<polygon fill="lightpink" stroke="black" points="402,-3751 16,-3751 16,-3715 402,-3715 402,-3751"/>
<text text-anchor="middle" x="209" y="-3729.3" font-family="Times,serif" font-size="14.00">Expert 0\n[128,2048,4096]\n×[4096,4096]\nGPU: 0</text>
</g>
<!-- l0_router&#45;&gt;l0_exp0 -->
<g id="edge10" class="edge">
<title>l0_router&#45;&gt;l0_exp0</title>
<path fill="none" stroke="black" d="M1588.89,-3823.98C1290.02,-3807.06 823.77,-3779.56 420,-3751 417.43,-3750.82 414.85,-3750.63 412.25,-3750.45"/>
<polygon fill="black" stroke="black" points="412.39,-3746.95 402.16,-3749.71 411.89,-3753.93 412.39,-3746.95"/>
</g>
<!-- l0_exp1 -->
<g id="node12" class="node">
<title>l0_exp1</title>
<polygon fill="lightpink" stroke="black" points="824,-3751 438,-3751 438,-3715 824,-3715 824,-3751"/>
<text text-anchor="middle" x="631" y="-3729.3" font-family="Times,serif" font-size="14.00">Expert 1\n[128,2048,4096]\n×[4096,4096]\nGPU: 1</text>
</g>
<!-- l0_router&#45;&gt;l0_exp1 -->
<g id="edge12" class="edge">
<title>l0_router&#45;&gt;l0_exp1</title>
<path fill="none" stroke="black" d="M1695.7,-3823.99C1459.79,-3804.05 1071.09,-3771.2 834.32,-3751.18"/>
<polygon fill="black" stroke="black" points="834.47,-3747.68 824.21,-3750.33 833.88,-3754.66 834.47,-3747.68"/>
</g>
<!-- l0_exp2 -->
<g id="node13" class="node">
<title>l0_exp2</title>
<polygon fill="lightpink" stroke="black" points="1246,-3751 860,-3751 860,-3715 1246,-3715 1246,-3751"/>
<text text-anchor="middle" x="1053" y="-3729.3" font-family="Times,serif" font-size="14.00">Expert 2\n[128,2048,4096]\n×[4096,4096]\nGPU: 2</text>
</g>
<!-- l0_router&#45;&gt;l0_exp2 -->
<g id="edge14" class="edge">
<title>l0_router&#45;&gt;l0_exp2</title>
<path fill="none" stroke="black" d="M1762.8,-3823.99C1608.52,-3804.43 1356.21,-3772.44 1197.65,-3752.34"/>
<polygon fill="black" stroke="black" points="1197.71,-3748.82 1187.35,-3751.03 1196.83,-3755.76 1197.71,-3748.82"/>
</g>
<!-- l0_exp3 -->
<g id="node14" class="node">
<title>l0_exp3</title>
<polygon fill="lightpink" stroke="black" points="1668,-3751 1282,-3751 1282,-3715 1668,-3715 1668,-3751"/>
<text text-anchor="middle" x="1475" y="-3729.3" font-family="Times,serif" font-size="14.00">Expert 3\n[128,2048,4096]\n×[4096,4096]\nGPU: 3</text>
</g>
<!-- l0_router&#45;&gt;l0_exp3 -->
<g id="edge16" class="edge">
<title>l0_router&#45;&gt;l0_exp3</title>
<path fill="none" stroke="black" d="M1829.67,-3823.93C1754.02,-3804.75 1631.45,-3773.67 1552.04,-3753.53"/>
<polygon fill="black" stroke="black" points="1552.65,-3750.08 1542.09,-3751.01 1550.93,-3756.86 1552.65,-3750.08"/>
</g>
<!-- l0_exp4 -->
<g id="node15" class="node">
<title>l0_exp4</title>
<polygon fill="lightpink" stroke="black" points="2090,-3751 1704,-3751 1704,-3715 2090,-3715 2090,-3751"/>
<text text-anchor="middle" x="1897" y="-3729.3" font-family="Times,serif" font-size="14.00">Expert 4\n[128,2048,4096]\n×[4096,4096]\nGPU: 4</text>
</g>
<!-- l0_router&#45;&gt;l0_exp4 -->
<g id="edge18" class="edge">
<title>l0_router&#45;&gt;l0_exp4</title>
<path fill="none" stroke="black" d="M1897,-3823.81C1897,-3806.96 1897,-3781.02 1897,-3761.34"/>
<polygon fill="black" stroke="black" points="1900.5,-3761.15 1897,-3751.15 1893.5,-3761.15 1900.5,-3761.15"/>
</g>
<!-- l0_exp5 -->
<g id="node16" class="node">
<title>l0_exp5</title>
<polygon fill="lightpink" stroke="black" points="2512,-3751 2126,-3751 2126,-3715 2512,-3715 2512,-3751"/>
<text text-anchor="middle" x="2319" y="-3729.3" font-family="Times,serif" font-size="14.00">Expert 5\n[128,2048,4096]\n×[4096,4096]\nGPU: 5</text>
</g>
<!-- l0_router&#45;&gt;l0_exp5 -->
<g id="edge20" class="edge">
<title>l0_router&#45;&gt;l0_exp5</title>
<path fill="none" stroke="black" d="M1964.33,-3823.93C2039.98,-3804.75 2162.55,-3773.67 2241.96,-3753.53"/>
<polygon fill="black" stroke="black" points="2243.07,-3756.86 2251.91,-3751.01 2241.35,-3750.08 2243.07,-3756.86"/>
</g>
<!-- l0_exp6 -->
<g id="node17" class="node">
<title>l0_exp6</title>
<polygon fill="lightpink" stroke="black" points="2934,-3751 2548,-3751 2548,-3715 2934,-3715 2934,-3751"/>
<text text-anchor="middle" x="2741" y="-3729.3" font-family="Times,serif" font-size="14.00">Expert 6\n[128,2048,4096]\n×[4096,4096]\nGPU: 6</text>
</g>
<!-- l0_router&#45;&gt;l0_exp6 -->
<g id="edge22" class="edge">
<title>l0_router&#45;&gt;l0_exp6</title>
<path fill="none" stroke="black" d="M2031.2,-3823.99C2185.48,-3804.43 2437.79,-3772.44 2596.35,-3752.34"/>
<polygon fill="black" stroke="black" points="2597.17,-3755.76 2606.65,-3751.03 2596.29,-3748.82 2597.17,-3755.76"/>
</g>
<!-- l0_exp7 -->
<g id="node18" class="node">
<title>l0_exp7</title>
<polygon fill="lightpink" stroke="black" points="3356,-3751 2970,-3751 2970,-3715 3356,-3715 3356,-3751"/>
<text text-anchor="middle" x="3163" y="-3729.3" font-family="Times,serif" font-size="14.00">Expert 7\n[128,2048,4096]\n×[4096,4096]\nGPU: 7</text>
</g>
<!-- l0_router&#45;&gt;l0_exp7 -->
<g id="edge24" class="edge">
<title>l0_router&#45;&gt;l0_exp7</title>
<path fill="none" stroke="black" d="M2098.3,-3823.99C2334.21,-3804.05 2722.91,-3771.2 2959.68,-3751.18"/>
<polygon fill="black" stroke="black" points="2960.12,-3754.66 2969.79,-3750.33 2959.53,-3747.68 2960.12,-3754.66"/>
</g>
<!-- l0_agg -->
<g id="node19" class="node">
<title>l0_agg</title>
<polygon fill="lightcyan" stroke="black" points="2416.2,-3642 1590.27,-3642 1377.8,-3606 2203.73,-3606 2416.2,-3642"/>
<text text-anchor="middle" x="1897" y="-3620.3" font-family="Times,serif" font-size="14.00">Expert Aggregation\n8×[128,2048,4096]\n→ [1024,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l0_exp0&#45;&gt;l0_agg -->
<g id="edge11" class="edge">
<title>l0_exp0&#45;&gt;l0_agg</title>
<path fill="none" stroke="black" d="M402.16,-3716.29C408.18,-3715.84 414.13,-3715.41 420,-3715 819.71,-3686.72 1280.65,-3659.49 1579.83,-3642.53"/>
<polygon fill="black" stroke="black" points="1580.17,-3646.02 1589.96,-3641.96 1579.78,-3639.03 1580.17,-3646.02"/>
</g>
<!-- l0_exp1&#45;&gt;l0_agg -->
<g id="edge13" class="edge">
<title>l0_exp1&#45;&gt;l0_agg</title>
<path fill="none" stroke="black" d="M824.31,-3715.66C1056.66,-3696.02 1445.2,-3663.19 1685.4,-3642.88"/>
<polygon fill="black" stroke="black" points="1685.99,-3646.35 1695.66,-3642.02 1685.4,-3639.37 1685.99,-3646.35"/>
</g>
<!-- l0_exp2&#45;&gt;l0_agg -->
<g id="edge15" class="edge">
<title>l0_exp2&#45;&gt;l0_agg</title>
<path fill="none" stroke="black" d="M1187.2,-3714.99C1341.48,-3695.43 1593.79,-3663.44 1752.35,-3643.34"/>
<polygon fill="black" stroke="black" points="1753.17,-3646.76 1762.65,-3642.03 1752.29,-3639.82 1753.17,-3646.76"/>
</g>
<!-- l0_exp3&#45;&gt;l0_agg -->
<g id="edge17" class="edge">
<title>l0_exp3&#45;&gt;l0_agg</title>
<path fill="none" stroke="black" d="M1542.33,-3714.93C1617.98,-3695.75 1740.55,-3664.67 1819.96,-3644.53"/>
<polygon fill="black" stroke="black" points="1821.07,-3647.86 1829.91,-3642.01 1819.35,-3641.08 1821.07,-3647.86"/>
</g>
<!-- l0_exp4&#45;&gt;l0_agg -->
<g id="edge19" class="edge">
<title>l0_exp4&#45;&gt;l0_agg</title>
<path fill="none" stroke="black" d="M1897,-3714.81C1897,-3697.96 1897,-3672.02 1897,-3652.34"/>
<polygon fill="black" stroke="black" points="1900.5,-3652.15 1897,-3642.15 1893.5,-3652.15 1900.5,-3652.15"/>
</g>
<!-- l0_exp5&#45;&gt;l0_agg -->
<g id="edge21" class="edge">
<title>l0_exp5&#45;&gt;l0_agg</title>
<path fill="none" stroke="black" d="M2251.67,-3714.93C2176.02,-3695.75 2053.45,-3664.67 1974.04,-3644.53"/>
<polygon fill="black" stroke="black" points="1974.65,-3641.08 1964.09,-3642.01 1972.93,-3647.86 1974.65,-3641.08"/>
</g>
<!-- l0_exp6&#45;&gt;l0_agg -->
<g id="edge23" class="edge">
<title>l0_exp6&#45;&gt;l0_agg</title>
<path fill="none" stroke="black" d="M2606.8,-3714.99C2452.52,-3695.43 2200.21,-3663.44 2041.65,-3643.34"/>
<polygon fill="black" stroke="black" points="2041.71,-3639.82 2031.35,-3642.03 2040.83,-3646.76 2041.71,-3639.82"/>
</g>
<!-- l0_exp7&#45;&gt;l0_agg -->
<g id="edge25" class="edge">
<title>l0_exp7&#45;&gt;l0_agg</title>
<path fill="none" stroke="black" d="M2969.69,-3715.66C2737.34,-3696.02 2348.8,-3663.19 2108.6,-3642.88"/>
<polygon fill="black" stroke="black" points="2108.6,-3639.37 2098.34,-3642.02 2108.01,-3646.35 2108.6,-3639.37"/>
</g>
<!-- l0_agg&#45;&gt;l0_moe_res -->
<g id="edge26" class="edge">
<title>l0_agg&#45;&gt;l0_moe_res</title>
<path fill="none" stroke="black" d="M2010.69,-3605.99C2141,-3586.49 2353.86,-3554.63 2488.25,-3534.52"/>
<polygon fill="black" stroke="black" points="2488.82,-3537.97 2498.19,-3533.03 2487.78,-3531.05 2488.82,-3537.97"/>
</g>
<!-- l1_token_split -->
<g id="node21" class="node">
<title>l1_token_split</title>
<polygon fill="lightcyan" stroke="black" points="2550.45,-3421 1816.39,-3421 1627.55,-3385 2361.61,-3385 2550.45,-3421"/>
<text text-anchor="middle" x="2089" y="-3399.3" font-family="Times,serif" font-size="14.00">Token Split\n[1024,2048,4096]\n→ 8×[128,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l0_moe_res&#45;&gt;l1_token_split -->
<g id="edge28" class="edge">
<title>l0_moe_res&#45;&gt;l1_token_split</title>
<path fill="none" stroke="black" d="M2531.14,-3496.99C2436.2,-3477.02 2279.13,-3443.99 2180,-3423.14"/>
<polygon fill="black" stroke="black" points="2180.51,-3419.67 2170,-3421.04 2179.07,-3426.52 2180.51,-3419.67"/>
</g>
<!-- l1_attn_res -->
<g id="node26" class="node">
<title>l1_attn_res</title>
<polygon fill="orange" stroke="black" points="2776,-2876 2448,-2876 2448,-2840 2776,-2840 2776,-2876"/>
<text text-anchor="middle" x="2612" y="-2854.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l0_moe_res&#45;&gt;l1_attn_res -->
<g id="edge29" class="edge">
<title>l0_moe_res&#45;&gt;l1_attn_res</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M2612,-3496.85C2612,-3475.21 2612,-3436.85 2612,-3404 2612,-3404 2612,-3404 2612,-2966 2612,-2938.83 2612,-2907.77 2612,-2886.14"/>
<polygon fill="red" stroke="red" points="2615.5,-2886.05 2612,-2876.05 2608.5,-2886.05 2615.5,-2886.05"/>
<text text-anchor="middle" x="2643" y="-3181.3" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- l0_moe_res&#45;&gt;l1_attn_res -->
<g id="edge35" class="edge">
<title>l0_moe_res&#45;&gt;l1_attn_res</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M2660.38,-3496.94C2698.76,-3479.95 2746,-3449.75 2746,-3404 2746,-3404 2746,-3404 2746,-2966 2746,-2925.14 2707.49,-2897.34 2671.76,-2880.34"/>
<polygon fill="red" stroke="red" points="2672.83,-2876.98 2662.28,-2876.04 2669.94,-2883.36 2672.83,-2876.98"/>
<text text-anchor="middle" x="2777" y="-3181.3" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- l1_qkv_proj -->
<g id="node22" class="node">
<title>l1_qkv_proj</title>
<polygon fill="yellow" stroke="black" points="2324.5,-3312 1849.5,-3312 1849.5,-3276 2324.5,-3276 2324.5,-3312"/>
<text text-anchor="middle" x="2087" y="-3290.3" font-family="Times,serif" font-size="14.00">QKV Projections\n8×[128,2048,4096]\n×[4096,1536]\nGPU: 0&#45;7</text>
</g>
<!-- l1_token_split&#45;&gt;l1_qkv_proj -->
<g id="edge30" class="edge">
<title>l1_token_split&#45;&gt;l1_qkv_proj</title>
<path fill="none" stroke="black" d="M2088.68,-3384.81C2088.36,-3367.96 2087.88,-3342.02 2087.51,-3322.34"/>
<polygon fill="black" stroke="black" points="2091.01,-3322.08 2087.32,-3312.15 2084.01,-3322.21 2091.01,-3322.08"/>
</g>
<!-- l1_attention -->
<g id="node23" class="node">
<title>l1_attention</title>
<polygon fill="yellow" stroke="black" points="2362,-3203 1804,-3203 1804,-3167 2362,-3167 2362,-3203"/>
<text text-anchor="middle" x="2083" y="-3181.3" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention\n8×[128,2048,1536]\n→ 8×[128,2048,512]\nGPU: 0&#45;7</text>
</g>
<!-- l1_qkv_proj&#45;&gt;l1_attention -->
<g id="edge31" class="edge">
<title>l1_qkv_proj&#45;&gt;l1_attention</title>
<path fill="none" stroke="black" d="M2086.36,-3275.81C2085.73,-3258.96 2084.76,-3233.02 2084.02,-3213.34"/>
<polygon fill="black" stroke="black" points="2087.51,-3213.01 2083.64,-3203.15 2080.52,-3213.27 2087.51,-3213.01"/>
</g>
<!-- l1_out_proj -->
<g id="node24" class="node">
<title>l1_out_proj</title>
<polygon fill="yellow" stroke="black" points="2320,-3094 1844,-3094 1844,-3058 2320,-3058 2320,-3094"/>
<text text-anchor="middle" x="2082" y="-3072.3" font-family="Times,serif" font-size="14.00">Output Projections\n8×[128,2048,512]\n×[512,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l1_attention&#45;&gt;l1_out_proj -->
<g id="edge32" class="edge">
<title>l1_attention&#45;&gt;l1_out_proj</title>
<path fill="none" stroke="black" d="M2082.84,-3166.81C2082.68,-3149.96 2082.44,-3124.02 2082.26,-3104.34"/>
<polygon fill="black" stroke="black" points="2085.75,-3104.12 2082.16,-3094.15 2078.75,-3104.18 2085.75,-3104.12"/>
</g>
<!-- l1_gather -->
<g id="node25" class="node">
<title>l1_gather</title>
<polygon fill="lightcyan" stroke="black" points="2557.44,-2985 1799.53,-2985 1604.56,-2949 2362.47,-2949 2557.44,-2985"/>
<text text-anchor="middle" x="2081" y="-2963.3" font-family="Times,serif" font-size="14.00">Token Gather\n8×[128,2048,4096]\n→ [1024,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l1_out_proj&#45;&gt;l1_gather -->
<g id="edge33" class="edge">
<title>l1_out_proj&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M2081.84,-3057.81C2081.68,-3040.96 2081.44,-3015.02 2081.26,-2995.34"/>
<polygon fill="black" stroke="black" points="2084.75,-2995.12 2081.16,-2985.15 2077.75,-2995.18 2084.75,-2995.12"/>
</g>
<!-- l1_gather&#45;&gt;l1_attn_res -->
<g id="edge34" class="edge">
<title>l1_gather&#45;&gt;l1_attn_res</title>
<path fill="none" stroke="black" d="M2165.43,-2948.99C2261.34,-2929.66 2417.45,-2898.2 2517.38,-2878.07"/>
<polygon fill="black" stroke="black" points="2518.37,-2881.44 2527.48,-2876.03 2516.98,-2874.58 2518.37,-2881.44"/>
</g>
<!-- l1_gate -->
<g id="node27" class="node">
<title>l1_gate</title>
<polygon fill="lightcoral" stroke="black" points="2100,-2767 1672,-2767 1672,-2731 2100,-2731 2100,-2767"/>
<text text-anchor="middle" x="1886" y="-2745.3" font-family="Times,serif" font-size="14.00">Gate Network\n[1024,2048,4096]\n×[4096,16]\nGPU: 0&#45;7</text>
</g>
<!-- l1_attn_res&#45;&gt;l1_gate -->
<g id="edge36" class="edge">
<title>l1_attn_res&#45;&gt;l1_gate</title>
<path fill="none" stroke="black" d="M2496.56,-2839.99C2364.25,-2820.49 2148.11,-2788.63 2011.66,-2768.52"/>
<polygon fill="black" stroke="black" points="2011.97,-2765.03 2001.56,-2767.03 2010.95,-2771.95 2011.97,-2765.03"/>
</g>
<!-- l1_router -->
<g id="node28" class="node">
<title>l1_router</title>
<polygon fill="lightcyan" stroke="black" points="3087.53,-2767 2331.07,-2767 2136.47,-2731 2892.93,-2731 3087.53,-2767"/>
<text text-anchor="middle" x="2612" y="-2745.3" font-family="Times,serif" font-size="14.00">Token Router\n[1024,2048,4096]\n→ 8×[128,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l1_attn_res&#45;&gt;l1_router -->
<g id="edge37" class="edge">
<title>l1_attn_res&#45;&gt;l1_router</title>
<path fill="none" stroke="black" d="M2612,-2839.81C2612,-2822.96 2612,-2797.02 2612,-2777.34"/>
<polygon fill="black" stroke="black" points="2615.5,-2777.15 2612,-2767.15 2608.5,-2777.15 2615.5,-2777.15"/>
</g>
<!-- l1_moe_res -->
<g id="node38" class="node">
<title>l1_moe_res</title>
<polygon fill="orange" stroke="black" points="3847,-2440 3519,-2440 3519,-2404 3847,-2404 3847,-2440"/>
<text text-anchor="middle" x="3683" y="-2418.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l1_attn_res&#45;&gt;l1_moe_res -->
<g id="edge55" class="edge">
<title>l1_attn_res&#45;&gt;l1_moe_res</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M2776.21,-2853.95C3171.4,-2845.53 4143,-2817.92 4143,-2750 4143,-2750 4143,-2750 4143,-2530 4143,-2468.97 3987.44,-2442.73 3857.24,-2431.47"/>
<polygon fill="red" stroke="red" points="3857.38,-2427.97 3847.12,-2430.62 3856.79,-2434.94 3857.38,-2427.97"/>
<text text-anchor="middle" x="4174" y="-2636.3" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- l1_exp0 -->
<g id="node29" class="node">
<title>l1_exp0</title>
<polygon fill="lightpink" stroke="black" points="1117,-2658 731,-2658 731,-2622 1117,-2622 1117,-2658"/>
<text text-anchor="middle" x="924" y="-2636.3" font-family="Times,serif" font-size="14.00">Expert 0\n[128,2048,4096]\n×[4096,4096]\nGPU: 0</text>
</g>
<!-- l1_router&#45;&gt;l1_exp0 -->
<g id="edge38" class="edge">
<title>l1_router&#45;&gt;l1_exp0</title>
<path fill="none" stroke="black" d="M2303.89,-2730.98C2005.02,-2714.06 1538.77,-2686.56 1135,-2658 1132.43,-2657.82 1129.85,-2657.63 1127.25,-2657.45"/>
<polygon fill="black" stroke="black" points="1127.39,-2653.95 1117.16,-2656.71 1126.89,-2660.93 1127.39,-2653.95"/>
</g>
<!-- l1_exp1 -->
<g id="node30" class="node">
<title>l1_exp1</title>
<polygon fill="lightpink" stroke="black" points="1539,-2658 1153,-2658 1153,-2622 1539,-2622 1539,-2658"/>
<text text-anchor="middle" x="1346" y="-2636.3" font-family="Times,serif" font-size="14.00">Expert 1\n[128,2048,4096]\n×[4096,4096]\nGPU: 1</text>
</g>
<!-- l1_router&#45;&gt;l1_exp1 -->
<g id="edge40" class="edge">
<title>l1_router&#45;&gt;l1_exp1</title>
<path fill="none" stroke="black" d="M2410.7,-2730.99C2174.79,-2711.05 1786.09,-2678.2 1549.32,-2658.18"/>
<polygon fill="black" stroke="black" points="1549.47,-2654.68 1539.21,-2657.33 1548.88,-2661.66 1549.47,-2654.68"/>
</g>
<!-- l1_exp2 -->
<g id="node31" class="node">
<title>l1_exp2</title>
<polygon fill="lightpink" stroke="black" points="1961,-2658 1575,-2658 1575,-2622 1961,-2622 1961,-2658"/>
<text text-anchor="middle" x="1768" y="-2636.3" font-family="Times,serif" font-size="14.00">Expert 2\n[128,2048,4096]\n×[4096,4096]\nGPU: 2</text>
</g>
<!-- l1_router&#45;&gt;l1_exp2 -->
<g id="edge42" class="edge">
<title>l1_router&#45;&gt;l1_exp2</title>
<path fill="none" stroke="black" d="M2477.8,-2730.99C2323.52,-2711.43 2071.21,-2679.44 1912.65,-2659.34"/>
<polygon fill="black" stroke="black" points="1912.71,-2655.82 1902.35,-2658.03 1911.83,-2662.76 1912.71,-2655.82"/>
</g>
<!-- l1_exp3 -->
<g id="node32" class="node">
<title>l1_exp3</title>
<polygon fill="lightpink" stroke="black" points="2383,-2658 1997,-2658 1997,-2622 2383,-2622 2383,-2658"/>
<text text-anchor="middle" x="2190" y="-2636.3" font-family="Times,serif" font-size="14.00">Expert 3\n[128,2048,4096]\n×[4096,4096]\nGPU: 3</text>
</g>
<!-- l1_router&#45;&gt;l1_exp3 -->
<g id="edge44" class="edge">
<title>l1_router&#45;&gt;l1_exp3</title>
<path fill="none" stroke="black" d="M2544.67,-2730.93C2469.02,-2711.75 2346.45,-2680.67 2267.04,-2660.53"/>
<polygon fill="black" stroke="black" points="2267.65,-2657.08 2257.09,-2658.01 2265.93,-2663.86 2267.65,-2657.08"/>
</g>
<!-- l1_exp4 -->
<g id="node33" class="node">
<title>l1_exp4</title>
<polygon fill="lightpink" stroke="black" points="2805,-2658 2419,-2658 2419,-2622 2805,-2622 2805,-2658"/>
<text text-anchor="middle" x="2612" y="-2636.3" font-family="Times,serif" font-size="14.00">Expert 4\n[128,2048,4096]\n×[4096,4096]\nGPU: 4</text>
</g>
<!-- l1_router&#45;&gt;l1_exp4 -->
<g id="edge46" class="edge">
<title>l1_router&#45;&gt;l1_exp4</title>
<path fill="none" stroke="black" d="M2612,-2730.81C2612,-2713.96 2612,-2688.02 2612,-2668.34"/>
<polygon fill="black" stroke="black" points="2615.5,-2668.15 2612,-2658.15 2608.5,-2668.15 2615.5,-2668.15"/>
</g>
<!-- l1_exp5 -->
<g id="node34" class="node">
<title>l1_exp5</title>
<polygon fill="lightpink" stroke="black" points="3227,-2658 2841,-2658 2841,-2622 3227,-2622 3227,-2658"/>
<text text-anchor="middle" x="3034" y="-2636.3" font-family="Times,serif" font-size="14.00">Expert 5\n[128,2048,4096]\n×[4096,4096]\nGPU: 5</text>
</g>
<!-- l1_router&#45;&gt;l1_exp5 -->
<g id="edge48" class="edge">
<title>l1_router&#45;&gt;l1_exp5</title>
<path fill="none" stroke="black" d="M2679.33,-2730.93C2754.98,-2711.75 2877.55,-2680.67 2956.96,-2660.53"/>
<polygon fill="black" stroke="black" points="2958.07,-2663.86 2966.91,-2658.01 2956.35,-2657.08 2958.07,-2663.86"/>
</g>
<!-- l1_exp6 -->
<g id="node35" class="node">
<title>l1_exp6</title>
<polygon fill="lightpink" stroke="black" points="3649,-2658 3263,-2658 3263,-2622 3649,-2622 3649,-2658"/>
<text text-anchor="middle" x="3456" y="-2636.3" font-family="Times,serif" font-size="14.00">Expert 6\n[128,2048,4096]\n×[4096,4096]\nGPU: 6</text>
</g>
<!-- l1_router&#45;&gt;l1_exp6 -->
<g id="edge50" class="edge">
<title>l1_router&#45;&gt;l1_exp6</title>
<path fill="none" stroke="black" d="M2746.2,-2730.99C2900.48,-2711.43 3152.79,-2679.44 3311.35,-2659.34"/>
<polygon fill="black" stroke="black" points="3312.17,-2662.76 3321.65,-2658.03 3311.29,-2655.82 3312.17,-2662.76"/>
</g>
<!-- l1_exp7 -->
<g id="node36" class="node">
<title>l1_exp7</title>
<polygon fill="lightpink" stroke="black" points="4071,-2658 3685,-2658 3685,-2622 4071,-2622 4071,-2658"/>
<text text-anchor="middle" x="3878" y="-2636.3" font-family="Times,serif" font-size="14.00">Expert 7\n[128,2048,4096]\n×[4096,4096]\nGPU: 7</text>
</g>
<!-- l1_router&#45;&gt;l1_exp7 -->
<g id="edge52" class="edge">
<title>l1_router&#45;&gt;l1_exp7</title>
<path fill="none" stroke="black" d="M2813.3,-2730.99C3049.21,-2711.05 3437.91,-2678.2 3674.68,-2658.18"/>
<polygon fill="black" stroke="black" points="3675.12,-2661.66 3684.79,-2657.33 3674.53,-2654.68 3675.12,-2661.66"/>
</g>
<!-- l1_agg -->
<g id="node37" class="node">
<title>l1_agg</title>
<polygon fill="lightcyan" stroke="black" points="3131.2,-2549 2305.27,-2549 2092.8,-2513 2918.73,-2513 3131.2,-2549"/>
<text text-anchor="middle" x="2612" y="-2527.3" font-family="Times,serif" font-size="14.00">Expert Aggregation\n8×[128,2048,4096]\n→ [1024,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l1_exp0&#45;&gt;l1_agg -->
<g id="edge39" class="edge">
<title>l1_exp0&#45;&gt;l1_agg</title>
<path fill="none" stroke="black" d="M1117.16,-2623.29C1123.18,-2622.84 1129.13,-2622.41 1135,-2622 1534.71,-2593.72 1995.65,-2566.49 2294.83,-2549.53"/>
<polygon fill="black" stroke="black" points="2295.17,-2553.02 2304.96,-2548.96 2294.78,-2546.03 2295.17,-2553.02"/>
</g>
<!-- l1_exp1&#45;&gt;l1_agg -->
<g id="edge41" class="edge">
<title>l1_exp1&#45;&gt;l1_agg</title>
<path fill="none" stroke="black" d="M1539.31,-2622.66C1771.66,-2603.02 2160.2,-2570.19 2400.4,-2549.88"/>
<polygon fill="black" stroke="black" points="2400.99,-2553.35 2410.66,-2549.02 2400.4,-2546.37 2400.99,-2553.35"/>
</g>
<!-- l1_exp2&#45;&gt;l1_agg -->
<g id="edge43" class="edge">
<title>l1_exp2&#45;&gt;l1_agg</title>
<path fill="none" stroke="black" d="M1902.2,-2621.99C2056.48,-2602.43 2308.79,-2570.44 2467.35,-2550.34"/>
<polygon fill="black" stroke="black" points="2468.17,-2553.76 2477.65,-2549.03 2467.29,-2546.82 2468.17,-2553.76"/>
</g>
<!-- l1_exp3&#45;&gt;l1_agg -->
<g id="edge45" class="edge">
<title>l1_exp3&#45;&gt;l1_agg</title>
<path fill="none" stroke="black" d="M2257.33,-2621.93C2332.98,-2602.75 2455.55,-2571.67 2534.96,-2551.53"/>
<polygon fill="black" stroke="black" points="2536.07,-2554.86 2544.91,-2549.01 2534.35,-2548.08 2536.07,-2554.86"/>
</g>
<!-- l1_exp4&#45;&gt;l1_agg -->
<g id="edge47" class="edge">
<title>l1_exp4&#45;&gt;l1_agg</title>
<path fill="none" stroke="black" d="M2612,-2621.81C2612,-2604.96 2612,-2579.02 2612,-2559.34"/>
<polygon fill="black" stroke="black" points="2615.5,-2559.15 2612,-2549.15 2608.5,-2559.15 2615.5,-2559.15"/>
</g>
<!-- l1_exp5&#45;&gt;l1_agg -->
<g id="edge49" class="edge">
<title>l1_exp5&#45;&gt;l1_agg</title>
<path fill="none" stroke="black" d="M2966.67,-2621.93C2891.02,-2602.75 2768.45,-2571.67 2689.04,-2551.53"/>
<polygon fill="black" stroke="black" points="2689.65,-2548.08 2679.09,-2549.01 2687.93,-2554.86 2689.65,-2548.08"/>
</g>
<!-- l1_exp6&#45;&gt;l1_agg -->
<g id="edge51" class="edge">
<title>l1_exp6&#45;&gt;l1_agg</title>
<path fill="none" stroke="black" d="M3321.8,-2621.99C3167.52,-2602.43 2915.21,-2570.44 2756.65,-2550.34"/>
<polygon fill="black" stroke="black" points="2756.71,-2546.82 2746.35,-2549.03 2755.83,-2553.76 2756.71,-2546.82"/>
</g>
<!-- l1_exp7&#45;&gt;l1_agg -->
<g id="edge53" class="edge">
<title>l1_exp7&#45;&gt;l1_agg</title>
<path fill="none" stroke="black" d="M3684.69,-2622.66C3452.34,-2603.02 3063.8,-2570.19 2823.6,-2549.88"/>
<polygon fill="black" stroke="black" points="2823.6,-2546.37 2813.34,-2549.02 2823.01,-2553.35 2823.6,-2546.37"/>
</g>
<!-- l1_agg&#45;&gt;l1_moe_res -->
<g id="edge54" class="edge">
<title>l1_agg&#45;&gt;l1_moe_res</title>
<path fill="none" stroke="black" d="M2782.29,-2512.99C2981.08,-2493.13 3308.11,-2460.45 3508.63,-2440.42"/>
<polygon fill="black" stroke="black" points="3509.08,-2443.89 3518.68,-2439.42 3508.38,-2436.93 3509.08,-2443.89"/>
</g>
<!-- stage0_to_stage1 -->
<g id="node75" class="node">
<title>stage0_to_stage1</title>
<polygon fill="gray" stroke="black" points="4309.16,-2331 3313.08,-2331 3056.84,-2295 4052.92,-2295 4309.16,-2331"/>
<text text-anchor="middle" x="3683" y="-2309.3" font-family="Times,serif" font-size="14.00">Pipeline Communication\nStage 0 (GPUs 0&#45;7)\n→ Stage 1 (GPUs 8&#45;15)\n[1024,2048,4096]</text>
</g>
<!-- l1_moe_res&#45;&gt;stage0_to_stage1 -->
<g id="edge56" class="edge">
<title>l1_moe_res&#45;&gt;stage0_to_stage1</title>
<path fill="none" stroke="black" d="M3683,-2403.81C3683,-2386.96 3683,-2361.02 3683,-2341.34"/>
<polygon fill="black" stroke="black" points="3686.5,-2341.15 3683,-2331.15 3679.5,-2341.15 3686.5,-2341.15"/>
</g>
<!-- l2_token_split -->
<g id="node39" class="node">
<title>l2_token_split</title>
<polygon fill="lightcyan" stroke="black" points="3620.6,-2219 2873.57,-2219 2681.4,-2183 3428.43,-2183 3620.6,-2219"/>
<text text-anchor="middle" x="3151" y="-2197.3" font-family="Times,serif" font-size="14.00">Token Split\n[1024,2048,4096]\n→ 8×[128,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l2_qkv_proj -->
<g id="node40" class="node">
<title>l2_qkv_proj</title>
<polygon fill="yellow" stroke="black" points="3391,-2110 2907,-2110 2907,-2074 3391,-2074 3391,-2110"/>
<text text-anchor="middle" x="3149" y="-2088.3" font-family="Times,serif" font-size="14.00">QKV Projections\n8×[128,2048,4096]\n×[4096,1536]\nGPU: 8&#45;15</text>
</g>
<!-- l2_token_split&#45;&gt;l2_qkv_proj -->
<g id="edge59" class="edge">
<title>l2_token_split&#45;&gt;l2_qkv_proj</title>
<path fill="none" stroke="black" d="M3150.68,-2182.81C3150.36,-2165.96 3149.88,-2140.02 3149.51,-2120.34"/>
<polygon fill="black" stroke="black" points="3153.01,-2120.08 3149.32,-2110.15 3146.01,-2120.21 3153.01,-2120.08"/>
</g>
<!-- l2_attention -->
<g id="node41" class="node">
<title>l2_attention</title>
<polygon fill="yellow" stroke="black" points="3428.5,-2001 2861.5,-2001 2861.5,-1965 3428.5,-1965 3428.5,-2001"/>
<text text-anchor="middle" x="3145" y="-1979.3" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention\n8×[128,2048,1536]\n→ 8×[128,2048,512]\nGPU: 8&#45;15</text>
</g>
<!-- l2_qkv_proj&#45;&gt;l2_attention -->
<g id="edge60" class="edge">
<title>l2_qkv_proj&#45;&gt;l2_attention</title>
<path fill="none" stroke="black" d="M3148.36,-2073.81C3147.73,-2056.96 3146.76,-2031.02 3146.02,-2011.34"/>
<polygon fill="black" stroke="black" points="3149.51,-2011.01 3145.64,-2001.15 3142.52,-2011.27 3149.51,-2011.01"/>
</g>
<!-- l2_out_proj -->
<g id="node42" class="node">
<title>l2_out_proj</title>
<polygon fill="yellow" stroke="black" points="3386.5,-1892 2901.5,-1892 2901.5,-1856 3386.5,-1856 3386.5,-1892"/>
<text text-anchor="middle" x="3144" y="-1870.3" font-family="Times,serif" font-size="14.00">Output Projections\n8×[128,2048,512]\n×[512,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l2_attention&#45;&gt;l2_out_proj -->
<g id="edge61" class="edge">
<title>l2_attention&#45;&gt;l2_out_proj</title>
<path fill="none" stroke="black" d="M3144.84,-1964.81C3144.68,-1947.96 3144.44,-1922.02 3144.26,-1902.34"/>
<polygon fill="black" stroke="black" points="3147.75,-1902.12 3144.16,-1892.15 3140.75,-1902.18 3147.75,-1902.12"/>
</g>
<!-- l2_gather -->
<g id="node43" class="node">
<title>l2_gather</title>
<polygon fill="lightcyan" stroke="black" points="3628.09,-1783 2856.42,-1783 2657.91,-1747 3429.58,-1747 3628.09,-1783"/>
<text text-anchor="middle" x="3143" y="-1761.3" font-family="Times,serif" font-size="14.00">Token Gather\n8×[128,2048,4096]\n→ [1024,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l2_out_proj&#45;&gt;l2_gather -->
<g id="edge62" class="edge">
<title>l2_out_proj&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M3143.84,-1855.81C3143.68,-1838.96 3143.44,-1813.02 3143.26,-1793.34"/>
<polygon fill="black" stroke="black" points="3146.75,-1793.12 3143.16,-1783.15 3139.75,-1793.18 3146.75,-1793.12"/>
</g>
<!-- l2_attn_res -->
<g id="node44" class="node">
<title>l2_attn_res</title>
<polygon fill="orange" stroke="black" points="3851.5,-1674 3514.5,-1674 3514.5,-1638 3851.5,-1638 3851.5,-1674"/>
<text text-anchor="middle" x="3683" y="-1652.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l2_gather&#45;&gt;l2_attn_res -->
<g id="edge63" class="edge">
<title>l2_gather&#45;&gt;l2_attn_res</title>
<path fill="none" stroke="black" d="M3228.86,-1746.99C3326.49,-1727.64 3485.47,-1696.14 3587.09,-1676"/>
<polygon fill="black" stroke="black" points="3587.92,-1679.41 3597.04,-1674.03 3586.55,-1672.54 3587.92,-1679.41"/>
</g>
<!-- l2_gate -->
<g id="node45" class="node">
<title>l2_gate</title>
<polygon fill="lightcoral" stroke="black" points="3162.5,-1565 2725.5,-1565 2725.5,-1529 3162.5,-1529 3162.5,-1565"/>
<text text-anchor="middle" x="2944" y="-1543.3" font-family="Times,serif" font-size="14.00">Gate Network\n[1024,2048,4096]\n×[4096,16]\nGPU: 8&#45;15</text>
</g>
<!-- l2_attn_res&#45;&gt;l2_gate -->
<g id="edge65" class="edge">
<title>l2_attn_res&#45;&gt;l2_gate</title>
<path fill="none" stroke="black" d="M3565.49,-1637.99C3430.81,-1618.49 3210.81,-1586.63 3071.91,-1566.52"/>
<polygon fill="black" stroke="black" points="3072.03,-1563 3061.63,-1565.03 3071.03,-1569.93 3072.03,-1563"/>
</g>
<!-- l2_router -->
<g id="node46" class="node">
<title>l2_router</title>
<polygon fill="lightcyan" stroke="black" points="4167.19,-1565 3396.95,-1565 3198.81,-1529 3969.05,-1529 4167.19,-1565"/>
<text text-anchor="middle" x="3683" y="-1543.3" font-family="Times,serif" font-size="14.00">Token Router\n[1024,2048,4096]\n→ 8×[128,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l2_attn_res&#45;&gt;l2_router -->
<g id="edge66" class="edge">
<title>l2_attn_res&#45;&gt;l2_router</title>
<path fill="none" stroke="black" d="M3683,-1637.81C3683,-1620.96 3683,-1595.02 3683,-1575.34"/>
<polygon fill="black" stroke="black" points="3686.5,-1575.15 3683,-1565.15 3679.5,-1575.15 3686.5,-1575.15"/>
</g>
<!-- l2_moe_res -->
<g id="node56" class="node">
<title>l2_moe_res</title>
<polygon fill="orange" stroke="black" points="4579.5,-1238 4242.5,-1238 4242.5,-1202 4579.5,-1202 4579.5,-1238"/>
<text text-anchor="middle" x="4411" y="-1216.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l2_attn_res&#45;&gt;l2_moe_res -->
<g id="edge84" class="edge">
<title>l2_attn_res&#45;&gt;l2_moe_res</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M3851.75,-1652.1C4255.91,-1644.06 5246,-1617.27 5246,-1548 5246,-1548 5246,-1548 5246,-1328 5246,-1262.39 4835.14,-1236.18 4589.83,-1226.37"/>
<polygon fill="blue" stroke="blue" points="4589.85,-1222.87 4579.72,-1225.97 4589.58,-1229.87 4589.85,-1222.87"/>
<text text-anchor="middle" x="5277" y="-1434.3" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- l2_exp0 -->
<g id="node47" class="node">
<title>l2_exp0</title>
<polygon fill="lightpink" stroke="black" points="2165,-1456 1779,-1456 1779,-1420 2165,-1420 2165,-1456"/>
<text text-anchor="middle" x="1972" y="-1434.3" font-family="Times,serif" font-size="14.00">Expert 0\n[128,2048,4096]\n×[4096,4096]\nGPU: 8</text>
</g>
<!-- l2_router&#45;&gt;l2_exp0 -->
<g id="edge67" class="edge">
<title>l2_router&#45;&gt;l2_exp0</title>
<path fill="none" stroke="black" d="M3368.28,-1528.99C3064.69,-1512.15 2592.23,-1484.76 2183,-1456 2180.43,-1455.82 2177.85,-1455.64 2175.25,-1455.45"/>
<polygon fill="black" stroke="black" points="2175.39,-1451.95 2165.16,-1454.72 2174.89,-1458.93 2175.39,-1451.95"/>
</g>
<!-- l2_exp1 -->
<g id="node48" class="node">
<title>l2_exp1</title>
<polygon fill="lightpink" stroke="black" points="2587,-1456 2201,-1456 2201,-1420 2587,-1420 2587,-1456"/>
<text text-anchor="middle" x="2394" y="-1434.3" font-family="Times,serif" font-size="14.00">Expert 1\n[128,2048,4096]\n×[4096,4096]\nGPU: 9</text>
</g>
<!-- l2_router&#45;&gt;l2_exp1 -->
<g id="edge69" class="edge">
<title>l2_router&#45;&gt;l2_exp1</title>
<path fill="none" stroke="black" d="M3478.04,-1528.99C3236.62,-1508.95 2838.04,-1475.86 2597.33,-1455.88"/>
<polygon fill="black" stroke="black" points="2597.31,-1452.37 2587.06,-1455.03 2596.73,-1459.34 2597.31,-1452.37"/>
</g>
<!-- l2_exp2 -->
<g id="node49" class="node">
<title>l2_exp2</title>
<polygon fill="lightpink" stroke="black" points="3018.5,-1456 2623.5,-1456 2623.5,-1420 3018.5,-1420 3018.5,-1456"/>
<text text-anchor="middle" x="2821" y="-1434.3" font-family="Times,serif" font-size="14.00">Expert 2\n[128,2048,4096]\n×[4096,4096]\nGPU: 10</text>
</g>
<!-- l2_router&#45;&gt;l2_exp2 -->
<g id="edge71" class="edge">
<title>l2_router&#45;&gt;l2_exp2</title>
<path fill="none" stroke="black" d="M3545.94,-1528.99C3388.21,-1509.41 3130.16,-1477.38 2968.25,-1457.28"/>
<polygon fill="black" stroke="black" points="2968.57,-1453.79 2958.21,-1456.03 2967.7,-1460.74 2968.57,-1453.79"/>
</g>
<!-- l2_exp3 -->
<g id="node50" class="node">
<title>l2_exp3</title>
<polygon fill="lightpink" stroke="black" points="3449.5,-1456 3054.5,-1456 3054.5,-1420 3449.5,-1420 3449.5,-1456"/>
<text text-anchor="middle" x="3252" y="-1434.3" font-family="Times,serif" font-size="14.00">Expert 3\n[128,2048,4096]\n×[4096,4096]\nGPU: 11</text>
</g>
<!-- l2_router&#45;&gt;l2_exp3 -->
<g id="edge73" class="edge">
<title>l2_router&#45;&gt;l2_exp3</title>
<path fill="none" stroke="black" d="M3614.23,-1528.93C3536.97,-1509.75 3411.78,-1478.67 3330.68,-1458.53"/>
<polygon fill="black" stroke="black" points="3331.07,-1455.02 3320.52,-1456.01 3329.39,-1461.82 3331.07,-1455.02"/>
</g>
<!-- l2_exp4 -->
<g id="node51" class="node">
<title>l2_exp4</title>
<polygon fill="lightpink" stroke="black" points="3880.5,-1456 3485.5,-1456 3485.5,-1420 3880.5,-1420 3880.5,-1456"/>
<text text-anchor="middle" x="3683" y="-1434.3" font-family="Times,serif" font-size="14.00">Expert 4\n[128,2048,4096]\n×[4096,4096]\nGPU: 12</text>
</g>
<!-- l2_router&#45;&gt;l2_exp4 -->
<g id="edge75" class="edge">
<title>l2_router&#45;&gt;l2_exp4</title>
<path fill="none" stroke="black" d="M3683,-1528.81C3683,-1511.96 3683,-1486.02 3683,-1466.34"/>
<polygon fill="black" stroke="black" points="3686.5,-1466.15 3683,-1456.15 3679.5,-1466.15 3686.5,-1466.15"/>
</g>
<!-- l2_exp5 -->
<g id="node52" class="node">
<title>l2_exp5</title>
<polygon fill="lightpink" stroke="black" points="4311.5,-1456 3916.5,-1456 3916.5,-1420 4311.5,-1420 4311.5,-1456"/>
<text text-anchor="middle" x="4114" y="-1434.3" font-family="Times,serif" font-size="14.00">Expert 5\n[128,2048,4096]\n×[4096,4096]\nGPU: 13</text>
</g>
<!-- l2_router&#45;&gt;l2_exp5 -->
<g id="edge77" class="edge">
<title>l2_router&#45;&gt;l2_exp5</title>
<path fill="none" stroke="black" d="M3751.77,-1528.93C3829.03,-1509.75 3954.22,-1478.67 4035.32,-1458.53"/>
<polygon fill="black" stroke="black" points="4036.61,-1461.82 4045.48,-1456.01 4034.93,-1455.02 4036.61,-1461.82"/>
</g>
<!-- l2_exp6 -->
<g id="node53" class="node">
<title>l2_exp6</title>
<polygon fill="lightpink" stroke="black" points="4742.5,-1456 4347.5,-1456 4347.5,-1420 4742.5,-1420 4742.5,-1456"/>
<text text-anchor="middle" x="4545" y="-1434.3" font-family="Times,serif" font-size="14.00">Expert 6\n[128,2048,4096]\n×[4096,4096]\nGPU: 14</text>
</g>
<!-- l2_router&#45;&gt;l2_exp6 -->
<g id="edge79" class="edge">
<title>l2_router&#45;&gt;l2_exp6</title>
<path fill="none" stroke="black" d="M3820.06,-1528.99C3977.79,-1509.41 4235.84,-1477.38 4397.75,-1457.28"/>
<polygon fill="black" stroke="black" points="4398.3,-1460.74 4407.79,-1456.03 4397.43,-1453.79 4398.3,-1460.74"/>
</g>
<!-- l2_exp7 -->
<g id="node54" class="node">
<title>l2_exp7</title>
<polygon fill="lightpink" stroke="black" points="5173.5,-1456 4778.5,-1456 4778.5,-1420 5173.5,-1420 5173.5,-1456"/>
<text text-anchor="middle" x="4976" y="-1434.3" font-family="Times,serif" font-size="14.00">Expert 7\n[128,2048,4096]\n×[4096,4096]\nGPU: 15</text>
</g>
<!-- l2_router&#45;&gt;l2_exp7 -->
<g id="edge81" class="edge">
<title>l2_router&#45;&gt;l2_exp7</title>
<path fill="none" stroke="black" d="M3888.59,-1528.99C4129.45,-1509.06 4526.23,-1476.22 4768.08,-1456.21"/>
<polygon fill="black" stroke="black" points="4768.73,-1459.66 4778.41,-1455.35 4768.15,-1452.69 4768.73,-1459.66"/>
</g>
<!-- l2_agg -->
<g id="node55" class="node">
<title>l2_agg</title>
<polygon fill="lightcyan" stroke="black" points="4210.86,-1347 3371.15,-1347 3155.14,-1311 3994.85,-1311 4210.86,-1347"/>
<text text-anchor="middle" x="3683" y="-1325.3" font-family="Times,serif" font-size="14.00">Expert Aggregation\n8×[128,2048,4096]\n→ [1024,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l2_exp0&#45;&gt;l2_agg -->
<g id="edge68" class="edge">
<title>l2_exp0&#45;&gt;l2_agg</title>
<path fill="none" stroke="black" d="M2165.16,-1421.28C2171.18,-1420.84 2177.13,-1420.41 2183,-1420 2588.6,-1391.5 3056.31,-1364.34 3360.16,-1347.46"/>
<polygon fill="black" stroke="black" points="3360.66,-1350.93 3370.45,-1346.89 3360.27,-1343.95 3360.66,-1350.93"/>
</g>
<!-- l2_exp1&#45;&gt;l2_agg -->
<g id="edge70" class="edge">
<title>l2_exp1&#45;&gt;l2_agg</title>
<path fill="none" stroke="black" d="M2587.32,-1420.95C2823.63,-1401.34 3222.29,-1368.24 3468.03,-1347.85"/>
<polygon fill="black" stroke="black" points="3468.48,-1351.32 3478.16,-1347 3467.9,-1344.34 3468.48,-1351.32"/>
</g>
<!-- l2_exp2&#45;&gt;l2_agg -->
<g id="edge72" class="edge">
<title>l2_exp2&#45;&gt;l2_agg</title>
<path fill="none" stroke="black" d="M2958.06,-1419.99C3115.79,-1400.41 3373.84,-1368.38 3535.75,-1348.28"/>
<polygon fill="black" stroke="black" points="3536.3,-1351.74 3545.79,-1347.03 3535.43,-1344.79 3536.3,-1351.74"/>
</g>
<!-- l2_exp3&#45;&gt;l2_agg -->
<g id="edge74" class="edge">
<title>l2_exp3&#45;&gt;l2_agg</title>
<path fill="none" stroke="black" d="M3320.77,-1419.93C3398.03,-1400.75 3523.22,-1369.67 3604.32,-1349.53"/>
<polygon fill="black" stroke="black" points="3605.61,-1352.82 3614.48,-1347.01 3603.93,-1346.02 3605.61,-1352.82"/>
</g>
<!-- l2_exp4&#45;&gt;l2_agg -->
<g id="edge76" class="edge">
<title>l2_exp4&#45;&gt;l2_agg</title>
<path fill="none" stroke="black" d="M3683,-1419.81C3683,-1402.96 3683,-1377.02 3683,-1357.34"/>
<polygon fill="black" stroke="black" points="3686.5,-1357.15 3683,-1347.15 3679.5,-1357.15 3686.5,-1357.15"/>
</g>
<!-- l2_exp5&#45;&gt;l2_agg -->
<g id="edge78" class="edge">
<title>l2_exp5&#45;&gt;l2_agg</title>
<path fill="none" stroke="black" d="M4045.23,-1419.93C3967.97,-1400.75 3842.78,-1369.67 3761.68,-1349.53"/>
<polygon fill="black" stroke="black" points="3762.07,-1346.02 3751.52,-1347.01 3760.39,-1352.82 3762.07,-1346.02"/>
</g>
<!-- l2_exp6&#45;&gt;l2_agg -->
<g id="edge80" class="edge">
<title>l2_exp6&#45;&gt;l2_agg</title>
<path fill="none" stroke="black" d="M4407.94,-1419.99C4250.21,-1400.41 3992.16,-1368.38 3830.25,-1348.28"/>
<polygon fill="black" stroke="black" points="3830.57,-1344.79 3820.21,-1347.03 3829.7,-1351.74 3830.57,-1344.79"/>
</g>
<!-- l2_exp7&#45;&gt;l2_agg -->
<g id="edge82" class="edge">
<title>l2_exp7&#45;&gt;l2_agg</title>
<path fill="none" stroke="black" d="M4778.21,-1420.63C4540.71,-1400.98 4143.79,-1368.13 3898.62,-1347.84"/>
<polygon fill="black" stroke="black" points="3898.77,-1344.34 3888.51,-1347.01 3898.19,-1351.32 3898.77,-1344.34"/>
</g>
<!-- l2_agg&#45;&gt;l2_moe_res -->
<g id="edge83" class="edge">
<title>l2_agg&#45;&gt;l2_moe_res</title>
<path fill="none" stroke="black" d="M3798.76,-1310.99C3931.44,-1291.49 4148.16,-1259.63 4285,-1239.52"/>
<polygon fill="black" stroke="black" points="4285.73,-1242.95 4295.12,-1238.03 4284.72,-1236.02 4285.73,-1242.95"/>
</g>
<!-- l3_token_split -->
<g id="node57" class="node">
<title>l3_token_split</title>
<polygon fill="lightcyan" stroke="black" points="4348.6,-1126 3601.57,-1126 3409.4,-1090 4156.43,-1090 4348.6,-1126"/>
<text text-anchor="middle" x="3879" y="-1104.3" font-family="Times,serif" font-size="14.00">Token Split\n[1024,2048,4096]\n→ 8×[128,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l2_moe_res&#45;&gt;l3_token_split -->
<g id="edge85" class="edge">
<title>l2_moe_res&#45;&gt;l3_token_split</title>
<path fill="none" stroke="black" d="M4328.75,-1201.99C4232.08,-1182 4072.08,-1148.92 3971.26,-1128.08"/>
<polygon fill="black" stroke="black" points="3971.9,-1124.63 3961.39,-1126.04 3970.48,-1131.49 3971.9,-1124.63"/>
</g>
<!-- l3_attn_res -->
<g id="node62" class="node">
<title>l3_attn_res</title>
<polygon fill="orange" stroke="black" points="4579.5,-581 4242.5,-581 4242.5,-545 4579.5,-545 4579.5,-581"/>
<text text-anchor="middle" x="4411" y="-559.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l2_moe_res&#45;&gt;l3_attn_res -->
<g id="edge86" class="edge">
<title>l2_moe_res&#45;&gt;l3_attn_res</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M4411,-1201.85C4411,-1180.21 4411,-1141.85 4411,-1109 4411,-1109 4411,-1109 4411,-671 4411,-643.83 4411,-612.77 4411,-591.14"/>
<polygon fill="blue" stroke="blue" points="4414.5,-591.05 4411,-581.05 4407.5,-591.05 4414.5,-591.05"/>
<text text-anchor="middle" x="4442" y="-886.3" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- l2_moe_res&#45;&gt;l3_attn_res -->
<g id="edge92" class="edge">
<title>l2_moe_res&#45;&gt;l3_attn_res</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M4459.38,-1201.94C4497.76,-1184.95 4545,-1154.75 4545,-1109 4545,-1109 4545,-1109 4545,-671 4545,-630.14 4506.49,-602.34 4470.76,-585.34"/>
<polygon fill="blue" stroke="blue" points="4471.83,-581.98 4461.28,-581.04 4468.94,-588.36 4471.83,-581.98"/>
<text text-anchor="middle" x="4576" y="-886.3" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- l3_qkv_proj -->
<g id="node58" class="node">
<title>l3_qkv_proj</title>
<polygon fill="yellow" stroke="black" points="4119,-1017 3635,-1017 3635,-981 4119,-981 4119,-1017"/>
<text text-anchor="middle" x="3877" y="-995.3" font-family="Times,serif" font-size="14.00">QKV Projections\n8×[128,2048,4096]\n×[4096,1536]\nGPU: 8&#45;15</text>
</g>
<!-- l3_token_split&#45;&gt;l3_qkv_proj -->
<g id="edge87" class="edge">
<title>l3_token_split&#45;&gt;l3_qkv_proj</title>
<path fill="none" stroke="black" d="M3878.68,-1089.81C3878.36,-1072.96 3877.88,-1047.02 3877.51,-1027.34"/>
<polygon fill="black" stroke="black" points="3881.01,-1027.08 3877.32,-1017.15 3874.01,-1027.21 3881.01,-1027.08"/>
</g>
<!-- l3_attention -->
<g id="node59" class="node">
<title>l3_attention</title>
<polygon fill="yellow" stroke="black" points="4156.5,-908 3589.5,-908 3589.5,-872 4156.5,-872 4156.5,-908"/>
<text text-anchor="middle" x="3873" y="-886.3" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention\n8×[128,2048,1536]\n→ 8×[128,2048,512]\nGPU: 8&#45;15</text>
</g>
<!-- l3_qkv_proj&#45;&gt;l3_attention -->
<g id="edge88" class="edge">
<title>l3_qkv_proj&#45;&gt;l3_attention</title>
<path fill="none" stroke="black" d="M3876.36,-980.81C3875.73,-963.96 3874.76,-938.02 3874.02,-918.34"/>
<polygon fill="black" stroke="black" points="3877.51,-918.01 3873.64,-908.15 3870.52,-918.27 3877.51,-918.01"/>
</g>
<!-- l3_out_proj -->
<g id="node60" class="node">
<title>l3_out_proj</title>
<polygon fill="yellow" stroke="black" points="4114.5,-799 3629.5,-799 3629.5,-763 4114.5,-763 4114.5,-799"/>
<text text-anchor="middle" x="3872" y="-777.3" font-family="Times,serif" font-size="14.00">Output Projections\n8×[128,2048,512]\n×[512,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l3_attention&#45;&gt;l3_out_proj -->
<g id="edge89" class="edge">
<title>l3_attention&#45;&gt;l3_out_proj</title>
<path fill="none" stroke="black" d="M3872.84,-871.81C3872.68,-854.96 3872.44,-829.02 3872.26,-809.34"/>
<polygon fill="black" stroke="black" points="3875.75,-809.12 3872.16,-799.15 3868.75,-809.18 3875.75,-809.12"/>
</g>
<!-- l3_gather -->
<g id="node61" class="node">
<title>l3_gather</title>
<polygon fill="lightcyan" stroke="black" points="4356.09,-690 3584.42,-690 3385.91,-654 4157.58,-654 4356.09,-690"/>
<text text-anchor="middle" x="3871" y="-668.3" font-family="Times,serif" font-size="14.00">Token Gather\n8×[128,2048,4096]\n→ [1024,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l3_out_proj&#45;&gt;l3_gather -->
<g id="edge90" class="edge">
<title>l3_out_proj&#45;&gt;l3_gather</title>
<path fill="none" stroke="black" d="M3871.84,-762.81C3871.68,-745.96 3871.44,-720.02 3871.26,-700.34"/>
<polygon fill="black" stroke="black" points="3874.75,-700.12 3871.16,-690.15 3867.75,-700.18 3874.75,-700.12"/>
</g>
<!-- l3_gather&#45;&gt;l3_attn_res -->
<g id="edge91" class="edge">
<title>l3_gather&#45;&gt;l3_attn_res</title>
<path fill="none" stroke="black" d="M3956.86,-653.99C4054.49,-634.64 4213.47,-603.14 4315.09,-583"/>
<polygon fill="black" stroke="black" points="4315.92,-586.41 4325.04,-581.03 4314.55,-579.54 4315.92,-586.41"/>
</g>
<!-- l3_gate -->
<g id="node63" class="node">
<title>l3_gate</title>
<polygon fill="lightcoral" stroke="black" points="3890.5,-472 3453.5,-472 3453.5,-436 3890.5,-436 3890.5,-472"/>
<text text-anchor="middle" x="3672" y="-450.3" font-family="Times,serif" font-size="14.00">Gate Network\n[1024,2048,4096]\n×[4096,16]\nGPU: 8&#45;15</text>
</g>
<!-- l3_attn_res&#45;&gt;l3_gate -->
<g id="edge93" class="edge">
<title>l3_attn_res&#45;&gt;l3_gate</title>
<path fill="none" stroke="black" d="M4293.49,-544.99C4158.81,-525.49 3938.81,-493.63 3799.91,-473.52"/>
<polygon fill="black" stroke="black" points="3800.03,-470 3789.63,-472.03 3799.03,-476.93 3800.03,-470"/>
</g>
<!-- l3_router -->
<g id="node64" class="node">
<title>l3_router</title>
<polygon fill="lightcyan" stroke="black" points="4895.19,-472 4124.95,-472 3926.81,-436 4697.05,-436 4895.19,-472"/>
<text text-anchor="middle" x="4411" y="-450.3" font-family="Times,serif" font-size="14.00">Token Router\n[1024,2048,4096]\n→ 8×[128,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l3_attn_res&#45;&gt;l3_router -->
<g id="edge94" class="edge">
<title>l3_attn_res&#45;&gt;l3_router</title>
<path fill="none" stroke="black" d="M4411,-544.81C4411,-527.96 4411,-502.02 4411,-482.34"/>
<polygon fill="black" stroke="black" points="4414.5,-482.15 4411,-472.15 4407.5,-482.15 4414.5,-482.15"/>
</g>
<!-- l3_moe_res -->
<g id="node74" class="node">
<title>l3_moe_res</title>
<polygon fill="orange" stroke="black" points="5307.5,-145 4970.5,-145 4970.5,-109 5307.5,-109 5307.5,-145"/>
<text text-anchor="middle" x="5139" y="-123.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l3_attn_res&#45;&gt;l3_moe_res -->
<g id="edge112" class="edge">
<title>l3_attn_res&#45;&gt;l3_moe_res</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M4579.75,-559.1C4983.91,-551.06 5974,-524.27 5974,-455 5974,-455 5974,-455 5974,-235 5974,-169.39 5563.14,-143.18 5317.83,-133.37"/>
<polygon fill="blue" stroke="blue" points="5317.85,-129.87 5307.72,-132.97 5317.58,-136.87 5317.85,-129.87"/>
<text text-anchor="middle" x="6005" y="-341.3" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- l3_exp0 -->
<g id="node65" class="node">
<title>l3_exp0</title>
<polygon fill="lightpink" stroke="black" points="2893,-363 2507,-363 2507,-327 2893,-327 2893,-363"/>
<text text-anchor="middle" x="2700" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 0\n[128,2048,4096]\n×[4096,4096]\nGPU: 8</text>
</g>
<!-- l3_router&#45;&gt;l3_exp0 -->
<g id="edge95" class="edge">
<title>l3_router&#45;&gt;l3_exp0</title>
<path fill="none" stroke="black" d="M4096.28,-435.99C3792.69,-419.15 3320.23,-391.76 2911,-363 2908.43,-362.82 2905.85,-362.64 2903.25,-362.45"/>
<polygon fill="black" stroke="black" points="2903.39,-358.95 2893.16,-361.72 2902.89,-365.93 2903.39,-358.95"/>
</g>
<!-- l3_exp1 -->
<g id="node66" class="node">
<title>l3_exp1</title>
<polygon fill="lightpink" stroke="black" points="3315,-363 2929,-363 2929,-327 3315,-327 3315,-363"/>
<text text-anchor="middle" x="3122" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 1\n[128,2048,4096]\n×[4096,4096]\nGPU: 9</text>
</g>
<!-- l3_router&#45;&gt;l3_exp1 -->
<g id="edge97" class="edge">
<title>l3_router&#45;&gt;l3_exp1</title>
<path fill="none" stroke="black" d="M4206.04,-435.99C3964.62,-415.95 3566.04,-382.86 3325.33,-362.88"/>
<polygon fill="black" stroke="black" points="3325.31,-359.37 3315.06,-362.03 3324.73,-366.34 3325.31,-359.37"/>
</g>
<!-- l3_exp2 -->
<g id="node67" class="node">
<title>l3_exp2</title>
<polygon fill="lightpink" stroke="black" points="3746.5,-363 3351.5,-363 3351.5,-327 3746.5,-327 3746.5,-363"/>
<text text-anchor="middle" x="3549" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 2\n[128,2048,4096]\n×[4096,4096]\nGPU: 10</text>
</g>
<!-- l3_router&#45;&gt;l3_exp2 -->
<g id="edge99" class="edge">
<title>l3_router&#45;&gt;l3_exp2</title>
<path fill="none" stroke="black" d="M4273.94,-435.99C4116.21,-416.41 3858.16,-384.38 3696.25,-364.28"/>
<polygon fill="black" stroke="black" points="3696.57,-360.79 3686.21,-363.03 3695.7,-367.74 3696.57,-360.79"/>
</g>
<!-- l3_exp3 -->
<g id="node68" class="node">
<title>l3_exp3</title>
<polygon fill="lightpink" stroke="black" points="4177.5,-363 3782.5,-363 3782.5,-327 4177.5,-327 4177.5,-363"/>
<text text-anchor="middle" x="3980" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 3\n[128,2048,4096]\n×[4096,4096]\nGPU: 11</text>
</g>
<!-- l3_router&#45;&gt;l3_exp3 -->
<g id="edge101" class="edge">
<title>l3_router&#45;&gt;l3_exp3</title>
<path fill="none" stroke="black" d="M4342.23,-435.93C4264.97,-416.75 4139.78,-385.67 4058.68,-365.53"/>
<polygon fill="black" stroke="black" points="4059.07,-362.02 4048.52,-363.01 4057.39,-368.82 4059.07,-362.02"/>
</g>
<!-- l3_exp4 -->
<g id="node69" class="node">
<title>l3_exp4</title>
<polygon fill="lightpink" stroke="black" points="4608.5,-363 4213.5,-363 4213.5,-327 4608.5,-327 4608.5,-363"/>
<text text-anchor="middle" x="4411" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 4\n[128,2048,4096]\n×[4096,4096]\nGPU: 12</text>
</g>
<!-- l3_router&#45;&gt;l3_exp4 -->
<g id="edge103" class="edge">
<title>l3_router&#45;&gt;l3_exp4</title>
<path fill="none" stroke="black" d="M4411,-435.81C4411,-418.96 4411,-393.02 4411,-373.34"/>
<polygon fill="black" stroke="black" points="4414.5,-373.15 4411,-363.15 4407.5,-373.15 4414.5,-373.15"/>
</g>
<!-- l3_exp5 -->
<g id="node70" class="node">
<title>l3_exp5</title>
<polygon fill="lightpink" stroke="black" points="5039.5,-363 4644.5,-363 4644.5,-327 5039.5,-327 5039.5,-363"/>
<text text-anchor="middle" x="4842" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 5\n[128,2048,4096]\n×[4096,4096]\nGPU: 13</text>
</g>
<!-- l3_router&#45;&gt;l3_exp5 -->
<g id="edge105" class="edge">
<title>l3_router&#45;&gt;l3_exp5</title>
<path fill="none" stroke="black" d="M4479.77,-435.93C4557.03,-416.75 4682.22,-385.67 4763.32,-365.53"/>
<polygon fill="black" stroke="black" points="4764.61,-368.82 4773.48,-363.01 4762.93,-362.02 4764.61,-368.82"/>
</g>
<!-- l3_exp6 -->
<g id="node71" class="node">
<title>l3_exp6</title>
<polygon fill="lightpink" stroke="black" points="5470.5,-363 5075.5,-363 5075.5,-327 5470.5,-327 5470.5,-363"/>
<text text-anchor="middle" x="5273" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 6\n[128,2048,4096]\n×[4096,4096]\nGPU: 14</text>
</g>
<!-- l3_router&#45;&gt;l3_exp6 -->
<g id="edge107" class="edge">
<title>l3_router&#45;&gt;l3_exp6</title>
<path fill="none" stroke="black" d="M4548.06,-435.99C4705.79,-416.41 4963.84,-384.38 5125.75,-364.28"/>
<polygon fill="black" stroke="black" points="5126.3,-367.74 5135.79,-363.03 5125.43,-360.79 5126.3,-367.74"/>
</g>
<!-- l3_exp7 -->
<g id="node72" class="node">
<title>l3_exp7</title>
<polygon fill="lightpink" stroke="black" points="5901.5,-363 5506.5,-363 5506.5,-327 5901.5,-327 5901.5,-363"/>
<text text-anchor="middle" x="5704" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 7\n[128,2048,4096]\n×[4096,4096]\nGPU: 15</text>
</g>
<!-- l3_router&#45;&gt;l3_exp7 -->
<g id="edge109" class="edge">
<title>l3_router&#45;&gt;l3_exp7</title>
<path fill="none" stroke="black" d="M4616.59,-435.99C4857.45,-416.06 5254.23,-383.22 5496.08,-363.21"/>
<polygon fill="black" stroke="black" points="5496.73,-366.66 5506.41,-362.35 5496.15,-359.69 5496.73,-366.66"/>
</g>
<!-- l3_agg -->
<g id="node73" class="node">
<title>l3_agg</title>
<polygon fill="lightcyan" stroke="black" points="4938.86,-254 4099.15,-254 3883.14,-218 4722.85,-218 4938.86,-254"/>
<text text-anchor="middle" x="4411" y="-232.3" font-family="Times,serif" font-size="14.00">Expert Aggregation\n8×[128,2048,4096]\n→ [1024,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l3_exp0&#45;&gt;l3_agg -->
<g id="edge96" class="edge">
<title>l3_exp0&#45;&gt;l3_agg</title>
<path fill="none" stroke="black" d="M2893.16,-328.28C2899.18,-327.84 2905.13,-327.41 2911,-327 3316.6,-298.5 3784.31,-271.34 4088.16,-254.46"/>
<polygon fill="black" stroke="black" points="4088.66,-257.93 4098.45,-253.89 4088.27,-250.95 4088.66,-257.93"/>
</g>
<!-- l3_exp1&#45;&gt;l3_agg -->
<g id="edge98" class="edge">
<title>l3_exp1&#45;&gt;l3_agg</title>
<path fill="none" stroke="black" d="M3315.32,-327.95C3551.63,-308.34 3950.29,-275.24 4196.03,-254.85"/>
<polygon fill="black" stroke="black" points="4196.48,-258.32 4206.16,-254 4195.9,-251.34 4196.48,-258.32"/>
</g>
<!-- l3_exp2&#45;&gt;l3_agg -->
<g id="edge100" class="edge">
<title>l3_exp2&#45;&gt;l3_agg</title>
<path fill="none" stroke="black" d="M3686.06,-326.99C3843.79,-307.41 4101.84,-275.38 4263.75,-255.28"/>
<polygon fill="black" stroke="black" points="4264.3,-258.74 4273.79,-254.03 4263.43,-251.79 4264.3,-258.74"/>
</g>
<!-- l3_exp3&#45;&gt;l3_agg -->
<g id="edge102" class="edge">
<title>l3_exp3&#45;&gt;l3_agg</title>
<path fill="none" stroke="black" d="M4048.77,-326.93C4126.03,-307.75 4251.22,-276.67 4332.32,-256.53"/>
<polygon fill="black" stroke="black" points="4333.61,-259.82 4342.48,-254.01 4331.93,-253.02 4333.61,-259.82"/>
</g>
<!-- l3_exp4&#45;&gt;l3_agg -->
<g id="edge104" class="edge">
<title>l3_exp4&#45;&gt;l3_agg</title>
<path fill="none" stroke="black" d="M4411,-326.81C4411,-309.96 4411,-284.02 4411,-264.34"/>
<polygon fill="black" stroke="black" points="4414.5,-264.15 4411,-254.15 4407.5,-264.15 4414.5,-264.15"/>
</g>
<!-- l3_exp5&#45;&gt;l3_agg -->
<g id="edge106" class="edge">
<title>l3_exp5&#45;&gt;l3_agg</title>
<path fill="none" stroke="black" d="M4773.23,-326.93C4695.97,-307.75 4570.78,-276.67 4489.68,-256.53"/>
<polygon fill="black" stroke="black" points="4490.07,-253.02 4479.52,-254.01 4488.39,-259.82 4490.07,-253.02"/>
</g>
<!-- l3_exp6&#45;&gt;l3_agg -->
<g id="edge108" class="edge">
<title>l3_exp6&#45;&gt;l3_agg</title>
<path fill="none" stroke="black" d="M5135.94,-326.99C4978.21,-307.41 4720.16,-275.38 4558.25,-255.28"/>
<polygon fill="black" stroke="black" points="4558.57,-251.79 4548.21,-254.03 4557.7,-258.74 4558.57,-251.79"/>
</g>
<!-- l3_exp7&#45;&gt;l3_agg -->
<g id="edge110" class="edge">
<title>l3_exp7&#45;&gt;l3_agg</title>
<path fill="none" stroke="black" d="M5506.21,-327.63C5268.71,-307.98 4871.79,-275.13 4626.62,-254.84"/>
<polygon fill="black" stroke="black" points="4626.77,-251.34 4616.51,-254.01 4626.19,-258.32 4626.77,-251.34"/>
</g>
<!-- l3_agg&#45;&gt;l3_moe_res -->
<g id="edge111" class="edge">
<title>l3_agg&#45;&gt;l3_moe_res</title>
<path fill="none" stroke="black" d="M4526.76,-217.99C4659.44,-198.49 4876.16,-166.63 5013,-146.52"/>
<polygon fill="black" stroke="black" points="5013.73,-149.95 5023.12,-145.03 5012.72,-143.02 5013.73,-149.95"/>
</g>
<!-- l3_moe_res&#45;&gt;output -->
<g id="edge113" class="edge">
<title>l3_moe_res&#45;&gt;output</title>
<path fill="none" stroke="black" d="M5139,-108.81C5139,-91.96 5139,-66.02 5139,-46.34"/>
<polygon fill="black" stroke="black" points="5142.5,-46.15 5139,-36.15 5135.5,-46.15 5142.5,-46.15"/>
</g>
<!-- stage0_to_stage1&#45;&gt;l2_token_split -->
<g id="edge57" class="edge">
<title>stage0_to_stage1&#45;&gt;l2_token_split</title>
<path fill="none" stroke="black" d="M3600.75,-2294.99C3504.08,-2275 3344.08,-2241.92 3243.26,-2221.08"/>
<polygon fill="black" stroke="black" points="3243.9,-2217.63 3233.39,-2219.04 3242.48,-2224.49 3243.9,-2217.63"/>
</g>
<!-- stage0_to_stage1&#45;&gt;l2_attn_res -->
<g id="edge58" class="edge">
<title>stage0_to_stage1&#45;&gt;l2_attn_res</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M3683,-2294.85C3683,-2273.21 3683,-2234.85 3683,-2202 3683,-2202 3683,-2202 3683,-1764 3683,-1736.83 3683,-1705.77 3683,-1684.14"/>
<polygon fill="blue" stroke="blue" points="3686.5,-1684.05 3683,-1674.05 3679.5,-1684.05 3686.5,-1684.05"/>
<text text-anchor="middle" x="3714" y="-1979.3" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- stage0_to_stage1&#45;&gt;l2_attn_res -->
<g id="edge64" class="edge">
<title>stage0_to_stage1&#45;&gt;l2_attn_res</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M3731.38,-2294.94C3769.76,-2277.95 3817,-2247.75 3817,-2202 3817,-2202 3817,-2202 3817,-1764 3817,-1723.14 3778.49,-1695.34 3742.76,-1678.34"/>
<polygon fill="blue" stroke="blue" points="3743.83,-1674.98 3733.28,-1674.04 3740.94,-1681.36 3743.83,-1674.98"/>
<text text-anchor="middle" x="3848" y="-1979.3" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
</g>
</svg>
