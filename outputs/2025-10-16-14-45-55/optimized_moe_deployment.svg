<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: optimized_moe_model Pages: 1 -->
<svg width="5478pt" height="1381pt"
 viewBox="0.00 0.00 5478.00 1380.91" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1376.91)">
<title>optimized_moe_model</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1376.91 5474,-1376.91 5474,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage_0</title>
<polygon fill="none" stroke="red" stroke-dasharray="5,2" points="4070,-284.45 4070,-1245.95 5390,-1245.95 5390,-284.45 4070,-284.45"/>
<text text-anchor="middle" x="4730" y="-1230.75" font-family="Times,serif" font-size="14.00">Stage 0 (GPUs 0&#45;7)</text>
<text text-anchor="middle" x="4730" y="-1215.75" font-family="Times,serif" font-size="14.00">Attention + Communication</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_layer_0_attention</title>
<path fill="none" stroke="red" d="M4746,-292.45C4746,-292.45 5370,-292.45 5370,-292.45 5376,-292.45 5382,-298.45 5382,-304.45 5382,-304.45 5382,-1187.95 5382,-1187.95 5382,-1193.95 5376,-1199.95 5370,-1199.95 5370,-1199.95 4746,-1199.95 4746,-1199.95 4740,-1199.95 4734,-1193.95 4734,-1187.95 4734,-1187.95 4734,-304.45 4734,-304.45 4734,-298.45 4740,-292.45 4746,-292.45"/>
<text text-anchor="middle" x="5058" y="-1184.75" font-family="Times,serif" font-size="14.00">Layer 0 Attention</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_layer_1_attention</title>
<path fill="none" stroke="red" d="M4090,-292.45C4090,-292.45 4714,-292.45 4714,-292.45 4720,-292.45 4726,-298.45 4726,-304.45 4726,-304.45 4726,-1187.95 4726,-1187.95 4726,-1193.95 4720,-1199.95 4714,-1199.95 4714,-1199.95 4090,-1199.95 4090,-1199.95 4084,-1199.95 4078,-1193.95 4078,-1187.95 4078,-1187.95 4078,-304.45 4078,-304.45 4078,-298.45 4084,-292.45 4090,-292.45"/>
<text text-anchor="middle" x="4402" y="-1184.75" font-family="Times,serif" font-size="14.00">Layer 1 Attention</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_stage_1</title>
<polygon fill="none" stroke="blue" stroke-dasharray="5,2" points="18,-131.95 18,-912.95 3984,-912.95 3984,-131.95 18,-131.95"/>
<text text-anchor="middle" x="2001" y="-897.75" font-family="Times,serif" font-size="14.00">Stage 1 (GPUs 8&#45;15)</text>
<text text-anchor="middle" x="2001" y="-882.75" font-family="Times,serif" font-size="14.00">MoE + Communication</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_layer_0_moe</title>
<path fill="none" stroke="blue" d="M38,-139.95C38,-139.95 1985,-139.95 1985,-139.95 1991,-139.95 1997,-145.95 1997,-151.95 1997,-151.95 1997,-854.95 1997,-854.95 1997,-860.95 1991,-866.95 1985,-866.95 1985,-866.95 38,-866.95 38,-866.95 32,-866.95 26,-860.95 26,-854.95 26,-854.95 26,-151.95 26,-151.95 26,-145.95 32,-139.95 38,-139.95"/>
<text text-anchor="middle" x="1011.5" y="-851.75" font-family="Times,serif" font-size="14.00">Layer 0 MoE</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_layer_1_moe</title>
<path fill="none" stroke="blue" d="M2017,-139.95C2017,-139.95 3964,-139.95 3964,-139.95 3970,-139.95 3976,-145.95 3976,-151.95 3976,-151.95 3976,-854.95 3976,-854.95 3976,-860.95 3970,-866.95 3964,-866.95 3964,-866.95 2017,-866.95 2017,-866.95 2011,-866.95 2005,-860.95 2005,-854.95 2005,-854.95 2005,-151.95 2005,-151.95 2005,-145.95 2011,-139.95 2017,-139.95"/>
<text text-anchor="middle" x="2990.5" y="-851.75" font-family="Times,serif" font-size="14.00">Layer 1 MoE</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightgreen" stroke="black" cx="5233" cy="-1335.43" rx="108" ry="37.45"/>
<text text-anchor="middle" x="5233" y="-1346.73" font-family="Times,serif" font-size="14.00">Input Embedding</text>
<text text-anchor="middle" x="5233" y="-1331.73" font-family="Times,serif" font-size="14.00">[1024,2048,4096]</text>
<text text-anchor="middle" x="5233" y="-1316.73" font-family="Times,serif" font-size="14.00">GPU: All</text>
</g>
<!-- l0_token_split -->
<g id="node3" class="node">
<title>l0_token_split</title>
<polygon fill="lightcyan" stroke="black" points="5374.42,-1168.95 4871.07,-1168.95 4741.58,-1062.95 5244.93,-1062.95 5374.42,-1168.95"/>
<text text-anchor="middle" x="5058" y="-1127.25" font-family="Times,serif" font-size="14.00">Token Split</text>
<text text-anchor="middle" x="5058" y="-1112.25" font-family="Times,serif" font-size="14.00">[1024,2048,4096] → 8×[128,2048,4096]</text>
<text text-anchor="middle" x="5058" y="-1097.25" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- input&#45;&gt;l0_token_split -->
<g id="edge47" class="edge">
<title>input&#45;&gt;l0_token_split</title>
<path fill="none" stroke="black" d="M5233,-1297.7C5233,-1297.7 5233,-1179.2 5233,-1179.2"/>
<polygon fill="black" stroke="black" points="5236.5,-1179.2 5233,-1169.2 5229.5,-1179.2 5236.5,-1179.2"/>
<text text-anchor="middle" x="5224.5" y="-1257.75" font-family="Times,serif" font-size="14.00">Broadcast</text>
</g>
<!-- l0_residual -->
<g id="node8" class="node">
<title>l0_residual</title>
<polygon fill="orange" stroke="black" points="5008,-353.45 4864,-353.45 4864,-300.45 5008,-300.45 5008,-353.45"/>
<text text-anchor="middle" x="4936" y="-338.25" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4936" y="-323.25" font-family="Times,serif" font-size="14.00">[1024,2048,4096]</text>
<text text-anchor="middle" x="4936" y="-308.25" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- input&#45;&gt;l0_residual -->
<g id="edge48" class="edge">
<title>input&#45;&gt;l0_residual</title>
<path fill="none" stroke="black" d="M5341.4,-1335C5369.59,-1335 5392.21,-1335 5392.21,-1335 5392.21,-1335 5392.21,-326 5392.21,-326 5392.21,-326 5018.04,-326 5018.04,-326"/>
<polygon fill="black" stroke="black" points="5018.04,-322.5 5008.04,-326 5018.04,-329.5 5018.04,-322.5"/>
<text text-anchor="middle" x="5439" y="-805.75" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- output -->
<g id="node2" class="node">
<title>output</title>
<ellipse fill="lightgreen" stroke="black" cx="3699" cy="-37.48" rx="108" ry="37.45"/>
<text text-anchor="middle" x="3699" y="-48.78" font-family="Times,serif" font-size="14.00">Final Output</text>
<text text-anchor="middle" x="3699" y="-33.78" font-family="Times,serif" font-size="14.00">[1024,2048,4096]</text>
<text text-anchor="middle" x="3699" y="-18.78" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- l0_qkv_proj -->
<g id="node4" class="node">
<title>l0_qkv_proj</title>
<polygon fill="yellow" stroke="black" points="5170.5,-1003.95 4945.5,-1003.95 4945.5,-950.95 5170.5,-950.95 5170.5,-1003.95"/>
<text text-anchor="middle" x="5058" y="-988.75" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="5058" y="-973.75" font-family="Times,serif" font-size="14.00">[128,2048,4096]×[4096,512]</text>
<text text-anchor="middle" x="5058" y="-958.75" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- l0_token_split&#45;&gt;l0_qkv_proj -->
<g id="edge1" class="edge">
<title>l0_token_split&#45;&gt;l0_qkv_proj</title>
<path fill="none" stroke="black" d="M5058,-1062.8C5058,-1062.8 5058,-1014.33 5058,-1014.33"/>
<polygon fill="black" stroke="black" points="5061.5,-1014.33 5058,-1004.33 5054.5,-1014.33 5061.5,-1014.33"/>
</g>
<!-- l0_attention -->
<g id="node5" class="node">
<title>l0_attention</title>
<polygon fill="yellow" stroke="black" points="5142,-835.95 4974,-835.95 4974,-782.95 5142,-782.95 5142,-835.95"/>
<text text-anchor="middle" x="5058" y="-820.75" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="5058" y="-805.75" font-family="Times,serif" font-size="14.00">[128,2048,512]</text>
<text text-anchor="middle" x="5058" y="-790.75" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- l0_qkv_proj&#45;&gt;l0_attention -->
<g id="edge2" class="edge">
<title>l0_qkv_proj&#45;&gt;l0_attention</title>
<path fill="none" stroke="black" d="M5058,-950.83C5058,-950.83 5058,-846.23 5058,-846.23"/>
<polygon fill="black" stroke="black" points="5061.5,-846.23 5058,-836.23 5054.5,-846.23 5061.5,-846.23"/>
</g>
<!-- l0_out_proj -->
<g id="node6" class="node">
<title>l0_out_proj</title>
<polygon fill="yellow" stroke="black" points="5166,-697.45 4950,-697.45 4950,-644.45 5166,-644.45 5166,-697.45"/>
<text text-anchor="middle" x="5058" y="-682.25" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="5058" y="-667.25" font-family="Times,serif" font-size="14.00">[128,2048,512]×[512,4096]</text>
<text text-anchor="middle" x="5058" y="-652.25" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- l0_attention&#45;&gt;l0_out_proj -->
<g id="edge3" class="edge">
<title>l0_attention&#45;&gt;l0_out_proj</title>
<path fill="none" stroke="black" d="M5058,-782.75C5058,-782.75 5058,-707.58 5058,-707.58"/>
<polygon fill="black" stroke="black" points="5061.5,-707.58 5058,-697.58 5054.5,-707.58 5061.5,-707.58"/>
</g>
<!-- l0_token_gather -->
<g id="node7" class="node">
<title>l0_token_gather</title>
<polygon fill="lightcyan" stroke="black" points="5374.42,-544.95 4871.07,-544.95 4741.58,-438.95 5244.93,-438.95 5374.42,-544.95"/>
<text text-anchor="middle" x="5058" y="-503.25" font-family="Times,serif" font-size="14.00">Token Gather</text>
<text text-anchor="middle" x="5058" y="-488.25" font-family="Times,serif" font-size="14.00">8×[128,2048,4096] → [1024,2048,4096]</text>
<text text-anchor="middle" x="5058" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- l0_out_proj&#45;&gt;l0_token_gather -->
<g id="edge4" class="edge">
<title>l0_out_proj&#45;&gt;l0_token_gather</title>
<path fill="none" stroke="black" d="M5058,-644.16C5058,-644.16 5058,-555.26 5058,-555.26"/>
<polygon fill="black" stroke="black" points="5061.5,-555.26 5058,-545.26 5054.5,-555.26 5061.5,-555.26"/>
</g>
<!-- l0_token_gather&#45;&gt;l0_residual -->
<g id="edge5" class="edge">
<title>l0_token_gather&#45;&gt;l0_residual</title>
<path fill="none" stroke="black" d="M4960,-438.84C4960,-438.84 4960,-363.62 4960,-363.62"/>
<polygon fill="black" stroke="black" points="4963.5,-363.62 4960,-353.62 4956.5,-363.62 4963.5,-363.62"/>
</g>
<!-- l0_gate -->
<g id="node15" class="node">
<title>l0_gate</title>
<polygon fill="lightcoral" stroke="black" points="1802.5,-835.95 1577.5,-835.95 1577.5,-782.95 1802.5,-782.95 1802.5,-835.95"/>
<text text-anchor="middle" x="1690" y="-820.75" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="1690" y="-805.75" font-family="Times,serif" font-size="14.00">[1024,2048,4096]×[4096,16]</text>
<text text-anchor="middle" x="1690" y="-790.75" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- l0_residual&#45;&gt;l0_gate -->
<g id="edge49" class="edge">
<title>l0_residual&#45;&gt;l0_gate</title>
<path fill="none" stroke="black" d="M4912,-353.82C4912,-377.75 4912,-409 4912,-409 4912,-409 1752.5,-409 1752.5,-409 1752.5,-409 1752.5,-772.87 1752.5,-772.87"/>
<polygon fill="black" stroke="black" points="1749,-772.87 1752.5,-782.87 1756,-772.87 1749,-772.87"/>
<text text-anchor="middle" x="4033.5" y="-577.75" font-family="Times,serif" font-size="14.00">Stage 1</text>
</g>
<!-- l0_moe_residual -->
<g id="node26" class="node">
<title>l0_moe_residual</title>
<polygon fill="orange" stroke="black" points="1794,-200.95 1646,-200.95 1646,-147.95 1794,-147.95 1794,-200.95"/>
<text text-anchor="middle" x="1720" y="-185.75" font-family="Times,serif" font-size="14.00">MoE Residual Add</text>
<text text-anchor="middle" x="1720" y="-170.75" font-family="Times,serif" font-size="14.00">[1024,2048,4096]</text>
<text text-anchor="middle" x="1720" y="-155.75" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- l0_residual&#45;&gt;l0_moe_residual -->
<g id="edge50" class="edge">
<title>l0_residual&#45;&gt;l0_moe_residual</title>
<path fill="none" stroke="black" d="M4936,-300.45C4936,-273.92 4936,-237 4936,-237 4936,-237 1773.67,-237 1773.67,-237 1773.67,-237 1773.67,-210.98 1773.67,-210.98"/>
<polygon fill="black" stroke="black" points="1777.17,-210.98 1773.67,-200.98 1770.17,-210.98 1777.17,-210.98"/>
<text text-anchor="middle" x="4553" y="-233.75" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- l1_token_split -->
<g id="node9" class="node">
<title>l1_token_split</title>
<polygon fill="lightcyan" stroke="black" points="4718.42,-1168.95 4215.07,-1168.95 4085.58,-1062.95 4588.93,-1062.95 4718.42,-1168.95"/>
<text text-anchor="middle" x="4402" y="-1127.25" font-family="Times,serif" font-size="14.00">Token Split</text>
<text text-anchor="middle" x="4402" y="-1112.25" font-family="Times,serif" font-size="14.00">[1024,2048,4096] → 8×[128,2048,4096]</text>
<text text-anchor="middle" x="4402" y="-1097.25" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- l1_qkv_proj -->
<g id="node10" class="node">
<title>l1_qkv_proj</title>
<polygon fill="yellow" stroke="black" points="4514.5,-1003.95 4289.5,-1003.95 4289.5,-950.95 4514.5,-950.95 4514.5,-1003.95"/>
<text text-anchor="middle" x="4402" y="-988.75" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="4402" y="-973.75" font-family="Times,serif" font-size="14.00">[128,2048,4096]×[4096,512]</text>
<text text-anchor="middle" x="4402" y="-958.75" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- l1_token_split&#45;&gt;l1_qkv_proj -->
<g id="edge6" class="edge">
<title>l1_token_split&#45;&gt;l1_qkv_proj</title>
<path fill="none" stroke="black" d="M4402,-1062.8C4402,-1062.8 4402,-1014.33 4402,-1014.33"/>
<polygon fill="black" stroke="black" points="4405.5,-1014.33 4402,-1004.33 4398.5,-1014.33 4405.5,-1014.33"/>
</g>
<!-- l1_attention -->
<g id="node11" class="node">
<title>l1_attention</title>
<polygon fill="yellow" stroke="black" points="4486,-835.95 4318,-835.95 4318,-782.95 4486,-782.95 4486,-835.95"/>
<text text-anchor="middle" x="4402" y="-820.75" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="4402" y="-805.75" font-family="Times,serif" font-size="14.00">[128,2048,512]</text>
<text text-anchor="middle" x="4402" y="-790.75" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- l1_qkv_proj&#45;&gt;l1_attention -->
<g id="edge7" class="edge">
<title>l1_qkv_proj&#45;&gt;l1_attention</title>
<path fill="none" stroke="black" d="M4402,-950.83C4402,-950.83 4402,-846.23 4402,-846.23"/>
<polygon fill="black" stroke="black" points="4405.5,-846.23 4402,-836.23 4398.5,-846.23 4405.5,-846.23"/>
</g>
<!-- l1_out_proj -->
<g id="node12" class="node">
<title>l1_out_proj</title>
<polygon fill="yellow" stroke="black" points="4510,-697.45 4294,-697.45 4294,-644.45 4510,-644.45 4510,-697.45"/>
<text text-anchor="middle" x="4402" y="-682.25" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="4402" y="-667.25" font-family="Times,serif" font-size="14.00">[128,2048,512]×[512,4096]</text>
<text text-anchor="middle" x="4402" y="-652.25" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- l1_attention&#45;&gt;l1_out_proj -->
<g id="edge8" class="edge">
<title>l1_attention&#45;&gt;l1_out_proj</title>
<path fill="none" stroke="black" d="M4402,-782.75C4402,-782.75 4402,-707.58 4402,-707.58"/>
<polygon fill="black" stroke="black" points="4405.5,-707.58 4402,-697.58 4398.5,-707.58 4405.5,-707.58"/>
</g>
<!-- l1_token_gather -->
<g id="node13" class="node">
<title>l1_token_gather</title>
<polygon fill="lightcyan" stroke="black" points="4718.42,-544.95 4215.07,-544.95 4085.58,-438.95 4588.93,-438.95 4718.42,-544.95"/>
<text text-anchor="middle" x="4402" y="-503.25" font-family="Times,serif" font-size="14.00">Token Gather</text>
<text text-anchor="middle" x="4402" y="-488.25" font-family="Times,serif" font-size="14.00">8×[128,2048,4096] → [1024,2048,4096]</text>
<text text-anchor="middle" x="4402" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- l1_out_proj&#45;&gt;l1_token_gather -->
<g id="edge9" class="edge">
<title>l1_out_proj&#45;&gt;l1_token_gather</title>
<path fill="none" stroke="black" d="M4402,-644.16C4402,-644.16 4402,-555.26 4402,-555.26"/>
<polygon fill="black" stroke="black" points="4405.5,-555.26 4402,-545.26 4398.5,-555.26 4405.5,-555.26"/>
</g>
<!-- l1_residual -->
<g id="node14" class="node">
<title>l1_residual</title>
<polygon fill="orange" stroke="black" points="4230,-353.45 4086,-353.45 4086,-300.45 4230,-300.45 4230,-353.45"/>
<text text-anchor="middle" x="4158" y="-338.25" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4158" y="-323.25" font-family="Times,serif" font-size="14.00">[1024,2048,4096]</text>
<text text-anchor="middle" x="4158" y="-308.25" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- l1_token_gather&#45;&gt;l1_residual -->
<g id="edge10" class="edge">
<title>l1_token_gather&#45;&gt;l1_residual</title>
<path fill="none" stroke="black" d="M4158,-438.84C4158,-438.84 4158,-363.62 4158,-363.62"/>
<polygon fill="black" stroke="black" points="4161.5,-363.62 4158,-353.62 4154.5,-363.62 4161.5,-363.62"/>
</g>
<!-- l1_gate -->
<g id="node27" class="node">
<title>l1_gate</title>
<polygon fill="lightcoral" stroke="black" points="3781.5,-835.95 3556.5,-835.95 3556.5,-782.95 3781.5,-782.95 3781.5,-835.95"/>
<text text-anchor="middle" x="3669" y="-820.75" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="3669" y="-805.75" font-family="Times,serif" font-size="14.00">[1024,2048,4096]×[4096,16]</text>
<text text-anchor="middle" x="3669" y="-790.75" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- l1_residual&#45;&gt;l1_gate -->
<g id="edge53" class="edge">
<title>l1_residual&#45;&gt;l1_gate</title>
<path fill="none" stroke="black" d="M4085.65,-340C3963.97,-340 3731.5,-340 3731.5,-340 3731.5,-340 3731.5,-772.87 3731.5,-772.87"/>
<polygon fill="black" stroke="black" points="3728,-772.87 3731.5,-782.87 3735,-772.87 3728,-772.87"/>
<text text-anchor="middle" x="4115.5" y="-577.75" font-family="Times,serif" font-size="14.00">Stage 1</text>
</g>
<!-- l1_moe_residual -->
<g id="node38" class="node">
<title>l1_moe_residual</title>
<polygon fill="orange" stroke="black" points="3773,-200.95 3625,-200.95 3625,-147.95 3773,-147.95 3773,-200.95"/>
<text text-anchor="middle" x="3699" y="-185.75" font-family="Times,serif" font-size="14.00">MoE Residual Add</text>
<text text-anchor="middle" x="3699" y="-170.75" font-family="Times,serif" font-size="14.00">[1024,2048,4096]</text>
<text text-anchor="middle" x="3699" y="-155.75" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- l1_residual&#45;&gt;l1_moe_residual -->
<g id="edge54" class="edge">
<title>l1_residual&#45;&gt;l1_moe_residual</title>
<path fill="none" stroke="black" d="M4085.98,-313C3972,-313 3762.83,-313 3762.83,-313 3762.83,-313 3762.83,-211.17 3762.83,-211.17"/>
<polygon fill="black" stroke="black" points="3766.33,-211.17 3762.83,-201.17 3759.33,-211.17 3766.33,-211.17"/>
<text text-anchor="middle" x="4173" y="-233.75" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- l0_expert_split -->
<g id="node16" class="node">
<title>l0_expert_split</title>
<polygon fill="lightcyan" stroke="black" points="1385.79,-723.95 986.84,-723.95 884.21,-617.95 1283.16,-617.95 1385.79,-723.95"/>
<text text-anchor="middle" x="1135" y="-682.25" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="1135" y="-667.25" font-family="Times,serif" font-size="14.00">[1024,2048,4096] → 16 experts</text>
<text text-anchor="middle" x="1135" y="-652.25" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- l0_gate&#45;&gt;l0_expert_split -->
<g id="edge11" class="edge">
<title>l0_gate&#45;&gt;l0_expert_split</title>
<path fill="none" stroke="black" d="M1659.5,-782.85C1659.5,-744.44 1659.5,-678 1659.5,-678 1659.5,-678 1351.54,-678 1351.54,-678"/>
<polygon fill="black" stroke="black" points="1351.54,-674.5 1341.54,-678 1351.54,-681.5 1351.54,-674.5"/>
</g>
<!-- l0_exp_0 -->
<g id="node17" class="node">
<title>l0_exp_0</title>
<polygon fill="lightpink" stroke="black" points="259.5,-518.45 34.5,-518.45 34.5,-465.45 259.5,-465.45 259.5,-518.45"/>
<text text-anchor="middle" x="147" y="-503.25" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="147" y="-488.25" font-family="Times,serif" font-size="14.00">[64,2048,4096]×[4096,4096]</text>
<text text-anchor="middle" x="147" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- l0_expert_split&#45;&gt;l0_exp_0 -->
<g id="edge12" class="edge">
<title>l0_expert_split&#45;&gt;l0_exp_0</title>
<path fill="none" stroke="black" d="M960.64,-697C677,-697 147,-697 147,-697 147,-697 147,-528.76 147,-528.76"/>
<polygon fill="black" stroke="black" points="150.5,-528.76 147,-518.76 143.5,-528.76 150.5,-528.76"/>
</g>
<!-- l0_exp_1 -->
<g id="node18" class="node">
<title>l0_exp_1</title>
<polygon fill="lightpink" stroke="black" points="506.5,-518.45 281.5,-518.45 281.5,-465.45 506.5,-465.45 506.5,-518.45"/>
<text text-anchor="middle" x="394" y="-503.25" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="394" y="-488.25" font-family="Times,serif" font-size="14.00">[64,2048,4096]×[4096,4096]</text>
<text text-anchor="middle" x="394" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- l0_expert_split&#45;&gt;l0_exp_1 -->
<g id="edge13" class="edge">
<title>l0_expert_split&#45;&gt;l0_exp_1</title>
<path fill="none" stroke="black" d="M934.47,-670C715.02,-670 394,-670 394,-670 394,-670 394,-528.61 394,-528.61"/>
<polygon fill="black" stroke="black" points="397.5,-528.61 394,-518.61 390.5,-528.61 397.5,-528.61"/>
</g>
<!-- l0_exp_2 -->
<g id="node19" class="node">
<title>l0_exp_2</title>
<polygon fill="lightpink" stroke="black" points="753.5,-518.45 528.5,-518.45 528.5,-465.45 753.5,-465.45 753.5,-518.45"/>
<text text-anchor="middle" x="641" y="-503.25" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="641" y="-488.25" font-family="Times,serif" font-size="14.00">[64,2048,4096]×[4096,4096]</text>
<text text-anchor="middle" x="641" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- l0_expert_split&#45;&gt;l0_exp_2 -->
<g id="edge14" class="edge">
<title>l0_expert_split&#45;&gt;l0_exp_2</title>
<path fill="none" stroke="black" d="M909.32,-644C779.14,-644 641,-644 641,-644 641,-644 641,-528.79 641,-528.79"/>
<polygon fill="black" stroke="black" points="644.5,-528.79 641,-518.79 637.5,-528.79 644.5,-528.79"/>
</g>
<!-- l0_exp_3 -->
<g id="node20" class="node">
<title>l0_exp_3</title>
<polygon fill="lightpink" stroke="black" points="1000.5,-518.45 775.5,-518.45 775.5,-465.45 1000.5,-465.45 1000.5,-518.45"/>
<text text-anchor="middle" x="888" y="-503.25" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="888" y="-488.25" font-family="Times,serif" font-size="14.00">[64,2048,4096]×[4096,4096]</text>
<text text-anchor="middle" x="888" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- l0_expert_split&#45;&gt;l0_exp_3 -->
<g id="edge15" class="edge">
<title>l0_expert_split&#45;&gt;l0_exp_3</title>
<path fill="none" stroke="black" d="M942.3,-617.73C942.3,-617.73 942.3,-528.82 942.3,-528.82"/>
<polygon fill="black" stroke="black" points="945.8,-528.82 942.3,-518.82 938.8,-528.82 945.8,-528.82"/>
</g>
<!-- l0_exp_4 -->
<g id="node21" class="node">
<title>l0_exp_4</title>
<polygon fill="lightpink" stroke="black" points="1247.5,-518.45 1022.5,-518.45 1022.5,-465.45 1247.5,-465.45 1247.5,-518.45"/>
<text text-anchor="middle" x="1135" y="-503.25" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1135" y="-488.25" font-family="Times,serif" font-size="14.00">[64,2048,4096]×[4096,4096]</text>
<text text-anchor="middle" x="1135" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- l0_expert_split&#45;&gt;l0_exp_4 -->
<g id="edge16" class="edge">
<title>l0_expert_split&#45;&gt;l0_exp_4</title>
<path fill="none" stroke="black" d="M1135,-617.73C1135,-617.73 1135,-528.82 1135,-528.82"/>
<polygon fill="black" stroke="black" points="1138.5,-528.82 1135,-518.82 1131.5,-528.82 1138.5,-528.82"/>
</g>
<!-- l0_exp_5 -->
<g id="node22" class="node">
<title>l0_exp_5</title>
<polygon fill="lightpink" stroke="black" points="1494.5,-518.45 1269.5,-518.45 1269.5,-465.45 1494.5,-465.45 1494.5,-518.45"/>
<text text-anchor="middle" x="1382" y="-503.25" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1382" y="-488.25" font-family="Times,serif" font-size="14.00">[64,2048,4096]×[4096,4096]</text>
<text text-anchor="middle" x="1382" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- l0_expert_split&#45;&gt;l0_exp_5 -->
<g id="edge17" class="edge">
<title>l0_expert_split&#45;&gt;l0_exp_5</title>
<path fill="none" stroke="black" d="M1327.7,-663.71C1327.7,-663.71 1327.7,-528.68 1327.7,-528.68"/>
<polygon fill="black" stroke="black" points="1331.2,-528.68 1327.7,-518.68 1324.2,-528.68 1331.2,-528.68"/>
</g>
<!-- l0_exp_6 -->
<g id="node23" class="node">
<title>l0_exp_6</title>
<polygon fill="lightpink" stroke="black" points="1741.5,-518.45 1516.5,-518.45 1516.5,-465.45 1741.5,-465.45 1741.5,-518.45"/>
<text text-anchor="middle" x="1629" y="-503.25" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1629" y="-488.25" font-family="Times,serif" font-size="14.00">[64,2048,4096]×[4096,4096]</text>
<text text-anchor="middle" x="1629" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- l0_expert_split&#45;&gt;l0_exp_6 -->
<g id="edge18" class="edge">
<title>l0_expert_split&#45;&gt;l0_exp_6</title>
<path fill="none" stroke="black" d="M1297.83,-633C1412.99,-633 1547,-633 1547,-633 1547,-633 1547,-528.48 1547,-528.48"/>
<polygon fill="black" stroke="black" points="1550.5,-528.48 1547,-518.48 1543.5,-528.48 1550.5,-528.48"/>
</g>
<!-- l0_exp_7 -->
<g id="node24" class="node">
<title>l0_exp_7</title>
<polygon fill="lightpink" stroke="black" points="1988.5,-518.45 1763.5,-518.45 1763.5,-465.45 1988.5,-465.45 1988.5,-518.45"/>
<text text-anchor="middle" x="1876" y="-503.25" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="1876" y="-488.25" font-family="Times,serif" font-size="14.00">[64,2048,4096]×[4096,4096]</text>
<text text-anchor="middle" x="1876" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- l0_expert_split&#45;&gt;l0_exp_7 -->
<g id="edge19" class="edge">
<title>l0_expert_split&#45;&gt;l0_exp_7</title>
<path fill="none" stroke="black" d="M1326.79,-663C1517.87,-663 1783,-663 1783,-663 1783,-663 1783,-528.68 1783,-528.68"/>
<polygon fill="black" stroke="black" points="1786.5,-528.68 1783,-518.68 1779.5,-528.68 1786.5,-528.68"/>
</g>
<!-- l0_expert_merge -->
<g id="node25" class="node">
<title>l0_expert_merge</title>
<polygon fill="lightcyan" stroke="black" points="1451.42,-379.95 948.07,-379.95 818.58,-273.95 1321.93,-273.95 1451.42,-379.95"/>
<text text-anchor="middle" x="1135" y="-338.25" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1135" y="-323.25" font-family="Times,serif" font-size="14.00">16×[64,2048,4096] → [1024,2048,4096]</text>
<text text-anchor="middle" x="1135" y="-308.25" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- l0_exp_0&#45;&gt;l0_expert_merge -->
<g id="edge20" class="edge">
<title>l0_exp_0&#45;&gt;l0_expert_merge</title>
<path fill="none" stroke="black" d="M147,-465.26C147,-412.52 147,-300 147,-300 147,-300 840.22,-300 840.22,-300"/>
<polygon fill="black" stroke="black" points="840.22,-303.5 850.22,-300 840.22,-296.5 840.22,-303.5"/>
</g>
<!-- l0_exp_1&#45;&gt;l0_expert_merge -->
<g id="edge21" class="edge">
<title>l0_exp_1&#45;&gt;l0_expert_merge</title>
<path fill="none" stroke="black" d="M394,-465.29C394,-418.38 394,-326 394,-326 394,-326 872.06,-326 872.06,-326"/>
<polygon fill="black" stroke="black" points="872.06,-329.5 882.06,-326 872.06,-322.5 872.06,-329.5"/>
</g>
<!-- l0_exp_2&#45;&gt;l0_expert_merge -->
<g id="edge22" class="edge">
<title>l0_exp_2&#45;&gt;l0_expert_merge</title>
<path fill="none" stroke="black" d="M641,-465.16C641,-424.78 641,-353 641,-353 641,-353 905.09,-353 905.09,-353"/>
<polygon fill="black" stroke="black" points="905.09,-356.5 915.09,-353 905.09,-349.5 905.09,-356.5"/>
</g>
<!-- l0_exp_3&#45;&gt;l0_expert_merge -->
<g id="edge23" class="edge">
<title>l0_exp_3&#45;&gt;l0_expert_merge</title>
<path fill="none" stroke="black" d="M909.65,-465.44C909.65,-465.44 909.65,-358.66 909.65,-358.66"/>
<polygon fill="black" stroke="black" points="913.15,-358.66 909.65,-348.66 906.15,-358.66 913.15,-358.66"/>
</g>
<!-- l0_exp_4&#45;&gt;l0_expert_merge -->
<g id="edge24" class="edge">
<title>l0_exp_4&#45;&gt;l0_expert_merge</title>
<path fill="none" stroke="black" d="M1135,-465.44C1135,-465.44 1135,-390.06 1135,-390.06"/>
<polygon fill="black" stroke="black" points="1138.5,-390.06 1135,-380.06 1131.5,-390.06 1138.5,-390.06"/>
</g>
<!-- l0_exp_5&#45;&gt;l0_expert_merge -->
<g id="edge25" class="edge">
<title>l0_exp_5&#45;&gt;l0_expert_merge</title>
<path fill="none" stroke="black" d="M1360.35,-465.44C1360.35,-465.44 1360.35,-390.06 1360.35,-390.06"/>
<polygon fill="black" stroke="black" points="1363.85,-390.06 1360.35,-380.06 1356.85,-390.06 1363.85,-390.06"/>
</g>
<!-- l0_exp_6&#45;&gt;l0_expert_merge -->
<g id="edge26" class="edge">
<title>l0_exp_6&#45;&gt;l0_expert_merge</title>
<path fill="none" stroke="black" d="M1581.25,-465.31C1581.25,-416.79 1581.25,-319 1581.25,-319 1581.25,-319 1387.06,-319 1387.06,-319"/>
<polygon fill="black" stroke="black" points="1387.06,-315.5 1377.06,-319 1387.06,-322.5 1387.06,-315.5"/>
</g>
<!-- l0_exp_7&#45;&gt;l0_expert_merge -->
<g id="edge27" class="edge">
<title>l0_exp_7&#45;&gt;l0_expert_merge</title>
<path fill="none" stroke="black" d="M1783.83,-465.42C1783.83,-413.61 1783.83,-304 1783.83,-304 1783.83,-304 1368.75,-304 1368.75,-304"/>
<polygon fill="black" stroke="black" points="1368.75,-300.5 1358.75,-304 1368.75,-307.5 1368.75,-300.5"/>
</g>
<!-- l0_expert_merge&#45;&gt;l0_moe_residual -->
<g id="edge28" class="edge">
<title>l0_expert_merge&#45;&gt;l0_moe_residual</title>
<path fill="none" stroke="black" d="M1340.68,-289C1500,-289 1693.75,-289 1693.75,-289 1693.75,-289 1693.75,-211.02 1693.75,-211.02"/>
<polygon fill="black" stroke="black" points="1697.25,-211.02 1693.75,-201.02 1690.25,-211.02 1697.25,-211.02"/>
</g>
<!-- l0_moe_residual&#45;&gt;l1_token_split -->
<g id="edge51" class="edge">
<title>l0_moe_residual&#45;&gt;l1_token_split</title>
<path fill="none" stroke="black" d="M1794.26,-183C2128.93,-183 3480.83,-183 3480.83,-183 3480.83,-183 3480.83,-1115 3480.83,-1115 3480.83,-1115 4139.07,-1115 4139.07,-1115"/>
<polygon fill="black" stroke="black" points="4139.07,-1118.5 4149.07,-1115 4139.07,-1111.5 4139.07,-1118.5"/>
<text text-anchor="middle" x="32.5" y="-667.25" font-family="Times,serif" font-size="14.00">Continue</text>
</g>
<!-- l0_moe_residual&#45;&gt;l1_residual -->
<g id="edge52" class="edge">
<title>l0_moe_residual&#45;&gt;l1_residual</title>
<path fill="none" stroke="black" d="M1794,-165C2129.12,-165 3488.17,-165 3488.17,-165 3488.17,-165 3488.17,-326 3488.17,-326 3488.17,-326 4076,-326 4076,-326"/>
<polygon fill="black" stroke="black" points="4076,-329.5 4086,-326 4076,-322.5 4076,-329.5"/>
<text text-anchor="middle" x="4068" y="-233.75" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- l1_expert_split -->
<g id="node28" class="node">
<title>l1_expert_split</title>
<polygon fill="lightcyan" stroke="black" points="3364.79,-723.95 2965.84,-723.95 2863.21,-617.95 3262.16,-617.95 3364.79,-723.95"/>
<text text-anchor="middle" x="3114" y="-682.25" font-family="Times,serif" font-size="14.00">Expert Routing</text>
<text text-anchor="middle" x="3114" y="-667.25" font-family="Times,serif" font-size="14.00">[1024,2048,4096] → 16 experts</text>
<text text-anchor="middle" x="3114" y="-652.25" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- l1_gate&#45;&gt;l1_expert_split -->
<g id="edge29" class="edge">
<title>l1_gate&#45;&gt;l1_expert_split</title>
<path fill="none" stroke="black" d="M3638.5,-782.8C3638.5,-753.34 3638.5,-710 3638.5,-710 3638.5,-710 3361.31,-710 3361.31,-710"/>
<polygon fill="black" stroke="black" points="3361.31,-706.5 3351.31,-710 3361.31,-713.5 3361.31,-706.5"/>
</g>
<!-- l1_exp_0 -->
<g id="node29" class="node">
<title>l1_exp_0</title>
<polygon fill="lightpink" stroke="black" points="2238.5,-518.45 2013.5,-518.45 2013.5,-465.45 2238.5,-465.45 2238.5,-518.45"/>
<text text-anchor="middle" x="2126" y="-503.25" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2126" y="-488.25" font-family="Times,serif" font-size="14.00">[64,2048,4096]×[4096,4096]</text>
<text text-anchor="middle" x="2126" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- l1_expert_split&#45;&gt;l1_exp_0 -->
<g id="edge30" class="edge">
<title>l1_expert_split&#45;&gt;l1_exp_0</title>
<path fill="none" stroke="black" d="M2950.3,-708C2669.52,-708 2126,-708 2126,-708 2126,-708 2126,-528.88 2126,-528.88"/>
<polygon fill="black" stroke="black" points="2129.5,-528.88 2126,-518.88 2122.5,-528.88 2129.5,-528.88"/>
</g>
<!-- l1_exp_1 -->
<g id="node30" class="node">
<title>l1_exp_1</title>
<polygon fill="lightpink" stroke="black" points="2485.5,-518.45 2260.5,-518.45 2260.5,-465.45 2485.5,-465.45 2485.5,-518.45"/>
<text text-anchor="middle" x="2373" y="-503.25" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2373" y="-488.25" font-family="Times,serif" font-size="14.00">[64,2048,4096]×[4096,4096]</text>
<text text-anchor="middle" x="2373" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- l1_expert_split&#45;&gt;l1_exp_1 -->
<g id="edge31" class="edge">
<title>l1_expert_split&#45;&gt;l1_exp_1</title>
<path fill="none" stroke="black" d="M2935.57,-693C2716.31,-693 2373,-693 2373,-693 2373,-693 2373,-528.65 2373,-528.65"/>
<polygon fill="black" stroke="black" points="2376.5,-528.65 2373,-518.65 2369.5,-528.65 2376.5,-528.65"/>
</g>
<!-- l1_exp_2 -->
<g id="node31" class="node">
<title>l1_exp_2</title>
<polygon fill="lightpink" stroke="black" points="2732.5,-518.45 2507.5,-518.45 2507.5,-465.45 2732.5,-465.45 2732.5,-518.45"/>
<text text-anchor="middle" x="2620" y="-503.25" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2620" y="-488.25" font-family="Times,serif" font-size="14.00">[64,2048,4096]×[4096,4096]</text>
<text text-anchor="middle" x="2620" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- l1_expert_split&#45;&gt;l1_exp_2 -->
<g id="edge32" class="edge">
<title>l1_expert_split&#45;&gt;l1_exp_2</title>
<path fill="none" stroke="black" d="M2892.29,-648C2760.96,-648 2620,-648 2620,-648 2620,-648 2620,-528.78 2620,-528.78"/>
<polygon fill="black" stroke="black" points="2623.5,-528.78 2620,-518.78 2616.5,-528.78 2623.5,-528.78"/>
</g>
<!-- l1_exp_3 -->
<g id="node32" class="node">
<title>l1_exp_3</title>
<polygon fill="lightpink" stroke="black" points="2979.5,-518.45 2754.5,-518.45 2754.5,-465.45 2979.5,-465.45 2979.5,-518.45"/>
<text text-anchor="middle" x="2867" y="-503.25" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2867" y="-488.25" font-family="Times,serif" font-size="14.00">[64,2048,4096]×[4096,4096]</text>
<text text-anchor="middle" x="2867" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- l1_expert_split&#45;&gt;l1_exp_3 -->
<g id="edge33" class="edge">
<title>l1_expert_split&#45;&gt;l1_exp_3</title>
<path fill="none" stroke="black" d="M2921.3,-617.73C2921.3,-617.73 2921.3,-528.82 2921.3,-528.82"/>
<polygon fill="black" stroke="black" points="2924.8,-528.82 2921.3,-518.82 2917.8,-528.82 2924.8,-528.82"/>
</g>
<!-- l1_exp_4 -->
<g id="node33" class="node">
<title>l1_exp_4</title>
<polygon fill="lightpink" stroke="black" points="3226.5,-518.45 3001.5,-518.45 3001.5,-465.45 3226.5,-465.45 3226.5,-518.45"/>
<text text-anchor="middle" x="3114" y="-503.25" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="3114" y="-488.25" font-family="Times,serif" font-size="14.00">[64,2048,4096]×[4096,4096]</text>
<text text-anchor="middle" x="3114" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- l1_expert_split&#45;&gt;l1_exp_4 -->
<g id="edge34" class="edge">
<title>l1_expert_split&#45;&gt;l1_exp_4</title>
<path fill="none" stroke="black" d="M3114,-617.73C3114,-617.73 3114,-528.82 3114,-528.82"/>
<polygon fill="black" stroke="black" points="3117.5,-528.82 3114,-518.82 3110.5,-528.82 3117.5,-528.82"/>
</g>
<!-- l1_exp_5 -->
<g id="node34" class="node">
<title>l1_exp_5</title>
<polygon fill="lightpink" stroke="black" points="3473.5,-518.45 3248.5,-518.45 3248.5,-465.45 3473.5,-465.45 3473.5,-518.45"/>
<text text-anchor="middle" x="3361" y="-503.25" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="3361" y="-488.25" font-family="Times,serif" font-size="14.00">[64,2048,4096]×[4096,4096]</text>
<text text-anchor="middle" x="3361" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- l1_expert_split&#45;&gt;l1_exp_5 -->
<g id="edge35" class="edge">
<title>l1_expert_split&#45;&gt;l1_exp_5</title>
<path fill="none" stroke="black" d="M3306.7,-663.71C3306.7,-663.71 3306.7,-528.68 3306.7,-528.68"/>
<polygon fill="black" stroke="black" points="3310.2,-528.68 3306.7,-518.68 3303.2,-528.68 3310.2,-528.68"/>
</g>
<!-- l1_exp_6 -->
<g id="node35" class="node">
<title>l1_exp_6</title>
<polygon fill="lightpink" stroke="black" points="3720.5,-518.45 3495.5,-518.45 3495.5,-465.45 3720.5,-465.45 3720.5,-518.45"/>
<text text-anchor="middle" x="3608" y="-503.25" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="3608" y="-488.25" font-family="Times,serif" font-size="14.00">[64,2048,4096]×[4096,4096]</text>
<text text-anchor="middle" x="3608" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- l1_expert_split&#45;&gt;l1_exp_6 -->
<g id="edge36" class="edge">
<title>l1_expert_split&#45;&gt;l1_exp_6</title>
<path fill="none" stroke="black" d="M3270.05,-626C3386.66,-626 3526,-626 3526,-626 3526,-626 3526,-528.76 3526,-528.76"/>
<polygon fill="black" stroke="black" points="3529.5,-528.76 3526,-518.76 3522.5,-528.76 3529.5,-528.76"/>
</g>
<!-- l1_exp_7 -->
<g id="node36" class="node">
<title>l1_exp_7</title>
<polygon fill="lightpink" stroke="black" points="3967.5,-518.45 3742.5,-518.45 3742.5,-465.45 3967.5,-465.45 3967.5,-518.45"/>
<text text-anchor="middle" x="3855" y="-503.25" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="3855" y="-488.25" font-family="Times,serif" font-size="14.00">[64,2048,4096]×[4096,4096]</text>
<text text-anchor="middle" x="3855" y="-473.25" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- l1_expert_split&#45;&gt;l1_exp_7 -->
<g id="edge37" class="edge">
<title>l1_expert_split&#45;&gt;l1_exp_7</title>
<path fill="none" stroke="black" d="M3278.77,-635C3470.76,-635 3762,-635 3762,-635 3762,-635 3762,-528.52 3762,-528.52"/>
<polygon fill="black" stroke="black" points="3765.5,-528.52 3762,-518.52 3758.5,-528.52 3765.5,-528.52"/>
</g>
<!-- l1_expert_merge -->
<g id="node37" class="node">
<title>l1_expert_merge</title>
<polygon fill="lightcyan" stroke="black" points="3430.42,-379.95 2927.07,-379.95 2797.58,-273.95 3300.93,-273.95 3430.42,-379.95"/>
<text text-anchor="middle" x="3114" y="-338.25" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="3114" y="-323.25" font-family="Times,serif" font-size="14.00">16×[64,2048,4096] → [1024,2048,4096]</text>
<text text-anchor="middle" x="3114" y="-308.25" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- l1_exp_0&#45;&gt;l1_expert_merge -->
<g id="edge38" class="edge">
<title>l1_exp_0&#45;&gt;l1_expert_merge</title>
<path fill="none" stroke="black" d="M2126,-465.16C2126,-420.09 2126,-334 2126,-334 2126,-334 2860.73,-334 2860.73,-334"/>
<polygon fill="black" stroke="black" points="2860.73,-337.5 2870.73,-334 2860.73,-330.5 2860.73,-337.5"/>
</g>
<!-- l1_exp_1&#45;&gt;l1_expert_merge -->
<g id="edge39" class="edge">
<title>l1_exp_1&#45;&gt;l1_expert_merge</title>
<path fill="none" stroke="black" d="M2373,-465.4C2373,-424.06 2373,-349 2373,-349 2373,-349 2879.16,-349 2879.16,-349"/>
<polygon fill="black" stroke="black" points="2879.16,-352.5 2889.16,-349 2879.16,-345.5 2879.16,-352.5"/>
</g>
<!-- l1_exp_2&#45;&gt;l1_expert_merge -->
<g id="edge40" class="edge">
<title>l1_exp_2&#45;&gt;l1_expert_merge</title>
<path fill="none" stroke="black" d="M2620,-465.44C2620,-427.96 2620,-364 2620,-364 2620,-364 2897.36,-364 2897.36,-364"/>
<polygon fill="black" stroke="black" points="2897.36,-367.5 2907.36,-364 2897.36,-360.5 2897.36,-367.5"/>
</g>
<!-- l1_exp_3&#45;&gt;l1_expert_merge -->
<g id="edge41" class="edge">
<title>l1_exp_3&#45;&gt;l1_expert_merge</title>
<path fill="none" stroke="black" d="M2888.65,-465.44C2888.65,-465.44 2888.65,-358.66 2888.65,-358.66"/>
<polygon fill="black" stroke="black" points="2892.15,-358.66 2888.65,-348.66 2885.15,-358.66 2892.15,-358.66"/>
</g>
<!-- l1_exp_4&#45;&gt;l1_expert_merge -->
<g id="edge42" class="edge">
<title>l1_exp_4&#45;&gt;l1_expert_merge</title>
<path fill="none" stroke="black" d="M3114,-465.44C3114,-465.44 3114,-390.06 3114,-390.06"/>
<polygon fill="black" stroke="black" points="3117.5,-390.06 3114,-380.06 3110.5,-390.06 3117.5,-390.06"/>
</g>
<!-- l1_exp_5&#45;&gt;l1_expert_merge -->
<g id="edge43" class="edge">
<title>l1_exp_5&#45;&gt;l1_expert_merge</title>
<path fill="none" stroke="black" d="M3339.35,-465.44C3339.35,-465.44 3339.35,-390.06 3339.35,-390.06"/>
<polygon fill="black" stroke="black" points="3342.85,-390.06 3339.35,-380.06 3335.85,-390.06 3342.85,-390.06"/>
</g>
<!-- l1_exp_6&#45;&gt;l1_expert_merge -->
<g id="edge44" class="edge">
<title>l1_exp_6&#45;&gt;l1_expert_merge</title>
<path fill="none" stroke="black" d="M3543.25,-465.41C3543.25,-429.81 3543.25,-371 3543.25,-371 3543.25,-371 3429.67,-371 3429.67,-371"/>
<polygon fill="black" stroke="black" points="3429.67,-367.5 3419.67,-371 3429.67,-374.5 3429.67,-367.5"/>
</g>
<!-- l1_exp_7&#45;&gt;l1_expert_merge -->
<g id="edge45" class="edge">
<title>l1_exp_7&#45;&gt;l1_expert_merge</title>
<path fill="none" stroke="black" d="M3752.67,-465.34C3752.67,-427.32 3752.67,-362 3752.67,-362 3752.67,-362 3418.56,-362 3418.56,-362"/>
<polygon fill="black" stroke="black" points="3418.56,-358.5 3408.56,-362 3418.56,-365.5 3418.56,-358.5"/>
</g>
<!-- l1_expert_merge&#45;&gt;l1_moe_residual -->
<g id="edge46" class="edge">
<title>l1_expert_merge&#45;&gt;l1_moe_residual</title>
<path fill="none" stroke="black" d="M3316.91,-287C3476.74,-287 3672.75,-287 3672.75,-287 3672.75,-287 3672.75,-211.13 3672.75,-211.13"/>
<polygon fill="black" stroke="black" points="3676.25,-211.13 3672.75,-201.13 3669.25,-211.13 3676.25,-211.13"/>
</g>
<!-- l1_moe_residual&#45;&gt;output -->
<g id="edge55" class="edge">
<title>l1_moe_residual&#45;&gt;output</title>
<path fill="none" stroke="black" d="M3699,-147.72C3699,-147.72 3699,-85.03 3699,-85.03"/>
<polygon fill="black" stroke="black" points="3702.5,-85.03 3699,-75.03 3695.5,-85.03 3702.5,-85.03"/>
<text text-anchor="middle" x="3717.5" y="-107.75" font-family="Times,serif" font-size="14.00">Final</text>
</g>
</g>
</svg>
