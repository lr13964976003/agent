digraph ma_separation_moe_model {
	graph [bb="0,0,16902,3583",
		nodesep=0.5,
		rankdir=TB,
		ranksep=1.0,
		splines=ortho
	];
	node [fillcolor=lightblue,
		label="\N",
		shape=rectangle,
		style=filled
	];
	subgraph cluster_layer_0 {
		graph [bb="13088,2482,16894,3498",
			color=purple,
			label="Layer 0",
			lheight=0.21,
			lp="14991,3486.5",
			lwidth=0.76,
			style=dashed
		];
		subgraph cluster_attention_0 {
			graph [bb="14995,2490,16886,3467",
				color=red,
				label="Attention Group (GPUs 0-7)",
				lheight=0.21,
				lp="15940,3455.5",
				lwidth=2.75,
				style=rounded
			];
			l0_qkv_all_gather	[fillcolor=lightcyan,
				height=1.8889,
				label="All-Gather QKV
Input: [1024,2048,4096]
Output: [1024,2048,4096]×8
GPU: 0-7",
				pos="16060,3368",
				shape=parallelogram,
				width=6.4509];
			l0_qkv_gpu0	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU0
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 0",
				pos="16060,3194",
				width=2.6944];
			l0_qkv_all_gather -> l0_qkv_gpu0	[pos="e,16060,3228.1 16060,3299.7 16060,3299.7 16060,3238.1 16060,3238.1"];
			l0_qkv_gpu1	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU1
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 1",
				pos="16294,3194",
				width=2.6944];
			l0_qkv_all_gather -> l0_qkv_gpu1	[pos="e,16245,3228.1 16245,3367.5 16245,3367.5 16245,3238.1 16245,3238.1"];
			l0_qkv_gpu2	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU2
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 2",
				pos="16530,3194",
				width=2.6944];
			l0_qkv_all_gather -> l0_qkv_gpu2	[pos="e,16530,3228.3 16229,3345 16364,3345 16530,3345 16530,3345 16530,3345 16530,3238.3 16530,3238.3"];
			l0_qkv_gpu3	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU3
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 3",
				pos="16765,3194",
				width=2.6944];
			l0_qkv_all_gather -> l0_qkv_gpu3	[pos="e,16729,3228.1 16261,3390 16457,3390 16729,3390 16729,3390 16729,3390 16729,3238.1 16729,3238.1"];
			l0_qkv_gpu4	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU4
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 4",
				pos="15118,3194",
				width=2.6944];
			l0_qkv_all_gather -> l0_qkv_gpu4	[pos="e,15118,3228 15838,3315 15559,3315 15118,3315 15118,3315 15118,3315 15118,3238 15118,3238"];
			l0_qkv_gpu5	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU5
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 5",
				pos="15357,3194",
				width=2.6944];
			l0_qkv_all_gather -> l0_qkv_gpu5	[pos="e,15357,3228.2 15834,3309 15628,3309 15357,3309 15357,3309 15357,3309 15357,3238.2 15357,3238.2"];
			l0_qkv_gpu6	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU6
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 6",
				pos="15594,3194",
				width=2.6944];
			l0_qkv_all_gather -> l0_qkv_gpu6	[pos="e,15594,3228.2 15829,3303 15712,3303 15594,3303 15594,3303 15594,3303 15594,3238.2 15594,3238.2"];
			l0_qkv_gpu7	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU7
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 7",
				pos="15828,3194",
				width=2.6944];
			l0_qkv_all_gather -> l0_qkv_gpu7	[pos="e,15876,3228.1 15876,3299.7 15876,3299.7 15876,3238.1 15876,3238.1"];
			l0_attn_gpu0	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU0
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 0",
				pos="16060,3054",
				width=2.6944];
			l0_qkv_gpu0 -> l0_attn_gpu0	[pos="e,16060,3088.4 16060,3159.8 16060,3159.8 16060,3098.4 16060,3098.4"];
			l0_out_gpu0	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU0
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 0",
				pos="16060,2914",
				width=2.8194];
			l0_attn_gpu0 -> l0_out_gpu0	[pos="e,16060,2948.4 16060,3019.8 16060,3019.8 16060,2958.4 16060,2958.4"];
			l0_attn_all_reduce	[fillcolor=lightcyan,
				height=1.8889,
				label="All-Reduce Attention
Input: [1024,2048,4096]×8
Output: [1024,2048,4096]
GPU: 0-7",
				pos="15940,2740",
				shape=parallelogram,
				width=6.1053];
			l0_out_gpu0 -> l0_attn_all_reduce	[pos="e,16059,2808.1 16059,2879.6 16059,2879.6 16059,2818.1 16059,2818.1"];
			l0_attn_gpu1	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU1
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 1",
				pos="16296,3054",
				width=2.6944];
			l0_qkv_gpu1 -> l0_attn_gpu1	[pos="e,16295,3088.4 16295,3159.8 16295,3159.8 16295,3098.4 16295,3098.4"];
			l0_out_gpu1	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU1
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 1",
				pos="16299,2914",
				width=2.8194];
			l0_attn_gpu1 -> l0_out_gpu1	[pos="e,16296,2948.4 16296,3019.8 16296,3019.8 16296,2958.4 16296,2958.4"];
			l0_out_gpu1 -> l0_attn_all_reduce	[pos="e,16137,2774 16299,2879.8 16299,2838.3 16299,2774 16299,2774 16299,2774 16147,2774 16147,2774"];
			l0_attn_gpu2	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU2
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 2",
				pos="16533,3054",
				width=2.6944];
			l0_qkv_gpu2 -> l0_attn_gpu2	[pos="e,16532,3088.4 16532,3159.8 16532,3159.8 16532,3098.4 16532,3098.4"];
			l0_out_gpu2	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU2
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 2",
				pos="16538,2914",
				width=2.8194];
			l0_attn_gpu2 -> l0_out_gpu2	[pos="e,16533,2948.4 16533,3019.8 16533,3019.8 16533,2958.4 16533,2958.4"];
			l0_out_gpu2 -> l0_attn_all_reduce	[pos="e,16115,2740 16538,2879.6 16538,2828.9 16538,2740 16538,2740 16538,2740 16125,2740 16125,2740"];
			l0_attn_gpu3	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU3
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 3",
				pos="16769,3054",
				width=2.6944];
			l0_qkv_gpu3 -> l0_attn_gpu3	[pos="e,16767,3088.4 16767,3159.8 16767,3159.8 16767,3098.4 16767,3098.4"];
			l0_out_gpu3	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU3
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 3",
				pos="16777,2914",
				width=2.8194];
			l0_attn_gpu3 -> l0_out_gpu3	[pos="e,16771,2948.4 16771,3019.8 16771,3019.8 16771,2958.4 16771,2958.4"];
			l0_out_gpu3 -> l0_attn_all_reduce	[pos="e,16093,2706 16777,2879.7 16777,2820.6 16777,2706 16777,2706 16777,2706 16103,2706 16103,2706"];
			l0_attn_gpu4	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU4
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 4",
				pos="15111,3054",
				width=2.6944];
			l0_qkv_gpu4 -> l0_attn_gpu4	[pos="e,15114,3088.4 15114,3159.8 15114,3159.8 15114,3098.4 15114,3098.4"];
			l0_out_gpu4	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU4
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 4",
				pos="15104,2914",
				width=2.8194];
			l0_attn_gpu4 -> l0_out_gpu4	[pos="e,15110,2948.4 15110,3019.8 15110,3019.8 15110,2958.4 15110,2958.4"];
			l0_out_gpu4 -> l0_attn_all_reduce	[pos="e,15785,2770 15104,2879.9 15104,2837.3 15104,2770 15104,2770 15104,2770 15775,2770 15775,2770"];
			l0_attn_gpu5	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU5
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 5",
				pos="15356,3054",
				width=2.6944];
			l0_qkv_gpu5 -> l0_attn_gpu5	[pos="e,15356,3088.4 15356,3159.8 15356,3159.8 15356,3098.4 15356,3098.4"];
			l0_out_gpu5	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU5
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 5",
				pos="15343,2914",
				width=2.8194];
			l0_attn_gpu5 -> l0_out_gpu5	[pos="e,15352,2948.4 15352,3019.8 15352,3019.8 15352,2958.4 15352,2958.4"];
			l0_out_gpu5 -> l0_attn_all_reduce	[pos="e,15794,2783 15343,2879.9 15343,2841.1 15343,2783 15343,2783 15343,2783 15784,2783 15784,2783"];
			l0_attn_gpu6	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU6
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 6",
				pos="15591,3054",
				width=2.6944];
			l0_qkv_gpu6 -> l0_attn_gpu6	[pos="e,15592,3088.4 15592,3159.8 15592,3159.8 15592,3098.4 15592,3098.4"];
			l0_out_gpu6	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU6
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 6",
				pos="15582,2914",
				width=2.8194];
			l0_attn_gpu6 -> l0_out_gpu6	[pos="e,15589,2948.4 15589,3019.8 15589,3019.8 15589,2958.4 15589,2958.4"];
			l0_out_gpu6 -> l0_attn_all_reduce	[pos="e,15802,2795 15582,2879.9 15582,2844.7 15582,2795 15582,2795 15582,2795 15792,2795 15792,2795"];
			l0_attn_gpu7	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU7
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 7",
				pos="15823,3054",
				width=2.6944];
			l0_qkv_gpu7 -> l0_attn_gpu7	[pos="e,15826,3088.4 15826,3159.8 15826,3159.8 15826,3098.4 15826,3098.4"];
			l0_out_gpu7	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU7
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 7",
				pos="15821,2914",
				width=2.8194];
			l0_attn_gpu7 -> l0_out_gpu7	[pos="e,15823,2948.4 15823,3019.8 15823,3019.8 15823,2958.4 15823,2958.4"];
			l0_out_gpu7 -> l0_attn_all_reduce	[pos="e,15821,2808.1 15821,2879.6 15821,2879.6 15821,2818.1 15821,2818.1"];
			l0_attn_res	[fillcolor=orange,
				height=0.94444,
				label="Residual Add
Input: [1024,2048,4096], [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 0-7",
				pos="15940,2532",
				width=4.5556];
			l0_attn_all_reduce -> l0_attn_res	[pos="e,15940,2566.1 15940,2671.9 15940,2671.9 15940,2576.1 15940,2576.1"];
		}
		subgraph cluster_moe_0 {
			graph [bb="13096,2872,14987,3433",
				color=blue,
				label="MoE Group (GPUs 8-15)",
				lheight=0.21,
				lp="14042,3421.5",
				lwidth=2.40,
				style=rounded
			];
			l0_moe_gate	[fillcolor=lightcoral,
				height=0.94444,
				label="Gate Network
Input: [1024,2048,4096]
Output: [1024,2048,16]
GPU: 8-15",
				pos="13922,3368",
				width=2.6528];
			l0_exp_gpu8	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 0,1
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 8",
				pos="13683,3194",
				width=2.8194];
			l0_moe_gate -> l0_exp_gpu8	[pos="e,13717,3228.3 13826,3347 13773,3347 13717,3347 13717,3347 13717,3347 13717,3238.3 13717,3238.3",
				style=dashed];
			l0_exp_gpu9	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 2,3
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 9",
				pos="13922,3194",
				width=2.8194];
			l0_moe_gate -> l0_exp_gpu9	[pos="e,13954,3228 13954,3333.6 13954,3333.6 13954,3238 13954,3238",
				style=dashed];
			l0_exp_gpu10	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 4,5
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 10",
				pos="14161,3194",
				width=2.8194];
			l0_moe_gate -> l0_exp_gpu10	[pos="e,14195,3228.3 14018,3347 14096,3347 14195,3347 14195,3347 14195,3347 14195,3238.3 14195,3238.3",
				style=dashed];
			l0_exp_gpu11	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 6,7
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 11",
				pos="14400,3194",
				width=2.8194];
			l0_moe_gate -> l0_exp_gpu11	[pos="e,14434,3228.2 14018,3361 14166,3361 14434,3361 14434,3361 14434,3361 14434,3238.2 14434,3238.2",
				style=dashed];
			l0_exp_gpu12	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 8,9
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 12",
				pos="14639,3194",
				width=2.8194];
			l0_moe_gate -> l0_exp_gpu12	[pos="e,14673,3228.3 14018,3374 14220,3374 14673,3374 14673,3374 14673,3374 14673,3238.3 14673,3238.3",
				style=dashed];
			l0_exp_gpu13	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 10,11
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 13",
				pos="14878,3194",
				width=2.8194];
			l0_moe_gate -> l0_exp_gpu13	[pos="e,14912,3228.2 14018,3388 14266,3388 14912,3388 14912,3388 14912,3388 14912,3238.2 14912,3238.2",
				style=dashed];
			l0_exp_gpu14	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 12,13
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 14",
				pos="13205,3194",
				width=2.8194];
			l0_moe_gate -> l0_exp_gpu14	[pos="e,13205,3228.3 13826,3374 13631,3374 13205,3374 13205,3374 13205,3374 13205,3238.3 13205,3238.3",
				style=dashed];
			l0_exp_gpu15	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 14,15
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 15",
				pos="13444,3194",
				width=2.8194];
			l0_moe_gate -> l0_exp_gpu15	[pos="e,13478,3228.2 13826,3361 13696,3361 13478,3361 13478,3361 13478,3361 13478,3238.2 13478,3238.2",
				style=dashed];
			l0_moe_agg	[fillcolor=lightcyan,
				height=0.94444,
				label="Expert Aggregation
Input: [1024,2048,4096]×2
Output: [1024,2048,4096]
GPU: 8-15",
				pos="13922,3054",
				width=2.9444];
			l0_exp_gpu8 -> l0_moe_agg	[pos="e,13816,3074 13683,3159.9 13683,3124.5 13683,3074 13683,3074 13683,3074 13806,3074 13806,3074"];
			l0_exp_gpu9 -> l0_moe_agg	[pos="e,13922,3088.4 13922,3159.8 13922,3159.8 13922,3098.4 13922,3098.4"];
			l0_exp_gpu10 -> l0_moe_agg	[pos="e,14028,3074 14161,3159.9 14161,3124.5 14161,3074 14161,3074 14161,3074 14038,3074 14038,3074"];
			l0_exp_gpu11 -> l0_moe_agg	[pos="e,14028,3060 14400,3159.8 14400,3120.1 14400,3060 14400,3060 14400,3060 14038,3060 14038,3060"];
			l0_exp_gpu12 -> l0_moe_agg	[pos="e,14028,3047 14639,3159.9 14639,3116.5 14639,3047 14639,3047 14639,3047 14038,3047 14038,3047"];
			l0_exp_gpu13 -> l0_moe_agg	[pos="e,14028,3033 14878,3159.9 14878,3112.6 14878,3033 14878,3033 14878,3033 14038,3033 14038,3033"];
			l0_exp_gpu14 -> l0_moe_agg	[pos="e,13816,3047 13205,3159.9 13205,3116.5 13205,3047 13205,3047 13205,3047 13806,3047 13806,3047"];
			l0_exp_gpu15 -> l0_moe_agg	[pos="e,13816,3060 13489,3159.8 13489,3120.1 13489,3060 13489,3060 13489,3060 13806,3060 13806,3060"];
			l0_moe_res	[fillcolor=orange,
				height=0.94444,
				label="Residual Add
Input: [1024,2048,4096], [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 8-15",
				pos="13268,2914",
				width=4.5556];
			l0_moe_agg -> l0_moe_res	[pos="e,13387,2948.1 13816,3033 13660,3033 13387,3033 13387,3033 13387,3033 13387,2958.1 13387,2958.1"];
		}
	}
	subgraph cluster_layer_1 {
		graph [bb="8674,1646,12480,2662",
			color=purple,
			label="Layer 1",
			lheight=0.21,
			lp="10577,2650.5",
			lwidth=0.76,
			style=dashed
		];
		subgraph cluster_attention_1 {
			graph [bb="10581,1654,12472,2631",
				color=red,
				label="Attention Group (GPUs 0-7)",
				lheight=0.21,
				lp="11526,2619.5",
				lwidth=2.75,
				style=rounded
			];
			l1_qkv_all_gather	[fillcolor=lightcyan,
				height=1.8889,
				label="All-Gather QKV
Input: [1024,2048,4096]
Output: [1024,2048,4096]×8
GPU: 0-7",
				pos="11646,2532",
				shape=parallelogram,
				width=6.4509];
			l1_qkv_gpu0	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU0
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 0",
				pos="11646,2358",
				width=2.6944];
			l1_qkv_all_gather -> l1_qkv_gpu0	[pos="e,11646,2392.1 11646,2463.7 11646,2463.7 11646,2402.1 11646,2402.1"];
			l1_qkv_gpu1	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU1
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 1",
				pos="11880,2358",
				width=2.6944];
			l1_qkv_all_gather -> l1_qkv_gpu1	[pos="e,11831,2392.1 11831,2531.5 11831,2531.5 11831,2402.1 11831,2402.1"];
			l1_qkv_gpu2	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU2
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 2",
				pos="12110,2358",
				width=2.6944];
			l1_qkv_all_gather -> l1_qkv_gpu2	[pos="e,12110,2392.3 11815,2509 11947,2509 12110,2509 12110,2509 12110,2509 12110,2402.3 12110,2402.3"];
			l1_qkv_gpu3	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU3
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 3",
				pos="12345,2358",
				width=2.6944];
			l1_qkv_all_gather -> l1_qkv_gpu3	[pos="e,12345,2392.1 11846,2554 12053,2554 12345,2554 12345,2554 12345,2554 12345,2402.1 12345,2402.1"];
			l1_qkv_gpu4	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU4
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 4",
				pos="10701,2358",
				width=2.6944];
			l1_qkv_all_gather -> l1_qkv_gpu4	[pos="e,10701,2392.1 11431,2489 11152,2489 10701,2489 10701,2489 10701,2489 10701,2402.1 10701,2402.1"];
			l1_qkv_gpu5	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU5
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 5",
				pos="10944,2358",
				width=2.6944];
			l1_qkv_all_gather -> l1_qkv_gpu5	[pos="e,10944,2392.3 11425,2481 11220,2481 10944,2481 10944,2481 10944,2481 10944,2402.3 10944,2402.3"];
			l1_qkv_gpu6	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU6
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 6",
				pos="11181,2358",
				width=2.6944];
			l1_qkv_all_gather -> l1_qkv_gpu6	[pos="e,11181,2392.2 11419,2472 11301,2472 11181,2472 11181,2472 11181,2472 11181,2402.2 11181,2402.2"];
			l1_qkv_gpu7	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU7
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 7",
				pos="11414,2358",
				width=2.6944];
			l1_qkv_all_gather -> l1_qkv_gpu7	[pos="e,11462,2392.1 11462,2463.7 11462,2463.7 11462,2402.1 11462,2402.1"];
			l1_attn_gpu0	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU0
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 0",
				pos="11646,2218",
				width=2.6944];
			l1_qkv_gpu0 -> l1_attn_gpu0	[pos="e,11646,2252.4 11646,2323.8 11646,2323.8 11646,2262.4 11646,2262.4"];
			l1_out_gpu0	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU0
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 0",
				pos="11646,2078",
				width=2.8194];
			l1_attn_gpu0 -> l1_out_gpu0	[pos="e,11646,2112.4 11646,2183.8 11646,2183.8 11646,2122.4 11646,2122.4"];
			l1_attn_all_reduce	[fillcolor=lightcyan,
				height=1.8889,
				label="All-Reduce Attention
Input: [1024,2048,4096]×8
Output: [1024,2048,4096]
GPU: 0-7",
				pos="11646,1904",
				shape=parallelogram,
				width=6.1053];
			l1_out_gpu0 -> l1_attn_all_reduce	[pos="e,11646,1972.1 11646,2043.6 11646,2043.6 11646,1982.1 11646,1982.1"];
			l1_attn_gpu1	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU1
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 1",
				pos="11882,2218",
				width=2.6944];
			l1_qkv_gpu1 -> l1_attn_gpu1	[pos="e,11881,2252.4 11881,2323.8 11881,2323.8 11881,2262.4 11881,2262.4"];
			l1_out_gpu1	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU1
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 1",
				pos="11885,2078",
				width=2.8194];
			l1_attn_gpu1 -> l1_out_gpu1	[pos="e,11882,2112.4 11882,2183.8 11882,2183.8 11882,2122.4 11882,2122.4"];
			l1_out_gpu1 -> l1_attn_all_reduce	[pos="e,11825,1972.1 11825,2043.6 11825,2043.6 11825,1982.1 11825,1982.1"];
			l1_attn_gpu2	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU2
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 2",
				pos="12115,2218",
				width=2.6944];
			l1_qkv_gpu2 -> l1_attn_gpu2	[pos="e,12112,2252.4 12112,2323.8 12112,2323.8 12112,2262.4 12112,2262.4"];
			l1_out_gpu2	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU2
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 2",
				pos="12124,2078",
				width=2.8194];
			l1_attn_gpu2 -> l1_out_gpu2	[pos="e,12117,2112.4 12117,2183.8 12117,2183.8 12117,2122.4 12117,2122.4"];
			l1_out_gpu2 -> l1_attn_all_reduce	[pos="e,11843,1938 12079,2043.8 12079,2002.3 12079,1938 12079,1938 12079,1938 11853,1938 11853,1938"];
			l1_attn_gpu3	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU3
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 3",
				pos="12347,2218",
				width=2.6944];
			l1_qkv_gpu3 -> l1_attn_gpu3	[pos="e,12346,2252.4 12346,2323.8 12346,2323.8 12346,2262.4 12346,2262.4"];
			l1_out_gpu3	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU3
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 3",
				pos="12363,2078",
				width=2.8194];
			l1_attn_gpu3 -> l1_out_gpu3	[pos="e,12353,2112.4 12353,2183.8 12353,2183.8 12353,2122.4 12353,2122.4"];
			l1_out_gpu3 -> l1_attn_all_reduce	[pos="e,11821,1904 12363,2043.6 12363,1992.9 12363,1904 12363,1904 12363,1904 11831,1904 11831,1904"];
			l1_attn_gpu4	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU4
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 4",
				pos="10695,2218",
				width=2.6944];
			l1_qkv_gpu4 -> l1_attn_gpu4	[pos="e,10698,2252.4 10698,2323.8 10698,2323.8 10698,2262.4 10698,2262.4"];
			l1_out_gpu4	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU4
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 4",
				pos="10690,2078",
				width=2.8194];
			l1_attn_gpu4 -> l1_out_gpu4	[pos="e,10695,2112.4 10695,2183.8 10695,2183.8 10695,2122.4 10695,2122.4"];
			l1_out_gpu4 -> l1_attn_all_reduce	[pos="e,11491,1934 10690,2043.9 10690,2001.3 10690,1934 10690,1934 10690,1934 11481,1934 11481,1934"];
			l1_attn_gpu5	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU5
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 5",
				pos="10939,2218",
				width=2.6944];
			l1_qkv_gpu5 -> l1_attn_gpu5	[pos="e,10942,2252.4 10942,2323.8 10942,2323.8 10942,2262.4 10942,2262.4"];
			l1_out_gpu5	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU5
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 5",
				pos="10929,2078",
				width=2.8194];
			l1_attn_gpu5 -> l1_out_gpu5	[pos="e,10936,2112.4 10936,2183.8 10936,2183.8 10936,2122.4 10936,2122.4"];
			l1_out_gpu5 -> l1_attn_all_reduce	[pos="e,11500,1947 10929,2043.9 10929,2005.1 10929,1947 10929,1947 10929,1947 11490,1947 11490,1947"];
			l1_attn_gpu6	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU6
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 6",
				pos="11173,2218",
				width=2.6944];
			l1_qkv_gpu6 -> l1_attn_gpu6	[pos="e,11177,2252.4 11177,2323.8 11177,2323.8 11177,2262.4 11177,2262.4"];
			l1_out_gpu6	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU6
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 6",
				pos="11168,2078",
				width=2.8194];
			l1_attn_gpu6 -> l1_out_gpu6	[pos="e,11173,2112.4 11173,2183.8 11173,2183.8 11173,2122.4 11173,2122.4"];
			l1_out_gpu6 -> l1_attn_all_reduce	[pos="e,11507,1959 11168,2043.9 11168,2008.7 11168,1959 11168,1959 11168,1959 11497,1959 11497,1959"];
			l1_attn_gpu7	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU7
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 7",
				pos="11411,2218",
				width=2.6944];
			l1_qkv_gpu7 -> l1_attn_gpu7	[pos="e,11412,2252.4 11412,2323.8 11412,2323.8 11412,2262.4 11412,2262.4"];
			l1_out_gpu7	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU7
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 7",
				pos="11407,2078",
				width=2.8194];
			l1_attn_gpu7 -> l1_out_gpu7	[pos="e,11411,2112.4 11411,2183.8 11411,2183.8 11411,2122.4 11411,2122.4"];
			l1_out_gpu7 -> l1_attn_all_reduce	[pos="e,11467,1904.1 11467,2043.6 11467,2043.6 11467,1914.1 11467,1914.1"];
			l1_attn_res	[fillcolor=orange,
				height=0.94444,
				label="Residual Add
Input: [1024,2048,4096], [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 0-7",
				pos="12300,1696",
				width=4.5556];
			l1_attn_all_reduce -> l1_attn_res	[pos="e,12181,1730.4 11799,1870 11957,1870 12181,1870 12181,1870 12181,1870 12181,1740.4 12181,1740.4"];
		}
		subgraph cluster_moe_1 {
			graph [bb="8682,2036,10573,2597",
				color=blue,
				label="MoE Group (GPUs 8-15)",
				lheight=0.21,
				lp="9627.5,2585.5",
				lwidth=2.40,
				style=rounded
			];
			l1_moe_gate	[fillcolor=lightcoral,
				height=0.94444,
				label="Gate Network
Input: [1024,2048,4096]
Output: [1024,2048,16]
GPU: 8-15",
				pos="9747,2532",
				width=2.6528];
			l1_exp_gpu8	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 0,1
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 8",
				pos="9269,2358",
				width=2.8194];
			l1_moe_gate -> l1_exp_gpu8	[pos="e,9235.2,2392.2 9651.3,2525 9503.2,2525 9235.2,2525 9235.2,2525 9235.2,2525 9235.2,2402.2 9235.2,2402.2",
				style=dashed];
			l1_exp_gpu9	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 2,3
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 9",
				pos="9508,2358",
				width=2.8194];
			l1_moe_gate -> l1_exp_gpu9	[pos="e,9474.2,2392.3 9651.2,2511 9572.6,2511 9474.2,2511 9474.2,2511 9474.2,2511 9474.2,2402.3 9474.2,2402.3",
				style=dashed];
			l1_exp_gpu10	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 4,5
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 10",
				pos="9747,2358",
				width=2.8194];
			l1_moe_gate -> l1_exp_gpu10	[pos="e,9715.2,2392 9715.2,2497.6 9715.2,2497.6 9715.2,2402 9715.2,2402",
				style=dashed];
			l1_exp_gpu11	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 6,7
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 11",
				pos="9986,2358",
				width=2.8194];
			l1_moe_gate -> l1_exp_gpu11	[pos="e,9952.2,2392.1 9842.7,2515 9896.2,2515 9952.2,2515 9952.2,2515 9952.2,2515 9952.2,2402.1 9952.2,2402.1",
				style=dashed];
			l1_exp_gpu12	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 8,9
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 12",
				pos="10225,2358",
				width=2.8194];
			l1_moe_gate -> l1_exp_gpu12	[pos="e,10191,2392.4 9842.6,2532 9973.1,2532 10191,2532 10191,2532 10191,2532 10191,2402.4 10191,2402.4",
				style=dashed];
			l1_exp_gpu13	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 10,11
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 13",
				pos="10464,2358",
				width=2.8194];
			l1_moe_gate -> l1_exp_gpu13	[pos="e,10430,2392.1 9842.7,2549 10031,2549 10430,2549 10430,2549 10430,2549 10430,2402.1 10430,2402.1",
				style=dashed];
			l1_exp_gpu14	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 12,13
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 14",
				pos="8791,2358",
				width=2.8194];
			l1_moe_gate -> l1_exp_gpu14	[pos="e,8757.2,2392.2 9651.2,2552 9402.8,2552 8757.2,2552 8757.2,2552 8757.2,2552 8757.2,2402.2 8757.2,2402.2",
				style=dashed];
			l1_exp_gpu15	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 14,15
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 15",
				pos="9030,2358",
				width=2.8194];
			l1_moe_gate -> l1_exp_gpu15	[pos="e,8996.2,2392.3 9651.1,2538 9448.7,2538 8996.2,2538 8996.2,2538 8996.2,2538 8996.2,2402.3 8996.2,2402.3",
				style=dashed];
			l1_moe_agg	[fillcolor=lightcyan,
				height=0.94444,
				label="Expert Aggregation
Input: [1024,2048,4096]×2
Output: [1024,2048,4096]
GPU: 8-15",
				pos="9627,2218",
				width=2.9444];
			l1_exp_gpu8 -> l1_moe_agg	[pos="e,9520.6,2235 9269,2323.7 9269,2287.3 9269,2235 9269,2235 9269,2235 9510.6,2235 9510.6,2235"];
			l1_exp_gpu9 -> l1_moe_agg	[pos="e,9565.2,2252.4 9565.2,2323.8 9565.2,2323.8 9565.2,2262.4 9565.2,2262.4"];
			l1_exp_gpu10 -> l1_moe_agg	[pos="e,9689.2,2252.4 9689.2,2323.8 9689.2,2323.8 9689.2,2262.4 9689.2,2262.4"];
			l1_exp_gpu11 -> l1_moe_agg	[pos="e,9733.3,2235 9986,2323.7 9986,2287.3 9986,2235 9986,2235 9986,2235 9743.3,2235 9743.3,2235"];
			l1_exp_gpu12 -> l1_moe_agg	[pos="e,9733.2,2218 10225,2323.8 10225,2282.3 10225,2218 10225,2218 10225,2218 9743.2,2218 9743.2,2218"];
			l1_exp_gpu13 -> l1_moe_agg	[pos="e,9733,2201 10464,2323.9 10464,2277.8 10464,2201 10464,2201 10464,2201 9743,2201 9743,2201"];
			l1_exp_gpu14 -> l1_moe_agg	[pos="e,9520.7,2201 8791,2323.9 8791,2277.8 8791,2201 8791,2201 8791,2201 9510.7,2201 9510.7,2201"];
			l1_exp_gpu15 -> l1_moe_agg	[pos="e,9521,2218 9030,2323.8 9030,2282.3 9030,2218 9030,2218 9030,2218 9511,2218 9511,2218"];
			l1_moe_res	[fillcolor=orange,
				height=0.94444,
				label="Residual Add
Input: [1024,2048,4096], [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 8-15",
				pos="9627,2078",
				width=4.5556];
			l1_moe_agg -> l1_moe_res	[pos="e,9627,2112.4 9627,2183.8 9627,2183.8 9627,2122.4 9627,2122.4"];
		}
	}
	subgraph cluster_layer_2 {
		graph [bb="4341,810,8147,1826",
			color=purple,
			label="Layer 2",
			lheight=0.21,
			lp="6244,1814.5",
			lwidth=0.76,
			style=dashed
		];
		subgraph cluster_attention_2 {
			graph [bb="6248,818,8139,1795",
				color=red,
				label="Attention Group (GPUs 0-7)",
				lheight=0.21,
				lp="7193.5,1783.5",
				lwidth=2.75,
				style=rounded
			];
			l2_qkv_all_gather	[fillcolor=lightcyan,
				height=1.8889,
				label="All-Gather QKV
Input: [1024,2048,4096]
Output: [1024,2048,4096]×8
GPU: 0-7",
				pos="7313,1696",
				shape=parallelogram,
				width=6.4509];
			l2_qkv_gpu0	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU0
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 0",
				pos="7313,1522",
				width=2.6944];
			l2_qkv_all_gather -> l2_qkv_gpu0	[pos="e,7313,1556.1 7313,1627.7 7313,1627.7 7313,1566.1 7313,1566.1"];
			l2_qkv_gpu1	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU1
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 1",
				pos="7543,1522",
				width=2.6944];
			l2_qkv_all_gather -> l2_qkv_gpu1	[pos="e,7495.6,1556.4 7495.6,1692.7 7495.6,1692.7 7495.6,1566.4 7495.6,1566.4"];
			l2_qkv_gpu2	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU2
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 2",
				pos="7779,1522",
				width=2.6944];
			l2_qkv_all_gather -> l2_qkv_gpu2	[pos="e,7779,1556.3 7481.9,1673 7615.3,1673 7779,1673 7779,1673 7779,1673 7779,1566.3 7779,1566.3"];
			l2_qkv_gpu3	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU3
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 3",
				pos="8009,1522",
				width=2.6944];
			l2_qkv_all_gather -> l2_qkv_gpu3	[pos="e,8009,1556.1 7513.4,1718 7719,1718 8009,1718 8009,1718 8009,1718 8009,1566.1 8009,1566.1"];
			l2_qkv_gpu4	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU4
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 4",
				pos="6373,1522",
				width=2.6944];
			l2_qkv_all_gather -> l2_qkv_gpu4	[pos="e,6373,1556.1 7097.9,1653 6820.5,1653 6373,1653 6373,1653 6373,1653 6373,1566.1 6373,1566.1"];
			l2_qkv_gpu5	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU5
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 5",
				pos="6603,1522",
				width=2.6944];
			l2_qkv_all_gather -> l2_qkv_gpu5	[pos="e,6603,1556.3 7092.2,1645 6883.8,1645 6603,1645 6603,1645 6603,1645 6603,1566.3 6603,1566.3"];
			l2_qkv_gpu6	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU6
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 6",
				pos="6846,1522",
				width=2.6944];
			l2_qkv_all_gather -> l2_qkv_gpu6	[pos="e,6846,1556.2 7086,1636 6967.1,1636 6846,1636 6846,1636 6846,1636 6846,1566.2 6846,1566.2"];
			l2_qkv_gpu7	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU7
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 7",
				pos="7083,1522",
				width=2.6944];
			l2_qkv_all_gather -> l2_qkv_gpu7	[pos="e,7130.4,1556.1 7130.4,1627.7 7130.4,1627.7 7130.4,1566.1 7130.4,1566.1"];
			l2_attn_gpu0	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU0
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 0",
				pos="7313,1382",
				width=2.6944];
			l2_qkv_gpu0 -> l2_attn_gpu0	[pos="e,7313,1416.4 7313,1487.8 7313,1487.8 7313,1426.4 7313,1426.4"];
			l2_out_gpu0	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU0
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 0",
				pos="7313,1242",
				width=2.8194];
			l2_attn_gpu0 -> l2_out_gpu0	[pos="e,7313,1276.4 7313,1347.8 7313,1347.8 7313,1286.4 7313,1286.4"];
			l2_attn_all_reduce	[fillcolor=lightcyan,
				height=1.8889,
				label="All-Reduce Attention
Input: [1024,2048,4096]×8
Output: [1024,2048,4096]
GPU: 0-7",
				pos="7313,1068",
				shape=parallelogram,
				width=6.1053];
			l2_out_gpu0 -> l2_attn_all_reduce	[pos="e,7313,1136.1 7313,1207.6 7313,1207.6 7313,1146.1 7313,1146.1"];
			l2_attn_gpu1	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU1
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 1",
				pos="7547,1382",
				width=2.6944];
			l2_qkv_gpu1 -> l2_attn_gpu1	[pos="e,7545,1416.4 7545,1487.8 7545,1487.8 7545,1426.4 7545,1426.4"];
			l2_out_gpu1	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU1
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 1",
				pos="7552,1242",
				width=2.8194];
			l2_attn_gpu1 -> l2_out_gpu1	[pos="e,7547.2,1276.4 7547.2,1347.8 7547.2,1347.8 7547.2,1286.4 7547.2,1286.4"];
			l2_out_gpu1 -> l2_attn_all_reduce	[pos="e,7491.6,1136.1 7491.6,1207.6 7491.6,1207.6 7491.6,1146.1 7491.6,1146.1"];
			l2_attn_gpu2	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU2
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 2",
				pos="7784,1382",
				width=2.6944];
			l2_qkv_gpu2 -> l2_attn_gpu2	[pos="e,7781.5,1416.4 7781.5,1487.8 7781.5,1487.8 7781.5,1426.4 7781.5,1426.4"];
			l2_out_gpu2	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU2
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 2",
				pos="7791,1242",
				width=2.8194];
			l2_attn_gpu2 -> l2_out_gpu2	[pos="e,7785.2,1276.4 7785.2,1347.8 7785.2,1347.8 7785.2,1286.4 7785.2,1286.4"];
			l2_out_gpu2 -> l2_attn_all_reduce	[pos="e,7510.3,1102 7746.2,1207.8 7746.2,1166.3 7746.2,1102 7746.2,1102 7746.2,1102 7520.3,1102 7520.3,1102"];
			l2_attn_gpu3	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU3
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 3",
				pos="8022,1382",
				width=2.6944];
			l2_qkv_gpu3 -> l2_attn_gpu3	[pos="e,8015.5,1416.4 8015.5,1487.8 8015.5,1487.8 8015.5,1426.4 8015.5,1426.4"];
			l2_out_gpu3	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU3
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 3",
				pos="8030,1242",
				width=2.8194];
			l2_attn_gpu3 -> l2_out_gpu3	[pos="e,8023.8,1276.4 8023.8,1347.8 8023.8,1347.8 8023.8,1286.4 8023.8,1286.4"];
			l2_out_gpu3 -> l2_attn_all_reduce	[pos="e,7487.9,1068 8029.8,1207.6 8029.8,1156.9 8029.8,1068 8029.8,1068 8029.8,1068 7497.9,1068 7497.9,1068"];
			l2_attn_gpu4	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU4
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 4",
				pos="6364,1382",
				width=2.6944];
			l2_qkv_gpu4 -> l2_attn_gpu4	[pos="e,6368.5,1416.4 6368.5,1487.8 6368.5,1487.8 6368.5,1426.4 6368.5,1426.4"];
			l2_out_gpu4	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU4
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 4",
				pos="6357,1242",
				width=2.8194];
			l2_attn_gpu4 -> l2_out_gpu4	[pos="e,6362.8,1276.4 6362.8,1347.8 6362.8,1347.8 6362.8,1286.4 6362.8,1286.4"];
			l2_out_gpu4 -> l2_attn_all_reduce	[pos="e,7158.1,1098 6357,1207.9 6357,1165.3 6357,1098 6357,1098 6357,1098 7148.1,1098 7148.1,1098"];
			l2_attn_gpu5	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU5
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 5",
				pos="6600,1382",
				width=2.6944];
			l2_qkv_gpu5 -> l2_attn_gpu5	[pos="e,6601.5,1416.4 6601.5,1487.8 6601.5,1487.8 6601.5,1426.4 6601.5,1426.4"];
			l2_out_gpu5	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU5
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 5",
				pos="6596,1242",
				width=2.8194];
			l2_attn_gpu5 -> l2_out_gpu5	[pos="e,6600,1276.4 6600,1347.8 6600,1347.8 6600,1286.4 6600,1286.4"];
			l2_out_gpu5 -> l2_attn_all_reduce	[pos="e,7166.6,1111 6596,1207.9 6596,1169.1 6596,1111 6596,1111 6596,1111 7156.6,1111 7156.6,1111"];
			l2_attn_gpu6	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU6
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 6",
				pos="6841,1382",
				width=2.6944];
			l2_qkv_gpu6 -> l2_attn_gpu6	[pos="e,6843.5,1416.4 6843.5,1487.8 6843.5,1487.8 6843.5,1426.4 6843.5,1426.4"];
			l2_out_gpu6	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU6
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 6",
				pos="6835,1242",
				width=2.8194];
			l2_attn_gpu6 -> l2_out_gpu6	[pos="e,6840.2,1276.4 6840.2,1347.8 6840.2,1347.8 6840.2,1286.4 6840.2,1286.4"];
			l2_out_gpu6 -> l2_attn_all_reduce	[pos="e,7174.4,1123 6835,1207.9 6835,1172.7 6835,1123 6835,1123 6835,1123 7164.4,1123 7164.4,1123"];
			l2_attn_gpu7	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU7
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 7",
				pos="7080,1382",
				width=2.6944];
			l2_qkv_gpu7 -> l2_attn_gpu7	[pos="e,7081.5,1416.4 7081.5,1487.8 7081.5,1487.8 7081.5,1426.4 7081.5,1426.4"];
			l2_out_gpu7	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU7
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 7",
				pos="7074,1242",
				width=2.8194];
			l2_attn_gpu7 -> l2_out_gpu7	[pos="e,7079.2,1276.4 7079.2,1347.8 7079.2,1347.8 7079.2,1286.4 7079.2,1286.4"];
			l2_out_gpu7 -> l2_attn_all_reduce	[pos="e,7134.4,1068.1 7134.4,1207.6 7134.4,1207.6 7134.4,1078.1 7134.4,1078.1"];
			l2_attn_res	[fillcolor=orange,
				height=0.94444,
				label="Residual Add
Input: [1024,2048,4096], [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 0-7",
				pos="7967,860",
				width=4.5556];
			l2_attn_all_reduce -> l2_attn_res	[pos="e,7847.8,894.38 7465.5,1034 7623.6,1034 7847.8,1034 7847.8,1034 7847.8,1034 7847.8,904.38 7847.8,904.38"];
		}
		subgraph cluster_moe_2 {
			graph [bb="4349,1200,6240,1761",
				color=blue,
				label="MoE Group (GPUs 8-15)",
				lheight=0.21,
				lp="5294.5,1749.5",
				lwidth=2.40,
				style=rounded
			];
			l2_moe_gate	[fillcolor=lightcoral,
				height=0.94444,
				label="Gate Network
Input: [1024,2048,4096]
Output: [1024,2048,16]
GPU: 8-15",
				pos="5414,1696",
				width=2.6528];
			l2_exp_gpu8	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 0,1
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 8",
				pos="4936,1522",
				width=2.8194];
			l2_moe_gate -> l2_exp_gpu8	[pos="e,4902.2,1556.2 5318.3,1689 5170.2,1689 4902.2,1689 4902.2,1689 4902.2,1689 4902.2,1566.2 4902.2,1566.2",
				style=dashed];
			l2_exp_gpu9	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 2,3
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 9",
				pos="5175,1522",
				width=2.8194];
			l2_moe_gate -> l2_exp_gpu9	[pos="e,5141.2,1556.3 5318.2,1675 5239.6,1675 5141.2,1675 5141.2,1675 5141.2,1675 5141.2,1566.3 5141.2,1566.3",
				style=dashed];
			l2_exp_gpu10	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 4,5
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 10",
				pos="5414,1522",
				width=2.8194];
			l2_moe_gate -> l2_exp_gpu10	[pos="e,5382.2,1556 5382.2,1661.6 5382.2,1661.6 5382.2,1566 5382.2,1566",
				style=dashed];
			l2_exp_gpu11	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 6,7
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 11",
				pos="5653,1522",
				width=2.8194];
			l2_moe_gate -> l2_exp_gpu11	[pos="e,5619.2,1556.1 5509.7,1679 5563.2,1679 5619.2,1679 5619.2,1679 5619.2,1679 5619.2,1566.1 5619.2,1566.1",
				style=dashed];
			l2_exp_gpu12	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 8,9
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 12",
				pos="5892,1522",
				width=2.8194];
			l2_moe_gate -> l2_exp_gpu12	[pos="e,5858.2,1556.4 5509.6,1696 5640.1,1696 5858.2,1696 5858.2,1696 5858.2,1696 5858.2,1566.4 5858.2,1566.4",
				style=dashed];
			l2_exp_gpu13	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 10,11
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 13",
				pos="6131,1522",
				width=2.8194];
			l2_moe_gate -> l2_exp_gpu13	[pos="e,6097.2,1556.1 5509.7,1713 5697.7,1713 6097.2,1713 6097.2,1713 6097.2,1713 6097.2,1566.1 6097.2,1566.1",
				style=dashed];
			l2_exp_gpu14	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 12,13
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 14",
				pos="4458,1522",
				width=2.8194];
			l2_moe_gate -> l2_exp_gpu14	[pos="e,4424.2,1556.2 5318.2,1716 5069.8,1716 4424.2,1716 4424.2,1716 4424.2,1716 4424.2,1566.2 4424.2,1566.2",
				style=dashed];
			l2_exp_gpu15	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 14,15
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 15",
				pos="4697,1522",
				width=2.8194];
			l2_moe_gate -> l2_exp_gpu15	[pos="e,4663.2,1556.3 5318.1,1702 5115.7,1702 4663.2,1702 4663.2,1702 4663.2,1702 4663.2,1566.3 4663.2,1566.3",
				style=dashed];
			l2_moe_agg	[fillcolor=lightcyan,
				height=0.94444,
				label="Expert Aggregation
Input: [1024,2048,4096]×2
Output: [1024,2048,4096]
GPU: 8-15",
				pos="5294,1382",
				width=2.9444];
			l2_exp_gpu8 -> l2_moe_agg	[pos="e,5187.6,1399 4936,1487.7 4936,1451.3 4936,1399 4936,1399 4936,1399 5177.6,1399 5177.6,1399"];
			l2_exp_gpu9 -> l2_moe_agg	[pos="e,5232.2,1416.4 5232.2,1487.8 5232.2,1487.8 5232.2,1426.4 5232.2,1426.4"];
			l2_exp_gpu10 -> l2_moe_agg	[pos="e,5356.2,1416.4 5356.2,1487.8 5356.2,1487.8 5356.2,1426.4 5356.2,1426.4"];
			l2_exp_gpu11 -> l2_moe_agg	[pos="e,5400.3,1399 5653,1487.7 5653,1451.3 5653,1399 5653,1399 5653,1399 5410.3,1399 5410.3,1399"];
			l2_exp_gpu12 -> l2_moe_agg	[pos="e,5400.2,1382 5892,1487.8 5892,1446.3 5892,1382 5892,1382 5892,1382 5410.2,1382 5410.2,1382"];
			l2_exp_gpu13 -> l2_moe_agg	[pos="e,5400,1365 6131,1487.9 6131,1441.8 6131,1365 6131,1365 6131,1365 5410,1365 5410,1365"];
			l2_exp_gpu14 -> l2_moe_agg	[pos="e,5187.7,1365 4458,1487.9 4458,1441.8 4458,1365 4458,1365 4458,1365 5177.7,1365 5177.7,1365"];
			l2_exp_gpu15 -> l2_moe_agg	[pos="e,5188,1382 4697,1487.8 4697,1446.3 4697,1382 4697,1382 4697,1382 5178,1382 5178,1382"];
			l2_moe_res	[fillcolor=orange,
				height=0.94444,
				label="Residual Add
Input: [1024,2048,4096], [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 8-15",
				pos="5294,1242",
				width=4.5556];
			l2_moe_agg -> l2_moe_res	[pos="e,5294,1276.4 5294,1347.8 5294,1347.8 5294,1286.4 5294,1286.4"];
		}
	}
	subgraph cluster_layer_3 {
		graph [bb="8,8,3814,990",
			color=purple,
			label="Layer 3",
			lheight=0.21,
			lp="1911,978.5",
			lwidth=0.76,
			style=dashed
		];
		subgraph cluster_attention_3 {
			graph [bb="16,16,1907,959",
				color=red,
				label="Attention Group (GPUs 0-7)",
				lheight=0.21,
				lp="961.5,947.5",
				lwidth=2.75,
				style=rounded
			];
			l3_qkv_all_gather	[fillcolor=lightcyan,
				height=1.8889,
				label="All-Gather QKV
Input: [1024,2048,4096]
Output: [1024,2048,4096]×8
GPU: 0-7",
				pos="1081,860",
				shape=parallelogram,
				width=6.4509];
			l3_qkv_gpu0	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU0
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 0",
				pos="1081,686",
				width=2.6944];
			l3_qkv_all_gather -> l3_qkv_gpu0	[pos="e,1081,720.11 1081,791.73 1081,791.73 1081,730.11 1081,730.11"];
			l3_qkv_gpu1	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU1
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 1",
				pos="1313,686",
				width=2.6944];
			l3_qkv_all_gather -> l3_qkv_gpu1	[pos="e,1264.6,720.09 1264.6,858.05 1264.6,858.05 1264.6,730.09 1264.6,730.09"];
			l3_qkv_gpu2	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU2
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 2",
				pos="1544,686",
				width=2.6944];
			l3_qkv_all_gather -> l3_qkv_gpu2	[pos="e,1544,720.21 1222.1,797 1358.3,797 1544,797 1544,797 1544,797 1544,730.21 1544,730.21"];
			l3_qkv_gpu3	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU3
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 3",
				pos="1775,686",
				width=2.6944];
			l3_qkv_all_gather -> l3_qkv_gpu3	[pos="e,1775,720.16 1226.1,803 1429.5,803 1775,803 1775,803 1775,803 1775,730.16 1775,730.16"];
			l3_qkv_gpu4	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU4
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 4",
				pos="144,686",
				width=2.6944];
			l3_qkv_all_gather -> l3_qkv_gpu4	[pos="e,144,720.35 919.66,894 651.68,894 144,894 144,894 144,894 144,730.35 144,730.35"];
			l3_qkv_gpu5	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU5
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 5",
				pos="391,686",
				width=2.6944];
			l3_qkv_all_gather -> l3_qkv_gpu5	[pos="e,391,720.38 896.09,860 691.71,860 391,860 391,860 391,860 391,730.38 391,730.38"];
			l3_qkv_gpu6	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU6
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 6",
				pos="621,686",
				width=2.6944];
			l3_qkv_all_gather -> l3_qkv_gpu6	[pos="e,621,720.25 872.2,826 750.59,826 621,826 621,826 621,826 621,730.25 621,730.25"];
			l3_qkv_gpu7	[fillcolor=yellow,
				height=0.94444,
				label="QKV Projection GPU7
Input: [1024,2048,4096]
Output: [1024,2048,512]
GPU: 7",
				pos="851,686",
				width=2.6944];
			l3_qkv_all_gather -> l3_qkv_gpu7	[pos="e,898.38,720.11 898.38,791.73 898.38,791.73 898.38,730.11 898.38,730.11"];
			l3_attn_gpu0	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU0
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 0",
				pos="1081,546",
				width=2.6944];
			l3_qkv_gpu0 -> l3_attn_gpu0	[pos="e,1081,580.38 1081,651.75 1081,651.75 1081,590.38 1081,590.38"];
			l3_out_gpu0	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU0
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 0",
				pos="1081,406",
				width=2.8194];
			l3_attn_gpu0 -> l3_out_gpu0	[pos="e,1081,440.38 1081,511.75 1081,511.75 1081,450.38 1081,450.38"];
			l3_attn_all_reduce	[fillcolor=lightcyan,
				height=1.8889,
				label="All-Reduce Attention
Input: [1024,2048,4096]×8
Output: [1024,2048,4096]
GPU: 0-7",
				pos="1081,232",
				shape=parallelogram,
				width=6.1053];
			l3_out_gpu0 -> l3_attn_all_reduce	[pos="e,1081,300.14 1081,371.62 1081,371.62 1081,310.14 1081,310.14"];
			l3_attn_gpu1	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU1
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 1",
				pos="1315,546",
				width=2.6944];
			l3_qkv_gpu1 -> l3_attn_gpu1	[pos="e,1314,580.38 1314,651.75 1314,651.75 1314,590.38 1314,590.38"];
			l3_out_gpu1	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU1
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 1",
				pos="1320,406",
				width=2.8194];
			l3_attn_gpu1 -> l3_out_gpu1	[pos="e,1315.2,440.38 1315.2,511.75 1315.2,511.75 1315.2,450.38 1315.2,450.38"];
			l3_out_gpu1 -> l3_attn_all_reduce	[pos="e,1259.6,300.14 1259.6,371.62 1259.6,371.62 1259.6,310.14 1259.6,310.14"];
			l3_attn_gpu2	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU2
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 2",
				pos="1548,546",
				width=2.6944];
			l3_qkv_gpu2 -> l3_attn_gpu2	[pos="e,1546,580.38 1546,651.75 1546,651.75 1546,590.38 1546,590.38"];
			l3_out_gpu2	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU2
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 2",
				pos="1559,406",
				width=2.8194];
			l3_attn_gpu2 -> l3_out_gpu2	[pos="e,1551.2,440.38 1551.2,511.75 1551.2,511.75 1551.2,450.38 1551.2,450.38"];
			l3_out_gpu2 -> l3_attn_all_reduce	[pos="e,1296,293 1514.2,371.79 1514.2,338.53 1514.2,293 1514.2,293 1514.2,293 1306,293 1306,293"];
			l3_attn_gpu3	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU3
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 3",
				pos="1779,546",
				width=2.6944];
			l3_qkv_gpu3 -> l3_attn_gpu3	[pos="e,1777,580.38 1777,651.75 1777,651.75 1777,590.38 1777,590.38"];
			l3_out_gpu3	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU3
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 3",
				pos="1798,406",
				width=2.8194];
			l3_attn_gpu3 -> l3_out_gpu3	[pos="e,1786.2,440.38 1786.2,511.75 1786.2,511.75 1786.2,450.38 1786.2,450.38"];
			l3_out_gpu3 -> l3_attn_all_reduce	[pos="e,1291.7,286 1797.8,371.93 1797.8,336.46 1797.8,286 1797.8,286 1797.8,286 1301.7,286 1301.7,286"];
			l3_attn_gpu4	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU4
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 4",
				pos="128,546",
				width=2.6944];
			l3_qkv_gpu4 -> l3_attn_gpu4	[pos="e,136,580.38 136,651.75 136,651.75 136,590.38 136,590.38"];
			l3_out_gpu4	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU4
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 4",
				pos="125,406",
				width=2.8194];
			l3_attn_gpu4 -> l3_out_gpu4	[pos="e,128,440.38 128,511.75 128,511.75 128,450.38 128,450.38"];
			l3_out_gpu4 -> l3_attn_all_reduce	[pos="e,883.79,198 125,371.65 125,312.58 125,198 125,198 125,198 873.79,198 873.79,198"];
			l3_attn_gpu5	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU5
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 5",
				pos="376,546",
				width=2.6944];
			l3_qkv_gpu5 -> l3_attn_gpu5	[pos="e,383.5,580.38 383.5,651.75 383.5,651.75 383.5,590.38 383.5,590.38"];
			l3_out_gpu5	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU5
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 5",
				pos="364,406",
				width=2.8194];
			l3_attn_gpu5 -> l3_out_gpu5	[pos="e,372.25,440.38 372.25,511.75 372.25,511.75 372.25,450.38 372.25,450.38"];
			l3_out_gpu5 -> l3_attn_all_reduce	[pos="e,906.06,232 364,371.62 364,320.91 364,232 364,232 364,232 896.06,232 896.06,232"];
			l3_attn_gpu6	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU6
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 6",
				pos="615,546",
				width=2.6944];
			l3_qkv_gpu6 -> l3_attn_gpu6	[pos="e,618,580.38 618,651.75 618,651.75 618,590.38 618,590.38"];
			l3_out_gpu6	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU6
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 6",
				pos="603,406",
				width=2.8194];
			l3_attn_gpu6 -> l3_out_gpu6	[pos="e,611.25,440.38 611.25,511.75 611.25,511.75 611.25,450.38 611.25,450.38"];
			l3_out_gpu6 -> l3_attn_all_reduce	[pos="e,928.77,266 603,371.75 603,330.31 603,266 603,266 603,266 918.77,266 918.77,266"];
			l3_attn_gpu7	[fillcolor=yellow,
				height=0.94444,
				label="Attention Heads GPU7
Input: [1024,2048,512]
Output: [1024,2048,512]
GPU: 7",
				pos="849,546",
				width=2.6944];
			l3_qkv_gpu7 -> l3_attn_gpu7	[pos="e,850,580.38 850,651.75 850,651.75 850,590.38 850,590.38"];
			l3_out_gpu7	[fillcolor=yellow,
				height=0.94444,
				label="Output Projection GPU7
Input: [1024,2048,512]
Output: [1024,2048,4096]
GPU: 7",
				pos="842,406",
				width=2.8194];
			l3_attn_gpu7 -> l3_out_gpu7	[pos="e,847.75,440.38 847.75,511.75 847.75,511.75 847.75,450.38 847.75,450.38"];
			l3_out_gpu7 -> l3_attn_all_reduce	[pos="e,902.35,232.06 902.35,371.62 902.35,371.62 902.35,242.06 902.35,242.06"];
			l3_attn_res	[fillcolor=orange,
				height=0.94444,
				label="Residual Add
Input: [1024,2048,4096], [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 0-7",
				pos="1735,58",
				width=4.5556];
			l3_attn_all_reduce -> l3_attn_res	[pos="e,1615.8,92.192 1217,173 1375.4,173 1615.8,173 1615.8,173 1615.8,173 1615.8,102.19 1615.8,102.19"];
		}
		subgraph cluster_moe_3 {
			graph [bb="1915,364,3806,925",
				color=blue,
				label="MoE Group (GPUs 8-15)",
				lheight=0.21,
				lp="2860.5,913.5",
				lwidth=2.40,
				style=rounded
			];
			l3_moe_gate	[fillcolor=lightcoral,
				height=0.94444,
				label="Gate Network
Input: [1024,2048,4096]
Output: [1024,2048,16]
GPU: 8-15",
				pos="2980,860",
				width=2.6528];
			l3_exp_gpu8	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 0,1
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 8",
				pos="2502,686",
				width=2.8194];
			l3_moe_gate -> l3_exp_gpu8	[pos="e,2468.2,720.2 2884.3,853 2736.2,853 2468.2,853 2468.2,853 2468.2,853 2468.2,730.2 2468.2,730.2",
				style=dashed];
			l3_exp_gpu9	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 2,3
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 9",
				pos="2741,686",
				width=2.8194];
			l3_moe_gate -> l3_exp_gpu9	[pos="e,2707.2,720.34 2884.2,839 2805.6,839 2707.2,839 2707.2,839 2707.2,839 2707.2,730.34 2707.2,730.34",
				style=dashed];
			l3_exp_gpu10	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 4,5
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 10",
				pos="2980,686",
				width=2.8194];
			l3_moe_gate -> l3_exp_gpu10	[pos="e,2948.2,720.01 2948.2,825.62 2948.2,825.62 2948.2,730.01 2948.2,730.01",
				style=dashed];
			l3_exp_gpu11	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 6,7
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 11",
				pos="3219,686",
				width=2.8194];
			l3_moe_gate -> l3_exp_gpu11	[pos="e,3185.2,720.34 3075.7,839 3129.2,839 3185.2,839 3185.2,839 3185.2,839 3185.2,730.34 3185.2,730.34",
				style=dashed];
			l3_exp_gpu12	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 8,9
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 12",
				pos="3458,686",
				width=2.8194];
			l3_moe_gate -> l3_exp_gpu12	[pos="e,3424.2,720.2 3075.6,853 3206.1,853 3424.2,853 3424.2,853 3424.2,853 3424.2,730.2 3424.2,730.2",
				style=dashed];
			l3_exp_gpu13	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 10,11
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 13",
				pos="3697,686",
				width=2.8194];
			l3_moe_gate -> l3_exp_gpu13	[pos="e,3663.2,720.28 3075.7,866 3263.7,866 3663.2,866 3663.2,866 3663.2,866 3663.2,730.28 3663.2,730.28",
				style=dashed];
			l3_exp_gpu14	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 12,13
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 14",
				pos="2024,686",
				width=2.8194];
			l3_moe_gate -> l3_exp_gpu14	[pos="e,1990.2,720.24 2884.2,880 2635.8,880 1990.2,880 1990.2,880 1990.2,880 1990.2,730.24 1990.2,730.24",
				style=dashed];
			l3_exp_gpu15	[fillcolor=lightpink,
				height=0.94444,
				label="Experts 14,15
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 15",
				pos="2263,686",
				width=2.8194];
			l3_moe_gate -> l3_exp_gpu15	[pos="e,2229.2,720.28 2884.1,866 2681.7,866 2229.2,866 2229.2,866 2229.2,866 2229.2,730.28 2229.2,730.28",
				style=dashed];
			l3_moe_agg	[fillcolor=lightcyan,
				height=0.94444,
				label="Expert Aggregation
Input: [1024,2048,4096]×2
Output: [1024,2048,4096]
GPU: 8-15",
				pos="2980,546",
				width=2.9444];
			l3_exp_gpu8 -> l3_moe_agg	[pos="e,2873.9,552 2502,651.84 2502,612.14 2502,552 2502,552 2502,552 2863.9,552 2863.9,552"];
			l3_exp_gpu9 -> l3_moe_agg	[pos="e,2873.8,566 2741,651.93 2741,616.46 2741,566 2741,566 2741,566 2863.8,566 2863.8,566"];
			l3_exp_gpu10 -> l3_moe_agg	[pos="e,2980,580.38 2980,651.75 2980,651.75 2980,590.38 2980,590.38"];
			l3_exp_gpu11 -> l3_moe_agg	[pos="e,3086.2,566 3219,651.93 3219,616.46 3219,566 3219,566 3219,566 3096.2,566 3096.2,566"];
			l3_exp_gpu12 -> l3_moe_agg	[pos="e,3086.3,552 3413.2,651.84 3413.2,612.14 3413.2,552 3413.2,552 3413.2,552 3096.3,552 3096.3,552"];
			l3_exp_gpu13 -> l3_moe_agg	[pos="e,3086.1,539 3696.8,651.91 3696.8,608.48 3696.8,539 3696.8,539 3696.8,539 3096.1,539 3096.1,539"];
			l3_exp_gpu14 -> l3_moe_agg	[pos="e,2873.6,525 2024,651.86 2024,604.6 2024,525 2024,525 2024,525 2863.6,525 2863.6,525"];
			l3_exp_gpu15 -> l3_moe_agg	[pos="e,2873.8,539 2263,651.91 2263,608.48 2263,539 2263,539 2263,539 2863.8,539 2863.8,539"];
			l3_moe_res	[fillcolor=orange,
				height=0.94444,
				label="Residual Add
Input: [1024,2048,4096], [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 8-15",
				pos="3634,406",
				width=4.5556];
			l3_moe_agg -> l3_moe_res	[pos="e,3514.8,440.1 3086.3,525 3242.2,525 3514.8,525 3514.8,525 3514.8,525 3514.8,450.1 3514.8,450.1"];
		}
	}
	input	[fillcolor=lightgreen,
		height=1.041,
		label="Input Embedding
Input: [batch_size=1024, seq_len=2048, hidden=4096]
GPU: all GPUs",
		pos="16497,3545.5",
		shape=ellipse,
		width=8.1121];
	input -> l0_qkv_all_gather	[pos="e,16249,3436.1 16249,3525.5 16249,3525.5 16249,3446.1 16249,3446.1"];
	input -> l0_attn_res	[pos="e,16104,2532 16417,3509.4 16417,3328.9 16417,2532 16417,2532 16417,2532 16114,2532 16114,2532"];
	l0_attn_to_moe	[fillcolor=gray,
		height=1.8889,
		label="Broadcast to MoE
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 0-7 → 8-15",
		pos="12870,3368",
		shape=parallelogram,
		width=5.8461];
	l0_attn_to_moe -> l0_moe_gate	[pos="e,13826,3388 13050,3388 13050,3388 13816,3388 13816,3388"];
	l0_attn_to_moe -> l0_exp_gpu8	[pos="e,13649,3228.1 13002,3312 13224,3312 13649,3312 13649,3312 13649,3312 13649,3238.1 13649,3238.1"];
	l0_attn_to_moe -> l0_exp_gpu9	[pos="e,13890,3228.2 13006,3318 13283,3318 13890,3318 13890,3318 13890,3318 13890,3238.2 13890,3238.2"];
	l0_attn_to_moe -> l0_exp_gpu10	[pos="e,14127,3228 13008,3321 13334,3321 14127,3321 14127,3321 14127,3321 14127,3238 14127,3238"];
	l0_attn_to_moe -> l0_exp_gpu11	[pos="e,14366,3228.2 13010,3324 13381,3324 14366,3324 14366,3324 14366,3324 14366,3238.2 14366,3238.2"];
	l0_attn_to_moe -> l0_exp_gpu12	[pos="e,14605,3228.3 13012,3327 13426,3327 14605,3327 14605,3327 14605,3327 14605,3238.3 14605,3238.3"];
	l0_attn_to_moe -> l0_exp_gpu13	[pos="e,14844,3228.3 13014,3330 13468,3330 14844,3330 14844,3330 14844,3330 14844,3238.3 14844,3238.3"];
	l0_attn_to_moe -> l0_exp_gpu14	[pos="e,13103,3194 13040,3367.9 13040,3362.6 13040,3194 13040,3194 13040,3194 13093,3194 13093,3194"];
	l0_attn_to_moe -> l0_exp_gpu15	[pos="e,13410,3228.2 12998,3306 13158,3306 13410,3306 13410,3306 13410,3306 13410,3238.2 13410,3238.2"];
	l0_attn_to_moe -> l0_moe_res	[pos="e,13104,2925 12999,3307.8 12999,3186.7 12999,2925 12999,2925 12999,2925 13094,2925 13094,2925"];
	l0_attn_res -> l0_attn_to_moe	[pos="e,12959,3299.9 15776,2532 15151,2532 12959,2532 12959,2532 12959,2532 12959,3289.9 12959,3289.9"];
	prev_layer_0	[height=0.5,
		pos="12865,2740",
		width=1.4861];
	l0_moe_res -> prev_layer_0	[pos="e,12865,2758.3 13104,2902 12992,2902 12865,2902 12865,2902 12865,2902 12865,2768.3 12865,2768.3"];
	l1_attn_to_moe	[fillcolor=gray,
		height=1.8889,
		label="Broadcast to MoE
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 0-7 → 8-15",
		pos="12698,2532",
		shape=parallelogram,
		width=5.8461];
	l1_attn_to_moe -> l1_moe_gate	[pos="e,9747,2566.1 12574,2599.9 12574,2619.7 12574,2636 12574,2636 12574,2636 9747,2636 9747,2636 9747,2636 9747,2576.1 9747,2576.1"];
	l1_attn_to_moe -> l1_exp_gpu8	[pos="e,9302.8,2392.3 12602,2463.7 12602,2450.1 12602,2440 12602,2440 12602,2440 9302.8,2440 9302.8,2440 9302.8,2440 9302.8,2402.3 9302.8,\
2402.3"];
	l1_attn_to_moe -> l1_exp_gpu9	[pos="e,9541.8,2392.4 12641,2463.9 12641,2446.2 12641,2432 12641,2432 12641,2432 9541.8,2432 9541.8,2432 9541.8,2432 9541.8,2402.4 9541.8,\
2402.4"];
	l1_attn_to_moe -> l1_exp_gpu10	[pos="e,9778.8,2392.2 12679,2463.9 12679,2442.3 12679,2424 12679,2424 12679,2424 9778.8,2424 9778.8,2424 9778.8,2424 9778.8,2402.2 9778.8,\
2402.2"];
	l1_attn_to_moe -> l1_exp_gpu11	[pos="e,10020,2392.1 12717,2463.9 12717,2438.6 12717,2416 12717,2416 12717,2416 10020,2416 10020,2416 10020,2416 10020,2402.1 10020,2402.1"];
	l1_attn_to_moe -> l1_exp_gpu12	[pos="e,10259,2392.2 12755,2463.8 12755,2435 12755,2408 12755,2408 12755,2408 10259,2408 10259,2408 10259,2408 10259,2402.2 10259,2402.2"];
	l1_attn_to_moe -> l1_exp_gpu13	[pos="e,10498,2392.3 12794,2463.7 12794,2431.5 12794,2400 12794,2400 12794,2400 10498,2400 10498,2400 10498,2400 10498,2399.2 10498,2399.2"];
	l1_attn_to_moe -> l1_exp_gpu14	[pos="e,8824.8,2392 12526,2463.8 12526,2459 12526,2456 12526,2456 12526,2456 8824.8,2456 8824.8,2456 8824.8,2456 8824.8,2402 8824.8,2402"];
	l1_attn_to_moe -> l1_exp_gpu15	[pos="e,9063.8,2392 12564,2463.8 12564,2454.5 12564,2448 12564,2448 12564,2448 9063.8,2448 9063.8,2448 9063.8,2448 9063.8,2402 9063.8,\
2402"];
	l1_attn_to_moe -> l1_moe_res	[pos="e,9762,2112.2 12832,2479 12832,2373.7 12832,2148 12832,2148 12832,2148 9762,2148 9762,2148 9762,2148 9762,2122.2 9762,2122.2"];
	l1_attn_res -> l1_attn_to_moe	[pos="e,12870,2531.8 12464,1707 12633,1707 12870,1707 12870,1707 12870,1707 12870,2521.8 12870,2521.8"];
	prev_layer_1	[height=0.5,
		pos="8613,1904",
		width=1.4861];
	l1_moe_res -> prev_layer_1	[pos="e,8613,1922.3 9463,2078 9176,2078 8613,2078 8613,2078 8613,2078 8613,1932.3 8613,1932.3"];
	l2_attn_to_moe	[fillcolor=gray,
		height=1.8889,
		label="Broadcast to MoE
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 0-7 → 8-15",
		pos="8365,1696",
		shape=parallelogram,
		width=5.8461];
	l2_attn_to_moe -> l2_moe_gate	[pos="e,5414,1730.1 8357,1764.2 8357,1783.8 8357,1800 8357,1800 8357,1800 5414,1800 5414,1800 5414,1800 5414,1740.1 5414,1740.1"];
	l2_attn_to_moe -> l2_exp_gpu8	[pos="e,4969.8,1556.3 8269.3,1627.7 8269.3,1614.1 8269.3,1604 8269.3,1604 8269.3,1604 4969.8,1604 4969.8,1604 4969.8,1604 4969.8,1566.3 \
4969.8,1566.3"];
	l2_attn_to_moe -> l2_exp_gpu9	[pos="e,5208.8,1556.4 8307.6,1627.9 8307.6,1610.2 8307.6,1596 8307.6,1596 8307.6,1596 5208.8,1596 5208.8,1596 5208.8,1596 5208.8,1566.4 \
5208.8,1566.4"];
	l2_attn_to_moe -> l2_exp_gpu10	[pos="e,5445.8,1556.2 8345.9,1627.9 8345.9,1606.3 8345.9,1588 8345.9,1588 8345.9,1588 5445.8,1588 5445.8,1588 5445.8,1588 5445.8,1566.2 \
5445.8,1566.2"];
	l2_attn_to_moe -> l2_exp_gpu11	[pos="e,5686.8,1556.1 8384.1,1627.9 8384.1,1602.6 8384.1,1580 8384.1,1580 8384.1,1580 5686.8,1580 5686.8,1580 5686.8,1580 5686.8,1566.1 \
5686.8,1566.1"];
	l2_attn_to_moe -> l2_exp_gpu12	[pos="e,5925.8,1556.2 8422.4,1627.8 8422.4,1599 8422.4,1572 8422.4,1572 8422.4,1572 5925.8,1572 5925.8,1572 5925.8,1572 5925.8,1566.2 \
5925.8,1566.2"];
	l2_attn_to_moe -> l2_exp_gpu13	[pos="e,6164.8,1556.3 8460.7,1627.7 8460.7,1595.5 8460.7,1564 8460.7,1564 8460.7,1564 6164.8,1564 6164.8,1564 6164.8,1564 6164.8,1563.2 \
6164.8,1563.2"];
	l2_attn_to_moe -> l2_exp_gpu14	[pos="e,4491.8,1556 8192.8,1627.8 8192.8,1623 8192.8,1620 8192.8,1620 8192.8,1620 4491.8,1620 4491.8,1620 4491.8,1620 4491.8,1566 4491.8,\
1566"];
	l2_attn_to_moe -> l2_exp_gpu15	[pos="e,4730.8,1556 8231.1,1627.8 8231.1,1618.5 8231.1,1612 8231.1,1612 8231.1,1612 4730.8,1612 4730.8,1612 4730.8,1612 4730.8,1566 4730.8,\
1566"];
	l2_attn_to_moe -> l2_moe_res	[pos="e,5429,1276.2 8498.9,1643 8498.9,1537.7 8498.9,1312 8498.9,1312 8498.9,1312 5429,1312 5429,1312 5429,1312 5429,1286.2 5429,1286.2"];
	l2_attn_res -> l2_attn_to_moe	[pos="e,8537.2,1695.8 8131.2,871 8299.6,871 8537.2,871 8537.2,871 8537.2,871 8537.2,1685.8 8537.2,1685.8"];
	prev_layer_2	[height=0.5,
		pos="4280,1068",
		width=1.4861];
	l2_moe_res -> prev_layer_2	[pos="e,4280,1086.3 5130,1242 4843,1242 4280,1242 4280,1242 4280,1242 4280,1096.3 4280,1096.3"];
	l3_attn_to_moe	[fillcolor=gray,
		height=1.8889,
		label="Broadcast to MoE
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 0-7 → 8-15",
		pos="4032,860",
		shape=parallelogram,
		width=5.8461];
	l3_attn_to_moe -> l3_moe_gate	[pos="e,3075.8,880 3877.1,880 3877.1,880 3085.8,880 3085.8,880"];
	l3_attn_to_moe -> l3_exp_gpu8	[pos="e,2535.8,720.3 3835.2,814 3429.2,814 2535.8,814 2535.8,814 2535.8,814 2535.8,730.3 2535.8,730.3"];
	l3_attn_to_moe -> l3_exp_gpu9	[pos="e,2774.8,720.16 3833.5,811 3479.2,811 2774.8,811 2774.8,811 2774.8,811 2774.8,730.16 2774.8,730.16"];
	l3_attn_to_moe -> l3_exp_gpu10	[pos="e,3011.8,720.26 3832.3,809 3535.3,809 3011.8,809 3011.8,809 3011.8,809 3011.8,730.26 3011.8,730.26"];
	l3_attn_to_moe -> l3_exp_gpu11	[pos="e,3252.8,720.07 3830.3,806 3599.5,806 3252.8,806 3252.8,806 3252.8,806 3252.8,730.07 3252.8,730.07"];
	l3_attn_to_moe -> l3_exp_gpu12	[pos="e,3491.8,720.2 3826.6,800 3673.9,800 3491.8,800 3491.8,800 3491.8,800 3491.8,730.2 3491.8,730.2"];
	l3_attn_to_moe -> l3_exp_gpu13	[pos="e,3730.8,720.17 3822.8,794 3771.4,794 3730.8,794 3730.8,794 3730.8,794 3730.8,730.17 3730.8,730.17"];
	l3_attn_to_moe -> l3_exp_gpu14	[pos="e,2057.8,720.16 3839.1,820 3342.4,820 2057.8,820 2057.8,820 2057.8,820 2057.8,730.16 2057.8,730.16"];
	l3_attn_to_moe -> l3_exp_gpu15	[pos="e,2296.8,720.08 3837.2,817 3383.9,817 2296.8,817 2296.8,817 2296.8,817 2296.8,730.08 2296.8,730.08"];
	l3_attn_to_moe -> l3_moe_res	[pos="e,3798.1,417 3918.2,791.75 3918.2,667.49 3918.2,417 3918.2,417 3918.2,417 3808.1,417 3808.1,417"];
	l3_attn_res -> l3_attn_to_moe	[pos="e,3841.1,823 1669.2,92.357 1669.2,241.21 1669.2,823 1669.2,823 1669.2,823 3831.1,823 3831.1,823"];
	output	[fillcolor=lightgreen,
		height=1.3356,
		label="Final Output
Input: [1024,2048,4096]
Output: [1024,2048,4096]
GPU: 8-15",
		pos="3966,232",
		shape=ellipse,
		width=3.9873];
	l3_moe_res -> output	[pos="e,4013.8,277.56 3798.1,394 3900.9,394 4013.8,394 4013.8,394 4013.8,394 4013.8,287.56 4013.8,287.56"];
	prev_layer_0 -> l1_qkv_all_gather	[pos="e,11646,2600.1 12811,2740 12576,2740 11646,2740 11646,2740 11646,2740 11646,2610.1 11646,2610.1"];
	prev_layer_0 -> l1_attn_res	[pos="e,12464,1684 12913,2721.7 12913,2581.4 12913,1684 12913,1684 12913,1684 12474,1684 12474,1684"];
	prev_layer_1 -> l2_qkv_all_gather	[pos="e,7313,1764.1 8559.2,1904 8313.9,1904 7313,1904 7313,1904 7313,1904 7313,1774.1 7313,1774.1"];
	prev_layer_1 -> l2_attn_res	[pos="e,8131.2,848 8621,1885.7 8621,1745.4 8621,848 8621,848 8621,848 8141.2,848 8141.2,848"];
	prev_layer_2 -> l3_qkv_all_gather	[pos="e,1081,928.11 4226.5,1068 3808.3,1068 1081,1068 1081,1068 1081,1068 1081,938.11 1081,938.11"];
	prev_layer_2 -> l3_attn_res	[pos="e,1899.1,58 4288,1049.6 4288,912.72 4288,58 4288,58 4288,58 1909.1,58 1909.1,58"];
}
