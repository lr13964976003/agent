<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: layer_2_optimized Pages: 1 -->
<svg width="3537pt" height="1243pt"
 viewBox="0.00 0.00 3537.00 1243.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1239)">
<title>layer_2_optimized</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1239 3533,-1239 3533,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightgreen" stroke="black" cx="1776" cy="-1217" rx="127.28" ry="18"/>
<text text-anchor="middle" x="1776" y="-1213.3" font-family="Times,serif" font-size="14.00">Input\n[1024,2048,4096]</text>
</g>
<!-- l2_token_split -->
<g id="node3" class="node">
<title>l2_token_split</title>
<polygon fill="lightcyan" stroke="black" points="1983.6,-1126 1236.57,-1126 1044.4,-1090 1791.43,-1090 1983.6,-1126"/>
<text text-anchor="middle" x="1514" y="-1104.3" font-family="Times,serif" font-size="14.00">Token Split\n[1024,2048,4096]\n→ 8×[128,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- input&#45;&gt;l2_token_split -->
<g id="edge1" class="edge">
<title>input&#45;&gt;l2_token_split</title>
<path fill="none" stroke="black" d="M1736.49,-1199.87C1690.83,-1181.22 1615.55,-1150.47 1565.38,-1129.98"/>
<polygon fill="black" stroke="black" points="1566.58,-1126.69 1556,-1126.15 1563.94,-1133.17 1566.58,-1126.69"/>
</g>
<!-- l2_attn_res -->
<g id="node8" class="node">
<title>l2_attn_res</title>
<polygon fill="orange" stroke="black" points="2072.5,-581 1735.5,-581 1735.5,-545 2072.5,-545 2072.5,-581"/>
<text text-anchor="middle" x="1904" y="-559.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- input&#45;&gt;l2_attn_res -->
<g id="edge7" class="edge">
<title>input&#45;&gt;l2_attn_res</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M1845.79,-1201.92C1923.7,-1184.14 2039,-1150.78 2039,-1109 2039,-1109 2039,-1109 2039,-671 2039,-630.09 2000.46,-602.36 1964.57,-585.39"/>
<polygon fill="blue" stroke="blue" points="1965.59,-582.01 1955.04,-581.1 1962.72,-588.4 1965.59,-582.01"/>
<text text-anchor="middle" x="2070" y="-886.3" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- output -->
<g id="node2" class="node">
<title>output</title>
<ellipse fill="lightgreen" stroke="black" cx="2685" cy="-18" rx="172.77" ry="18"/>
<text text-anchor="middle" x="2685" y="-14.3" font-family="Times,serif" font-size="14.00">Layer 2 Output\n[1024,2048,4096]</text>
</g>
<!-- l2_qkv_proj -->
<g id="node4" class="node">
<title>l2_qkv_proj</title>
<polygon fill="yellow" stroke="black" points="1756,-1017 1272,-1017 1272,-981 1756,-981 1756,-1017"/>
<text text-anchor="middle" x="1514" y="-995.3" font-family="Times,serif" font-size="14.00">QKV Projections\n8×[128,2048,4096]\n×[4096,1536]\nGPU: 8&#45;15</text>
</g>
<!-- l2_token_split&#45;&gt;l2_qkv_proj -->
<g id="edge2" class="edge">
<title>l2_token_split&#45;&gt;l2_qkv_proj</title>
<path fill="none" stroke="black" d="M1514,-1089.81C1514,-1072.96 1514,-1047.02 1514,-1027.34"/>
<polygon fill="black" stroke="black" points="1517.5,-1027.15 1514,-1017.15 1510.5,-1027.15 1517.5,-1027.15"/>
</g>
<!-- l2_attention -->
<g id="node5" class="node">
<title>l2_attention</title>
<polygon fill="yellow" stroke="black" points="1796.5,-908 1229.5,-908 1229.5,-872 1796.5,-872 1796.5,-908"/>
<text text-anchor="middle" x="1513" y="-886.3" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention\n8×[128,2048,1536]\n→ 8×[128,2048,512]\nGPU: 8&#45;15</text>
</g>
<!-- l2_qkv_proj&#45;&gt;l2_attention -->
<g id="edge3" class="edge">
<title>l2_qkv_proj&#45;&gt;l2_attention</title>
<path fill="none" stroke="black" d="M1513.84,-980.81C1513.68,-963.96 1513.44,-938.02 1513.26,-918.34"/>
<polygon fill="black" stroke="black" points="1516.75,-918.12 1513.16,-908.15 1509.75,-918.18 1516.75,-918.12"/>
</g>
<!-- l2_out_proj -->
<g id="node6" class="node">
<title>l2_out_proj</title>
<polygon fill="yellow" stroke="black" points="1752.5,-799 1267.5,-799 1267.5,-763 1752.5,-763 1752.5,-799"/>
<text text-anchor="middle" x="1510" y="-777.3" font-family="Times,serif" font-size="14.00">Output Projections\n8×[128,2048,512]\n×[512,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l2_attention&#45;&gt;l2_out_proj -->
<g id="edge4" class="edge">
<title>l2_attention&#45;&gt;l2_out_proj</title>
<path fill="none" stroke="black" d="M1512.52,-871.81C1512.05,-854.96 1511.32,-829.02 1510.77,-809.34"/>
<polygon fill="black" stroke="black" points="1514.26,-809.05 1510.48,-799.15 1507.26,-809.24 1514.26,-809.05"/>
</g>
<!-- l2_gather -->
<g id="node7" class="node">
<title>l2_gather</title>
<polygon fill="lightcyan" stroke="black" points="1984.09,-690 1212.42,-690 1013.91,-654 1785.58,-654 1984.09,-690"/>
<text text-anchor="middle" x="1499" y="-668.3" font-family="Times,serif" font-size="14.00">Token Gather\n8×[128,2048,4096]\n→ [1024,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l2_out_proj&#45;&gt;l2_gather -->
<g id="edge5" class="edge">
<title>l2_out_proj&#45;&gt;l2_gather</title>
<path fill="none" stroke="black" d="M1508.23,-762.81C1506.5,-745.96 1503.83,-720.02 1501.81,-700.34"/>
<polygon fill="black" stroke="black" points="1505.27,-699.74 1500.76,-690.15 1498.3,-700.45 1505.27,-699.74"/>
</g>
<!-- l2_gather&#45;&gt;l2_attn_res -->
<g id="edge6" class="edge">
<title>l2_gather&#45;&gt;l2_attn_res</title>
<path fill="none" stroke="black" d="M1563.62,-653.93C1636.08,-634.78 1753.38,-603.79 1829.6,-583.66"/>
<polygon fill="black" stroke="black" points="1830.83,-586.95 1839.61,-581.01 1829.05,-580.18 1830.83,-586.95"/>
</g>
<!-- l2_gate -->
<g id="node9" class="node">
<title>l2_gate</title>
<polygon fill="lightcoral" stroke="black" points="1383.5,-472 946.5,-472 946.5,-436 1383.5,-436 1383.5,-472"/>
<text text-anchor="middle" x="1165" y="-450.3" font-family="Times,serif" font-size="14.00">Gate Network\n[1024,2048,4096]\n×[4096,16]\nGPU: 8&#45;15</text>
</g>
<!-- l2_attn_res&#45;&gt;l2_gate -->
<g id="edge8" class="edge">
<title>l2_attn_res&#45;&gt;l2_gate</title>
<path fill="none" stroke="black" d="M1786.49,-544.99C1651.81,-525.49 1431.81,-493.63 1292.91,-473.52"/>
<polygon fill="black" stroke="black" points="1293.03,-470 1282.63,-472.03 1292.03,-476.93 1293.03,-470"/>
</g>
<!-- l2_router -->
<g id="node10" class="node">
<title>l2_router</title>
<polygon fill="lightcyan" stroke="black" points="2388.19,-472 1617.95,-472 1419.81,-436 2190.05,-436 2388.19,-472"/>
<text text-anchor="middle" x="1904" y="-450.3" font-family="Times,serif" font-size="14.00">Token Router\n[1024,2048,4096]\n→ 8×[128,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l2_attn_res&#45;&gt;l2_router -->
<g id="edge9" class="edge">
<title>l2_attn_res&#45;&gt;l2_router</title>
<path fill="none" stroke="black" d="M1904,-544.81C1904,-527.96 1904,-502.02 1904,-482.34"/>
<polygon fill="black" stroke="black" points="1907.5,-482.15 1904,-472.15 1900.5,-482.15 1907.5,-482.15"/>
</g>
<!-- l2_moe_res -->
<g id="node20" class="node">
<title>l2_moe_res</title>
<polygon fill="orange" stroke="black" points="2853.5,-145 2516.5,-145 2516.5,-109 2853.5,-109 2853.5,-145"/>
<text text-anchor="middle" x="2685" y="-123.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l2_attn_res&#45;&gt;l2_moe_res -->
<g id="edge27" class="edge">
<title>l2_attn_res&#45;&gt;l2_moe_res</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M2072.75,-559.1C2476.91,-551.06 3467,-524.27 3467,-455 3467,-455 3467,-455 3467,-235 3467,-174.49 3094.76,-146.54 2863.92,-135.03"/>
<polygon fill="blue" stroke="blue" points="2863.88,-131.52 2853.72,-134.53 2863.54,-138.52 2863.88,-131.52"/>
<text text-anchor="middle" x="3498" y="-341.3" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- l2_exp0 -->
<g id="node11" class="node">
<title>l2_exp0</title>
<polygon fill="lightpink" stroke="black" points="386,-363 0,-363 0,-327 386,-327 386,-363"/>
<text text-anchor="middle" x="193" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 0\n[128,2048,4096]\n×[4096,4096]\nGPU: 8</text>
</g>
<!-- l2_router&#45;&gt;l2_exp0 -->
<g id="edge10" class="edge">
<title>l2_router&#45;&gt;l2_exp0</title>
<path fill="none" stroke="black" d="M1589.28,-435.99C1285.69,-419.15 813.23,-391.76 404,-363 401.43,-362.82 398.85,-362.64 396.25,-362.45"/>
<polygon fill="black" stroke="black" points="396.39,-358.95 386.16,-361.72 395.89,-365.93 396.39,-358.95"/>
</g>
<!-- l2_exp1 -->
<g id="node12" class="node">
<title>l2_exp1</title>
<polygon fill="lightpink" stroke="black" points="808,-363 422,-363 422,-327 808,-327 808,-363"/>
<text text-anchor="middle" x="615" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 1\n[128,2048,4096]\n×[4096,4096]\nGPU: 9</text>
</g>
<!-- l2_router&#45;&gt;l2_exp1 -->
<g id="edge12" class="edge">
<title>l2_router&#45;&gt;l2_exp1</title>
<path fill="none" stroke="black" d="M1699.04,-435.99C1457.62,-415.95 1059.04,-382.86 818.33,-362.88"/>
<polygon fill="black" stroke="black" points="818.31,-359.37 808.06,-362.03 817.73,-366.34 818.31,-359.37"/>
</g>
<!-- l2_exp2 -->
<g id="node13" class="node">
<title>l2_exp2</title>
<polygon fill="lightpink" stroke="black" points="1239.5,-363 844.5,-363 844.5,-327 1239.5,-327 1239.5,-363"/>
<text text-anchor="middle" x="1042" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 2\n[128,2048,4096]\n×[4096,4096]\nGPU: 10</text>
</g>
<!-- l2_router&#45;&gt;l2_exp2 -->
<g id="edge14" class="edge">
<title>l2_router&#45;&gt;l2_exp2</title>
<path fill="none" stroke="black" d="M1766.94,-435.99C1609.21,-416.41 1351.16,-384.38 1189.25,-364.28"/>
<polygon fill="black" stroke="black" points="1189.57,-360.79 1179.21,-363.03 1188.7,-367.74 1189.57,-360.79"/>
</g>
<!-- l2_exp3 -->
<g id="node14" class="node">
<title>l2_exp3</title>
<polygon fill="lightpink" stroke="black" points="1670.5,-363 1275.5,-363 1275.5,-327 1670.5,-327 1670.5,-363"/>
<text text-anchor="middle" x="1473" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 3\n[128,2048,4096]\n×[4096,4096]\nGPU: 11</text>
</g>
<!-- l2_router&#45;&gt;l2_exp3 -->
<g id="edge16" class="edge">
<title>l2_router&#45;&gt;l2_exp3</title>
<path fill="none" stroke="black" d="M1835.23,-435.93C1757.97,-416.75 1632.78,-385.67 1551.68,-365.53"/>
<polygon fill="black" stroke="black" points="1552.07,-362.02 1541.52,-363.01 1550.39,-368.82 1552.07,-362.02"/>
</g>
<!-- l2_exp4 -->
<g id="node15" class="node">
<title>l2_exp4</title>
<polygon fill="lightpink" stroke="black" points="2101.5,-363 1706.5,-363 1706.5,-327 2101.5,-327 2101.5,-363"/>
<text text-anchor="middle" x="1904" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 4\n[128,2048,4096]\n×[4096,4096]\nGPU: 12</text>
</g>
<!-- l2_router&#45;&gt;l2_exp4 -->
<g id="edge18" class="edge">
<title>l2_router&#45;&gt;l2_exp4</title>
<path fill="none" stroke="black" d="M1904,-435.81C1904,-418.96 1904,-393.02 1904,-373.34"/>
<polygon fill="black" stroke="black" points="1907.5,-373.15 1904,-363.15 1900.5,-373.15 1907.5,-373.15"/>
</g>
<!-- l2_exp5 -->
<g id="node16" class="node">
<title>l2_exp5</title>
<polygon fill="lightpink" stroke="black" points="2532.5,-363 2137.5,-363 2137.5,-327 2532.5,-327 2532.5,-363"/>
<text text-anchor="middle" x="2335" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 5\n[128,2048,4096]\n×[4096,4096]\nGPU: 13</text>
</g>
<!-- l2_router&#45;&gt;l2_exp5 -->
<g id="edge20" class="edge">
<title>l2_router&#45;&gt;l2_exp5</title>
<path fill="none" stroke="black" d="M1972.77,-435.93C2050.03,-416.75 2175.22,-385.67 2256.32,-365.53"/>
<polygon fill="black" stroke="black" points="2257.61,-368.82 2266.48,-363.01 2255.93,-362.02 2257.61,-368.82"/>
</g>
<!-- l2_exp6 -->
<g id="node17" class="node">
<title>l2_exp6</title>
<polygon fill="lightpink" stroke="black" points="2963.5,-363 2568.5,-363 2568.5,-327 2963.5,-327 2963.5,-363"/>
<text text-anchor="middle" x="2766" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 6\n[128,2048,4096]\n×[4096,4096]\nGPU: 14</text>
</g>
<!-- l2_router&#45;&gt;l2_exp6 -->
<g id="edge22" class="edge">
<title>l2_router&#45;&gt;l2_exp6</title>
<path fill="none" stroke="black" d="M2041.06,-435.99C2198.79,-416.41 2456.84,-384.38 2618.75,-364.28"/>
<polygon fill="black" stroke="black" points="2619.3,-367.74 2628.79,-363.03 2618.43,-360.79 2619.3,-367.74"/>
</g>
<!-- l2_exp7 -->
<g id="node18" class="node">
<title>l2_exp7</title>
<polygon fill="lightpink" stroke="black" points="3394.5,-363 2999.5,-363 2999.5,-327 3394.5,-327 3394.5,-363"/>
<text text-anchor="middle" x="3197" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 7\n[128,2048,4096]\n×[4096,4096]\nGPU: 15</text>
</g>
<!-- l2_router&#45;&gt;l2_exp7 -->
<g id="edge24" class="edge">
<title>l2_router&#45;&gt;l2_exp7</title>
<path fill="none" stroke="black" d="M2109.59,-435.99C2350.45,-416.06 2747.23,-383.22 2989.08,-363.21"/>
<polygon fill="black" stroke="black" points="2989.73,-366.66 2999.41,-362.35 2989.15,-359.69 2989.73,-366.66"/>
</g>
<!-- l2_agg -->
<g id="node19" class="node">
<title>l2_agg</title>
<polygon fill="lightcyan" stroke="black" points="2431.86,-254 1592.15,-254 1376.14,-218 2215.85,-218 2431.86,-254"/>
<text text-anchor="middle" x="1904" y="-232.3" font-family="Times,serif" font-size="14.00">Expert Aggregation\n8×[128,2048,4096]\n→ [1024,2048,4096]\nGPU: 8&#45;15</text>
</g>
<!-- l2_exp0&#45;&gt;l2_agg -->
<g id="edge11" class="edge">
<title>l2_exp0&#45;&gt;l2_agg</title>
<path fill="none" stroke="black" d="M386.16,-328.28C392.18,-327.84 398.13,-327.41 404,-327 809.6,-298.5 1277.31,-271.34 1581.16,-254.46"/>
<polygon fill="black" stroke="black" points="1581.66,-257.93 1591.45,-253.89 1581.27,-250.95 1581.66,-257.93"/>
</g>
<!-- l2_exp1&#45;&gt;l2_agg -->
<g id="edge13" class="edge">
<title>l2_exp1&#45;&gt;l2_agg</title>
<path fill="none" stroke="black" d="M808.32,-327.95C1044.63,-308.34 1443.29,-275.24 1689.03,-254.85"/>
<polygon fill="black" stroke="black" points="1689.48,-258.32 1699.16,-254 1688.9,-251.34 1689.48,-258.32"/>
</g>
<!-- l2_exp2&#45;&gt;l2_agg -->
<g id="edge15" class="edge">
<title>l2_exp2&#45;&gt;l2_agg</title>
<path fill="none" stroke="black" d="M1179.06,-326.99C1336.79,-307.41 1594.84,-275.38 1756.75,-255.28"/>
<polygon fill="black" stroke="black" points="1757.3,-258.74 1766.79,-254.03 1756.43,-251.79 1757.3,-258.74"/>
</g>
<!-- l2_exp3&#45;&gt;l2_agg -->
<g id="edge17" class="edge">
<title>l2_exp3&#45;&gt;l2_agg</title>
<path fill="none" stroke="black" d="M1541.77,-326.93C1619.03,-307.75 1744.22,-276.67 1825.32,-256.53"/>
<polygon fill="black" stroke="black" points="1826.61,-259.82 1835.48,-254.01 1824.93,-253.02 1826.61,-259.82"/>
</g>
<!-- l2_exp4&#45;&gt;l2_agg -->
<g id="edge19" class="edge">
<title>l2_exp4&#45;&gt;l2_agg</title>
<path fill="none" stroke="black" d="M1904,-326.81C1904,-309.96 1904,-284.02 1904,-264.34"/>
<polygon fill="black" stroke="black" points="1907.5,-264.15 1904,-254.15 1900.5,-264.15 1907.5,-264.15"/>
</g>
<!-- l2_exp5&#45;&gt;l2_agg -->
<g id="edge21" class="edge">
<title>l2_exp5&#45;&gt;l2_agg</title>
<path fill="none" stroke="black" d="M2266.23,-326.93C2188.97,-307.75 2063.78,-276.67 1982.68,-256.53"/>
<polygon fill="black" stroke="black" points="1983.07,-253.02 1972.52,-254.01 1981.39,-259.82 1983.07,-253.02"/>
</g>
<!-- l2_exp6&#45;&gt;l2_agg -->
<g id="edge23" class="edge">
<title>l2_exp6&#45;&gt;l2_agg</title>
<path fill="none" stroke="black" d="M2628.94,-326.99C2471.21,-307.41 2213.16,-275.38 2051.25,-255.28"/>
<polygon fill="black" stroke="black" points="2051.57,-251.79 2041.21,-254.03 2050.7,-258.74 2051.57,-251.79"/>
</g>
<!-- l2_exp7&#45;&gt;l2_agg -->
<g id="edge25" class="edge">
<title>l2_exp7&#45;&gt;l2_agg</title>
<path fill="none" stroke="black" d="M2999.21,-327.63C2761.71,-307.98 2364.79,-275.13 2119.62,-254.84"/>
<polygon fill="black" stroke="black" points="2119.77,-251.34 2109.51,-254.01 2119.19,-258.32 2119.77,-251.34"/>
</g>
<!-- l2_agg&#45;&gt;l2_moe_res -->
<g id="edge26" class="edge">
<title>l2_agg&#45;&gt;l2_moe_res</title>
<path fill="none" stroke="black" d="M2028.18,-217.99C2170.81,-198.45 2403.96,-166.5 2550.71,-146.4"/>
<polygon fill="black" stroke="black" points="2551.25,-149.86 2560.68,-145.03 2550.3,-142.92 2551.25,-149.86"/>
</g>
<!-- l2_moe_res&#45;&gt;output -->
<g id="edge28" class="edge">
<title>l2_moe_res&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2685,-108.81C2685,-91.96 2685,-66.02 2685,-46.34"/>
<polygon fill="black" stroke="black" points="2688.5,-46.15 2685,-36.15 2681.5,-46.15 2688.5,-46.15"/>
</g>
</g>
</svg>
