<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: layer_1_optimized Pages: 1 -->
<svg width="3482pt" height="1243pt"
 viewBox="0.00 0.00 3482.00 1243.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1239)">
<title>layer_1_optimized</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1239 3478,-1239 3478,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightgreen" stroke="black" cx="1756" cy="-1217" rx="127.28" ry="18"/>
<text text-anchor="middle" x="1756" y="-1213.3" font-family="Times,serif" font-size="14.00">Input\n[1024,2048,4096]</text>
</g>
<!-- l1_token_split -->
<g id="node3" class="node">
<title>l1_token_split</title>
<polygon fill="lightcyan" stroke="black" points="1959.45,-1126 1225.39,-1126 1036.55,-1090 1770.61,-1090 1959.45,-1126"/>
<text text-anchor="middle" x="1498" y="-1104.3" font-family="Times,serif" font-size="14.00">Token Split\n[1024,2048,4096]\n→ 8×[128,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- input&#45;&gt;l1_token_split -->
<g id="edge1" class="edge">
<title>input&#45;&gt;l1_token_split</title>
<path fill="none" stroke="black" d="M1716.82,-1199.75C1671.88,-1181.11 1598.09,-1150.51 1548.78,-1130.06"/>
<polygon fill="black" stroke="black" points="1549.84,-1126.71 1539.26,-1126.11 1547.16,-1133.18 1549.84,-1126.71"/>
</g>
<!-- l1_attn_res -->
<g id="node8" class="node">
<title>l1_attn_res</title>
<polygon fill="orange" stroke="black" points="2045,-581 1717,-581 1717,-545 2045,-545 2045,-581"/>
<text text-anchor="middle" x="1881" y="-559.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- input&#45;&gt;l1_attn_res -->
<g id="edge7" class="edge">
<title>input&#45;&gt;l1_attn_res</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M1875.56,-1210.59C1943.05,-1200.35 2014,-1174.1 2014,-1109 2014,-1109 2014,-1109 2014,-671 2014,-630.33 1975.78,-602.51 1940.31,-585.46"/>
<polygon fill="red" stroke="red" points="1941.45,-582.13 1930.9,-581.14 1938.53,-588.49 1941.45,-582.13"/>
<text text-anchor="middle" x="2045" y="-886.3" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- output -->
<g id="node2" class="node">
<title>output</title>
<ellipse fill="lightgreen" stroke="black" cx="2646" cy="-18" rx="172.77" ry="18"/>
<text text-anchor="middle" x="2646" y="-14.3" font-family="Times,serif" font-size="14.00">Layer 1 Output\n[1024,2048,4096]</text>
</g>
<!-- l1_qkv_proj -->
<g id="node4" class="node">
<title>l1_qkv_proj</title>
<polygon fill="yellow" stroke="black" points="1735.5,-1017 1260.5,-1017 1260.5,-981 1735.5,-981 1735.5,-1017"/>
<text text-anchor="middle" x="1498" y="-995.3" font-family="Times,serif" font-size="14.00">QKV Projections\n8×[128,2048,4096]\n×[4096,1536]\nGPU: 0&#45;7</text>
</g>
<!-- l1_token_split&#45;&gt;l1_qkv_proj -->
<g id="edge2" class="edge">
<title>l1_token_split&#45;&gt;l1_qkv_proj</title>
<path fill="none" stroke="black" d="M1498,-1089.81C1498,-1072.96 1498,-1047.02 1498,-1027.34"/>
<polygon fill="black" stroke="black" points="1501.5,-1027.15 1498,-1017.15 1494.5,-1027.15 1501.5,-1027.15"/>
</g>
<!-- l1_attention -->
<g id="node5" class="node">
<title>l1_attention</title>
<polygon fill="yellow" stroke="black" points="1776,-908 1218,-908 1218,-872 1776,-872 1776,-908"/>
<text text-anchor="middle" x="1497" y="-886.3" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention\n8×[128,2048,1536]\n→ 8×[128,2048,512]\nGPU: 0&#45;7</text>
</g>
<!-- l1_qkv_proj&#45;&gt;l1_attention -->
<g id="edge3" class="edge">
<title>l1_qkv_proj&#45;&gt;l1_attention</title>
<path fill="none" stroke="black" d="M1497.84,-980.81C1497.68,-963.96 1497.44,-938.02 1497.26,-918.34"/>
<polygon fill="black" stroke="black" points="1500.75,-918.12 1497.16,-908.15 1493.75,-918.18 1500.75,-918.12"/>
</g>
<!-- l1_out_proj -->
<g id="node6" class="node">
<title>l1_out_proj</title>
<polygon fill="yellow" stroke="black" points="1732,-799 1256,-799 1256,-763 1732,-763 1732,-799"/>
<text text-anchor="middle" x="1494" y="-777.3" font-family="Times,serif" font-size="14.00">Output Projections\n8×[128,2048,512]\n×[512,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l1_attention&#45;&gt;l1_out_proj -->
<g id="edge4" class="edge">
<title>l1_attention&#45;&gt;l1_out_proj</title>
<path fill="none" stroke="black" d="M1496.52,-871.81C1496.05,-854.96 1495.32,-829.02 1494.77,-809.34"/>
<polygon fill="black" stroke="black" points="1498.26,-809.05 1494.48,-799.15 1491.26,-809.24 1498.26,-809.05"/>
</g>
<!-- l1_gather -->
<g id="node7" class="node">
<title>l1_gather</title>
<polygon fill="lightcyan" stroke="black" points="1959.44,-690 1201.53,-690 1006.56,-654 1764.47,-654 1959.44,-690"/>
<text text-anchor="middle" x="1483" y="-668.3" font-family="Times,serif" font-size="14.00">Token Gather\n8×[128,2048,4096]\n→ [1024,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l1_out_proj&#45;&gt;l1_gather -->
<g id="edge5" class="edge">
<title>l1_out_proj&#45;&gt;l1_gather</title>
<path fill="none" stroke="black" d="M1492.23,-762.81C1490.5,-745.96 1487.83,-720.02 1485.81,-700.34"/>
<polygon fill="black" stroke="black" points="1489.27,-699.74 1484.76,-690.15 1482.3,-700.45 1489.27,-699.74"/>
</g>
<!-- l1_gather&#45;&gt;l1_attn_res -->
<g id="edge6" class="edge">
<title>l1_gather&#45;&gt;l1_attn_res</title>
<path fill="none" stroke="black" d="M1546.5,-653.93C1617.71,-634.78 1732.98,-603.79 1807.88,-583.66"/>
<polygon fill="black" stroke="black" points="1808.97,-586.99 1817.72,-581.01 1807.16,-580.23 1808.97,-586.99"/>
</g>
<!-- l1_gate -->
<g id="node9" class="node">
<title>l1_gate</title>
<polygon fill="lightcoral" stroke="black" points="1369,-472 941,-472 941,-436 1369,-436 1369,-472"/>
<text text-anchor="middle" x="1155" y="-450.3" font-family="Times,serif" font-size="14.00">Gate Network\n[1024,2048,4096]\n×[4096,16]\nGPU: 0&#45;7</text>
</g>
<!-- l1_attn_res&#45;&gt;l1_gate -->
<g id="edge8" class="edge">
<title>l1_attn_res&#45;&gt;l1_gate</title>
<path fill="none" stroke="black" d="M1765.56,-544.99C1633.25,-525.49 1417.11,-493.63 1280.66,-473.52"/>
<polygon fill="black" stroke="black" points="1280.97,-470.03 1270.56,-472.03 1279.95,-476.95 1280.97,-470.03"/>
</g>
<!-- l1_router -->
<g id="node10" class="node">
<title>l1_router</title>
<polygon fill="lightcyan" stroke="black" points="2356.53,-472 1600.07,-472 1405.47,-436 2161.93,-436 2356.53,-472"/>
<text text-anchor="middle" x="1881" y="-450.3" font-family="Times,serif" font-size="14.00">Token Router\n[1024,2048,4096]\n→ 8×[128,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l1_attn_res&#45;&gt;l1_router -->
<g id="edge9" class="edge">
<title>l1_attn_res&#45;&gt;l1_router</title>
<path fill="none" stroke="black" d="M1881,-544.81C1881,-527.96 1881,-502.02 1881,-482.34"/>
<polygon fill="black" stroke="black" points="1884.5,-482.15 1881,-472.15 1877.5,-482.15 1884.5,-482.15"/>
</g>
<!-- l1_moe_res -->
<g id="node20" class="node">
<title>l1_moe_res</title>
<polygon fill="orange" stroke="black" points="2810,-145 2482,-145 2482,-109 2810,-109 2810,-145"/>
<text text-anchor="middle" x="2646" y="-123.3" font-family="Times,serif" font-size="14.00">Residual Add\n[1024,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l1_attn_res&#45;&gt;l1_moe_res -->
<g id="edge27" class="edge">
<title>l1_attn_res&#45;&gt;l1_moe_res</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M2045.21,-558.95C2440.4,-550.53 3412,-522.92 3412,-455 3412,-455 3412,-455 3412,-235 3412,-175.63 3046.35,-147.22 2820.31,-135.33"/>
<polygon fill="red" stroke="red" points="2820.49,-131.84 2810.33,-134.81 2820.13,-138.83 2820.49,-131.84"/>
<text text-anchor="middle" x="3443" y="-341.3" font-family="Times,serif" font-size="14.00">Residual</text>
</g>
<!-- l1_exp0 -->
<g id="node11" class="node">
<title>l1_exp0</title>
<polygon fill="lightpink" stroke="black" points="386,-363 0,-363 0,-327 386,-327 386,-363"/>
<text text-anchor="middle" x="193" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 0\n[128,2048,4096]\n×[4096,4096]\nGPU: 0</text>
</g>
<!-- l1_router&#45;&gt;l1_exp0 -->
<g id="edge10" class="edge">
<title>l1_router&#45;&gt;l1_exp0</title>
<path fill="none" stroke="black" d="M1572.89,-435.98C1274.02,-419.06 807.77,-391.56 404,-363 401.43,-362.82 398.85,-362.63 396.25,-362.45"/>
<polygon fill="black" stroke="black" points="396.39,-358.95 386.16,-361.71 395.89,-365.93 396.39,-358.95"/>
</g>
<!-- l1_exp1 -->
<g id="node12" class="node">
<title>l1_exp1</title>
<polygon fill="lightpink" stroke="black" points="808,-363 422,-363 422,-327 808,-327 808,-363"/>
<text text-anchor="middle" x="615" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 1\n[128,2048,4096]\n×[4096,4096]\nGPU: 1</text>
</g>
<!-- l1_router&#45;&gt;l1_exp1 -->
<g id="edge12" class="edge">
<title>l1_router&#45;&gt;l1_exp1</title>
<path fill="none" stroke="black" d="M1679.7,-435.99C1443.79,-416.05 1055.09,-383.2 818.32,-363.18"/>
<polygon fill="black" stroke="black" points="818.47,-359.68 808.21,-362.33 817.88,-366.66 818.47,-359.68"/>
</g>
<!-- l1_exp2 -->
<g id="node13" class="node">
<title>l1_exp2</title>
<polygon fill="lightpink" stroke="black" points="1230,-363 844,-363 844,-327 1230,-327 1230,-363"/>
<text text-anchor="middle" x="1037" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 2\n[128,2048,4096]\n×[4096,4096]\nGPU: 2</text>
</g>
<!-- l1_router&#45;&gt;l1_exp2 -->
<g id="edge14" class="edge">
<title>l1_router&#45;&gt;l1_exp2</title>
<path fill="none" stroke="black" d="M1746.8,-435.99C1592.52,-416.43 1340.21,-384.44 1181.65,-364.34"/>
<polygon fill="black" stroke="black" points="1181.71,-360.82 1171.35,-363.03 1180.83,-367.76 1181.71,-360.82"/>
</g>
<!-- l1_exp3 -->
<g id="node14" class="node">
<title>l1_exp3</title>
<polygon fill="lightpink" stroke="black" points="1652,-363 1266,-363 1266,-327 1652,-327 1652,-363"/>
<text text-anchor="middle" x="1459" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 3\n[128,2048,4096]\n×[4096,4096]\nGPU: 3</text>
</g>
<!-- l1_router&#45;&gt;l1_exp3 -->
<g id="edge16" class="edge">
<title>l1_router&#45;&gt;l1_exp3</title>
<path fill="none" stroke="black" d="M1813.67,-435.93C1738.02,-416.75 1615.45,-385.67 1536.04,-365.53"/>
<polygon fill="black" stroke="black" points="1536.65,-362.08 1526.09,-363.01 1534.93,-368.86 1536.65,-362.08"/>
</g>
<!-- l1_exp4 -->
<g id="node15" class="node">
<title>l1_exp4</title>
<polygon fill="lightpink" stroke="black" points="2074,-363 1688,-363 1688,-327 2074,-327 2074,-363"/>
<text text-anchor="middle" x="1881" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 4\n[128,2048,4096]\n×[4096,4096]\nGPU: 4</text>
</g>
<!-- l1_router&#45;&gt;l1_exp4 -->
<g id="edge18" class="edge">
<title>l1_router&#45;&gt;l1_exp4</title>
<path fill="none" stroke="black" d="M1881,-435.81C1881,-418.96 1881,-393.02 1881,-373.34"/>
<polygon fill="black" stroke="black" points="1884.5,-373.15 1881,-363.15 1877.5,-373.15 1884.5,-373.15"/>
</g>
<!-- l1_exp5 -->
<g id="node16" class="node">
<title>l1_exp5</title>
<polygon fill="lightpink" stroke="black" points="2496,-363 2110,-363 2110,-327 2496,-327 2496,-363"/>
<text text-anchor="middle" x="2303" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 5\n[128,2048,4096]\n×[4096,4096]\nGPU: 5</text>
</g>
<!-- l1_router&#45;&gt;l1_exp5 -->
<g id="edge20" class="edge">
<title>l1_router&#45;&gt;l1_exp5</title>
<path fill="none" stroke="black" d="M1948.33,-435.93C2023.98,-416.75 2146.55,-385.67 2225.96,-365.53"/>
<polygon fill="black" stroke="black" points="2227.07,-368.86 2235.91,-363.01 2225.35,-362.08 2227.07,-368.86"/>
</g>
<!-- l1_exp6 -->
<g id="node17" class="node">
<title>l1_exp6</title>
<polygon fill="lightpink" stroke="black" points="2918,-363 2532,-363 2532,-327 2918,-327 2918,-363"/>
<text text-anchor="middle" x="2725" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 6\n[128,2048,4096]\n×[4096,4096]\nGPU: 6</text>
</g>
<!-- l1_router&#45;&gt;l1_exp6 -->
<g id="edge22" class="edge">
<title>l1_router&#45;&gt;l1_exp6</title>
<path fill="none" stroke="black" d="M2015.2,-435.99C2169.48,-416.43 2421.79,-384.44 2580.35,-364.34"/>
<polygon fill="black" stroke="black" points="2581.17,-367.76 2590.65,-363.03 2580.29,-360.82 2581.17,-367.76"/>
</g>
<!-- l1_exp7 -->
<g id="node18" class="node">
<title>l1_exp7</title>
<polygon fill="lightpink" stroke="black" points="3340,-363 2954,-363 2954,-327 3340,-327 3340,-363"/>
<text text-anchor="middle" x="3147" y="-341.3" font-family="Times,serif" font-size="14.00">Expert 7\n[128,2048,4096]\n×[4096,4096]\nGPU: 7</text>
</g>
<!-- l1_router&#45;&gt;l1_exp7 -->
<g id="edge24" class="edge">
<title>l1_router&#45;&gt;l1_exp7</title>
<path fill="none" stroke="black" d="M2082.3,-435.99C2318.21,-416.05 2706.91,-383.2 2943.68,-363.18"/>
<polygon fill="black" stroke="black" points="2944.12,-366.66 2953.79,-362.33 2943.53,-359.68 2944.12,-366.66"/>
</g>
<!-- l1_agg -->
<g id="node19" class="node">
<title>l1_agg</title>
<polygon fill="lightcyan" stroke="black" points="2400.2,-254 1574.27,-254 1361.8,-218 2187.73,-218 2400.2,-254"/>
<text text-anchor="middle" x="1881" y="-232.3" font-family="Times,serif" font-size="14.00">Expert Aggregation\n8×[128,2048,4096]\n→ [1024,2048,4096]\nGPU: 0&#45;7</text>
</g>
<!-- l1_exp0&#45;&gt;l1_agg -->
<g id="edge11" class="edge">
<title>l1_exp0&#45;&gt;l1_agg</title>
<path fill="none" stroke="black" d="M386.16,-328.29C392.18,-327.84 398.13,-327.41 404,-327 803.71,-298.72 1264.65,-271.49 1563.83,-254.53"/>
<polygon fill="black" stroke="black" points="1564.17,-258.02 1573.96,-253.96 1563.78,-251.03 1564.17,-258.02"/>
</g>
<!-- l1_exp1&#45;&gt;l1_agg -->
<g id="edge13" class="edge">
<title>l1_exp1&#45;&gt;l1_agg</title>
<path fill="none" stroke="black" d="M808.31,-327.66C1040.66,-308.02 1429.2,-275.19 1669.4,-254.88"/>
<polygon fill="black" stroke="black" points="1669.99,-258.35 1679.66,-254.02 1669.4,-251.37 1669.99,-258.35"/>
</g>
<!-- l1_exp2&#45;&gt;l1_agg -->
<g id="edge15" class="edge">
<title>l1_exp2&#45;&gt;l1_agg</title>
<path fill="none" stroke="black" d="M1171.2,-326.99C1325.48,-307.43 1577.79,-275.44 1736.35,-255.34"/>
<polygon fill="black" stroke="black" points="1737.17,-258.76 1746.65,-254.03 1736.29,-251.82 1737.17,-258.76"/>
</g>
<!-- l1_exp3&#45;&gt;l1_agg -->
<g id="edge17" class="edge">
<title>l1_exp3&#45;&gt;l1_agg</title>
<path fill="none" stroke="black" d="M1526.33,-326.93C1601.98,-307.75 1724.55,-276.67 1803.96,-256.53"/>
<polygon fill="black" stroke="black" points="1805.07,-259.86 1813.91,-254.01 1803.35,-253.08 1805.07,-259.86"/>
</g>
<!-- l1_exp4&#45;&gt;l1_agg -->
<g id="edge19" class="edge">
<title>l1_exp4&#45;&gt;l1_agg</title>
<path fill="none" stroke="black" d="M1881,-326.81C1881,-309.96 1881,-284.02 1881,-264.34"/>
<polygon fill="black" stroke="black" points="1884.5,-264.15 1881,-254.15 1877.5,-264.15 1884.5,-264.15"/>
</g>
<!-- l1_exp5&#45;&gt;l1_agg -->
<g id="edge21" class="edge">
<title>l1_exp5&#45;&gt;l1_agg</title>
<path fill="none" stroke="black" d="M2235.67,-326.93C2160.02,-307.75 2037.45,-276.67 1958.04,-256.53"/>
<polygon fill="black" stroke="black" points="1958.65,-253.08 1948.09,-254.01 1956.93,-259.86 1958.65,-253.08"/>
</g>
<!-- l1_exp6&#45;&gt;l1_agg -->
<g id="edge23" class="edge">
<title>l1_exp6&#45;&gt;l1_agg</title>
<path fill="none" stroke="black" d="M2590.8,-326.99C2436.52,-307.43 2184.21,-275.44 2025.65,-255.34"/>
<polygon fill="black" stroke="black" points="2025.71,-251.82 2015.35,-254.03 2024.83,-258.76 2025.71,-251.82"/>
</g>
<!-- l1_exp7&#45;&gt;l1_agg -->
<g id="edge25" class="edge">
<title>l1_exp7&#45;&gt;l1_agg</title>
<path fill="none" stroke="black" d="M2953.69,-327.66C2721.34,-308.02 2332.8,-275.19 2092.6,-254.88"/>
<polygon fill="black" stroke="black" points="2092.6,-251.37 2082.34,-254.02 2092.01,-258.35 2092.6,-251.37"/>
</g>
<!-- l1_agg&#45;&gt;l1_moe_res -->
<g id="edge26" class="edge">
<title>l1_agg&#45;&gt;l1_moe_res</title>
<path fill="none" stroke="black" d="M2002.64,-217.99C2142.2,-198.47 2370.26,-166.57 2514.03,-146.46"/>
<polygon fill="black" stroke="black" points="2514.81,-149.88 2524.23,-145.03 2513.84,-142.95 2514.81,-149.88"/>
</g>
<!-- l1_moe_res&#45;&gt;output -->
<g id="edge28" class="edge">
<title>l1_moe_res&#45;&gt;output</title>
<path fill="none" stroke="black" d="M2646,-108.81C2646,-91.96 2646,-66.02 2646,-46.34"/>
<polygon fill="black" stroke="black" points="2649.5,-46.15 2646,-36.15 2642.5,-46.15 2649.5,-46.15"/>
</g>
</g>
</svg>
