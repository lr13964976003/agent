<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: MoE_Baseline_TP8_PP2 Pages: 1 -->
<svg width="556pt" height="2160pt"
 viewBox="0.00 0.00 555.57 2160.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.21 0.21) rotate(0) translate(4 10073.48)">
<title>MoE_Baseline_TP8_PP2</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-10073.48 2588,-10073.48 2588,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage0</title>
<polygon fill="none" stroke="red" stroke-dasharray="5,2" points="262,-5059.74 262,-9988.74 2576,-9988.74 2576,-5059.74 262,-5059.74"/>
<text text-anchor="middle" x="1419" y="-9973.54" font-family="Times,serif" font-size="14.00">Pipeline Stage 0</text>
<text text-anchor="middle" x="1419" y="-9958.54" font-family="Times,serif" font-size="14.00">GPUs 0&#45;7</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_stage1</title>
<polygon fill="none" stroke="blue" stroke-dasharray="5,2" points="8,-82.74 8,-5011.74 2322,-5011.74 2322,-82.74 8,-82.74"/>
<text text-anchor="middle" x="1165" y="-4996.54" font-family="Times,serif" font-size="14.00">Pipeline Stage 1</text>
<text text-anchor="middle" x="1165" y="-4981.54" font-family="Times,serif" font-size="14.00">GPUs 8&#45;15</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightgreen" stroke="black" cx="2228" cy="-10042.61" rx="268.9" ry="26.74"/>
<text text-anchor="middle" x="2228" y="-10046.41" font-family="Times,serif" font-size="14.00">Model Input</text>
<text text-anchor="middle" x="2228" y="-10031.41" font-family="Times,serif" font-size="14.00">batch_size=128, seq_len=10000, token_dim=4096</text>
</g>
<!-- layer_0_mha -->
<g id="node2" class="node">
<title>layer_0_mha</title>
<polygon fill="lightblue" stroke="black" points="2329.5,-9942.74 2126.5,-9942.74 2126.5,-9859.74 2329.5,-9859.74 2329.5,-9942.74"/>
<text text-anchor="middle" x="2228" y="-9927.54" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="2228" y="-9912.54" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="2228" y="-9897.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2228" y="-9882.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="2228" y="-9867.54" font-family="Times,serif" font-size="14.00">TP=8 across GPUs 0&#45;7</text>
</g>
<!-- input&#45;&gt;layer_0_mha -->
<g id="edge1" class="edge">
<title>input&#45;&gt;layer_0_mha</title>
<path fill="none" stroke="black" d="M2228,-10015.72C2228,-9998.13 2228,-9974.28 2228,-9952.99"/>
<polygon fill="black" stroke="black" points="2231.5,-9952.78 2228,-9942.78 2224.5,-9952.78 2231.5,-9952.78"/>
</g>
<!-- layer_0_gate -->
<g id="node3" class="node">
<title>layer_0_gate</title>
<polygon fill="lightblue" stroke="black" points="1611.5,-9822.74 1412.5,-9822.74 1412.5,-9739.74 1611.5,-9739.74 1611.5,-9822.74"/>
<text text-anchor="middle" x="1512" y="-9807.54" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="1512" y="-9792.54" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1512" y="-9777.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1512" y="-9762.54" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="1512" y="-9747.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_0_mha&#45;&gt;layer_0_gate -->
<g id="edge2" class="edge">
<title>layer_0_mha&#45;&gt;layer_0_gate</title>
<path fill="none" stroke="black" d="M2126.18,-9883.46C1992.65,-9861.45 1759.28,-9822.99 1621.88,-9800.35"/>
<polygon fill="black" stroke="black" points="1622.18,-9796.85 1611.74,-9798.68 1621.04,-9803.76 1622.18,-9796.85"/>
</g>
<!-- layer_0_residual -->
<g id="node13" class="node">
<title>layer_0_residual</title>
<polygon fill="lightblue" stroke="black" points="2345,-9448.74 2017,-9448.74 2017,-9365.74 2345,-9365.74 2345,-9448.74"/>
<text text-anchor="middle" x="2181" y="-9433.54" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="2181" y="-9418.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="2181" y="-9403.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-9388.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-9373.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_0_mha&#45;&gt;layer_0_residual -->
<g id="edge19" class="edge">
<title>layer_0_mha&#45;&gt;layer_0_residual</title>
<path fill="none" stroke="black" d="M2329.73,-9897.9C2411.22,-9889.95 2512,-9863.66 2512,-9782.24 2512,-9782.24 2512,-9782.24 2512,-9526.24 2512,-9488.5 2434.69,-9459.68 2354.8,-9439.97"/>
<polygon fill="black" stroke="black" points="2355.59,-9436.56 2345.05,-9437.61 2353.94,-9443.36 2355.59,-9436.56"/>
<text text-anchor="middle" x="2540" y="-9643.54" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_0_expert_0 -->
<g id="node4" class="node">
<title>layer_0_expert_0</title>
<polygon fill="lightblue" stroke="black" points="530,-9688.74 270,-9688.74 270,-9605.74 530,-9605.74 530,-9688.74"/>
<text text-anchor="middle" x="400" y="-9673.54" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="400" y="-9658.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="400" y="-9643.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="400" y="-9628.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="400" y="-9613.54" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_0_gate&#45;&gt;layer_0_expert_0 -->
<g id="edge3" class="edge">
<title>layer_0_gate&#45;&gt;layer_0_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.19,-9778.04C1236.57,-9772.6 861.29,-9753.94 540.03,-9688.86"/>
<polygon fill="black" stroke="black" points="540.56,-9685.4 530.06,-9686.82 539.16,-9692.25 540.56,-9685.4"/>
<text text-anchor="middle" x="773" y="-9710.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_0_expert_1 -->
<g id="node5" class="node">
<title>layer_0_expert_1</title>
<polygon fill="lightblue" stroke="black" points="808,-9688.74 548,-9688.74 548,-9605.74 808,-9605.74 808,-9688.74"/>
<text text-anchor="middle" x="678" y="-9673.54" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="678" y="-9658.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="678" y="-9643.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="678" y="-9628.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="678" y="-9613.54" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_0_gate&#45;&gt;layer_0_expert_1 -->
<g id="edge4" class="edge">
<title>layer_0_gate&#45;&gt;layer_0_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.22,-9771.93C1278.56,-9759.72 1034.15,-9733.61 818.01,-9688.87"/>
<polygon fill="black" stroke="black" points="818.57,-9685.41 808.07,-9686.79 817.14,-9692.26 818.57,-9685.41"/>
<text text-anchor="middle" x="1037" y="-9710.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_0_expert_2 -->
<g id="node6" class="node">
<title>layer_0_expert_2</title>
<polygon fill="lightblue" stroke="black" points="1086,-9688.74 826,-9688.74 826,-9605.74 1086,-9605.74 1086,-9688.74"/>
<text text-anchor="middle" x="956" y="-9673.54" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="956" y="-9658.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="956" y="-9643.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="956" y="-9628.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="956" y="-9613.54" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_0_gate&#45;&gt;layer_0_expert_2 -->
<g id="edge5" class="edge">
<title>layer_0_gate&#45;&gt;layer_0_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.13,-9760.3C1329.78,-9743.4 1209.76,-9717.72 1096.07,-9688.97"/>
<polygon fill="black" stroke="black" points="1096.7,-9685.52 1086.15,-9686.45 1094.98,-9692.3 1096.7,-9685.52"/>
<text text-anchor="middle" x="1281" y="-9710.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_0_expert_3 -->
<g id="node7" class="node">
<title>layer_0_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1364,-9688.74 1104,-9688.74 1104,-9605.74 1364,-9605.74 1364,-9688.74"/>
<text text-anchor="middle" x="1234" y="-9673.54" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1234" y="-9658.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1234" y="-9643.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1234" y="-9628.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1234" y="-9613.54" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_0_gate&#45;&gt;layer_0_expert_3 -->
<g id="edge6" class="edge">
<title>layer_0_gate&#45;&gt;layer_0_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1426.7,-9739.74C1395.76,-9725.05 1360.62,-9708.36 1328.9,-9693.3"/>
<polygon fill="black" stroke="black" points="1330.15,-9690.02 1319.62,-9688.89 1327.15,-9696.34 1330.15,-9690.02"/>
<text text-anchor="middle" x="1431" y="-9710.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_0_expert_4 -->
<g id="node8" class="node">
<title>layer_0_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1642,-9688.74 1382,-9688.74 1382,-9605.74 1642,-9605.74 1642,-9688.74"/>
<text text-anchor="middle" x="1512" y="-9673.54" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1512" y="-9658.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1512" y="-9643.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-9628.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-9613.54" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_0_gate&#45;&gt;layer_0_expert_4 -->
<g id="edge7" class="edge">
<title>layer_0_gate&#45;&gt;layer_0_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1512,-9739.56C1512,-9726.76 1512,-9712.47 1512,-9699.06"/>
<polygon fill="black" stroke="black" points="1515.5,-9699.01 1512,-9689.01 1508.5,-9699.01 1515.5,-9699.01"/>
<text text-anchor="middle" x="1562" y="-9710.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_0_expert_5 -->
<g id="node9" class="node">
<title>layer_0_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1920,-9688.74 1660,-9688.74 1660,-9605.74 1920,-9605.74 1920,-9688.74"/>
<text text-anchor="middle" x="1790" y="-9673.54" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1790" y="-9658.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1790" y="-9643.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1790" y="-9628.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1790" y="-9613.54" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_0_gate&#45;&gt;layer_0_expert_5 -->
<g id="edge8" class="edge">
<title>layer_0_gate&#45;&gt;layer_0_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1597.3,-9739.74C1628.24,-9725.05 1663.38,-9708.36 1695.1,-9693.3"/>
<polygon fill="black" stroke="black" points="1696.85,-9696.34 1704.38,-9688.89 1693.85,-9690.02 1696.85,-9696.34"/>
<text text-anchor="middle" x="1709" y="-9710.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_0_expert_6 -->
<g id="node10" class="node">
<title>layer_0_expert_6</title>
<polygon fill="lightblue" stroke="black" points="2198,-9688.74 1938,-9688.74 1938,-9605.74 2198,-9605.74 2198,-9688.74"/>
<text text-anchor="middle" x="2068" y="-9673.54" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="2068" y="-9658.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2068" y="-9643.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2068" y="-9628.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2068" y="-9613.54" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_0_gate&#45;&gt;layer_0_expert_6 -->
<g id="edge9" class="edge">
<title>layer_0_gate&#45;&gt;layer_0_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1611.87,-9760.3C1694.22,-9743.4 1814.24,-9717.72 1927.93,-9688.97"/>
<polygon fill="black" stroke="black" points="1929.02,-9692.3 1937.85,-9686.45 1927.3,-9685.52 1929.02,-9692.3"/>
<text text-anchor="middle" x="1899" y="-9710.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_0_expert_7 -->
<g id="node11" class="node">
<title>layer_0_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2476,-9688.74 2216,-9688.74 2216,-9605.74 2476,-9605.74 2476,-9688.74"/>
<text text-anchor="middle" x="2346" y="-9673.54" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2346" y="-9658.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2346" y="-9643.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2346" y="-9628.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2346" y="-9613.54" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_0_gate&#45;&gt;layer_0_expert_7 -->
<g id="edge10" class="edge">
<title>layer_0_gate&#45;&gt;layer_0_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1611.78,-9771.93C1745.44,-9759.72 1989.85,-9733.61 2205.99,-9688.87"/>
<polygon fill="black" stroke="black" points="2206.86,-9692.26 2215.93,-9686.79 2205.43,-9685.41 2206.86,-9692.26"/>
<text text-anchor="middle" x="2163" y="-9710.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_0_expert_agg -->
<g id="node12" class="node">
<title>layer_0_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="1636,-9568.74 1388,-9568.74 1388,-9485.74 1636,-9485.74 1636,-9568.74"/>
<text text-anchor="middle" x="1512" y="-9553.54" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="1512" y="-9538.54" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1512" y="-9523.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-9508.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1512" y="-9493.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_0_expert_0&#45;&gt;layer_0_expert_agg -->
<g id="edge11" class="edge">
<title>layer_0_expert_0&#45;&gt;layer_0_expert_agg</title>
<path fill="none" stroke="black" d="M530.03,-9607.48C533.04,-9606.87 536.03,-9606.28 539,-9605.74 835.03,-9551.41 1188.63,-9535.17 1377.44,-9530.31"/>
<polygon fill="black" stroke="black" points="1377.78,-9533.8 1387.69,-9530.05 1377.6,-9526.8 1377.78,-9533.8"/>
</g>
<!-- layer_0_expert_1&#45;&gt;layer_0_expert_agg -->
<g id="edge12" class="edge">
<title>layer_0_expert_1&#45;&gt;layer_0_expert_agg</title>
<path fill="none" stroke="black" d="M808.05,-9607.61C811.06,-9606.96 814.04,-9606.33 817,-9605.74 1010,-9567.16 1237.26,-9546.37 1378,-9536.3"/>
<polygon fill="black" stroke="black" points="1378.25,-9539.79 1387.98,-9535.59 1377.76,-9532.81 1378.25,-9539.79"/>
</g>
<!-- layer_0_expert_2&#45;&gt;layer_0_expert_agg -->
<g id="edge13" class="edge">
<title>layer_0_expert_2&#45;&gt;layer_0_expert_agg</title>
<path fill="none" stroke="black" d="M1086.12,-9607.9C1089.1,-9607.16 1092.07,-9606.44 1095,-9605.74 1188.79,-9583.42 1295.72,-9563.66 1377.81,-9549.68"/>
<polygon fill="black" stroke="black" points="1378.43,-9553.12 1387.7,-9548 1377.26,-9546.22 1378.43,-9553.12"/>
</g>
<!-- layer_0_expert_3&#45;&gt;layer_0_expert_agg -->
<g id="edge14" class="edge">
<title>layer_0_expert_3&#45;&gt;layer_0_expert_agg</title>
<path fill="none" stroke="black" d="M1329.67,-9605.63C1354.57,-9595.06 1381.53,-9583.62 1406.89,-9572.86"/>
<polygon fill="black" stroke="black" points="1408.31,-9576.05 1416.15,-9568.92 1405.58,-9569.61 1408.31,-9576.05"/>
</g>
<!-- layer_0_expert_4&#45;&gt;layer_0_expert_agg -->
<g id="edge15" class="edge">
<title>layer_0_expert_4&#45;&gt;layer_0_expert_agg</title>
<path fill="none" stroke="black" d="M1512,-9605.63C1512,-9597.1 1512,-9588 1512,-9579.15"/>
<polygon fill="black" stroke="black" points="1515.5,-9578.92 1512,-9568.92 1508.5,-9578.92 1515.5,-9578.92"/>
</g>
<!-- layer_0_expert_5&#45;&gt;layer_0_expert_agg -->
<g id="edge16" class="edge">
<title>layer_0_expert_5&#45;&gt;layer_0_expert_agg</title>
<path fill="none" stroke="black" d="M1694.33,-9605.63C1669.43,-9595.06 1642.47,-9583.62 1617.11,-9572.86"/>
<polygon fill="black" stroke="black" points="1618.42,-9569.61 1607.85,-9568.92 1615.69,-9576.05 1618.42,-9569.61"/>
</g>
<!-- layer_0_expert_6&#45;&gt;layer_0_expert_agg -->
<g id="edge17" class="edge">
<title>layer_0_expert_6&#45;&gt;layer_0_expert_agg</title>
<path fill="none" stroke="black" d="M1937.88,-9607.9C1934.9,-9607.16 1931.93,-9606.44 1929,-9605.74 1835.21,-9583.42 1728.28,-9563.66 1646.19,-9549.68"/>
<polygon fill="black" stroke="black" points="1646.74,-9546.22 1636.3,-9548 1645.57,-9553.12 1646.74,-9546.22"/>
</g>
<!-- layer_0_expert_7&#45;&gt;layer_0_expert_agg -->
<g id="edge18" class="edge">
<title>layer_0_expert_7&#45;&gt;layer_0_expert_agg</title>
<path fill="none" stroke="black" d="M2215.95,-9607.61C2212.94,-9606.96 2209.96,-9606.33 2207,-9605.74 2014,-9567.16 1786.74,-9546.37 1646,-9536.3"/>
<polygon fill="black" stroke="black" points="1646.24,-9532.81 1636.02,-9535.59 1645.75,-9539.79 1646.24,-9532.81"/>
</g>
<!-- layer_0_expert_agg&#45;&gt;layer_0_residual -->
<g id="edge20" class="edge">
<title>layer_0_expert_agg&#45;&gt;layer_0_residual</title>
<path fill="none" stroke="black" d="M1636.27,-9504.32C1740.54,-9485.93 1890.66,-9459.45 2006.91,-9438.95"/>
<polygon fill="black" stroke="black" points="2007.74,-9442.35 2016.98,-9437.17 2006.53,-9435.46 2007.74,-9442.35"/>
</g>
<!-- layer_1_mha -->
<g id="node14" class="node">
<title>layer_1_mha</title>
<polygon fill="lightblue" stroke="black" points="2282.5,-9328.74 2079.5,-9328.74 2079.5,-9245.74 2282.5,-9245.74 2282.5,-9328.74"/>
<text text-anchor="middle" x="2181" y="-9313.54" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="2181" y="-9298.54" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="2181" y="-9283.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-9268.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-9253.54" font-family="Times,serif" font-size="14.00">TP=8 across GPUs 0&#45;7</text>
</g>
<!-- layer_0_residual&#45;&gt;layer_1_mha -->
<g id="edge21" class="edge">
<title>layer_0_residual&#45;&gt;layer_1_mha</title>
<path fill="none" stroke="black" d="M2181,-9365.63C2181,-9357.1 2181,-9348 2181,-9339.15"/>
<polygon fill="black" stroke="black" points="2184.5,-9338.92 2181,-9328.92 2177.5,-9338.92 2184.5,-9338.92"/>
</g>
<!-- layer_1_gate -->
<g id="node15" class="node">
<title>layer_1_gate</title>
<polygon fill="lightblue" stroke="black" points="1611.5,-9208.74 1412.5,-9208.74 1412.5,-9125.74 1611.5,-9125.74 1611.5,-9208.74"/>
<text text-anchor="middle" x="1512" y="-9193.54" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="1512" y="-9178.54" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1512" y="-9163.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1512" y="-9148.54" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="1512" y="-9133.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_1_mha&#45;&gt;layer_1_gate -->
<g id="edge22" class="edge">
<title>layer_1_mha&#45;&gt;layer_1_gate</title>
<path fill="none" stroke="black" d="M2079.39,-9268.32C1955.99,-9246.55 1748.63,-9209.98 1621.69,-9187.59"/>
<polygon fill="black" stroke="black" points="1622.01,-9184.09 1611.55,-9185.8 1620.79,-9190.98 1622.01,-9184.09"/>
</g>
<!-- layer_1_residual -->
<g id="node25" class="node">
<title>layer_1_residual</title>
<polygon fill="lightblue" stroke="black" points="2345,-8834.74 2017,-8834.74 2017,-8751.74 2345,-8751.74 2345,-8834.74"/>
<text text-anchor="middle" x="2181" y="-8819.54" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="2181" y="-8804.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="2181" y="-8789.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-8774.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-8759.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_1_mha&#45;&gt;layer_1_residual -->
<g id="edge39" class="edge">
<title>layer_1_mha&#45;&gt;layer_1_residual</title>
<path fill="none" stroke="black" d="M2282.56,-9270.1C2379.86,-9251.68 2512,-9217.58 2512,-9168.24 2512,-9168.24 2512,-9168.24 2512,-8912.24 2512,-8874.5 2434.69,-8845.68 2354.8,-8825.97"/>
<polygon fill="black" stroke="black" points="2355.59,-8822.56 2345.05,-8823.61 2353.94,-8829.36 2355.59,-8822.56"/>
<text text-anchor="middle" x="2540" y="-9029.54" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_1_expert_0 -->
<g id="node16" class="node">
<title>layer_1_expert_0</title>
<polygon fill="lightblue" stroke="black" points="530,-9074.74 270,-9074.74 270,-8991.74 530,-8991.74 530,-9074.74"/>
<text text-anchor="middle" x="400" y="-9059.54" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="400" y="-9044.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="400" y="-9029.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="400" y="-9014.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="400" y="-8999.54" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_1_gate&#45;&gt;layer_1_expert_0 -->
<g id="edge23" class="edge">
<title>layer_1_gate&#45;&gt;layer_1_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.19,-9164.04C1236.57,-9158.6 861.29,-9139.94 540.03,-9074.86"/>
<polygon fill="black" stroke="black" points="540.56,-9071.4 530.06,-9072.82 539.16,-9078.25 540.56,-9071.4"/>
<text text-anchor="middle" x="773" y="-9096.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_1_expert_1 -->
<g id="node17" class="node">
<title>layer_1_expert_1</title>
<polygon fill="lightblue" stroke="black" points="808,-9074.74 548,-9074.74 548,-8991.74 808,-8991.74 808,-9074.74"/>
<text text-anchor="middle" x="678" y="-9059.54" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="678" y="-9044.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="678" y="-9029.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="678" y="-9014.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="678" y="-8999.54" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_1_gate&#45;&gt;layer_1_expert_1 -->
<g id="edge24" class="edge">
<title>layer_1_gate&#45;&gt;layer_1_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.22,-9157.93C1278.56,-9145.72 1034.15,-9119.61 818.01,-9074.87"/>
<polygon fill="black" stroke="black" points="818.57,-9071.41 808.07,-9072.79 817.14,-9078.26 818.57,-9071.41"/>
<text text-anchor="middle" x="1037" y="-9096.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_1_expert_2 -->
<g id="node18" class="node">
<title>layer_1_expert_2</title>
<polygon fill="lightblue" stroke="black" points="1086,-9074.74 826,-9074.74 826,-8991.74 1086,-8991.74 1086,-9074.74"/>
<text text-anchor="middle" x="956" y="-9059.54" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="956" y="-9044.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="956" y="-9029.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="956" y="-9014.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="956" y="-8999.54" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_1_gate&#45;&gt;layer_1_expert_2 -->
<g id="edge25" class="edge">
<title>layer_1_gate&#45;&gt;layer_1_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.13,-9146.3C1329.78,-9129.4 1209.76,-9103.72 1096.07,-9074.97"/>
<polygon fill="black" stroke="black" points="1096.7,-9071.52 1086.15,-9072.45 1094.98,-9078.3 1096.7,-9071.52"/>
<text text-anchor="middle" x="1281" y="-9096.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_1_expert_3 -->
<g id="node19" class="node">
<title>layer_1_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1364,-9074.74 1104,-9074.74 1104,-8991.74 1364,-8991.74 1364,-9074.74"/>
<text text-anchor="middle" x="1234" y="-9059.54" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1234" y="-9044.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1234" y="-9029.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1234" y="-9014.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1234" y="-8999.54" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_1_gate&#45;&gt;layer_1_expert_3 -->
<g id="edge26" class="edge">
<title>layer_1_gate&#45;&gt;layer_1_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1426.7,-9125.74C1395.76,-9111.05 1360.62,-9094.36 1328.9,-9079.3"/>
<polygon fill="black" stroke="black" points="1330.15,-9076.02 1319.62,-9074.89 1327.15,-9082.34 1330.15,-9076.02"/>
<text text-anchor="middle" x="1431" y="-9096.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_1_expert_4 -->
<g id="node20" class="node">
<title>layer_1_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1642,-9074.74 1382,-9074.74 1382,-8991.74 1642,-8991.74 1642,-9074.74"/>
<text text-anchor="middle" x="1512" y="-9059.54" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1512" y="-9044.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1512" y="-9029.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-9014.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-8999.54" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_1_gate&#45;&gt;layer_1_expert_4 -->
<g id="edge27" class="edge">
<title>layer_1_gate&#45;&gt;layer_1_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1512,-9125.56C1512,-9112.76 1512,-9098.47 1512,-9085.06"/>
<polygon fill="black" stroke="black" points="1515.5,-9085.01 1512,-9075.01 1508.5,-9085.01 1515.5,-9085.01"/>
<text text-anchor="middle" x="1562" y="-9096.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_1_expert_5 -->
<g id="node21" class="node">
<title>layer_1_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1920,-9074.74 1660,-9074.74 1660,-8991.74 1920,-8991.74 1920,-9074.74"/>
<text text-anchor="middle" x="1790" y="-9059.54" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1790" y="-9044.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1790" y="-9029.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1790" y="-9014.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1790" y="-8999.54" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_1_gate&#45;&gt;layer_1_expert_5 -->
<g id="edge28" class="edge">
<title>layer_1_gate&#45;&gt;layer_1_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1597.3,-9125.74C1628.24,-9111.05 1663.38,-9094.36 1695.1,-9079.3"/>
<polygon fill="black" stroke="black" points="1696.85,-9082.34 1704.38,-9074.89 1693.85,-9076.02 1696.85,-9082.34"/>
<text text-anchor="middle" x="1709" y="-9096.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_1_expert_6 -->
<g id="node22" class="node">
<title>layer_1_expert_6</title>
<polygon fill="lightblue" stroke="black" points="2198,-9074.74 1938,-9074.74 1938,-8991.74 2198,-8991.74 2198,-9074.74"/>
<text text-anchor="middle" x="2068" y="-9059.54" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="2068" y="-9044.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2068" y="-9029.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2068" y="-9014.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2068" y="-8999.54" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_1_gate&#45;&gt;layer_1_expert_6 -->
<g id="edge29" class="edge">
<title>layer_1_gate&#45;&gt;layer_1_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1611.87,-9146.3C1694.22,-9129.4 1814.24,-9103.72 1927.93,-9074.97"/>
<polygon fill="black" stroke="black" points="1929.02,-9078.3 1937.85,-9072.45 1927.3,-9071.52 1929.02,-9078.3"/>
<text text-anchor="middle" x="1899" y="-9096.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_1_expert_7 -->
<g id="node23" class="node">
<title>layer_1_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2476,-9074.74 2216,-9074.74 2216,-8991.74 2476,-8991.74 2476,-9074.74"/>
<text text-anchor="middle" x="2346" y="-9059.54" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2346" y="-9044.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2346" y="-9029.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2346" y="-9014.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2346" y="-8999.54" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_1_gate&#45;&gt;layer_1_expert_7 -->
<g id="edge30" class="edge">
<title>layer_1_gate&#45;&gt;layer_1_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1611.78,-9157.93C1745.44,-9145.72 1989.85,-9119.61 2205.99,-9074.87"/>
<polygon fill="black" stroke="black" points="2206.86,-9078.26 2215.93,-9072.79 2205.43,-9071.41 2206.86,-9078.26"/>
<text text-anchor="middle" x="2163" y="-9096.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_1_expert_agg -->
<g id="node24" class="node">
<title>layer_1_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="1636,-8954.74 1388,-8954.74 1388,-8871.74 1636,-8871.74 1636,-8954.74"/>
<text text-anchor="middle" x="1512" y="-8939.54" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="1512" y="-8924.54" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1512" y="-8909.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-8894.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1512" y="-8879.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_1_expert_0&#45;&gt;layer_1_expert_agg -->
<g id="edge31" class="edge">
<title>layer_1_expert_0&#45;&gt;layer_1_expert_agg</title>
<path fill="none" stroke="black" d="M530.03,-8993.48C533.04,-8992.87 536.03,-8992.28 539,-8991.74 835.03,-8937.41 1188.63,-8921.17 1377.44,-8916.31"/>
<polygon fill="black" stroke="black" points="1377.78,-8919.8 1387.69,-8916.05 1377.6,-8912.8 1377.78,-8919.8"/>
</g>
<!-- layer_1_expert_1&#45;&gt;layer_1_expert_agg -->
<g id="edge32" class="edge">
<title>layer_1_expert_1&#45;&gt;layer_1_expert_agg</title>
<path fill="none" stroke="black" d="M808.05,-8993.61C811.06,-8992.96 814.04,-8992.33 817,-8991.74 1010,-8953.16 1237.26,-8932.37 1378,-8922.3"/>
<polygon fill="black" stroke="black" points="1378.25,-8925.79 1387.98,-8921.59 1377.76,-8918.81 1378.25,-8925.79"/>
</g>
<!-- layer_1_expert_2&#45;&gt;layer_1_expert_agg -->
<g id="edge33" class="edge">
<title>layer_1_expert_2&#45;&gt;layer_1_expert_agg</title>
<path fill="none" stroke="black" d="M1086.12,-8993.9C1089.1,-8993.16 1092.07,-8992.44 1095,-8991.74 1188.79,-8969.42 1295.72,-8949.66 1377.81,-8935.68"/>
<polygon fill="black" stroke="black" points="1378.43,-8939.12 1387.7,-8934 1377.26,-8932.22 1378.43,-8939.12"/>
</g>
<!-- layer_1_expert_3&#45;&gt;layer_1_expert_agg -->
<g id="edge34" class="edge">
<title>layer_1_expert_3&#45;&gt;layer_1_expert_agg</title>
<path fill="none" stroke="black" d="M1329.67,-8991.63C1354.57,-8981.06 1381.53,-8969.62 1406.89,-8958.86"/>
<polygon fill="black" stroke="black" points="1408.31,-8962.05 1416.15,-8954.92 1405.58,-8955.61 1408.31,-8962.05"/>
</g>
<!-- layer_1_expert_4&#45;&gt;layer_1_expert_agg -->
<g id="edge35" class="edge">
<title>layer_1_expert_4&#45;&gt;layer_1_expert_agg</title>
<path fill="none" stroke="black" d="M1512,-8991.63C1512,-8983.1 1512,-8974 1512,-8965.15"/>
<polygon fill="black" stroke="black" points="1515.5,-8964.92 1512,-8954.92 1508.5,-8964.92 1515.5,-8964.92"/>
</g>
<!-- layer_1_expert_5&#45;&gt;layer_1_expert_agg -->
<g id="edge36" class="edge">
<title>layer_1_expert_5&#45;&gt;layer_1_expert_agg</title>
<path fill="none" stroke="black" d="M1694.33,-8991.63C1669.43,-8981.06 1642.47,-8969.62 1617.11,-8958.86"/>
<polygon fill="black" stroke="black" points="1618.42,-8955.61 1607.85,-8954.92 1615.69,-8962.05 1618.42,-8955.61"/>
</g>
<!-- layer_1_expert_6&#45;&gt;layer_1_expert_agg -->
<g id="edge37" class="edge">
<title>layer_1_expert_6&#45;&gt;layer_1_expert_agg</title>
<path fill="none" stroke="black" d="M1937.88,-8993.9C1934.9,-8993.16 1931.93,-8992.44 1929,-8991.74 1835.21,-8969.42 1728.28,-8949.66 1646.19,-8935.68"/>
<polygon fill="black" stroke="black" points="1646.74,-8932.22 1636.3,-8934 1645.57,-8939.12 1646.74,-8932.22"/>
</g>
<!-- layer_1_expert_7&#45;&gt;layer_1_expert_agg -->
<g id="edge38" class="edge">
<title>layer_1_expert_7&#45;&gt;layer_1_expert_agg</title>
<path fill="none" stroke="black" d="M2215.95,-8993.61C2212.94,-8992.96 2209.96,-8992.33 2207,-8991.74 2014,-8953.16 1786.74,-8932.37 1646,-8922.3"/>
<polygon fill="black" stroke="black" points="1646.24,-8918.81 1636.02,-8921.59 1645.75,-8925.79 1646.24,-8918.81"/>
</g>
<!-- layer_1_expert_agg&#45;&gt;layer_1_residual -->
<g id="edge40" class="edge">
<title>layer_1_expert_agg&#45;&gt;layer_1_residual</title>
<path fill="none" stroke="black" d="M1636.27,-8890.32C1740.54,-8871.93 1890.66,-8845.45 2006.91,-8824.95"/>
<polygon fill="black" stroke="black" points="2007.74,-8828.35 2016.98,-8823.17 2006.53,-8821.46 2007.74,-8828.35"/>
</g>
<!-- layer_2_mha -->
<g id="node26" class="node">
<title>layer_2_mha</title>
<polygon fill="lightblue" stroke="black" points="2282.5,-8714.74 2079.5,-8714.74 2079.5,-8631.74 2282.5,-8631.74 2282.5,-8714.74"/>
<text text-anchor="middle" x="2181" y="-8699.54" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="2181" y="-8684.54" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="2181" y="-8669.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-8654.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-8639.54" font-family="Times,serif" font-size="14.00">TP=8 across GPUs 0&#45;7</text>
</g>
<!-- layer_1_residual&#45;&gt;layer_2_mha -->
<g id="edge41" class="edge">
<title>layer_1_residual&#45;&gt;layer_2_mha</title>
<path fill="none" stroke="black" d="M2181,-8751.63C2181,-8743.1 2181,-8734 2181,-8725.15"/>
<polygon fill="black" stroke="black" points="2184.5,-8724.92 2181,-8714.92 2177.5,-8724.92 2184.5,-8724.92"/>
</g>
<!-- layer_2_gate -->
<g id="node27" class="node">
<title>layer_2_gate</title>
<polygon fill="lightblue" stroke="black" points="1611.5,-8594.74 1412.5,-8594.74 1412.5,-8511.74 1611.5,-8511.74 1611.5,-8594.74"/>
<text text-anchor="middle" x="1512" y="-8579.54" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="1512" y="-8564.54" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1512" y="-8549.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1512" y="-8534.54" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="1512" y="-8519.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_2_mha&#45;&gt;layer_2_gate -->
<g id="edge42" class="edge">
<title>layer_2_mha&#45;&gt;layer_2_gate</title>
<path fill="none" stroke="black" d="M2079.39,-8654.32C1955.99,-8632.55 1748.63,-8595.98 1621.69,-8573.59"/>
<polygon fill="black" stroke="black" points="1622.01,-8570.09 1611.55,-8571.8 1620.79,-8576.98 1622.01,-8570.09"/>
</g>
<!-- layer_2_residual -->
<g id="node37" class="node">
<title>layer_2_residual</title>
<polygon fill="lightblue" stroke="black" points="2122,-8220.74 1794,-8220.74 1794,-8137.74 2122,-8137.74 2122,-8220.74"/>
<text text-anchor="middle" x="1958" y="-8205.54" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="1958" y="-8190.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="1958" y="-8175.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="1958" y="-8160.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1958" y="-8145.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_2_mha&#45;&gt;layer_2_residual -->
<g id="edge59" class="edge">
<title>layer_2_mha&#45;&gt;layer_2_residual</title>
<path fill="none" stroke="black" d="M2282.56,-8656.1C2379.86,-8637.68 2512,-8603.58 2512,-8554.24 2512,-8554.24 2512,-8554.24 2512,-8298.24 2512,-8219.44 2294.86,-8193.05 2132.47,-8184.34"/>
<polygon fill="black" stroke="black" points="2132.51,-8180.84 2122.34,-8183.82 2132.15,-8187.83 2132.51,-8180.84"/>
<text text-anchor="middle" x="2540" y="-8415.54" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_2_expert_0 -->
<g id="node28" class="node">
<title>layer_2_expert_0</title>
<polygon fill="lightblue" stroke="black" points="530,-8460.74 270,-8460.74 270,-8377.74 530,-8377.74 530,-8460.74"/>
<text text-anchor="middle" x="400" y="-8445.54" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="400" y="-8430.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="400" y="-8415.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="400" y="-8400.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="400" y="-8385.54" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_2_gate&#45;&gt;layer_2_expert_0 -->
<g id="edge43" class="edge">
<title>layer_2_gate&#45;&gt;layer_2_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.19,-8550.04C1236.57,-8544.6 861.29,-8525.94 540.03,-8460.86"/>
<polygon fill="black" stroke="black" points="540.56,-8457.4 530.06,-8458.82 539.16,-8464.25 540.56,-8457.4"/>
<text text-anchor="middle" x="773" y="-8482.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_2_expert_1 -->
<g id="node29" class="node">
<title>layer_2_expert_1</title>
<polygon fill="lightblue" stroke="black" points="808,-8460.74 548,-8460.74 548,-8377.74 808,-8377.74 808,-8460.74"/>
<text text-anchor="middle" x="678" y="-8445.54" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="678" y="-8430.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="678" y="-8415.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="678" y="-8400.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="678" y="-8385.54" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_2_gate&#45;&gt;layer_2_expert_1 -->
<g id="edge44" class="edge">
<title>layer_2_gate&#45;&gt;layer_2_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.22,-8543.93C1278.56,-8531.72 1034.15,-8505.61 818.01,-8460.87"/>
<polygon fill="black" stroke="black" points="818.57,-8457.41 808.07,-8458.79 817.14,-8464.26 818.57,-8457.41"/>
<text text-anchor="middle" x="1037" y="-8482.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_2_expert_2 -->
<g id="node30" class="node">
<title>layer_2_expert_2</title>
<polygon fill="lightblue" stroke="black" points="1086,-8460.74 826,-8460.74 826,-8377.74 1086,-8377.74 1086,-8460.74"/>
<text text-anchor="middle" x="956" y="-8445.54" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="956" y="-8430.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="956" y="-8415.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="956" y="-8400.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="956" y="-8385.54" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_2_gate&#45;&gt;layer_2_expert_2 -->
<g id="edge45" class="edge">
<title>layer_2_gate&#45;&gt;layer_2_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.13,-8532.3C1329.78,-8515.4 1209.76,-8489.72 1096.07,-8460.97"/>
<polygon fill="black" stroke="black" points="1096.7,-8457.52 1086.15,-8458.45 1094.98,-8464.3 1096.7,-8457.52"/>
<text text-anchor="middle" x="1281" y="-8482.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_2_expert_3 -->
<g id="node31" class="node">
<title>layer_2_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1364,-8460.74 1104,-8460.74 1104,-8377.74 1364,-8377.74 1364,-8460.74"/>
<text text-anchor="middle" x="1234" y="-8445.54" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1234" y="-8430.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1234" y="-8415.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1234" y="-8400.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1234" y="-8385.54" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_2_gate&#45;&gt;layer_2_expert_3 -->
<g id="edge46" class="edge">
<title>layer_2_gate&#45;&gt;layer_2_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1426.7,-8511.74C1395.76,-8497.05 1360.62,-8480.36 1328.9,-8465.3"/>
<polygon fill="black" stroke="black" points="1330.15,-8462.02 1319.62,-8460.89 1327.15,-8468.34 1330.15,-8462.02"/>
<text text-anchor="middle" x="1431" y="-8482.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_2_expert_4 -->
<g id="node32" class="node">
<title>layer_2_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1642,-8460.74 1382,-8460.74 1382,-8377.74 1642,-8377.74 1642,-8460.74"/>
<text text-anchor="middle" x="1512" y="-8445.54" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1512" y="-8430.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1512" y="-8415.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-8400.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-8385.54" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_2_gate&#45;&gt;layer_2_expert_4 -->
<g id="edge47" class="edge">
<title>layer_2_gate&#45;&gt;layer_2_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1512,-8511.56C1512,-8498.76 1512,-8484.47 1512,-8471.06"/>
<polygon fill="black" stroke="black" points="1515.5,-8471.01 1512,-8461.01 1508.5,-8471.01 1515.5,-8471.01"/>
<text text-anchor="middle" x="1562" y="-8482.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_2_expert_5 -->
<g id="node33" class="node">
<title>layer_2_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1920,-8460.74 1660,-8460.74 1660,-8377.74 1920,-8377.74 1920,-8460.74"/>
<text text-anchor="middle" x="1790" y="-8445.54" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1790" y="-8430.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1790" y="-8415.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1790" y="-8400.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1790" y="-8385.54" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_2_gate&#45;&gt;layer_2_expert_5 -->
<g id="edge48" class="edge">
<title>layer_2_gate&#45;&gt;layer_2_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1597.3,-8511.74C1628.24,-8497.05 1663.38,-8480.36 1695.1,-8465.3"/>
<polygon fill="black" stroke="black" points="1696.85,-8468.34 1704.38,-8460.89 1693.85,-8462.02 1696.85,-8468.34"/>
<text text-anchor="middle" x="1709" y="-8482.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_2_expert_6 -->
<g id="node34" class="node">
<title>layer_2_expert_6</title>
<polygon fill="lightblue" stroke="black" points="2198,-8460.74 1938,-8460.74 1938,-8377.74 2198,-8377.74 2198,-8460.74"/>
<text text-anchor="middle" x="2068" y="-8445.54" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="2068" y="-8430.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2068" y="-8415.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2068" y="-8400.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2068" y="-8385.54" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_2_gate&#45;&gt;layer_2_expert_6 -->
<g id="edge49" class="edge">
<title>layer_2_gate&#45;&gt;layer_2_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1611.87,-8532.3C1694.22,-8515.4 1814.24,-8489.72 1927.93,-8460.97"/>
<polygon fill="black" stroke="black" points="1929.02,-8464.3 1937.85,-8458.45 1927.3,-8457.52 1929.02,-8464.3"/>
<text text-anchor="middle" x="1899" y="-8482.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_2_expert_7 -->
<g id="node35" class="node">
<title>layer_2_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2476,-8460.74 2216,-8460.74 2216,-8377.74 2476,-8377.74 2476,-8460.74"/>
<text text-anchor="middle" x="2346" y="-8445.54" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2346" y="-8430.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2346" y="-8415.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2346" y="-8400.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2346" y="-8385.54" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_2_gate&#45;&gt;layer_2_expert_7 -->
<g id="edge50" class="edge">
<title>layer_2_gate&#45;&gt;layer_2_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1611.78,-8543.93C1745.44,-8531.72 1989.85,-8505.61 2205.99,-8460.87"/>
<polygon fill="black" stroke="black" points="2206.86,-8464.26 2215.93,-8458.79 2205.43,-8457.41 2206.86,-8464.26"/>
<text text-anchor="middle" x="2163" y="-8482.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_2_expert_agg -->
<g id="node36" class="node">
<title>layer_2_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="1636,-8340.74 1388,-8340.74 1388,-8257.74 1636,-8257.74 1636,-8340.74"/>
<text text-anchor="middle" x="1512" y="-8325.54" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="1512" y="-8310.54" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1512" y="-8295.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-8280.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1512" y="-8265.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_2_expert_0&#45;&gt;layer_2_expert_agg -->
<g id="edge51" class="edge">
<title>layer_2_expert_0&#45;&gt;layer_2_expert_agg</title>
<path fill="none" stroke="black" d="M530.03,-8379.48C533.04,-8378.87 536.03,-8378.28 539,-8377.74 835.03,-8323.41 1188.63,-8307.17 1377.44,-8302.31"/>
<polygon fill="black" stroke="black" points="1377.78,-8305.8 1387.69,-8302.05 1377.6,-8298.8 1377.78,-8305.8"/>
</g>
<!-- layer_2_expert_1&#45;&gt;layer_2_expert_agg -->
<g id="edge52" class="edge">
<title>layer_2_expert_1&#45;&gt;layer_2_expert_agg</title>
<path fill="none" stroke="black" d="M808.05,-8379.61C811.06,-8378.96 814.04,-8378.33 817,-8377.74 1010,-8339.16 1237.26,-8318.37 1378,-8308.3"/>
<polygon fill="black" stroke="black" points="1378.25,-8311.79 1387.98,-8307.59 1377.76,-8304.81 1378.25,-8311.79"/>
</g>
<!-- layer_2_expert_2&#45;&gt;layer_2_expert_agg -->
<g id="edge53" class="edge">
<title>layer_2_expert_2&#45;&gt;layer_2_expert_agg</title>
<path fill="none" stroke="black" d="M1086.12,-8379.9C1089.1,-8379.16 1092.07,-8378.44 1095,-8377.74 1188.79,-8355.42 1295.72,-8335.66 1377.81,-8321.68"/>
<polygon fill="black" stroke="black" points="1378.43,-8325.12 1387.7,-8320 1377.26,-8318.22 1378.43,-8325.12"/>
</g>
<!-- layer_2_expert_3&#45;&gt;layer_2_expert_agg -->
<g id="edge54" class="edge">
<title>layer_2_expert_3&#45;&gt;layer_2_expert_agg</title>
<path fill="none" stroke="black" d="M1329.67,-8377.63C1354.57,-8367.06 1381.53,-8355.62 1406.89,-8344.86"/>
<polygon fill="black" stroke="black" points="1408.31,-8348.05 1416.15,-8340.92 1405.58,-8341.61 1408.31,-8348.05"/>
</g>
<!-- layer_2_expert_4&#45;&gt;layer_2_expert_agg -->
<g id="edge55" class="edge">
<title>layer_2_expert_4&#45;&gt;layer_2_expert_agg</title>
<path fill="none" stroke="black" d="M1512,-8377.63C1512,-8369.1 1512,-8360 1512,-8351.15"/>
<polygon fill="black" stroke="black" points="1515.5,-8350.92 1512,-8340.92 1508.5,-8350.92 1515.5,-8350.92"/>
</g>
<!-- layer_2_expert_5&#45;&gt;layer_2_expert_agg -->
<g id="edge56" class="edge">
<title>layer_2_expert_5&#45;&gt;layer_2_expert_agg</title>
<path fill="none" stroke="black" d="M1694.33,-8377.63C1669.43,-8367.06 1642.47,-8355.62 1617.11,-8344.86"/>
<polygon fill="black" stroke="black" points="1618.42,-8341.61 1607.85,-8340.92 1615.69,-8348.05 1618.42,-8341.61"/>
</g>
<!-- layer_2_expert_6&#45;&gt;layer_2_expert_agg -->
<g id="edge57" class="edge">
<title>layer_2_expert_6&#45;&gt;layer_2_expert_agg</title>
<path fill="none" stroke="black" d="M1937.88,-8379.9C1934.9,-8379.16 1931.93,-8378.44 1929,-8377.74 1835.21,-8355.42 1728.28,-8335.66 1646.19,-8321.68"/>
<polygon fill="black" stroke="black" points="1646.74,-8318.22 1636.3,-8320 1645.57,-8325.12 1646.74,-8318.22"/>
</g>
<!-- layer_2_expert_7&#45;&gt;layer_2_expert_agg -->
<g id="edge58" class="edge">
<title>layer_2_expert_7&#45;&gt;layer_2_expert_agg</title>
<path fill="none" stroke="black" d="M2215.95,-8379.61C2212.94,-8378.96 2209.96,-8378.33 2207,-8377.74 2014,-8339.16 1786.74,-8318.37 1646,-8308.3"/>
<polygon fill="black" stroke="black" points="1646.24,-8304.81 1636.02,-8307.59 1645.75,-8311.79 1646.24,-8304.81"/>
</g>
<!-- layer_2_expert_agg&#45;&gt;layer_2_residual -->
<g id="edge60" class="edge">
<title>layer_2_expert_agg&#45;&gt;layer_2_residual</title>
<path fill="none" stroke="black" d="M1636.24,-8265.37C1685.37,-8252.37 1742.52,-8237.25 1794.91,-8223.39"/>
<polygon fill="black" stroke="black" points="1795.86,-8226.76 1804.64,-8220.82 1794.07,-8219.99 1795.86,-8226.76"/>
</g>
<!-- layer_3_mha -->
<g id="node38" class="node">
<title>layer_3_mha</title>
<polygon fill="lightblue" stroke="black" points="2059.5,-8100.74 1856.5,-8100.74 1856.5,-8017.74 2059.5,-8017.74 2059.5,-8100.74"/>
<text text-anchor="middle" x="1958" y="-8085.54" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="1958" y="-8070.54" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1958" y="-8055.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1958" y="-8040.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1958" y="-8025.54" font-family="Times,serif" font-size="14.00">TP=8 across GPUs 0&#45;7</text>
</g>
<!-- layer_2_residual&#45;&gt;layer_3_mha -->
<g id="edge61" class="edge">
<title>layer_2_residual&#45;&gt;layer_3_mha</title>
<path fill="none" stroke="black" d="M1958,-8137.63C1958,-8129.1 1958,-8120 1958,-8111.15"/>
<polygon fill="black" stroke="black" points="1961.5,-8110.92 1958,-8100.92 1954.5,-8110.92 1961.5,-8110.92"/>
</g>
<!-- layer_3_gate -->
<g id="node39" class="node">
<title>layer_3_gate</title>
<polygon fill="lightblue" stroke="black" points="1611.5,-7980.74 1412.5,-7980.74 1412.5,-7897.74 1611.5,-7897.74 1611.5,-7980.74"/>
<text text-anchor="middle" x="1512" y="-7965.54" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="1512" y="-7950.54" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1512" y="-7935.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1512" y="-7920.54" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="1512" y="-7905.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_3_mha&#45;&gt;layer_3_gate -->
<g id="edge62" class="edge">
<title>layer_3_mha&#45;&gt;layer_3_gate</title>
<path fill="none" stroke="black" d="M1856.24,-8031.32C1786.26,-8012.8 1693.39,-7988.23 1621.75,-7969.28"/>
<polygon fill="black" stroke="black" points="1622.35,-7965.82 1611.79,-7966.64 1620.56,-7972.58 1622.35,-7965.82"/>
</g>
<!-- layer_3_residual -->
<g id="node49" class="node">
<title>layer_3_residual</title>
<polygon fill="lightblue" stroke="black" points="2345,-7606.74 2017,-7606.74 2017,-7523.74 2345,-7523.74 2345,-7606.74"/>
<text text-anchor="middle" x="2181" y="-7591.54" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="2181" y="-7576.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="2181" y="-7561.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-7546.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-7531.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_3_mha&#45;&gt;layer_3_residual -->
<g id="edge79" class="edge">
<title>layer_3_mha&#45;&gt;layer_3_residual</title>
<path fill="none" stroke="black" d="M2059.61,-8057.11C2219.55,-8052.55 2512,-8031.69 2512,-7940.24 2512,-7940.24 2512,-7940.24 2512,-7684.24 2512,-7646.5 2434.69,-7617.68 2354.8,-7597.97"/>
<polygon fill="black" stroke="black" points="2355.59,-7594.56 2345.05,-7595.61 2353.94,-7601.36 2355.59,-7594.56"/>
<text text-anchor="middle" x="2540" y="-7801.54" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_3_expert_0 -->
<g id="node40" class="node">
<title>layer_3_expert_0</title>
<polygon fill="lightblue" stroke="black" points="530,-7846.74 270,-7846.74 270,-7763.74 530,-7763.74 530,-7846.74"/>
<text text-anchor="middle" x="400" y="-7831.54" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="400" y="-7816.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="400" y="-7801.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="400" y="-7786.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="400" y="-7771.54" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_3_gate&#45;&gt;layer_3_expert_0 -->
<g id="edge63" class="edge">
<title>layer_3_gate&#45;&gt;layer_3_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.19,-7936.04C1236.57,-7930.6 861.29,-7911.94 540.03,-7846.86"/>
<polygon fill="black" stroke="black" points="540.56,-7843.4 530.06,-7844.82 539.16,-7850.25 540.56,-7843.4"/>
<text text-anchor="middle" x="773" y="-7868.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_3_expert_1 -->
<g id="node41" class="node">
<title>layer_3_expert_1</title>
<polygon fill="lightblue" stroke="black" points="808,-7846.74 548,-7846.74 548,-7763.74 808,-7763.74 808,-7846.74"/>
<text text-anchor="middle" x="678" y="-7831.54" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="678" y="-7816.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="678" y="-7801.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="678" y="-7786.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="678" y="-7771.54" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_3_gate&#45;&gt;layer_3_expert_1 -->
<g id="edge64" class="edge">
<title>layer_3_gate&#45;&gt;layer_3_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.22,-7929.93C1278.56,-7917.72 1034.15,-7891.61 818.01,-7846.87"/>
<polygon fill="black" stroke="black" points="818.57,-7843.41 808.07,-7844.79 817.14,-7850.26 818.57,-7843.41"/>
<text text-anchor="middle" x="1037" y="-7868.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_3_expert_2 -->
<g id="node42" class="node">
<title>layer_3_expert_2</title>
<polygon fill="lightblue" stroke="black" points="1086,-7846.74 826,-7846.74 826,-7763.74 1086,-7763.74 1086,-7846.74"/>
<text text-anchor="middle" x="956" y="-7831.54" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="956" y="-7816.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="956" y="-7801.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="956" y="-7786.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="956" y="-7771.54" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_3_gate&#45;&gt;layer_3_expert_2 -->
<g id="edge65" class="edge">
<title>layer_3_gate&#45;&gt;layer_3_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.13,-7918.3C1329.78,-7901.4 1209.76,-7875.72 1096.07,-7846.97"/>
<polygon fill="black" stroke="black" points="1096.7,-7843.52 1086.15,-7844.45 1094.98,-7850.3 1096.7,-7843.52"/>
<text text-anchor="middle" x="1281" y="-7868.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_3_expert_3 -->
<g id="node43" class="node">
<title>layer_3_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1364,-7846.74 1104,-7846.74 1104,-7763.74 1364,-7763.74 1364,-7846.74"/>
<text text-anchor="middle" x="1234" y="-7831.54" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1234" y="-7816.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1234" y="-7801.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1234" y="-7786.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1234" y="-7771.54" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_3_gate&#45;&gt;layer_3_expert_3 -->
<g id="edge66" class="edge">
<title>layer_3_gate&#45;&gt;layer_3_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1426.7,-7897.74C1395.76,-7883.05 1360.62,-7866.36 1328.9,-7851.3"/>
<polygon fill="black" stroke="black" points="1330.15,-7848.02 1319.62,-7846.89 1327.15,-7854.34 1330.15,-7848.02"/>
<text text-anchor="middle" x="1431" y="-7868.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_3_expert_4 -->
<g id="node44" class="node">
<title>layer_3_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1642,-7846.74 1382,-7846.74 1382,-7763.74 1642,-7763.74 1642,-7846.74"/>
<text text-anchor="middle" x="1512" y="-7831.54" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1512" y="-7816.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1512" y="-7801.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-7786.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-7771.54" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_3_gate&#45;&gt;layer_3_expert_4 -->
<g id="edge67" class="edge">
<title>layer_3_gate&#45;&gt;layer_3_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1512,-7897.56C1512,-7884.76 1512,-7870.47 1512,-7857.06"/>
<polygon fill="black" stroke="black" points="1515.5,-7857.01 1512,-7847.01 1508.5,-7857.01 1515.5,-7857.01"/>
<text text-anchor="middle" x="1562" y="-7868.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_3_expert_5 -->
<g id="node45" class="node">
<title>layer_3_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1920,-7846.74 1660,-7846.74 1660,-7763.74 1920,-7763.74 1920,-7846.74"/>
<text text-anchor="middle" x="1790" y="-7831.54" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1790" y="-7816.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1790" y="-7801.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1790" y="-7786.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1790" y="-7771.54" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_3_gate&#45;&gt;layer_3_expert_5 -->
<g id="edge68" class="edge">
<title>layer_3_gate&#45;&gt;layer_3_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1597.3,-7897.74C1628.24,-7883.05 1663.38,-7866.36 1695.1,-7851.3"/>
<polygon fill="black" stroke="black" points="1696.85,-7854.34 1704.38,-7846.89 1693.85,-7848.02 1696.85,-7854.34"/>
<text text-anchor="middle" x="1709" y="-7868.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_3_expert_6 -->
<g id="node46" class="node">
<title>layer_3_expert_6</title>
<polygon fill="lightblue" stroke="black" points="2198,-7846.74 1938,-7846.74 1938,-7763.74 2198,-7763.74 2198,-7846.74"/>
<text text-anchor="middle" x="2068" y="-7831.54" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="2068" y="-7816.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2068" y="-7801.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2068" y="-7786.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2068" y="-7771.54" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_3_gate&#45;&gt;layer_3_expert_6 -->
<g id="edge69" class="edge">
<title>layer_3_gate&#45;&gt;layer_3_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1611.87,-7918.3C1694.22,-7901.4 1814.24,-7875.72 1927.93,-7846.97"/>
<polygon fill="black" stroke="black" points="1929.02,-7850.3 1937.85,-7844.45 1927.3,-7843.52 1929.02,-7850.3"/>
<text text-anchor="middle" x="1899" y="-7868.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_3_expert_7 -->
<g id="node47" class="node">
<title>layer_3_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2476,-7846.74 2216,-7846.74 2216,-7763.74 2476,-7763.74 2476,-7846.74"/>
<text text-anchor="middle" x="2346" y="-7831.54" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2346" y="-7816.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2346" y="-7801.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2346" y="-7786.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2346" y="-7771.54" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_3_gate&#45;&gt;layer_3_expert_7 -->
<g id="edge70" class="edge">
<title>layer_3_gate&#45;&gt;layer_3_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1611.78,-7929.93C1745.44,-7917.72 1989.85,-7891.61 2205.99,-7846.87"/>
<polygon fill="black" stroke="black" points="2206.86,-7850.26 2215.93,-7844.79 2205.43,-7843.41 2206.86,-7850.26"/>
<text text-anchor="middle" x="2163" y="-7868.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_3_expert_agg -->
<g id="node48" class="node">
<title>layer_3_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="1636,-7726.74 1388,-7726.74 1388,-7643.74 1636,-7643.74 1636,-7726.74"/>
<text text-anchor="middle" x="1512" y="-7711.54" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="1512" y="-7696.54" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1512" y="-7681.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-7666.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1512" y="-7651.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_3_expert_0&#45;&gt;layer_3_expert_agg -->
<g id="edge71" class="edge">
<title>layer_3_expert_0&#45;&gt;layer_3_expert_agg</title>
<path fill="none" stroke="black" d="M530.03,-7765.48C533.04,-7764.87 536.03,-7764.28 539,-7763.74 835.03,-7709.41 1188.63,-7693.17 1377.44,-7688.31"/>
<polygon fill="black" stroke="black" points="1377.78,-7691.8 1387.69,-7688.05 1377.6,-7684.8 1377.78,-7691.8"/>
</g>
<!-- layer_3_expert_1&#45;&gt;layer_3_expert_agg -->
<g id="edge72" class="edge">
<title>layer_3_expert_1&#45;&gt;layer_3_expert_agg</title>
<path fill="none" stroke="black" d="M808.05,-7765.61C811.06,-7764.96 814.04,-7764.33 817,-7763.74 1010,-7725.16 1237.26,-7704.37 1378,-7694.3"/>
<polygon fill="black" stroke="black" points="1378.25,-7697.79 1387.98,-7693.59 1377.76,-7690.81 1378.25,-7697.79"/>
</g>
<!-- layer_3_expert_2&#45;&gt;layer_3_expert_agg -->
<g id="edge73" class="edge">
<title>layer_3_expert_2&#45;&gt;layer_3_expert_agg</title>
<path fill="none" stroke="black" d="M1086.12,-7765.9C1089.1,-7765.16 1092.07,-7764.44 1095,-7763.74 1188.79,-7741.42 1295.72,-7721.66 1377.81,-7707.68"/>
<polygon fill="black" stroke="black" points="1378.43,-7711.12 1387.7,-7706 1377.26,-7704.22 1378.43,-7711.12"/>
</g>
<!-- layer_3_expert_3&#45;&gt;layer_3_expert_agg -->
<g id="edge74" class="edge">
<title>layer_3_expert_3&#45;&gt;layer_3_expert_agg</title>
<path fill="none" stroke="black" d="M1329.67,-7763.63C1354.57,-7753.06 1381.53,-7741.62 1406.89,-7730.86"/>
<polygon fill="black" stroke="black" points="1408.31,-7734.05 1416.15,-7726.92 1405.58,-7727.61 1408.31,-7734.05"/>
</g>
<!-- layer_3_expert_4&#45;&gt;layer_3_expert_agg -->
<g id="edge75" class="edge">
<title>layer_3_expert_4&#45;&gt;layer_3_expert_agg</title>
<path fill="none" stroke="black" d="M1512,-7763.63C1512,-7755.1 1512,-7746 1512,-7737.15"/>
<polygon fill="black" stroke="black" points="1515.5,-7736.92 1512,-7726.92 1508.5,-7736.92 1515.5,-7736.92"/>
</g>
<!-- layer_3_expert_5&#45;&gt;layer_3_expert_agg -->
<g id="edge76" class="edge">
<title>layer_3_expert_5&#45;&gt;layer_3_expert_agg</title>
<path fill="none" stroke="black" d="M1694.33,-7763.63C1669.43,-7753.06 1642.47,-7741.62 1617.11,-7730.86"/>
<polygon fill="black" stroke="black" points="1618.42,-7727.61 1607.85,-7726.92 1615.69,-7734.05 1618.42,-7727.61"/>
</g>
<!-- layer_3_expert_6&#45;&gt;layer_3_expert_agg -->
<g id="edge77" class="edge">
<title>layer_3_expert_6&#45;&gt;layer_3_expert_agg</title>
<path fill="none" stroke="black" d="M1937.88,-7765.9C1934.9,-7765.16 1931.93,-7764.44 1929,-7763.74 1835.21,-7741.42 1728.28,-7721.66 1646.19,-7707.68"/>
<polygon fill="black" stroke="black" points="1646.74,-7704.22 1636.3,-7706 1645.57,-7711.12 1646.74,-7704.22"/>
</g>
<!-- layer_3_expert_7&#45;&gt;layer_3_expert_agg -->
<g id="edge78" class="edge">
<title>layer_3_expert_7&#45;&gt;layer_3_expert_agg</title>
<path fill="none" stroke="black" d="M2215.95,-7765.61C2212.94,-7764.96 2209.96,-7764.33 2207,-7763.74 2014,-7725.16 1786.74,-7704.37 1646,-7694.3"/>
<polygon fill="black" stroke="black" points="1646.24,-7690.81 1636.02,-7693.59 1645.75,-7697.79 1646.24,-7690.81"/>
</g>
<!-- layer_3_expert_agg&#45;&gt;layer_3_residual -->
<g id="edge80" class="edge">
<title>layer_3_expert_agg&#45;&gt;layer_3_residual</title>
<path fill="none" stroke="black" d="M1636.27,-7662.32C1740.54,-7643.93 1890.66,-7617.45 2006.91,-7596.95"/>
<polygon fill="black" stroke="black" points="2007.74,-7600.35 2016.98,-7595.17 2006.53,-7593.46 2007.74,-7600.35"/>
</g>
<!-- layer_4_mha -->
<g id="node50" class="node">
<title>layer_4_mha</title>
<polygon fill="lightblue" stroke="black" points="2282.5,-7486.74 2079.5,-7486.74 2079.5,-7403.74 2282.5,-7403.74 2282.5,-7486.74"/>
<text text-anchor="middle" x="2181" y="-7471.54" font-family="Times,serif" font-size="14.00">Layer 4</text>
<text text-anchor="middle" x="2181" y="-7456.54" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="2181" y="-7441.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-7426.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-7411.54" font-family="Times,serif" font-size="14.00">TP=8 across GPUs 0&#45;7</text>
</g>
<!-- layer_3_residual&#45;&gt;layer_4_mha -->
<g id="edge81" class="edge">
<title>layer_3_residual&#45;&gt;layer_4_mha</title>
<path fill="none" stroke="black" d="M2181,-7523.63C2181,-7515.1 2181,-7506 2181,-7497.15"/>
<polygon fill="black" stroke="black" points="2184.5,-7496.92 2181,-7486.92 2177.5,-7496.92 2184.5,-7496.92"/>
</g>
<!-- layer_4_gate -->
<g id="node51" class="node">
<title>layer_4_gate</title>
<polygon fill="lightblue" stroke="black" points="1611.5,-7366.74 1412.5,-7366.74 1412.5,-7283.74 1611.5,-7283.74 1611.5,-7366.74"/>
<text text-anchor="middle" x="1512" y="-7351.54" font-family="Times,serif" font-size="14.00">Layer 4</text>
<text text-anchor="middle" x="1512" y="-7336.54" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1512" y="-7321.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1512" y="-7306.54" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="1512" y="-7291.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_4_mha&#45;&gt;layer_4_gate -->
<g id="edge82" class="edge">
<title>layer_4_mha&#45;&gt;layer_4_gate</title>
<path fill="none" stroke="black" d="M2079.39,-7426.32C1955.99,-7404.55 1748.63,-7367.98 1621.69,-7345.59"/>
<polygon fill="black" stroke="black" points="1622.01,-7342.09 1611.55,-7343.8 1620.79,-7348.98 1622.01,-7342.09"/>
</g>
<!-- layer_4_residual -->
<g id="node61" class="node">
<title>layer_4_residual</title>
<polygon fill="lightblue" stroke="black" points="2345,-6992.74 2017,-6992.74 2017,-6909.74 2345,-6909.74 2345,-6992.74"/>
<text text-anchor="middle" x="2181" y="-6977.54" font-family="Times,serif" font-size="14.00">Layer 4</text>
<text text-anchor="middle" x="2181" y="-6962.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="2181" y="-6947.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-6932.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-6917.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_4_mha&#45;&gt;layer_4_residual -->
<g id="edge99" class="edge">
<title>layer_4_mha&#45;&gt;layer_4_residual</title>
<path fill="none" stroke="black" d="M2282.56,-7428.1C2379.86,-7409.68 2512,-7375.58 2512,-7326.24 2512,-7326.24 2512,-7326.24 2512,-7070.24 2512,-7032.5 2434.69,-7003.68 2354.8,-6983.97"/>
<polygon fill="black" stroke="black" points="2355.59,-6980.56 2345.05,-6981.61 2353.94,-6987.36 2355.59,-6980.56"/>
<text text-anchor="middle" x="2540" y="-7187.54" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_4_expert_0 -->
<g id="node52" class="node">
<title>layer_4_expert_0</title>
<polygon fill="lightblue" stroke="black" points="530,-7232.74 270,-7232.74 270,-7149.74 530,-7149.74 530,-7232.74"/>
<text text-anchor="middle" x="400" y="-7217.54" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="400" y="-7202.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="400" y="-7187.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="400" y="-7172.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="400" y="-7157.54" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_4_gate&#45;&gt;layer_4_expert_0 -->
<g id="edge83" class="edge">
<title>layer_4_gate&#45;&gt;layer_4_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.19,-7322.04C1236.57,-7316.6 861.29,-7297.94 540.03,-7232.86"/>
<polygon fill="black" stroke="black" points="540.56,-7229.4 530.06,-7230.82 539.16,-7236.25 540.56,-7229.4"/>
<text text-anchor="middle" x="773" y="-7254.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_4_expert_1 -->
<g id="node53" class="node">
<title>layer_4_expert_1</title>
<polygon fill="lightblue" stroke="black" points="808,-7232.74 548,-7232.74 548,-7149.74 808,-7149.74 808,-7232.74"/>
<text text-anchor="middle" x="678" y="-7217.54" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="678" y="-7202.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="678" y="-7187.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="678" y="-7172.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="678" y="-7157.54" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_4_gate&#45;&gt;layer_4_expert_1 -->
<g id="edge84" class="edge">
<title>layer_4_gate&#45;&gt;layer_4_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.22,-7315.93C1278.56,-7303.72 1034.15,-7277.61 818.01,-7232.87"/>
<polygon fill="black" stroke="black" points="818.57,-7229.41 808.07,-7230.79 817.14,-7236.26 818.57,-7229.41"/>
<text text-anchor="middle" x="1037" y="-7254.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_4_expert_2 -->
<g id="node54" class="node">
<title>layer_4_expert_2</title>
<polygon fill="lightblue" stroke="black" points="1086,-7232.74 826,-7232.74 826,-7149.74 1086,-7149.74 1086,-7232.74"/>
<text text-anchor="middle" x="956" y="-7217.54" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="956" y="-7202.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="956" y="-7187.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="956" y="-7172.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="956" y="-7157.54" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_4_gate&#45;&gt;layer_4_expert_2 -->
<g id="edge85" class="edge">
<title>layer_4_gate&#45;&gt;layer_4_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.13,-7304.3C1329.78,-7287.4 1209.76,-7261.72 1096.07,-7232.97"/>
<polygon fill="black" stroke="black" points="1096.7,-7229.52 1086.15,-7230.45 1094.98,-7236.3 1096.7,-7229.52"/>
<text text-anchor="middle" x="1281" y="-7254.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_4_expert_3 -->
<g id="node55" class="node">
<title>layer_4_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1364,-7232.74 1104,-7232.74 1104,-7149.74 1364,-7149.74 1364,-7232.74"/>
<text text-anchor="middle" x="1234" y="-7217.54" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1234" y="-7202.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1234" y="-7187.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1234" y="-7172.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1234" y="-7157.54" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_4_gate&#45;&gt;layer_4_expert_3 -->
<g id="edge86" class="edge">
<title>layer_4_gate&#45;&gt;layer_4_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1426.7,-7283.74C1395.76,-7269.05 1360.62,-7252.36 1328.9,-7237.3"/>
<polygon fill="black" stroke="black" points="1330.15,-7234.02 1319.62,-7232.89 1327.15,-7240.34 1330.15,-7234.02"/>
<text text-anchor="middle" x="1431" y="-7254.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_4_expert_4 -->
<g id="node56" class="node">
<title>layer_4_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1642,-7232.74 1382,-7232.74 1382,-7149.74 1642,-7149.74 1642,-7232.74"/>
<text text-anchor="middle" x="1512" y="-7217.54" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1512" y="-7202.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1512" y="-7187.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-7172.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-7157.54" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_4_gate&#45;&gt;layer_4_expert_4 -->
<g id="edge87" class="edge">
<title>layer_4_gate&#45;&gt;layer_4_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1512,-7283.56C1512,-7270.76 1512,-7256.47 1512,-7243.06"/>
<polygon fill="black" stroke="black" points="1515.5,-7243.01 1512,-7233.01 1508.5,-7243.01 1515.5,-7243.01"/>
<text text-anchor="middle" x="1562" y="-7254.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_4_expert_5 -->
<g id="node57" class="node">
<title>layer_4_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1920,-7232.74 1660,-7232.74 1660,-7149.74 1920,-7149.74 1920,-7232.74"/>
<text text-anchor="middle" x="1790" y="-7217.54" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1790" y="-7202.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1790" y="-7187.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1790" y="-7172.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1790" y="-7157.54" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_4_gate&#45;&gt;layer_4_expert_5 -->
<g id="edge88" class="edge">
<title>layer_4_gate&#45;&gt;layer_4_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1597.3,-7283.74C1628.24,-7269.05 1663.38,-7252.36 1695.1,-7237.3"/>
<polygon fill="black" stroke="black" points="1696.85,-7240.34 1704.38,-7232.89 1693.85,-7234.02 1696.85,-7240.34"/>
<text text-anchor="middle" x="1709" y="-7254.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_4_expert_6 -->
<g id="node58" class="node">
<title>layer_4_expert_6</title>
<polygon fill="lightblue" stroke="black" points="2198,-7232.74 1938,-7232.74 1938,-7149.74 2198,-7149.74 2198,-7232.74"/>
<text text-anchor="middle" x="2068" y="-7217.54" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="2068" y="-7202.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2068" y="-7187.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2068" y="-7172.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2068" y="-7157.54" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_4_gate&#45;&gt;layer_4_expert_6 -->
<g id="edge89" class="edge">
<title>layer_4_gate&#45;&gt;layer_4_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1611.87,-7304.3C1694.22,-7287.4 1814.24,-7261.72 1927.93,-7232.97"/>
<polygon fill="black" stroke="black" points="1929.02,-7236.3 1937.85,-7230.45 1927.3,-7229.52 1929.02,-7236.3"/>
<text text-anchor="middle" x="1899" y="-7254.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_4_expert_7 -->
<g id="node59" class="node">
<title>layer_4_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2476,-7232.74 2216,-7232.74 2216,-7149.74 2476,-7149.74 2476,-7232.74"/>
<text text-anchor="middle" x="2346" y="-7217.54" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2346" y="-7202.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2346" y="-7187.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2346" y="-7172.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2346" y="-7157.54" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_4_gate&#45;&gt;layer_4_expert_7 -->
<g id="edge90" class="edge">
<title>layer_4_gate&#45;&gt;layer_4_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1611.78,-7315.93C1745.44,-7303.72 1989.85,-7277.61 2205.99,-7232.87"/>
<polygon fill="black" stroke="black" points="2206.86,-7236.26 2215.93,-7230.79 2205.43,-7229.41 2206.86,-7236.26"/>
<text text-anchor="middle" x="2163" y="-7254.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_4_expert_agg -->
<g id="node60" class="node">
<title>layer_4_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="1636,-7112.74 1388,-7112.74 1388,-7029.74 1636,-7029.74 1636,-7112.74"/>
<text text-anchor="middle" x="1512" y="-7097.54" font-family="Times,serif" font-size="14.00">Layer 4</text>
<text text-anchor="middle" x="1512" y="-7082.54" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1512" y="-7067.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-7052.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1512" y="-7037.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_4_expert_0&#45;&gt;layer_4_expert_agg -->
<g id="edge91" class="edge">
<title>layer_4_expert_0&#45;&gt;layer_4_expert_agg</title>
<path fill="none" stroke="black" d="M530.03,-7151.48C533.04,-7150.87 536.03,-7150.28 539,-7149.74 835.03,-7095.41 1188.63,-7079.17 1377.44,-7074.31"/>
<polygon fill="black" stroke="black" points="1377.78,-7077.8 1387.69,-7074.05 1377.6,-7070.8 1377.78,-7077.8"/>
</g>
<!-- layer_4_expert_1&#45;&gt;layer_4_expert_agg -->
<g id="edge92" class="edge">
<title>layer_4_expert_1&#45;&gt;layer_4_expert_agg</title>
<path fill="none" stroke="black" d="M808.05,-7151.61C811.06,-7150.96 814.04,-7150.33 817,-7149.74 1010,-7111.16 1237.26,-7090.37 1378,-7080.3"/>
<polygon fill="black" stroke="black" points="1378.25,-7083.79 1387.98,-7079.59 1377.76,-7076.81 1378.25,-7083.79"/>
</g>
<!-- layer_4_expert_2&#45;&gt;layer_4_expert_agg -->
<g id="edge93" class="edge">
<title>layer_4_expert_2&#45;&gt;layer_4_expert_agg</title>
<path fill="none" stroke="black" d="M1086.12,-7151.9C1089.1,-7151.16 1092.07,-7150.44 1095,-7149.74 1188.79,-7127.42 1295.72,-7107.66 1377.81,-7093.68"/>
<polygon fill="black" stroke="black" points="1378.43,-7097.12 1387.7,-7092 1377.26,-7090.22 1378.43,-7097.12"/>
</g>
<!-- layer_4_expert_3&#45;&gt;layer_4_expert_agg -->
<g id="edge94" class="edge">
<title>layer_4_expert_3&#45;&gt;layer_4_expert_agg</title>
<path fill="none" stroke="black" d="M1329.67,-7149.63C1354.57,-7139.06 1381.53,-7127.62 1406.89,-7116.86"/>
<polygon fill="black" stroke="black" points="1408.31,-7120.05 1416.15,-7112.92 1405.58,-7113.61 1408.31,-7120.05"/>
</g>
<!-- layer_4_expert_4&#45;&gt;layer_4_expert_agg -->
<g id="edge95" class="edge">
<title>layer_4_expert_4&#45;&gt;layer_4_expert_agg</title>
<path fill="none" stroke="black" d="M1512,-7149.63C1512,-7141.1 1512,-7132 1512,-7123.15"/>
<polygon fill="black" stroke="black" points="1515.5,-7122.92 1512,-7112.92 1508.5,-7122.92 1515.5,-7122.92"/>
</g>
<!-- layer_4_expert_5&#45;&gt;layer_4_expert_agg -->
<g id="edge96" class="edge">
<title>layer_4_expert_5&#45;&gt;layer_4_expert_agg</title>
<path fill="none" stroke="black" d="M1694.33,-7149.63C1669.43,-7139.06 1642.47,-7127.62 1617.11,-7116.86"/>
<polygon fill="black" stroke="black" points="1618.42,-7113.61 1607.85,-7112.92 1615.69,-7120.05 1618.42,-7113.61"/>
</g>
<!-- layer_4_expert_6&#45;&gt;layer_4_expert_agg -->
<g id="edge97" class="edge">
<title>layer_4_expert_6&#45;&gt;layer_4_expert_agg</title>
<path fill="none" stroke="black" d="M1937.88,-7151.9C1934.9,-7151.16 1931.93,-7150.44 1929,-7149.74 1835.21,-7127.42 1728.28,-7107.66 1646.19,-7093.68"/>
<polygon fill="black" stroke="black" points="1646.74,-7090.22 1636.3,-7092 1645.57,-7097.12 1646.74,-7090.22"/>
</g>
<!-- layer_4_expert_7&#45;&gt;layer_4_expert_agg -->
<g id="edge98" class="edge">
<title>layer_4_expert_7&#45;&gt;layer_4_expert_agg</title>
<path fill="none" stroke="black" d="M2215.95,-7151.61C2212.94,-7150.96 2209.96,-7150.33 2207,-7149.74 2014,-7111.16 1786.74,-7090.37 1646,-7080.3"/>
<polygon fill="black" stroke="black" points="1646.24,-7076.81 1636.02,-7079.59 1645.75,-7083.79 1646.24,-7076.81"/>
</g>
<!-- layer_4_expert_agg&#45;&gt;layer_4_residual -->
<g id="edge100" class="edge">
<title>layer_4_expert_agg&#45;&gt;layer_4_residual</title>
<path fill="none" stroke="black" d="M1636.27,-7048.32C1740.54,-7029.93 1890.66,-7003.45 2006.91,-6982.95"/>
<polygon fill="black" stroke="black" points="2007.74,-6986.35 2016.98,-6981.17 2006.53,-6979.46 2007.74,-6986.35"/>
</g>
<!-- layer_5_mha -->
<g id="node62" class="node">
<title>layer_5_mha</title>
<polygon fill="lightblue" stroke="black" points="2282.5,-6872.74 2079.5,-6872.74 2079.5,-6789.74 2282.5,-6789.74 2282.5,-6872.74"/>
<text text-anchor="middle" x="2181" y="-6857.54" font-family="Times,serif" font-size="14.00">Layer 5</text>
<text text-anchor="middle" x="2181" y="-6842.54" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="2181" y="-6827.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-6812.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-6797.54" font-family="Times,serif" font-size="14.00">TP=8 across GPUs 0&#45;7</text>
</g>
<!-- layer_4_residual&#45;&gt;layer_5_mha -->
<g id="edge101" class="edge">
<title>layer_4_residual&#45;&gt;layer_5_mha</title>
<path fill="none" stroke="black" d="M2181,-6909.63C2181,-6901.1 2181,-6892 2181,-6883.15"/>
<polygon fill="black" stroke="black" points="2184.5,-6882.92 2181,-6872.92 2177.5,-6882.92 2184.5,-6882.92"/>
</g>
<!-- layer_5_gate -->
<g id="node63" class="node">
<title>layer_5_gate</title>
<polygon fill="lightblue" stroke="black" points="1611.5,-6752.74 1412.5,-6752.74 1412.5,-6669.74 1611.5,-6669.74 1611.5,-6752.74"/>
<text text-anchor="middle" x="1512" y="-6737.54" font-family="Times,serif" font-size="14.00">Layer 5</text>
<text text-anchor="middle" x="1512" y="-6722.54" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1512" y="-6707.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1512" y="-6692.54" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="1512" y="-6677.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_5_mha&#45;&gt;layer_5_gate -->
<g id="edge102" class="edge">
<title>layer_5_mha&#45;&gt;layer_5_gate</title>
<path fill="none" stroke="black" d="M2079.39,-6812.32C1955.99,-6790.55 1748.63,-6753.98 1621.69,-6731.59"/>
<polygon fill="black" stroke="black" points="1622.01,-6728.09 1611.55,-6729.8 1620.79,-6734.98 1622.01,-6728.09"/>
</g>
<!-- layer_5_residual -->
<g id="node73" class="node">
<title>layer_5_residual</title>
<polygon fill="lightblue" stroke="black" points="2345,-6378.74 2017,-6378.74 2017,-6295.74 2345,-6295.74 2345,-6378.74"/>
<text text-anchor="middle" x="2181" y="-6363.54" font-family="Times,serif" font-size="14.00">Layer 5</text>
<text text-anchor="middle" x="2181" y="-6348.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="2181" y="-6333.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-6318.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-6303.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_5_mha&#45;&gt;layer_5_residual -->
<g id="edge119" class="edge">
<title>layer_5_mha&#45;&gt;layer_5_residual</title>
<path fill="none" stroke="black" d="M2282.56,-6814.1C2379.86,-6795.68 2512,-6761.58 2512,-6712.24 2512,-6712.24 2512,-6712.24 2512,-6456.24 2512,-6418.5 2434.69,-6389.68 2354.8,-6369.97"/>
<polygon fill="black" stroke="black" points="2355.59,-6366.56 2345.05,-6367.61 2353.94,-6373.36 2355.59,-6366.56"/>
<text text-anchor="middle" x="2540" y="-6573.54" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_5_expert_0 -->
<g id="node64" class="node">
<title>layer_5_expert_0</title>
<polygon fill="lightblue" stroke="black" points="530,-6618.74 270,-6618.74 270,-6535.74 530,-6535.74 530,-6618.74"/>
<text text-anchor="middle" x="400" y="-6603.54" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="400" y="-6588.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="400" y="-6573.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="400" y="-6558.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="400" y="-6543.54" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_5_gate&#45;&gt;layer_5_expert_0 -->
<g id="edge103" class="edge">
<title>layer_5_gate&#45;&gt;layer_5_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.19,-6708.04C1236.57,-6702.6 861.29,-6683.94 540.03,-6618.86"/>
<polygon fill="black" stroke="black" points="540.56,-6615.4 530.06,-6616.82 539.16,-6622.25 540.56,-6615.4"/>
<text text-anchor="middle" x="773" y="-6640.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_5_expert_1 -->
<g id="node65" class="node">
<title>layer_5_expert_1</title>
<polygon fill="lightblue" stroke="black" points="808,-6618.74 548,-6618.74 548,-6535.74 808,-6535.74 808,-6618.74"/>
<text text-anchor="middle" x="678" y="-6603.54" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="678" y="-6588.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="678" y="-6573.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="678" y="-6558.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="678" y="-6543.54" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_5_gate&#45;&gt;layer_5_expert_1 -->
<g id="edge104" class="edge">
<title>layer_5_gate&#45;&gt;layer_5_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.22,-6701.93C1278.56,-6689.72 1034.15,-6663.61 818.01,-6618.87"/>
<polygon fill="black" stroke="black" points="818.57,-6615.41 808.07,-6616.79 817.14,-6622.26 818.57,-6615.41"/>
<text text-anchor="middle" x="1037" y="-6640.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_5_expert_2 -->
<g id="node66" class="node">
<title>layer_5_expert_2</title>
<polygon fill="lightblue" stroke="black" points="1086,-6618.74 826,-6618.74 826,-6535.74 1086,-6535.74 1086,-6618.74"/>
<text text-anchor="middle" x="956" y="-6603.54" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="956" y="-6588.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="956" y="-6573.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="956" y="-6558.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="956" y="-6543.54" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_5_gate&#45;&gt;layer_5_expert_2 -->
<g id="edge105" class="edge">
<title>layer_5_gate&#45;&gt;layer_5_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.13,-6690.3C1329.78,-6673.4 1209.76,-6647.72 1096.07,-6618.97"/>
<polygon fill="black" stroke="black" points="1096.7,-6615.52 1086.15,-6616.45 1094.98,-6622.3 1096.7,-6615.52"/>
<text text-anchor="middle" x="1281" y="-6640.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_5_expert_3 -->
<g id="node67" class="node">
<title>layer_5_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1364,-6618.74 1104,-6618.74 1104,-6535.74 1364,-6535.74 1364,-6618.74"/>
<text text-anchor="middle" x="1234" y="-6603.54" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1234" y="-6588.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1234" y="-6573.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1234" y="-6558.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1234" y="-6543.54" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_5_gate&#45;&gt;layer_5_expert_3 -->
<g id="edge106" class="edge">
<title>layer_5_gate&#45;&gt;layer_5_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1426.7,-6669.74C1395.76,-6655.05 1360.62,-6638.36 1328.9,-6623.3"/>
<polygon fill="black" stroke="black" points="1330.15,-6620.02 1319.62,-6618.89 1327.15,-6626.34 1330.15,-6620.02"/>
<text text-anchor="middle" x="1431" y="-6640.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_5_expert_4 -->
<g id="node68" class="node">
<title>layer_5_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1642,-6618.74 1382,-6618.74 1382,-6535.74 1642,-6535.74 1642,-6618.74"/>
<text text-anchor="middle" x="1512" y="-6603.54" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1512" y="-6588.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1512" y="-6573.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-6558.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-6543.54" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_5_gate&#45;&gt;layer_5_expert_4 -->
<g id="edge107" class="edge">
<title>layer_5_gate&#45;&gt;layer_5_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1512,-6669.56C1512,-6656.76 1512,-6642.47 1512,-6629.06"/>
<polygon fill="black" stroke="black" points="1515.5,-6629.01 1512,-6619.01 1508.5,-6629.01 1515.5,-6629.01"/>
<text text-anchor="middle" x="1562" y="-6640.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_5_expert_5 -->
<g id="node69" class="node">
<title>layer_5_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1920,-6618.74 1660,-6618.74 1660,-6535.74 1920,-6535.74 1920,-6618.74"/>
<text text-anchor="middle" x="1790" y="-6603.54" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1790" y="-6588.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1790" y="-6573.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1790" y="-6558.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1790" y="-6543.54" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_5_gate&#45;&gt;layer_5_expert_5 -->
<g id="edge108" class="edge">
<title>layer_5_gate&#45;&gt;layer_5_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1597.3,-6669.74C1628.24,-6655.05 1663.38,-6638.36 1695.1,-6623.3"/>
<polygon fill="black" stroke="black" points="1696.85,-6626.34 1704.38,-6618.89 1693.85,-6620.02 1696.85,-6626.34"/>
<text text-anchor="middle" x="1709" y="-6640.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_5_expert_6 -->
<g id="node70" class="node">
<title>layer_5_expert_6</title>
<polygon fill="lightblue" stroke="black" points="2198,-6618.74 1938,-6618.74 1938,-6535.74 2198,-6535.74 2198,-6618.74"/>
<text text-anchor="middle" x="2068" y="-6603.54" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="2068" y="-6588.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2068" y="-6573.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2068" y="-6558.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2068" y="-6543.54" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_5_gate&#45;&gt;layer_5_expert_6 -->
<g id="edge109" class="edge">
<title>layer_5_gate&#45;&gt;layer_5_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1611.87,-6690.3C1694.22,-6673.4 1814.24,-6647.72 1927.93,-6618.97"/>
<polygon fill="black" stroke="black" points="1929.02,-6622.3 1937.85,-6616.45 1927.3,-6615.52 1929.02,-6622.3"/>
<text text-anchor="middle" x="1899" y="-6640.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_5_expert_7 -->
<g id="node71" class="node">
<title>layer_5_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2476,-6618.74 2216,-6618.74 2216,-6535.74 2476,-6535.74 2476,-6618.74"/>
<text text-anchor="middle" x="2346" y="-6603.54" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2346" y="-6588.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2346" y="-6573.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2346" y="-6558.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2346" y="-6543.54" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_5_gate&#45;&gt;layer_5_expert_7 -->
<g id="edge110" class="edge">
<title>layer_5_gate&#45;&gt;layer_5_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1611.78,-6701.93C1745.44,-6689.72 1989.85,-6663.61 2205.99,-6618.87"/>
<polygon fill="black" stroke="black" points="2206.86,-6622.26 2215.93,-6616.79 2205.43,-6615.41 2206.86,-6622.26"/>
<text text-anchor="middle" x="2163" y="-6640.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_5_expert_agg -->
<g id="node72" class="node">
<title>layer_5_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="1636,-6498.74 1388,-6498.74 1388,-6415.74 1636,-6415.74 1636,-6498.74"/>
<text text-anchor="middle" x="1512" y="-6483.54" font-family="Times,serif" font-size="14.00">Layer 5</text>
<text text-anchor="middle" x="1512" y="-6468.54" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1512" y="-6453.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-6438.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1512" y="-6423.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_5_expert_0&#45;&gt;layer_5_expert_agg -->
<g id="edge111" class="edge">
<title>layer_5_expert_0&#45;&gt;layer_5_expert_agg</title>
<path fill="none" stroke="black" d="M530.03,-6537.48C533.04,-6536.87 536.03,-6536.28 539,-6535.74 835.03,-6481.41 1188.63,-6465.17 1377.44,-6460.31"/>
<polygon fill="black" stroke="black" points="1377.78,-6463.8 1387.69,-6460.05 1377.6,-6456.8 1377.78,-6463.8"/>
</g>
<!-- layer_5_expert_1&#45;&gt;layer_5_expert_agg -->
<g id="edge112" class="edge">
<title>layer_5_expert_1&#45;&gt;layer_5_expert_agg</title>
<path fill="none" stroke="black" d="M808.05,-6537.61C811.06,-6536.96 814.04,-6536.33 817,-6535.74 1010,-6497.16 1237.26,-6476.37 1378,-6466.3"/>
<polygon fill="black" stroke="black" points="1378.25,-6469.79 1387.98,-6465.59 1377.76,-6462.81 1378.25,-6469.79"/>
</g>
<!-- layer_5_expert_2&#45;&gt;layer_5_expert_agg -->
<g id="edge113" class="edge">
<title>layer_5_expert_2&#45;&gt;layer_5_expert_agg</title>
<path fill="none" stroke="black" d="M1086.12,-6537.9C1089.1,-6537.16 1092.07,-6536.44 1095,-6535.74 1188.79,-6513.42 1295.72,-6493.66 1377.81,-6479.68"/>
<polygon fill="black" stroke="black" points="1378.43,-6483.12 1387.7,-6478 1377.26,-6476.22 1378.43,-6483.12"/>
</g>
<!-- layer_5_expert_3&#45;&gt;layer_5_expert_agg -->
<g id="edge114" class="edge">
<title>layer_5_expert_3&#45;&gt;layer_5_expert_agg</title>
<path fill="none" stroke="black" d="M1329.67,-6535.63C1354.57,-6525.06 1381.53,-6513.62 1406.89,-6502.86"/>
<polygon fill="black" stroke="black" points="1408.31,-6506.05 1416.15,-6498.92 1405.58,-6499.61 1408.31,-6506.05"/>
</g>
<!-- layer_5_expert_4&#45;&gt;layer_5_expert_agg -->
<g id="edge115" class="edge">
<title>layer_5_expert_4&#45;&gt;layer_5_expert_agg</title>
<path fill="none" stroke="black" d="M1512,-6535.63C1512,-6527.1 1512,-6518 1512,-6509.15"/>
<polygon fill="black" stroke="black" points="1515.5,-6508.92 1512,-6498.92 1508.5,-6508.92 1515.5,-6508.92"/>
</g>
<!-- layer_5_expert_5&#45;&gt;layer_5_expert_agg -->
<g id="edge116" class="edge">
<title>layer_5_expert_5&#45;&gt;layer_5_expert_agg</title>
<path fill="none" stroke="black" d="M1694.33,-6535.63C1669.43,-6525.06 1642.47,-6513.62 1617.11,-6502.86"/>
<polygon fill="black" stroke="black" points="1618.42,-6499.61 1607.85,-6498.92 1615.69,-6506.05 1618.42,-6499.61"/>
</g>
<!-- layer_5_expert_6&#45;&gt;layer_5_expert_agg -->
<g id="edge117" class="edge">
<title>layer_5_expert_6&#45;&gt;layer_5_expert_agg</title>
<path fill="none" stroke="black" d="M1937.88,-6537.9C1934.9,-6537.16 1931.93,-6536.44 1929,-6535.74 1835.21,-6513.42 1728.28,-6493.66 1646.19,-6479.68"/>
<polygon fill="black" stroke="black" points="1646.74,-6476.22 1636.3,-6478 1645.57,-6483.12 1646.74,-6476.22"/>
</g>
<!-- layer_5_expert_7&#45;&gt;layer_5_expert_agg -->
<g id="edge118" class="edge">
<title>layer_5_expert_7&#45;&gt;layer_5_expert_agg</title>
<path fill="none" stroke="black" d="M2215.95,-6537.61C2212.94,-6536.96 2209.96,-6536.33 2207,-6535.74 2014,-6497.16 1786.74,-6476.37 1646,-6466.3"/>
<polygon fill="black" stroke="black" points="1646.24,-6462.81 1636.02,-6465.59 1645.75,-6469.79 1646.24,-6462.81"/>
</g>
<!-- layer_5_expert_agg&#45;&gt;layer_5_residual -->
<g id="edge120" class="edge">
<title>layer_5_expert_agg&#45;&gt;layer_5_residual</title>
<path fill="none" stroke="black" d="M1636.27,-6434.32C1740.54,-6415.93 1890.66,-6389.45 2006.91,-6368.95"/>
<polygon fill="black" stroke="black" points="2007.74,-6372.35 2016.98,-6367.17 2006.53,-6365.46 2007.74,-6372.35"/>
</g>
<!-- layer_6_mha -->
<g id="node74" class="node">
<title>layer_6_mha</title>
<polygon fill="lightblue" stroke="black" points="2282.5,-6258.74 2079.5,-6258.74 2079.5,-6175.74 2282.5,-6175.74 2282.5,-6258.74"/>
<text text-anchor="middle" x="2181" y="-6243.54" font-family="Times,serif" font-size="14.00">Layer 6</text>
<text text-anchor="middle" x="2181" y="-6228.54" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="2181" y="-6213.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-6198.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="2181" y="-6183.54" font-family="Times,serif" font-size="14.00">TP=8 across GPUs 0&#45;7</text>
</g>
<!-- layer_5_residual&#45;&gt;layer_6_mha -->
<g id="edge121" class="edge">
<title>layer_5_residual&#45;&gt;layer_6_mha</title>
<path fill="none" stroke="black" d="M2181,-6295.63C2181,-6287.1 2181,-6278 2181,-6269.15"/>
<polygon fill="black" stroke="black" points="2184.5,-6268.92 2181,-6258.92 2177.5,-6268.92 2184.5,-6268.92"/>
</g>
<!-- layer_6_gate -->
<g id="node75" class="node">
<title>layer_6_gate</title>
<polygon fill="lightblue" stroke="black" points="1611.5,-6138.74 1412.5,-6138.74 1412.5,-6055.74 1611.5,-6055.74 1611.5,-6138.74"/>
<text text-anchor="middle" x="1512" y="-6123.54" font-family="Times,serif" font-size="14.00">Layer 6</text>
<text text-anchor="middle" x="1512" y="-6108.54" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1512" y="-6093.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1512" y="-6078.54" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="1512" y="-6063.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_6_mha&#45;&gt;layer_6_gate -->
<g id="edge122" class="edge">
<title>layer_6_mha&#45;&gt;layer_6_gate</title>
<path fill="none" stroke="black" d="M2079.39,-6198.32C1955.99,-6176.55 1748.63,-6139.98 1621.69,-6117.59"/>
<polygon fill="black" stroke="black" points="1622.01,-6114.09 1611.55,-6115.8 1620.79,-6120.98 1622.01,-6114.09"/>
</g>
<!-- layer_6_residual -->
<g id="node85" class="node">
<title>layer_6_residual</title>
<polygon fill="lightblue" stroke="black" points="2122,-5764.74 1794,-5764.74 1794,-5681.74 2122,-5681.74 2122,-5764.74"/>
<text text-anchor="middle" x="1958" y="-5749.54" font-family="Times,serif" font-size="14.00">Layer 6</text>
<text text-anchor="middle" x="1958" y="-5734.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="1958" y="-5719.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="1958" y="-5704.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1958" y="-5689.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_6_mha&#45;&gt;layer_6_residual -->
<g id="edge139" class="edge">
<title>layer_6_mha&#45;&gt;layer_6_residual</title>
<path fill="none" stroke="black" d="M2282.56,-6200.1C2379.86,-6181.68 2512,-6147.58 2512,-6098.24 2512,-6098.24 2512,-6098.24 2512,-5842.24 2512,-5763.44 2294.86,-5737.05 2132.47,-5728.34"/>
<polygon fill="black" stroke="black" points="2132.51,-5724.84 2122.34,-5727.82 2132.15,-5731.83 2132.51,-5724.84"/>
<text text-anchor="middle" x="2540" y="-5959.54" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_6_expert_0 -->
<g id="node76" class="node">
<title>layer_6_expert_0</title>
<polygon fill="lightblue" stroke="black" points="530,-6004.74 270,-6004.74 270,-5921.74 530,-5921.74 530,-6004.74"/>
<text text-anchor="middle" x="400" y="-5989.54" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="400" y="-5974.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="400" y="-5959.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="400" y="-5944.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="400" y="-5929.54" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_6_gate&#45;&gt;layer_6_expert_0 -->
<g id="edge123" class="edge">
<title>layer_6_gate&#45;&gt;layer_6_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.19,-6094.04C1236.57,-6088.6 861.29,-6069.94 540.03,-6004.86"/>
<polygon fill="black" stroke="black" points="540.56,-6001.4 530.06,-6002.82 539.16,-6008.25 540.56,-6001.4"/>
<text text-anchor="middle" x="773" y="-6026.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_6_expert_1 -->
<g id="node77" class="node">
<title>layer_6_expert_1</title>
<polygon fill="lightblue" stroke="black" points="808,-6004.74 548,-6004.74 548,-5921.74 808,-5921.74 808,-6004.74"/>
<text text-anchor="middle" x="678" y="-5989.54" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="678" y="-5974.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="678" y="-5959.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="678" y="-5944.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="678" y="-5929.54" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_6_gate&#45;&gt;layer_6_expert_1 -->
<g id="edge124" class="edge">
<title>layer_6_gate&#45;&gt;layer_6_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.22,-6087.93C1278.56,-6075.72 1034.15,-6049.61 818.01,-6004.87"/>
<polygon fill="black" stroke="black" points="818.57,-6001.41 808.07,-6002.79 817.14,-6008.26 818.57,-6001.41"/>
<text text-anchor="middle" x="1037" y="-6026.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_6_expert_2 -->
<g id="node78" class="node">
<title>layer_6_expert_2</title>
<polygon fill="lightblue" stroke="black" points="1086,-6004.74 826,-6004.74 826,-5921.74 1086,-5921.74 1086,-6004.74"/>
<text text-anchor="middle" x="956" y="-5989.54" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="956" y="-5974.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="956" y="-5959.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="956" y="-5944.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="956" y="-5929.54" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_6_gate&#45;&gt;layer_6_expert_2 -->
<g id="edge125" class="edge">
<title>layer_6_gate&#45;&gt;layer_6_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.13,-6076.3C1329.78,-6059.4 1209.76,-6033.72 1096.07,-6004.97"/>
<polygon fill="black" stroke="black" points="1096.7,-6001.52 1086.15,-6002.45 1094.98,-6008.3 1096.7,-6001.52"/>
<text text-anchor="middle" x="1281" y="-6026.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_6_expert_3 -->
<g id="node79" class="node">
<title>layer_6_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1364,-6004.74 1104,-6004.74 1104,-5921.74 1364,-5921.74 1364,-6004.74"/>
<text text-anchor="middle" x="1234" y="-5989.54" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1234" y="-5974.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1234" y="-5959.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1234" y="-5944.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1234" y="-5929.54" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_6_gate&#45;&gt;layer_6_expert_3 -->
<g id="edge126" class="edge">
<title>layer_6_gate&#45;&gt;layer_6_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1426.7,-6055.74C1395.76,-6041.05 1360.62,-6024.36 1328.9,-6009.3"/>
<polygon fill="black" stroke="black" points="1330.15,-6006.02 1319.62,-6004.89 1327.15,-6012.34 1330.15,-6006.02"/>
<text text-anchor="middle" x="1431" y="-6026.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_6_expert_4 -->
<g id="node80" class="node">
<title>layer_6_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1642,-6004.74 1382,-6004.74 1382,-5921.74 1642,-5921.74 1642,-6004.74"/>
<text text-anchor="middle" x="1512" y="-5989.54" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1512" y="-5974.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1512" y="-5959.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-5944.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-5929.54" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_6_gate&#45;&gt;layer_6_expert_4 -->
<g id="edge127" class="edge">
<title>layer_6_gate&#45;&gt;layer_6_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1512,-6055.56C1512,-6042.76 1512,-6028.47 1512,-6015.06"/>
<polygon fill="black" stroke="black" points="1515.5,-6015.01 1512,-6005.01 1508.5,-6015.01 1515.5,-6015.01"/>
<text text-anchor="middle" x="1562" y="-6026.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_6_expert_5 -->
<g id="node81" class="node">
<title>layer_6_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1920,-6004.74 1660,-6004.74 1660,-5921.74 1920,-5921.74 1920,-6004.74"/>
<text text-anchor="middle" x="1790" y="-5989.54" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1790" y="-5974.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1790" y="-5959.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1790" y="-5944.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1790" y="-5929.54" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_6_gate&#45;&gt;layer_6_expert_5 -->
<g id="edge128" class="edge">
<title>layer_6_gate&#45;&gt;layer_6_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1597.3,-6055.74C1628.24,-6041.05 1663.38,-6024.36 1695.1,-6009.3"/>
<polygon fill="black" stroke="black" points="1696.85,-6012.34 1704.38,-6004.89 1693.85,-6006.02 1696.85,-6012.34"/>
<text text-anchor="middle" x="1709" y="-6026.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_6_expert_6 -->
<g id="node82" class="node">
<title>layer_6_expert_6</title>
<polygon fill="lightblue" stroke="black" points="2198,-6004.74 1938,-6004.74 1938,-5921.74 2198,-5921.74 2198,-6004.74"/>
<text text-anchor="middle" x="2068" y="-5989.54" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="2068" y="-5974.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2068" y="-5959.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2068" y="-5944.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2068" y="-5929.54" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_6_gate&#45;&gt;layer_6_expert_6 -->
<g id="edge129" class="edge">
<title>layer_6_gate&#45;&gt;layer_6_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1611.87,-6076.3C1694.22,-6059.4 1814.24,-6033.72 1927.93,-6004.97"/>
<polygon fill="black" stroke="black" points="1929.02,-6008.3 1937.85,-6002.45 1927.3,-6001.52 1929.02,-6008.3"/>
<text text-anchor="middle" x="1899" y="-6026.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_6_expert_7 -->
<g id="node83" class="node">
<title>layer_6_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2476,-6004.74 2216,-6004.74 2216,-5921.74 2476,-5921.74 2476,-6004.74"/>
<text text-anchor="middle" x="2346" y="-5989.54" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2346" y="-5974.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2346" y="-5959.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2346" y="-5944.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2346" y="-5929.54" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_6_gate&#45;&gt;layer_6_expert_7 -->
<g id="edge130" class="edge">
<title>layer_6_gate&#45;&gt;layer_6_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1611.78,-6087.93C1745.44,-6075.72 1989.85,-6049.61 2205.99,-6004.87"/>
<polygon fill="black" stroke="black" points="2206.86,-6008.26 2215.93,-6002.79 2205.43,-6001.41 2206.86,-6008.26"/>
<text text-anchor="middle" x="2163" y="-6026.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_6_expert_agg -->
<g id="node84" class="node">
<title>layer_6_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="1636,-5884.74 1388,-5884.74 1388,-5801.74 1636,-5801.74 1636,-5884.74"/>
<text text-anchor="middle" x="1512" y="-5869.54" font-family="Times,serif" font-size="14.00">Layer 6</text>
<text text-anchor="middle" x="1512" y="-5854.54" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1512" y="-5839.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-5824.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1512" y="-5809.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_6_expert_0&#45;&gt;layer_6_expert_agg -->
<g id="edge131" class="edge">
<title>layer_6_expert_0&#45;&gt;layer_6_expert_agg</title>
<path fill="none" stroke="black" d="M530.03,-5923.48C533.04,-5922.87 536.03,-5922.28 539,-5921.74 835.03,-5867.41 1188.63,-5851.17 1377.44,-5846.31"/>
<polygon fill="black" stroke="black" points="1377.78,-5849.8 1387.69,-5846.05 1377.6,-5842.8 1377.78,-5849.8"/>
</g>
<!-- layer_6_expert_1&#45;&gt;layer_6_expert_agg -->
<g id="edge132" class="edge">
<title>layer_6_expert_1&#45;&gt;layer_6_expert_agg</title>
<path fill="none" stroke="black" d="M808.05,-5923.61C811.06,-5922.96 814.04,-5922.33 817,-5921.74 1010,-5883.16 1237.26,-5862.37 1378,-5852.3"/>
<polygon fill="black" stroke="black" points="1378.25,-5855.79 1387.98,-5851.59 1377.76,-5848.81 1378.25,-5855.79"/>
</g>
<!-- layer_6_expert_2&#45;&gt;layer_6_expert_agg -->
<g id="edge133" class="edge">
<title>layer_6_expert_2&#45;&gt;layer_6_expert_agg</title>
<path fill="none" stroke="black" d="M1086.12,-5923.9C1089.1,-5923.16 1092.07,-5922.44 1095,-5921.74 1188.79,-5899.42 1295.72,-5879.66 1377.81,-5865.68"/>
<polygon fill="black" stroke="black" points="1378.43,-5869.12 1387.7,-5864 1377.26,-5862.22 1378.43,-5869.12"/>
</g>
<!-- layer_6_expert_3&#45;&gt;layer_6_expert_agg -->
<g id="edge134" class="edge">
<title>layer_6_expert_3&#45;&gt;layer_6_expert_agg</title>
<path fill="none" stroke="black" d="M1329.67,-5921.63C1354.57,-5911.06 1381.53,-5899.62 1406.89,-5888.86"/>
<polygon fill="black" stroke="black" points="1408.31,-5892.05 1416.15,-5884.92 1405.58,-5885.61 1408.31,-5892.05"/>
</g>
<!-- layer_6_expert_4&#45;&gt;layer_6_expert_agg -->
<g id="edge135" class="edge">
<title>layer_6_expert_4&#45;&gt;layer_6_expert_agg</title>
<path fill="none" stroke="black" d="M1512,-5921.63C1512,-5913.1 1512,-5904 1512,-5895.15"/>
<polygon fill="black" stroke="black" points="1515.5,-5894.92 1512,-5884.92 1508.5,-5894.92 1515.5,-5894.92"/>
</g>
<!-- layer_6_expert_5&#45;&gt;layer_6_expert_agg -->
<g id="edge136" class="edge">
<title>layer_6_expert_5&#45;&gt;layer_6_expert_agg</title>
<path fill="none" stroke="black" d="M1694.33,-5921.63C1669.43,-5911.06 1642.47,-5899.62 1617.11,-5888.86"/>
<polygon fill="black" stroke="black" points="1618.42,-5885.61 1607.85,-5884.92 1615.69,-5892.05 1618.42,-5885.61"/>
</g>
<!-- layer_6_expert_6&#45;&gt;layer_6_expert_agg -->
<g id="edge137" class="edge">
<title>layer_6_expert_6&#45;&gt;layer_6_expert_agg</title>
<path fill="none" stroke="black" d="M1937.88,-5923.9C1934.9,-5923.16 1931.93,-5922.44 1929,-5921.74 1835.21,-5899.42 1728.28,-5879.66 1646.19,-5865.68"/>
<polygon fill="black" stroke="black" points="1646.74,-5862.22 1636.3,-5864 1645.57,-5869.12 1646.74,-5862.22"/>
</g>
<!-- layer_6_expert_7&#45;&gt;layer_6_expert_agg -->
<g id="edge138" class="edge">
<title>layer_6_expert_7&#45;&gt;layer_6_expert_agg</title>
<path fill="none" stroke="black" d="M2215.95,-5923.61C2212.94,-5922.96 2209.96,-5922.33 2207,-5921.74 2014,-5883.16 1786.74,-5862.37 1646,-5852.3"/>
<polygon fill="black" stroke="black" points="1646.24,-5848.81 1636.02,-5851.59 1645.75,-5855.79 1646.24,-5848.81"/>
</g>
<!-- layer_6_expert_agg&#45;&gt;layer_6_residual -->
<g id="edge140" class="edge">
<title>layer_6_expert_agg&#45;&gt;layer_6_residual</title>
<path fill="none" stroke="black" d="M1636.24,-5809.37C1685.37,-5796.37 1742.52,-5781.25 1794.91,-5767.39"/>
<polygon fill="black" stroke="black" points="1795.86,-5770.76 1804.64,-5764.82 1794.07,-5763.99 1795.86,-5770.76"/>
</g>
<!-- layer_7_mha -->
<g id="node86" class="node">
<title>layer_7_mha</title>
<polygon fill="lightblue" stroke="black" points="2059.5,-5644.74 1856.5,-5644.74 1856.5,-5561.74 2059.5,-5561.74 2059.5,-5644.74"/>
<text text-anchor="middle" x="1958" y="-5629.54" font-family="Times,serif" font-size="14.00">Layer 7</text>
<text text-anchor="middle" x="1958" y="-5614.54" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1958" y="-5599.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1958" y="-5584.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1958" y="-5569.54" font-family="Times,serif" font-size="14.00">TP=8 across GPUs 0&#45;7</text>
</g>
<!-- layer_6_residual&#45;&gt;layer_7_mha -->
<g id="edge141" class="edge">
<title>layer_6_residual&#45;&gt;layer_7_mha</title>
<path fill="none" stroke="black" d="M1958,-5681.63C1958,-5673.1 1958,-5664 1958,-5655.15"/>
<polygon fill="black" stroke="black" points="1961.5,-5654.92 1958,-5644.92 1954.5,-5654.92 1961.5,-5654.92"/>
</g>
<!-- layer_7_gate -->
<g id="node87" class="node">
<title>layer_7_gate</title>
<polygon fill="lightblue" stroke="black" points="1611.5,-5524.74 1412.5,-5524.74 1412.5,-5441.74 1611.5,-5441.74 1611.5,-5524.74"/>
<text text-anchor="middle" x="1512" y="-5509.54" font-family="Times,serif" font-size="14.00">Layer 7</text>
<text text-anchor="middle" x="1512" y="-5494.54" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1512" y="-5479.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1512" y="-5464.54" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="1512" y="-5449.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_7_mha&#45;&gt;layer_7_gate -->
<g id="edge142" class="edge">
<title>layer_7_mha&#45;&gt;layer_7_gate</title>
<path fill="none" stroke="black" d="M1856.24,-5575.32C1786.26,-5556.8 1693.39,-5532.23 1621.75,-5513.28"/>
<polygon fill="black" stroke="black" points="1622.35,-5509.82 1611.79,-5510.64 1620.56,-5516.58 1622.35,-5509.82"/>
</g>
<!-- layer_7_residual -->
<g id="node97" class="node">
<title>layer_7_residual</title>
<polygon fill="lightblue" stroke="black" points="2122,-5150.74 1794,-5150.74 1794,-5067.74 2122,-5067.74 2122,-5150.74"/>
<text text-anchor="middle" x="1958" y="-5135.54" font-family="Times,serif" font-size="14.00">Layer 7</text>
<text text-anchor="middle" x="1958" y="-5120.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="1958" y="-5105.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="1958" y="-5090.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1958" y="-5075.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_7_mha&#45;&gt;layer_7_residual -->
<g id="edge159" class="edge">
<title>layer_7_mha&#45;&gt;layer_7_residual</title>
<path fill="none" stroke="black" d="M2059.61,-5601.11C2219.55,-5596.55 2512,-5575.69 2512,-5484.24 2512,-5484.24 2512,-5484.24 2512,-5228.24 2512,-5149.44 2294.86,-5123.05 2132.47,-5114.34"/>
<polygon fill="black" stroke="black" points="2132.51,-5110.84 2122.34,-5113.82 2132.15,-5117.83 2132.51,-5110.84"/>
<text text-anchor="middle" x="2540" y="-5345.54" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_7_expert_0 -->
<g id="node88" class="node">
<title>layer_7_expert_0</title>
<polygon fill="lightblue" stroke="black" points="530,-5390.74 270,-5390.74 270,-5307.74 530,-5307.74 530,-5390.74"/>
<text text-anchor="middle" x="400" y="-5375.54" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="400" y="-5360.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="400" y="-5345.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="400" y="-5330.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="400" y="-5315.54" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_7_gate&#45;&gt;layer_7_expert_0 -->
<g id="edge143" class="edge">
<title>layer_7_gate&#45;&gt;layer_7_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.19,-5480.04C1236.57,-5474.6 861.29,-5455.94 540.03,-5390.86"/>
<polygon fill="black" stroke="black" points="540.56,-5387.4 530.06,-5388.82 539.16,-5394.25 540.56,-5387.4"/>
<text text-anchor="middle" x="773" y="-5412.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_7_expert_1 -->
<g id="node89" class="node">
<title>layer_7_expert_1</title>
<polygon fill="lightblue" stroke="black" points="808,-5390.74 548,-5390.74 548,-5307.74 808,-5307.74 808,-5390.74"/>
<text text-anchor="middle" x="678" y="-5375.54" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="678" y="-5360.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="678" y="-5345.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="678" y="-5330.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="678" y="-5315.54" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_7_gate&#45;&gt;layer_7_expert_1 -->
<g id="edge144" class="edge">
<title>layer_7_gate&#45;&gt;layer_7_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.22,-5473.93C1278.56,-5461.72 1034.15,-5435.61 818.01,-5390.87"/>
<polygon fill="black" stroke="black" points="818.57,-5387.41 808.07,-5388.79 817.14,-5394.26 818.57,-5387.41"/>
<text text-anchor="middle" x="1037" y="-5412.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_7_expert_2 -->
<g id="node90" class="node">
<title>layer_7_expert_2</title>
<polygon fill="lightblue" stroke="black" points="1086,-5390.74 826,-5390.74 826,-5307.74 1086,-5307.74 1086,-5390.74"/>
<text text-anchor="middle" x="956" y="-5375.54" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="956" y="-5360.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="956" y="-5345.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="956" y="-5330.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="956" y="-5315.54" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_7_gate&#45;&gt;layer_7_expert_2 -->
<g id="edge145" class="edge">
<title>layer_7_gate&#45;&gt;layer_7_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1412.13,-5462.3C1329.78,-5445.4 1209.76,-5419.72 1096.07,-5390.97"/>
<polygon fill="black" stroke="black" points="1096.7,-5387.52 1086.15,-5388.45 1094.98,-5394.3 1096.7,-5387.52"/>
<text text-anchor="middle" x="1281" y="-5412.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_7_expert_3 -->
<g id="node91" class="node">
<title>layer_7_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1364,-5390.74 1104,-5390.74 1104,-5307.74 1364,-5307.74 1364,-5390.74"/>
<text text-anchor="middle" x="1234" y="-5375.54" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1234" y="-5360.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1234" y="-5345.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1234" y="-5330.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1234" y="-5315.54" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_7_gate&#45;&gt;layer_7_expert_3 -->
<g id="edge146" class="edge">
<title>layer_7_gate&#45;&gt;layer_7_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1426.7,-5441.74C1395.76,-5427.05 1360.62,-5410.36 1328.9,-5395.3"/>
<polygon fill="black" stroke="black" points="1330.15,-5392.02 1319.62,-5390.89 1327.15,-5398.34 1330.15,-5392.02"/>
<text text-anchor="middle" x="1431" y="-5412.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_7_expert_4 -->
<g id="node92" class="node">
<title>layer_7_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1642,-5390.74 1382,-5390.74 1382,-5307.74 1642,-5307.74 1642,-5390.74"/>
<text text-anchor="middle" x="1512" y="-5375.54" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1512" y="-5360.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1512" y="-5345.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-5330.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-5315.54" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_7_gate&#45;&gt;layer_7_expert_4 -->
<g id="edge147" class="edge">
<title>layer_7_gate&#45;&gt;layer_7_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1512,-5441.56C1512,-5428.76 1512,-5414.47 1512,-5401.06"/>
<polygon fill="black" stroke="black" points="1515.5,-5401.01 1512,-5391.01 1508.5,-5401.01 1515.5,-5401.01"/>
<text text-anchor="middle" x="1562" y="-5412.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_7_expert_5 -->
<g id="node93" class="node">
<title>layer_7_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1920,-5390.74 1660,-5390.74 1660,-5307.74 1920,-5307.74 1920,-5390.74"/>
<text text-anchor="middle" x="1790" y="-5375.54" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1790" y="-5360.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1790" y="-5345.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1790" y="-5330.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1790" y="-5315.54" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_7_gate&#45;&gt;layer_7_expert_5 -->
<g id="edge148" class="edge">
<title>layer_7_gate&#45;&gt;layer_7_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1597.3,-5441.74C1628.24,-5427.05 1663.38,-5410.36 1695.1,-5395.3"/>
<polygon fill="black" stroke="black" points="1696.85,-5398.34 1704.38,-5390.89 1693.85,-5392.02 1696.85,-5398.34"/>
<text text-anchor="middle" x="1709" y="-5412.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_7_expert_6 -->
<g id="node94" class="node">
<title>layer_7_expert_6</title>
<polygon fill="lightblue" stroke="black" points="2198,-5390.74 1938,-5390.74 1938,-5307.74 2198,-5307.74 2198,-5390.74"/>
<text text-anchor="middle" x="2068" y="-5375.54" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="2068" y="-5360.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2068" y="-5345.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2068" y="-5330.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2068" y="-5315.54" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_7_gate&#45;&gt;layer_7_expert_6 -->
<g id="edge149" class="edge">
<title>layer_7_gate&#45;&gt;layer_7_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1611.87,-5462.3C1694.22,-5445.4 1814.24,-5419.72 1927.93,-5390.97"/>
<polygon fill="black" stroke="black" points="1929.02,-5394.3 1937.85,-5388.45 1927.3,-5387.52 1929.02,-5394.3"/>
<text text-anchor="middle" x="1899" y="-5412.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_7_expert_7 -->
<g id="node95" class="node">
<title>layer_7_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2476,-5390.74 2216,-5390.74 2216,-5307.74 2476,-5307.74 2476,-5390.74"/>
<text text-anchor="middle" x="2346" y="-5375.54" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2346" y="-5360.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2346" y="-5345.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2346" y="-5330.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2346" y="-5315.54" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_7_gate&#45;&gt;layer_7_expert_7 -->
<g id="edge150" class="edge">
<title>layer_7_gate&#45;&gt;layer_7_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1611.78,-5473.93C1745.44,-5461.72 1989.85,-5435.61 2205.99,-5390.87"/>
<polygon fill="black" stroke="black" points="2206.86,-5394.26 2215.93,-5388.79 2205.43,-5387.41 2206.86,-5394.26"/>
<text text-anchor="middle" x="2163" y="-5412.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_7_expert_agg -->
<g id="node96" class="node">
<title>layer_7_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="1636,-5270.74 1388,-5270.74 1388,-5187.74 1636,-5187.74 1636,-5270.74"/>
<text text-anchor="middle" x="1512" y="-5255.54" font-family="Times,serif" font-size="14.00">Layer 7</text>
<text text-anchor="middle" x="1512" y="-5240.54" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1512" y="-5225.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1512" y="-5210.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1512" y="-5195.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_7_expert_0&#45;&gt;layer_7_expert_agg -->
<g id="edge151" class="edge">
<title>layer_7_expert_0&#45;&gt;layer_7_expert_agg</title>
<path fill="none" stroke="black" d="M530.03,-5309.48C533.04,-5308.87 536.03,-5308.28 539,-5307.74 835.03,-5253.41 1188.63,-5237.17 1377.44,-5232.31"/>
<polygon fill="black" stroke="black" points="1377.78,-5235.8 1387.69,-5232.05 1377.6,-5228.8 1377.78,-5235.8"/>
</g>
<!-- layer_7_expert_1&#45;&gt;layer_7_expert_agg -->
<g id="edge152" class="edge">
<title>layer_7_expert_1&#45;&gt;layer_7_expert_agg</title>
<path fill="none" stroke="black" d="M808.05,-5309.61C811.06,-5308.96 814.04,-5308.33 817,-5307.74 1010,-5269.16 1237.26,-5248.37 1378,-5238.3"/>
<polygon fill="black" stroke="black" points="1378.25,-5241.79 1387.98,-5237.59 1377.76,-5234.81 1378.25,-5241.79"/>
</g>
<!-- layer_7_expert_2&#45;&gt;layer_7_expert_agg -->
<g id="edge153" class="edge">
<title>layer_7_expert_2&#45;&gt;layer_7_expert_agg</title>
<path fill="none" stroke="black" d="M1086.12,-5309.9C1089.1,-5309.16 1092.07,-5308.44 1095,-5307.74 1188.79,-5285.42 1295.72,-5265.66 1377.81,-5251.68"/>
<polygon fill="black" stroke="black" points="1378.43,-5255.12 1387.7,-5250 1377.26,-5248.22 1378.43,-5255.12"/>
</g>
<!-- layer_7_expert_3&#45;&gt;layer_7_expert_agg -->
<g id="edge154" class="edge">
<title>layer_7_expert_3&#45;&gt;layer_7_expert_agg</title>
<path fill="none" stroke="black" d="M1329.67,-5307.63C1354.57,-5297.06 1381.53,-5285.62 1406.89,-5274.86"/>
<polygon fill="black" stroke="black" points="1408.31,-5278.05 1416.15,-5270.92 1405.58,-5271.61 1408.31,-5278.05"/>
</g>
<!-- layer_7_expert_4&#45;&gt;layer_7_expert_agg -->
<g id="edge155" class="edge">
<title>layer_7_expert_4&#45;&gt;layer_7_expert_agg</title>
<path fill="none" stroke="black" d="M1512,-5307.63C1512,-5299.1 1512,-5290 1512,-5281.15"/>
<polygon fill="black" stroke="black" points="1515.5,-5280.92 1512,-5270.92 1508.5,-5280.92 1515.5,-5280.92"/>
</g>
<!-- layer_7_expert_5&#45;&gt;layer_7_expert_agg -->
<g id="edge156" class="edge">
<title>layer_7_expert_5&#45;&gt;layer_7_expert_agg</title>
<path fill="none" stroke="black" d="M1694.33,-5307.63C1669.43,-5297.06 1642.47,-5285.62 1617.11,-5274.86"/>
<polygon fill="black" stroke="black" points="1618.42,-5271.61 1607.85,-5270.92 1615.69,-5278.05 1618.42,-5271.61"/>
</g>
<!-- layer_7_expert_6&#45;&gt;layer_7_expert_agg -->
<g id="edge157" class="edge">
<title>layer_7_expert_6&#45;&gt;layer_7_expert_agg</title>
<path fill="none" stroke="black" d="M1937.88,-5309.9C1934.9,-5309.16 1931.93,-5308.44 1929,-5307.74 1835.21,-5285.42 1728.28,-5265.66 1646.19,-5251.68"/>
<polygon fill="black" stroke="black" points="1646.74,-5248.22 1636.3,-5250 1645.57,-5255.12 1646.74,-5248.22"/>
</g>
<!-- layer_7_expert_7&#45;&gt;layer_7_expert_agg -->
<g id="edge158" class="edge">
<title>layer_7_expert_7&#45;&gt;layer_7_expert_agg</title>
<path fill="none" stroke="black" d="M2215.95,-5309.61C2212.94,-5308.96 2209.96,-5308.33 2207,-5307.74 2014,-5269.16 1786.74,-5248.37 1646,-5238.3"/>
<polygon fill="black" stroke="black" points="1646.24,-5234.81 1636.02,-5237.59 1645.75,-5241.79 1646.24,-5234.81"/>
</g>
<!-- layer_7_expert_agg&#45;&gt;layer_7_residual -->
<g id="edge160" class="edge">
<title>layer_7_expert_agg&#45;&gt;layer_7_residual</title>
<path fill="none" stroke="black" d="M1636.24,-5195.37C1685.37,-5182.37 1742.52,-5167.25 1794.91,-5153.39"/>
<polygon fill="black" stroke="black" points="1795.86,-5156.76 1804.64,-5150.82 1794.07,-5149.99 1795.86,-5156.76"/>
</g>
<!-- layer_8_mha -->
<g id="node98" class="node">
<title>layer_8_mha</title>
<polygon fill="lightblue" stroke="black" points="2059.5,-4965.74 1856.5,-4965.74 1856.5,-4882.74 2059.5,-4882.74 2059.5,-4965.74"/>
<text text-anchor="middle" x="1958" y="-4950.54" font-family="Times,serif" font-size="14.00">Layer 8</text>
<text text-anchor="middle" x="1958" y="-4935.54" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1958" y="-4920.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1958" y="-4905.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1958" y="-4890.54" font-family="Times,serif" font-size="14.00">TP=8 across GPUs 8&#45;15</text>
</g>
<!-- layer_7_residual&#45;&gt;layer_8_mha -->
<g id="edge161" class="edge">
<title>layer_7_residual&#45;&gt;layer_8_mha</title>
<path fill="none" stroke="black" d="M1955.65,-5067.65C1955.38,-5061.65 1955.15,-5055.53 1955,-5049.74 1954.38,-5025.47 1954.88,-4998.53 1955.64,-4975.94"/>
<polygon fill="black" stroke="black" points="1959.14,-4976.01 1956,-4965.89 1952.14,-4975.76 1959.14,-4976.01"/>
</g>
<!-- layer_7_residual&#45;&gt;layer_8_mha -->
<g id="edge322" class="edge">
<title>layer_7_residual&#45;&gt;layer_8_mha</title>
<path fill="none" stroke="black" d="M1958,-5067.63C1958,-5040.62 1958,-5004.93 1958,-4976.05"/>
<polygon fill="black" stroke="black" points="1961.5,-4975.74 1958,-4965.74 1954.5,-4975.74 1961.5,-4975.74"/>
<text text-anchor="middle" x="2045" y="-5038.54" font-family="Times,serif" font-size="14.00">Pipeline stage boundary</text>
<text text-anchor="middle" x="2045" y="-5023.54" font-family="Times,serif" font-size="14.00">GPU 7  GPU 8</text>
</g>
<!-- layer_8_gate -->
<g id="node99" class="node">
<title>layer_8_gate</title>
<polygon fill="lightblue" stroke="black" points="1357.5,-4845.74 1158.5,-4845.74 1158.5,-4762.74 1357.5,-4762.74 1357.5,-4845.74"/>
<text text-anchor="middle" x="1258" y="-4830.54" font-family="Times,serif" font-size="14.00">Layer 8</text>
<text text-anchor="middle" x="1258" y="-4815.54" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1258" y="-4800.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1258" y="-4785.54" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="1258" y="-4770.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_8_mha&#45;&gt;layer_8_gate -->
<g id="edge162" class="edge">
<title>layer_8_mha&#45;&gt;layer_8_gate</title>
<path fill="none" stroke="black" d="M1856.21,-4906.08C1726,-4884.13 1501.35,-4846.26 1367.52,-4823.7"/>
<polygon fill="black" stroke="black" points="1368.09,-4820.25 1357.64,-4822.04 1366.92,-4827.15 1368.09,-4820.25"/>
</g>
<!-- layer_8_residual -->
<g id="node109" class="node">
<title>layer_8_residual</title>
<polygon fill="lightblue" stroke="black" points="2091,-4471.74 1763,-4471.74 1763,-4388.74 2091,-4388.74 2091,-4471.74"/>
<text text-anchor="middle" x="1927" y="-4456.54" font-family="Times,serif" font-size="14.00">Layer 8</text>
<text text-anchor="middle" x="1927" y="-4441.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="1927" y="-4426.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-4411.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-4396.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_8_mha&#45;&gt;layer_8_residual -->
<g id="edge179" class="edge">
<title>layer_8_mha&#45;&gt;layer_8_residual</title>
<path fill="none" stroke="black" d="M2059.57,-4903.27C2146.6,-4883.16 2258,-4848.89 2258,-4805.24 2258,-4805.24 2258,-4805.24 2258,-4549.24 2258,-4511.5 2180.69,-4482.68 2100.8,-4462.97"/>
<polygon fill="black" stroke="black" points="2101.59,-4459.56 2091.05,-4460.61 2099.94,-4466.36 2101.59,-4459.56"/>
<text text-anchor="middle" x="2286" y="-4666.54" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_8_expert_0 -->
<g id="node100" class="node">
<title>layer_8_expert_0</title>
<polygon fill="lightblue" stroke="black" points="276,-4711.74 16,-4711.74 16,-4628.74 276,-4628.74 276,-4711.74"/>
<text text-anchor="middle" x="146" y="-4696.54" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="146" y="-4681.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="146" y="-4666.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="146" y="-4651.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="146" y="-4636.54" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_8_gate&#45;&gt;layer_8_expert_0 -->
<g id="edge163" class="edge">
<title>layer_8_gate&#45;&gt;layer_8_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.19,-4801.04C982.57,-4795.6 607.29,-4776.94 286.03,-4711.86"/>
<polygon fill="black" stroke="black" points="286.56,-4708.4 276.06,-4709.82 285.16,-4715.25 286.56,-4708.4"/>
<text text-anchor="middle" x="519" y="-4733.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_8_expert_1 -->
<g id="node101" class="node">
<title>layer_8_expert_1</title>
<polygon fill="lightblue" stroke="black" points="554,-4711.74 294,-4711.74 294,-4628.74 554,-4628.74 554,-4711.74"/>
<text text-anchor="middle" x="424" y="-4696.54" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="424" y="-4681.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="424" y="-4666.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="424" y="-4651.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="424" y="-4636.54" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_8_gate&#45;&gt;layer_8_expert_1 -->
<g id="edge164" class="edge">
<title>layer_8_gate&#45;&gt;layer_8_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.22,-4794.93C1024.56,-4782.72 780.15,-4756.61 564.01,-4711.87"/>
<polygon fill="black" stroke="black" points="564.57,-4708.41 554.07,-4709.79 563.14,-4715.26 564.57,-4708.41"/>
<text text-anchor="middle" x="783" y="-4733.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_8_expert_2 -->
<g id="node102" class="node">
<title>layer_8_expert_2</title>
<polygon fill="lightblue" stroke="black" points="832,-4711.74 572,-4711.74 572,-4628.74 832,-4628.74 832,-4711.74"/>
<text text-anchor="middle" x="702" y="-4696.54" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="702" y="-4681.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="702" y="-4666.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="702" y="-4651.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="702" y="-4636.54" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_8_gate&#45;&gt;layer_8_expert_2 -->
<g id="edge165" class="edge">
<title>layer_8_gate&#45;&gt;layer_8_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.13,-4783.3C1075.78,-4766.4 955.76,-4740.72 842.07,-4711.97"/>
<polygon fill="black" stroke="black" points="842.7,-4708.52 832.15,-4709.45 840.98,-4715.3 842.7,-4708.52"/>
<text text-anchor="middle" x="1027" y="-4733.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_8_expert_3 -->
<g id="node103" class="node">
<title>layer_8_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1110,-4711.74 850,-4711.74 850,-4628.74 1110,-4628.74 1110,-4711.74"/>
<text text-anchor="middle" x="980" y="-4696.54" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="980" y="-4681.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="980" y="-4666.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="980" y="-4651.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="980" y="-4636.54" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_8_gate&#45;&gt;layer_8_expert_3 -->
<g id="edge166" class="edge">
<title>layer_8_gate&#45;&gt;layer_8_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1172.7,-4762.74C1141.76,-4748.05 1106.62,-4731.36 1074.9,-4716.3"/>
<polygon fill="black" stroke="black" points="1076.15,-4713.02 1065.62,-4711.89 1073.15,-4719.34 1076.15,-4713.02"/>
<text text-anchor="middle" x="1177" y="-4733.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_8_expert_4 -->
<g id="node104" class="node">
<title>layer_8_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1388,-4711.74 1128,-4711.74 1128,-4628.74 1388,-4628.74 1388,-4711.74"/>
<text text-anchor="middle" x="1258" y="-4696.54" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1258" y="-4681.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1258" y="-4666.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-4651.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-4636.54" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_8_gate&#45;&gt;layer_8_expert_4 -->
<g id="edge167" class="edge">
<title>layer_8_gate&#45;&gt;layer_8_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1258,-4762.56C1258,-4749.76 1258,-4735.47 1258,-4722.06"/>
<polygon fill="black" stroke="black" points="1261.5,-4722.01 1258,-4712.01 1254.5,-4722.01 1261.5,-4722.01"/>
<text text-anchor="middle" x="1308" y="-4733.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_8_expert_5 -->
<g id="node105" class="node">
<title>layer_8_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1666,-4711.74 1406,-4711.74 1406,-4628.74 1666,-4628.74 1666,-4711.74"/>
<text text-anchor="middle" x="1536" y="-4696.54" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1536" y="-4681.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1536" y="-4666.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1536" y="-4651.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1536" y="-4636.54" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_8_gate&#45;&gt;layer_8_expert_5 -->
<g id="edge168" class="edge">
<title>layer_8_gate&#45;&gt;layer_8_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1343.3,-4762.74C1374.24,-4748.05 1409.38,-4731.36 1441.1,-4716.3"/>
<polygon fill="black" stroke="black" points="1442.85,-4719.34 1450.38,-4711.89 1439.85,-4713.02 1442.85,-4719.34"/>
<text text-anchor="middle" x="1455" y="-4733.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_8_expert_6 -->
<g id="node106" class="node">
<title>layer_8_expert_6</title>
<polygon fill="lightblue" stroke="black" points="1944,-4711.74 1684,-4711.74 1684,-4628.74 1944,-4628.74 1944,-4711.74"/>
<text text-anchor="middle" x="1814" y="-4696.54" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1814" y="-4681.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1814" y="-4666.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1814" y="-4651.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1814" y="-4636.54" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_8_gate&#45;&gt;layer_8_expert_6 -->
<g id="edge169" class="edge">
<title>layer_8_gate&#45;&gt;layer_8_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1357.87,-4783.3C1440.22,-4766.4 1560.24,-4740.72 1673.93,-4711.97"/>
<polygon fill="black" stroke="black" points="1675.02,-4715.3 1683.85,-4709.45 1673.3,-4708.52 1675.02,-4715.3"/>
<text text-anchor="middle" x="1645" y="-4733.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_8_expert_7 -->
<g id="node107" class="node">
<title>layer_8_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2222,-4711.74 1962,-4711.74 1962,-4628.74 2222,-4628.74 2222,-4711.74"/>
<text text-anchor="middle" x="2092" y="-4696.54" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2092" y="-4681.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2092" y="-4666.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2092" y="-4651.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2092" y="-4636.54" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_8_gate&#45;&gt;layer_8_expert_7 -->
<g id="edge170" class="edge">
<title>layer_8_gate&#45;&gt;layer_8_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1357.78,-4794.93C1491.44,-4782.72 1735.85,-4756.61 1951.99,-4711.87"/>
<polygon fill="black" stroke="black" points="1952.86,-4715.26 1961.93,-4709.79 1951.43,-4708.41 1952.86,-4715.26"/>
<text text-anchor="middle" x="1909" y="-4733.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_8_expert_agg -->
<g id="node108" class="node">
<title>layer_8_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="1382,-4591.74 1134,-4591.74 1134,-4508.74 1382,-4508.74 1382,-4591.74"/>
<text text-anchor="middle" x="1258" y="-4576.54" font-family="Times,serif" font-size="14.00">Layer 8</text>
<text text-anchor="middle" x="1258" y="-4561.54" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1258" y="-4546.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-4531.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1258" y="-4516.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_8_expert_0&#45;&gt;layer_8_expert_agg -->
<g id="edge171" class="edge">
<title>layer_8_expert_0&#45;&gt;layer_8_expert_agg</title>
<path fill="none" stroke="black" d="M276.03,-4630.48C279.04,-4629.87 282.03,-4629.28 285,-4628.74 581.03,-4574.41 934.63,-4558.17 1123.44,-4553.31"/>
<polygon fill="black" stroke="black" points="1123.78,-4556.8 1133.69,-4553.05 1123.6,-4549.8 1123.78,-4556.8"/>
</g>
<!-- layer_8_expert_1&#45;&gt;layer_8_expert_agg -->
<g id="edge172" class="edge">
<title>layer_8_expert_1&#45;&gt;layer_8_expert_agg</title>
<path fill="none" stroke="black" d="M554.05,-4630.61C557.06,-4629.96 560.04,-4629.33 563,-4628.74 756,-4590.16 983.26,-4569.37 1124,-4559.3"/>
<polygon fill="black" stroke="black" points="1124.25,-4562.79 1133.98,-4558.59 1123.76,-4555.81 1124.25,-4562.79"/>
</g>
<!-- layer_8_expert_2&#45;&gt;layer_8_expert_agg -->
<g id="edge173" class="edge">
<title>layer_8_expert_2&#45;&gt;layer_8_expert_agg</title>
<path fill="none" stroke="black" d="M832.12,-4630.9C835.1,-4630.16 838.07,-4629.44 841,-4628.74 934.79,-4606.42 1041.72,-4586.66 1123.81,-4572.68"/>
<polygon fill="black" stroke="black" points="1124.43,-4576.12 1133.7,-4571 1123.26,-4569.22 1124.43,-4576.12"/>
</g>
<!-- layer_8_expert_3&#45;&gt;layer_8_expert_agg -->
<g id="edge174" class="edge">
<title>layer_8_expert_3&#45;&gt;layer_8_expert_agg</title>
<path fill="none" stroke="black" d="M1075.67,-4628.63C1100.57,-4618.06 1127.53,-4606.62 1152.89,-4595.86"/>
<polygon fill="black" stroke="black" points="1154.31,-4599.05 1162.15,-4591.92 1151.58,-4592.61 1154.31,-4599.05"/>
</g>
<!-- layer_8_expert_4&#45;&gt;layer_8_expert_agg -->
<g id="edge175" class="edge">
<title>layer_8_expert_4&#45;&gt;layer_8_expert_agg</title>
<path fill="none" stroke="black" d="M1258,-4628.63C1258,-4620.1 1258,-4611 1258,-4602.15"/>
<polygon fill="black" stroke="black" points="1261.5,-4601.92 1258,-4591.92 1254.5,-4601.92 1261.5,-4601.92"/>
</g>
<!-- layer_8_expert_5&#45;&gt;layer_8_expert_agg -->
<g id="edge176" class="edge">
<title>layer_8_expert_5&#45;&gt;layer_8_expert_agg</title>
<path fill="none" stroke="black" d="M1440.33,-4628.63C1415.43,-4618.06 1388.47,-4606.62 1363.11,-4595.86"/>
<polygon fill="black" stroke="black" points="1364.42,-4592.61 1353.85,-4591.92 1361.69,-4599.05 1364.42,-4592.61"/>
</g>
<!-- layer_8_expert_6&#45;&gt;layer_8_expert_agg -->
<g id="edge177" class="edge">
<title>layer_8_expert_6&#45;&gt;layer_8_expert_agg</title>
<path fill="none" stroke="black" d="M1683.88,-4630.9C1680.9,-4630.16 1677.93,-4629.44 1675,-4628.74 1581.21,-4606.42 1474.28,-4586.66 1392.19,-4572.68"/>
<polygon fill="black" stroke="black" points="1392.74,-4569.22 1382.3,-4571 1391.57,-4576.12 1392.74,-4569.22"/>
</g>
<!-- layer_8_expert_7&#45;&gt;layer_8_expert_agg -->
<g id="edge178" class="edge">
<title>layer_8_expert_7&#45;&gt;layer_8_expert_agg</title>
<path fill="none" stroke="black" d="M1961.95,-4630.61C1958.94,-4629.96 1955.96,-4629.33 1953,-4628.74 1760,-4590.16 1532.74,-4569.37 1392,-4559.3"/>
<polygon fill="black" stroke="black" points="1392.24,-4555.81 1382.02,-4558.59 1391.75,-4562.79 1392.24,-4555.81"/>
</g>
<!-- layer_8_expert_agg&#45;&gt;layer_8_residual -->
<g id="edge180" class="edge">
<title>layer_8_expert_agg&#45;&gt;layer_8_residual</title>
<path fill="none" stroke="black" d="M1382.27,-4527.32C1486.54,-4508.93 1636.66,-4482.45 1752.91,-4461.95"/>
<polygon fill="black" stroke="black" points="1753.74,-4465.35 1762.98,-4460.17 1752.53,-4458.46 1753.74,-4465.35"/>
</g>
<!-- layer_9_mha -->
<g id="node110" class="node">
<title>layer_9_mha</title>
<polygon fill="lightblue" stroke="black" points="2028.5,-4351.74 1825.5,-4351.74 1825.5,-4268.74 2028.5,-4268.74 2028.5,-4351.74"/>
<text text-anchor="middle" x="1927" y="-4336.54" font-family="Times,serif" font-size="14.00">Layer 9</text>
<text text-anchor="middle" x="1927" y="-4321.54" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1927" y="-4306.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-4291.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-4276.54" font-family="Times,serif" font-size="14.00">TP=8 across GPUs 8&#45;15</text>
</g>
<!-- layer_8_residual&#45;&gt;layer_9_mha -->
<g id="edge181" class="edge">
<title>layer_8_residual&#45;&gt;layer_9_mha</title>
<path fill="none" stroke="black" d="M1927,-4388.63C1927,-4380.1 1927,-4371 1927,-4362.15"/>
<polygon fill="black" stroke="black" points="1930.5,-4361.92 1927,-4351.92 1923.5,-4361.92 1930.5,-4361.92"/>
</g>
<!-- layer_9_gate -->
<g id="node111" class="node">
<title>layer_9_gate</title>
<polygon fill="lightblue" stroke="black" points="1357.5,-4231.74 1158.5,-4231.74 1158.5,-4148.74 1357.5,-4148.74 1357.5,-4231.74"/>
<text text-anchor="middle" x="1258" y="-4216.54" font-family="Times,serif" font-size="14.00">Layer 9</text>
<text text-anchor="middle" x="1258" y="-4201.54" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1258" y="-4186.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1258" y="-4171.54" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="1258" y="-4156.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_9_mha&#45;&gt;layer_9_gate -->
<g id="edge182" class="edge">
<title>layer_9_mha&#45;&gt;layer_9_gate</title>
<path fill="none" stroke="black" d="M1825.39,-4291.32C1701.99,-4269.55 1494.63,-4232.98 1367.69,-4210.59"/>
<polygon fill="black" stroke="black" points="1368.01,-4207.09 1357.55,-4208.8 1366.79,-4213.98 1368.01,-4207.09"/>
</g>
<!-- layer_9_residual -->
<g id="node121" class="node">
<title>layer_9_residual</title>
<polygon fill="lightblue" stroke="black" points="2091,-3857.74 1763,-3857.74 1763,-3774.74 2091,-3774.74 2091,-3857.74"/>
<text text-anchor="middle" x="1927" y="-3842.54" font-family="Times,serif" font-size="14.00">Layer 9</text>
<text text-anchor="middle" x="1927" y="-3827.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="1927" y="-3812.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-3797.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-3782.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_9_mha&#45;&gt;layer_9_residual -->
<g id="edge199" class="edge">
<title>layer_9_mha&#45;&gt;layer_9_residual</title>
<path fill="none" stroke="black" d="M2028.56,-4293.1C2125.86,-4274.68 2258,-4240.58 2258,-4191.24 2258,-4191.24 2258,-4191.24 2258,-3935.24 2258,-3897.5 2180.69,-3868.68 2100.8,-3848.97"/>
<polygon fill="black" stroke="black" points="2101.59,-3845.56 2091.05,-3846.61 2099.94,-3852.36 2101.59,-3845.56"/>
<text text-anchor="middle" x="2286" y="-4052.54" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_9_expert_0 -->
<g id="node112" class="node">
<title>layer_9_expert_0</title>
<polygon fill="lightblue" stroke="black" points="276,-4097.74 16,-4097.74 16,-4014.74 276,-4014.74 276,-4097.74"/>
<text text-anchor="middle" x="146" y="-4082.54" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="146" y="-4067.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="146" y="-4052.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="146" y="-4037.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="146" y="-4022.54" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_9_gate&#45;&gt;layer_9_expert_0 -->
<g id="edge183" class="edge">
<title>layer_9_gate&#45;&gt;layer_9_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.19,-4187.04C982.57,-4181.6 607.29,-4162.94 286.03,-4097.86"/>
<polygon fill="black" stroke="black" points="286.56,-4094.4 276.06,-4095.82 285.16,-4101.25 286.56,-4094.4"/>
<text text-anchor="middle" x="519" y="-4119.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_9_expert_1 -->
<g id="node113" class="node">
<title>layer_9_expert_1</title>
<polygon fill="lightblue" stroke="black" points="554,-4097.74 294,-4097.74 294,-4014.74 554,-4014.74 554,-4097.74"/>
<text text-anchor="middle" x="424" y="-4082.54" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="424" y="-4067.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="424" y="-4052.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="424" y="-4037.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="424" y="-4022.54" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_9_gate&#45;&gt;layer_9_expert_1 -->
<g id="edge184" class="edge">
<title>layer_9_gate&#45;&gt;layer_9_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.22,-4180.93C1024.56,-4168.72 780.15,-4142.61 564.01,-4097.87"/>
<polygon fill="black" stroke="black" points="564.57,-4094.41 554.07,-4095.79 563.14,-4101.26 564.57,-4094.41"/>
<text text-anchor="middle" x="783" y="-4119.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_9_expert_2 -->
<g id="node114" class="node">
<title>layer_9_expert_2</title>
<polygon fill="lightblue" stroke="black" points="832,-4097.74 572,-4097.74 572,-4014.74 832,-4014.74 832,-4097.74"/>
<text text-anchor="middle" x="702" y="-4082.54" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="702" y="-4067.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="702" y="-4052.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="702" y="-4037.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="702" y="-4022.54" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_9_gate&#45;&gt;layer_9_expert_2 -->
<g id="edge185" class="edge">
<title>layer_9_gate&#45;&gt;layer_9_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.13,-4169.3C1075.78,-4152.4 955.76,-4126.72 842.07,-4097.97"/>
<polygon fill="black" stroke="black" points="842.7,-4094.52 832.15,-4095.45 840.98,-4101.3 842.7,-4094.52"/>
<text text-anchor="middle" x="1027" y="-4119.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_9_expert_3 -->
<g id="node115" class="node">
<title>layer_9_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1110,-4097.74 850,-4097.74 850,-4014.74 1110,-4014.74 1110,-4097.74"/>
<text text-anchor="middle" x="980" y="-4082.54" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="980" y="-4067.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="980" y="-4052.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="980" y="-4037.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="980" y="-4022.54" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_9_gate&#45;&gt;layer_9_expert_3 -->
<g id="edge186" class="edge">
<title>layer_9_gate&#45;&gt;layer_9_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1172.7,-4148.74C1141.76,-4134.05 1106.62,-4117.36 1074.9,-4102.3"/>
<polygon fill="black" stroke="black" points="1076.15,-4099.02 1065.62,-4097.89 1073.15,-4105.34 1076.15,-4099.02"/>
<text text-anchor="middle" x="1177" y="-4119.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_9_expert_4 -->
<g id="node116" class="node">
<title>layer_9_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1388,-4097.74 1128,-4097.74 1128,-4014.74 1388,-4014.74 1388,-4097.74"/>
<text text-anchor="middle" x="1258" y="-4082.54" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1258" y="-4067.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1258" y="-4052.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-4037.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-4022.54" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_9_gate&#45;&gt;layer_9_expert_4 -->
<g id="edge187" class="edge">
<title>layer_9_gate&#45;&gt;layer_9_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1258,-4148.56C1258,-4135.76 1258,-4121.47 1258,-4108.06"/>
<polygon fill="black" stroke="black" points="1261.5,-4108.01 1258,-4098.01 1254.5,-4108.01 1261.5,-4108.01"/>
<text text-anchor="middle" x="1308" y="-4119.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_9_expert_5 -->
<g id="node117" class="node">
<title>layer_9_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1666,-4097.74 1406,-4097.74 1406,-4014.74 1666,-4014.74 1666,-4097.74"/>
<text text-anchor="middle" x="1536" y="-4082.54" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1536" y="-4067.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1536" y="-4052.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1536" y="-4037.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1536" y="-4022.54" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_9_gate&#45;&gt;layer_9_expert_5 -->
<g id="edge188" class="edge">
<title>layer_9_gate&#45;&gt;layer_9_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1343.3,-4148.74C1374.24,-4134.05 1409.38,-4117.36 1441.1,-4102.3"/>
<polygon fill="black" stroke="black" points="1442.85,-4105.34 1450.38,-4097.89 1439.85,-4099.02 1442.85,-4105.34"/>
<text text-anchor="middle" x="1455" y="-4119.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_9_expert_6 -->
<g id="node118" class="node">
<title>layer_9_expert_6</title>
<polygon fill="lightblue" stroke="black" points="1944,-4097.74 1684,-4097.74 1684,-4014.74 1944,-4014.74 1944,-4097.74"/>
<text text-anchor="middle" x="1814" y="-4082.54" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1814" y="-4067.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1814" y="-4052.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1814" y="-4037.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1814" y="-4022.54" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_9_gate&#45;&gt;layer_9_expert_6 -->
<g id="edge189" class="edge">
<title>layer_9_gate&#45;&gt;layer_9_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1357.87,-4169.3C1440.22,-4152.4 1560.24,-4126.72 1673.93,-4097.97"/>
<polygon fill="black" stroke="black" points="1675.02,-4101.3 1683.85,-4095.45 1673.3,-4094.52 1675.02,-4101.3"/>
<text text-anchor="middle" x="1645" y="-4119.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_9_expert_7 -->
<g id="node119" class="node">
<title>layer_9_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2222,-4097.74 1962,-4097.74 1962,-4014.74 2222,-4014.74 2222,-4097.74"/>
<text text-anchor="middle" x="2092" y="-4082.54" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2092" y="-4067.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2092" y="-4052.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2092" y="-4037.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2092" y="-4022.54" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_9_gate&#45;&gt;layer_9_expert_7 -->
<g id="edge190" class="edge">
<title>layer_9_gate&#45;&gt;layer_9_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1357.78,-4180.93C1491.44,-4168.72 1735.85,-4142.61 1951.99,-4097.87"/>
<polygon fill="black" stroke="black" points="1952.86,-4101.26 1961.93,-4095.79 1951.43,-4094.41 1952.86,-4101.26"/>
<text text-anchor="middle" x="1909" y="-4119.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_9_expert_agg -->
<g id="node120" class="node">
<title>layer_9_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="1382,-3977.74 1134,-3977.74 1134,-3894.74 1382,-3894.74 1382,-3977.74"/>
<text text-anchor="middle" x="1258" y="-3962.54" font-family="Times,serif" font-size="14.00">Layer 9</text>
<text text-anchor="middle" x="1258" y="-3947.54" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1258" y="-3932.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-3917.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1258" y="-3902.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_9_expert_0&#45;&gt;layer_9_expert_agg -->
<g id="edge191" class="edge">
<title>layer_9_expert_0&#45;&gt;layer_9_expert_agg</title>
<path fill="none" stroke="black" d="M276.03,-4016.48C279.04,-4015.87 282.03,-4015.28 285,-4014.74 581.03,-3960.41 934.63,-3944.17 1123.44,-3939.31"/>
<polygon fill="black" stroke="black" points="1123.78,-3942.8 1133.69,-3939.05 1123.6,-3935.8 1123.78,-3942.8"/>
</g>
<!-- layer_9_expert_1&#45;&gt;layer_9_expert_agg -->
<g id="edge192" class="edge">
<title>layer_9_expert_1&#45;&gt;layer_9_expert_agg</title>
<path fill="none" stroke="black" d="M554.05,-4016.61C557.06,-4015.96 560.04,-4015.33 563,-4014.74 756,-3976.16 983.26,-3955.37 1124,-3945.3"/>
<polygon fill="black" stroke="black" points="1124.25,-3948.79 1133.98,-3944.59 1123.76,-3941.81 1124.25,-3948.79"/>
</g>
<!-- layer_9_expert_2&#45;&gt;layer_9_expert_agg -->
<g id="edge193" class="edge">
<title>layer_9_expert_2&#45;&gt;layer_9_expert_agg</title>
<path fill="none" stroke="black" d="M832.12,-4016.9C835.1,-4016.16 838.07,-4015.44 841,-4014.74 934.79,-3992.42 1041.72,-3972.66 1123.81,-3958.68"/>
<polygon fill="black" stroke="black" points="1124.43,-3962.12 1133.7,-3957 1123.26,-3955.22 1124.43,-3962.12"/>
</g>
<!-- layer_9_expert_3&#45;&gt;layer_9_expert_agg -->
<g id="edge194" class="edge">
<title>layer_9_expert_3&#45;&gt;layer_9_expert_agg</title>
<path fill="none" stroke="black" d="M1075.67,-4014.63C1100.57,-4004.06 1127.53,-3992.62 1152.89,-3981.86"/>
<polygon fill="black" stroke="black" points="1154.31,-3985.05 1162.15,-3977.92 1151.58,-3978.61 1154.31,-3985.05"/>
</g>
<!-- layer_9_expert_4&#45;&gt;layer_9_expert_agg -->
<g id="edge195" class="edge">
<title>layer_9_expert_4&#45;&gt;layer_9_expert_agg</title>
<path fill="none" stroke="black" d="M1258,-4014.63C1258,-4006.1 1258,-3997 1258,-3988.15"/>
<polygon fill="black" stroke="black" points="1261.5,-3987.92 1258,-3977.92 1254.5,-3987.92 1261.5,-3987.92"/>
</g>
<!-- layer_9_expert_5&#45;&gt;layer_9_expert_agg -->
<g id="edge196" class="edge">
<title>layer_9_expert_5&#45;&gt;layer_9_expert_agg</title>
<path fill="none" stroke="black" d="M1440.33,-4014.63C1415.43,-4004.06 1388.47,-3992.62 1363.11,-3981.86"/>
<polygon fill="black" stroke="black" points="1364.42,-3978.61 1353.85,-3977.92 1361.69,-3985.05 1364.42,-3978.61"/>
</g>
<!-- layer_9_expert_6&#45;&gt;layer_9_expert_agg -->
<g id="edge197" class="edge">
<title>layer_9_expert_6&#45;&gt;layer_9_expert_agg</title>
<path fill="none" stroke="black" d="M1683.88,-4016.9C1680.9,-4016.16 1677.93,-4015.44 1675,-4014.74 1581.21,-3992.42 1474.28,-3972.66 1392.19,-3958.68"/>
<polygon fill="black" stroke="black" points="1392.74,-3955.22 1382.3,-3957 1391.57,-3962.12 1392.74,-3955.22"/>
</g>
<!-- layer_9_expert_7&#45;&gt;layer_9_expert_agg -->
<g id="edge198" class="edge">
<title>layer_9_expert_7&#45;&gt;layer_9_expert_agg</title>
<path fill="none" stroke="black" d="M1961.95,-4016.61C1958.94,-4015.96 1955.96,-4015.33 1953,-4014.74 1760,-3976.16 1532.74,-3955.37 1392,-3945.3"/>
<polygon fill="black" stroke="black" points="1392.24,-3941.81 1382.02,-3944.59 1391.75,-3948.79 1392.24,-3941.81"/>
</g>
<!-- layer_9_expert_agg&#45;&gt;layer_9_residual -->
<g id="edge200" class="edge">
<title>layer_9_expert_agg&#45;&gt;layer_9_residual</title>
<path fill="none" stroke="black" d="M1382.27,-3913.32C1486.54,-3894.93 1636.66,-3868.45 1752.91,-3847.95"/>
<polygon fill="black" stroke="black" points="1753.74,-3851.35 1762.98,-3846.17 1752.53,-3844.46 1753.74,-3851.35"/>
</g>
<!-- layer_10_mha -->
<g id="node122" class="node">
<title>layer_10_mha</title>
<polygon fill="lightblue" stroke="black" points="2028.5,-3737.74 1825.5,-3737.74 1825.5,-3654.74 2028.5,-3654.74 2028.5,-3737.74"/>
<text text-anchor="middle" x="1927" y="-3722.54" font-family="Times,serif" font-size="14.00">Layer 10</text>
<text text-anchor="middle" x="1927" y="-3707.54" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1927" y="-3692.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-3677.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-3662.54" font-family="Times,serif" font-size="14.00">TP=8 across GPUs 8&#45;15</text>
</g>
<!-- layer_9_residual&#45;&gt;layer_10_mha -->
<g id="edge201" class="edge">
<title>layer_9_residual&#45;&gt;layer_10_mha</title>
<path fill="none" stroke="black" d="M1927,-3774.63C1927,-3766.1 1927,-3757 1927,-3748.15"/>
<polygon fill="black" stroke="black" points="1930.5,-3747.92 1927,-3737.92 1923.5,-3747.92 1930.5,-3747.92"/>
</g>
<!-- layer_10_gate -->
<g id="node123" class="node">
<title>layer_10_gate</title>
<polygon fill="lightblue" stroke="black" points="1357.5,-3617.74 1158.5,-3617.74 1158.5,-3534.74 1357.5,-3534.74 1357.5,-3617.74"/>
<text text-anchor="middle" x="1258" y="-3602.54" font-family="Times,serif" font-size="14.00">Layer 10</text>
<text text-anchor="middle" x="1258" y="-3587.54" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1258" y="-3572.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1258" y="-3557.54" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="1258" y="-3542.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_10_mha&#45;&gt;layer_10_gate -->
<g id="edge202" class="edge">
<title>layer_10_mha&#45;&gt;layer_10_gate</title>
<path fill="none" stroke="black" d="M1825.39,-3677.32C1701.99,-3655.55 1494.63,-3618.98 1367.69,-3596.59"/>
<polygon fill="black" stroke="black" points="1368.01,-3593.09 1357.55,-3594.8 1366.79,-3599.98 1368.01,-3593.09"/>
</g>
<!-- layer_10_residual -->
<g id="node133" class="node">
<title>layer_10_residual</title>
<polygon fill="lightblue" stroke="black" points="2091,-3243.74 1763,-3243.74 1763,-3160.74 2091,-3160.74 2091,-3243.74"/>
<text text-anchor="middle" x="1927" y="-3228.54" font-family="Times,serif" font-size="14.00">Layer 10</text>
<text text-anchor="middle" x="1927" y="-3213.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="1927" y="-3198.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-3183.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-3168.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_10_mha&#45;&gt;layer_10_residual -->
<g id="edge219" class="edge">
<title>layer_10_mha&#45;&gt;layer_10_residual</title>
<path fill="none" stroke="black" d="M2028.56,-3679.1C2125.86,-3660.68 2258,-3626.58 2258,-3577.24 2258,-3577.24 2258,-3577.24 2258,-3321.24 2258,-3283.5 2180.69,-3254.68 2100.8,-3234.97"/>
<polygon fill="black" stroke="black" points="2101.59,-3231.56 2091.05,-3232.61 2099.94,-3238.36 2101.59,-3231.56"/>
<text text-anchor="middle" x="2286" y="-3438.54" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_10_expert_0 -->
<g id="node124" class="node">
<title>layer_10_expert_0</title>
<polygon fill="lightblue" stroke="black" points="276,-3483.74 16,-3483.74 16,-3400.74 276,-3400.74 276,-3483.74"/>
<text text-anchor="middle" x="146" y="-3468.54" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="146" y="-3453.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="146" y="-3438.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="146" y="-3423.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="146" y="-3408.54" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_10_gate&#45;&gt;layer_10_expert_0 -->
<g id="edge203" class="edge">
<title>layer_10_gate&#45;&gt;layer_10_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.19,-3573.04C982.57,-3567.6 607.29,-3548.94 286.03,-3483.86"/>
<polygon fill="black" stroke="black" points="286.56,-3480.4 276.06,-3481.82 285.16,-3487.25 286.56,-3480.4"/>
<text text-anchor="middle" x="519" y="-3505.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_10_expert_1 -->
<g id="node125" class="node">
<title>layer_10_expert_1</title>
<polygon fill="lightblue" stroke="black" points="554,-3483.74 294,-3483.74 294,-3400.74 554,-3400.74 554,-3483.74"/>
<text text-anchor="middle" x="424" y="-3468.54" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="424" y="-3453.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="424" y="-3438.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="424" y="-3423.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="424" y="-3408.54" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_10_gate&#45;&gt;layer_10_expert_1 -->
<g id="edge204" class="edge">
<title>layer_10_gate&#45;&gt;layer_10_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.22,-3566.93C1024.56,-3554.72 780.15,-3528.61 564.01,-3483.87"/>
<polygon fill="black" stroke="black" points="564.57,-3480.41 554.07,-3481.79 563.14,-3487.26 564.57,-3480.41"/>
<text text-anchor="middle" x="783" y="-3505.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_10_expert_2 -->
<g id="node126" class="node">
<title>layer_10_expert_2</title>
<polygon fill="lightblue" stroke="black" points="832,-3483.74 572,-3483.74 572,-3400.74 832,-3400.74 832,-3483.74"/>
<text text-anchor="middle" x="702" y="-3468.54" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="702" y="-3453.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="702" y="-3438.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="702" y="-3423.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="702" y="-3408.54" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_10_gate&#45;&gt;layer_10_expert_2 -->
<g id="edge205" class="edge">
<title>layer_10_gate&#45;&gt;layer_10_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.13,-3555.3C1075.78,-3538.4 955.76,-3512.72 842.07,-3483.97"/>
<polygon fill="black" stroke="black" points="842.7,-3480.52 832.15,-3481.45 840.98,-3487.3 842.7,-3480.52"/>
<text text-anchor="middle" x="1027" y="-3505.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_10_expert_3 -->
<g id="node127" class="node">
<title>layer_10_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1110,-3483.74 850,-3483.74 850,-3400.74 1110,-3400.74 1110,-3483.74"/>
<text text-anchor="middle" x="980" y="-3468.54" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="980" y="-3453.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="980" y="-3438.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="980" y="-3423.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="980" y="-3408.54" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_10_gate&#45;&gt;layer_10_expert_3 -->
<g id="edge206" class="edge">
<title>layer_10_gate&#45;&gt;layer_10_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1172.7,-3534.74C1141.76,-3520.05 1106.62,-3503.36 1074.9,-3488.3"/>
<polygon fill="black" stroke="black" points="1076.15,-3485.02 1065.62,-3483.89 1073.15,-3491.34 1076.15,-3485.02"/>
<text text-anchor="middle" x="1177" y="-3505.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_10_expert_4 -->
<g id="node128" class="node">
<title>layer_10_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1388,-3483.74 1128,-3483.74 1128,-3400.74 1388,-3400.74 1388,-3483.74"/>
<text text-anchor="middle" x="1258" y="-3468.54" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1258" y="-3453.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1258" y="-3438.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-3423.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-3408.54" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_10_gate&#45;&gt;layer_10_expert_4 -->
<g id="edge207" class="edge">
<title>layer_10_gate&#45;&gt;layer_10_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1258,-3534.56C1258,-3521.76 1258,-3507.47 1258,-3494.06"/>
<polygon fill="black" stroke="black" points="1261.5,-3494.01 1258,-3484.01 1254.5,-3494.01 1261.5,-3494.01"/>
<text text-anchor="middle" x="1308" y="-3505.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_10_expert_5 -->
<g id="node129" class="node">
<title>layer_10_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1666,-3483.74 1406,-3483.74 1406,-3400.74 1666,-3400.74 1666,-3483.74"/>
<text text-anchor="middle" x="1536" y="-3468.54" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1536" y="-3453.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1536" y="-3438.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1536" y="-3423.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1536" y="-3408.54" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_10_gate&#45;&gt;layer_10_expert_5 -->
<g id="edge208" class="edge">
<title>layer_10_gate&#45;&gt;layer_10_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1343.3,-3534.74C1374.24,-3520.05 1409.38,-3503.36 1441.1,-3488.3"/>
<polygon fill="black" stroke="black" points="1442.85,-3491.34 1450.38,-3483.89 1439.85,-3485.02 1442.85,-3491.34"/>
<text text-anchor="middle" x="1455" y="-3505.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_10_expert_6 -->
<g id="node130" class="node">
<title>layer_10_expert_6</title>
<polygon fill="lightblue" stroke="black" points="1944,-3483.74 1684,-3483.74 1684,-3400.74 1944,-3400.74 1944,-3483.74"/>
<text text-anchor="middle" x="1814" y="-3468.54" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1814" y="-3453.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1814" y="-3438.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1814" y="-3423.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1814" y="-3408.54" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_10_gate&#45;&gt;layer_10_expert_6 -->
<g id="edge209" class="edge">
<title>layer_10_gate&#45;&gt;layer_10_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1357.87,-3555.3C1440.22,-3538.4 1560.24,-3512.72 1673.93,-3483.97"/>
<polygon fill="black" stroke="black" points="1675.02,-3487.3 1683.85,-3481.45 1673.3,-3480.52 1675.02,-3487.3"/>
<text text-anchor="middle" x="1645" y="-3505.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_10_expert_7 -->
<g id="node131" class="node">
<title>layer_10_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2222,-3483.74 1962,-3483.74 1962,-3400.74 2222,-3400.74 2222,-3483.74"/>
<text text-anchor="middle" x="2092" y="-3468.54" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2092" y="-3453.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2092" y="-3438.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2092" y="-3423.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2092" y="-3408.54" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_10_gate&#45;&gt;layer_10_expert_7 -->
<g id="edge210" class="edge">
<title>layer_10_gate&#45;&gt;layer_10_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1357.78,-3566.93C1491.44,-3554.72 1735.85,-3528.61 1951.99,-3483.87"/>
<polygon fill="black" stroke="black" points="1952.86,-3487.26 1961.93,-3481.79 1951.43,-3480.41 1952.86,-3487.26"/>
<text text-anchor="middle" x="1909" y="-3505.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_10_expert_agg -->
<g id="node132" class="node">
<title>layer_10_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="1382,-3363.74 1134,-3363.74 1134,-3280.74 1382,-3280.74 1382,-3363.74"/>
<text text-anchor="middle" x="1258" y="-3348.54" font-family="Times,serif" font-size="14.00">Layer 10</text>
<text text-anchor="middle" x="1258" y="-3333.54" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1258" y="-3318.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-3303.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1258" y="-3288.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_10_expert_0&#45;&gt;layer_10_expert_agg -->
<g id="edge211" class="edge">
<title>layer_10_expert_0&#45;&gt;layer_10_expert_agg</title>
<path fill="none" stroke="black" d="M276.03,-3402.48C279.04,-3401.87 282.03,-3401.28 285,-3400.74 581.03,-3346.41 934.63,-3330.17 1123.44,-3325.31"/>
<polygon fill="black" stroke="black" points="1123.78,-3328.8 1133.69,-3325.05 1123.6,-3321.8 1123.78,-3328.8"/>
</g>
<!-- layer_10_expert_1&#45;&gt;layer_10_expert_agg -->
<g id="edge212" class="edge">
<title>layer_10_expert_1&#45;&gt;layer_10_expert_agg</title>
<path fill="none" stroke="black" d="M554.05,-3402.61C557.06,-3401.96 560.04,-3401.33 563,-3400.74 756,-3362.16 983.26,-3341.37 1124,-3331.3"/>
<polygon fill="black" stroke="black" points="1124.25,-3334.79 1133.98,-3330.59 1123.76,-3327.81 1124.25,-3334.79"/>
</g>
<!-- layer_10_expert_2&#45;&gt;layer_10_expert_agg -->
<g id="edge213" class="edge">
<title>layer_10_expert_2&#45;&gt;layer_10_expert_agg</title>
<path fill="none" stroke="black" d="M832.12,-3402.9C835.1,-3402.16 838.07,-3401.44 841,-3400.74 934.79,-3378.42 1041.72,-3358.66 1123.81,-3344.68"/>
<polygon fill="black" stroke="black" points="1124.43,-3348.12 1133.7,-3343 1123.26,-3341.22 1124.43,-3348.12"/>
</g>
<!-- layer_10_expert_3&#45;&gt;layer_10_expert_agg -->
<g id="edge214" class="edge">
<title>layer_10_expert_3&#45;&gt;layer_10_expert_agg</title>
<path fill="none" stroke="black" d="M1075.67,-3400.63C1100.57,-3390.06 1127.53,-3378.62 1152.89,-3367.86"/>
<polygon fill="black" stroke="black" points="1154.31,-3371.05 1162.15,-3363.92 1151.58,-3364.61 1154.31,-3371.05"/>
</g>
<!-- layer_10_expert_4&#45;&gt;layer_10_expert_agg -->
<g id="edge215" class="edge">
<title>layer_10_expert_4&#45;&gt;layer_10_expert_agg</title>
<path fill="none" stroke="black" d="M1258,-3400.63C1258,-3392.1 1258,-3383 1258,-3374.15"/>
<polygon fill="black" stroke="black" points="1261.5,-3373.92 1258,-3363.92 1254.5,-3373.92 1261.5,-3373.92"/>
</g>
<!-- layer_10_expert_5&#45;&gt;layer_10_expert_agg -->
<g id="edge216" class="edge">
<title>layer_10_expert_5&#45;&gt;layer_10_expert_agg</title>
<path fill="none" stroke="black" d="M1440.33,-3400.63C1415.43,-3390.06 1388.47,-3378.62 1363.11,-3367.86"/>
<polygon fill="black" stroke="black" points="1364.42,-3364.61 1353.85,-3363.92 1361.69,-3371.05 1364.42,-3364.61"/>
</g>
<!-- layer_10_expert_6&#45;&gt;layer_10_expert_agg -->
<g id="edge217" class="edge">
<title>layer_10_expert_6&#45;&gt;layer_10_expert_agg</title>
<path fill="none" stroke="black" d="M1683.88,-3402.9C1680.9,-3402.16 1677.93,-3401.44 1675,-3400.74 1581.21,-3378.42 1474.28,-3358.66 1392.19,-3344.68"/>
<polygon fill="black" stroke="black" points="1392.74,-3341.22 1382.3,-3343 1391.57,-3348.12 1392.74,-3341.22"/>
</g>
<!-- layer_10_expert_7&#45;&gt;layer_10_expert_agg -->
<g id="edge218" class="edge">
<title>layer_10_expert_7&#45;&gt;layer_10_expert_agg</title>
<path fill="none" stroke="black" d="M1961.95,-3402.61C1958.94,-3401.96 1955.96,-3401.33 1953,-3400.74 1760,-3362.16 1532.74,-3341.37 1392,-3331.3"/>
<polygon fill="black" stroke="black" points="1392.24,-3327.81 1382.02,-3330.59 1391.75,-3334.79 1392.24,-3327.81"/>
</g>
<!-- layer_10_expert_agg&#45;&gt;layer_10_residual -->
<g id="edge220" class="edge">
<title>layer_10_expert_agg&#45;&gt;layer_10_residual</title>
<path fill="none" stroke="black" d="M1382.27,-3299.32C1486.54,-3280.93 1636.66,-3254.45 1752.91,-3233.95"/>
<polygon fill="black" stroke="black" points="1753.74,-3237.35 1762.98,-3232.17 1752.53,-3230.46 1753.74,-3237.35"/>
</g>
<!-- layer_11_mha -->
<g id="node134" class="node">
<title>layer_11_mha</title>
<polygon fill="lightblue" stroke="black" points="2028.5,-3123.74 1825.5,-3123.74 1825.5,-3040.74 2028.5,-3040.74 2028.5,-3123.74"/>
<text text-anchor="middle" x="1927" y="-3108.54" font-family="Times,serif" font-size="14.00">Layer 11</text>
<text text-anchor="middle" x="1927" y="-3093.54" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1927" y="-3078.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-3063.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-3048.54" font-family="Times,serif" font-size="14.00">TP=8 across GPUs 8&#45;15</text>
</g>
<!-- layer_10_residual&#45;&gt;layer_11_mha -->
<g id="edge221" class="edge">
<title>layer_10_residual&#45;&gt;layer_11_mha</title>
<path fill="none" stroke="black" d="M1927,-3160.63C1927,-3152.1 1927,-3143 1927,-3134.15"/>
<polygon fill="black" stroke="black" points="1930.5,-3133.92 1927,-3123.92 1923.5,-3133.92 1930.5,-3133.92"/>
</g>
<!-- layer_11_gate -->
<g id="node135" class="node">
<title>layer_11_gate</title>
<polygon fill="lightblue" stroke="black" points="1357.5,-3003.74 1158.5,-3003.74 1158.5,-2920.74 1357.5,-2920.74 1357.5,-3003.74"/>
<text text-anchor="middle" x="1258" y="-2988.54" font-family="Times,serif" font-size="14.00">Layer 11</text>
<text text-anchor="middle" x="1258" y="-2973.54" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1258" y="-2958.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1258" y="-2943.54" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="1258" y="-2928.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_11_mha&#45;&gt;layer_11_gate -->
<g id="edge222" class="edge">
<title>layer_11_mha&#45;&gt;layer_11_gate</title>
<path fill="none" stroke="black" d="M1825.39,-3063.32C1701.99,-3041.55 1494.63,-3004.98 1367.69,-2982.59"/>
<polygon fill="black" stroke="black" points="1368.01,-2979.09 1357.55,-2980.8 1366.79,-2985.98 1368.01,-2979.09"/>
</g>
<!-- layer_11_residual -->
<g id="node145" class="node">
<title>layer_11_residual</title>
<polygon fill="lightblue" stroke="black" points="2091,-2629.74 1763,-2629.74 1763,-2546.74 2091,-2546.74 2091,-2629.74"/>
<text text-anchor="middle" x="1927" y="-2614.54" font-family="Times,serif" font-size="14.00">Layer 11</text>
<text text-anchor="middle" x="1927" y="-2599.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="1927" y="-2584.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-2569.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-2554.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_11_mha&#45;&gt;layer_11_residual -->
<g id="edge239" class="edge">
<title>layer_11_mha&#45;&gt;layer_11_residual</title>
<path fill="none" stroke="black" d="M2028.56,-3065.1C2125.86,-3046.68 2258,-3012.58 2258,-2963.24 2258,-2963.24 2258,-2963.24 2258,-2707.24 2258,-2669.5 2180.69,-2640.68 2100.8,-2620.97"/>
<polygon fill="black" stroke="black" points="2101.59,-2617.56 2091.05,-2618.61 2099.94,-2624.36 2101.59,-2617.56"/>
<text text-anchor="middle" x="2286" y="-2824.54" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_11_expert_0 -->
<g id="node136" class="node">
<title>layer_11_expert_0</title>
<polygon fill="lightblue" stroke="black" points="276,-2869.74 16,-2869.74 16,-2786.74 276,-2786.74 276,-2869.74"/>
<text text-anchor="middle" x="146" y="-2854.54" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="146" y="-2839.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="146" y="-2824.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="146" y="-2809.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="146" y="-2794.54" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_11_gate&#45;&gt;layer_11_expert_0 -->
<g id="edge223" class="edge">
<title>layer_11_gate&#45;&gt;layer_11_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.19,-2959.04C982.57,-2953.6 607.29,-2934.94 286.03,-2869.86"/>
<polygon fill="black" stroke="black" points="286.56,-2866.4 276.06,-2867.82 285.16,-2873.25 286.56,-2866.4"/>
<text text-anchor="middle" x="519" y="-2891.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_11_expert_1 -->
<g id="node137" class="node">
<title>layer_11_expert_1</title>
<polygon fill="lightblue" stroke="black" points="554,-2869.74 294,-2869.74 294,-2786.74 554,-2786.74 554,-2869.74"/>
<text text-anchor="middle" x="424" y="-2854.54" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="424" y="-2839.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="424" y="-2824.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="424" y="-2809.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="424" y="-2794.54" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_11_gate&#45;&gt;layer_11_expert_1 -->
<g id="edge224" class="edge">
<title>layer_11_gate&#45;&gt;layer_11_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.22,-2952.93C1024.56,-2940.72 780.15,-2914.61 564.01,-2869.87"/>
<polygon fill="black" stroke="black" points="564.57,-2866.41 554.07,-2867.79 563.14,-2873.26 564.57,-2866.41"/>
<text text-anchor="middle" x="783" y="-2891.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_11_expert_2 -->
<g id="node138" class="node">
<title>layer_11_expert_2</title>
<polygon fill="lightblue" stroke="black" points="832,-2869.74 572,-2869.74 572,-2786.74 832,-2786.74 832,-2869.74"/>
<text text-anchor="middle" x="702" y="-2854.54" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="702" y="-2839.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="702" y="-2824.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="702" y="-2809.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="702" y="-2794.54" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_11_gate&#45;&gt;layer_11_expert_2 -->
<g id="edge225" class="edge">
<title>layer_11_gate&#45;&gt;layer_11_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.13,-2941.3C1075.78,-2924.4 955.76,-2898.72 842.07,-2869.97"/>
<polygon fill="black" stroke="black" points="842.7,-2866.52 832.15,-2867.45 840.98,-2873.3 842.7,-2866.52"/>
<text text-anchor="middle" x="1027" y="-2891.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_11_expert_3 -->
<g id="node139" class="node">
<title>layer_11_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1110,-2869.74 850,-2869.74 850,-2786.74 1110,-2786.74 1110,-2869.74"/>
<text text-anchor="middle" x="980" y="-2854.54" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="980" y="-2839.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="980" y="-2824.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="980" y="-2809.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="980" y="-2794.54" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_11_gate&#45;&gt;layer_11_expert_3 -->
<g id="edge226" class="edge">
<title>layer_11_gate&#45;&gt;layer_11_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1172.7,-2920.74C1141.76,-2906.05 1106.62,-2889.36 1074.9,-2874.3"/>
<polygon fill="black" stroke="black" points="1076.15,-2871.02 1065.62,-2869.89 1073.15,-2877.34 1076.15,-2871.02"/>
<text text-anchor="middle" x="1177" y="-2891.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_11_expert_4 -->
<g id="node140" class="node">
<title>layer_11_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1388,-2869.74 1128,-2869.74 1128,-2786.74 1388,-2786.74 1388,-2869.74"/>
<text text-anchor="middle" x="1258" y="-2854.54" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1258" y="-2839.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1258" y="-2824.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-2809.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-2794.54" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_11_gate&#45;&gt;layer_11_expert_4 -->
<g id="edge227" class="edge">
<title>layer_11_gate&#45;&gt;layer_11_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1258,-2920.56C1258,-2907.76 1258,-2893.47 1258,-2880.06"/>
<polygon fill="black" stroke="black" points="1261.5,-2880.01 1258,-2870.01 1254.5,-2880.01 1261.5,-2880.01"/>
<text text-anchor="middle" x="1308" y="-2891.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_11_expert_5 -->
<g id="node141" class="node">
<title>layer_11_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1666,-2869.74 1406,-2869.74 1406,-2786.74 1666,-2786.74 1666,-2869.74"/>
<text text-anchor="middle" x="1536" y="-2854.54" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1536" y="-2839.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1536" y="-2824.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1536" y="-2809.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1536" y="-2794.54" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_11_gate&#45;&gt;layer_11_expert_5 -->
<g id="edge228" class="edge">
<title>layer_11_gate&#45;&gt;layer_11_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1343.3,-2920.74C1374.24,-2906.05 1409.38,-2889.36 1441.1,-2874.3"/>
<polygon fill="black" stroke="black" points="1442.85,-2877.34 1450.38,-2869.89 1439.85,-2871.02 1442.85,-2877.34"/>
<text text-anchor="middle" x="1455" y="-2891.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_11_expert_6 -->
<g id="node142" class="node">
<title>layer_11_expert_6</title>
<polygon fill="lightblue" stroke="black" points="1944,-2869.74 1684,-2869.74 1684,-2786.74 1944,-2786.74 1944,-2869.74"/>
<text text-anchor="middle" x="1814" y="-2854.54" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1814" y="-2839.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1814" y="-2824.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1814" y="-2809.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1814" y="-2794.54" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_11_gate&#45;&gt;layer_11_expert_6 -->
<g id="edge229" class="edge">
<title>layer_11_gate&#45;&gt;layer_11_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1357.87,-2941.3C1440.22,-2924.4 1560.24,-2898.72 1673.93,-2869.97"/>
<polygon fill="black" stroke="black" points="1675.02,-2873.3 1683.85,-2867.45 1673.3,-2866.52 1675.02,-2873.3"/>
<text text-anchor="middle" x="1645" y="-2891.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_11_expert_7 -->
<g id="node143" class="node">
<title>layer_11_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2222,-2869.74 1962,-2869.74 1962,-2786.74 2222,-2786.74 2222,-2869.74"/>
<text text-anchor="middle" x="2092" y="-2854.54" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2092" y="-2839.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2092" y="-2824.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2092" y="-2809.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2092" y="-2794.54" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_11_gate&#45;&gt;layer_11_expert_7 -->
<g id="edge230" class="edge">
<title>layer_11_gate&#45;&gt;layer_11_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1357.78,-2952.93C1491.44,-2940.72 1735.85,-2914.61 1951.99,-2869.87"/>
<polygon fill="black" stroke="black" points="1952.86,-2873.26 1961.93,-2867.79 1951.43,-2866.41 1952.86,-2873.26"/>
<text text-anchor="middle" x="1909" y="-2891.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_11_expert_agg -->
<g id="node144" class="node">
<title>layer_11_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="1382,-2749.74 1134,-2749.74 1134,-2666.74 1382,-2666.74 1382,-2749.74"/>
<text text-anchor="middle" x="1258" y="-2734.54" font-family="Times,serif" font-size="14.00">Layer 11</text>
<text text-anchor="middle" x="1258" y="-2719.54" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1258" y="-2704.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-2689.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1258" y="-2674.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_11_expert_0&#45;&gt;layer_11_expert_agg -->
<g id="edge231" class="edge">
<title>layer_11_expert_0&#45;&gt;layer_11_expert_agg</title>
<path fill="none" stroke="black" d="M276.03,-2788.48C279.04,-2787.87 282.03,-2787.28 285,-2786.74 581.03,-2732.41 934.63,-2716.17 1123.44,-2711.31"/>
<polygon fill="black" stroke="black" points="1123.78,-2714.8 1133.69,-2711.05 1123.6,-2707.8 1123.78,-2714.8"/>
</g>
<!-- layer_11_expert_1&#45;&gt;layer_11_expert_agg -->
<g id="edge232" class="edge">
<title>layer_11_expert_1&#45;&gt;layer_11_expert_agg</title>
<path fill="none" stroke="black" d="M554.05,-2788.61C557.06,-2787.96 560.04,-2787.33 563,-2786.74 756,-2748.16 983.26,-2727.37 1124,-2717.3"/>
<polygon fill="black" stroke="black" points="1124.25,-2720.79 1133.98,-2716.59 1123.76,-2713.81 1124.25,-2720.79"/>
</g>
<!-- layer_11_expert_2&#45;&gt;layer_11_expert_agg -->
<g id="edge233" class="edge">
<title>layer_11_expert_2&#45;&gt;layer_11_expert_agg</title>
<path fill="none" stroke="black" d="M832.12,-2788.9C835.1,-2788.16 838.07,-2787.44 841,-2786.74 934.79,-2764.42 1041.72,-2744.66 1123.81,-2730.68"/>
<polygon fill="black" stroke="black" points="1124.43,-2734.12 1133.7,-2729 1123.26,-2727.22 1124.43,-2734.12"/>
</g>
<!-- layer_11_expert_3&#45;&gt;layer_11_expert_agg -->
<g id="edge234" class="edge">
<title>layer_11_expert_3&#45;&gt;layer_11_expert_agg</title>
<path fill="none" stroke="black" d="M1075.67,-2786.63C1100.57,-2776.06 1127.53,-2764.62 1152.89,-2753.86"/>
<polygon fill="black" stroke="black" points="1154.31,-2757.05 1162.15,-2749.92 1151.58,-2750.61 1154.31,-2757.05"/>
</g>
<!-- layer_11_expert_4&#45;&gt;layer_11_expert_agg -->
<g id="edge235" class="edge">
<title>layer_11_expert_4&#45;&gt;layer_11_expert_agg</title>
<path fill="none" stroke="black" d="M1258,-2786.63C1258,-2778.1 1258,-2769 1258,-2760.15"/>
<polygon fill="black" stroke="black" points="1261.5,-2759.92 1258,-2749.92 1254.5,-2759.92 1261.5,-2759.92"/>
</g>
<!-- layer_11_expert_5&#45;&gt;layer_11_expert_agg -->
<g id="edge236" class="edge">
<title>layer_11_expert_5&#45;&gt;layer_11_expert_agg</title>
<path fill="none" stroke="black" d="M1440.33,-2786.63C1415.43,-2776.06 1388.47,-2764.62 1363.11,-2753.86"/>
<polygon fill="black" stroke="black" points="1364.42,-2750.61 1353.85,-2749.92 1361.69,-2757.05 1364.42,-2750.61"/>
</g>
<!-- layer_11_expert_6&#45;&gt;layer_11_expert_agg -->
<g id="edge237" class="edge">
<title>layer_11_expert_6&#45;&gt;layer_11_expert_agg</title>
<path fill="none" stroke="black" d="M1683.88,-2788.9C1680.9,-2788.16 1677.93,-2787.44 1675,-2786.74 1581.21,-2764.42 1474.28,-2744.66 1392.19,-2730.68"/>
<polygon fill="black" stroke="black" points="1392.74,-2727.22 1382.3,-2729 1391.57,-2734.12 1392.74,-2727.22"/>
</g>
<!-- layer_11_expert_7&#45;&gt;layer_11_expert_agg -->
<g id="edge238" class="edge">
<title>layer_11_expert_7&#45;&gt;layer_11_expert_agg</title>
<path fill="none" stroke="black" d="M1961.95,-2788.61C1958.94,-2787.96 1955.96,-2787.33 1953,-2786.74 1760,-2748.16 1532.74,-2727.37 1392,-2717.3"/>
<polygon fill="black" stroke="black" points="1392.24,-2713.81 1382.02,-2716.59 1391.75,-2720.79 1392.24,-2713.81"/>
</g>
<!-- layer_11_expert_agg&#45;&gt;layer_11_residual -->
<g id="edge240" class="edge">
<title>layer_11_expert_agg&#45;&gt;layer_11_residual</title>
<path fill="none" stroke="black" d="M1382.27,-2685.32C1486.54,-2666.93 1636.66,-2640.45 1752.91,-2619.95"/>
<polygon fill="black" stroke="black" points="1753.74,-2623.35 1762.98,-2618.17 1752.53,-2616.46 1753.74,-2623.35"/>
</g>
<!-- layer_12_mha -->
<g id="node146" class="node">
<title>layer_12_mha</title>
<polygon fill="lightblue" stroke="black" points="2028.5,-2509.74 1825.5,-2509.74 1825.5,-2426.74 2028.5,-2426.74 2028.5,-2509.74"/>
<text text-anchor="middle" x="1927" y="-2494.54" font-family="Times,serif" font-size="14.00">Layer 12</text>
<text text-anchor="middle" x="1927" y="-2479.54" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1927" y="-2464.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-2449.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-2434.54" font-family="Times,serif" font-size="14.00">TP=8 across GPUs 8&#45;15</text>
</g>
<!-- layer_11_residual&#45;&gt;layer_12_mha -->
<g id="edge241" class="edge">
<title>layer_11_residual&#45;&gt;layer_12_mha</title>
<path fill="none" stroke="black" d="M1927,-2546.63C1927,-2538.1 1927,-2529 1927,-2520.15"/>
<polygon fill="black" stroke="black" points="1930.5,-2519.92 1927,-2509.92 1923.5,-2519.92 1930.5,-2519.92"/>
</g>
<!-- layer_12_gate -->
<g id="node147" class="node">
<title>layer_12_gate</title>
<polygon fill="lightblue" stroke="black" points="1357.5,-2389.74 1158.5,-2389.74 1158.5,-2306.74 1357.5,-2306.74 1357.5,-2389.74"/>
<text text-anchor="middle" x="1258" y="-2374.54" font-family="Times,serif" font-size="14.00">Layer 12</text>
<text text-anchor="middle" x="1258" y="-2359.54" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1258" y="-2344.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1258" y="-2329.54" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="1258" y="-2314.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_12_mha&#45;&gt;layer_12_gate -->
<g id="edge242" class="edge">
<title>layer_12_mha&#45;&gt;layer_12_gate</title>
<path fill="none" stroke="black" d="M1825.39,-2449.32C1701.99,-2427.55 1494.63,-2390.98 1367.69,-2368.59"/>
<polygon fill="black" stroke="black" points="1368.01,-2365.09 1357.55,-2366.8 1366.79,-2371.98 1368.01,-2365.09"/>
</g>
<!-- layer_12_residual -->
<g id="node157" class="node">
<title>layer_12_residual</title>
<polygon fill="lightblue" stroke="black" points="2091,-2015.74 1763,-2015.74 1763,-1932.74 2091,-1932.74 2091,-2015.74"/>
<text text-anchor="middle" x="1927" y="-2000.54" font-family="Times,serif" font-size="14.00">Layer 12</text>
<text text-anchor="middle" x="1927" y="-1985.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="1927" y="-1970.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-1955.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-1940.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_12_mha&#45;&gt;layer_12_residual -->
<g id="edge259" class="edge">
<title>layer_12_mha&#45;&gt;layer_12_residual</title>
<path fill="none" stroke="black" d="M2028.56,-2451.1C2125.86,-2432.68 2258,-2398.58 2258,-2349.24 2258,-2349.24 2258,-2349.24 2258,-2093.24 2258,-2055.5 2180.69,-2026.68 2100.8,-2006.97"/>
<polygon fill="black" stroke="black" points="2101.59,-2003.56 2091.05,-2004.61 2099.94,-2010.36 2101.59,-2003.56"/>
<text text-anchor="middle" x="2286" y="-2210.54" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_12_expert_0 -->
<g id="node148" class="node">
<title>layer_12_expert_0</title>
<polygon fill="lightblue" stroke="black" points="276,-2255.74 16,-2255.74 16,-2172.74 276,-2172.74 276,-2255.74"/>
<text text-anchor="middle" x="146" y="-2240.54" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="146" y="-2225.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="146" y="-2210.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="146" y="-2195.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="146" y="-2180.54" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_12_gate&#45;&gt;layer_12_expert_0 -->
<g id="edge243" class="edge">
<title>layer_12_gate&#45;&gt;layer_12_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.19,-2345.04C982.57,-2339.6 607.29,-2320.94 286.03,-2255.86"/>
<polygon fill="black" stroke="black" points="286.56,-2252.4 276.06,-2253.82 285.16,-2259.25 286.56,-2252.4"/>
<text text-anchor="middle" x="519" y="-2277.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_12_expert_1 -->
<g id="node149" class="node">
<title>layer_12_expert_1</title>
<polygon fill="lightblue" stroke="black" points="554,-2255.74 294,-2255.74 294,-2172.74 554,-2172.74 554,-2255.74"/>
<text text-anchor="middle" x="424" y="-2240.54" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="424" y="-2225.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="424" y="-2210.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="424" y="-2195.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="424" y="-2180.54" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_12_gate&#45;&gt;layer_12_expert_1 -->
<g id="edge244" class="edge">
<title>layer_12_gate&#45;&gt;layer_12_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.22,-2338.93C1024.56,-2326.72 780.15,-2300.61 564.01,-2255.87"/>
<polygon fill="black" stroke="black" points="564.57,-2252.41 554.07,-2253.79 563.14,-2259.26 564.57,-2252.41"/>
<text text-anchor="middle" x="783" y="-2277.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_12_expert_2 -->
<g id="node150" class="node">
<title>layer_12_expert_2</title>
<polygon fill="lightblue" stroke="black" points="832,-2255.74 572,-2255.74 572,-2172.74 832,-2172.74 832,-2255.74"/>
<text text-anchor="middle" x="702" y="-2240.54" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="702" y="-2225.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="702" y="-2210.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="702" y="-2195.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="702" y="-2180.54" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_12_gate&#45;&gt;layer_12_expert_2 -->
<g id="edge245" class="edge">
<title>layer_12_gate&#45;&gt;layer_12_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.13,-2327.3C1075.78,-2310.4 955.76,-2284.72 842.07,-2255.97"/>
<polygon fill="black" stroke="black" points="842.7,-2252.52 832.15,-2253.45 840.98,-2259.3 842.7,-2252.52"/>
<text text-anchor="middle" x="1027" y="-2277.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_12_expert_3 -->
<g id="node151" class="node">
<title>layer_12_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1110,-2255.74 850,-2255.74 850,-2172.74 1110,-2172.74 1110,-2255.74"/>
<text text-anchor="middle" x="980" y="-2240.54" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="980" y="-2225.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="980" y="-2210.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="980" y="-2195.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="980" y="-2180.54" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_12_gate&#45;&gt;layer_12_expert_3 -->
<g id="edge246" class="edge">
<title>layer_12_gate&#45;&gt;layer_12_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1172.7,-2306.74C1141.76,-2292.05 1106.62,-2275.36 1074.9,-2260.3"/>
<polygon fill="black" stroke="black" points="1076.15,-2257.02 1065.62,-2255.89 1073.15,-2263.34 1076.15,-2257.02"/>
<text text-anchor="middle" x="1177" y="-2277.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_12_expert_4 -->
<g id="node152" class="node">
<title>layer_12_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1388,-2255.74 1128,-2255.74 1128,-2172.74 1388,-2172.74 1388,-2255.74"/>
<text text-anchor="middle" x="1258" y="-2240.54" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1258" y="-2225.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1258" y="-2210.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-2195.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-2180.54" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_12_gate&#45;&gt;layer_12_expert_4 -->
<g id="edge247" class="edge">
<title>layer_12_gate&#45;&gt;layer_12_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1258,-2306.56C1258,-2293.76 1258,-2279.47 1258,-2266.06"/>
<polygon fill="black" stroke="black" points="1261.5,-2266.01 1258,-2256.01 1254.5,-2266.01 1261.5,-2266.01"/>
<text text-anchor="middle" x="1308" y="-2277.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_12_expert_5 -->
<g id="node153" class="node">
<title>layer_12_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1666,-2255.74 1406,-2255.74 1406,-2172.74 1666,-2172.74 1666,-2255.74"/>
<text text-anchor="middle" x="1536" y="-2240.54" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1536" y="-2225.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1536" y="-2210.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1536" y="-2195.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1536" y="-2180.54" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_12_gate&#45;&gt;layer_12_expert_5 -->
<g id="edge248" class="edge">
<title>layer_12_gate&#45;&gt;layer_12_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1343.3,-2306.74C1374.24,-2292.05 1409.38,-2275.36 1441.1,-2260.3"/>
<polygon fill="black" stroke="black" points="1442.85,-2263.34 1450.38,-2255.89 1439.85,-2257.02 1442.85,-2263.34"/>
<text text-anchor="middle" x="1455" y="-2277.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_12_expert_6 -->
<g id="node154" class="node">
<title>layer_12_expert_6</title>
<polygon fill="lightblue" stroke="black" points="1944,-2255.74 1684,-2255.74 1684,-2172.74 1944,-2172.74 1944,-2255.74"/>
<text text-anchor="middle" x="1814" y="-2240.54" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1814" y="-2225.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1814" y="-2210.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1814" y="-2195.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1814" y="-2180.54" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_12_gate&#45;&gt;layer_12_expert_6 -->
<g id="edge249" class="edge">
<title>layer_12_gate&#45;&gt;layer_12_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1357.87,-2327.3C1440.22,-2310.4 1560.24,-2284.72 1673.93,-2255.97"/>
<polygon fill="black" stroke="black" points="1675.02,-2259.3 1683.85,-2253.45 1673.3,-2252.52 1675.02,-2259.3"/>
<text text-anchor="middle" x="1645" y="-2277.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_12_expert_7 -->
<g id="node155" class="node">
<title>layer_12_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2222,-2255.74 1962,-2255.74 1962,-2172.74 2222,-2172.74 2222,-2255.74"/>
<text text-anchor="middle" x="2092" y="-2240.54" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2092" y="-2225.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2092" y="-2210.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2092" y="-2195.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2092" y="-2180.54" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_12_gate&#45;&gt;layer_12_expert_7 -->
<g id="edge250" class="edge">
<title>layer_12_gate&#45;&gt;layer_12_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1357.78,-2338.93C1491.44,-2326.72 1735.85,-2300.61 1951.99,-2255.87"/>
<polygon fill="black" stroke="black" points="1952.86,-2259.26 1961.93,-2253.79 1951.43,-2252.41 1952.86,-2259.26"/>
<text text-anchor="middle" x="1909" y="-2277.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_12_expert_agg -->
<g id="node156" class="node">
<title>layer_12_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="1382,-2135.74 1134,-2135.74 1134,-2052.74 1382,-2052.74 1382,-2135.74"/>
<text text-anchor="middle" x="1258" y="-2120.54" font-family="Times,serif" font-size="14.00">Layer 12</text>
<text text-anchor="middle" x="1258" y="-2105.54" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1258" y="-2090.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-2075.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1258" y="-2060.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_12_expert_0&#45;&gt;layer_12_expert_agg -->
<g id="edge251" class="edge">
<title>layer_12_expert_0&#45;&gt;layer_12_expert_agg</title>
<path fill="none" stroke="black" d="M276.03,-2174.48C279.04,-2173.87 282.03,-2173.28 285,-2172.74 581.03,-2118.41 934.63,-2102.17 1123.44,-2097.31"/>
<polygon fill="black" stroke="black" points="1123.78,-2100.8 1133.69,-2097.05 1123.6,-2093.8 1123.78,-2100.8"/>
</g>
<!-- layer_12_expert_1&#45;&gt;layer_12_expert_agg -->
<g id="edge252" class="edge">
<title>layer_12_expert_1&#45;&gt;layer_12_expert_agg</title>
<path fill="none" stroke="black" d="M554.05,-2174.61C557.06,-2173.96 560.04,-2173.33 563,-2172.74 756,-2134.16 983.26,-2113.37 1124,-2103.3"/>
<polygon fill="black" stroke="black" points="1124.25,-2106.79 1133.98,-2102.59 1123.76,-2099.81 1124.25,-2106.79"/>
</g>
<!-- layer_12_expert_2&#45;&gt;layer_12_expert_agg -->
<g id="edge253" class="edge">
<title>layer_12_expert_2&#45;&gt;layer_12_expert_agg</title>
<path fill="none" stroke="black" d="M832.12,-2174.9C835.1,-2174.16 838.07,-2173.44 841,-2172.74 934.79,-2150.42 1041.72,-2130.66 1123.81,-2116.68"/>
<polygon fill="black" stroke="black" points="1124.43,-2120.12 1133.7,-2115 1123.26,-2113.22 1124.43,-2120.12"/>
</g>
<!-- layer_12_expert_3&#45;&gt;layer_12_expert_agg -->
<g id="edge254" class="edge">
<title>layer_12_expert_3&#45;&gt;layer_12_expert_agg</title>
<path fill="none" stroke="black" d="M1075.67,-2172.63C1100.57,-2162.06 1127.53,-2150.62 1152.89,-2139.86"/>
<polygon fill="black" stroke="black" points="1154.31,-2143.05 1162.15,-2135.92 1151.58,-2136.61 1154.31,-2143.05"/>
</g>
<!-- layer_12_expert_4&#45;&gt;layer_12_expert_agg -->
<g id="edge255" class="edge">
<title>layer_12_expert_4&#45;&gt;layer_12_expert_agg</title>
<path fill="none" stroke="black" d="M1258,-2172.63C1258,-2164.1 1258,-2155 1258,-2146.15"/>
<polygon fill="black" stroke="black" points="1261.5,-2145.92 1258,-2135.92 1254.5,-2145.92 1261.5,-2145.92"/>
</g>
<!-- layer_12_expert_5&#45;&gt;layer_12_expert_agg -->
<g id="edge256" class="edge">
<title>layer_12_expert_5&#45;&gt;layer_12_expert_agg</title>
<path fill="none" stroke="black" d="M1440.33,-2172.63C1415.43,-2162.06 1388.47,-2150.62 1363.11,-2139.86"/>
<polygon fill="black" stroke="black" points="1364.42,-2136.61 1353.85,-2135.92 1361.69,-2143.05 1364.42,-2136.61"/>
</g>
<!-- layer_12_expert_6&#45;&gt;layer_12_expert_agg -->
<g id="edge257" class="edge">
<title>layer_12_expert_6&#45;&gt;layer_12_expert_agg</title>
<path fill="none" stroke="black" d="M1683.88,-2174.9C1680.9,-2174.16 1677.93,-2173.44 1675,-2172.74 1581.21,-2150.42 1474.28,-2130.66 1392.19,-2116.68"/>
<polygon fill="black" stroke="black" points="1392.74,-2113.22 1382.3,-2115 1391.57,-2120.12 1392.74,-2113.22"/>
</g>
<!-- layer_12_expert_7&#45;&gt;layer_12_expert_agg -->
<g id="edge258" class="edge">
<title>layer_12_expert_7&#45;&gt;layer_12_expert_agg</title>
<path fill="none" stroke="black" d="M1961.95,-2174.61C1958.94,-2173.96 1955.96,-2173.33 1953,-2172.74 1760,-2134.16 1532.74,-2113.37 1392,-2103.3"/>
<polygon fill="black" stroke="black" points="1392.24,-2099.81 1382.02,-2102.59 1391.75,-2106.79 1392.24,-2099.81"/>
</g>
<!-- layer_12_expert_agg&#45;&gt;layer_12_residual -->
<g id="edge260" class="edge">
<title>layer_12_expert_agg&#45;&gt;layer_12_residual</title>
<path fill="none" stroke="black" d="M1382.27,-2071.32C1486.54,-2052.93 1636.66,-2026.45 1752.91,-2005.95"/>
<polygon fill="black" stroke="black" points="1753.74,-2009.35 1762.98,-2004.17 1752.53,-2002.46 1753.74,-2009.35"/>
</g>
<!-- layer_13_mha -->
<g id="node158" class="node">
<title>layer_13_mha</title>
<polygon fill="lightblue" stroke="black" points="2028.5,-1895.74 1825.5,-1895.74 1825.5,-1812.74 2028.5,-1812.74 2028.5,-1895.74"/>
<text text-anchor="middle" x="1927" y="-1880.54" font-family="Times,serif" font-size="14.00">Layer 13</text>
<text text-anchor="middle" x="1927" y="-1865.54" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1927" y="-1850.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-1835.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-1820.54" font-family="Times,serif" font-size="14.00">TP=8 across GPUs 8&#45;15</text>
</g>
<!-- layer_12_residual&#45;&gt;layer_13_mha -->
<g id="edge261" class="edge">
<title>layer_12_residual&#45;&gt;layer_13_mha</title>
<path fill="none" stroke="black" d="M1927,-1932.63C1927,-1924.1 1927,-1915 1927,-1906.15"/>
<polygon fill="black" stroke="black" points="1930.5,-1905.92 1927,-1895.92 1923.5,-1905.92 1930.5,-1905.92"/>
</g>
<!-- layer_13_gate -->
<g id="node159" class="node">
<title>layer_13_gate</title>
<polygon fill="lightblue" stroke="black" points="1357.5,-1775.74 1158.5,-1775.74 1158.5,-1692.74 1357.5,-1692.74 1357.5,-1775.74"/>
<text text-anchor="middle" x="1258" y="-1760.54" font-family="Times,serif" font-size="14.00">Layer 13</text>
<text text-anchor="middle" x="1258" y="-1745.54" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1258" y="-1730.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1258" y="-1715.54" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="1258" y="-1700.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_13_mha&#45;&gt;layer_13_gate -->
<g id="edge262" class="edge">
<title>layer_13_mha&#45;&gt;layer_13_gate</title>
<path fill="none" stroke="black" d="M1825.39,-1835.32C1701.99,-1813.55 1494.63,-1776.98 1367.69,-1754.59"/>
<polygon fill="black" stroke="black" points="1368.01,-1751.09 1357.55,-1752.8 1366.79,-1757.98 1368.01,-1751.09"/>
</g>
<!-- layer_13_residual -->
<g id="node169" class="node">
<title>layer_13_residual</title>
<polygon fill="lightblue" stroke="black" points="2091,-1401.74 1763,-1401.74 1763,-1318.74 2091,-1318.74 2091,-1401.74"/>
<text text-anchor="middle" x="1927" y="-1386.54" font-family="Times,serif" font-size="14.00">Layer 13</text>
<text text-anchor="middle" x="1927" y="-1371.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="1927" y="-1356.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-1341.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-1326.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_13_mha&#45;&gt;layer_13_residual -->
<g id="edge279" class="edge">
<title>layer_13_mha&#45;&gt;layer_13_residual</title>
<path fill="none" stroke="black" d="M2028.56,-1837.1C2125.86,-1818.68 2258,-1784.58 2258,-1735.24 2258,-1735.24 2258,-1735.24 2258,-1479.24 2258,-1441.5 2180.69,-1412.68 2100.8,-1392.97"/>
<polygon fill="black" stroke="black" points="2101.59,-1389.56 2091.05,-1390.61 2099.94,-1396.36 2101.59,-1389.56"/>
<text text-anchor="middle" x="2286" y="-1596.54" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_13_expert_0 -->
<g id="node160" class="node">
<title>layer_13_expert_0</title>
<polygon fill="lightblue" stroke="black" points="276,-1641.74 16,-1641.74 16,-1558.74 276,-1558.74 276,-1641.74"/>
<text text-anchor="middle" x="146" y="-1626.54" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="146" y="-1611.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="146" y="-1596.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="146" y="-1581.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="146" y="-1566.54" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_13_gate&#45;&gt;layer_13_expert_0 -->
<g id="edge263" class="edge">
<title>layer_13_gate&#45;&gt;layer_13_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.19,-1731.04C982.57,-1725.6 607.29,-1706.94 286.03,-1641.86"/>
<polygon fill="black" stroke="black" points="286.56,-1638.4 276.06,-1639.82 285.16,-1645.25 286.56,-1638.4"/>
<text text-anchor="middle" x="519" y="-1663.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_13_expert_1 -->
<g id="node161" class="node">
<title>layer_13_expert_1</title>
<polygon fill="lightblue" stroke="black" points="554,-1641.74 294,-1641.74 294,-1558.74 554,-1558.74 554,-1641.74"/>
<text text-anchor="middle" x="424" y="-1626.54" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="424" y="-1611.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="424" y="-1596.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="424" y="-1581.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="424" y="-1566.54" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_13_gate&#45;&gt;layer_13_expert_1 -->
<g id="edge264" class="edge">
<title>layer_13_gate&#45;&gt;layer_13_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.22,-1724.93C1024.56,-1712.72 780.15,-1686.61 564.01,-1641.87"/>
<polygon fill="black" stroke="black" points="564.57,-1638.41 554.07,-1639.79 563.14,-1645.26 564.57,-1638.41"/>
<text text-anchor="middle" x="783" y="-1663.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_13_expert_2 -->
<g id="node162" class="node">
<title>layer_13_expert_2</title>
<polygon fill="lightblue" stroke="black" points="832,-1641.74 572,-1641.74 572,-1558.74 832,-1558.74 832,-1641.74"/>
<text text-anchor="middle" x="702" y="-1626.54" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="702" y="-1611.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="702" y="-1596.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="702" y="-1581.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="702" y="-1566.54" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_13_gate&#45;&gt;layer_13_expert_2 -->
<g id="edge265" class="edge">
<title>layer_13_gate&#45;&gt;layer_13_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.13,-1713.3C1075.78,-1696.4 955.76,-1670.72 842.07,-1641.97"/>
<polygon fill="black" stroke="black" points="842.7,-1638.52 832.15,-1639.45 840.98,-1645.3 842.7,-1638.52"/>
<text text-anchor="middle" x="1027" y="-1663.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_13_expert_3 -->
<g id="node163" class="node">
<title>layer_13_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1110,-1641.74 850,-1641.74 850,-1558.74 1110,-1558.74 1110,-1641.74"/>
<text text-anchor="middle" x="980" y="-1626.54" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="980" y="-1611.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="980" y="-1596.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="980" y="-1581.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="980" y="-1566.54" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_13_gate&#45;&gt;layer_13_expert_3 -->
<g id="edge266" class="edge">
<title>layer_13_gate&#45;&gt;layer_13_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1172.7,-1692.74C1141.76,-1678.05 1106.62,-1661.36 1074.9,-1646.3"/>
<polygon fill="black" stroke="black" points="1076.15,-1643.02 1065.62,-1641.89 1073.15,-1649.34 1076.15,-1643.02"/>
<text text-anchor="middle" x="1177" y="-1663.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_13_expert_4 -->
<g id="node164" class="node">
<title>layer_13_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1388,-1641.74 1128,-1641.74 1128,-1558.74 1388,-1558.74 1388,-1641.74"/>
<text text-anchor="middle" x="1258" y="-1626.54" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1258" y="-1611.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1258" y="-1596.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-1581.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-1566.54" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_13_gate&#45;&gt;layer_13_expert_4 -->
<g id="edge267" class="edge">
<title>layer_13_gate&#45;&gt;layer_13_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1258,-1692.56C1258,-1679.76 1258,-1665.47 1258,-1652.06"/>
<polygon fill="black" stroke="black" points="1261.5,-1652.01 1258,-1642.01 1254.5,-1652.01 1261.5,-1652.01"/>
<text text-anchor="middle" x="1308" y="-1663.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_13_expert_5 -->
<g id="node165" class="node">
<title>layer_13_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1666,-1641.74 1406,-1641.74 1406,-1558.74 1666,-1558.74 1666,-1641.74"/>
<text text-anchor="middle" x="1536" y="-1626.54" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1536" y="-1611.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1536" y="-1596.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1536" y="-1581.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1536" y="-1566.54" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_13_gate&#45;&gt;layer_13_expert_5 -->
<g id="edge268" class="edge">
<title>layer_13_gate&#45;&gt;layer_13_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1343.3,-1692.74C1374.24,-1678.05 1409.38,-1661.36 1441.1,-1646.3"/>
<polygon fill="black" stroke="black" points="1442.85,-1649.34 1450.38,-1641.89 1439.85,-1643.02 1442.85,-1649.34"/>
<text text-anchor="middle" x="1455" y="-1663.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_13_expert_6 -->
<g id="node166" class="node">
<title>layer_13_expert_6</title>
<polygon fill="lightblue" stroke="black" points="1944,-1641.74 1684,-1641.74 1684,-1558.74 1944,-1558.74 1944,-1641.74"/>
<text text-anchor="middle" x="1814" y="-1626.54" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1814" y="-1611.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1814" y="-1596.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1814" y="-1581.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1814" y="-1566.54" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_13_gate&#45;&gt;layer_13_expert_6 -->
<g id="edge269" class="edge">
<title>layer_13_gate&#45;&gt;layer_13_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1357.87,-1713.3C1440.22,-1696.4 1560.24,-1670.72 1673.93,-1641.97"/>
<polygon fill="black" stroke="black" points="1675.02,-1645.3 1683.85,-1639.45 1673.3,-1638.52 1675.02,-1645.3"/>
<text text-anchor="middle" x="1645" y="-1663.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_13_expert_7 -->
<g id="node167" class="node">
<title>layer_13_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2222,-1641.74 1962,-1641.74 1962,-1558.74 2222,-1558.74 2222,-1641.74"/>
<text text-anchor="middle" x="2092" y="-1626.54" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2092" y="-1611.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2092" y="-1596.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2092" y="-1581.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2092" y="-1566.54" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_13_gate&#45;&gt;layer_13_expert_7 -->
<g id="edge270" class="edge">
<title>layer_13_gate&#45;&gt;layer_13_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1357.78,-1724.93C1491.44,-1712.72 1735.85,-1686.61 1951.99,-1641.87"/>
<polygon fill="black" stroke="black" points="1952.86,-1645.26 1961.93,-1639.79 1951.43,-1638.41 1952.86,-1645.26"/>
<text text-anchor="middle" x="1909" y="-1663.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_13_expert_agg -->
<g id="node168" class="node">
<title>layer_13_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="1382,-1521.74 1134,-1521.74 1134,-1438.74 1382,-1438.74 1382,-1521.74"/>
<text text-anchor="middle" x="1258" y="-1506.54" font-family="Times,serif" font-size="14.00">Layer 13</text>
<text text-anchor="middle" x="1258" y="-1491.54" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1258" y="-1476.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-1461.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1258" y="-1446.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_13_expert_0&#45;&gt;layer_13_expert_agg -->
<g id="edge271" class="edge">
<title>layer_13_expert_0&#45;&gt;layer_13_expert_agg</title>
<path fill="none" stroke="black" d="M276.03,-1560.48C279.04,-1559.87 282.03,-1559.28 285,-1558.74 581.03,-1504.41 934.63,-1488.17 1123.44,-1483.31"/>
<polygon fill="black" stroke="black" points="1123.78,-1486.8 1133.69,-1483.05 1123.6,-1479.8 1123.78,-1486.8"/>
</g>
<!-- layer_13_expert_1&#45;&gt;layer_13_expert_agg -->
<g id="edge272" class="edge">
<title>layer_13_expert_1&#45;&gt;layer_13_expert_agg</title>
<path fill="none" stroke="black" d="M554.05,-1560.61C557.06,-1559.96 560.04,-1559.33 563,-1558.74 756,-1520.16 983.26,-1499.37 1124,-1489.3"/>
<polygon fill="black" stroke="black" points="1124.25,-1492.79 1133.98,-1488.59 1123.76,-1485.81 1124.25,-1492.79"/>
</g>
<!-- layer_13_expert_2&#45;&gt;layer_13_expert_agg -->
<g id="edge273" class="edge">
<title>layer_13_expert_2&#45;&gt;layer_13_expert_agg</title>
<path fill="none" stroke="black" d="M832.12,-1560.9C835.1,-1560.16 838.07,-1559.44 841,-1558.74 934.79,-1536.42 1041.72,-1516.66 1123.81,-1502.68"/>
<polygon fill="black" stroke="black" points="1124.43,-1506.12 1133.7,-1501 1123.26,-1499.22 1124.43,-1506.12"/>
</g>
<!-- layer_13_expert_3&#45;&gt;layer_13_expert_agg -->
<g id="edge274" class="edge">
<title>layer_13_expert_3&#45;&gt;layer_13_expert_agg</title>
<path fill="none" stroke="black" d="M1075.67,-1558.63C1100.57,-1548.06 1127.53,-1536.62 1152.89,-1525.86"/>
<polygon fill="black" stroke="black" points="1154.31,-1529.05 1162.15,-1521.92 1151.58,-1522.61 1154.31,-1529.05"/>
</g>
<!-- layer_13_expert_4&#45;&gt;layer_13_expert_agg -->
<g id="edge275" class="edge">
<title>layer_13_expert_4&#45;&gt;layer_13_expert_agg</title>
<path fill="none" stroke="black" d="M1258,-1558.63C1258,-1550.1 1258,-1541 1258,-1532.15"/>
<polygon fill="black" stroke="black" points="1261.5,-1531.92 1258,-1521.92 1254.5,-1531.92 1261.5,-1531.92"/>
</g>
<!-- layer_13_expert_5&#45;&gt;layer_13_expert_agg -->
<g id="edge276" class="edge">
<title>layer_13_expert_5&#45;&gt;layer_13_expert_agg</title>
<path fill="none" stroke="black" d="M1440.33,-1558.63C1415.43,-1548.06 1388.47,-1536.62 1363.11,-1525.86"/>
<polygon fill="black" stroke="black" points="1364.42,-1522.61 1353.85,-1521.92 1361.69,-1529.05 1364.42,-1522.61"/>
</g>
<!-- layer_13_expert_6&#45;&gt;layer_13_expert_agg -->
<g id="edge277" class="edge">
<title>layer_13_expert_6&#45;&gt;layer_13_expert_agg</title>
<path fill="none" stroke="black" d="M1683.88,-1560.9C1680.9,-1560.16 1677.93,-1559.44 1675,-1558.74 1581.21,-1536.42 1474.28,-1516.66 1392.19,-1502.68"/>
<polygon fill="black" stroke="black" points="1392.74,-1499.22 1382.3,-1501 1391.57,-1506.12 1392.74,-1499.22"/>
</g>
<!-- layer_13_expert_7&#45;&gt;layer_13_expert_agg -->
<g id="edge278" class="edge">
<title>layer_13_expert_7&#45;&gt;layer_13_expert_agg</title>
<path fill="none" stroke="black" d="M1961.95,-1560.61C1958.94,-1559.96 1955.96,-1559.33 1953,-1558.74 1760,-1520.16 1532.74,-1499.37 1392,-1489.3"/>
<polygon fill="black" stroke="black" points="1392.24,-1485.81 1382.02,-1488.59 1391.75,-1492.79 1392.24,-1485.81"/>
</g>
<!-- layer_13_expert_agg&#45;&gt;layer_13_residual -->
<g id="edge280" class="edge">
<title>layer_13_expert_agg&#45;&gt;layer_13_residual</title>
<path fill="none" stroke="black" d="M1382.27,-1457.32C1486.54,-1438.93 1636.66,-1412.45 1752.91,-1391.95"/>
<polygon fill="black" stroke="black" points="1753.74,-1395.35 1762.98,-1390.17 1752.53,-1388.46 1753.74,-1395.35"/>
</g>
<!-- layer_14_mha -->
<g id="node170" class="node">
<title>layer_14_mha</title>
<polygon fill="lightblue" stroke="black" points="2028.5,-1281.74 1825.5,-1281.74 1825.5,-1198.74 2028.5,-1198.74 2028.5,-1281.74"/>
<text text-anchor="middle" x="1927" y="-1266.54" font-family="Times,serif" font-size="14.00">Layer 14</text>
<text text-anchor="middle" x="1927" y="-1251.54" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1927" y="-1236.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-1221.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-1206.54" font-family="Times,serif" font-size="14.00">TP=8 across GPUs 8&#45;15</text>
</g>
<!-- layer_13_residual&#45;&gt;layer_14_mha -->
<g id="edge281" class="edge">
<title>layer_13_residual&#45;&gt;layer_14_mha</title>
<path fill="none" stroke="black" d="M1927,-1318.63C1927,-1310.1 1927,-1301 1927,-1292.15"/>
<polygon fill="black" stroke="black" points="1930.5,-1291.92 1927,-1281.92 1923.5,-1291.92 1930.5,-1291.92"/>
</g>
<!-- layer_14_gate -->
<g id="node171" class="node">
<title>layer_14_gate</title>
<polygon fill="lightblue" stroke="black" points="1357.5,-1161.74 1158.5,-1161.74 1158.5,-1078.74 1357.5,-1078.74 1357.5,-1161.74"/>
<text text-anchor="middle" x="1258" y="-1146.54" font-family="Times,serif" font-size="14.00">Layer 14</text>
<text text-anchor="middle" x="1258" y="-1131.54" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1258" y="-1116.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1258" y="-1101.54" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="1258" y="-1086.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_14_mha&#45;&gt;layer_14_gate -->
<g id="edge282" class="edge">
<title>layer_14_mha&#45;&gt;layer_14_gate</title>
<path fill="none" stroke="black" d="M1825.39,-1221.32C1701.99,-1199.55 1494.63,-1162.98 1367.69,-1140.59"/>
<polygon fill="black" stroke="black" points="1368.01,-1137.09 1357.55,-1138.8 1366.79,-1143.98 1368.01,-1137.09"/>
</g>
<!-- layer_14_residual -->
<g id="node181" class="node">
<title>layer_14_residual</title>
<polygon fill="lightblue" stroke="black" points="2091,-787.74 1763,-787.74 1763,-704.74 2091,-704.74 2091,-787.74"/>
<text text-anchor="middle" x="1927" y="-772.54" font-family="Times,serif" font-size="14.00">Layer 14</text>
<text text-anchor="middle" x="1927" y="-757.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="1927" y="-742.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-727.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-712.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_14_mha&#45;&gt;layer_14_residual -->
<g id="edge299" class="edge">
<title>layer_14_mha&#45;&gt;layer_14_residual</title>
<path fill="none" stroke="black" d="M2028.56,-1223.1C2125.86,-1204.68 2258,-1170.58 2258,-1121.24 2258,-1121.24 2258,-1121.24 2258,-865.24 2258,-827.5 2180.69,-798.68 2100.8,-778.97"/>
<polygon fill="black" stroke="black" points="2101.59,-775.56 2091.05,-776.61 2099.94,-782.36 2101.59,-775.56"/>
<text text-anchor="middle" x="2286" y="-982.54" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_14_expert_0 -->
<g id="node172" class="node">
<title>layer_14_expert_0</title>
<polygon fill="lightblue" stroke="black" points="276,-1027.74 16,-1027.74 16,-944.74 276,-944.74 276,-1027.74"/>
<text text-anchor="middle" x="146" y="-1012.54" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="146" y="-997.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="146" y="-982.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="146" y="-967.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="146" y="-952.54" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_14_gate&#45;&gt;layer_14_expert_0 -->
<g id="edge283" class="edge">
<title>layer_14_gate&#45;&gt;layer_14_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.19,-1117.04C982.57,-1111.6 607.29,-1092.94 286.03,-1027.86"/>
<polygon fill="black" stroke="black" points="286.56,-1024.4 276.06,-1025.82 285.16,-1031.25 286.56,-1024.4"/>
<text text-anchor="middle" x="519" y="-1049.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_14_expert_1 -->
<g id="node173" class="node">
<title>layer_14_expert_1</title>
<polygon fill="lightblue" stroke="black" points="554,-1027.74 294,-1027.74 294,-944.74 554,-944.74 554,-1027.74"/>
<text text-anchor="middle" x="424" y="-1012.54" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="424" y="-997.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="424" y="-982.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="424" y="-967.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="424" y="-952.54" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_14_gate&#45;&gt;layer_14_expert_1 -->
<g id="edge284" class="edge">
<title>layer_14_gate&#45;&gt;layer_14_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.22,-1110.93C1024.56,-1098.72 780.15,-1072.61 564.01,-1027.87"/>
<polygon fill="black" stroke="black" points="564.57,-1024.41 554.07,-1025.79 563.14,-1031.26 564.57,-1024.41"/>
<text text-anchor="middle" x="783" y="-1049.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_14_expert_2 -->
<g id="node174" class="node">
<title>layer_14_expert_2</title>
<polygon fill="lightblue" stroke="black" points="832,-1027.74 572,-1027.74 572,-944.74 832,-944.74 832,-1027.74"/>
<text text-anchor="middle" x="702" y="-1012.54" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="702" y="-997.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="702" y="-982.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="702" y="-967.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="702" y="-952.54" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_14_gate&#45;&gt;layer_14_expert_2 -->
<g id="edge285" class="edge">
<title>layer_14_gate&#45;&gt;layer_14_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.13,-1099.3C1075.78,-1082.4 955.76,-1056.72 842.07,-1027.97"/>
<polygon fill="black" stroke="black" points="842.7,-1024.52 832.15,-1025.45 840.98,-1031.3 842.7,-1024.52"/>
<text text-anchor="middle" x="1027" y="-1049.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_14_expert_3 -->
<g id="node175" class="node">
<title>layer_14_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1110,-1027.74 850,-1027.74 850,-944.74 1110,-944.74 1110,-1027.74"/>
<text text-anchor="middle" x="980" y="-1012.54" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="980" y="-997.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="980" y="-982.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="980" y="-967.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="980" y="-952.54" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_14_gate&#45;&gt;layer_14_expert_3 -->
<g id="edge286" class="edge">
<title>layer_14_gate&#45;&gt;layer_14_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1172.7,-1078.74C1141.76,-1064.05 1106.62,-1047.36 1074.9,-1032.3"/>
<polygon fill="black" stroke="black" points="1076.15,-1029.02 1065.62,-1027.89 1073.15,-1035.34 1076.15,-1029.02"/>
<text text-anchor="middle" x="1177" y="-1049.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_14_expert_4 -->
<g id="node176" class="node">
<title>layer_14_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1388,-1027.74 1128,-1027.74 1128,-944.74 1388,-944.74 1388,-1027.74"/>
<text text-anchor="middle" x="1258" y="-1012.54" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1258" y="-997.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1258" y="-982.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-967.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-952.54" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_14_gate&#45;&gt;layer_14_expert_4 -->
<g id="edge287" class="edge">
<title>layer_14_gate&#45;&gt;layer_14_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1258,-1078.56C1258,-1065.76 1258,-1051.47 1258,-1038.06"/>
<polygon fill="black" stroke="black" points="1261.5,-1038.01 1258,-1028.01 1254.5,-1038.01 1261.5,-1038.01"/>
<text text-anchor="middle" x="1308" y="-1049.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_14_expert_5 -->
<g id="node177" class="node">
<title>layer_14_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1666,-1027.74 1406,-1027.74 1406,-944.74 1666,-944.74 1666,-1027.74"/>
<text text-anchor="middle" x="1536" y="-1012.54" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1536" y="-997.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1536" y="-982.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1536" y="-967.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1536" y="-952.54" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_14_gate&#45;&gt;layer_14_expert_5 -->
<g id="edge288" class="edge">
<title>layer_14_gate&#45;&gt;layer_14_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1343.3,-1078.74C1374.24,-1064.05 1409.38,-1047.36 1441.1,-1032.3"/>
<polygon fill="black" stroke="black" points="1442.85,-1035.34 1450.38,-1027.89 1439.85,-1029.02 1442.85,-1035.34"/>
<text text-anchor="middle" x="1455" y="-1049.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_14_expert_6 -->
<g id="node178" class="node">
<title>layer_14_expert_6</title>
<polygon fill="lightblue" stroke="black" points="1944,-1027.74 1684,-1027.74 1684,-944.74 1944,-944.74 1944,-1027.74"/>
<text text-anchor="middle" x="1814" y="-1012.54" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1814" y="-997.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1814" y="-982.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1814" y="-967.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1814" y="-952.54" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_14_gate&#45;&gt;layer_14_expert_6 -->
<g id="edge289" class="edge">
<title>layer_14_gate&#45;&gt;layer_14_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1357.87,-1099.3C1440.22,-1082.4 1560.24,-1056.72 1673.93,-1027.97"/>
<polygon fill="black" stroke="black" points="1675.02,-1031.3 1683.85,-1025.45 1673.3,-1024.52 1675.02,-1031.3"/>
<text text-anchor="middle" x="1645" y="-1049.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_14_expert_7 -->
<g id="node179" class="node">
<title>layer_14_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2222,-1027.74 1962,-1027.74 1962,-944.74 2222,-944.74 2222,-1027.74"/>
<text text-anchor="middle" x="2092" y="-1012.54" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2092" y="-997.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2092" y="-982.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2092" y="-967.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2092" y="-952.54" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_14_gate&#45;&gt;layer_14_expert_7 -->
<g id="edge290" class="edge">
<title>layer_14_gate&#45;&gt;layer_14_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1357.78,-1110.93C1491.44,-1098.72 1735.85,-1072.61 1951.99,-1027.87"/>
<polygon fill="black" stroke="black" points="1952.86,-1031.26 1961.93,-1025.79 1951.43,-1024.41 1952.86,-1031.26"/>
<text text-anchor="middle" x="1909" y="-1049.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_14_expert_agg -->
<g id="node180" class="node">
<title>layer_14_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="1382,-907.74 1134,-907.74 1134,-824.74 1382,-824.74 1382,-907.74"/>
<text text-anchor="middle" x="1258" y="-892.54" font-family="Times,serif" font-size="14.00">Layer 14</text>
<text text-anchor="middle" x="1258" y="-877.54" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1258" y="-862.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-847.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1258" y="-832.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_14_expert_0&#45;&gt;layer_14_expert_agg -->
<g id="edge291" class="edge">
<title>layer_14_expert_0&#45;&gt;layer_14_expert_agg</title>
<path fill="none" stroke="black" d="M276.03,-946.48C279.04,-945.87 282.03,-945.28 285,-944.74 581.03,-890.41 934.63,-874.17 1123.44,-869.31"/>
<polygon fill="black" stroke="black" points="1123.78,-872.8 1133.69,-869.05 1123.6,-865.8 1123.78,-872.8"/>
</g>
<!-- layer_14_expert_1&#45;&gt;layer_14_expert_agg -->
<g id="edge292" class="edge">
<title>layer_14_expert_1&#45;&gt;layer_14_expert_agg</title>
<path fill="none" stroke="black" d="M554.05,-946.61C557.06,-945.96 560.04,-945.33 563,-944.74 756,-906.16 983.26,-885.37 1124,-875.3"/>
<polygon fill="black" stroke="black" points="1124.25,-878.79 1133.98,-874.59 1123.76,-871.81 1124.25,-878.79"/>
</g>
<!-- layer_14_expert_2&#45;&gt;layer_14_expert_agg -->
<g id="edge293" class="edge">
<title>layer_14_expert_2&#45;&gt;layer_14_expert_agg</title>
<path fill="none" stroke="black" d="M832.12,-946.9C835.1,-946.16 838.07,-945.44 841,-944.74 934.79,-922.42 1041.72,-902.66 1123.81,-888.68"/>
<polygon fill="black" stroke="black" points="1124.43,-892.12 1133.7,-887 1123.26,-885.22 1124.43,-892.12"/>
</g>
<!-- layer_14_expert_3&#45;&gt;layer_14_expert_agg -->
<g id="edge294" class="edge">
<title>layer_14_expert_3&#45;&gt;layer_14_expert_agg</title>
<path fill="none" stroke="black" d="M1075.67,-944.63C1100.57,-934.06 1127.53,-922.62 1152.89,-911.86"/>
<polygon fill="black" stroke="black" points="1154.31,-915.05 1162.15,-907.92 1151.58,-908.61 1154.31,-915.05"/>
</g>
<!-- layer_14_expert_4&#45;&gt;layer_14_expert_agg -->
<g id="edge295" class="edge">
<title>layer_14_expert_4&#45;&gt;layer_14_expert_agg</title>
<path fill="none" stroke="black" d="M1258,-944.63C1258,-936.1 1258,-927 1258,-918.15"/>
<polygon fill="black" stroke="black" points="1261.5,-917.92 1258,-907.92 1254.5,-917.92 1261.5,-917.92"/>
</g>
<!-- layer_14_expert_5&#45;&gt;layer_14_expert_agg -->
<g id="edge296" class="edge">
<title>layer_14_expert_5&#45;&gt;layer_14_expert_agg</title>
<path fill="none" stroke="black" d="M1440.33,-944.63C1415.43,-934.06 1388.47,-922.62 1363.11,-911.86"/>
<polygon fill="black" stroke="black" points="1364.42,-908.61 1353.85,-907.92 1361.69,-915.05 1364.42,-908.61"/>
</g>
<!-- layer_14_expert_6&#45;&gt;layer_14_expert_agg -->
<g id="edge297" class="edge">
<title>layer_14_expert_6&#45;&gt;layer_14_expert_agg</title>
<path fill="none" stroke="black" d="M1683.88,-946.9C1680.9,-946.16 1677.93,-945.44 1675,-944.74 1581.21,-922.42 1474.28,-902.66 1392.19,-888.68"/>
<polygon fill="black" stroke="black" points="1392.74,-885.22 1382.3,-887 1391.57,-892.12 1392.74,-885.22"/>
</g>
<!-- layer_14_expert_7&#45;&gt;layer_14_expert_agg -->
<g id="edge298" class="edge">
<title>layer_14_expert_7&#45;&gt;layer_14_expert_agg</title>
<path fill="none" stroke="black" d="M1961.95,-946.61C1958.94,-945.96 1955.96,-945.33 1953,-944.74 1760,-906.16 1532.74,-885.37 1392,-875.3"/>
<polygon fill="black" stroke="black" points="1392.24,-871.81 1382.02,-874.59 1391.75,-878.79 1392.24,-871.81"/>
</g>
<!-- layer_14_expert_agg&#45;&gt;layer_14_residual -->
<g id="edge300" class="edge">
<title>layer_14_expert_agg&#45;&gt;layer_14_residual</title>
<path fill="none" stroke="black" d="M1382.27,-843.32C1486.54,-824.93 1636.66,-798.45 1752.91,-777.95"/>
<polygon fill="black" stroke="black" points="1753.74,-781.35 1762.98,-776.17 1752.53,-774.46 1753.74,-781.35"/>
</g>
<!-- layer_15_mha -->
<g id="node182" class="node">
<title>layer_15_mha</title>
<polygon fill="lightblue" stroke="black" points="2028.5,-667.74 1825.5,-667.74 1825.5,-584.74 2028.5,-584.74 2028.5,-667.74"/>
<text text-anchor="middle" x="1927" y="-652.54" font-family="Times,serif" font-size="14.00">Layer 15</text>
<text text-anchor="middle" x="1927" y="-637.54" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1927" y="-622.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-607.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1927" y="-592.54" font-family="Times,serif" font-size="14.00">TP=8 across GPUs 8&#45;15</text>
</g>
<!-- layer_14_residual&#45;&gt;layer_15_mha -->
<g id="edge301" class="edge">
<title>layer_14_residual&#45;&gt;layer_15_mha</title>
<path fill="none" stroke="black" d="M1927,-704.63C1927,-696.1 1927,-687 1927,-678.15"/>
<polygon fill="black" stroke="black" points="1930.5,-677.92 1927,-667.92 1923.5,-677.92 1930.5,-677.92"/>
</g>
<!-- layer_15_gate -->
<g id="node183" class="node">
<title>layer_15_gate</title>
<polygon fill="lightblue" stroke="black" points="1357.5,-547.74 1158.5,-547.74 1158.5,-464.74 1357.5,-464.74 1357.5,-547.74"/>
<text text-anchor="middle" x="1258" y="-532.54" font-family="Times,serif" font-size="14.00">Layer 15</text>
<text text-anchor="middle" x="1258" y="-517.54" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="1258" y="-502.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="1258" y="-487.54" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="1258" y="-472.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_15_mha&#45;&gt;layer_15_gate -->
<g id="edge302" class="edge">
<title>layer_15_mha&#45;&gt;layer_15_gate</title>
<path fill="none" stroke="black" d="M1825.39,-607.32C1701.99,-585.55 1494.63,-548.98 1367.69,-526.59"/>
<polygon fill="black" stroke="black" points="1368.01,-523.09 1357.55,-524.8 1366.79,-529.98 1368.01,-523.09"/>
</g>
<!-- layer_15_residual -->
<g id="node193" class="node">
<title>layer_15_residual</title>
<polygon fill="lightblue" stroke="black" points="1868,-173.74 1540,-173.74 1540,-90.74 1868,-90.74 1868,-173.74"/>
<text text-anchor="middle" x="1704" y="-158.54" font-family="Times,serif" font-size="14.00">Layer 15</text>
<text text-anchor="middle" x="1704" y="-143.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="1704" y="-128.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="1704" y="-113.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1704" y="-98.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_15_mha&#45;&gt;layer_15_residual -->
<g id="edge319" class="edge">
<title>layer_15_mha&#45;&gt;layer_15_residual</title>
<path fill="none" stroke="black" d="M2028.56,-609.1C2125.86,-590.68 2258,-556.58 2258,-507.24 2258,-507.24 2258,-507.24 2258,-251.24 2258,-172.44 2040.86,-146.05 1878.47,-137.34"/>
<polygon fill="black" stroke="black" points="1878.51,-133.84 1868.34,-136.82 1878.15,-140.83 1878.51,-133.84"/>
<text text-anchor="middle" x="2286" y="-368.54" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_15_expert_0 -->
<g id="node184" class="node">
<title>layer_15_expert_0</title>
<polygon fill="lightblue" stroke="black" points="276,-413.74 16,-413.74 16,-330.74 276,-330.74 276,-413.74"/>
<text text-anchor="middle" x="146" y="-398.54" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="146" y="-383.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="146" y="-368.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="146" y="-353.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="146" y="-338.54" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_15_gate&#45;&gt;layer_15_expert_0 -->
<g id="edge303" class="edge">
<title>layer_15_gate&#45;&gt;layer_15_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.19,-503.04C982.57,-497.6 607.29,-478.94 286.03,-413.86"/>
<polygon fill="black" stroke="black" points="286.56,-410.4 276.06,-411.82 285.16,-417.25 286.56,-410.4"/>
<text text-anchor="middle" x="519" y="-435.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_15_expert_1 -->
<g id="node185" class="node">
<title>layer_15_expert_1</title>
<polygon fill="lightblue" stroke="black" points="554,-413.74 294,-413.74 294,-330.74 554,-330.74 554,-413.74"/>
<text text-anchor="middle" x="424" y="-398.54" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="424" y="-383.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="424" y="-368.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="424" y="-353.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="424" y="-338.54" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_15_gate&#45;&gt;layer_15_expert_1 -->
<g id="edge304" class="edge">
<title>layer_15_gate&#45;&gt;layer_15_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.22,-496.93C1024.56,-484.72 780.15,-458.61 564.01,-413.87"/>
<polygon fill="black" stroke="black" points="564.57,-410.41 554.07,-411.79 563.14,-417.26 564.57,-410.41"/>
<text text-anchor="middle" x="783" y="-435.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_15_expert_2 -->
<g id="node186" class="node">
<title>layer_15_expert_2</title>
<polygon fill="lightblue" stroke="black" points="832,-413.74 572,-413.74 572,-330.74 832,-330.74 832,-413.74"/>
<text text-anchor="middle" x="702" y="-398.54" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="702" y="-383.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="702" y="-368.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="702" y="-353.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="702" y="-338.54" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_15_gate&#45;&gt;layer_15_expert_2 -->
<g id="edge305" class="edge">
<title>layer_15_gate&#45;&gt;layer_15_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1158.13,-485.3C1075.78,-468.4 955.76,-442.72 842.07,-413.97"/>
<polygon fill="black" stroke="black" points="842.7,-410.52 832.15,-411.45 840.98,-417.3 842.7,-410.52"/>
<text text-anchor="middle" x="1027" y="-435.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_15_expert_3 -->
<g id="node187" class="node">
<title>layer_15_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1110,-413.74 850,-413.74 850,-330.74 1110,-330.74 1110,-413.74"/>
<text text-anchor="middle" x="980" y="-398.54" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="980" y="-383.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="980" y="-368.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="980" y="-353.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="980" y="-338.54" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_15_gate&#45;&gt;layer_15_expert_3 -->
<g id="edge306" class="edge">
<title>layer_15_gate&#45;&gt;layer_15_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1172.7,-464.74C1141.76,-450.05 1106.62,-433.36 1074.9,-418.3"/>
<polygon fill="black" stroke="black" points="1076.15,-415.02 1065.62,-413.89 1073.15,-421.34 1076.15,-415.02"/>
<text text-anchor="middle" x="1177" y="-435.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_15_expert_4 -->
<g id="node188" class="node">
<title>layer_15_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1388,-413.74 1128,-413.74 1128,-330.74 1388,-330.74 1388,-413.74"/>
<text text-anchor="middle" x="1258" y="-398.54" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1258" y="-383.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1258" y="-368.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-353.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-338.54" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_15_gate&#45;&gt;layer_15_expert_4 -->
<g id="edge307" class="edge">
<title>layer_15_gate&#45;&gt;layer_15_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1258,-464.56C1258,-451.76 1258,-437.47 1258,-424.06"/>
<polygon fill="black" stroke="black" points="1261.5,-424.01 1258,-414.01 1254.5,-424.01 1261.5,-424.01"/>
<text text-anchor="middle" x="1308" y="-435.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_15_expert_5 -->
<g id="node189" class="node">
<title>layer_15_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1666,-413.74 1406,-413.74 1406,-330.74 1666,-330.74 1666,-413.74"/>
<text text-anchor="middle" x="1536" y="-398.54" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1536" y="-383.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1536" y="-368.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1536" y="-353.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1536" y="-338.54" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_15_gate&#45;&gt;layer_15_expert_5 -->
<g id="edge308" class="edge">
<title>layer_15_gate&#45;&gt;layer_15_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1343.3,-464.74C1374.24,-450.05 1409.38,-433.36 1441.1,-418.3"/>
<polygon fill="black" stroke="black" points="1442.85,-421.34 1450.38,-413.89 1439.85,-415.02 1442.85,-421.34"/>
<text text-anchor="middle" x="1455" y="-435.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_15_expert_6 -->
<g id="node190" class="node">
<title>layer_15_expert_6</title>
<polygon fill="lightblue" stroke="black" points="1944,-413.74 1684,-413.74 1684,-330.74 1944,-330.74 1944,-413.74"/>
<text text-anchor="middle" x="1814" y="-398.54" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1814" y="-383.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1814" y="-368.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1814" y="-353.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1814" y="-338.54" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_15_gate&#45;&gt;layer_15_expert_6 -->
<g id="edge309" class="edge">
<title>layer_15_gate&#45;&gt;layer_15_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1357.87,-485.3C1440.22,-468.4 1560.24,-442.72 1673.93,-413.97"/>
<polygon fill="black" stroke="black" points="1675.02,-417.3 1683.85,-411.45 1673.3,-410.52 1675.02,-417.3"/>
<text text-anchor="middle" x="1645" y="-435.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_15_expert_7 -->
<g id="node191" class="node">
<title>layer_15_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2222,-413.74 1962,-413.74 1962,-330.74 2222,-330.74 2222,-413.74"/>
<text text-anchor="middle" x="2092" y="-398.54" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2092" y="-383.54" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2092" y="-368.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2092" y="-353.54" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2092" y="-338.54" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_15_gate&#45;&gt;layer_15_expert_7 -->
<g id="edge310" class="edge">
<title>layer_15_gate&#45;&gt;layer_15_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1357.78,-496.93C1491.44,-484.72 1735.85,-458.61 1951.99,-413.87"/>
<polygon fill="black" stroke="black" points="1952.86,-417.26 1961.93,-411.79 1951.43,-410.41 1952.86,-417.26"/>
<text text-anchor="middle" x="1909" y="-435.54" font-family="Times,serif" font-size="14.00">routed tokens</text>
</g>
<!-- layer_15_expert_agg -->
<g id="node192" class="node">
<title>layer_15_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="1382,-293.74 1134,-293.74 1134,-210.74 1382,-210.74 1382,-293.74"/>
<text text-anchor="middle" x="1258" y="-278.54" font-family="Times,serif" font-size="14.00">Layer 15</text>
<text text-anchor="middle" x="1258" y="-263.54" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="1258" y="-248.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1258" y="-233.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="1258" y="-218.54" font-family="Times,serif" font-size="14.00">GPU: all 8 GPUs</text>
</g>
<!-- layer_15_expert_0&#45;&gt;layer_15_expert_agg -->
<g id="edge311" class="edge">
<title>layer_15_expert_0&#45;&gt;layer_15_expert_agg</title>
<path fill="none" stroke="black" d="M276.03,-332.48C279.04,-331.87 282.03,-331.28 285,-330.74 581.03,-276.41 934.63,-260.17 1123.44,-255.31"/>
<polygon fill="black" stroke="black" points="1123.78,-258.8 1133.69,-255.05 1123.6,-251.8 1123.78,-258.8"/>
</g>
<!-- layer_15_expert_1&#45;&gt;layer_15_expert_agg -->
<g id="edge312" class="edge">
<title>layer_15_expert_1&#45;&gt;layer_15_expert_agg</title>
<path fill="none" stroke="black" d="M554.05,-332.61C557.06,-331.96 560.04,-331.33 563,-330.74 756,-292.16 983.26,-271.37 1124,-261.3"/>
<polygon fill="black" stroke="black" points="1124.25,-264.79 1133.98,-260.59 1123.76,-257.81 1124.25,-264.79"/>
</g>
<!-- layer_15_expert_2&#45;&gt;layer_15_expert_agg -->
<g id="edge313" class="edge">
<title>layer_15_expert_2&#45;&gt;layer_15_expert_agg</title>
<path fill="none" stroke="black" d="M832.12,-332.9C835.1,-332.16 838.07,-331.44 841,-330.74 934.79,-308.42 1041.72,-288.66 1123.81,-274.68"/>
<polygon fill="black" stroke="black" points="1124.43,-278.12 1133.7,-273 1123.26,-271.22 1124.43,-278.12"/>
</g>
<!-- layer_15_expert_3&#45;&gt;layer_15_expert_agg -->
<g id="edge314" class="edge">
<title>layer_15_expert_3&#45;&gt;layer_15_expert_agg</title>
<path fill="none" stroke="black" d="M1075.67,-330.63C1100.57,-320.06 1127.53,-308.62 1152.89,-297.86"/>
<polygon fill="black" stroke="black" points="1154.31,-301.05 1162.15,-293.92 1151.58,-294.61 1154.31,-301.05"/>
</g>
<!-- layer_15_expert_4&#45;&gt;layer_15_expert_agg -->
<g id="edge315" class="edge">
<title>layer_15_expert_4&#45;&gt;layer_15_expert_agg</title>
<path fill="none" stroke="black" d="M1258,-330.63C1258,-322.1 1258,-313 1258,-304.15"/>
<polygon fill="black" stroke="black" points="1261.5,-303.92 1258,-293.92 1254.5,-303.92 1261.5,-303.92"/>
</g>
<!-- layer_15_expert_5&#45;&gt;layer_15_expert_agg -->
<g id="edge316" class="edge">
<title>layer_15_expert_5&#45;&gt;layer_15_expert_agg</title>
<path fill="none" stroke="black" d="M1440.33,-330.63C1415.43,-320.06 1388.47,-308.62 1363.11,-297.86"/>
<polygon fill="black" stroke="black" points="1364.42,-294.61 1353.85,-293.92 1361.69,-301.05 1364.42,-294.61"/>
</g>
<!-- layer_15_expert_6&#45;&gt;layer_15_expert_agg -->
<g id="edge317" class="edge">
<title>layer_15_expert_6&#45;&gt;layer_15_expert_agg</title>
<path fill="none" stroke="black" d="M1683.88,-332.9C1680.9,-332.16 1677.93,-331.44 1675,-330.74 1581.21,-308.42 1474.28,-288.66 1392.19,-274.68"/>
<polygon fill="black" stroke="black" points="1392.74,-271.22 1382.3,-273 1391.57,-278.12 1392.74,-271.22"/>
</g>
<!-- layer_15_expert_7&#45;&gt;layer_15_expert_agg -->
<g id="edge318" class="edge">
<title>layer_15_expert_7&#45;&gt;layer_15_expert_agg</title>
<path fill="none" stroke="black" d="M1961.95,-332.61C1958.94,-331.96 1955.96,-331.33 1953,-330.74 1760,-292.16 1532.74,-271.37 1392,-261.3"/>
<polygon fill="black" stroke="black" points="1392.24,-257.81 1382.02,-260.59 1391.75,-264.79 1392.24,-257.81"/>
</g>
<!-- layer_15_expert_agg&#45;&gt;layer_15_residual -->
<g id="edge320" class="edge">
<title>layer_15_expert_agg&#45;&gt;layer_15_residual</title>
<path fill="none" stroke="black" d="M1382.24,-218.37C1431.37,-205.37 1488.52,-190.25 1540.91,-176.39"/>
<polygon fill="black" stroke="black" points="1541.86,-179.76 1550.64,-173.82 1540.07,-172.99 1541.86,-179.76"/>
</g>
<!-- output -->
<g id="node194" class="node">
<title>output</title>
<ellipse fill="lightgreen" stroke="black" cx="1704" cy="-26.87" rx="268.9" ry="26.74"/>
<text text-anchor="middle" x="1704" y="-30.67" font-family="Times,serif" font-size="14.00">Model Output</text>
<text text-anchor="middle" x="1704" y="-15.67" font-family="Times,serif" font-size="14.00">batch_size=128, seq_len=10000, token_dim=4096</text>
</g>
<!-- layer_15_residual&#45;&gt;output -->
<g id="edge321" class="edge">
<title>layer_15_residual&#45;&gt;output</title>
<path fill="none" stroke="black" d="M1704,-90.68C1704,-81.92 1704,-72.7 1704,-64.11"/>
<polygon fill="black" stroke="black" points="1707.5,-64.02 1704,-54.02 1700.5,-64.02 1707.5,-64.02"/>
</g>
</g>
</svg>
