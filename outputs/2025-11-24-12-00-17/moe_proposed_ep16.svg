<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: MoE_Large_EP16_CrossNode Pages: 1 -->
<svg width="1153pt" height="2160pt"
 viewBox="0.00 0.00 1152.89 2160.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.14 0.14) rotate(0) translate(4 14912.63)">
<title>MoE_Large_EP16_CrossNode</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-14912.63 7957.7,-14912.63 7957.7,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="lightgreen" stroke="black" cx="4402" cy="-14881.76" rx="268.9" ry="26.74"/>
<text text-anchor="middle" x="4402" y="-14885.56" font-family="Times,serif" font-size="14.00">Model Input</text>
<text text-anchor="middle" x="4402" y="-14870.56" font-family="Times,serif" font-size="14.00">batch_size=128, seq_len=10000, token_dim=4096</text>
</g>
<!-- layer_0_mha -->
<g id="node2" class="node">
<title>layer_0_mha</title>
<polygon fill="lightblue" stroke="black" points="4503.5,-14817.89 4300.5,-14817.89 4300.5,-14734.89 4503.5,-14734.89 4503.5,-14817.89"/>
<text text-anchor="middle" x="4402" y="-14802.69" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="4402" y="-14787.69" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="4402" y="-14772.69" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4402" y="-14757.69" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="4402" y="-14742.69" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- input&#45;&gt;layer_0_mha -->
<g id="edge1" class="edge">
<title>input&#45;&gt;layer_0_mha</title>
<path fill="none" stroke="black" d="M4402,-14854.68C4402,-14846.59 4402,-14837.39 4402,-14828.23"/>
<polygon fill="black" stroke="black" points="4405.5,-14827.96 4402,-14817.96 4398.5,-14827.96 4405.5,-14827.96"/>
</g>
<!-- layer_0_gate -->
<g id="node3" class="node">
<title>layer_0_gate</title>
<polygon fill="lightblue" stroke="black" points="3941.5,-14697.89 3742.5,-14697.89 3742.5,-14614.89 3941.5,-14614.89 3941.5,-14697.89"/>
<text text-anchor="middle" x="3842" y="-14682.69" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="3842" y="-14667.69" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="3842" y="-14652.69" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="3842" y="-14637.69" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="3842" y="-14622.69" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_0_mha&#45;&gt;layer_0_gate -->
<g id="edge2" class="edge">
<title>layer_0_mha&#45;&gt;layer_0_gate</title>
<path fill="none" stroke="black" d="M4300.26,-14753.95C4201.69,-14733.18 4052.67,-14701.78 3951.54,-14680.47"/>
<polygon fill="black" stroke="black" points="3952.1,-14677.01 3941.6,-14678.38 3950.66,-14683.86 3952.1,-14677.01"/>
</g>
<!-- layer_0_residual -->
<g id="node23" class="node">
<title>layer_0_residual</title>
<polygon fill="lightblue" stroke="black" points="4554,-14015.13 4226,-14015.13 4226,-13932.13 4554,-13932.13 4554,-14015.13"/>
<text text-anchor="middle" x="4390" y="-13999.93" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="4390" y="-13984.93" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4390" y="-13969.93" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="4390" y="-13954.93" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="4390" y="-13939.93" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_0_mha&#45;&gt;layer_0_residual -->
<g id="edge37" class="edge">
<title>layer_0_mha&#45;&gt;layer_0_residual</title>
<path fill="none" stroke="black" d="M4436.81,-14734.81C4451.82,-14713.26 4466,-14685.47 4466,-14657.39 4466,-14657.39 4466,-14657.39 4466,-14092.63 4466,-14067.25 4453.42,-14042.99 4438.5,-14023.14"/>
<polygon fill="black" stroke="black" points="4441.17,-14020.88 4432.22,-14015.2 4435.67,-14025.21 4441.17,-14020.88"/>
<text text-anchor="middle" x="4494" y="-14364.31" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_0_all2all -->
<g id="node4" class="node">
<title>layer_0_all2all</title>
<ellipse fill="yellow" stroke="black" cx="2354" cy="-14519.2" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="2354" y="-14545.5" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="2354" y="-14530.5" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="2354" y="-14515.5" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="2354" y="-14500.5" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="2354" y="-14485.5" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_0_gate&#45;&gt;layer_0_all2all -->
<g id="edge3" class="edge">
<title>layer_0_gate&#45;&gt;layer_0_all2all</title>
<path fill="none" stroke="black" d="M3742.35,-14646.34C3485.76,-14623.03 2801.46,-14560.85 2500.03,-14533.47"/>
<polygon fill="black" stroke="black" points="2500.18,-14529.97 2489.91,-14532.55 2499.55,-14536.94 2500.18,-14529.97"/>
</g>
<!-- layer_0_expert_0 -->
<g id="node5" class="node">
<title>layer_0_expert_0</title>
<polygon fill="lightblue" stroke="black" points="260,-14409.51 0,-14409.51 0,-14326.51 260,-14326.51 260,-14409.51"/>
<text text-anchor="middle" x="130" y="-14394.31" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="130" y="-14379.31" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="130" y="-14364.31" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="130" y="-14349.31" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="130" y="-14334.31" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_0_all2all&#45;&gt;layer_0_expert_0 -->
<g id="edge4" class="edge">
<title>layer_0_all2all&#45;&gt;layer_0_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2214.94,-14515.55C1834.13,-14507.84 779.87,-14483.34 435,-14442.51 380.37,-14436.05 321.38,-14423.24 269.97,-14410.11"/>
<polygon fill="black" stroke="black" points="270.68,-14406.68 260.13,-14407.57 268.93,-14413.46 270.68,-14406.68"/>
<text text-anchor="middle" x="526.5" y="-14431.31" font-family="Times,serif" font-size="14.00">tokens routed to expert 0</text>
</g>
<!-- layer_0_expert_1 -->
<g id="node6" class="node">
<title>layer_0_expert_1</title>
<polygon fill="lightblue" stroke="black" points="538,-14409.51 278,-14409.51 278,-14326.51 538,-14326.51 538,-14409.51"/>
<text text-anchor="middle" x="408" y="-14394.31" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="408" y="-14379.31" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="408" y="-14364.31" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="408" y="-14349.31" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="408" y="-14334.31" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_0_all2all&#45;&gt;layer_0_expert_1 -->
<g id="edge5" class="edge">
<title>layer_0_all2all&#45;&gt;layer_0_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2214.47,-14518.69C1930.9,-14518.16 1267.35,-14509.14 715,-14442.51 642.55,-14433.77 622.55,-14427.99 548,-14409.72"/>
<polygon fill="black" stroke="black" points="548.67,-14406.28 538.13,-14407.31 547.01,-14413.08 548.67,-14406.28"/>
<text text-anchor="middle" x="806.5" y="-14431.31" font-family="Times,serif" font-size="14.00">tokens routed to expert 1</text>
</g>
<!-- layer_0_expert_2 -->
<g id="node7" class="node">
<title>layer_0_expert_2</title>
<polygon fill="lightblue" stroke="black" points="816,-14409.51 556,-14409.51 556,-14326.51 816,-14326.51 816,-14409.51"/>
<text text-anchor="middle" x="686" y="-14394.31" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="686" y="-14379.31" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="686" y="-14364.31" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="686" y="-14349.31" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="686" y="-14334.31" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_0_all2all&#45;&gt;layer_0_expert_2 -->
<g id="edge6" class="edge">
<title>layer_0_all2all&#45;&gt;layer_0_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2214.43,-14517.3C1966.12,-14514.17 1431.72,-14500.6 985,-14442.51 932.45,-14435.68 875.75,-14423.11 826.01,-14410.28"/>
<polygon fill="black" stroke="black" points="826.72,-14406.85 816.16,-14407.71 824.95,-14413.62 826.72,-14406.85"/>
<text text-anchor="middle" x="1076.5" y="-14431.31" font-family="Times,serif" font-size="14.00">tokens routed to expert 2</text>
</g>
<!-- layer_0_expert_3 -->
<g id="node8" class="node">
<title>layer_0_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1094,-14409.51 834,-14409.51 834,-14326.51 1094,-14326.51 1094,-14409.51"/>
<text text-anchor="middle" x="964" y="-14394.31" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="964" y="-14379.31" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="964" y="-14364.31" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="964" y="-14349.31" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="964" y="-14334.31" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_0_all2all&#45;&gt;layer_0_expert_3 -->
<g id="edge7" class="edge">
<title>layer_0_all2all&#45;&gt;layer_0_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2214.81,-14516.17C2003.29,-14511.42 1588.74,-14495.53 1241,-14442.51 1195.62,-14435.59 1146.96,-14424.11 1103.29,-14412.26"/>
<polygon fill="black" stroke="black" points="1104.04,-14408.83 1093.47,-14409.56 1102.19,-14415.58 1104.04,-14408.83"/>
<text text-anchor="middle" x="1332.5" y="-14431.31" font-family="Times,serif" font-size="14.00">tokens routed to expert 3</text>
</g>
<!-- layer_0_expert_4 -->
<g id="node9" class="node">
<title>layer_0_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1372,-14409.51 1112,-14409.51 1112,-14326.51 1372,-14326.51 1372,-14409.51"/>
<text text-anchor="middle" x="1242" y="-14394.31" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1242" y="-14379.31" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1242" y="-14364.31" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1242" y="-14349.31" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1242" y="-14334.31" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_0_all2all&#45;&gt;layer_0_expert_4 -->
<g id="edge8" class="edge">
<title>layer_0_all2all&#45;&gt;layer_0_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2214.78,-14514.59C2043.04,-14508.17 1742.77,-14490.54 1490,-14442.51 1450.65,-14435.04 1408.62,-14423.85 1370.55,-14412.44"/>
<polygon fill="black" stroke="black" points="1371.54,-14409.09 1360.96,-14409.54 1369.51,-14415.78 1371.54,-14409.09"/>
<text text-anchor="middle" x="1581.5" y="-14431.31" font-family="Times,serif" font-size="14.00">tokens routed to expert 4</text>
</g>
<!-- layer_0_expert_5 -->
<g id="node10" class="node">
<title>layer_0_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1650,-14409.51 1390,-14409.51 1390,-14326.51 1650,-14326.51 1650,-14409.51"/>
<text text-anchor="middle" x="1520" y="-14394.31" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1520" y="-14379.31" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1520" y="-14364.31" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1520" y="-14349.31" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1520" y="-14334.31" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_0_all2all&#45;&gt;layer_0_expert_5 -->
<g id="edge9" class="edge">
<title>layer_0_all2all&#45;&gt;layer_0_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2216.18,-14510.06C2088.75,-14500.52 1894.74,-14480.86 1730,-14442.51 1697.44,-14434.93 1662.89,-14424.08 1631.43,-14413.03"/>
<polygon fill="black" stroke="black" points="1632.36,-14409.65 1621.76,-14409.6 1630.02,-14416.24 1632.36,-14409.65"/>
<text text-anchor="middle" x="1821.5" y="-14431.31" font-family="Times,serif" font-size="14.00">tokens routed to expert 5</text>
</g>
<!-- layer_0_expert_6 -->
<g id="node11" class="node">
<title>layer_0_expert_6</title>
<polygon fill="lightblue" stroke="black" points="1928,-14409.51 1668,-14409.51 1668,-14326.51 1928,-14326.51 1928,-14409.51"/>
<text text-anchor="middle" x="1798" y="-14394.31" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="1798" y="-14379.31" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1798" y="-14364.31" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1798" y="-14349.31" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1798" y="-14334.31" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_0_all2all&#45;&gt;layer_0_expert_6 -->
<g id="edge10" class="edge">
<title>layer_0_all2all&#45;&gt;layer_0_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2221.36,-14501.05C2143.49,-14488.96 2043.83,-14469.98 1958,-14442.51 1933.84,-14434.78 1908.53,-14424.34 1885.36,-14413.75"/>
<polygon fill="black" stroke="black" points="1886.79,-14410.56 1876.25,-14409.54 1883.85,-14416.91 1886.79,-14410.56"/>
<text text-anchor="middle" x="2049.5" y="-14431.31" font-family="Times,serif" font-size="14.00">tokens routed to expert 6</text>
</g>
<!-- layer_0_expert_7 -->
<g id="node12" class="node">
<title>layer_0_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2206,-14409.51 1946,-14409.51 1946,-14326.51 2206,-14326.51 2206,-14409.51"/>
<text text-anchor="middle" x="2076" y="-14394.31" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2076" y="-14379.31" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2076" y="-14364.31" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2076" y="-14349.31" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2076" y="-14334.31" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_0_all2all&#45;&gt;layer_0_expert_7 -->
<g id="edge11" class="edge">
<title>layer_0_all2all&#45;&gt;layer_0_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2247.06,-14481.22C2220.17,-14470.24 2191.9,-14457.17 2167,-14442.51 2153.94,-14434.82 2140.75,-14425.37 2128.63,-14415.83"/>
<polygon fill="black" stroke="black" points="2130.82,-14413.1 2120.83,-14409.57 2126.44,-14418.56 2130.82,-14413.1"/>
<text text-anchor="middle" x="2258.5" y="-14431.31" font-family="Times,serif" font-size="14.00">tokens routed to expert 7</text>
</g>
<!-- layer_0_expert_8 -->
<g id="node13" class="node">
<title>layer_0_expert_8</title>
<polygon fill="lightblue" stroke="black" points="2484,-14409.51 2224,-14409.51 2224,-14326.51 2484,-14326.51 2484,-14409.51"/>
<text text-anchor="middle" x="2354" y="-14394.31" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="2354" y="-14379.31" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2354" y="-14364.31" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2354" y="-14349.31" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2354" y="-14334.31" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_0_all2all&#45;&gt;layer_0_expert_8 -->
<g id="edge12" class="edge">
<title>layer_0_all2all&#45;&gt;layer_0_expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2354,-14460.09C2354,-14446.79 2354,-14432.76 2354,-14419.8"/>
<polygon fill="black" stroke="black" points="2357.5,-14419.66 2354,-14409.66 2350.5,-14419.66 2357.5,-14419.66"/>
<text text-anchor="middle" x="2445.5" y="-14431.31" font-family="Times,serif" font-size="14.00">tokens routed to expert 8</text>
</g>
<!-- layer_0_expert_9 -->
<g id="node14" class="node">
<title>layer_0_expert_9</title>
<polygon fill="lightblue" stroke="black" points="2762,-14409.51 2502,-14409.51 2502,-14326.51 2762,-14326.51 2762,-14409.51"/>
<text text-anchor="middle" x="2632" y="-14394.31" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="2632" y="-14379.31" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2632" y="-14364.31" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2632" y="-14349.31" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2632" y="-14334.31" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_0_all2all&#45;&gt;layer_0_expert_9 -->
<g id="edge13" class="edge">
<title>layer_0_all2all&#45;&gt;layer_0_expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2460.94,-14481.22C2487.83,-14470.24 2516.1,-14457.17 2541,-14442.51 2554.06,-14434.82 2567.25,-14425.37 2579.37,-14415.83"/>
<polygon fill="black" stroke="black" points="2581.56,-14418.56 2587.17,-14409.57 2577.18,-14413.1 2581.56,-14418.56"/>
<text text-anchor="middle" x="2653.5" y="-14431.31" font-family="Times,serif" font-size="14.00">tokens routed to expert 9</text>
</g>
<!-- layer_0_expert_10 -->
<g id="node15" class="node">
<title>layer_0_expert_10</title>
<polygon fill="lightblue" stroke="black" points="3040,-14409.51 2780,-14409.51 2780,-14326.51 3040,-14326.51 3040,-14409.51"/>
<text text-anchor="middle" x="2910" y="-14394.31" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="2910" y="-14379.31" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2910" y="-14364.31" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2910" y="-14349.31" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2910" y="-14334.31" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_0_all2all&#45;&gt;layer_0_expert_10 -->
<g id="edge14" class="edge">
<title>layer_0_all2all&#45;&gt;layer_0_expert_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2486.73,-14500.87C2564.33,-14488.74 2663.52,-14469.78 2749,-14442.51 2773.29,-14434.76 2798.75,-14424.31 2822.07,-14413.73"/>
<polygon fill="black" stroke="black" points="2823.61,-14416.87 2831.24,-14409.51 2820.69,-14410.51 2823.61,-14416.87"/>
<text text-anchor="middle" x="2885" y="-14431.31" font-family="Times,serif" font-size="14.00">tokens routed to expert 10</text>
</g>
<!-- layer_0_expert_11 -->
<g id="node16" class="node">
<title>layer_0_expert_11</title>
<polygon fill="lightblue" stroke="black" points="3318,-14409.51 3058,-14409.51 3058,-14326.51 3318,-14326.51 3318,-14409.51"/>
<text text-anchor="middle" x="3188" y="-14394.31" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="3188" y="-14379.31" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3188" y="-14364.31" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3188" y="-14349.31" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3188" y="-14334.31" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_0_all2all&#45;&gt;layer_0_expert_11 -->
<g id="edge15" class="edge">
<title>layer_0_all2all&#45;&gt;layer_0_expert_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2491.9,-14510.73C2620.81,-14501.62 2817.95,-14482.22 2985,-14442.51 3016.51,-14435.02 3049.87,-14424.22 3080.25,-14413.19"/>
<polygon fill="black" stroke="black" points="3081.82,-14416.34 3090,-14409.6 3079.4,-14409.77 3081.82,-14416.34"/>
<text text-anchor="middle" x="3132" y="-14431.31" font-family="Times,serif" font-size="14.00">tokens routed to expert 11</text>
</g>
<!-- layer_0_expert_12 -->
<g id="node17" class="node">
<title>layer_0_expert_12</title>
<polygon fill="lightblue" stroke="black" points="3596,-14409.51 3336,-14409.51 3336,-14326.51 3596,-14326.51 3596,-14409.51"/>
<text text-anchor="middle" x="3466" y="-14394.31" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="3466" y="-14379.31" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3466" y="-14364.31" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3466" y="-14349.31" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3466" y="-14334.31" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_0_all2all&#45;&gt;layer_0_expert_12 -->
<g id="edge16" class="edge">
<title>layer_0_all2all&#45;&gt;layer_0_expert_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2493.31,-14515.55C2667.58,-14510.1 2974.41,-14493.43 3232,-14442.51 3269.2,-14435.16 3308.83,-14424.03 3344.7,-14412.64"/>
<polygon fill="black" stroke="black" points="3345.77,-14415.97 3354.22,-14409.58 3343.63,-14409.31 3345.77,-14415.97"/>
<text text-anchor="middle" x="3386" y="-14431.31" font-family="Times,serif" font-size="14.00">tokens routed to expert 12</text>
</g>
<!-- layer_0_expert_13 -->
<g id="node18" class="node">
<title>layer_0_expert_13</title>
<polygon fill="lightblue" stroke="black" points="3874,-14409.51 3614,-14409.51 3614,-14326.51 3874,-14326.51 3874,-14409.51"/>
<text text-anchor="middle" x="3744" y="-14394.31" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="3744" y="-14379.31" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3744" y="-14364.31" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3744" y="-14349.31" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3744" y="-14334.31" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_0_all2all&#45;&gt;layer_0_expert_13 -->
<g id="edge17" class="edge">
<title>layer_0_all2all&#45;&gt;layer_0_expert_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2493.61,-14517.98C2708.38,-14515.59 3132.12,-14502.76 3486,-14442.51 3527.67,-14435.42 3572.23,-14424.11 3612.38,-14412.48"/>
<polygon fill="black" stroke="black" points="3613.61,-14415.76 3622.22,-14409.59 3611.64,-14409.05 3613.61,-14415.76"/>
<text text-anchor="middle" x="3646" y="-14431.31" font-family="Times,serif" font-size="14.00">tokens routed to expert 13</text>
</g>
<!-- layer_0_expert_14 -->
<g id="node19" class="node">
<title>layer_0_expert_14</title>
<polygon fill="lightblue" stroke="black" points="4152,-14409.51 3892,-14409.51 3892,-14326.51 4152,-14326.51 4152,-14409.51"/>
<text text-anchor="middle" x="4022" y="-14394.31" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="4022" y="-14379.31" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4022" y="-14364.31" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4022" y="-14349.31" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4022" y="-14334.31" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_0_all2all&#45;&gt;layer_0_expert_14 -->
<g id="edge18" class="edge">
<title>layer_0_all2all&#45;&gt;layer_0_expert_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2493.63,-14518.98C2745.34,-14518.53 3291.3,-14509.07 3746,-14442.51 3791.73,-14435.82 3840.74,-14424.26 3884.59,-14412.26"/>
<polygon fill="black" stroke="black" points="3885.74,-14415.57 3894.45,-14409.53 3883.87,-14408.82 3885.74,-14415.57"/>
<text text-anchor="middle" x="3918" y="-14431.31" font-family="Times,serif" font-size="14.00">tokens routed to expert 14</text>
</g>
<!-- layer_0_expert_15 -->
<g id="node20" class="node">
<title>layer_0_expert_15</title>
<polygon fill="lightblue" stroke="black" points="4430,-14409.51 4170,-14409.51 4170,-14326.51 4430,-14326.51 4430,-14409.51"/>
<text text-anchor="middle" x="4300" y="-14394.31" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="4300" y="-14379.31" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4300" y="-14364.31" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4300" y="-14349.31" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4300" y="-14334.31" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_0_all2all&#45;&gt;layer_0_expert_15 -->
<g id="edge19" class="edge">
<title>layer_0_all2all&#45;&gt;layer_0_expert_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2493.05,-14515.12C2837.75,-14506.97 3724.95,-14482.65 4018,-14442.51 4065.17,-14436.05 4115.76,-14424.41 4160.89,-14412.27"/>
<polygon fill="black" stroke="black" points="4162,-14415.59 4170.73,-14409.59 4160.16,-14408.84 4162,-14415.59"/>
<text text-anchor="middle" x="4192" y="-14431.31" font-family="Times,serif" font-size="14.00">tokens routed to expert 15</text>
</g>
<!-- layer_0_all2all_result -->
<g id="node21" class="node">
<title>layer_0_all2all_result</title>
<ellipse fill="yellow" stroke="black" cx="2354" cy="-14230.82" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="2354" y="-14257.12" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="2354" y="-14242.12" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Result Merge</text>
<text text-anchor="middle" x="2354" y="-14227.12" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="2354" y="-14212.12" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="2354" y="-14197.12" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_0_expert_0&#45;&gt;layer_0_all2all_result -->
<g id="edge20" class="edge">
<title>layer_0_expert_0&#45;&gt;layer_0_all2all_result</title>
<path fill="none" stroke="black" d="M260,-14328.12C263.02,-14327.54 266.02,-14327.01 269,-14326.51 641.89,-14264.63 1791.76,-14240.72 2204.55,-14233.99"/>
<polygon fill="black" stroke="black" points="2204.81,-14237.49 2214.76,-14233.83 2204.7,-14230.49 2204.81,-14237.49"/>
</g>
<!-- layer_0_expert_1&#45;&gt;layer_0_all2all_result -->
<g id="edge21" class="edge">
<title>layer_0_expert_1&#45;&gt;layer_0_all2all_result</title>
<path fill="none" stroke="black" d="M538.01,-14328.14C541.03,-14327.56 544.03,-14327.02 547,-14326.51 864.38,-14272.7 1831.71,-14244.36 2204.92,-14235.2"/>
<polygon fill="black" stroke="black" points="2205.07,-14238.7 2214.98,-14234.95 2204.9,-14231.7 2205.07,-14238.7"/>
</g>
<!-- layer_0_expert_2&#45;&gt;layer_0_all2all_result -->
<g id="edge22" class="edge">
<title>layer_0_expert_2&#45;&gt;layer_0_all2all_result</title>
<path fill="none" stroke="black" d="M816.01,-14328.13C819.02,-14327.55 822.03,-14327.01 825,-14326.51 984.74,-14299.67 1027.29,-14317.83 1189,-14308.51 1555.21,-14287.41 1985.84,-14257.82 2206.81,-14242.28"/>
<polygon fill="black" stroke="black" points="2207.12,-14245.77 2216.85,-14241.58 2206.63,-14238.79 2207.12,-14245.77"/>
</g>
<!-- layer_0_expert_3&#45;&gt;layer_0_all2all_result -->
<g id="edge23" class="edge">
<title>layer_0_expert_3&#45;&gt;layer_0_all2all_result</title>
<path fill="none" stroke="black" d="M1094.37,-14327.98C1097.27,-14327.45 1100.14,-14326.96 1103,-14326.51 1238.5,-14305.15 1583.21,-14318.76 1720,-14308.51 1890.08,-14295.77 2084.69,-14270.65 2212.93,-14252.63"/>
<polygon fill="black" stroke="black" points="2213.79,-14256.04 2223.2,-14251.18 2212.81,-14249.11 2213.79,-14256.04"/>
</g>
<!-- layer_0_expert_4&#45;&gt;layer_0_all2all_result -->
<g id="edge24" class="edge">
<title>layer_0_expert_4&#45;&gt;layer_0_all2all_result</title>
<path fill="none" stroke="black" d="M1372.37,-14327.98C1375.27,-14327.45 1378.14,-14326.96 1381,-14326.51 1651.99,-14283.8 1725.66,-14341.54 1998,-14308.51 2074.72,-14299.21 2159.34,-14281.3 2226.83,-14265.13"/>
<polygon fill="black" stroke="black" points="2227.76,-14268.51 2236.66,-14262.76 2226.11,-14261.71 2227.76,-14268.51"/>
</g>
<!-- layer_0_expert_5&#45;&gt;layer_0_all2all_result -->
<g id="edge25" class="edge">
<title>layer_0_expert_5&#45;&gt;layer_0_all2all_result</title>
<path fill="none" stroke="black" d="M1650.37,-14328.01C1653.27,-14327.47 1656.15,-14326.97 1659,-14326.51 1874.14,-14291.77 1935.31,-14351.24 2149,-14308.51 2182.91,-14301.73 2218.63,-14290.08 2250.57,-14277.87"/>
<polygon fill="black" stroke="black" points="2251.86,-14281.13 2259.91,-14274.25 2249.32,-14274.6 2251.86,-14281.13"/>
</g>
<!-- layer_0_expert_6&#45;&gt;layer_0_all2all_result -->
<g id="edge26" class="edge">
<title>layer_0_expert_6&#45;&gt;layer_0_all2all_result</title>
<path fill="none" stroke="black" d="M1928.01,-14328.17C1931.03,-14327.58 1934.03,-14327.03 1937,-14326.51 2002.8,-14315.1 2173.61,-14329.52 2237,-14308.51 2251.75,-14303.62 2266.44,-14296.39 2280.17,-14288.28"/>
<polygon fill="black" stroke="black" points="2282.35,-14291.05 2289.05,-14282.85 2278.69,-14285.08 2282.35,-14291.05"/>
</g>
<!-- layer_0_expert_7&#45;&gt;layer_0_all2all_result -->
<g id="edge27" class="edge">
<title>layer_0_expert_7&#45;&gt;layer_0_all2all_result</title>
<path fill="none" stroke="black" d="M2206.16,-14328.83C2209.13,-14328.04 2212.08,-14327.27 2215,-14326.51 2249.86,-14317.47 2263.59,-14327.81 2294,-14308.51 2299.85,-14304.8 2305.36,-14300.31 2310.5,-14295.39"/>
<polygon fill="black" stroke="black" points="2313.31,-14297.52 2317.75,-14287.91 2308.28,-14292.65 2313.31,-14297.52"/>
</g>
<!-- layer_0_expert_8&#45;&gt;layer_0_all2all_result -->
<g id="edge28" class="edge">
<title>layer_0_expert_8&#45;&gt;layer_0_all2all_result</title>
<path fill="none" stroke="black" d="M2354,-14326.45C2354,-14318.09 2354,-14309.06 2354,-14300.02"/>
<polygon fill="black" stroke="black" points="2357.5,-14299.85 2354,-14289.85 2350.5,-14299.85 2357.5,-14299.85"/>
</g>
<!-- layer_0_expert_9&#45;&gt;layer_0_all2all_result -->
<g id="edge29" class="edge">
<title>layer_0_expert_9&#45;&gt;layer_0_all2all_result</title>
<path fill="none" stroke="black" d="M2548.59,-14326.45C2518.6,-14311.87 2484.49,-14295.28 2453.28,-14280.1"/>
<polygon fill="black" stroke="black" points="2454.66,-14276.88 2444.13,-14275.65 2451.59,-14283.17 2454.66,-14276.88"/>
</g>
<!-- layer_0_expert_10&#45;&gt;layer_0_all2all_result -->
<g id="edge30" class="edge">
<title>layer_0_expert_10&#45;&gt;layer_0_all2all_result</title>
<path fill="none" stroke="black" d="M2779.85,-14328.83C2776.87,-14328.04 2773.92,-14327.27 2771,-14326.51 2676.9,-14302.14 2569.98,-14277.93 2487.97,-14260.09"/>
<polygon fill="black" stroke="black" points="2488.61,-14256.65 2478.09,-14257.95 2487.12,-14263.49 2488.61,-14256.65"/>
</g>
<!-- layer_0_expert_11&#45;&gt;layer_0_all2all_result -->
<g id="edge31" class="edge">
<title>layer_0_expert_11&#45;&gt;layer_0_all2all_result</title>
<path fill="none" stroke="black" d="M3057.93,-14328.48C3054.93,-14327.8 3051.95,-14327.14 3049,-14326.51 2861.29,-14286.61 2641.31,-14259.95 2499.92,-14245.35"/>
<polygon fill="black" stroke="black" points="2500.19,-14241.86 2489.88,-14244.32 2499.47,-14248.82 2500.19,-14241.86"/>
</g>
<!-- layer_0_expert_12&#45;&gt;layer_0_all2all_result -->
<g id="edge32" class="edge">
<title>layer_0_expert_12&#45;&gt;layer_0_all2all_result</title>
<path fill="none" stroke="black" d="M3335.96,-14328.32C3332.95,-14327.69 3329.96,-14327.08 3327,-14326.51 3038.22,-14270.89 2694.6,-14247.19 2502.68,-14237.67"/>
<polygon fill="black" stroke="black" points="2502.68,-14234.17 2492.53,-14237.17 2502.34,-14241.16 2502.68,-14234.17"/>
</g>
<!-- layer_0_expert_13&#45;&gt;layer_0_all2all_result -->
<g id="edge33" class="edge">
<title>layer_0_expert_13&#45;&gt;layer_0_all2all_result</title>
<path fill="none" stroke="black" d="M3613.98,-14328.24C3610.96,-14327.63 3607.97,-14327.05 3605,-14326.51 3211.77,-14255.15 2739.55,-14237.44 2503.59,-14233.13"/>
<polygon fill="black" stroke="black" points="2503.63,-14229.63 2493.57,-14232.95 2503.51,-14236.63 2503.63,-14229.63"/>
</g>
<!-- layer_0_expert_14&#45;&gt;layer_0_all2all_result -->
<g id="edge34" class="edge">
<title>layer_0_expert_14&#45;&gt;layer_0_all2all_result</title>
<path fill="none" stroke="black" d="M3891.99,-14328.18C3888.97,-14327.59 3885.97,-14327.03 3883,-14326.51 3620.76,-14280.77 2833.76,-14248.67 2503,-14236.84"/>
<polygon fill="black" stroke="black" points="2502.99,-14233.34 2492.87,-14236.48 2502.74,-14240.33 2502.99,-14233.34"/>
</g>
<!-- layer_0_expert_15&#45;&gt;layer_0_all2all_result -->
<g id="edge35" class="edge">
<title>layer_0_expert_15&#45;&gt;layer_0_all2all_result</title>
<path fill="none" stroke="black" d="M4169.99,-14328.14C4166.97,-14327.56 4163.97,-14327.02 4161,-14326.51 3843.62,-14272.7 2876.29,-14244.36 2503.08,-14235.2"/>
<polygon fill="black" stroke="black" points="2503.1,-14231.7 2493.02,-14234.95 2502.93,-14238.7 2503.1,-14231.7"/>
</g>
<!-- layer_0_expert_agg -->
<g id="node22" class="node">
<title>layer_0_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="3948,-14135.13 3700,-14135.13 3700,-14052.13 3948,-14052.13 3948,-14135.13"/>
<text text-anchor="middle" x="3824" y="-14119.93" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="3824" y="-14104.93" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="3824" y="-14089.93" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3824" y="-14074.93" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="3824" y="-14059.93" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_0_all2all_result&#45;&gt;layer_0_expert_agg -->
<g id="edge36" class="edge">
<title>layer_0_all2all_result&#45;&gt;layer_0_expert_agg</title>
<path fill="none" stroke="black" d="M2489.66,-14217.35C2770.06,-14191.56 3410.53,-14132.66 3689.73,-14106.98"/>
<polygon fill="black" stroke="black" points="3690.28,-14110.44 3699.92,-14106.04 3689.64,-14103.47 3690.28,-14110.44"/>
</g>
<!-- layer_0_expert_agg&#45;&gt;layer_0_residual -->
<g id="edge38" class="edge">
<title>layer_0_expert_agg&#45;&gt;layer_0_residual</title>
<path fill="none" stroke="black" d="M3948.21,-14066.74C4026.7,-14050.37 4129.29,-14028.99 4215.85,-14010.94"/>
<polygon fill="black" stroke="black" points="4216.7,-14014.34 4225.78,-14008.87 4215.28,-14007.48 4216.7,-14014.34"/>
</g>
<!-- layer_1_mha -->
<g id="node24" class="node">
<title>layer_1_mha</title>
<polygon fill="lightblue" stroke="black" points="4491.5,-13895.13 4288.5,-13895.13 4288.5,-13812.13 4491.5,-13812.13 4491.5,-13895.13"/>
<text text-anchor="middle" x="4390" y="-13879.93" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="4390" y="-13864.93" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="4390" y="-13849.93" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4390" y="-13834.93" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="4390" y="-13819.93" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_0_residual&#45;&gt;layer_1_mha -->
<g id="edge39" class="edge">
<title>layer_0_residual&#45;&gt;layer_1_mha</title>
<path fill="none" stroke="black" d="M4390,-13932.02C4390,-13923.49 4390,-13914.39 4390,-13905.54"/>
<polygon fill="black" stroke="black" points="4393.5,-13905.32 4390,-13895.32 4386.5,-13905.32 4393.5,-13905.32"/>
</g>
<!-- layer_1_gate -->
<g id="node25" class="node">
<title>layer_1_gate</title>
<polygon fill="lightblue" stroke="black" points="4177.5,-13775.13 3978.5,-13775.13 3978.5,-13692.13 4177.5,-13692.13 4177.5,-13775.13"/>
<text text-anchor="middle" x="4078" y="-13759.93" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="4078" y="-13744.93" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="4078" y="-13729.93" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4078" y="-13714.93" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="4078" y="-13699.93" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_1_mha&#45;&gt;layer_1_gate -->
<g id="edge40" class="edge">
<title>layer_1_mha&#45;&gt;layer_1_gate</title>
<path fill="none" stroke="black" d="M4288.27,-13814.16C4255.98,-13801.95 4220.15,-13788.39 4187.35,-13775.99"/>
<polygon fill="black" stroke="black" points="4188.32,-13772.61 4177.73,-13772.35 4185.84,-13779.16 4188.32,-13772.61"/>
</g>
<!-- layer_1_residual -->
<g id="node45" class="node">
<title>layer_1_residual</title>
<polygon fill="lightblue" stroke="black" points="4790,-13092.37 4462,-13092.37 4462,-13009.37 4790,-13009.37 4790,-13092.37"/>
<text text-anchor="middle" x="4626" y="-13077.17" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="4626" y="-13062.17" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4626" y="-13047.17" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="4626" y="-13032.17" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="4626" y="-13017.17" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_1_mha&#45;&gt;layer_1_residual -->
<g id="edge75" class="edge">
<title>layer_1_mha&#45;&gt;layer_1_residual</title>
<path fill="none" stroke="black" d="M4491.73,-13834.2C4582.78,-13814.72 4702,-13780.45 4702,-13734.63 4702,-13734.63 4702,-13734.63 4702,-13169.87 4702,-13144.49 4689.42,-13120.23 4674.5,-13100.38"/>
<polygon fill="black" stroke="black" points="4677.17,-13098.12 4668.22,-13092.44 4671.67,-13102.46 4677.17,-13098.12"/>
<text text-anchor="middle" x="4730" y="-13441.55" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_1_all2all -->
<g id="node26" class="node">
<title>layer_1_all2all</title>
<ellipse fill="yellow" stroke="black" cx="2590" cy="-13596.44" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="2590" y="-13622.74" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="2590" y="-13607.74" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="2590" y="-13592.74" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="2590" y="-13577.74" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="2590" y="-13562.74" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_1_gate&#45;&gt;layer_1_all2all -->
<g id="edge41" class="edge">
<title>layer_1_gate&#45;&gt;layer_1_all2all</title>
<path fill="none" stroke="black" d="M3978.35,-13723.58C3721.76,-13700.27 3037.46,-13638.1 2736.03,-13610.71"/>
<polygon fill="black" stroke="black" points="2736.18,-13607.21 2725.91,-13609.79 2735.55,-13614.18 2736.18,-13607.21"/>
</g>
<!-- layer_1_expert_0 -->
<g id="node27" class="node">
<title>layer_1_expert_0</title>
<polygon fill="lightblue" stroke="black" points="496,-13486.75 236,-13486.75 236,-13403.75 496,-13403.75 496,-13486.75"/>
<text text-anchor="middle" x="366" y="-13471.55" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="366" y="-13456.55" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="366" y="-13441.55" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="366" y="-13426.55" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="366" y="-13411.55" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_1_all2all&#45;&gt;layer_1_expert_0 -->
<g id="edge42" class="edge">
<title>layer_1_all2all&#45;&gt;layer_1_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2450.94,-13592.79C2070.13,-13585.08 1015.87,-13560.58 671,-13519.75 616.37,-13513.29 557.38,-13500.48 505.97,-13487.35"/>
<polygon fill="black" stroke="black" points="506.68,-13483.92 496.13,-13484.81 504.93,-13490.7 506.68,-13483.92"/>
<text text-anchor="middle" x="762.5" y="-13508.55" font-family="Times,serif" font-size="14.00">tokens routed to expert 0</text>
</g>
<!-- layer_1_expert_1 -->
<g id="node28" class="node">
<title>layer_1_expert_1</title>
<polygon fill="lightblue" stroke="black" points="774,-13486.75 514,-13486.75 514,-13403.75 774,-13403.75 774,-13486.75"/>
<text text-anchor="middle" x="644" y="-13471.55" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="644" y="-13456.55" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="644" y="-13441.55" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="644" y="-13426.55" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="644" y="-13411.55" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_1_all2all&#45;&gt;layer_1_expert_1 -->
<g id="edge43" class="edge">
<title>layer_1_all2all&#45;&gt;layer_1_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2450.47,-13595.93C2166.9,-13595.4 1503.35,-13586.38 951,-13519.75 878.55,-13511.01 858.55,-13505.24 784,-13486.96"/>
<polygon fill="black" stroke="black" points="784.67,-13483.53 774.13,-13484.55 783.01,-13490.32 784.67,-13483.53"/>
<text text-anchor="middle" x="1042.5" y="-13508.55" font-family="Times,serif" font-size="14.00">tokens routed to expert 1</text>
</g>
<!-- layer_1_expert_2 -->
<g id="node29" class="node">
<title>layer_1_expert_2</title>
<polygon fill="lightblue" stroke="black" points="1052,-13486.75 792,-13486.75 792,-13403.75 1052,-13403.75 1052,-13486.75"/>
<text text-anchor="middle" x="922" y="-13471.55" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="922" y="-13456.55" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="922" y="-13441.55" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="922" y="-13426.55" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="922" y="-13411.55" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_1_all2all&#45;&gt;layer_1_expert_2 -->
<g id="edge44" class="edge">
<title>layer_1_all2all&#45;&gt;layer_1_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2450.32,-13594.6C2201.82,-13591.57 1667.01,-13578.16 1220,-13519.75 1167.74,-13512.92 1111.38,-13500.4 1061.89,-13487.6"/>
<polygon fill="black" stroke="black" points="1062.65,-13484.18 1052.09,-13485.04 1060.88,-13490.96 1062.65,-13484.18"/>
<text text-anchor="middle" x="1311.5" y="-13508.55" font-family="Times,serif" font-size="14.00">tokens routed to expert 2</text>
</g>
<!-- layer_1_expert_3 -->
<g id="node30" class="node">
<title>layer_1_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1330,-13486.75 1070,-13486.75 1070,-13403.75 1330,-13403.75 1330,-13486.75"/>
<text text-anchor="middle" x="1200" y="-13471.55" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1200" y="-13456.55" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1200" y="-13441.55" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1200" y="-13426.55" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1200" y="-13411.55" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_1_all2all&#45;&gt;layer_1_expert_3 -->
<g id="edge45" class="edge">
<title>layer_1_all2all&#45;&gt;layer_1_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2450.67,-13593.5C2238.95,-13588.85 1824.01,-13573.1 1476,-13519.75 1430.77,-13512.82 1382.29,-13501.34 1338.78,-13489.48"/>
<polygon fill="black" stroke="black" points="1339.57,-13486.07 1329,-13486.79 1337.71,-13492.82 1339.57,-13486.07"/>
<text text-anchor="middle" x="1567.5" y="-13508.55" font-family="Times,serif" font-size="14.00">tokens routed to expert 3</text>
</g>
<!-- layer_1_expert_4 -->
<g id="node31" class="node">
<title>layer_1_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1608,-13486.75 1348,-13486.75 1348,-13403.75 1608,-13403.75 1608,-13486.75"/>
<text text-anchor="middle" x="1478" y="-13471.55" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1478" y="-13456.55" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1478" y="-13441.55" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1478" y="-13426.55" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1478" y="-13411.55" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_1_all2all&#45;&gt;layer_1_expert_4 -->
<g id="edge46" class="edge">
<title>layer_1_all2all&#45;&gt;layer_1_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2450.78,-13591.83C2279.04,-13585.41 1978.77,-13567.78 1726,-13519.75 1686.65,-13512.28 1644.62,-13501.09 1606.55,-13489.68"/>
<polygon fill="black" stroke="black" points="1607.54,-13486.33 1596.96,-13486.78 1605.51,-13493.03 1607.54,-13486.33"/>
<text text-anchor="middle" x="1817.5" y="-13508.55" font-family="Times,serif" font-size="14.00">tokens routed to expert 4</text>
</g>
<!-- layer_1_expert_5 -->
<g id="node32" class="node">
<title>layer_1_expert_5</title>
<polygon fill="lightblue" stroke="black" points="1886,-13486.75 1626,-13486.75 1626,-13403.75 1886,-13403.75 1886,-13486.75"/>
<text text-anchor="middle" x="1756" y="-13471.55" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1756" y="-13456.55" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1756" y="-13441.55" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1756" y="-13426.55" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1756" y="-13411.55" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_1_all2all&#45;&gt;layer_1_expert_5 -->
<g id="edge47" class="edge">
<title>layer_1_all2all&#45;&gt;layer_1_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2452.18,-13587.3C2324.75,-13577.76 2130.74,-13558.1 1966,-13519.75 1933.44,-13512.17 1898.89,-13501.32 1867.43,-13490.27"/>
<polygon fill="black" stroke="black" points="1868.36,-13486.89 1857.76,-13486.84 1866.02,-13493.48 1868.36,-13486.89"/>
<text text-anchor="middle" x="2057.5" y="-13508.55" font-family="Times,serif" font-size="14.00">tokens routed to expert 5</text>
</g>
<!-- layer_1_expert_6 -->
<g id="node33" class="node">
<title>layer_1_expert_6</title>
<polygon fill="lightblue" stroke="black" points="2164,-13486.75 1904,-13486.75 1904,-13403.75 2164,-13403.75 2164,-13486.75"/>
<text text-anchor="middle" x="2034" y="-13471.55" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="2034" y="-13456.55" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2034" y="-13441.55" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2034" y="-13426.55" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2034" y="-13411.55" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_1_all2all&#45;&gt;layer_1_expert_6 -->
<g id="edge48" class="edge">
<title>layer_1_all2all&#45;&gt;layer_1_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2457.36,-13578.29C2379.49,-13566.21 2279.83,-13547.22 2194,-13519.75 2169.84,-13512.02 2144.53,-13501.58 2121.36,-13490.99"/>
<polygon fill="black" stroke="black" points="2122.79,-13487.8 2112.25,-13486.78 2119.85,-13494.16 2122.79,-13487.8"/>
<text text-anchor="middle" x="2285.5" y="-13508.55" font-family="Times,serif" font-size="14.00">tokens routed to expert 6</text>
</g>
<!-- layer_1_expert_7 -->
<g id="node34" class="node">
<title>layer_1_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2442,-13486.75 2182,-13486.75 2182,-13403.75 2442,-13403.75 2442,-13486.75"/>
<text text-anchor="middle" x="2312" y="-13471.55" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2312" y="-13456.55" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2312" y="-13441.55" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2312" y="-13426.55" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2312" y="-13411.55" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_1_all2all&#45;&gt;layer_1_expert_7 -->
<g id="edge49" class="edge">
<title>layer_1_all2all&#45;&gt;layer_1_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2483.06,-13558.47C2456.17,-13547.48 2427.9,-13534.41 2403,-13519.75 2389.94,-13512.06 2376.75,-13502.61 2364.63,-13493.07"/>
<polygon fill="black" stroke="black" points="2366.82,-13490.34 2356.83,-13486.81 2362.44,-13495.8 2366.82,-13490.34"/>
<text text-anchor="middle" x="2494.5" y="-13508.55" font-family="Times,serif" font-size="14.00">tokens routed to expert 7</text>
</g>
<!-- layer_1_expert_8 -->
<g id="node35" class="node">
<title>layer_1_expert_8</title>
<polygon fill="lightblue" stroke="black" points="2720,-13486.75 2460,-13486.75 2460,-13403.75 2720,-13403.75 2720,-13486.75"/>
<text text-anchor="middle" x="2590" y="-13471.55" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="2590" y="-13456.55" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2590" y="-13441.55" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2590" y="-13426.55" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2590" y="-13411.55" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_1_all2all&#45;&gt;layer_1_expert_8 -->
<g id="edge50" class="edge">
<title>layer_1_all2all&#45;&gt;layer_1_expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2590,-13537.33C2590,-13524.04 2590,-13510 2590,-13497.04"/>
<polygon fill="black" stroke="black" points="2593.5,-13496.9 2590,-13486.9 2586.5,-13496.91 2593.5,-13496.9"/>
<text text-anchor="middle" x="2681.5" y="-13508.55" font-family="Times,serif" font-size="14.00">tokens routed to expert 8</text>
</g>
<!-- layer_1_expert_9 -->
<g id="node36" class="node">
<title>layer_1_expert_9</title>
<polygon fill="lightblue" stroke="black" points="2998,-13486.75 2738,-13486.75 2738,-13403.75 2998,-13403.75 2998,-13486.75"/>
<text text-anchor="middle" x="2868" y="-13471.55" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="2868" y="-13456.55" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2868" y="-13441.55" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2868" y="-13426.55" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2868" y="-13411.55" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_1_all2all&#45;&gt;layer_1_expert_9 -->
<g id="edge51" class="edge">
<title>layer_1_all2all&#45;&gt;layer_1_expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2696.94,-13558.47C2723.83,-13547.48 2752.1,-13534.41 2777,-13519.75 2790.06,-13512.06 2803.25,-13502.61 2815.37,-13493.07"/>
<polygon fill="black" stroke="black" points="2817.56,-13495.8 2823.17,-13486.81 2813.18,-13490.34 2817.56,-13495.8"/>
<text text-anchor="middle" x="2889.5" y="-13508.55" font-family="Times,serif" font-size="14.00">tokens routed to expert 9</text>
</g>
<!-- layer_1_expert_10 -->
<g id="node37" class="node">
<title>layer_1_expert_10</title>
<polygon fill="lightblue" stroke="black" points="3276,-13486.75 3016,-13486.75 3016,-13403.75 3276,-13403.75 3276,-13486.75"/>
<text text-anchor="middle" x="3146" y="-13471.55" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="3146" y="-13456.55" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3146" y="-13441.55" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3146" y="-13426.55" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3146" y="-13411.55" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_1_all2all&#45;&gt;layer_1_expert_10 -->
<g id="edge52" class="edge">
<title>layer_1_all2all&#45;&gt;layer_1_expert_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2722.73,-13578.11C2800.33,-13565.98 2899.52,-13547.02 2985,-13519.75 3009.29,-13512 3034.75,-13501.55 3058.07,-13490.97"/>
<polygon fill="black" stroke="black" points="3059.61,-13494.11 3067.24,-13486.76 3056.69,-13487.75 3059.61,-13494.11"/>
<text text-anchor="middle" x="3121" y="-13508.55" font-family="Times,serif" font-size="14.00">tokens routed to expert 10</text>
</g>
<!-- layer_1_expert_11 -->
<g id="node38" class="node">
<title>layer_1_expert_11</title>
<polygon fill="lightblue" stroke="black" points="3554,-13486.75 3294,-13486.75 3294,-13403.75 3554,-13403.75 3554,-13486.75"/>
<text text-anchor="middle" x="3424" y="-13471.55" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="3424" y="-13456.55" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3424" y="-13441.55" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3424" y="-13426.55" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3424" y="-13411.55" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_1_all2all&#45;&gt;layer_1_expert_11 -->
<g id="edge53" class="edge">
<title>layer_1_all2all&#45;&gt;layer_1_expert_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2727.9,-13587.97C2856.81,-13578.86 3053.95,-13559.46 3221,-13519.75 3252.51,-13512.26 3285.87,-13501.46 3316.25,-13490.43"/>
<polygon fill="black" stroke="black" points="3317.82,-13493.58 3326,-13486.84 3315.4,-13487.01 3317.82,-13493.58"/>
<text text-anchor="middle" x="3368" y="-13508.55" font-family="Times,serif" font-size="14.00">tokens routed to expert 11</text>
</g>
<!-- layer_1_expert_12 -->
<g id="node39" class="node">
<title>layer_1_expert_12</title>
<polygon fill="lightblue" stroke="black" points="3832,-13486.75 3572,-13486.75 3572,-13403.75 3832,-13403.75 3832,-13486.75"/>
<text text-anchor="middle" x="3702" y="-13471.55" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="3702" y="-13456.55" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3702" y="-13441.55" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3702" y="-13426.55" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3702" y="-13411.55" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_1_all2all&#45;&gt;layer_1_expert_12 -->
<g id="edge54" class="edge">
<title>layer_1_all2all&#45;&gt;layer_1_expert_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2729.31,-13592.79C2903.58,-13587.34 3210.41,-13570.67 3468,-13519.75 3505.2,-13512.4 3544.83,-13501.27 3580.7,-13489.88"/>
<polygon fill="black" stroke="black" points="3581.77,-13493.21 3590.22,-13486.82 3579.63,-13486.55 3581.77,-13493.21"/>
<text text-anchor="middle" x="3622" y="-13508.55" font-family="Times,serif" font-size="14.00">tokens routed to expert 12</text>
</g>
<!-- layer_1_expert_13 -->
<g id="node40" class="node">
<title>layer_1_expert_13</title>
<polygon fill="lightblue" stroke="black" points="4110,-13486.75 3850,-13486.75 3850,-13403.75 4110,-13403.75 4110,-13486.75"/>
<text text-anchor="middle" x="3980" y="-13471.55" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="3980" y="-13456.55" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3980" y="-13441.55" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3980" y="-13426.55" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3980" y="-13411.55" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_1_all2all&#45;&gt;layer_1_expert_13 -->
<g id="edge55" class="edge">
<title>layer_1_all2all&#45;&gt;layer_1_expert_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2729.61,-13595.22C2944.38,-13592.83 3368.12,-13580 3722,-13519.75 3763.67,-13512.66 3808.23,-13501.35 3848.38,-13489.72"/>
<polygon fill="black" stroke="black" points="3849.61,-13493.01 3858.22,-13486.83 3847.64,-13486.29 3849.61,-13493.01"/>
<text text-anchor="middle" x="3882" y="-13508.55" font-family="Times,serif" font-size="14.00">tokens routed to expert 13</text>
</g>
<!-- layer_1_expert_14 -->
<g id="node41" class="node">
<title>layer_1_expert_14</title>
<polygon fill="lightblue" stroke="black" points="4388,-13486.75 4128,-13486.75 4128,-13403.75 4388,-13403.75 4388,-13486.75"/>
<text text-anchor="middle" x="4258" y="-13471.55" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="4258" y="-13456.55" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4258" y="-13441.55" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4258" y="-13426.55" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4258" y="-13411.55" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_1_all2all&#45;&gt;layer_1_expert_14 -->
<g id="edge56" class="edge">
<title>layer_1_all2all&#45;&gt;layer_1_expert_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2729.63,-13596.22C2981.34,-13595.77 3527.3,-13586.31 3982,-13519.75 4027.73,-13513.06 4076.74,-13501.5 4120.59,-13489.5"/>
<polygon fill="black" stroke="black" points="4121.74,-13492.81 4130.45,-13486.77 4119.87,-13486.07 4121.74,-13492.81"/>
<text text-anchor="middle" x="4154" y="-13508.55" font-family="Times,serif" font-size="14.00">tokens routed to expert 14</text>
</g>
<!-- layer_1_expert_15 -->
<g id="node42" class="node">
<title>layer_1_expert_15</title>
<polygon fill="lightblue" stroke="black" points="4666,-13486.75 4406,-13486.75 4406,-13403.75 4666,-13403.75 4666,-13486.75"/>
<text text-anchor="middle" x="4536" y="-13471.55" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="4536" y="-13456.55" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4536" y="-13441.55" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4536" y="-13426.55" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4536" y="-13411.55" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_1_all2all&#45;&gt;layer_1_expert_15 -->
<g id="edge57" class="edge">
<title>layer_1_all2all&#45;&gt;layer_1_expert_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2729.05,-13592.36C3073.75,-13584.21 3960.95,-13559.89 4254,-13519.75 4301.17,-13513.29 4351.76,-13501.65 4396.89,-13489.51"/>
<polygon fill="black" stroke="black" points="4398,-13492.83 4406.73,-13486.83 4396.16,-13486.08 4398,-13492.83"/>
<text text-anchor="middle" x="4428" y="-13508.55" font-family="Times,serif" font-size="14.00">tokens routed to expert 15</text>
</g>
<!-- layer_1_all2all_result -->
<g id="node43" class="node">
<title>layer_1_all2all_result</title>
<ellipse fill="yellow" stroke="black" cx="2590" cy="-13308.06" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="2590" y="-13334.36" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="2590" y="-13319.36" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Result Merge</text>
<text text-anchor="middle" x="2590" y="-13304.36" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="2590" y="-13289.36" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="2590" y="-13274.36" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_1_expert_0&#45;&gt;layer_1_all2all_result -->
<g id="edge58" class="edge">
<title>layer_1_expert_0&#45;&gt;layer_1_all2all_result</title>
<path fill="none" stroke="black" d="M496,-13405.36C499.02,-13404.78 502.02,-13404.25 505,-13403.75 877.89,-13341.87 2027.76,-13317.96 2440.55,-13311.23"/>
<polygon fill="black" stroke="black" points="2440.81,-13314.73 2450.76,-13311.07 2440.7,-13307.73 2440.81,-13314.73"/>
</g>
<!-- layer_1_expert_1&#45;&gt;layer_1_all2all_result -->
<g id="edge59" class="edge">
<title>layer_1_expert_1&#45;&gt;layer_1_all2all_result</title>
<path fill="none" stroke="black" d="M774.01,-13405.38C777.03,-13404.8 780.03,-13404.26 783,-13403.75 1100.38,-13349.95 2067.71,-13321.6 2440.92,-13312.44"/>
<polygon fill="black" stroke="black" points="2441.07,-13315.94 2450.98,-13312.19 2440.9,-13308.94 2441.07,-13315.94"/>
</g>
<!-- layer_1_expert_2&#45;&gt;layer_1_all2all_result -->
<g id="edge60" class="edge">
<title>layer_1_expert_2&#45;&gt;layer_1_all2all_result</title>
<path fill="none" stroke="black" d="M1052.01,-13405.42C1055.03,-13404.83 1058.03,-13404.27 1061,-13403.75 1323.24,-13358.01 2110.24,-13325.91 2441,-13314.08"/>
<polygon fill="black" stroke="black" points="2441.26,-13317.57 2451.13,-13313.72 2441.01,-13310.58 2441.26,-13317.57"/>
</g>
<!-- layer_1_expert_3&#45;&gt;layer_1_all2all_result -->
<g id="edge61" class="edge">
<title>layer_1_expert_3&#45;&gt;layer_1_all2all_result</title>
<path fill="none" stroke="black" d="M1330.02,-13405.48C1333.04,-13404.87 1336.03,-13404.29 1339,-13403.75 1732.23,-13332.39 2204.45,-13314.68 2440.41,-13310.37"/>
<polygon fill="black" stroke="black" points="2440.49,-13313.87 2450.43,-13310.2 2440.37,-13306.87 2440.49,-13313.87"/>
</g>
<!-- layer_1_expert_4&#45;&gt;layer_1_all2all_result -->
<g id="edge62" class="edge">
<title>layer_1_expert_4&#45;&gt;layer_1_all2all_result</title>
<path fill="none" stroke="black" d="M1608.04,-13405.57C1611.05,-13404.93 1614.04,-13404.32 1617,-13403.75 1905.78,-13348.14 2249.4,-13324.43 2441.32,-13314.91"/>
<polygon fill="black" stroke="black" points="2441.66,-13318.4 2451.47,-13314.42 2441.32,-13311.41 2441.66,-13318.4"/>
</g>
<!-- layer_1_expert_5&#45;&gt;layer_1_all2all_result -->
<g id="edge63" class="edge">
<title>layer_1_expert_5&#45;&gt;layer_1_all2all_result</title>
<path fill="none" stroke="black" d="M1886.07,-13405.72C1889.07,-13405.04 1892.05,-13404.38 1895,-13403.75 2082.71,-13363.85 2302.69,-13337.19 2444.08,-13322.59"/>
<polygon fill="black" stroke="black" points="2444.53,-13326.06 2454.12,-13321.56 2443.81,-13319.1 2444.53,-13326.06"/>
</g>
<!-- layer_1_expert_6&#45;&gt;layer_1_all2all_result -->
<g id="edge64" class="edge">
<title>layer_1_expert_6&#45;&gt;layer_1_all2all_result</title>
<path fill="none" stroke="black" d="M2164.15,-13406.07C2167.13,-13405.28 2170.08,-13404.51 2173,-13403.75 2267.1,-13379.38 2374.02,-13355.17 2456.03,-13337.33"/>
<polygon fill="black" stroke="black" points="2456.88,-13340.73 2465.91,-13335.19 2455.39,-13333.89 2456.88,-13340.73"/>
</g>
<!-- layer_1_expert_7&#45;&gt;layer_1_all2all_result -->
<g id="edge65" class="edge">
<title>layer_1_expert_7&#45;&gt;layer_1_all2all_result</title>
<path fill="none" stroke="black" d="M2395.41,-13403.69C2425.4,-13389.11 2459.51,-13372.52 2490.72,-13357.34"/>
<polygon fill="black" stroke="black" points="2492.41,-13360.41 2499.87,-13352.89 2489.34,-13354.12 2492.41,-13360.41"/>
</g>
<!-- layer_1_expert_8&#45;&gt;layer_1_all2all_result -->
<g id="edge66" class="edge">
<title>layer_1_expert_8&#45;&gt;layer_1_all2all_result</title>
<path fill="none" stroke="black" d="M2590,-13403.69C2590,-13395.33 2590,-13386.3 2590,-13377.26"/>
<polygon fill="black" stroke="black" points="2593.5,-13377.09 2590,-13367.09 2586.5,-13377.09 2593.5,-13377.09"/>
</g>
<!-- layer_1_expert_9&#45;&gt;layer_1_all2all_result -->
<g id="edge67" class="edge">
<title>layer_1_expert_9&#45;&gt;layer_1_all2all_result</title>
<path fill="none" stroke="black" d="M2784.59,-13403.69C2754.6,-13389.11 2720.49,-13372.52 2689.28,-13357.34"/>
<polygon fill="black" stroke="black" points="2690.66,-13354.12 2680.13,-13352.89 2687.59,-13360.41 2690.66,-13354.12"/>
</g>
<!-- layer_1_expert_10&#45;&gt;layer_1_all2all_result -->
<g id="edge68" class="edge">
<title>layer_1_expert_10&#45;&gt;layer_1_all2all_result</title>
<path fill="none" stroke="black" d="M3015.85,-13406.07C3012.87,-13405.28 3009.92,-13404.51 3007,-13403.75 2912.9,-13379.38 2805.98,-13355.17 2723.97,-13337.33"/>
<polygon fill="black" stroke="black" points="2724.61,-13333.89 2714.09,-13335.19 2723.12,-13340.73 2724.61,-13333.89"/>
</g>
<!-- layer_1_expert_11&#45;&gt;layer_1_all2all_result -->
<g id="edge69" class="edge">
<title>layer_1_expert_11&#45;&gt;layer_1_all2all_result</title>
<path fill="none" stroke="black" d="M3293.93,-13405.72C3290.93,-13405.04 3287.95,-13404.38 3285,-13403.75 3097.29,-13363.85 2877.31,-13337.19 2735.92,-13322.59"/>
<polygon fill="black" stroke="black" points="2736.19,-13319.1 2725.88,-13321.56 2735.47,-13326.06 2736.19,-13319.1"/>
</g>
<!-- layer_1_expert_12&#45;&gt;layer_1_all2all_result -->
<g id="edge70" class="edge">
<title>layer_1_expert_12&#45;&gt;layer_1_all2all_result</title>
<path fill="none" stroke="black" d="M3571.96,-13405.57C3568.95,-13404.93 3565.96,-13404.32 3563,-13403.75 3274.22,-13348.14 2930.6,-13324.43 2738.68,-13314.91"/>
<polygon fill="black" stroke="black" points="2738.68,-13311.41 2728.53,-13314.42 2738.34,-13318.4 2738.68,-13311.41"/>
</g>
<!-- layer_1_expert_13&#45;&gt;layer_1_all2all_result -->
<g id="edge71" class="edge">
<title>layer_1_expert_13&#45;&gt;layer_1_all2all_result</title>
<path fill="none" stroke="black" d="M3849.98,-13405.48C3846.96,-13404.87 3843.97,-13404.29 3841,-13403.75 3447.77,-13332.39 2975.55,-13314.68 2739.59,-13310.37"/>
<polygon fill="black" stroke="black" points="2739.63,-13306.87 2729.57,-13310.2 2739.51,-13313.87 2739.63,-13306.87"/>
</g>
<!-- layer_1_expert_14&#45;&gt;layer_1_all2all_result -->
<g id="edge72" class="edge">
<title>layer_1_expert_14&#45;&gt;layer_1_all2all_result</title>
<path fill="none" stroke="black" d="M4127.99,-13405.42C4124.97,-13404.83 4121.97,-13404.27 4119,-13403.75 3856.76,-13358.01 3069.76,-13325.91 2739,-13314.08"/>
<polygon fill="black" stroke="black" points="2738.99,-13310.58 2728.87,-13313.72 2738.74,-13317.57 2738.99,-13310.58"/>
</g>
<!-- layer_1_expert_15&#45;&gt;layer_1_all2all_result -->
<g id="edge73" class="edge">
<title>layer_1_expert_15&#45;&gt;layer_1_all2all_result</title>
<path fill="none" stroke="black" d="M4405.99,-13405.38C4402.97,-13404.8 4399.97,-13404.26 4397,-13403.75 4079.62,-13349.95 3112.29,-13321.6 2739.08,-13312.44"/>
<polygon fill="black" stroke="black" points="2739.1,-13308.94 2729.02,-13312.19 2738.93,-13315.94 2739.1,-13308.94"/>
</g>
<!-- layer_1_expert_agg -->
<g id="node44" class="node">
<title>layer_1_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="4184,-13212.37 3936,-13212.37 3936,-13129.37 4184,-13129.37 4184,-13212.37"/>
<text text-anchor="middle" x="4060" y="-13197.17" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="4060" y="-13182.17" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4060" y="-13167.17" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4060" y="-13152.17" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="4060" y="-13137.17" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_1_all2all_result&#45;&gt;layer_1_expert_agg -->
<g id="edge74" class="edge">
<title>layer_1_all2all_result&#45;&gt;layer_1_expert_agg</title>
<path fill="none" stroke="black" d="M2725.66,-13294.59C3006.06,-13268.8 3646.53,-13209.9 3925.73,-13184.22"/>
<polygon fill="black" stroke="black" points="3926.28,-13187.69 3935.92,-13183.28 3925.64,-13180.71 3926.28,-13187.69"/>
</g>
<!-- layer_1_expert_agg&#45;&gt;layer_1_residual -->
<g id="edge76" class="edge">
<title>layer_1_expert_agg&#45;&gt;layer_1_residual</title>
<path fill="none" stroke="black" d="M4184.21,-13143.98C4262.7,-13127.61 4365.29,-13106.23 4451.85,-13088.18"/>
<polygon fill="black" stroke="black" points="4452.7,-13091.58 4461.78,-13086.11 4451.28,-13084.72 4452.7,-13091.58"/>
</g>
<!-- layer_2_mha -->
<g id="node46" class="node">
<title>layer_2_mha</title>
<polygon fill="lightblue" stroke="black" points="4727.5,-12972.37 4524.5,-12972.37 4524.5,-12889.37 4727.5,-12889.37 4727.5,-12972.37"/>
<text text-anchor="middle" x="4626" y="-12957.17" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="4626" y="-12942.17" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="4626" y="-12927.17" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4626" y="-12912.17" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="4626" y="-12897.17" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_1_residual&#45;&gt;layer_2_mha -->
<g id="edge77" class="edge">
<title>layer_1_residual&#45;&gt;layer_2_mha</title>
<path fill="none" stroke="black" d="M4626,-13009.26C4626,-13000.73 4626,-12991.64 4626,-12982.78"/>
<polygon fill="black" stroke="black" points="4629.5,-12982.56 4626,-12972.56 4622.5,-12982.56 4629.5,-12982.56"/>
</g>
<!-- layer_2_gate -->
<g id="node47" class="node">
<title>layer_2_gate</title>
<polygon fill="lightblue" stroke="black" points="4413.5,-12852.37 4214.5,-12852.37 4214.5,-12769.37 4413.5,-12769.37 4413.5,-12852.37"/>
<text text-anchor="middle" x="4314" y="-12837.17" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="4314" y="-12822.17" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="4314" y="-12807.17" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4314" y="-12792.17" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="4314" y="-12777.17" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_2_mha&#45;&gt;layer_2_gate -->
<g id="edge78" class="edge">
<title>layer_2_mha&#45;&gt;layer_2_gate</title>
<path fill="none" stroke="black" d="M4524.27,-12891.4C4491.98,-12879.19 4456.15,-12865.63 4423.35,-12853.23"/>
<polygon fill="black" stroke="black" points="4424.32,-12849.85 4413.73,-12849.59 4421.84,-12856.4 4424.32,-12849.85"/>
</g>
<!-- layer_2_residual -->
<g id="node67" class="node">
<title>layer_2_residual</title>
<polygon fill="lightblue" stroke="black" points="5026,-12169.61 4698,-12169.61 4698,-12086.61 5026,-12086.61 5026,-12169.61"/>
<text text-anchor="middle" x="4862" y="-12154.41" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="4862" y="-12139.41" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="4862" y="-12124.41" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="4862" y="-12109.41" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="4862" y="-12094.41" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_2_mha&#45;&gt;layer_2_residual -->
<g id="edge113" class="edge">
<title>layer_2_mha&#45;&gt;layer_2_residual</title>
<path fill="none" stroke="black" d="M4727.73,-12911.44C4818.78,-12891.96 4938,-12857.69 4938,-12811.87 4938,-12811.87 4938,-12811.87 4938,-12247.11 4938,-12221.73 4925.42,-12197.47 4910.5,-12177.62"/>
<polygon fill="black" stroke="black" points="4913.17,-12175.36 4904.22,-12169.68 4907.67,-12179.7 4913.17,-12175.36"/>
<text text-anchor="middle" x="4966" y="-12518.79" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_2_all2all -->
<g id="node48" class="node">
<title>layer_2_all2all</title>
<ellipse fill="yellow" stroke="black" cx="2826" cy="-12673.68" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="2826" y="-12699.98" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="2826" y="-12684.98" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="2826" y="-12669.98" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="2826" y="-12654.98" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="2826" y="-12639.98" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_2_gate&#45;&gt;layer_2_all2all -->
<g id="edge79" class="edge">
<title>layer_2_gate&#45;&gt;layer_2_all2all</title>
<path fill="none" stroke="black" d="M4214.35,-12800.82C3957.76,-12777.51 3273.46,-12715.34 2972.03,-12687.95"/>
<polygon fill="black" stroke="black" points="2972.18,-12684.45 2961.91,-12687.03 2971.55,-12691.42 2972.18,-12684.45"/>
</g>
<!-- layer_2_expert_0 -->
<g id="node49" class="node">
<title>layer_2_expert_0</title>
<polygon fill="lightblue" stroke="black" points="732,-12563.99 472,-12563.99 472,-12480.99 732,-12480.99 732,-12563.99"/>
<text text-anchor="middle" x="602" y="-12548.79" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="602" y="-12533.79" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="602" y="-12518.79" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="602" y="-12503.79" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="602" y="-12488.79" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_2_all2all&#45;&gt;layer_2_expert_0 -->
<g id="edge80" class="edge">
<title>layer_2_all2all&#45;&gt;layer_2_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2686.78,-12669.87C2306.83,-12661.75 1257.56,-12636.34 914,-12596.99 839.42,-12588.45 818.77,-12582.78 742.25,-12564.26"/>
<polygon fill="black" stroke="black" points="742.66,-12560.76 732.12,-12561.81 741.02,-12567.56 742.66,-12560.76"/>
<text text-anchor="middle" x="1005.5" y="-12585.79" font-family="Times,serif" font-size="14.00">tokens routed to expert 0</text>
</g>
<!-- layer_2_expert_1 -->
<g id="node50" class="node">
<title>layer_2_expert_1</title>
<polygon fill="lightblue" stroke="black" points="1010,-12563.99 750,-12563.99 750,-12480.99 1010,-12480.99 1010,-12563.99"/>
<text text-anchor="middle" x="880" y="-12548.79" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="880" y="-12533.79" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="880" y="-12518.79" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="880" y="-12503.79" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="880" y="-12488.79" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_2_all2all&#45;&gt;layer_2_expert_1 -->
<g id="edge81" class="edge">
<title>layer_2_all2all&#45;&gt;layer_2_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2686.65,-12673.23C2403.05,-12672.81 1738.82,-12663.99 1186,-12596.99 1131.1,-12590.34 1071.77,-12577.45 1020.1,-12564.31"/>
<polygon fill="black" stroke="black" points="1020.76,-12560.87 1010.21,-12561.76 1019.02,-12567.65 1020.76,-12560.87"/>
<text text-anchor="middle" x="1277.5" y="-12585.79" font-family="Times,serif" font-size="14.00">tokens routed to expert 1</text>
</g>
<!-- layer_2_expert_2 -->
<g id="node51" class="node">
<title>layer_2_expert_2</title>
<polygon fill="lightblue" stroke="black" points="1288,-12563.99 1028,-12563.99 1028,-12480.99 1288,-12480.99 1288,-12563.99"/>
<text text-anchor="middle" x="1158" y="-12548.79" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1158" y="-12533.79" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1158" y="-12518.79" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1158" y="-12503.79" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1158" y="-12488.79" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_2_all2all&#45;&gt;layer_2_expert_2 -->
<g id="edge82" class="edge">
<title>layer_2_all2all&#45;&gt;layer_2_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2686.7,-12671.91C2438.22,-12669 1902.6,-12655.75 1455,-12596.99 1403.03,-12590.17 1347,-12577.69 1297.76,-12564.92"/>
<polygon fill="black" stroke="black" points="1298.57,-12561.52 1288.01,-12562.37 1296.8,-12568.29 1298.57,-12561.52"/>
<text text-anchor="middle" x="1546.5" y="-12585.79" font-family="Times,serif" font-size="14.00">tokens routed to expert 2</text>
</g>
<!-- layer_2_expert_3 -->
<g id="node52" class="node">
<title>layer_2_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1566,-12563.99 1306,-12563.99 1306,-12480.99 1566,-12480.99 1566,-12563.99"/>
<text text-anchor="middle" x="1436" y="-12548.79" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1436" y="-12533.79" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1436" y="-12518.79" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1436" y="-12503.79" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1436" y="-12488.79" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_2_all2all&#45;&gt;layer_2_expert_3 -->
<g id="edge83" class="edge">
<title>layer_2_all2all&#45;&gt;layer_2_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2686.67,-12670.74C2474.95,-12666.09 2060.01,-12650.34 1712,-12596.99 1666.77,-12590.06 1618.29,-12578.58 1574.78,-12566.72"/>
<polygon fill="black" stroke="black" points="1575.57,-12563.31 1565,-12564.03 1573.71,-12570.06 1575.57,-12563.31"/>
<text text-anchor="middle" x="1803.5" y="-12585.79" font-family="Times,serif" font-size="14.00">tokens routed to expert 3</text>
</g>
<!-- layer_2_expert_4 -->
<g id="node53" class="node">
<title>layer_2_expert_4</title>
<polygon fill="lightblue" stroke="black" points="1844,-12563.99 1584,-12563.99 1584,-12480.99 1844,-12480.99 1844,-12563.99"/>
<text text-anchor="middle" x="1714" y="-12548.79" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1714" y="-12533.79" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1714" y="-12518.79" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1714" y="-12503.79" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1714" y="-12488.79" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_2_all2all&#45;&gt;layer_2_expert_4 -->
<g id="edge84" class="edge">
<title>layer_2_all2all&#45;&gt;layer_2_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2686.78,-12669.07C2515.04,-12662.65 2214.77,-12645.02 1962,-12596.99 1922.65,-12589.52 1880.62,-12578.33 1842.55,-12566.92"/>
<polygon fill="black" stroke="black" points="1843.54,-12563.57 1832.96,-12564.02 1841.51,-12570.27 1843.54,-12563.57"/>
<text text-anchor="middle" x="2053.5" y="-12585.79" font-family="Times,serif" font-size="14.00">tokens routed to expert 4</text>
</g>
<!-- layer_2_expert_5 -->
<g id="node54" class="node">
<title>layer_2_expert_5</title>
<polygon fill="lightblue" stroke="black" points="2122,-12563.99 1862,-12563.99 1862,-12480.99 2122,-12480.99 2122,-12563.99"/>
<text text-anchor="middle" x="1992" y="-12548.79" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="1992" y="-12533.79" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1992" y="-12518.79" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1992" y="-12503.79" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1992" y="-12488.79" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_2_all2all&#45;&gt;layer_2_expert_5 -->
<g id="edge85" class="edge">
<title>layer_2_all2all&#45;&gt;layer_2_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2688.18,-12664.54C2560.75,-12655 2366.74,-12635.34 2202,-12596.99 2169.44,-12589.41 2134.89,-12578.56 2103.43,-12567.51"/>
<polygon fill="black" stroke="black" points="2104.36,-12564.13 2093.76,-12564.08 2102.02,-12570.72 2104.36,-12564.13"/>
<text text-anchor="middle" x="2293.5" y="-12585.79" font-family="Times,serif" font-size="14.00">tokens routed to expert 5</text>
</g>
<!-- layer_2_expert_6 -->
<g id="node55" class="node">
<title>layer_2_expert_6</title>
<polygon fill="lightblue" stroke="black" points="2400,-12563.99 2140,-12563.99 2140,-12480.99 2400,-12480.99 2400,-12563.99"/>
<text text-anchor="middle" x="2270" y="-12548.79" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="2270" y="-12533.79" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2270" y="-12518.79" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2270" y="-12503.79" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2270" y="-12488.79" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_2_all2all&#45;&gt;layer_2_expert_6 -->
<g id="edge86" class="edge">
<title>layer_2_all2all&#45;&gt;layer_2_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2693.36,-12655.53C2615.49,-12643.45 2515.83,-12624.46 2430,-12596.99 2405.84,-12589.26 2380.53,-12578.82 2357.36,-12568.23"/>
<polygon fill="black" stroke="black" points="2358.79,-12565.04 2348.25,-12564.02 2355.85,-12571.4 2358.79,-12565.04"/>
<text text-anchor="middle" x="2521.5" y="-12585.79" font-family="Times,serif" font-size="14.00">tokens routed to expert 6</text>
</g>
<!-- layer_2_expert_7 -->
<g id="node56" class="node">
<title>layer_2_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2678,-12563.99 2418,-12563.99 2418,-12480.99 2678,-12480.99 2678,-12563.99"/>
<text text-anchor="middle" x="2548" y="-12548.79" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2548" y="-12533.79" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2548" y="-12518.79" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2548" y="-12503.79" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2548" y="-12488.79" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_2_all2all&#45;&gt;layer_2_expert_7 -->
<g id="edge87" class="edge">
<title>layer_2_all2all&#45;&gt;layer_2_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2719.06,-12635.71C2692.17,-12624.72 2663.9,-12611.65 2639,-12596.99 2625.94,-12589.3 2612.75,-12579.85 2600.63,-12570.31"/>
<polygon fill="black" stroke="black" points="2602.82,-12567.58 2592.83,-12564.05 2598.44,-12573.04 2602.82,-12567.58"/>
<text text-anchor="middle" x="2730.5" y="-12585.79" font-family="Times,serif" font-size="14.00">tokens routed to expert 7</text>
</g>
<!-- layer_2_expert_8 -->
<g id="node57" class="node">
<title>layer_2_expert_8</title>
<polygon fill="lightblue" stroke="black" points="2956,-12563.99 2696,-12563.99 2696,-12480.99 2956,-12480.99 2956,-12563.99"/>
<text text-anchor="middle" x="2826" y="-12548.79" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="2826" y="-12533.79" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2826" y="-12518.79" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2826" y="-12503.79" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2826" y="-12488.79" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_2_all2all&#45;&gt;layer_2_expert_8 -->
<g id="edge88" class="edge">
<title>layer_2_all2all&#45;&gt;layer_2_expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2826,-12614.57C2826,-12601.28 2826,-12587.24 2826,-12574.28"/>
<polygon fill="black" stroke="black" points="2829.5,-12574.15 2826,-12564.15 2822.5,-12574.15 2829.5,-12574.15"/>
<text text-anchor="middle" x="2917.5" y="-12585.79" font-family="Times,serif" font-size="14.00">tokens routed to expert 8</text>
</g>
<!-- layer_2_expert_9 -->
<g id="node58" class="node">
<title>layer_2_expert_9</title>
<polygon fill="lightblue" stroke="black" points="3234,-12563.99 2974,-12563.99 2974,-12480.99 3234,-12480.99 3234,-12563.99"/>
<text text-anchor="middle" x="3104" y="-12548.79" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="3104" y="-12533.79" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3104" y="-12518.79" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3104" y="-12503.79" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3104" y="-12488.79" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_2_all2all&#45;&gt;layer_2_expert_9 -->
<g id="edge89" class="edge">
<title>layer_2_all2all&#45;&gt;layer_2_expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2932.94,-12635.71C2959.83,-12624.72 2988.1,-12611.65 3013,-12596.99 3026.06,-12589.3 3039.25,-12579.85 3051.37,-12570.31"/>
<polygon fill="black" stroke="black" points="3053.56,-12573.04 3059.17,-12564.05 3049.18,-12567.58 3053.56,-12573.04"/>
<text text-anchor="middle" x="3125.5" y="-12585.79" font-family="Times,serif" font-size="14.00">tokens routed to expert 9</text>
</g>
<!-- layer_2_expert_10 -->
<g id="node59" class="node">
<title>layer_2_expert_10</title>
<polygon fill="lightblue" stroke="black" points="3512,-12563.99 3252,-12563.99 3252,-12480.99 3512,-12480.99 3512,-12563.99"/>
<text text-anchor="middle" x="3382" y="-12548.79" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="3382" y="-12533.79" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3382" y="-12518.79" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3382" y="-12503.79" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3382" y="-12488.79" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_2_all2all&#45;&gt;layer_2_expert_10 -->
<g id="edge90" class="edge">
<title>layer_2_all2all&#45;&gt;layer_2_expert_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2958.73,-12655.35C3036.33,-12643.22 3135.52,-12624.26 3221,-12596.99 3245.29,-12589.24 3270.75,-12578.8 3294.07,-12568.21"/>
<polygon fill="black" stroke="black" points="3295.61,-12571.35 3303.24,-12564 3292.69,-12564.99 3295.61,-12571.35"/>
<text text-anchor="middle" x="3357" y="-12585.79" font-family="Times,serif" font-size="14.00">tokens routed to expert 10</text>
</g>
<!-- layer_2_expert_11 -->
<g id="node60" class="node">
<title>layer_2_expert_11</title>
<polygon fill="lightblue" stroke="black" points="3790,-12563.99 3530,-12563.99 3530,-12480.99 3790,-12480.99 3790,-12563.99"/>
<text text-anchor="middle" x="3660" y="-12548.79" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="3660" y="-12533.79" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3660" y="-12518.79" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3660" y="-12503.79" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3660" y="-12488.79" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_2_all2all&#45;&gt;layer_2_expert_11 -->
<g id="edge91" class="edge">
<title>layer_2_all2all&#45;&gt;layer_2_expert_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2963.9,-12665.21C3092.81,-12656.1 3289.95,-12636.7 3457,-12596.99 3488.51,-12589.5 3521.87,-12578.7 3552.25,-12567.67"/>
<polygon fill="black" stroke="black" points="3553.82,-12570.82 3562,-12564.08 3551.4,-12564.25 3553.82,-12570.82"/>
<text text-anchor="middle" x="3604" y="-12585.79" font-family="Times,serif" font-size="14.00">tokens routed to expert 11</text>
</g>
<!-- layer_2_expert_12 -->
<g id="node61" class="node">
<title>layer_2_expert_12</title>
<polygon fill="lightblue" stroke="black" points="4068,-12563.99 3808,-12563.99 3808,-12480.99 4068,-12480.99 4068,-12563.99"/>
<text text-anchor="middle" x="3938" y="-12548.79" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="3938" y="-12533.79" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3938" y="-12518.79" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3938" y="-12503.79" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3938" y="-12488.79" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_2_all2all&#45;&gt;layer_2_expert_12 -->
<g id="edge92" class="edge">
<title>layer_2_all2all&#45;&gt;layer_2_expert_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2965.31,-12670.03C3139.58,-12664.58 3446.41,-12647.92 3704,-12596.99 3741.2,-12589.64 3780.83,-12578.51 3816.7,-12567.12"/>
<polygon fill="black" stroke="black" points="3817.77,-12570.45 3826.22,-12564.06 3815.63,-12563.79 3817.77,-12570.45"/>
<text text-anchor="middle" x="3858" y="-12585.79" font-family="Times,serif" font-size="14.00">tokens routed to expert 12</text>
</g>
<!-- layer_2_expert_13 -->
<g id="node62" class="node">
<title>layer_2_expert_13</title>
<polygon fill="lightblue" stroke="black" points="4346,-12563.99 4086,-12563.99 4086,-12480.99 4346,-12480.99 4346,-12563.99"/>
<text text-anchor="middle" x="4216" y="-12548.79" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="4216" y="-12533.79" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4216" y="-12518.79" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4216" y="-12503.79" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4216" y="-12488.79" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_2_all2all&#45;&gt;layer_2_expert_13 -->
<g id="edge93" class="edge">
<title>layer_2_all2all&#45;&gt;layer_2_expert_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2965.61,-12672.46C3180.38,-12670.07 3604.12,-12657.24 3958,-12596.99 3999.67,-12589.9 4044.23,-12578.59 4084.38,-12566.96"/>
<polygon fill="black" stroke="black" points="4085.61,-12570.25 4094.22,-12564.08 4083.64,-12563.53 4085.61,-12570.25"/>
<text text-anchor="middle" x="4118" y="-12585.79" font-family="Times,serif" font-size="14.00">tokens routed to expert 13</text>
</g>
<!-- layer_2_expert_14 -->
<g id="node63" class="node">
<title>layer_2_expert_14</title>
<polygon fill="lightblue" stroke="black" points="4624,-12563.99 4364,-12563.99 4364,-12480.99 4624,-12480.99 4624,-12563.99"/>
<text text-anchor="middle" x="4494" y="-12548.79" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="4494" y="-12533.79" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4494" y="-12518.79" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4494" y="-12503.79" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4494" y="-12488.79" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_2_all2all&#45;&gt;layer_2_expert_14 -->
<g id="edge94" class="edge">
<title>layer_2_all2all&#45;&gt;layer_2_expert_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2965.63,-12673.46C3217.34,-12673.02 3763.3,-12663.55 4218,-12596.99 4263.73,-12590.3 4312.74,-12578.74 4356.59,-12566.74"/>
<polygon fill="black" stroke="black" points="4357.74,-12570.05 4366.45,-12564.01 4355.87,-12563.31 4357.74,-12570.05"/>
<text text-anchor="middle" x="4390" y="-12585.79" font-family="Times,serif" font-size="14.00">tokens routed to expert 14</text>
</g>
<!-- layer_2_expert_15 -->
<g id="node64" class="node">
<title>layer_2_expert_15</title>
<polygon fill="lightblue" stroke="black" points="4902,-12563.99 4642,-12563.99 4642,-12480.99 4902,-12480.99 4902,-12563.99"/>
<text text-anchor="middle" x="4772" y="-12548.79" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="4772" y="-12533.79" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4772" y="-12518.79" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4772" y="-12503.79" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4772" y="-12488.79" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_2_all2all&#45;&gt;layer_2_expert_15 -->
<g id="edge95" class="edge">
<title>layer_2_all2all&#45;&gt;layer_2_expert_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2965.05,-12669.6C3309.75,-12661.45 4196.95,-12637.13 4490,-12596.99 4537.17,-12590.53 4587.76,-12578.89 4632.89,-12566.75"/>
<polygon fill="black" stroke="black" points="4634,-12570.08 4642.73,-12564.07 4632.16,-12563.32 4634,-12570.08"/>
<text text-anchor="middle" x="4664" y="-12585.79" font-family="Times,serif" font-size="14.00">tokens routed to expert 15</text>
</g>
<!-- layer_2_all2all_result -->
<g id="node65" class="node">
<title>layer_2_all2all_result</title>
<ellipse fill="yellow" stroke="black" cx="2826" cy="-12385.3" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="2826" y="-12411.6" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="2826" y="-12396.6" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Result Merge</text>
<text text-anchor="middle" x="2826" y="-12381.6" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="2826" y="-12366.6" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="2826" y="-12351.6" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_2_expert_0&#45;&gt;layer_2_all2all_result -->
<g id="edge96" class="edge">
<title>layer_2_expert_0&#45;&gt;layer_2_all2all_result</title>
<path fill="none" stroke="black" d="M732,-12482.6C735.02,-12482.02 738.02,-12481.49 741,-12480.99 1113.89,-12419.11 2263.76,-12395.2 2676.55,-12388.47"/>
<polygon fill="black" stroke="black" points="2676.81,-12391.97 2686.76,-12388.31 2676.7,-12384.97 2676.81,-12391.97"/>
</g>
<!-- layer_2_expert_1&#45;&gt;layer_2_all2all_result -->
<g id="edge97" class="edge">
<title>layer_2_expert_1&#45;&gt;layer_2_all2all_result</title>
<path fill="none" stroke="black" d="M1010.01,-12482.63C1013.03,-12482.04 1016.03,-12481.5 1019,-12480.99 1336.38,-12427.19 2303.71,-12398.84 2676.92,-12389.68"/>
<polygon fill="black" stroke="black" points="2677.07,-12393.18 2686.98,-12389.43 2676.9,-12386.18 2677.07,-12393.18"/>
</g>
<!-- layer_2_expert_2&#45;&gt;layer_2_all2all_result -->
<g id="edge98" class="edge">
<title>layer_2_expert_2&#45;&gt;layer_2_all2all_result</title>
<path fill="none" stroke="black" d="M1288.01,-12482.66C1291.03,-12482.07 1294.03,-12481.51 1297,-12480.99 1559.24,-12435.25 2346.24,-12403.15 2677,-12391.32"/>
<polygon fill="black" stroke="black" points="2677.26,-12394.82 2687.13,-12390.96 2677.01,-12387.82 2677.26,-12394.82"/>
</g>
<!-- layer_2_expert_3&#45;&gt;layer_2_all2all_result -->
<g id="edge99" class="edge">
<title>layer_2_expert_3&#45;&gt;layer_2_all2all_result</title>
<path fill="none" stroke="black" d="M1566.02,-12482.72C1569.04,-12482.11 1572.03,-12481.53 1575,-12480.99 1968.23,-12409.63 2440.45,-12391.92 2676.41,-12387.61"/>
<polygon fill="black" stroke="black" points="2676.49,-12391.11 2686.43,-12387.44 2676.37,-12384.11 2676.49,-12391.11"/>
</g>
<!-- layer_2_expert_4&#45;&gt;layer_2_all2all_result -->
<g id="edge100" class="edge">
<title>layer_2_expert_4&#45;&gt;layer_2_all2all_result</title>
<path fill="none" stroke="black" d="M1844.04,-12482.81C1847.05,-12482.17 1850.04,-12481.56 1853,-12480.99 2141.78,-12425.38 2485.4,-12401.67 2677.32,-12392.15"/>
<polygon fill="black" stroke="black" points="2677.66,-12395.64 2687.47,-12391.66 2677.32,-12388.65 2677.66,-12395.64"/>
</g>
<!-- layer_2_expert_5&#45;&gt;layer_2_all2all_result -->
<g id="edge101" class="edge">
<title>layer_2_expert_5&#45;&gt;layer_2_all2all_result</title>
<path fill="none" stroke="black" d="M2122.07,-12482.96C2125.07,-12482.28 2128.05,-12481.62 2131,-12480.99 2318.71,-12441.09 2538.69,-12414.43 2680.08,-12399.83"/>
<polygon fill="black" stroke="black" points="2680.53,-12403.3 2690.12,-12398.8 2679.81,-12396.34 2680.53,-12403.3"/>
</g>
<!-- layer_2_expert_6&#45;&gt;layer_2_all2all_result -->
<g id="edge102" class="edge">
<title>layer_2_expert_6&#45;&gt;layer_2_all2all_result</title>
<path fill="none" stroke="black" d="M2400.15,-12483.31C2403.13,-12482.52 2406.08,-12481.75 2409,-12480.99 2503.1,-12456.62 2610.02,-12432.41 2692.03,-12414.57"/>
<polygon fill="black" stroke="black" points="2692.88,-12417.97 2701.91,-12412.43 2691.39,-12411.13 2692.88,-12417.97"/>
</g>
<!-- layer_2_expert_7&#45;&gt;layer_2_all2all_result -->
<g id="edge103" class="edge">
<title>layer_2_expert_7&#45;&gt;layer_2_all2all_result</title>
<path fill="none" stroke="black" d="M2631.41,-12480.93C2661.4,-12466.35 2695.51,-12449.76 2726.72,-12434.58"/>
<polygon fill="black" stroke="black" points="2728.41,-12437.65 2735.87,-12430.13 2725.34,-12431.36 2728.41,-12437.65"/>
</g>
<!-- layer_2_expert_8&#45;&gt;layer_2_all2all_result -->
<g id="edge104" class="edge">
<title>layer_2_expert_8&#45;&gt;layer_2_all2all_result</title>
<path fill="none" stroke="black" d="M2826,-12480.93C2826,-12472.57 2826,-12463.54 2826,-12454.5"/>
<polygon fill="black" stroke="black" points="2829.5,-12454.33 2826,-12444.33 2822.5,-12454.33 2829.5,-12454.33"/>
</g>
<!-- layer_2_expert_9&#45;&gt;layer_2_all2all_result -->
<g id="edge105" class="edge">
<title>layer_2_expert_9&#45;&gt;layer_2_all2all_result</title>
<path fill="none" stroke="black" d="M3020.59,-12480.93C2990.6,-12466.35 2956.49,-12449.76 2925.28,-12434.58"/>
<polygon fill="black" stroke="black" points="2926.66,-12431.36 2916.13,-12430.13 2923.59,-12437.65 2926.66,-12431.36"/>
</g>
<!-- layer_2_expert_10&#45;&gt;layer_2_all2all_result -->
<g id="edge106" class="edge">
<title>layer_2_expert_10&#45;&gt;layer_2_all2all_result</title>
<path fill="none" stroke="black" d="M3251.85,-12483.31C3248.87,-12482.52 3245.92,-12481.75 3243,-12480.99 3148.9,-12456.62 3041.98,-12432.41 2959.97,-12414.57"/>
<polygon fill="black" stroke="black" points="2960.61,-12411.13 2950.09,-12412.43 2959.12,-12417.97 2960.61,-12411.13"/>
</g>
<!-- layer_2_expert_11&#45;&gt;layer_2_all2all_result -->
<g id="edge107" class="edge">
<title>layer_2_expert_11&#45;&gt;layer_2_all2all_result</title>
<path fill="none" stroke="black" d="M3529.93,-12482.96C3526.93,-12482.28 3523.95,-12481.62 3521,-12480.99 3333.29,-12441.09 3113.31,-12414.43 2971.92,-12399.83"/>
<polygon fill="black" stroke="black" points="2972.19,-12396.34 2961.88,-12398.8 2971.47,-12403.3 2972.19,-12396.34"/>
</g>
<!-- layer_2_expert_12&#45;&gt;layer_2_all2all_result -->
<g id="edge108" class="edge">
<title>layer_2_expert_12&#45;&gt;layer_2_all2all_result</title>
<path fill="none" stroke="black" d="M3807.96,-12482.81C3804.95,-12482.17 3801.96,-12481.56 3799,-12480.99 3510.22,-12425.38 3166.6,-12401.67 2974.68,-12392.15"/>
<polygon fill="black" stroke="black" points="2974.68,-12388.65 2964.53,-12391.66 2974.34,-12395.64 2974.68,-12388.65"/>
</g>
<!-- layer_2_expert_13&#45;&gt;layer_2_all2all_result -->
<g id="edge109" class="edge">
<title>layer_2_expert_13&#45;&gt;layer_2_all2all_result</title>
<path fill="none" stroke="black" d="M4085.98,-12482.72C4082.96,-12482.11 4079.97,-12481.53 4077,-12480.99 3683.77,-12409.63 3211.55,-12391.92 2975.59,-12387.61"/>
<polygon fill="black" stroke="black" points="2975.63,-12384.11 2965.57,-12387.44 2975.51,-12391.11 2975.63,-12384.11"/>
</g>
<!-- layer_2_expert_14&#45;&gt;layer_2_all2all_result -->
<g id="edge110" class="edge">
<title>layer_2_expert_14&#45;&gt;layer_2_all2all_result</title>
<path fill="none" stroke="black" d="M4363.99,-12482.66C4360.97,-12482.07 4357.97,-12481.51 4355,-12480.99 4092.76,-12435.25 3305.76,-12403.15 2975,-12391.32"/>
<polygon fill="black" stroke="black" points="2974.99,-12387.82 2964.87,-12390.96 2974.74,-12394.82 2974.99,-12387.82"/>
</g>
<!-- layer_2_expert_15&#45;&gt;layer_2_all2all_result -->
<g id="edge111" class="edge">
<title>layer_2_expert_15&#45;&gt;layer_2_all2all_result</title>
<path fill="none" stroke="black" d="M4641.99,-12482.63C4638.97,-12482.04 4635.97,-12481.5 4633,-12480.99 4315.62,-12427.19 3348.29,-12398.84 2975.08,-12389.68"/>
<polygon fill="black" stroke="black" points="2975.1,-12386.18 2965.02,-12389.43 2974.93,-12393.18 2975.1,-12386.18"/>
</g>
<!-- layer_2_expert_agg -->
<g id="node66" class="node">
<title>layer_2_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="4420,-12289.61 4172,-12289.61 4172,-12206.61 4420,-12206.61 4420,-12289.61"/>
<text text-anchor="middle" x="4296" y="-12274.41" font-family="Times,serif" font-size="14.00">Layer 2</text>
<text text-anchor="middle" x="4296" y="-12259.41" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4296" y="-12244.41" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4296" y="-12229.41" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="4296" y="-12214.41" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_2_all2all_result&#45;&gt;layer_2_expert_agg -->
<g id="edge112" class="edge">
<title>layer_2_all2all_result&#45;&gt;layer_2_expert_agg</title>
<path fill="none" stroke="black" d="M2961.66,-12371.83C3242.06,-12346.04 3882.53,-12287.14 4161.73,-12261.46"/>
<polygon fill="black" stroke="black" points="4162.28,-12264.93 4171.92,-12260.52 4161.64,-12257.96 4162.28,-12264.93"/>
</g>
<!-- layer_2_expert_agg&#45;&gt;layer_2_residual -->
<g id="edge114" class="edge">
<title>layer_2_expert_agg&#45;&gt;layer_2_residual</title>
<path fill="none" stroke="black" d="M4420.21,-12221.22C4498.7,-12204.85 4601.29,-12183.47 4687.85,-12165.42"/>
<polygon fill="black" stroke="black" points="4688.7,-12168.82 4697.78,-12163.35 4687.28,-12161.96 4688.7,-12168.82"/>
</g>
<!-- layer_3_mha -->
<g id="node68" class="node">
<title>layer_3_mha</title>
<polygon fill="lightblue" stroke="black" points="4963.5,-12049.61 4760.5,-12049.61 4760.5,-11966.61 4963.5,-11966.61 4963.5,-12049.61"/>
<text text-anchor="middle" x="4862" y="-12034.41" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="4862" y="-12019.41" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="4862" y="-12004.41" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4862" y="-11989.41" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="4862" y="-11974.41" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_2_residual&#45;&gt;layer_3_mha -->
<g id="edge115" class="edge">
<title>layer_2_residual&#45;&gt;layer_3_mha</title>
<path fill="none" stroke="black" d="M4862,-12086.5C4862,-12077.97 4862,-12068.88 4862,-12060.02"/>
<polygon fill="black" stroke="black" points="4865.5,-12059.8 4862,-12049.8 4858.5,-12059.8 4865.5,-12059.8"/>
</g>
<!-- layer_3_gate -->
<g id="node69" class="node">
<title>layer_3_gate</title>
<polygon fill="lightblue" stroke="black" points="4649.5,-11929.61 4450.5,-11929.61 4450.5,-11846.61 4649.5,-11846.61 4649.5,-11929.61"/>
<text text-anchor="middle" x="4550" y="-11914.41" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="4550" y="-11899.41" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="4550" y="-11884.41" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4550" y="-11869.41" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="4550" y="-11854.41" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_3_mha&#45;&gt;layer_3_gate -->
<g id="edge116" class="edge">
<title>layer_3_mha&#45;&gt;layer_3_gate</title>
<path fill="none" stroke="black" d="M4760.27,-11968.64C4727.98,-11956.43 4692.15,-11942.87 4659.35,-11930.47"/>
<polygon fill="black" stroke="black" points="4660.32,-11927.09 4649.73,-11926.83 4657.84,-11933.64 4660.32,-11927.09"/>
</g>
<!-- layer_3_residual -->
<g id="node89" class="node">
<title>layer_3_residual</title>
<polygon fill="lightblue" stroke="black" points="5262,-11246.85 4934,-11246.85 4934,-11163.85 5262,-11163.85 5262,-11246.85"/>
<text text-anchor="middle" x="5098" y="-11231.65" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="5098" y="-11216.65" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5098" y="-11201.65" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="5098" y="-11186.65" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="5098" y="-11171.65" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_3_mha&#45;&gt;layer_3_residual -->
<g id="edge151" class="edge">
<title>layer_3_mha&#45;&gt;layer_3_residual</title>
<path fill="none" stroke="black" d="M4963.73,-11988.68C5054.78,-11969.2 5174,-11934.94 5174,-11889.11 5174,-11889.11 5174,-11889.11 5174,-11324.35 5174,-11298.97 5161.42,-11274.72 5146.5,-11254.86"/>
<polygon fill="black" stroke="black" points="5149.17,-11252.6 5140.22,-11246.92 5143.67,-11256.94 5149.17,-11252.6"/>
<text text-anchor="middle" x="5202" y="-11596.03" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_3_all2all -->
<g id="node70" class="node">
<title>layer_3_all2all</title>
<ellipse fill="yellow" stroke="black" cx="3062" cy="-11750.92" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="3062" y="-11777.22" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="3062" y="-11762.22" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="3062" y="-11747.22" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="3062" y="-11732.22" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="3062" y="-11717.22" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_3_gate&#45;&gt;layer_3_all2all -->
<g id="edge117" class="edge">
<title>layer_3_gate&#45;&gt;layer_3_all2all</title>
<path fill="none" stroke="black" d="M4450.35,-11878.06C4193.76,-11854.75 3509.46,-11792.58 3208.03,-11765.19"/>
<polygon fill="black" stroke="black" points="3208.18,-11761.69 3197.91,-11764.27 3207.55,-11768.66 3208.18,-11761.69"/>
</g>
<!-- layer_3_expert_0 -->
<g id="node71" class="node">
<title>layer_3_expert_0</title>
<polygon fill="lightblue" stroke="black" points="968,-11641.23 708,-11641.23 708,-11558.23 968,-11558.23 968,-11641.23"/>
<text text-anchor="middle" x="838" y="-11626.03" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="838" y="-11611.03" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="838" y="-11596.03" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="838" y="-11581.03" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="838" y="-11566.03" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_3_all2all&#45;&gt;layer_3_expert_0 -->
<g id="edge118" class="edge">
<title>layer_3_all2all&#45;&gt;layer_3_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2922.78,-11747.11C2542.83,-11738.99 1493.56,-11713.58 1150,-11674.23 1075.42,-11665.69 1054.77,-11660.02 978.25,-11641.5"/>
<polygon fill="black" stroke="black" points="978.66,-11638 968.12,-11639.05 977.02,-11644.8 978.66,-11638"/>
<text text-anchor="middle" x="1241.5" y="-11663.03" font-family="Times,serif" font-size="14.00">tokens routed to expert 0</text>
</g>
<!-- layer_3_expert_1 -->
<g id="node72" class="node">
<title>layer_3_expert_1</title>
<polygon fill="lightblue" stroke="black" points="1246,-11641.23 986,-11641.23 986,-11558.23 1246,-11558.23 1246,-11641.23"/>
<text text-anchor="middle" x="1116" y="-11626.03" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1116" y="-11611.03" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1116" y="-11596.03" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1116" y="-11581.03" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1116" y="-11566.03" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_3_all2all&#45;&gt;layer_3_expert_1 -->
<g id="edge119" class="edge">
<title>layer_3_all2all&#45;&gt;layer_3_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2922.56,-11750.53C2638.78,-11750.22 1974.12,-11741.58 1421,-11674.23 1366.4,-11667.58 1307.41,-11654.74 1255.99,-11641.63"/>
<polygon fill="black" stroke="black" points="1256.71,-11638.2 1246.15,-11639.09 1254.96,-11644.98 1256.71,-11638.2"/>
<text text-anchor="middle" x="1512.5" y="-11663.03" font-family="Times,serif" font-size="14.00">tokens routed to expert 1</text>
</g>
<!-- layer_3_expert_2 -->
<g id="node73" class="node">
<title>layer_3_expert_2</title>
<polygon fill="lightblue" stroke="black" points="1524,-11641.23 1264,-11641.23 1264,-11558.23 1524,-11558.23 1524,-11641.23"/>
<text text-anchor="middle" x="1394" y="-11626.03" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1394" y="-11611.03" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1394" y="-11596.03" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1394" y="-11581.03" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1394" y="-11566.03" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_3_all2all&#45;&gt;layer_3_expert_2 -->
<g id="edge120" class="edge">
<title>layer_3_all2all&#45;&gt;layer_3_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2922.7,-11749.15C2674.22,-11746.24 2138.6,-11732.99 1691,-11674.23 1639.03,-11667.41 1583,-11654.93 1533.76,-11642.16"/>
<polygon fill="black" stroke="black" points="1534.57,-11638.76 1524.01,-11639.61 1532.8,-11645.53 1534.57,-11638.76"/>
<text text-anchor="middle" x="1782.5" y="-11663.03" font-family="Times,serif" font-size="14.00">tokens routed to expert 2</text>
</g>
<!-- layer_3_expert_3 -->
<g id="node74" class="node">
<title>layer_3_expert_3</title>
<polygon fill="lightblue" stroke="black" points="1802,-11641.23 1542,-11641.23 1542,-11558.23 1802,-11558.23 1802,-11641.23"/>
<text text-anchor="middle" x="1672" y="-11626.03" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1672" y="-11611.03" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1672" y="-11596.03" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1672" y="-11581.03" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1672" y="-11566.03" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_3_all2all&#45;&gt;layer_3_expert_3 -->
<g id="edge121" class="edge">
<title>layer_3_all2all&#45;&gt;layer_3_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2922.67,-11747.98C2710.95,-11743.33 2296.01,-11727.58 1948,-11674.23 1902.77,-11667.3 1854.29,-11655.82 1810.78,-11643.96"/>
<polygon fill="black" stroke="black" points="1811.57,-11640.55 1801,-11641.27 1809.71,-11647.3 1811.57,-11640.55"/>
<text text-anchor="middle" x="2039.5" y="-11663.03" font-family="Times,serif" font-size="14.00">tokens routed to expert 3</text>
</g>
<!-- layer_3_expert_4 -->
<g id="node75" class="node">
<title>layer_3_expert_4</title>
<polygon fill="lightblue" stroke="black" points="2080,-11641.23 1820,-11641.23 1820,-11558.23 2080,-11558.23 2080,-11641.23"/>
<text text-anchor="middle" x="1950" y="-11626.03" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="1950" y="-11611.03" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1950" y="-11596.03" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1950" y="-11581.03" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1950" y="-11566.03" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_3_all2all&#45;&gt;layer_3_expert_4 -->
<g id="edge122" class="edge">
<title>layer_3_all2all&#45;&gt;layer_3_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2922.78,-11746.31C2751.04,-11739.89 2450.77,-11722.26 2198,-11674.23 2158.65,-11666.76 2116.62,-11655.57 2078.55,-11644.16"/>
<polygon fill="black" stroke="black" points="2079.54,-11640.81 2068.96,-11641.26 2077.51,-11647.51 2079.54,-11640.81"/>
<text text-anchor="middle" x="2289.5" y="-11663.03" font-family="Times,serif" font-size="14.00">tokens routed to expert 4</text>
</g>
<!-- layer_3_expert_5 -->
<g id="node76" class="node">
<title>layer_3_expert_5</title>
<polygon fill="lightblue" stroke="black" points="2358,-11641.23 2098,-11641.23 2098,-11558.23 2358,-11558.23 2358,-11641.23"/>
<text text-anchor="middle" x="2228" y="-11626.03" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="2228" y="-11611.03" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2228" y="-11596.03" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2228" y="-11581.03" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2228" y="-11566.03" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_3_all2all&#45;&gt;layer_3_expert_5 -->
<g id="edge123" class="edge">
<title>layer_3_all2all&#45;&gt;layer_3_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2924.18,-11741.78C2796.75,-11732.24 2602.74,-11712.58 2438,-11674.23 2405.44,-11666.65 2370.89,-11655.8 2339.43,-11644.75"/>
<polygon fill="black" stroke="black" points="2340.36,-11641.37 2329.76,-11641.32 2338.02,-11647.96 2340.36,-11641.37"/>
<text text-anchor="middle" x="2529.5" y="-11663.03" font-family="Times,serif" font-size="14.00">tokens routed to expert 5</text>
</g>
<!-- layer_3_expert_6 -->
<g id="node77" class="node">
<title>layer_3_expert_6</title>
<polygon fill="lightblue" stroke="black" points="2636,-11641.23 2376,-11641.23 2376,-11558.23 2636,-11558.23 2636,-11641.23"/>
<text text-anchor="middle" x="2506" y="-11626.03" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="2506" y="-11611.03" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2506" y="-11596.03" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2506" y="-11581.03" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2506" y="-11566.03" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_3_all2all&#45;&gt;layer_3_expert_6 -->
<g id="edge124" class="edge">
<title>layer_3_all2all&#45;&gt;layer_3_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2929.36,-11732.77C2851.49,-11720.69 2751.83,-11701.7 2666,-11674.23 2641.84,-11666.5 2616.53,-11656.06 2593.36,-11645.48"/>
<polygon fill="black" stroke="black" points="2594.79,-11642.28 2584.25,-11641.26 2591.85,-11648.64 2594.79,-11642.28"/>
<text text-anchor="middle" x="2757.5" y="-11663.03" font-family="Times,serif" font-size="14.00">tokens routed to expert 6</text>
</g>
<!-- layer_3_expert_7 -->
<g id="node78" class="node">
<title>layer_3_expert_7</title>
<polygon fill="lightblue" stroke="black" points="2914,-11641.23 2654,-11641.23 2654,-11558.23 2914,-11558.23 2914,-11641.23"/>
<text text-anchor="middle" x="2784" y="-11626.03" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="2784" y="-11611.03" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2784" y="-11596.03" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2784" y="-11581.03" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2784" y="-11566.03" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_3_all2all&#45;&gt;layer_3_expert_7 -->
<g id="edge125" class="edge">
<title>layer_3_all2all&#45;&gt;layer_3_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2955.06,-11712.95C2928.17,-11701.96 2899.9,-11688.89 2875,-11674.23 2861.94,-11666.54 2848.75,-11657.09 2836.63,-11647.55"/>
<polygon fill="black" stroke="black" points="2838.82,-11644.82 2828.83,-11641.29 2834.44,-11650.28 2838.82,-11644.82"/>
<text text-anchor="middle" x="2966.5" y="-11663.03" font-family="Times,serif" font-size="14.00">tokens routed to expert 7</text>
</g>
<!-- layer_3_expert_8 -->
<g id="node79" class="node">
<title>layer_3_expert_8</title>
<polygon fill="lightblue" stroke="black" points="3192,-11641.23 2932,-11641.23 2932,-11558.23 3192,-11558.23 3192,-11641.23"/>
<text text-anchor="middle" x="3062" y="-11626.03" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="3062" y="-11611.03" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3062" y="-11596.03" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3062" y="-11581.03" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3062" y="-11566.03" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_3_all2all&#45;&gt;layer_3_expert_8 -->
<g id="edge126" class="edge">
<title>layer_3_all2all&#45;&gt;layer_3_expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3062,-11691.82C3062,-11678.52 3062,-11664.48 3062,-11651.52"/>
<polygon fill="black" stroke="black" points="3065.5,-11651.39 3062,-11641.39 3058.5,-11651.39 3065.5,-11651.39"/>
<text text-anchor="middle" x="3153.5" y="-11663.03" font-family="Times,serif" font-size="14.00">tokens routed to expert 8</text>
</g>
<!-- layer_3_expert_9 -->
<g id="node80" class="node">
<title>layer_3_expert_9</title>
<polygon fill="lightblue" stroke="black" points="3470,-11641.23 3210,-11641.23 3210,-11558.23 3470,-11558.23 3470,-11641.23"/>
<text text-anchor="middle" x="3340" y="-11626.03" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="3340" y="-11611.03" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3340" y="-11596.03" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3340" y="-11581.03" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3340" y="-11566.03" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_3_all2all&#45;&gt;layer_3_expert_9 -->
<g id="edge127" class="edge">
<title>layer_3_all2all&#45;&gt;layer_3_expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3168.94,-11712.95C3195.83,-11701.96 3224.1,-11688.89 3249,-11674.23 3262.06,-11666.54 3275.25,-11657.09 3287.37,-11647.55"/>
<polygon fill="black" stroke="black" points="3289.56,-11650.28 3295.17,-11641.29 3285.18,-11644.82 3289.56,-11650.28"/>
<text text-anchor="middle" x="3361.5" y="-11663.03" font-family="Times,serif" font-size="14.00">tokens routed to expert 9</text>
</g>
<!-- layer_3_expert_10 -->
<g id="node81" class="node">
<title>layer_3_expert_10</title>
<polygon fill="lightblue" stroke="black" points="3748,-11641.23 3488,-11641.23 3488,-11558.23 3748,-11558.23 3748,-11641.23"/>
<text text-anchor="middle" x="3618" y="-11626.03" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="3618" y="-11611.03" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3618" y="-11596.03" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3618" y="-11581.03" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3618" y="-11566.03" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_3_all2all&#45;&gt;layer_3_expert_10 -->
<g id="edge128" class="edge">
<title>layer_3_all2all&#45;&gt;layer_3_expert_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3194.73,-11732.59C3272.33,-11720.47 3371.52,-11701.5 3457,-11674.23 3481.29,-11666.48 3506.75,-11656.04 3530.07,-11645.45"/>
<polygon fill="black" stroke="black" points="3531.61,-11648.59 3539.24,-11641.24 3528.69,-11642.24 3531.61,-11648.59"/>
<text text-anchor="middle" x="3593" y="-11663.03" font-family="Times,serif" font-size="14.00">tokens routed to expert 10</text>
</g>
<!-- layer_3_expert_11 -->
<g id="node82" class="node">
<title>layer_3_expert_11</title>
<polygon fill="lightblue" stroke="black" points="4026,-11641.23 3766,-11641.23 3766,-11558.23 4026,-11558.23 4026,-11641.23"/>
<text text-anchor="middle" x="3896" y="-11626.03" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="3896" y="-11611.03" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3896" y="-11596.03" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3896" y="-11581.03" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3896" y="-11566.03" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_3_all2all&#45;&gt;layer_3_expert_11 -->
<g id="edge129" class="edge">
<title>layer_3_all2all&#45;&gt;layer_3_expert_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3199.9,-11742.45C3328.81,-11733.35 3525.95,-11713.94 3693,-11674.23 3724.51,-11666.74 3757.87,-11655.94 3788.25,-11644.91"/>
<polygon fill="black" stroke="black" points="3789.82,-11648.06 3798,-11641.32 3787.4,-11641.49 3789.82,-11648.06"/>
<text text-anchor="middle" x="3840" y="-11663.03" font-family="Times,serif" font-size="14.00">tokens routed to expert 11</text>
</g>
<!-- layer_3_expert_12 -->
<g id="node83" class="node">
<title>layer_3_expert_12</title>
<polygon fill="lightblue" stroke="black" points="4304,-11641.23 4044,-11641.23 4044,-11558.23 4304,-11558.23 4304,-11641.23"/>
<text text-anchor="middle" x="4174" y="-11626.03" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="4174" y="-11611.03" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4174" y="-11596.03" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4174" y="-11581.03" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4174" y="-11566.03" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_3_all2all&#45;&gt;layer_3_expert_12 -->
<g id="edge130" class="edge">
<title>layer_3_all2all&#45;&gt;layer_3_expert_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3201.31,-11747.27C3375.58,-11741.82 3682.41,-11725.16 3940,-11674.23 3977.2,-11666.88 4016.83,-11655.75 4052.7,-11644.36"/>
<polygon fill="black" stroke="black" points="4053.77,-11647.69 4062.22,-11641.3 4051.63,-11641.03 4053.77,-11647.69"/>
<text text-anchor="middle" x="4094" y="-11663.03" font-family="Times,serif" font-size="14.00">tokens routed to expert 12</text>
</g>
<!-- layer_3_expert_13 -->
<g id="node84" class="node">
<title>layer_3_expert_13</title>
<polygon fill="lightblue" stroke="black" points="4582,-11641.23 4322,-11641.23 4322,-11558.23 4582,-11558.23 4582,-11641.23"/>
<text text-anchor="middle" x="4452" y="-11626.03" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="4452" y="-11611.03" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4452" y="-11596.03" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4452" y="-11581.03" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4452" y="-11566.03" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_3_all2all&#45;&gt;layer_3_expert_13 -->
<g id="edge131" class="edge">
<title>layer_3_all2all&#45;&gt;layer_3_expert_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3201.61,-11749.7C3416.38,-11747.31 3840.12,-11734.48 4194,-11674.23 4235.67,-11667.14 4280.23,-11655.83 4320.38,-11644.2"/>
<polygon fill="black" stroke="black" points="4321.61,-11647.49 4330.22,-11641.32 4319.64,-11640.77 4321.61,-11647.49"/>
<text text-anchor="middle" x="4354" y="-11663.03" font-family="Times,serif" font-size="14.00">tokens routed to expert 13</text>
</g>
<!-- layer_3_expert_14 -->
<g id="node85" class="node">
<title>layer_3_expert_14</title>
<polygon fill="lightblue" stroke="black" points="4860,-11641.23 4600,-11641.23 4600,-11558.23 4860,-11558.23 4860,-11641.23"/>
<text text-anchor="middle" x="4730" y="-11626.03" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="4730" y="-11611.03" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4730" y="-11596.03" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4730" y="-11581.03" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4730" y="-11566.03" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_3_all2all&#45;&gt;layer_3_expert_14 -->
<g id="edge132" class="edge">
<title>layer_3_all2all&#45;&gt;layer_3_expert_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3201.63,-11750.7C3453.34,-11750.26 3999.3,-11740.79 4454,-11674.23 4499.73,-11667.54 4548.74,-11655.98 4592.59,-11643.98"/>
<polygon fill="black" stroke="black" points="4593.74,-11647.29 4602.45,-11641.25 4591.87,-11640.55 4593.74,-11647.29"/>
<text text-anchor="middle" x="4626" y="-11663.03" font-family="Times,serif" font-size="14.00">tokens routed to expert 14</text>
</g>
<!-- layer_3_expert_15 -->
<g id="node86" class="node">
<title>layer_3_expert_15</title>
<polygon fill="lightblue" stroke="black" points="5138,-11641.23 4878,-11641.23 4878,-11558.23 5138,-11558.23 5138,-11641.23"/>
<text text-anchor="middle" x="5008" y="-11626.03" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="5008" y="-11611.03" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5008" y="-11596.03" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5008" y="-11581.03" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5008" y="-11566.03" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_3_all2all&#45;&gt;layer_3_expert_15 -->
<g id="edge133" class="edge">
<title>layer_3_all2all&#45;&gt;layer_3_expert_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3201.05,-11746.85C3545.75,-11738.69 4432.95,-11714.37 4726,-11674.23 4773.17,-11667.77 4823.76,-11656.13 4868.89,-11643.99"/>
<polygon fill="black" stroke="black" points="4870,-11647.32 4878.73,-11641.31 4868.16,-11640.56 4870,-11647.32"/>
<text text-anchor="middle" x="4900" y="-11663.03" font-family="Times,serif" font-size="14.00">tokens routed to expert 15</text>
</g>
<!-- layer_3_all2all_result -->
<g id="node87" class="node">
<title>layer_3_all2all_result</title>
<ellipse fill="yellow" stroke="black" cx="3062" cy="-11462.54" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="3062" y="-11488.84" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="3062" y="-11473.84" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Result Merge</text>
<text text-anchor="middle" x="3062" y="-11458.84" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="3062" y="-11443.84" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="3062" y="-11428.84" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_3_expert_0&#45;&gt;layer_3_all2all_result -->
<g id="edge134" class="edge">
<title>layer_3_expert_0&#45;&gt;layer_3_all2all_result</title>
<path fill="none" stroke="black" d="M968,-11559.84C971.02,-11559.26 974.02,-11558.73 977,-11558.23 1349.89,-11496.35 2499.76,-11472.44 2912.55,-11465.71"/>
<polygon fill="black" stroke="black" points="2912.81,-11469.21 2922.76,-11465.55 2912.7,-11462.21 2912.81,-11469.21"/>
</g>
<!-- layer_3_expert_1&#45;&gt;layer_3_all2all_result -->
<g id="edge135" class="edge">
<title>layer_3_expert_1&#45;&gt;layer_3_all2all_result</title>
<path fill="none" stroke="black" d="M1246.01,-11559.87C1249.03,-11559.28 1252.03,-11558.74 1255,-11558.23 1572.38,-11504.43 2539.71,-11476.08 2912.92,-11466.92"/>
<polygon fill="black" stroke="black" points="2913.07,-11470.42 2922.98,-11466.67 2912.9,-11463.42 2913.07,-11470.42"/>
</g>
<!-- layer_3_expert_2&#45;&gt;layer_3_all2all_result -->
<g id="edge136" class="edge">
<title>layer_3_expert_2&#45;&gt;layer_3_all2all_result</title>
<path fill="none" stroke="black" d="M1524.01,-11559.9C1527.03,-11559.31 1530.03,-11558.75 1533,-11558.23 1795.24,-11512.49 2582.24,-11480.39 2913,-11468.56"/>
<polygon fill="black" stroke="black" points="2913.26,-11472.06 2923.13,-11468.2 2913.01,-11465.06 2913.26,-11472.06"/>
</g>
<!-- layer_3_expert_3&#45;&gt;layer_3_all2all_result -->
<g id="edge137" class="edge">
<title>layer_3_expert_3&#45;&gt;layer_3_all2all_result</title>
<path fill="none" stroke="black" d="M1802.02,-11559.96C1805.04,-11559.35 1808.03,-11558.77 1811,-11558.23 2204.23,-11486.87 2676.45,-11469.16 2912.41,-11464.85"/>
<polygon fill="black" stroke="black" points="2912.49,-11468.35 2922.43,-11464.68 2912.37,-11461.35 2912.49,-11468.35"/>
</g>
<!-- layer_3_expert_4&#45;&gt;layer_3_all2all_result -->
<g id="edge138" class="edge">
<title>layer_3_expert_4&#45;&gt;layer_3_all2all_result</title>
<path fill="none" stroke="black" d="M2080.04,-11560.05C2083.05,-11559.41 2086.04,-11558.8 2089,-11558.23 2377.78,-11502.62 2721.4,-11478.91 2913.32,-11469.39"/>
<polygon fill="black" stroke="black" points="2913.66,-11472.88 2923.47,-11468.9 2913.32,-11465.89 2913.66,-11472.88"/>
</g>
<!-- layer_3_expert_5&#45;&gt;layer_3_all2all_result -->
<g id="edge139" class="edge">
<title>layer_3_expert_5&#45;&gt;layer_3_all2all_result</title>
<path fill="none" stroke="black" d="M2358.07,-11560.2C2361.07,-11559.52 2364.05,-11558.86 2367,-11558.23 2554.71,-11518.33 2774.69,-11491.67 2916.08,-11477.07"/>
<polygon fill="black" stroke="black" points="2916.53,-11480.54 2926.12,-11476.04 2915.81,-11473.58 2916.53,-11480.54"/>
</g>
<!-- layer_3_expert_6&#45;&gt;layer_3_all2all_result -->
<g id="edge140" class="edge">
<title>layer_3_expert_6&#45;&gt;layer_3_all2all_result</title>
<path fill="none" stroke="black" d="M2636.15,-11560.55C2639.13,-11559.76 2642.08,-11558.99 2645,-11558.23 2739.1,-11533.87 2846.02,-11509.66 2928.03,-11491.81"/>
<polygon fill="black" stroke="black" points="2928.88,-11495.21 2937.91,-11489.67 2927.39,-11488.37 2928.88,-11495.21"/>
</g>
<!-- layer_3_expert_7&#45;&gt;layer_3_all2all_result -->
<g id="edge141" class="edge">
<title>layer_3_expert_7&#45;&gt;layer_3_all2all_result</title>
<path fill="none" stroke="black" d="M2867.41,-11558.17C2897.4,-11543.59 2931.51,-11527 2962.72,-11511.82"/>
<polygon fill="black" stroke="black" points="2964.41,-11514.9 2971.87,-11507.37 2961.34,-11508.6 2964.41,-11514.9"/>
</g>
<!-- layer_3_expert_8&#45;&gt;layer_3_all2all_result -->
<g id="edge142" class="edge">
<title>layer_3_expert_8&#45;&gt;layer_3_all2all_result</title>
<path fill="none" stroke="black" d="M3062,-11558.17C3062,-11549.81 3062,-11540.78 3062,-11531.75"/>
<polygon fill="black" stroke="black" points="3065.5,-11531.57 3062,-11521.57 3058.5,-11531.57 3065.5,-11531.57"/>
</g>
<!-- layer_3_expert_9&#45;&gt;layer_3_all2all_result -->
<g id="edge143" class="edge">
<title>layer_3_expert_9&#45;&gt;layer_3_all2all_result</title>
<path fill="none" stroke="black" d="M3256.59,-11558.17C3226.6,-11543.59 3192.49,-11527 3161.28,-11511.82"/>
<polygon fill="black" stroke="black" points="3162.66,-11508.6 3152.13,-11507.37 3159.59,-11514.9 3162.66,-11508.6"/>
</g>
<!-- layer_3_expert_10&#45;&gt;layer_3_all2all_result -->
<g id="edge144" class="edge">
<title>layer_3_expert_10&#45;&gt;layer_3_all2all_result</title>
<path fill="none" stroke="black" d="M3487.85,-11560.55C3484.87,-11559.76 3481.92,-11558.99 3479,-11558.23 3384.9,-11533.87 3277.98,-11509.66 3195.97,-11491.81"/>
<polygon fill="black" stroke="black" points="3196.61,-11488.37 3186.09,-11489.67 3195.12,-11495.21 3196.61,-11488.37"/>
</g>
<!-- layer_3_expert_11&#45;&gt;layer_3_all2all_result -->
<g id="edge145" class="edge">
<title>layer_3_expert_11&#45;&gt;layer_3_all2all_result</title>
<path fill="none" stroke="black" d="M3765.93,-11560.2C3762.93,-11559.52 3759.95,-11558.86 3757,-11558.23 3569.29,-11518.33 3349.31,-11491.67 3207.92,-11477.07"/>
<polygon fill="black" stroke="black" points="3208.19,-11473.58 3197.88,-11476.04 3207.47,-11480.54 3208.19,-11473.58"/>
</g>
<!-- layer_3_expert_12&#45;&gt;layer_3_all2all_result -->
<g id="edge146" class="edge">
<title>layer_3_expert_12&#45;&gt;layer_3_all2all_result</title>
<path fill="none" stroke="black" d="M4043.96,-11560.05C4040.95,-11559.41 4037.96,-11558.8 4035,-11558.23 3746.22,-11502.62 3402.6,-11478.91 3210.68,-11469.39"/>
<polygon fill="black" stroke="black" points="3210.68,-11465.89 3200.53,-11468.9 3210.34,-11472.88 3210.68,-11465.89"/>
</g>
<!-- layer_3_expert_13&#45;&gt;layer_3_all2all_result -->
<g id="edge147" class="edge">
<title>layer_3_expert_13&#45;&gt;layer_3_all2all_result</title>
<path fill="none" stroke="black" d="M4321.98,-11559.96C4318.96,-11559.35 4315.97,-11558.77 4313,-11558.23 3919.77,-11486.87 3447.55,-11469.16 3211.59,-11464.85"/>
<polygon fill="black" stroke="black" points="3211.63,-11461.35 3201.57,-11464.68 3211.51,-11468.35 3211.63,-11461.35"/>
</g>
<!-- layer_3_expert_14&#45;&gt;layer_3_all2all_result -->
<g id="edge148" class="edge">
<title>layer_3_expert_14&#45;&gt;layer_3_all2all_result</title>
<path fill="none" stroke="black" d="M4599.99,-11559.9C4596.97,-11559.31 4593.97,-11558.75 4591,-11558.23 4328.76,-11512.49 3541.76,-11480.39 3211,-11468.56"/>
<polygon fill="black" stroke="black" points="3210.99,-11465.06 3200.87,-11468.2 3210.74,-11472.06 3210.99,-11465.06"/>
</g>
<!-- layer_3_expert_15&#45;&gt;layer_3_all2all_result -->
<g id="edge149" class="edge">
<title>layer_3_expert_15&#45;&gt;layer_3_all2all_result</title>
<path fill="none" stroke="black" d="M4877.99,-11559.87C4874.97,-11559.28 4871.97,-11558.74 4869,-11558.23 4551.62,-11504.43 3584.29,-11476.08 3211.08,-11466.92"/>
<polygon fill="black" stroke="black" points="3211.1,-11463.42 3201.02,-11466.67 3210.93,-11470.42 3211.1,-11463.42"/>
</g>
<!-- layer_3_expert_agg -->
<g id="node88" class="node">
<title>layer_3_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="4656,-11366.85 4408,-11366.85 4408,-11283.85 4656,-11283.85 4656,-11366.85"/>
<text text-anchor="middle" x="4532" y="-11351.65" font-family="Times,serif" font-size="14.00">Layer 3</text>
<text text-anchor="middle" x="4532" y="-11336.65" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4532" y="-11321.65" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4532" y="-11306.65" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="4532" y="-11291.65" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_3_all2all_result&#45;&gt;layer_3_expert_agg -->
<g id="edge150" class="edge">
<title>layer_3_all2all_result&#45;&gt;layer_3_expert_agg</title>
<path fill="none" stroke="black" d="M3197.66,-11449.07C3478.06,-11423.28 4118.53,-11364.38 4397.73,-11338.7"/>
<polygon fill="black" stroke="black" points="4398.28,-11342.17 4407.92,-11337.77 4397.64,-11335.2 4398.28,-11342.17"/>
</g>
<!-- layer_3_expert_agg&#45;&gt;layer_3_residual -->
<g id="edge152" class="edge">
<title>layer_3_expert_agg&#45;&gt;layer_3_residual</title>
<path fill="none" stroke="black" d="M4656.21,-11298.46C4734.7,-11282.09 4837.29,-11260.71 4923.85,-11242.66"/>
<polygon fill="black" stroke="black" points="4924.7,-11246.06 4933.78,-11240.59 4923.28,-11239.2 4924.7,-11246.06"/>
</g>
<!-- layer_4_mha -->
<g id="node90" class="node">
<title>layer_4_mha</title>
<polygon fill="lightblue" stroke="black" points="5199.5,-11126.85 4996.5,-11126.85 4996.5,-11043.85 5199.5,-11043.85 5199.5,-11126.85"/>
<text text-anchor="middle" x="5098" y="-11111.65" font-family="Times,serif" font-size="14.00">Layer 4</text>
<text text-anchor="middle" x="5098" y="-11096.65" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="5098" y="-11081.65" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5098" y="-11066.65" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="5098" y="-11051.65" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_3_residual&#45;&gt;layer_4_mha -->
<g id="edge153" class="edge">
<title>layer_3_residual&#45;&gt;layer_4_mha</title>
<path fill="none" stroke="black" d="M5098,-11163.74C5098,-11155.22 5098,-11146.12 5098,-11137.27"/>
<polygon fill="black" stroke="black" points="5101.5,-11137.04 5098,-11127.04 5094.5,-11137.04 5101.5,-11137.04"/>
</g>
<!-- layer_4_gate -->
<g id="node91" class="node">
<title>layer_4_gate</title>
<polygon fill="lightblue" stroke="black" points="4885.5,-11006.85 4686.5,-11006.85 4686.5,-10923.85 4885.5,-10923.85 4885.5,-11006.85"/>
<text text-anchor="middle" x="4786" y="-10991.65" font-family="Times,serif" font-size="14.00">Layer 4</text>
<text text-anchor="middle" x="4786" y="-10976.65" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="4786" y="-10961.65" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="4786" y="-10946.65" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="4786" y="-10931.65" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_4_mha&#45;&gt;layer_4_gate -->
<g id="edge154" class="edge">
<title>layer_4_mha&#45;&gt;layer_4_gate</title>
<path fill="none" stroke="black" d="M4996.27,-11045.88C4963.98,-11033.67 4928.15,-11020.12 4895.35,-11007.71"/>
<polygon fill="black" stroke="black" points="4896.32,-11004.34 4885.73,-11004.07 4893.84,-11010.88 4896.32,-11004.34"/>
</g>
<!-- layer_4_residual -->
<g id="node111" class="node">
<title>layer_4_residual</title>
<polygon fill="lightblue" stroke="black" points="5498,-10324.09 5170,-10324.09 5170,-10241.09 5498,-10241.09 5498,-10324.09"/>
<text text-anchor="middle" x="5334" y="-10308.89" font-family="Times,serif" font-size="14.00">Layer 4</text>
<text text-anchor="middle" x="5334" y="-10293.89" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5334" y="-10278.89" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="5334" y="-10263.89" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="5334" y="-10248.89" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_4_mha&#45;&gt;layer_4_residual -->
<g id="edge189" class="edge">
<title>layer_4_mha&#45;&gt;layer_4_residual</title>
<path fill="none" stroke="black" d="M5199.73,-11065.92C5290.78,-11046.44 5410,-11012.18 5410,-10966.35 5410,-10966.35 5410,-10966.35 5410,-10401.59 5410,-10376.22 5397.42,-10351.96 5382.5,-10332.11"/>
<polygon fill="black" stroke="black" points="5385.17,-10329.84 5376.22,-10324.16 5379.67,-10334.18 5385.17,-10329.84"/>
<text text-anchor="middle" x="5438" y="-10673.27" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_4_all2all -->
<g id="node92" class="node">
<title>layer_4_all2all</title>
<ellipse fill="yellow" stroke="black" cx="3298" cy="-10828.16" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="3298" y="-10854.46" font-family="Times,serif" font-size="14.00">Layer 4</text>
<text text-anchor="middle" x="3298" y="-10839.46" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="3298" y="-10824.46" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="3298" y="-10809.46" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="3298" y="-10794.46" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_4_gate&#45;&gt;layer_4_all2all -->
<g id="edge155" class="edge">
<title>layer_4_gate&#45;&gt;layer_4_all2all</title>
<path fill="none" stroke="black" d="M4686.35,-10955.3C4429.76,-10931.99 3745.46,-10869.82 3444.03,-10842.43"/>
<polygon fill="black" stroke="black" points="3444.18,-10838.93 3433.91,-10841.51 3443.55,-10845.9 3444.18,-10838.93"/>
</g>
<!-- layer_4_expert_0 -->
<g id="node93" class="node">
<title>layer_4_expert_0</title>
<polygon fill="lightblue" stroke="black" points="1204,-10718.47 944,-10718.47 944,-10635.47 1204,-10635.47 1204,-10718.47"/>
<text text-anchor="middle" x="1074" y="-10703.27" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1074" y="-10688.27" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1074" y="-10673.27" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1074" y="-10658.27" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1074" y="-10643.27" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_4_all2all&#45;&gt;layer_4_expert_0 -->
<g id="edge156" class="edge">
<title>layer_4_all2all&#45;&gt;layer_4_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3158.71,-10824.37C2778.55,-10816.3 1728.72,-10791.02 1385,-10751.47 1310.84,-10742.94 1290.33,-10737.2 1214.2,-10718.73"/>
<polygon fill="black" stroke="black" points="1214.66,-10715.24 1204.12,-10716.29 1213.02,-10722.04 1214.66,-10715.24"/>
<text text-anchor="middle" x="1476.5" y="-10740.27" font-family="Times,serif" font-size="14.00">tokens routed to expert 0</text>
</g>
<!-- layer_4_expert_1 -->
<g id="node94" class="node">
<title>layer_4_expert_1</title>
<polygon fill="lightblue" stroke="black" points="1482,-10718.47 1222,-10718.47 1222,-10635.47 1482,-10635.47 1482,-10718.47"/>
<text text-anchor="middle" x="1352" y="-10703.27" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1352" y="-10688.27" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1352" y="-10673.27" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1352" y="-10658.27" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1352" y="-10643.27" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_4_all2all&#45;&gt;layer_4_expert_1 -->
<g id="edge157" class="edge">
<title>layer_4_all2all&#45;&gt;layer_4_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3158.56,-10827.77C2874.78,-10827.46 2210.12,-10818.82 1657,-10751.47 1602.4,-10744.83 1543.41,-10731.98 1491.99,-10718.87"/>
<polygon fill="black" stroke="black" points="1492.71,-10715.44 1482.15,-10716.33 1490.96,-10722.22 1492.71,-10715.44"/>
<text text-anchor="middle" x="1748.5" y="-10740.27" font-family="Times,serif" font-size="14.00">tokens routed to expert 1</text>
</g>
<!-- layer_4_expert_2 -->
<g id="node95" class="node">
<title>layer_4_expert_2</title>
<polygon fill="lightblue" stroke="black" points="1760,-10718.47 1500,-10718.47 1500,-10635.47 1760,-10635.47 1760,-10718.47"/>
<text text-anchor="middle" x="1630" y="-10703.27" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1630" y="-10688.27" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1630" y="-10673.27" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1630" y="-10658.27" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1630" y="-10643.27" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_4_all2all&#45;&gt;layer_4_expert_2 -->
<g id="edge158" class="edge">
<title>layer_4_all2all&#45;&gt;layer_4_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3158.7,-10826.39C2910.22,-10823.48 2374.6,-10810.23 1927,-10751.47 1875.03,-10744.65 1819,-10732.17 1769.76,-10719.4"/>
<polygon fill="black" stroke="black" points="1770.57,-10716 1760.01,-10716.85 1768.8,-10722.77 1770.57,-10716"/>
<text text-anchor="middle" x="2018.5" y="-10740.27" font-family="Times,serif" font-size="14.00">tokens routed to expert 2</text>
</g>
<!-- layer_4_expert_3 -->
<g id="node96" class="node">
<title>layer_4_expert_3</title>
<polygon fill="lightblue" stroke="black" points="2038,-10718.47 1778,-10718.47 1778,-10635.47 2038,-10635.47 2038,-10718.47"/>
<text text-anchor="middle" x="1908" y="-10703.27" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="1908" y="-10688.27" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1908" y="-10673.27" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1908" y="-10658.27" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1908" y="-10643.27" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_4_all2all&#45;&gt;layer_4_expert_3 -->
<g id="edge159" class="edge">
<title>layer_4_all2all&#45;&gt;layer_4_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3158.67,-10825.22C2946.95,-10820.57 2532.01,-10804.82 2184,-10751.47 2138.77,-10744.54 2090.29,-10733.06 2046.78,-10721.2"/>
<polygon fill="black" stroke="black" points="2047.57,-10717.79 2037,-10718.51 2045.71,-10724.54 2047.57,-10717.79"/>
<text text-anchor="middle" x="2275.5" y="-10740.27" font-family="Times,serif" font-size="14.00">tokens routed to expert 3</text>
</g>
<!-- layer_4_expert_4 -->
<g id="node97" class="node">
<title>layer_4_expert_4</title>
<polygon fill="lightblue" stroke="black" points="2316,-10718.47 2056,-10718.47 2056,-10635.47 2316,-10635.47 2316,-10718.47"/>
<text text-anchor="middle" x="2186" y="-10703.27" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="2186" y="-10688.27" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2186" y="-10673.27" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2186" y="-10658.27" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2186" y="-10643.27" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_4_all2all&#45;&gt;layer_4_expert_4 -->
<g id="edge160" class="edge">
<title>layer_4_all2all&#45;&gt;layer_4_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3158.78,-10823.55C2987.04,-10817.13 2686.77,-10799.5 2434,-10751.47 2394.65,-10744 2352.62,-10732.81 2314.55,-10721.4"/>
<polygon fill="black" stroke="black" points="2315.54,-10718.05 2304.96,-10718.5 2313.51,-10724.75 2315.54,-10718.05"/>
<text text-anchor="middle" x="2525.5" y="-10740.27" font-family="Times,serif" font-size="14.00">tokens routed to expert 4</text>
</g>
<!-- layer_4_expert_5 -->
<g id="node98" class="node">
<title>layer_4_expert_5</title>
<polygon fill="lightblue" stroke="black" points="2594,-10718.47 2334,-10718.47 2334,-10635.47 2594,-10635.47 2594,-10718.47"/>
<text text-anchor="middle" x="2464" y="-10703.27" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="2464" y="-10688.27" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2464" y="-10673.27" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2464" y="-10658.27" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2464" y="-10643.27" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_4_all2all&#45;&gt;layer_4_expert_5 -->
<g id="edge161" class="edge">
<title>layer_4_all2all&#45;&gt;layer_4_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3160.18,-10819.02C3032.75,-10809.48 2838.74,-10789.82 2674,-10751.47 2641.44,-10743.9 2606.89,-10733.04 2575.43,-10721.99"/>
<polygon fill="black" stroke="black" points="2576.36,-10718.61 2565.76,-10718.56 2574.02,-10725.2 2576.36,-10718.61"/>
<text text-anchor="middle" x="2765.5" y="-10740.27" font-family="Times,serif" font-size="14.00">tokens routed to expert 5</text>
</g>
<!-- layer_4_expert_6 -->
<g id="node99" class="node">
<title>layer_4_expert_6</title>
<polygon fill="lightblue" stroke="black" points="2872,-10718.47 2612,-10718.47 2612,-10635.47 2872,-10635.47 2872,-10718.47"/>
<text text-anchor="middle" x="2742" y="-10703.27" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="2742" y="-10688.27" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2742" y="-10673.27" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2742" y="-10658.27" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2742" y="-10643.27" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_4_all2all&#45;&gt;layer_4_expert_6 -->
<g id="edge162" class="edge">
<title>layer_4_all2all&#45;&gt;layer_4_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3165.36,-10810.01C3087.49,-10797.93 2987.83,-10778.94 2902,-10751.47 2877.84,-10743.74 2852.53,-10733.3 2829.36,-10722.72"/>
<polygon fill="black" stroke="black" points="2830.79,-10719.52 2820.25,-10718.5 2827.85,-10725.88 2830.79,-10719.52"/>
<text text-anchor="middle" x="2993.5" y="-10740.27" font-family="Times,serif" font-size="14.00">tokens routed to expert 6</text>
</g>
<!-- layer_4_expert_7 -->
<g id="node100" class="node">
<title>layer_4_expert_7</title>
<polygon fill="lightblue" stroke="black" points="3150,-10718.47 2890,-10718.47 2890,-10635.47 3150,-10635.47 3150,-10718.47"/>
<text text-anchor="middle" x="3020" y="-10703.27" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="3020" y="-10688.27" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3020" y="-10673.27" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3020" y="-10658.27" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3020" y="-10643.27" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_4_all2all&#45;&gt;layer_4_expert_7 -->
<g id="edge163" class="edge">
<title>layer_4_all2all&#45;&gt;layer_4_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3191.06,-10790.19C3164.17,-10779.2 3135.9,-10766.13 3111,-10751.47 3097.94,-10743.78 3084.75,-10734.33 3072.63,-10724.79"/>
<polygon fill="black" stroke="black" points="3074.82,-10722.06 3064.83,-10718.53 3070.44,-10727.52 3074.82,-10722.06"/>
<text text-anchor="middle" x="3202.5" y="-10740.27" font-family="Times,serif" font-size="14.00">tokens routed to expert 7</text>
</g>
<!-- layer_4_expert_8 -->
<g id="node101" class="node">
<title>layer_4_expert_8</title>
<polygon fill="lightblue" stroke="black" points="3428,-10718.47 3168,-10718.47 3168,-10635.47 3428,-10635.47 3428,-10718.47"/>
<text text-anchor="middle" x="3298" y="-10703.27" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="3298" y="-10688.27" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3298" y="-10673.27" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3298" y="-10658.27" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3298" y="-10643.27" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_4_all2all&#45;&gt;layer_4_expert_8 -->
<g id="edge164" class="edge">
<title>layer_4_all2all&#45;&gt;layer_4_expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3298,-10769.06C3298,-10755.76 3298,-10741.72 3298,-10728.76"/>
<polygon fill="black" stroke="black" points="3301.5,-10728.63 3298,-10718.63 3294.5,-10728.63 3301.5,-10728.63"/>
<text text-anchor="middle" x="3389.5" y="-10740.27" font-family="Times,serif" font-size="14.00">tokens routed to expert 8</text>
</g>
<!-- layer_4_expert_9 -->
<g id="node102" class="node">
<title>layer_4_expert_9</title>
<polygon fill="lightblue" stroke="black" points="3706,-10718.47 3446,-10718.47 3446,-10635.47 3706,-10635.47 3706,-10718.47"/>
<text text-anchor="middle" x="3576" y="-10703.27" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="3576" y="-10688.27" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3576" y="-10673.27" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3576" y="-10658.27" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3576" y="-10643.27" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_4_all2all&#45;&gt;layer_4_expert_9 -->
<g id="edge165" class="edge">
<title>layer_4_all2all&#45;&gt;layer_4_expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3404.94,-10790.19C3431.83,-10779.2 3460.1,-10766.13 3485,-10751.47 3498.06,-10743.78 3511.25,-10734.33 3523.37,-10724.79"/>
<polygon fill="black" stroke="black" points="3525.56,-10727.52 3531.17,-10718.53 3521.18,-10722.06 3525.56,-10727.52"/>
<text text-anchor="middle" x="3597.5" y="-10740.27" font-family="Times,serif" font-size="14.00">tokens routed to expert 9</text>
</g>
<!-- layer_4_expert_10 -->
<g id="node103" class="node">
<title>layer_4_expert_10</title>
<polygon fill="lightblue" stroke="black" points="3984,-10718.47 3724,-10718.47 3724,-10635.47 3984,-10635.47 3984,-10718.47"/>
<text text-anchor="middle" x="3854" y="-10703.27" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="3854" y="-10688.27" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3854" y="-10673.27" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3854" y="-10658.27" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3854" y="-10643.27" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_4_all2all&#45;&gt;layer_4_expert_10 -->
<g id="edge166" class="edge">
<title>layer_4_all2all&#45;&gt;layer_4_expert_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3430.73,-10809.83C3508.33,-10797.71 3607.52,-10778.74 3693,-10751.47 3717.29,-10743.72 3742.75,-10733.28 3766.07,-10722.69"/>
<polygon fill="black" stroke="black" points="3767.61,-10725.84 3775.24,-10718.48 3764.69,-10719.48 3767.61,-10725.84"/>
<text text-anchor="middle" x="3829" y="-10740.27" font-family="Times,serif" font-size="14.00">tokens routed to expert 10</text>
</g>
<!-- layer_4_expert_11 -->
<g id="node104" class="node">
<title>layer_4_expert_11</title>
<polygon fill="lightblue" stroke="black" points="4262,-10718.47 4002,-10718.47 4002,-10635.47 4262,-10635.47 4262,-10718.47"/>
<text text-anchor="middle" x="4132" y="-10703.27" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="4132" y="-10688.27" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4132" y="-10673.27" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4132" y="-10658.27" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4132" y="-10643.27" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_4_all2all&#45;&gt;layer_4_expert_11 -->
<g id="edge167" class="edge">
<title>layer_4_all2all&#45;&gt;layer_4_expert_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3435.9,-10819.69C3564.81,-10810.59 3761.95,-10791.18 3929,-10751.47 3960.51,-10743.98 3993.87,-10733.18 4024.25,-10722.15"/>
<polygon fill="black" stroke="black" points="4025.82,-10725.3 4034,-10718.56 4023.4,-10718.73 4025.82,-10725.3"/>
<text text-anchor="middle" x="4076" y="-10740.27" font-family="Times,serif" font-size="14.00">tokens routed to expert 11</text>
</g>
<!-- layer_4_expert_12 -->
<g id="node105" class="node">
<title>layer_4_expert_12</title>
<polygon fill="lightblue" stroke="black" points="4540,-10718.47 4280,-10718.47 4280,-10635.47 4540,-10635.47 4540,-10718.47"/>
<text text-anchor="middle" x="4410" y="-10703.27" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="4410" y="-10688.27" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4410" y="-10673.27" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4410" y="-10658.27" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4410" y="-10643.27" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_4_all2all&#45;&gt;layer_4_expert_12 -->
<g id="edge168" class="edge">
<title>layer_4_all2all&#45;&gt;layer_4_expert_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3437.31,-10824.51C3611.58,-10819.06 3918.41,-10802.4 4176,-10751.47 4213.2,-10744.12 4252.83,-10732.99 4288.7,-10721.6"/>
<polygon fill="black" stroke="black" points="4289.77,-10724.93 4298.22,-10718.54 4287.63,-10718.27 4289.77,-10724.93"/>
<text text-anchor="middle" x="4330" y="-10740.27" font-family="Times,serif" font-size="14.00">tokens routed to expert 12</text>
</g>
<!-- layer_4_expert_13 -->
<g id="node106" class="node">
<title>layer_4_expert_13</title>
<polygon fill="lightblue" stroke="black" points="4818,-10718.47 4558,-10718.47 4558,-10635.47 4818,-10635.47 4818,-10718.47"/>
<text text-anchor="middle" x="4688" y="-10703.27" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="4688" y="-10688.27" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4688" y="-10673.27" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4688" y="-10658.27" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4688" y="-10643.27" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_4_all2all&#45;&gt;layer_4_expert_13 -->
<g id="edge169" class="edge">
<title>layer_4_all2all&#45;&gt;layer_4_expert_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3437.61,-10826.94C3652.38,-10824.55 4076.12,-10811.72 4430,-10751.47 4471.67,-10744.38 4516.23,-10733.08 4556.38,-10721.44"/>
<polygon fill="black" stroke="black" points="4557.61,-10724.73 4566.22,-10718.56 4555.64,-10718.01 4557.61,-10724.73"/>
<text text-anchor="middle" x="4590" y="-10740.27" font-family="Times,serif" font-size="14.00">tokens routed to expert 13</text>
</g>
<!-- layer_4_expert_14 -->
<g id="node107" class="node">
<title>layer_4_expert_14</title>
<polygon fill="lightblue" stroke="black" points="5096,-10718.47 4836,-10718.47 4836,-10635.47 5096,-10635.47 5096,-10718.47"/>
<text text-anchor="middle" x="4966" y="-10703.27" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="4966" y="-10688.27" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4966" y="-10673.27" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4966" y="-10658.27" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4966" y="-10643.27" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_4_all2all&#45;&gt;layer_4_expert_14 -->
<g id="edge170" class="edge">
<title>layer_4_all2all&#45;&gt;layer_4_expert_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3437.63,-10827.94C3689.34,-10827.5 4235.3,-10818.03 4690,-10751.47 4735.73,-10744.78 4784.74,-10733.22 4828.59,-10721.22"/>
<polygon fill="black" stroke="black" points="4829.74,-10724.53 4838.45,-10718.49 4827.87,-10717.79 4829.74,-10724.53"/>
<text text-anchor="middle" x="4862" y="-10740.27" font-family="Times,serif" font-size="14.00">tokens routed to expert 14</text>
</g>
<!-- layer_4_expert_15 -->
<g id="node108" class="node">
<title>layer_4_expert_15</title>
<polygon fill="lightblue" stroke="black" points="5374,-10718.47 5114,-10718.47 5114,-10635.47 5374,-10635.47 5374,-10718.47"/>
<text text-anchor="middle" x="5244" y="-10703.27" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="5244" y="-10688.27" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5244" y="-10673.27" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5244" y="-10658.27" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5244" y="-10643.27" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_4_all2all&#45;&gt;layer_4_expert_15 -->
<g id="edge171" class="edge">
<title>layer_4_all2all&#45;&gt;layer_4_expert_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3437.05,-10824.09C3781.75,-10815.93 4668.95,-10791.61 4962,-10751.47 5009.17,-10745.01 5059.76,-10733.37 5104.89,-10721.23"/>
<polygon fill="black" stroke="black" points="5106,-10724.56 5114.73,-10718.55 5104.16,-10717.8 5106,-10724.56"/>
<text text-anchor="middle" x="5136" y="-10740.27" font-family="Times,serif" font-size="14.00">tokens routed to expert 15</text>
</g>
<!-- layer_4_all2all_result -->
<g id="node109" class="node">
<title>layer_4_all2all_result</title>
<ellipse fill="yellow" stroke="black" cx="3298" cy="-10539.78" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="3298" y="-10566.08" font-family="Times,serif" font-size="14.00">Layer 4</text>
<text text-anchor="middle" x="3298" y="-10551.08" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Result Merge</text>
<text text-anchor="middle" x="3298" y="-10536.08" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="3298" y="-10521.08" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="3298" y="-10506.08" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_4_expert_0&#45;&gt;layer_4_all2all_result -->
<g id="edge172" class="edge">
<title>layer_4_expert_0&#45;&gt;layer_4_all2all_result</title>
<path fill="none" stroke="black" d="M1204,-10637.08C1207.02,-10636.5 1210.02,-10635.97 1213,-10635.47 1585.89,-10573.59 2735.76,-10549.68 3148.55,-10542.95"/>
<polygon fill="black" stroke="black" points="3148.81,-10546.45 3158.76,-10542.79 3148.7,-10539.45 3148.81,-10546.45"/>
</g>
<!-- layer_4_expert_1&#45;&gt;layer_4_all2all_result -->
<g id="edge173" class="edge">
<title>layer_4_expert_1&#45;&gt;layer_4_all2all_result</title>
<path fill="none" stroke="black" d="M1482.01,-10637.11C1485.03,-10636.52 1488.03,-10635.98 1491,-10635.47 1808.38,-10581.67 2775.71,-10553.32 3148.92,-10544.16"/>
<polygon fill="black" stroke="black" points="3149.07,-10547.66 3158.98,-10543.91 3148.9,-10540.66 3149.07,-10547.66"/>
</g>
<!-- layer_4_expert_2&#45;&gt;layer_4_all2all_result -->
<g id="edge174" class="edge">
<title>layer_4_expert_2&#45;&gt;layer_4_all2all_result</title>
<path fill="none" stroke="black" d="M1760.01,-10637.14C1763.03,-10636.55 1766.03,-10635.99 1769,-10635.47 2031.24,-10589.73 2818.24,-10557.63 3149,-10545.8"/>
<polygon fill="black" stroke="black" points="3149.26,-10549.3 3159.13,-10545.44 3149.01,-10542.3 3149.26,-10549.3"/>
</g>
<!-- layer_4_expert_3&#45;&gt;layer_4_all2all_result -->
<g id="edge175" class="edge">
<title>layer_4_expert_3&#45;&gt;layer_4_all2all_result</title>
<path fill="none" stroke="black" d="M2038.02,-10637.2C2041.04,-10636.59 2044.03,-10636.01 2047,-10635.47 2440.23,-10564.11 2912.45,-10546.4 3148.41,-10542.09"/>
<polygon fill="black" stroke="black" points="3148.49,-10545.59 3158.43,-10541.92 3148.37,-10538.59 3148.49,-10545.59"/>
</g>
<!-- layer_4_expert_4&#45;&gt;layer_4_all2all_result -->
<g id="edge176" class="edge">
<title>layer_4_expert_4&#45;&gt;layer_4_all2all_result</title>
<path fill="none" stroke="black" d="M2316.04,-10637.29C2319.05,-10636.65 2322.04,-10636.04 2325,-10635.47 2613.78,-10579.86 2957.4,-10556.15 3149.32,-10546.63"/>
<polygon fill="black" stroke="black" points="3149.66,-10550.12 3159.47,-10546.14 3149.32,-10543.13 3149.66,-10550.12"/>
</g>
<!-- layer_4_expert_5&#45;&gt;layer_4_all2all_result -->
<g id="edge177" class="edge">
<title>layer_4_expert_5&#45;&gt;layer_4_all2all_result</title>
<path fill="none" stroke="black" d="M2594.07,-10637.44C2597.07,-10636.76 2600.05,-10636.1 2603,-10635.47 2790.71,-10595.57 3010.69,-10568.91 3152.08,-10554.31"/>
<polygon fill="black" stroke="black" points="3152.53,-10557.79 3162.12,-10553.28 3151.81,-10550.82 3152.53,-10557.79"/>
</g>
<!-- layer_4_expert_6&#45;&gt;layer_4_all2all_result -->
<g id="edge178" class="edge">
<title>layer_4_expert_6&#45;&gt;layer_4_all2all_result</title>
<path fill="none" stroke="black" d="M2872.15,-10637.79C2875.13,-10637 2878.08,-10636.23 2881,-10635.47 2975.1,-10611.11 3082.02,-10586.9 3164.03,-10569.06"/>
<polygon fill="black" stroke="black" points="3164.88,-10572.45 3173.91,-10566.91 3163.39,-10565.61 3164.88,-10572.45"/>
</g>
<!-- layer_4_expert_7&#45;&gt;layer_4_all2all_result -->
<g id="edge179" class="edge">
<title>layer_4_expert_7&#45;&gt;layer_4_all2all_result</title>
<path fill="none" stroke="black" d="M3103.41,-10635.41C3133.4,-10620.83 3167.51,-10604.24 3198.72,-10589.06"/>
<polygon fill="black" stroke="black" points="3200.41,-10592.14 3207.87,-10584.61 3197.34,-10585.84 3200.41,-10592.14"/>
</g>
<!-- layer_4_expert_8&#45;&gt;layer_4_all2all_result -->
<g id="edge180" class="edge">
<title>layer_4_expert_8&#45;&gt;layer_4_all2all_result</title>
<path fill="none" stroke="black" d="M3298,-10635.41C3298,-10627.05 3298,-10618.02 3298,-10608.99"/>
<polygon fill="black" stroke="black" points="3301.5,-10608.81 3298,-10598.81 3294.5,-10608.81 3301.5,-10608.81"/>
</g>
<!-- layer_4_expert_9&#45;&gt;layer_4_all2all_result -->
<g id="edge181" class="edge">
<title>layer_4_expert_9&#45;&gt;layer_4_all2all_result</title>
<path fill="none" stroke="black" d="M3492.59,-10635.41C3462.6,-10620.83 3428.49,-10604.24 3397.28,-10589.06"/>
<polygon fill="black" stroke="black" points="3398.66,-10585.84 3388.13,-10584.61 3395.59,-10592.14 3398.66,-10585.84"/>
</g>
<!-- layer_4_expert_10&#45;&gt;layer_4_all2all_result -->
<g id="edge182" class="edge">
<title>layer_4_expert_10&#45;&gt;layer_4_all2all_result</title>
<path fill="none" stroke="black" d="M3723.85,-10637.79C3720.87,-10637 3717.92,-10636.23 3715,-10635.47 3620.9,-10611.11 3513.98,-10586.9 3431.97,-10569.06"/>
<polygon fill="black" stroke="black" points="3432.61,-10565.61 3422.09,-10566.91 3431.12,-10572.45 3432.61,-10565.61"/>
</g>
<!-- layer_4_expert_11&#45;&gt;layer_4_all2all_result -->
<g id="edge183" class="edge">
<title>layer_4_expert_11&#45;&gt;layer_4_all2all_result</title>
<path fill="none" stroke="black" d="M4001.93,-10637.44C3998.93,-10636.76 3995.95,-10636.1 3993,-10635.47 3805.29,-10595.57 3585.31,-10568.91 3443.92,-10554.31"/>
<polygon fill="black" stroke="black" points="3444.19,-10550.82 3433.88,-10553.28 3443.47,-10557.79 3444.19,-10550.82"/>
</g>
<!-- layer_4_expert_12&#45;&gt;layer_4_all2all_result -->
<g id="edge184" class="edge">
<title>layer_4_expert_12&#45;&gt;layer_4_all2all_result</title>
<path fill="none" stroke="black" d="M4279.96,-10637.29C4276.95,-10636.65 4273.96,-10636.04 4271,-10635.47 3982.22,-10579.86 3638.6,-10556.15 3446.68,-10546.63"/>
<polygon fill="black" stroke="black" points="3446.68,-10543.13 3436.53,-10546.14 3446.34,-10550.12 3446.68,-10543.13"/>
</g>
<!-- layer_4_expert_13&#45;&gt;layer_4_all2all_result -->
<g id="edge185" class="edge">
<title>layer_4_expert_13&#45;&gt;layer_4_all2all_result</title>
<path fill="none" stroke="black" d="M4557.98,-10637.2C4554.96,-10636.59 4551.97,-10636.01 4549,-10635.47 4155.77,-10564.11 3683.55,-10546.4 3447.59,-10542.09"/>
<polygon fill="black" stroke="black" points="3447.63,-10538.59 3437.57,-10541.92 3447.51,-10545.59 3447.63,-10538.59"/>
</g>
<!-- layer_4_expert_14&#45;&gt;layer_4_all2all_result -->
<g id="edge186" class="edge">
<title>layer_4_expert_14&#45;&gt;layer_4_all2all_result</title>
<path fill="none" stroke="black" d="M4835.99,-10637.14C4832.97,-10636.55 4829.97,-10635.99 4827,-10635.47 4564.76,-10589.73 3777.76,-10557.63 3447,-10545.8"/>
<polygon fill="black" stroke="black" points="3446.99,-10542.3 3436.87,-10545.44 3446.74,-10549.3 3446.99,-10542.3"/>
</g>
<!-- layer_4_expert_15&#45;&gt;layer_4_all2all_result -->
<g id="edge187" class="edge">
<title>layer_4_expert_15&#45;&gt;layer_4_all2all_result</title>
<path fill="none" stroke="black" d="M5113.99,-10637.11C5110.97,-10636.52 5107.97,-10635.98 5105,-10635.47 4787.62,-10581.67 3820.29,-10553.32 3447.08,-10544.16"/>
<polygon fill="black" stroke="black" points="3447.1,-10540.66 3437.02,-10543.91 3446.93,-10547.66 3447.1,-10540.66"/>
</g>
<!-- layer_4_expert_agg -->
<g id="node110" class="node">
<title>layer_4_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="4892,-10444.09 4644,-10444.09 4644,-10361.09 4892,-10361.09 4892,-10444.09"/>
<text text-anchor="middle" x="4768" y="-10428.89" font-family="Times,serif" font-size="14.00">Layer 4</text>
<text text-anchor="middle" x="4768" y="-10413.89" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4768" y="-10398.89" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4768" y="-10383.89" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="4768" y="-10368.89" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_4_all2all_result&#45;&gt;layer_4_expert_agg -->
<g id="edge188" class="edge">
<title>layer_4_all2all_result&#45;&gt;layer_4_expert_agg</title>
<path fill="none" stroke="black" d="M3433.66,-10526.31C3714.06,-10500.52 4354.53,-10441.62 4633.73,-10415.94"/>
<polygon fill="black" stroke="black" points="4634.28,-10419.41 4643.92,-10415.01 4633.64,-10412.44 4634.28,-10419.41"/>
</g>
<!-- layer_4_expert_agg&#45;&gt;layer_4_residual -->
<g id="edge190" class="edge">
<title>layer_4_expert_agg&#45;&gt;layer_4_residual</title>
<path fill="none" stroke="black" d="M4892.21,-10375.7C4970.7,-10359.33 5073.29,-10337.95 5159.85,-10319.9"/>
<polygon fill="black" stroke="black" points="5160.7,-10323.3 5169.78,-10317.83 5159.28,-10316.45 5160.7,-10323.3"/>
</g>
<!-- layer_5_mha -->
<g id="node112" class="node">
<title>layer_5_mha</title>
<polygon fill="lightblue" stroke="black" points="5435.5,-10204.09 5232.5,-10204.09 5232.5,-10121.09 5435.5,-10121.09 5435.5,-10204.09"/>
<text text-anchor="middle" x="5334" y="-10188.89" font-family="Times,serif" font-size="14.00">Layer 5</text>
<text text-anchor="middle" x="5334" y="-10173.89" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="5334" y="-10158.89" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5334" y="-10143.89" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="5334" y="-10128.89" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_4_residual&#45;&gt;layer_5_mha -->
<g id="edge191" class="edge">
<title>layer_4_residual&#45;&gt;layer_5_mha</title>
<path fill="none" stroke="black" d="M5334,-10240.99C5334,-10232.46 5334,-10223.36 5334,-10214.51"/>
<polygon fill="black" stroke="black" points="5337.5,-10214.28 5334,-10204.28 5330.5,-10214.28 5337.5,-10214.28"/>
</g>
<!-- layer_5_gate -->
<g id="node113" class="node">
<title>layer_5_gate</title>
<polygon fill="lightblue" stroke="black" points="5121.5,-10084.09 4922.5,-10084.09 4922.5,-10001.09 5121.5,-10001.09 5121.5,-10084.09"/>
<text text-anchor="middle" x="5022" y="-10068.89" font-family="Times,serif" font-size="14.00">Layer 5</text>
<text text-anchor="middle" x="5022" y="-10053.89" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="5022" y="-10038.89" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5022" y="-10023.89" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="5022" y="-10008.89" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_5_mha&#45;&gt;layer_5_gate -->
<g id="edge192" class="edge">
<title>layer_5_mha&#45;&gt;layer_5_gate</title>
<path fill="none" stroke="black" d="M5232.27,-10123.12C5199.98,-10110.91 5164.15,-10097.36 5131.35,-10084.95"/>
<polygon fill="black" stroke="black" points="5132.32,-10081.58 5121.73,-10081.31 5129.84,-10088.12 5132.32,-10081.58"/>
</g>
<!-- layer_5_residual -->
<g id="node133" class="node">
<title>layer_5_residual</title>
<polygon fill="lightblue" stroke="black" points="5734,-9401.33 5406,-9401.33 5406,-9318.33 5734,-9318.33 5734,-9401.33"/>
<text text-anchor="middle" x="5570" y="-9386.13" font-family="Times,serif" font-size="14.00">Layer 5</text>
<text text-anchor="middle" x="5570" y="-9371.13" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5570" y="-9356.13" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="5570" y="-9341.13" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="5570" y="-9326.13" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_5_mha&#45;&gt;layer_5_residual -->
<g id="edge227" class="edge">
<title>layer_5_mha&#45;&gt;layer_5_residual</title>
<path fill="none" stroke="black" d="M5435.73,-10143.16C5526.78,-10123.68 5646,-10089.42 5646,-10043.59 5646,-10043.59 5646,-10043.59 5646,-9478.83 5646,-9453.46 5633.42,-9429.2 5618.5,-9409.35"/>
<polygon fill="black" stroke="black" points="5621.17,-9407.08 5612.22,-9401.4 5615.67,-9411.42 5621.17,-9407.08"/>
<text text-anchor="middle" x="5674" y="-9750.51" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_5_all2all -->
<g id="node114" class="node">
<title>layer_5_all2all</title>
<ellipse fill="yellow" stroke="black" cx="3534" cy="-9905.4" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="3534" y="-9931.7" font-family="Times,serif" font-size="14.00">Layer 5</text>
<text text-anchor="middle" x="3534" y="-9916.7" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="3534" y="-9901.7" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="3534" y="-9886.7" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="3534" y="-9871.7" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_5_gate&#45;&gt;layer_5_all2all -->
<g id="edge193" class="edge">
<title>layer_5_gate&#45;&gt;layer_5_all2all</title>
<path fill="none" stroke="black" d="M4922.35,-10032.54C4665.76,-10009.23 3981.46,-9947.06 3680.03,-9919.67"/>
<polygon fill="black" stroke="black" points="3680.18,-9916.17 3669.91,-9918.75 3679.55,-9923.14 3680.18,-9916.17"/>
</g>
<!-- layer_5_expert_0 -->
<g id="node115" class="node">
<title>layer_5_expert_0</title>
<polygon fill="lightblue" stroke="black" points="1440,-9795.71 1180,-9795.71 1180,-9712.71 1440,-9712.71 1440,-9795.71"/>
<text text-anchor="middle" x="1310" y="-9780.51" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1310" y="-9765.51" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1310" y="-9750.51" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1310" y="-9735.51" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1310" y="-9720.51" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_5_all2all&#45;&gt;layer_5_expert_0 -->
<g id="edge194" class="edge">
<title>layer_5_all2all&#45;&gt;layer_5_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3394.94,-9901.75C3014.13,-9894.04 1959.87,-9869.54 1615,-9828.71 1560.37,-9822.25 1501.38,-9809.44 1449.97,-9796.31"/>
<polygon fill="black" stroke="black" points="1450.68,-9792.88 1440.13,-9793.77 1448.93,-9799.66 1450.68,-9792.88"/>
<text text-anchor="middle" x="1706.5" y="-9817.51" font-family="Times,serif" font-size="14.00">tokens routed to expert 0</text>
</g>
<!-- layer_5_expert_1 -->
<g id="node116" class="node">
<title>layer_5_expert_1</title>
<polygon fill="lightblue" stroke="black" points="1718,-9795.71 1458,-9795.71 1458,-9712.71 1718,-9712.71 1718,-9795.71"/>
<text text-anchor="middle" x="1588" y="-9780.51" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1588" y="-9765.51" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1588" y="-9750.51" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1588" y="-9735.51" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1588" y="-9720.51" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_5_all2all&#45;&gt;layer_5_expert_1 -->
<g id="edge195" class="edge">
<title>layer_5_all2all&#45;&gt;layer_5_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3394.65,-9904.78C3111.45,-9904.04 2448.75,-9894.67 1897,-9828.71 1823.71,-9819.95 1803.44,-9814.31 1728.1,-9795.95"/>
<polygon fill="black" stroke="black" points="1728.67,-9792.48 1718.12,-9793.52 1727.01,-9799.29 1728.67,-9792.48"/>
<text text-anchor="middle" x="1988.5" y="-9817.51" font-family="Times,serif" font-size="14.00">tokens routed to expert 1</text>
</g>
<!-- layer_5_expert_2 -->
<g id="node117" class="node">
<title>layer_5_expert_2</title>
<polygon fill="lightblue" stroke="black" points="1996,-9795.71 1736,-9795.71 1736,-9712.71 1996,-9712.71 1996,-9795.71"/>
<text text-anchor="middle" x="1866" y="-9780.51" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="1866" y="-9765.51" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1866" y="-9750.51" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1866" y="-9735.51" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1866" y="-9720.51" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_5_all2all&#45;&gt;layer_5_expert_2 -->
<g id="edge196" class="edge">
<title>layer_5_all2all&#45;&gt;layer_5_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3394.37,-9903.24C3146.62,-9899.72 2614.26,-9885.56 2169,-9828.71 2115.03,-9821.82 2056.72,-9809.01 2005.81,-9795.99"/>
<polygon fill="black" stroke="black" points="2006.62,-9792.59 1996.06,-9793.47 2004.87,-9799.36 2006.62,-9792.59"/>
<text text-anchor="middle" x="2260.5" y="-9817.51" font-family="Times,serif" font-size="14.00">tokens routed to expert 2</text>
</g>
<!-- layer_5_expert_3 -->
<g id="node118" class="node">
<title>layer_5_expert_3</title>
<polygon fill="lightblue" stroke="black" points="2274,-9795.71 2014,-9795.71 2014,-9712.71 2274,-9712.71 2274,-9795.71"/>
<text text-anchor="middle" x="2144" y="-9780.51" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2144" y="-9765.51" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2144" y="-9750.51" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2144" y="-9735.51" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2144" y="-9720.51" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_5_all2all&#45;&gt;layer_5_expert_3 -->
<g id="edge197" class="edge">
<title>layer_5_all2all&#45;&gt;layer_5_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3394.94,-9901.07C3186.2,-9894.65 2779.88,-9876.67 2438,-9828.71 2387.18,-9821.59 2332.42,-9809.22 2284.08,-9796.64"/>
<polygon fill="black" stroke="black" points="2284.75,-9793.2 2274.19,-9794.04 2282.97,-9799.97 2284.75,-9793.2"/>
<text text-anchor="middle" x="2529.5" y="-9817.51" font-family="Times,serif" font-size="14.00">tokens routed to expert 3</text>
</g>
<!-- layer_5_expert_4 -->
<g id="node119" class="node">
<title>layer_5_expert_4</title>
<polygon fill="lightblue" stroke="black" points="2552,-9795.71 2292,-9795.71 2292,-9712.71 2552,-9712.71 2552,-9795.71"/>
<text text-anchor="middle" x="2422" y="-9780.51" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="2422" y="-9765.51" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2422" y="-9750.51" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2422" y="-9735.51" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2422" y="-9720.51" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_5_all2all&#45;&gt;layer_5_expert_4 -->
<g id="edge198" class="edge">
<title>layer_5_all2all&#45;&gt;layer_5_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3395.02,-9899.64C3225.53,-9892.08 2930.85,-9873.34 2682,-9828.71 2668.91,-9826.37 2616.36,-9811.67 2561.91,-9796.02"/>
<polygon fill="black" stroke="black" points="2562.66,-9792.6 2552.08,-9793.2 2560.73,-9799.33 2562.66,-9792.6"/>
<text text-anchor="middle" x="2773.5" y="-9817.51" font-family="Times,serif" font-size="14.00">tokens routed to expert 4</text>
</g>
<!-- layer_5_expert_5 -->
<g id="node120" class="node">
<title>layer_5_expert_5</title>
<polygon fill="lightblue" stroke="black" points="2830,-9795.71 2570,-9795.71 2570,-9712.71 2830,-9712.71 2830,-9795.71"/>
<text text-anchor="middle" x="2700" y="-9780.51" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="2700" y="-9765.51" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2700" y="-9750.51" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2700" y="-9735.51" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2700" y="-9720.51" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_5_all2all&#45;&gt;layer_5_expert_5 -->
<g id="edge199" class="edge">
<title>layer_5_all2all&#45;&gt;layer_5_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3396.18,-9896.26C3268.75,-9886.72 3074.74,-9867.06 2910,-9828.71 2904.9,-9827.53 2866.37,-9814.13 2823.68,-9799.1"/>
<polygon fill="black" stroke="black" points="2824.83,-9795.79 2814.23,-9795.77 2822.5,-9802.39 2824.83,-9795.79"/>
<text text-anchor="middle" x="3001.5" y="-9817.51" font-family="Times,serif" font-size="14.00">tokens routed to expert 5</text>
</g>
<!-- layer_5_expert_6 -->
<g id="node121" class="node">
<title>layer_5_expert_6</title>
<polygon fill="lightblue" stroke="black" points="3108,-9795.71 2848,-9795.71 2848,-9712.71 3108,-9712.71 3108,-9795.71"/>
<text text-anchor="middle" x="2978" y="-9780.51" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="2978" y="-9765.51" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2978" y="-9750.51" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2978" y="-9735.51" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2978" y="-9720.51" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_5_all2all&#45;&gt;layer_5_expert_6 -->
<g id="edge200" class="edge">
<title>layer_5_all2all&#45;&gt;layer_5_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3401.36,-9887.25C3323.49,-9875.17 3223.83,-9856.18 3138,-9828.71 3113.84,-9820.98 3088.53,-9810.54 3065.36,-9799.96"/>
<polygon fill="black" stroke="black" points="3066.79,-9796.76 3056.25,-9795.74 3063.85,-9803.12 3066.79,-9796.76"/>
<text text-anchor="middle" x="3229.5" y="-9817.51" font-family="Times,serif" font-size="14.00">tokens routed to expert 6</text>
</g>
<!-- layer_5_expert_7 -->
<g id="node122" class="node">
<title>layer_5_expert_7</title>
<polygon fill="lightblue" stroke="black" points="3386,-9795.71 3126,-9795.71 3126,-9712.71 3386,-9712.71 3386,-9795.71"/>
<text text-anchor="middle" x="3256" y="-9780.51" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="3256" y="-9765.51" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3256" y="-9750.51" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3256" y="-9735.51" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3256" y="-9720.51" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_5_all2all&#45;&gt;layer_5_expert_7 -->
<g id="edge201" class="edge">
<title>layer_5_all2all&#45;&gt;layer_5_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3427.06,-9867.43C3400.17,-9856.44 3371.9,-9843.37 3347,-9828.71 3333.94,-9821.02 3320.75,-9811.57 3308.63,-9802.03"/>
<polygon fill="black" stroke="black" points="3310.82,-9799.3 3300.83,-9795.77 3306.44,-9804.76 3310.82,-9799.3"/>
<text text-anchor="middle" x="3438.5" y="-9817.51" font-family="Times,serif" font-size="14.00">tokens routed to expert 7</text>
</g>
<!-- layer_5_expert_8 -->
<g id="node123" class="node">
<title>layer_5_expert_8</title>
<polygon fill="lightblue" stroke="black" points="3664,-9795.71 3404,-9795.71 3404,-9712.71 3664,-9712.71 3664,-9795.71"/>
<text text-anchor="middle" x="3534" y="-9780.51" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="3534" y="-9765.51" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3534" y="-9750.51" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3534" y="-9735.51" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3534" y="-9720.51" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_5_all2all&#45;&gt;layer_5_expert_8 -->
<g id="edge202" class="edge">
<title>layer_5_all2all&#45;&gt;layer_5_expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3534,-9846.3C3534,-9833 3534,-9818.96 3534,-9806"/>
<polygon fill="black" stroke="black" points="3537.5,-9805.87 3534,-9795.87 3530.5,-9805.87 3537.5,-9805.87"/>
<text text-anchor="middle" x="3625.5" y="-9817.51" font-family="Times,serif" font-size="14.00">tokens routed to expert 8</text>
</g>
<!-- layer_5_expert_9 -->
<g id="node124" class="node">
<title>layer_5_expert_9</title>
<polygon fill="lightblue" stroke="black" points="3942,-9795.71 3682,-9795.71 3682,-9712.71 3942,-9712.71 3942,-9795.71"/>
<text text-anchor="middle" x="3812" y="-9780.51" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="3812" y="-9765.51" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3812" y="-9750.51" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3812" y="-9735.51" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3812" y="-9720.51" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_5_all2all&#45;&gt;layer_5_expert_9 -->
<g id="edge203" class="edge">
<title>layer_5_all2all&#45;&gt;layer_5_expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3640.94,-9867.43C3667.83,-9856.44 3696.1,-9843.37 3721,-9828.71 3734.06,-9821.02 3747.25,-9811.57 3759.37,-9802.03"/>
<polygon fill="black" stroke="black" points="3761.56,-9804.76 3767.17,-9795.77 3757.18,-9799.3 3761.56,-9804.76"/>
<text text-anchor="middle" x="3833.5" y="-9817.51" font-family="Times,serif" font-size="14.00">tokens routed to expert 9</text>
</g>
<!-- layer_5_expert_10 -->
<g id="node125" class="node">
<title>layer_5_expert_10</title>
<polygon fill="lightblue" stroke="black" points="4220,-9795.71 3960,-9795.71 3960,-9712.71 4220,-9712.71 4220,-9795.71"/>
<text text-anchor="middle" x="4090" y="-9780.51" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="4090" y="-9765.51" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4090" y="-9750.51" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4090" y="-9735.51" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4090" y="-9720.51" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_5_all2all&#45;&gt;layer_5_expert_10 -->
<g id="edge204" class="edge">
<title>layer_5_all2all&#45;&gt;layer_5_expert_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3666.73,-9887.07C3744.33,-9874.95 3843.52,-9855.98 3929,-9828.71 3953.29,-9820.97 3978.75,-9810.52 4002.07,-9799.93"/>
<polygon fill="black" stroke="black" points="4003.61,-9803.08 4011.24,-9795.72 4000.69,-9796.72 4003.61,-9803.08"/>
<text text-anchor="middle" x="4065" y="-9817.51" font-family="Times,serif" font-size="14.00">tokens routed to expert 10</text>
</g>
<!-- layer_5_expert_11 -->
<g id="node126" class="node">
<title>layer_5_expert_11</title>
<polygon fill="lightblue" stroke="black" points="4498,-9795.71 4238,-9795.71 4238,-9712.71 4498,-9712.71 4498,-9795.71"/>
<text text-anchor="middle" x="4368" y="-9780.51" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="4368" y="-9765.51" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4368" y="-9750.51" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4368" y="-9735.51" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4368" y="-9720.51" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_5_all2all&#45;&gt;layer_5_expert_11 -->
<g id="edge205" class="edge">
<title>layer_5_all2all&#45;&gt;layer_5_expert_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3671.9,-9896.94C3800.81,-9887.83 3997.95,-9868.43 4165,-9828.71 4196.51,-9821.22 4229.87,-9810.42 4260.25,-9799.39"/>
<polygon fill="black" stroke="black" points="4261.82,-9802.54 4270,-9795.8 4259.4,-9795.97 4261.82,-9802.54"/>
<text text-anchor="middle" x="4312" y="-9817.51" font-family="Times,serif" font-size="14.00">tokens routed to expert 11</text>
</g>
<!-- layer_5_expert_12 -->
<g id="node127" class="node">
<title>layer_5_expert_12</title>
<polygon fill="lightblue" stroke="black" points="4776,-9795.71 4516,-9795.71 4516,-9712.71 4776,-9712.71 4776,-9795.71"/>
<text text-anchor="middle" x="4646" y="-9780.51" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="4646" y="-9765.51" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4646" y="-9750.51" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4646" y="-9735.51" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4646" y="-9720.51" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_5_all2all&#45;&gt;layer_5_expert_12 -->
<g id="edge206" class="edge">
<title>layer_5_all2all&#45;&gt;layer_5_expert_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3673.31,-9901.75C3847.58,-9896.3 4154.41,-9879.64 4412,-9828.71 4449.2,-9821.36 4488.83,-9810.23 4524.7,-9798.84"/>
<polygon fill="black" stroke="black" points="4525.77,-9802.17 4534.22,-9795.78 4523.63,-9795.51 4525.77,-9802.17"/>
<text text-anchor="middle" x="4566" y="-9817.51" font-family="Times,serif" font-size="14.00">tokens routed to expert 12</text>
</g>
<!-- layer_5_expert_13 -->
<g id="node128" class="node">
<title>layer_5_expert_13</title>
<polygon fill="lightblue" stroke="black" points="5054,-9795.71 4794,-9795.71 4794,-9712.71 5054,-9712.71 5054,-9795.71"/>
<text text-anchor="middle" x="4924" y="-9780.51" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="4924" y="-9765.51" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4924" y="-9750.51" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4924" y="-9735.51" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4924" y="-9720.51" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_5_all2all&#45;&gt;layer_5_expert_13 -->
<g id="edge207" class="edge">
<title>layer_5_all2all&#45;&gt;layer_5_expert_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3673.61,-9904.18C3888.38,-9901.79 4312.12,-9888.96 4666,-9828.71 4707.67,-9821.62 4752.23,-9810.32 4792.38,-9798.68"/>
<polygon fill="black" stroke="black" points="4793.61,-9801.97 4802.22,-9795.8 4791.64,-9795.25 4793.61,-9801.97"/>
<text text-anchor="middle" x="4826" y="-9817.51" font-family="Times,serif" font-size="14.00">tokens routed to expert 13</text>
</g>
<!-- layer_5_expert_14 -->
<g id="node129" class="node">
<title>layer_5_expert_14</title>
<polygon fill="lightblue" stroke="black" points="5332,-9795.71 5072,-9795.71 5072,-9712.71 5332,-9712.71 5332,-9795.71"/>
<text text-anchor="middle" x="5202" y="-9780.51" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="5202" y="-9765.51" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5202" y="-9750.51" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5202" y="-9735.51" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5202" y="-9720.51" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_5_all2all&#45;&gt;layer_5_expert_14 -->
<g id="edge208" class="edge">
<title>layer_5_all2all&#45;&gt;layer_5_expert_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3673.63,-9905.19C3925.34,-9904.74 4471.3,-9895.27 4926,-9828.71 4971.73,-9822.02 5020.74,-9810.46 5064.59,-9798.46"/>
<polygon fill="black" stroke="black" points="5065.74,-9801.77 5074.45,-9795.73 5063.87,-9795.03 5065.74,-9801.77"/>
<text text-anchor="middle" x="5098" y="-9817.51" font-family="Times,serif" font-size="14.00">tokens routed to expert 14</text>
</g>
<!-- layer_5_expert_15 -->
<g id="node130" class="node">
<title>layer_5_expert_15</title>
<polygon fill="lightblue" stroke="black" points="5610,-9795.71 5350,-9795.71 5350,-9712.71 5610,-9712.71 5610,-9795.71"/>
<text text-anchor="middle" x="5480" y="-9780.51" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="5480" y="-9765.51" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5480" y="-9750.51" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5480" y="-9735.51" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5480" y="-9720.51" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_5_all2all&#45;&gt;layer_5_expert_15 -->
<g id="edge209" class="edge">
<title>layer_5_all2all&#45;&gt;layer_5_expert_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3673.05,-9901.33C4017.75,-9893.17 4904.95,-9868.85 5198,-9828.71 5245.17,-9822.25 5295.76,-9810.61 5340.89,-9798.47"/>
<polygon fill="black" stroke="black" points="5342,-9801.8 5350.73,-9795.79 5340.16,-9795.04 5342,-9801.8"/>
<text text-anchor="middle" x="5372" y="-9817.51" font-family="Times,serif" font-size="14.00">tokens routed to expert 15</text>
</g>
<!-- layer_5_all2all_result -->
<g id="node131" class="node">
<title>layer_5_all2all_result</title>
<ellipse fill="yellow" stroke="black" cx="3534" cy="-9617.02" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="3534" y="-9643.32" font-family="Times,serif" font-size="14.00">Layer 5</text>
<text text-anchor="middle" x="3534" y="-9628.32" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Result Merge</text>
<text text-anchor="middle" x="3534" y="-9613.32" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="3534" y="-9598.32" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="3534" y="-9583.32" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_5_expert_0&#45;&gt;layer_5_all2all_result -->
<g id="edge210" class="edge">
<title>layer_5_expert_0&#45;&gt;layer_5_all2all_result</title>
<path fill="none" stroke="black" d="M1440,-9714.32C1443.02,-9713.74 1446.02,-9713.21 1449,-9712.71 1821.89,-9650.83 2971.76,-9626.92 3384.55,-9620.19"/>
<polygon fill="black" stroke="black" points="3384.81,-9623.69 3394.76,-9620.03 3384.7,-9616.69 3384.81,-9623.69"/>
</g>
<!-- layer_5_expert_1&#45;&gt;layer_5_all2all_result -->
<g id="edge211" class="edge">
<title>layer_5_expert_1&#45;&gt;layer_5_all2all_result</title>
<path fill="none" stroke="black" d="M1718.01,-9714.35C1721.03,-9713.76 1724.03,-9713.22 1727,-9712.71 2044.38,-9658.91 3011.71,-9630.57 3384.92,-9621.4"/>
<polygon fill="black" stroke="black" points="3385.07,-9624.9 3394.98,-9621.15 3384.9,-9617.9 3385.07,-9624.9"/>
</g>
<!-- layer_5_expert_2&#45;&gt;layer_5_all2all_result -->
<g id="edge212" class="edge">
<title>layer_5_expert_2&#45;&gt;layer_5_all2all_result</title>
<path fill="none" stroke="black" d="M1996.01,-9714.39C1999.03,-9713.79 2002.03,-9713.23 2005,-9712.71 2267.24,-9666.97 3054.24,-9634.87 3385,-9623.04"/>
<polygon fill="black" stroke="black" points="3385.26,-9626.54 3395.13,-9622.68 3385.01,-9619.54 3385.26,-9626.54"/>
</g>
<!-- layer_5_expert_3&#45;&gt;layer_5_all2all_result -->
<g id="edge213" class="edge">
<title>layer_5_expert_3&#45;&gt;layer_5_all2all_result</title>
<path fill="none" stroke="black" d="M2274.02,-9714.44C2277.04,-9713.83 2280.03,-9713.25 2283,-9712.71 2676.23,-9641.35 3148.45,-9623.64 3384.41,-9619.33"/>
<polygon fill="black" stroke="black" points="3384.49,-9622.83 3394.43,-9619.16 3384.37,-9615.83 3384.49,-9622.83"/>
</g>
<!-- layer_5_expert_4&#45;&gt;layer_5_all2all_result -->
<g id="edge214" class="edge">
<title>layer_5_expert_4&#45;&gt;layer_5_all2all_result</title>
<path fill="none" stroke="black" d="M2552.04,-9714.53C2555.05,-9713.89 2558.04,-9713.28 2561,-9712.71 2849.78,-9657.1 3193.4,-9633.39 3385.32,-9623.87"/>
<polygon fill="black" stroke="black" points="3385.66,-9627.36 3395.47,-9623.38 3385.32,-9620.37 3385.66,-9627.36"/>
</g>
<!-- layer_5_expert_5&#45;&gt;layer_5_all2all_result -->
<g id="edge215" class="edge">
<title>layer_5_expert_5&#45;&gt;layer_5_all2all_result</title>
<path fill="none" stroke="black" d="M2830.07,-9714.68C2833.07,-9714 2836.05,-9713.34 2839,-9712.71 3026.71,-9672.81 3246.69,-9646.15 3388.08,-9631.55"/>
<polygon fill="black" stroke="black" points="3388.53,-9635.03 3398.12,-9630.52 3387.81,-9628.06 3388.53,-9635.03"/>
</g>
<!-- layer_5_expert_6&#45;&gt;layer_5_all2all_result -->
<g id="edge216" class="edge">
<title>layer_5_expert_6&#45;&gt;layer_5_all2all_result</title>
<path fill="none" stroke="black" d="M3108.15,-9715.03C3111.13,-9714.24 3114.08,-9713.47 3117,-9712.71 3211.1,-9688.35 3318.02,-9664.14 3400.03,-9646.3"/>
<polygon fill="black" stroke="black" points="3400.88,-9649.69 3409.91,-9644.15 3399.39,-9642.85 3400.88,-9649.69"/>
</g>
<!-- layer_5_expert_7&#45;&gt;layer_5_all2all_result -->
<g id="edge217" class="edge">
<title>layer_5_expert_7&#45;&gt;layer_5_all2all_result</title>
<path fill="none" stroke="black" d="M3339.41,-9712.65C3369.4,-9698.07 3403.51,-9681.48 3434.72,-9666.3"/>
<polygon fill="black" stroke="black" points="3436.41,-9669.38 3443.87,-9661.86 3433.34,-9663.08 3436.41,-9669.38"/>
</g>
<!-- layer_5_expert_8&#45;&gt;layer_5_all2all_result -->
<g id="edge218" class="edge">
<title>layer_5_expert_8&#45;&gt;layer_5_all2all_result</title>
<path fill="none" stroke="black" d="M3534,-9712.65C3534,-9704.29 3534,-9695.27 3534,-9686.23"/>
<polygon fill="black" stroke="black" points="3537.5,-9686.05 3534,-9676.05 3530.5,-9686.05 3537.5,-9686.05"/>
</g>
<!-- layer_5_expert_9&#45;&gt;layer_5_all2all_result -->
<g id="edge219" class="edge">
<title>layer_5_expert_9&#45;&gt;layer_5_all2all_result</title>
<path fill="none" stroke="black" d="M3728.59,-9712.65C3698.6,-9698.07 3664.49,-9681.48 3633.28,-9666.3"/>
<polygon fill="black" stroke="black" points="3634.66,-9663.08 3624.13,-9661.86 3631.59,-9669.38 3634.66,-9663.08"/>
</g>
<!-- layer_5_expert_10&#45;&gt;layer_5_all2all_result -->
<g id="edge220" class="edge">
<title>layer_5_expert_10&#45;&gt;layer_5_all2all_result</title>
<path fill="none" stroke="black" d="M3959.85,-9715.03C3956.87,-9714.24 3953.92,-9713.47 3951,-9712.71 3856.9,-9688.35 3749.98,-9664.14 3667.97,-9646.3"/>
<polygon fill="black" stroke="black" points="3668.61,-9642.85 3658.09,-9644.15 3667.12,-9649.69 3668.61,-9642.85"/>
</g>
<!-- layer_5_expert_11&#45;&gt;layer_5_all2all_result -->
<g id="edge221" class="edge">
<title>layer_5_expert_11&#45;&gt;layer_5_all2all_result</title>
<path fill="none" stroke="black" d="M4237.93,-9714.68C4234.93,-9714 4231.95,-9713.34 4229,-9712.71 4041.29,-9672.81 3821.31,-9646.15 3679.92,-9631.55"/>
<polygon fill="black" stroke="black" points="3680.19,-9628.06 3669.88,-9630.52 3679.47,-9635.03 3680.19,-9628.06"/>
</g>
<!-- layer_5_expert_12&#45;&gt;layer_5_all2all_result -->
<g id="edge222" class="edge">
<title>layer_5_expert_12&#45;&gt;layer_5_all2all_result</title>
<path fill="none" stroke="black" d="M4515.96,-9714.53C4512.95,-9713.89 4509.96,-9713.28 4507,-9712.71 4218.22,-9657.1 3874.6,-9633.39 3682.68,-9623.87"/>
<polygon fill="black" stroke="black" points="3682.68,-9620.37 3672.53,-9623.38 3682.34,-9627.36 3682.68,-9620.37"/>
</g>
<!-- layer_5_expert_13&#45;&gt;layer_5_all2all_result -->
<g id="edge223" class="edge">
<title>layer_5_expert_13&#45;&gt;layer_5_all2all_result</title>
<path fill="none" stroke="black" d="M4793.98,-9714.44C4790.96,-9713.83 4787.97,-9713.25 4785,-9712.71 4391.77,-9641.35 3919.55,-9623.64 3683.59,-9619.33"/>
<polygon fill="black" stroke="black" points="3683.63,-9615.83 3673.57,-9619.16 3683.51,-9622.83 3683.63,-9615.83"/>
</g>
<!-- layer_5_expert_14&#45;&gt;layer_5_all2all_result -->
<g id="edge224" class="edge">
<title>layer_5_expert_14&#45;&gt;layer_5_all2all_result</title>
<path fill="none" stroke="black" d="M5071.99,-9714.39C5068.97,-9713.79 5065.97,-9713.23 5063,-9712.71 4800.76,-9666.97 4013.76,-9634.87 3683,-9623.04"/>
<polygon fill="black" stroke="black" points="3682.99,-9619.54 3672.87,-9622.68 3682.74,-9626.54 3682.99,-9619.54"/>
</g>
<!-- layer_5_expert_15&#45;&gt;layer_5_all2all_result -->
<g id="edge225" class="edge">
<title>layer_5_expert_15&#45;&gt;layer_5_all2all_result</title>
<path fill="none" stroke="black" d="M5349.99,-9714.35C5346.97,-9713.76 5343.97,-9713.22 5341,-9712.71 5023.62,-9658.91 4056.29,-9630.57 3683.08,-9621.4"/>
<polygon fill="black" stroke="black" points="3683.1,-9617.9 3673.02,-9621.15 3682.93,-9624.9 3683.1,-9617.9"/>
</g>
<!-- layer_5_expert_agg -->
<g id="node132" class="node">
<title>layer_5_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="5128,-9521.33 4880,-9521.33 4880,-9438.33 5128,-9438.33 5128,-9521.33"/>
<text text-anchor="middle" x="5004" y="-9506.13" font-family="Times,serif" font-size="14.00">Layer 5</text>
<text text-anchor="middle" x="5004" y="-9491.13" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="5004" y="-9476.13" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5004" y="-9461.13" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="5004" y="-9446.13" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_5_all2all_result&#45;&gt;layer_5_expert_agg -->
<g id="edge226" class="edge">
<title>layer_5_all2all_result&#45;&gt;layer_5_expert_agg</title>
<path fill="none" stroke="black" d="M3669.66,-9603.55C3950.06,-9577.76 4590.53,-9518.86 4869.73,-9493.18"/>
<polygon fill="black" stroke="black" points="4870.28,-9496.65 4879.92,-9492.25 4869.64,-9489.68 4870.28,-9496.65"/>
</g>
<!-- layer_5_expert_agg&#45;&gt;layer_5_residual -->
<g id="edge228" class="edge">
<title>layer_5_expert_agg&#45;&gt;layer_5_residual</title>
<path fill="none" stroke="black" d="M5128.21,-9452.94C5206.7,-9436.58 5309.29,-9415.19 5395.85,-9397.14"/>
<polygon fill="black" stroke="black" points="5396.7,-9400.54 5405.78,-9395.07 5395.28,-9393.69 5396.7,-9400.54"/>
</g>
<!-- layer_6_mha -->
<g id="node134" class="node">
<title>layer_6_mha</title>
<polygon fill="lightblue" stroke="black" points="5671.5,-9281.33 5468.5,-9281.33 5468.5,-9198.33 5671.5,-9198.33 5671.5,-9281.33"/>
<text text-anchor="middle" x="5570" y="-9266.13" font-family="Times,serif" font-size="14.00">Layer 6</text>
<text text-anchor="middle" x="5570" y="-9251.13" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="5570" y="-9236.13" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5570" y="-9221.13" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="5570" y="-9206.13" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_5_residual&#45;&gt;layer_6_mha -->
<g id="edge229" class="edge">
<title>layer_5_residual&#45;&gt;layer_6_mha</title>
<path fill="none" stroke="black" d="M5570,-9318.23C5570,-9309.7 5570,-9300.6 5570,-9291.75"/>
<polygon fill="black" stroke="black" points="5573.5,-9291.52 5570,-9281.52 5566.5,-9291.52 5573.5,-9291.52"/>
</g>
<!-- layer_6_gate -->
<g id="node135" class="node">
<title>layer_6_gate</title>
<polygon fill="lightblue" stroke="black" points="5357.5,-9161.33 5158.5,-9161.33 5158.5,-9078.33 5357.5,-9078.33 5357.5,-9161.33"/>
<text text-anchor="middle" x="5258" y="-9146.13" font-family="Times,serif" font-size="14.00">Layer 6</text>
<text text-anchor="middle" x="5258" y="-9131.13" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="5258" y="-9116.13" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5258" y="-9101.13" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="5258" y="-9086.13" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_6_mha&#45;&gt;layer_6_gate -->
<g id="edge230" class="edge">
<title>layer_6_mha&#45;&gt;layer_6_gate</title>
<path fill="none" stroke="black" d="M5468.27,-9200.36C5435.98,-9188.15 5400.15,-9174.6 5367.35,-9162.19"/>
<polygon fill="black" stroke="black" points="5368.32,-9158.82 5357.73,-9158.55 5365.84,-9165.36 5368.32,-9158.82"/>
</g>
<!-- layer_6_residual -->
<g id="node155" class="node">
<title>layer_6_residual</title>
<polygon fill="lightblue" stroke="black" points="5725,-8478.58 5397,-8478.58 5397,-8395.58 5725,-8395.58 5725,-8478.58"/>
<text text-anchor="middle" x="5561" y="-8463.38" font-family="Times,serif" font-size="14.00">Layer 6</text>
<text text-anchor="middle" x="5561" y="-8448.38" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5561" y="-8433.38" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="5561" y="-8418.38" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="5561" y="-8403.38" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_6_mha&#45;&gt;layer_6_residual -->
<g id="edge265" class="edge">
<title>layer_6_mha&#45;&gt;layer_6_residual</title>
<path fill="none" stroke="black" d="M5671.73,-9220.4C5762.78,-9200.92 5882,-9166.66 5882,-9120.83 5882,-9120.83 5882,-9120.83 5882,-8556.08 5882,-8520.2 5810.49,-8491.91 5734.97,-8472.02"/>
<polygon fill="black" stroke="black" points="5735.82,-8468.63 5725.26,-8469.52 5734.07,-8475.41 5735.82,-8468.63"/>
<text text-anchor="middle" x="5910" y="-8827.75" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_6_all2all -->
<g id="node136" class="node">
<title>layer_6_all2all</title>
<ellipse fill="yellow" stroke="black" cx="3770" cy="-8982.64" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="3770" y="-9008.94" font-family="Times,serif" font-size="14.00">Layer 6</text>
<text text-anchor="middle" x="3770" y="-8993.94" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="3770" y="-8978.94" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="3770" y="-8963.94" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="3770" y="-8948.94" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_6_gate&#45;&gt;layer_6_all2all -->
<g id="edge231" class="edge">
<title>layer_6_gate&#45;&gt;layer_6_all2all</title>
<path fill="none" stroke="black" d="M5158.35,-9109.78C4901.76,-9086.47 4217.46,-9024.3 3916.03,-8996.91"/>
<polygon fill="black" stroke="black" points="3916.18,-8993.41 3905.91,-8995.99 3915.55,-9000.38 3916.18,-8993.41"/>
</g>
<!-- layer_6_expert_0 -->
<g id="node137" class="node">
<title>layer_6_expert_0</title>
<polygon fill="lightblue" stroke="black" points="1676,-8872.95 1416,-8872.95 1416,-8789.95 1676,-8789.95 1676,-8872.95"/>
<text text-anchor="middle" x="1546" y="-8857.75" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1546" y="-8842.75" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1546" y="-8827.75" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1546" y="-8812.75" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1546" y="-8797.75" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_6_all2all&#45;&gt;layer_6_expert_0 -->
<g id="edge232" class="edge">
<title>layer_6_all2all&#45;&gt;layer_6_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3630.71,-8978.85C3250.55,-8970.78 2200.72,-8945.5 1857,-8905.95 1782.84,-8897.42 1762.33,-8891.68 1686.2,-8873.21"/>
<polygon fill="black" stroke="black" points="1686.66,-8869.72 1676.12,-8870.77 1685.02,-8876.53 1686.66,-8869.72"/>
<text text-anchor="middle" x="1948.5" y="-8894.75" font-family="Times,serif" font-size="14.00">tokens routed to expert 0</text>
</g>
<!-- layer_6_expert_1 -->
<g id="node138" class="node">
<title>layer_6_expert_1</title>
<polygon fill="lightblue" stroke="black" points="1954,-8872.95 1694,-8872.95 1694,-8789.95 1954,-8789.95 1954,-8872.95"/>
<text text-anchor="middle" x="1824" y="-8857.75" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1824" y="-8842.75" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1824" y="-8827.75" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1824" y="-8812.75" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1824" y="-8797.75" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_6_all2all&#45;&gt;layer_6_expert_1 -->
<g id="edge233" class="edge">
<title>layer_6_all2all&#45;&gt;layer_6_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3630.56,-8982.25C3346.78,-8981.94 2682.12,-8973.3 2129,-8905.95 2074.4,-8899.31 2015.41,-8886.46 1963.99,-8873.35"/>
<polygon fill="black" stroke="black" points="1964.71,-8869.92 1954.15,-8870.81 1962.96,-8876.7 1964.71,-8869.92"/>
<text text-anchor="middle" x="2220.5" y="-8894.75" font-family="Times,serif" font-size="14.00">tokens routed to expert 1</text>
</g>
<!-- layer_6_expert_2 -->
<g id="node139" class="node">
<title>layer_6_expert_2</title>
<polygon fill="lightblue" stroke="black" points="2232,-8872.95 1972,-8872.95 1972,-8789.95 2232,-8789.95 2232,-8872.95"/>
<text text-anchor="middle" x="2102" y="-8857.75" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2102" y="-8842.75" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2102" y="-8827.75" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2102" y="-8812.75" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2102" y="-8797.75" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_6_all2all&#45;&gt;layer_6_expert_2 -->
<g id="edge234" class="edge">
<title>layer_6_all2all&#45;&gt;layer_6_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3630.7,-8980.87C3382.22,-8977.96 2846.6,-8964.71 2399,-8905.95 2347.03,-8899.13 2291,-8886.65 2241.76,-8873.88"/>
<polygon fill="black" stroke="black" points="2242.57,-8870.48 2232.01,-8871.33 2240.8,-8877.25 2242.57,-8870.48"/>
<text text-anchor="middle" x="2490.5" y="-8894.75" font-family="Times,serif" font-size="14.00">tokens routed to expert 2</text>
</g>
<!-- layer_6_expert_3 -->
<g id="node140" class="node">
<title>layer_6_expert_3</title>
<polygon fill="lightblue" stroke="black" points="2510,-8872.95 2250,-8872.95 2250,-8789.95 2510,-8789.95 2510,-8872.95"/>
<text text-anchor="middle" x="2380" y="-8857.75" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2380" y="-8842.75" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2380" y="-8827.75" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2380" y="-8812.75" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2380" y="-8797.75" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_6_all2all&#45;&gt;layer_6_expert_3 -->
<g id="edge235" class="edge">
<title>layer_6_all2all&#45;&gt;layer_6_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3630.67,-8979.7C3418.95,-8975.05 3004.01,-8959.3 2656,-8905.95 2610.77,-8899.02 2562.29,-8887.54 2518.78,-8875.68"/>
<polygon fill="black" stroke="black" points="2519.57,-8872.27 2509,-8872.99 2517.71,-8879.02 2519.57,-8872.27"/>
<text text-anchor="middle" x="2747.5" y="-8894.75" font-family="Times,serif" font-size="14.00">tokens routed to expert 3</text>
</g>
<!-- layer_6_expert_4 -->
<g id="node141" class="node">
<title>layer_6_expert_4</title>
<polygon fill="lightblue" stroke="black" points="2788,-8872.95 2528,-8872.95 2528,-8789.95 2788,-8789.95 2788,-8872.95"/>
<text text-anchor="middle" x="2658" y="-8857.75" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="2658" y="-8842.75" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2658" y="-8827.75" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2658" y="-8812.75" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2658" y="-8797.75" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_6_all2all&#45;&gt;layer_6_expert_4 -->
<g id="edge236" class="edge">
<title>layer_6_all2all&#45;&gt;layer_6_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3630.78,-8978.03C3459.04,-8971.62 3158.77,-8953.98 2906,-8905.95 2866.65,-8898.48 2824.62,-8887.29 2786.55,-8875.88"/>
<polygon fill="black" stroke="black" points="2787.54,-8872.53 2776.96,-8872.98 2785.51,-8879.23 2787.54,-8872.53"/>
<text text-anchor="middle" x="2997.5" y="-8894.75" font-family="Times,serif" font-size="14.00">tokens routed to expert 4</text>
</g>
<!-- layer_6_expert_5 -->
<g id="node142" class="node">
<title>layer_6_expert_5</title>
<polygon fill="lightblue" stroke="black" points="3066,-8872.95 2806,-8872.95 2806,-8789.95 3066,-8789.95 3066,-8872.95"/>
<text text-anchor="middle" x="2936" y="-8857.75" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="2936" y="-8842.75" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2936" y="-8827.75" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2936" y="-8812.75" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2936" y="-8797.75" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_6_all2all&#45;&gt;layer_6_expert_5 -->
<g id="edge237" class="edge">
<title>layer_6_all2all&#45;&gt;layer_6_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3632.18,-8973.5C3504.75,-8963.96 3310.74,-8944.3 3146,-8905.95 3113.44,-8898.38 3078.89,-8887.52 3047.43,-8876.47"/>
<polygon fill="black" stroke="black" points="3048.36,-8873.09 3037.76,-8873.04 3046.02,-8879.68 3048.36,-8873.09"/>
<text text-anchor="middle" x="3237.5" y="-8894.75" font-family="Times,serif" font-size="14.00">tokens routed to expert 5</text>
</g>
<!-- layer_6_expert_6 -->
<g id="node143" class="node">
<title>layer_6_expert_6</title>
<polygon fill="lightblue" stroke="black" points="3344,-8872.95 3084,-8872.95 3084,-8789.95 3344,-8789.95 3344,-8872.95"/>
<text text-anchor="middle" x="3214" y="-8857.75" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="3214" y="-8842.75" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3214" y="-8827.75" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3214" y="-8812.75" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3214" y="-8797.75" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_6_all2all&#45;&gt;layer_6_expert_6 -->
<g id="edge238" class="edge">
<title>layer_6_all2all&#45;&gt;layer_6_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3637.36,-8964.49C3559.49,-8952.41 3459.83,-8933.42 3374,-8905.95 3349.84,-8898.22 3324.53,-8887.78 3301.36,-8877.2"/>
<polygon fill="black" stroke="black" points="3302.79,-8874.01 3292.25,-8872.98 3299.85,-8880.36 3302.79,-8874.01"/>
<text text-anchor="middle" x="3465.5" y="-8894.75" font-family="Times,serif" font-size="14.00">tokens routed to expert 6</text>
</g>
<!-- layer_6_expert_7 -->
<g id="node144" class="node">
<title>layer_6_expert_7</title>
<polygon fill="lightblue" stroke="black" points="3622,-8872.95 3362,-8872.95 3362,-8789.95 3622,-8789.95 3622,-8872.95"/>
<text text-anchor="middle" x="3492" y="-8857.75" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="3492" y="-8842.75" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3492" y="-8827.75" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3492" y="-8812.75" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3492" y="-8797.75" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_6_all2all&#45;&gt;layer_6_expert_7 -->
<g id="edge239" class="edge">
<title>layer_6_all2all&#45;&gt;layer_6_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3663.06,-8944.67C3636.17,-8933.68 3607.9,-8920.61 3583,-8905.95 3569.94,-8898.26 3556.75,-8888.81 3544.63,-8879.27"/>
<polygon fill="black" stroke="black" points="3546.82,-8876.54 3536.83,-8873.01 3542.44,-8882 3546.82,-8876.54"/>
<text text-anchor="middle" x="3674.5" y="-8894.75" font-family="Times,serif" font-size="14.00">tokens routed to expert 7</text>
</g>
<!-- layer_6_expert_8 -->
<g id="node145" class="node">
<title>layer_6_expert_8</title>
<polygon fill="lightblue" stroke="black" points="3900,-8872.95 3640,-8872.95 3640,-8789.95 3900,-8789.95 3900,-8872.95"/>
<text text-anchor="middle" x="3770" y="-8857.75" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="3770" y="-8842.75" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3770" y="-8827.75" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3770" y="-8812.75" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3770" y="-8797.75" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_6_all2all&#45;&gt;layer_6_expert_8 -->
<g id="edge240" class="edge">
<title>layer_6_all2all&#45;&gt;layer_6_expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3770,-8923.54C3770,-8910.24 3770,-8896.2 3770,-8883.24"/>
<polygon fill="black" stroke="black" points="3773.5,-8883.11 3770,-8873.11 3766.5,-8883.11 3773.5,-8883.11"/>
<text text-anchor="middle" x="3861.5" y="-8894.75" font-family="Times,serif" font-size="14.00">tokens routed to expert 8</text>
</g>
<!-- layer_6_expert_9 -->
<g id="node146" class="node">
<title>layer_6_expert_9</title>
<polygon fill="lightblue" stroke="black" points="4178,-8872.95 3918,-8872.95 3918,-8789.95 4178,-8789.95 4178,-8872.95"/>
<text text-anchor="middle" x="4048" y="-8857.75" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="4048" y="-8842.75" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4048" y="-8827.75" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4048" y="-8812.75" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4048" y="-8797.75" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_6_all2all&#45;&gt;layer_6_expert_9 -->
<g id="edge241" class="edge">
<title>layer_6_all2all&#45;&gt;layer_6_expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3876.94,-8944.67C3903.83,-8933.68 3932.1,-8920.61 3957,-8905.95 3970.06,-8898.26 3983.25,-8888.81 3995.37,-8879.27"/>
<polygon fill="black" stroke="black" points="3997.56,-8882 4003.17,-8873.01 3993.18,-8876.54 3997.56,-8882"/>
<text text-anchor="middle" x="4069.5" y="-8894.75" font-family="Times,serif" font-size="14.00">tokens routed to expert 9</text>
</g>
<!-- layer_6_expert_10 -->
<g id="node147" class="node">
<title>layer_6_expert_10</title>
<polygon fill="lightblue" stroke="black" points="4456,-8872.95 4196,-8872.95 4196,-8789.95 4456,-8789.95 4456,-8872.95"/>
<text text-anchor="middle" x="4326" y="-8857.75" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="4326" y="-8842.75" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4326" y="-8827.75" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4326" y="-8812.75" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4326" y="-8797.75" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_6_all2all&#45;&gt;layer_6_expert_10 -->
<g id="edge242" class="edge">
<title>layer_6_all2all&#45;&gt;layer_6_expert_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3902.73,-8964.31C3980.33,-8952.19 4079.52,-8933.22 4165,-8905.95 4189.29,-8898.21 4214.75,-8887.76 4238.07,-8877.17"/>
<polygon fill="black" stroke="black" points="4239.61,-8880.32 4247.24,-8872.96 4236.69,-8873.96 4239.61,-8880.32"/>
<text text-anchor="middle" x="4301" y="-8894.75" font-family="Times,serif" font-size="14.00">tokens routed to expert 10</text>
</g>
<!-- layer_6_expert_11 -->
<g id="node148" class="node">
<title>layer_6_expert_11</title>
<polygon fill="lightblue" stroke="black" points="4734,-8872.95 4474,-8872.95 4474,-8789.95 4734,-8789.95 4734,-8872.95"/>
<text text-anchor="middle" x="4604" y="-8857.75" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="4604" y="-8842.75" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4604" y="-8827.75" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4604" y="-8812.75" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4604" y="-8797.75" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_6_all2all&#45;&gt;layer_6_expert_11 -->
<g id="edge243" class="edge">
<title>layer_6_all2all&#45;&gt;layer_6_expert_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3907.9,-8974.18C4036.81,-8965.07 4233.95,-8945.67 4401,-8905.95 4432.51,-8898.47 4465.87,-8887.66 4496.25,-8876.63"/>
<polygon fill="black" stroke="black" points="4497.82,-8879.78 4506,-8873.04 4495.4,-8873.21 4497.82,-8879.78"/>
<text text-anchor="middle" x="4548" y="-8894.75" font-family="Times,serif" font-size="14.00">tokens routed to expert 11</text>
</g>
<!-- layer_6_expert_12 -->
<g id="node149" class="node">
<title>layer_6_expert_12</title>
<polygon fill="lightblue" stroke="black" points="5012,-8872.95 4752,-8872.95 4752,-8789.95 5012,-8789.95 5012,-8872.95"/>
<text text-anchor="middle" x="4882" y="-8857.75" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="4882" y="-8842.75" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4882" y="-8827.75" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4882" y="-8812.75" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4882" y="-8797.75" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_6_all2all&#45;&gt;layer_6_expert_12 -->
<g id="edge244" class="edge">
<title>layer_6_all2all&#45;&gt;layer_6_expert_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3909.31,-8978.99C4083.58,-8973.54 4390.41,-8956.88 4648,-8905.95 4685.2,-8898.6 4724.83,-8887.47 4760.7,-8876.08"/>
<polygon fill="black" stroke="black" points="4761.77,-8879.41 4770.22,-8873.02 4759.63,-8872.75 4761.77,-8879.41"/>
<text text-anchor="middle" x="4802" y="-8894.75" font-family="Times,serif" font-size="14.00">tokens routed to expert 12</text>
</g>
<!-- layer_6_expert_13 -->
<g id="node150" class="node">
<title>layer_6_expert_13</title>
<polygon fill="lightblue" stroke="black" points="5290,-8872.95 5030,-8872.95 5030,-8789.95 5290,-8789.95 5290,-8872.95"/>
<text text-anchor="middle" x="5160" y="-8857.75" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="5160" y="-8842.75" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5160" y="-8827.75" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5160" y="-8812.75" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5160" y="-8797.75" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_6_all2all&#45;&gt;layer_6_expert_13 -->
<g id="edge245" class="edge">
<title>layer_6_all2all&#45;&gt;layer_6_expert_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3909.61,-8981.42C4124.38,-8979.03 4548.12,-8966.2 4902,-8905.95 4943.67,-8898.86 4988.23,-8887.56 5028.38,-8875.92"/>
<polygon fill="black" stroke="black" points="5029.61,-8879.21 5038.22,-8873.04 5027.64,-8872.49 5029.61,-8879.21"/>
<text text-anchor="middle" x="5062" y="-8894.75" font-family="Times,serif" font-size="14.00">tokens routed to expert 13</text>
</g>
<!-- layer_6_expert_14 -->
<g id="node151" class="node">
<title>layer_6_expert_14</title>
<polygon fill="lightblue" stroke="black" points="5568,-8872.95 5308,-8872.95 5308,-8789.95 5568,-8789.95 5568,-8872.95"/>
<text text-anchor="middle" x="5438" y="-8857.75" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="5438" y="-8842.75" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5438" y="-8827.75" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5438" y="-8812.75" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5438" y="-8797.75" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_6_all2all&#45;&gt;layer_6_expert_14 -->
<g id="edge246" class="edge">
<title>layer_6_all2all&#45;&gt;layer_6_expert_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3909.63,-8982.43C4161.34,-8981.98 4707.3,-8972.51 5162,-8905.95 5207.73,-8899.26 5256.74,-8887.7 5300.59,-8875.7"/>
<polygon fill="black" stroke="black" points="5301.74,-8879.01 5310.45,-8872.97 5299.87,-8872.27 5301.74,-8879.01"/>
<text text-anchor="middle" x="5334" y="-8894.75" font-family="Times,serif" font-size="14.00">tokens routed to expert 14</text>
</g>
<!-- layer_6_expert_15 -->
<g id="node152" class="node">
<title>layer_6_expert_15</title>
<polygon fill="lightblue" stroke="black" points="5846,-8872.95 5586,-8872.95 5586,-8789.95 5846,-8789.95 5846,-8872.95"/>
<text text-anchor="middle" x="5716" y="-8857.75" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="5716" y="-8842.75" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5716" y="-8827.75" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5716" y="-8812.75" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5716" y="-8797.75" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_6_all2all&#45;&gt;layer_6_expert_15 -->
<g id="edge247" class="edge">
<title>layer_6_all2all&#45;&gt;layer_6_expert_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3909.05,-8978.57C4253.75,-8970.41 5140.95,-8946.09 5434,-8905.95 5481.17,-8899.49 5531.76,-8887.85 5576.89,-8875.71"/>
<polygon fill="black" stroke="black" points="5578,-8879.04 5586.73,-8873.03 5576.16,-8872.28 5578,-8879.04"/>
<text text-anchor="middle" x="5608" y="-8894.75" font-family="Times,serif" font-size="14.00">tokens routed to expert 15</text>
</g>
<!-- layer_6_all2all_result -->
<g id="node153" class="node">
<title>layer_6_all2all_result</title>
<ellipse fill="yellow" stroke="black" cx="3770" cy="-8694.27" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="3770" y="-8720.57" font-family="Times,serif" font-size="14.00">Layer 6</text>
<text text-anchor="middle" x="3770" y="-8705.57" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Result Merge</text>
<text text-anchor="middle" x="3770" y="-8690.57" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="3770" y="-8675.57" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="3770" y="-8660.57" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_6_expert_0&#45;&gt;layer_6_all2all_result -->
<g id="edge248" class="edge">
<title>layer_6_expert_0&#45;&gt;layer_6_all2all_result</title>
<path fill="none" stroke="black" d="M1676,-8791.56C1679.02,-8790.99 1682.02,-8790.45 1685,-8789.95 2057.89,-8728.07 3207.76,-8704.17 3620.55,-8697.44"/>
<polygon fill="black" stroke="black" points="3620.81,-8700.93 3630.76,-8697.27 3620.7,-8693.93 3620.81,-8700.93"/>
</g>
<!-- layer_6_expert_1&#45;&gt;layer_6_all2all_result -->
<g id="edge249" class="edge">
<title>layer_6_expert_1&#45;&gt;layer_6_all2all_result</title>
<path fill="none" stroke="black" d="M1954.01,-8791.59C1957.03,-8791 1960.03,-8790.46 1963,-8789.95 2280.38,-8736.15 3247.71,-8707.81 3620.92,-8698.64"/>
<polygon fill="black" stroke="black" points="3621.07,-8702.14 3630.98,-8698.4 3620.9,-8695.14 3621.07,-8702.14"/>
</g>
<!-- layer_6_expert_2&#45;&gt;layer_6_all2all_result -->
<g id="edge250" class="edge">
<title>layer_6_expert_2&#45;&gt;layer_6_all2all_result</title>
<path fill="none" stroke="black" d="M2232.01,-8791.63C2235.03,-8791.03 2238.03,-8790.47 2241,-8789.95 2503.24,-8744.22 3290.24,-8712.11 3621,-8700.28"/>
<polygon fill="black" stroke="black" points="3621.26,-8703.78 3631.13,-8699.92 3621.01,-8696.78 3621.26,-8703.78"/>
</g>
<!-- layer_6_expert_3&#45;&gt;layer_6_all2all_result -->
<g id="edge251" class="edge">
<title>layer_6_expert_3&#45;&gt;layer_6_all2all_result</title>
<path fill="none" stroke="black" d="M2510.02,-8791.68C2513.04,-8791.07 2516.03,-8790.49 2519,-8789.95 2912.23,-8718.59 3384.45,-8700.88 3620.41,-8696.58"/>
<polygon fill="black" stroke="black" points="3620.49,-8700.07 3630.43,-8696.4 3620.37,-8693.08 3620.49,-8700.07"/>
</g>
<!-- layer_6_expert_4&#45;&gt;layer_6_all2all_result -->
<g id="edge252" class="edge">
<title>layer_6_expert_4&#45;&gt;layer_6_all2all_result</title>
<path fill="none" stroke="black" d="M2788.04,-8791.77C2791.05,-8791.13 2794.04,-8790.53 2797,-8789.95 3085.78,-8734.34 3429.4,-8710.63 3621.32,-8701.11"/>
<polygon fill="black" stroke="black" points="3621.66,-8704.6 3631.47,-8700.62 3621.32,-8697.61 3621.66,-8704.6"/>
</g>
<!-- layer_6_expert_5&#45;&gt;layer_6_all2all_result -->
<g id="edge253" class="edge">
<title>layer_6_expert_5&#45;&gt;layer_6_all2all_result</title>
<path fill="none" stroke="black" d="M3066.07,-8791.92C3069.07,-8791.24 3072.05,-8790.58 3075,-8789.95 3262.71,-8750.05 3482.69,-8723.39 3624.08,-8708.79"/>
<polygon fill="black" stroke="black" points="3624.53,-8712.27 3634.12,-8707.76 3623.81,-8705.3 3624.53,-8712.27"/>
</g>
<!-- layer_6_expert_6&#45;&gt;layer_6_all2all_result -->
<g id="edge254" class="edge">
<title>layer_6_expert_6&#45;&gt;layer_6_all2all_result</title>
<path fill="none" stroke="black" d="M3344.15,-8792.27C3347.13,-8791.49 3350.08,-8790.71 3353,-8789.95 3354.79,-8789.49 3516.83,-8752.71 3638.35,-8725.13"/>
<polygon fill="black" stroke="black" points="3639.16,-8728.54 3648.13,-8722.91 3637.61,-8721.71 3639.16,-8728.54"/>
</g>
<!-- layer_6_expert_7&#45;&gt;layer_6_all2all_result -->
<g id="edge255" class="edge">
<title>layer_6_expert_7&#45;&gt;layer_6_all2all_result</title>
<path fill="none" stroke="black" d="M3577.77,-8789.87C3590.27,-8783.89 3602.98,-8777.79 3615,-8771.95 3633.45,-8763 3653.1,-8753.36 3671.98,-8744.05"/>
<polygon fill="black" stroke="black" points="3673.77,-8747.07 3681.18,-8739.5 3670.67,-8740.79 3673.77,-8747.07"/>
</g>
<!-- layer_6_expert_8&#45;&gt;layer_6_all2all_result -->
<g id="edge256" class="edge">
<title>layer_6_expert_8&#45;&gt;layer_6_all2all_result</title>
<path fill="none" stroke="black" d="M3770,-8789.89C3770,-8781.53 3770,-8772.51 3770,-8763.47"/>
<polygon fill="black" stroke="black" points="3773.5,-8763.29 3770,-8753.29 3766.5,-8763.29 3773.5,-8763.29"/>
</g>
<!-- layer_6_expert_9&#45;&gt;layer_6_all2all_result -->
<g id="edge257" class="edge">
<title>layer_6_expert_9&#45;&gt;layer_6_all2all_result</title>
<path fill="none" stroke="black" d="M3964.59,-8789.89C3934.6,-8775.31 3900.49,-8758.72 3869.28,-8743.54"/>
<polygon fill="black" stroke="black" points="3870.66,-8740.32 3860.13,-8739.1 3867.59,-8746.62 3870.66,-8740.32"/>
</g>
<!-- layer_6_expert_10&#45;&gt;layer_6_all2all_result -->
<g id="edge258" class="edge">
<title>layer_6_expert_10&#45;&gt;layer_6_all2all_result</title>
<path fill="none" stroke="black" d="M4195.85,-8792.27C4192.87,-8791.49 4189.92,-8790.71 4187,-8789.95 4092.9,-8765.59 3985.98,-8741.38 3903.97,-8723.54"/>
<polygon fill="black" stroke="black" points="3904.61,-8720.09 3894.09,-8721.39 3903.12,-8726.93 3904.61,-8720.09"/>
</g>
<!-- layer_6_expert_11&#45;&gt;layer_6_all2all_result -->
<g id="edge259" class="edge">
<title>layer_6_expert_11&#45;&gt;layer_6_all2all_result</title>
<path fill="none" stroke="black" d="M4473.93,-8791.92C4470.93,-8791.24 4467.95,-8790.58 4465,-8789.95 4277.29,-8750.05 4057.31,-8723.39 3915.92,-8708.79"/>
<polygon fill="black" stroke="black" points="3916.19,-8705.3 3905.88,-8707.76 3915.47,-8712.27 3916.19,-8705.3"/>
</g>
<!-- layer_6_expert_12&#45;&gt;layer_6_all2all_result -->
<g id="edge260" class="edge">
<title>layer_6_expert_12&#45;&gt;layer_6_all2all_result</title>
<path fill="none" stroke="black" d="M4751.96,-8791.77C4748.95,-8791.13 4745.96,-8790.53 4743,-8789.95 4454.22,-8734.34 4110.6,-8710.63 3918.68,-8701.11"/>
<polygon fill="black" stroke="black" points="3918.68,-8697.61 3908.53,-8700.62 3918.34,-8704.6 3918.68,-8697.61"/>
</g>
<!-- layer_6_expert_13&#45;&gt;layer_6_all2all_result -->
<g id="edge261" class="edge">
<title>layer_6_expert_13&#45;&gt;layer_6_all2all_result</title>
<path fill="none" stroke="black" d="M5029.98,-8791.68C5026.96,-8791.07 5023.97,-8790.49 5021,-8789.95 4627.77,-8718.59 4155.55,-8700.88 3919.59,-8696.58"/>
<polygon fill="black" stroke="black" points="3919.63,-8693.08 3909.57,-8696.4 3919.51,-8700.07 3919.63,-8693.08"/>
</g>
<!-- layer_6_expert_14&#45;&gt;layer_6_all2all_result -->
<g id="edge262" class="edge">
<title>layer_6_expert_14&#45;&gt;layer_6_all2all_result</title>
<path fill="none" stroke="black" d="M5307.99,-8791.63C5304.97,-8791.03 5301.97,-8790.47 5299,-8789.95 5036.76,-8744.22 4249.76,-8712.11 3919,-8700.28"/>
<polygon fill="black" stroke="black" points="3918.99,-8696.78 3908.87,-8699.92 3918.74,-8703.78 3918.99,-8696.78"/>
</g>
<!-- layer_6_expert_15&#45;&gt;layer_6_all2all_result -->
<g id="edge263" class="edge">
<title>layer_6_expert_15&#45;&gt;layer_6_all2all_result</title>
<path fill="none" stroke="black" d="M5585.99,-8791.59C5582.97,-8791 5579.97,-8790.46 5577,-8789.95 5259.62,-8736.15 4292.29,-8707.81 3919.08,-8698.64"/>
<polygon fill="black" stroke="black" points="3919.1,-8695.14 3909.02,-8698.4 3918.93,-8702.14 3919.1,-8695.14"/>
</g>
<!-- layer_6_expert_agg -->
<g id="node154" class="node">
<title>layer_6_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="5364,-8598.58 5116,-8598.58 5116,-8515.58 5364,-8515.58 5364,-8598.58"/>
<text text-anchor="middle" x="5240" y="-8583.38" font-family="Times,serif" font-size="14.00">Layer 6</text>
<text text-anchor="middle" x="5240" y="-8568.38" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="5240" y="-8553.38" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5240" y="-8538.38" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="5240" y="-8523.38" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_6_all2all_result&#45;&gt;layer_6_expert_agg -->
<g id="edge264" class="edge">
<title>layer_6_all2all_result&#45;&gt;layer_6_expert_agg</title>
<path fill="none" stroke="black" d="M3905.66,-8680.79C4186.06,-8655 4826.53,-8596.1 5105.73,-8570.42"/>
<polygon fill="black" stroke="black" points="5106.28,-8573.89 5115.92,-8569.49 5105.64,-8566.92 5106.28,-8573.89"/>
</g>
<!-- layer_6_expert_agg&#45;&gt;layer_6_residual -->
<g id="edge266" class="edge">
<title>layer_6_expert_agg&#45;&gt;layer_6_residual</title>
<path fill="none" stroke="black" d="M5350.47,-8515.47C5379.68,-8504.73 5411.35,-8493.09 5441.03,-8482.17"/>
<polygon fill="black" stroke="black" points="5442.42,-8485.39 5450.6,-8478.66 5440,-8478.82 5442.42,-8485.39"/>
</g>
<!-- layer_7_mha -->
<g id="node156" class="node">
<title>layer_7_mha</title>
<polygon fill="lightblue" stroke="black" points="5662.5,-8358.58 5459.5,-8358.58 5459.5,-8275.58 5662.5,-8275.58 5662.5,-8358.58"/>
<text text-anchor="middle" x="5561" y="-8343.38" font-family="Times,serif" font-size="14.00">Layer 7</text>
<text text-anchor="middle" x="5561" y="-8328.38" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="5561" y="-8313.38" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5561" y="-8298.38" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="5561" y="-8283.38" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_6_residual&#45;&gt;layer_7_mha -->
<g id="edge267" class="edge">
<title>layer_6_residual&#45;&gt;layer_7_mha</title>
<path fill="none" stroke="black" d="M5561,-8395.47C5561,-8386.94 5561,-8377.84 5561,-8368.99"/>
<polygon fill="black" stroke="black" points="5564.5,-8368.76 5561,-8358.76 5557.5,-8368.76 5564.5,-8368.76"/>
</g>
<!-- layer_7_gate -->
<g id="node157" class="node">
<title>layer_7_gate</title>
<polygon fill="lightblue" stroke="black" points="5348.5,-8238.58 5149.5,-8238.58 5149.5,-8155.58 5348.5,-8155.58 5348.5,-8238.58"/>
<text text-anchor="middle" x="5249" y="-8223.38" font-family="Times,serif" font-size="14.00">Layer 7</text>
<text text-anchor="middle" x="5249" y="-8208.38" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="5249" y="-8193.38" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5249" y="-8178.38" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="5249" y="-8163.38" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_7_mha&#45;&gt;layer_7_gate -->
<g id="edge268" class="edge">
<title>layer_7_mha&#45;&gt;layer_7_gate</title>
<path fill="none" stroke="black" d="M5459.27,-8277.6C5426.98,-8265.39 5391.15,-8251.84 5358.35,-8239.43"/>
<polygon fill="black" stroke="black" points="5359.32,-8236.06 5348.73,-8235.79 5356.84,-8242.6 5359.32,-8236.06"/>
</g>
<!-- layer_7_residual -->
<g id="node177" class="node">
<title>layer_7_residual</title>
<polygon fill="lightblue" stroke="black" points="5961,-7555.82 5633,-7555.82 5633,-7472.82 5961,-7472.82 5961,-7555.82"/>
<text text-anchor="middle" x="5797" y="-7540.62" font-family="Times,serif" font-size="14.00">Layer 7</text>
<text text-anchor="middle" x="5797" y="-7525.62" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="5797" y="-7510.62" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="5797" y="-7495.62" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="5797" y="-7480.62" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_7_mha&#45;&gt;layer_7_residual -->
<g id="edge303" class="edge">
<title>layer_7_mha&#45;&gt;layer_7_residual</title>
<path fill="none" stroke="black" d="M5662.73,-8297.64C5753.78,-8278.16 5873,-8243.9 5873,-8198.08 5873,-8198.08 5873,-8198.08 5873,-7633.32 5873,-7607.94 5860.42,-7583.68 5845.5,-7563.83"/>
<polygon fill="black" stroke="black" points="5848.17,-7561.56 5839.22,-7555.88 5842.67,-7565.9 5848.17,-7561.56"/>
<text text-anchor="middle" x="5901" y="-7905" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_7_all2all -->
<g id="node158" class="node">
<title>layer_7_all2all</title>
<ellipse fill="yellow" stroke="black" cx="3761" cy="-8059.89" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="3761" y="-8086.19" font-family="Times,serif" font-size="14.00">Layer 7</text>
<text text-anchor="middle" x="3761" y="-8071.19" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="3761" y="-8056.19" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="3761" y="-8041.19" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="3761" y="-8026.19" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_7_gate&#45;&gt;layer_7_all2all -->
<g id="edge269" class="edge">
<title>layer_7_gate&#45;&gt;layer_7_all2all</title>
<path fill="none" stroke="black" d="M5149.35,-8187.02C4892.76,-8163.71 4208.46,-8101.54 3907.03,-8074.15"/>
<polygon fill="black" stroke="black" points="3907.18,-8070.65 3896.91,-8073.23 3906.55,-8077.62 3907.18,-8070.65"/>
</g>
<!-- layer_7_expert_0 -->
<g id="node159" class="node">
<title>layer_7_expert_0</title>
<polygon fill="lightblue" stroke="black" points="1667,-7950.2 1407,-7950.2 1407,-7867.2 1667,-7867.2 1667,-7950.2"/>
<text text-anchor="middle" x="1537" y="-7935" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1537" y="-7920" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1537" y="-7905" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1537" y="-7890" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1537" y="-7875" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_7_all2all&#45;&gt;layer_7_expert_0 -->
<g id="edge270" class="edge">
<title>layer_7_all2all&#45;&gt;layer_7_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3621.71,-8056.09C3241.55,-8048.02 2191.72,-8022.74 1848,-7983.2 1773.84,-7974.66 1753.33,-7968.92 1677.2,-7950.45"/>
<polygon fill="black" stroke="black" points="1677.66,-7946.96 1667.12,-7948.01 1676.02,-7953.77 1677.66,-7946.96"/>
<text text-anchor="middle" x="1939.5" y="-7972" font-family="Times,serif" font-size="14.00">tokens routed to expert 0</text>
</g>
<!-- layer_7_expert_1 -->
<g id="node160" class="node">
<title>layer_7_expert_1</title>
<polygon fill="lightblue" stroke="black" points="1945,-7950.2 1685,-7950.2 1685,-7867.2 1945,-7867.2 1945,-7950.2"/>
<text text-anchor="middle" x="1815" y="-7935" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1815" y="-7920" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1815" y="-7905" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1815" y="-7890" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1815" y="-7875" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_7_all2all&#45;&gt;layer_7_expert_1 -->
<g id="edge271" class="edge">
<title>layer_7_all2all&#45;&gt;layer_7_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3621.56,-8059.49C3337.78,-8059.18 2673.12,-8050.54 2120,-7983.2 2065.4,-7976.55 2006.41,-7963.71 1954.99,-7950.59"/>
<polygon fill="black" stroke="black" points="1955.71,-7947.16 1945.15,-7948.05 1953.96,-7953.94 1955.71,-7947.16"/>
<text text-anchor="middle" x="2211.5" y="-7972" font-family="Times,serif" font-size="14.00">tokens routed to expert 1</text>
</g>
<!-- layer_7_expert_2 -->
<g id="node161" class="node">
<title>layer_7_expert_2</title>
<polygon fill="lightblue" stroke="black" points="2223,-7950.2 1963,-7950.2 1963,-7867.2 2223,-7867.2 2223,-7950.2"/>
<text text-anchor="middle" x="2093" y="-7935" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2093" y="-7920" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2093" y="-7905" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2093" y="-7890" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2093" y="-7875" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_7_all2all&#45;&gt;layer_7_expert_2 -->
<g id="edge272" class="edge">
<title>layer_7_all2all&#45;&gt;layer_7_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3621.7,-8058.11C3373.22,-8055.2 2837.6,-8041.95 2390,-7983.2 2338.03,-7976.37 2282,-7963.89 2232.76,-7951.13"/>
<polygon fill="black" stroke="black" points="2233.57,-7947.72 2223.01,-7948.57 2231.8,-7954.49 2233.57,-7947.72"/>
<text text-anchor="middle" x="2481.5" y="-7972" font-family="Times,serif" font-size="14.00">tokens routed to expert 2</text>
</g>
<!-- layer_7_expert_3 -->
<g id="node162" class="node">
<title>layer_7_expert_3</title>
<polygon fill="lightblue" stroke="black" points="2501,-7950.2 2241,-7950.2 2241,-7867.2 2501,-7867.2 2501,-7950.2"/>
<text text-anchor="middle" x="2371" y="-7935" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2371" y="-7920" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2371" y="-7905" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2371" y="-7890" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2371" y="-7875" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_7_all2all&#45;&gt;layer_7_expert_3 -->
<g id="edge273" class="edge">
<title>layer_7_all2all&#45;&gt;layer_7_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3621.67,-8056.94C3409.95,-8052.29 2995.01,-8036.54 2647,-7983.2 2601.77,-7976.26 2553.29,-7964.78 2509.78,-7952.93"/>
<polygon fill="black" stroke="black" points="2510.57,-7949.51 2500,-7950.23 2508.71,-7956.26 2510.57,-7949.51"/>
<text text-anchor="middle" x="2738.5" y="-7972" font-family="Times,serif" font-size="14.00">tokens routed to expert 3</text>
</g>
<!-- layer_7_expert_4 -->
<g id="node163" class="node">
<title>layer_7_expert_4</title>
<polygon fill="lightblue" stroke="black" points="2779,-7950.2 2519,-7950.2 2519,-7867.2 2779,-7867.2 2779,-7950.2"/>
<text text-anchor="middle" x="2649" y="-7935" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="2649" y="-7920" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2649" y="-7905" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2649" y="-7890" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2649" y="-7875" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_7_all2all&#45;&gt;layer_7_expert_4 -->
<g id="edge274" class="edge">
<title>layer_7_all2all&#45;&gt;layer_7_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3621.78,-8055.27C3450.04,-8048.86 3149.77,-8031.22 2897,-7983.2 2857.65,-7975.72 2815.62,-7964.53 2777.55,-7953.12"/>
<polygon fill="black" stroke="black" points="2778.54,-7949.77 2767.96,-7950.22 2776.51,-7956.47 2778.54,-7949.77"/>
<text text-anchor="middle" x="2988.5" y="-7972" font-family="Times,serif" font-size="14.00">tokens routed to expert 4</text>
</g>
<!-- layer_7_expert_5 -->
<g id="node164" class="node">
<title>layer_7_expert_5</title>
<polygon fill="lightblue" stroke="black" points="3057,-7950.2 2797,-7950.2 2797,-7867.2 3057,-7867.2 3057,-7950.2"/>
<text text-anchor="middle" x="2927" y="-7935" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="2927" y="-7920" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2927" y="-7905" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2927" y="-7890" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2927" y="-7875" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_7_all2all&#45;&gt;layer_7_expert_5 -->
<g id="edge275" class="edge">
<title>layer_7_all2all&#45;&gt;layer_7_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3623.18,-8050.74C3495.75,-8041.2 3301.74,-8021.54 3137,-7983.2 3104.44,-7975.62 3069.89,-7964.76 3038.43,-7953.71"/>
<polygon fill="black" stroke="black" points="3039.36,-7950.33 3028.76,-7950.28 3037.02,-7956.93 3039.36,-7950.33"/>
<text text-anchor="middle" x="3228.5" y="-7972" font-family="Times,serif" font-size="14.00">tokens routed to expert 5</text>
</g>
<!-- layer_7_expert_6 -->
<g id="node165" class="node">
<title>layer_7_expert_6</title>
<polygon fill="lightblue" stroke="black" points="3335,-7950.2 3075,-7950.2 3075,-7867.2 3335,-7867.2 3335,-7950.2"/>
<text text-anchor="middle" x="3205" y="-7935" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="3205" y="-7920" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3205" y="-7905" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3205" y="-7890" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3205" y="-7875" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_7_all2all&#45;&gt;layer_7_expert_6 -->
<g id="edge276" class="edge">
<title>layer_7_all2all&#45;&gt;layer_7_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3628.36,-8041.73C3550.49,-8029.65 3450.83,-8010.66 3365,-7983.2 3340.84,-7975.46 3315.53,-7965.02 3292.36,-7954.44"/>
<polygon fill="black" stroke="black" points="3293.79,-7951.25 3283.25,-7950.22 3290.85,-7957.6 3293.79,-7951.25"/>
<text text-anchor="middle" x="3456.5" y="-7972" font-family="Times,serif" font-size="14.00">tokens routed to expert 6</text>
</g>
<!-- layer_7_expert_7 -->
<g id="node166" class="node">
<title>layer_7_expert_7</title>
<polygon fill="lightblue" stroke="black" points="3613,-7950.2 3353,-7950.2 3353,-7867.2 3613,-7867.2 3613,-7950.2"/>
<text text-anchor="middle" x="3483" y="-7935" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="3483" y="-7920" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3483" y="-7905" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3483" y="-7890" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3483" y="-7875" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_7_all2all&#45;&gt;layer_7_expert_7 -->
<g id="edge277" class="edge">
<title>layer_7_all2all&#45;&gt;layer_7_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3654.06,-8021.91C3627.17,-8010.92 3598.9,-7997.85 3574,-7983.2 3560.94,-7975.51 3547.75,-7966.05 3535.63,-7956.51"/>
<polygon fill="black" stroke="black" points="3537.82,-7953.78 3527.83,-7950.25 3533.44,-7959.24 3537.82,-7953.78"/>
<text text-anchor="middle" x="3665.5" y="-7972" font-family="Times,serif" font-size="14.00">tokens routed to expert 7</text>
</g>
<!-- layer_7_expert_8 -->
<g id="node167" class="node">
<title>layer_7_expert_8</title>
<polygon fill="lightblue" stroke="black" points="3891,-7950.2 3631,-7950.2 3631,-7867.2 3891,-7867.2 3891,-7950.2"/>
<text text-anchor="middle" x="3761" y="-7935" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="3761" y="-7920" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3761" y="-7905" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3761" y="-7890" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3761" y="-7875" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_7_all2all&#45;&gt;layer_7_expert_8 -->
<g id="edge278" class="edge">
<title>layer_7_all2all&#45;&gt;layer_7_expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3761,-8000.78C3761,-7987.48 3761,-7973.44 3761,-7960.48"/>
<polygon fill="black" stroke="black" points="3764.5,-7960.35 3761,-7950.35 3757.5,-7960.35 3764.5,-7960.35"/>
<text text-anchor="middle" x="3852.5" y="-7972" font-family="Times,serif" font-size="14.00">tokens routed to expert 8</text>
</g>
<!-- layer_7_expert_9 -->
<g id="node168" class="node">
<title>layer_7_expert_9</title>
<polygon fill="lightblue" stroke="black" points="4169,-7950.2 3909,-7950.2 3909,-7867.2 4169,-7867.2 4169,-7950.2"/>
<text text-anchor="middle" x="4039" y="-7935" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="4039" y="-7920" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4039" y="-7905" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4039" y="-7890" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4039" y="-7875" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_7_all2all&#45;&gt;layer_7_expert_9 -->
<g id="edge279" class="edge">
<title>layer_7_all2all&#45;&gt;layer_7_expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3867.94,-8021.91C3894.83,-8010.92 3923.1,-7997.85 3948,-7983.2 3961.06,-7975.51 3974.25,-7966.05 3986.37,-7956.51"/>
<polygon fill="black" stroke="black" points="3988.56,-7959.24 3994.17,-7950.25 3984.18,-7953.78 3988.56,-7959.24"/>
<text text-anchor="middle" x="4060.5" y="-7972" font-family="Times,serif" font-size="14.00">tokens routed to expert 9</text>
</g>
<!-- layer_7_expert_10 -->
<g id="node169" class="node">
<title>layer_7_expert_10</title>
<polygon fill="lightblue" stroke="black" points="4447,-7950.2 4187,-7950.2 4187,-7867.2 4447,-7867.2 4447,-7950.2"/>
<text text-anchor="middle" x="4317" y="-7935" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="4317" y="-7920" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4317" y="-7905" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4317" y="-7890" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4317" y="-7875" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_7_all2all&#45;&gt;layer_7_expert_10 -->
<g id="edge280" class="edge">
<title>layer_7_all2all&#45;&gt;layer_7_expert_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3893.73,-8041.55C3971.33,-8029.43 4070.52,-8010.46 4156,-7983.2 4180.29,-7975.45 4205.75,-7965 4229.07,-7954.41"/>
<polygon fill="black" stroke="black" points="4230.61,-7957.56 4238.24,-7950.2 4227.69,-7951.2 4230.61,-7957.56"/>
<text text-anchor="middle" x="4292" y="-7972" font-family="Times,serif" font-size="14.00">tokens routed to expert 10</text>
</g>
<!-- layer_7_expert_11 -->
<g id="node170" class="node">
<title>layer_7_expert_11</title>
<polygon fill="lightblue" stroke="black" points="4725,-7950.2 4465,-7950.2 4465,-7867.2 4725,-7867.2 4725,-7950.2"/>
<text text-anchor="middle" x="4595" y="-7935" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="4595" y="-7920" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4595" y="-7905" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4595" y="-7890" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4595" y="-7875" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_7_all2all&#45;&gt;layer_7_expert_11 -->
<g id="edge281" class="edge">
<title>layer_7_all2all&#45;&gt;layer_7_expert_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3898.9,-8051.42C4027.81,-8042.31 4224.95,-8022.91 4392,-7983.2 4423.51,-7975.71 4456.87,-7964.9 4487.25,-7953.87"/>
<polygon fill="black" stroke="black" points="4488.82,-7957.02 4497,-7950.28 4486.4,-7950.45 4488.82,-7957.02"/>
<text text-anchor="middle" x="4539" y="-7972" font-family="Times,serif" font-size="14.00">tokens routed to expert 11</text>
</g>
<!-- layer_7_expert_12 -->
<g id="node171" class="node">
<title>layer_7_expert_12</title>
<polygon fill="lightblue" stroke="black" points="5003,-7950.2 4743,-7950.2 4743,-7867.2 5003,-7867.2 5003,-7950.2"/>
<text text-anchor="middle" x="4873" y="-7935" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="4873" y="-7920" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4873" y="-7905" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4873" y="-7890" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4873" y="-7875" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_7_all2all&#45;&gt;layer_7_expert_12 -->
<g id="edge282" class="edge">
<title>layer_7_all2all&#45;&gt;layer_7_expert_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3900.31,-8056.23C4074.58,-8050.78 4381.41,-8034.12 4639,-7983.2 4676.2,-7975.84 4715.83,-7964.71 4751.7,-7953.32"/>
<polygon fill="black" stroke="black" points="4752.77,-7956.65 4761.22,-7950.26 4750.63,-7949.99 4752.77,-7956.65"/>
<text text-anchor="middle" x="4793" y="-7972" font-family="Times,serif" font-size="14.00">tokens routed to expert 12</text>
</g>
<!-- layer_7_expert_13 -->
<g id="node172" class="node">
<title>layer_7_expert_13</title>
<polygon fill="lightblue" stroke="black" points="5281,-7950.2 5021,-7950.2 5021,-7867.2 5281,-7867.2 5281,-7950.2"/>
<text text-anchor="middle" x="5151" y="-7935" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="5151" y="-7920" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5151" y="-7905" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5151" y="-7890" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5151" y="-7875" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_7_all2all&#45;&gt;layer_7_expert_13 -->
<g id="edge283" class="edge">
<title>layer_7_all2all&#45;&gt;layer_7_expert_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3900.61,-8058.66C4115.38,-8056.27 4539.12,-8043.45 4893,-7983.2 4934.67,-7976.1 4979.23,-7964.8 5019.38,-7953.16"/>
<polygon fill="black" stroke="black" points="5020.61,-7956.45 5029.22,-7950.28 5018.64,-7949.73 5020.61,-7956.45"/>
<text text-anchor="middle" x="5053" y="-7972" font-family="Times,serif" font-size="14.00">tokens routed to expert 13</text>
</g>
<!-- layer_7_expert_14 -->
<g id="node173" class="node">
<title>layer_7_expert_14</title>
<polygon fill="lightblue" stroke="black" points="5559,-7950.2 5299,-7950.2 5299,-7867.2 5559,-7867.2 5559,-7950.2"/>
<text text-anchor="middle" x="5429" y="-7935" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="5429" y="-7920" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5429" y="-7905" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5429" y="-7890" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5429" y="-7875" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_7_all2all&#45;&gt;layer_7_expert_14 -->
<g id="edge284" class="edge">
<title>layer_7_all2all&#45;&gt;layer_7_expert_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3900.63,-8059.67C4152.34,-8059.22 4698.3,-8049.75 5153,-7983.2 5198.73,-7976.5 5247.74,-7964.94 5291.59,-7952.94"/>
<polygon fill="black" stroke="black" points="5292.74,-7956.25 5301.45,-7950.21 5290.87,-7949.51 5292.74,-7956.25"/>
<text text-anchor="middle" x="5325" y="-7972" font-family="Times,serif" font-size="14.00">tokens routed to expert 14</text>
</g>
<!-- layer_7_expert_15 -->
<g id="node174" class="node">
<title>layer_7_expert_15</title>
<polygon fill="lightblue" stroke="black" points="5837,-7950.2 5577,-7950.2 5577,-7867.2 5837,-7867.2 5837,-7950.2"/>
<text text-anchor="middle" x="5707" y="-7935" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="5707" y="-7920" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5707" y="-7905" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5707" y="-7890" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5707" y="-7875" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_7_all2all&#45;&gt;layer_7_expert_15 -->
<g id="edge285" class="edge">
<title>layer_7_all2all&#45;&gt;layer_7_expert_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3900.05,-8055.81C4244.75,-8047.66 5131.95,-8023.34 5425,-7983.2 5472.17,-7976.73 5522.76,-7965.09 5567.89,-7952.95"/>
<polygon fill="black" stroke="black" points="5569,-7956.28 5577.73,-7950.27 5567.16,-7949.52 5569,-7956.28"/>
<text text-anchor="middle" x="5599" y="-7972" font-family="Times,serif" font-size="14.00">tokens routed to expert 15</text>
</g>
<!-- layer_7_all2all_result -->
<g id="node175" class="node">
<title>layer_7_all2all_result</title>
<ellipse fill="yellow" stroke="black" cx="3761" cy="-7771.51" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="3761" y="-7797.81" font-family="Times,serif" font-size="14.00">Layer 7</text>
<text text-anchor="middle" x="3761" y="-7782.81" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Result Merge</text>
<text text-anchor="middle" x="3761" y="-7767.81" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="3761" y="-7752.81" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="3761" y="-7737.81" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_7_expert_0&#45;&gt;layer_7_all2all_result -->
<g id="edge286" class="edge">
<title>layer_7_expert_0&#45;&gt;layer_7_all2all_result</title>
<path fill="none" stroke="black" d="M1667,-7868.8C1670.02,-7868.23 1673.02,-7867.69 1676,-7867.2 2048.89,-7805.32 3198.76,-7781.41 3611.55,-7774.68"/>
<polygon fill="black" stroke="black" points="3611.81,-7778.17 3621.76,-7774.51 3611.7,-7771.17 3611.81,-7778.17"/>
</g>
<!-- layer_7_expert_1&#45;&gt;layer_7_all2all_result -->
<g id="edge287" class="edge">
<title>layer_7_expert_1&#45;&gt;layer_7_all2all_result</title>
<path fill="none" stroke="black" d="M1945.01,-7868.83C1948.03,-7868.25 1951.03,-7867.7 1954,-7867.2 2271.38,-7813.39 3238.71,-7785.05 3611.92,-7775.88"/>
<polygon fill="black" stroke="black" points="3612.07,-7779.38 3621.98,-7775.64 3611.9,-7772.38 3612.07,-7779.38"/>
</g>
<!-- layer_7_expert_2&#45;&gt;layer_7_all2all_result -->
<g id="edge288" class="edge">
<title>layer_7_expert_2&#45;&gt;layer_7_all2all_result</title>
<path fill="none" stroke="black" d="M2223.01,-7868.87C2226.03,-7868.27 2229.03,-7867.71 2232,-7867.2 2494.24,-7821.46 3281.24,-7789.35 3612,-7777.52"/>
<polygon fill="black" stroke="black" points="3612.26,-7781.02 3622.13,-7777.16 3612.01,-7774.02 3612.26,-7781.02"/>
</g>
<!-- layer_7_expert_3&#45;&gt;layer_7_all2all_result -->
<g id="edge289" class="edge">
<title>layer_7_expert_3&#45;&gt;layer_7_all2all_result</title>
<path fill="none" stroke="black" d="M2501.02,-7868.92C2504.04,-7868.31 2507.03,-7867.73 2510,-7867.2 2903.23,-7795.83 3375.45,-7778.12 3611.41,-7773.82"/>
<polygon fill="black" stroke="black" points="3611.49,-7777.31 3621.43,-7773.64 3611.37,-7770.32 3611.49,-7777.31"/>
</g>
<!-- layer_7_expert_4&#45;&gt;layer_7_all2all_result -->
<g id="edge290" class="edge">
<title>layer_7_expert_4&#45;&gt;layer_7_all2all_result</title>
<path fill="none" stroke="black" d="M2779.04,-7869.01C2782.05,-7868.37 2785.04,-7867.77 2788,-7867.2 3076.78,-7811.58 3420.4,-7787.87 3612.32,-7778.36"/>
<polygon fill="black" stroke="black" points="3612.66,-7781.84 3622.47,-7777.86 3612.32,-7774.85 3612.66,-7781.84"/>
</g>
<!-- layer_7_expert_5&#45;&gt;layer_7_all2all_result -->
<g id="edge291" class="edge">
<title>layer_7_expert_5&#45;&gt;layer_7_all2all_result</title>
<path fill="none" stroke="black" d="M3057.07,-7869.16C3060.07,-7868.48 3063.05,-7867.82 3066,-7867.2 3253.71,-7827.29 3473.69,-7800.63 3615.08,-7786.03"/>
<polygon fill="black" stroke="black" points="3615.53,-7789.51 3625.12,-7785 3614.81,-7782.54 3615.53,-7789.51"/>
</g>
<!-- layer_7_expert_6&#45;&gt;layer_7_all2all_result -->
<g id="edge292" class="edge">
<title>layer_7_expert_6&#45;&gt;layer_7_all2all_result</title>
<path fill="none" stroke="black" d="M3335.15,-7869.51C3338.13,-7868.73 3341.08,-7867.95 3344,-7867.2 3438.1,-7842.83 3545.02,-7818.62 3627.03,-7800.78"/>
<polygon fill="black" stroke="black" points="3627.88,-7804.18 3636.91,-7798.63 3626.39,-7797.33 3627.88,-7804.18"/>
</g>
<!-- layer_7_expert_7&#45;&gt;layer_7_all2all_result -->
<g id="edge293" class="edge">
<title>layer_7_expert_7&#45;&gt;layer_7_all2all_result</title>
<path fill="none" stroke="black" d="M3566.41,-7867.13C3596.4,-7852.55 3630.51,-7835.96 3661.72,-7820.79"/>
<polygon fill="black" stroke="black" points="3663.41,-7823.86 3670.87,-7816.34 3660.34,-7817.56 3663.41,-7823.86"/>
</g>
<!-- layer_7_expert_8&#45;&gt;layer_7_all2all_result -->
<g id="edge294" class="edge">
<title>layer_7_expert_8&#45;&gt;layer_7_all2all_result</title>
<path fill="none" stroke="black" d="M3761,-7867.13C3761,-7858.77 3761,-7849.75 3761,-7840.71"/>
<polygon fill="black" stroke="black" points="3764.5,-7840.53 3761,-7830.53 3757.5,-7840.53 3764.5,-7840.53"/>
</g>
<!-- layer_7_expert_9&#45;&gt;layer_7_all2all_result -->
<g id="edge295" class="edge">
<title>layer_7_expert_9&#45;&gt;layer_7_all2all_result</title>
<path fill="none" stroke="black" d="M3955.59,-7867.13C3925.6,-7852.55 3891.49,-7835.96 3860.28,-7820.79"/>
<polygon fill="black" stroke="black" points="3861.66,-7817.56 3851.13,-7816.34 3858.59,-7823.86 3861.66,-7817.56"/>
</g>
<!-- layer_7_expert_10&#45;&gt;layer_7_all2all_result -->
<g id="edge296" class="edge">
<title>layer_7_expert_10&#45;&gt;layer_7_all2all_result</title>
<path fill="none" stroke="black" d="M4186.85,-7869.51C4183.87,-7868.73 4180.92,-7867.95 4178,-7867.2 4083.9,-7842.83 3976.98,-7818.62 3894.97,-7800.78"/>
<polygon fill="black" stroke="black" points="3895.61,-7797.33 3885.09,-7798.63 3894.12,-7804.18 3895.61,-7797.33"/>
</g>
<!-- layer_7_expert_11&#45;&gt;layer_7_all2all_result -->
<g id="edge297" class="edge">
<title>layer_7_expert_11&#45;&gt;layer_7_all2all_result</title>
<path fill="none" stroke="black" d="M4464.93,-7869.16C4461.93,-7868.48 4458.95,-7867.82 4456,-7867.2 4268.29,-7827.29 4048.31,-7800.63 3906.92,-7786.03"/>
<polygon fill="black" stroke="black" points="3907.19,-7782.54 3896.88,-7785 3906.47,-7789.51 3907.19,-7782.54"/>
</g>
<!-- layer_7_expert_12&#45;&gt;layer_7_all2all_result -->
<g id="edge298" class="edge">
<title>layer_7_expert_12&#45;&gt;layer_7_all2all_result</title>
<path fill="none" stroke="black" d="M4742.96,-7869.01C4739.95,-7868.37 4736.96,-7867.77 4734,-7867.2 4445.22,-7811.58 4101.6,-7787.87 3909.68,-7778.36"/>
<polygon fill="black" stroke="black" points="3909.68,-7774.85 3899.53,-7777.86 3909.34,-7781.84 3909.68,-7774.85"/>
</g>
<!-- layer_7_expert_13&#45;&gt;layer_7_all2all_result -->
<g id="edge299" class="edge">
<title>layer_7_expert_13&#45;&gt;layer_7_all2all_result</title>
<path fill="none" stroke="black" d="M5020.98,-7868.92C5017.96,-7868.31 5014.97,-7867.73 5012,-7867.2 4618.77,-7795.83 4146.55,-7778.12 3910.59,-7773.82"/>
<polygon fill="black" stroke="black" points="3910.63,-7770.32 3900.57,-7773.64 3910.51,-7777.31 3910.63,-7770.32"/>
</g>
<!-- layer_7_expert_14&#45;&gt;layer_7_all2all_result -->
<g id="edge300" class="edge">
<title>layer_7_expert_14&#45;&gt;layer_7_all2all_result</title>
<path fill="none" stroke="black" d="M5298.99,-7868.87C5295.97,-7868.27 5292.97,-7867.71 5290,-7867.2 5027.76,-7821.46 4240.76,-7789.35 3910,-7777.52"/>
<polygon fill="black" stroke="black" points="3909.99,-7774.02 3899.87,-7777.16 3909.74,-7781.02 3909.99,-7774.02"/>
</g>
<!-- layer_7_expert_15&#45;&gt;layer_7_all2all_result -->
<g id="edge301" class="edge">
<title>layer_7_expert_15&#45;&gt;layer_7_all2all_result</title>
<path fill="none" stroke="black" d="M5576.99,-7868.83C5573.97,-7868.25 5570.97,-7867.7 5568,-7867.2 5250.62,-7813.39 4283.29,-7785.05 3910.08,-7775.88"/>
<polygon fill="black" stroke="black" points="3910.1,-7772.38 3900.02,-7775.64 3909.93,-7779.38 3910.1,-7772.38"/>
</g>
<!-- layer_7_expert_agg -->
<g id="node176" class="node">
<title>layer_7_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="5355,-7675.82 5107,-7675.82 5107,-7592.82 5355,-7592.82 5355,-7675.82"/>
<text text-anchor="middle" x="5231" y="-7660.62" font-family="Times,serif" font-size="14.00">Layer 7</text>
<text text-anchor="middle" x="5231" y="-7645.62" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="5231" y="-7630.62" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5231" y="-7615.62" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="5231" y="-7600.62" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_7_all2all_result&#45;&gt;layer_7_expert_agg -->
<g id="edge302" class="edge">
<title>layer_7_all2all_result&#45;&gt;layer_7_expert_agg</title>
<path fill="none" stroke="black" d="M3896.66,-7758.03C4177.06,-7732.24 4817.53,-7673.34 5096.73,-7647.66"/>
<polygon fill="black" stroke="black" points="5097.28,-7651.13 5106.92,-7646.73 5096.64,-7644.16 5097.28,-7651.13"/>
</g>
<!-- layer_7_expert_agg&#45;&gt;layer_7_residual -->
<g id="edge304" class="edge">
<title>layer_7_expert_agg&#45;&gt;layer_7_residual</title>
<path fill="none" stroke="black" d="M5355.21,-7607.42C5433.7,-7591.06 5536.29,-7569.67 5622.85,-7551.62"/>
<polygon fill="black" stroke="black" points="5623.7,-7555.02 5632.78,-7549.55 5622.28,-7548.17 5623.7,-7555.02"/>
</g>
<!-- layer_8_mha -->
<g id="node178" class="node">
<title>layer_8_mha</title>
<polygon fill="lightblue" stroke="black" points="5898.5,-7435.82 5695.5,-7435.82 5695.5,-7352.82 5898.5,-7352.82 5898.5,-7435.82"/>
<text text-anchor="middle" x="5797" y="-7420.62" font-family="Times,serif" font-size="14.00">Layer 8</text>
<text text-anchor="middle" x="5797" y="-7405.62" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="5797" y="-7390.62" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5797" y="-7375.62" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="5797" y="-7360.62" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_7_residual&#45;&gt;layer_8_mha -->
<g id="edge305" class="edge">
<title>layer_7_residual&#45;&gt;layer_8_mha</title>
<path fill="none" stroke="black" d="M5797,-7472.71C5797,-7464.18 5797,-7455.08 5797,-7446.23"/>
<polygon fill="black" stroke="black" points="5800.5,-7446 5797,-7436 5793.5,-7446 5800.5,-7446"/>
</g>
<!-- layer_8_gate -->
<g id="node179" class="node">
<title>layer_8_gate</title>
<polygon fill="lightblue" stroke="black" points="5584.5,-7315.82 5385.5,-7315.82 5385.5,-7232.82 5584.5,-7232.82 5584.5,-7315.82"/>
<text text-anchor="middle" x="5485" y="-7300.62" font-family="Times,serif" font-size="14.00">Layer 8</text>
<text text-anchor="middle" x="5485" y="-7285.62" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="5485" y="-7270.62" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5485" y="-7255.62" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="5485" y="-7240.62" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_8_mha&#45;&gt;layer_8_gate -->
<g id="edge306" class="edge">
<title>layer_8_mha&#45;&gt;layer_8_gate</title>
<path fill="none" stroke="black" d="M5695.27,-7354.84C5662.98,-7342.63 5627.15,-7329.08 5594.35,-7316.67"/>
<polygon fill="black" stroke="black" points="5595.32,-7313.3 5584.73,-7313.03 5592.84,-7319.84 5595.32,-7313.3"/>
</g>
<!-- layer_8_residual -->
<g id="node199" class="node">
<title>layer_8_residual</title>
<polygon fill="lightblue" stroke="black" points="6197,-6633.06 5869,-6633.06 5869,-6550.06 6197,-6550.06 6197,-6633.06"/>
<text text-anchor="middle" x="6033" y="-6617.86" font-family="Times,serif" font-size="14.00">Layer 8</text>
<text text-anchor="middle" x="6033" y="-6602.86" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="6033" y="-6587.86" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="6033" y="-6572.86" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="6033" y="-6557.86" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_8_mha&#45;&gt;layer_8_residual -->
<g id="edge341" class="edge">
<title>layer_8_mha&#45;&gt;layer_8_residual</title>
<path fill="none" stroke="black" d="M5898.73,-7374.88C5989.78,-7355.4 6109,-7321.14 6109,-7275.32 6109,-7275.32 6109,-7275.32 6109,-6710.56 6109,-6685.18 6096.42,-6660.92 6081.5,-6641.07"/>
<polygon fill="black" stroke="black" points="6084.17,-6638.8 6075.22,-6633.12 6078.67,-6643.14 6084.17,-6638.8"/>
<text text-anchor="middle" x="6137" y="-6982.24" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_8_all2all -->
<g id="node180" class="node">
<title>layer_8_all2all</title>
<ellipse fill="yellow" stroke="black" cx="3997" cy="-7137.13" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="3997" y="-7163.43" font-family="Times,serif" font-size="14.00">Layer 8</text>
<text text-anchor="middle" x="3997" y="-7148.43" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="3997" y="-7133.43" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="3997" y="-7118.43" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="3997" y="-7103.43" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_8_gate&#45;&gt;layer_8_all2all -->
<g id="edge307" class="edge">
<title>layer_8_gate&#45;&gt;layer_8_all2all</title>
<path fill="none" stroke="black" d="M5385.35,-7264.26C5128.76,-7240.95 4444.46,-7178.78 4143.03,-7151.39"/>
<polygon fill="black" stroke="black" points="4143.18,-7147.89 4132.91,-7150.47 4142.55,-7154.86 4143.18,-7147.89"/>
</g>
<!-- layer_8_expert_0 -->
<g id="node181" class="node">
<title>layer_8_expert_0</title>
<polygon fill="lightblue" stroke="black" points="1903,-7027.44 1643,-7027.44 1643,-6944.44 1903,-6944.44 1903,-7027.44"/>
<text text-anchor="middle" x="1773" y="-7012.24" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1773" y="-6997.24" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="1773" y="-6982.24" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1773" y="-6967.24" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="1773" y="-6952.24" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_8_all2all&#45;&gt;layer_8_expert_0 -->
<g id="edge308" class="edge">
<title>layer_8_all2all&#45;&gt;layer_8_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3857.71,-7133.33C3477.55,-7125.27 2427.72,-7099.98 2084,-7060.44 2009.84,-7051.9 1989.33,-7046.16 1913.2,-7027.69"/>
<polygon fill="black" stroke="black" points="1913.66,-7024.2 1903.12,-7025.25 1912.02,-7031.01 1913.66,-7024.2"/>
<text text-anchor="middle" x="2175.5" y="-7049.24" font-family="Times,serif" font-size="14.00">tokens routed to expert 0</text>
</g>
<!-- layer_8_expert_1 -->
<g id="node182" class="node">
<title>layer_8_expert_1</title>
<polygon fill="lightblue" stroke="black" points="2181,-7027.44 1921,-7027.44 1921,-6944.44 2181,-6944.44 2181,-7027.44"/>
<text text-anchor="middle" x="2051" y="-7012.24" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2051" y="-6997.24" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2051" y="-6982.24" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2051" y="-6967.24" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2051" y="-6952.24" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_8_all2all&#45;&gt;layer_8_expert_1 -->
<g id="edge309" class="edge">
<title>layer_8_all2all&#45;&gt;layer_8_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3857.56,-7136.73C3573.78,-7136.42 2909.12,-7127.78 2356,-7060.44 2301.4,-7053.79 2242.41,-7040.95 2190.99,-7027.83"/>
<polygon fill="black" stroke="black" points="2191.71,-7024.4 2181.15,-7025.3 2189.96,-7031.18 2191.71,-7024.4"/>
<text text-anchor="middle" x="2447.5" y="-7049.24" font-family="Times,serif" font-size="14.00">tokens routed to expert 1</text>
</g>
<!-- layer_8_expert_2 -->
<g id="node183" class="node">
<title>layer_8_expert_2</title>
<polygon fill="lightblue" stroke="black" points="2459,-7027.44 2199,-7027.44 2199,-6944.44 2459,-6944.44 2459,-7027.44"/>
<text text-anchor="middle" x="2329" y="-7012.24" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2329" y="-6997.24" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2329" y="-6982.24" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2329" y="-6967.24" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2329" y="-6952.24" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_8_all2all&#45;&gt;layer_8_expert_2 -->
<g id="edge310" class="edge">
<title>layer_8_all2all&#45;&gt;layer_8_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3857.7,-7135.35C3609.22,-7132.44 3073.6,-7119.19 2626,-7060.44 2574.03,-7053.61 2518,-7041.13 2468.76,-7028.37"/>
<polygon fill="black" stroke="black" points="2469.57,-7024.96 2459.01,-7025.81 2467.8,-7031.73 2469.57,-7024.96"/>
<text text-anchor="middle" x="2717.5" y="-7049.24" font-family="Times,serif" font-size="14.00">tokens routed to expert 2</text>
</g>
<!-- layer_8_expert_3 -->
<g id="node184" class="node">
<title>layer_8_expert_3</title>
<polygon fill="lightblue" stroke="black" points="2737,-7027.44 2477,-7027.44 2477,-6944.44 2737,-6944.44 2737,-7027.44"/>
<text text-anchor="middle" x="2607" y="-7012.24" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2607" y="-6997.24" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2607" y="-6982.24" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2607" y="-6967.24" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2607" y="-6952.24" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_8_all2all&#45;&gt;layer_8_expert_3 -->
<g id="edge311" class="edge">
<title>layer_8_all2all&#45;&gt;layer_8_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3857.67,-7134.18C3645.95,-7129.53 3231.01,-7113.78 2883,-7060.44 2837.77,-7053.5 2789.29,-7042.02 2745.78,-7030.17"/>
<polygon fill="black" stroke="black" points="2746.57,-7026.75 2736,-7027.47 2744.71,-7033.5 2746.57,-7026.75"/>
<text text-anchor="middle" x="2974.5" y="-7049.24" font-family="Times,serif" font-size="14.00">tokens routed to expert 3</text>
</g>
<!-- layer_8_expert_4 -->
<g id="node185" class="node">
<title>layer_8_expert_4</title>
<polygon fill="lightblue" stroke="black" points="3015,-7027.44 2755,-7027.44 2755,-6944.44 3015,-6944.44 3015,-7027.44"/>
<text text-anchor="middle" x="2885" y="-7012.24" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="2885" y="-6997.24" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2885" y="-6982.24" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2885" y="-6967.24" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2885" y="-6952.24" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_8_all2all&#45;&gt;layer_8_expert_4 -->
<g id="edge312" class="edge">
<title>layer_8_all2all&#45;&gt;layer_8_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3857.78,-7132.51C3686.04,-7126.1 3385.77,-7108.46 3133,-7060.44 3093.65,-7052.96 3051.62,-7041.77 3013.55,-7030.37"/>
<polygon fill="black" stroke="black" points="3014.54,-7027.01 3003.96,-7027.46 3012.51,-7033.71 3014.54,-7027.01"/>
<text text-anchor="middle" x="3224.5" y="-7049.24" font-family="Times,serif" font-size="14.00">tokens routed to expert 4</text>
</g>
<!-- layer_8_expert_5 -->
<g id="node186" class="node">
<title>layer_8_expert_5</title>
<polygon fill="lightblue" stroke="black" points="3293,-7027.44 3033,-7027.44 3033,-6944.44 3293,-6944.44 3293,-7027.44"/>
<text text-anchor="middle" x="3163" y="-7012.24" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="3163" y="-6997.24" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3163" y="-6982.24" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3163" y="-6967.24" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3163" y="-6952.24" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_8_all2all&#45;&gt;layer_8_expert_5 -->
<g id="edge313" class="edge">
<title>layer_8_all2all&#45;&gt;layer_8_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3859.18,-7127.98C3731.75,-7118.44 3537.74,-7098.78 3373,-7060.44 3340.44,-7052.86 3305.89,-7042 3274.43,-7030.95"/>
<polygon fill="black" stroke="black" points="3275.36,-7027.57 3264.76,-7027.52 3273.02,-7034.17 3275.36,-7027.57"/>
<text text-anchor="middle" x="3464.5" y="-7049.24" font-family="Times,serif" font-size="14.00">tokens routed to expert 5</text>
</g>
<!-- layer_8_expert_6 -->
<g id="node187" class="node">
<title>layer_8_expert_6</title>
<polygon fill="lightblue" stroke="black" points="3571,-7027.44 3311,-7027.44 3311,-6944.44 3571,-6944.44 3571,-7027.44"/>
<text text-anchor="middle" x="3441" y="-7012.24" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="3441" y="-6997.24" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3441" y="-6982.24" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3441" y="-6967.24" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3441" y="-6952.24" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_8_all2all&#45;&gt;layer_8_expert_6 -->
<g id="edge314" class="edge">
<title>layer_8_all2all&#45;&gt;layer_8_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3864.36,-7118.97C3786.49,-7106.89 3686.83,-7087.9 3601,-7060.44 3576.84,-7052.7 3551.53,-7042.26 3528.36,-7031.68"/>
<polygon fill="black" stroke="black" points="3529.79,-7028.49 3519.25,-7027.46 3526.85,-7034.84 3529.79,-7028.49"/>
<text text-anchor="middle" x="3692.5" y="-7049.24" font-family="Times,serif" font-size="14.00">tokens routed to expert 6</text>
</g>
<!-- layer_8_expert_7 -->
<g id="node188" class="node">
<title>layer_8_expert_7</title>
<polygon fill="lightblue" stroke="black" points="3849,-7027.44 3589,-7027.44 3589,-6944.44 3849,-6944.44 3849,-7027.44"/>
<text text-anchor="middle" x="3719" y="-7012.24" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="3719" y="-6997.24" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3719" y="-6982.24" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3719" y="-6967.24" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3719" y="-6952.24" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_8_all2all&#45;&gt;layer_8_expert_7 -->
<g id="edge315" class="edge">
<title>layer_8_all2all&#45;&gt;layer_8_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3890.06,-7099.15C3863.17,-7088.16 3834.9,-7075.09 3810,-7060.44 3796.94,-7052.75 3783.75,-7043.29 3771.63,-7033.75"/>
<polygon fill="black" stroke="black" points="3773.82,-7031.02 3763.83,-7027.49 3769.44,-7036.48 3773.82,-7031.02"/>
<text text-anchor="middle" x="3901.5" y="-7049.24" font-family="Times,serif" font-size="14.00">tokens routed to expert 7</text>
</g>
<!-- layer_8_expert_8 -->
<g id="node189" class="node">
<title>layer_8_expert_8</title>
<polygon fill="lightblue" stroke="black" points="4127,-7027.44 3867,-7027.44 3867,-6944.44 4127,-6944.44 4127,-7027.44"/>
<text text-anchor="middle" x="3997" y="-7012.24" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="3997" y="-6997.24" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3997" y="-6982.24" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3997" y="-6967.24" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3997" y="-6952.24" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_8_all2all&#45;&gt;layer_8_expert_8 -->
<g id="edge316" class="edge">
<title>layer_8_all2all&#45;&gt;layer_8_expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3997,-7078.02C3997,-7064.72 3997,-7050.68 3997,-7037.72"/>
<polygon fill="black" stroke="black" points="4000.5,-7037.59 3997,-7027.59 3993.5,-7037.59 4000.5,-7037.59"/>
<text text-anchor="middle" x="4088.5" y="-7049.24" font-family="Times,serif" font-size="14.00">tokens routed to expert 8</text>
</g>
<!-- layer_8_expert_9 -->
<g id="node190" class="node">
<title>layer_8_expert_9</title>
<polygon fill="lightblue" stroke="black" points="4405,-7027.44 4145,-7027.44 4145,-6944.44 4405,-6944.44 4405,-7027.44"/>
<text text-anchor="middle" x="4275" y="-7012.24" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="4275" y="-6997.24" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4275" y="-6982.24" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4275" y="-6967.24" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4275" y="-6952.24" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_8_all2all&#45;&gt;layer_8_expert_9 -->
<g id="edge317" class="edge">
<title>layer_8_all2all&#45;&gt;layer_8_expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4103.94,-7099.15C4130.83,-7088.16 4159.1,-7075.09 4184,-7060.44 4197.06,-7052.75 4210.25,-7043.29 4222.37,-7033.75"/>
<polygon fill="black" stroke="black" points="4224.56,-7036.48 4230.17,-7027.49 4220.18,-7031.02 4224.56,-7036.48"/>
<text text-anchor="middle" x="4296.5" y="-7049.24" font-family="Times,serif" font-size="14.00">tokens routed to expert 9</text>
</g>
<!-- layer_8_expert_10 -->
<g id="node191" class="node">
<title>layer_8_expert_10</title>
<polygon fill="lightblue" stroke="black" points="4683,-7027.44 4423,-7027.44 4423,-6944.44 4683,-6944.44 4683,-7027.44"/>
<text text-anchor="middle" x="4553" y="-7012.24" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="4553" y="-6997.24" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4553" y="-6982.24" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4553" y="-6967.24" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4553" y="-6952.24" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_8_all2all&#45;&gt;layer_8_expert_10 -->
<g id="edge318" class="edge">
<title>layer_8_all2all&#45;&gt;layer_8_expert_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4129.73,-7118.79C4207.33,-7106.67 4306.52,-7087.7 4392,-7060.44 4416.29,-7052.69 4441.75,-7042.24 4465.07,-7031.65"/>
<polygon fill="black" stroke="black" points="4466.61,-7034.8 4474.24,-7027.44 4463.69,-7028.44 4466.61,-7034.8"/>
<text text-anchor="middle" x="4528" y="-7049.24" font-family="Times,serif" font-size="14.00">tokens routed to expert 10</text>
</g>
<!-- layer_8_expert_11 -->
<g id="node192" class="node">
<title>layer_8_expert_11</title>
<polygon fill="lightblue" stroke="black" points="4961,-7027.44 4701,-7027.44 4701,-6944.44 4961,-6944.44 4961,-7027.44"/>
<text text-anchor="middle" x="4831" y="-7012.24" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="4831" y="-6997.24" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4831" y="-6982.24" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4831" y="-6967.24" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4831" y="-6952.24" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_8_all2all&#45;&gt;layer_8_expert_11 -->
<g id="edge319" class="edge">
<title>layer_8_all2all&#45;&gt;layer_8_expert_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4134.9,-7128.66C4263.81,-7119.55 4460.95,-7100.15 4628,-7060.44 4659.51,-7052.95 4692.87,-7042.14 4723.25,-7031.11"/>
<polygon fill="black" stroke="black" points="4724.82,-7034.26 4733,-7027.52 4722.4,-7027.69 4724.82,-7034.26"/>
<text text-anchor="middle" x="4775" y="-7049.24" font-family="Times,serif" font-size="14.00">tokens routed to expert 11</text>
</g>
<!-- layer_8_expert_12 -->
<g id="node193" class="node">
<title>layer_8_expert_12</title>
<polygon fill="lightblue" stroke="black" points="5239,-7027.44 4979,-7027.44 4979,-6944.44 5239,-6944.44 5239,-7027.44"/>
<text text-anchor="middle" x="5109" y="-7012.24" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="5109" y="-6997.24" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5109" y="-6982.24" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5109" y="-6967.24" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5109" y="-6952.24" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_8_all2all&#45;&gt;layer_8_expert_12 -->
<g id="edge320" class="edge">
<title>layer_8_all2all&#45;&gt;layer_8_expert_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4136.31,-7133.47C4310.58,-7128.02 4617.41,-7111.36 4875,-7060.44 4912.2,-7053.08 4951.83,-7041.95 4987.7,-7030.56"/>
<polygon fill="black" stroke="black" points="4988.77,-7033.89 4997.22,-7027.51 4986.63,-7027.23 4988.77,-7033.89"/>
<text text-anchor="middle" x="5029" y="-7049.24" font-family="Times,serif" font-size="14.00">tokens routed to expert 12</text>
</g>
<!-- layer_8_expert_13 -->
<g id="node194" class="node">
<title>layer_8_expert_13</title>
<polygon fill="lightblue" stroke="black" points="5517,-7027.44 5257,-7027.44 5257,-6944.44 5517,-6944.44 5517,-7027.44"/>
<text text-anchor="middle" x="5387" y="-7012.24" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="5387" y="-6997.24" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5387" y="-6982.24" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5387" y="-6967.24" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5387" y="-6952.24" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_8_all2all&#45;&gt;layer_8_expert_13 -->
<g id="edge321" class="edge">
<title>layer_8_all2all&#45;&gt;layer_8_expert_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4136.61,-7135.9C4351.38,-7133.51 4775.12,-7120.69 5129,-7060.44 5170.67,-7053.34 5215.23,-7042.04 5255.38,-7030.4"/>
<polygon fill="black" stroke="black" points="5256.61,-7033.69 5265.22,-7027.52 5254.64,-7026.97 5256.61,-7033.69"/>
<text text-anchor="middle" x="5289" y="-7049.24" font-family="Times,serif" font-size="14.00">tokens routed to expert 13</text>
</g>
<!-- layer_8_expert_14 -->
<g id="node195" class="node">
<title>layer_8_expert_14</title>
<polygon fill="lightblue" stroke="black" points="5795,-7027.44 5535,-7027.44 5535,-6944.44 5795,-6944.44 5795,-7027.44"/>
<text text-anchor="middle" x="5665" y="-7012.24" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="5665" y="-6997.24" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5665" y="-6982.24" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5665" y="-6967.24" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5665" y="-6952.24" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_8_all2all&#45;&gt;layer_8_expert_14 -->
<g id="edge322" class="edge">
<title>layer_8_all2all&#45;&gt;layer_8_expert_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4136.63,-7136.91C4388.34,-7136.46 4934.3,-7126.99 5389,-7060.44 5434.73,-7053.74 5483.74,-7042.18 5527.59,-7030.18"/>
<polygon fill="black" stroke="black" points="5528.74,-7033.5 5537.45,-7027.45 5526.87,-7026.75 5528.74,-7033.5"/>
<text text-anchor="middle" x="5561" y="-7049.24" font-family="Times,serif" font-size="14.00">tokens routed to expert 14</text>
</g>
<!-- layer_8_expert_15 -->
<g id="node196" class="node">
<title>layer_8_expert_15</title>
<polygon fill="lightblue" stroke="black" points="6073,-7027.44 5813,-7027.44 5813,-6944.44 6073,-6944.44 6073,-7027.44"/>
<text text-anchor="middle" x="5943" y="-7012.24" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="5943" y="-6997.24" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5943" y="-6982.24" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5943" y="-6967.24" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5943" y="-6952.24" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_8_all2all&#45;&gt;layer_8_expert_15 -->
<g id="edge323" class="edge">
<title>layer_8_all2all&#45;&gt;layer_8_expert_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4136.05,-7133.05C4480.75,-7124.9 5367.95,-7100.58 5661,-7060.44 5708.17,-7053.98 5758.76,-7042.33 5803.89,-7030.19"/>
<polygon fill="black" stroke="black" points="5805,-7033.52 5813.73,-7027.51 5803.16,-7026.76 5805,-7033.52"/>
<text text-anchor="middle" x="5835" y="-7049.24" font-family="Times,serif" font-size="14.00">tokens routed to expert 15</text>
</g>
<!-- layer_8_all2all_result -->
<g id="node197" class="node">
<title>layer_8_all2all_result</title>
<ellipse fill="yellow" stroke="black" cx="3997" cy="-6848.75" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="3997" y="-6875.05" font-family="Times,serif" font-size="14.00">Layer 8</text>
<text text-anchor="middle" x="3997" y="-6860.05" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Result Merge</text>
<text text-anchor="middle" x="3997" y="-6845.05" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="3997" y="-6830.05" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="3997" y="-6815.05" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_8_expert_0&#45;&gt;layer_8_all2all_result -->
<g id="edge324" class="edge">
<title>layer_8_expert_0&#45;&gt;layer_8_all2all_result</title>
<path fill="none" stroke="black" d="M1903,-6946.04C1906.02,-6945.47 1909.02,-6944.93 1912,-6944.44 2284.89,-6882.56 3434.76,-6858.65 3847.55,-6851.92"/>
<polygon fill="black" stroke="black" points="3847.81,-6855.41 3857.76,-6851.75 3847.7,-6848.41 3847.81,-6855.41"/>
</g>
<!-- layer_8_expert_1&#45;&gt;layer_8_all2all_result -->
<g id="edge325" class="edge">
<title>layer_8_expert_1&#45;&gt;layer_8_all2all_result</title>
<path fill="none" stroke="black" d="M2181.01,-6946.07C2184.03,-6945.49 2187.03,-6944.94 2190,-6944.44 2507.38,-6890.63 3474.71,-6862.29 3847.92,-6853.12"/>
<polygon fill="black" stroke="black" points="3848.07,-6856.62 3857.98,-6852.88 3847.9,-6849.62 3848.07,-6856.62"/>
</g>
<!-- layer_8_expert_2&#45;&gt;layer_8_all2all_result -->
<g id="edge326" class="edge">
<title>layer_8_expert_2&#45;&gt;layer_8_all2all_result</title>
<path fill="none" stroke="black" d="M2459.01,-6946.11C2462.03,-6945.51 2465.03,-6944.95 2468,-6944.44 2730.24,-6898.7 3517.24,-6866.59 3848,-6854.77"/>
<polygon fill="black" stroke="black" points="3848.26,-6858.26 3858.13,-6854.4 3848.01,-6851.26 3848.26,-6858.26"/>
</g>
<!-- layer_8_expert_3&#45;&gt;layer_8_all2all_result -->
<g id="edge327" class="edge">
<title>layer_8_expert_3&#45;&gt;layer_8_all2all_result</title>
<path fill="none" stroke="black" d="M2737.02,-6946.16C2740.04,-6945.55 2743.03,-6944.97 2746,-6944.44 3139.23,-6873.07 3611.45,-6855.36 3847.41,-6851.06"/>
<polygon fill="black" stroke="black" points="3847.49,-6854.56 3857.43,-6850.88 3847.37,-6847.56 3847.49,-6854.56"/>
</g>
<!-- layer_8_expert_4&#45;&gt;layer_8_all2all_result -->
<g id="edge328" class="edge">
<title>layer_8_expert_4&#45;&gt;layer_8_all2all_result</title>
<path fill="none" stroke="black" d="M3015.04,-6946.25C3018.05,-6945.61 3021.04,-6945.01 3024,-6944.44 3312.78,-6888.82 3656.4,-6865.11 3848.32,-6855.6"/>
<polygon fill="black" stroke="black" points="3848.66,-6859.08 3858.47,-6855.1 3848.32,-6852.09 3848.66,-6859.08"/>
</g>
<!-- layer_8_expert_5&#45;&gt;layer_8_all2all_result -->
<g id="edge329" class="edge">
<title>layer_8_expert_5&#45;&gt;layer_8_all2all_result</title>
<path fill="none" stroke="black" d="M3293.07,-6946.4C3296.07,-6945.72 3299.05,-6945.06 3302,-6944.44 3489.71,-6904.53 3709.69,-6877.87 3851.08,-6863.28"/>
<polygon fill="black" stroke="black" points="3851.53,-6866.75 3861.12,-6862.25 3850.81,-6859.78 3851.53,-6866.75"/>
</g>
<!-- layer_8_expert_6&#45;&gt;layer_8_all2all_result -->
<g id="edge330" class="edge">
<title>layer_8_expert_6&#45;&gt;layer_8_all2all_result</title>
<path fill="none" stroke="black" d="M3571.15,-6946.76C3574.13,-6945.97 3577.08,-6945.19 3580,-6944.44 3674.1,-6920.07 3781.02,-6895.86 3863.03,-6878.02"/>
<polygon fill="black" stroke="black" points="3863.88,-6881.42 3872.91,-6875.87 3862.39,-6874.57 3863.88,-6881.42"/>
</g>
<!-- layer_8_expert_7&#45;&gt;layer_8_all2all_result -->
<g id="edge331" class="edge">
<title>layer_8_expert_7&#45;&gt;layer_8_all2all_result</title>
<path fill="none" stroke="black" d="M3802.41,-6944.37C3832.4,-6929.79 3866.51,-6913.2 3897.72,-6898.03"/>
<polygon fill="black" stroke="black" points="3899.41,-6901.1 3906.87,-6893.58 3896.34,-6894.8 3899.41,-6901.1"/>
</g>
<!-- layer_8_expert_8&#45;&gt;layer_8_all2all_result -->
<g id="edge332" class="edge">
<title>layer_8_expert_8&#45;&gt;layer_8_all2all_result</title>
<path fill="none" stroke="black" d="M3997,-6944.37C3997,-6936.01 3997,-6926.99 3997,-6917.95"/>
<polygon fill="black" stroke="black" points="4000.5,-6917.77 3997,-6907.77 3993.5,-6917.77 4000.5,-6917.77"/>
</g>
<!-- layer_8_expert_9&#45;&gt;layer_8_all2all_result -->
<g id="edge333" class="edge">
<title>layer_8_expert_9&#45;&gt;layer_8_all2all_result</title>
<path fill="none" stroke="black" d="M4191.59,-6944.37C4161.6,-6929.79 4127.49,-6913.2 4096.28,-6898.03"/>
<polygon fill="black" stroke="black" points="4097.66,-6894.8 4087.13,-6893.58 4094.59,-6901.1 4097.66,-6894.8"/>
</g>
<!-- layer_8_expert_10&#45;&gt;layer_8_all2all_result -->
<g id="edge334" class="edge">
<title>layer_8_expert_10&#45;&gt;layer_8_all2all_result</title>
<path fill="none" stroke="black" d="M4422.85,-6946.76C4419.87,-6945.97 4416.92,-6945.19 4414,-6944.44 4319.9,-6920.07 4212.98,-6895.86 4130.97,-6878.02"/>
<polygon fill="black" stroke="black" points="4131.61,-6874.57 4121.09,-6875.87 4130.12,-6881.42 4131.61,-6874.57"/>
</g>
<!-- layer_8_expert_11&#45;&gt;layer_8_all2all_result -->
<g id="edge335" class="edge">
<title>layer_8_expert_11&#45;&gt;layer_8_all2all_result</title>
<path fill="none" stroke="black" d="M4700.93,-6946.4C4697.93,-6945.72 4694.95,-6945.06 4692,-6944.44 4504.29,-6904.53 4284.31,-6877.87 4142.92,-6863.28"/>
<polygon fill="black" stroke="black" points="4143.19,-6859.78 4132.88,-6862.25 4142.47,-6866.75 4143.19,-6859.78"/>
</g>
<!-- layer_8_expert_12&#45;&gt;layer_8_all2all_result -->
<g id="edge336" class="edge">
<title>layer_8_expert_12&#45;&gt;layer_8_all2all_result</title>
<path fill="none" stroke="black" d="M4978.96,-6946.25C4975.95,-6945.61 4972.96,-6945.01 4970,-6944.44 4681.22,-6888.82 4337.6,-6865.11 4145.68,-6855.6"/>
<polygon fill="black" stroke="black" points="4145.68,-6852.09 4135.53,-6855.1 4145.34,-6859.08 4145.68,-6852.09"/>
</g>
<!-- layer_8_expert_13&#45;&gt;layer_8_all2all_result -->
<g id="edge337" class="edge">
<title>layer_8_expert_13&#45;&gt;layer_8_all2all_result</title>
<path fill="none" stroke="black" d="M5256.98,-6946.16C5253.96,-6945.55 5250.97,-6944.97 5248,-6944.44 4854.77,-6873.07 4382.55,-6855.36 4146.59,-6851.06"/>
<polygon fill="black" stroke="black" points="4146.63,-6847.56 4136.57,-6850.88 4146.51,-6854.56 4146.63,-6847.56"/>
</g>
<!-- layer_8_expert_14&#45;&gt;layer_8_all2all_result -->
<g id="edge338" class="edge">
<title>layer_8_expert_14&#45;&gt;layer_8_all2all_result</title>
<path fill="none" stroke="black" d="M5534.99,-6946.11C5531.97,-6945.51 5528.97,-6944.95 5526,-6944.44 5263.76,-6898.7 4476.76,-6866.59 4146,-6854.77"/>
<polygon fill="black" stroke="black" points="4145.99,-6851.26 4135.87,-6854.4 4145.74,-6858.26 4145.99,-6851.26"/>
</g>
<!-- layer_8_expert_15&#45;&gt;layer_8_all2all_result -->
<g id="edge339" class="edge">
<title>layer_8_expert_15&#45;&gt;layer_8_all2all_result</title>
<path fill="none" stroke="black" d="M5812.99,-6946.07C5809.97,-6945.49 5806.97,-6944.94 5804,-6944.44 5486.62,-6890.63 4519.29,-6862.29 4146.08,-6853.12"/>
<polygon fill="black" stroke="black" points="4146.1,-6849.62 4136.02,-6852.88 4145.93,-6856.62 4146.1,-6849.62"/>
</g>
<!-- layer_8_expert_agg -->
<g id="node198" class="node">
<title>layer_8_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="5591,-6753.06 5343,-6753.06 5343,-6670.06 5591,-6670.06 5591,-6753.06"/>
<text text-anchor="middle" x="5467" y="-6737.86" font-family="Times,serif" font-size="14.00">Layer 8</text>
<text text-anchor="middle" x="5467" y="-6722.86" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="5467" y="-6707.86" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5467" y="-6692.86" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="5467" y="-6677.86" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_8_all2all_result&#45;&gt;layer_8_expert_agg -->
<g id="edge340" class="edge">
<title>layer_8_all2all_result&#45;&gt;layer_8_expert_agg</title>
<path fill="none" stroke="black" d="M4132.66,-6835.27C4413.06,-6809.48 5053.53,-6750.58 5332.73,-6724.9"/>
<polygon fill="black" stroke="black" points="5333.28,-6728.37 5342.92,-6723.97 5332.64,-6721.4 5333.28,-6728.37"/>
</g>
<!-- layer_8_expert_agg&#45;&gt;layer_8_residual -->
<g id="edge342" class="edge">
<title>layer_8_expert_agg&#45;&gt;layer_8_residual</title>
<path fill="none" stroke="black" d="M5591.21,-6684.66C5669.7,-6668.3 5772.29,-6646.91 5858.85,-6628.86"/>
<polygon fill="black" stroke="black" points="5859.7,-6632.26 5868.78,-6626.79 5858.28,-6625.41 5859.7,-6632.26"/>
</g>
<!-- layer_9_mha -->
<g id="node200" class="node">
<title>layer_9_mha</title>
<polygon fill="lightblue" stroke="black" points="6134.5,-6513.06 5931.5,-6513.06 5931.5,-6430.06 6134.5,-6430.06 6134.5,-6513.06"/>
<text text-anchor="middle" x="6033" y="-6497.86" font-family="Times,serif" font-size="14.00">Layer 9</text>
<text text-anchor="middle" x="6033" y="-6482.86" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="6033" y="-6467.86" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="6033" y="-6452.86" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="6033" y="-6437.86" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_8_residual&#45;&gt;layer_9_mha -->
<g id="edge343" class="edge">
<title>layer_8_residual&#45;&gt;layer_9_mha</title>
<path fill="none" stroke="black" d="M6033,-6549.95C6033,-6541.42 6033,-6532.32 6033,-6523.47"/>
<polygon fill="black" stroke="black" points="6036.5,-6523.24 6033,-6513.24 6029.5,-6523.24 6036.5,-6523.24"/>
</g>
<!-- layer_9_gate -->
<g id="node201" class="node">
<title>layer_9_gate</title>
<polygon fill="lightblue" stroke="black" points="5820.5,-6393.06 5621.5,-6393.06 5621.5,-6310.06 5820.5,-6310.06 5820.5,-6393.06"/>
<text text-anchor="middle" x="5721" y="-6377.86" font-family="Times,serif" font-size="14.00">Layer 9</text>
<text text-anchor="middle" x="5721" y="-6362.86" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="5721" y="-6347.86" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5721" y="-6332.86" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="5721" y="-6317.86" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_9_mha&#45;&gt;layer_9_gate -->
<g id="edge344" class="edge">
<title>layer_9_mha&#45;&gt;layer_9_gate</title>
<path fill="none" stroke="black" d="M5931.27,-6432.08C5898.98,-6419.87 5863.15,-6406.32 5830.35,-6393.91"/>
<polygon fill="black" stroke="black" points="5831.32,-6390.54 5820.73,-6390.27 5828.84,-6397.09 5831.32,-6390.54"/>
</g>
<!-- layer_9_residual -->
<g id="node221" class="node">
<title>layer_9_residual</title>
<polygon fill="lightblue" stroke="black" points="6433,-5710.3 6105,-5710.3 6105,-5627.3 6433,-5627.3 6433,-5710.3"/>
<text text-anchor="middle" x="6269" y="-5695.1" font-family="Times,serif" font-size="14.00">Layer 9</text>
<text text-anchor="middle" x="6269" y="-5680.1" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="6269" y="-5665.1" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="6269" y="-5650.1" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="6269" y="-5635.1" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_9_mha&#45;&gt;layer_9_residual -->
<g id="edge379" class="edge">
<title>layer_9_mha&#45;&gt;layer_9_residual</title>
<path fill="none" stroke="black" d="M6134.73,-6452.12C6225.78,-6432.64 6345,-6398.38 6345,-6352.56 6345,-6352.56 6345,-6352.56 6345,-5787.8 6345,-5762.42 6332.42,-5738.16 6317.5,-5718.31"/>
<polygon fill="black" stroke="black" points="6320.17,-5716.04 6311.22,-5710.36 6314.67,-5720.38 6320.17,-5716.04"/>
<text text-anchor="middle" x="6373" y="-6059.48" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_9_all2all -->
<g id="node202" class="node">
<title>layer_9_all2all</title>
<ellipse fill="yellow" stroke="black" cx="4233" cy="-6214.37" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="4233" y="-6240.67" font-family="Times,serif" font-size="14.00">Layer 9</text>
<text text-anchor="middle" x="4233" y="-6225.67" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="4233" y="-6210.67" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="4233" y="-6195.67" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="4233" y="-6180.67" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_9_gate&#45;&gt;layer_9_all2all -->
<g id="edge345" class="edge">
<title>layer_9_gate&#45;&gt;layer_9_all2all</title>
<path fill="none" stroke="black" d="M5621.35,-6341.5C5364.76,-6318.19 4680.46,-6256.02 4379.03,-6228.63"/>
<polygon fill="black" stroke="black" points="4379.18,-6225.13 4368.91,-6227.71 4378.55,-6232.1 4379.18,-6225.13"/>
</g>
<!-- layer_9_expert_0 -->
<g id="node203" class="node">
<title>layer_9_expert_0</title>
<polygon fill="lightblue" stroke="black" points="2139,-6104.68 1879,-6104.68 1879,-6021.68 2139,-6021.68 2139,-6104.68"/>
<text text-anchor="middle" x="2009" y="-6089.48" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2009" y="-6074.48" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2009" y="-6059.48" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2009" y="-6044.48" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2009" y="-6029.48" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_9_all2all&#45;&gt;layer_9_expert_0 -->
<g id="edge346" class="edge">
<title>layer_9_all2all&#45;&gt;layer_9_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4093.71,-6210.57C3713.55,-6202.51 2663.72,-6177.22 2320,-6137.68 2245.84,-6129.14 2225.33,-6123.4 2149.2,-6104.93"/>
<polygon fill="black" stroke="black" points="2149.66,-6101.44 2139.12,-6102.49 2148.02,-6108.25 2149.66,-6101.44"/>
<text text-anchor="middle" x="2411.5" y="-6126.48" font-family="Times,serif" font-size="14.00">tokens routed to expert 0</text>
</g>
<!-- layer_9_expert_1 -->
<g id="node204" class="node">
<title>layer_9_expert_1</title>
<polygon fill="lightblue" stroke="black" points="2417,-6104.68 2157,-6104.68 2157,-6021.68 2417,-6021.68 2417,-6104.68"/>
<text text-anchor="middle" x="2287" y="-6089.48" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2287" y="-6074.48" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2287" y="-6059.48" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2287" y="-6044.48" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2287" y="-6029.48" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_9_all2all&#45;&gt;layer_9_expert_1 -->
<g id="edge347" class="edge">
<title>layer_9_all2all&#45;&gt;layer_9_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4093.56,-6213.97C3809.78,-6213.66 3145.12,-6205.03 2592,-6137.68 2537.4,-6131.03 2478.41,-6118.19 2426.99,-6105.07"/>
<polygon fill="black" stroke="black" points="2427.71,-6101.64 2417.15,-6102.54 2425.96,-6108.42 2427.71,-6101.64"/>
<text text-anchor="middle" x="2683.5" y="-6126.48" font-family="Times,serif" font-size="14.00">tokens routed to expert 1</text>
</g>
<!-- layer_9_expert_2 -->
<g id="node205" class="node">
<title>layer_9_expert_2</title>
<polygon fill="lightblue" stroke="black" points="2695,-6104.68 2435,-6104.68 2435,-6021.68 2695,-6021.68 2695,-6104.68"/>
<text text-anchor="middle" x="2565" y="-6089.48" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2565" y="-6074.48" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2565" y="-6059.48" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2565" y="-6044.48" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2565" y="-6029.48" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_9_all2all&#45;&gt;layer_9_expert_2 -->
<g id="edge348" class="edge">
<title>layer_9_all2all&#45;&gt;layer_9_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4093.7,-6212.59C3845.22,-6209.68 3309.6,-6196.43 2862,-6137.68 2810.03,-6130.85 2754,-6118.37 2704.76,-6105.61"/>
<polygon fill="black" stroke="black" points="2705.57,-6102.2 2695.01,-6103.05 2703.8,-6108.97 2705.57,-6102.2"/>
<text text-anchor="middle" x="2953.5" y="-6126.48" font-family="Times,serif" font-size="14.00">tokens routed to expert 2</text>
</g>
<!-- layer_9_expert_3 -->
<g id="node206" class="node">
<title>layer_9_expert_3</title>
<polygon fill="lightblue" stroke="black" points="2973,-6104.68 2713,-6104.68 2713,-6021.68 2973,-6021.68 2973,-6104.68"/>
<text text-anchor="middle" x="2843" y="-6089.48" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2843" y="-6074.48" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2843" y="-6059.48" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2843" y="-6044.48" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2843" y="-6029.48" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_9_all2all&#45;&gt;layer_9_expert_3 -->
<g id="edge349" class="edge">
<title>layer_9_all2all&#45;&gt;layer_9_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4093.67,-6211.42C3881.95,-6206.77 3467.01,-6191.02 3119,-6137.68 3073.77,-6130.74 3025.29,-6119.26 2981.78,-6107.41"/>
<polygon fill="black" stroke="black" points="2982.57,-6103.99 2972,-6104.71 2980.71,-6110.74 2982.57,-6103.99"/>
<text text-anchor="middle" x="3210.5" y="-6126.48" font-family="Times,serif" font-size="14.00">tokens routed to expert 3</text>
</g>
<!-- layer_9_expert_4 -->
<g id="node207" class="node">
<title>layer_9_expert_4</title>
<polygon fill="lightblue" stroke="black" points="3251,-6104.68 2991,-6104.68 2991,-6021.68 3251,-6021.68 3251,-6104.68"/>
<text text-anchor="middle" x="3121" y="-6089.48" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="3121" y="-6074.48" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3121" y="-6059.48" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3121" y="-6044.48" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3121" y="-6029.48" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_9_all2all&#45;&gt;layer_9_expert_4 -->
<g id="edge350" class="edge">
<title>layer_9_all2all&#45;&gt;layer_9_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4093.78,-6209.76C3922.04,-6203.34 3621.77,-6185.7 3369,-6137.68 3329.65,-6130.2 3287.62,-6119.01 3249.55,-6107.61"/>
<polygon fill="black" stroke="black" points="3250.54,-6104.25 3239.96,-6104.7 3248.51,-6110.95 3250.54,-6104.25"/>
<text text-anchor="middle" x="3460.5" y="-6126.48" font-family="Times,serif" font-size="14.00">tokens routed to expert 4</text>
</g>
<!-- layer_9_expert_5 -->
<g id="node208" class="node">
<title>layer_9_expert_5</title>
<polygon fill="lightblue" stroke="black" points="3529,-6104.68 3269,-6104.68 3269,-6021.68 3529,-6021.68 3529,-6104.68"/>
<text text-anchor="middle" x="3399" y="-6089.48" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="3399" y="-6074.48" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3399" y="-6059.48" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3399" y="-6044.48" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3399" y="-6029.48" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_9_all2all&#45;&gt;layer_9_expert_5 -->
<g id="edge351" class="edge">
<title>layer_9_all2all&#45;&gt;layer_9_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4095.18,-6205.22C3967.75,-6195.68 3773.74,-6176.02 3609,-6137.68 3576.44,-6130.1 3541.89,-6119.24 3510.43,-6108.19"/>
<polygon fill="black" stroke="black" points="3511.36,-6104.81 3500.76,-6104.76 3509.02,-6111.41 3511.36,-6104.81"/>
<text text-anchor="middle" x="3700.5" y="-6126.48" font-family="Times,serif" font-size="14.00">tokens routed to expert 5</text>
</g>
<!-- layer_9_expert_6 -->
<g id="node209" class="node">
<title>layer_9_expert_6</title>
<polygon fill="lightblue" stroke="black" points="3807,-6104.68 3547,-6104.68 3547,-6021.68 3807,-6021.68 3807,-6104.68"/>
<text text-anchor="middle" x="3677" y="-6089.48" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="3677" y="-6074.48" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3677" y="-6059.48" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3677" y="-6044.48" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3677" y="-6029.48" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_9_all2all&#45;&gt;layer_9_expert_6 -->
<g id="edge352" class="edge">
<title>layer_9_all2all&#45;&gt;layer_9_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4100.36,-6196.22C4022.49,-6184.13 3922.83,-6165.15 3837,-6137.68 3812.84,-6129.94 3787.53,-6119.5 3764.36,-6108.92"/>
<polygon fill="black" stroke="black" points="3765.79,-6105.73 3755.25,-6104.7 3762.85,-6112.08 3765.79,-6105.73"/>
<text text-anchor="middle" x="3928.5" y="-6126.48" font-family="Times,serif" font-size="14.00">tokens routed to expert 6</text>
</g>
<!-- layer_9_expert_7 -->
<g id="node210" class="node">
<title>layer_9_expert_7</title>
<polygon fill="lightblue" stroke="black" points="4085,-6104.68 3825,-6104.68 3825,-6021.68 4085,-6021.68 4085,-6104.68"/>
<text text-anchor="middle" x="3955" y="-6089.48" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="3955" y="-6074.48" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3955" y="-6059.48" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3955" y="-6044.48" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3955" y="-6029.48" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_9_all2all&#45;&gt;layer_9_expert_7 -->
<g id="edge353" class="edge">
<title>layer_9_all2all&#45;&gt;layer_9_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4126.06,-6176.39C4099.17,-6165.4 4070.9,-6152.33 4046,-6137.68 4032.94,-6129.99 4019.75,-6120.53 4007.63,-6111"/>
<polygon fill="black" stroke="black" points="4009.82,-6108.26 3999.83,-6104.73 4005.44,-6113.72 4009.82,-6108.26"/>
<text text-anchor="middle" x="4137.5" y="-6126.48" font-family="Times,serif" font-size="14.00">tokens routed to expert 7</text>
</g>
<!-- layer_9_expert_8 -->
<g id="node211" class="node">
<title>layer_9_expert_8</title>
<polygon fill="lightblue" stroke="black" points="4363,-6104.68 4103,-6104.68 4103,-6021.68 4363,-6021.68 4363,-6104.68"/>
<text text-anchor="middle" x="4233" y="-6089.48" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="4233" y="-6074.48" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4233" y="-6059.48" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4233" y="-6044.48" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4233" y="-6029.48" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_9_all2all&#45;&gt;layer_9_expert_8 -->
<g id="edge354" class="edge">
<title>layer_9_all2all&#45;&gt;layer_9_expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4233,-6155.26C4233,-6141.96 4233,-6127.92 4233,-6114.96"/>
<polygon fill="black" stroke="black" points="4236.5,-6114.83 4233,-6104.83 4229.5,-6114.83 4236.5,-6114.83"/>
<text text-anchor="middle" x="4324.5" y="-6126.48" font-family="Times,serif" font-size="14.00">tokens routed to expert 8</text>
</g>
<!-- layer_9_expert_9 -->
<g id="node212" class="node">
<title>layer_9_expert_9</title>
<polygon fill="lightblue" stroke="black" points="4641,-6104.68 4381,-6104.68 4381,-6021.68 4641,-6021.68 4641,-6104.68"/>
<text text-anchor="middle" x="4511" y="-6089.48" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="4511" y="-6074.48" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4511" y="-6059.48" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4511" y="-6044.48" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4511" y="-6029.48" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_9_all2all&#45;&gt;layer_9_expert_9 -->
<g id="edge355" class="edge">
<title>layer_9_all2all&#45;&gt;layer_9_expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4339.94,-6176.39C4366.83,-6165.4 4395.1,-6152.33 4420,-6137.68 4433.06,-6129.99 4446.25,-6120.53 4458.37,-6111"/>
<polygon fill="black" stroke="black" points="4460.56,-6113.72 4466.17,-6104.73 4456.18,-6108.26 4460.56,-6113.72"/>
<text text-anchor="middle" x="4532.5" y="-6126.48" font-family="Times,serif" font-size="14.00">tokens routed to expert 9</text>
</g>
<!-- layer_9_expert_10 -->
<g id="node213" class="node">
<title>layer_9_expert_10</title>
<polygon fill="lightblue" stroke="black" points="4919,-6104.68 4659,-6104.68 4659,-6021.68 4919,-6021.68 4919,-6104.68"/>
<text text-anchor="middle" x="4789" y="-6089.48" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="4789" y="-6074.48" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4789" y="-6059.48" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4789" y="-6044.48" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4789" y="-6029.48" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_9_all2all&#45;&gt;layer_9_expert_10 -->
<g id="edge356" class="edge">
<title>layer_9_all2all&#45;&gt;layer_9_expert_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4365.73,-6196.03C4443.33,-6183.91 4542.52,-6164.94 4628,-6137.68 4652.29,-6129.93 4677.75,-6119.48 4701.07,-6108.9"/>
<polygon fill="black" stroke="black" points="4702.61,-6112.04 4710.24,-6104.68 4699.69,-6105.68 4702.61,-6112.04"/>
<text text-anchor="middle" x="4764" y="-6126.48" font-family="Times,serif" font-size="14.00">tokens routed to expert 10</text>
</g>
<!-- layer_9_expert_11 -->
<g id="node214" class="node">
<title>layer_9_expert_11</title>
<polygon fill="lightblue" stroke="black" points="5197,-6104.68 4937,-6104.68 4937,-6021.68 5197,-6021.68 5197,-6104.68"/>
<text text-anchor="middle" x="5067" y="-6089.48" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="5067" y="-6074.48" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5067" y="-6059.48" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5067" y="-6044.48" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5067" y="-6029.48" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_9_all2all&#45;&gt;layer_9_expert_11 -->
<g id="edge357" class="edge">
<title>layer_9_all2all&#45;&gt;layer_9_expert_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4370.9,-6205.9C4499.81,-6196.79 4696.95,-6177.39 4864,-6137.68 4895.51,-6130.19 4928.87,-6119.38 4959.25,-6108.35"/>
<polygon fill="black" stroke="black" points="4960.82,-6111.5 4969,-6104.76 4958.4,-6104.93 4960.82,-6111.5"/>
<text text-anchor="middle" x="5011" y="-6126.48" font-family="Times,serif" font-size="14.00">tokens routed to expert 11</text>
</g>
<!-- layer_9_expert_12 -->
<g id="node215" class="node">
<title>layer_9_expert_12</title>
<polygon fill="lightblue" stroke="black" points="5475,-6104.68 5215,-6104.68 5215,-6021.68 5475,-6021.68 5475,-6104.68"/>
<text text-anchor="middle" x="5345" y="-6089.48" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="5345" y="-6074.48" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5345" y="-6059.48" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5345" y="-6044.48" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5345" y="-6029.48" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_9_all2all&#45;&gt;layer_9_expert_12 -->
<g id="edge358" class="edge">
<title>layer_9_all2all&#45;&gt;layer_9_expert_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4372.31,-6210.71C4546.58,-6205.26 4853.41,-6188.6 5111,-6137.68 5148.2,-6130.32 5187.83,-6119.19 5223.7,-6107.8"/>
<polygon fill="black" stroke="black" points="5224.77,-6111.14 5233.22,-6104.75 5222.63,-6104.47 5224.77,-6111.14"/>
<text text-anchor="middle" x="5265" y="-6126.48" font-family="Times,serif" font-size="14.00">tokens routed to expert 12</text>
</g>
<!-- layer_9_expert_13 -->
<g id="node216" class="node">
<title>layer_9_expert_13</title>
<polygon fill="lightblue" stroke="black" points="5753,-6104.68 5493,-6104.68 5493,-6021.68 5753,-6021.68 5753,-6104.68"/>
<text text-anchor="middle" x="5623" y="-6089.48" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="5623" y="-6074.48" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5623" y="-6059.48" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5623" y="-6044.48" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5623" y="-6029.48" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_9_all2all&#45;&gt;layer_9_expert_13 -->
<g id="edge359" class="edge">
<title>layer_9_all2all&#45;&gt;layer_9_expert_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4372.61,-6213.14C4587.38,-6210.75 5011.12,-6197.93 5365,-6137.68 5406.67,-6130.58 5451.23,-6119.28 5491.38,-6107.64"/>
<polygon fill="black" stroke="black" points="5492.61,-6110.93 5501.22,-6104.76 5490.64,-6104.21 5492.61,-6110.93"/>
<text text-anchor="middle" x="5525" y="-6126.48" font-family="Times,serif" font-size="14.00">tokens routed to expert 13</text>
</g>
<!-- layer_9_expert_14 -->
<g id="node217" class="node">
<title>layer_9_expert_14</title>
<polygon fill="lightblue" stroke="black" points="6031,-6104.68 5771,-6104.68 5771,-6021.68 6031,-6021.68 6031,-6104.68"/>
<text text-anchor="middle" x="5901" y="-6089.48" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="5901" y="-6074.48" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5901" y="-6059.48" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5901" y="-6044.48" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5901" y="-6029.48" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_9_all2all&#45;&gt;layer_9_expert_14 -->
<g id="edge360" class="edge">
<title>layer_9_all2all&#45;&gt;layer_9_expert_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4372.63,-6214.15C4624.34,-6213.7 5170.3,-6204.23 5625,-6137.68 5670.73,-6130.98 5719.74,-6119.42 5763.59,-6107.42"/>
<polygon fill="black" stroke="black" points="5764.74,-6110.74 5773.45,-6104.7 5762.87,-6103.99 5764.74,-6110.74"/>
<text text-anchor="middle" x="5797" y="-6126.48" font-family="Times,serif" font-size="14.00">tokens routed to expert 14</text>
</g>
<!-- layer_9_expert_15 -->
<g id="node218" class="node">
<title>layer_9_expert_15</title>
<polygon fill="lightblue" stroke="black" points="6309,-6104.68 6049,-6104.68 6049,-6021.68 6309,-6021.68 6309,-6104.68"/>
<text text-anchor="middle" x="6179" y="-6089.48" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="6179" y="-6074.48" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6179" y="-6059.48" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6179" y="-6044.48" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6179" y="-6029.48" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_9_all2all&#45;&gt;layer_9_expert_15 -->
<g id="edge361" class="edge">
<title>layer_9_all2all&#45;&gt;layer_9_expert_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4372.05,-6210.29C4716.75,-6202.14 5603.95,-6177.82 5897,-6137.68 5944.17,-6131.22 5994.76,-6119.57 6039.89,-6107.43"/>
<polygon fill="black" stroke="black" points="6041,-6110.76 6049.73,-6104.76 6039.16,-6104 6041,-6110.76"/>
<text text-anchor="middle" x="6071" y="-6126.48" font-family="Times,serif" font-size="14.00">tokens routed to expert 15</text>
</g>
<!-- layer_9_all2all_result -->
<g id="node219" class="node">
<title>layer_9_all2all_result</title>
<ellipse fill="yellow" stroke="black" cx="4233" cy="-5925.99" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="4233" y="-5952.29" font-family="Times,serif" font-size="14.00">Layer 9</text>
<text text-anchor="middle" x="4233" y="-5937.29" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Result Merge</text>
<text text-anchor="middle" x="4233" y="-5922.29" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="4233" y="-5907.29" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="4233" y="-5892.29" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_9_expert_0&#45;&gt;layer_9_all2all_result -->
<g id="edge362" class="edge">
<title>layer_9_expert_0&#45;&gt;layer_9_all2all_result</title>
<path fill="none" stroke="black" d="M2139,-6023.28C2142.02,-6022.71 2145.02,-6022.17 2148,-6021.68 2520.89,-5959.8 3670.76,-5935.89 4083.55,-5929.16"/>
<polygon fill="black" stroke="black" points="4083.81,-5932.65 4093.76,-5928.99 4083.7,-5925.65 4083.81,-5932.65"/>
</g>
<!-- layer_9_expert_1&#45;&gt;layer_9_all2all_result -->
<g id="edge363" class="edge">
<title>layer_9_expert_1&#45;&gt;layer_9_all2all_result</title>
<path fill="none" stroke="black" d="M2417.01,-6023.31C2420.03,-6022.73 2423.03,-6022.18 2426,-6021.68 2743.38,-5967.87 3710.71,-5939.53 4083.92,-5930.36"/>
<polygon fill="black" stroke="black" points="4084.07,-5933.86 4093.98,-5930.12 4083.9,-5926.86 4084.07,-5933.86"/>
</g>
<!-- layer_9_expert_2&#45;&gt;layer_9_all2all_result -->
<g id="edge364" class="edge">
<title>layer_9_expert_2&#45;&gt;layer_9_all2all_result</title>
<path fill="none" stroke="black" d="M2695.01,-6023.35C2698.03,-6022.75 2701.03,-6022.19 2704,-6021.68 2966.24,-5975.94 3753.24,-5943.83 4084,-5932.01"/>
<polygon fill="black" stroke="black" points="4084.26,-5935.5 4094.13,-5931.64 4084.01,-5928.5 4084.26,-5935.5"/>
</g>
<!-- layer_9_expert_3&#45;&gt;layer_9_all2all_result -->
<g id="edge365" class="edge">
<title>layer_9_expert_3&#45;&gt;layer_9_all2all_result</title>
<path fill="none" stroke="black" d="M2973.02,-6023.4C2976.04,-6022.79 2979.03,-6022.22 2982,-6021.68 3375.23,-5950.31 3847.45,-5932.6 4083.41,-5928.3"/>
<polygon fill="black" stroke="black" points="4083.49,-5931.8 4093.43,-5928.12 4083.37,-5924.8 4083.49,-5931.8"/>
</g>
<!-- layer_9_expert_4&#45;&gt;layer_9_all2all_result -->
<g id="edge366" class="edge">
<title>layer_9_expert_4&#45;&gt;layer_9_all2all_result</title>
<path fill="none" stroke="black" d="M3251.04,-6023.49C3254.05,-6022.85 3257.04,-6022.25 3260,-6021.68 3548.78,-5966.06 3892.4,-5942.35 4084.32,-5932.84"/>
<polygon fill="black" stroke="black" points="4084.66,-5936.32 4094.47,-5932.34 4084.32,-5929.33 4084.66,-5936.32"/>
</g>
<!-- layer_9_expert_5&#45;&gt;layer_9_all2all_result -->
<g id="edge367" class="edge">
<title>layer_9_expert_5&#45;&gt;layer_9_all2all_result</title>
<path fill="none" stroke="black" d="M3529.07,-6023.64C3532.07,-6022.96 3535.05,-6022.3 3538,-6021.68 3725.71,-5981.77 3945.69,-5955.11 4087.08,-5940.52"/>
<polygon fill="black" stroke="black" points="4087.53,-5943.99 4097.12,-5939.49 4086.81,-5937.02 4087.53,-5943.99"/>
</g>
<!-- layer_9_expert_6&#45;&gt;layer_9_all2all_result -->
<g id="edge368" class="edge">
<title>layer_9_expert_6&#45;&gt;layer_9_all2all_result</title>
<path fill="none" stroke="black" d="M3807.15,-6024C3810.13,-6023.21 3813.08,-6022.43 3816,-6021.68 3910.1,-5997.31 4017.02,-5973.1 4099.03,-5955.26"/>
<polygon fill="black" stroke="black" points="4099.88,-5958.66 4108.91,-5953.11 4098.39,-5951.82 4099.88,-5958.66"/>
</g>
<!-- layer_9_expert_7&#45;&gt;layer_9_all2all_result -->
<g id="edge369" class="edge">
<title>layer_9_expert_7&#45;&gt;layer_9_all2all_result</title>
<path fill="none" stroke="black" d="M4038.41,-6021.62C4068.4,-6007.03 4102.51,-5990.44 4133.72,-5975.27"/>
<polygon fill="black" stroke="black" points="4135.41,-5978.34 4142.87,-5970.82 4132.34,-5972.04 4135.41,-5978.34"/>
</g>
<!-- layer_9_expert_8&#45;&gt;layer_9_all2all_result -->
<g id="edge370" class="edge">
<title>layer_9_expert_8&#45;&gt;layer_9_all2all_result</title>
<path fill="none" stroke="black" d="M4233,-6021.62C4233,-6013.25 4233,-6004.23 4233,-5995.19"/>
<polygon fill="black" stroke="black" points="4236.5,-5995.01 4233,-5985.01 4229.5,-5995.01 4236.5,-5995.01"/>
</g>
<!-- layer_9_expert_9&#45;&gt;layer_9_all2all_result -->
<g id="edge371" class="edge">
<title>layer_9_expert_9&#45;&gt;layer_9_all2all_result</title>
<path fill="none" stroke="black" d="M4427.59,-6021.62C4397.6,-6007.03 4363.49,-5990.44 4332.28,-5975.27"/>
<polygon fill="black" stroke="black" points="4333.66,-5972.04 4323.13,-5970.82 4330.59,-5978.34 4333.66,-5972.04"/>
</g>
<!-- layer_9_expert_10&#45;&gt;layer_9_all2all_result -->
<g id="edge372" class="edge">
<title>layer_9_expert_10&#45;&gt;layer_9_all2all_result</title>
<path fill="none" stroke="black" d="M4658.85,-6024C4655.87,-6023.21 4652.92,-6022.43 4650,-6021.68 4555.9,-5997.31 4448.98,-5973.1 4366.97,-5955.26"/>
<polygon fill="black" stroke="black" points="4367.61,-5951.82 4357.09,-5953.11 4366.12,-5958.66 4367.61,-5951.82"/>
</g>
<!-- layer_9_expert_11&#45;&gt;layer_9_all2all_result -->
<g id="edge373" class="edge">
<title>layer_9_expert_11&#45;&gt;layer_9_all2all_result</title>
<path fill="none" stroke="black" d="M4936.93,-6023.64C4933.93,-6022.96 4930.95,-6022.3 4928,-6021.68 4740.29,-5981.77 4520.31,-5955.11 4378.92,-5940.52"/>
<polygon fill="black" stroke="black" points="4379.19,-5937.02 4368.88,-5939.49 4378.47,-5943.99 4379.19,-5937.02"/>
</g>
<!-- layer_9_expert_12&#45;&gt;layer_9_all2all_result -->
<g id="edge374" class="edge">
<title>layer_9_expert_12&#45;&gt;layer_9_all2all_result</title>
<path fill="none" stroke="black" d="M5214.96,-6023.49C5211.95,-6022.85 5208.96,-6022.25 5206,-6021.68 4917.22,-5966.06 4573.6,-5942.35 4381.68,-5932.84"/>
<polygon fill="black" stroke="black" points="4381.68,-5929.33 4371.53,-5932.34 4381.34,-5936.32 4381.68,-5929.33"/>
</g>
<!-- layer_9_expert_13&#45;&gt;layer_9_all2all_result -->
<g id="edge375" class="edge">
<title>layer_9_expert_13&#45;&gt;layer_9_all2all_result</title>
<path fill="none" stroke="black" d="M5492.98,-6023.4C5489.96,-6022.79 5486.97,-6022.22 5484,-6021.68 5090.77,-5950.31 4618.55,-5932.6 4382.59,-5928.3"/>
<polygon fill="black" stroke="black" points="4382.63,-5924.8 4372.57,-5928.12 4382.51,-5931.8 4382.63,-5924.8"/>
</g>
<!-- layer_9_expert_14&#45;&gt;layer_9_all2all_result -->
<g id="edge376" class="edge">
<title>layer_9_expert_14&#45;&gt;layer_9_all2all_result</title>
<path fill="none" stroke="black" d="M5770.99,-6023.35C5767.97,-6022.75 5764.97,-6022.19 5762,-6021.68 5499.76,-5975.94 4712.76,-5943.83 4382,-5932.01"/>
<polygon fill="black" stroke="black" points="4381.99,-5928.5 4371.87,-5931.64 4381.74,-5935.5 4381.99,-5928.5"/>
</g>
<!-- layer_9_expert_15&#45;&gt;layer_9_all2all_result -->
<g id="edge377" class="edge">
<title>layer_9_expert_15&#45;&gt;layer_9_all2all_result</title>
<path fill="none" stroke="black" d="M6048.99,-6023.31C6045.97,-6022.73 6042.97,-6022.18 6040,-6021.68 5722.62,-5967.87 4755.29,-5939.53 4382.08,-5930.36"/>
<polygon fill="black" stroke="black" points="4382.1,-5926.86 4372.02,-5930.12 4381.93,-5933.86 4382.1,-5926.86"/>
</g>
<!-- layer_9_expert_agg -->
<g id="node220" class="node">
<title>layer_9_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="5827,-5830.3 5579,-5830.3 5579,-5747.3 5827,-5747.3 5827,-5830.3"/>
<text text-anchor="middle" x="5703" y="-5815.1" font-family="Times,serif" font-size="14.00">Layer 9</text>
<text text-anchor="middle" x="5703" y="-5800.1" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="5703" y="-5785.1" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5703" y="-5770.1" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="5703" y="-5755.1" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_9_all2all_result&#45;&gt;layer_9_expert_agg -->
<g id="edge378" class="edge">
<title>layer_9_all2all_result&#45;&gt;layer_9_expert_agg</title>
<path fill="none" stroke="black" d="M4368.66,-5912.51C4649.06,-5886.72 5289.53,-5827.82 5568.73,-5802.14"/>
<polygon fill="black" stroke="black" points="5569.28,-5805.61 5578.92,-5801.21 5568.64,-5798.64 5569.28,-5805.61"/>
</g>
<!-- layer_9_expert_agg&#45;&gt;layer_9_residual -->
<g id="edge380" class="edge">
<title>layer_9_expert_agg&#45;&gt;layer_9_residual</title>
<path fill="none" stroke="black" d="M5827.21,-5761.9C5905.7,-5745.54 6008.29,-5724.15 6094.85,-5706.1"/>
<polygon fill="black" stroke="black" points="6095.7,-5709.5 6104.78,-5704.03 6094.28,-5702.65 6095.7,-5709.5"/>
</g>
<!-- layer_10_mha -->
<g id="node222" class="node">
<title>layer_10_mha</title>
<polygon fill="lightblue" stroke="black" points="6370.5,-5590.3 6167.5,-5590.3 6167.5,-5507.3 6370.5,-5507.3 6370.5,-5590.3"/>
<text text-anchor="middle" x="6269" y="-5575.1" font-family="Times,serif" font-size="14.00">Layer 10</text>
<text text-anchor="middle" x="6269" y="-5560.1" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="6269" y="-5545.1" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="6269" y="-5530.1" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="6269" y="-5515.1" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_9_residual&#45;&gt;layer_10_mha -->
<g id="edge381" class="edge">
<title>layer_9_residual&#45;&gt;layer_10_mha</title>
<path fill="none" stroke="black" d="M6269,-5627.19C6269,-5618.66 6269,-5609.56 6269,-5600.71"/>
<polygon fill="black" stroke="black" points="6272.5,-5600.48 6269,-5590.48 6265.5,-5600.48 6272.5,-5600.48"/>
</g>
<!-- layer_10_gate -->
<g id="node223" class="node">
<title>layer_10_gate</title>
<polygon fill="lightblue" stroke="black" points="6056.5,-5470.3 5857.5,-5470.3 5857.5,-5387.3 6056.5,-5387.3 6056.5,-5470.3"/>
<text text-anchor="middle" x="5957" y="-5455.1" font-family="Times,serif" font-size="14.00">Layer 10</text>
<text text-anchor="middle" x="5957" y="-5440.1" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="5957" y="-5425.1" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="5957" y="-5410.1" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="5957" y="-5395.1" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_10_mha&#45;&gt;layer_10_gate -->
<g id="edge382" class="edge">
<title>layer_10_mha&#45;&gt;layer_10_gate</title>
<path fill="none" stroke="black" d="M6167.27,-5509.32C6134.98,-5497.11 6099.15,-5483.56 6066.35,-5471.15"/>
<polygon fill="black" stroke="black" points="6067.32,-5467.78 6056.73,-5467.51 6064.84,-5474.33 6067.32,-5467.78"/>
</g>
<!-- layer_10_residual -->
<g id="node243" class="node">
<title>layer_10_residual</title>
<polygon fill="lightblue" stroke="black" points="6669,-4787.54 6341,-4787.54 6341,-4704.54 6669,-4704.54 6669,-4787.54"/>
<text text-anchor="middle" x="6505" y="-4772.34" font-family="Times,serif" font-size="14.00">Layer 10</text>
<text text-anchor="middle" x="6505" y="-4757.34" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="6505" y="-4742.34" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="6505" y="-4727.34" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="6505" y="-4712.34" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_10_mha&#45;&gt;layer_10_residual -->
<g id="edge417" class="edge">
<title>layer_10_mha&#45;&gt;layer_10_residual</title>
<path fill="none" stroke="black" d="M6370.73,-5529.36C6461.78,-5509.88 6581,-5475.62 6581,-5429.8 6581,-5429.8 6581,-5429.8 6581,-4865.04 6581,-4839.66 6568.42,-4815.4 6553.5,-4795.55"/>
<polygon fill="black" stroke="black" points="6556.17,-4793.28 6547.22,-4787.6 6550.67,-4797.62 6556.17,-4793.28"/>
<text text-anchor="middle" x="6609" y="-5136.72" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_10_all2all -->
<g id="node224" class="node">
<title>layer_10_all2all</title>
<ellipse fill="yellow" stroke="black" cx="4469" cy="-5291.61" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="4469" y="-5317.91" font-family="Times,serif" font-size="14.00">Layer 10</text>
<text text-anchor="middle" x="4469" y="-5302.91" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="4469" y="-5287.91" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="4469" y="-5272.91" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="4469" y="-5257.91" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_10_gate&#45;&gt;layer_10_all2all -->
<g id="edge383" class="edge">
<title>layer_10_gate&#45;&gt;layer_10_all2all</title>
<path fill="none" stroke="black" d="M5857.35,-5418.74C5600.76,-5395.43 4916.46,-5333.26 4615.03,-5305.87"/>
<polygon fill="black" stroke="black" points="4615.18,-5302.37 4604.91,-5304.95 4614.55,-5309.35 4615.18,-5302.37"/>
</g>
<!-- layer_10_expert_0 -->
<g id="node225" class="node">
<title>layer_10_expert_0</title>
<polygon fill="lightblue" stroke="black" points="2375,-5181.92 2115,-5181.92 2115,-5098.92 2375,-5098.92 2375,-5181.92"/>
<text text-anchor="middle" x="2245" y="-5166.72" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2245" y="-5151.72" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2245" y="-5136.72" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2245" y="-5121.72" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2245" y="-5106.72" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_10_all2all&#45;&gt;layer_10_expert_0 -->
<g id="edge384" class="edge">
<title>layer_10_all2all&#45;&gt;layer_10_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4329.71,-5287.81C3949.55,-5279.75 2899.72,-5254.46 2556,-5214.92 2481.84,-5206.38 2461.33,-5200.64 2385.2,-5182.17"/>
<polygon fill="black" stroke="black" points="2385.66,-5178.68 2375.12,-5179.73 2384.02,-5185.49 2385.66,-5178.68"/>
<text text-anchor="middle" x="2647.5" y="-5203.72" font-family="Times,serif" font-size="14.00">tokens routed to expert 0</text>
</g>
<!-- layer_10_expert_1 -->
<g id="node226" class="node">
<title>layer_10_expert_1</title>
<polygon fill="lightblue" stroke="black" points="2653,-5181.92 2393,-5181.92 2393,-5098.92 2653,-5098.92 2653,-5181.92"/>
<text text-anchor="middle" x="2523" y="-5166.72" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2523" y="-5151.72" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2523" y="-5136.72" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2523" y="-5121.72" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2523" y="-5106.72" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_10_all2all&#45;&gt;layer_10_expert_1 -->
<g id="edge385" class="edge">
<title>layer_10_all2all&#45;&gt;layer_10_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4329.56,-5291.21C4045.78,-5290.9 3381.12,-5282.27 2828,-5214.92 2773.4,-5208.27 2714.41,-5195.43 2662.99,-5182.31"/>
<polygon fill="black" stroke="black" points="2663.71,-5178.88 2653.15,-5179.78 2661.96,-5185.66 2663.71,-5178.88"/>
<text text-anchor="middle" x="2919.5" y="-5203.72" font-family="Times,serif" font-size="14.00">tokens routed to expert 1</text>
</g>
<!-- layer_10_expert_2 -->
<g id="node227" class="node">
<title>layer_10_expert_2</title>
<polygon fill="lightblue" stroke="black" points="2931,-5181.92 2671,-5181.92 2671,-5098.92 2931,-5098.92 2931,-5181.92"/>
<text text-anchor="middle" x="2801" y="-5166.72" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2801" y="-5151.72" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2801" y="-5136.72" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2801" y="-5121.72" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2801" y="-5106.72" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_10_all2all&#45;&gt;layer_10_expert_2 -->
<g id="edge386" class="edge">
<title>layer_10_all2all&#45;&gt;layer_10_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4329.7,-5289.83C4081.22,-5286.92 3545.6,-5273.67 3098,-5214.92 3046.03,-5208.1 2990,-5195.61 2940.76,-5182.85"/>
<polygon fill="black" stroke="black" points="2941.57,-5179.44 2931.01,-5180.29 2939.8,-5186.21 2941.57,-5179.44"/>
<text text-anchor="middle" x="3189.5" y="-5203.72" font-family="Times,serif" font-size="14.00">tokens routed to expert 2</text>
</g>
<!-- layer_10_expert_3 -->
<g id="node228" class="node">
<title>layer_10_expert_3</title>
<polygon fill="lightblue" stroke="black" points="3209,-5181.92 2949,-5181.92 2949,-5098.92 3209,-5098.92 3209,-5181.92"/>
<text text-anchor="middle" x="3079" y="-5166.72" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3079" y="-5151.72" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3079" y="-5136.72" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3079" y="-5121.72" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3079" y="-5106.72" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_10_all2all&#45;&gt;layer_10_expert_3 -->
<g id="edge387" class="edge">
<title>layer_10_all2all&#45;&gt;layer_10_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4329.67,-5288.66C4117.95,-5284.01 3703.01,-5268.26 3355,-5214.92 3309.77,-5207.98 3261.29,-5196.5 3217.78,-5184.65"/>
<polygon fill="black" stroke="black" points="3218.57,-5181.23 3208,-5181.95 3216.71,-5187.98 3218.57,-5181.23"/>
<text text-anchor="middle" x="3446.5" y="-5203.72" font-family="Times,serif" font-size="14.00">tokens routed to expert 3</text>
</g>
<!-- layer_10_expert_4 -->
<g id="node229" class="node">
<title>layer_10_expert_4</title>
<polygon fill="lightblue" stroke="black" points="3487,-5181.92 3227,-5181.92 3227,-5098.92 3487,-5098.92 3487,-5181.92"/>
<text text-anchor="middle" x="3357" y="-5166.72" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="3357" y="-5151.72" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3357" y="-5136.72" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3357" y="-5121.72" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3357" y="-5106.72" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_10_all2all&#45;&gt;layer_10_expert_4 -->
<g id="edge388" class="edge">
<title>layer_10_all2all&#45;&gt;layer_10_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4329.78,-5287C4158.04,-5280.58 3857.77,-5262.94 3605,-5214.92 3565.65,-5207.44 3523.62,-5196.25 3485.55,-5184.85"/>
<polygon fill="black" stroke="black" points="3486.54,-5181.49 3475.96,-5181.94 3484.51,-5188.19 3486.54,-5181.49"/>
<text text-anchor="middle" x="3696.5" y="-5203.72" font-family="Times,serif" font-size="14.00">tokens routed to expert 4</text>
</g>
<!-- layer_10_expert_5 -->
<g id="node230" class="node">
<title>layer_10_expert_5</title>
<polygon fill="lightblue" stroke="black" points="3765,-5181.92 3505,-5181.92 3505,-5098.92 3765,-5098.92 3765,-5181.92"/>
<text text-anchor="middle" x="3635" y="-5166.72" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="3635" y="-5151.72" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3635" y="-5136.72" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3635" y="-5121.72" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3635" y="-5106.72" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_10_all2all&#45;&gt;layer_10_expert_5 -->
<g id="edge389" class="edge">
<title>layer_10_all2all&#45;&gt;layer_10_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4331.18,-5282.47C4203.75,-5272.92 4009.74,-5253.26 3845,-5214.92 3812.44,-5207.34 3777.89,-5196.48 3746.43,-5185.43"/>
<polygon fill="black" stroke="black" points="3747.36,-5182.05 3736.76,-5182 3745.02,-5188.65 3747.36,-5182.05"/>
<text text-anchor="middle" x="3936.5" y="-5203.72" font-family="Times,serif" font-size="14.00">tokens routed to expert 5</text>
</g>
<!-- layer_10_expert_6 -->
<g id="node231" class="node">
<title>layer_10_expert_6</title>
<polygon fill="lightblue" stroke="black" points="4043,-5181.92 3783,-5181.92 3783,-5098.92 4043,-5098.92 4043,-5181.92"/>
<text text-anchor="middle" x="3913" y="-5166.72" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="3913" y="-5151.72" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3913" y="-5136.72" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3913" y="-5121.72" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3913" y="-5106.72" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_10_all2all&#45;&gt;layer_10_expert_6 -->
<g id="edge390" class="edge">
<title>layer_10_all2all&#45;&gt;layer_10_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4336.36,-5273.46C4258.49,-5261.37 4158.83,-5242.39 4073,-5214.92 4048.84,-5207.18 4023.53,-5196.74 4000.36,-5186.16"/>
<polygon fill="black" stroke="black" points="4001.79,-5182.97 3991.25,-5181.94 3998.85,-5189.32 4001.79,-5182.97"/>
<text text-anchor="middle" x="4164.5" y="-5203.72" font-family="Times,serif" font-size="14.00">tokens routed to expert 6</text>
</g>
<!-- layer_10_expert_7 -->
<g id="node232" class="node">
<title>layer_10_expert_7</title>
<polygon fill="lightblue" stroke="black" points="4321,-5181.92 4061,-5181.92 4061,-5098.92 4321,-5098.92 4321,-5181.92"/>
<text text-anchor="middle" x="4191" y="-5166.72" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="4191" y="-5151.72" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4191" y="-5136.72" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4191" y="-5121.72" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4191" y="-5106.72" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_10_all2all&#45;&gt;layer_10_expert_7 -->
<g id="edge391" class="edge">
<title>layer_10_all2all&#45;&gt;layer_10_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4362.06,-5253.63C4335.17,-5242.65 4306.9,-5229.57 4282,-5214.92 4268.94,-5207.23 4255.75,-5197.77 4243.63,-5188.24"/>
<polygon fill="black" stroke="black" points="4245.82,-5185.5 4235.83,-5181.97 4241.44,-5190.96 4245.82,-5185.5"/>
<text text-anchor="middle" x="4373.5" y="-5203.72" font-family="Times,serif" font-size="14.00">tokens routed to expert 7</text>
</g>
<!-- layer_10_expert_8 -->
<g id="node233" class="node">
<title>layer_10_expert_8</title>
<polygon fill="lightblue" stroke="black" points="4599,-5181.92 4339,-5181.92 4339,-5098.92 4599,-5098.92 4599,-5181.92"/>
<text text-anchor="middle" x="4469" y="-5166.72" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="4469" y="-5151.72" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4469" y="-5136.72" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4469" y="-5121.72" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4469" y="-5106.72" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_10_all2all&#45;&gt;layer_10_expert_8 -->
<g id="edge392" class="edge">
<title>layer_10_all2all&#45;&gt;layer_10_expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4469,-5232.5C4469,-5219.2 4469,-5205.17 4469,-5192.2"/>
<polygon fill="black" stroke="black" points="4472.5,-5192.07 4469,-5182.07 4465.5,-5192.07 4472.5,-5192.07"/>
<text text-anchor="middle" x="4560.5" y="-5203.72" font-family="Times,serif" font-size="14.00">tokens routed to expert 8</text>
</g>
<!-- layer_10_expert_9 -->
<g id="node234" class="node">
<title>layer_10_expert_9</title>
<polygon fill="lightblue" stroke="black" points="4877,-5181.92 4617,-5181.92 4617,-5098.92 4877,-5098.92 4877,-5181.92"/>
<text text-anchor="middle" x="4747" y="-5166.72" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="4747" y="-5151.72" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4747" y="-5136.72" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4747" y="-5121.72" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4747" y="-5106.72" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_10_all2all&#45;&gt;layer_10_expert_9 -->
<g id="edge393" class="edge">
<title>layer_10_all2all&#45;&gt;layer_10_expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4575.94,-5253.63C4602.83,-5242.65 4631.1,-5229.57 4656,-5214.92 4669.06,-5207.23 4682.25,-5197.77 4694.37,-5188.24"/>
<polygon fill="black" stroke="black" points="4696.56,-5190.96 4702.17,-5181.97 4692.18,-5185.5 4696.56,-5190.96"/>
<text text-anchor="middle" x="4768.5" y="-5203.72" font-family="Times,serif" font-size="14.00">tokens routed to expert 9</text>
</g>
<!-- layer_10_expert_10 -->
<g id="node235" class="node">
<title>layer_10_expert_10</title>
<polygon fill="lightblue" stroke="black" points="5155,-5181.92 4895,-5181.92 4895,-5098.92 5155,-5098.92 5155,-5181.92"/>
<text text-anchor="middle" x="5025" y="-5166.72" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="5025" y="-5151.72" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5025" y="-5136.72" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5025" y="-5121.72" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5025" y="-5106.72" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_10_all2all&#45;&gt;layer_10_expert_10 -->
<g id="edge394" class="edge">
<title>layer_10_all2all&#45;&gt;layer_10_expert_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4601.73,-5273.28C4679.33,-5261.15 4778.52,-5242.19 4864,-5214.92 4888.29,-5207.17 4913.75,-5196.72 4937.07,-5186.14"/>
<polygon fill="black" stroke="black" points="4938.61,-5189.28 4946.24,-5181.92 4935.69,-5182.92 4938.61,-5189.28"/>
<text text-anchor="middle" x="5000" y="-5203.72" font-family="Times,serif" font-size="14.00">tokens routed to expert 10</text>
</g>
<!-- layer_10_expert_11 -->
<g id="node236" class="node">
<title>layer_10_expert_11</title>
<polygon fill="lightblue" stroke="black" points="5433,-5181.92 5173,-5181.92 5173,-5098.92 5433,-5098.92 5433,-5181.92"/>
<text text-anchor="middle" x="5303" y="-5166.72" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="5303" y="-5151.72" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5303" y="-5136.72" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5303" y="-5121.72" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5303" y="-5106.72" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_10_all2all&#45;&gt;layer_10_expert_11 -->
<g id="edge395" class="edge">
<title>layer_10_all2all&#45;&gt;layer_10_expert_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4606.9,-5283.14C4735.81,-5274.03 4932.95,-5254.63 5100,-5214.92 5131.51,-5207.43 5164.87,-5196.62 5195.25,-5185.59"/>
<polygon fill="black" stroke="black" points="5196.82,-5188.74 5205,-5182.01 5194.4,-5182.17 5196.82,-5188.74"/>
<text text-anchor="middle" x="5247" y="-5203.72" font-family="Times,serif" font-size="14.00">tokens routed to expert 11</text>
</g>
<!-- layer_10_expert_12 -->
<g id="node237" class="node">
<title>layer_10_expert_12</title>
<polygon fill="lightblue" stroke="black" points="5711,-5181.92 5451,-5181.92 5451,-5098.92 5711,-5098.92 5711,-5181.92"/>
<text text-anchor="middle" x="5581" y="-5166.72" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="5581" y="-5151.72" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5581" y="-5136.72" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5581" y="-5121.72" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5581" y="-5106.72" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_10_all2all&#45;&gt;layer_10_expert_12 -->
<g id="edge396" class="edge">
<title>layer_10_all2all&#45;&gt;layer_10_expert_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4608.31,-5287.96C4782.58,-5282.5 5089.41,-5265.84 5347,-5214.92 5384.2,-5207.56 5423.83,-5196.43 5459.7,-5185.04"/>
<polygon fill="black" stroke="black" points="5460.77,-5188.38 5469.22,-5181.99 5458.63,-5181.71 5460.77,-5188.38"/>
<text text-anchor="middle" x="5501" y="-5203.72" font-family="Times,serif" font-size="14.00">tokens routed to expert 12</text>
</g>
<!-- layer_10_expert_13 -->
<g id="node238" class="node">
<title>layer_10_expert_13</title>
<polygon fill="lightblue" stroke="black" points="5989,-5181.92 5729,-5181.92 5729,-5098.92 5989,-5098.92 5989,-5181.92"/>
<text text-anchor="middle" x="5859" y="-5166.72" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="5859" y="-5151.72" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5859" y="-5136.72" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5859" y="-5121.72" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5859" y="-5106.72" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_10_all2all&#45;&gt;layer_10_expert_13 -->
<g id="edge397" class="edge">
<title>layer_10_all2all&#45;&gt;layer_10_expert_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4608.61,-5290.38C4823.38,-5287.99 5247.12,-5275.17 5601,-5214.92 5642.67,-5207.82 5687.23,-5196.52 5727.38,-5184.88"/>
<polygon fill="black" stroke="black" points="5728.61,-5188.17 5737.22,-5182 5726.64,-5181.45 5728.61,-5188.17"/>
<text text-anchor="middle" x="5761" y="-5203.72" font-family="Times,serif" font-size="14.00">tokens routed to expert 13</text>
</g>
<!-- layer_10_expert_14 -->
<g id="node239" class="node">
<title>layer_10_expert_14</title>
<polygon fill="lightblue" stroke="black" points="6267,-5181.92 6007,-5181.92 6007,-5098.92 6267,-5098.92 6267,-5181.92"/>
<text text-anchor="middle" x="6137" y="-5166.72" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="6137" y="-5151.72" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6137" y="-5136.72" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6137" y="-5121.72" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6137" y="-5106.72" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_10_all2all&#45;&gt;layer_10_expert_14 -->
<g id="edge398" class="edge">
<title>layer_10_all2all&#45;&gt;layer_10_expert_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4608.63,-5291.39C4860.34,-5290.94 5406.3,-5281.48 5861,-5214.92 5906.73,-5208.22 5955.74,-5196.66 5999.59,-5184.66"/>
<polygon fill="black" stroke="black" points="6000.74,-5187.98 6009.45,-5181.94 5998.87,-5181.23 6000.74,-5187.98"/>
<text text-anchor="middle" x="6033" y="-5203.72" font-family="Times,serif" font-size="14.00">tokens routed to expert 14</text>
</g>
<!-- layer_10_expert_15 -->
<g id="node240" class="node">
<title>layer_10_expert_15</title>
<polygon fill="lightblue" stroke="black" points="6545,-5181.92 6285,-5181.92 6285,-5098.92 6545,-5098.92 6545,-5181.92"/>
<text text-anchor="middle" x="6415" y="-5166.72" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="6415" y="-5151.72" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6415" y="-5136.72" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6415" y="-5121.72" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6415" y="-5106.72" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_10_all2all&#45;&gt;layer_10_expert_15 -->
<g id="edge399" class="edge">
<title>layer_10_all2all&#45;&gt;layer_10_expert_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4608.05,-5287.53C4952.75,-5279.38 5839.95,-5255.06 6133,-5214.92 6180.17,-5208.46 6230.76,-5196.82 6275.89,-5184.67"/>
<polygon fill="black" stroke="black" points="6277,-5188 6285.73,-5182 6275.16,-5181.25 6277,-5188"/>
<text text-anchor="middle" x="6307" y="-5203.72" font-family="Times,serif" font-size="14.00">tokens routed to expert 15</text>
</g>
<!-- layer_10_all2all_result -->
<g id="node241" class="node">
<title>layer_10_all2all_result</title>
<ellipse fill="yellow" stroke="black" cx="4469" cy="-5003.23" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="4469" y="-5029.53" font-family="Times,serif" font-size="14.00">Layer 10</text>
<text text-anchor="middle" x="4469" y="-5014.53" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Result Merge</text>
<text text-anchor="middle" x="4469" y="-4999.53" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="4469" y="-4984.53" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="4469" y="-4969.53" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_10_expert_0&#45;&gt;layer_10_all2all_result -->
<g id="edge400" class="edge">
<title>layer_10_expert_0&#45;&gt;layer_10_all2all_result</title>
<path fill="none" stroke="black" d="M2375,-5100.52C2378.02,-5099.95 2381.02,-5099.41 2384,-5098.92 2756.89,-5037.04 3906.76,-5013.13 4319.55,-5006.4"/>
<polygon fill="black" stroke="black" points="4319.81,-5009.89 4329.76,-5006.23 4319.7,-5002.89 4319.81,-5009.89"/>
</g>
<!-- layer_10_expert_1&#45;&gt;layer_10_all2all_result -->
<g id="edge401" class="edge">
<title>layer_10_expert_1&#45;&gt;layer_10_all2all_result</title>
<path fill="none" stroke="black" d="M2653.01,-5100.55C2656.03,-5099.97 2659.03,-5099.42 2662,-5098.92 2979.38,-5045.11 3946.71,-5016.77 4319.92,-5007.6"/>
<polygon fill="black" stroke="black" points="4320.07,-5011.1 4329.98,-5007.36 4319.9,-5004.1 4320.07,-5011.1"/>
</g>
<!-- layer_10_expert_2&#45;&gt;layer_10_all2all_result -->
<g id="edge402" class="edge">
<title>layer_10_expert_2&#45;&gt;layer_10_all2all_result</title>
<path fill="none" stroke="black" d="M2931.01,-5100.59C2934.03,-5099.99 2937.03,-5099.44 2940,-5098.92 3202.24,-5053.18 3989.24,-5021.07 4320,-5009.25"/>
<polygon fill="black" stroke="black" points="4320.26,-5012.74 4330.13,-5008.89 4320.01,-5005.74 4320.26,-5012.74"/>
</g>
<!-- layer_10_expert_3&#45;&gt;layer_10_all2all_result -->
<g id="edge403" class="edge">
<title>layer_10_expert_3&#45;&gt;layer_10_all2all_result</title>
<path fill="none" stroke="black" d="M3209.02,-5100.64C3212.04,-5100.03 3215.03,-5099.46 3218,-5098.92 3611.23,-5027.55 4083.45,-5009.84 4319.41,-5005.54"/>
<polygon fill="black" stroke="black" points="4319.49,-5009.04 4329.43,-5005.36 4319.37,-5002.04 4319.49,-5009.04"/>
</g>
<!-- layer_10_expert_4&#45;&gt;layer_10_all2all_result -->
<g id="edge404" class="edge">
<title>layer_10_expert_4&#45;&gt;layer_10_all2all_result</title>
<path fill="none" stroke="black" d="M3487.04,-5100.73C3490.05,-5100.09 3493.04,-5099.49 3496,-5098.92 3784.78,-5043.3 4128.4,-5019.59 4320.32,-5010.08"/>
<polygon fill="black" stroke="black" points="4320.66,-5013.56 4330.47,-5009.58 4320.32,-5006.57 4320.66,-5013.56"/>
</g>
<!-- layer_10_expert_5&#45;&gt;layer_10_all2all_result -->
<g id="edge405" class="edge">
<title>layer_10_expert_5&#45;&gt;layer_10_all2all_result</title>
<path fill="none" stroke="black" d="M3765.07,-5100.89C3768.07,-5100.2 3771.05,-5099.54 3774,-5098.92 3961.71,-5059.01 4181.69,-5032.35 4323.08,-5017.76"/>
<polygon fill="black" stroke="black" points="4323.53,-5021.23 4333.12,-5016.73 4322.81,-5014.27 4323.53,-5021.23"/>
</g>
<!-- layer_10_expert_6&#45;&gt;layer_10_all2all_result -->
<g id="edge406" class="edge">
<title>layer_10_expert_6&#45;&gt;layer_10_all2all_result</title>
<path fill="none" stroke="black" d="M4043.15,-5101.24C4046.13,-5100.45 4049.08,-5099.67 4052,-5098.92 4146.1,-5074.55 4253.02,-5050.34 4335.03,-5032.5"/>
<polygon fill="black" stroke="black" points="4335.88,-5035.9 4344.91,-5030.36 4334.39,-5029.06 4335.88,-5035.9"/>
</g>
<!-- layer_10_expert_7&#45;&gt;layer_10_all2all_result -->
<g id="edge407" class="edge">
<title>layer_10_expert_7&#45;&gt;layer_10_all2all_result</title>
<path fill="none" stroke="black" d="M4274.41,-5098.86C4304.4,-5084.27 4338.51,-5067.68 4369.72,-5052.51"/>
<polygon fill="black" stroke="black" points="4371.41,-5055.58 4378.87,-5048.06 4368.34,-5049.28 4371.41,-5055.58"/>
</g>
<!-- layer_10_expert_8&#45;&gt;layer_10_all2all_result -->
<g id="edge408" class="edge">
<title>layer_10_expert_8&#45;&gt;layer_10_all2all_result</title>
<path fill="none" stroke="black" d="M4469,-5098.86C4469,-5090.49 4469,-5081.47 4469,-5072.43"/>
<polygon fill="black" stroke="black" points="4472.5,-5072.25 4469,-5062.25 4465.5,-5072.25 4472.5,-5072.25"/>
</g>
<!-- layer_10_expert_9&#45;&gt;layer_10_all2all_result -->
<g id="edge409" class="edge">
<title>layer_10_expert_9&#45;&gt;layer_10_all2all_result</title>
<path fill="none" stroke="black" d="M4663.59,-5098.86C4633.6,-5084.27 4599.49,-5067.68 4568.28,-5052.51"/>
<polygon fill="black" stroke="black" points="4569.66,-5049.28 4559.13,-5048.06 4566.59,-5055.58 4569.66,-5049.28"/>
</g>
<!-- layer_10_expert_10&#45;&gt;layer_10_all2all_result -->
<g id="edge410" class="edge">
<title>layer_10_expert_10&#45;&gt;layer_10_all2all_result</title>
<path fill="none" stroke="black" d="M4894.85,-5101.24C4891.87,-5100.45 4888.92,-5099.67 4886,-5098.92 4791.9,-5074.55 4684.98,-5050.34 4602.97,-5032.5"/>
<polygon fill="black" stroke="black" points="4603.61,-5029.06 4593.09,-5030.36 4602.12,-5035.9 4603.61,-5029.06"/>
</g>
<!-- layer_10_expert_11&#45;&gt;layer_10_all2all_result -->
<g id="edge411" class="edge">
<title>layer_10_expert_11&#45;&gt;layer_10_all2all_result</title>
<path fill="none" stroke="black" d="M5172.93,-5100.89C5169.93,-5100.2 5166.95,-5099.54 5164,-5098.92 4976.29,-5059.01 4756.31,-5032.35 4614.92,-5017.76"/>
<polygon fill="black" stroke="black" points="4615.19,-5014.27 4604.88,-5016.73 4614.47,-5021.23 4615.19,-5014.27"/>
</g>
<!-- layer_10_expert_12&#45;&gt;layer_10_all2all_result -->
<g id="edge412" class="edge">
<title>layer_10_expert_12&#45;&gt;layer_10_all2all_result</title>
<path fill="none" stroke="black" d="M5450.96,-5100.73C5447.95,-5100.09 5444.96,-5099.49 5442,-5098.92 5153.22,-5043.3 4809.6,-5019.59 4617.68,-5010.08"/>
<polygon fill="black" stroke="black" points="4617.68,-5006.57 4607.53,-5009.58 4617.34,-5013.56 4617.68,-5006.57"/>
</g>
<!-- layer_10_expert_13&#45;&gt;layer_10_all2all_result -->
<g id="edge413" class="edge">
<title>layer_10_expert_13&#45;&gt;layer_10_all2all_result</title>
<path fill="none" stroke="black" d="M5728.98,-5100.64C5725.96,-5100.03 5722.97,-5099.46 5720,-5098.92 5326.77,-5027.55 4854.55,-5009.84 4618.59,-5005.54"/>
<polygon fill="black" stroke="black" points="4618.63,-5002.04 4608.57,-5005.36 4618.51,-5009.04 4618.63,-5002.04"/>
</g>
<!-- layer_10_expert_14&#45;&gt;layer_10_all2all_result -->
<g id="edge414" class="edge">
<title>layer_10_expert_14&#45;&gt;layer_10_all2all_result</title>
<path fill="none" stroke="black" d="M6006.99,-5100.59C6003.97,-5099.99 6000.97,-5099.44 5998,-5098.92 5735.76,-5053.18 4948.76,-5021.07 4618,-5009.25"/>
<polygon fill="black" stroke="black" points="4617.99,-5005.74 4607.87,-5008.89 4617.74,-5012.74 4617.99,-5005.74"/>
</g>
<!-- layer_10_expert_15&#45;&gt;layer_10_all2all_result -->
<g id="edge415" class="edge">
<title>layer_10_expert_15&#45;&gt;layer_10_all2all_result</title>
<path fill="none" stroke="black" d="M6284.99,-5100.55C6281.97,-5099.97 6278.97,-5099.42 6276,-5098.92 5958.62,-5045.11 4991.29,-5016.77 4618.08,-5007.6"/>
<polygon fill="black" stroke="black" points="4618.1,-5004.1 4608.02,-5007.36 4617.93,-5011.1 4618.1,-5004.1"/>
</g>
<!-- layer_10_expert_agg -->
<g id="node242" class="node">
<title>layer_10_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="6063,-4907.54 5815,-4907.54 5815,-4824.54 6063,-4824.54 6063,-4907.54"/>
<text text-anchor="middle" x="5939" y="-4892.34" font-family="Times,serif" font-size="14.00">Layer 10</text>
<text text-anchor="middle" x="5939" y="-4877.34" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="5939" y="-4862.34" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5939" y="-4847.34" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="5939" y="-4832.34" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_10_all2all_result&#45;&gt;layer_10_expert_agg -->
<g id="edge416" class="edge">
<title>layer_10_all2all_result&#45;&gt;layer_10_expert_agg</title>
<path fill="none" stroke="black" d="M4604.66,-4989.75C4885.06,-4963.96 5525.53,-4905.06 5804.73,-4879.39"/>
<polygon fill="black" stroke="black" points="5805.28,-4882.85 5814.92,-4878.45 5804.64,-4875.88 5805.28,-4882.85"/>
</g>
<!-- layer_10_expert_agg&#45;&gt;layer_10_residual -->
<g id="edge418" class="edge">
<title>layer_10_expert_agg&#45;&gt;layer_10_residual</title>
<path fill="none" stroke="black" d="M6063.21,-4839.14C6141.7,-4822.78 6244.29,-4801.39 6330.85,-4783.35"/>
<polygon fill="black" stroke="black" points="6331.7,-4786.74 6340.78,-4781.27 6330.28,-4779.89 6331.7,-4786.74"/>
</g>
<!-- layer_11_mha -->
<g id="node244" class="node">
<title>layer_11_mha</title>
<polygon fill="lightblue" stroke="black" points="6606.5,-4667.54 6403.5,-4667.54 6403.5,-4584.54 6606.5,-4584.54 6606.5,-4667.54"/>
<text text-anchor="middle" x="6505" y="-4652.34" font-family="Times,serif" font-size="14.00">Layer 11</text>
<text text-anchor="middle" x="6505" y="-4637.34" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="6505" y="-4622.34" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="6505" y="-4607.34" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="6505" y="-4592.34" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_10_residual&#45;&gt;layer_11_mha -->
<g id="edge419" class="edge">
<title>layer_10_residual&#45;&gt;layer_11_mha</title>
<path fill="none" stroke="black" d="M6505,-4704.43C6505,-4695.9 6505,-4686.8 6505,-4677.95"/>
<polygon fill="black" stroke="black" points="6508.5,-4677.72 6505,-4667.72 6501.5,-4677.72 6508.5,-4677.72"/>
</g>
<!-- layer_11_gate -->
<g id="node245" class="node">
<title>layer_11_gate</title>
<polygon fill="lightblue" stroke="black" points="6292.5,-4547.54 6093.5,-4547.54 6093.5,-4464.54 6292.5,-4464.54 6292.5,-4547.54"/>
<text text-anchor="middle" x="6193" y="-4532.34" font-family="Times,serif" font-size="14.00">Layer 11</text>
<text text-anchor="middle" x="6193" y="-4517.34" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="6193" y="-4502.34" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="6193" y="-4487.34" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="6193" y="-4472.34" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_11_mha&#45;&gt;layer_11_gate -->
<g id="edge420" class="edge">
<title>layer_11_mha&#45;&gt;layer_11_gate</title>
<path fill="none" stroke="black" d="M6403.27,-4586.56C6370.98,-4574.35 6335.15,-4560.8 6302.35,-4548.39"/>
<polygon fill="black" stroke="black" points="6303.32,-4545.02 6292.73,-4544.75 6300.84,-4551.57 6303.32,-4545.02"/>
</g>
<!-- layer_11_residual -->
<g id="node265" class="node">
<title>layer_11_residual</title>
<polygon fill="lightblue" stroke="black" points="6905,-3864.78 6577,-3864.78 6577,-3781.78 6905,-3781.78 6905,-3864.78"/>
<text text-anchor="middle" x="6741" y="-3849.58" font-family="Times,serif" font-size="14.00">Layer 11</text>
<text text-anchor="middle" x="6741" y="-3834.58" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="6741" y="-3819.58" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="6741" y="-3804.58" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="6741" y="-3789.58" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_11_mha&#45;&gt;layer_11_residual -->
<g id="edge455" class="edge">
<title>layer_11_mha&#45;&gt;layer_11_residual</title>
<path fill="none" stroke="black" d="M6606.73,-4606.61C6697.78,-4587.12 6817,-4552.86 6817,-4507.04 6817,-4507.04 6817,-4507.04 6817,-3942.28 6817,-3916.9 6804.42,-3892.64 6789.5,-3872.79"/>
<polygon fill="black" stroke="black" points="6792.17,-3870.52 6783.22,-3864.84 6786.67,-3874.86 6792.17,-3870.52"/>
<text text-anchor="middle" x="6845" y="-4213.96" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_11_all2all -->
<g id="node246" class="node">
<title>layer_11_all2all</title>
<ellipse fill="yellow" stroke="black" cx="4705" cy="-4368.85" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="4705" y="-4395.15" font-family="Times,serif" font-size="14.00">Layer 11</text>
<text text-anchor="middle" x="4705" y="-4380.15" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="4705" y="-4365.15" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="4705" y="-4350.15" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="4705" y="-4335.15" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_11_gate&#45;&gt;layer_11_all2all -->
<g id="edge421" class="edge">
<title>layer_11_gate&#45;&gt;layer_11_all2all</title>
<path fill="none" stroke="black" d="M6093.35,-4495.98C5836.76,-4472.67 5152.46,-4410.5 4851.03,-4383.11"/>
<polygon fill="black" stroke="black" points="4851.18,-4379.61 4840.91,-4382.2 4850.55,-4386.59 4851.18,-4379.61"/>
</g>
<!-- layer_11_expert_0 -->
<g id="node247" class="node">
<title>layer_11_expert_0</title>
<polygon fill="lightblue" stroke="black" points="2611,-4259.16 2351,-4259.16 2351,-4176.16 2611,-4176.16 2611,-4259.16"/>
<text text-anchor="middle" x="2481" y="-4243.96" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2481" y="-4228.96" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2481" y="-4213.96" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2481" y="-4198.96" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2481" y="-4183.96" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_11_all2all&#45;&gt;layer_11_expert_0 -->
<g id="edge422" class="edge">
<title>layer_11_all2all&#45;&gt;layer_11_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4565.71,-4365.05C4185.55,-4356.99 3135.72,-4331.7 2792,-4292.16 2717.84,-4283.63 2697.33,-4277.88 2621.2,-4259.41"/>
<polygon fill="black" stroke="black" points="2621.66,-4255.92 2611.12,-4256.97 2620.02,-4262.73 2621.66,-4255.92"/>
<text text-anchor="middle" x="2883.5" y="-4280.96" font-family="Times,serif" font-size="14.00">tokens routed to expert 0</text>
</g>
<!-- layer_11_expert_1 -->
<g id="node248" class="node">
<title>layer_11_expert_1</title>
<polygon fill="lightblue" stroke="black" points="2889,-4259.16 2629,-4259.16 2629,-4176.16 2889,-4176.16 2889,-4259.16"/>
<text text-anchor="middle" x="2759" y="-4243.96" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2759" y="-4228.96" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2759" y="-4213.96" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2759" y="-4198.96" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2759" y="-4183.96" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_11_all2all&#45;&gt;layer_11_expert_1 -->
<g id="edge423" class="edge">
<title>layer_11_all2all&#45;&gt;layer_11_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4565.56,-4368.45C4281.78,-4368.14 3617.12,-4359.51 3064,-4292.16 3009.4,-4285.51 2950.41,-4272.67 2898.99,-4259.55"/>
<polygon fill="black" stroke="black" points="2899.71,-4256.12 2889.15,-4257.02 2897.96,-4262.9 2899.71,-4256.12"/>
<text text-anchor="middle" x="3155.5" y="-4280.96" font-family="Times,serif" font-size="14.00">tokens routed to expert 1</text>
</g>
<!-- layer_11_expert_2 -->
<g id="node249" class="node">
<title>layer_11_expert_2</title>
<polygon fill="lightblue" stroke="black" points="3167,-4259.16 2907,-4259.16 2907,-4176.16 3167,-4176.16 3167,-4259.16"/>
<text text-anchor="middle" x="3037" y="-4243.96" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3037" y="-4228.96" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3037" y="-4213.96" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3037" y="-4198.96" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3037" y="-4183.96" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_11_all2all&#45;&gt;layer_11_expert_2 -->
<g id="edge424" class="edge">
<title>layer_11_all2all&#45;&gt;layer_11_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4565.7,-4367.08C4317.22,-4364.16 3781.6,-4350.92 3334,-4292.16 3282.03,-4285.34 3226,-4272.85 3176.76,-4260.09"/>
<polygon fill="black" stroke="black" points="3177.57,-4256.68 3167.01,-4257.53 3175.8,-4263.45 3177.57,-4256.68"/>
<text text-anchor="middle" x="3425.5" y="-4280.96" font-family="Times,serif" font-size="14.00">tokens routed to expert 2</text>
</g>
<!-- layer_11_expert_3 -->
<g id="node250" class="node">
<title>layer_11_expert_3</title>
<polygon fill="lightblue" stroke="black" points="3445,-4259.16 3185,-4259.16 3185,-4176.16 3445,-4176.16 3445,-4259.16"/>
<text text-anchor="middle" x="3315" y="-4243.96" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3315" y="-4228.96" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3315" y="-4213.96" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3315" y="-4198.96" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3315" y="-4183.96" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_11_all2all&#45;&gt;layer_11_expert_3 -->
<g id="edge425" class="edge">
<title>layer_11_all2all&#45;&gt;layer_11_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4565.67,-4365.9C4353.95,-4361.25 3939.01,-4345.5 3591,-4292.16 3545.77,-4285.22 3497.29,-4273.74 3453.78,-4261.89"/>
<polygon fill="black" stroke="black" points="3454.57,-4258.47 3444,-4259.19 3452.71,-4265.22 3454.57,-4258.47"/>
<text text-anchor="middle" x="3682.5" y="-4280.96" font-family="Times,serif" font-size="14.00">tokens routed to expert 3</text>
</g>
<!-- layer_11_expert_4 -->
<g id="node251" class="node">
<title>layer_11_expert_4</title>
<polygon fill="lightblue" stroke="black" points="3723,-4259.16 3463,-4259.16 3463,-4176.16 3723,-4176.16 3723,-4259.16"/>
<text text-anchor="middle" x="3593" y="-4243.96" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="3593" y="-4228.96" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3593" y="-4213.96" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3593" y="-4198.96" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3593" y="-4183.96" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_11_all2all&#45;&gt;layer_11_expert_4 -->
<g id="edge426" class="edge">
<title>layer_11_all2all&#45;&gt;layer_11_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4565.78,-4364.24C4394.04,-4357.82 4093.77,-4340.18 3841,-4292.16 3801.65,-4284.68 3759.62,-4273.49 3721.55,-4262.09"/>
<polygon fill="black" stroke="black" points="3722.54,-4258.73 3711.96,-4259.18 3720.51,-4265.43 3722.54,-4258.73"/>
<text text-anchor="middle" x="3932.5" y="-4280.96" font-family="Times,serif" font-size="14.00">tokens routed to expert 4</text>
</g>
<!-- layer_11_expert_5 -->
<g id="node252" class="node">
<title>layer_11_expert_5</title>
<polygon fill="lightblue" stroke="black" points="4001,-4259.16 3741,-4259.16 3741,-4176.16 4001,-4176.16 4001,-4259.16"/>
<text text-anchor="middle" x="3871" y="-4243.96" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="3871" y="-4228.96" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3871" y="-4213.96" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3871" y="-4198.96" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3871" y="-4183.96" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_11_all2all&#45;&gt;layer_11_expert_5 -->
<g id="edge427" class="edge">
<title>layer_11_all2all&#45;&gt;layer_11_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4567.18,-4359.71C4439.75,-4350.16 4245.74,-4330.5 4081,-4292.16 4048.44,-4284.58 4013.89,-4273.72 3982.43,-4262.67"/>
<polygon fill="black" stroke="black" points="3983.36,-4259.29 3972.76,-4259.24 3981.02,-4265.89 3983.36,-4259.29"/>
<text text-anchor="middle" x="4172.5" y="-4280.96" font-family="Times,serif" font-size="14.00">tokens routed to expert 5</text>
</g>
<!-- layer_11_expert_6 -->
<g id="node253" class="node">
<title>layer_11_expert_6</title>
<polygon fill="lightblue" stroke="black" points="4279,-4259.16 4019,-4259.16 4019,-4176.16 4279,-4176.16 4279,-4259.16"/>
<text text-anchor="middle" x="4149" y="-4243.96" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="4149" y="-4228.96" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4149" y="-4213.96" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4149" y="-4198.96" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4149" y="-4183.96" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_11_all2all&#45;&gt;layer_11_expert_6 -->
<g id="edge428" class="edge">
<title>layer_11_all2all&#45;&gt;layer_11_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4572.36,-4350.7C4494.49,-4338.61 4394.83,-4319.63 4309,-4292.16 4284.84,-4284.43 4259.53,-4273.98 4236.36,-4263.4"/>
<polygon fill="black" stroke="black" points="4237.79,-4260.21 4227.25,-4259.18 4234.85,-4266.56 4237.79,-4260.21"/>
<text text-anchor="middle" x="4400.5" y="-4280.96" font-family="Times,serif" font-size="14.00">tokens routed to expert 6</text>
</g>
<!-- layer_11_expert_7 -->
<g id="node254" class="node">
<title>layer_11_expert_7</title>
<polygon fill="lightblue" stroke="black" points="4557,-4259.16 4297,-4259.16 4297,-4176.16 4557,-4176.16 4557,-4259.16"/>
<text text-anchor="middle" x="4427" y="-4243.96" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="4427" y="-4228.96" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4427" y="-4213.96" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4427" y="-4198.96" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4427" y="-4183.96" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_11_all2all&#45;&gt;layer_11_expert_7 -->
<g id="edge429" class="edge">
<title>layer_11_all2all&#45;&gt;layer_11_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4598.06,-4330.87C4571.17,-4319.89 4542.9,-4306.81 4518,-4292.16 4504.94,-4284.47 4491.75,-4275.01 4479.63,-4265.48"/>
<polygon fill="black" stroke="black" points="4481.82,-4262.75 4471.83,-4259.22 4477.44,-4268.2 4481.82,-4262.75"/>
<text text-anchor="middle" x="4609.5" y="-4280.96" font-family="Times,serif" font-size="14.00">tokens routed to expert 7</text>
</g>
<!-- layer_11_expert_8 -->
<g id="node255" class="node">
<title>layer_11_expert_8</title>
<polygon fill="lightblue" stroke="black" points="4835,-4259.16 4575,-4259.16 4575,-4176.16 4835,-4176.16 4835,-4259.16"/>
<text text-anchor="middle" x="4705" y="-4243.96" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="4705" y="-4228.96" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4705" y="-4213.96" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4705" y="-4198.96" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4705" y="-4183.96" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_11_all2all&#45;&gt;layer_11_expert_8 -->
<g id="edge430" class="edge">
<title>layer_11_all2all&#45;&gt;layer_11_expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4705,-4309.74C4705,-4296.44 4705,-4282.41 4705,-4269.44"/>
<polygon fill="black" stroke="black" points="4708.5,-4269.31 4705,-4259.31 4701.5,-4269.31 4708.5,-4269.31"/>
<text text-anchor="middle" x="4796.5" y="-4280.96" font-family="Times,serif" font-size="14.00">tokens routed to expert 8</text>
</g>
<!-- layer_11_expert_9 -->
<g id="node256" class="node">
<title>layer_11_expert_9</title>
<polygon fill="lightblue" stroke="black" points="5113,-4259.16 4853,-4259.16 4853,-4176.16 5113,-4176.16 5113,-4259.16"/>
<text text-anchor="middle" x="4983" y="-4243.96" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="4983" y="-4228.96" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4983" y="-4213.96" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4983" y="-4198.96" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4983" y="-4183.96" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_11_all2all&#45;&gt;layer_11_expert_9 -->
<g id="edge431" class="edge">
<title>layer_11_all2all&#45;&gt;layer_11_expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4811.94,-4330.87C4838.83,-4319.89 4867.1,-4306.81 4892,-4292.16 4905.06,-4284.47 4918.25,-4275.01 4930.37,-4265.48"/>
<polygon fill="black" stroke="black" points="4932.56,-4268.2 4938.17,-4259.22 4928.18,-4262.75 4932.56,-4268.2"/>
<text text-anchor="middle" x="5004.5" y="-4280.96" font-family="Times,serif" font-size="14.00">tokens routed to expert 9</text>
</g>
<!-- layer_11_expert_10 -->
<g id="node257" class="node">
<title>layer_11_expert_10</title>
<polygon fill="lightblue" stroke="black" points="5391,-4259.16 5131,-4259.16 5131,-4176.16 5391,-4176.16 5391,-4259.16"/>
<text text-anchor="middle" x="5261" y="-4243.96" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="5261" y="-4228.96" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5261" y="-4213.96" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5261" y="-4198.96" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5261" y="-4183.96" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_11_all2all&#45;&gt;layer_11_expert_10 -->
<g id="edge432" class="edge">
<title>layer_11_all2all&#45;&gt;layer_11_expert_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4837.73,-4350.52C4915.33,-4338.39 5014.52,-4319.43 5100,-4292.16 5124.29,-4284.41 5149.75,-4273.96 5173.07,-4263.38"/>
<polygon fill="black" stroke="black" points="5174.61,-4266.52 5182.24,-4259.16 5171.69,-4260.16 5174.61,-4266.52"/>
<text text-anchor="middle" x="5236" y="-4280.96" font-family="Times,serif" font-size="14.00">tokens routed to expert 10</text>
</g>
<!-- layer_11_expert_11 -->
<g id="node258" class="node">
<title>layer_11_expert_11</title>
<polygon fill="lightblue" stroke="black" points="5669,-4259.16 5409,-4259.16 5409,-4176.16 5669,-4176.16 5669,-4259.16"/>
<text text-anchor="middle" x="5539" y="-4243.96" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="5539" y="-4228.96" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5539" y="-4213.96" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5539" y="-4198.96" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5539" y="-4183.96" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_11_all2all&#45;&gt;layer_11_expert_11 -->
<g id="edge433" class="edge">
<title>layer_11_all2all&#45;&gt;layer_11_expert_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4842.9,-4360.38C4971.81,-4351.27 5168.95,-4331.87 5336,-4292.16 5367.51,-4284.67 5400.87,-4273.86 5431.25,-4262.83"/>
<polygon fill="black" stroke="black" points="5432.82,-4265.98 5441,-4259.25 5430.4,-4259.41 5432.82,-4265.98"/>
<text text-anchor="middle" x="5483" y="-4280.96" font-family="Times,serif" font-size="14.00">tokens routed to expert 11</text>
</g>
<!-- layer_11_expert_12 -->
<g id="node259" class="node">
<title>layer_11_expert_12</title>
<polygon fill="lightblue" stroke="black" points="5947,-4259.16 5687,-4259.16 5687,-4176.16 5947,-4176.16 5947,-4259.16"/>
<text text-anchor="middle" x="5817" y="-4243.96" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="5817" y="-4228.96" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5817" y="-4213.96" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5817" y="-4198.96" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5817" y="-4183.96" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_11_all2all&#45;&gt;layer_11_expert_12 -->
<g id="edge434" class="edge">
<title>layer_11_all2all&#45;&gt;layer_11_expert_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4844.31,-4365.2C5018.58,-4359.74 5325.41,-4343.08 5583,-4292.16 5620.2,-4284.8 5659.83,-4273.67 5695.7,-4262.28"/>
<polygon fill="black" stroke="black" points="5696.77,-4265.62 5705.22,-4259.23 5694.63,-4258.95 5696.77,-4265.62"/>
<text text-anchor="middle" x="5737" y="-4280.96" font-family="Times,serif" font-size="14.00">tokens routed to expert 12</text>
</g>
<!-- layer_11_expert_13 -->
<g id="node260" class="node">
<title>layer_11_expert_13</title>
<polygon fill="lightblue" stroke="black" points="6225,-4259.16 5965,-4259.16 5965,-4176.16 6225,-4176.16 6225,-4259.16"/>
<text text-anchor="middle" x="6095" y="-4243.96" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="6095" y="-4228.96" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6095" y="-4213.96" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6095" y="-4198.96" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6095" y="-4183.96" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_11_all2all&#45;&gt;layer_11_expert_13 -->
<g id="edge435" class="edge">
<title>layer_11_all2all&#45;&gt;layer_11_expert_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4844.61,-4367.62C5059.38,-4365.23 5483.12,-4352.41 5837,-4292.16 5878.67,-4285.06 5923.23,-4273.76 5963.38,-4262.12"/>
<polygon fill="black" stroke="black" points="5964.61,-4265.41 5973.22,-4259.24 5962.64,-4258.69 5964.61,-4265.41"/>
<text text-anchor="middle" x="5997" y="-4280.96" font-family="Times,serif" font-size="14.00">tokens routed to expert 13</text>
</g>
<!-- layer_11_expert_14 -->
<g id="node261" class="node">
<title>layer_11_expert_14</title>
<polygon fill="lightblue" stroke="black" points="6503,-4259.16 6243,-4259.16 6243,-4176.16 6503,-4176.16 6503,-4259.16"/>
<text text-anchor="middle" x="6373" y="-4243.96" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="6373" y="-4228.96" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6373" y="-4213.96" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6373" y="-4198.96" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6373" y="-4183.96" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_11_all2all&#45;&gt;layer_11_expert_14 -->
<g id="edge436" class="edge">
<title>layer_11_all2all&#45;&gt;layer_11_expert_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4844.63,-4368.63C5096.34,-4368.18 5642.3,-4358.72 6097,-4292.16 6142.73,-4285.46 6191.74,-4273.9 6235.59,-4261.9"/>
<polygon fill="black" stroke="black" points="6236.74,-4265.22 6245.45,-4259.18 6234.87,-4258.47 6236.74,-4265.22"/>
<text text-anchor="middle" x="6269" y="-4280.96" font-family="Times,serif" font-size="14.00">tokens routed to expert 14</text>
</g>
<!-- layer_11_expert_15 -->
<g id="node262" class="node">
<title>layer_11_expert_15</title>
<polygon fill="lightblue" stroke="black" points="6781,-4259.16 6521,-4259.16 6521,-4176.16 6781,-4176.16 6781,-4259.16"/>
<text text-anchor="middle" x="6651" y="-4243.96" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="6651" y="-4228.96" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6651" y="-4213.96" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6651" y="-4198.96" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6651" y="-4183.96" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_11_all2all&#45;&gt;layer_11_expert_15 -->
<g id="edge437" class="edge">
<title>layer_11_all2all&#45;&gt;layer_11_expert_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4844.05,-4364.77C5188.75,-4356.62 6075.95,-4332.3 6369,-4292.16 6416.17,-4285.7 6466.76,-4274.06 6511.89,-4261.92"/>
<polygon fill="black" stroke="black" points="6513,-4265.24 6521.73,-4259.24 6511.16,-4258.49 6513,-4265.24"/>
<text text-anchor="middle" x="6543" y="-4280.96" font-family="Times,serif" font-size="14.00">tokens routed to expert 15</text>
</g>
<!-- layer_11_all2all_result -->
<g id="node263" class="node">
<title>layer_11_all2all_result</title>
<ellipse fill="yellow" stroke="black" cx="4705" cy="-4080.47" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="4705" y="-4106.77" font-family="Times,serif" font-size="14.00">Layer 11</text>
<text text-anchor="middle" x="4705" y="-4091.77" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Result Merge</text>
<text text-anchor="middle" x="4705" y="-4076.77" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="4705" y="-4061.77" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="4705" y="-4046.77" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_11_expert_0&#45;&gt;layer_11_all2all_result -->
<g id="edge438" class="edge">
<title>layer_11_expert_0&#45;&gt;layer_11_all2all_result</title>
<path fill="none" stroke="black" d="M2611,-4177.76C2614.02,-4177.19 2617.02,-4176.65 2620,-4176.16 2992.89,-4114.28 4142.76,-4090.37 4555.55,-4083.64"/>
<polygon fill="black" stroke="black" points="4555.81,-4087.13 4565.76,-4083.47 4555.7,-4080.14 4555.81,-4087.13"/>
</g>
<!-- layer_11_expert_1&#45;&gt;layer_11_all2all_result -->
<g id="edge439" class="edge">
<title>layer_11_expert_1&#45;&gt;layer_11_all2all_result</title>
<path fill="none" stroke="black" d="M2889.01,-4177.79C2892.03,-4177.21 2895.03,-4176.66 2898,-4176.16 3215.38,-4122.35 4182.71,-4094.01 4555.92,-4084.84"/>
<polygon fill="black" stroke="black" points="4556.07,-4088.34 4565.98,-4084.6 4555.9,-4081.34 4556.07,-4088.34"/>
</g>
<!-- layer_11_expert_2&#45;&gt;layer_11_all2all_result -->
<g id="edge440" class="edge">
<title>layer_11_expert_2&#45;&gt;layer_11_all2all_result</title>
<path fill="none" stroke="black" d="M3167.01,-4177.83C3170.03,-4177.23 3173.03,-4176.68 3176,-4176.16 3438.24,-4130.42 4225.24,-4098.31 4556,-4086.49"/>
<polygon fill="black" stroke="black" points="4556.26,-4089.98 4566.13,-4086.13 4556.01,-4082.98 4556.26,-4089.98"/>
</g>
<!-- layer_11_expert_3&#45;&gt;layer_11_all2all_result -->
<g id="edge441" class="edge">
<title>layer_11_expert_3&#45;&gt;layer_11_all2all_result</title>
<path fill="none" stroke="black" d="M3445.02,-4177.88C3448.04,-4177.27 3451.03,-4176.7 3454,-4176.16 3847.23,-4104.79 4319.45,-4087.08 4555.41,-4082.78"/>
<polygon fill="black" stroke="black" points="4555.49,-4086.28 4565.43,-4082.6 4555.37,-4079.28 4555.49,-4086.28"/>
</g>
<!-- layer_11_expert_4&#45;&gt;layer_11_all2all_result -->
<g id="edge442" class="edge">
<title>layer_11_expert_4&#45;&gt;layer_11_all2all_result</title>
<path fill="none" stroke="black" d="M3723.04,-4177.97C3726.05,-4177.33 3729.04,-4176.73 3732,-4176.16 4020.78,-4120.54 4364.4,-4096.83 4556.32,-4087.32"/>
<polygon fill="black" stroke="black" points="4556.66,-4090.81 4566.47,-4086.82 4556.32,-4083.81 4556.66,-4090.81"/>
</g>
<!-- layer_11_expert_5&#45;&gt;layer_11_all2all_result -->
<g id="edge443" class="edge">
<title>layer_11_expert_5&#45;&gt;layer_11_all2all_result</title>
<path fill="none" stroke="black" d="M4001.07,-4178.13C4004.07,-4177.44 4007.05,-4176.78 4010,-4176.16 4197.71,-4136.25 4417.69,-4109.6 4559.08,-4095"/>
<polygon fill="black" stroke="black" points="4559.53,-4098.47 4569.12,-4093.97 4558.81,-4091.51 4559.53,-4098.47"/>
</g>
<!-- layer_11_expert_6&#45;&gt;layer_11_all2all_result -->
<g id="edge444" class="edge">
<title>layer_11_expert_6&#45;&gt;layer_11_all2all_result</title>
<path fill="none" stroke="black" d="M4279.15,-4178.48C4282.13,-4177.69 4285.08,-4176.91 4288,-4176.16 4382.1,-4151.79 4489.02,-4127.58 4571.03,-4109.74"/>
<polygon fill="black" stroke="black" points="4571.88,-4113.14 4580.91,-4107.6 4570.39,-4106.3 4571.88,-4113.14"/>
</g>
<!-- layer_11_expert_7&#45;&gt;layer_11_all2all_result -->
<g id="edge445" class="edge">
<title>layer_11_expert_7&#45;&gt;layer_11_all2all_result</title>
<path fill="none" stroke="black" d="M4510.41,-4176.1C4540.4,-4161.51 4574.51,-4144.92 4605.72,-4129.75"/>
<polygon fill="black" stroke="black" points="4607.41,-4132.82 4614.87,-4125.3 4604.34,-4126.52 4607.41,-4132.82"/>
</g>
<!-- layer_11_expert_8&#45;&gt;layer_11_all2all_result -->
<g id="edge446" class="edge">
<title>layer_11_expert_8&#45;&gt;layer_11_all2all_result</title>
<path fill="none" stroke="black" d="M4705,-4176.1C4705,-4167.73 4705,-4158.71 4705,-4149.67"/>
<polygon fill="black" stroke="black" points="4708.5,-4149.49 4705,-4139.49 4701.5,-4149.49 4708.5,-4149.49"/>
</g>
<!-- layer_11_expert_9&#45;&gt;layer_11_all2all_result -->
<g id="edge447" class="edge">
<title>layer_11_expert_9&#45;&gt;layer_11_all2all_result</title>
<path fill="none" stroke="black" d="M4899.59,-4176.1C4869.6,-4161.51 4835.49,-4144.92 4804.28,-4129.75"/>
<polygon fill="black" stroke="black" points="4805.66,-4126.52 4795.13,-4125.3 4802.59,-4132.82 4805.66,-4126.52"/>
</g>
<!-- layer_11_expert_10&#45;&gt;layer_11_all2all_result -->
<g id="edge448" class="edge">
<title>layer_11_expert_10&#45;&gt;layer_11_all2all_result</title>
<path fill="none" stroke="black" d="M5130.85,-4178.48C5127.87,-4177.69 5124.92,-4176.91 5122,-4176.16 5027.9,-4151.79 4920.98,-4127.58 4838.97,-4109.74"/>
<polygon fill="black" stroke="black" points="4839.61,-4106.3 4829.09,-4107.6 4838.12,-4113.14 4839.61,-4106.3"/>
</g>
<!-- layer_11_expert_11&#45;&gt;layer_11_all2all_result -->
<g id="edge449" class="edge">
<title>layer_11_expert_11&#45;&gt;layer_11_all2all_result</title>
<path fill="none" stroke="black" d="M5408.93,-4178.13C5405.93,-4177.44 5402.95,-4176.78 5400,-4176.16 5212.29,-4136.25 4992.31,-4109.6 4850.92,-4095"/>
<polygon fill="black" stroke="black" points="4851.19,-4091.51 4840.88,-4093.97 4850.47,-4098.47 4851.19,-4091.51"/>
</g>
<!-- layer_11_expert_12&#45;&gt;layer_11_all2all_result -->
<g id="edge450" class="edge">
<title>layer_11_expert_12&#45;&gt;layer_11_all2all_result</title>
<path fill="none" stroke="black" d="M5686.96,-4177.97C5683.95,-4177.33 5680.96,-4176.73 5678,-4176.16 5389.22,-4120.54 5045.6,-4096.83 4853.68,-4087.32"/>
<polygon fill="black" stroke="black" points="4853.68,-4083.81 4843.53,-4086.82 4853.34,-4090.81 4853.68,-4083.81"/>
</g>
<!-- layer_11_expert_13&#45;&gt;layer_11_all2all_result -->
<g id="edge451" class="edge">
<title>layer_11_expert_13&#45;&gt;layer_11_all2all_result</title>
<path fill="none" stroke="black" d="M5964.98,-4177.88C5961.96,-4177.27 5958.97,-4176.7 5956,-4176.16 5562.77,-4104.79 5090.55,-4087.08 4854.59,-4082.78"/>
<polygon fill="black" stroke="black" points="4854.63,-4079.28 4844.57,-4082.6 4854.51,-4086.28 4854.63,-4079.28"/>
</g>
<!-- layer_11_expert_14&#45;&gt;layer_11_all2all_result -->
<g id="edge452" class="edge">
<title>layer_11_expert_14&#45;&gt;layer_11_all2all_result</title>
<path fill="none" stroke="black" d="M6242.99,-4177.83C6239.97,-4177.23 6236.97,-4176.68 6234,-4176.16 5971.76,-4130.42 5184.76,-4098.31 4854,-4086.49"/>
<polygon fill="black" stroke="black" points="4853.99,-4082.98 4843.87,-4086.13 4853.74,-4089.98 4853.99,-4082.98"/>
</g>
<!-- layer_11_expert_15&#45;&gt;layer_11_all2all_result -->
<g id="edge453" class="edge">
<title>layer_11_expert_15&#45;&gt;layer_11_all2all_result</title>
<path fill="none" stroke="black" d="M6520.99,-4177.79C6517.97,-4177.21 6514.97,-4176.66 6512,-4176.16 6194.62,-4122.35 5227.29,-4094.01 4854.08,-4084.84"/>
<polygon fill="black" stroke="black" points="4854.1,-4081.34 4844.02,-4084.6 4853.93,-4088.34 4854.1,-4081.34"/>
</g>
<!-- layer_11_expert_agg -->
<g id="node264" class="node">
<title>layer_11_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="6299,-3984.78 6051,-3984.78 6051,-3901.78 6299,-3901.78 6299,-3984.78"/>
<text text-anchor="middle" x="6175" y="-3969.58" font-family="Times,serif" font-size="14.00">Layer 11</text>
<text text-anchor="middle" x="6175" y="-3954.58" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="6175" y="-3939.58" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6175" y="-3924.58" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="6175" y="-3909.58" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_11_all2all_result&#45;&gt;layer_11_expert_agg -->
<g id="edge454" class="edge">
<title>layer_11_all2all_result&#45;&gt;layer_11_expert_agg</title>
<path fill="none" stroke="black" d="M4840.66,-4066.99C5121.06,-4041.2 5761.53,-3982.3 6040.73,-3956.63"/>
<polygon fill="black" stroke="black" points="6041.28,-3960.09 6050.92,-3955.69 6040.64,-3953.12 6041.28,-3960.09"/>
</g>
<!-- layer_11_expert_agg&#45;&gt;layer_11_residual -->
<g id="edge456" class="edge">
<title>layer_11_expert_agg&#45;&gt;layer_11_residual</title>
<path fill="none" stroke="black" d="M6299.21,-3916.38C6377.7,-3900.02 6480.29,-3878.63 6566.85,-3860.59"/>
<polygon fill="black" stroke="black" points="6567.7,-3863.98 6576.78,-3858.51 6566.28,-3857.13 6567.7,-3863.98"/>
</g>
<!-- layer_12_mha -->
<g id="node266" class="node">
<title>layer_12_mha</title>
<polygon fill="lightblue" stroke="black" points="6842.5,-3744.78 6639.5,-3744.78 6639.5,-3661.78 6842.5,-3661.78 6842.5,-3744.78"/>
<text text-anchor="middle" x="6741" y="-3729.58" font-family="Times,serif" font-size="14.00">Layer 12</text>
<text text-anchor="middle" x="6741" y="-3714.58" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="6741" y="-3699.58" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="6741" y="-3684.58" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="6741" y="-3669.58" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_11_residual&#45;&gt;layer_12_mha -->
<g id="edge457" class="edge">
<title>layer_11_residual&#45;&gt;layer_12_mha</title>
<path fill="none" stroke="black" d="M6741,-3781.67C6741,-3773.14 6741,-3764.04 6741,-3755.19"/>
<polygon fill="black" stroke="black" points="6744.5,-3754.96 6741,-3744.96 6737.5,-3754.96 6744.5,-3754.96"/>
</g>
<!-- layer_12_gate -->
<g id="node267" class="node">
<title>layer_12_gate</title>
<polygon fill="lightblue" stroke="black" points="6528.5,-3624.78 6329.5,-3624.78 6329.5,-3541.78 6528.5,-3541.78 6528.5,-3624.78"/>
<text text-anchor="middle" x="6429" y="-3609.58" font-family="Times,serif" font-size="14.00">Layer 12</text>
<text text-anchor="middle" x="6429" y="-3594.58" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="6429" y="-3579.58" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="6429" y="-3564.58" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="6429" y="-3549.58" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_12_mha&#45;&gt;layer_12_gate -->
<g id="edge458" class="edge">
<title>layer_12_mha&#45;&gt;layer_12_gate</title>
<path fill="none" stroke="black" d="M6639.27,-3663.8C6606.98,-3651.59 6571.15,-3638.04 6538.35,-3625.63"/>
<polygon fill="black" stroke="black" points="6539.32,-3622.26 6528.73,-3622 6536.84,-3628.81 6539.32,-3622.26"/>
</g>
<!-- layer_12_residual -->
<g id="node287" class="node">
<title>layer_12_residual</title>
<polygon fill="lightblue" stroke="black" points="7141,-2942.02 6813,-2942.02 6813,-2859.02 7141,-2859.02 7141,-2942.02"/>
<text text-anchor="middle" x="6977" y="-2926.82" font-family="Times,serif" font-size="14.00">Layer 12</text>
<text text-anchor="middle" x="6977" y="-2911.82" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="6977" y="-2896.82" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="6977" y="-2881.82" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="6977" y="-2866.82" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_12_mha&#45;&gt;layer_12_residual -->
<g id="edge493" class="edge">
<title>layer_12_mha&#45;&gt;layer_12_residual</title>
<path fill="none" stroke="black" d="M6842.73,-3683.85C6933.78,-3664.36 7053,-3630.1 7053,-3584.28 7053,-3584.28 7053,-3584.28 7053,-3019.52 7053,-2994.14 7040.42,-2969.88 7025.5,-2950.03"/>
<polygon fill="black" stroke="black" points="7028.17,-2947.76 7019.22,-2942.08 7022.67,-2952.1 7028.17,-2947.76"/>
<text text-anchor="middle" x="7081" y="-3291.2" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_12_all2all -->
<g id="node268" class="node">
<title>layer_12_all2all</title>
<ellipse fill="yellow" stroke="black" cx="4941" cy="-3446.09" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="4941" y="-3472.39" font-family="Times,serif" font-size="14.00">Layer 12</text>
<text text-anchor="middle" x="4941" y="-3457.39" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="4941" y="-3442.39" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="4941" y="-3427.39" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="4941" y="-3412.39" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_12_gate&#45;&gt;layer_12_all2all -->
<g id="edge459" class="edge">
<title>layer_12_gate&#45;&gt;layer_12_all2all</title>
<path fill="none" stroke="black" d="M6329.35,-3573.22C6072.76,-3549.91 5388.46,-3487.74 5087.03,-3460.36"/>
<polygon fill="black" stroke="black" points="5087.18,-3456.85 5076.91,-3459.44 5086.55,-3463.83 5087.18,-3456.85"/>
</g>
<!-- layer_12_expert_0 -->
<g id="node269" class="node">
<title>layer_12_expert_0</title>
<polygon fill="lightblue" stroke="black" points="2847,-3336.4 2587,-3336.4 2587,-3253.4 2847,-3253.4 2847,-3336.4"/>
<text text-anchor="middle" x="2717" y="-3321.2" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2717" y="-3306.2" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2717" y="-3291.2" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2717" y="-3276.2" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2717" y="-3261.2" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_12_all2all&#45;&gt;layer_12_expert_0 -->
<g id="edge460" class="edge">
<title>layer_12_all2all&#45;&gt;layer_12_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4801.71,-3442.29C4421.55,-3434.23 3371.72,-3408.94 3028,-3369.4 2953.84,-3360.87 2933.33,-3355.12 2857.2,-3336.65"/>
<polygon fill="black" stroke="black" points="2857.66,-3333.16 2847.12,-3334.21 2856.02,-3339.97 2857.66,-3333.16"/>
<text text-anchor="middle" x="3119.5" y="-3358.2" font-family="Times,serif" font-size="14.00">tokens routed to expert 0</text>
</g>
<!-- layer_12_expert_1 -->
<g id="node270" class="node">
<title>layer_12_expert_1</title>
<polygon fill="lightblue" stroke="black" points="3125,-3336.4 2865,-3336.4 2865,-3253.4 3125,-3253.4 3125,-3336.4"/>
<text text-anchor="middle" x="2995" y="-3321.2" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2995" y="-3306.2" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2995" y="-3291.2" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2995" y="-3276.2" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2995" y="-3261.2" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_12_all2all&#45;&gt;layer_12_expert_1 -->
<g id="edge461" class="edge">
<title>layer_12_all2all&#45;&gt;layer_12_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4801.56,-3445.7C4517.78,-3445.38 3853.12,-3436.75 3300,-3369.4 3245.4,-3362.75 3186.41,-3349.91 3134.99,-3336.79"/>
<polygon fill="black" stroke="black" points="3135.71,-3333.36 3125.15,-3334.26 3133.96,-3340.14 3135.71,-3333.36"/>
<text text-anchor="middle" x="3391.5" y="-3358.2" font-family="Times,serif" font-size="14.00">tokens routed to expert 1</text>
</g>
<!-- layer_12_expert_2 -->
<g id="node271" class="node">
<title>layer_12_expert_2</title>
<polygon fill="lightblue" stroke="black" points="3403,-3336.4 3143,-3336.4 3143,-3253.4 3403,-3253.4 3403,-3336.4"/>
<text text-anchor="middle" x="3273" y="-3321.2" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3273" y="-3306.2" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3273" y="-3291.2" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3273" y="-3276.2" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3273" y="-3261.2" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_12_all2all&#45;&gt;layer_12_expert_2 -->
<g id="edge462" class="edge">
<title>layer_12_all2all&#45;&gt;layer_12_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4801.7,-3444.32C4553.22,-3441.4 4017.6,-3428.16 3570,-3369.4 3518.03,-3362.58 3462,-3350.09 3412.76,-3337.33"/>
<polygon fill="black" stroke="black" points="3413.57,-3333.92 3403.01,-3334.77 3411.8,-3340.69 3413.57,-3333.92"/>
<text text-anchor="middle" x="3661.5" y="-3358.2" font-family="Times,serif" font-size="14.00">tokens routed to expert 2</text>
</g>
<!-- layer_12_expert_3 -->
<g id="node272" class="node">
<title>layer_12_expert_3</title>
<polygon fill="lightblue" stroke="black" points="3681,-3336.4 3421,-3336.4 3421,-3253.4 3681,-3253.4 3681,-3336.4"/>
<text text-anchor="middle" x="3551" y="-3321.2" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3551" y="-3306.2" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3551" y="-3291.2" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3551" y="-3276.2" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3551" y="-3261.2" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_12_all2all&#45;&gt;layer_12_expert_3 -->
<g id="edge463" class="edge">
<title>layer_12_all2all&#45;&gt;layer_12_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4801.67,-3443.14C4589.95,-3438.49 4175.01,-3422.75 3827,-3369.4 3781.77,-3362.47 3733.29,-3350.98 3689.78,-3339.13"/>
<polygon fill="black" stroke="black" points="3690.57,-3335.71 3680,-3336.43 3688.71,-3342.46 3690.57,-3335.71"/>
<text text-anchor="middle" x="3918.5" y="-3358.2" font-family="Times,serif" font-size="14.00">tokens routed to expert 3</text>
</g>
<!-- layer_12_expert_4 -->
<g id="node273" class="node">
<title>layer_12_expert_4</title>
<polygon fill="lightblue" stroke="black" points="3959,-3336.4 3699,-3336.4 3699,-3253.4 3959,-3253.4 3959,-3336.4"/>
<text text-anchor="middle" x="3829" y="-3321.2" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="3829" y="-3306.2" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3829" y="-3291.2" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3829" y="-3276.2" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3829" y="-3261.2" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_12_all2all&#45;&gt;layer_12_expert_4 -->
<g id="edge464" class="edge">
<title>layer_12_all2all&#45;&gt;layer_12_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4801.78,-3441.48C4630.04,-3435.06 4329.77,-3417.42 4077,-3369.4 4037.65,-3361.92 3995.62,-3350.73 3957.55,-3339.33"/>
<polygon fill="black" stroke="black" points="3958.54,-3335.97 3947.96,-3336.42 3956.51,-3342.67 3958.54,-3335.97"/>
<text text-anchor="middle" x="4168.5" y="-3358.2" font-family="Times,serif" font-size="14.00">tokens routed to expert 4</text>
</g>
<!-- layer_12_expert_5 -->
<g id="node274" class="node">
<title>layer_12_expert_5</title>
<polygon fill="lightblue" stroke="black" points="4237,-3336.4 3977,-3336.4 3977,-3253.4 4237,-3253.4 4237,-3336.4"/>
<text text-anchor="middle" x="4107" y="-3321.2" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="4107" y="-3306.2" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4107" y="-3291.2" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4107" y="-3276.2" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4107" y="-3261.2" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_12_all2all&#45;&gt;layer_12_expert_5 -->
<g id="edge465" class="edge">
<title>layer_12_all2all&#45;&gt;layer_12_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4803.18,-3436.95C4675.75,-3427.4 4481.74,-3407.74 4317,-3369.4 4284.44,-3361.82 4249.89,-3350.96 4218.43,-3339.91"/>
<polygon fill="black" stroke="black" points="4219.36,-3336.53 4208.76,-3336.48 4217.02,-3343.13 4219.36,-3336.53"/>
<text text-anchor="middle" x="4408.5" y="-3358.2" font-family="Times,serif" font-size="14.00">tokens routed to expert 5</text>
</g>
<!-- layer_12_expert_6 -->
<g id="node275" class="node">
<title>layer_12_expert_6</title>
<polygon fill="lightblue" stroke="black" points="4515,-3336.4 4255,-3336.4 4255,-3253.4 4515,-3253.4 4515,-3336.4"/>
<text text-anchor="middle" x="4385" y="-3321.2" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="4385" y="-3306.2" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4385" y="-3291.2" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4385" y="-3276.2" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4385" y="-3261.2" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_12_all2all&#45;&gt;layer_12_expert_6 -->
<g id="edge466" class="edge">
<title>layer_12_all2all&#45;&gt;layer_12_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4808.36,-3427.94C4730.49,-3415.85 4630.83,-3396.87 4545,-3369.4 4520.84,-3361.67 4495.53,-3351.22 4472.36,-3340.64"/>
<polygon fill="black" stroke="black" points="4473.79,-3337.45 4463.25,-3336.42 4470.85,-3343.8 4473.79,-3337.45"/>
<text text-anchor="middle" x="4636.5" y="-3358.2" font-family="Times,serif" font-size="14.00">tokens routed to expert 6</text>
</g>
<!-- layer_12_expert_7 -->
<g id="node276" class="node">
<title>layer_12_expert_7</title>
<polygon fill="lightblue" stroke="black" points="4793,-3336.4 4533,-3336.4 4533,-3253.4 4793,-3253.4 4793,-3336.4"/>
<text text-anchor="middle" x="4663" y="-3321.2" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="4663" y="-3306.2" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4663" y="-3291.2" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4663" y="-3276.2" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4663" y="-3261.2" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_12_all2all&#45;&gt;layer_12_expert_7 -->
<g id="edge467" class="edge">
<title>layer_12_all2all&#45;&gt;layer_12_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4834.06,-3408.11C4807.17,-3397.13 4778.9,-3384.06 4754,-3369.4 4740.94,-3361.71 4727.75,-3352.25 4715.63,-3342.72"/>
<polygon fill="black" stroke="black" points="4717.82,-3339.99 4707.83,-3336.46 4713.44,-3345.44 4717.82,-3339.99"/>
<text text-anchor="middle" x="4845.5" y="-3358.2" font-family="Times,serif" font-size="14.00">tokens routed to expert 7</text>
</g>
<!-- layer_12_expert_8 -->
<g id="node277" class="node">
<title>layer_12_expert_8</title>
<polygon fill="lightblue" stroke="black" points="5071,-3336.4 4811,-3336.4 4811,-3253.4 5071,-3253.4 5071,-3336.4"/>
<text text-anchor="middle" x="4941" y="-3321.2" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="4941" y="-3306.2" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4941" y="-3291.2" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4941" y="-3276.2" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4941" y="-3261.2" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_12_all2all&#45;&gt;layer_12_expert_8 -->
<g id="edge468" class="edge">
<title>layer_12_all2all&#45;&gt;layer_12_expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4941,-3386.98C4941,-3373.68 4941,-3359.65 4941,-3346.68"/>
<polygon fill="black" stroke="black" points="4944.5,-3346.55 4941,-3336.55 4937.5,-3346.55 4944.5,-3346.55"/>
<text text-anchor="middle" x="5032.5" y="-3358.2" font-family="Times,serif" font-size="14.00">tokens routed to expert 8</text>
</g>
<!-- layer_12_expert_9 -->
<g id="node278" class="node">
<title>layer_12_expert_9</title>
<polygon fill="lightblue" stroke="black" points="5349,-3336.4 5089,-3336.4 5089,-3253.4 5349,-3253.4 5349,-3336.4"/>
<text text-anchor="middle" x="5219" y="-3321.2" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="5219" y="-3306.2" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5219" y="-3291.2" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5219" y="-3276.2" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5219" y="-3261.2" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_12_all2all&#45;&gt;layer_12_expert_9 -->
<g id="edge469" class="edge">
<title>layer_12_all2all&#45;&gt;layer_12_expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5047.94,-3408.11C5074.83,-3397.13 5103.1,-3384.06 5128,-3369.4 5141.06,-3361.71 5154.25,-3352.25 5166.37,-3342.72"/>
<polygon fill="black" stroke="black" points="5168.56,-3345.44 5174.17,-3336.46 5164.18,-3339.99 5168.56,-3345.44"/>
<text text-anchor="middle" x="5240.5" y="-3358.2" font-family="Times,serif" font-size="14.00">tokens routed to expert 9</text>
</g>
<!-- layer_12_expert_10 -->
<g id="node279" class="node">
<title>layer_12_expert_10</title>
<polygon fill="lightblue" stroke="black" points="5627,-3336.4 5367,-3336.4 5367,-3253.4 5627,-3253.4 5627,-3336.4"/>
<text text-anchor="middle" x="5497" y="-3321.2" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="5497" y="-3306.2" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5497" y="-3291.2" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5497" y="-3276.2" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5497" y="-3261.2" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_12_all2all&#45;&gt;layer_12_expert_10 -->
<g id="edge470" class="edge">
<title>layer_12_all2all&#45;&gt;layer_12_expert_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5073.73,-3427.76C5151.33,-3415.63 5250.52,-3396.67 5336,-3369.4 5360.29,-3361.65 5385.75,-3351.2 5409.07,-3340.62"/>
<polygon fill="black" stroke="black" points="5410.61,-3343.76 5418.24,-3336.4 5407.69,-3337.4 5410.61,-3343.76"/>
<text text-anchor="middle" x="5472" y="-3358.2" font-family="Times,serif" font-size="14.00">tokens routed to expert 10</text>
</g>
<!-- layer_12_expert_11 -->
<g id="node280" class="node">
<title>layer_12_expert_11</title>
<polygon fill="lightblue" stroke="black" points="5905,-3336.4 5645,-3336.4 5645,-3253.4 5905,-3253.4 5905,-3336.4"/>
<text text-anchor="middle" x="5775" y="-3321.2" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="5775" y="-3306.2" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5775" y="-3291.2" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5775" y="-3276.2" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5775" y="-3261.2" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_12_all2all&#45;&gt;layer_12_expert_11 -->
<g id="edge471" class="edge">
<title>layer_12_all2all&#45;&gt;layer_12_expert_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5078.9,-3437.62C5207.81,-3428.51 5404.95,-3409.11 5572,-3369.4 5603.51,-3361.91 5636.87,-3351.1 5667.25,-3340.07"/>
<polygon fill="black" stroke="black" points="5668.82,-3343.22 5677,-3336.49 5666.4,-3336.65 5668.82,-3343.22"/>
<text text-anchor="middle" x="5719" y="-3358.2" font-family="Times,serif" font-size="14.00">tokens routed to expert 11</text>
</g>
<!-- layer_12_expert_12 -->
<g id="node281" class="node">
<title>layer_12_expert_12</title>
<polygon fill="lightblue" stroke="black" points="6183,-3336.4 5923,-3336.4 5923,-3253.4 6183,-3253.4 6183,-3336.4"/>
<text text-anchor="middle" x="6053" y="-3321.2" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="6053" y="-3306.2" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6053" y="-3291.2" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6053" y="-3276.2" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6053" y="-3261.2" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_12_all2all&#45;&gt;layer_12_expert_12 -->
<g id="edge472" class="edge">
<title>layer_12_all2all&#45;&gt;layer_12_expert_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5080.31,-3442.44C5254.58,-3436.98 5561.41,-3420.32 5819,-3369.4 5856.2,-3362.05 5895.83,-3350.91 5931.7,-3339.52"/>
<polygon fill="black" stroke="black" points="5932.77,-3342.86 5941.22,-3336.47 5930.63,-3336.19 5932.77,-3342.86"/>
<text text-anchor="middle" x="5973" y="-3358.2" font-family="Times,serif" font-size="14.00">tokens routed to expert 12</text>
</g>
<!-- layer_12_expert_13 -->
<g id="node282" class="node">
<title>layer_12_expert_13</title>
<polygon fill="lightblue" stroke="black" points="6461,-3336.4 6201,-3336.4 6201,-3253.4 6461,-3253.4 6461,-3336.4"/>
<text text-anchor="middle" x="6331" y="-3321.2" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="6331" y="-3306.2" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6331" y="-3291.2" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6331" y="-3276.2" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6331" y="-3261.2" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_12_all2all&#45;&gt;layer_12_expert_13 -->
<g id="edge473" class="edge">
<title>layer_12_all2all&#45;&gt;layer_12_expert_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5080.61,-3444.86C5295.38,-3442.47 5719.12,-3429.65 6073,-3369.4 6114.67,-3362.3 6159.23,-3351 6199.38,-3339.36"/>
<polygon fill="black" stroke="black" points="6200.61,-3342.65 6209.22,-3336.48 6198.64,-3335.93 6200.61,-3342.65"/>
<text text-anchor="middle" x="6233" y="-3358.2" font-family="Times,serif" font-size="14.00">tokens routed to expert 13</text>
</g>
<!-- layer_12_expert_14 -->
<g id="node283" class="node">
<title>layer_12_expert_14</title>
<polygon fill="lightblue" stroke="black" points="6739,-3336.4 6479,-3336.4 6479,-3253.4 6739,-3253.4 6739,-3336.4"/>
<text text-anchor="middle" x="6609" y="-3321.2" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="6609" y="-3306.2" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6609" y="-3291.2" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6609" y="-3276.2" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6609" y="-3261.2" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_12_all2all&#45;&gt;layer_12_expert_14 -->
<g id="edge474" class="edge">
<title>layer_12_all2all&#45;&gt;layer_12_expert_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5080.63,-3445.87C5332.34,-3445.42 5878.3,-3435.96 6333,-3369.4 6378.73,-3362.7 6427.74,-3351.14 6471.59,-3339.14"/>
<polygon fill="black" stroke="black" points="6472.74,-3342.46 6481.45,-3336.42 6470.87,-3335.71 6472.74,-3342.46"/>
<text text-anchor="middle" x="6505" y="-3358.2" font-family="Times,serif" font-size="14.00">tokens routed to expert 14</text>
</g>
<!-- layer_12_expert_15 -->
<g id="node284" class="node">
<title>layer_12_expert_15</title>
<polygon fill="lightblue" stroke="black" points="7017,-3336.4 6757,-3336.4 6757,-3253.4 7017,-3253.4 7017,-3336.4"/>
<text text-anchor="middle" x="6887" y="-3321.2" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="6887" y="-3306.2" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6887" y="-3291.2" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6887" y="-3276.2" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6887" y="-3261.2" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_12_all2all&#45;&gt;layer_12_expert_15 -->
<g id="edge475" class="edge">
<title>layer_12_all2all&#45;&gt;layer_12_expert_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5080.05,-3442.01C5424.75,-3433.86 6311.95,-3409.54 6605,-3369.4 6652.17,-3362.94 6702.76,-3351.3 6747.89,-3339.16"/>
<polygon fill="black" stroke="black" points="6749,-3342.48 6757.73,-3336.48 6747.16,-3335.73 6749,-3342.48"/>
<text text-anchor="middle" x="6779" y="-3358.2" font-family="Times,serif" font-size="14.00">tokens routed to expert 15</text>
</g>
<!-- layer_12_all2all_result -->
<g id="node285" class="node">
<title>layer_12_all2all_result</title>
<ellipse fill="yellow" stroke="black" cx="4941" cy="-3157.71" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="4941" y="-3184.01" font-family="Times,serif" font-size="14.00">Layer 12</text>
<text text-anchor="middle" x="4941" y="-3169.01" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Result Merge</text>
<text text-anchor="middle" x="4941" y="-3154.01" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="4941" y="-3139.01" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="4941" y="-3124.01" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_12_expert_0&#45;&gt;layer_12_all2all_result -->
<g id="edge476" class="edge">
<title>layer_12_expert_0&#45;&gt;layer_12_all2all_result</title>
<path fill="none" stroke="black" d="M2847,-3255C2850.02,-3254.43 2853.02,-3253.89 2856,-3253.4 3228.89,-3191.52 4378.76,-3167.61 4791.55,-3160.88"/>
<polygon fill="black" stroke="black" points="4791.81,-3164.37 4801.76,-3160.71 4791.7,-3157.38 4791.81,-3164.37"/>
</g>
<!-- layer_12_expert_1&#45;&gt;layer_12_all2all_result -->
<g id="edge477" class="edge">
<title>layer_12_expert_1&#45;&gt;layer_12_all2all_result</title>
<path fill="none" stroke="black" d="M3125.01,-3255.03C3128.03,-3254.45 3131.03,-3253.9 3134,-3253.4 3451.38,-3199.59 4418.71,-3171.25 4791.92,-3162.08"/>
<polygon fill="black" stroke="black" points="4792.07,-3165.58 4801.98,-3161.84 4791.9,-3158.58 4792.07,-3165.58"/>
</g>
<!-- layer_12_expert_2&#45;&gt;layer_12_all2all_result -->
<g id="edge478" class="edge">
<title>layer_12_expert_2&#45;&gt;layer_12_all2all_result</title>
<path fill="none" stroke="black" d="M3403.01,-3255.07C3406.03,-3254.48 3409.03,-3253.92 3412,-3253.4 3545.44,-3230.12 4434.85,-3183.92 4792.49,-3166.03"/>
<polygon fill="black" stroke="black" points="4792.84,-3169.52 4802.65,-3165.52 4792.49,-3162.52 4792.84,-3169.52"/>
</g>
<!-- layer_12_expert_3&#45;&gt;layer_12_all2all_result -->
<g id="edge479" class="edge">
<title>layer_12_expert_3&#45;&gt;layer_12_all2all_result</title>
<path fill="none" stroke="black" d="M3681.02,-3255.12C3684.04,-3254.51 3687.03,-3253.94 3690,-3253.4 3716.85,-3248.53 4468.63,-3193.23 4793.64,-3169.46"/>
<polygon fill="black" stroke="black" points="4794.35,-3172.92 4804.07,-3168.7 4793.84,-3165.94 4794.35,-3172.92"/>
</g>
<!-- layer_12_expert_4&#45;&gt;layer_12_all2all_result -->
<g id="edge480" class="edge">
<title>layer_12_expert_4&#45;&gt;layer_12_all2all_result</title>
<path fill="none" stroke="black" d="M3959.04,-3255.21C3962.05,-3254.57 3965.04,-3253.97 3968,-3253.4 4122.26,-3223.69 4562.23,-3187.43 4794.02,-3169.63"/>
<polygon fill="black" stroke="black" points="4794.52,-3173.1 4804.22,-3168.85 4793.98,-3166.12 4794.52,-3173.1"/>
</g>
<!-- layer_12_expert_5&#45;&gt;layer_12_all2all_result -->
<g id="edge481" class="edge">
<title>layer_12_expert_5&#45;&gt;layer_12_all2all_result</title>
<path fill="none" stroke="black" d="M4237.07,-3255.37C4240.07,-3254.68 4243.05,-3254.03 4246,-3253.4 4433.71,-3213.49 4653.69,-3186.84 4795.08,-3172.24"/>
<polygon fill="black" stroke="black" points="4795.53,-3175.71 4805.12,-3171.21 4794.81,-3168.75 4795.53,-3175.71"/>
</g>
<!-- layer_12_expert_6&#45;&gt;layer_12_all2all_result -->
<g id="edge482" class="edge">
<title>layer_12_expert_6&#45;&gt;layer_12_all2all_result</title>
<path fill="none" stroke="black" d="M4515.15,-3255.72C4518.13,-3254.93 4521.08,-3254.15 4524,-3253.4 4618.1,-3229.03 4725.02,-3204.82 4807.03,-3186.98"/>
<polygon fill="black" stroke="black" points="4807.88,-3190.38 4816.91,-3184.84 4806.39,-3183.54 4807.88,-3190.38"/>
</g>
<!-- layer_12_expert_7&#45;&gt;layer_12_all2all_result -->
<g id="edge483" class="edge">
<title>layer_12_expert_7&#45;&gt;layer_12_all2all_result</title>
<path fill="none" stroke="black" d="M4746.41,-3253.34C4776.4,-3238.75 4810.51,-3222.16 4841.72,-3206.99"/>
<polygon fill="black" stroke="black" points="4843.41,-3210.06 4850.87,-3202.54 4840.34,-3203.77 4843.41,-3210.06"/>
</g>
<!-- layer_12_expert_8&#45;&gt;layer_12_all2all_result -->
<g id="edge484" class="edge">
<title>layer_12_expert_8&#45;&gt;layer_12_all2all_result</title>
<path fill="none" stroke="black" d="M4941,-3253.34C4941,-3244.97 4941,-3235.95 4941,-3226.91"/>
<polygon fill="black" stroke="black" points="4944.5,-3226.73 4941,-3216.73 4937.5,-3226.73 4944.5,-3226.73"/>
</g>
<!-- layer_12_expert_9&#45;&gt;layer_12_all2all_result -->
<g id="edge485" class="edge">
<title>layer_12_expert_9&#45;&gt;layer_12_all2all_result</title>
<path fill="none" stroke="black" d="M5135.59,-3253.34C5105.6,-3238.75 5071.49,-3222.16 5040.28,-3206.99"/>
<polygon fill="black" stroke="black" points="5041.66,-3203.77 5031.13,-3202.54 5038.59,-3210.06 5041.66,-3203.77"/>
</g>
<!-- layer_12_expert_10&#45;&gt;layer_12_all2all_result -->
<g id="edge486" class="edge">
<title>layer_12_expert_10&#45;&gt;layer_12_all2all_result</title>
<path fill="none" stroke="black" d="M5366.85,-3255.72C5363.87,-3254.93 5360.92,-3254.15 5358,-3253.4 5263.9,-3229.03 5156.98,-3204.82 5074.97,-3186.98"/>
<polygon fill="black" stroke="black" points="5075.61,-3183.54 5065.09,-3184.84 5074.12,-3190.38 5075.61,-3183.54"/>
</g>
<!-- layer_12_expert_11&#45;&gt;layer_12_all2all_result -->
<g id="edge487" class="edge">
<title>layer_12_expert_11&#45;&gt;layer_12_all2all_result</title>
<path fill="none" stroke="black" d="M5644.93,-3255.37C5641.93,-3254.68 5638.95,-3254.03 5636,-3253.4 5448.29,-3213.49 5228.31,-3186.84 5086.92,-3172.24"/>
<polygon fill="black" stroke="black" points="5087.19,-3168.75 5076.88,-3171.21 5086.47,-3175.71 5087.19,-3168.75"/>
</g>
<!-- layer_12_expert_12&#45;&gt;layer_12_all2all_result -->
<g id="edge488" class="edge">
<title>layer_12_expert_12&#45;&gt;layer_12_all2all_result</title>
<path fill="none" stroke="black" d="M5922.96,-3255.21C5919.95,-3254.57 5916.96,-3253.97 5914,-3253.4 5625.22,-3197.78 5281.6,-3174.07 5089.68,-3164.56"/>
<polygon fill="black" stroke="black" points="5089.68,-3161.05 5079.53,-3164.06 5089.34,-3168.05 5089.68,-3161.05"/>
</g>
<!-- layer_12_expert_13&#45;&gt;layer_12_all2all_result -->
<g id="edge489" class="edge">
<title>layer_12_expert_13&#45;&gt;layer_12_all2all_result</title>
<path fill="none" stroke="black" d="M6200.98,-3255.12C6197.96,-3254.51 6194.97,-3253.94 6192,-3253.4 5798.77,-3182.03 5326.55,-3164.32 5090.59,-3160.02"/>
<polygon fill="black" stroke="black" points="5090.63,-3156.52 5080.57,-3159.84 5090.51,-3163.52 5090.63,-3156.52"/>
</g>
<!-- layer_12_expert_14&#45;&gt;layer_12_all2all_result -->
<g id="edge490" class="edge">
<title>layer_12_expert_14&#45;&gt;layer_12_all2all_result</title>
<path fill="none" stroke="black" d="M6478.99,-3255.07C6475.97,-3254.48 6472.97,-3253.92 6470,-3253.4 6207.76,-3207.66 5420.76,-3175.55 5090,-3163.73"/>
<polygon fill="black" stroke="black" points="5089.99,-3160.22 5079.87,-3163.37 5089.74,-3167.22 5089.99,-3160.22"/>
</g>
<!-- layer_12_expert_15&#45;&gt;layer_12_all2all_result -->
<g id="edge491" class="edge">
<title>layer_12_expert_15&#45;&gt;layer_12_all2all_result</title>
<path fill="none" stroke="black" d="M6756.99,-3255.03C6753.97,-3254.45 6750.97,-3253.9 6748,-3253.4 6430.62,-3199.59 5463.29,-3171.25 5090.08,-3162.08"/>
<polygon fill="black" stroke="black" points="5090.1,-3158.58 5080.02,-3161.84 5089.93,-3165.58 5090.1,-3158.58"/>
</g>
<!-- layer_12_expert_agg -->
<g id="node286" class="node">
<title>layer_12_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="6535,-3062.02 6287,-3062.02 6287,-2979.02 6535,-2979.02 6535,-3062.02"/>
<text text-anchor="middle" x="6411" y="-3046.82" font-family="Times,serif" font-size="14.00">Layer 12</text>
<text text-anchor="middle" x="6411" y="-3031.82" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="6411" y="-3016.82" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6411" y="-3001.82" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="6411" y="-2986.82" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_12_all2all_result&#45;&gt;layer_12_expert_agg -->
<g id="edge492" class="edge">
<title>layer_12_all2all_result&#45;&gt;layer_12_expert_agg</title>
<path fill="none" stroke="black" d="M5076.66,-3144.23C5357.06,-3118.45 5997.53,-3059.54 6276.73,-3033.87"/>
<polygon fill="black" stroke="black" points="6277.28,-3037.33 6286.92,-3032.93 6276.64,-3030.36 6277.28,-3037.33"/>
</g>
<!-- layer_12_expert_agg&#45;&gt;layer_12_residual -->
<g id="edge494" class="edge">
<title>layer_12_expert_agg&#45;&gt;layer_12_residual</title>
<path fill="none" stroke="black" d="M6535.21,-2993.62C6613.7,-2977.26 6716.29,-2955.87 6802.85,-2937.83"/>
<polygon fill="black" stroke="black" points="6803.7,-2941.22 6812.78,-2935.76 6802.28,-2934.37 6803.7,-2941.22"/>
</g>
<!-- layer_13_mha -->
<g id="node288" class="node">
<title>layer_13_mha</title>
<polygon fill="lightblue" stroke="black" points="7078.5,-2822.02 6875.5,-2822.02 6875.5,-2739.02 7078.5,-2739.02 7078.5,-2822.02"/>
<text text-anchor="middle" x="6977" y="-2806.82" font-family="Times,serif" font-size="14.00">Layer 13</text>
<text text-anchor="middle" x="6977" y="-2791.82" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="6977" y="-2776.82" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="6977" y="-2761.82" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="6977" y="-2746.82" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_12_residual&#45;&gt;layer_13_mha -->
<g id="edge495" class="edge">
<title>layer_12_residual&#45;&gt;layer_13_mha</title>
<path fill="none" stroke="black" d="M6977,-2858.91C6977,-2850.38 6977,-2841.28 6977,-2832.43"/>
<polygon fill="black" stroke="black" points="6980.5,-2832.2 6977,-2822.2 6973.5,-2832.2 6980.5,-2832.2"/>
</g>
<!-- layer_13_gate -->
<g id="node289" class="node">
<title>layer_13_gate</title>
<polygon fill="lightblue" stroke="black" points="6764.5,-2702.02 6565.5,-2702.02 6565.5,-2619.02 6764.5,-2619.02 6764.5,-2702.02"/>
<text text-anchor="middle" x="6665" y="-2686.82" font-family="Times,serif" font-size="14.00">Layer 13</text>
<text text-anchor="middle" x="6665" y="-2671.82" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="6665" y="-2656.82" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="6665" y="-2641.82" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="6665" y="-2626.82" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_13_mha&#45;&gt;layer_13_gate -->
<g id="edge496" class="edge">
<title>layer_13_mha&#45;&gt;layer_13_gate</title>
<path fill="none" stroke="black" d="M6875.27,-2741.04C6842.98,-2728.83 6807.15,-2715.28 6774.35,-2702.87"/>
<polygon fill="black" stroke="black" points="6775.32,-2699.5 6764.73,-2699.24 6772.84,-2706.05 6775.32,-2699.5"/>
</g>
<!-- layer_13_residual -->
<g id="node309" class="node">
<title>layer_13_residual</title>
<polygon fill="lightblue" stroke="black" points="7377,-2019.26 7049,-2019.26 7049,-1936.26 7377,-1936.26 7377,-2019.26"/>
<text text-anchor="middle" x="7213" y="-2004.06" font-family="Times,serif" font-size="14.00">Layer 13</text>
<text text-anchor="middle" x="7213" y="-1989.06" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="7213" y="-1974.06" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="7213" y="-1959.06" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="7213" y="-1944.06" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_13_mha&#45;&gt;layer_13_residual -->
<g id="edge531" class="edge">
<title>layer_13_mha&#45;&gt;layer_13_residual</title>
<path fill="none" stroke="black" d="M7078.73,-2761.09C7169.78,-2741.6 7289,-2707.34 7289,-2661.52 7289,-2661.52 7289,-2661.52 7289,-2096.76 7289,-2071.38 7276.42,-2047.12 7261.5,-2027.27"/>
<polygon fill="black" stroke="black" points="7264.17,-2025 7255.22,-2019.32 7258.67,-2029.34 7264.17,-2025"/>
<text text-anchor="middle" x="7317" y="-2368.44" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_13_all2all -->
<g id="node290" class="node">
<title>layer_13_all2all</title>
<ellipse fill="yellow" stroke="black" cx="5177" cy="-2523.33" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="5177" y="-2549.63" font-family="Times,serif" font-size="14.00">Layer 13</text>
<text text-anchor="middle" x="5177" y="-2534.63" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="5177" y="-2519.63" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="5177" y="-2504.63" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="5177" y="-2489.63" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_13_gate&#45;&gt;layer_13_all2all -->
<g id="edge497" class="edge">
<title>layer_13_gate&#45;&gt;layer_13_all2all</title>
<path fill="none" stroke="black" d="M6565.35,-2650.46C6308.76,-2627.15 5624.46,-2564.98 5323.03,-2537.6"/>
<polygon fill="black" stroke="black" points="5323.18,-2534.1 5312.91,-2536.68 5322.55,-2541.07 5323.18,-2534.1"/>
</g>
<!-- layer_13_expert_0 -->
<g id="node291" class="node">
<title>layer_13_expert_0</title>
<polygon fill="lightblue" stroke="black" points="3083,-2413.64 2823,-2413.64 2823,-2330.64 3083,-2330.64 3083,-2413.64"/>
<text text-anchor="middle" x="2953" y="-2398.44" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2953" y="-2383.44" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="2953" y="-2368.44" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2953" y="-2353.44" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="2953" y="-2338.44" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_13_all2all&#45;&gt;layer_13_expert_0 -->
<g id="edge498" class="edge">
<title>layer_13_all2all&#45;&gt;layer_13_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5037.71,-2519.53C4657.55,-2511.47 3607.72,-2486.19 3264,-2446.64 3189.84,-2438.11 3169.33,-2432.37 3093.2,-2413.89"/>
<polygon fill="black" stroke="black" points="3093.66,-2410.41 3083.12,-2411.45 3092.02,-2417.21 3093.66,-2410.41"/>
<text text-anchor="middle" x="3355.5" y="-2435.44" font-family="Times,serif" font-size="14.00">tokens routed to expert 0</text>
</g>
<!-- layer_13_expert_1 -->
<g id="node292" class="node">
<title>layer_13_expert_1</title>
<polygon fill="lightblue" stroke="black" points="3361,-2413.64 3101,-2413.64 3101,-2330.64 3361,-2330.64 3361,-2413.64"/>
<text text-anchor="middle" x="3231" y="-2398.44" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3231" y="-2383.44" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3231" y="-2368.44" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3231" y="-2353.44" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3231" y="-2338.44" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_13_all2all&#45;&gt;layer_13_expert_1 -->
<g id="edge499" class="edge">
<title>layer_13_all2all&#45;&gt;layer_13_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5037.56,-2522.94C4753.78,-2522.62 4089.12,-2513.99 3536,-2446.64 3481.4,-2439.99 3422.41,-2427.15 3370.99,-2414.04"/>
<polygon fill="black" stroke="black" points="3371.71,-2410.6 3361.15,-2411.5 3369.96,-2417.38 3371.71,-2410.6"/>
<text text-anchor="middle" x="3627.5" y="-2435.44" font-family="Times,serif" font-size="14.00">tokens routed to expert 1</text>
</g>
<!-- layer_13_expert_2 -->
<g id="node293" class="node">
<title>layer_13_expert_2</title>
<polygon fill="lightblue" stroke="black" points="3639,-2413.64 3379,-2413.64 3379,-2330.64 3639,-2330.64 3639,-2413.64"/>
<text text-anchor="middle" x="3509" y="-2398.44" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3509" y="-2383.44" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3509" y="-2368.44" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3509" y="-2353.44" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3509" y="-2338.44" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_13_all2all&#45;&gt;layer_13_expert_2 -->
<g id="edge500" class="edge">
<title>layer_13_all2all&#45;&gt;layer_13_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5037.7,-2521.56C4789.22,-2518.64 4253.6,-2505.4 3806,-2446.64 3754.03,-2439.82 3698,-2427.33 3648.76,-2414.57"/>
<polygon fill="black" stroke="black" points="3649.57,-2411.16 3639.01,-2412.01 3647.8,-2417.93 3649.57,-2411.16"/>
<text text-anchor="middle" x="3897.5" y="-2435.44" font-family="Times,serif" font-size="14.00">tokens routed to expert 2</text>
</g>
<!-- layer_13_expert_3 -->
<g id="node294" class="node">
<title>layer_13_expert_3</title>
<polygon fill="lightblue" stroke="black" points="3917,-2413.64 3657,-2413.64 3657,-2330.64 3917,-2330.64 3917,-2413.64"/>
<text text-anchor="middle" x="3787" y="-2398.44" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3787" y="-2383.44" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3787" y="-2368.44" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3787" y="-2353.44" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3787" y="-2338.44" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_13_all2all&#45;&gt;layer_13_expert_3 -->
<g id="edge501" class="edge">
<title>layer_13_all2all&#45;&gt;layer_13_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5037.67,-2520.38C4825.95,-2515.73 4411.01,-2499.99 4063,-2446.64 4017.77,-2439.71 3969.29,-2428.22 3925.78,-2416.37"/>
<polygon fill="black" stroke="black" points="3926.57,-2412.96 3916,-2413.67 3924.71,-2419.7 3926.57,-2412.96"/>
<text text-anchor="middle" x="4154.5" y="-2435.44" font-family="Times,serif" font-size="14.00">tokens routed to expert 3</text>
</g>
<!-- layer_13_expert_4 -->
<g id="node295" class="node">
<title>layer_13_expert_4</title>
<polygon fill="lightblue" stroke="black" points="4195,-2413.64 3935,-2413.64 3935,-2330.64 4195,-2330.64 4195,-2413.64"/>
<text text-anchor="middle" x="4065" y="-2398.44" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="4065" y="-2383.44" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4065" y="-2368.44" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4065" y="-2353.44" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4065" y="-2338.44" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_13_all2all&#45;&gt;layer_13_expert_4 -->
<g id="edge502" class="edge">
<title>layer_13_all2all&#45;&gt;layer_13_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5037.78,-2518.72C4866.04,-2512.3 4565.77,-2494.66 4313,-2446.64 4273.65,-2439.16 4231.62,-2427.97 4193.55,-2416.57"/>
<polygon fill="black" stroke="black" points="4194.54,-2413.21 4183.96,-2413.67 4192.51,-2419.91 4194.54,-2413.21"/>
<text text-anchor="middle" x="4404.5" y="-2435.44" font-family="Times,serif" font-size="14.00">tokens routed to expert 4</text>
</g>
<!-- layer_13_expert_5 -->
<g id="node296" class="node">
<title>layer_13_expert_5</title>
<polygon fill="lightblue" stroke="black" points="4473,-2413.64 4213,-2413.64 4213,-2330.64 4473,-2330.64 4473,-2413.64"/>
<text text-anchor="middle" x="4343" y="-2398.44" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="4343" y="-2383.44" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4343" y="-2368.44" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4343" y="-2353.44" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4343" y="-2338.44" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_13_all2all&#45;&gt;layer_13_expert_5 -->
<g id="edge503" class="edge">
<title>layer_13_all2all&#45;&gt;layer_13_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5039.18,-2514.19C4911.75,-2504.64 4717.74,-2484.99 4553,-2446.64 4520.44,-2439.06 4485.89,-2428.2 4454.43,-2417.16"/>
<polygon fill="black" stroke="black" points="4455.36,-2413.77 4444.76,-2413.72 4453.02,-2420.37 4455.36,-2413.77"/>
<text text-anchor="middle" x="4644.5" y="-2435.44" font-family="Times,serif" font-size="14.00">tokens routed to expert 5</text>
</g>
<!-- layer_13_expert_6 -->
<g id="node297" class="node">
<title>layer_13_expert_6</title>
<polygon fill="lightblue" stroke="black" points="4751,-2413.64 4491,-2413.64 4491,-2330.64 4751,-2330.64 4751,-2413.64"/>
<text text-anchor="middle" x="4621" y="-2398.44" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="4621" y="-2383.44" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4621" y="-2368.44" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4621" y="-2353.44" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4621" y="-2338.44" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_13_all2all&#45;&gt;layer_13_expert_6 -->
<g id="edge504" class="edge">
<title>layer_13_all2all&#45;&gt;layer_13_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5044.36,-2505.18C4966.49,-2493.09 4866.83,-2474.11 4781,-2446.64 4756.84,-2438.91 4731.53,-2428.46 4708.36,-2417.88"/>
<polygon fill="black" stroke="black" points="4709.79,-2414.69 4699.25,-2413.66 4706.85,-2421.04 4709.79,-2414.69"/>
<text text-anchor="middle" x="4872.5" y="-2435.44" font-family="Times,serif" font-size="14.00">tokens routed to expert 6</text>
</g>
<!-- layer_13_expert_7 -->
<g id="node298" class="node">
<title>layer_13_expert_7</title>
<polygon fill="lightblue" stroke="black" points="5029,-2413.64 4769,-2413.64 4769,-2330.64 5029,-2330.64 5029,-2413.64"/>
<text text-anchor="middle" x="4899" y="-2398.44" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="4899" y="-2383.44" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4899" y="-2368.44" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4899" y="-2353.44" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4899" y="-2338.44" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_13_all2all&#45;&gt;layer_13_expert_7 -->
<g id="edge505" class="edge">
<title>layer_13_all2all&#45;&gt;layer_13_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5070.06,-2485.35C5043.17,-2474.37 5014.9,-2461.3 4990,-2446.64 4976.94,-2438.95 4963.75,-2429.49 4951.63,-2419.96"/>
<polygon fill="black" stroke="black" points="4953.82,-2417.23 4943.83,-2413.7 4949.44,-2422.69 4953.82,-2417.23"/>
<text text-anchor="middle" x="5081.5" y="-2435.44" font-family="Times,serif" font-size="14.00">tokens routed to expert 7</text>
</g>
<!-- layer_13_expert_8 -->
<g id="node299" class="node">
<title>layer_13_expert_8</title>
<polygon fill="lightblue" stroke="black" points="5307,-2413.64 5047,-2413.64 5047,-2330.64 5307,-2330.64 5307,-2413.64"/>
<text text-anchor="middle" x="5177" y="-2398.44" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="5177" y="-2383.44" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5177" y="-2368.44" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5177" y="-2353.44" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5177" y="-2338.44" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_13_all2all&#45;&gt;layer_13_expert_8 -->
<g id="edge506" class="edge">
<title>layer_13_all2all&#45;&gt;layer_13_expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5177,-2464.22C5177,-2450.92 5177,-2436.89 5177,-2423.92"/>
<polygon fill="black" stroke="black" points="5180.5,-2423.79 5177,-2413.79 5173.5,-2423.79 5180.5,-2423.79"/>
<text text-anchor="middle" x="5268.5" y="-2435.44" font-family="Times,serif" font-size="14.00">tokens routed to expert 8</text>
</g>
<!-- layer_13_expert_9 -->
<g id="node300" class="node">
<title>layer_13_expert_9</title>
<polygon fill="lightblue" stroke="black" points="5585,-2413.64 5325,-2413.64 5325,-2330.64 5585,-2330.64 5585,-2413.64"/>
<text text-anchor="middle" x="5455" y="-2398.44" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="5455" y="-2383.44" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5455" y="-2368.44" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5455" y="-2353.44" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5455" y="-2338.44" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_13_all2all&#45;&gt;layer_13_expert_9 -->
<g id="edge507" class="edge">
<title>layer_13_all2all&#45;&gt;layer_13_expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5283.94,-2485.35C5310.83,-2474.37 5339.1,-2461.3 5364,-2446.64 5377.06,-2438.95 5390.25,-2429.49 5402.37,-2419.96"/>
<polygon fill="black" stroke="black" points="5404.56,-2422.69 5410.17,-2413.7 5400.18,-2417.23 5404.56,-2422.69"/>
<text text-anchor="middle" x="5476.5" y="-2435.44" font-family="Times,serif" font-size="14.00">tokens routed to expert 9</text>
</g>
<!-- layer_13_expert_10 -->
<g id="node301" class="node">
<title>layer_13_expert_10</title>
<polygon fill="lightblue" stroke="black" points="5863,-2413.64 5603,-2413.64 5603,-2330.64 5863,-2330.64 5863,-2413.64"/>
<text text-anchor="middle" x="5733" y="-2398.44" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="5733" y="-2383.44" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5733" y="-2368.44" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5733" y="-2353.44" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5733" y="-2338.44" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_13_all2all&#45;&gt;layer_13_expert_10 -->
<g id="edge508" class="edge">
<title>layer_13_all2all&#45;&gt;layer_13_expert_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5309.73,-2505C5387.33,-2492.87 5486.52,-2473.91 5572,-2446.64 5596.29,-2438.89 5621.75,-2428.44 5645.07,-2417.86"/>
<polygon fill="black" stroke="black" points="5646.61,-2421 5654.24,-2413.64 5643.69,-2414.64 5646.61,-2421"/>
<text text-anchor="middle" x="5708" y="-2435.44" font-family="Times,serif" font-size="14.00">tokens routed to expert 10</text>
</g>
<!-- layer_13_expert_11 -->
<g id="node302" class="node">
<title>layer_13_expert_11</title>
<polygon fill="lightblue" stroke="black" points="6141,-2413.64 5881,-2413.64 5881,-2330.64 6141,-2330.64 6141,-2413.64"/>
<text text-anchor="middle" x="6011" y="-2398.44" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="6011" y="-2383.44" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6011" y="-2368.44" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6011" y="-2353.44" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6011" y="-2338.44" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_13_all2all&#45;&gt;layer_13_expert_11 -->
<g id="edge509" class="edge">
<title>layer_13_all2all&#45;&gt;layer_13_expert_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5314.9,-2514.86C5443.81,-2505.75 5640.95,-2486.35 5808,-2446.64 5839.51,-2439.15 5872.87,-2428.34 5903.25,-2417.31"/>
<polygon fill="black" stroke="black" points="5904.82,-2420.46 5913,-2413.73 5902.4,-2413.89 5904.82,-2420.46"/>
<text text-anchor="middle" x="5955" y="-2435.44" font-family="Times,serif" font-size="14.00">tokens routed to expert 11</text>
</g>
<!-- layer_13_expert_12 -->
<g id="node303" class="node">
<title>layer_13_expert_12</title>
<polygon fill="lightblue" stroke="black" points="6419,-2413.64 6159,-2413.64 6159,-2330.64 6419,-2330.64 6419,-2413.64"/>
<text text-anchor="middle" x="6289" y="-2398.44" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="6289" y="-2383.44" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6289" y="-2368.44" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6289" y="-2353.44" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6289" y="-2338.44" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_13_all2all&#45;&gt;layer_13_expert_12 -->
<g id="edge510" class="edge">
<title>layer_13_all2all&#45;&gt;layer_13_expert_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5316.31,-2519.68C5490.58,-2514.22 5797.41,-2497.56 6055,-2446.64 6092.2,-2439.29 6131.83,-2428.16 6167.7,-2416.77"/>
<polygon fill="black" stroke="black" points="6168.77,-2420.1 6177.22,-2413.71 6166.63,-2413.43 6168.77,-2420.1"/>
<text text-anchor="middle" x="6209" y="-2435.44" font-family="Times,serif" font-size="14.00">tokens routed to expert 12</text>
</g>
<!-- layer_13_expert_13 -->
<g id="node304" class="node">
<title>layer_13_expert_13</title>
<polygon fill="lightblue" stroke="black" points="6697,-2413.64 6437,-2413.64 6437,-2330.64 6697,-2330.64 6697,-2413.64"/>
<text text-anchor="middle" x="6567" y="-2398.44" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="6567" y="-2383.44" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6567" y="-2368.44" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6567" y="-2353.44" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6567" y="-2338.44" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_13_all2all&#45;&gt;layer_13_expert_13 -->
<g id="edge511" class="edge">
<title>layer_13_all2all&#45;&gt;layer_13_expert_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5316.61,-2522.1C5531.38,-2519.71 5955.12,-2506.89 6309,-2446.64 6350.67,-2439.54 6395.23,-2428.24 6435.38,-2416.6"/>
<polygon fill="black" stroke="black" points="6436.61,-2419.89 6445.22,-2413.72 6434.64,-2413.17 6436.61,-2419.89"/>
<text text-anchor="middle" x="6469" y="-2435.44" font-family="Times,serif" font-size="14.00">tokens routed to expert 13</text>
</g>
<!-- layer_13_expert_14 -->
<g id="node305" class="node">
<title>layer_13_expert_14</title>
<polygon fill="lightblue" stroke="black" points="6975,-2413.64 6715,-2413.64 6715,-2330.64 6975,-2330.64 6975,-2413.64"/>
<text text-anchor="middle" x="6845" y="-2398.44" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="6845" y="-2383.44" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6845" y="-2368.44" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6845" y="-2353.44" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6845" y="-2338.44" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_13_all2all&#45;&gt;layer_13_expert_14 -->
<g id="edge512" class="edge">
<title>layer_13_all2all&#45;&gt;layer_13_expert_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5316.63,-2523.11C5568.34,-2522.66 6114.3,-2513.2 6569,-2446.64 6614.73,-2439.95 6663.74,-2428.38 6707.59,-2416.39"/>
<polygon fill="black" stroke="black" points="6708.74,-2419.7 6717.45,-2413.66 6706.87,-2412.95 6708.74,-2419.7"/>
<text text-anchor="middle" x="6741" y="-2435.44" font-family="Times,serif" font-size="14.00">tokens routed to expert 14</text>
</g>
<!-- layer_13_expert_15 -->
<g id="node306" class="node">
<title>layer_13_expert_15</title>
<polygon fill="lightblue" stroke="black" points="7253,-2413.64 6993,-2413.64 6993,-2330.64 7253,-2330.64 7253,-2413.64"/>
<text text-anchor="middle" x="7123" y="-2398.44" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="7123" y="-2383.44" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="7123" y="-2368.44" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="7123" y="-2353.44" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="7123" y="-2338.44" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_13_all2all&#45;&gt;layer_13_expert_15 -->
<g id="edge513" class="edge">
<title>layer_13_all2all&#45;&gt;layer_13_expert_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5316.05,-2519.25C5660.75,-2511.1 6547.95,-2486.78 6841,-2446.64 6888.17,-2440.18 6938.76,-2428.54 6983.89,-2416.4"/>
<polygon fill="black" stroke="black" points="6985,-2419.72 6993.73,-2413.72 6983.16,-2412.97 6985,-2419.72"/>
<text text-anchor="middle" x="7015" y="-2435.44" font-family="Times,serif" font-size="14.00">tokens routed to expert 15</text>
</g>
<!-- layer_13_all2all_result -->
<g id="node307" class="node">
<title>layer_13_all2all_result</title>
<ellipse fill="yellow" stroke="black" cx="5177" cy="-2234.95" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="5177" y="-2261.25" font-family="Times,serif" font-size="14.00">Layer 13</text>
<text text-anchor="middle" x="5177" y="-2246.25" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Result Merge</text>
<text text-anchor="middle" x="5177" y="-2231.25" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="5177" y="-2216.25" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="5177" y="-2201.25" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_13_expert_0&#45;&gt;layer_13_all2all_result -->
<g id="edge514" class="edge">
<title>layer_13_expert_0&#45;&gt;layer_13_all2all_result</title>
<path fill="none" stroke="black" d="M3083,-2332.24C3086.02,-2331.67 3089.02,-2331.13 3092,-2330.64 3464.89,-2268.76 4614.76,-2244.85 5027.55,-2238.12"/>
<polygon fill="black" stroke="black" points="5027.81,-2241.62 5037.76,-2237.95 5027.7,-2234.62 5027.81,-2241.62"/>
</g>
<!-- layer_13_expert_1&#45;&gt;layer_13_all2all_result -->
<g id="edge515" class="edge">
<title>layer_13_expert_1&#45;&gt;layer_13_all2all_result</title>
<path fill="none" stroke="black" d="M3361.01,-2332.27C3364.03,-2331.69 3367.03,-2331.14 3370,-2330.64 3687.38,-2276.83 4654.71,-2248.49 5027.92,-2239.32"/>
<polygon fill="black" stroke="black" points="5028.07,-2242.82 5037.98,-2239.08 5027.9,-2235.82 5028.07,-2242.82"/>
</g>
<!-- layer_13_expert_2&#45;&gt;layer_13_all2all_result -->
<g id="edge516" class="edge">
<title>layer_13_expert_2&#45;&gt;layer_13_all2all_result</title>
<path fill="none" stroke="black" d="M3639.01,-2332.31C3642.03,-2331.72 3645.03,-2331.16 3648,-2330.64 3910.24,-2284.9 4697.24,-2252.79 5028,-2240.97"/>
<polygon fill="black" stroke="black" points="5028.26,-2244.46 5038.13,-2240.61 5028.01,-2237.47 5028.26,-2244.46"/>
</g>
<!-- layer_13_expert_3&#45;&gt;layer_13_all2all_result -->
<g id="edge517" class="edge">
<title>layer_13_expert_3&#45;&gt;layer_13_all2all_result</title>
<path fill="none" stroke="black" d="M3917.02,-2332.37C3920.04,-2331.75 3923.03,-2331.18 3926,-2330.64 4319.23,-2259.27 4791.45,-2241.56 5027.41,-2237.26"/>
<polygon fill="black" stroke="black" points="5027.49,-2240.76 5037.43,-2237.08 5027.37,-2233.76 5027.49,-2240.76"/>
</g>
<!-- layer_13_expert_4&#45;&gt;layer_13_all2all_result -->
<g id="edge518" class="edge">
<title>layer_13_expert_4&#45;&gt;layer_13_all2all_result</title>
<path fill="none" stroke="black" d="M4195.04,-2332.45C4198.05,-2331.82 4201.04,-2331.21 4204,-2330.64 4492.78,-2275.02 4836.4,-2251.31 5028.32,-2241.8"/>
<polygon fill="black" stroke="black" points="5028.66,-2245.29 5038.47,-2241.3 5028.32,-2238.29 5028.66,-2245.29"/>
</g>
<!-- layer_13_expert_5&#45;&gt;layer_13_all2all_result -->
<g id="edge519" class="edge">
<title>layer_13_expert_5&#45;&gt;layer_13_all2all_result</title>
<path fill="none" stroke="black" d="M4473.07,-2332.61C4476.07,-2331.92 4479.05,-2331.27 4482,-2330.64 4669.71,-2290.73 4889.69,-2264.08 5031.08,-2249.48"/>
<polygon fill="black" stroke="black" points="5031.53,-2252.95 5041.12,-2248.45 5030.81,-2245.99 5031.53,-2252.95"/>
</g>
<!-- layer_13_expert_6&#45;&gt;layer_13_all2all_result -->
<g id="edge520" class="edge">
<title>layer_13_expert_6&#45;&gt;layer_13_all2all_result</title>
<path fill="none" stroke="black" d="M4751.15,-2332.96C4754.13,-2332.17 4757.08,-2331.39 4760,-2330.64 4854.1,-2306.27 4961.02,-2282.06 5043.03,-2264.22"/>
<polygon fill="black" stroke="black" points="5043.88,-2267.62 5052.91,-2262.08 5042.39,-2260.78 5043.88,-2267.62"/>
</g>
<!-- layer_13_expert_7&#45;&gt;layer_13_all2all_result -->
<g id="edge521" class="edge">
<title>layer_13_expert_7&#45;&gt;layer_13_all2all_result</title>
<path fill="none" stroke="black" d="M4982.41,-2330.58C5012.4,-2316 5046.51,-2299.4 5077.72,-2284.23"/>
<polygon fill="black" stroke="black" points="5079.41,-2287.3 5086.87,-2279.78 5076.34,-2281.01 5079.41,-2287.3"/>
</g>
<!-- layer_13_expert_8&#45;&gt;layer_13_all2all_result -->
<g id="edge522" class="edge">
<title>layer_13_expert_8&#45;&gt;layer_13_all2all_result</title>
<path fill="none" stroke="black" d="M5177,-2330.58C5177,-2322.21 5177,-2313.19 5177,-2304.15"/>
<polygon fill="black" stroke="black" points="5180.5,-2303.97 5177,-2293.97 5173.5,-2303.97 5180.5,-2303.97"/>
</g>
<!-- layer_13_expert_9&#45;&gt;layer_13_all2all_result -->
<g id="edge523" class="edge">
<title>layer_13_expert_9&#45;&gt;layer_13_all2all_result</title>
<path fill="none" stroke="black" d="M5371.59,-2330.58C5341.6,-2316 5307.49,-2299.4 5276.28,-2284.23"/>
<polygon fill="black" stroke="black" points="5277.66,-2281.01 5267.13,-2279.78 5274.59,-2287.3 5277.66,-2281.01"/>
</g>
<!-- layer_13_expert_10&#45;&gt;layer_13_all2all_result -->
<g id="edge524" class="edge">
<title>layer_13_expert_10&#45;&gt;layer_13_all2all_result</title>
<path fill="none" stroke="black" d="M5602.85,-2332.96C5599.87,-2332.17 5596.92,-2331.39 5594,-2330.64 5499.9,-2306.27 5392.98,-2282.06 5310.97,-2264.22"/>
<polygon fill="black" stroke="black" points="5311.61,-2260.78 5301.09,-2262.08 5310.12,-2267.62 5311.61,-2260.78"/>
</g>
<!-- layer_13_expert_11&#45;&gt;layer_13_all2all_result -->
<g id="edge525" class="edge">
<title>layer_13_expert_11&#45;&gt;layer_13_all2all_result</title>
<path fill="none" stroke="black" d="M5880.93,-2332.61C5877.93,-2331.92 5874.95,-2331.27 5872,-2330.64 5684.29,-2290.73 5464.31,-2264.08 5322.92,-2249.48"/>
<polygon fill="black" stroke="black" points="5323.19,-2245.99 5312.88,-2248.45 5322.47,-2252.95 5323.19,-2245.99"/>
</g>
<!-- layer_13_expert_12&#45;&gt;layer_13_all2all_result -->
<g id="edge526" class="edge">
<title>layer_13_expert_12&#45;&gt;layer_13_all2all_result</title>
<path fill="none" stroke="black" d="M6158.96,-2332.45C6155.95,-2331.82 6152.96,-2331.21 6150,-2330.64 5861.22,-2275.02 5517.6,-2251.31 5325.68,-2241.8"/>
<polygon fill="black" stroke="black" points="5325.68,-2238.29 5315.53,-2241.3 5325.34,-2245.29 5325.68,-2238.29"/>
</g>
<!-- layer_13_expert_13&#45;&gt;layer_13_all2all_result -->
<g id="edge527" class="edge">
<title>layer_13_expert_13&#45;&gt;layer_13_all2all_result</title>
<path fill="none" stroke="black" d="M6436.98,-2332.37C6433.96,-2331.75 6430.97,-2331.18 6428,-2330.64 6034.77,-2259.27 5562.55,-2241.56 5326.59,-2237.26"/>
<polygon fill="black" stroke="black" points="5326.63,-2233.76 5316.57,-2237.08 5326.51,-2240.76 5326.63,-2233.76"/>
</g>
<!-- layer_13_expert_14&#45;&gt;layer_13_all2all_result -->
<g id="edge528" class="edge">
<title>layer_13_expert_14&#45;&gt;layer_13_all2all_result</title>
<path fill="none" stroke="black" d="M6714.99,-2332.31C6711.97,-2331.72 6708.97,-2331.16 6706,-2330.64 6443.76,-2284.9 5656.76,-2252.79 5326,-2240.97"/>
<polygon fill="black" stroke="black" points="5325.99,-2237.47 5315.87,-2240.61 5325.74,-2244.46 5325.99,-2237.47"/>
</g>
<!-- layer_13_expert_15&#45;&gt;layer_13_all2all_result -->
<g id="edge529" class="edge">
<title>layer_13_expert_15&#45;&gt;layer_13_all2all_result</title>
<path fill="none" stroke="black" d="M6992.99,-2332.27C6989.97,-2331.69 6986.97,-2331.14 6984,-2330.64 6666.62,-2276.83 5699.29,-2248.49 5326.08,-2239.32"/>
<polygon fill="black" stroke="black" points="5326.1,-2235.82 5316.02,-2239.08 5325.93,-2242.82 5326.1,-2235.82"/>
</g>
<!-- layer_13_expert_agg -->
<g id="node308" class="node">
<title>layer_13_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="6771,-2139.26 6523,-2139.26 6523,-2056.26 6771,-2056.26 6771,-2139.26"/>
<text text-anchor="middle" x="6647" y="-2124.06" font-family="Times,serif" font-size="14.00">Layer 13</text>
<text text-anchor="middle" x="6647" y="-2109.06" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="6647" y="-2094.06" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6647" y="-2079.06" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="6647" y="-2064.06" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_13_all2all_result&#45;&gt;layer_13_expert_agg -->
<g id="edge530" class="edge">
<title>layer_13_all2all_result&#45;&gt;layer_13_expert_agg</title>
<path fill="none" stroke="black" d="M5312.66,-2221.47C5593.06,-2195.69 6233.53,-2136.78 6512.73,-2111.11"/>
<polygon fill="black" stroke="black" points="6513.28,-2114.57 6522.92,-2110.17 6512.64,-2107.6 6513.28,-2114.57"/>
</g>
<!-- layer_13_expert_agg&#45;&gt;layer_13_residual -->
<g id="edge532" class="edge">
<title>layer_13_expert_agg&#45;&gt;layer_13_residual</title>
<path fill="none" stroke="black" d="M6771.21,-2070.86C6849.7,-2054.5 6952.29,-2033.11 7038.85,-2015.07"/>
<polygon fill="black" stroke="black" points="7039.7,-2018.46 7048.78,-2013 7038.28,-2011.61 7039.7,-2018.46"/>
</g>
<!-- layer_14_mha -->
<g id="node310" class="node">
<title>layer_14_mha</title>
<polygon fill="lightblue" stroke="black" points="7314.5,-1899.26 7111.5,-1899.26 7111.5,-1816.26 7314.5,-1816.26 7314.5,-1899.26"/>
<text text-anchor="middle" x="7213" y="-1884.06" font-family="Times,serif" font-size="14.00">Layer 14</text>
<text text-anchor="middle" x="7213" y="-1869.06" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="7213" y="-1854.06" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="7213" y="-1839.06" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="7213" y="-1824.06" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_13_residual&#45;&gt;layer_14_mha -->
<g id="edge533" class="edge">
<title>layer_13_residual&#45;&gt;layer_14_mha</title>
<path fill="none" stroke="black" d="M7213,-1936.15C7213,-1927.62 7213,-1918.52 7213,-1909.67"/>
<polygon fill="black" stroke="black" points="7216.5,-1909.44 7213,-1899.44 7209.5,-1909.44 7216.5,-1909.44"/>
</g>
<!-- layer_14_gate -->
<g id="node311" class="node">
<title>layer_14_gate</title>
<polygon fill="lightblue" stroke="black" points="7000.5,-1779.26 6801.5,-1779.26 6801.5,-1696.26 7000.5,-1696.26 7000.5,-1779.26"/>
<text text-anchor="middle" x="6901" y="-1764.06" font-family="Times,serif" font-size="14.00">Layer 14</text>
<text text-anchor="middle" x="6901" y="-1749.06" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="6901" y="-1734.06" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="6901" y="-1719.06" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="6901" y="-1704.06" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_14_mha&#45;&gt;layer_14_gate -->
<g id="edge534" class="edge">
<title>layer_14_mha&#45;&gt;layer_14_gate</title>
<path fill="none" stroke="black" d="M7111.27,-1818.28C7078.98,-1806.07 7043.15,-1792.52 7010.35,-1780.11"/>
<polygon fill="black" stroke="black" points="7011.32,-1776.74 7000.73,-1776.48 7008.84,-1783.29 7011.32,-1776.74"/>
</g>
<!-- layer_14_residual -->
<g id="node331" class="node">
<title>layer_14_residual</title>
<polygon fill="lightblue" stroke="black" points="7613,-1096.5 7285,-1096.5 7285,-1013.5 7613,-1013.5 7613,-1096.5"/>
<text text-anchor="middle" x="7449" y="-1081.3" font-family="Times,serif" font-size="14.00">Layer 14</text>
<text text-anchor="middle" x="7449" y="-1066.3" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="7449" y="-1051.3" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="7449" y="-1036.3" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="7449" y="-1021.3" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_14_mha&#45;&gt;layer_14_residual -->
<g id="edge569" class="edge">
<title>layer_14_mha&#45;&gt;layer_14_residual</title>
<path fill="none" stroke="black" d="M7314.73,-1838.33C7405.78,-1818.84 7525,-1784.58 7525,-1738.76 7525,-1738.76 7525,-1738.76 7525,-1174 7525,-1148.62 7512.42,-1124.36 7497.5,-1104.51"/>
<polygon fill="black" stroke="black" points="7500.17,-1102.24 7491.22,-1096.57 7494.67,-1106.58 7500.17,-1102.24"/>
<text text-anchor="middle" x="7553" y="-1445.68" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_14_all2all -->
<g id="node312" class="node">
<title>layer_14_all2all</title>
<ellipse fill="yellow" stroke="black" cx="5413" cy="-1600.57" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="5413" y="-1626.87" font-family="Times,serif" font-size="14.00">Layer 14</text>
<text text-anchor="middle" x="5413" y="-1611.87" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="5413" y="-1596.87" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="5413" y="-1581.87" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="5413" y="-1566.87" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_14_gate&#45;&gt;layer_14_all2all -->
<g id="edge535" class="edge">
<title>layer_14_gate&#45;&gt;layer_14_all2all</title>
<path fill="none" stroke="black" d="M6801.35,-1727.71C6544.76,-1704.39 5860.46,-1642.22 5559.03,-1614.84"/>
<polygon fill="black" stroke="black" points="5559.18,-1611.34 5548.91,-1613.92 5558.55,-1618.31 5559.18,-1611.34"/>
</g>
<!-- layer_14_expert_0 -->
<g id="node313" class="node">
<title>layer_14_expert_0</title>
<polygon fill="lightblue" stroke="black" points="3319,-1490.88 3059,-1490.88 3059,-1407.88 3319,-1407.88 3319,-1490.88"/>
<text text-anchor="middle" x="3189" y="-1475.68" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="3189" y="-1460.68" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3189" y="-1445.68" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3189" y="-1430.68" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3189" y="-1415.68" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_14_all2all&#45;&gt;layer_14_expert_0 -->
<g id="edge536" class="edge">
<title>layer_14_all2all&#45;&gt;layer_14_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5273.71,-1596.77C4893.55,-1588.71 3843.72,-1563.43 3500,-1523.88 3425.84,-1515.35 3405.33,-1509.61 3329.2,-1491.14"/>
<polygon fill="black" stroke="black" points="3329.66,-1487.65 3319.12,-1488.69 3328.02,-1494.45 3329.66,-1487.65"/>
<text text-anchor="middle" x="3591.5" y="-1512.68" font-family="Times,serif" font-size="14.00">tokens routed to expert 0</text>
</g>
<!-- layer_14_expert_1 -->
<g id="node314" class="node">
<title>layer_14_expert_1</title>
<polygon fill="lightblue" stroke="black" points="3597,-1490.88 3337,-1490.88 3337,-1407.88 3597,-1407.88 3597,-1490.88"/>
<text text-anchor="middle" x="3467" y="-1475.68" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3467" y="-1460.68" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3467" y="-1445.68" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3467" y="-1430.68" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3467" y="-1415.68" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_14_all2all&#45;&gt;layer_14_expert_1 -->
<g id="edge537" class="edge">
<title>layer_14_all2all&#45;&gt;layer_14_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5273.56,-1600.18C4989.78,-1599.86 4325.12,-1591.23 3772,-1523.88 3717.4,-1517.23 3658.41,-1504.39 3606.99,-1491.28"/>
<polygon fill="black" stroke="black" points="3607.71,-1487.85 3597.15,-1488.74 3605.96,-1494.62 3607.71,-1487.85"/>
<text text-anchor="middle" x="3863.5" y="-1512.68" font-family="Times,serif" font-size="14.00">tokens routed to expert 1</text>
</g>
<!-- layer_14_expert_2 -->
<g id="node315" class="node">
<title>layer_14_expert_2</title>
<polygon fill="lightblue" stroke="black" points="3875,-1490.88 3615,-1490.88 3615,-1407.88 3875,-1407.88 3875,-1490.88"/>
<text text-anchor="middle" x="3745" y="-1475.68" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3745" y="-1460.68" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3745" y="-1445.68" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3745" y="-1430.68" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3745" y="-1415.68" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_14_all2all&#45;&gt;layer_14_expert_2 -->
<g id="edge538" class="edge">
<title>layer_14_all2all&#45;&gt;layer_14_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5273.7,-1598.8C5025.22,-1595.88 4489.6,-1582.64 4042,-1523.88 3990.03,-1517.06 3934,-1504.58 3884.76,-1491.81"/>
<polygon fill="black" stroke="black" points="3885.57,-1488.4 3875.01,-1489.25 3883.8,-1495.17 3885.57,-1488.4"/>
<text text-anchor="middle" x="4133.5" y="-1512.68" font-family="Times,serif" font-size="14.00">tokens routed to expert 2</text>
</g>
<!-- layer_14_expert_3 -->
<g id="node316" class="node">
<title>layer_14_expert_3</title>
<polygon fill="lightblue" stroke="black" points="4153,-1490.88 3893,-1490.88 3893,-1407.88 4153,-1407.88 4153,-1490.88"/>
<text text-anchor="middle" x="4023" y="-1475.68" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="4023" y="-1460.68" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4023" y="-1445.68" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4023" y="-1430.68" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4023" y="-1415.68" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_14_all2all&#45;&gt;layer_14_expert_3 -->
<g id="edge539" class="edge">
<title>layer_14_all2all&#45;&gt;layer_14_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5273.67,-1597.62C5061.95,-1592.98 4647.01,-1577.23 4299,-1523.88 4253.77,-1516.95 4205.29,-1505.46 4161.78,-1493.61"/>
<polygon fill="black" stroke="black" points="4162.57,-1490.2 4152,-1490.92 4160.71,-1496.94 4162.57,-1490.2"/>
<text text-anchor="middle" x="4390.5" y="-1512.68" font-family="Times,serif" font-size="14.00">tokens routed to expert 3</text>
</g>
<!-- layer_14_expert_4 -->
<g id="node317" class="node">
<title>layer_14_expert_4</title>
<polygon fill="lightblue" stroke="black" points="4431,-1490.88 4171,-1490.88 4171,-1407.88 4431,-1407.88 4431,-1490.88"/>
<text text-anchor="middle" x="4301" y="-1475.68" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="4301" y="-1460.68" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4301" y="-1445.68" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4301" y="-1430.68" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4301" y="-1415.68" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_14_all2all&#45;&gt;layer_14_expert_4 -->
<g id="edge540" class="edge">
<title>layer_14_all2all&#45;&gt;layer_14_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5273.78,-1595.96C5102.04,-1589.54 4801.77,-1571.9 4549,-1523.88 4509.65,-1516.4 4467.62,-1505.21 4429.55,-1493.81"/>
<polygon fill="black" stroke="black" points="4430.54,-1490.45 4419.96,-1490.91 4428.51,-1497.15 4430.54,-1490.45"/>
<text text-anchor="middle" x="4640.5" y="-1512.68" font-family="Times,serif" font-size="14.00">tokens routed to expert 4</text>
</g>
<!-- layer_14_expert_5 -->
<g id="node318" class="node">
<title>layer_14_expert_5</title>
<polygon fill="lightblue" stroke="black" points="4709,-1490.88 4449,-1490.88 4449,-1407.88 4709,-1407.88 4709,-1490.88"/>
<text text-anchor="middle" x="4579" y="-1475.68" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="4579" y="-1460.68" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4579" y="-1445.68" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4579" y="-1430.68" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4579" y="-1415.68" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_14_all2all&#45;&gt;layer_14_expert_5 -->
<g id="edge541" class="edge">
<title>layer_14_all2all&#45;&gt;layer_14_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5275.18,-1591.43C5147.75,-1581.88 4953.74,-1562.23 4789,-1523.88 4756.44,-1516.3 4721.89,-1505.45 4690.43,-1494.4"/>
<polygon fill="black" stroke="black" points="4691.36,-1491.01 4680.76,-1490.96 4689.02,-1497.61 4691.36,-1491.01"/>
<text text-anchor="middle" x="4880.5" y="-1512.68" font-family="Times,serif" font-size="14.00">tokens routed to expert 5</text>
</g>
<!-- layer_14_expert_6 -->
<g id="node319" class="node">
<title>layer_14_expert_6</title>
<polygon fill="lightblue" stroke="black" points="4987,-1490.88 4727,-1490.88 4727,-1407.88 4987,-1407.88 4987,-1490.88"/>
<text text-anchor="middle" x="4857" y="-1475.68" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="4857" y="-1460.68" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4857" y="-1445.68" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4857" y="-1430.68" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4857" y="-1415.68" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_14_all2all&#45;&gt;layer_14_expert_6 -->
<g id="edge542" class="edge">
<title>layer_14_all2all&#45;&gt;layer_14_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5280.36,-1582.42C5202.49,-1570.33 5102.83,-1551.35 5017,-1523.88 4992.84,-1516.15 4967.53,-1505.7 4944.36,-1495.12"/>
<polygon fill="black" stroke="black" points="4945.79,-1491.93 4935.25,-1490.91 4942.85,-1498.28 4945.79,-1491.93"/>
<text text-anchor="middle" x="5108.5" y="-1512.68" font-family="Times,serif" font-size="14.00">tokens routed to expert 6</text>
</g>
<!-- layer_14_expert_7 -->
<g id="node320" class="node">
<title>layer_14_expert_7</title>
<polygon fill="lightblue" stroke="black" points="5265,-1490.88 5005,-1490.88 5005,-1407.88 5265,-1407.88 5265,-1490.88"/>
<text text-anchor="middle" x="5135" y="-1475.68" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="5135" y="-1460.68" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5135" y="-1445.68" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5135" y="-1430.68" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5135" y="-1415.68" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_14_all2all&#45;&gt;layer_14_expert_7 -->
<g id="edge543" class="edge">
<title>layer_14_all2all&#45;&gt;layer_14_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5306.06,-1562.59C5279.17,-1551.61 5250.9,-1538.54 5226,-1523.88 5212.94,-1516.19 5199.75,-1506.73 5187.63,-1497.2"/>
<polygon fill="black" stroke="black" points="5189.82,-1494.47 5179.83,-1490.94 5185.44,-1499.93 5189.82,-1494.47"/>
<text text-anchor="middle" x="5317.5" y="-1512.68" font-family="Times,serif" font-size="14.00">tokens routed to expert 7</text>
</g>
<!-- layer_14_expert_8 -->
<g id="node321" class="node">
<title>layer_14_expert_8</title>
<polygon fill="lightblue" stroke="black" points="5543,-1490.88 5283,-1490.88 5283,-1407.88 5543,-1407.88 5543,-1490.88"/>
<text text-anchor="middle" x="5413" y="-1475.68" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="5413" y="-1460.68" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5413" y="-1445.68" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5413" y="-1430.68" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5413" y="-1415.68" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_14_all2all&#45;&gt;layer_14_expert_8 -->
<g id="edge544" class="edge">
<title>layer_14_all2all&#45;&gt;layer_14_expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5413,-1541.46C5413,-1528.16 5413,-1514.13 5413,-1501.16"/>
<polygon fill="black" stroke="black" points="5416.5,-1501.03 5413,-1491.03 5409.5,-1501.03 5416.5,-1501.03"/>
<text text-anchor="middle" x="5504.5" y="-1512.68" font-family="Times,serif" font-size="14.00">tokens routed to expert 8</text>
</g>
<!-- layer_14_expert_9 -->
<g id="node322" class="node">
<title>layer_14_expert_9</title>
<polygon fill="lightblue" stroke="black" points="5821,-1490.88 5561,-1490.88 5561,-1407.88 5821,-1407.88 5821,-1490.88"/>
<text text-anchor="middle" x="5691" y="-1475.68" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="5691" y="-1460.68" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5691" y="-1445.68" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5691" y="-1430.68" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5691" y="-1415.68" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_14_all2all&#45;&gt;layer_14_expert_9 -->
<g id="edge545" class="edge">
<title>layer_14_all2all&#45;&gt;layer_14_expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5519.94,-1562.59C5546.83,-1551.61 5575.1,-1538.54 5600,-1523.88 5613.06,-1516.19 5626.25,-1506.73 5638.37,-1497.2"/>
<polygon fill="black" stroke="black" points="5640.56,-1499.93 5646.17,-1490.94 5636.18,-1494.47 5640.56,-1499.93"/>
<text text-anchor="middle" x="5712.5" y="-1512.68" font-family="Times,serif" font-size="14.00">tokens routed to expert 9</text>
</g>
<!-- layer_14_expert_10 -->
<g id="node323" class="node">
<title>layer_14_expert_10</title>
<polygon fill="lightblue" stroke="black" points="6099,-1490.88 5839,-1490.88 5839,-1407.88 6099,-1407.88 6099,-1490.88"/>
<text text-anchor="middle" x="5969" y="-1475.68" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="5969" y="-1460.68" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5969" y="-1445.68" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5969" y="-1430.68" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5969" y="-1415.68" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_14_all2all&#45;&gt;layer_14_expert_10 -->
<g id="edge546" class="edge">
<title>layer_14_all2all&#45;&gt;layer_14_expert_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5545.73,-1582.24C5623.33,-1570.11 5722.52,-1551.15 5808,-1523.88 5832.29,-1516.13 5857.75,-1505.68 5881.07,-1495.1"/>
<polygon fill="black" stroke="black" points="5882.61,-1498.24 5890.24,-1490.88 5879.69,-1491.88 5882.61,-1498.24"/>
<text text-anchor="middle" x="5944" y="-1512.68" font-family="Times,serif" font-size="14.00">tokens routed to expert 10</text>
</g>
<!-- layer_14_expert_11 -->
<g id="node324" class="node">
<title>layer_14_expert_11</title>
<polygon fill="lightblue" stroke="black" points="6377,-1490.88 6117,-1490.88 6117,-1407.88 6377,-1407.88 6377,-1490.88"/>
<text text-anchor="middle" x="6247" y="-1475.68" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="6247" y="-1460.68" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6247" y="-1445.68" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6247" y="-1430.68" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6247" y="-1415.68" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_14_all2all&#45;&gt;layer_14_expert_11 -->
<g id="edge547" class="edge">
<title>layer_14_all2all&#45;&gt;layer_14_expert_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5550.9,-1592.1C5679.81,-1582.99 5876.95,-1563.59 6044,-1523.88 6075.51,-1516.39 6108.87,-1505.58 6139.25,-1494.55"/>
<polygon fill="black" stroke="black" points="6140.82,-1497.7 6149,-1490.97 6138.4,-1491.13 6140.82,-1497.7"/>
<text text-anchor="middle" x="6191" y="-1512.68" font-family="Times,serif" font-size="14.00">tokens routed to expert 11</text>
</g>
<!-- layer_14_expert_12 -->
<g id="node325" class="node">
<title>layer_14_expert_12</title>
<polygon fill="lightblue" stroke="black" points="6655,-1490.88 6395,-1490.88 6395,-1407.88 6655,-1407.88 6655,-1490.88"/>
<text text-anchor="middle" x="6525" y="-1475.68" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="6525" y="-1460.68" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6525" y="-1445.68" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6525" y="-1430.68" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6525" y="-1415.68" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_14_all2all&#45;&gt;layer_14_expert_12 -->
<g id="edge548" class="edge">
<title>layer_14_all2all&#45;&gt;layer_14_expert_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5552.31,-1596.92C5726.58,-1591.47 6033.41,-1574.8 6291,-1523.88 6328.2,-1516.53 6367.83,-1505.4 6403.7,-1494.01"/>
<polygon fill="black" stroke="black" points="6404.77,-1497.34 6413.22,-1490.95 6402.63,-1490.67 6404.77,-1497.34"/>
<text text-anchor="middle" x="6445" y="-1512.68" font-family="Times,serif" font-size="14.00">tokens routed to expert 12</text>
</g>
<!-- layer_14_expert_13 -->
<g id="node326" class="node">
<title>layer_14_expert_13</title>
<polygon fill="lightblue" stroke="black" points="6933,-1490.88 6673,-1490.88 6673,-1407.88 6933,-1407.88 6933,-1490.88"/>
<text text-anchor="middle" x="6803" y="-1475.68" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="6803" y="-1460.68" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6803" y="-1445.68" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6803" y="-1430.68" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6803" y="-1415.68" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_14_all2all&#45;&gt;layer_14_expert_13 -->
<g id="edge549" class="edge">
<title>layer_14_all2all&#45;&gt;layer_14_expert_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5552.61,-1599.34C5767.38,-1596.95 6191.12,-1584.13 6545,-1523.88 6586.67,-1516.78 6631.23,-1505.48 6671.38,-1493.84"/>
<polygon fill="black" stroke="black" points="6672.61,-1497.13 6681.22,-1490.96 6670.64,-1490.42 6672.61,-1497.13"/>
<text text-anchor="middle" x="6705" y="-1512.68" font-family="Times,serif" font-size="14.00">tokens routed to expert 13</text>
</g>
<!-- layer_14_expert_14 -->
<g id="node327" class="node">
<title>layer_14_expert_14</title>
<polygon fill="lightblue" stroke="black" points="7211,-1490.88 6951,-1490.88 6951,-1407.88 7211,-1407.88 7211,-1490.88"/>
<text text-anchor="middle" x="7081" y="-1475.68" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="7081" y="-1460.68" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="7081" y="-1445.68" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="7081" y="-1430.68" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="7081" y="-1415.68" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_14_all2all&#45;&gt;layer_14_expert_14 -->
<g id="edge550" class="edge">
<title>layer_14_all2all&#45;&gt;layer_14_expert_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5552.63,-1600.35C5804.34,-1599.9 6350.3,-1590.44 6805,-1523.88 6850.73,-1517.19 6899.74,-1505.62 6943.59,-1493.63"/>
<polygon fill="black" stroke="black" points="6944.74,-1496.94 6953.45,-1490.9 6942.87,-1490.19 6944.74,-1496.94"/>
<text text-anchor="middle" x="6977" y="-1512.68" font-family="Times,serif" font-size="14.00">tokens routed to expert 14</text>
</g>
<!-- layer_14_expert_15 -->
<g id="node328" class="node">
<title>layer_14_expert_15</title>
<polygon fill="lightblue" stroke="black" points="7489,-1490.88 7229,-1490.88 7229,-1407.88 7489,-1407.88 7489,-1490.88"/>
<text text-anchor="middle" x="7359" y="-1475.68" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="7359" y="-1460.68" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="7359" y="-1445.68" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="7359" y="-1430.68" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="7359" y="-1415.68" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_14_all2all&#45;&gt;layer_14_expert_15 -->
<g id="edge551" class="edge">
<title>layer_14_all2all&#45;&gt;layer_14_expert_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5552.05,-1596.49C5896.75,-1588.34 6783.95,-1564.02 7077,-1523.88 7124.17,-1517.42 7174.76,-1505.78 7219.89,-1493.64"/>
<polygon fill="black" stroke="black" points="7221,-1496.96 7229.73,-1490.96 7219.16,-1490.21 7221,-1496.96"/>
<text text-anchor="middle" x="7251" y="-1512.68" font-family="Times,serif" font-size="14.00">tokens routed to expert 15</text>
</g>
<!-- layer_14_all2all_result -->
<g id="node329" class="node">
<title>layer_14_all2all_result</title>
<ellipse fill="yellow" stroke="black" cx="5413" cy="-1312.19" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="5413" y="-1338.49" font-family="Times,serif" font-size="14.00">Layer 14</text>
<text text-anchor="middle" x="5413" y="-1323.49" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Result Merge</text>
<text text-anchor="middle" x="5413" y="-1308.49" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="5413" y="-1293.49" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="5413" y="-1278.49" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_14_expert_0&#45;&gt;layer_14_all2all_result -->
<g id="edge552" class="edge">
<title>layer_14_expert_0&#45;&gt;layer_14_all2all_result</title>
<path fill="none" stroke="black" d="M3319,-1409.48C3322.02,-1408.91 3325.02,-1408.37 3328,-1407.88 3700.89,-1346 4850.76,-1322.09 5263.55,-1315.36"/>
<polygon fill="black" stroke="black" points="5263.81,-1318.86 5273.76,-1315.19 5263.7,-1311.86 5263.81,-1318.86"/>
</g>
<!-- layer_14_expert_1&#45;&gt;layer_14_all2all_result -->
<g id="edge553" class="edge">
<title>layer_14_expert_1&#45;&gt;layer_14_all2all_result</title>
<path fill="none" stroke="black" d="M3597.01,-1409.51C3600.03,-1408.93 3603.03,-1408.38 3606,-1407.88 3923.38,-1354.07 4890.71,-1325.73 5263.92,-1316.57"/>
<polygon fill="black" stroke="black" points="5264.07,-1320.06 5273.98,-1316.32 5263.9,-1313.07 5264.07,-1320.06"/>
</g>
<!-- layer_14_expert_2&#45;&gt;layer_14_all2all_result -->
<g id="edge554" class="edge">
<title>layer_14_expert_2&#45;&gt;layer_14_all2all_result</title>
<path fill="none" stroke="black" d="M3875.01,-1409.55C3878.03,-1408.96 3881.03,-1408.4 3884,-1407.88 4146.24,-1362.14 4933.24,-1330.04 5264,-1318.21"/>
<polygon fill="black" stroke="black" points="5264.26,-1321.7 5274.13,-1317.85 5264.01,-1314.71 5264.26,-1321.7"/>
</g>
<!-- layer_14_expert_3&#45;&gt;layer_14_all2all_result -->
<g id="edge555" class="edge">
<title>layer_14_expert_3&#45;&gt;layer_14_all2all_result</title>
<path fill="none" stroke="black" d="M4153.02,-1409.61C4156.04,-1409 4159.03,-1408.42 4162,-1407.88 4555.23,-1336.51 5027.45,-1318.81 5263.41,-1314.5"/>
<polygon fill="black" stroke="black" points="5263.49,-1318 5273.43,-1314.32 5263.37,-1311 5263.49,-1318"/>
</g>
<!-- layer_14_expert_4&#45;&gt;layer_14_all2all_result -->
<g id="edge556" class="edge">
<title>layer_14_expert_4&#45;&gt;layer_14_all2all_result</title>
<path fill="none" stroke="black" d="M4431.04,-1409.69C4434.05,-1409.06 4437.04,-1408.45 4440,-1407.88 4728.78,-1352.26 5072.4,-1328.55 5264.32,-1319.04"/>
<polygon fill="black" stroke="black" points="5264.66,-1322.53 5274.47,-1318.54 5264.32,-1315.54 5264.66,-1322.53"/>
</g>
<!-- layer_14_expert_5&#45;&gt;layer_14_all2all_result -->
<g id="edge557" class="edge">
<title>layer_14_expert_5&#45;&gt;layer_14_all2all_result</title>
<path fill="none" stroke="black" d="M4709.07,-1409.85C4712.07,-1409.16 4715.05,-1408.51 4718,-1407.88 4905.71,-1367.97 5125.69,-1341.32 5267.08,-1326.72"/>
<polygon fill="black" stroke="black" points="5267.53,-1330.19 5277.12,-1325.69 5266.81,-1323.23 5267.53,-1330.19"/>
</g>
<!-- layer_14_expert_6&#45;&gt;layer_14_all2all_result -->
<g id="edge558" class="edge">
<title>layer_14_expert_6&#45;&gt;layer_14_all2all_result</title>
<path fill="none" stroke="black" d="M4987.15,-1410.2C4990.13,-1409.41 4993.08,-1408.64 4996,-1407.88 5090.1,-1383.51 5197.02,-1359.3 5279.03,-1341.46"/>
<polygon fill="black" stroke="black" points="5279.88,-1344.86 5288.91,-1339.32 5278.39,-1338.02 5279.88,-1344.86"/>
</g>
<!-- layer_14_expert_7&#45;&gt;layer_14_all2all_result -->
<g id="edge559" class="edge">
<title>layer_14_expert_7&#45;&gt;layer_14_all2all_result</title>
<path fill="none" stroke="black" d="M5218.41,-1407.82C5248.4,-1393.24 5282.51,-1376.64 5313.72,-1361.47"/>
<polygon fill="black" stroke="black" points="5315.41,-1364.54 5322.87,-1357.02 5312.34,-1358.25 5315.41,-1364.54"/>
</g>
<!-- layer_14_expert_8&#45;&gt;layer_14_all2all_result -->
<g id="edge560" class="edge">
<title>layer_14_expert_8&#45;&gt;layer_14_all2all_result</title>
<path fill="none" stroke="black" d="M5413,-1407.82C5413,-1399.45 5413,-1390.43 5413,-1381.39"/>
<polygon fill="black" stroke="black" points="5416.5,-1381.21 5413,-1371.21 5409.5,-1381.21 5416.5,-1381.21"/>
</g>
<!-- layer_14_expert_9&#45;&gt;layer_14_all2all_result -->
<g id="edge561" class="edge">
<title>layer_14_expert_9&#45;&gt;layer_14_all2all_result</title>
<path fill="none" stroke="black" d="M5607.59,-1407.82C5577.6,-1393.24 5543.49,-1376.64 5512.28,-1361.47"/>
<polygon fill="black" stroke="black" points="5513.66,-1358.25 5503.13,-1357.02 5510.59,-1364.54 5513.66,-1358.25"/>
</g>
<!-- layer_14_expert_10&#45;&gt;layer_14_all2all_result -->
<g id="edge562" class="edge">
<title>layer_14_expert_10&#45;&gt;layer_14_all2all_result</title>
<path fill="none" stroke="black" d="M5838.85,-1410.2C5835.87,-1409.41 5832.92,-1408.64 5830,-1407.88 5735.9,-1383.51 5628.98,-1359.3 5546.97,-1341.46"/>
<polygon fill="black" stroke="black" points="5547.61,-1338.02 5537.09,-1339.32 5546.12,-1344.86 5547.61,-1338.02"/>
</g>
<!-- layer_14_expert_11&#45;&gt;layer_14_all2all_result -->
<g id="edge563" class="edge">
<title>layer_14_expert_11&#45;&gt;layer_14_all2all_result</title>
<path fill="none" stroke="black" d="M6116.93,-1409.85C6113.93,-1409.16 6110.95,-1408.51 6108,-1407.88 5920.29,-1367.97 5700.31,-1341.32 5558.92,-1326.72"/>
<polygon fill="black" stroke="black" points="5559.19,-1323.23 5548.88,-1325.69 5558.47,-1330.19 5559.19,-1323.23"/>
</g>
<!-- layer_14_expert_12&#45;&gt;layer_14_all2all_result -->
<g id="edge564" class="edge">
<title>layer_14_expert_12&#45;&gt;layer_14_all2all_result</title>
<path fill="none" stroke="black" d="M6394.96,-1409.69C6391.95,-1409.06 6388.96,-1408.45 6386,-1407.88 6097.22,-1352.26 5753.6,-1328.55 5561.68,-1319.04"/>
<polygon fill="black" stroke="black" points="5561.68,-1315.54 5551.53,-1318.54 5561.34,-1322.53 5561.68,-1315.54"/>
</g>
<!-- layer_14_expert_13&#45;&gt;layer_14_all2all_result -->
<g id="edge565" class="edge">
<title>layer_14_expert_13&#45;&gt;layer_14_all2all_result</title>
<path fill="none" stroke="black" d="M6672.98,-1409.61C6669.96,-1409 6666.97,-1408.42 6664,-1407.88 6270.77,-1336.51 5798.55,-1318.81 5562.59,-1314.5"/>
<polygon fill="black" stroke="black" points="5562.63,-1311 5552.57,-1314.32 5562.51,-1318 5562.63,-1311"/>
</g>
<!-- layer_14_expert_14&#45;&gt;layer_14_all2all_result -->
<g id="edge566" class="edge">
<title>layer_14_expert_14&#45;&gt;layer_14_all2all_result</title>
<path fill="none" stroke="black" d="M6950.99,-1409.55C6947.97,-1408.96 6944.97,-1408.4 6942,-1407.88 6679.76,-1362.14 5892.76,-1330.04 5562,-1318.21"/>
<polygon fill="black" stroke="black" points="5561.99,-1314.71 5551.87,-1317.85 5561.74,-1321.7 5561.99,-1314.71"/>
</g>
<!-- layer_14_expert_15&#45;&gt;layer_14_all2all_result -->
<g id="edge567" class="edge">
<title>layer_14_expert_15&#45;&gt;layer_14_all2all_result</title>
<path fill="none" stroke="black" d="M7228.99,-1409.51C7225.97,-1408.93 7222.97,-1408.38 7220,-1407.88 6902.62,-1354.07 5935.29,-1325.73 5562.08,-1316.57"/>
<polygon fill="black" stroke="black" points="5562.1,-1313.07 5552.02,-1316.32 5561.93,-1320.06 5562.1,-1313.07"/>
</g>
<!-- layer_14_expert_agg -->
<g id="node330" class="node">
<title>layer_14_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="7007,-1216.5 6759,-1216.5 6759,-1133.5 7007,-1133.5 7007,-1216.5"/>
<text text-anchor="middle" x="6883" y="-1201.3" font-family="Times,serif" font-size="14.00">Layer 14</text>
<text text-anchor="middle" x="6883" y="-1186.3" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="6883" y="-1171.3" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6883" y="-1156.3" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="6883" y="-1141.3" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_14_all2all_result&#45;&gt;layer_14_expert_agg -->
<g id="edge568" class="edge">
<title>layer_14_all2all_result&#45;&gt;layer_14_expert_agg</title>
<path fill="none" stroke="black" d="M5548.66,-1298.71C5829.06,-1272.93 6469.53,-1214.02 6748.73,-1188.35"/>
<polygon fill="black" stroke="black" points="6749.28,-1191.81 6758.92,-1187.41 6748.64,-1184.84 6749.28,-1191.81"/>
</g>
<!-- layer_14_expert_agg&#45;&gt;layer_14_residual -->
<g id="edge570" class="edge">
<title>layer_14_expert_agg&#45;&gt;layer_14_residual</title>
<path fill="none" stroke="black" d="M7007.21,-1148.1C7085.7,-1131.74 7188.29,-1110.35 7274.85,-1092.31"/>
<polygon fill="black" stroke="black" points="7275.7,-1095.7 7284.78,-1090.24 7274.28,-1088.85 7275.7,-1095.7"/>
</g>
<!-- layer_15_mha -->
<g id="node332" class="node">
<title>layer_15_mha</title>
<polygon fill="lightblue" stroke="black" points="7550.5,-976.5 7347.5,-976.5 7347.5,-893.5 7550.5,-893.5 7550.5,-976.5"/>
<text text-anchor="middle" x="7449" y="-961.3" font-family="Times,serif" font-size="14.00">Layer 15</text>
<text text-anchor="middle" x="7449" y="-946.3" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="7449" y="-931.3" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="7449" y="-916.3" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="7449" y="-901.3" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_14_residual&#45;&gt;layer_15_mha -->
<g id="edge571" class="edge">
<title>layer_14_residual&#45;&gt;layer_15_mha</title>
<path fill="none" stroke="black" d="M7449,-1013.39C7449,-1004.86 7449,-995.76 7449,-986.91"/>
<polygon fill="black" stroke="black" points="7452.5,-986.68 7449,-976.68 7445.5,-986.68 7452.5,-986.68"/>
</g>
<!-- layer_15_gate -->
<g id="node333" class="node">
<title>layer_15_gate</title>
<polygon fill="lightblue" stroke="black" points="7236.5,-856.5 7037.5,-856.5 7037.5,-773.5 7236.5,-773.5 7236.5,-856.5"/>
<text text-anchor="middle" x="7137" y="-841.3" font-family="Times,serif" font-size="14.00">Layer 15</text>
<text text-anchor="middle" x="7137" y="-826.3" font-family="Times,serif" font-size="14.00">Expert Gate</text>
<text text-anchor="middle" x="7137" y="-811.3" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096]</text>
<text text-anchor="middle" x="7137" y="-796.3" font-family="Times,serif" font-size="14.00">Output: routing decisions</text>
<text text-anchor="middle" x="7137" y="-781.3" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_15_mha&#45;&gt;layer_15_gate -->
<g id="edge572" class="edge">
<title>layer_15_mha&#45;&gt;layer_15_gate</title>
<path fill="none" stroke="black" d="M7347.27,-895.53C7314.98,-883.31 7279.15,-869.76 7246.35,-857.36"/>
<polygon fill="black" stroke="black" points="7247.32,-853.98 7236.73,-853.72 7244.84,-860.53 7247.32,-853.98"/>
</g>
<!-- layer_15_residual -->
<g id="node353" class="node">
<title>layer_15_residual</title>
<polygon fill="lightblue" stroke="black" points="7849,-173.74 7521,-173.74 7521,-90.74 7849,-90.74 7849,-173.74"/>
<text text-anchor="middle" x="7685" y="-158.54" font-family="Times,serif" font-size="14.00">Layer 15</text>
<text text-anchor="middle" x="7685" y="-143.54" font-family="Times,serif" font-size="14.00">Residual Add</text>
<text text-anchor="middle" x="7685" y="-128.54" font-family="Times,serif" font-size="14.00">Input: [128,10000,4096], [128,10000,4096]</text>
<text text-anchor="middle" x="7685" y="-113.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="7685" y="-98.54" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_15_mha&#45;&gt;layer_15_residual -->
<g id="edge607" class="edge">
<title>layer_15_mha&#45;&gt;layer_15_residual</title>
<path fill="none" stroke="black" d="M7550.73,-915.57C7641.78,-896.08 7761,-861.82 7761,-816 7761,-816 7761,-816 7761,-251.24 7761,-225.86 7748.42,-201.6 7733.5,-181.75"/>
<polygon fill="black" stroke="black" points="7736.17,-179.48 7727.22,-173.81 7730.67,-183.82 7736.17,-179.48"/>
<text text-anchor="middle" x="7789" y="-522.92" font-family="Times,serif" font-size="14.00">identity</text>
</g>
<!-- layer_15_all2all -->
<g id="node334" class="node">
<title>layer_15_all2all</title>
<ellipse fill="yellow" stroke="black" cx="5649" cy="-677.81" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="5649" y="-704.11" font-family="Times,serif" font-size="14.00">Layer 15</text>
<text text-anchor="middle" x="5649" y="-689.11" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Communication</text>
<text text-anchor="middle" x="5649" y="-674.11" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="5649" y="-659.11" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="5649" y="-644.11" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_15_gate&#45;&gt;layer_15_all2all -->
<g id="edge573" class="edge">
<title>layer_15_gate&#45;&gt;layer_15_all2all</title>
<path fill="none" stroke="black" d="M7037.35,-804.95C6780.76,-781.63 6096.46,-719.46 5795.03,-692.08"/>
<polygon fill="black" stroke="black" points="5795.18,-688.58 5784.91,-691.16 5794.55,-695.55 5795.18,-688.58"/>
</g>
<!-- layer_15_expert_0 -->
<g id="node335" class="node">
<title>layer_15_expert_0</title>
<polygon fill="lightblue" stroke="black" points="3555,-568.12 3295,-568.12 3295,-485.12 3555,-485.12 3555,-568.12"/>
<text text-anchor="middle" x="3425" y="-552.92" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="3425" y="-537.92" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3425" y="-522.92" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3425" y="-507.92" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3425" y="-492.92" font-family="Times,serif" font-size="14.00">GPU: 0</text>
</g>
<!-- layer_15_all2all&#45;&gt;layer_15_expert_0 -->
<g id="edge574" class="edge">
<title>layer_15_all2all&#45;&gt;layer_15_expert_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5509.71,-674.01C5129.55,-665.95 4079.72,-640.67 3736,-601.12 3661.84,-592.59 3641.33,-586.85 3565.2,-568.38"/>
<polygon fill="black" stroke="black" points="3565.66,-564.89 3555.12,-565.93 3564.02,-571.69 3565.66,-564.89"/>
<text text-anchor="middle" x="3827.5" y="-589.92" font-family="Times,serif" font-size="14.00">tokens routed to expert 0</text>
</g>
<!-- layer_15_expert_1 -->
<g id="node336" class="node">
<title>layer_15_expert_1</title>
<polygon fill="lightblue" stroke="black" points="3833,-568.12 3573,-568.12 3573,-485.12 3833,-485.12 3833,-568.12"/>
<text text-anchor="middle" x="3703" y="-552.92" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3703" y="-537.92" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3703" y="-522.92" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3703" y="-507.92" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3703" y="-492.92" font-family="Times,serif" font-size="14.00">GPU: 1</text>
</g>
<!-- layer_15_all2all&#45;&gt;layer_15_expert_1 -->
<g id="edge575" class="edge">
<title>layer_15_all2all&#45;&gt;layer_15_expert_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5509.56,-677.42C5225.78,-677.1 4561.12,-668.47 4008,-601.12 3953.4,-594.47 3894.41,-581.63 3842.99,-568.52"/>
<polygon fill="black" stroke="black" points="3843.71,-565.09 3833.15,-565.98 3841.96,-571.86 3843.71,-565.09"/>
<text text-anchor="middle" x="4099.5" y="-589.92" font-family="Times,serif" font-size="14.00">tokens routed to expert 1</text>
</g>
<!-- layer_15_expert_2 -->
<g id="node337" class="node">
<title>layer_15_expert_2</title>
<polygon fill="lightblue" stroke="black" points="4111,-568.12 3851,-568.12 3851,-485.12 4111,-485.12 4111,-568.12"/>
<text text-anchor="middle" x="3981" y="-552.92" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3981" y="-537.92" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="3981" y="-522.92" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3981" y="-507.92" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="3981" y="-492.92" font-family="Times,serif" font-size="14.00">GPU: 2</text>
</g>
<!-- layer_15_all2all&#45;&gt;layer_15_expert_2 -->
<g id="edge576" class="edge">
<title>layer_15_all2all&#45;&gt;layer_15_expert_2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5509.7,-676.04C5261.22,-673.12 4725.6,-659.88 4278,-601.12 4226.03,-594.3 4170,-581.82 4120.76,-569.05"/>
<polygon fill="black" stroke="black" points="4121.57,-565.64 4111.01,-566.49 4119.8,-572.41 4121.57,-565.64"/>
<text text-anchor="middle" x="4369.5" y="-589.92" font-family="Times,serif" font-size="14.00">tokens routed to expert 2</text>
</g>
<!-- layer_15_expert_3 -->
<g id="node338" class="node">
<title>layer_15_expert_3</title>
<polygon fill="lightblue" stroke="black" points="4389,-568.12 4129,-568.12 4129,-485.12 4389,-485.12 4389,-568.12"/>
<text text-anchor="middle" x="4259" y="-552.92" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="4259" y="-537.92" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4259" y="-522.92" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4259" y="-507.92" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4259" y="-492.92" font-family="Times,serif" font-size="14.00">GPU: 3</text>
</g>
<!-- layer_15_all2all&#45;&gt;layer_15_expert_3 -->
<g id="edge577" class="edge">
<title>layer_15_all2all&#45;&gt;layer_15_expert_3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5509.67,-674.86C5297.95,-670.22 4883.01,-654.47 4535,-601.12 4489.77,-594.19 4441.29,-582.7 4397.78,-570.85"/>
<polygon fill="black" stroke="black" points="4398.57,-567.44 4388,-568.16 4396.71,-574.19 4398.57,-567.44"/>
<text text-anchor="middle" x="4626.5" y="-589.92" font-family="Times,serif" font-size="14.00">tokens routed to expert 3</text>
</g>
<!-- layer_15_expert_4 -->
<g id="node339" class="node">
<title>layer_15_expert_4</title>
<polygon fill="lightblue" stroke="black" points="4667,-568.12 4407,-568.12 4407,-485.12 4667,-485.12 4667,-568.12"/>
<text text-anchor="middle" x="4537" y="-552.92" font-family="Times,serif" font-size="14.00">Expert 4</text>
<text text-anchor="middle" x="4537" y="-537.92" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4537" y="-522.92" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4537" y="-507.92" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4537" y="-492.92" font-family="Times,serif" font-size="14.00">GPU: 4</text>
</g>
<!-- layer_15_all2all&#45;&gt;layer_15_expert_4 -->
<g id="edge578" class="edge">
<title>layer_15_all2all&#45;&gt;layer_15_expert_4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5509.78,-673.2C5338.04,-666.78 5037.77,-649.14 4785,-601.12 4745.65,-593.64 4703.62,-582.46 4665.55,-571.05"/>
<polygon fill="black" stroke="black" points="4666.54,-567.69 4655.96,-568.15 4664.51,-574.39 4666.54,-567.69"/>
<text text-anchor="middle" x="4876.5" y="-589.92" font-family="Times,serif" font-size="14.00">tokens routed to expert 4</text>
</g>
<!-- layer_15_expert_5 -->
<g id="node340" class="node">
<title>layer_15_expert_5</title>
<polygon fill="lightblue" stroke="black" points="4945,-568.12 4685,-568.12 4685,-485.12 4945,-485.12 4945,-568.12"/>
<text text-anchor="middle" x="4815" y="-552.92" font-family="Times,serif" font-size="14.00">Expert 5</text>
<text text-anchor="middle" x="4815" y="-537.92" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="4815" y="-522.92" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4815" y="-507.92" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="4815" y="-492.92" font-family="Times,serif" font-size="14.00">GPU: 5</text>
</g>
<!-- layer_15_all2all&#45;&gt;layer_15_expert_5 -->
<g id="edge579" class="edge">
<title>layer_15_all2all&#45;&gt;layer_15_expert_5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5511.18,-668.67C5383.75,-659.12 5189.74,-639.47 5025,-601.12 4992.44,-593.54 4957.89,-582.69 4926.43,-571.64"/>
<polygon fill="black" stroke="black" points="4927.36,-568.25 4916.76,-568.2 4925.02,-574.85 4927.36,-568.25"/>
<text text-anchor="middle" x="5116.5" y="-589.92" font-family="Times,serif" font-size="14.00">tokens routed to expert 5</text>
</g>
<!-- layer_15_expert_6 -->
<g id="node341" class="node">
<title>layer_15_expert_6</title>
<polygon fill="lightblue" stroke="black" points="5223,-568.12 4963,-568.12 4963,-485.12 5223,-485.12 5223,-568.12"/>
<text text-anchor="middle" x="5093" y="-552.92" font-family="Times,serif" font-size="14.00">Expert 6</text>
<text text-anchor="middle" x="5093" y="-537.92" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5093" y="-522.92" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5093" y="-507.92" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5093" y="-492.92" font-family="Times,serif" font-size="14.00">GPU: 6</text>
</g>
<!-- layer_15_all2all&#45;&gt;layer_15_expert_6 -->
<g id="edge580" class="edge">
<title>layer_15_all2all&#45;&gt;layer_15_expert_6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5516.36,-659.66C5438.49,-647.57 5338.83,-628.59 5253,-601.12 5228.84,-593.39 5203.53,-582.95 5180.36,-572.36"/>
<polygon fill="black" stroke="black" points="5181.79,-569.17 5171.25,-568.15 5178.85,-575.52 5181.79,-569.17"/>
<text text-anchor="middle" x="5344.5" y="-589.92" font-family="Times,serif" font-size="14.00">tokens routed to expert 6</text>
</g>
<!-- layer_15_expert_7 -->
<g id="node342" class="node">
<title>layer_15_expert_7</title>
<polygon fill="lightblue" stroke="black" points="5501,-568.12 5241,-568.12 5241,-485.12 5501,-485.12 5501,-568.12"/>
<text text-anchor="middle" x="5371" y="-552.92" font-family="Times,serif" font-size="14.00">Expert 7</text>
<text text-anchor="middle" x="5371" y="-537.92" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5371" y="-522.92" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5371" y="-507.92" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5371" y="-492.92" font-family="Times,serif" font-size="14.00">GPU: 7</text>
</g>
<!-- layer_15_all2all&#45;&gt;layer_15_expert_7 -->
<g id="edge581" class="edge">
<title>layer_15_all2all&#45;&gt;layer_15_expert_7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5542.06,-639.83C5515.17,-628.85 5486.9,-615.78 5462,-601.12 5448.94,-593.43 5435.75,-583.97 5423.63,-574.44"/>
<polygon fill="black" stroke="black" points="5425.82,-571.71 5415.83,-568.18 5421.44,-577.17 5425.82,-571.71"/>
<text text-anchor="middle" x="5553.5" y="-589.92" font-family="Times,serif" font-size="14.00">tokens routed to expert 7</text>
</g>
<!-- layer_15_expert_8 -->
<g id="node343" class="node">
<title>layer_15_expert_8</title>
<polygon fill="lightblue" stroke="black" points="5779,-568.12 5519,-568.12 5519,-485.12 5779,-485.12 5779,-568.12"/>
<text text-anchor="middle" x="5649" y="-552.92" font-family="Times,serif" font-size="14.00">Expert 8</text>
<text text-anchor="middle" x="5649" y="-537.92" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5649" y="-522.92" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5649" y="-507.92" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5649" y="-492.92" font-family="Times,serif" font-size="14.00">GPU: 8</text>
</g>
<!-- layer_15_all2all&#45;&gt;layer_15_expert_8 -->
<g id="edge582" class="edge">
<title>layer_15_all2all&#45;&gt;layer_15_expert_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5649,-618.7C5649,-605.4 5649,-591.37 5649,-578.4"/>
<polygon fill="black" stroke="black" points="5652.5,-578.27 5649,-568.27 5645.5,-578.27 5652.5,-578.27"/>
<text text-anchor="middle" x="5740.5" y="-589.92" font-family="Times,serif" font-size="14.00">tokens routed to expert 8</text>
</g>
<!-- layer_15_expert_9 -->
<g id="node344" class="node">
<title>layer_15_expert_9</title>
<polygon fill="lightblue" stroke="black" points="6057,-568.12 5797,-568.12 5797,-485.12 6057,-485.12 6057,-568.12"/>
<text text-anchor="middle" x="5927" y="-552.92" font-family="Times,serif" font-size="14.00">Expert 9</text>
<text text-anchor="middle" x="5927" y="-537.92" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="5927" y="-522.92" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5927" y="-507.92" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="5927" y="-492.92" font-family="Times,serif" font-size="14.00">GPU: 9</text>
</g>
<!-- layer_15_all2all&#45;&gt;layer_15_expert_9 -->
<g id="edge583" class="edge">
<title>layer_15_all2all&#45;&gt;layer_15_expert_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5755.94,-639.83C5782.83,-628.85 5811.1,-615.78 5836,-601.12 5849.06,-593.43 5862.25,-583.97 5874.37,-574.44"/>
<polygon fill="black" stroke="black" points="5876.56,-577.17 5882.17,-568.18 5872.18,-571.71 5876.56,-577.17"/>
<text text-anchor="middle" x="5948.5" y="-589.92" font-family="Times,serif" font-size="14.00">tokens routed to expert 9</text>
</g>
<!-- layer_15_expert_10 -->
<g id="node345" class="node">
<title>layer_15_expert_10</title>
<polygon fill="lightblue" stroke="black" points="6335,-568.12 6075,-568.12 6075,-485.12 6335,-485.12 6335,-568.12"/>
<text text-anchor="middle" x="6205" y="-552.92" font-family="Times,serif" font-size="14.00">Expert 10</text>
<text text-anchor="middle" x="6205" y="-537.92" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6205" y="-522.92" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6205" y="-507.92" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6205" y="-492.92" font-family="Times,serif" font-size="14.00">GPU: 10</text>
</g>
<!-- layer_15_all2all&#45;&gt;layer_15_expert_10 -->
<g id="edge584" class="edge">
<title>layer_15_all2all&#45;&gt;layer_15_expert_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5781.73,-659.48C5859.33,-647.35 5958.52,-628.39 6044,-601.12 6068.29,-593.37 6093.75,-582.92 6117.07,-572.34"/>
<polygon fill="black" stroke="black" points="6118.61,-575.48 6126.24,-568.12 6115.69,-569.12 6118.61,-575.48"/>
<text text-anchor="middle" x="6180" y="-589.92" font-family="Times,serif" font-size="14.00">tokens routed to expert 10</text>
</g>
<!-- layer_15_expert_11 -->
<g id="node346" class="node">
<title>layer_15_expert_11</title>
<polygon fill="lightblue" stroke="black" points="6613,-568.12 6353,-568.12 6353,-485.12 6613,-485.12 6613,-568.12"/>
<text text-anchor="middle" x="6483" y="-552.92" font-family="Times,serif" font-size="14.00">Expert 11</text>
<text text-anchor="middle" x="6483" y="-537.92" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6483" y="-522.92" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6483" y="-507.92" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6483" y="-492.92" font-family="Times,serif" font-size="14.00">GPU: 11</text>
</g>
<!-- layer_15_all2all&#45;&gt;layer_15_expert_11 -->
<g id="edge585" class="edge">
<title>layer_15_all2all&#45;&gt;layer_15_expert_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5786.9,-669.34C5915.81,-660.23 6112.95,-640.83 6280,-601.12 6311.51,-593.63 6344.87,-582.82 6375.25,-571.79"/>
<polygon fill="black" stroke="black" points="6376.82,-574.94 6385,-568.21 6374.4,-568.37 6376.82,-574.94"/>
<text text-anchor="middle" x="6427" y="-589.92" font-family="Times,serif" font-size="14.00">tokens routed to expert 11</text>
</g>
<!-- layer_15_expert_12 -->
<g id="node347" class="node">
<title>layer_15_expert_12</title>
<polygon fill="lightblue" stroke="black" points="6891,-568.12 6631,-568.12 6631,-485.12 6891,-485.12 6891,-568.12"/>
<text text-anchor="middle" x="6761" y="-552.92" font-family="Times,serif" font-size="14.00">Expert 12</text>
<text text-anchor="middle" x="6761" y="-537.92" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="6761" y="-522.92" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6761" y="-507.92" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="6761" y="-492.92" font-family="Times,serif" font-size="14.00">GPU: 12</text>
</g>
<!-- layer_15_all2all&#45;&gt;layer_15_expert_12 -->
<g id="edge586" class="edge">
<title>layer_15_all2all&#45;&gt;layer_15_expert_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5788.31,-674.16C5962.58,-668.71 6269.41,-652.04 6527,-601.12 6564.2,-593.77 6603.83,-582.64 6639.7,-571.25"/>
<polygon fill="black" stroke="black" points="6640.77,-574.58 6649.22,-568.19 6638.63,-567.91 6640.77,-574.58"/>
<text text-anchor="middle" x="6681" y="-589.92" font-family="Times,serif" font-size="14.00">tokens routed to expert 12</text>
</g>
<!-- layer_15_expert_13 -->
<g id="node348" class="node">
<title>layer_15_expert_13</title>
<polygon fill="lightblue" stroke="black" points="7169,-568.12 6909,-568.12 6909,-485.12 7169,-485.12 7169,-568.12"/>
<text text-anchor="middle" x="7039" y="-552.92" font-family="Times,serif" font-size="14.00">Expert 13</text>
<text text-anchor="middle" x="7039" y="-537.92" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="7039" y="-522.92" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="7039" y="-507.92" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="7039" y="-492.92" font-family="Times,serif" font-size="14.00">GPU: 13</text>
</g>
<!-- layer_15_all2all&#45;&gt;layer_15_expert_13 -->
<g id="edge587" class="edge">
<title>layer_15_all2all&#45;&gt;layer_15_expert_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5788.61,-676.58C6003.38,-674.2 6427.12,-661.37 6781,-601.12 6822.67,-594.02 6867.23,-582.72 6907.38,-571.09"/>
<polygon fill="black" stroke="black" points="6908.61,-574.37 6917.22,-568.2 6906.64,-567.66 6908.61,-574.37"/>
<text text-anchor="middle" x="6941" y="-589.92" font-family="Times,serif" font-size="14.00">tokens routed to expert 13</text>
</g>
<!-- layer_15_expert_14 -->
<g id="node349" class="node">
<title>layer_15_expert_14</title>
<polygon fill="lightblue" stroke="black" points="7447,-568.12 7187,-568.12 7187,-485.12 7447,-485.12 7447,-568.12"/>
<text text-anchor="middle" x="7317" y="-552.92" font-family="Times,serif" font-size="14.00">Expert 14</text>
<text text-anchor="middle" x="7317" y="-537.92" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="7317" y="-522.92" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="7317" y="-507.92" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="7317" y="-492.92" font-family="Times,serif" font-size="14.00">GPU: 14</text>
</g>
<!-- layer_15_all2all&#45;&gt;layer_15_expert_14 -->
<g id="edge588" class="edge">
<title>layer_15_all2all&#45;&gt;layer_15_expert_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5788.63,-677.59C6040.34,-677.14 6586.3,-667.68 7041,-601.12 7086.73,-594.43 7135.74,-582.86 7179.59,-570.87"/>
<polygon fill="black" stroke="black" points="7180.74,-574.18 7189.45,-568.14 7178.87,-567.43 7180.74,-574.18"/>
<text text-anchor="middle" x="7213" y="-589.92" font-family="Times,serif" font-size="14.00">tokens routed to expert 14</text>
</g>
<!-- layer_15_expert_15 -->
<g id="node350" class="node">
<title>layer_15_expert_15</title>
<polygon fill="lightblue" stroke="black" points="7725,-568.12 7465,-568.12 7465,-485.12 7725,-485.12 7725,-568.12"/>
<text text-anchor="middle" x="7595" y="-552.92" font-family="Times,serif" font-size="14.00">Expert 15</text>
<text text-anchor="middle" x="7595" y="-537.92" font-family="Times,serif" font-size="14.00">MLP</text>
<text text-anchor="middle" x="7595" y="-522.92" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="7595" y="-507.92" font-family="Times,serif" font-size="14.00">Output: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="7595" y="-492.92" font-family="Times,serif" font-size="14.00">GPU: 15</text>
</g>
<!-- layer_15_all2all&#45;&gt;layer_15_expert_15 -->
<g id="edge589" class="edge">
<title>layer_15_all2all&#45;&gt;layer_15_expert_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M5788.05,-673.73C6132.75,-665.58 7019.95,-641.26 7313,-601.12 7360.17,-594.66 7410.76,-583.02 7455.89,-570.88"/>
<polygon fill="black" stroke="black" points="7457,-574.2 7465.73,-568.2 7455.16,-567.45 7457,-574.2"/>
<text text-anchor="middle" x="7487" y="-589.92" font-family="Times,serif" font-size="14.00">tokens routed to expert 15</text>
</g>
<!-- layer_15_all2all_result -->
<g id="node351" class="node">
<title>layer_15_all2all_result</title>
<ellipse fill="yellow" stroke="black" cx="5649" cy="-389.43" rx="139.1" ry="58.88"/>
<text text-anchor="middle" x="5649" y="-415.73" font-family="Times,serif" font-size="14.00">Layer 15</text>
<text text-anchor="middle" x="5649" y="-400.73" font-family="Times,serif" font-size="14.00">All&#45;to&#45;All Result Merge</text>
<text text-anchor="middle" x="5649" y="-385.73" font-family="Times,serif" font-size="14.00">GPU: all 16 GPUs</text>
<text text-anchor="middle" x="5649" y="-370.73" font-family="Times,serif" font-size="14.00">Shape: [128,10000,4096]</text>
<text text-anchor="middle" x="5649" y="-355.73" font-family="Times,serif" font-size="14.00">via NVLink/InfiniBand</text>
</g>
<!-- layer_15_expert_0&#45;&gt;layer_15_all2all_result -->
<g id="edge590" class="edge">
<title>layer_15_expert_0&#45;&gt;layer_15_all2all_result</title>
<path fill="none" stroke="black" d="M3555,-486.72C3558.02,-486.15 3561.02,-485.61 3564,-485.12 3936.89,-423.24 5086.76,-399.33 5499.55,-392.6"/>
<polygon fill="black" stroke="black" points="5499.81,-396.1 5509.76,-392.43 5499.7,-389.1 5499.81,-396.1"/>
</g>
<!-- layer_15_expert_1&#45;&gt;layer_15_all2all_result -->
<g id="edge591" class="edge">
<title>layer_15_expert_1&#45;&gt;layer_15_all2all_result</title>
<path fill="none" stroke="black" d="M3833.01,-486.75C3836.03,-486.17 3839.03,-485.62 3842,-485.12 4159.38,-431.31 5126.71,-402.97 5499.92,-393.81"/>
<polygon fill="black" stroke="black" points="5500.07,-397.3 5509.98,-393.56 5499.9,-390.31 5500.07,-397.3"/>
</g>
<!-- layer_15_expert_2&#45;&gt;layer_15_all2all_result -->
<g id="edge592" class="edge">
<title>layer_15_expert_2&#45;&gt;layer_15_all2all_result</title>
<path fill="none" stroke="black" d="M4111.01,-486.79C4114.03,-486.2 4117.03,-485.64 4120,-485.12 4382.24,-439.38 5169.24,-407.28 5500,-395.45"/>
<polygon fill="black" stroke="black" points="5500.26,-398.94 5510.13,-395.09 5500.01,-391.95 5500.26,-398.94"/>
</g>
<!-- layer_15_expert_3&#45;&gt;layer_15_all2all_result -->
<g id="edge593" class="edge">
<title>layer_15_expert_3&#45;&gt;layer_15_all2all_result</title>
<path fill="none" stroke="black" d="M4389.02,-486.85C4392.04,-486.24 4395.03,-485.66 4398,-485.12 4791.23,-413.75 5263.45,-396.05 5499.41,-391.74"/>
<polygon fill="black" stroke="black" points="5499.49,-395.24 5509.43,-391.56 5499.37,-388.24 5499.49,-395.24"/>
</g>
<!-- layer_15_expert_4&#45;&gt;layer_15_all2all_result -->
<g id="edge594" class="edge">
<title>layer_15_expert_4&#45;&gt;layer_15_all2all_result</title>
<path fill="none" stroke="black" d="M4667.04,-486.93C4670.05,-486.3 4673.04,-485.69 4676,-485.12 4964.78,-429.5 5308.4,-405.79 5500.32,-396.28"/>
<polygon fill="black" stroke="black" points="5500.66,-399.77 5510.47,-395.78 5500.32,-392.78 5500.66,-399.77"/>
</g>
<!-- layer_15_expert_5&#45;&gt;layer_15_all2all_result -->
<g id="edge595" class="edge">
<title>layer_15_expert_5&#45;&gt;layer_15_all2all_result</title>
<path fill="none" stroke="black" d="M4945.07,-487.09C4948.07,-486.4 4951.05,-485.75 4954,-485.12 5141.71,-445.22 5361.69,-418.56 5503.08,-403.96"/>
<polygon fill="black" stroke="black" points="5503.53,-407.43 5513.12,-402.93 5502.81,-400.47 5503.53,-407.43"/>
</g>
<!-- layer_15_expert_6&#45;&gt;layer_15_all2all_result -->
<g id="edge596" class="edge">
<title>layer_15_expert_6&#45;&gt;layer_15_all2all_result</title>
<path fill="none" stroke="black" d="M5223.15,-487.44C5226.13,-486.65 5229.08,-485.88 5232,-485.12 5326.1,-460.75 5433.02,-436.54 5515.03,-418.7"/>
<polygon fill="black" stroke="black" points="5515.88,-422.1 5524.91,-416.56 5514.39,-415.26 5515.88,-422.1"/>
</g>
<!-- layer_15_expert_7&#45;&gt;layer_15_all2all_result -->
<g id="edge597" class="edge">
<title>layer_15_expert_7&#45;&gt;layer_15_all2all_result</title>
<path fill="none" stroke="black" d="M5454.41,-485.06C5484.4,-470.48 5518.51,-453.88 5549.72,-438.71"/>
<polygon fill="black" stroke="black" points="5551.41,-441.78 5558.87,-434.26 5548.34,-435.49 5551.41,-441.78"/>
</g>
<!-- layer_15_expert_8&#45;&gt;layer_15_all2all_result -->
<g id="edge598" class="edge">
<title>layer_15_expert_8&#45;&gt;layer_15_all2all_result</title>
<path fill="none" stroke="black" d="M5649,-485.06C5649,-476.7 5649,-467.67 5649,-458.63"/>
<polygon fill="black" stroke="black" points="5652.5,-458.46 5649,-448.46 5645.5,-458.46 5652.5,-458.46"/>
</g>
<!-- layer_15_expert_9&#45;&gt;layer_15_all2all_result -->
<g id="edge599" class="edge">
<title>layer_15_expert_9&#45;&gt;layer_15_all2all_result</title>
<path fill="none" stroke="black" d="M5843.59,-485.06C5813.6,-470.48 5779.49,-453.88 5748.28,-438.71"/>
<polygon fill="black" stroke="black" points="5749.66,-435.49 5739.13,-434.26 5746.59,-441.78 5749.66,-435.49"/>
</g>
<!-- layer_15_expert_10&#45;&gt;layer_15_all2all_result -->
<g id="edge600" class="edge">
<title>layer_15_expert_10&#45;&gt;layer_15_all2all_result</title>
<path fill="none" stroke="black" d="M6074.85,-487.44C6071.87,-486.65 6068.92,-485.88 6066,-485.12 5971.9,-460.75 5864.98,-436.54 5782.97,-418.7"/>
<polygon fill="black" stroke="black" points="5783.61,-415.26 5773.09,-416.56 5782.12,-422.1 5783.61,-415.26"/>
</g>
<!-- layer_15_expert_11&#45;&gt;layer_15_all2all_result -->
<g id="edge601" class="edge">
<title>layer_15_expert_11&#45;&gt;layer_15_all2all_result</title>
<path fill="none" stroke="black" d="M6352.93,-487.09C6349.93,-486.4 6346.95,-485.75 6344,-485.12 6156.29,-445.22 5936.31,-418.56 5794.92,-403.96"/>
<polygon fill="black" stroke="black" points="5795.19,-400.47 5784.88,-402.93 5794.47,-407.43 5795.19,-400.47"/>
</g>
<!-- layer_15_expert_12&#45;&gt;layer_15_all2all_result -->
<g id="edge602" class="edge">
<title>layer_15_expert_12&#45;&gt;layer_15_all2all_result</title>
<path fill="none" stroke="black" d="M6630.96,-486.93C6627.95,-486.3 6624.96,-485.69 6622,-485.12 6333.22,-429.5 5989.6,-405.79 5797.68,-396.28"/>
<polygon fill="black" stroke="black" points="5797.68,-392.78 5787.53,-395.78 5797.34,-399.77 5797.68,-392.78"/>
</g>
<!-- layer_15_expert_13&#45;&gt;layer_15_all2all_result -->
<g id="edge603" class="edge">
<title>layer_15_expert_13&#45;&gt;layer_15_all2all_result</title>
<path fill="none" stroke="black" d="M6908.98,-486.85C6905.96,-486.24 6902.97,-485.66 6900,-485.12 6506.77,-413.75 6034.55,-396.05 5798.59,-391.74"/>
<polygon fill="black" stroke="black" points="5798.63,-388.24 5788.57,-391.56 5798.51,-395.24 5798.63,-388.24"/>
</g>
<!-- layer_15_expert_14&#45;&gt;layer_15_all2all_result -->
<g id="edge604" class="edge">
<title>layer_15_expert_14&#45;&gt;layer_15_all2all_result</title>
<path fill="none" stroke="black" d="M7186.99,-486.79C7183.97,-486.2 7180.97,-485.64 7178,-485.12 6915.76,-439.38 6128.76,-407.28 5798,-395.45"/>
<polygon fill="black" stroke="black" points="5797.99,-391.95 5787.87,-395.09 5797.74,-398.94 5797.99,-391.95"/>
</g>
<!-- layer_15_expert_15&#45;&gt;layer_15_all2all_result -->
<g id="edge605" class="edge">
<title>layer_15_expert_15&#45;&gt;layer_15_all2all_result</title>
<path fill="none" stroke="black" d="M7464.99,-486.75C7461.97,-486.17 7458.97,-485.62 7456,-485.12 7138.62,-431.31 6171.29,-402.97 5798.08,-393.81"/>
<polygon fill="black" stroke="black" points="5798.1,-390.31 5788.02,-393.56 5797.93,-397.3 5798.1,-390.31"/>
</g>
<!-- layer_15_expert_agg -->
<g id="node352" class="node">
<title>layer_15_expert_agg</title>
<polygon fill="lightblue" stroke="black" points="7243,-293.74 6995,-293.74 6995,-210.74 7243,-210.74 7243,-293.74"/>
<text text-anchor="middle" x="7119" y="-278.54" font-family="Times,serif" font-size="14.00">Layer 15</text>
<text text-anchor="middle" x="7119" y="-263.54" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="7119" y="-248.54" font-family="Times,serif" font-size="14.00">Input: [128,subset_tokens,4096]</text>
<text text-anchor="middle" x="7119" y="-233.54" font-family="Times,serif" font-size="14.00">Output: [128,10000,4096]</text>
<text text-anchor="middle" x="7119" y="-218.54" font-family="Times,serif" font-size="14.00">All 16 GPUs</text>
</g>
<!-- layer_15_all2all_result&#45;&gt;layer_15_expert_agg -->
<g id="edge606" class="edge">
<title>layer_15_all2all_result&#45;&gt;layer_15_expert_agg</title>
<path fill="none" stroke="black" d="M5784.66,-375.95C6065.06,-350.17 6705.53,-291.27 6984.73,-265.59"/>
<polygon fill="black" stroke="black" points="6985.28,-269.05 6994.92,-264.65 6984.64,-262.08 6985.28,-269.05"/>
</g>
<!-- layer_15_expert_agg&#45;&gt;layer_15_residual -->
<g id="edge608" class="edge">
<title>layer_15_expert_agg&#45;&gt;layer_15_residual</title>
<path fill="none" stroke="black" d="M7243.21,-225.34C7321.7,-208.98 7424.29,-187.59 7510.85,-169.55"/>
<polygon fill="black" stroke="black" points="7511.7,-172.94 7520.78,-167.48 7510.28,-166.09 7511.7,-172.94"/>
</g>
<!-- output -->
<g id="node354" class="node">
<title>output</title>
<ellipse fill="lightgreen" stroke="black" cx="7685" cy="-26.87" rx="268.9" ry="26.74"/>
<text text-anchor="middle" x="7685" y="-30.67" font-family="Times,serif" font-size="14.00">Model Output</text>
<text text-anchor="middle" x="7685" y="-15.67" font-family="Times,serif" font-size="14.00">batch_size=128, seq_len=10000, token_dim=4096</text>
</g>
<!-- layer_15_residual&#45;&gt;output -->
<g id="edge609" class="edge">
<title>layer_15_residual&#45;&gt;output</title>
<path fill="none" stroke="black" d="M7685,-90.68C7685,-81.92 7685,-72.7 7685,-64.11"/>
<polygon fill="black" stroke="black" points="7688.5,-64.02 7685,-54.02 7681.5,-64.02 7688.5,-64.02"/>
</g>
</g>
</svg>
