// LLM Deployment DAG - PP(4) x TP(2)
digraph {
	nodesep=0.5 rankdir=TB ranksep=1.0 size="20,30"
	node [fillcolor=lightblue shape=ellipse style=filled]
	node [fillcolor=lightgreen shape=rectangle style=filled]
	node [fillcolor=lightyellow shape=parallelogram style=filled]
	input [label="Input\n[batch_size=4, seq_len=2048, hidden=8192]" fillcolor=white shape=ellipse style=filled]
	subgraph cluster_stage0 {
		bgcolor=lightgray label="Stage 0: GPUs [0,1]\nLayers 0-19" style=rounded
		split_0 [label="Input Split\n[batch_size=4, seq_len=2048, hidden=4096]" fillcolor=lightyellow shape=parallelogram]
		layer0_embed_0 [label="Embedding\nGPU:0\nInput:[4,2048]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer0_embed_1 [label="Embedding\nGPU:1\nInput:[4,2048]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		embed_ag_0 [label="All-Gather\nEmbedding\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer1_qkv_0 [label="QKV Linear\nLayer 1\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer1_qkv_1 [label="QKV Linear\nLayer 1\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_1_0 [label="All-Reduce\nQKV\nLayer 1\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer1_attn_0 [label="Self-Attention\nLayer 1\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer1_attn_1 [label="Self-Attention\nLayer 1\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer1_attn_out_0 [label="Attention Output\nLayer 1\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer1_attn_out_1 [label="Attention Output\nLayer 1\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_1_0 [label="All-Reduce\nAttention\nLayer 1\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer1_ffn_gate_0 [label="FFN Gate\nLayer 1\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer1_ffn_gate_1 [label="FFN Gate\nLayer 1\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer1_ffn_up_0 [label="FFN Up\nLayer 1\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer1_ffn_up_1 [label="FFN Up\nLayer 1\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_1_0 [label="All-Reduce\nFFN\nLayer 1\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer1_ffn_down_0 [label="FFN Down\nLayer 1\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer1_ffn_down_1 [label="FFN Down\nLayer 1\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_1_0 [label="All-Reduce\nFFN Output\nLayer 1\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer2_qkv_0 [label="QKV Linear\nLayer 2\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer2_qkv_1 [label="QKV Linear\nLayer 2\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_2_0 [label="All-Reduce\nQKV\nLayer 2\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer2_attn_0 [label="Self-Attention\nLayer 2\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer2_attn_1 [label="Self-Attention\nLayer 2\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer2_attn_out_0 [label="Attention Output\nLayer 2\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer2_attn_out_1 [label="Attention Output\nLayer 2\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_2_0 [label="All-Reduce\nAttention\nLayer 2\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer2_ffn_gate_0 [label="FFN Gate\nLayer 2\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer2_ffn_gate_1 [label="FFN Gate\nLayer 2\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer2_ffn_up_0 [label="FFN Up\nLayer 2\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer2_ffn_up_1 [label="FFN Up\nLayer 2\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_2_0 [label="All-Reduce\nFFN\nLayer 2\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer2_ffn_down_0 [label="FFN Down\nLayer 2\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer2_ffn_down_1 [label="FFN Down\nLayer 2\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_2_0 [label="All-Reduce\nFFN Output\nLayer 2\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer3_qkv_0 [label="QKV Linear\nLayer 3\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer3_qkv_1 [label="QKV Linear\nLayer 3\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_3_0 [label="All-Reduce\nQKV\nLayer 3\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer3_attn_0 [label="Self-Attention\nLayer 3\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer3_attn_1 [label="Self-Attention\nLayer 3\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer3_attn_out_0 [label="Attention Output\nLayer 3\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer3_attn_out_1 [label="Attention Output\nLayer 3\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_3_0 [label="All-Reduce\nAttention\nLayer 3\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer3_ffn_gate_0 [label="FFN Gate\nLayer 3\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer3_ffn_gate_1 [label="FFN Gate\nLayer 3\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer3_ffn_up_0 [label="FFN Up\nLayer 3\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer3_ffn_up_1 [label="FFN Up\nLayer 3\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_3_0 [label="All-Reduce\nFFN\nLayer 3\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer3_ffn_down_0 [label="FFN Down\nLayer 3\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer3_ffn_down_1 [label="FFN Down\nLayer 3\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_3_0 [label="All-Reduce\nFFN Output\nLayer 3\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer4_qkv_0 [label="QKV Linear\nLayer 4\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer4_qkv_1 [label="QKV Linear\nLayer 4\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_4_0 [label="All-Reduce\nQKV\nLayer 4\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer4_attn_0 [label="Self-Attention\nLayer 4\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer4_attn_1 [label="Self-Attention\nLayer 4\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer4_attn_out_0 [label="Attention Output\nLayer 4\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer4_attn_out_1 [label="Attention Output\nLayer 4\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_4_0 [label="All-Reduce\nAttention\nLayer 4\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer4_ffn_gate_0 [label="FFN Gate\nLayer 4\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer4_ffn_gate_1 [label="FFN Gate\nLayer 4\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer4_ffn_up_0 [label="FFN Up\nLayer 4\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer4_ffn_up_1 [label="FFN Up\nLayer 4\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_4_0 [label="All-Reduce\nFFN\nLayer 4\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer4_ffn_down_0 [label="FFN Down\nLayer 4\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer4_ffn_down_1 [label="FFN Down\nLayer 4\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_4_0 [label="All-Reduce\nFFN Output\nLayer 4\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer5_qkv_0 [label="QKV Linear\nLayer 5\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer5_qkv_1 [label="QKV Linear\nLayer 5\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_5_0 [label="All-Reduce\nQKV\nLayer 5\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer5_attn_0 [label="Self-Attention\nLayer 5\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer5_attn_1 [label="Self-Attention\nLayer 5\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer5_attn_out_0 [label="Attention Output\nLayer 5\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer5_attn_out_1 [label="Attention Output\nLayer 5\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_5_0 [label="All-Reduce\nAttention\nLayer 5\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer5_ffn_gate_0 [label="FFN Gate\nLayer 5\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer5_ffn_gate_1 [label="FFN Gate\nLayer 5\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer5_ffn_up_0 [label="FFN Up\nLayer 5\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer5_ffn_up_1 [label="FFN Up\nLayer 5\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_5_0 [label="All-Reduce\nFFN\nLayer 5\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer5_ffn_down_0 [label="FFN Down\nLayer 5\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer5_ffn_down_1 [label="FFN Down\nLayer 5\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_5_0 [label="All-Reduce\nFFN Output\nLayer 5\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer6_qkv_0 [label="QKV Linear\nLayer 6\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer6_qkv_1 [label="QKV Linear\nLayer 6\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_6_0 [label="All-Reduce\nQKV\nLayer 6\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer6_attn_0 [label="Self-Attention\nLayer 6\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer6_attn_1 [label="Self-Attention\nLayer 6\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer6_attn_out_0 [label="Attention Output\nLayer 6\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer6_attn_out_1 [label="Attention Output\nLayer 6\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_6_0 [label="All-Reduce\nAttention\nLayer 6\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer6_ffn_gate_0 [label="FFN Gate\nLayer 6\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer6_ffn_gate_1 [label="FFN Gate\nLayer 6\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer6_ffn_up_0 [label="FFN Up\nLayer 6\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer6_ffn_up_1 [label="FFN Up\nLayer 6\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_6_0 [label="All-Reduce\nFFN\nLayer 6\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer6_ffn_down_0 [label="FFN Down\nLayer 6\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer6_ffn_down_1 [label="FFN Down\nLayer 6\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_6_0 [label="All-Reduce\nFFN Output\nLayer 6\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer7_qkv_0 [label="QKV Linear\nLayer 7\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer7_qkv_1 [label="QKV Linear\nLayer 7\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_7_0 [label="All-Reduce\nQKV\nLayer 7\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer7_attn_0 [label="Self-Attention\nLayer 7\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer7_attn_1 [label="Self-Attention\nLayer 7\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer7_attn_out_0 [label="Attention Output\nLayer 7\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer7_attn_out_1 [label="Attention Output\nLayer 7\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_7_0 [label="All-Reduce\nAttention\nLayer 7\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer7_ffn_gate_0 [label="FFN Gate\nLayer 7\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer7_ffn_gate_1 [label="FFN Gate\nLayer 7\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer7_ffn_up_0 [label="FFN Up\nLayer 7\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer7_ffn_up_1 [label="FFN Up\nLayer 7\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_7_0 [label="All-Reduce\nFFN\nLayer 7\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer7_ffn_down_0 [label="FFN Down\nLayer 7\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer7_ffn_down_1 [label="FFN Down\nLayer 7\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_7_0 [label="All-Reduce\nFFN Output\nLayer 7\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer8_qkv_0 [label="QKV Linear\nLayer 8\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer8_qkv_1 [label="QKV Linear\nLayer 8\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_8_0 [label="All-Reduce\nQKV\nLayer 8\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer8_attn_0 [label="Self-Attention\nLayer 8\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer8_attn_1 [label="Self-Attention\nLayer 8\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer8_attn_out_0 [label="Attention Output\nLayer 8\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer8_attn_out_1 [label="Attention Output\nLayer 8\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_8_0 [label="All-Reduce\nAttention\nLayer 8\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer8_ffn_gate_0 [label="FFN Gate\nLayer 8\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer8_ffn_gate_1 [label="FFN Gate\nLayer 8\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer8_ffn_up_0 [label="FFN Up\nLayer 8\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer8_ffn_up_1 [label="FFN Up\nLayer 8\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_8_0 [label="All-Reduce\nFFN\nLayer 8\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer8_ffn_down_0 [label="FFN Down\nLayer 8\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer8_ffn_down_1 [label="FFN Down\nLayer 8\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_8_0 [label="All-Reduce\nFFN Output\nLayer 8\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer9_qkv_0 [label="QKV Linear\nLayer 9\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer9_qkv_1 [label="QKV Linear\nLayer 9\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_9_0 [label="All-Reduce\nQKV\nLayer 9\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer9_attn_0 [label="Self-Attention\nLayer 9\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer9_attn_1 [label="Self-Attention\nLayer 9\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer9_attn_out_0 [label="Attention Output\nLayer 9\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer9_attn_out_1 [label="Attention Output\nLayer 9\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_9_0 [label="All-Reduce\nAttention\nLayer 9\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer9_ffn_gate_0 [label="FFN Gate\nLayer 9\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer9_ffn_gate_1 [label="FFN Gate\nLayer 9\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer9_ffn_up_0 [label="FFN Up\nLayer 9\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer9_ffn_up_1 [label="FFN Up\nLayer 9\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_9_0 [label="All-Reduce\nFFN\nLayer 9\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer9_ffn_down_0 [label="FFN Down\nLayer 9\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer9_ffn_down_1 [label="FFN Down\nLayer 9\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_9_0 [label="All-Reduce\nFFN Output\nLayer 9\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer10_qkv_0 [label="QKV Linear\nLayer 10\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer10_qkv_1 [label="QKV Linear\nLayer 10\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_10_0 [label="All-Reduce\nQKV\nLayer 10\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer10_attn_0 [label="Self-Attention\nLayer 10\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer10_attn_1 [label="Self-Attention\nLayer 10\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer10_attn_out_0 [label="Attention Output\nLayer 10\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer10_attn_out_1 [label="Attention Output\nLayer 10\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_10_0 [label="All-Reduce\nAttention\nLayer 10\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer10_ffn_gate_0 [label="FFN Gate\nLayer 10\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer10_ffn_gate_1 [label="FFN Gate\nLayer 10\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer10_ffn_up_0 [label="FFN Up\nLayer 10\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer10_ffn_up_1 [label="FFN Up\nLayer 10\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_10_0 [label="All-Reduce\nFFN\nLayer 10\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer10_ffn_down_0 [label="FFN Down\nLayer 10\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer10_ffn_down_1 [label="FFN Down\nLayer 10\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_10_0 [label="All-Reduce\nFFN Output\nLayer 10\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer11_qkv_0 [label="QKV Linear\nLayer 11\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer11_qkv_1 [label="QKV Linear\nLayer 11\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_11_0 [label="All-Reduce\nQKV\nLayer 11\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer11_attn_0 [label="Self-Attention\nLayer 11\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer11_attn_1 [label="Self-Attention\nLayer 11\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer11_attn_out_0 [label="Attention Output\nLayer 11\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer11_attn_out_1 [label="Attention Output\nLayer 11\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_11_0 [label="All-Reduce\nAttention\nLayer 11\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer11_ffn_gate_0 [label="FFN Gate\nLayer 11\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer11_ffn_gate_1 [label="FFN Gate\nLayer 11\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer11_ffn_up_0 [label="FFN Up\nLayer 11\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer11_ffn_up_1 [label="FFN Up\nLayer 11\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_11_0 [label="All-Reduce\nFFN\nLayer 11\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer11_ffn_down_0 [label="FFN Down\nLayer 11\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer11_ffn_down_1 [label="FFN Down\nLayer 11\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_11_0 [label="All-Reduce\nFFN Output\nLayer 11\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer12_qkv_0 [label="QKV Linear\nLayer 12\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer12_qkv_1 [label="QKV Linear\nLayer 12\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_12_0 [label="All-Reduce\nQKV\nLayer 12\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer12_attn_0 [label="Self-Attention\nLayer 12\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer12_attn_1 [label="Self-Attention\nLayer 12\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer12_attn_out_0 [label="Attention Output\nLayer 12\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer12_attn_out_1 [label="Attention Output\nLayer 12\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_12_0 [label="All-Reduce\nAttention\nLayer 12\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer12_ffn_gate_0 [label="FFN Gate\nLayer 12\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer12_ffn_gate_1 [label="FFN Gate\nLayer 12\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer12_ffn_up_0 [label="FFN Up\nLayer 12\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer12_ffn_up_1 [label="FFN Up\nLayer 12\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_12_0 [label="All-Reduce\nFFN\nLayer 12\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer12_ffn_down_0 [label="FFN Down\nLayer 12\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer12_ffn_down_1 [label="FFN Down\nLayer 12\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_12_0 [label="All-Reduce\nFFN Output\nLayer 12\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer13_qkv_0 [label="QKV Linear\nLayer 13\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer13_qkv_1 [label="QKV Linear\nLayer 13\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_13_0 [label="All-Reduce\nQKV\nLayer 13\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer13_attn_0 [label="Self-Attention\nLayer 13\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer13_attn_1 [label="Self-Attention\nLayer 13\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer13_attn_out_0 [label="Attention Output\nLayer 13\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer13_attn_out_1 [label="Attention Output\nLayer 13\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_13_0 [label="All-Reduce\nAttention\nLayer 13\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer13_ffn_gate_0 [label="FFN Gate\nLayer 13\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer13_ffn_gate_1 [label="FFN Gate\nLayer 13\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer13_ffn_up_0 [label="FFN Up\nLayer 13\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer13_ffn_up_1 [label="FFN Up\nLayer 13\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_13_0 [label="All-Reduce\nFFN\nLayer 13\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer13_ffn_down_0 [label="FFN Down\nLayer 13\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer13_ffn_down_1 [label="FFN Down\nLayer 13\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_13_0 [label="All-Reduce\nFFN Output\nLayer 13\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer14_qkv_0 [label="QKV Linear\nLayer 14\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer14_qkv_1 [label="QKV Linear\nLayer 14\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_14_0 [label="All-Reduce\nQKV\nLayer 14\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer14_attn_0 [label="Self-Attention\nLayer 14\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer14_attn_1 [label="Self-Attention\nLayer 14\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer14_attn_out_0 [label="Attention Output\nLayer 14\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer14_attn_out_1 [label="Attention Output\nLayer 14\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_14_0 [label="All-Reduce\nAttention\nLayer 14\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer14_ffn_gate_0 [label="FFN Gate\nLayer 14\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer14_ffn_gate_1 [label="FFN Gate\nLayer 14\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer14_ffn_up_0 [label="FFN Up\nLayer 14\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer14_ffn_up_1 [label="FFN Up\nLayer 14\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_14_0 [label="All-Reduce\nFFN\nLayer 14\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer14_ffn_down_0 [label="FFN Down\nLayer 14\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer14_ffn_down_1 [label="FFN Down\nLayer 14\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_14_0 [label="All-Reduce\nFFN Output\nLayer 14\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer15_qkv_0 [label="QKV Linear\nLayer 15\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer15_qkv_1 [label="QKV Linear\nLayer 15\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_15_0 [label="All-Reduce\nQKV\nLayer 15\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer15_attn_0 [label="Self-Attention\nLayer 15\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer15_attn_1 [label="Self-Attention\nLayer 15\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer15_attn_out_0 [label="Attention Output\nLayer 15\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer15_attn_out_1 [label="Attention Output\nLayer 15\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_15_0 [label="All-Reduce\nAttention\nLayer 15\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer15_ffn_gate_0 [label="FFN Gate\nLayer 15\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer15_ffn_gate_1 [label="FFN Gate\nLayer 15\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer15_ffn_up_0 [label="FFN Up\nLayer 15\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer15_ffn_up_1 [label="FFN Up\nLayer 15\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_15_0 [label="All-Reduce\nFFN\nLayer 15\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer15_ffn_down_0 [label="FFN Down\nLayer 15\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer15_ffn_down_1 [label="FFN Down\nLayer 15\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_15_0 [label="All-Reduce\nFFN Output\nLayer 15\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer16_qkv_0 [label="QKV Linear\nLayer 16\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer16_qkv_1 [label="QKV Linear\nLayer 16\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_16_0 [label="All-Reduce\nQKV\nLayer 16\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer16_attn_0 [label="Self-Attention\nLayer 16\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer16_attn_1 [label="Self-Attention\nLayer 16\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer16_attn_out_0 [label="Attention Output\nLayer 16\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer16_attn_out_1 [label="Attention Output\nLayer 16\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_16_0 [label="All-Reduce\nAttention\nLayer 16\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer16_ffn_gate_0 [label="FFN Gate\nLayer 16\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer16_ffn_gate_1 [label="FFN Gate\nLayer 16\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer16_ffn_up_0 [label="FFN Up\nLayer 16\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer16_ffn_up_1 [label="FFN Up\nLayer 16\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_16_0 [label="All-Reduce\nFFN\nLayer 16\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer16_ffn_down_0 [label="FFN Down\nLayer 16\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer16_ffn_down_1 [label="FFN Down\nLayer 16\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_16_0 [label="All-Reduce\nFFN Output\nLayer 16\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer17_qkv_0 [label="QKV Linear\nLayer 17\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer17_qkv_1 [label="QKV Linear\nLayer 17\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_17_0 [label="All-Reduce\nQKV\nLayer 17\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer17_attn_0 [label="Self-Attention\nLayer 17\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer17_attn_1 [label="Self-Attention\nLayer 17\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer17_attn_out_0 [label="Attention Output\nLayer 17\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer17_attn_out_1 [label="Attention Output\nLayer 17\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_17_0 [label="All-Reduce\nAttention\nLayer 17\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer17_ffn_gate_0 [label="FFN Gate\nLayer 17\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer17_ffn_gate_1 [label="FFN Gate\nLayer 17\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer17_ffn_up_0 [label="FFN Up\nLayer 17\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer17_ffn_up_1 [label="FFN Up\nLayer 17\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_17_0 [label="All-Reduce\nFFN\nLayer 17\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer17_ffn_down_0 [label="FFN Down\nLayer 17\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer17_ffn_down_1 [label="FFN Down\nLayer 17\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_17_0 [label="All-Reduce\nFFN Output\nLayer 17\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer18_qkv_0 [label="QKV Linear\nLayer 18\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer18_qkv_1 [label="QKV Linear\nLayer 18\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_18_0 [label="All-Reduce\nQKV\nLayer 18\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer18_attn_0 [label="Self-Attention\nLayer 18\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer18_attn_1 [label="Self-Attention\nLayer 18\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer18_attn_out_0 [label="Attention Output\nLayer 18\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer18_attn_out_1 [label="Attention Output\nLayer 18\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_18_0 [label="All-Reduce\nAttention\nLayer 18\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer18_ffn_gate_0 [label="FFN Gate\nLayer 18\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer18_ffn_gate_1 [label="FFN Gate\nLayer 18\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer18_ffn_up_0 [label="FFN Up\nLayer 18\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer18_ffn_up_1 [label="FFN Up\nLayer 18\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_18_0 [label="All-Reduce\nFFN\nLayer 18\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer18_ffn_down_0 [label="FFN Down\nLayer 18\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer18_ffn_down_1 [label="FFN Down\nLayer 18\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_18_0 [label="All-Reduce\nFFN Output\nLayer 18\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer19_qkv_0 [label="QKV Linear\nLayer 19\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		layer19_qkv_1 [label="QKV Linear\nLayer 19\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#FFE6E6" shape=rectangle]
		qkv_ar_19_0 [label="All-Reduce\nQKV\nLayer 19\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer19_attn_0 [label="Self-Attention\nLayer 19\nGPU:0\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer19_attn_1 [label="Self-Attention\nLayer 19\nGPU:1\nInput:[4,2048,12288]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer19_attn_out_0 [label="Attention Output\nLayer 19\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer19_attn_out_1 [label="Attention Output\nLayer 19\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		attn_out_ar_19_0 [label="All-Reduce\nAttention\nLayer 19\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer19_ffn_gate_0 [label="FFN Gate\nLayer 19\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer19_ffn_gate_1 [label="FFN Gate\nLayer 19\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer19_ffn_up_0 [label="FFN Up\nLayer 19\nGPU:0\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		layer19_ffn_up_1 [label="FFN Up\nLayer 19\nGPU:1\nInput:[4,2048,8192]\nOutput:[4,2048,28672]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_ar_19_0 [label="All-Reduce\nFFN\nLayer 19\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
		layer19_ffn_down_0 [label="FFN Down\nLayer 19\nGPU:0\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		layer19_ffn_down_1 [label="FFN Down\nLayer 19\nGPU:1\nInput:[4,2048,28672]\nOutput:[4,2048,8192]" fillcolor="#FFE6E6" shape=rectangle]
		ffn_out_ar_19_0 [label="All-Reduce\nFFN Output\nLayer 19\nGPU:[0,1]" fillcolor=lightblue shape=ellipse]
	}
	subgraph cluster_stage1 {
		bgcolor=lightgray label="Stage 1: GPUs [2,3]\nLayers 20-39" style=rounded
		layer20_qkv_0 [label="QKV Linear\nLayer 20\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer20_qkv_1 [label="QKV Linear\nLayer 20\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_20_1 [label="All-Reduce\nQKV\nLayer 20\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer20_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 20\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_20_1 [label="All-Reduce\nFFN\nLayer 20\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_20_1 [label="All-Reduce\nFFN Output\nLayer 20\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer21_qkv_0 [label="QKV Linear\nLayer 21\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer21_qkv_1 [label="QKV Linear\nLayer 21\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_21_1 [label="All-Reduce\nQKV\nLayer 21\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer21_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 21\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_21_1 [label="All-Reduce\nFFN\nLayer 21\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_21_1 [label="All-Reduce\nFFN Output\nLayer 21\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer22_qkv_0 [label="QKV Linear\nLayer 22\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer22_qkv_1 [label="QKV Linear\nLayer 22\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_22_1 [label="All-Reduce\nQKV\nLayer 22\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer22_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 22\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_22_1 [label="All-Reduce\nFFN\nLayer 22\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_22_1 [label="All-Reduce\nFFN Output\nLayer 22\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer23_qkv_0 [label="QKV Linear\nLayer 23\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer23_qkv_1 [label="QKV Linear\nLayer 23\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_23_1 [label="All-Reduce\nQKV\nLayer 23\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer23_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 23\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_23_1 [label="All-Reduce\nFFN\nLayer 23\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_23_1 [label="All-Reduce\nFFN Output\nLayer 23\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer24_qkv_0 [label="QKV Linear\nLayer 24\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer24_qkv_1 [label="QKV Linear\nLayer 24\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_24_1 [label="All-Reduce\nQKV\nLayer 24\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer24_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 24\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_24_1 [label="All-Reduce\nFFN\nLayer 24\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_24_1 [label="All-Reduce\nFFN Output\nLayer 24\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer25_qkv_0 [label="QKV Linear\nLayer 25\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer25_qkv_1 [label="QKV Linear\nLayer 25\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_25_1 [label="All-Reduce\nQKV\nLayer 25\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer25_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 25\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_25_1 [label="All-Reduce\nFFN\nLayer 25\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_25_1 [label="All-Reduce\nFFN Output\nLayer 25\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer26_qkv_0 [label="QKV Linear\nLayer 26\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer26_qkv_1 [label="QKV Linear\nLayer 26\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_26_1 [label="All-Reduce\nQKV\nLayer 26\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer26_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 26\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_26_1 [label="All-Reduce\nFFN\nLayer 26\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_26_1 [label="All-Reduce\nFFN Output\nLayer 26\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer27_qkv_0 [label="QKV Linear\nLayer 27\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer27_qkv_1 [label="QKV Linear\nLayer 27\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_27_1 [label="All-Reduce\nQKV\nLayer 27\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer27_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 27\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_27_1 [label="All-Reduce\nFFN\nLayer 27\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_27_1 [label="All-Reduce\nFFN Output\nLayer 27\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer28_qkv_0 [label="QKV Linear\nLayer 28\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer28_qkv_1 [label="QKV Linear\nLayer 28\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_28_1 [label="All-Reduce\nQKV\nLayer 28\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer28_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 28\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_28_1 [label="All-Reduce\nFFN\nLayer 28\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_28_1 [label="All-Reduce\nFFN Output\nLayer 28\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer29_qkv_0 [label="QKV Linear\nLayer 29\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer29_qkv_1 [label="QKV Linear\nLayer 29\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_29_1 [label="All-Reduce\nQKV\nLayer 29\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer29_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 29\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_29_1 [label="All-Reduce\nFFN\nLayer 29\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_29_1 [label="All-Reduce\nFFN Output\nLayer 29\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer30_qkv_0 [label="QKV Linear\nLayer 30\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer30_qkv_1 [label="QKV Linear\nLayer 30\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_30_1 [label="All-Reduce\nQKV\nLayer 30\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer30_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 30\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_30_1 [label="All-Reduce\nFFN\nLayer 30\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_30_1 [label="All-Reduce\nFFN Output\nLayer 30\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer31_qkv_0 [label="QKV Linear\nLayer 31\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer31_qkv_1 [label="QKV Linear\nLayer 31\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_31_1 [label="All-Reduce\nQKV\nLayer 31\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer31_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 31\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_31_1 [label="All-Reduce\nFFN\nLayer 31\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_31_1 [label="All-Reduce\nFFN Output\nLayer 31\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer32_qkv_0 [label="QKV Linear\nLayer 32\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer32_qkv_1 [label="QKV Linear\nLayer 32\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_32_1 [label="All-Reduce\nQKV\nLayer 32\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer32_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 32\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_32_1 [label="All-Reduce\nFFN\nLayer 32\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_32_1 [label="All-Reduce\nFFN Output\nLayer 32\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer33_qkv_0 [label="QKV Linear\nLayer 33\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer33_qkv_1 [label="QKV Linear\nLayer 33\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_33_1 [label="All-Reduce\nQKV\nLayer 33\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer33_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 33\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_33_1 [label="All-Reduce\nFFN\nLayer 33\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_33_1 [label="All-Reduce\nFFN Output\nLayer 33\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer34_qkv_0 [label="QKV Linear\nLayer 34\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer34_qkv_1 [label="QKV Linear\nLayer 34\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_34_1 [label="All-Reduce\nQKV\nLayer 34\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer34_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 34\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_34_1 [label="All-Reduce\nFFN\nLayer 34\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_34_1 [label="All-Reduce\nFFN Output\nLayer 34\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer35_qkv_0 [label="QKV Linear\nLayer 35\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer35_qkv_1 [label="QKV Linear\nLayer 35\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_35_1 [label="All-Reduce\nQKV\nLayer 35\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer35_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 35\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_35_1 [label="All-Reduce\nFFN\nLayer 35\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_35_1 [label="All-Reduce\nFFN Output\nLayer 35\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer36_qkv_0 [label="QKV Linear\nLayer 36\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer36_qkv_1 [label="QKV Linear\nLayer 36\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_36_1 [label="All-Reduce\nQKV\nLayer 36\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer36_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 36\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_36_1 [label="All-Reduce\nFFN\nLayer 36\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_36_1 [label="All-Reduce\nFFN Output\nLayer 36\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer37_qkv_0 [label="QKV Linear\nLayer 37\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer37_qkv_1 [label="QKV Linear\nLayer 37\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_37_1 [label="All-Reduce\nQKV\nLayer 37\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer37_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 37\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_37_1 [label="All-Reduce\nFFN\nLayer 37\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_37_1 [label="All-Reduce\nFFN Output\nLayer 37\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer38_qkv_0 [label="QKV Linear\nLayer 38\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer38_qkv_1 [label="QKV Linear\nLayer 38\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_38_1 [label="All-Reduce\nQKV\nLayer 38\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer38_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 38\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_38_1 [label="All-Reduce\nFFN\nLayer 38\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_38_1 [label="All-Reduce\nFFN Output\nLayer 38\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer39_qkv_0 [label="QKV Linear\nLayer 39\nGPU:2\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" mythology=rectangle]
		layer39_qkv_1 [label="QKV Linear\nLayer 39\nGPU:3\nInput:[4,2048,8192]\nOutput:[4,2048,12288]" fillcolor="#E6F3FF" shape=rectangle]
		qkv_ar_39_1 [label="All-Reduce\nQKV\nLayer 39\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		layer39_attn_out_ar_1 [label="All-Reduce\nAttention\nLayer 39\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_ar_39_1 [label="All-Reduce\nFFN\nLayer 39\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_39_1 [label="All-Reduce\nFFN Output\nLayer 39\nGPU:[2,3]" fillcolor=lightblue shape=ellipse]
	}
	subgraph cluster_stage2 {
		bgcolor=lightgray label="Stage 2: GPUs [4,5]\nLayers 40-59" style=rounded
		layer40_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 40\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_40_2 [label="All-Reduce\nFFN Output\nLayer 40\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer41_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 41\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_41_2 [label="All-Reduce\nFFN Output\nLayer 41\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer42_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 42\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_42_2 [label="All-Reduce\nFFN Output\nLayer 42\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer43_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 43\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_43_2 [label="All-Reduce\nFFN Output\nLayer 43\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer44_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 44\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_44_2 [label="All-Reduce\nFFN Output\nLayer 44\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer45_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 45\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_45_2 [label="All-Reduce\nFFN Output\nLayer 45\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer46_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 46\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_46_2 [label="All-Reduce\nFFN Output\nLayer 46\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer47_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 47\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_47_2 [label="All-Reduce\nFFN Output\nLayer 47\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer48_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 48\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_48_2 [label="All-Reduce\nFFN Output\nLayer 48\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer49_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 49\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_49_2 [label="All-Reduce\nFFN Output\nLayer 49\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer50_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 50\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_50_2 [label="All-Reduce\nFFN Output\nLayer 50\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer51_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 51\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_51_2 [label="All-Reduce\nFFN Output\nLayer 51\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer52_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 52\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_52_2 [label="All-Reduce\nFFN Output\nLayer 52\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer53_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 53\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_53_2 [label="All-Reduce\nFFN Output\nLayer 53\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer54_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 54\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_54_2 [label="All-Reduce\nFFN Output\nLayer 54\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer55_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 55\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_55_2 [label="All-Reduce\nFFN Output\nLayer 55\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer56_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 56\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_56_2 [label="All-Reduce\nFFN Output\nLayer 56\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer57_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 57\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_57_2 [label="All-Reduce\nFFN Output\nLayer 57\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer58_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 58\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_58_2 [label="All-Reduce\nFFN Output\nLayer 58\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		layer59_attn_out_ar_2 [label="All-Reduce\nAttention\nLayer 59\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_59_2 [label="All-Reduce\nFFN Output\nLayer 59\nGPU:[4,5]" fillcolor=lightblue shape=ellipse]
	}
	subgraph cluster_stage3 {
		bgcolor=lightgray label="Stage 3: GPUs [6,7]\nLayers 60-79" style=rounded
		layer60_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 60\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_60_3 [label="All-Reduce\nFFN Output\nLayer 60\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer61_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 61\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_61_3 [label="All-Reduce\nFFN Output\nLayer 61\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer62_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 62\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_62_3 [label="All-Reduce\nFFN Output\nLayer 62\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer63_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 63\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_63_3 [label="All-Reduce\nFFN Output\nLayer 63\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer64_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 64\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_64_3 [label="All-Reduce\nFFN Output\nLayer 64\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer65_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 65\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_65_3 [label="All-Reduce\nFFN Output\nLayer 65\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer66_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 66\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_66_3 [label="All-Reduce\nFFN Output\nLayer 66\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer67_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 67\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_67_3 [label="All-Reduce\nFFN Output\nLayer 67\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer68_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 68\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_68_3 [label="All-Reduce\nFFN Output\nLayer 68\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer69_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 69\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_69_3 [label="All-Reduce\nFFN Output\nLayer 69\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer70_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 70\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_70_3 [label="All-Reduce\nFFN Output\nLayer 70\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer71_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 71\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_71_3 [label="All-Reduce\nFFN Output\nLayer 71\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer72_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 72\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_72_3 [label="All-Reduce\nFFN Output\nLayer 72\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer73_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 73\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_73_3 [label="All-Reduce\nFFN Output\nLayer 73\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer74_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 74\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_74_3 [label="All-Reduce\nFFN Output\nLayer 74\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer75_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 75\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_75_3 [label="All-Reduce\nFFN Output\nLayer 75\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer76_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 76\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_76_3 [label="All-Reduce\nFFN Output\nLayer 76\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer77_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 77\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_77_3 [label="All-Reduce\nFFN Output\nLayer 77\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer78_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 78\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_78_3 [label="All-Reduce\nFFN Output\nLayer 78\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		layer79_attn_out_ar_3 [label="All-Reduce\nAttention\nLayer 79\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
		ffn_out_ar_79_3 [label="All-Reduce\nFFN Output\nLayer 79\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
	}
	pp_send_0_1 [label="Pipeline Send\nStage 01\nGPU:[1][2]" fillcolor=lightcoral shape=ellipse]
	pp_send_1_2 [label="Pipeline Send\nStage 12\nGPU:[3][4]" fillcolor=lightcoral shape=ellipse]
	pp_send_2_3 [label="Pipeline Send\nStage 23\nGPU:[5][6]" fillcolor=lightcoral shape=ellipse]
	output_norm_0 [label="RMSNorm\nGPU:6\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFF0E6" shape=rectangle]
	output_norm_1 [label="RMSNorm\nGPU:7\nInput:[4,2048,8192]\nOutput:[4,2048,8192]" fillcolor="#FFF0E6" shape=rectangle]
	final_ag [label="All-Gather\nFinal Output\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
	lm_head_0 [label="LM Head\nGPU:6\nInput:[4,2048,8192]\nOutput:[4,2048,128256]" fillcolor="#FFF0E6" shape=rectangle]
	lm_head_1 [label="LM Head\nGPU:7\nInput:[4,2048,8192]\nOutput:[4,2048,128256]" fillcolor="#FFF0E6" shape=rectangle]
	final_ar [label="All-Reduce\nLogits\nGPU:[6,7]" fillcolor=lightblue shape=ellipse]
	output [label="Output\n[batch_size=4, seq_len=2048, vocab=128256]" fillcolor=white shape=ellipse style=filled]
	input -> split_0
	split_0 -> layer0_embed_0
	split_0 -> layer0_embed_1
	layer0_embed_0 -> embed_ag_0
	layer0_embed_1 -> embed_ag_0
	ffn_out_ar_19_0 -> pp_send_0_1
	pp_send_0_1 -> layer20_qkv_0
	pp_send_0_1 -> layer20_qkv_1
	ffn_out_ar_39_1 -> pp_send_1_2
	pp_send_1_2 -> layer40_attn_out_ar_2
	ffn_out_ar_59_2 -> pp_send_2_3
	pp_send_2_3 -> layer60_attn_out_ar_3
	ffn_out_ar_79_3 -> output_norm_0
	ffn_out_ar_79_3 -> output_norm_1
	output_norm_0 -> final_ag
	output_norm_1 -> final_ag
	final_ag -> lm_head_0
	final_ag -> lm_head_1
	lm_head_0 -> final_ar
	lm_head_1 -> final_ar
	final_ar -> output
}
