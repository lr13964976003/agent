<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="4757pt" height="12000pt"
 viewBox="0.00 0.00 1141.61 2880.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(4 4) rotate(0) translate(4 2998.08)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2998.08 1186,-2998.08 1186,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_input</title>
<path fill="lightgray" stroke="black" d="M421,-2895.08C421,-2895.08 669,-2895.08 669,-2895.08 675,-2895.08 681,-2901.08 681,-2907.08 681,-2907.08 681,-2974.08 681,-2974.08 681,-2980.08 675,-2986.08 669,-2986.08 669,-2986.08 421,-2986.08 421,-2986.08 415,-2986.08 409,-2980.08 409,-2974.08 409,-2974.08 409,-2907.08 409,-2907.08 409,-2901.08 415,-2895.08 421,-2895.08"/>
<text text-anchor="middle" x="545" y="-2970.88" font-family="Times,serif" font-size="14.00">Input Layer</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_layer1</title>
<path fill="lightblue" stroke="black" d="M20,-1652C20,-1652 1162,-1652 1162,-1652 1168,-1652 1174,-1658 1174,-1664 1174,-1664 1174,-2855.08 1174,-2855.08 1174,-2861.08 1168,-2867.08 1162,-2867.08 1162,-2867.08 20,-2867.08 20,-2867.08 14,-2867.08 8,-2861.08 8,-2855.08 8,-2855.08 8,-1664 8,-1664 8,-1658 14,-1652 20,-1652"/>
<text text-anchor="middle" x="591" y="-2851.88" font-family="Times,serif" font-size="14.00">Layer 1 &#45; Attention + MoE</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_layers_2_16</title>
<path fill="lightblue" stroke="black" d="M492,-296C492,-296 656,-296 656,-296 662,-296 668,-302 668,-308 668,-308 668,-1621 668,-1621 668,-1627 662,-1633 656,-1633 656,-1633 492,-1633 492,-1633 486,-1633 480,-1627 480,-1621 480,-1621 480,-308 480,-308 480,-302 486,-296 492,-296"/>
<text text-anchor="middle" x="574" y="-1617.8" font-family="Times,serif" font-size="14.00">Layers 2&#45;16 (Simplified)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_output</title>
<path fill="lightgray" stroke="black" d="M500,-8C500,-8 648,-8 648,-8 654,-8 660,-14 660,-20 660,-20 660,-265 660,-265 660,-271 654,-277 648,-277 648,-277 500,-277 500,-277 494,-277 488,-271 488,-265 488,-265 488,-20 488,-20 488,-14 494,-8 500,-8"/>
<text text-anchor="middle" x="574" y="-261.8" font-family="Times,serif" font-size="14.00">Output Layer</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="lightcoral" stroke="black" points="672.5,-2955.08 417.5,-2955.08 417.5,-2903.08 672.5,-2903.08 672.5,-2955.08"/>
<text text-anchor="middle" x="545" y="-2943.08" font-family="Arial" font-size="10.00">Input Tokens</text>
<text text-anchor="middle" x="545" y="-2932.08" font-family="Arial" font-size="10.00">GPU: All</text>
<text text-anchor="middle" x="545" y="-2921.08" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=1024, hidden=1024]</text>
<text text-anchor="middle" x="545" y="-2910.08" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=1024, hidden=1024]</text>
</g>
<!-- attn_norm_1 -->
<g id="node2" class="node">
<title>attn_norm_1</title>
<polygon fill="lightblue" stroke="black" points="609,-2836.08 481,-2836.08 481,-2784.08 609,-2784.08 609,-2836.08"/>
<text text-anchor="middle" x="545" y="-2824.08" font-family="Arial" font-size="10.00">Layer Norm (Attention)</text>
<text text-anchor="middle" x="545" y="-2813.08" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="545" y="-2802.08" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="545" y="-2791.08" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- input&#45;&gt;attn_norm_1 -->
<g id="edge1" class="edge">
<title>input&#45;&gt;attn_norm_1</title>
<path fill="none" stroke="black" d="M545,-2902.98C545,-2886.4 545,-2864.44 545,-2846.14"/>
<polygon fill="black" stroke="black" points="548.5,-2846.14 545,-2836.14 541.5,-2846.14 548.5,-2846.14"/>
<text text-anchor="middle" x="584.5" y="-2877.88" font-family="Arial" font-size="9.00">Token embeddings</text>
</g>
<!-- attn_q_1 -->
<g id="node3" class="node">
<title>attn_q_1</title>
<polygon fill="lightblue" stroke="black" points="463,-2747.08 335,-2747.08 335,-2695.08 463,-2695.08 463,-2747.08"/>
<text text-anchor="middle" x="399" y="-2735.08" font-family="Arial" font-size="10.00">Q Projection</text>
<text text-anchor="middle" x="399" y="-2724.08" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="399" y="-2713.08" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="399" y="-2702.08" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- attn_norm_1&#45;&gt;attn_q_1 -->
<g id="edge2" class="edge">
<title>attn_norm_1&#45;&gt;attn_q_1</title>
<path fill="none" stroke="black" d="M502.77,-2783.91C486.28,-2774.09 467.22,-2762.73 449.97,-2752.45"/>
<polygon fill="black" stroke="black" points="451.52,-2749.3 441.13,-2747.19 447.93,-2755.31 451.52,-2749.3"/>
</g>
<!-- attn_k_1 -->
<g id="node4" class="node">
<title>attn_k_1</title>
<polygon fill="lightblue" stroke="black" points="609,-2747.08 481,-2747.08 481,-2695.08 609,-2695.08 609,-2747.08"/>
<text text-anchor="middle" x="545" y="-2735.08" font-family="Arial" font-size="10.00">K Projection</text>
<text text-anchor="middle" x="545" y="-2724.08" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="545" y="-2713.08" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="545" y="-2702.08" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- attn_norm_1&#45;&gt;attn_k_1 -->
<g id="edge3" class="edge">
<title>attn_norm_1&#45;&gt;attn_k_1</title>
<path fill="none" stroke="black" d="M545,-2783.91C545,-2775.62 545,-2766.23 545,-2757.33"/>
<polygon fill="black" stroke="black" points="548.5,-2757.19 545,-2747.19 541.5,-2757.19 548.5,-2757.19"/>
</g>
<!-- attn_v_1 -->
<g id="node5" class="node">
<title>attn_v_1</title>
<polygon fill="lightblue" stroke="black" points="692,-2677.08 564,-2677.08 564,-2625.08 692,-2625.08 692,-2677.08"/>
<text text-anchor="middle" x="628" y="-2665.08" font-family="Arial" font-size="10.00">V Projection</text>
<text text-anchor="middle" x="628" y="-2654.08" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="628" y="-2643.08" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="628" y="-2632.08" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- attn_norm_1&#45;&gt;attn_v_1 -->
<g id="edge4" class="edge">
<title>attn_norm_1&#45;&gt;attn_v_1</title>
<path fill="none" stroke="black" d="M585.4,-2783.85C597.91,-2773.95 610.39,-2761.49 618,-2747.08 627.56,-2728.97 630.22,-2706.24 630.42,-2687.55"/>
<polygon fill="black" stroke="black" points="633.92,-2687.31 630.3,-2677.35 626.92,-2687.4 633.92,-2687.31"/>
</g>
<!-- attn_score_1 -->
<g id="node6" class="node">
<title>attn_score_1</title>
<polygon fill="lightblue" stroke="black" points="589,-2607.08 461,-2607.08 461,-2555.08 589,-2555.08 589,-2607.08"/>
<text text-anchor="middle" x="525" y="-2595.08" font-family="Arial" font-size="10.00">Attention Scores</text>
<text text-anchor="middle" x="525" y="-2584.08" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="525" y="-2573.08" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="525" y="-2562.08" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- attn_q_1&#45;&gt;attn_score_1 -->
<g id="edge5" class="edge">
<title>attn_q_1&#45;&gt;attn_score_1</title>
<path fill="none" stroke="black" d="M418.94,-2694.77C434.67,-2675.22 457.47,-2647.75 479,-2625.08 482.31,-2621.59 485.83,-2618.04 489.41,-2614.54"/>
<polygon fill="black" stroke="black" points="491.97,-2616.93 496.75,-2607.48 487.12,-2611.89 491.97,-2616.93"/>
<text text-anchor="middle" x="496" y="-2648.88" font-family="Arial" font-size="9.00">Q matrix</text>
</g>
<!-- attn_k_1&#45;&gt;attn_score_1 -->
<g id="edge6" class="edge">
<title>attn_k_1&#45;&gt;attn_score_1</title>
<path fill="none" stroke="black" d="M528.27,-2695.06C525.27,-2689.38 522.59,-2683.2 521,-2677.08 515.96,-2657.71 516.59,-2635.39 518.65,-2617.25"/>
<polygon fill="black" stroke="black" points="522.15,-2617.48 520,-2607.11 515.21,-2616.56 522.15,-2617.48"/>
<text text-anchor="middle" x="538" y="-2648.88" font-family="Arial" font-size="9.00">K matrix</text>
</g>
<!-- attn_out_1 -->
<g id="node7" class="node">
<title>attn_out_1</title>
<polygon fill="lightblue" stroke="black" points="640,-2509.08 512,-2509.08 512,-2457.08 640,-2457.08 640,-2509.08"/>
<text text-anchor="middle" x="576" y="-2497.08" font-family="Arial" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="576" y="-2486.08" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="576" y="-2475.08" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="576" y="-2464.08" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- attn_v_1&#45;&gt;attn_out_1 -->
<g id="edge7" class="edge">
<title>attn_v_1&#45;&gt;attn_out_1</title>
<path fill="none" stroke="black" d="M632.11,-2624.74C635.11,-2598.91 636.47,-2558.31 622,-2527.08 620.34,-2523.5 618.24,-2520.07 615.84,-2516.83"/>
<polygon fill="black" stroke="black" points="618.51,-2514.56 609.39,-2509.16 613.15,-2519.07 618.51,-2514.56"/>
<text text-anchor="middle" x="651" y="-2578.88" font-family="Arial" font-size="9.00">V matrix</text>
</g>
<!-- attn_score_1&#45;&gt;attn_out_1 -->
<g id="edge8" class="edge">
<title>attn_score_1&#45;&gt;attn_out_1</title>
<path fill="none" stroke="black" d="M537.58,-2554.9C542.06,-2546.07 547.19,-2536.1 552,-2527.08 553.53,-2524.21 555.13,-2521.25 556.76,-2518.28"/>
<polygon fill="black" stroke="black" points="559.86,-2519.9 561.63,-2509.46 553.73,-2516.52 559.86,-2519.9"/>
<text text-anchor="middle" x="587" y="-2529.88" font-family="Arial" font-size="9.00">Attention weights</text>
</g>
<!-- moe_gate_1 -->
<g id="node8" class="node">
<title>moe_gate_1</title>
<polygon fill="yellow" stroke="black" points="700.32,-2411.08 502.55,-2411.08 451.68,-2307.08 649.45,-2307.08 700.32,-2411.08"/>
<text text-anchor="middle" x="576" y="-2373.08" font-family="Arial" font-size="10.00">MoE Gate</text>
<text text-anchor="middle" x="576" y="-2362.08" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="576" y="-2351.08" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="576" y="-2340.08" font-family="Arial" font-size="10.00">Output: [128, 1024, 64]</text>
</g>
<!-- attn_out_1&#45;&gt;moe_gate_1 -->
<g id="edge9" class="edge">
<title>attn_out_1&#45;&gt;moe_gate_1</title>
<path fill="none" stroke="black" d="M576,-2456.8C576,-2446.55 576,-2434.22 576,-2421.85"/>
<polygon fill="black" stroke="black" points="579.5,-2421.49 576,-2411.49 572.5,-2421.49 579.5,-2421.49"/>
<text text-anchor="middle" x="608" y="-2431.88" font-family="Arial" font-size="9.00">Attention output</text>
</g>
<!-- tp_split_0_1 -->
<g id="node10" class="node">
<title>tp_split_0_1</title>
<ellipse fill="lightgreen" stroke="black" cx="226" cy="-2224.31" rx="79.39" ry="36.54"/>
<text text-anchor="middle" x="226" y="-2238.31" font-family="Arial" font-size="10.00">TP Split</text>
<text text-anchor="middle" x="226" y="-2227.31" font-family="Arial" font-size="10.00">GPU: 0&#45;1</text>
<text text-anchor="middle" x="226" y="-2216.31" font-family="Arial" font-size="10.00">Input: [128, 1024, 16]</text>
<text text-anchor="middle" x="226" y="-2205.31" font-family="Arial" font-size="10.00">Output: [128, 1024, 8]</text>
</g>
<!-- moe_gate_1&#45;&gt;tp_split_0_1 -->
<g id="edge10" class="edge">
<title>moe_gate_1&#45;&gt;tp_split_0_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M453.59,-2311.64C400.77,-2291.61 340.9,-2268.9 295.83,-2251.8"/>
<polygon fill="black" stroke="black" points="297.04,-2248.51 286.45,-2248.24 294.56,-2255.06 297.04,-2248.51"/>
<text text-anchor="middle" x="423.5" y="-2281.88" font-family="Arial" font-size="9.00">Gate selection 0</text>
</g>
<!-- tp_split_1_1 -->
<g id="node15" class="node">
<title>tp_split_1_1</title>
<ellipse fill="lightgreen" stroke="black" cx="510" cy="-2224.31" rx="79.39" ry="36.54"/>
<text text-anchor="middle" x="510" y="-2238.31" font-family="Arial" font-size="10.00">TP Split</text>
<text text-anchor="middle" x="510" y="-2227.31" font-family="Arial" font-size="10.00">GPU: 2&#45;3</text>
<text text-anchor="middle" x="510" y="-2216.31" font-family="Arial" font-size="10.00">Input: [128, 1024, 16]</text>
<text text-anchor="middle" x="510" y="-2205.31" font-family="Arial" font-size="10.00">Output: [128, 1024, 8]</text>
</g>
<!-- moe_gate_1&#45;&gt;tp_split_1_1 -->
<g id="edge17" class="edge">
<title>moe_gate_1&#45;&gt;tp_split_1_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M550.48,-2306.75C544.41,-2294.54 537.99,-2281.62 532.09,-2269.75"/>
<polygon fill="black" stroke="black" points="535.07,-2267.88 527.49,-2260.49 528.81,-2271 535.07,-2267.88"/>
<text text-anchor="middle" x="574.5" y="-2281.88" font-family="Arial" font-size="9.00">Gate selection 1</text>
</g>
<!-- tp_split_2_1 -->
<g id="node20" class="node">
<title>tp_split_2_1</title>
<ellipse fill="lightgreen" stroke="black" cx="686" cy="-2224.31" rx="79.39" ry="36.54"/>
<text text-anchor="middle" x="686" y="-2238.31" font-family="Arial" font-size="10.00">TP Split</text>
<text text-anchor="middle" x="686" y="-2227.31" font-family="Arial" font-size="10.00">GPU: 4&#45;5</text>
<text text-anchor="middle" x="686" y="-2216.31" font-family="Arial" font-size="10.00">Input: [128, 1024, 16]</text>
<text text-anchor="middle" x="686" y="-2205.31" font-family="Arial" font-size="10.00">Output: [128, 1024, 8]</text>
</g>
<!-- moe_gate_1&#45;&gt;tp_split_2_1 -->
<g id="edge24" class="edge">
<title>moe_gate_1&#45;&gt;tp_split_2_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M618.53,-2306.75C629.54,-2293.45 641.26,-2279.31 651.79,-2266.6"/>
<polygon fill="black" stroke="black" points="654.49,-2268.83 658.17,-2258.9 649.1,-2264.36 654.49,-2268.83"/>
<text text-anchor="middle" x="673.5" y="-2281.88" font-family="Arial" font-size="9.00">Gate selection 2</text>
</g>
<!-- tp_split_3_1 -->
<g id="node25" class="node">
<title>tp_split_3_1</title>
<ellipse fill="lightgreen" stroke="black" cx="956" cy="-2224.31" rx="79.39" ry="36.54"/>
<text text-anchor="middle" x="956" y="-2238.31" font-family="Arial" font-size="10.00">TP Split</text>
<text text-anchor="middle" x="956" y="-2227.31" font-family="Arial" font-size="10.00">GPU: 6&#45;7</text>
<text text-anchor="middle" x="956" y="-2216.31" font-family="Arial" font-size="10.00">Input: [128, 1024, 16]</text>
<text text-anchor="middle" x="956" y="-2205.31" font-family="Arial" font-size="10.00">Output: [128, 1024, 8]</text>
</g>
<!-- moe_gate_1&#45;&gt;tp_split_3_1 -->
<g id="edge31" class="edge">
<title>moe_gate_1&#45;&gt;tp_split_3_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M660.33,-2328.61C727.51,-2305.14 820.53,-2272.64 884.19,-2250.4"/>
<polygon fill="black" stroke="black" points="885.46,-2253.66 893.75,-2247.06 883.15,-2247.05 885.46,-2253.66"/>
<text text-anchor="middle" x="833.5" y="-2281.88" font-family="Arial" font-size="9.00">Gate selection 3</text>
</g>
<!-- expert_0_1 -->
<g id="node9" class="node">
<title>expert_0_1</title>
<polygon fill="lightblue" stroke="black" points="373,-1951 245,-1951 245,-1899 373,-1899 373,-1951"/>
<text text-anchor="middle" x="309" y="-1939" font-family="Arial" font-size="10.00">Expert 0</text>
<text text-anchor="middle" x="309" y="-1928" font-family="Arial" font-size="10.00">GPU: 0&#45;1</text>
<text text-anchor="middle" x="309" y="-1917" font-family="Arial" font-size="10.00">Input: [128, 1024, 16]</text>
<text text-anchor="middle" x="309" y="-1906" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
</g>
<!-- expert_agg_1 -->
<g id="node29" class="node">
<title>expert_agg_1</title>
<polygon fill="yellow" stroke="black" points="721.44,-1853 486.9,-1853 426.56,-1749 661.1,-1749 721.44,-1853"/>
<text text-anchor="middle" x="574" y="-1815" font-family="Arial" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="574" y="-1804" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-1793" font-family="Arial" font-size="10.00">Input: [128, 1024, 2048] x 64</text>
<text text-anchor="middle" x="574" y="-1782" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- expert_0_1&#45;&gt;expert_agg_1 -->
<g id="edge16" class="edge">
<title>expert_0_1&#45;&gt;expert_agg_1</title>
<path fill="none" stroke="black" d="M363.59,-1898.87C394.94,-1884.43 435.33,-1865.84 472.32,-1848.81"/>
<polygon fill="black" stroke="black" points="474.03,-1851.88 481.65,-1844.52 471.1,-1845.52 474.03,-1851.88"/>
<text text-anchor="middle" x="448" y="-1873.8" font-family="Arial" font-size="9.00">Expert 0 output</text>
</g>
<!-- expert_compute_0_0_1 -->
<g id="node11" class="node">
<title>expert_compute_0_0_1</title>
<polygon fill="lightblue" stroke="black" points="144,-2150.54 16,-2150.54 16,-2098.54 144,-2098.54 144,-2150.54"/>
<text text-anchor="middle" x="80" y="-2138.54" font-family="Arial" font-size="10.00">Expert Compute Part 0</text>
<text text-anchor="middle" x="80" y="-2127.54" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="80" y="-2116.54" font-family="Arial" font-size="10.00">Input: [128, 1024, 8]</text>
<text text-anchor="middle" x="80" y="-2105.54" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- tp_split_0_1&#45;&gt;expert_compute_0_0_1 -->
<g id="edge11" class="edge">
<title>tp_split_0_1&#45;&gt;expert_compute_0_0_1</title>
<path fill="none" stroke="black" d="M181.8,-2193.71C164.2,-2181.92 143.94,-2168.36 126.15,-2156.45"/>
<polygon fill="black" stroke="black" points="127.9,-2153.4 117.64,-2150.75 124,-2159.22 127.9,-2153.4"/>
</g>
<!-- expert_compute_1_0_1 -->
<g id="node12" class="node">
<title>expert_compute_1_0_1</title>
<polygon fill="lightblue" stroke="black" points="290,-2150.54 162,-2150.54 162,-2098.54 290,-2098.54 290,-2150.54"/>
<text text-anchor="middle" x="226" y="-2138.54" font-family="Arial" font-size="10.00">Expert Compute Part 1</text>
<text text-anchor="middle" x="226" y="-2127.54" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="226" y="-2116.54" font-family="Arial" font-size="10.00">Input: [128, 1024, 8]</text>
<text text-anchor="middle" x="226" y="-2105.54" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- tp_split_0_1&#45;&gt;expert_compute_1_0_1 -->
<g id="edge12" class="edge">
<title>tp_split_0_1&#45;&gt;expert_compute_1_0_1</title>
<path fill="none" stroke="black" d="M226,-2187.46C226,-2178.78 226,-2169.51 226,-2160.85"/>
<polygon fill="black" stroke="black" points="229.5,-2160.69 226,-2150.69 222.5,-2160.69 229.5,-2160.69"/>
</g>
<!-- tp_allreduce_0_1 -->
<g id="node13" class="node">
<title>tp_allreduce_0_1</title>
<ellipse fill="lightgreen" stroke="black" cx="226" cy="-2024.77" rx="90.52" ry="36.54"/>
<text text-anchor="middle" x="226" y="-2038.77" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="226" y="-2027.77" font-family="Arial" font-size="10.00">GPU: 0&#45;1</text>
<text text-anchor="middle" x="226" y="-2016.77" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="226" y="-2005.77" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
</g>
<!-- expert_compute_0_0_1&#45;&gt;tp_allreduce_0_1 -->
<g id="edge13" class="edge">
<title>expert_compute_0_0_1&#45;&gt;tp_allreduce_0_1</title>
<path fill="none" stroke="black" d="M117.6,-2098.36C133.94,-2087.42 153.39,-2074.39 171.29,-2062.41"/>
<polygon fill="black" stroke="black" points="173.56,-2065.1 179.92,-2056.63 169.67,-2059.28 173.56,-2065.1"/>
</g>
<!-- expert_compute_1_0_1&#45;&gt;tp_allreduce_0_1 -->
<g id="edge14" class="edge">
<title>expert_compute_1_0_1&#45;&gt;tp_allreduce_0_1</title>
<path fill="none" stroke="black" d="M226,-2098.36C226,-2090.22 226,-2080.93 226,-2071.76"/>
<polygon fill="black" stroke="black" points="229.5,-2071.55 226,-2061.55 222.5,-2071.55 229.5,-2071.55"/>
</g>
<!-- tp_allreduce_0_1&#45;&gt;expert_0_1 -->
<g id="edge15" class="edge">
<title>tp_allreduce_0_1&#45;&gt;expert_0_1</title>
<path fill="none" stroke="black" d="M254.8,-1989.85C263.29,-1979.84 272.58,-1968.9 281.02,-1958.96"/>
<polygon fill="black" stroke="black" points="283.78,-1961.12 287.58,-1951.23 278.44,-1956.59 283.78,-1961.12"/>
</g>
<!-- expert_1_1 -->
<g id="node14" class="node">
<title>expert_1_1</title>
<polygon fill="lightblue" stroke="black" points="578,-1951 450,-1951 450,-1899 578,-1899 578,-1951"/>
<text text-anchor="middle" x="514" y="-1939" font-family="Arial" font-size="10.00">Expert 1</text>
<text text-anchor="middle" x="514" y="-1928" font-family="Arial" font-size="10.00">GPU: 2&#45;3</text>
<text text-anchor="middle" x="514" y="-1917" font-family="Arial" font-size="10.00">Input: [128, 1024, 16]</text>
<text text-anchor="middle" x="514" y="-1906" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
</g>
<!-- expert_1_1&#45;&gt;expert_agg_1 -->
<g id="edge23" class="edge">
<title>expert_1_1&#45;&gt;expert_agg_1</title>
<path fill="none" stroke="black" d="M526.43,-1898.72C531.62,-1888.16 537.9,-1875.4 544.17,-1862.66"/>
<polygon fill="black" stroke="black" points="547.44,-1863.93 548.71,-1853.41 541.16,-1860.84 547.44,-1863.93"/>
<text text-anchor="middle" x="569" y="-1873.8" font-family="Arial" font-size="9.00">Expert 1 output</text>
</g>
<!-- expert_compute_0_1_1 -->
<g id="node16" class="node">
<title>expert_compute_0_1_1</title>
<polygon fill="lightblue" stroke="black" points="436,-2150.54 308,-2150.54 308,-2098.54 436,-2098.54 436,-2150.54"/>
<text text-anchor="middle" x="372" y="-2138.54" font-family="Arial" font-size="10.00">Expert Compute Part 0</text>
<text text-anchor="middle" x="372" y="-2127.54" font-family="Arial" font-size="10.00">GPU: 2</text>
<text text-anchor="middle" x="372" y="-2116.54" font-family="Arial" font-size="10.00">Input: [128, 1024, 8]</text>
<text text-anchor="middle" x="372" y="-2105.54" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- tp_split_1_1&#45;&gt;expert_compute_0_1_1 -->
<g id="edge18" class="edge">
<title>tp_split_1_1&#45;&gt;expert_compute_0_1_1</title>
<path fill="none" stroke="black" d="M467.47,-2193.18C451.15,-2181.61 432.5,-2168.4 416.04,-2156.74"/>
<polygon fill="black" stroke="black" points="417.84,-2153.73 407.66,-2150.8 413.79,-2159.44 417.84,-2153.73"/>
</g>
<!-- expert_compute_1_1_1 -->
<g id="node17" class="node">
<title>expert_compute_1_1_1</title>
<polygon fill="lightblue" stroke="black" points="582,-2150.54 454,-2150.54 454,-2098.54 582,-2098.54 582,-2150.54"/>
<text text-anchor="middle" x="518" y="-2138.54" font-family="Arial" font-size="10.00">Expert Compute Part 1</text>
<text text-anchor="middle" x="518" y="-2127.54" font-family="Arial" font-size="10.00">GPU: 3</text>
<text text-anchor="middle" x="518" y="-2116.54" font-family="Arial" font-size="10.00">Input: [128, 1024, 8]</text>
<text text-anchor="middle" x="518" y="-2105.54" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- tp_split_1_1&#45;&gt;expert_compute_1_1_1 -->
<g id="edge19" class="edge">
<title>tp_split_1_1&#45;&gt;expert_compute_1_1_1</title>
<path fill="none" stroke="black" d="M512.93,-2187.46C513.64,-2178.78 514.4,-2169.51 515.11,-2160.85"/>
<polygon fill="black" stroke="black" points="518.62,-2160.94 515.94,-2150.69 511.64,-2160.37 518.62,-2160.94"/>
</g>
<!-- tp_allreduce_1_1 -->
<g id="node18" class="node">
<title>tp_allreduce_1_1</title>
<ellipse fill="lightgreen" stroke="black" cx="485" cy="-2024.77" rx="90.52" ry="36.54"/>
<text text-anchor="middle" x="485" y="-2038.77" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="485" y="-2027.77" font-family="Arial" font-size="10.00">GPU: 2&#45;3</text>
<text text-anchor="middle" x="485" y="-2016.77" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="485" y="-2005.77" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
</g>
<!-- expert_compute_0_1_1&#45;&gt;tp_allreduce_1_1 -->
<g id="edge20" class="edge">
<title>expert_compute_0_1_1&#45;&gt;tp_allreduce_1_1</title>
<path fill="none" stroke="black" d="M401.1,-2098.36C412.91,-2088.14 426.82,-2076.11 439.89,-2064.8"/>
<polygon fill="black" stroke="black" points="442.19,-2067.44 447.46,-2058.25 437.61,-2062.15 442.19,-2067.44"/>
</g>
<!-- expert_compute_1_1_1&#45;&gt;tp_allreduce_1_1 -->
<g id="edge21" class="edge">
<title>expert_compute_1_1_1&#45;&gt;tp_allreduce_1_1</title>
<path fill="none" stroke="black" d="M509.5,-2098.36C506.7,-2090.05 503.48,-2080.52 500.33,-2071.17"/>
<polygon fill="black" stroke="black" points="503.59,-2069.9 497.08,-2061.55 496.96,-2072.14 503.59,-2069.9"/>
</g>
<!-- tp_allreduce_1_1&#45;&gt;expert_1_1 -->
<g id="edge22" class="edge">
<title>tp_allreduce_1_1&#45;&gt;expert_1_1</title>
<path fill="none" stroke="black" d="M495.55,-1988.2C498.19,-1979.31 501.01,-1969.79 503.64,-1960.93"/>
<polygon fill="black" stroke="black" points="507.01,-1961.87 506.5,-1951.29 500.3,-1959.88 507.01,-1961.87"/>
</g>
<!-- expert_2_1 -->
<g id="node19" class="node">
<title>expert_2_1</title>
<polygon fill="lightblue" stroke="black" points="737,-1951 609,-1951 609,-1899 737,-1899 737,-1951"/>
<text text-anchor="middle" x="673" y="-1939" font-family="Arial" font-size="10.00">Expert 2</text>
<text text-anchor="middle" x="673" y="-1928" font-family="Arial" font-size="10.00">GPU: 4&#45;5</text>
<text text-anchor="middle" x="673" y="-1917" font-family="Arial" font-size="10.00">Input: [128, 1024, 16]</text>
<text text-anchor="middle" x="673" y="-1906" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
</g>
<!-- expert_2_1&#45;&gt;expert_agg_1 -->
<g id="edge30" class="edge">
<title>expert_2_1&#45;&gt;expert_agg_1</title>
<path fill="none" stroke="black" d="M652.49,-1898.72C643.67,-1887.86 632.96,-1874.65 622.32,-1861.54"/>
<polygon fill="black" stroke="black" points="624.74,-1858.97 615.72,-1853.41 619.3,-1863.38 624.74,-1858.97"/>
<text text-anchor="middle" x="666" y="-1873.8" font-family="Arial" font-size="9.00">Expert 2 output</text>
</g>
<!-- expert_compute_0_2_1 -->
<g id="node21" class="node">
<title>expert_compute_0_2_1</title>
<polygon fill="lightblue" stroke="black" points="728,-2150.54 600,-2150.54 600,-2098.54 728,-2098.54 728,-2150.54"/>
<text text-anchor="middle" x="664" y="-2138.54" font-family="Arial" font-size="10.00">Expert Compute Part 0</text>
<text text-anchor="middle" x="664" y="-2127.54" font-family="Arial" font-size="10.00">GPU: 4</text>
<text text-anchor="middle" x="664" y="-2116.54" font-family="Arial" font-size="10.00">Input: [128, 1024, 8]</text>
<text text-anchor="middle" x="664" y="-2105.54" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- tp_split_2_1&#45;&gt;expert_compute_0_2_1 -->
<g id="edge25" class="edge">
<title>tp_split_2_1&#45;&gt;expert_compute_0_2_1</title>
<path fill="none" stroke="black" d="M677.93,-2187.46C675.96,-2178.68 673.85,-2169.31 671.88,-2160.57"/>
<polygon fill="black" stroke="black" points="675.27,-2159.67 669.66,-2150.69 668.44,-2161.21 675.27,-2159.67"/>
</g>
<!-- expert_compute_1_2_1 -->
<g id="node22" class="node">
<title>expert_compute_1_2_1</title>
<polygon fill="lightblue" stroke="black" points="874,-2150.54 746,-2150.54 746,-2098.54 874,-2098.54 874,-2150.54"/>
<text text-anchor="middle" x="810" y="-2138.54" font-family="Arial" font-size="10.00">Expert Compute Part 1</text>
<text text-anchor="middle" x="810" y="-2127.54" font-family="Arial" font-size="10.00">GPU: 5</text>
<text text-anchor="middle" x="810" y="-2116.54" font-family="Arial" font-size="10.00">Input: [128, 1024, 8]</text>
<text text-anchor="middle" x="810" y="-2105.54" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- tp_split_2_1&#45;&gt;expert_compute_1_2_1 -->
<g id="edge26" class="edge">
<title>tp_split_2_1&#45;&gt;expert_compute_1_2_1</title>
<path fill="none" stroke="black" d="M725.58,-2192.1C739.8,-2180.89 755.83,-2168.25 770.08,-2157.01"/>
<polygon fill="black" stroke="black" points="772.55,-2159.52 778.24,-2150.58 768.22,-2154.03 772.55,-2159.52"/>
</g>
<!-- tp_allreduce_2_1 -->
<g id="node23" class="node">
<title>tp_allreduce_2_1</title>
<ellipse fill="lightgreen" stroke="black" cx="684" cy="-2024.77" rx="90.52" ry="36.54"/>
<text text-anchor="middle" x="684" y="-2038.77" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="684" y="-2027.77" font-family="Arial" font-size="10.00">GPU: 4&#45;5</text>
<text text-anchor="middle" x="684" y="-2016.77" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="684" y="-2005.77" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
</g>
<!-- expert_compute_0_2_1&#45;&gt;tp_allreduce_2_1 -->
<g id="edge27" class="edge">
<title>expert_compute_0_2_1&#45;&gt;tp_allreduce_2_1</title>
<path fill="none" stroke="black" d="M669.15,-2098.36C670.83,-2090.13 672.76,-2080.73 674.65,-2071.47"/>
<polygon fill="black" stroke="black" points="678.11,-2072.05 676.68,-2061.55 671.25,-2070.64 678.11,-2072.05"/>
</g>
<!-- expert_compute_1_2_1&#45;&gt;tp_allreduce_2_1 -->
<g id="edge28" class="edge">
<title>expert_compute_1_2_1&#45;&gt;tp_allreduce_2_1</title>
<path fill="none" stroke="black" d="M777.55,-2098.36C764.14,-2087.95 748.29,-2075.66 733.49,-2064.17"/>
<polygon fill="black" stroke="black" points="735.44,-2061.25 725.39,-2057.89 731.15,-2066.78 735.44,-2061.25"/>
</g>
<!-- tp_allreduce_2_1&#45;&gt;expert_2_1 -->
<g id="edge29" class="edge">
<title>tp_allreduce_2_1&#45;&gt;expert_2_1</title>
<path fill="none" stroke="black" d="M679.97,-1987.92C678.99,-1979.24 677.95,-1969.97 676.97,-1961.32"/>
<polygon fill="black" stroke="black" points="680.43,-1960.69 675.83,-1951.15 673.47,-1961.47 680.43,-1960.69"/>
</g>
<!-- expert_3_1 -->
<g id="node24" class="node">
<title>expert_3_1</title>
<polygon fill="lightblue" stroke="black" points="963,-1951 835,-1951 835,-1899 963,-1899 963,-1951"/>
<text text-anchor="middle" x="899" y="-1939" font-family="Arial" font-size="10.00">Expert 3</text>
<text text-anchor="middle" x="899" y="-1928" font-family="Arial" font-size="10.00">GPU: 6&#45;7</text>
<text text-anchor="middle" x="899" y="-1917" font-family="Arial" font-size="10.00">Input: [128, 1024, 16]</text>
<text text-anchor="middle" x="899" y="-1906" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
</g>
<!-- expert_3_1&#45;&gt;expert_agg_1 -->
<g id="edge37" class="edge">
<title>expert_3_1&#45;&gt;expert_agg_1</title>
<path fill="none" stroke="black" d="M834.79,-1899.9C801.67,-1887.46 759.82,-1871.75 719.39,-1856.58"/>
<polygon fill="black" stroke="black" points="720.57,-1853.28 709.98,-1853.04 718.11,-1859.84 720.57,-1853.28"/>
<text text-anchor="middle" x="806" y="-1873.8" font-family="Arial" font-size="9.00">Expert 3 output</text>
</g>
<!-- expert_compute_0_3_1 -->
<g id="node26" class="node">
<title>expert_compute_0_3_1</title>
<polygon fill="lightblue" stroke="black" points="1020,-2150.54 892,-2150.54 892,-2098.54 1020,-2098.54 1020,-2150.54"/>
<text text-anchor="middle" x="956" y="-2138.54" font-family="Arial" font-size="10.00">Expert Compute Part 0</text>
<text text-anchor="middle" x="956" y="-2127.54" font-family="Arial" font-size="10.00">GPU: 6</text>
<text text-anchor="middle" x="956" y="-2116.54" font-family="Arial" font-size="10.00">Input: [128, 1024, 8]</text>
<text text-anchor="middle" x="956" y="-2105.54" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- tp_split_3_1&#45;&gt;expert_compute_0_3_1 -->
<g id="edge32" class="edge">
<title>tp_split_3_1&#45;&gt;expert_compute_0_3_1</title>
<path fill="none" stroke="black" d="M956,-2187.46C956,-2178.78 956,-2169.51 956,-2160.85"/>
<polygon fill="black" stroke="black" points="959.5,-2160.69 956,-2150.69 952.5,-2160.69 959.5,-2160.69"/>
</g>
<!-- expert_compute_1_3_1 -->
<g id="node27" class="node">
<title>expert_compute_1_3_1</title>
<polygon fill="lightblue" stroke="black" points="1166,-2150.54 1038,-2150.54 1038,-2098.54 1166,-2098.54 1166,-2150.54"/>
<text text-anchor="middle" x="1102" y="-2138.54" font-family="Arial" font-size="10.00">Expert Compute Part 1</text>
<text text-anchor="middle" x="1102" y="-2127.54" font-family="Arial" font-size="10.00">GPU: 7</text>
<text text-anchor="middle" x="1102" y="-2116.54" font-family="Arial" font-size="10.00">Input: [128, 1024, 8]</text>
<text text-anchor="middle" x="1102" y="-2105.54" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- tp_split_3_1&#45;&gt;expert_compute_1_3_1 -->
<g id="edge33" class="edge">
<title>tp_split_3_1&#45;&gt;expert_compute_1_3_1</title>
<path fill="none" stroke="black" d="M1000.2,-2193.71C1017.8,-2181.92 1038.06,-2168.36 1055.85,-2156.45"/>
<polygon fill="black" stroke="black" points="1058,-2159.22 1064.36,-2150.75 1054.1,-2153.4 1058,-2159.22"/>
</g>
<!-- tp_allreduce_3_1 -->
<g id="node28" class="node">
<title>tp_allreduce_3_1</title>
<ellipse fill="lightgreen" stroke="black" cx="956" cy="-2024.77" rx="90.52" ry="36.54"/>
<text text-anchor="middle" x="956" y="-2038.77" font-family="Arial" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="956" y="-2027.77" font-family="Arial" font-size="10.00">GPU: 6&#45;7</text>
<text text-anchor="middle" x="956" y="-2016.77" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="956" y="-2005.77" font-family="Arial" font-size="10.00">Output: [128, 1024, 2048]</text>
</g>
<!-- expert_compute_0_3_1&#45;&gt;tp_allreduce_3_1 -->
<g id="edge34" class="edge">
<title>expert_compute_0_3_1&#45;&gt;tp_allreduce_3_1</title>
<path fill="none" stroke="black" d="M956,-2098.36C956,-2090.22 956,-2080.93 956,-2071.76"/>
<polygon fill="black" stroke="black" points="959.5,-2071.55 956,-2061.55 952.5,-2071.55 959.5,-2071.55"/>
</g>
<!-- expert_compute_1_3_1&#45;&gt;tp_allreduce_3_1 -->
<g id="edge35" class="edge">
<title>expert_compute_1_3_1&#45;&gt;tp_allreduce_3_1</title>
<path fill="none" stroke="black" d="M1064.4,-2098.36C1048.06,-2087.42 1028.61,-2074.39 1010.71,-2062.41"/>
<polygon fill="black" stroke="black" points="1012.33,-2059.28 1002.08,-2056.63 1008.44,-2065.1 1012.33,-2059.28"/>
</g>
<!-- tp_allreduce_3_1&#45;&gt;expert_3_1 -->
<g id="edge36" class="edge">
<title>tp_allreduce_3_1&#45;&gt;expert_3_1</title>
<path fill="none" stroke="black" d="M935.58,-1988.75C930.11,-1979.36 924.21,-1969.24 918.77,-1959.91"/>
<polygon fill="black" stroke="black" points="921.79,-1958.15 913.73,-1951.27 915.75,-1961.67 921.79,-1958.15"/>
</g>
<!-- layer_norm_1 -->
<g id="node30" class="node">
<title>layer_norm_1</title>
<polygon fill="lightblue" stroke="black" points="638,-1712 510,-1712 510,-1660 638,-1660 638,-1712"/>
<text text-anchor="middle" x="574" y="-1700" font-family="Arial" font-size="10.00">Layer Norm</text>
<text text-anchor="middle" x="574" y="-1689" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-1678" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-1667" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- expert_agg_1&#45;&gt;layer_norm_1 -->
<g id="edge38" class="edge">
<title>expert_agg_1&#45;&gt;layer_norm_1</title>
<path fill="none" stroke="black" d="M574,-1748.79C574,-1739.84 574,-1730.71 574,-1722.31"/>
<polygon fill="black" stroke="black" points="577.5,-1722.13 574,-1712.13 570.5,-1722.13 577.5,-1722.13"/>
</g>
<!-- layer_2 -->
<g id="node31" class="node">
<title>layer_2</title>
<polygon fill="lightblue" stroke="black" points="638.5,-1602 509.5,-1602 509.5,-1550 638.5,-1550 638.5,-1602"/>
<text text-anchor="middle" x="574" y="-1590" font-family="Arial" font-size="10.00">Layer 2 (Attention + MoE)</text>
<text text-anchor="middle" x="574" y="-1579" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-1568" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-1557" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- layer_norm_1&#45;&gt;layer_2 -->
<g id="edge39" class="edge">
<title>layer_norm_1&#45;&gt;layer_2</title>
<path fill="none" stroke="black" d="M574,-1659.95C574,-1645.88 574,-1628.08 574,-1612.58"/>
<polygon fill="black" stroke="black" points="577.5,-1612.29 574,-1602.29 570.5,-1612.29 577.5,-1612.29"/>
</g>
<!-- layer_3 -->
<g id="node32" class="node">
<title>layer_3</title>
<polygon fill="lightblue" stroke="black" points="638.5,-1513 509.5,-1513 509.5,-1461 638.5,-1461 638.5,-1513"/>
<text text-anchor="middle" x="574" y="-1501" font-family="Arial" font-size="10.00">Layer 3 (Attention + MoE)</text>
<text text-anchor="middle" x="574" y="-1490" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-1479" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-1468" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- layer_2&#45;&gt;layer_3 -->
<g id="edge40" class="edge">
<title>layer_2&#45;&gt;layer_3</title>
<path fill="none" stroke="black" d="M574,-1549.84C574,-1541.54 574,-1532.15 574,-1523.25"/>
<polygon fill="black" stroke="black" points="577.5,-1523.11 574,-1513.11 570.5,-1523.11 577.5,-1523.11"/>
</g>
<!-- layer_4 -->
<g id="node33" class="node">
<title>layer_4</title>
<polygon fill="lightblue" stroke="black" points="638.5,-1424 509.5,-1424 509.5,-1372 638.5,-1372 638.5,-1424"/>
<text text-anchor="middle" x="574" y="-1412" font-family="Arial" font-size="10.00">Layer 4 (Attention + MoE)</text>
<text text-anchor="middle" x="574" y="-1401" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-1390" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-1379" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- layer_3&#45;&gt;layer_4 -->
<g id="edge41" class="edge">
<title>layer_3&#45;&gt;layer_4</title>
<path fill="none" stroke="black" d="M574,-1460.84C574,-1452.54 574,-1443.15 574,-1434.25"/>
<polygon fill="black" stroke="black" points="577.5,-1434.11 574,-1424.11 570.5,-1434.11 577.5,-1434.11"/>
</g>
<!-- layer_5 -->
<g id="node34" class="node">
<title>layer_5</title>
<polygon fill="lightblue" stroke="black" points="638.5,-1335 509.5,-1335 509.5,-1283 638.5,-1283 638.5,-1335"/>
<text text-anchor="middle" x="574" y="-1323" font-family="Arial" font-size="10.00">Layer 5 (Attention + MoE)</text>
<text text-anchor="middle" x="574" y="-1312" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-1301" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-1290" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- layer_4&#45;&gt;layer_5 -->
<g id="edge42" class="edge">
<title>layer_4&#45;&gt;layer_5</title>
<path fill="none" stroke="black" d="M574,-1371.84C574,-1363.54 574,-1354.15 574,-1345.25"/>
<polygon fill="black" stroke="black" points="577.5,-1345.11 574,-1335.11 570.5,-1345.11 577.5,-1345.11"/>
</g>
<!-- layer_6 -->
<g id="node35" class="node">
<title>layer_6</title>
<polygon fill="lightblue" stroke="black" points="638.5,-1246 509.5,-1246 509.5,-1194 638.5,-1194 638.5,-1246"/>
<text text-anchor="middle" x="574" y="-1234" font-family="Arial" font-size="10.00">Layer 6 (Attention + MoE)</text>
<text text-anchor="middle" x="574" y="-1223" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-1212" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-1201" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- layer_5&#45;&gt;layer_6 -->
<g id="edge43" class="edge">
<title>layer_5&#45;&gt;layer_6</title>
<path fill="none" stroke="black" d="M574,-1282.84C574,-1274.54 574,-1265.15 574,-1256.25"/>
<polygon fill="black" stroke="black" points="577.5,-1256.11 574,-1246.11 570.5,-1256.11 577.5,-1256.11"/>
</g>
<!-- layer_7 -->
<g id="node36" class="node">
<title>layer_7</title>
<polygon fill="lightblue" stroke="black" points="638.5,-1157 509.5,-1157 509.5,-1105 638.5,-1105 638.5,-1157"/>
<text text-anchor="middle" x="574" y="-1145" font-family="Arial" font-size="10.00">Layer 7 (Attention + MoE)</text>
<text text-anchor="middle" x="574" y="-1134" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-1123" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-1112" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- layer_6&#45;&gt;layer_7 -->
<g id="edge44" class="edge">
<title>layer_6&#45;&gt;layer_7</title>
<path fill="none" stroke="black" d="M574,-1193.84C574,-1185.54 574,-1176.15 574,-1167.25"/>
<polygon fill="black" stroke="black" points="577.5,-1167.11 574,-1157.11 570.5,-1167.11 577.5,-1167.11"/>
</g>
<!-- layer_8 -->
<g id="node37" class="node">
<title>layer_8</title>
<polygon fill="lightblue" stroke="black" points="638.5,-1068 509.5,-1068 509.5,-1016 638.5,-1016 638.5,-1068"/>
<text text-anchor="middle" x="574" y="-1056" font-family="Arial" font-size="10.00">Layer 8 (Attention + MoE)</text>
<text text-anchor="middle" x="574" y="-1045" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-1034" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-1023" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- layer_7&#45;&gt;layer_8 -->
<g id="edge45" class="edge">
<title>layer_7&#45;&gt;layer_8</title>
<path fill="none" stroke="black" d="M574,-1104.84C574,-1096.54 574,-1087.15 574,-1078.25"/>
<polygon fill="black" stroke="black" points="577.5,-1078.11 574,-1068.11 570.5,-1078.11 577.5,-1078.11"/>
</g>
<!-- layer_9 -->
<g id="node38" class="node">
<title>layer_9</title>
<polygon fill="lightblue" stroke="black" points="638.5,-979 509.5,-979 509.5,-927 638.5,-927 638.5,-979"/>
<text text-anchor="middle" x="574" y="-967" font-family="Arial" font-size="10.00">Layer 9 (Attention + MoE)</text>
<text text-anchor="middle" x="574" y="-956" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-945" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-934" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- layer_8&#45;&gt;layer_9 -->
<g id="edge46" class="edge">
<title>layer_8&#45;&gt;layer_9</title>
<path fill="none" stroke="black" d="M574,-1015.84C574,-1007.54 574,-998.15 574,-989.25"/>
<polygon fill="black" stroke="black" points="577.5,-989.11 574,-979.11 570.5,-989.11 577.5,-989.11"/>
</g>
<!-- layer_10 -->
<g id="node39" class="node">
<title>layer_10</title>
<polygon fill="lightblue" stroke="black" points="641,-890 507,-890 507,-838 641,-838 641,-890"/>
<text text-anchor="middle" x="574" y="-878" font-family="Arial" font-size="10.00">Layer 10 (Attention + MoE)</text>
<text text-anchor="middle" x="574" y="-867" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-856" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-845" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- layer_9&#45;&gt;layer_10 -->
<g id="edge47" class="edge">
<title>layer_9&#45;&gt;layer_10</title>
<path fill="none" stroke="black" d="M574,-926.84C574,-918.54 574,-909.15 574,-900.25"/>
<polygon fill="black" stroke="black" points="577.5,-900.11 574,-890.11 570.5,-900.11 577.5,-900.11"/>
</g>
<!-- layer_11 -->
<g id="node40" class="node">
<title>layer_11</title>
<polygon fill="lightblue" stroke="black" points="641,-801 507,-801 507,-749 641,-749 641,-801"/>
<text text-anchor="middle" x="574" y="-789" font-family="Arial" font-size="10.00">Layer 11 (Attention + MoE)</text>
<text text-anchor="middle" x="574" y="-778" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-767" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-756" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- layer_10&#45;&gt;layer_11 -->
<g id="edge48" class="edge">
<title>layer_10&#45;&gt;layer_11</title>
<path fill="none" stroke="black" d="M574,-837.84C574,-829.54 574,-820.15 574,-811.25"/>
<polygon fill="black" stroke="black" points="577.5,-811.11 574,-801.11 570.5,-811.11 577.5,-811.11"/>
</g>
<!-- layer_12 -->
<g id="node41" class="node">
<title>layer_12</title>
<polygon fill="lightblue" stroke="black" points="641,-712 507,-712 507,-660 641,-660 641,-712"/>
<text text-anchor="middle" x="574" y="-700" font-family="Arial" font-size="10.00">Layer 12 (Attention + MoE)</text>
<text text-anchor="middle" x="574" y="-689" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-678" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-667" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- layer_11&#45;&gt;layer_12 -->
<g id="edge49" class="edge">
<title>layer_11&#45;&gt;layer_12</title>
<path fill="none" stroke="black" d="M574,-748.84C574,-740.54 574,-731.15 574,-722.25"/>
<polygon fill="black" stroke="black" points="577.5,-722.11 574,-712.11 570.5,-722.11 577.5,-722.11"/>
</g>
<!-- layer_13 -->
<g id="node42" class="node">
<title>layer_13</title>
<polygon fill="lightblue" stroke="black" points="641,-623 507,-623 507,-571 641,-571 641,-623"/>
<text text-anchor="middle" x="574" y="-611" font-family="Arial" font-size="10.00">Layer 13 (Attention + MoE)</text>
<text text-anchor="middle" x="574" y="-600" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-589" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-578" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- layer_12&#45;&gt;layer_13 -->
<g id="edge50" class="edge">
<title>layer_12&#45;&gt;layer_13</title>
<path fill="none" stroke="black" d="M574,-659.84C574,-651.54 574,-642.15 574,-633.25"/>
<polygon fill="black" stroke="black" points="577.5,-633.11 574,-623.11 570.5,-633.11 577.5,-633.11"/>
</g>
<!-- layer_14 -->
<g id="node43" class="node">
<title>layer_14</title>
<polygon fill="lightblue" stroke="black" points="641,-534 507,-534 507,-482 641,-482 641,-534"/>
<text text-anchor="middle" x="574" y="-522" font-family="Arial" font-size="10.00">Layer 14 (Attention + MoE)</text>
<text text-anchor="middle" x="574" y="-511" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-500" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-489" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- layer_13&#45;&gt;layer_14 -->
<g id="edge51" class="edge">
<title>layer_13&#45;&gt;layer_14</title>
<path fill="none" stroke="black" d="M574,-570.84C574,-562.54 574,-553.15 574,-544.25"/>
<polygon fill="black" stroke="black" points="577.5,-544.11 574,-534.11 570.5,-544.11 577.5,-544.11"/>
</g>
<!-- layer_15 -->
<g id="node44" class="node">
<title>layer_15</title>
<polygon fill="lightblue" stroke="black" points="641,-445 507,-445 507,-393 641,-393 641,-445"/>
<text text-anchor="middle" x="574" y="-433" font-family="Arial" font-size="10.00">Layer 15 (Attention + MoE)</text>
<text text-anchor="middle" x="574" y="-422" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-411" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-400" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- layer_14&#45;&gt;layer_15 -->
<g id="edge52" class="edge">
<title>layer_14&#45;&gt;layer_15</title>
<path fill="none" stroke="black" d="M574,-481.84C574,-473.54 574,-464.15 574,-455.25"/>
<polygon fill="black" stroke="black" points="577.5,-455.11 574,-445.11 570.5,-455.11 577.5,-455.11"/>
</g>
<!-- layer_16 -->
<g id="node45" class="node">
<title>layer_16</title>
<polygon fill="lightblue" stroke="black" points="641,-356 507,-356 507,-304 641,-304 641,-356"/>
<text text-anchor="middle" x="574" y="-344" font-family="Arial" font-size="10.00">Layer 16 (Attention + MoE)</text>
<text text-anchor="middle" x="574" y="-333" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-322" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-311" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- layer_15&#45;&gt;layer_16 -->
<g id="edge53" class="edge">
<title>layer_15&#45;&gt;layer_16</title>
<path fill="none" stroke="black" d="M574,-392.84C574,-384.54 574,-375.15 574,-366.25"/>
<polygon fill="black" stroke="black" points="577.5,-366.11 574,-356.11 570.5,-366.11 577.5,-366.11"/>
</g>
<!-- output_norm -->
<g id="node46" class="node">
<title>output_norm</title>
<polygon fill="lightblue" stroke="black" points="638,-246 510,-246 510,-194 638,-194 638,-246"/>
<text text-anchor="middle" x="574" y="-234" font-family="Arial" font-size="10.00">Final Layer Norm</text>
<text text-anchor="middle" x="574" y="-223" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-212" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-201" font-family="Arial" font-size="10.00">Output: [128, 1024, 1024]</text>
</g>
<!-- layer_16&#45;&gt;output_norm -->
<g id="edge54" class="edge">
<title>layer_16&#45;&gt;output_norm</title>
<path fill="none" stroke="black" d="M574,-303.95C574,-289.88 574,-272.08 574,-256.58"/>
<polygon fill="black" stroke="black" points="577.5,-256.29 574,-246.29 570.5,-256.29 577.5,-256.29"/>
</g>
<!-- output_proj -->
<g id="node47" class="node">
<title>output_proj</title>
<polygon fill="lightblue" stroke="black" points="652,-157 496,-157 496,-105 652,-105 652,-157"/>
<text text-anchor="middle" x="574" y="-145" font-family="Arial" font-size="10.00">Output Projection</text>
<text text-anchor="middle" x="574" y="-134" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-123" font-family="Arial" font-size="10.00">Input: [128, 1024, 1024]</text>
<text text-anchor="middle" x="574" y="-112" font-family="Arial" font-size="10.00">Output: [128, 1024, vocab_size]</text>
</g>
<!-- output_norm&#45;&gt;output_proj -->
<g id="edge55" class="edge">
<title>output_norm&#45;&gt;output_proj</title>
<path fill="none" stroke="black" d="M574,-193.84C574,-185.54 574,-176.15 574,-167.25"/>
<polygon fill="black" stroke="black" points="577.5,-167.11 574,-157.11 570.5,-167.11 577.5,-167.11"/>
</g>
<!-- output -->
<g id="node48" class="node">
<title>output</title>
<polygon fill="lightcoral" stroke="black" points="648.5,-68 499.5,-68 499.5,-16 648.5,-16 648.5,-68"/>
<text text-anchor="middle" x="574" y="-56" font-family="Arial" font-size="10.00">Output Tokens</text>
<text text-anchor="middle" x="574" y="-45" font-family="Arial" font-size="10.00">GPU: All 128 GPUs</text>
<text text-anchor="middle" x="574" y="-34" font-family="Arial" font-size="10.00">Input: [128, 1024, vocab_size]</text>
<text text-anchor="middle" x="574" y="-23" font-family="Arial" font-size="10.00">Output: [128, 1024]</text>
</g>
<!-- output_proj&#45;&gt;output -->
<g id="edge56" class="edge">
<title>output_proj&#45;&gt;output</title>
<path fill="none" stroke="black" d="M574,-104.84C574,-96.54 574,-87.15 574,-78.25"/>
<polygon fill="black" stroke="black" points="577.5,-78.11 574,-68.11 570.5,-78.11 577.5,-78.11"/>
</g>
</g>
</svg>
