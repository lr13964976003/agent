// Enhanced LLM Deployment DAG - EP64_TP2 with Advanced Optimizations
digraph {
	dpi=300 rankdir=TB size="80,80"
	node [fontname=Arial fontsize=11]
	node [fillcolor=lightblue shape=ellipse style=filled]
	node [fillcolor=lightgreen shape=rectangle style=filled]
	node [fillcolor=yellow shape=parallelogram style=filled]
	node [fillcolor=lightcoral shape=ellipse style=filled]
	subgraph cluster_main {
		fontname="Arial Bold" fontsize=16 label="Enhanced LLM Model Deployment - EP64_TP2 with Advanced Optimizations" style=rounded
		input [label="Model Input
[batch=128, seq=10000, d_model=4096]
Enhanced with Async Prefetch" fillcolor=lightblue shape=ellipse]
		embedding [label="Token Embedding
[128, 10000, 4096]
Optimized with Memory Pooling" fillcolor=lightgreen shape=rectangle]
		subgraph cluster_layer_0 {
			fillcolor=lightgray label="Transformer Layer 0 (Enhanced)" style=rounded
			pre_ln_0 [label="Pre-LayerNorm_0
[128, 10000, 4096]
Fused RMSNorm" fillcolor=lightgreen shape=rectangle]
			subgraph cluster_mha_0 {
				label="Multi-Head Attention (TP=2, Flash Attention v2)" style=dashed
				mha_input_0 [label="MHA_Input_0
[128, 10000, 4096]
Async Overlap" fillcolor=yellow shape=parallelogram]
				qkv_proj_0_gpu0 [label="QKV_Proj_0_GPU0
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				qkv_proj_0_gpu1 [label="QKV_Proj_0_GPU1
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				flash_attn_0_gpu0 [label="Flash_Attention_0_GPU0
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				flash_attn_0_gpu1 [label="Flash_Attention_0_GPU1
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				out_proj_0_gpu0 [label="Output_Proj_0_GPU0
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				out_proj_0_gpu1 [label="Output_Proj_0_GPU1
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				mha_merge_0 [label="MHA_Merge_0
[128, 10000, 4096]
Priority Queue" fillcolor=yellow shape=parallelogram]
			}
			add_1_0 [label="Residual_Add1_0
[128, 10000, 4096]
Fused Add" fillcolor=lightgreen shape=rectangle]
			post_ln_0 [label="Post-LayerNorm_0
[128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
			enhanced_gate_0 [label="Enhanced_Expert_Gate_0
[128, 10000, 4096]
Dynamic Load Balanced" fillcolor=yellow shape=parallelogram style=dashed]
			token_dist_local_0 [label="Token_Distribution_Local_0
NVLink Optimized" fillcolor=lightcoral shape=ellipse]
			token_dist_cross_0 [label="Token_Distribution_Cross_0
IB Optimized" fillcolor=lightcoral shape=ellipse]
			subgraph cluster_moe_enhanced_0 {
				label="Enhanced MoE (EP=64, TP=2, Hierarchical)" style=dashed
				subgraph cluster_expert_enhanced_0_0 {
					label="Expert 0 (Node 0, GPUs 0,1)" style=rounded
					expert_enhanced_0_0_gpu0 [label="Expert_0_0_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_0_0_gpu1 [label="Expert_0_0_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_0_0 [label="Expert_Merge_0_0
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_0_1 {
					label="Expert 1 (Node 0, GPUs 2,3)" style=rounded
					expert_enhanced_0_1_gpu0 [label="Expert_0_1_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_0_1_gpu1 [label="Expert_0_1_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_0_1 [label="Expert_Merge_0_1
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_0_2 {
					label="Expert 2 (Node 0, GPUs 4,5)" style=rounded
					expert_enhanced_0_2_gpu0 [label="Expert_0_2_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_0_2_gpu1 [label="Expert_0_2_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_0_2 [label="Expert_Merge_0_2
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_0_61 {
					label="Expert 61 (Node 15, GPUs 122,123)" style=rounded
					expert_enhanced_0_61_gpu0 [label="Expert_0_61_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_0_61_gpu1 [label="Expert_0_61_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_0_61 [label="Expert_Merge_0_61
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_0_62 {
					label="Expert 62 (Node 15, GPUs 124,125)" style=rounded
					expert_enhanced_0_62_gpu0 [label="Expert_0_62_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_0_62_gpu1 [label="Expert_0_62_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_0_62 [label="Expert_Merge_0_62
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_0_63 {
					label="Expert 63 (Node 15, GPUs 126,127)" style=rounded
					expert_enhanced_0_63_gpu0 [label="Expert_0_63_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_0_63_gpu1 [label="Expert_0_63_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_0_63 [label="Expert_Merge_0_63
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				expert_agg_enhanced_0 [label="Expert_Aggregation_0
[expert_outputs, 4096]→[128, 10000, 4096]
Priority" fillcolor=yellow shape=parallelogram]
			}
			add_2_enhanced_0 [label="Residual_Add2_0
[128, 10000, 4096] + [128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_layer_1 {
			fillcolor=lightgray label="Transformer Layer 1 (Enhanced)" style=rounded
			pre_ln_1 [label="Pre-LayerNorm_1
[128, 10000, 4096]
Fused RMSNorm" fillcolor=lightgreen shape=rectangle]
			subgraph cluster_mha_1 {
				label="Multi-Head Attention (TP=2, Flash Attention v2)" style=dashed
				mha_input_1 [label="MHA_Input_1
[128, 10000, 4096]
Async Overlap" fillcolor=yellow shape=parallelogram]
				qkv_proj_1_gpu0 [label="QKV_Proj_1_GPU0
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				qkv_proj_1_gpu1 [label="QKV_Proj_1_GPU1
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				flash_attn_1_gpu0 [label="Flash_Attention_1_GPU0
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				flash_attn_1_gpu1 [label="Flash_Attention_1_GPU1
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				out_proj_1_gpu0 [label="Output_Proj_1_GPU0
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				out_proj_1_gpu1 [label="Output_Proj_1_GPU1
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				mha_merge_1 [label="MHA_Merge_1
[128, 10000, 4096]
Priority Queue" fillcolor=yellow shape=parallelogram]
			}
			add_1_1 [label="Residual_Add1_1
[128, 10000, 4096]
Fused Add" fillcolor=lightgreen shape=rectangle]
			post_ln_1 [label="Post-LayerNorm_1
[128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
			enhanced_gate_1 [label="Enhanced_Expert_Gate_1
[128, 10000, 4096]
Dynamic Load Balanced" fillcolor=yellow shape=parallelogram style=dashed]
			token_dist_local_1 [label="Token_Distribution_Local_1
NVLink Optimized" fillcolor=lightcoral shape=ellipse]
			token_dist_cross_1 [label="Token_Distribution_Cross_1
IB Optimized" fillcolor=lightcoral shape=ellipse]
			subgraph cluster_moe_enhanced_1 {
				label="Enhanced MoE (EP=64, TP=2, Hierarchical)" style=dashed
				subgraph cluster_expert_enhanced_1_0 {
					label="Expert 0 (Node 0, GPUs 0,1)" style=rounded
					expert_enhanced_1_0_gpu0 [label="Expert_1_0_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_1_0_gpu1 [label="Expert_1_0_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_1_0 [label="Expert_Merge_1_0
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_1_1 {
					label="Expert 1 (Node 0, GPUs 2,3)" style=rounded
					expert_enhanced_1_1_gpu0 [label="Expert_1_1_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_1_1_gpu1 [label="Expert_1_1_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_1_1 [label="Expert_Merge_1_1
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_1_2 {
					label="Expert 2 (Node 0, GPUs 4,5)" style=rounded
					expert_enhanced_1_2_gpu0 [label="Expert_1_2_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_1_2_gpu1 [label="Expert_1_2_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_1_2 [label="Expert_Merge_1_2
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_1_61 {
					label="Expert 61 (Node 15, GPUs 122,123)" style=rounded
					expert_enhanced_1_61_gpu0 [label="Expert_1_61_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_1_61_gpu1 [label="Expert_1_61_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_1_61 [label="Expert_Merge_1_61
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_1_62 {
					label="Expert 62 (Node 15, GPUs 124,125)" style=rounded
					expert_enhanced_1_62_gpu0 [label="Expert_1_62_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_1_62_gpu1 [label="Expert_1_62_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_1_62 [label="Expert_Merge_1_62
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_1_63 {
					label="Expert 63 (Node 15, GPUs 126,127)" style=rounded
					expert_enhanced_1_63_gpu0 [label="Expert_1_63_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_1_63_gpu1 [label="Expert_1_63_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_1_63 [label="Expert_Merge_1_63
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				expert_agg_enhanced_1 [label="Expert_Aggregation_1
[expert_outputs, 4096]→[128, 10000, 4096]
Priority" fillcolor=yellow shape=parallelogram]
			}
			add_2_enhanced_1 [label="Residual_Add2_1
[128, 10000, 4096] + [128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_layer_2 {
			fillcolor=lightgray label="Transformer Layer 2 (Enhanced)" style=rounded
			pre_ln_2 [label="Pre-LayerNorm_2
[128, 10000, 4096]
Fused RMSNorm" fillcolor=lightgreen shape=rectangle]
			subgraph cluster_mha_2 {
				label="Multi-Head Attention (TP=2, Flash Attention v2)" style=dashed
				mha_input_2 [label="MHA_Input_2
[128, 10000, 4096]
Async Overlap" fillcolor=yellow shape=parallelogram]
				qkv_proj_2_gpu0 [label="QKV_Proj_2_GPU0
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				qkv_proj_2_gpu1 [label="QKV_Proj_2_GPU1
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				flash_attn_2_gpu0 [label="Flash_Attention_2_GPU0
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				flash_attn_2_gpu1 [label="Flash_Attention_2_GPU1
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				out_proj_2_gpu0 [label="Output_Proj_2_GPU0
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				out_proj_2_gpu1 [label="Output_Proj_2_GPU1
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				mha_merge_2 [label="MHA_Merge_2
[128, 10000, 4096]
Priority Queue" fillcolor=yellow shape=parallelogram]
			}
			add_1_2 [label="Residual_Add1_2
[128, 10000, 4096]
Fused Add" fillcolor=lightgreen shape=rectangle]
			post_ln_2 [label="Post-LayerNorm_2
[128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
			enhanced_gate_2 [label="Enhanced_Expert_Gate_2
[128, 10000, 4096]
Dynamic Load Balanced" fillcolor=yellow shape=parallelogram style=dashed]
			token_dist_local_2 [label="Token_Distribution_Local_2
NVLink Optimized" fillcolor=lightcoral shape=ellipse]
			token_dist_cross_2 [label="Token_Distribution_Cross_2
IB Optimized" fillcolor=lightcoral shape=ellipse]
			subgraph cluster_moe_enhanced_2 {
				label="Enhanced MoE (EP=64, TP=2, Hierarchical)" style=dashed
				subgraph cluster_expert_enhanced_2_0 {
					label="Expert 0 (Node 0, GPUs 0,1)" style=rounded
					expert_enhanced_2_0_gpu0 [label="Expert_2_0_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_2_0_gpu1 [label="Expert_2_0_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_2_0 [label="Expert_Merge_2_0
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_2_1 {
					label="Expert 1 (Node 0, GPUs 2,3)" style=rounded
					expert_enhanced_2_1_gpu0 [label="Expert_2_1_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_2_1_gpu1 [label="Expert_2_1_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_2_1 [label="Expert_Merge_2_1
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_2_2 {
					label="Expert 2 (Node 0, GPUs 4,5)" style=rounded
					expert_enhanced_2_2_gpu0 [label="Expert_2_2_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_2_2_gpu1 [label="Expert_2_2_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_2_2 [label="Expert_Merge_2_2
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_2_61 {
					label="Expert 61 (Node 15, GPUs 122,123)" style=rounded
					expert_enhanced_2_61_gpu0 [label="Expert_2_61_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_2_61_gpu1 [label="Expert_2_61_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_2_61 [label="Expert_Merge_2_61
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_2_62 {
					label="Expert 62 (Node 15, GPUs 124,125)" style=rounded
					expert_enhanced_2_62_gpu0 [label="Expert_2_62_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_2_62_gpu1 [label="Expert_2_62_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_2_62 [label="Expert_Merge_2_62
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_2_63 {
					label="Expert 63 (Node 15, GPUs 126,127)" style=rounded
					expert_enhanced_2_63_gpu0 [label="Expert_2_63_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_2_63_gpu1 [label="Expert_2_63_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_2_63 [label="Expert_Merge_2_63
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				expert_agg_enhanced_2 [label="Expert_Aggregation_2
[expert_outputs, 4096]→[128, 10000, 4096]
Priority" fillcolor=yellow shape=parallelogram]
			}
			add_2_enhanced_2 [label="Residual_Add2_2
[128, 10000, 4096] + [128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_layer_3 {
			fillcolor=lightgray label="Transformer Layer 3 (Enhanced)" style=rounded
			pre_ln_3 [label="Pre-LayerNorm_3
[128, 10000, 4096]
Fused RMSNorm" fillcolor=lightgreen shape=rectangle]
			subgraph cluster_mha_3 {
				label="Multi-Head Attention (TP=2, Flash Attention v2)" style=dashed
				mha_input_3 [label="MHA_Input_3
[128, 10000, 4096]
Async Overlap" fillcolor=yellow shape=parallelogram]
				qkv_proj_3_gpu0 [label="QKV_Proj_3_GPU0
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				qkv_proj_3_gpu1 [label="QKV_Proj_3_GPU1
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				flash_attn_3_gpu0 [label="Flash_Attention_3_GPU0
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				flash_attn_3_gpu1 [label="Flash_Attention_3_GPU1
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				out_proj_3_gpu0 [label="Output_Proj_3_GPU0
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				out_proj_3_gpu1 [label="Output_Proj_3_GPU1
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				mha_merge_3 [label="MHA_Merge_3
[128, 10000, 4096]
Priority Queue" fillcolor=yellow shape=parallelogram]
			}
			add_1_3 [label="Residual_Add1_3
[128, 10000, 4096]
Fused Add" fillcolor=lightgreen shape=rectangle]
			post_ln_3 [label="Post-LayerNorm_3
[128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
			enhanced_gate_3 [label="Enhanced_Expert_Gate_3
[128, 10000, 4096]
Dynamic Load Balanced" fillcolor=yellow shape=parallelogram style=dashed]
			token_dist_local_3 [label="Token_Distribution_Local_3
NVLink Optimized" fillcolor=lightcoral shape=ellipse]
			token_dist_cross_3 [label="Token_Distribution_Cross_3
IB Optimized" fillcolor=lightcoral shape=ellipse]
			subgraph cluster_moe_enhanced_3 {
				label="Enhanced MoE (EP=64, TP=2, Hierarchical)" style=dashed
				subgraph cluster_expert_enhanced_3_0 {
					label="Expert 0 (Node 0, GPUs 0,1)" style=rounded
					expert_enhanced_3_0_gpu0 [label="Expert_3_0_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_3_0_gpu1 [label="Expert_3_0_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_3_0 [label="Expert_Merge_3_0
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_3_1 {
					label="Expert 1 (Node 0, GPUs 2,3)" style=rounded
					expert_enhanced_3_1_gpu0 [label="Expert_3_1_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_3_1_gpu1 [label="Expert_3_1_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_3_1 [label="Expert_Merge_3_1
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_3_2 {
					label="Expert 2 (Node 0, GPUs 4,5)" style=rounded
					expert_enhanced_3_2_gpu0 [label="Expert_3_2_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_3_2_gpu1 [label="Expert_3_2_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_3_2 [label="Expert_Merge_3_2
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_3_61 {
					label="Expert 61 (Node 15, GPUs 122,123)" style=rounded
					expert_enhanced_3_61_gpu0 [label="Expert_3_61_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_3_61_gpu1 [label="Expert_3_61_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_3_61 [label="Expert_Merge_3_61
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_3_62 {
					label="Expert 62 (Node 15, GPUs 124,125)" style=rounded
					expert_enhanced_3_62_gpu0 [label="Expert_3_62_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_3_62_gpu1 [label="Expert_3_62_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_3_62 [label="Expert_Merge_3_62
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_3_63 {
					label="Expert 63 (Node 15, GPUs 126,127)" style=rounded
					expert_enhanced_3_63_gpu0 [label="Expert_3_63_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_3_63_gpu1 [label="Expert_3_63_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_3_63 [label="Expert_Merge_3_63
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				expert_agg_enhanced_3 [label="Expert_Aggregation_3
[expert_outputs, 4096]→[128, 10000, 4096]
Priority" fillcolor=yellow shape=parallelogram]
			}
			add_2_enhanced_3 [label="Residual_Add2_3
[128, 10000, 4096] + [128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_layer_4 {
			fillcolor=lightgray label="Transformer Layer 4 (Enhanced)" style=rounded
			pre_ln_4 [label="Pre-LayerNorm_4
[128, 10000, 4096]
Fused RMSNorm" fillcolor=lightgreen shape=rectangle]
			subgraph cluster_mha_4 {
				label="Multi-Head Attention (TP=2, Flash Attention v2)" style=dashed
				mha_input_4 [label="MHA_Input_4
[128, 10000, 4096]
Async Overlap" fillcolor=yellow shape=parallelogram]
				qkv_proj_4_gpu0 [label="QKV_Proj_4_GPU0
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				qkv_proj_4_gpu1 [label="QKV_Proj_4_GPU1
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				flash_attn_4_gpu0 [label="Flash_Attention_4_GPU0
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				flash_attn_4_gpu1 [label="Flash_Attention_4_GPU1
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				out_proj_4_gpu0 [label="Output_Proj_4_GPU0
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				out_proj_4_gpu1 [label="Output_Proj_4_GPU1
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				mha_merge_4 [label="MHA_Merge_4
[128, 10000, 4096]
Priority Queue" fillcolor=yellow shape=parallelogram]
			}
			add_1_4 [label="Residual_Add1_4
[128, 10000, 4096]
Fused Add" fillcolor=lightgreen shape=rectangle]
			post_ln_4 [label="Post-LayerNorm_4
[128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
			enhanced_gate_4 [label="Enhanced_Expert_Gate_4
[128, 10000, 4096]
Dynamic Load Balanced" fillcolor=yellow shape=parallelogram style=dashed]
			token_dist_local_4 [label="Token_Distribution_Local_4
NVLink Optimized" fillcolor=lightcoral shape=ellipse]
			token_dist_cross_4 [label="Token_Distribution_Cross_4
IB Optimized" fillcolor=lightcoral shape=ellipse]
			subgraph cluster_moe_enhanced_4 {
				label="Enhanced MoE (EP=64, TP=2, Hierarchical)" style=dashed
				subgraph cluster_expert_enhanced_4_0 {
					label="Expert 0 (Node 0, GPUs 0,1)" style=rounded
					expert_enhanced_4_0_gpu0 [label="Expert_4_0_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_4_0_gpu1 [label="Expert_4_0_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_4_0 [label="Expert_Merge_4_0
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_4_1 {
					label="Expert 1 (Node 0, GPUs 2,3)" style=rounded
					expert_enhanced_4_1_gpu0 [label="Expert_4_1_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_4_1_gpu1 [label="Expert_4_1_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_4_1 [label="Expert_Merge_4_1
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_4_2 {
					label="Expert 2 (Node 0, GPUs 4,5)" style=rounded
					expert_enhanced_4_2_gpu0 [label="Expert_4_2_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_4_2_gpu1 [label="Expert_4_2_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_4_2 [label="Expert_Merge_4_2
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_4_61 {
					label="Expert 61 (Node 15, GPUs 122,123)" style=rounded
					expert_enhanced_4_61_gpu0 [label="Expert_4_61_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_4_61_gpu1 [label="Expert_4_61_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_4_61 [label="Expert_Merge_4_61
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_4_62 {
					label="Expert 62 (Node 15, GPUs 124,125)" style=rounded
					expert_enhanced_4_62_gpu0 [label="Expert_4_62_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_4_62_gpu1 [label="Expert_4_62_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_4_62 [label="Expert_Merge_4_62
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_4_63 {
					label="Expert 63 (Node 15, GPUs 126,127)" style=rounded
					expert_enhanced_4_63_gpu0 [label="Expert_4_63_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_4_63_gpu1 [label="Expert_4_63_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_4_63 [label="Expert_Merge_4_63
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				expert_agg_enhanced_4 [label="Expert_Aggregation_4
[expert_outputs, 4096]→[128, 10000, 4096]
Priority" fillcolor=yellow shape=parallelogram]
			}
			add_2_enhanced_4 [label="Residual_Add2_4
[128, 10000, 4096] + [128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_layer_5 {
			fillcolor=lightgray label="Transformer Layer 5 (Enhanced)" style=rounded
			pre_ln_5 [label="Pre-LayerNorm_5
[128, 10000, 4096]
Fused RMSNorm" fillcolor=lightgreen shape=rectangle]
			subgraph cluster_mha_5 {
				label="Multi-Head Attention (TP=2, Flash Attention v2)" style=dashed
				mha_input_5 [label="MHA_Input_5
[128, 10000, 4096]
Async Overlap" fillcolor=yellow shape=parallelogram]
				qkv_proj_5_gpu0 [label="QKV_Proj_5_GPU0
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				qkv_proj_5_gpu1 [label="QKV_Proj_5_GPU1
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				flash_attn_5_gpu0 [label="Flash_Attention_5_GPU0
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				flash_attn_5_gpu1 [label="Flash_Attention_5_GPU1
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				out_proj_5_gpu0 [label="Output_Proj_5_GPU0
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				out_proj_5_gpu1 [label="Output_Proj_5_GPU1
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				mha_merge_5 [label="MHA_Merge_5
[128, 10000, 4096]
Priority Queue" fillcolor=yellow shape=parallelogram]
			}
			add_1_5 [label="Residual_Add1_5
[128, 10000, 4096]
Fused Add" fillcolor=lightgreen shape=rectangle]
			post_ln_5 [label="Post-LayerNorm_5
[128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
			enhanced_gate_5 [label="Enhanced_Expert_Gate_5
[128, 10000, 4096]
Dynamic Load Balanced" fillcolor=yellow shape=parallelogram style=dashed]
			token_dist_local_5 [label="Token_Distribution_Local_5
NVLink Optimized" fillcolor=lightcoral shape=ellipse]
			token_dist_cross_5 [label="Token_Distribution_Cross_5
IB Optimized" fillcolor=lightcoral shape=ellipse]
			subgraph cluster_moe_enhanced_5 {
				label="Enhanced MoE (EP=64, TP=2, Hierarchical)" style=dashed
				subgraph cluster_expert_enhanced_5_0 {
					label="Expert 0 (Node 0, GPUs 0,1)" style=rounded
					expert_enhanced_5_0_gpu0 [label="Expert_5_0_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_5_0_gpu1 [label="Expert_5_0_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_5_0 [label="Expert_Merge_5_0
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_5_1 {
					label="Expert 1 (Node 0, GPUs 2,3)" style=rounded
					expert_enhanced_5_1_gpu0 [label="Expert_5_1_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_5_1_gpu1 [label="Expert_5_1_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_5_1 [label="Expert_Merge_5_1
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_5_2 {
					label="Expert 2 (Node 0, GPUs 4,5)" style=rounded
					expert_enhanced_5_2_gpu0 [label="Expert_5_2_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_5_2_gpu1 [label="Expert_5_2_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_5_2 [label="Expert_Merge_5_2
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_5_61 {
					label="Expert 61 (Node 15, GPUs 122,123)" style=rounded
					expert_enhanced_5_61_gpu0 [label="Expert_5_61_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_5_61_gpu1 [label="Expert_5_61_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_5_61 [label="Expert_Merge_5_61
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_5_62 {
					label="Expert 62 (Node 15, GPUs 124,125)" style=rounded
					expert_enhanced_5_62_gpu0 [label="Expert_5_62_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_5_62_gpu1 [label="Expert_5_62_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_5_62 [label="Expert_Merge_5_62
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_5_63 {
					label="Expert 63 (Node 15, GPUs 126,127)" style=rounded
					expert_enhanced_5_63_gpu0 [label="Expert_5_63_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_5_63_gpu1 [label="Expert_5_63_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_5_63 [label="Expert_Merge_5_63
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				expert_agg_enhanced_5 [label="Expert_Aggregation_5
[expert_outputs, 4096]→[128, 10000, 4096]
Priority" fillcolor=yellow shape=parallelogram]
			}
			add_2_enhanced_5 [label="Residual_Add2_5
[128, 10000, 4096] + [128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_layer_6 {
			fillcolor=lightgray label="Transformer Layer 6 (Enhanced)" style=rounded
			pre_ln_6 [label="Pre-LayerNorm_6
[128, 10000, 4096]
Fused RMSNorm" fillcolor=lightgreen shape=rectangle]
			subgraph cluster_mha_6 {
				label="Multi-Head Attention (TP=2, Flash Attention v2)" style=dashed
				mha_input_6 [label="MHA_Input_6
[128, 10000, 4096]
Async Overlap" fillcolor=yellow shape=parallelogram]
				qkv_proj_6_gpu0 [label="QKV_Proj_6_GPU0
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				qkv_proj_6_gpu1 [label="QKV_Proj_6_GPU1
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				flash_attn_6_gpu0 [label="Flash_Attention_6_GPU0
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				flash_attn_6_gpu1 [label="Flash_Attention_6_GPU1
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				out_proj_6_gpu0 [label="Output_Proj_6_GPU0
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				out_proj_6_gpu1 [label="Output_Proj_6_GPU1
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				mha_merge_6 [label="MHA_Merge_6
[128, 10000, 4096]
Priority Queue" fillcolor=yellow shape=parallelogram]
			}
			add_1_6 [label="Residual_Add1_6
[128, 10000, 4096]
Fused Add" fillcolor=lightgreen shape=rectangle]
			post_ln_6 [label="Post-LayerNorm_6
[128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
			enhanced_gate_6 [label="Enhanced_Expert_Gate_6
[128, 10000, 4096]
Dynamic Load Balanced" fillcolor=yellow shape=parallelogram style=dashed]
			token_dist_local_6 [label="Token_Distribution_Local_6
NVLink Optimized" fillcolor=lightcoral shape=ellipse]
			token_dist_cross_6 [label="Token_Distribution_Cross_6
IB Optimized" fillcolor=lightcoral shape=ellipse]
			subgraph cluster_moe_enhanced_6 {
				label="Enhanced MoE (EP=64, TP=2, Hierarchical)" style=dashed
				subgraph cluster_expert_enhanced_6_0 {
					label="Expert 0 (Node 0, GPUs 0,1)" style=rounded
					expert_enhanced_6_0_gpu0 [label="Expert_6_0_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_6_0_gpu1 [label="Expert_6_0_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_6_0 [label="Expert_Merge_6_0
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_6_1 {
					label="Expert 1 (Node 0, GPUs 2,3)" style=rounded
					expert_enhanced_6_1_gpu0 [label="Expert_6_1_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_6_1_gpu1 [label="Expert_6_1_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_6_1 [label="Expert_Merge_6_1
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_6_2 {
					label="Expert 2 (Node 0, GPUs 4,5)" style=rounded
					expert_enhanced_6_2_gpu0 [label="Expert_6_2_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_6_2_gpu1 [label="Expert_6_2_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_6_2 [label="Expert_Merge_6_2
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_6_61 {
					label="Expert 61 (Node 15, GPUs 122,123)" style=rounded
					expert_enhanced_6_61_gpu0 [label="Expert_6_61_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_6_61_gpu1 [label="Expert_6_61_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_6_61 [label="Expert_Merge_6_61
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_6_62 {
					label="Expert 62 (Node 15, GPUs 124,125)" style=rounded
					expert_enhanced_6_62_gpu0 [label="Expert_6_62_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_6_62_gpu1 [label="Expert_6_62_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_6_62 [label="Expert_Merge_6_62
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_6_63 {
					label="Expert 63 (Node 15, GPUs 126,127)" style=rounded
					expert_enhanced_6_63_gpu0 [label="Expert_6_63_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_6_63_gpu1 [label="Expert_6_63_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_6_63 [label="Expert_Merge_6_63
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				expert_agg_enhanced_6 [label="Expert_Aggregation_6
[expert_outputs, 4096]→[128, 10000, 4096]
Priority" fillcolor=yellow shape=parallelogram]
			}
			add_2_enhanced_6 [label="Residual_Add2_6
[128, 10000, 4096] + [128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_layer_7 {
			fillcolor=lightgray label="Transformer Layer 7 (Enhanced)" style=rounded
			pre_ln_7 [label="Pre-LayerNorm_7
[128, 10000, 4096]
Fused RMSNorm" fillcolor=lightgreen shape=rectangle]
			subgraph cluster_mha_7 {
				label="Multi-Head Attention (TP=2, Flash Attention v2)" style=dashed
				mha_input_7 [label="MHA_Input_7
[128, 10000, 4096]
Async Overlap" fillcolor=yellow shape=parallelogram]
				qkv_proj_7_gpu0 [label="QKV_Proj_7_GPU0
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				qkv_proj_7_gpu1 [label="QKV_Proj_7_GPU1
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				flash_attn_7_gpu0 [label="Flash_Attention_7_GPU0
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				flash_attn_7_gpu1 [label="Flash_Attention_7_GPU1
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				out_proj_7_gpu0 [label="Output_Proj_7_GPU0
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				out_proj_7_gpu1 [label="Output_Proj_7_GPU1
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				mha_merge_7 [label="MHA_Merge_7
[128, 10000, 4096]
Priority Queue" fillcolor=yellow shape=parallelogram]
			}
			add_1_7 [label="Residual_Add1_7
[128, 10000, 4096]
Fused Add" fillcolor=lightgreen shape=rectangle]
			post_ln_7 [label="Post-LayerNorm_7
[128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
			enhanced_gate_7 [label="Enhanced_Expert_Gate_7
[128, 10000, 4096]
Dynamic Load Balanced" fillcolor=yellow shape=parallelogram style=dashed]
			token_dist_local_7 [label="Token_Distribution_Local_7
NVLink Optimized" fillcolor=lightcoral shape=ellipse]
			token_dist_cross_7 [label="Token_Distribution_Cross_7
IB Optimized" fillcolor=lightcoral shape=ellipse]
			subgraph cluster_moe_enhanced_7 {
				label="Enhanced MoE (EP=64, TP=2, Hierarchical)" style=dashed
				subgraph cluster_expert_enhanced_7_0 {
					label="Expert 0 (Node 0, GPUs 0,1)" style=rounded
					expert_enhanced_7_0_gpu0 [label="Expert_7_0_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_7_0_gpu1 [label="Expert_7_0_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_7_0 [label="Expert_Merge_7_0
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_7_1 {
					label="Expert 1 (Node 0, GPUs 2,3)" style=rounded
					expert_enhanced_7_1_gpu0 [label="Expert_7_1_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_7_1_gpu1 [label="Expert_7_1_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_7_1 [label="Expert_Merge_7_1
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_7_2 {
					label="Expert 2 (Node 0, GPUs 4,5)" style=rounded
					expert_enhanced_7_2_gpu0 [label="Expert_7_2_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_7_2_gpu1 [label="Expert_7_2_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_7_2 [label="Expert_Merge_7_2
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_7_61 {
					label="Expert 61 (Node 15, GPUs 122,123)" style=rounded
					expert_enhanced_7_61_gpu0 [label="Expert_7_61_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_7_61_gpu1 [label="Expert_7_61_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_7_61 [label="Expert_Merge_7_61
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_7_62 {
					label="Expert 62 (Node 15, GPUs 124,125)" style=rounded
					expert_enhanced_7_62_gpu0 [label="Expert_7_62_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_7_62_gpu1 [label="Expert_7_62_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_7_62 [label="Expert_Merge_7_62
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_7_63 {
					label="Expert 63 (Node 15, GPUs 126,127)" style=rounded
					expert_enhanced_7_63_gpu0 [label="Expert_7_63_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_7_63_gpu1 [label="Expert_7_63_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_7_63 [label="Expert_Merge_7_63
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				expert_agg_enhanced_7 [label="Expert_Aggregation_7
[expert_outputs, 4096]→[128, 10000, 4096]
Priority" fillcolor=yellow shape=parallelogram]
			}
			add_2_enhanced_7 [label="Residual_Add2_7
[128, 10000, 4096] + [128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_layer_8 {
			fillcolor=lightgray label="Transformer Layer 8 (Enhanced)" style=rounded
			pre_ln_8 [label="Pre-LayerNorm_8
[128, 10000, 4096]
Fused RMSNorm" fillcolor=lightgreen shape=rectangle]
			subgraph cluster_mha_8 {
				label="Multi-Head Attention (TP=2, Flash Attention v2)" style=dashed
				mha_input_8 [label="MHA_Input_8
[128, 10000, 4096]
Async Overlap" fillcolor=yellow shape=parallelogram]
				qkv_proj_8_gpu0 [label="QKV_Proj_8_GPU0
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				qkv_proj_8_gpu1 [label="QKV_Proj_8_GPU1
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				flash_attn_8_gpu0 [label="Flash_Attention_8_GPU0
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				flash_attn_8_gpu1 [label="Flash_Attention_8_GPU1
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				out_proj_8_gpu0 [label="Output_Proj_8_GPU0
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				out_proj_8_gpu1 [label="Output_Proj_8_GPU1
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				mha_merge_8 [label="MHA_Merge_8
[128, 10000, 4096]
Priority Queue" fillcolor=yellow shape=parallelogram]
			}
			add_1_8 [label="Residual_Add1_8
[128, 10000, 4096]
Fused Add" fillcolor=lightgreen shape=rectangle]
			post_ln_8 [label="Post-LayerNorm_8
[128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
			enhanced_gate_8 [label="Enhanced_Expert_Gate_8
[128, 10000, 4096]
Dynamic Load Balanced" fillcolor=yellow shape=parallelogram style=dashed]
			token_dist_local_8 [label="Token_Distribution_Local_8
NVLink Optimized" fillcolor=lightcoral shape=ellipse]
			token_dist_cross_8 [label="Token_Distribution_Cross_8
IB Optimized" fillcolor=lightcoral shape=ellipse]
			subgraph cluster_moe_enhanced_8 {
				label="Enhanced MoE (EP=64, TP=2, Hierarchical)" style=dashed
				subgraph cluster_expert_enhanced_8_0 {
					label="Expert 0 (Node 0, GPUs 0,1)" style=rounded
					expert_enhanced_8_0_gpu0 [label="Expert_8_0_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_8_0_gpu1 [label="Expert_8_0_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_8_0 [label="Expert_Merge_8_0
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_8_1 {
					label="Expert 1 (Node 0, GPUs 2,3)" style=rounded
					expert_enhanced_8_1_gpu0 [label="Expert_8_1_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_8_1_gpu1 [label="Expert_8_1_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_8_1 [label="Expert_Merge_8_1
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_8_2 {
					label="Expert 2 (Node 0, GPUs 4,5)" style=rounded
					expert_enhanced_8_2_gpu0 [label="Expert_8_2_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_8_2_gpu1 [label="Expert_8_2_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_8_2 [label="Expert_Merge_8_2
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_8_61 {
					label="Expert 61 (Node 15, GPUs 122,123)" style=rounded
					expert_enhanced_8_61_gpu0 [label="Expert_8_61_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_8_61_gpu1 [label="Expert_8_61_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_8_61 [label="Expert_Merge_8_61
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_8_62 {
					label="Expert 62 (Node 15, GPUs 124,125)" style=rounded
					expert_enhanced_8_62_gpu0 [label="Expert_8_62_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_8_62_gpu1 [label="Expert_8_62_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_8_62 [label="Expert_Merge_8_62
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_8_63 {
					label="Expert 63 (Node 15, GPUs 126,127)" style=rounded
					expert_enhanced_8_63_gpu0 [label="Expert_8_63_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_8_63_gpu1 [label="Expert_8_63_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_8_63 [label="Expert_Merge_8_63
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				expert_agg_enhanced_8 [label="Expert_Aggregation_8
[expert_outputs, 4096]→[128, 10000, 4096]
Priority" fillcolor=yellow shape=parallelogram]
			}
			add_2_enhanced_8 [label="Residual_Add2_8
[128, 10000, 4096] + [128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_layer_9 {
			fillcolor=lightgray label="Transformer Layer 9 (Enhanced)" style=rounded
			pre_ln_9 [label="Pre-LayerNorm_9
[128, 10000, 4096]
Fused RMSNorm" fillcolor=lightgreen shape=rectangle]
			subgraph cluster_mha_9 {
				label="Multi-Head Attention (TP=2, Flash Attention v2)" style=dashed
				mha_input_9 [label="MHA_Input_9
[128, 10000, 4096]
Async Overlap" fillcolor=yellow shape=parallelogram]
				qkv_proj_9_gpu0 [label="QKV_Proj_9_GPU0
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				qkv_proj_9_gpu1 [label="QKV_Proj_9_GPU1
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				flash_attn_9_gpu0 [label="Flash_Attention_9_GPU0
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				flash_attn_9_gpu1 [label="Flash_Attention_9_GPU1
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				out_proj_9_gpu0 [label="Output_Proj_9_GPU0
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				out_proj_9_gpu1 [label="Output_Proj_9_GPU1
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				mha_merge_9 [label="MHA_Merge_9
[128, 10000, 4096]
Priority Queue" fillcolor=yellow shape=parallelogram]
			}
			add_1_9 [label="Residual_Add1_9
[128, 10000, 4096]
Fused Add" fillcolor=lightgreen shape=rectangle]
			post_ln_9 [label="Post-LayerNorm_9
[128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
			enhanced_gate_9 [label="Enhanced_Expert_Gate_9
[128, 10000, 4096]
Dynamic Load Balanced" fillcolor=yellow shape=parallelogram style=dashed]
			token_dist_local_9 [label="Token_Distribution_Local_9
NVLink Optimized" fillcolor=lightcoral shape=ellipse]
			token_dist_cross_9 [label="Token_Distribution_Cross_9
IB Optimized" fillcolor=lightcoral shape=ellipse]
			subgraph cluster_moe_enhanced_9 {
				label="Enhanced MoE (EP=64, TP=2, Hierarchical)" style=dashed
				subgraph cluster_expert_enhanced_9_0 {
					label="Expert 0 (Node 0, GPUs 0,1)" style=rounded
					expert_enhanced_9_0_gpu0 [label="Expert_9_0_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_9_0_gpu1 [label="Expert_9_0_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_9_0 [label="Expert_Merge_9_0
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_9_1 {
					label="Expert 1 (Node 0, GPUs 2,3)" style=rounded
					expert_enhanced_9_1_gpu0 [label="Expert_9_1_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_9_1_gpu1 [label="Expert_9_1_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_9_1 [label="Expert_Merge_9_1
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_9_2 {
					label="Expert 2 (Node 0, GPUs 4,5)" style=rounded
					expert_enhanced_9_2_gpu0 [label="Expert_9_2_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_9_2_gpu1 [label="Expert_9_2_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_9_2 [label="Expert_Merge_9_2
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_9_61 {
					label="Expert 61 (Node 15, GPUs 122,123)" style=rounded
					expert_enhanced_9_61_gpu0 [label="Expert_9_61_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_9_61_gpu1 [label="Expert_9_61_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_9_61 [label="Expert_Merge_9_61
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_9_62 {
					label="Expert 62 (Node 15, GPUs 124,125)" style=rounded
					expert_enhanced_9_62_gpu0 [label="Expert_9_62_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_9_62_gpu1 [label="Expert_9_62_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_9_62 [label="Expert_Merge_9_62
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_9_63 {
					label="Expert 63 (Node 15, GPUs 126,127)" style=rounded
					expert_enhanced_9_63_gpu0 [label="Expert_9_63_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_9_63_gpu1 [label="Expert_9_63_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_9_63 [label="Expert_Merge_9_63
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				expert_agg_enhanced_9 [label="Expert_Aggregation_9
[expert_outputs, 4096]→[128, 10000, 4096]
Priority" fillcolor=yellow shape=parallelogram]
			}
			add_2_enhanced_9 [label="Residual_Add2_9
[128, 10000, 4096] + [128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_layer_10 {
			fillcolor=lightgray label="Transformer Layer 10 (Enhanced)" style=rounded
			pre_ln_10 [label="Pre-LayerNorm_10
[128, 10000, 4096]
Fused RMSNorm" fillcolor=lightgreen shape=rectangle]
			subgraph cluster_mha_10 {
				label="Multi-Head Attention (TP=2, Flash Attention v2)" style=dashed
				mha_input_10 [label="MHA_Input_10
[128, 10000, 4096]
Async Overlap" fillcolor=yellow shape=parallelogram]
				qkv_proj_10_gpu0 [label="QKV_Proj_10_GPU0
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				qkv_proj_10_gpu1 [label="QKV_Proj_10_GPU1
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				flash_attn_10_gpu0 [label="Flash_Attention_10_GPU0
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				flash_attn_10_gpu1 [label="Flash_Attention_10_GPU1
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				out_proj_10_gpu0 [label="Output_Proj_10_GPU0
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				out_proj_10_gpu1 [label="Output_Proj_10_GPU1
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				mha_merge_10 [label="MHA_Merge_10
[128, 10000, 4096]
Priority Queue" fillcolor=yellow shape=parallelogram]
			}
			add_1_10 [label="Residual_Add1_10
[128, 10000, 4096]
Fused Add" fillcolor=lightgreen shape=rectangle]
			post_ln_10 [label="Post-LayerNorm_10
[128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
			enhanced_gate_10 [label="Enhanced_Expert_Gate_10
[128, 10000, 4096]
Dynamic Load Balanced" fillcolor=yellow shape=parallelogram style=dashed]
			token_dist_local_10 [label="Token_Distribution_Local_10
NVLink Optimized" fillcolor=lightcoral shape=ellipse]
			token_dist_cross_10 [label="Token_Distribution_Cross_10
IB Optimized" fillcolor=lightcoral shape=ellipse]
			subgraph cluster_moe_enhanced_10 {
				label="Enhanced MoE (EP=64, TP=2, Hierarchical)" style=dashed
				subgraph cluster_expert_enhanced_10_0 {
					label="Expert 0 (Node 0, GPUs 0,1)" style=rounded
					expert_enhanced_10_0_gpu0 [label="Expert_10_0_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_10_0_gpu1 [label="Expert_10_0_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_10_0 [label="Expert_Merge_10_0
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_10_1 {
					label="Expert 1 (Node 0, GPUs 2,3)" style=rounded
					expert_enhanced_10_1_gpu0 [label="Expert_10_1_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_10_1_gpu1 [label="Expert_10_1_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_10_1 [label="Expert_Merge_10_1
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_10_2 {
					label="Expert 2 (Node 0, GPUs 4,5)" style=rounded
					expert_enhanced_10_2_gpu0 [label="Expert_10_2_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_10_2_gpu1 [label="Expert_10_2_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_10_2 [label="Expert_Merge_10_2
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_10_61 {
					label="Expert 61 (Node 15, GPUs 122,123)" style=rounded
					expert_enhanced_10_61_gpu0 [label="Expert_10_61_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_10_61_gpu1 [label="Expert_10_61_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_10_61 [label="Expert_Merge_10_61
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_10_62 {
					label="Expert 62 (Node 15, GPUs 124,125)" style=rounded
					expert_enhanced_10_62_gpu0 [label="Expert_10_62_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_10_62_gpu1 [label="Expert_10_62_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_10_62 [label="Expert_Merge_10_62
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_10_63 {
					label="Expert 63 (Node 15, GPUs 126,127)" style=rounded
					expert_enhanced_10_63_gpu0 [label="Expert_10_63_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_10_63_gpu1 [label="Expert_10_63_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_10_63 [label="Expert_Merge_10_63
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				expert_agg_enhanced_10 [label="Expert_Aggregation_10
[expert_outputs, 4096]→[128, 10000, 4096]
Priority" fillcolor=yellow shape=parallelogram]
			}
			add_2_enhanced_10 [label="Residual_Add2_10
[128, 10000, 4096] + [128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_layer_11 {
			fillcolor=lightgray label="Transformer Layer 11 (Enhanced)" style=rounded
			pre_ln_11 [label="Pre-LayerNorm_11
[128, 10000, 4096]
Fused RMSNorm" fillcolor=lightgreen shape=rectangle]
			subgraph cluster_mha_11 {
				label="Multi-Head Attention (TP=2, Flash Attention v2)" style=dashed
				mha_input_11 [label="MHA_Input_11
[128, 10000, 4096]
Async Overlap" fillcolor=yellow shape=parallelogram]
				qkv_proj_11_gpu0 [label="QKV_Proj_11_GPU0
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				qkv_proj_11_gpu1 [label="QKV_Proj_11_GPU1
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				flash_attn_11_gpu0 [label="Flash_Attention_11_GPU0
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				flash_attn_11_gpu1 [label="Flash_Attention_11_GPU1
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				out_proj_11_gpu0 [label="Output_Proj_11_GPU0
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				out_proj_11_gpu1 [label="Output_Proj_11_GPU1
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				mha_merge_11 [label="MHA_Merge_11
[128, 10000, 4096]
Priority Queue" fillcolor=yellow shape=parallelogram]
			}
			add_1_11 [label="Residual_Add1_11
[128, 10000, 4096]
Fused Add" fillcolor=lightgreen shape=rectangle]
			post_ln_11 [label="Post-LayerNorm_11
[128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
			enhanced_gate_11 [label="Enhanced_Expert_Gate_11
[128, 10000, 4096]
Dynamic Load Balanced" fillcolor=yellow shape=parallelogram style=dashed]
			token_dist_local_11 [label="Token_Distribution_Local_11
NVLink Optimized" fillcolor=lightcoral shape=ellipse]
			token_dist_cross_11 [label="Token_Distribution_Cross_11
IB Optimized" fillcolor=lightcoral shape=ellipse]
			subgraph cluster_moe_enhanced_11 {
				label="Enhanced MoE (EP=64, TP=2, Hierarchical)" style=dashed
				subgraph cluster_expert_enhanced_11_0 {
					label="Expert 0 (Node 0, GPUs 0,1)" style=rounded
					expert_enhanced_11_0_gpu0 [label="Expert_11_0_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_11_0_gpu1 [label="Expert_11_0_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_11_0 [label="Expert_Merge_11_0
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_11_1 {
					label="Expert 1 (Node 0, GPUs 2,3)" style=rounded
					expert_enhanced_11_1_gpu0 [label="Expert_11_1_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_11_1_gpu1 [label="Expert_11_1_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_11_1 [label="Expert_Merge_11_1
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_11_2 {
					label="Expert 2 (Node 0, GPUs 4,5)" style=rounded
					expert_enhanced_11_2_gpu0 [label="Expert_11_2_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_11_2_gpu1 [label="Expert_11_2_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_11_2 [label="Expert_Merge_11_2
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_11_61 {
					label="Expert 61 (Node 15, GPUs 122,123)" style=rounded
					expert_enhanced_11_61_gpu0 [label="Expert_11_61_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_11_61_gpu1 [label="Expert_11_61_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_11_61 [label="Expert_Merge_11_61
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_11_62 {
					label="Expert 62 (Node 15, GPUs 124,125)" style=rounded
					expert_enhanced_11_62_gpu0 [label="Expert_11_62_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_11_62_gpu1 [label="Expert_11_62_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_11_62 [label="Expert_Merge_11_62
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_11_63 {
					label="Expert 63 (Node 15, GPUs 126,127)" style=rounded
					expert_enhanced_11_63_gpu0 [label="Expert_11_63_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_11_63_gpu1 [label="Expert_11_63_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_11_63 [label="Expert_Merge_11_63
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				expert_agg_enhanced_11 [label="Expert_Aggregation_11
[expert_outputs, 4096]→[128, 10000, 4096]
Priority" fillcolor=yellow shape=parallelogram]
			}
			add_2_enhanced_11 [label="Residual_Add2_11
[128, 10000, 4096] + [128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_layer_12 {
			fillcolor=lightgray label="Transformer Layer 12 (Enhanced)" style=rounded
			pre_ln_12 [label="Pre-LayerNorm_12
[128, 10000, 4096]
Fused RMSNorm" fillcolor=lightgreen shape=rectangle]
			subgraph cluster_mha_12 {
				label="Multi-Head Attention (TP=2, Flash Attention v2)" style=dashed
				mha_input_12 [label="MHA_Input_12
[128, 10000, 4096]
Async Overlap" fillcolor=yellow shape=parallelogram]
				qkv_proj_12_gpu0 [label="QKV_Proj_12_GPU0
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				qkv_proj_12_gpu1 [label="QKV_Proj_12_GPU1
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				flash_attn_12_gpu0 [label="Flash_Attention_12_GPU0
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				flash_attn_12_gpu1 [label="Flash_Attention_12_GPU1
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				out_proj_12_gpu0 [label="Output_Proj_12_GPU0
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				out_proj_12_gpu1 [label="Output_Proj_12_GPU1
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				mha_merge_12 [label="MHA_Merge_12
[128, 10000, 4096]
Priority Queue" fillcolor=yellow shape=parallelogram]
			}
			add_1_12 [label="Residual_Add1_12
[128, 10000, 4096]
Fused Add" fillcolor=lightgreen shape=rectangle]
			post_ln_12 [label="Post-LayerNorm_12
[128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
			enhanced_gate_12 [label="Enhanced_Expert_Gate_12
[128, 10000, 4096]
Dynamic Load Balanced" fillcolor=yellow shape=parallelogram style=dashed]
			token_dist_local_12 [label="Token_Distribution_Local_12
NVLink Optimized" fillcolor=lightcoral shape=ellipse]
			token_dist_cross_12 [label="Token_Distribution_Cross_12
IB Optimized" fillcolor=lightcoral shape=ellipse]
			subgraph cluster_moe_enhanced_12 {
				label="Enhanced MoE (EP=64, TP=2, Hierarchical)" style=dashed
				subgraph cluster_expert_enhanced_12_0 {
					label="Expert 0 (Node 0, GPUs 0,1)" style=rounded
					expert_enhanced_12_0_gpu0 [label="Expert_12_0_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_12_0_gpu1 [label="Expert_12_0_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_12_0 [label="Expert_Merge_12_0
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_12_1 {
					label="Expert 1 (Node 0, GPUs 2,3)" style=rounded
					expert_enhanced_12_1_gpu0 [label="Expert_12_1_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_12_1_gpu1 [label="Expert_12_1_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_12_1 [label="Expert_Merge_12_1
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_12_2 {
					label="Expert 2 (Node 0, GPUs 4,5)" style=rounded
					expert_enhanced_12_2_gpu0 [label="Expert_12_2_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_12_2_gpu1 [label="Expert_12_2_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_12_2 [label="Expert_Merge_12_2
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_12_61 {
					label="Expert 61 (Node 15, GPUs 122,123)" style=rounded
					expert_enhanced_12_61_gpu0 [label="Expert_12_61_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_12_61_gpu1 [label="Expert_12_61_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_12_61 [label="Expert_Merge_12_61
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_12_62 {
					label="Expert 62 (Node 15, GPUs 124,125)" style=rounded
					expert_enhanced_12_62_gpu0 [label="Expert_12_62_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_12_62_gpu1 [label="Expert_12_62_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_12_62 [label="Expert_Merge_12_62
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_12_63 {
					label="Expert 63 (Node 15, GPUs 126,127)" style=rounded
					expert_enhanced_12_63_gpu0 [label="Expert_12_63_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_12_63_gpu1 [label="Expert_12_63_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_12_63 [label="Expert_Merge_12_63
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				expert_agg_enhanced_12 [label="Expert_Aggregation_12
[expert_outputs, 4096]→[128, 10000, 4096]
Priority" fillcolor=yellow shape=parallelogram]
			}
			add_2_enhanced_12 [label="Residual_Add2_12
[128, 10000, 4096] + [128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_layer_13 {
			fillcolor=lightgray label="Transformer Layer 13 (Enhanced)" style=rounded
			pre_ln_13 [label="Pre-LayerNorm_13
[128, 10000, 4096]
Fused RMSNorm" fillcolor=lightgreen shape=rectangle]
			subgraph cluster_mha_13 {
				label="Multi-Head Attention (TP=2, Flash Attention v2)" style=dashed
				mha_input_13 [label="MHA_Input_13
[128, 10000, 4096]
Async Overlap" fillcolor=yellow shape=parallelogram]
				qkv_proj_13_gpu0 [label="QKV_Proj_13_GPU0
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				qkv_proj_13_gpu1 [label="QKV_Proj_13_GPU1
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				flash_attn_13_gpu0 [label="Flash_Attention_13_GPU0
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				flash_attn_13_gpu1 [label="Flash_Attention_13_GPU1
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				out_proj_13_gpu0 [label="Output_Proj_13_GPU0
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				out_proj_13_gpu1 [label="Output_Proj_13_GPU1
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				mha_merge_13 [label="MHA_Merge_13
[128, 10000, 4096]
Priority Queue" fillcolor=yellow shape=parallelogram]
			}
			add_1_13 [label="Residual_Add1_13
[128, 10000, 4096]
Fused Add" fillcolor=lightgreen shape=rectangle]
			post_ln_13 [label="Post-LayerNorm_13
[128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
			enhanced_gate_13 [label="Enhanced_Expert_Gate_13
[128, 10000, 4096]
Dynamic Load Balanced" fillcolor=yellow shape=parallelogram style=dashed]
			token_dist_local_13 [label="Token_Distribution_Local_13
NVLink Optimized" fillcolor=lightcoral shape=ellipse]
			token_dist_cross_13 [label="Token_Distribution_Cross_13
IB Optimized" fillcolor=lightcoral shape=ellipse]
			subgraph cluster_moe_enhanced_13 {
				label="Enhanced MoE (EP=64, TP=2, Hierarchical)" style=dashed
				subgraph cluster_expert_enhanced_13_0 {
					label="Expert 0 (Node 0, GPUs 0,1)" style=rounded
					expert_enhanced_13_0_gpu0 [label="Expert_13_0_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_13_0_gpu1 [label="Expert_13_0_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_13_0 [label="Expert_Merge_13_0
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_13_1 {
					label="Expert 1 (Node 0, GPUs 2,3)" style=rounded
					expert_enhanced_13_1_gpu0 [label="Expert_13_1_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_13_1_gpu1 [label="Expert_13_1_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_13_1 [label="Expert_Merge_13_1
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_13_2 {
					label="Expert 2 (Node 0, GPUs 4,5)" style=rounded
					expert_enhanced_13_2_gpu0 [label="Expert_13_2_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_13_2_gpu1 [label="Expert_13_2_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_13_2 [label="Expert_Merge_13_2
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_13_61 {
					label="Expert 61 (Node 15, GPUs 122,123)" style=rounded
					expert_enhanced_13_61_gpu0 [label="Expert_13_61_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_13_61_gpu1 [label="Expert_13_61_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_13_61 [label="Expert_Merge_13_61
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_13_62 {
					label="Expert 62 (Node 15, GPUs 124,125)" style=rounded
					expert_enhanced_13_62_gpu0 [label="Expert_13_62_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_13_62_gpu1 [label="Expert_13_62_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_13_62 [label="Expert_Merge_13_62
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_13_63 {
					label="Expert 63 (Node 15, GPUs 126,127)" style=rounded
					expert_enhanced_13_63_gpu0 [label="Expert_13_63_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_13_63_gpu1 [label="Expert_13_63_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_13_63 [label="Expert_Merge_13_63
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				expert_agg_enhanced_13 [label="Expert_Aggregation_13
[expert_outputs, 4096]→[128, 10000, 4096]
Priority" fillcolor=yellow shape=parallelogram]
			}
			add_2_enhanced_13 [label="Residual_Add2_13
[128, 10000, 4096] + [128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_layer_14 {
			fillcolor=lightgray label="Transformer Layer 14 (Enhanced)" style=rounded
			pre_ln_14 [label="Pre-LayerNorm_14
[128, 10000, 4096]
Fused RMSNorm" fillcolor=lightgreen shape=rectangle]
			subgraph cluster_mha_14 {
				label="Multi-Head Attention (TP=2, Flash Attention v2)" style=dashed
				mha_input_14 [label="MHA_Input_14
[128, 10000, 4096]
Async Overlap" fillcolor=yellow shape=parallelogram]
				qkv_proj_14_gpu0 [label="QKV_Proj_14_GPU0
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				qkv_proj_14_gpu1 [label="QKV_Proj_14_GPU1
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				flash_attn_14_gpu0 [label="Flash_Attention_14_GPU0
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				flash_attn_14_gpu1 [label="Flash_Attention_14_GPU1
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				out_proj_14_gpu0 [label="Output_Proj_14_GPU0
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				out_proj_14_gpu1 [label="Output_Proj_14_GPU1
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				mha_merge_14 [label="MHA_Merge_14
[128, 10000, 4096]
Priority Queue" fillcolor=yellow shape=parallelogram]
			}
			add_1_14 [label="Residual_Add1_14
[128, 10000, 4096]
Fused Add" fillcolor=lightgreen shape=rectangle]
			post_ln_14 [label="Post-LayerNorm_14
[128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
			enhanced_gate_14 [label="Enhanced_Expert_Gate_14
[128, 10000, 4096]
Dynamic Load Balanced" fillcolor=yellow shape=parallelogram style=dashed]
			token_dist_local_14 [label="Token_Distribution_Local_14
NVLink Optimized" fillcolor=lightcoral shape=ellipse]
			token_dist_cross_14 [label="Token_Distribution_Cross_14
IB Optimized" fillcolor=lightcoral shape=ellipse]
			subgraph cluster_moe_enhanced_14 {
				label="Enhanced MoE (EP=64, TP=2, Hierarchical)" style=dashed
				subgraph cluster_expert_enhanced_14_0 {
					label="Expert 0 (Node 0, GPUs 0,1)" style=rounded
					expert_enhanced_14_0_gpu0 [label="Expert_14_0_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_14_0_gpu1 [label="Expert_14_0_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_14_0 [label="Expert_Merge_14_0
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_14_1 {
					label="Expert 1 (Node 0, GPUs 2,3)" style=rounded
					expert_enhanced_14_1_gpu0 [label="Expert_14_1_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_14_1_gpu1 [label="Expert_14_1_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_14_1 [label="Expert_Merge_14_1
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_14_2 {
					label="Expert 2 (Node 0, GPUs 4,5)" style=rounded
					expert_enhanced_14_2_gpu0 [label="Expert_14_2_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_14_2_gpu1 [label="Expert_14_2_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_14_2 [label="Expert_Merge_14_2
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_14_61 {
					label="Expert 61 (Node 15, GPUs 122,123)" style=rounded
					expert_enhanced_14_61_gpu0 [label="Expert_14_61_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_14_61_gpu1 [label="Expert_14_61_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_14_61 [label="Expert_Merge_14_61
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_14_62 {
					label="Expert 62 (Node 15, GPUs 124,125)" style=rounded
					expert_enhanced_14_62_gpu0 [label="Expert_14_62_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_14_62_gpu1 [label="Expert_14_62_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_14_62 [label="Expert_Merge_14_62
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_14_63 {
					label="Expert 63 (Node 15, GPUs 126,127)" style=rounded
					expert_enhanced_14_63_gpu0 [label="Expert_14_63_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_14_63_gpu1 [label="Expert_14_63_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_14_63 [label="Expert_Merge_14_63
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				expert_agg_enhanced_14 [label="Expert_Aggregation_14
[expert_outputs, 4096]→[128, 10000, 4096]
Priority" fillcolor=yellow shape=parallelogram]
			}
			add_2_enhanced_14 [label="Residual_Add2_14
[128, 10000, 4096] + [128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_layer_15 {
			fillcolor=lightgray label="Transformer Layer 15 (Enhanced)" style=rounded
			pre_ln_15 [label="Pre-LayerNorm_15
[128, 10000, 4096]
Fused RMSNorm" fillcolor=lightgreen shape=rectangle]
			subgraph cluster_mha_15 {
				label="Multi-Head Attention (TP=2, Flash Attention v2)" style=dashed
				mha_input_15 [label="MHA_Input_15
[128, 10000, 4096]
Async Overlap" fillcolor=yellow shape=parallelogram]
				qkv_proj_15_gpu0 [label="QKV_Proj_15_GPU0
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				qkv_proj_15_gpu1 [label="QKV_Proj_15_GPU1
[128, 10000, 192]
Fused Kernel" fillcolor=lightgreen shape=rectangle]
				flash_attn_15_gpu0 [label="Flash_Attention_15_GPU0
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				flash_attn_15_gpu1 [label="Flash_Attention_15_GPU1
[128, 10000, 64]
Memory Efficient" fillcolor=lightgreen shape=rectangle]
				out_proj_15_gpu0 [label="Output_Proj_15_GPU0
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				out_proj_15_gpu1 [label="Output_Proj_15_GPU1
[128, 10000, 2048]
Overlap Optimized" fillcolor=lightgreen shape=rectangle]
				mha_merge_15 [label="MHA_Merge_15
[128, 10000, 4096]
Priority Queue" fillcolor=yellow shape=parallelogram]
			}
			add_1_15 [label="Residual_Add1_15
[128, 10000, 4096]
Fused Add" fillcolor=lightgreen shape=rectangle]
			post_ln_15 [label="Post-LayerNorm_15
[128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
			enhanced_gate_15 [label="Enhanced_Expert_Gate_15
[128, 10000, 4096]
Dynamic Load Balanced" fillcolor=yellow shape=parallelogram style=dashed]
			token_dist_local_15 [label="Token_Distribution_Local_15
NVLink Optimized" fillcolor=lightcoral shape=ellipse]
			token_dist_cross_15 [label="Token_Distribution_Cross_15
IB Optimized" fillcolor=lightcoral shape=ellipse]
			subgraph cluster_moe_enhanced_15 {
				label="Enhanced MoE (EP=64, TP=2, Hierarchical)" style=dashed
				subgraph cluster_expert_enhanced_15_0 {
					label="Expert 0 (Node 0, GPUs 0,1)" style=rounded
					expert_enhanced_15_0_gpu0 [label="Expert_15_0_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_15_0_gpu1 [label="Expert_15_0_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_15_0 [label="Expert_Merge_15_0
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_15_1 {
					label="Expert 1 (Node 0, GPUs 2,3)" style=rounded
					expert_enhanced_15_1_gpu0 [label="Expert_15_1_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_15_1_gpu1 [label="Expert_15_1_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_15_1 [label="Expert_Merge_15_1
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_15_2 {
					label="Expert 2 (Node 0, GPUs 4,5)" style=rounded
					expert_enhanced_15_2_gpu0 [label="Expert_15_2_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_15_2_gpu1 [label="Expert_15_2_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_15_2 [label="Expert_Merge_15_2
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_15_61 {
					label="Expert 61 (Node 15, GPUs 122,123)" style=rounded
					expert_enhanced_15_61_gpu0 [label="Expert_15_61_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_15_61_gpu1 [label="Expert_15_61_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_15_61 [label="Expert_Merge_15_61
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_15_62 {
					label="Expert 62 (Node 15, GPUs 124,125)" style=rounded
					expert_enhanced_15_62_gpu0 [label="Expert_15_62_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_15_62_gpu1 [label="Expert_15_62_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_15_62 [label="Expert_Merge_15_62
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				subgraph cluster_expert_enhanced_15_63 {
					label="Expert 63 (Node 15, GPUs 126,127)" style=rounded
					expert_enhanced_15_63_gpu0 [label="Expert_15_63_GPU0
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_enhanced_15_63_gpu1 [label="Expert_15_63_GPU1
[tokens, 4096]→[tokens, 8192]
Fused MLP" fillcolor=lightgreen shape=rectangle]
					expert_merge_enhanced_15_63 [label="Expert_Merge_15_63
[tokens, 8192]→[tokens, 4096]
Async" fillcolor=yellow shape=parallelogram]
				}
				expert_agg_enhanced_15 [label="Expert_Aggregation_15
[expert_outputs, 4096]→[128, 10000, 4096]
Priority" fillcolor=yellow shape=parallelogram]
			}
			add_2_enhanced_15 [label="Residual_Add2_15
[128, 10000, 4096] + [128, 10000, 4096]
Checkpointed" fillcolor=lightgreen shape=rectangle]
		}
		output_enhanced [label="Model Output
[128, 10000, 4096]→[128, 10000, 51200]
Async Writeback" fillcolor=lightblue shape=ellipse]
	}
	edge [color=black style=solid]
	input -> embedding [label=async_prefetch]
	embedding -> pre_ln_0 [label=overlap_ready]
	pre_ln_0 -> mha_input_0 [label=async]
	mha_input_0 -> qkv_proj_0_gpu0 [label=broadcast]
	mha_input_0 -> qkv_proj_0_gpu1 [label=broadcast]
	qkv_proj_0_gpu0 -> flash_attn_0_gpu0 [label=fused]
	qkv_proj_0_gpu1 -> flash_attn_0_gpu1 [label=fused]
	flash_attn_0_gpu0 -> out_proj_0_gpu0 [label=flash]
	flash_attn_0_gpu1 -> out_proj_0_gpu1 [label=flash]
	out_proj_0_gpu0 -> mha_merge_0 [label=async]
	out_proj_0_gpu1 -> mha_merge_0 [label=async]
	mha_merge_0 -> add_1_0 [label=priority]
	embedding -> add_1_0 [label=residual]
	add_1_0 -> post_ln_0 [label=checkpoint]
	post_ln_0 -> enhanced_gate_0 [label=dynamic]
	enhanced_gate_0 -> token_dist_local_0 [label=local color=red style=dashed]
	enhanced_gate_0 -> token_dist_cross_0 [label=cross color=blue style=dashed]
	token_dist_local_0 -> expert_enhanced_0_0_gpu0 [label=nvlink]
	token_dist_local_0 -> expert_enhanced_0_1_gpu0 [label=nvlink]
	token_dist_cross_0 -> expert_enhanced_0_61_gpu0 [label=infiniband]
	token_dist_cross_0 -> expert_enhanced_0_62_gpu0 [label=infiniband]
	expert_enhanced_0_0_gpu0 -> expert_enhanced_0_0_gpu1 [label=tp_coord]
	expert_enhanced_0_0_gpu1 -> expert_merge_enhanced_0_0 [label=async]
	expert_merge_enhanced_0_0 -> expert_agg_enhanced_0 [label=priority]
	expert_merge_enhanced_0_1 -> expert_agg_enhanced_0 [label=priority]
	expert_agg_enhanced_0 -> add_2_enhanced_0 [label=checkpoint]
	add_1_0 -> add_2_enhanced_0 [label=residual]
	add_2_enhanced_0 -> pre_ln_1 [label=overlap_ready]
	pre_ln_1 -> mha_input_1 [label=async]
	mha_input_1 -> qkv_proj_1_gpu0 [label=broadcast]
	mha_input_1 -> qkv_proj_1_gpu1 [label=broadcast]
	qkv_proj_1_gpu0 -> flash_attn_1_gpu0 [label=fused]
	qkv_proj_1_gpu1 -> flash_attn_1_gpu1 [label=fused]
	flash_attn_1_gpu0 -> out_proj_1_gpu0 [label=flash]
	flash_attn_1_gpu1 -> out_proj_1_gpu1 [label=flash]
	out_proj_1_gpu0 -> mha_merge_1 [label=async]
	out_proj_1_gpu1 -> mha_merge_1 [label=async]
	mha_merge_1 -> add_1_1 [label=priority]
	add_2_enhanced_0 -> add_1_1 [label=residual]
	add_1_1 -> post_ln_1 [label=checkpoint]
	post_ln_1 -> enhanced_gate_1 [label=dynamic]
	enhanced_gate_1 -> token_dist_local_1 [label=local color=red style=dashed]
	enhanced_gate_1 -> token_dist_cross_1 [label=cross color=blue style=dashed]
	token_dist_local_1 -> expert_enhanced_1_0_gpu0 [label=nvlink]
	token_dist_local_1 -> expert_enhanced_1_1_gpu0 [label=nvlink]
	token_dist_cross_1 -> expert_enhanced_1_61_gpu0 [label=infiniband]
	token_dist_cross_1 -> expert_enhanced_1_62_gpu0 [label=infiniband]
	expert_enhanced_1_0_gpu0 -> expert_enhanced_1_0_gpu1 [label=tp_coord]
	expert_enhanced_1_0_gpu1 -> expert_merge_enhanced_1_0 [label=async]
	expert_merge_enhanced_1_0 -> expert_agg_enhanced_1 [label=priority]
	expert_merge_enhanced_1_1 -> expert_agg_enhanced_1 [label=priority]
	expert_agg_enhanced_1 -> add_2_enhanced_1 [label=checkpoint]
	add_1_1 -> add_2_enhanced_1 [label=residual]
	add_2_enhanced_1 -> pre_ln_2 [label=overlap_ready]
	pre_ln_2 -> mha_input_2 [label=async]
	mha_input_2 -> qkv_proj_2_gpu0 [label=broadcast]
	mha_input_2 -> qkv_proj_2_gpu1 [label=broadcast]
	qkv_proj_2_gpu0 -> flash_attn_2_gpu0 [label=fused]
	qkv_proj_2_gpu1 -> flash_attn_2_gpu1 [label=fused]
	flash_attn_2_gpu0 -> out_proj_2_gpu0 [label=flash]
	flash_attn_2_gpu1 -> out_proj_2_gpu1 [label=flash]
	out_proj_2_gpu0 -> mha_merge_2 [label=async]
	out_proj_2_gpu1 -> mha_merge_2 [label=async]
	mha_merge_2 -> add_1_2 [label=priority]
	add_2_enhanced_1 -> add_1_2 [label=residual]
	add_1_2 -> post_ln_2 [label=checkpoint]
	post_ln_2 -> enhanced_gate_2 [label=dynamic]
	enhanced_gate_2 -> token_dist_local_2 [label=local color=red style=dashed]
	enhanced_gate_2 -> token_dist_cross_2 [label=cross color=blue style=dashed]
	token_dist_local_2 -> expert_enhanced_2_0_gpu0 [label=nvlink]
	token_dist_local_2 -> expert_enhanced_2_1_gpu0 [label=nvlink]
	token_dist_cross_2 -> expert_enhanced_2_61_gpu0 [label=infiniband]
	token_dist_cross_2 -> expert_enhanced_2_62_gpu0 [label=infiniband]
	expert_enhanced_2_0_gpu0 -> expert_enhanced_2_0_gpu1 [label=tp_coord]
	expert_enhanced_2_0_gpu1 -> expert_merge_enhanced_2_0 [label=async]
	expert_merge_enhanced_2_0 -> expert_agg_enhanced_2 [label=priority]
	expert_merge_enhanced_2_1 -> expert_agg_enhanced_2 [label=priority]
	expert_agg_enhanced_2 -> add_2_enhanced_2 [label=checkpoint]
	add_1_2 -> add_2_enhanced_2 [label=residual]
	add_2_enhanced_2 -> pre_ln_3 [label=overlap_ready]
	pre_ln_3 -> mha_input_3 [label=async]
	mha_input_3 -> qkv_proj_3_gpu0 [label=broadcast]
	mha_input_3 -> qkv_proj_3_gpu1 [label=broadcast]
	qkv_proj_3_gpu0 -> flash_attn_3_gpu0 [label=fused]
	qkv_proj_3_gpu1 -> flash_attn_3_gpu1 [label=fused]
	flash_attn_3_gpu0 -> out_proj_3_gpu0 [label=flash]
	flash_attn_3_gpu1 -> out_proj_3_gpu1 [label=flash]
	out_proj_3_gpu0 -> mha_merge_3 [label=async]
	out_proj_3_gpu1 -> mha_merge_3 [label=async]
	mha_merge_3 -> add_1_3 [label=priority]
	add_2_enhanced_2 -> add_1_3 [label=residual]
	add_1_3 -> post_ln_3 [label=checkpoint]
	post_ln_3 -> enhanced_gate_3 [label=dynamic]
	enhanced_gate_3 -> token_dist_local_3 [label=local color=red style=dashed]
	enhanced_gate_3 -> token_dist_cross_3 [label=cross color=blue style=dashed]
	token_dist_local_3 -> expert_enhanced_3_0_gpu0 [label=nvlink]
	token_dist_local_3 -> expert_enhanced_3_1_gpu0 [label=nvlink]
	token_dist_cross_3 -> expert_enhanced_3_61_gpu0 [label=infiniband]
	token_dist_cross_3 -> expert_enhanced_3_62_gpu0 [label=infiniband]
	expert_enhanced_3_0_gpu0 -> expert_enhanced_3_0_gpu1 [label=tp_coord]
	expert_enhanced_3_0_gpu1 -> expert_merge_enhanced_3_0 [label=async]
	expert_merge_enhanced_3_0 -> expert_agg_enhanced_3 [label=priority]
	expert_merge_enhanced_3_1 -> expert_agg_enhanced_3 [label=priority]
	expert_agg_enhanced_3 -> add_2_enhanced_3 [label=checkpoint]
	add_1_3 -> add_2_enhanced_3 [label=residual]
	add_2_enhanced_3 -> pre_ln_4 [label=overlap_ready]
	pre_ln_4 -> mha_input_4 [label=async]
	mha_input_4 -> qkv_proj_4_gpu0 [label=broadcast]
	mha_input_4 -> qkv_proj_4_gpu1 [label=broadcast]
	qkv_proj_4_gpu0 -> flash_attn_4_gpu0 [label=fused]
	qkv_proj_4_gpu1 -> flash_attn_4_gpu1 [label=fused]
	flash_attn_4_gpu0 -> out_proj_4_gpu0 [label=flash]
	flash_attn_4_gpu1 -> out_proj_4_gpu1 [label=flash]
	out_proj_4_gpu0 -> mha_merge_4 [label=async]
	out_proj_4_gpu1 -> mha_merge_4 [label=async]
	mha_merge_4 -> add_1_4 [label=priority]
	add_2_enhanced_3 -> add_1_4 [label=residual]
	add_1_4 -> post_ln_4 [label=checkpoint]
	post_ln_4 -> enhanced_gate_4 [label=dynamic]
	enhanced_gate_4 -> token_dist_local_4 [label=local color=red style=dashed]
	enhanced_gate_4 -> token_dist_cross_4 [label=cross color=blue style=dashed]
	token_dist_local_4 -> expert_enhanced_4_0_gpu0 [label=nvlink]
	token_dist_local_4 -> expert_enhanced_4_1_gpu0 [label=nvlink]
	token_dist_cross_4 -> expert_enhanced_4_61_gpu0 [label=infiniband]
	token_dist_cross_4 -> expert_enhanced_4_62_gpu0 [label=infiniband]
	expert_enhanced_4_0_gpu0 -> expert_enhanced_4_0_gpu1 [label=tp_coord]
	expert_enhanced_4_0_gpu1 -> expert_merge_enhanced_4_0 [label=async]
	expert_merge_enhanced_4_0 -> expert_agg_enhanced_4 [label=priority]
	expert_merge_enhanced_4_1 -> expert_agg_enhanced_4 [label=priority]
	expert_agg_enhanced_4 -> add_2_enhanced_4 [label=checkpoint]
	add_1_4 -> add_2_enhanced_4 [label=residual]
	add_2_enhanced_4 -> pre_ln_5 [label=overlap_ready]
	pre_ln_5 -> mha_input_5 [label=async]
	mha_input_5 -> qkv_proj_5_gpu0 [label=broadcast]
	mha_input_5 -> qkv_proj_5_gpu1 [label=broadcast]
	qkv_proj_5_gpu0 -> flash_attn_5_gpu0 [label=fused]
	qkv_proj_5_gpu1 -> flash_attn_5_gpu1 [label=fused]
	flash_attn_5_gpu0 -> out_proj_5_gpu0 [label=flash]
	flash_attn_5_gpu1 -> out_proj_5_gpu1 [label=flash]
	out_proj_5_gpu0 -> mha_merge_5 [label=async]
	out_proj_5_gpu1 -> mha_merge_5 [label=async]
	mha_merge_5 -> add_1_5 [label=priority]
	add_2_enhanced_4 -> add_1_5 [label=residual]
	add_1_5 -> post_ln_5 [label=checkpoint]
	post_ln_5 -> enhanced_gate_5 [label=dynamic]
	enhanced_gate_5 -> token_dist_local_5 [label=local color=red style=dashed]
	enhanced_gate_5 -> token_dist_cross_5 [label=cross color=blue style=dashed]
	token_dist_local_5 -> expert_enhanced_5_0_gpu0 [label=nvlink]
	token_dist_local_5 -> expert_enhanced_5_1_gpu0 [label=nvlink]
	token_dist_cross_5 -> expert_enhanced_5_61_gpu0 [label=infiniband]
	token_dist_cross_5 -> expert_enhanced_5_62_gpu0 [label=infiniband]
	expert_enhanced_5_0_gpu0 -> expert_enhanced_5_0_gpu1 [label=tp_coord]
	expert_enhanced_5_0_gpu1 -> expert_merge_enhanced_5_0 [label=async]
	expert_merge_enhanced_5_0 -> expert_agg_enhanced_5 [label=priority]
	expert_merge_enhanced_5_1 -> expert_agg_enhanced_5 [label=priority]
	expert_agg_enhanced_5 -> add_2_enhanced_5 [label=checkpoint]
	add_1_5 -> add_2_enhanced_5 [label=residual]
	add_2_enhanced_5 -> pre_ln_6 [label=overlap_ready]
	pre_ln_6 -> mha_input_6 [label=async]
	mha_input_6 -> qkv_proj_6_gpu0 [label=broadcast]
	mha_input_6 -> qkv_proj_6_gpu1 [label=broadcast]
	qkv_proj_6_gpu0 -> flash_attn_6_gpu0 [label=fused]
	qkv_proj_6_gpu1 -> flash_attn_6_gpu1 [label=fused]
	flash_attn_6_gpu0 -> out_proj_6_gpu0 [label=flash]
	flash_attn_6_gpu1 -> out_proj_6_gpu1 [label=flash]
	out_proj_6_gpu0 -> mha_merge_6 [label=async]
	out_proj_6_gpu1 -> mha_merge_6 [label=async]
	mha_merge_6 -> add_1_6 [label=priority]
	add_2_enhanced_5 -> add_1_6 [label=residual]
	add_1_6 -> post_ln_6 [label=checkpoint]
	post_ln_6 -> enhanced_gate_6 [label=dynamic]
	enhanced_gate_6 -> token_dist_local_6 [label=local color=red style=dashed]
	enhanced_gate_6 -> token_dist_cross_6 [label=cross color=blue style=dashed]
	token_dist_local_6 -> expert_enhanced_6_0_gpu0 [label=nvlink]
	token_dist_local_6 -> expert_enhanced_6_1_gpu0 [label=nvlink]
	token_dist_cross_6 -> expert_enhanced_6_61_gpu0 [label=infiniband]
	token_dist_cross_6 -> expert_enhanced_6_62_gpu0 [label=infiniband]
	expert_enhanced_6_0_gpu0 -> expert_enhanced_6_0_gpu1 [label=tp_coord]
	expert_enhanced_6_0_gpu1 -> expert_merge_enhanced_6_0 [label=async]
	expert_merge_enhanced_6_0 -> expert_agg_enhanced_6 [label=priority]
	expert_merge_enhanced_6_1 -> expert_agg_enhanced_6 [label=priority]
	expert_agg_enhanced_6 -> add_2_enhanced_6 [label=checkpoint]
	add_1_6 -> add_2_enhanced_6 [label=residual]
	add_2_enhanced_6 -> pre_ln_7 [label=overlap_ready]
	pre_ln_7 -> mha_input_7 [label=async]
	mha_input_7 -> qkv_proj_7_gpu0 [label=broadcast]
	mha_input_7 -> qkv_proj_7_gpu1 [label=broadcast]
	qkv_proj_7_gpu0 -> flash_attn_7_gpu0 [label=fused]
	qkv_proj_7_gpu1 -> flash_attn_7_gpu1 [label=fused]
	flash_attn_7_gpu0 -> out_proj_7_gpu0 [label=flash]
	flash_attn_7_gpu1 -> out_proj_7_gpu1 [label=flash]
	out_proj_7_gpu0 -> mha_merge_7 [label=async]
	out_proj_7_gpu1 -> mha_merge_7 [label=async]
	mha_merge_7 -> add_1_7 [label=priority]
	add_2_enhanced_6 -> add_1_7 [label=residual]
	add_1_7 -> post_ln_7 [label=checkpoint]
	post_ln_7 -> enhanced_gate_7 [label=dynamic]
	enhanced_gate_7 -> token_dist_local_7 [label=local color=red style=dashed]
	enhanced_gate_7 -> token_dist_cross_7 [label=cross color=blue style=dashed]
	token_dist_local_7 -> expert_enhanced_7_0_gpu0 [label=nvlink]
	token_dist_local_7 -> expert_enhanced_7_1_gpu0 [label=nvlink]
	token_dist_cross_7 -> expert_enhanced_7_61_gpu0 [label=infiniband]
	token_dist_cross_7 -> expert_enhanced_7_62_gpu0 [label=infiniband]
	expert_enhanced_7_0_gpu0 -> expert_enhanced_7_0_gpu1 [label=tp_coord]
	expert_enhanced_7_0_gpu1 -> expert_merge_enhanced_7_0 [label=async]
	expert_merge_enhanced_7_0 -> expert_agg_enhanced_7 [label=priority]
	expert_merge_enhanced_7_1 -> expert_agg_enhanced_7 [label=priority]
	expert_agg_enhanced_7 -> add_2_enhanced_7 [label=checkpoint]
	add_1_7 -> add_2_enhanced_7 [label=residual]
	add_2_enhanced_7 -> pre_ln_8 [label=overlap_ready]
	pre_ln_8 -> mha_input_8 [label=async]
	mha_input_8 -> qkv_proj_8_gpu0 [label=broadcast]
	mha_input_8 -> qkv_proj_8_gpu1 [label=broadcast]
	qkv_proj_8_gpu0 -> flash_attn_8_gpu0 [label=fused]
	qkv_proj_8_gpu1 -> flash_attn_8_gpu1 [label=fused]
	flash_attn_8_gpu0 -> out_proj_8_gpu0 [label=flash]
	flash_attn_8_gpu1 -> out_proj_8_gpu1 [label=flash]
	out_proj_8_gpu0 -> mha_merge_8 [label=async]
	out_proj_8_gpu1 -> mha_merge_8 [label=async]
	mha_merge_8 -> add_1_8 [label=priority]
	add_2_enhanced_7 -> add_1_8 [label=residual]
	add_1_8 -> post_ln_8 [label=checkpoint]
	post_ln_8 -> enhanced_gate_8 [label=dynamic]
	enhanced_gate_8 -> token_dist_local_8 [label=local color=red style=dashed]
	enhanced_gate_8 -> token_dist_cross_8 [label=cross color=blue style=dashed]
	token_dist_local_8 -> expert_enhanced_8_0_gpu0 [label=nvlink]
	token_dist_local_8 -> expert_enhanced_8_1_gpu0 [label=nvlink]
	token_dist_cross_8 -> expert_enhanced_8_61_gpu0 [label=infiniband]
	token_dist_cross_8 -> expert_enhanced_8_62_gpu0 [label=infiniband]
	expert_enhanced_8_0_gpu0 -> expert_enhanced_8_0_gpu1 [label=tp_coord]
	expert_enhanced_8_0_gpu1 -> expert_merge_enhanced_8_0 [label=async]
	expert_merge_enhanced_8_0 -> expert_agg_enhanced_8 [label=priority]
	expert_merge_enhanced_8_1 -> expert_agg_enhanced_8 [label=priority]
	expert_agg_enhanced_8 -> add_2_enhanced_8 [label=checkpoint]
	add_1_8 -> add_2_enhanced_8 [label=residual]
	add_2_enhanced_8 -> pre_ln_9 [label=overlap_ready]
	pre_ln_9 -> mha_input_9 [label=async]
	mha_input_9 -> qkv_proj_9_gpu0 [label=broadcast]
	mha_input_9 -> qkv_proj_9_gpu1 [label=broadcast]
	qkv_proj_9_gpu0 -> flash_attn_9_gpu0 [label=fused]
	qkv_proj_9_gpu1 -> flash_attn_9_gpu1 [label=fused]
	flash_attn_9_gpu0 -> out_proj_9_gpu0 [label=flash]
	flash_attn_9_gpu1 -> out_proj_9_gpu1 [label=flash]
	out_proj_9_gpu0 -> mha_merge_9 [label=async]
	out_proj_9_gpu1 -> mha_merge_9 [label=async]
	mha_merge_9 -> add_1_9 [label=priority]
	add_2_enhanced_8 -> add_1_9 [label=residual]
	add_1_9 -> post_ln_9 [label=checkpoint]
	post_ln_9 -> enhanced_gate_9 [label=dynamic]
	enhanced_gate_9 -> token_dist_local_9 [label=local color=red style=dashed]
	enhanced_gate_9 -> token_dist_cross_9 [label=cross color=blue style=dashed]
	token_dist_local_9 -> expert_enhanced_9_0_gpu0 [label=nvlink]
	token_dist_local_9 -> expert_enhanced_9_1_gpu0 [label=nvlink]
	token_dist_cross_9 -> expert_enhanced_9_61_gpu0 [label=infiniband]
	token_dist_cross_9 -> expert_enhanced_9_62_gpu0 [label=infiniband]
	expert_enhanced_9_0_gpu0 -> expert_enhanced_9_0_gpu1 [label=tp_coord]
	expert_enhanced_9_0_gpu1 -> expert_merge_enhanced_9_0 [label=async]
	expert_merge_enhanced_9_0 -> expert_agg_enhanced_9 [label=priority]
	expert_merge_enhanced_9_1 -> expert_agg_enhanced_9 [label=priority]
	expert_agg_enhanced_9 -> add_2_enhanced_9 [label=checkpoint]
	add_1_9 -> add_2_enhanced_9 [label=residual]
	add_2_enhanced_9 -> pre_ln_10 [label=overlap_ready]
	pre_ln_10 -> mha_input_10 [label=async]
	mha_input_10 -> qkv_proj_10_gpu0 [label=broadcast]
	mha_input_10 -> qkv_proj_10_gpu1 [label=broadcast]
	qkv_proj_10_gpu0 -> flash_attn_10_gpu0 [label=fused]
	qkv_proj_10_gpu1 -> flash_attn_10_gpu1 [label=fused]
	flash_attn_10_gpu0 -> out_proj_10_gpu0 [label=flash]
	flash_attn_10_gpu1 -> out_proj_10_gpu1 [label=flash]
	out_proj_10_gpu0 -> mha_merge_10 [label=async]
	out_proj_10_gpu1 -> mha_merge_10 [label=async]
	mha_merge_10 -> add_1_10 [label=priority]
	add_2_enhanced_9 -> add_1_10 [label=residual]
	add_1_10 -> post_ln_10 [label=checkpoint]
	post_ln_10 -> enhanced_gate_10 [label=dynamic]
	enhanced_gate_10 -> token_dist_local_10 [label=local color=red style=dashed]
	enhanced_gate_10 -> token_dist_cross_10 [label=cross color=blue style=dashed]
	token_dist_local_10 -> expert_enhanced_10_0_gpu0 [label=nvlink]
	token_dist_local_10 -> expert_enhanced_10_1_gpu0 [label=nvlink]
	token_dist_cross_10 -> expert_enhanced_10_61_gpu0 [label=infiniband]
	token_dist_cross_10 -> expert_enhanced_10_62_gpu0 [label=infiniband]
	expert_enhanced_10_0_gpu0 -> expert_enhanced_10_0_gpu1 [label=tp_coord]
	expert_enhanced_10_0_gpu1 -> expert_merge_enhanced_10_0 [label=async]
	expert_merge_enhanced_10_0 -> expert_agg_enhanced_10 [label=priority]
	expert_merge_enhanced_10_1 -> expert_agg_enhanced_10 [label=priority]
	expert_agg_enhanced_10 -> add_2_enhanced_10 [label=checkpoint]
	add_1_10 -> add_2_enhanced_10 [label=residual]
	add_2_enhanced_10 -> pre_ln_11 [label=overlap_ready]
	pre_ln_11 -> mha_input_11 [label=async]
	mha_input_11 -> qkv_proj_11_gpu0 [label=broadcast]
	mha_input_11 -> qkv_proj_11_gpu1 [label=broadcast]
	qkv_proj_11_gpu0 -> flash_attn_11_gpu0 [label=fused]
	qkv_proj_11_gpu1 -> flash_attn_11_gpu1 [label=fused]
	flash_attn_11_gpu0 -> out_proj_11_gpu0 [label=flash]
	flash_attn_11_gpu1 -> out_proj_11_gpu1 [label=flash]
	out_proj_11_gpu0 -> mha_merge_11 [label=async]
	out_proj_11_gpu1 -> mha_merge_11 [label=async]
	mha_merge_11 -> add_1_11 [label=priority]
	add_2_enhanced_10 -> add_1_11 [label=residual]
	add_1_11 -> post_ln_11 [label=checkpoint]
	post_ln_11 -> enhanced_gate_11 [label=dynamic]
	enhanced_gate_11 -> token_dist_local_11 [label=local color=red style=dashed]
	enhanced_gate_11 -> token_dist_cross_11 [label=cross color=blue style=dashed]
	token_dist_local_11 -> expert_enhanced_11_0_gpu0 [label=nvlink]
	token_dist_local_11 -> expert_enhanced_11_1_gpu0 [label=nvlink]
	token_dist_cross_11 -> expert_enhanced_11_61_gpu0 [label=infiniband]
	token_dist_cross_11 -> expert_enhanced_11_62_gpu0 [label=infiniband]
	expert_enhanced_11_0_gpu0 -> expert_enhanced_11_0_gpu1 [label=tp_coord]
	expert_enhanced_11_0_gpu1 -> expert_merge_enhanced_11_0 [label=async]
	expert_merge_enhanced_11_0 -> expert_agg_enhanced_11 [label=priority]
	expert_merge_enhanced_11_1 -> expert_agg_enhanced_11 [label=priority]
	expert_agg_enhanced_11 -> add_2_enhanced_11 [label=checkpoint]
	add_1_11 -> add_2_enhanced_11 [label=residual]
	add_2_enhanced_11 -> pre_ln_12 [label=overlap_ready]
	pre_ln_12 -> mha_input_12 [label=async]
	mha_input_12 -> qkv_proj_12_gpu0 [label=broadcast]
	mha_input_12 -> qkv_proj_12_gpu1 [label=broadcast]
	qkv_proj_12_gpu0 -> flash_attn_12_gpu0 [label=fused]
	qkv_proj_12_gpu1 -> flash_attn_12_gpu1 [label=fused]
	flash_attn_12_gpu0 -> out_proj_12_gpu0 [label=flash]
	flash_attn_12_gpu1 -> out_proj_12_gpu1 [label=flash]
	out_proj_12_gpu0 -> mha_merge_12 [label=async]
	out_proj_12_gpu1 -> mha_merge_12 [label=async]
	mha_merge_12 -> add_1_12 [label=priority]
	add_2_enhanced_11 -> add_1_12 [label=residual]
	add_1_12 -> post_ln_12 [label=checkpoint]
	post_ln_12 -> enhanced_gate_12 [label=dynamic]
	enhanced_gate_12 -> token_dist_local_12 [label=local color=red style=dashed]
	enhanced_gate_12 -> token_dist_cross_12 [label=cross color=blue style=dashed]
	token_dist_local_12 -> expert_enhanced_12_0_gpu0 [label=nvlink]
	token_dist_local_12 -> expert_enhanced_12_1_gpu0 [label=nvlink]
	token_dist_cross_12 -> expert_enhanced_12_61_gpu0 [label=infiniband]
	token_dist_cross_12 -> expert_enhanced_12_62_gpu0 [label=infiniband]
	expert_enhanced_12_0_gpu0 -> expert_enhanced_12_0_gpu1 [label=tp_coord]
	expert_enhanced_12_0_gpu1 -> expert_merge_enhanced_12_0 [label=async]
	expert_merge_enhanced_12_0 -> expert_agg_enhanced_12 [label=priority]
	expert_merge_enhanced_12_1 -> expert_agg_enhanced_12 [label=priority]
	expert_agg_enhanced_12 -> add_2_enhanced_12 [label=checkpoint]
	add_1_12 -> add_2_enhanced_12 [label=residual]
	add_2_enhanced_12 -> pre_ln_13 [label=overlap_ready]
	pre_ln_13 -> mha_input_13 [label=async]
	mha_input_13 -> qkv_proj_13_gpu0 [label=broadcast]
	mha_input_13 -> qkv_proj_13_gpu1 [label=broadcast]
	qkv_proj_13_gpu0 -> flash_attn_13_gpu0 [label=fused]
	qkv_proj_13_gpu1 -> flash_attn_13_gpu1 [label=fused]
	flash_attn_13_gpu0 -> out_proj_13_gpu0 [label=flash]
	flash_attn_13_gpu1 -> out_proj_13_gpu1 [label=flash]
	out_proj_13_gpu0 -> mha_merge_13 [label=async]
	out_proj_13_gpu1 -> mha_merge_13 [label=async]
	mha_merge_13 -> add_1_13 [label=priority]
	add_2_enhanced_12 -> add_1_13 [label=residual]
	add_1_13 -> post_ln_13 [label=checkpoint]
	post_ln_13 -> enhanced_gate_13 [label=dynamic]
	enhanced_gate_13 -> token_dist_local_13 [label=local color=red style=dashed]
	enhanced_gate_13 -> token_dist_cross_13 [label=cross color=blue style=dashed]
	token_dist_local_13 -> expert_enhanced_13_0_gpu0 [label=nvlink]
	token_dist_local_13 -> expert_enhanced_13_1_gpu0 [label=nvlink]
	token_dist_cross_13 -> expert_enhanced_13_61_gpu0 [label=infiniband]
	token_dist_cross_13 -> expert_enhanced_13_62_gpu0 [label=infiniband]
	expert_enhanced_13_0_gpu0 -> expert_enhanced_13_0_gpu1 [label=tp_coord]
	expert_enhanced_13_0_gpu1 -> expert_merge_enhanced_13_0 [label=async]
	expert_merge_enhanced_13_0 -> expert_agg_enhanced_13 [label=priority]
	expert_merge_enhanced_13_1 -> expert_agg_enhanced_13 [label=priority]
	expert_agg_enhanced_13 -> add_2_enhanced_13 [label=checkpoint]
	add_1_13 -> add_2_enhanced_13 [label=residual]
	add_2_enhanced_13 -> pre_ln_14 [label=overlap_ready]
	pre_ln_14 -> mha_input_14 [label=async]
	mha_input_14 -> qkv_proj_14_gpu0 [label=broadcast]
	mha_input_14 -> qkv_proj_14_gpu1 [label=broadcast]
	qkv_proj_14_gpu0 -> flash_attn_14_gpu0 [label=fused]
	qkv_proj_14_gpu1 -> flash_attn_14_gpu1 [label=fused]
	flash_attn_14_gpu0 -> out_proj_14_gpu0 [label=flash]
	flash_attn_14_gpu1 -> out_proj_14_gpu1 [label=flash]
	out_proj_14_gpu0 -> mha_merge_14 [label=async]
	out_proj_14_gpu1 -> mha_merge_14 [label=async]
	mha_merge_14 -> add_1_14 [label=priority]
	add_2_enhanced_13 -> add_1_14 [label=residual]
	add_1_14 -> post_ln_14 [label=checkpoint]
	post_ln_14 -> enhanced_gate_14 [label=dynamic]
	enhanced_gate_14 -> token_dist_local_14 [label=local color=red style=dashed]
	enhanced_gate_14 -> token_dist_cross_14 [label=cross color=blue style=dashed]
	token_dist_local_14 -> expert_enhanced_14_0_gpu0 [label=nvlink]
	token_dist_local_14 -> expert_enhanced_14_1_gpu0 [label=nvlink]
	token_dist_cross_14 -> expert_enhanced_14_61_gpu0 [label=infiniband]
	token_dist_cross_14 -> expert_enhanced_14_62_gpu0 [label=infiniband]
	expert_enhanced_14_0_gpu0 -> expert_enhanced_14_0_gpu1 [label=tp_coord]
	expert_enhanced_14_0_gpu1 -> expert_merge_enhanced_14_0 [label=async]
	expert_merge_enhanced_14_0 -> expert_agg_enhanced_14 [label=priority]
	expert_merge_enhanced_14_1 -> expert_agg_enhanced_14 [label=priority]
	expert_agg_enhanced_14 -> add_2_enhanced_14 [label=checkpoint]
	add_1_14 -> add_2_enhanced_14 [label=residual]
	add_2_enhanced_14 -> pre_ln_15 [label=overlap_ready]
	pre_ln_15 -> mha_input_15 [label=async]
	mha_input_15 -> qkv_proj_15_gpu0 [label=broadcast]
	mha_input_15 -> qkv_proj_15_gpu1 [label=broadcast]
	qkv_proj_15_gpu0 -> flash_attn_15_gpu0 [label=fused]
	qkv_proj_15_gpu1 -> flash_attn_15_gpu1 [label=fused]
	flash_attn_15_gpu0 -> out_proj_15_gpu0 [label=flash]
	flash_attn_15_gpu1 -> out_proj_15_gpu1 [label=flash]
	out_proj_15_gpu0 -> mha_merge_15 [label=async]
	out_proj_15_gpu1 -> mha_merge_15 [label=async]
	mha_merge_15 -> add_1_15 [label=priority]
	add_2_enhanced_14 -> add_1_15 [label=residual]
	add_1_15 -> post_ln_15 [label=checkpoint]
	post_ln_15 -> enhanced_gate_15 [label=dynamic]
	enhanced_gate_15 -> token_dist_local_15 [label=local color=red style=dashed]
	enhanced_gate_15 -> token_dist_cross_15 [label=cross color=blue style=dashed]
	token_dist_local_15 -> expert_enhanced_15_0_gpu0 [label=nvlink]
	token_dist_local_15 -> expert_enhanced_15_1_gpu0 [label=nvlink]
	token_dist_cross_15 -> expert_enhanced_15_61_gpu0 [label=infiniband]
	token_dist_cross_15 -> expert_enhanced_15_62_gpu0 [label=infiniband]
	expert_enhanced_15_0_gpu0 -> expert_enhanced_15_0_gpu1 [label=tp_coord]
	expert_enhanced_15_0_gpu1 -> expert_merge_enhanced_15_0 [label=async]
	expert_merge_enhanced_15_0 -> expert_agg_enhanced_15 [label=priority]
	expert_merge_enhanced_15_1 -> expert_agg_enhanced_15 [label=priority]
	expert_agg_enhanced_15 -> add_2_enhanced_15 [label=checkpoint]
	add_1_15 -> add_2_enhanced_15 [label=residual]
	add_2_enhanced_15 -> output_enhanced [label=async_writeback]
}
