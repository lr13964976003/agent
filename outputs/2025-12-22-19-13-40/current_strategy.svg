<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: CurrentStrategy Pages: 1 -->
<svg width="908pt" height="2689pt"
 viewBox="0.00 0.00 908.00 2689.19" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2685.19)">
<title>CurrentStrategy</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2685.19 904,-2685.19 904,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_stage0</title>
<path fill="none" stroke="black" d="M20,-1360.82C20,-1360.82 812,-1360.82 812,-1360.82 818,-1360.82 824,-1366.82 824,-1372.82 824,-1372.82 824,-2603.21 824,-2603.21 824,-2609.21 818,-2615.21 812,-2615.21 812,-2615.21 20,-2615.21 20,-2615.21 14,-2615.21 8,-2609.21 8,-2603.21 8,-2603.21 8,-1372.82 8,-1372.82 8,-1366.82 14,-1360.82 20,-1360.82"/>
<text text-anchor="middle" x="416" y="-2600.01" font-family="Times,serif" font-size="14.00">Pipeline Stage 0 (Layers 0&#45;7)</text>
<text text-anchor="middle" x="416" y="-2585.01" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;1023</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_layer0_attn</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="317,-2115.78 317,-2569.21 502,-2569.21 502,-2115.78 317,-2115.78"/>
<text text-anchor="middle" x="409.5" y="-2554.01" font-family="Times,serif" font-size="14.00">Layer 0 Attention (TP8)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_layer0_moe</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="16,-1368.82 16,-2082.78 816,-2082.78 816,-1368.82 16,-1368.82"/>
<text text-anchor="middle" x="416" y="-2067.58" font-family="Times,serif" font-size="14.00">Layer 0 MoE (EP64)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_stage1</title>
<path fill="none" stroke="black" d="M88,-98.43C88,-98.43 880,-98.43 880,-98.43 886,-98.43 892,-104.43 892,-110.43 892,-110.43 892,-1340.82 892,-1340.82 892,-1346.82 886,-1352.82 880,-1352.82 880,-1352.82 88,-1352.82 88,-1352.82 82,-1352.82 76,-1346.82 76,-1340.82 76,-1340.82 76,-110.43 76,-110.43 76,-104.43 82,-98.43 88,-98.43"/>
<text text-anchor="middle" x="484" y="-1337.62" font-family="Times,serif" font-size="14.00">Pipeline Stage 1 (Layers 8&#45;15)</text>
<text text-anchor="middle" x="484" y="-1322.62" font-family="Times,serif" font-size="14.00">GPUs: 1024&#45;2047</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_layer8_attn</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="317,-853.39 317,-1306.82 502,-1306.82 502,-853.39 317,-853.39"/>
<text text-anchor="middle" x="409.5" y="-1291.62" font-family="Times,serif" font-size="14.00">Layer 8 Attention (TP8)</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_layer8_moe</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="84,-106.43 84,-820.39 884,-820.39 884,-106.43 84,-106.43"/>
<text text-anchor="middle" x="484" y="-805.19" font-family="Times,serif" font-size="14.00">Layer 8 MoE (EP64)</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="white" stroke="black" cx="409" cy="-2652.2" rx="101.23" ry="28.98"/>
<text text-anchor="middle" x="409" y="-2660.7" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="409" y="-2649.7" font-family="Arial" font-size="10.00">[BS=128, SL=1024, H=1024]</text>
<text text-anchor="middle" x="409" y="-2638.7" font-family="Arial" font-size="10.00">DP2: 64 seqs per replica</text>
</g>
<!-- l0_attn_qkv -->
<g id="node2" class="node">
<title>l0_attn_qkv</title>
<polygon fill="lightblue" stroke="black" points="460.5,-2538.21 357.5,-2538.21 357.5,-2486.21 460.5,-2486.21 460.5,-2538.21"/>
<text text-anchor="middle" x="409" y="-2526.21" font-family="Arial" font-size="10.00">L0&#45;Attention&#45;QKV</text>
<text text-anchor="middle" x="409" y="-2515.21" font-family="Arial" font-size="10.00">TP8[0&#45;7]</text>
<text text-anchor="middle" x="409" y="-2504.21" font-family="Arial" font-size="10.00">In: [64,1024,1024]</text>
<text text-anchor="middle" x="409" y="-2493.21" font-family="Arial" font-size="10.00">Out: [64,1024,3072]</text>
</g>
<!-- input&#45;&gt;l0_attn_qkv -->
<g id="edge1" class="edge">
<title>input&#45;&gt;l0_attn_qkv</title>
<path fill="none" stroke="black" d="M409,-2622.94C409,-2601.47 409,-2571.8 409,-2548.73"/>
<polygon fill="black" stroke="black" points="412.5,-2548.64 409,-2538.64 405.5,-2548.64 412.5,-2548.64"/>
</g>
<!-- l0_attn_allreduce -->
<g id="node5" class="node">
<title>l0_attn_allreduce</title>
<ellipse fill="lightgreen" stroke="black" cx="409" cy="-2393" rx="82.96" ry="21.43"/>
<text text-anchor="middle" x="409" y="-2396" font-family="Arial" font-size="10.00">L0&#45;Attention&#45;AllReduce</text>
<text text-anchor="middle" x="409" y="-2385" font-family="Arial" font-size="10.00">TP8[0&#45;7]</text>
</g>
<!-- l0_attn_qkv&#45;&gt;l0_attn_allreduce -->
<g id="edge2" class="edge">
<title>l0_attn_qkv&#45;&gt;l0_attn_allreduce</title>
<path fill="none" stroke="black" d="M409,-2486.07C409,-2468.02 409,-2443.6 409,-2424.45"/>
<polygon fill="black" stroke="black" points="412.5,-2424.42 409,-2414.42 405.5,-2424.42 412.5,-2424.42"/>
</g>
<!-- l0_attn_score -->
<g id="node3" class="node">
<title>l0_attn_score</title>
<polygon fill="lightblue" stroke="black" points="467,-2299.78 351,-2299.78 351,-2247.78 467,-2247.78 467,-2299.78"/>
<text text-anchor="middle" x="409" y="-2287.78" font-family="Arial" font-size="10.00">L0&#45;Attention&#45;Score</text>
<text text-anchor="middle" x="409" y="-2276.78" font-family="Arial" font-size="10.00">TP8[0&#45;7]</text>
<text text-anchor="middle" x="409" y="-2265.78" font-family="Arial" font-size="10.00">In: [64,16,1024,64]</text>
<text text-anchor="middle" x="409" y="-2254.78" font-family="Arial" font-size="10.00">Out: [64,16,1024,1024]</text>
</g>
<!-- l0_attn_out -->
<g id="node4" class="node">
<title>l0_attn_out</title>
<polygon fill="lightblue" stroke="black" points="460.5,-2175.78 357.5,-2175.78 357.5,-2123.78 460.5,-2123.78 460.5,-2175.78"/>
<text text-anchor="middle" x="409" y="-2163.78" font-family="Arial" font-size="10.00">L0&#45;Attention&#45;Output</text>
<text text-anchor="middle" x="409" y="-2152.78" font-family="Arial" font-size="10.00">TP8[0&#45;7]</text>
<text text-anchor="middle" x="409" y="-2141.78" font-family="Arial" font-size="10.00">In: [64,1024,1024]</text>
<text text-anchor="middle" x="409" y="-2130.78" font-family="Arial" font-size="10.00">Out: [64,1024,1024]</text>
</g>
<!-- l0_attn_score&#45;&gt;l0_attn_out -->
<g id="edge4" class="edge">
<title>l0_attn_score&#45;&gt;l0_attn_out</title>
<path fill="none" stroke="black" d="M409,-2247.51C409,-2229.76 409,-2205.78 409,-2186.14"/>
<polygon fill="black" stroke="black" points="412.5,-2186.03 409,-2176.03 405.5,-2186.03 412.5,-2186.03"/>
</g>
<!-- l0_route -->
<g id="node6" class="node">
<title>l0_route</title>
<polygon fill="lightyellow" stroke="black" points="515.57,-2051.78 346.04,-2051.78 302.43,-1947.78 471.96,-1947.78 515.57,-2051.78"/>
<text text-anchor="middle" x="409" y="-2013.78" font-family="Arial" font-size="10.00">L0&#45;Expert&#45;Routing</text>
<text text-anchor="middle" x="409" y="-2002.78" font-family="Arial" font-size="10.00">EP64[0&#45;63]</text>
<text text-anchor="middle" x="409" y="-1991.78" font-family="Arial" font-size="10.00">In: [64,1024,1024]</text>
<text text-anchor="middle" x="409" y="-1980.78" font-family="Arial" font-size="10.00">Out: [64,1024,1024]</text>
</g>
<!-- l0_attn_out&#45;&gt;l0_route -->
<g id="edge5" class="edge">
<title>l0_attn_out&#45;&gt;l0_route</title>
<path fill="none" stroke="black" d="M409,-2123.68C409,-2106.73 409,-2083.6 409,-2061.97"/>
<polygon fill="black" stroke="black" points="412.5,-2061.84 409,-2051.84 405.5,-2061.84 412.5,-2061.84"/>
</g>
<!-- l0_attn_allreduce&#45;&gt;l0_attn_score -->
<g id="edge3" class="edge">
<title>l0_attn_allreduce&#45;&gt;l0_attn_score</title>
<path fill="none" stroke="black" d="M409,-2371.58C409,-2354.6 409,-2330.05 409,-2309.92"/>
<polygon fill="black" stroke="black" points="412.5,-2309.86 409,-2299.86 405.5,-2309.86 412.5,-2309.86"/>
</g>
<!-- l0_dispatch -->
<g id="node7" class="node">
<title>l0_dispatch</title>
<ellipse fill="lightgreen" stroke="black" cx="409" cy="-1846.79" rx="71.34" ry="28.98"/>
<text text-anchor="middle" x="409" y="-1855.29" font-family="Arial" font-size="10.00">L0&#45;Expert&#45;Dispatch</text>
<text text-anchor="middle" x="409" y="-1844.29" font-family="Arial" font-size="10.00">EP64[0&#45;63]</text>
<text text-anchor="middle" x="409" y="-1833.29" font-family="Arial" font-size="10.00">All&#45;to&#45;All</text>
</g>
<!-- l0_route&#45;&gt;l0_dispatch -->
<g id="edge6" class="edge">
<title>l0_route&#45;&gt;l0_dispatch</title>
<path fill="none" stroke="black" d="M409,-1947.67C409,-1927.55 409,-1904.84 409,-1886.17"/>
<polygon fill="black" stroke="black" points="412.5,-1885.97 409,-1875.97 405.5,-1885.97 412.5,-1885.97"/>
</g>
<!-- l0_expert_0_3 -->
<g id="node8" class="node">
<title>l0_expert_0_3</title>
<polygon fill="lightblue" stroke="black" points="122,-1745.8 24,-1745.8 24,-1682.8 122,-1682.8 122,-1745.8"/>
<text text-anchor="middle" x="73" y="-1733.8" font-family="Arial" font-size="10.00">L0&#45;Experts&#45;0&#45;3</text>
<text text-anchor="middle" x="73" y="-1722.8" font-family="Arial" font-size="10.00">EP64[0&#45;63]</text>
<text text-anchor="middle" x="73" y="-1711.8" font-family="Arial" font-size="10.00">(4 experts)</text>
<text text-anchor="middle" x="73" y="-1700.8" font-family="Arial" font-size="10.00">In: [4,1024,1024]</text>
<text text-anchor="middle" x="73" y="-1689.8" font-family="Arial" font-size="10.00">Out: [4,1024,1024]</text>
</g>
<!-- l0_dispatch&#45;&gt;l0_expert_0_3 -->
<g id="edge7" class="edge">
<title>l0_dispatch&#45;&gt;l0_expert_0_3</title>
<path fill="none" stroke="black" d="M355.99,-1827.35C301.43,-1808.07 214.15,-1776.41 140,-1745.8 137.2,-1744.64 134.34,-1743.44 131.46,-1742.2"/>
<polygon fill="black" stroke="black" points="132.79,-1738.97 122.22,-1738.19 130,-1745.39 132.79,-1738.97"/>
</g>
<!-- l0_expert_4_7 -->
<g id="node9" class="node">
<title>l0_expert_4_7</title>
<polygon fill="lightblue" stroke="black" points="256,-1745.8 158,-1745.8 158,-1682.8 256,-1682.8 256,-1745.8"/>
<text text-anchor="middle" x="207" y="-1733.8" font-family="Arial" font-size="10.00">L0&#45;Experts&#45;4&#45;7</text>
<text text-anchor="middle" x="207" y="-1722.8" font-family="Arial" font-size="10.00">EP64[64&#45;127]</text>
<text text-anchor="middle" x="207" y="-1711.8" font-family="Arial" font-size="10.00">(4 experts)</text>
<text text-anchor="middle" x="207" y="-1700.8" font-family="Arial" font-size="10.00">In: [4,1024,1024]</text>
<text text-anchor="middle" x="207" y="-1689.8" font-family="Arial" font-size="10.00">Out: [4,1024,1024]</text>
</g>
<!-- l0_dispatch&#45;&gt;l0_expert_4_7 -->
<g id="edge8" class="edge">
<title>l0_dispatch&#45;&gt;l0_expert_4_7</title>
<path fill="none" stroke="black" d="M371.95,-1821.86C341.5,-1802.19 297.88,-1774.01 263.14,-1751.57"/>
<polygon fill="black" stroke="black" points="264.81,-1748.48 254.51,-1745.99 261.01,-1754.36 264.81,-1748.48"/>
</g>
<!-- l0_expert_8_15 -->
<g id="node10" class="node">
<title>l0_expert_8_15</title>
<polygon fill="lightblue" stroke="black" points="390,-1745.8 292,-1745.8 292,-1682.8 390,-1682.8 390,-1745.8"/>
<text text-anchor="middle" x="341" y="-1733.8" font-family="Arial" font-size="10.00">L0&#45;Experts&#45;8&#45;15</text>
<text text-anchor="middle" x="341" y="-1722.8" font-family="Arial" font-size="10.00">EP64[128&#45;255]</text>
<text text-anchor="middle" x="341" y="-1711.8" font-family="Arial" font-size="10.00">(8 experts)</text>
<text text-anchor="middle" x="341" y="-1700.8" font-family="Arial" font-size="10.00">In: [8,1024,1024]</text>
<text text-anchor="middle" x="341" y="-1689.8" font-family="Arial" font-size="10.00">Out: [8,1024,1024]</text>
</g>
<!-- l0_dispatch&#45;&gt;l0_expert_8_15 -->
<g id="edge9" class="edge">
<title>l0_dispatch&#45;&gt;l0_expert_8_15</title>
<path fill="none" stroke="black" d="M394.58,-1818.12C385.05,-1799.82 372.4,-1775.55 361.78,-1755.18"/>
<polygon fill="black" stroke="black" points="364.79,-1753.38 357.07,-1746.13 358.58,-1756.62 364.79,-1753.38"/>
</g>
<!-- l0_expert_16_31 -->
<g id="node11" class="node">
<title>l0_expert_16_31</title>
<polygon fill="lightblue" stroke="black" points="529.5,-1745.8 426.5,-1745.8 426.5,-1682.8 529.5,-1682.8 529.5,-1745.8"/>
<text text-anchor="middle" x="478" y="-1733.8" font-family="Arial" font-size="10.00">L0&#45;Experts&#45;16&#45;31</text>
<text text-anchor="middle" x="478" y="-1722.8" font-family="Arial" font-size="10.00">EP64[256&#45;511]</text>
<text text-anchor="middle" x="478" y="-1711.8" font-family="Arial" font-size="10.00">(16 experts)</text>
<text text-anchor="middle" x="478" y="-1700.8" font-family="Arial" font-size="10.00">In: [16,1024,1024]</text>
<text text-anchor="middle" x="478" y="-1689.8" font-family="Arial" font-size="10.00">Out: [16,1024,1024]</text>
</g>
<!-- l0_dispatch&#45;&gt;l0_expert_16_31 -->
<g id="edge10" class="edge">
<title>l0_dispatch&#45;&gt;l0_expert_16_31</title>
<path fill="none" stroke="black" d="M423.63,-1818.12C433.31,-1799.82 446.14,-1775.55 456.91,-1755.18"/>
<polygon fill="black" stroke="black" points="460.12,-1756.61 461.7,-1746.13 453.93,-1753.34 460.12,-1756.61"/>
</g>
<!-- l0_expert_32_47 -->
<g id="node12" class="node">
<title>l0_expert_32_47</title>
<polygon fill="lightblue" stroke="black" points="668.5,-1745.8 565.5,-1745.8 565.5,-1682.8 668.5,-1682.8 668.5,-1745.8"/>
<text text-anchor="middle" x="617" y="-1733.8" font-family="Arial" font-size="10.00">L0&#45;Experts&#45;32&#45;47</text>
<text text-anchor="middle" x="617" y="-1722.8" font-family="Arial" font-size="10.00">EP64[512&#45;767]</text>
<text text-anchor="middle" x="617" y="-1711.8" font-family="Arial" font-size="10.00">(16 experts)</text>
<text text-anchor="middle" x="617" y="-1700.8" font-family="Arial" font-size="10.00">In: [16,1024,1024]</text>
<text text-anchor="middle" x="617" y="-1689.8" font-family="Arial" font-size="10.00">Out: [16,1024,1024]</text>
</g>
<!-- l0_dispatch&#45;&gt;l0_expert_32_47 -->
<g id="edge11" class="edge">
<title>l0_dispatch&#45;&gt;l0_expert_32_47</title>
<path fill="none" stroke="black" d="M447.15,-1821.86C478.5,-1802.19 523.42,-1774.01 559.19,-1751.57"/>
<polygon fill="black" stroke="black" points="561.47,-1754.27 568.08,-1745.99 557.75,-1748.34 561.47,-1754.27"/>
</g>
<!-- l0_expert_48_63 -->
<g id="node13" class="node">
<title>l0_expert_48_63</title>
<polygon fill="lightblue" stroke="black" points="807.5,-1745.8 704.5,-1745.8 704.5,-1682.8 807.5,-1682.8 807.5,-1745.8"/>
<text text-anchor="middle" x="756" y="-1733.8" font-family="Arial" font-size="10.00">L0&#45;Experts&#45;48&#45;63</text>
<text text-anchor="middle" x="756" y="-1722.8" font-family="Arial" font-size="10.00">EP64[768&#45;1023]</text>
<text text-anchor="middle" x="756" y="-1711.8" font-family="Arial" font-size="10.00">(16 experts)</text>
<text text-anchor="middle" x="756" y="-1700.8" font-family="Arial" font-size="10.00">In: [16,1024,1024]</text>
<text text-anchor="middle" x="756" y="-1689.8" font-family="Arial" font-size="10.00">Out: [16,1024,1024]</text>
</g>
<!-- l0_dispatch&#45;&gt;l0_expert_48_63 -->
<g id="edge12" class="edge">
<title>l0_dispatch&#45;&gt;l0_expert_48_63</title>
<path fill="none" stroke="black" d="M462.98,-1827.65C519.3,-1808.42 609.98,-1776.63 687,-1745.8 689.53,-1744.79 692.11,-1743.74 694.71,-1742.66"/>
<polygon fill="black" stroke="black" points="696.31,-1745.78 704.17,-1738.68 693.6,-1739.33 696.31,-1745.78"/>
</g>
<!-- l0_combine -->
<g id="node14" class="node">
<title>l0_combine</title>
<polygon fill="lightyellow" stroke="black" points="515.57,-1610.8 346.04,-1610.8 302.43,-1506.8 471.96,-1506.8 515.57,-1610.8"/>
<text text-anchor="middle" x="409" y="-1572.8" font-family="Arial" font-size="10.00">L0&#45;Expert&#45;Combine</text>
<text text-anchor="middle" x="409" y="-1561.8" font-family="Arial" font-size="10.00">EP64[0&#45;63]</text>
<text text-anchor="middle" x="409" y="-1550.8" font-family="Arial" font-size="10.00">In: [64,1024,1024]</text>
<text text-anchor="middle" x="409" y="-1539.8" font-family="Arial" font-size="10.00">Out: [64,1024,1024]</text>
</g>
<!-- l0_expert_0_3&#45;&gt;l0_combine -->
<g id="edge13" class="edge">
<title>l0_expert_0_3&#45;&gt;l0_combine</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M122.22,-1690.82C176.42,-1666.05 264.41,-1625.86 328.64,-1596.51"/>
<polygon fill="black" stroke="black" points="330.3,-1599.6 337.94,-1592.26 327.39,-1593.24 330.3,-1599.6"/>
</g>
<!-- l0_expert_4_7&#45;&gt;l0_combine -->
<g id="edge14" class="edge">
<title>l0_expert_4_7&#45;&gt;l0_combine</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M247.39,-1682.61C272.97,-1663.17 306.77,-1637.48 336.85,-1614.63"/>
<polygon fill="black" stroke="black" points="338.97,-1617.41 344.82,-1608.57 334.74,-1611.84 338.97,-1617.41"/>
</g>
<!-- l0_expert_8_15&#45;&gt;l0_combine -->
<g id="edge15" class="edge">
<title>l0_expert_8_15&#45;&gt;l0_combine</title>
<path fill="none" stroke="black" d="M354.6,-1682.61C362.5,-1664.77 372.73,-1641.67 382.19,-1620.33"/>
<polygon fill="black" stroke="black" points="385.47,-1621.55 386.32,-1610.99 379.07,-1618.72 385.47,-1621.55"/>
</g>
<!-- l0_expert_16_31&#45;&gt;l0_combine -->
<g id="edge16" class="edge">
<title>l0_expert_16_31&#45;&gt;l0_combine</title>
<path fill="none" stroke="black" d="M464.2,-1682.61C456.19,-1664.77 445.8,-1641.67 436.21,-1620.33"/>
<polygon fill="black" stroke="black" points="439.3,-1618.68 432.01,-1610.99 432.92,-1621.55 439.3,-1618.68"/>
</g>
<!-- l0_expert_32_47&#45;&gt;l0_combine -->
<g id="edge17" class="edge">
<title>l0_expert_32_47&#45;&gt;l0_combine</title>
<path fill="none" stroke="black" d="M575.41,-1682.61C550.05,-1663.89 516.84,-1639.38 486.76,-1617.19"/>
<polygon fill="black" stroke="black" points="488.49,-1614.11 478.37,-1610.99 484.34,-1619.75 488.49,-1614.11"/>
</g>
<!-- l0_expert_48_63&#45;&gt;l0_combine -->
<g id="edge18" class="edge">
<title>l0_expert_48_63&#45;&gt;l0_combine</title>
<path fill="none" stroke="black" d="M704.43,-1690.49C656.75,-1669.4 584.23,-1637.32 522.98,-1610.22"/>
<polygon fill="black" stroke="black" points="524.2,-1606.93 513.64,-1606.09 521.37,-1613.34 524.2,-1606.93"/>
</g>
<!-- l0_combine_alltoall -->
<g id="node15" class="node">
<title>l0_combine_alltoall</title>
<ellipse fill="lightgreen" stroke="black" cx="409" cy="-1405.81" rx="71.34" ry="28.98"/>
<text text-anchor="middle" x="409" y="-1414.31" font-family="Arial" font-size="10.00">L0&#45;Expert&#45;Combine</text>
<text text-anchor="middle" x="409" y="-1403.31" font-family="Arial" font-size="10.00">EP64[0&#45;63]</text>
<text text-anchor="middle" x="409" y="-1392.31" font-family="Arial" font-size="10.00">All&#45;to&#45;All</text>
</g>
<!-- l0_combine&#45;&gt;l0_combine_alltoall -->
<g id="edge19" class="edge">
<title>l0_combine&#45;&gt;l0_combine_alltoall</title>
<path fill="none" stroke="black" d="M409,-1506.68C409,-1486.56 409,-1463.86 409,-1445.19"/>
<polygon fill="black" stroke="black" points="412.5,-1444.99 409,-1434.99 405.5,-1444.99 412.5,-1444.99"/>
</g>
<!-- l8_attn_qkv -->
<g id="node16" class="node">
<title>l8_attn_qkv</title>
<polygon fill="lightblue" stroke="black" points="460.5,-1275.82 357.5,-1275.82 357.5,-1223.82 460.5,-1223.82 460.5,-1275.82"/>
<text text-anchor="middle" x="409" y="-1263.82" font-family="Arial" font-size="10.00">L8&#45;Attention&#45;QKV</text>
<text text-anchor="middle" x="409" y="-1252.82" font-family="Arial" font-size="10.00">TP8[1024&#45;1031]</text>
<text text-anchor="middle" x="409" y="-1241.82" font-family="Arial" font-size="10.00">In: [64,1024,1024]</text>
<text text-anchor="middle" x="409" y="-1230.82" font-family="Arial" font-size="10.00">Out: [64,1024,3072]</text>
</g>
<!-- l0_combine_alltoall&#45;&gt;l8_attn_qkv -->
<g id="edge20" class="edge">
<title>l0_combine_alltoall&#45;&gt;l8_attn_qkv</title>
<path fill="none" stroke="black" d="M409,-1376.57C409,-1351.12 409,-1313.6 409,-1286.17"/>
<polygon fill="black" stroke="black" points="412.5,-1285.83 409,-1275.83 405.5,-1285.83 412.5,-1285.83"/>
</g>
<!-- l8_attn_allreduce -->
<g id="node19" class="node">
<title>l8_attn_allreduce</title>
<ellipse fill="lightgreen" stroke="black" cx="409" cy="-1130.61" rx="82.96" ry="21.43"/>
<text text-anchor="middle" x="409" y="-1133.61" font-family="Arial" font-size="10.00">L8&#45;Attention&#45;AllReduce</text>
<text text-anchor="middle" x="409" y="-1122.61" font-family="Arial" font-size="10.00">TP8[1024&#45;1031]</text>
</g>
<!-- l8_attn_qkv&#45;&gt;l8_attn_allreduce -->
<g id="edge21" class="edge">
<title>l8_attn_qkv&#45;&gt;l8_attn_allreduce</title>
<path fill="none" stroke="black" d="M409,-1223.67C409,-1205.62 409,-1181.21 409,-1162.05"/>
<polygon fill="black" stroke="black" points="412.5,-1162.03 409,-1152.03 405.5,-1162.03 412.5,-1162.03"/>
</g>
<!-- l8_attn_score -->
<g id="node17" class="node">
<title>l8_attn_score</title>
<polygon fill="lightblue" stroke="black" points="467,-1037.39 351,-1037.39 351,-985.39 467,-985.39 467,-1037.39"/>
<text text-anchor="middle" x="409" y="-1025.39" font-family="Arial" font-size="10.00">L8&#45;Attention&#45;Score</text>
<text text-anchor="middle" x="409" y="-1014.39" font-family="Arial" font-size="10.00">TP8[1024&#45;1031]</text>
<text text-anchor="middle" x="409" y="-1003.39" font-family="Arial" font-size="10.00">In: [64,16,1024,64]</text>
<text text-anchor="middle" x="409" y="-992.39" font-family="Arial" font-size="10.00">Out: [64,16,1024,1024]</text>
</g>
<!-- l8_attn_out -->
<g id="node18" class="node">
<title>l8_attn_out</title>
<polygon fill="lightblue" stroke="black" points="460.5,-913.39 357.5,-913.39 357.5,-861.39 460.5,-861.39 460.5,-913.39"/>
<text text-anchor="middle" x="409" y="-901.39" font-family="Arial" font-size="10.00">L8&#45;Attention&#45;Output</text>
<text text-anchor="middle" x="409" y="-890.39" font-family="Arial" font-size="10.00">TP8[1024&#45;1031]</text>
<text text-anchor="middle" x="409" y="-879.39" font-family="Arial" font-size="10.00">In: [64,1024,1024]</text>
<text text-anchor="middle" x="409" y="-868.39" font-family="Arial" font-size="10.00">Out: [64,1024,1024]</text>
</g>
<!-- l8_attn_score&#45;&gt;l8_attn_out -->
<g id="edge23" class="edge">
<title>l8_attn_score&#45;&gt;l8_attn_out</title>
<path fill="none" stroke="black" d="M409,-985.11C409,-967.37 409,-943.39 409,-923.75"/>
<polygon fill="black" stroke="black" points="412.5,-923.64 409,-913.64 405.5,-923.64 412.5,-923.64"/>
</g>
<!-- l8_route -->
<g id="node20" class="node">
<title>l8_route</title>
<polygon fill="lightyellow" stroke="black" points="515.57,-789.39 346.04,-789.39 302.43,-685.39 471.96,-685.39 515.57,-789.39"/>
<text text-anchor="middle" x="409" y="-751.39" font-family="Arial" font-size="10.00">L8&#45;Expert&#45;Routing</text>
<text text-anchor="middle" x="409" y="-740.39" font-family="Arial" font-size="10.00">EP64[1024&#45;1087]</text>
<text text-anchor="middle" x="409" y="-729.39" font-family="Arial" font-size="10.00">In: [64,1024,1024]</text>
<text text-anchor="middle" x="409" y="-718.39" font-family="Arial" font-size="10.00">Out: [64,1024,1024]</text>
</g>
<!-- l8_attn_out&#45;&gt;l8_route -->
<g id="edge24" class="edge">
<title>l8_attn_out&#45;&gt;l8_route</title>
<path fill="none" stroke="black" d="M409,-861.29C409,-844.34 409,-821.21 409,-799.58"/>
<polygon fill="black" stroke="black" points="412.5,-799.44 409,-789.44 405.5,-799.44 412.5,-799.44"/>
</g>
<!-- l8_attn_allreduce&#45;&gt;l8_attn_score -->
<g id="edge22" class="edge">
<title>l8_attn_allreduce&#45;&gt;l8_attn_score</title>
<path fill="none" stroke="black" d="M409,-1109.19C409,-1092.21 409,-1067.65 409,-1047.52"/>
<polygon fill="black" stroke="black" points="412.5,-1047.47 409,-1037.47 405.5,-1047.47 412.5,-1047.47"/>
</g>
<!-- l8_dispatch -->
<g id="node21" class="node">
<title>l8_dispatch</title>
<ellipse fill="lightgreen" stroke="black" cx="409" cy="-584.4" rx="71.34" ry="28.98"/>
<text text-anchor="middle" x="409" y="-592.9" font-family="Arial" font-size="10.00">L8&#45;Expert&#45;Dispatch</text>
<text text-anchor="middle" x="409" y="-581.9" font-family="Arial" font-size="10.00">EP64[1024&#45;1087]</text>
<text text-anchor="middle" x="409" y="-570.9" font-family="Arial" font-size="10.00">All&#45;to&#45;All</text>
</g>
<!-- l8_route&#45;&gt;l8_dispatch -->
<g id="edge25" class="edge">
<title>l8_route&#45;&gt;l8_dispatch</title>
<path fill="none" stroke="black" d="M409,-685.27C409,-665.15 409,-642.45 409,-623.78"/>
<polygon fill="black" stroke="black" points="412.5,-623.58 409,-613.58 405.5,-623.58 412.5,-623.58"/>
</g>
<!-- l8_expert_0_3 -->
<g id="node22" class="node">
<title>l8_expert_0_3</title>
<polygon fill="lightblue" stroke="black" points="190,-483.41 92,-483.41 92,-420.41 190,-420.41 190,-483.41"/>
<text text-anchor="middle" x="141" y="-471.41" font-family="Arial" font-size="10.00">L8&#45;Experts&#45;0&#45;3</text>
<text text-anchor="middle" x="141" y="-460.41" font-family="Arial" font-size="10.00">EP64[1024&#45;1087]</text>
<text text-anchor="middle" x="141" y="-449.41" font-family="Arial" font-size="10.00">(4 experts)</text>
<text text-anchor="middle" x="141" y="-438.41" font-family="Arial" font-size="10.00">In: [4,1024,1024]</text>
<text text-anchor="middle" x="141" y="-427.41" font-family="Arial" font-size="10.00">Out: [4,1024,1024]</text>
</g>
<!-- l8_dispatch&#45;&gt;l8_expert_0_3 -->
<g id="edge26" class="edge">
<title>l8_dispatch&#45;&gt;l8_expert_0_3</title>
<path fill="none" stroke="black" d="M364.44,-561.71C319.19,-539.67 248.87,-505.43 199.23,-481.26"/>
<polygon fill="black" stroke="black" points="200.73,-478.1 190.21,-476.87 197.67,-484.39 200.73,-478.1"/>
</g>
<!-- l8_expert_4_7 -->
<g id="node23" class="node">
<title>l8_expert_4_7</title>
<polygon fill="lightblue" stroke="black" points="324,-483.41 226,-483.41 226,-420.41 324,-420.41 324,-483.41"/>
<text text-anchor="middle" x="275" y="-471.41" font-family="Arial" font-size="10.00">L8&#45;Experts&#45;4&#45;7</text>
<text text-anchor="middle" x="275" y="-460.41" font-family="Arial" font-size="10.00">EP64[1088&#45;1151]</text>
<text text-anchor="middle" x="275" y="-449.41" font-family="Arial" font-size="10.00">(4 experts)</text>
<text text-anchor="middle" x="275" y="-438.41" font-family="Arial" font-size="10.00">In: [4,1024,1024]</text>
<text text-anchor="middle" x="275" y="-427.41" font-family="Arial" font-size="10.00">Out: [4,1024,1024]</text>
</g>
<!-- l8_dispatch&#45;&gt;l8_expert_4_7 -->
<g id="edge27" class="edge">
<title>l8_dispatch&#45;&gt;l8_expert_4_7</title>
<path fill="none" stroke="black" d="M382.21,-557.31C362.58,-538.2 335.65,-511.97 313.69,-490.59"/>
<polygon fill="black" stroke="black" points="316.06,-488.01 306.46,-483.54 311.18,-493.03 316.06,-488.01"/>
</g>
<!-- l8_expert_8_15 -->
<g id="node24" class="node">
<title>l8_expert_8_15</title>
<polygon fill="lightblue" stroke="black" points="458,-483.41 360,-483.41 360,-420.41 458,-420.41 458,-483.41"/>
<text text-anchor="middle" x="409" y="-471.41" font-family="Arial" font-size="10.00">L8&#45;Experts&#45;8&#45;15</text>
<text text-anchor="middle" x="409" y="-460.41" font-family="Arial" font-size="10.00">EP64[1152&#45;1279]</text>
<text text-anchor="middle" x="409" y="-449.41" font-family="Arial" font-size="10.00">(8 experts)</text>
<text text-anchor="middle" x="409" y="-438.41" font-family="Arial" font-size="10.00">In: [8,1024,1024]</text>
<text text-anchor="middle" x="409" y="-427.41" font-family="Arial" font-size="10.00">Out: [8,1024,1024]</text>
</g>
<!-- l8_dispatch&#45;&gt;l8_expert_8_15 -->
<g id="edge28" class="edge">
<title>l8_dispatch&#45;&gt;l8_expert_8_15</title>
<path fill="none" stroke="black" d="M409,-555.41C409,-537.42 409,-513.76 409,-493.7"/>
<polygon fill="black" stroke="black" points="412.5,-493.59 409,-483.59 405.5,-493.59 412.5,-493.59"/>
</g>
<!-- l8_expert_16_31 -->
<g id="node25" class="node">
<title>l8_expert_16_31</title>
<polygon fill="lightblue" stroke="black" points="597.5,-483.41 494.5,-483.41 494.5,-420.41 597.5,-420.41 597.5,-483.41"/>
<text text-anchor="middle" x="546" y="-471.41" font-family="Arial" font-size="10.00">L8&#45;Experts&#45;16&#45;31</text>
<text text-anchor="middle" x="546" y="-460.41" font-family="Arial" font-size="10.00">EP64[1280&#45;1599]</text>
<text text-anchor="middle" x="546" y="-449.41" font-family="Arial" font-size="10.00">(16 experts)</text>
<text text-anchor="middle" x="546" y="-438.41" font-family="Arial" font-size="10.00">In: [16,1024,1024]</text>
<text text-anchor="middle" x="546" y="-427.41" font-family="Arial" font-size="10.00">Out: [16,1024,1024]</text>
</g>
<!-- l8_dispatch&#45;&gt;l8_expert_16_31 -->
<g id="edge29" class="edge">
<title>l8_dispatch&#45;&gt;l8_expert_16_31</title>
<path fill="none" stroke="black" d="M436.39,-557.31C456.46,-538.2 483.99,-511.97 506.44,-490.59"/>
<polygon fill="black" stroke="black" points="509.01,-492.97 513.84,-483.54 504.19,-487.9 509.01,-492.97"/>
</g>
<!-- l8_expert_32_47 -->
<g id="node26" class="node">
<title>l8_expert_32_47</title>
<polygon fill="lightblue" stroke="black" points="736.5,-483.41 633.5,-483.41 633.5,-420.41 736.5,-420.41 736.5,-483.41"/>
<text text-anchor="middle" x="685" y="-471.41" font-family="Arial" font-size="10.00">L8&#45;Experts&#45;32&#45;47</text>
<text text-anchor="middle" x="685" y="-460.41" font-family="Arial" font-size="10.00">EP64[1600&#45;1919]</text>
<text text-anchor="middle" x="685" y="-449.41" font-family="Arial" font-size="10.00">(16 experts)</text>
<text text-anchor="middle" x="685" y="-438.41" font-family="Arial" font-size="10.00">In: [16,1024,1024]</text>
<text text-anchor="middle" x="685" y="-427.41" font-family="Arial" font-size="10.00">Out: [16,1024,1024]</text>
</g>
<!-- l8_dispatch&#45;&gt;l8_expert_32_47 -->
<g id="edge30" class="edge">
<title>l8_dispatch&#45;&gt;l8_expert_32_47</title>
<path fill="none" stroke="black" d="M454.58,-561.85C500.84,-539.98 572.77,-505.97 623.94,-481.78"/>
<polygon fill="black" stroke="black" points="625.7,-484.82 633.24,-477.38 622.71,-478.49 625.7,-484.82"/>
</g>
<!-- l8_expert_48_63 -->
<g id="node27" class="node">
<title>l8_expert_48_63</title>
<polygon fill="lightblue" stroke="black" points="875.5,-483.41 772.5,-483.41 772.5,-420.41 875.5,-420.41 875.5,-483.41"/>
<text text-anchor="middle" x="824" y="-471.41" font-family="Arial" font-size="10.00">L8&#45;Experts&#45;48&#45;63</text>
<text text-anchor="middle" x="824" y="-460.41" font-family="Arial" font-size="10.00">EP64[1920&#45;2047]</text>
<text text-anchor="middle" x="824" y="-449.41" font-family="Arial" font-size="10.00">(16 experts)</text>
<text text-anchor="middle" x="824" y="-438.41" font-family="Arial" font-size="10.00">In: [16,1024,1024]</text>
<text text-anchor="middle" x="824" y="-427.41" font-family="Arial" font-size="10.00">Out: [16,1024,1024]</text>
</g>
<!-- l8_dispatch&#45;&gt;l8_expert_48_63 -->
<g id="edge31" class="edge">
<title>l8_dispatch&#45;&gt;l8_expert_48_63</title>
<path fill="none" stroke="black" d="M469.17,-568.65C538.82,-550.96 656.57,-519.2 755,-483.41 757.57,-482.48 760.17,-481.49 762.79,-480.47"/>
<polygon fill="black" stroke="black" points="764.34,-483.63 772.31,-476.65 761.73,-477.13 764.34,-483.63"/>
</g>
<!-- l8_combine -->
<g id="node28" class="node">
<title>l8_combine</title>
<polygon fill="lightyellow" stroke="black" points="583.57,-348.41 414.04,-348.41 370.43,-244.41 539.96,-244.41 583.57,-348.41"/>
<text text-anchor="middle" x="477" y="-310.41" font-family="Arial" font-size="10.00">L8&#45;Expert&#45;Combine</text>
<text text-anchor="middle" x="477" y="-299.41" font-family="Arial" font-size="10.00">EP64[1024&#45;1087]</text>
<text text-anchor="middle" x="477" y="-288.41" font-family="Arial" font-size="10.00">In: [64,1024,1024]</text>
<text text-anchor="middle" x="477" y="-277.41" font-family="Arial" font-size="10.00">Out: [64,1024,1024]</text>
</g>
<!-- l8_expert_0_3&#45;&gt;l8_combine -->
<g id="edge32" class="edge">
<title>l8_expert_0_3&#45;&gt;l8_combine</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M190.22,-428.42C244.42,-403.66 332.41,-363.47 396.64,-334.12"/>
<polygon fill="black" stroke="black" points="398.3,-337.21 405.94,-329.87 395.39,-330.84 398.3,-337.21"/>
</g>
<!-- l8_expert_4_7&#45;&gt;l8_combine -->
<g id="edge33" class="edge">
<title>l8_expert_4_7&#45;&gt;l8_combine</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M315.39,-420.22C340.97,-400.78 374.77,-375.09 404.85,-352.23"/>
<polygon fill="black" stroke="black" points="406.97,-355.02 412.82,-346.18 402.74,-349.44 406.97,-355.02"/>
</g>
<!-- l8_expert_8_15&#45;&gt;l8_combine -->
<g id="edge34" class="edge">
<title>l8_expert_8_15&#45;&gt;l8_combine</title>
<path fill="none" stroke="black" d="M422.6,-420.22C430.5,-402.38 440.73,-379.28 450.19,-357.94"/>
<polygon fill="black" stroke="black" points="453.47,-359.16 454.32,-348.6 447.07,-356.33 453.47,-359.16"/>
</g>
<!-- l8_expert_16_31&#45;&gt;l8_combine -->
<g id="edge35" class="edge">
<title>l8_expert_16_31&#45;&gt;l8_combine</title>
<path fill="none" stroke="black" d="M532.2,-420.22C524.19,-402.38 513.8,-379.28 504.21,-357.94"/>
<polygon fill="black" stroke="black" points="507.3,-356.29 500.01,-348.6 500.92,-359.16 507.3,-356.29"/>
</g>
<!-- l8_expert_32_47&#45;&gt;l8_combine -->
<g id="edge36" class="edge">
<title>l8_expert_32_47&#45;&gt;l8_combine</title>
<path fill="none" stroke="black" d="M643.41,-420.22C618.05,-401.5 584.84,-376.99 554.76,-354.79"/>
<polygon fill="black" stroke="black" points="556.49,-351.72 546.37,-348.6 552.34,-357.35 556.49,-351.72"/>
</g>
<!-- l8_expert_48_63&#45;&gt;l8_combine -->
<g id="edge37" class="edge">
<title>l8_expert_48_63&#45;&gt;l8_combine</title>
<path fill="none" stroke="black" d="M772.43,-428.09C724.75,-407 652.23,-374.92 590.98,-347.83"/>
<polygon fill="black" stroke="black" points="592.2,-344.54 581.64,-343.7 589.37,-350.94 592.2,-344.54"/>
</g>
<!-- l8_combine_alltoall -->
<g id="node29" class="node">
<title>l8_combine_alltoall</title>
<ellipse fill="lightgreen" stroke="black" cx="477" cy="-143.42" rx="71.34" ry="28.98"/>
<text text-anchor="middle" x="477" y="-151.92" font-family="Arial" font-size="10.00">L8&#45;Expert&#45;Combine</text>
<text text-anchor="middle" x="477" y="-140.92" font-family="Arial" font-size="10.00">EP64[1024&#45;1087]</text>
<text text-anchor="middle" x="477" y="-129.92" font-family="Arial" font-size="10.00">All&#45;to&#45;All</text>
</g>
<!-- l8_combine&#45;&gt;l8_combine_alltoall -->
<g id="edge38" class="edge">
<title>l8_combine&#45;&gt;l8_combine_alltoall</title>
<path fill="none" stroke="black" d="M477,-244.29C477,-224.17 477,-201.47 477,-182.79"/>
<polygon fill="black" stroke="black" points="480.5,-182.6 477,-172.6 473.5,-182.6 480.5,-182.6"/>
</g>
<!-- output -->
<g id="node30" class="node">
<title>output</title>
<ellipse fill="white" stroke="black" cx="477" cy="-21.21" rx="101.23" ry="21.43"/>
<text text-anchor="middle" x="477" y="-24.21" font-family="Arial" font-size="10.00">Output</text>
<text text-anchor="middle" x="477" y="-13.21" font-family="Arial" font-size="10.00">[BS=128, SL=1024, H=1024]</text>
</g>
<!-- l8_combine_alltoall&#45;&gt;output -->
<g id="edge39" class="edge">
<title>l8_combine_alltoall&#45;&gt;output</title>
<path fill="none" stroke="black" d="M477,-114.24C477,-95.82 477,-71.77 477,-52.88"/>
<polygon fill="black" stroke="black" points="480.5,-52.7 477,-42.7 473.5,-52.7 480.5,-52.7"/>
</g>
</g>
</svg>
