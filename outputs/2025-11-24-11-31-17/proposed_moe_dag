digraph proposed_moe {
	rankdir=TB size="20,25"
	input [label="Input\nBatch: 128\nSeq Len: 10,000\nDim: 4096" fillcolor=yellow shape=ellipse style=filled]
	token_dist [label="Token Distribution\nAll GPUs\n[128,10000,4096]â†’[128,10000,4096]" fillcolor=lightcoral shape=ellipse style=filled]
	subgraph cluster_layer_1 {
		label="Layer 1 (16 Experts on 16 GPUs)" style=dashed
		dist_l1 [label="Distribute Tokens\nLayer 1\nAll GPUs\n[128,10000,4096]" fillcolor=lightyellow shape=ellipse style=filled]
		mha_l1_gpu0 [label="MHA\nLayer 1\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l1_gpu1 [label="MHA\nLayer 1\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l1_gpu2 [label="MHA\nLayer 1\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l1_gpu3 [label="MHA\nLayer 1\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l1_gpu4 [label="MHA\nLayer 1\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l1_gpu5 [label="MHA\nLayer 1\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l1_gpu6 [label="MHA\nLayer 1\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l1_gpu7 [label="MHA\nLayer 1\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l1_gpu8 [label="MHA\nLayer 1\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l1_gpu9 [label="MHA\nLayer 1\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l1_gpu10 [label="MHA\nLayer 1\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l1_gpu11 [label="MHA\nLayer 1\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l1_gpu12 [label="MHA\nLayer 1\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l1_gpu13 [label="MHA\nLayer 1\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l1_gpu14 [label="MHA\nLayer 1\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l1_gpu15 [label="MHA\nLayer 1\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		gate_l1_gpu0 [label="Gate\nLayer 1\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l1_gpu1 [label="Gate\nLayer 1\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l1_gpu2 [label="Gate\nLayer 1\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l1_gpu3 [label="Gate\nLayer 1\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l1_gpu4 [label="Gate\nLayer 1\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l1_gpu5 [label="Gate\nLayer 1\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l1_gpu6 [label="Gate\nLayer 1\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l1_gpu7 [label="Gate\nLayer 1\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l1_gpu8 [label="Gate\nLayer 1\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l1_gpu9 [label="Gate\nLayer 1\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l1_gpu10 [label="Gate\nLayer 1\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l1_gpu11 [label="Gate\nLayer 1\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l1_gpu12 [label="Gate\nLayer 1\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l1_gpu13 [label="Gate\nLayer 1\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l1_gpu14 [label="Gate\nLayer 1\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l1_gpu15 [label="Gate\nLayer 1\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		expert_l1_gpu0 [label="Expert 1\nLayer 1\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light1 shape=rectangle style=filled]
		expert_l1_gpu1 [label="Expert 2\nLayer 1\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light2 shape=rectangle style=filled]
		expert_l1_gpu2 [label="Expert 3\nLayer 1\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light3 shape=rectangle style=filled]
		expert_l1_gpu3 [label="Expert 4\nLayer 1\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light4 shape=rectangle style=filled]
		expert_l1_gpu4 [label="Expert 5\nLayer 1\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light5 shape=rectangle style=filled]
		expert_l1_gpu5 [label="Expert 6\nLayer 1\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light6 shape=rectangle style=filled]
		expert_l1_gpu6 [label="Expert 7\nLayer 1\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light7 shape=rectangle style=filled]
		expert_l1_gpu7 [label="Expert 8\nLayer 1\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light8 shape=rectangle style=filled]
		expert_l1_gpu8 [label="Expert 9\nLayer 1\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light9 shape=rectangle style=filled]
		expert_l1_gpu9 [label="Expert 10\nLayer 1\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light10 shape=rectangle style=filled]
		expert_l1_gpu10 [label="Expert 11\nLayer 1\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light11 shape=rectangle style=filled]
		expert_l1_gpu11 [label="Expert 12\nLayer 1\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light12 shape=rectangle style=filled]
		expert_l1_gpu12 [label="Expert 13\nLayer 1\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light13 shape=rectangle style=filled]
		expert_l1_gpu13 [label="Expert 14\nLayer 1\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light14 shape=rectangle style=filled]
		expert_l1_gpu14 [label="Expert 15\nLayer 1\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light15 shape=rectangle style=filled]
		expert_l1_gpu15 [label="Expert 16\nLayer 1\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light16 shape=rectangle style=filled]
		agg_l1_gpu0 [label="Aggregate\nLayer 1\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l1_gpu1 [label="Aggregate\nLayer 1\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l1_gpu2 [label="Aggregate\nLayer 1\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l1_gpu3 [label="Aggregate\nLayer 1\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l1_gpu4 [label="Aggregate\nLayer 1\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l1_gpu5 [label="Aggregate\nLayer 1\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l1_gpu6 [label="Aggregate\nLayer 1\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l1_gpu7 [label="Aggregate\nLayer 1\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l1_gpu8 [label="Aggregate\nLayer 1\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l1_gpu9 [label="Aggregate\nLayer 1\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l1_gpu10 [label="Aggregate\nLayer 1\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l1_gpu11 [label="Aggregate\nLayer 1\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l1_gpu12 [label="Aggregate\nLayer 1\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l1_gpu13 [label="Aggregate\nLayer 1\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l1_gpu14 [label="Aggregate\nLayer 1\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l1_gpu15 [label="Aggregate\nLayer 1\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		global_agg_l1 [label="Global Aggregation\nLayer 1\nAll GPUs\n[128,10000,4096]" fillcolor=pink shape=ellipse style=filled]
		residual_l1 [label="Residual Add\nLayer 1\nAll GPUs\nInput: [128,10000,4096]\nOutput: [128,10000,4096]" fillcolor=lightgray shape=rectangle style=filled]
	}
	subgraph cluster_layer_2 {
		label="Layer 2 (16 Experts on 16 GPUs)" style=dashed
		dist_l2 [label="Distribute Tokens\nLayer 2\nAll GPUs\n[128,10000,4096]" fillcolor=lightyellow shape=ellipse style=filled]
		mha_l2_gpu0 [label="MHA\nLayer 2\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l2_gpu1 [label="MHA\nLayer 2\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l2_gpu2 [label="MHA\nLayer 2\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l2_gpu3 [label="MHA\nLayer 2\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l2_gpu4 [label="MHA\nLayer 2\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l2_gpu5 [label="MHA\nLayer 2\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l2_gpu6 [label="MHA\nLayer 2\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l2_gpu7 [label="MHA\nLayer 2\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l2_gpu8 [label="MHA\nLayer 2\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l2_gpu9 [label="MHA\nLayer 2\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l2_gpu10 [label="MHA\nLayer 2\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l2_gpu11 [label="MHA\nLayer 2\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l2_gpu12 [label="MHA\nLayer 2\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l2_gpu13 [label="MHA\nLayer 2\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l2_gpu14 [label="MHA\nLayer 2\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l2_gpu15 [label="MHA\nLayer 2\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		gate_l2_gpu0 [label="Gate\nLayer 2\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l2_gpu1 [label="Gate\nLayer 2\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l2_gpu2 [label="Gate\nLayer 2\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l2_gpu3 [label="Gate\nLayer 2\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l2_gpu4 [label="Gate\nLayer 2\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l2_gpu5 [label="Gate\nLayer 2\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l2_gpu6 [label="Gate\nLayer 2\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l2_gpu7 [label="Gate\nLayer 2\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l2_gpu8 [label="Gate\nLayer 2\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l2_gpu9 [label="Gate\nLayer 2\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l2_gpu10 [label="Gate\nLayer 2\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l2_gpu11 [label="Gate\nLayer 2\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l2_gpu12 [label="Gate\nLayer 2\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l2_gpu13 [label="Gate\nLayer 2\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l2_gpu14 [label="Gate\nLayer 2\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l2_gpu15 [label="Gate\nLayer 2\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		expert_l2_gpu0 [label="Expert 1\nLayer 2\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light1 shape=rectangle style=filled]
		expert_l2_gpu1 [label="Expert 2\nLayer 2\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light2 shape=rectangle style=filled]
		expert_l2_gpu2 [label="Expert 3\nLayer 2\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light3 shape=rectangle style=filled]
		expert_l2_gpu3 [label="Expert 4\nLayer 2\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light4 shape=rectangle style=filled]
		expert_l2_gpu4 [label="Expert 5\nLayer 2\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light5 shape=rectangle style=filled]
		expert_l2_gpu5 [label="Expert 6\nLayer 2\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light6 shape=rectangle style=filled]
		expert_l2_gpu6 [label="Expert 7\nLayer 2\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light7 shape=rectangle style=filled]
		expert_l2_gpu7 [label="Expert 8\nLayer 2\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light8 shape=rectangle style=filled]
		expert_l2_gpu8 [label="Expert 9\nLayer 2\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light9 shape=rectangle style=filled]
		expert_l2_gpu9 [label="Expert 10\nLayer 2\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light10 shape=rectangle style=filled]
		expert_l2_gpu10 [label="Expert 11\nLayer 2\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light11 shape=rectangle style=filled]
		expert_l2_gpu11 [label="Expert 12\nLayer 2\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light12 shape=rectangle style=filled]
		expert_l2_gpu12 [label="Expert 13\nLayer 2\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light13 shape=rectangle style=filled]
		expert_l2_gpu13 [label="Expert 14\nLayer 2\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light14 shape=rectangle style=filled]
		expert_l2_gpu14 [label="Expert 15\nLayer 2\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light15 shape=rectangle style=filled]
		expert_l2_gpu15 [label="Expert 16\nLayer 2\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light16 shape=rectangle style=filled]
		agg_l2_gpu0 [label="Aggregate\nLayer 2\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l2_gpu1 [label="Aggregate\nLayer 2\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l2_gpu2 [label="Aggregate\nLayer 2\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l2_gpu3 [label="Aggregate\nLayer 2\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l2_gpu4 [label="Aggregate\nLayer 2\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l2_gpu5 [label="Aggregate\nLayer 2\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l2_gpu6 [label="Aggregate\nLayer 2\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l2_gpu7 [label="Aggregate\nLayer 2\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l2_gpu8 [label="Aggregate\nLayer 2\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l2_gpu9 [label="Aggregate\nLayer 2\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l2_gpu10 [label="Aggregate\nLayer 2\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l2_gpu11 [label="Aggregate\nLayer 2\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l2_gpu12 [label="Aggregate\nLayer 2\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l2_gpu13 [label="Aggregate\nLayer 2\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l2_gpu14 [label="Aggregate\nLayer 2\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l2_gpu15 [label="Aggregate\nLayer 2\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		global_agg_l2 [label="Global Aggregation\nLayer 2\nAll GPUs\n[128,10000,4096]" fillcolor=pink shape=ellipse style=filled]
		residual_l2 [label="Residual Add\nLayer 2\nAll GPUs\nInput: [128,10000,4096]\nOutput: [128,10000,4096]" fillcolor=lightgray shape=rectangle style=filled]
	}
	subgraph cluster_layer_3 {
		label="Layer 3 (16 Experts on 16 GPUs)" style=dashed
		dist_l3 [label="Distribute Tokens\nLayer 3\nAll GPUs\n[128,10000,4096]" fillcolor=lightyellow shape=ellipse style=filled]
		mha_l3_gpu0 [label="MHA\nLayer 3\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l3_gpu1 [label="MHA\nLayer 3\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l3_gpu2 [label="MHA\nLayer 3\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l3_gpu3 [label="MHA\nLayer 3\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l3_gpu4 [label="MHA\nLayer 3\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l3_gpu5 [label="MHA\nLayer 3\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l3_gpu6 [label="MHA\nLayer 3\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l3_gpu7 [label="MHA\nLayer 3\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l3_gpu8 [label="MHA\nLayer 3\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l3_gpu9 [label="MHA\nLayer 3\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l3_gpu10 [label="MHA\nLayer 3\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l3_gpu11 [label="MHA\nLayer 3\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l3_gpu12 [label="MHA\nLayer 3\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l3_gpu13 [label="MHA\nLayer 3\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l3_gpu14 [label="MHA\nLayer 3\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l3_gpu15 [label="MHA\nLayer 3\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		gate_l3_gpu0 [label="Gate\nLayer 3\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l3_gpu1 [label="Gate\nLayer 3\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l3_gpu2 [label="Gate\nLayer 3\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l3_gpu3 [label="Gate\nLayer 3\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l3_gpu4 [label="Gate\nLayer 3\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l3_gpu5 [label="Gate\nLayer 3\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l3_gpu6 [label="Gate\nLayer 3\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l3_gpu7 [label="Gate\nLayer 3\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l3_gpu8 [label="Gate\nLayer 3\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l3_gpu9 [label="Gate\nLayer 3\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l3_gpu10 [label="Gate\nLayer 3\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l3_gpu11 [label="Gate\nLayer 3\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l3_gpu12 [label="Gate\nLayer 3\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l3_gpu13 [label="Gate\nLayer 3\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l3_gpu14 [label="Gate\nLayer 3\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l3_gpu15 [label="Gate\nLayer 3\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		expert_l3_gpu0 [label="Expert 1\nLayer 3\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light1 shape=rectangle style=filled]
		expert_l3_gpu1 [label="Expert 2\nLayer 3\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light2 shape=rectangle style=filled]
		expert_l3_gpu2 [label="Expert 3\nLayer 3\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light3 shape=rectangle style=filled]
		expert_l3_gpu3 [label="Expert 4\nLayer 3\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light4 shape=rectangle style=filled]
		expert_l3_gpu4 [label="Expert 5\nLayer 3\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light5 shape=rectangle style=filled]
		expert_l3_gpu5 [label="Expert 6\nLayer 3\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light6 shape=rectangle style=filled]
		expert_l3_gpu6 [label="Expert 7\nLayer 3\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light7 shape=rectangle style=filled]
		expert_l3_gpu7 [label="Expert 8\nLayer 3\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light8 shape=rectangle style=filled]
		expert_l3_gpu8 [label="Expert 9\nLayer 3\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light9 shape=rectangle style=filled]
		expert_l3_gpu9 [label="Expert 10\nLayer 3\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light10 shape=rectangle style=filled]
		expert_l3_gpu10 [label="Expert 11\nLayer 3\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light11 shape=rectangle style=filled]
		expert_l3_gpu11 [label="Expert 12\nLayer 3\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light12 shape=rectangle style=filled]
		expert_l3_gpu12 [label="Expert 13\nLayer 3\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light13 shape=rectangle style=filled]
		expert_l3_gpu13 [label="Expert 14\nLayer 3\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light14 shape=rectangle style=filled]
		expert_l3_gpu14 [label="Expert 15\nLayer 3\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light15 shape=rectangle style=filled]
		expert_l3_gpu15 [label="Expert 16\nLayer 3\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light16 shape=rectangle style=filled]
		agg_l3_gpu0 [label="Aggregate\nLayer 3\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l3_gpu1 [label="Aggregate\nLayer 3\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l3_gpu2 [label="Aggregate\nLayer 3\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l3_gpu3 [label="Aggregate\nLayer 3\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l3_gpu4 [label="Aggregate\nLayer 3\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l3_gpu5 [label="Aggregate\nLayer 3\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l3_gpu6 [label="Aggregate\nLayer 3\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l3_gpu7 [label="Aggregate\nLayer 3\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l3_gpu8 [label="Aggregate\nLayer 3\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l3_gpu9 [label="Aggregate\nLayer 3\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l3_gpu10 [label="Aggregate\nLayer 3\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l3_gpu11 [label="Aggregate\nLayer 3\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l3_gpu12 [label="Aggregate\nLayer 3\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l3_gpu13 [label="Aggregate\nLayer 3\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l3_gpu14 [label="Aggregate\nLayer 3\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l3_gpu15 [label="Aggregate\nLayer 3\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		global_agg_l3 [label="Global Aggregation\nLayer 3\nAll GPUs\n[128,10000,4096]" fillcolor=pink shape=ellipse style=filled]
		residual_l3 [label="Residual Add\nLayer 3\nAll GPUs\nInput: [128,10000,4096]\nOutput: [128,10000,4096]" fillcolor=lightgray shape=rectangle style=filled]
	}
	subgraph cluster_layer_4 {
		label="Layer 4 (16 Experts on 16 GPUs)" style=dashed
		dist_l4 [label="Distribute Tokens\nLayer 4\nAll GPUs\n[128,10000,4096]" fillcolor=lightyellow shape=ellipse style=filled]
		mha_l4_gpu0 [label="MHA\nLayer 4\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l4_gpu1 [label="MHA\nLayer 4\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l4_gpu2 [label="MHA\nLayer 4\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l4_gpu3 [label="MHA\nLayer 4\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l4_gpu4 [label="MHA\nLayer 4\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l4_gpu5 [label="MHA\nLayer 4\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l4_gpu6 [label="MHA\nLayer 4\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l4_gpu7 [label="MHA\nLayer 4\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l4_gpu8 [label="MHA\nLayer 4\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l4_gpu9 [label="MHA\nLayer 4\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l4_gpu10 [label="MHA\nLayer 4\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l4_gpu11 [label="MHA\nLayer 4\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l4_gpu12 [label="MHA\nLayer 4\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l4_gpu13 [label="MHA\nLayer 4\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l4_gpu14 [label="MHA\nLayer 4\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l4_gpu15 [label="MHA\nLayer 4\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		gate_l4_gpu0 [label="Gate\nLayer 4\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l4_gpu1 [label="Gate\nLayer 4\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l4_gpu2 [label="Gate\nLayer 4\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l4_gpu3 [label="Gate\nLayer 4\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l4_gpu4 [label="Gate\nLayer 4\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l4_gpu5 [label="Gate\nLayer 4\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l4_gpu6 [label="Gate\nLayer 4\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l4_gpu7 [label="Gate\nLayer 4\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l4_gpu8 [label="Gate\nLayer 4\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l4_gpu9 [label="Gate\nLayer 4\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l4_gpu10 [label="Gate\nLayer 4\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l4_gpu11 [label="Gate\nLayer 4\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l4_gpu12 [label="Gate\nLayer 4\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l4_gpu13 [label="Gate\nLayer 4\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l4_gpu14 [label="Gate\nLayer 4\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l4_gpu15 [label="Gate\nLayer 4\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		expert_l4_gpu0 [label="Expert 1\nLayer 4\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light1 shape=rectangle style=filled]
		expert_l4_gpu1 [label="Expert 2\nLayer 4\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light2 shape=rectangle style=filled]
		expert_l4_gpu2 [label="Expert 3\nLayer 4\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light3 shape=rectangle style=filled]
		expert_l4_gpu3 [label="Expert 4\nLayer 4\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light4 shape=rectangle style=filled]
		expert_l4_gpu4 [label="Expert 5\nLayer 4\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light5 shape=rectangle style=filled]
		expert_l4_gpu5 [label="Expert 6\nLayer 4\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light6 shape=rectangle style=filled]
		expert_l4_gpu6 [label="Expert 7\nLayer 4\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light7 shape=rectangle style=filled]
		expert_l4_gpu7 [label="Expert 8\nLayer 4\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light8 shape=rectangle style=filled]
		expert_l4_gpu8 [label="Expert 9\nLayer 4\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light9 shape=rectangle style=filled]
		expert_l4_gpu9 [label="Expert 10\nLayer 4\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light10 shape=rectangle style=filled]
		expert_l4_gpu10 [label="Expert 11\nLayer 4\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light11 shape=rectangle style=filled]
		expert_l4_gpu11 [label="Expert 12\nLayer 4\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light12 shape=rectangle style=filled]
		expert_l4_gpu12 [label="Expert 13\nLayer 4\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light13 shape=rectangle style=filled]
		expert_l4_gpu13 [label="Expert 14\nLayer 4\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light14 shape=rectangle style=filled]
		expert_l4_gpu14 [label="Expert 15\nLayer 4\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light15 shape=rectangle style=filled]
		expert_l4_gpu15 [label="Expert 16\nLayer 4\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light16 shape=rectangle style=filled]
		agg_l4_gpu0 [label="Aggregate\nLayer 4\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l4_gpu1 [label="Aggregate\nLayer 4\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l4_gpu2 [label="Aggregate\nLayer 4\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l4_gpu3 [label="Aggregate\nLayer 4\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l4_gpu4 [label="Aggregate\nLayer 4\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l4_gpu5 [label="Aggregate\nLayer 4\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l4_gpu6 [label="Aggregate\nLayer 4\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l4_gpu7 [label="Aggregate\nLayer 4\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l4_gpu8 [label="Aggregate\nLayer 4\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l4_gpu9 [label="Aggregate\nLayer 4\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l4_gpu10 [label="Aggregate\nLayer 4\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l4_gpu11 [label="Aggregate\nLayer 4\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l4_gpu12 [label="Aggregate\nLayer 4\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l4_gpu13 [label="Aggregate\nLayer 4\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l4_gpu14 [label="Aggregate\nLayer 4\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l4_gpu15 [label="Aggregate\nLayer 4\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		global_agg_l4 [label="Global Aggregation\nLayer 4\nAll GPUs\n[128,10000,4096]" fillcolor=pink shape=ellipse style=filled]
		residual_l4 [label="Residual Add\nLayer 4\nAll GPUs\nInput: [128,10000,4096]\nOutput: [128,10000,4096]" fillcolor=lightgray shape=rectangle style=filled]
	}
	subgraph cluster_layer_5 {
		label="Layer 5 (16 Experts on 16 GPUs)" style=dashed
		dist_l5 [label="Distribute Tokens\nLayer 5\nAll GPUs\n[128,10000,4096]" fillcolor=lightyellow shape=ellipse style=filled]
		mha_l5_gpu0 [label="MHA\nLayer 5\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l5_gpu1 [label="MHA\nLayer 5\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l5_gpu2 [label="MHA\nLayer 5\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l5_gpu3 [label="MHA\nLayer 5\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l5_gpu4 [label="MHA\nLayer 5\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l5_gpu5 [label="MHA\nLayer 5\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l5_gpu6 [label="MHA\nLayer 5\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l5_gpu7 [label="MHA\nLayer 5\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l5_gpu8 [label="MHA\nLayer 5\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l5_gpu9 [label="MHA\nLayer 5\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l5_gpu10 [label="MHA\nLayer 5\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l5_gpu11 [label="MHA\nLayer 5\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l5_gpu12 [label="MHA\nLayer 5\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l5_gpu13 [label="MHA\nLayer 5\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l5_gpu14 [label="MHA\nLayer 5\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l5_gpu15 [label="MHA\nLayer 5\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		gate_l5_gpu0 [label="Gate\nLayer 5\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l5_gpu1 [label="Gate\nLayer 5\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l5_gpu2 [label="Gate\nLayer 5\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l5_gpu3 [label="Gate\nLayer 5\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l5_gpu4 [label="Gate\nLayer 5\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l5_gpu5 [label="Gate\nLayer 5\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l5_gpu6 [label="Gate\nLayer 5\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l5_gpu7 [label="Gate\nLayer 5\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l5_gpu8 [label="Gate\nLayer 5\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l5_gpu9 [label="Gate\nLayer 5\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l5_gpu10 [label="Gate\nLayer 5\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l5_gpu11 [label="Gate\nLayer 5\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l5_gpu12 [label="Gate\nLayer 5\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l5_gpu13 [label="Gate\nLayer 5\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l5_gpu14 [label="Gate\nLayer 5\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l5_gpu15 [label="Gate\nLayer 5\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		expert_l5_gpu0 [label="Expert 1\nLayer 5\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light1 shape=rectangle style=filled]
		expert_l5_gpu1 [label="Expert 2\nLayer 5\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light2 shape=rectangle style=filled]
		expert_l5_gpu2 [label="Expert 3\nLayer 5\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light3 shape=rectangle style=filled]
		expert_l5_gpu3 [label="Expert 4\nLayer 5\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light4 shape=rectangle style=filled]
		expert_l5_gpu4 [label="Expert 5\nLayer 5\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light5 shape=rectangle style=filled]
		expert_l5_gpu5 [label="Expert 6\nLayer 5\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light6 shape=rectangle style=filled]
		expert_l5_gpu6 [label="Expert 7\nLayer 5\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light7 shape=rectangle style=filled]
		expert_l5_gpu7 [label="Expert 8\nLayer 5\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light8 shape=rectangle style=filled]
		expert_l5_gpu8 [label="Expert 9\nLayer 5\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light9 shape=rectangle style=filled]
		expert_l5_gpu9 [label="Expert 10\nLayer 5\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light10 shape=rectangle style=filled]
		expert_l5_gpu10 [label="Expert 11\nLayer 5\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light11 shape=rectangle style=filled]
		expert_l5_gpu11 [label="Expert 12\nLayer 5\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light12 shape=rectangle style=filled]
		expert_l5_gpu12 [label="Expert 13\nLayer 5\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light13 shape=rectangle style=filled]
		expert_l5_gpu13 [label="Expert 14\nLayer 5\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light14 shape=rectangle style=filled]
		expert_l5_gpu14 [label="Expert 15\nLayer 5\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light15 shape=rectangle style=filled]
		expert_l5_gpu15 [label="Expert 16\nLayer 5\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light16 shape=rectangle style=filled]
		agg_l5_gpu0 [label="Aggregate\nLayer 5\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l5_gpu1 [label="Aggregate\nLayer 5\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l5_gpu2 [label="Aggregate\nLayer 5\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l5_gpu3 [label="Aggregate\nLayer 5\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l5_gpu4 [label="Aggregate\nLayer 5\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l5_gpu5 [label="Aggregate\nLayer 5\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l5_gpu6 [label="Aggregate\nLayer 5\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l5_gpu7 [label="Aggregate\nLayer 5\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l5_gpu8 [label="Aggregate\nLayer 5\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l5_gpu9 [label="Aggregate\nLayer 5\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l5_gpu10 [label="Aggregate\nLayer 5\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l5_gpu11 [label="Aggregate\nLayer 5\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l5_gpu12 [label="Aggregate\nLayer 5\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l5_gpu13 [label="Aggregate\nLayer 5\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l5_gpu14 [label="Aggregate\nLayer 5\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l5_gpu15 [label="Aggregate\nLayer 5\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		global_agg_l5 [label="Global Aggregation\nLayer 5\nAll GPUs\n[128,10000,4096]" fillcolor=pink shape=ellipse style=filled]
		residual_l5 [label="Residual Add\nLayer 5\nAll GPUs\nInput: [128,10000,4096]\nOutput: [128,10000,4096]" fillcolor=lightgray shape=rectangle style=filled]
	}
	subgraph cluster_layer_6 {
		label="Layer 6 (16 Experts on 16 GPUs)" style=dashed
		dist_l6 [label="Distribute Tokens\nLayer 6\nAll GPUs\n[128,10000,4096]" fillcolor=lightyellow shape=ellipse style=filled]
		mha_l6_gpu0 [label="MHA\nLayer 6\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l6_gpu1 [label="MHA\nLayer 6\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l6_gpu2 [label="MHA\nLayer 6\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l6_gpu3 [label="MHA\nLayer 6\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l6_gpu4 [label="MHA\nLayer 6\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l6_gpu5 [label="MHA\nLayer 6\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l6_gpu6 [label="MHA\nLayer 6\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l6_gpu7 [label="MHA\nLayer 6\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l6_gpu8 [label="MHA\nLayer 6\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l6_gpu9 [label="MHA\nLayer 6\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l6_gpu10 [label="MHA\nLayer 6\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l6_gpu11 [label="MHA\nLayer 6\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l6_gpu12 [label="MHA\nLayer 6\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l6_gpu13 [label="MHA\nLayer 6\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l6_gpu14 [label="MHA\nLayer 6\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l6_gpu15 [label="MHA\nLayer 6\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		gate_l6_gpu0 [label="Gate\nLayer 6\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l6_gpu1 [label="Gate\nLayer 6\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l6_gpu2 [label="Gate\nLayer 6\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l6_gpu3 [label="Gate\nLayer 6\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l6_gpu4 [label="Gate\nLayer 6\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l6_gpu5 [label="Gate\nLayer 6\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l6_gpu6 [label="Gate\nLayer 6\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l6_gpu7 [label="Gate\nLayer 6\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l6_gpu8 [label="Gate\nLayer 6\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l6_gpu9 [label="Gate\nLayer 6\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l6_gpu10 [label="Gate\nLayer 6\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l6_gpu11 [label="Gate\nLayer 6\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l6_gpu12 [label="Gate\nLayer 6\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l6_gpu13 [label="Gate\nLayer 6\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l6_gpu14 [label="Gate\nLayer 6\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l6_gpu15 [label="Gate\nLayer 6\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		expert_l6_gpu0 [label="Expert 1\nLayer 6\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light1 shape=rectangle style=filled]
		expert_l6_gpu1 [label="Expert 2\nLayer 6\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light2 shape=rectangle style=filled]
		expert_l6_gpu2 [label="Expert 3\nLayer 6\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light3 shape=rectangle style=filled]
		expert_l6_gpu3 [label="Expert 4\nLayer 6\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light4 shape=rectangle style=filled]
		expert_l6_gpu4 [label="Expert 5\nLayer 6\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light5 shape=rectangle style=filled]
		expert_l6_gpu5 [label="Expert 6\nLayer 6\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light6 shape=rectangle style=filled]
		expert_l6_gpu6 [label="Expert 7\nLayer 6\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light7 shape=rectangle style=filled]
		expert_l6_gpu7 [label="Expert 8\nLayer 6\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light8 shape=rectangle style=filled]
		expert_l6_gpu8 [label="Expert 9\nLayer 6\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light9 shape=rectangle style=filled]
		expert_l6_gpu9 [label="Expert 10\nLayer 6\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light10 shape=rectangle style=filled]
		expert_l6_gpu10 [label="Expert 11\nLayer 6\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light11 shape=rectangle style=filled]
		expert_l6_gpu11 [label="Expert 12\nLayer 6\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light12 shape=rectangle style=filled]
		expert_l6_gpu12 [label="Expert 13\nLayer 6\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light13 shape=rectangle style=filled]
		expert_l6_gpu13 [label="Expert 14\nLayer 6\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light14 shape=rectangle style=filled]
		expert_l6_gpu14 [label="Expert 15\nLayer 6\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light15 shape=rectangle style=filled]
		expert_l6_gpu15 [label="Expert 16\nLayer 6\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light16 shape=rectangle style=filled]
		agg_l6_gpu0 [label="Aggregate\nLayer 6\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l6_gpu1 [label="Aggregate\nLayer 6\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l6_gpu2 [label="Aggregate\nLayer 6\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l6_gpu3 [label="Aggregate\nLayer 6\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l6_gpu4 [label="Aggregate\nLayer 6\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l6_gpu5 [label="Aggregate\nLayer 6\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l6_gpu6 [label="Aggregate\nLayer 6\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l6_gpu7 [label="Aggregate\nLayer 6\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l6_gpu8 [label="Aggregate\nLayer 6\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l6_gpu9 [label="Aggregate\nLayer 6\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l6_gpu10 [label="Aggregate\nLayer 6\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l6_gpu11 [label="Aggregate\nLayer 6\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l6_gpu12 [label="Aggregate\nLayer 6\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l6_gpu13 [label="Aggregate\nLayer 6\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l6_gpu14 [label="Aggregate\nLayer 6\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l6_gpu15 [label="Aggregate\nLayer 6\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		global_agg_l6 [label="Global Aggregation\nLayer 6\nAll GPUs\n[128,10000,4096]" fillcolor=pink shape=ellipse style=filled]
		residual_l6 [label="Residual Add\nLayer 6\nAll GPUs\nInput: [128,10000,4096]\nOutput: [128,10000,4096]" fillcolor=lightgray shape=rectangle style=filled]
	}
	subgraph cluster_layer_7 {
		label="Layer 7 (16 Experts on 16 GPUs)" style=dashed
		dist_l7 [label="Distribute Tokens\nLayer 7\nAll GPUs\n[128,10000,4096]" fillcolor=lightyellow shape=ellipse style=filled]
		mha_l7_gpu0 [label="MHA\nLayer 7\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l7_gpu1 [label="MHA\nLayer 7\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l7_gpu2 [label="MHA\nLayer 7\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l7_gpu3 [label="MHA\nLayer 7\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l7_gpu4 [label="MHA\nLayer 7\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l7_gpu5 [label="MHA\nLayer 7\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l7_gpu6 [label="MHA\nLayer 7\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l7_gpu7 [label="MHA\nLayer 7\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l7_gpu8 [label="MHA\nLayer 7\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l7_gpu9 [label="MHA\nLayer 7\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l7_gpu10 [label="MHA\nLayer 7\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l7_gpu11 [label="MHA\nLayer 7\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l7_gpu12 [label="MHA\nLayer 7\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l7_gpu13 [label="MHA\nLayer 7\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l7_gpu14 [label="MHA\nLayer 7\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l7_gpu15 [label="MHA\nLayer 7\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		gate_l7_gpu0 [label="Gate\nLayer 7\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l7_gpu1 [label="Gate\nLayer 7\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l7_gpu2 [label="Gate\nLayer 7\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l7_gpu3 [label="Gate\nLayer 7\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l7_gpu4 [label="Gate\nLayer 7\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l7_gpu5 [label="Gate\nLayer 7\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l7_gpu6 [label="Gate\nLayer 7\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l7_gpu7 [label="Gate\nLayer 7\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l7_gpu8 [label="Gate\nLayer 7\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l7_gpu9 [label="Gate\nLayer 7\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l7_gpu10 [label="Gate\nLayer 7\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l7_gpu11 [label="Gate\nLayer 7\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l7_gpu12 [label="Gate\nLayer 7\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l7_gpu13 [label="Gate\nLayer 7\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l7_gpu14 [label="Gate\nLayer 7\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l7_gpu15 [label="Gate\nLayer 7\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		expert_l7_gpu0 [label="Expert 1\nLayer 7\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light1 shape=rectangle style=filled]
		expert_l7_gpu1 [label="Expert 2\nLayer 7\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light2 shape=rectangle style=filled]
		expert_l7_gpu2 [label="Expert 3\nLayer 7\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light3 shape=rectangle style=filled]
		expert_l7_gpu3 [label="Expert 4\nLayer 7\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light4 shape=rectangle style=filled]
		expert_l7_gpu4 [label="Expert 5\nLayer 7\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light5 shape=rectangle style=filled]
		expert_l7_gpu5 [label="Expert 6\nLayer 7\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light6 shape=rectangle style=filled]
		expert_l7_gpu6 [label="Expert 7\nLayer 7\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light7 shape=rectangle style=filled]
		expert_l7_gpu7 [label="Expert 8\nLayer 7\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light8 shape=rectangle style=filled]
		expert_l7_gpu8 [label="Expert 9\nLayer 7\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light9 shape=rectangle style=filled]
		expert_l7_gpu9 [label="Expert 10\nLayer 7\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light10 shape=rectangle style=filled]
		expert_l7_gpu10 [label="Expert 11\nLayer 7\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light11 shape=rectangle style=filled]
		expert_l7_gpu11 [label="Expert 12\nLayer 7\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light12 shape=rectangle style=filled]
		expert_l7_gpu12 [label="Expert 13\nLayer 7\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light13 shape=rectangle style=filled]
		expert_l7_gpu13 [label="Expert 14\nLayer 7\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light14 shape=rectangle style=filled]
		expert_l7_gpu14 [label="Expert 15\nLayer 7\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light15 shape=rectangle style=filled]
		expert_l7_gpu15 [label="Expert 16\nLayer 7\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light16 shape=rectangle style=filled]
		agg_l7_gpu0 [label="Aggregate\nLayer 7\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l7_gpu1 [label="Aggregate\nLayer 7\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l7_gpu2 [label="Aggregate\nLayer 7\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l7_gpu3 [label="Aggregate\nLayer 7\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l7_gpu4 [label="Aggregate\nLayer 7\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l7_gpu5 [label="Aggregate\nLayer 7\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l7_gpu6 [label="Aggregate\nLayer 7\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l7_gpu7 [label="Aggregate\nLayer 7\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l7_gpu8 [label="Aggregate\nLayer 7\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l7_gpu9 [label="Aggregate\nLayer 7\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l7_gpu10 [label="Aggregate\nLayer 7\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l7_gpu11 [label="Aggregate\nLayer 7\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l7_gpu12 [label="Aggregate\nLayer 7\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l7_gpu13 [label="Aggregate\nLayer 7\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l7_gpu14 [label="Aggregate\nLayer 7\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l7_gpu15 [label="Aggregate\nLayer 7\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		global_agg_l7 [label="Global Aggregation\nLayer 7\nAll GPUs\n[128,10000,4096]" fillcolor=pink shape=ellipse style=filled]
		residual_l7 [label="Residual Add\nLayer 7\nAll GPUs\nInput: [128,10000,4096]\nOutput: [128,10000,4096]" fillcolor=lightgray shape=rectangle style=filled]
	}
	subgraph cluster_layer_8 {
		label="Layer 8 (16 Experts on 16 GPUs)" style=dashed
		dist_l8 [label="Distribute Tokens\nLayer 8\nAll GPUs\n[128,10000,4096]" fillcolor=lightyellow shape=ellipse style=filled]
		mha_l8_gpu0 [label="MHA\nLayer 8\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l8_gpu1 [label="MHA\nLayer 8\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l8_gpu2 [label="MHA\nLayer 8\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l8_gpu3 [label="MHA\nLayer 8\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l8_gpu4 [label="MHA\nLayer 8\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l8_gpu5 [label="MHA\nLayer 8\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l8_gpu6 [label="MHA\nLayer 8\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l8_gpu7 [label="MHA\nLayer 8\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l8_gpu8 [label="MHA\nLayer 8\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l8_gpu9 [label="MHA\nLayer 8\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l8_gpu10 [label="MHA\nLayer 8\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l8_gpu11 [label="MHA\nLayer 8\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l8_gpu12 [label="MHA\nLayer 8\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l8_gpu13 [label="MHA\nLayer 8\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l8_gpu14 [label="MHA\nLayer 8\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l8_gpu15 [label="MHA\nLayer 8\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		gate_l8_gpu0 [label="Gate\nLayer 8\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l8_gpu1 [label="Gate\nLayer 8\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l8_gpu2 [label="Gate\nLayer 8\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l8_gpu3 [label="Gate\nLayer 8\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l8_gpu4 [label="Gate\nLayer 8\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l8_gpu5 [label="Gate\nLayer 8\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l8_gpu6 [label="Gate\nLayer 8\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l8_gpu7 [label="Gate\nLayer 8\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l8_gpu8 [label="Gate\nLayer 8\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l8_gpu9 [label="Gate\nLayer 8\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l8_gpu10 [label="Gate\nLayer 8\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l8_gpu11 [label="Gate\nLayer 8\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l8_gpu12 [label="Gate\nLayer 8\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l8_gpu13 [label="Gate\nLayer 8\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l8_gpu14 [label="Gate\nLayer 8\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l8_gpu15 [label="Gate\nLayer 8\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		expert_l8_gpu0 [label="Expert 1\nLayer 8\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light1 shape=rectangle style=filled]
		expert_l8_gpu1 [label="Expert 2\nLayer 8\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light2 shape=rectangle style=filled]
		expert_l8_gpu2 [label="Expert 3\nLayer 8\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light3 shape=rectangle style=filled]
		expert_l8_gpu3 [label="Expert 4\nLayer 8\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light4 shape=rectangle style=filled]
		expert_l8_gpu4 [label="Expert 5\nLayer 8\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light5 shape=rectangle style=filled]
		expert_l8_gpu5 [label="Expert 6\nLayer 8\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light6 shape=rectangle style=filled]
		expert_l8_gpu6 [label="Expert 7\nLayer 8\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light7 shape=rectangle style=filled]
		expert_l8_gpu7 [label="Expert 8\nLayer 8\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light8 shape=rectangle style=filled]
		expert_l8_gpu8 [label="Expert 9\nLayer 8\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light9 shape=rectangle style=filled]
		expert_l8_gpu9 [label="Expert 10\nLayer 8\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light10 shape=rectangle style=filled]
		expert_l8_gpu10 [label="Expert 11\nLayer 8\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light11 shape=rectangle style=filled]
		expert_l8_gpu11 [label="Expert 12\nLayer 8\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light12 shape=rectangle style=filled]
		expert_l8_gpu12 [label="Expert 13\nLayer 8\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light13 shape=rectangle style=filled]
		expert_l8_gpu13 [label="Expert 14\nLayer 8\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light14 shape=rectangle style=filled]
		expert_l8_gpu14 [label="Expert 15\nLayer 8\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light15 shape=rectangle style=filled]
		expert_l8_gpu15 [label="Expert 16\nLayer 8\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light16 shape=rectangle style=filled]
		agg_l8_gpu0 [label="Aggregate\nLayer 8\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l8_gpu1 [label="Aggregate\nLayer 8\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l8_gpu2 [label="Aggregate\nLayer 8\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l8_gpu3 [label="Aggregate\nLayer 8\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l8_gpu4 [label="Aggregate\nLayer 8\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l8_gpu5 [label="Aggregate\nLayer 8\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l8_gpu6 [label="Aggregate\nLayer 8\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l8_gpu7 [label="Aggregate\nLayer 8\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l8_gpu8 [label="Aggregate\nLayer 8\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l8_gpu9 [label="Aggregate\nLayer 8\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l8_gpu10 [label="Aggregate\nLayer 8\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l8_gpu11 [label="Aggregate\nLayer 8\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l8_gpu12 [label="Aggregate\nLayer 8\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l8_gpu13 [label="Aggregate\nLayer 8\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l8_gpu14 [label="Aggregate\nLayer 8\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l8_gpu15 [label="Aggregate\nLayer 8\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		global_agg_l8 [label="Global Aggregation\nLayer 8\nAll GPUs\n[128,10000,4096]" fillcolor=pink shape=ellipse style=filled]
		residual_l8 [label="Residual Add\nLayer 8\nAll GPUs\nInput: [128,10000,4096]\nOutput: [128,10000,4096]" fillcolor=lightgray shape=rectangle style=filled]
	}
	subgraph cluster_layer_9 {
		label="Layer 9 (16 Experts on 16 GPUs)" style=dashed
		dist_l9 [label="Distribute Tokens\nLayer 9\nAll GPUs\n[128,10000,4096]" fillcolor=lightyellow shape=ellipse style=filled]
		mha_l9_gpu0 [label="MHA\nLayer 9\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l9_gpu1 [label="MHA\nLayer 9\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l9_gpu2 [label="MHA\nLayer 9\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l9_gpu3 [label="MHA\nLayer 9\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l9_gpu4 [label="MHA\nLayer 9\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l9_gpu5 [label="MHA\nLayer 9\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l9_gpu6 [label="MHA\nLayer 9\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l9_gpu7 [label="MHA\nLayer 9\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l9_gpu8 [label="MHA\nLayer 9\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l9_gpu9 [label="MHA\nLayer 9\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l9_gpu10 [label="MHA\nLayer 9\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l9_gpu11 [label="MHA\nLayer 9\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l9_gpu12 [label="MHA\nLayer 9\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l9_gpu13 [label="MHA\nLayer 9\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l9_gpu14 [label="MHA\nLayer 9\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l9_gpu15 [label="MHA\nLayer 9\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		gate_l9_gpu0 [label="Gate\nLayer 9\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l9_gpu1 [label="Gate\nLayer 9\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l9_gpu2 [label="Gate\nLayer 9\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l9_gpu3 [label="Gate\nLayer 9\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l9_gpu4 [label="Gate\nLayer 9\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l9_gpu5 [label="Gate\nLayer 9\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l9_gpu6 [label="Gate\nLayer 9\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l9_gpu7 [label="Gate\nLayer 9\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l9_gpu8 [label="Gate\nLayer 9\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l9_gpu9 [label="Gate\nLayer 9\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l9_gpu10 [label="Gate\nLayer 9\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l9_gpu11 [label="Gate\nLayer 9\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l9_gpu12 [label="Gate\nLayer 9\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l9_gpu13 [label="Gate\nLayer 9\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l9_gpu14 [label="Gate\nLayer 9\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l9_gpu15 [label="Gate\nLayer 9\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		expert_l9_gpu0 [label="Expert 1\nLayer 9\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light1 shape=rectangle style=filled]
		expert_l9_gpu1 [label="Expert 2\nLayer 9\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light2 shape=rectangle style=filled]
		expert_l9_gpu2 [label="Expert 3\nLayer 9\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light3 shape=rectangle style=filled]
		expert_l9_gpu3 [label="Expert 4\nLayer 9\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light4 shape=rectangle style=filled]
		expert_l9_gpu4 [label="Expert 5\nLayer 9\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light5 shape=rectangle style=filled]
		expert_l9_gpu5 [label="Expert 6\nLayer 9\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light6 shape=rectangle style=filled]
		expert_l9_gpu6 [label="Expert 7\nLayer 9\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light7 shape=rectangle style=filled]
		expert_l9_gpu7 [label="Expert 8\nLayer 9\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light8 shape=rectangle style=filled]
		expert_l9_gpu8 [label="Expert 9\nLayer 9\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light9 shape=rectangle style=filled]
		expert_l9_gpu9 [label="Expert 10\nLayer 9\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light10 shape=rectangle style=filled]
		expert_l9_gpu10 [label="Expert 11\nLayer 9\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light11 shape=rectangle style=filled]
		expert_l9_gpu11 [label="Expert 12\nLayer 9\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light12 shape=rectangle style=filled]
		expert_l9_gpu12 [label="Expert 13\nLayer 9\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light13 shape=rectangle style=filled]
		expert_l9_gpu13 [label="Expert 14\nLayer 9\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light14 shape=rectangle style=filled]
		expert_l9_gpu14 [label="Expert 15\nLayer 9\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light15 shape=rectangle style=filled]
		expert_l9_gpu15 [label="Expert 16\nLayer 9\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light16 shape=rectangle style=filled]
		agg_l9_gpu0 [label="Aggregate\nLayer 9\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l9_gpu1 [label="Aggregate\nLayer 9\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l9_gpu2 [label="Aggregate\nLayer 9\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l9_gpu3 [label="Aggregate\nLayer 9\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l9_gpu4 [label="Aggregate\nLayer 9\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l9_gpu5 [label="Aggregate\nLayer 9\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l9_gpu6 [label="Aggregate\nLayer 9\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l9_gpu7 [label="Aggregate\nLayer 9\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l9_gpu8 [label="Aggregate\nLayer 9\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l9_gpu9 [label="Aggregate\nLayer 9\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l9_gpu10 [label="Aggregate\nLayer 9\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l9_gpu11 [label="Aggregate\nLayer 9\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l9_gpu12 [label="Aggregate\nLayer 9\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l9_gpu13 [label="Aggregate\nLayer 9\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l9_gpu14 [label="Aggregate\nLayer 9\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l9_gpu15 [label="Aggregate\nLayer 9\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		global_agg_l9 [label="Global Aggregation\nLayer 9\nAll GPUs\n[128,10000,4096]" fillcolor=pink shape=ellipse style=filled]
		residual_l9 [label="Residual Add\nLayer 9\nAll GPUs\nInput: [128,10000,4096]\nOutput: [128,10000,4096]" fillcolor=lightgray shape=rectangle style=filled]
	}
	subgraph cluster_layer_10 {
		label="Layer 10 (16 Experts on 16 GPUs)" style=dashed
		dist_l10 [label="Distribute Tokens\nLayer 10\nAll GPUs\n[128,10000,4096]" fillcolor=lightyellow shape=ellipse style=filled]
		mha_l10_gpu0 [label="MHA\nLayer 10\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l10_gpu1 [label="MHA\nLayer 10\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l10_gpu2 [label="MHA\nLayer 10\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l10_gpu3 [label="MHA\nLayer 10\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l10_gpu4 [label="MHA\nLayer 10\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l10_gpu5 [label="MHA\nLayer 10\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l10_gpu6 [label="MHA\nLayer 10\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l10_gpu7 [label="MHA\nLayer 10\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l10_gpu8 [label="MHA\nLayer 10\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l10_gpu9 [label="MHA\nLayer 10\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l10_gpu10 [label="MHA\nLayer 10\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l10_gpu11 [label="MHA\nLayer 10\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l10_gpu12 [label="MHA\nLayer 10\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l10_gpu13 [label="MHA\nLayer 10\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l10_gpu14 [label="MHA\nLayer 10\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l10_gpu15 [label="MHA\nLayer 10\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		gate_l10_gpu0 [label="Gate\nLayer 10\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l10_gpu1 [label="Gate\nLayer 10\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l10_gpu2 [label="Gate\nLayer 10\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l10_gpu3 [label="Gate\nLayer 10\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l10_gpu4 [label="Gate\nLayer 10\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l10_gpu5 [label="Gate\nLayer 10\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l10_gpu6 [label="Gate\nLayer 10\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l10_gpu7 [label="Gate\nLayer 10\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l10_gpu8 [label="Gate\nLayer 10\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l10_gpu9 [label="Gate\nLayer 10\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l10_gpu10 [label="Gate\nLayer 10\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l10_gpu11 [label="Gate\nLayer 10\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l10_gpu12 [label="Gate\nLayer 10\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l10_gpu13 [label="Gate\nLayer 10\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l10_gpu14 [label="Gate\nLayer 10\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l10_gpu15 [label="Gate\nLayer 10\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		expert_l10_gpu0 [label="Expert 1\nLayer 10\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light1 shape=rectangle style=filled]
		expert_l10_gpu1 [label="Expert 2\nLayer 10\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light2 shape=rectangle style=filled]
		expert_l10_gpu2 [label="Expert 3\nLayer 10\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light3 shape=rectangle style=filled]
		expert_l10_gpu3 [label="Expert 4\nLayer 10\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light4 shape=rectangle style=filled]
		expert_l10_gpu4 [label="Expert 5\nLayer 10\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light5 shape=rectangle style=filled]
		expert_l10_gpu5 [label="Expert 6\nLayer 10\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light6 shape=rectangle style=filled]
		expert_l10_gpu6 [label="Expert 7\nLayer 10\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light7 shape=rectangle style=filled]
		expert_l10_gpu7 [label="Expert 8\nLayer 10\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light8 shape=rectangle style=filled]
		expert_l10_gpu8 [label="Expert 9\nLayer 10\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light9 shape=rectangle style=filled]
		expert_l10_gpu9 [label="Expert 10\nLayer 10\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light10 shape=rectangle style=filled]
		expert_l10_gpu10 [label="Expert 11\nLayer 10\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light11 shape=rectangle style=filled]
		expert_l10_gpu11 [label="Expert 12\nLayer 10\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light12 shape=rectangle style=filled]
		expert_l10_gpu12 [label="Expert 13\nLayer 10\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light13 shape=rectangle style=filled]
		expert_l10_gpu13 [label="Expert 14\nLayer 10\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light14 shape=rectangle style=filled]
		expert_l10_gpu14 [label="Expert 15\nLayer 10\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light15 shape=rectangle style=filled]
		expert_l10_gpu15 [label="Expert 16\nLayer 10\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light16 shape=rectangle style=filled]
		agg_l10_gpu0 [label="Aggregate\nLayer 10\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l10_gpu1 [label="Aggregate\nLayer 10\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l10_gpu2 [label="Aggregate\nLayer 10\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l10_gpu3 [label="Aggregate\nLayer 10\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l10_gpu4 [label="Aggregate\nLayer 10\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l10_gpu5 [label="Aggregate\nLayer 10\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l10_gpu6 [label="Aggregate\nLayer 10\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l10_gpu7 [label="Aggregate\nLayer 10\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l10_gpu8 [label="Aggregate\nLayer 10\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l10_gpu9 [label="Aggregate\nLayer 10\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l10_gpu10 [label="Aggregate\nLayer 10\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l10_gpu11 [label="Aggregate\nLayer 10\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l10_gpu12 [label="Aggregate\nLayer 10\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l10_gpu13 [label="Aggregate\nLayer 10\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l10_gpu14 [label="Aggregate\nLayer 10\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l10_gpu15 [label="Aggregate\nLayer 10\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		global_agg_l10 [label="Global Aggregation\nLayer 10\nAll GPUs\n[128,10000,4096]" fillcolor=pink shape=ellipse style=filled]
		residual_l10 [label="Residual Add\nLayer 10\nAll GPUs\nInput: [128,10000,4096]\nOutput: [128,10000,4096]" fillcolor=lightgray shape=rectangle style=filled]
	}
	subgraph cluster_layer_11 {
		label="Layer 11 (16 Experts on 16 GPUs)" style=dashed
		dist_l11 [label="Distribute Tokens\nLayer 11\nAll GPUs\n[128,10000,4096]" fillcolor=lightyellow shape=ellipse style=filled]
		mha_l11_gpu0 [label="MHA\nLayer 11\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l11_gpu1 [label="MHA\nLayer 11\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l11_gpu2 [label="MHA\nLayer 11\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l11_gpu3 [label="MHA\nLayer 11\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l11_gpu4 [label="MHA\nLayer 11\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l11_gpu5 [label="MHA\nLayer 11\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l11_gpu6 [label="MHA\nLayer 11\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l11_gpu7 [label="MHA\nLayer 11\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l11_gpu8 [label="MHA\nLayer 11\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l11_gpu9 [label="MHA\nLayer 11\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l11_gpu10 [label="MHA\nLayer 11\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l11_gpu11 [label="MHA\nLayer 11\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l11_gpu12 [label="MHA\nLayer 11\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l11_gpu13 [label="MHA\nLayer 11\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l11_gpu14 [label="MHA\nLayer 11\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l11_gpu15 [label="MHA\nLayer 11\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		gate_l11_gpu0 [label="Gate\nLayer 11\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l11_gpu1 [label="Gate\nLayer 11\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l11_gpu2 [label="Gate\nLayer 11\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l11_gpu3 [label="Gate\nLayer 11\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l11_gpu4 [label="Gate\nLayer 11\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l11_gpu5 [label="Gate\nLayer 11\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l11_gpu6 [label="Gate\nLayer 11\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l11_gpu7 [label="Gate\nLayer 11\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l11_gpu8 [label="Gate\nLayer 11\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l11_gpu9 [label="Gate\nLayer 11\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l11_gpu10 [label="Gate\nLayer 11\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l11_gpu11 [label="Gate\nLayer 11\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l11_gpu12 [label="Gate\nLayer 11\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l11_gpu13 [label="Gate\nLayer 11\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l11_gpu14 [label="Gate\nLayer 11\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l11_gpu15 [label="Gate\nLayer 11\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		expert_l11_gpu0 [label="Expert 1\nLayer 11\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light1 shape=rectangle style=filled]
		expert_l11_gpu1 [label="Expert 2\nLayer 11\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light2 shape=rectangle style=filled]
		expert_l11_gpu2 [label="Expert 3\nLayer 11\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light3 shape=rectangle style=filled]
		expert_l11_gpu3 [label="Expert 4\nLayer 11\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light4 shape=rectangle style=filled]
		expert_l11_gpu4 [label="Expert 5\nLayer 11\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light5 shape=rectangle style=filled]
		expert_l11_gpu5 [label="Expert 6\nLayer 11\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light6 shape=rectangle style=filled]
		expert_l11_gpu6 [label="Expert 7\nLayer 11\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light7 shape=rectangle style=filled]
		expert_l11_gpu7 [label="Expert 8\nLayer 11\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light8 shape=rectangle style=filled]
		expert_l11_gpu8 [label="Expert 9\nLayer 11\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light9 shape=rectangle style=filled]
		expert_l11_gpu9 [label="Expert 10\nLayer 11\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light10 shape=rectangle style=filled]
		expert_l11_gpu10 [label="Expert 11\nLayer 11\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light11 shape=rectangle style=filled]
		expert_l11_gpu11 [label="Expert 12\nLayer 11\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light12 shape=rectangle style=filled]
		expert_l11_gpu12 [label="Expert 13\nLayer 11\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light13 shape=rectangle style=filled]
		expert_l11_gpu13 [label="Expert 14\nLayer 11\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light14 shape=rectangle style=filled]
		expert_l11_gpu14 [label="Expert 15\nLayer 11\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light15 shape=rectangle style=filled]
		expert_l11_gpu15 [label="Expert 16\nLayer 11\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light16 shape=rectangle style=filled]
		agg_l11_gpu0 [label="Aggregate\nLayer 11\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l11_gpu1 [label="Aggregate\nLayer 11\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l11_gpu2 [label="Aggregate\nLayer 11\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l11_gpu3 [label="Aggregate\nLayer 11\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l11_gpu4 [label="Aggregate\nLayer 11\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l11_gpu5 [label="Aggregate\nLayer 11\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l11_gpu6 [label="Aggregate\nLayer 11\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l11_gpu7 [label="Aggregate\nLayer 11\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l11_gpu8 [label="Aggregate\nLayer 11\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l11_gpu9 [label="Aggregate\nLayer 11\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l11_gpu10 [label="Aggregate\nLayer 11\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l11_gpu11 [label="Aggregate\nLayer 11\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l11_gpu12 [label="Aggregate\nLayer 11\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l11_gpu13 [label="Aggregate\nLayer 11\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l11_gpu14 [label="Aggregate\nLayer 11\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l11_gpu15 [label="Aggregate\nLayer 11\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		global_agg_l11 [label="Global Aggregation\nLayer 11\nAll GPUs\n[128,10000,4096]" fillcolor=pink shape=ellipse style=filled]
		residual_l11 [label="Residual Add\nLayer 11\nAll GPUs\nInput: [128,10000,4096]\nOutput: [128,10000,4096]" fillcolor=lightgray shape=rectangle style=filled]
	}
	subgraph cluster_layer_12 {
		label="Layer 12 (16 Experts on 16 GPUs)" style=dashed
		dist_l12 [label="Distribute Tokens\nLayer 12\nAll GPUs\n[128,10000,4096]" fillcolor=lightyellow shape=ellipse style=filled]
		mha_l12_gpu0 [label="MHA\nLayer 12\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l12_gpu1 [label="MHA\nLayer 12\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l12_gpu2 [label="MHA\nLayer 12\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l12_gpu3 [label="MHA\nLayer 12\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l12_gpu4 [label="MHA\nLayer 12\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l12_gpu5 [label="MHA\nLayer 12\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l12_gpu6 [label="MHA\nLayer 12\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l12_gpu7 [label="MHA\nLayer 12\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l12_gpu8 [label="MHA\nLayer 12\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l12_gpu9 [label="MHA\nLayer 12\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l12_gpu10 [label="MHA\nLayer 12\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l12_gpu11 [label="MHA\nLayer 12\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l12_gpu12 [label="MHA\nLayer 12\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l12_gpu13 [label="MHA\nLayer 12\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l12_gpu14 [label="MHA\nLayer 12\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l12_gpu15 [label="MHA\nLayer 12\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		gate_l12_gpu0 [label="Gate\nLayer 12\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l12_gpu1 [label="Gate\nLayer 12\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l12_gpu2 [label="Gate\nLayer 12\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l12_gpu3 [label="Gate\nLayer 12\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l12_gpu4 [label="Gate\nLayer 12\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l12_gpu5 [label="Gate\nLayer 12\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l12_gpu6 [label="Gate\nLayer 12\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l12_gpu7 [label="Gate\nLayer 12\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l12_gpu8 [label="Gate\nLayer 12\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l12_gpu9 [label="Gate\nLayer 12\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l12_gpu10 [label="Gate\nLayer 12\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l12_gpu11 [label="Gate\nLayer 12\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l12_gpu12 [label="Gate\nLayer 12\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l12_gpu13 [label="Gate\nLayer 12\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l12_gpu14 [label="Gate\nLayer 12\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l12_gpu15 [label="Gate\nLayer 12\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		expert_l12_gpu0 [label="Expert 1\nLayer 12\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light1 shape=rectangle style=filled]
		expert_l12_gpu1 [label="Expert 2\nLayer 12\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light2 shape=rectangle style=filled]
		expert_l12_gpu2 [label="Expert 3\nLayer 12\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light3 shape=rectangle style=filled]
		expert_l12_gpu3 [label="Expert 4\nLayer 12\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light4 shape=rectangle style=filled]
		expert_l12_gpu4 [label="Expert 5\nLayer 12\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light5 shape=rectangle style=filled]
		expert_l12_gpu5 [label="Expert 6\nLayer 12\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light6 shape=rectangle style=filled]
		expert_l12_gpu6 [label="Expert 7\nLayer 12\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light7 shape=rectangle style=filled]
		expert_l12_gpu7 [label="Expert 8\nLayer 12\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light8 shape=rectangle style=filled]
		expert_l12_gpu8 [label="Expert 9\nLayer 12\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light9 shape=rectangle style=filled]
		expert_l12_gpu9 [label="Expert 10\nLayer 12\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light10 shape=rectangle style=filled]
		expert_l12_gpu10 [label="Expert 11\nLayer 12\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light11 shape=rectangle style=filled]
		expert_l12_gpu11 [label="Expert 12\nLayer 12\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light12 shape=rectangle style=filled]
		expert_l12_gpu12 [label="Expert 13\nLayer 12\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light13 shape=rectangle style=filled]
		expert_l12_gpu13 [label="Expert 14\nLayer 12\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light14 shape=rectangle style=filled]
		expert_l12_gpu14 [label="Expert 15\nLayer 12\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light15 shape=rectangle style=filled]
		expert_l12_gpu15 [label="Expert 16\nLayer 12\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light16 shape=rectangle style=filled]
		agg_l12_gpu0 [label="Aggregate\nLayer 12\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l12_gpu1 [label="Aggregate\nLayer 12\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l12_gpu2 [label="Aggregate\nLayer 12\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l12_gpu3 [label="Aggregate\nLayer 12\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l12_gpu4 [label="Aggregate\nLayer 12\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l12_gpu5 [label="Aggregate\nLayer 12\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l12_gpu6 [label="Aggregate\nLayer 12\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l12_gpu7 [label="Aggregate\nLayer 12\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l12_gpu8 [label="Aggregate\nLayer 12\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l12_gpu9 [label="Aggregate\nLayer 12\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l12_gpu10 [label="Aggregate\nLayer 12\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l12_gpu11 [label="Aggregate\nLayer 12\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l12_gpu12 [label="Aggregate\nLayer 12\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l12_gpu13 [label="Aggregate\nLayer 12\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l12_gpu14 [label="Aggregate\nLayer 12\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l12_gpu15 [label="Aggregate\nLayer 12\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		global_agg_l12 [label="Global Aggregation\nLayer 12\nAll GPUs\n[128,10000,4096]" fillcolor=pink shape=ellipse style=filled]
		residual_l12 [label="Residual Add\nLayer 12\nAll GPUs\nInput: [128,10000,4096]\nOutput: [128,10000,4096]" fillcolor=lightgray shape=rectangle style=filled]
	}
	subgraph cluster_layer_13 {
		label="Layer 13 (16 Experts on 16 GPUs)" style=dashed
		dist_l13 [label="Distribute Tokens\nLayer 13\nAll GPUs\n[128,10000,4096]" fillcolor=lightyellow shape=ellipse style=filled]
		mha_l13_gpu0 [label="MHA\nLayer 13\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l13_gpu1 [label="MHA\nLayer 13\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l13_gpu2 [label="MHA\nLayer 13\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l13_gpu3 [label="MHA\nLayer 13\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l13_gpu4 [label="MHA\nLayer 13\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l13_gpu5 [label="MHA\nLayer 13\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l13_gpu6 [label="MHA\nLayer 13\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l13_gpu7 [label="MHA\nLayer 13\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l13_gpu8 [label="MHA\nLayer 13\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l13_gpu9 [label="MHA\nLayer 13\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l13_gpu10 [label="MHA\nLayer 13\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l13_gpu11 [label="MHA\nLayer 13\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l13_gpu12 [label="MHA\nLayer 13\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l13_gpu13 [label="MHA\nLayer 13\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l13_gpu14 [label="MHA\nLayer 13\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l13_gpu15 [label="MHA\nLayer 13\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		gate_l13_gpu0 [label="Gate\nLayer 13\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l13_gpu1 [label="Gate\nLayer 13\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l13_gpu2 [label="Gate\nLayer 13\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l13_gpu3 [label="Gate\nLayer 13\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l13_gpu4 [label="Gate\nLayer 13\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l13_gpu5 [label="Gate\nLayer 13\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l13_gpu6 [label="Gate\nLayer 13\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l13_gpu7 [label="Gate\nLayer 13\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l13_gpu8 [label="Gate\nLayer 13\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l13_gpu9 [label="Gate\nLayer 13\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l13_gpu10 [label="Gate\nLayer 13\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l13_gpu11 [label="Gate\nLayer 13\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l13_gpu12 [label="Gate\nLayer 13\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l13_gpu13 [label="Gate\nLayer 13\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l13_gpu14 [label="Gate\nLayer 13\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l13_gpu15 [label="Gate\nLayer 13\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		expert_l13_gpu0 [label="Expert 1\nLayer 13\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light1 shape=rectangle style=filled]
		expert_l13_gpu1 [label="Expert 2\nLayer 13\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light2 shape=rectangle style=filled]
		expert_l13_gpu2 [label="Expert 3\nLayer 13\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light3 shape=rectangle style=filled]
		expert_l13_gpu3 [label="Expert 4\nLayer 13\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light4 shape=rectangle style=filled]
		expert_l13_gpu4 [label="Expert 5\nLayer 13\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light5 shape=rectangle style=filled]
		expert_l13_gpu5 [label="Expert 6\nLayer 13\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light6 shape=rectangle style=filled]
		expert_l13_gpu6 [label="Expert 7\nLayer 13\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light7 shape=rectangle style=filled]
		expert_l13_gpu7 [label="Expert 8\nLayer 13\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light8 shape=rectangle style=filled]
		expert_l13_gpu8 [label="Expert 9\nLayer 13\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light9 shape=rectangle style=filled]
		expert_l13_gpu9 [label="Expert 10\nLayer 13\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light10 shape=rectangle style=filled]
		expert_l13_gpu10 [label="Expert 11\nLayer 13\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light11 shape=rectangle style=filled]
		expert_l13_gpu11 [label="Expert 12\nLayer 13\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light12 shape=rectangle style=filled]
		expert_l13_gpu12 [label="Expert 13\nLayer 13\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light13 shape=rectangle style=filled]
		expert_l13_gpu13 [label="Expert 14\nLayer 13\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light14 shape=rectangle style=filled]
		expert_l13_gpu14 [label="Expert 15\nLayer 13\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light15 shape=rectangle style=filled]
		expert_l13_gpu15 [label="Expert 16\nLayer 13\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light16 shape=rectangle style=filled]
		agg_l13_gpu0 [label="Aggregate\nLayer 13\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l13_gpu1 [label="Aggregate\nLayer 13\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l13_gpu2 [label="Aggregate\nLayer 13\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l13_gpu3 [label="Aggregate\nLayer 13\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l13_gpu4 [label="Aggregate\nLayer 13\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l13_gpu5 [label="Aggregate\nLayer 13\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l13_gpu6 [label="Aggregate\nLayer 13\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l13_gpu7 [label="Aggregate\nLayer 13\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l13_gpu8 [label="Aggregate\nLayer 13\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l13_gpu9 [label="Aggregate\nLayer 13\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l13_gpu10 [label="Aggregate\nLayer 13\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l13_gpu11 [label="Aggregate\nLayer 13\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l13_gpu12 [label="Aggregate\nLayer 13\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l13_gpu13 [label="Aggregate\nLayer 13\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l13_gpu14 [label="Aggregate\nLayer 13\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l13_gpu15 [label="Aggregate\nLayer 13\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		global_agg_l13 [label="Global Aggregation\nLayer 13\nAll GPUs\n[128,10000,4096]" fillcolor=pink shape=ellipse style=filled]
		residual_l13 [label="Residual Add\nLayer 13\nAll GPUs\nInput: [128,10000,4096]\nOutput: [128,10000,4096]" fillcolor=lightgray shape=rectangle style=filled]
	}
	subgraph cluster_layer_14 {
		label="Layer 14 (16 Experts on 16 GPUs)" style=dashed
		dist_l14 [label="Distribute Tokens\nLayer 14\nAll GPUs\n[128,10000,4096]" fillcolor=lightyellow shape=ellipse style=filled]
		mha_l14_gpu0 [label="MHA\nLayer 14\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l14_gpu1 [label="MHA\nLayer 14\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l14_gpu2 [label="MHA\nLayer 14\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l14_gpu3 [label="MHA\nLayer 14\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l14_gpu4 [label="MHA\nLayer 14\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l14_gpu5 [label="MHA\nLayer 14\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l14_gpu6 [label="MHA\nLayer 14\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l14_gpu7 [label="MHA\nLayer 14\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l14_gpu8 [label="MHA\nLayer 14\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l14_gpu9 [label="MHA\nLayer 14\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l14_gpu10 [label="MHA\nLayer 14\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l14_gpu11 [label="MHA\nLayer 14\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l14_gpu12 [label="MHA\nLayer 14\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l14_gpu13 [label="MHA\nLayer 14\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l14_gpu14 [label="MHA\nLayer 14\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l14_gpu15 [label="MHA\nLayer 14\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		gate_l14_gpu0 [label="Gate\nLayer 14\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l14_gpu1 [label="Gate\nLayer 14\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l14_gpu2 [label="Gate\nLayer 14\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l14_gpu3 [label="Gate\nLayer 14\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l14_gpu4 [label="Gate\nLayer 14\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l14_gpu5 [label="Gate\nLayer 14\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l14_gpu6 [label="Gate\nLayer 14\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l14_gpu7 [label="Gate\nLayer 14\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l14_gpu8 [label="Gate\nLayer 14\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l14_gpu9 [label="Gate\nLayer 14\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l14_gpu10 [label="Gate\nLayer 14\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l14_gpu11 [label="Gate\nLayer 14\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l14_gpu12 [label="Gate\nLayer 14\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l14_gpu13 [label="Gate\nLayer 14\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l14_gpu14 [label="Gate\nLayer 14\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l14_gpu15 [label="Gate\nLayer 14\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		expert_l14_gpu0 [label="Expert 1\nLayer 14\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light1 shape=rectangle style=filled]
		expert_l14_gpu1 [label="Expert 2\nLayer 14\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light2 shape=rectangle style=filled]
		expert_l14_gpu2 [label="Expert 3\nLayer 14\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light3 shape=rectangle style=filled]
		expert_l14_gpu3 [label="Expert 4\nLayer 14\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light4 shape=rectangle style=filled]
		expert_l14_gpu4 [label="Expert 5\nLayer 14\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light5 shape=rectangle style=filled]
		expert_l14_gpu5 [label="Expert 6\nLayer 14\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light6 shape=rectangle style=filled]
		expert_l14_gpu6 [label="Expert 7\nLayer 14\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light7 shape=rectangle style=filled]
		expert_l14_gpu7 [label="Expert 8\nLayer 14\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light8 shape=rectangle style=filled]
		expert_l14_gpu8 [label="Expert 9\nLayer 14\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light9 shape=rectangle style=filled]
		expert_l14_gpu9 [label="Expert 10\nLayer 14\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light10 shape=rectangle style=filled]
		expert_l14_gpu10 [label="Expert 11\nLayer 14\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light11 shape=rectangle style=filled]
		expert_l14_gpu11 [label="Expert 12\nLayer 14\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light12 shape=rectangle style=filled]
		expert_l14_gpu12 [label="Expert 13\nLayer 14\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light13 shape=rectangle style=filled]
		expert_l14_gpu13 [label="Expert 14\nLayer 14\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light14 shape=rectangle style=filled]
		expert_l14_gpu14 [label="Expert 15\nLayer 14\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light15 shape=rectangle style=filled]
		expert_l14_gpu15 [label="Expert 16\nLayer 14\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light16 shape=rectangle style=filled]
		agg_l14_gpu0 [label="Aggregate\nLayer 14\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l14_gpu1 [label="Aggregate\nLayer 14\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l14_gpu2 [label="Aggregate\nLayer 14\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l14_gpu3 [label="Aggregate\nLayer 14\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l14_gpu4 [label="Aggregate\nLayer 14\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l14_gpu5 [label="Aggregate\nLayer 14\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l14_gpu6 [label="Aggregate\nLayer 14\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l14_gpu7 [label="Aggregate\nLayer 14\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l14_gpu8 [label="Aggregate\nLayer 14\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l14_gpu9 [label="Aggregate\nLayer 14\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l14_gpu10 [label="Aggregate\nLayer 14\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l14_gpu11 [label="Aggregate\nLayer 14\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l14_gpu12 [label="Aggregate\nLayer 14\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l14_gpu13 [label="Aggregate\nLayer 14\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l14_gpu14 [label="Aggregate\nLayer 14\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l14_gpu15 [label="Aggregate\nLayer 14\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		global_agg_l14 [label="Global Aggregation\nLayer 14\nAll GPUs\n[128,10000,4096]" fillcolor=pink shape=ellipse style=filled]
		residual_l14 [label="Residual Add\nLayer 14\nAll GPUs\nInput: [128,10000,4096]\nOutput: [128,10000,4096]" fillcolor=lightgray shape=rectangle style=filled]
	}
	subgraph cluster_layer_15 {
		label="Layer 15 (16 Experts on 16 GPUs)" style=dashed
		dist_l15 [label="Distribute Tokens\nLayer 15\nAll GPUs\n[128,10000,4096]" fillcolor=lightyellow shape=ellipse style=filled]
		mha_l15_gpu0 [label="MHA\nLayer 15\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l15_gpu1 [label="MHA\nLayer 15\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l15_gpu2 [label="MHA\nLayer 15\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l15_gpu3 [label="MHA\nLayer 15\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l15_gpu4 [label="MHA\nLayer 15\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l15_gpu5 [label="MHA\nLayer 15\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l15_gpu6 [label="MHA\nLayer 15\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l15_gpu7 [label="MHA\nLayer 15\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l15_gpu8 [label="MHA\nLayer 15\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l15_gpu9 [label="MHA\nLayer 15\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l15_gpu10 [label="MHA\nLayer 15\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l15_gpu11 [label="MHA\nLayer 15\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l15_gpu12 [label="MHA\nLayer 15\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l15_gpu13 [label="MHA\nLayer 15\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l15_gpu14 [label="MHA\nLayer 15\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l15_gpu15 [label="MHA\nLayer 15\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		gate_l15_gpu0 [label="Gate\nLayer 15\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l15_gpu1 [label="Gate\nLayer 15\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l15_gpu2 [label="Gate\nLayer 15\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l15_gpu3 [label="Gate\nLayer 15\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l15_gpu4 [label="Gate\nLayer 15\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l15_gpu5 [label="Gate\nLayer 15\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l15_gpu6 [label="Gate\nLayer 15\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l15_gpu7 [label="Gate\nLayer 15\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l15_gpu8 [label="Gate\nLayer 15\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l15_gpu9 [label="Gate\nLayer 15\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l15_gpu10 [label="Gate\nLayer 15\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l15_gpu11 [label="Gate\nLayer 15\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l15_gpu12 [label="Gate\nLayer 15\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l15_gpu13 [label="Gate\nLayer 15\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l15_gpu14 [label="Gate\nLayer 15\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l15_gpu15 [label="Gate\nLayer 15\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		expert_l15_gpu0 [label="Expert 1\nLayer 15\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light1 shape=rectangle style=filled]
		expert_l15_gpu1 [label="Expert 2\nLayer 15\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light2 shape=rectangle style=filled]
		expert_l15_gpu2 [label="Expert 3\nLayer 15\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light3 shape=rectangle style=filled]
		expert_l15_gpu3 [label="Expert 4\nLayer 15\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light4 shape=rectangle style=filled]
		expert_l15_gpu4 [label="Expert 5\nLayer 15\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light5 shape=rectangle style=filled]
		expert_l15_gpu5 [label="Expert 6\nLayer 15\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light6 shape=rectangle style=filled]
		expert_l15_gpu6 [label="Expert 7\nLayer 15\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light7 shape=rectangle style=filled]
		expert_l15_gpu7 [label="Expert 8\nLayer 15\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light8 shape=rectangle style=filled]
		expert_l15_gpu8 [label="Expert 9\nLayer 15\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light9 shape=rectangle style=filled]
		expert_l15_gpu9 [label="Expert 10\nLayer 15\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light10 shape=rectangle style=filled]
		expert_l15_gpu10 [label="Expert 11\nLayer 15\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light11 shape=rectangle style=filled]
		expert_l15_gpu11 [label="Expert 12\nLayer 15\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light12 shape=rectangle style=filled]
		expert_l15_gpu12 [label="Expert 13\nLayer 15\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light13 shape=rectangle style=filled]
		expert_l15_gpu13 [label="Expert 14\nLayer 15\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light14 shape=rectangle style=filled]
		expert_l15_gpu14 [label="Expert 15\nLayer 15\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light15 shape=rectangle style=filled]
		expert_l15_gpu15 [label="Expert 16\nLayer 15\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light16 shape=rectangle style=filled]
		agg_l15_gpu0 [label="Aggregate\nLayer 15\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l15_gpu1 [label="Aggregate\nLayer 15\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l15_gpu2 [label="Aggregate\nLayer 15\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l15_gpu3 [label="Aggregate\nLayer 15\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l15_gpu4 [label="Aggregate\nLayer 15\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l15_gpu5 [label="Aggregate\nLayer 15\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l15_gpu6 [label="Aggregate\nLayer 15\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l15_gpu7 [label="Aggregate\nLayer 15\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l15_gpu8 [label="Aggregate\nLayer 15\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l15_gpu9 [label="Aggregate\nLayer 15\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l15_gpu10 [label="Aggregate\nLayer 15\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l15_gpu11 [label="Aggregate\nLayer 15\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l15_gpu12 [label="Aggregate\nLayer 15\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l15_gpu13 [label="Aggregate\nLayer 15\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l15_gpu14 [label="Aggregate\nLayer 15\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l15_gpu15 [label="Aggregate\nLayer 15\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		global_agg_l15 [label="Global Aggregation\nLayer 15\nAll GPUs\n[128,10000,4096]" fillcolor=pink shape=ellipse style=filled]
		residual_l15 [label="Residual Add\nLayer 15\nAll GPUs\nInput: [128,10000,4096]\nOutput: [128,10000,4096]" fillcolor=lightgray shape=rectangle style=filled]
	}
	subgraph cluster_layer_16 {
		label="Layer 16 (16 Experts on 16 GPUs)" style=dashed
		dist_l16 [label="Distribute Tokens\nLayer 16\nAll GPUs\n[128,10000,4096]" fillcolor=lightyellow shape=ellipse style=filled]
		mha_l16_gpu0 [label="MHA\nLayer 16\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l16_gpu1 [label="MHA\nLayer 16\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l16_gpu2 [label="MHA\nLayer 16\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l16_gpu3 [label="MHA\nLayer 16\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l16_gpu4 [label="MHA\nLayer 16\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l16_gpu5 [label="MHA\nLayer 16\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l16_gpu6 [label="MHA\nLayer 16\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l16_gpu7 [label="MHA\nLayer 16\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l16_gpu8 [label="MHA\nLayer 16\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l16_gpu9 [label="MHA\nLayer 16\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l16_gpu10 [label="MHA\nLayer 16\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l16_gpu11 [label="MHA\nLayer 16\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l16_gpu12 [label="MHA\nLayer 16\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l16_gpu13 [label="MHA\nLayer 16\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l16_gpu14 [label="MHA\nLayer 16\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		mha_l16_gpu15 [label="MHA\nLayer 16\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=lightgreen shape=rectangle style=filled]
		gate_l16_gpu0 [label="Gate\nLayer 16\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l16_gpu1 [label="Gate\nLayer 16\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l16_gpu2 [label="Gate\nLayer 16\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l16_gpu3 [label="Gate\nLayer 16\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l16_gpu4 [label="Gate\nLayer 16\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l16_gpu5 [label="Gate\nLayer 16\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l16_gpu6 [label="Gate\nLayer 16\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l16_gpu7 [label="Gate\nLayer 16\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l16_gpu8 [label="Gate\nLayer 16\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l16_gpu9 [label="Gate\nLayer 16\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l16_gpu10 [label="Gate\nLayer 16\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l16_gpu11 [label="Gate\nLayer 16\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l16_gpu12 [label="Gate\nLayer 16\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l16_gpu13 [label="Gate\nLayer 16\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l16_gpu14 [label="Gate\nLayer 16\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		gate_l16_gpu15 [label="Gate\nLayer 16\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,16]" fillcolor=lightblue shape=parallelogram style=filled]
		expert_l16_gpu0 [label="Expert 1\nLayer 16\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light1 shape=rectangle style=filled]
		expert_l16_gpu1 [label="Expert 2\nLayer 16\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light2 shape=rectangle style=filled]
		expert_l16_gpu2 [label="Expert 3\nLayer 16\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light3 shape=rectangle style=filled]
		expert_l16_gpu3 [label="Expert 4\nLayer 16\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light4 shape=rectangle style=filled]
		expert_l16_gpu4 [label="Expert 5\nLayer 16\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light5 shape=rectangle style=filled]
		expert_l16_gpu5 [label="Expert 6\nLayer 16\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light6 shape=rectangle style=filled]
		expert_l16_gpu6 [label="Expert 7\nLayer 16\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light7 shape=rectangle style=filled]
		expert_l16_gpu7 [label="Expert 8\nLayer 16\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light8 shape=rectangle style=filled]
		expert_l16_gpu8 [label="Expert 9\nLayer 16\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light9 shape=rectangle style=filled]
		expert_l16_gpu9 [label="Expert 10\nLayer 16\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light10 shape=rectangle style=filled]
		expert_l16_gpu10 [label="Expert 11\nLayer 16\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light11 shape=rectangle style=filled]
		expert_l16_gpu11 [label="Expert 12\nLayer 16\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light12 shape=rectangle style=filled]
		expert_l16_gpu12 [label="Expert 13\nLayer 16\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light13 shape=rectangle style=filled]
		expert_l16_gpu13 [label="Expert 14\nLayer 16\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light14 shape=rectangle style=filled]
		expert_l16_gpu14 [label="Expert 15\nLayer 16\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light15 shape=rectangle style=filled]
		expert_l16_gpu15 [label="Expert 16\nLayer 16\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=light16 shape=rectangle style=filled]
		agg_l16_gpu0 [label="Aggregate\nLayer 16\nGPU 0\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l16_gpu1 [label="Aggregate\nLayer 16\nGPU 1\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l16_gpu2 [label="Aggregate\nLayer 16\nGPU 2\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l16_gpu3 [label="Aggregate\nLayer 16\nGPU 3\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l16_gpu4 [label="Aggregate\nLayer 16\nGPU 4\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l16_gpu5 [label="Aggregate\nLayer 16\nGPU 5\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l16_gpu6 [label="Aggregate\nLayer 16\nGPU 6\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l16_gpu7 [label="Aggregate\nLayer 16\nGPU 7\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l16_gpu8 [label="Aggregate\nLayer 16\nGPU 8\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l16_gpu9 [label="Aggregate\nLayer 16\nGPU 9\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l16_gpu10 [label="Aggregate\nLayer 16\nGPU 10\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l16_gpu11 [label="Aggregate\nLayer 16\nGPU 11\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l16_gpu12 [label="Aggregate\nLayer 16\nGPU 12\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l16_gpu13 [label="Aggregate\nLayer 16\nGPU 13\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l16_gpu14 [label="Aggregate\nLayer 16\nGPU 14\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		agg_l16_gpu15 [label="Aggregate\nLayer 16\nGPU 15\nInput: [128,?,4096]\nOutput: [128,?,4096]" fillcolor=orange shape=parallelogram style=filled]
		global_agg_l16 [label="Global Aggregation\nLayer 16\nAll GPUs\n[128,10000,4096]" fillcolor=pink shape=ellipse style=filled]
		residual_l16 [label="Residual Add\nLayer 16\nAll GPUs\nInput: [128,10000,4096]\nOutput: [128,10000,4096]" fillcolor=lightgray shape=rectangle style=filled]
	}
	output [label="Output\nBatch: 128\nSeq Len: 10,000\nDim: 4096" fillcolor=yellow shape=ellipse style=filled]
	input -> token_dist
	token_dist -> dist_l1
	dist_l1 -> mha_l1_gpu0
	mha_l1_gpu0 -> gate_l1_gpu0
	gate_l1_gpu0 -> expert_l1_gpu0 [style=dashed]
	expert_l1_gpu0 -> agg_l1_gpu0
	agg_l1_gpu0 -> global_agg_l1
	dist_l1 -> mha_l1_gpu1
	mha_l1_gpu1 -> gate_l1_gpu1
	gate_l1_gpu1 -> expert_l1_gpu1 [style=dashed]
	expert_l1_gpu1 -> agg_l1_gpu1
	agg_l1_gpu1 -> global_agg_l1
	dist_l1 -> mha_l1_gpu2
	mha_l1_gpu2 -> gate_l1_gpu2
	gate_l1_gpu2 -> expert_l1_gpu2 [style=dashed]
	expert_l1_gpu2 -> agg_l1_gpu2
	agg_l1_gpu2 -> global_agg_l1
	dist_l1 -> mha_l1_gpu3
	mha_l1_gpu3 -> gate_l1_gpu3
	gate_l1_gpu3 -> expert_l1_gpu3 [style=dashed]
	expert_l1_gpu3 -> agg_l1_gpu3
	agg_l1_gpu3 -> global_agg_l1
	dist_l1 -> mha_l1_gpu4
	mha_l1_gpu4 -> gate_l1_gpu4
	gate_l1_gpu4 -> expert_l1_gpu4 [style=dashed]
	expert_l1_gpu4 -> agg_l1_gpu4
	agg_l1_gpu4 -> global_agg_l1
	dist_l1 -> mha_l1_gpu5
	mha_l1_gpu5 -> gate_l1_gpu5
	gate_l1_gpu5 -> expert_l1_gpu5 [style=dashed]
	expert_l1_gpu5 -> agg_l1_gpu5
	agg_l1_gpu5 -> global_agg_l1
	dist_l1 -> mha_l1_gpu6
	mha_l1_gpu6 -> gate_l1_gpu6
	gate_l1_gpu6 -> expert_l1_gpu6 [style=dashed]
	expert_l1_gpu6 -> agg_l1_gpu6
	agg_l1_gpu6 -> global_agg_l1
	dist_l1 -> mha_l1_gpu7
	mha_l1_gpu7 -> gate_l1_gpu7
	gate_l1_gpu7 -> expert_l1_gpu7 [style=dashed]
	expert_l1_gpu7 -> agg_l1_gpu7
	agg_l1_gpu7 -> global_agg_l1
	dist_l1 -> mha_l1_gpu8
	mha_l1_gpu8 -> gate_l1_gpu8
	gate_l1_gpu8 -> expert_l1_gpu8 [style=dashed]
	expert_l1_gpu8 -> agg_l1_gpu8
	agg_l1_gpu8 -> global_agg_l1
	dist_l1 -> mha_l1_gpu9
	mha_l1_gpu9 -> gate_l1_gpu9
	gate_l1_gpu9 -> expert_l1_gpu9 [style=dashed]
	expert_l1_gpu9 -> agg_l1_gpu9
	agg_l1_gpu9 -> global_agg_l1
	dist_l1 -> mha_l1_gpu10
	mha_l1_gpu10 -> gate_l1_gpu10
	gate_l1_gpu10 -> expert_l1_gpu10 [style=dashed]
	expert_l1_gpu10 -> agg_l1_gpu10
	agg_l1_gpu10 -> global_agg_l1
	dist_l1 -> mha_l1_gpu11
	mha_l1_gpu11 -> gate_l1_gpu11
	gate_l1_gpu11 -> expert_l1_gpu11 [style=dashed]
	expert_l1_gpu11 -> agg_l1_gpu11
	agg_l1_gpu11 -> global_agg_l1
	dist_l1 -> mha_l1_gpu12
	mha_l1_gpu12 -> gate_l1_gpu12
	gate_l1_gpu12 -> expert_l1_gpu12 [style=dashed]
	expert_l1_gpu12 -> agg_l1_gpu12
	agg_l1_gpu12 -> global_agg_l1
	dist_l1 -> mha_l1_gpu13
	mha_l1_gpu13 -> gate_l1_gpu13
	gate_l1_gpu13 -> expert_l1_gpu13 [style=dashed]
	expert_l1_gpu13 -> agg_l1_gpu13
	agg_l1_gpu13 -> global_agg_l1
	dist_l1 -> mha_l1_gpu14
	mha_l1_gpu14 -> gate_l1_gpu14
	gate_l1_gpu14 -> expert_l1_gpu14 [style=dashed]
	expert_l1_gpu14 -> agg_l1_gpu14
	agg_l1_gpu14 -> global_agg_l1
	dist_l1 -> mha_l1_gpu15
	mha_l1_gpu15 -> gate_l1_gpu15
	gate_l1_gpu15 -> expert_l1_gpu15 [style=dashed]
	expert_l1_gpu15 -> agg_l1_gpu15
	agg_l1_gpu15 -> global_agg_l1
	global_agg_l1 -> residual_l1
	token_dist -> residual_l1
	residual_l1 -> dist_l2
	dist_l2 -> mha_l2_gpu0
	mha_l2_gpu0 -> gate_l2_gpu0
	gate_l2_gpu0 -> expert_l2_gpu0 [style=dashed]
	expert_l2_gpu0 -> agg_l2_gpu0
	agg_l2_gpu0 -> global_agg_l2
	dist_l2 -> mha_l2_gpu1
	mha_l2_gpu1 -> gate_l2_gpu1
	gate_l2_gpu1 -> expert_l2_gpu1 [style=dashed]
	expert_l2_gpu1 -> agg_l2_gpu1
	agg_l2_gpu1 -> global_agg_l2
	dist_l2 -> mha_l2_gpu2
	mha_l2_gpu2 -> gate_l2_gpu2
	gate_l2_gpu2 -> expert_l2_gpu2 [style=dashed]
	expert_l2_gpu2 -> agg_l2_gpu2
	agg_l2_gpu2 -> global_agg_l2
	dist_l2 -> mha_l2_gpu3
	mha_l2_gpu3 -> gate_l2_gpu3
	gate_l2_gpu3 -> expert_l2_gpu3 [style=dashed]
	expert_l2_gpu3 -> agg_l2_gpu3
	agg_l2_gpu3 -> global_agg_l2
	dist_l2 -> mha_l2_gpu4
	mha_l2_gpu4 -> gate_l2_gpu4
	gate_l2_gpu4 -> expert_l2_gpu4 [style=dashed]
	expert_l2_gpu4 -> agg_l2_gpu4
	agg_l2_gpu4 -> global_agg_l2
	dist_l2 -> mha_l2_gpu5
	mha_l2_gpu5 -> gate_l2_gpu5
	gate_l2_gpu5 -> expert_l2_gpu5 [style=dashed]
	expert_l2_gpu5 -> agg_l2_gpu5
	agg_l2_gpu5 -> global_agg_l2
	dist_l2 -> mha_l2_gpu6
	mha_l2_gpu6 -> gate_l2_gpu6
	gate_l2_gpu6 -> expert_l2_gpu6 [style=dashed]
	expert_l2_gpu6 -> agg_l2_gpu6
	agg_l2_gpu6 -> global_agg_l2
	dist_l2 -> mha_l2_gpu7
	mha_l2_gpu7 -> gate_l2_gpu7
	gate_l2_gpu7 -> expert_l2_gpu7 [style=dashed]
	expert_l2_gpu7 -> agg_l2_gpu7
	agg_l2_gpu7 -> global_agg_l2
	dist_l2 -> mha_l2_gpu8
	mha_l2_gpu8 -> gate_l2_gpu8
	gate_l2_gpu8 -> expert_l2_gpu8 [style=dashed]
	expert_l2_gpu8 -> agg_l2_gpu8
	agg_l2_gpu8 -> global_agg_l2
	dist_l2 -> mha_l2_gpu9
	mha_l2_gpu9 -> gate_l2_gpu9
	gate_l2_gpu9 -> expert_l2_gpu9 [style=dashed]
	expert_l2_gpu9 -> agg_l2_gpu9
	agg_l2_gpu9 -> global_agg_l2
	dist_l2 -> mha_l2_gpu10
	mha_l2_gpu10 -> gate_l2_gpu10
	gate_l2_gpu10 -> expert_l2_gpu10 [style=dashed]
	expert_l2_gpu10 -> agg_l2_gpu10
	agg_l2_gpu10 -> global_agg_l2
	dist_l2 -> mha_l2_gpu11
	mha_l2_gpu11 -> gate_l2_gpu11
	gate_l2_gpu11 -> expert_l2_gpu11 [style=dashed]
	expert_l2_gpu11 -> agg_l2_gpu11
	agg_l2_gpu11 -> global_agg_l2
	dist_l2 -> mha_l2_gpu12
	mha_l2_gpu12 -> gate_l2_gpu12
	gate_l2_gpu12 -> expert_l2_gpu12 [style=dashed]
	expert_l2_gpu12 -> agg_l2_gpu12
	agg_l2_gpu12 -> global_agg_l2
	dist_l2 -> mha_l2_gpu13
	mha_l2_gpu13 -> gate_l2_gpu13
	gate_l2_gpu13 -> expert_l2_gpu13 [style=dashed]
	expert_l2_gpu13 -> agg_l2_gpu13
	agg_l2_gpu13 -> global_agg_l2
	dist_l2 -> mha_l2_gpu14
	mha_l2_gpu14 -> gate_l2_gpu14
	gate_l2_gpu14 -> expert_l2_gpu14 [style=dashed]
	expert_l2_gpu14 -> agg_l2_gpu14
	agg_l2_gpu14 -> global_agg_l2
	dist_l2 -> mha_l2_gpu15
	mha_l2_gpu15 -> gate_l2_gpu15
	gate_l2_gpu15 -> expert_l2_gpu15 [style=dashed]
	expert_l2_gpu15 -> agg_l2_gpu15
	agg_l2_gpu15 -> global_agg_l2
	global_agg_l2 -> residual_l2
	residual_l1 -> residual_l2
	residual_l2 -> dist_l3
	dist_l3 -> mha_l3_gpu0
	mha_l3_gpu0 -> gate_l3_gpu0
	gate_l3_gpu0 -> expert_l3_gpu0 [style=dashed]
	expert_l3_gpu0 -> agg_l3_gpu0
	agg_l3_gpu0 -> global_agg_l3
	dist_l3 -> mha_l3_gpu1
	mha_l3_gpu1 -> gate_l3_gpu1
	gate_l3_gpu1 -> expert_l3_gpu1 [style=dashed]
	expert_l3_gpu1 -> agg_l3_gpu1
	agg_l3_gpu1 -> global_agg_l3
	dist_l3 -> mha_l3_gpu2
	mha_l3_gpu2 -> gate_l3_gpu2
	gate_l3_gpu2 -> expert_l3_gpu2 [style=dashed]
	expert_l3_gpu2 -> agg_l3_gpu2
	agg_l3_gpu2 -> global_agg_l3
	dist_l3 -> mha_l3_gpu3
	mha_l3_gpu3 -> gate_l3_gpu3
	gate_l3_gpu3 -> expert_l3_gpu3 [style=dashed]
	expert_l3_gpu3 -> agg_l3_gpu3
	agg_l3_gpu3 -> global_agg_l3
	dist_l3 -> mha_l3_gpu4
	mha_l3_gpu4 -> gate_l3_gpu4
	gate_l3_gpu4 -> expert_l3_gpu4 [style=dashed]
	expert_l3_gpu4 -> agg_l3_gpu4
	agg_l3_gpu4 -> global_agg_l3
	dist_l3 -> mha_l3_gpu5
	mha_l3_gpu5 -> gate_l3_gpu5
	gate_l3_gpu5 -> expert_l3_gpu5 [style=dashed]
	expert_l3_gpu5 -> agg_l3_gpu5
	agg_l3_gpu5 -> global_agg_l3
	dist_l3 -> mha_l3_gpu6
	mha_l3_gpu6 -> gate_l3_gpu6
	gate_l3_gpu6 -> expert_l3_gpu6 [style=dashed]
	expert_l3_gpu6 -> agg_l3_gpu6
	agg_l3_gpu6 -> global_agg_l3
	dist_l3 -> mha_l3_gpu7
	mha_l3_gpu7 -> gate_l3_gpu7
	gate_l3_gpu7 -> expert_l3_gpu7 [style=dashed]
	expert_l3_gpu7 -> agg_l3_gpu7
	agg_l3_gpu7 -> global_agg_l3
	dist_l3 -> mha_l3_gpu8
	mha_l3_gpu8 -> gate_l3_gpu8
	gate_l3_gpu8 -> expert_l3_gpu8 [style=dashed]
	expert_l3_gpu8 -> agg_l3_gpu8
	agg_l3_gpu8 -> global_agg_l3
	dist_l3 -> mha_l3_gpu9
	mha_l3_gpu9 -> gate_l3_gpu9
	gate_l3_gpu9 -> expert_l3_gpu9 [style=dashed]
	expert_l3_gpu9 -> agg_l3_gpu9
	agg_l3_gpu9 -> global_agg_l3
	dist_l3 -> mha_l3_gpu10
	mha_l3_gpu10 -> gate_l3_gpu10
	gate_l3_gpu10 -> expert_l3_gpu10 [style=dashed]
	expert_l3_gpu10 -> agg_l3_gpu10
	agg_l3_gpu10 -> global_agg_l3
	dist_l3 -> mha_l3_gpu11
	mha_l3_gpu11 -> gate_l3_gpu11
	gate_l3_gpu11 -> expert_l3_gpu11 [style=dashed]
	expert_l3_gpu11 -> agg_l3_gpu11
	agg_l3_gpu11 -> global_agg_l3
	dist_l3 -> mha_l3_gpu12
	mha_l3_gpu12 -> gate_l3_gpu12
	gate_l3_gpu12 -> expert_l3_gpu12 [style=dashed]
	expert_l3_gpu12 -> agg_l3_gpu12
	agg_l3_gpu12 -> global_agg_l3
	dist_l3 -> mha_l3_gpu13
	mha_l3_gpu13 -> gate_l3_gpu13
	gate_l3_gpu13 -> expert_l3_gpu13 [style=dashed]
	expert_l3_gpu13 -> agg_l3_gpu13
	agg_l3_gpu13 -> global_agg_l3
	dist_l3 -> mha_l3_gpu14
	mha_l3_gpu14 -> gate_l3_gpu14
	gate_l3_gpu14 -> expert_l3_gpu14 [style=dashed]
	expert_l3_gpu14 -> agg_l3_gpu14
	agg_l3_gpu14 -> global_agg_l3
	dist_l3 -> mha_l3_gpu15
	mha_l3_gpu15 -> gate_l3_gpu15
	gate_l3_gpu15 -> expert_l3_gpu15 [style=dashed]
	expert_l3_gpu15 -> agg_l3_gpu15
	agg_l3_gpu15 -> global_agg_l3
	global_agg_l3 -> residual_l3
	residual_l2 -> residual_l3
	residual_l3 -> dist_l4
	dist_l4 -> mha_l4_gpu0
	mha_l4_gpu0 -> gate_l4_gpu0
	gate_l4_gpu0 -> expert_l4_gpu0 [style=dashed]
	expert_l4_gpu0 -> agg_l4_gpu0
	agg_l4_gpu0 -> global_agg_l4
	dist_l4 -> mha_l4_gpu1
	mha_l4_gpu1 -> gate_l4_gpu1
	gate_l4_gpu1 -> expert_l4_gpu1 [style=dashed]
	expert_l4_gpu1 -> agg_l4_gpu1
	agg_l4_gpu1 -> global_agg_l4
	dist_l4 -> mha_l4_gpu2
	mha_l4_gpu2 -> gate_l4_gpu2
	gate_l4_gpu2 -> expert_l4_gpu2 [style=dashed]
	expert_l4_gpu2 -> agg_l4_gpu2
	agg_l4_gpu2 -> global_agg_l4
	dist_l4 -> mha_l4_gpu3
	mha_l4_gpu3 -> gate_l4_gpu3
	gate_l4_gpu3 -> expert_l4_gpu3 [style=dashed]
	expert_l4_gpu3 -> agg_l4_gpu3
	agg_l4_gpu3 -> global_agg_l4
	dist_l4 -> mha_l4_gpu4
	mha_l4_gpu4 -> gate_l4_gpu4
	gate_l4_gpu4 -> expert_l4_gpu4 [style=dashed]
	expert_l4_gpu4 -> agg_l4_gpu4
	agg_l4_gpu4 -> global_agg_l4
	dist_l4 -> mha_l4_gpu5
	mha_l4_gpu5 -> gate_l4_gpu5
	gate_l4_gpu5 -> expert_l4_gpu5 [style=dashed]
	expert_l4_gpu5 -> agg_l4_gpu5
	agg_l4_gpu5 -> global_agg_l4
	dist_l4 -> mha_l4_gpu6
	mha_l4_gpu6 -> gate_l4_gpu6
	gate_l4_gpu6 -> expert_l4_gpu6 [style=dashed]
	expert_l4_gpu6 -> agg_l4_gpu6
	agg_l4_gpu6 -> global_agg_l4
	dist_l4 -> mha_l4_gpu7
	mha_l4_gpu7 -> gate_l4_gpu7
	gate_l4_gpu7 -> expert_l4_gpu7 [style=dashed]
	expert_l4_gpu7 -> agg_l4_gpu7
	agg_l4_gpu7 -> global_agg_l4
	dist_l4 -> mha_l4_gpu8
	mha_l4_gpu8 -> gate_l4_gpu8
	gate_l4_gpu8 -> expert_l4_gpu8 [style=dashed]
	expert_l4_gpu8 -> agg_l4_gpu8
	agg_l4_gpu8 -> global_agg_l4
	dist_l4 -> mha_l4_gpu9
	mha_l4_gpu9 -> gate_l4_gpu9
	gate_l4_gpu9 -> expert_l4_gpu9 [style=dashed]
	expert_l4_gpu9 -> agg_l4_gpu9
	agg_l4_gpu9 -> global_agg_l4
	dist_l4 -> mha_l4_gpu10
	mha_l4_gpu10 -> gate_l4_gpu10
	gate_l4_gpu10 -> expert_l4_gpu10 [style=dashed]
	expert_l4_gpu10 -> agg_l4_gpu10
	agg_l4_gpu10 -> global_agg_l4
	dist_l4 -> mha_l4_gpu11
	mha_l4_gpu11 -> gate_l4_gpu11
	gate_l4_gpu11 -> expert_l4_gpu11 [style=dashed]
	expert_l4_gpu11 -> agg_l4_gpu11
	agg_l4_gpu11 -> global_agg_l4
	dist_l4 -> mha_l4_gpu12
	mha_l4_gpu12 -> gate_l4_gpu12
	gate_l4_gpu12 -> expert_l4_gpu12 [style=dashed]
	expert_l4_gpu12 -> agg_l4_gpu12
	agg_l4_gpu12 -> global_agg_l4
	dist_l4 -> mha_l4_gpu13
	mha_l4_gpu13 -> gate_l4_gpu13
	gate_l4_gpu13 -> expert_l4_gpu13 [style=dashed]
	expert_l4_gpu13 -> agg_l4_gpu13
	agg_l4_gpu13 -> global_agg_l4
	dist_l4 -> mha_l4_gpu14
	mha_l4_gpu14 -> gate_l4_gpu14
	gate_l4_gpu14 -> expert_l4_gpu14 [style=dashed]
	expert_l4_gpu14 -> agg_l4_gpu14
	agg_l4_gpu14 -> global_agg_l4
	dist_l4 -> mha_l4_gpu15
	mha_l4_gpu15 -> gate_l4_gpu15
	gate_l4_gpu15 -> expert_l4_gpu15 [style=dashed]
	expert_l4_gpu15 -> agg_l4_gpu15
	agg_l4_gpu15 -> global_agg_l4
	global_agg_l4 -> residual_l4
	residual_l3 -> residual_l4
	residual_l4 -> dist_l5
	dist_l5 -> mha_l5_gpu0
	mha_l5_gpu0 -> gate_l5_gpu0
	gate_l5_gpu0 -> expert_l5_gpu0 [style=dashed]
	expert_l5_gpu0 -> agg_l5_gpu0
	agg_l5_gpu0 -> global_agg_l5
	dist_l5 -> mha_l5_gpu1
	mha_l5_gpu1 -> gate_l5_gpu1
	gate_l5_gpu1 -> expert_l5_gpu1 [style=dashed]
	expert_l5_gpu1 -> agg_l5_gpu1
	agg_l5_gpu1 -> global_agg_l5
	dist_l5 -> mha_l5_gpu2
	mha_l5_gpu2 -> gate_l5_gpu2
	gate_l5_gpu2 -> expert_l5_gpu2 [style=dashed]
	expert_l5_gpu2 -> agg_l5_gpu2
	agg_l5_gpu2 -> global_agg_l5
	dist_l5 -> mha_l5_gpu3
	mha_l5_gpu3 -> gate_l5_gpu3
	gate_l5_gpu3 -> expert_l5_gpu3 [style=dashed]
	expert_l5_gpu3 -> agg_l5_gpu3
	agg_l5_gpu3 -> global_agg_l5
	dist_l5 -> mha_l5_gpu4
	mha_l5_gpu4 -> gate_l5_gpu4
	gate_l5_gpu4 -> expert_l5_gpu4 [style=dashed]
	expert_l5_gpu4 -> agg_l5_gpu4
	agg_l5_gpu4 -> global_agg_l5
	dist_l5 -> mha_l5_gpu5
	mha_l5_gpu5 -> gate_l5_gpu5
	gate_l5_gpu5 -> expert_l5_gpu5 [style=dashed]
	expert_l5_gpu5 -> agg_l5_gpu5
	agg_l5_gpu5 -> global_agg_l5
	dist_l5 -> mha_l5_gpu6
	mha_l5_gpu6 -> gate_l5_gpu6
	gate_l5_gpu6 -> expert_l5_gpu6 [style=dashed]
	expert_l5_gpu6 -> agg_l5_gpu6
	agg_l5_gpu6 -> global_agg_l5
	dist_l5 -> mha_l5_gpu7
	mha_l5_gpu7 -> gate_l5_gpu7
	gate_l5_gpu7 -> expert_l5_gpu7 [style=dashed]
	expert_l5_gpu7 -> agg_l5_gpu7
	agg_l5_gpu7 -> global_agg_l5
	dist_l5 -> mha_l5_gpu8
	mha_l5_gpu8 -> gate_l5_gpu8
	gate_l5_gpu8 -> expert_l5_gpu8 [style=dashed]
	expert_l5_gpu8 -> agg_l5_gpu8
	agg_l5_gpu8 -> global_agg_l5
	dist_l5 -> mha_l5_gpu9
	mha_l5_gpu9 -> gate_l5_gpu9
	gate_l5_gpu9 -> expert_l5_gpu9 [style=dashed]
	expert_l5_gpu9 -> agg_l5_gpu9
	agg_l5_gpu9 -> global_agg_l5
	dist_l5 -> mha_l5_gpu10
	mha_l5_gpu10 -> gate_l5_gpu10
	gate_l5_gpu10 -> expert_l5_gpu10 [style=dashed]
	expert_l5_gpu10 -> agg_l5_gpu10
	agg_l5_gpu10 -> global_agg_l5
	dist_l5 -> mha_l5_gpu11
	mha_l5_gpu11 -> gate_l5_gpu11
	gate_l5_gpu11 -> expert_l5_gpu11 [style=dashed]
	expert_l5_gpu11 -> agg_l5_gpu11
	agg_l5_gpu11 -> global_agg_l5
	dist_l5 -> mha_l5_gpu12
	mha_l5_gpu12 -> gate_l5_gpu12
	gate_l5_gpu12 -> expert_l5_gpu12 [style=dashed]
	expert_l5_gpu12 -> agg_l5_gpu12
	agg_l5_gpu12 -> global_agg_l5
	dist_l5 -> mha_l5_gpu13
	mha_l5_gpu13 -> gate_l5_gpu13
	gate_l5_gpu13 -> expert_l5_gpu13 [style=dashed]
	expert_l5_gpu13 -> agg_l5_gpu13
	agg_l5_gpu13 -> global_agg_l5
	dist_l5 -> mha_l5_gpu14
	mha_l5_gpu14 -> gate_l5_gpu14
	gate_l5_gpu14 -> expert_l5_gpu14 [style=dashed]
	expert_l5_gpu14 -> agg_l5_gpu14
	agg_l5_gpu14 -> global_agg_l5
	dist_l5 -> mha_l5_gpu15
	mha_l5_gpu15 -> gate_l5_gpu15
	gate_l5_gpu15 -> expert_l5_gpu15 [style=dashed]
	expert_l5_gpu15 -> agg_l5_gpu15
	agg_l5_gpu15 -> global_agg_l5
	global_agg_l5 -> residual_l5
	residual_l4 -> residual_l5
	residual_l5 -> dist_l6
	dist_l6 -> mha_l6_gpu0
	mha_l6_gpu0 -> gate_l6_gpu0
	gate_l6_gpu0 -> expert_l6_gpu0 [style=dashed]
	expert_l6_gpu0 -> agg_l6_gpu0
	agg_l6_gpu0 -> global_agg_l6
	dist_l6 -> mha_l6_gpu1
	mha_l6_gpu1 -> gate_l6_gpu1
	gate_l6_gpu1 -> expert_l6_gpu1 [style=dashed]
	expert_l6_gpu1 -> agg_l6_gpu1
	agg_l6_gpu1 -> global_agg_l6
	dist_l6 -> mha_l6_gpu2
	mha_l6_gpu2 -> gate_l6_gpu2
	gate_l6_gpu2 -> expert_l6_gpu2 [style=dashed]
	expert_l6_gpu2 -> agg_l6_gpu2
	agg_l6_gpu2 -> global_agg_l6
	dist_l6 -> mha_l6_gpu3
	mha_l6_gpu3 -> gate_l6_gpu3
	gate_l6_gpu3 -> expert_l6_gpu3 [style=dashed]
	expert_l6_gpu3 -> agg_l6_gpu3
	agg_l6_gpu3 -> global_agg_l6
	dist_l6 -> mha_l6_gpu4
	mha_l6_gpu4 -> gate_l6_gpu4
	gate_l6_gpu4 -> expert_l6_gpu4 [style=dashed]
	expert_l6_gpu4 -> agg_l6_gpu4
	agg_l6_gpu4 -> global_agg_l6
	dist_l6 -> mha_l6_gpu5
	mha_l6_gpu5 -> gate_l6_gpu5
	gate_l6_gpu5 -> expert_l6_gpu5 [style=dashed]
	expert_l6_gpu5 -> agg_l6_gpu5
	agg_l6_gpu5 -> global_agg_l6
	dist_l6 -> mha_l6_gpu6
	mha_l6_gpu6 -> gate_l6_gpu6
	gate_l6_gpu6 -> expert_l6_gpu6 [style=dashed]
	expert_l6_gpu6 -> agg_l6_gpu6
	agg_l6_gpu6 -> global_agg_l6
	dist_l6 -> mha_l6_gpu7
	mha_l6_gpu7 -> gate_l6_gpu7
	gate_l6_gpu7 -> expert_l6_gpu7 [style=dashed]
	expert_l6_gpu7 -> agg_l6_gpu7
	agg_l6_gpu7 -> global_agg_l6
	dist_l6 -> mha_l6_gpu8
	mha_l6_gpu8 -> gate_l6_gpu8
	gate_l6_gpu8 -> expert_l6_gpu8 [style=dashed]
	expert_l6_gpu8 -> agg_l6_gpu8
	agg_l6_gpu8 -> global_agg_l6
	dist_l6 -> mha_l6_gpu9
	mha_l6_gpu9 -> gate_l6_gpu9
	gate_l6_gpu9 -> expert_l6_gpu9 [style=dashed]
	expert_l6_gpu9 -> agg_l6_gpu9
	agg_l6_gpu9 -> global_agg_l6
	dist_l6 -> mha_l6_gpu10
	mha_l6_gpu10 -> gate_l6_gpu10
	gate_l6_gpu10 -> expert_l6_gpu10 [style=dashed]
	expert_l6_gpu10 -> agg_l6_gpu10
	agg_l6_gpu10 -> global_agg_l6
	dist_l6 -> mha_l6_gpu11
	mha_l6_gpu11 -> gate_l6_gpu11
	gate_l6_gpu11 -> expert_l6_gpu11 [style=dashed]
	expert_l6_gpu11 -> agg_l6_gpu11
	agg_l6_gpu11 -> global_agg_l6
	dist_l6 -> mha_l6_gpu12
	mha_l6_gpu12 -> gate_l6_gpu12
	gate_l6_gpu12 -> expert_l6_gpu12 [style=dashed]
	expert_l6_gpu12 -> agg_l6_gpu12
	agg_l6_gpu12 -> global_agg_l6
	dist_l6 -> mha_l6_gpu13
	mha_l6_gpu13 -> gate_l6_gpu13
	gate_l6_gpu13 -> expert_l6_gpu13 [style=dashed]
	expert_l6_gpu13 -> agg_l6_gpu13
	agg_l6_gpu13 -> global_agg_l6
	dist_l6 -> mha_l6_gpu14
	mha_l6_gpu14 -> gate_l6_gpu14
	gate_l6_gpu14 -> expert_l6_gpu14 [style=dashed]
	expert_l6_gpu14 -> agg_l6_gpu14
	agg_l6_gpu14 -> global_agg_l6
	dist_l6 -> mha_l6_gpu15
	mha_l6_gpu15 -> gate_l6_gpu15
	gate_l6_gpu15 -> expert_l6_gpu15 [style=dashed]
	expert_l6_gpu15 -> agg_l6_gpu15
	agg_l6_gpu15 -> global_agg_l6
	global_agg_l6 -> residual_l6
	residual_l5 -> residual_l6
	residual_l6 -> dist_l7
	dist_l7 -> mha_l7_gpu0
	mha_l7_gpu0 -> gate_l7_gpu0
	gate_l7_gpu0 -> expert_l7_gpu0 [style=dashed]
	expert_l7_gpu0 -> agg_l7_gpu0
	agg_l7_gpu0 -> global_agg_l7
	dist_l7 -> mha_l7_gpu1
	mha_l7_gpu1 -> gate_l7_gpu1
	gate_l7_gpu1 -> expert_l7_gpu1 [style=dashed]
	expert_l7_gpu1 -> agg_l7_gpu1
	agg_l7_gpu1 -> global_agg_l7
	dist_l7 -> mha_l7_gpu2
	mha_l7_gpu2 -> gate_l7_gpu2
	gate_l7_gpu2 -> expert_l7_gpu2 [style=dashed]
	expert_l7_gpu2 -> agg_l7_gpu2
	agg_l7_gpu2 -> global_agg_l7
	dist_l7 -> mha_l7_gpu3
	mha_l7_gpu3 -> gate_l7_gpu3
	gate_l7_gpu3 -> expert_l7_gpu3 [style=dashed]
	expert_l7_gpu3 -> agg_l7_gpu3
	agg_l7_gpu3 -> global_agg_l7
	dist_l7 -> mha_l7_gpu4
	mha_l7_gpu4 -> gate_l7_gpu4
	gate_l7_gpu4 -> expert_l7_gpu4 [style=dashed]
	expert_l7_gpu4 -> agg_l7_gpu4
	agg_l7_gpu4 -> global_agg_l7
	dist_l7 -> mha_l7_gpu5
	mha_l7_gpu5 -> gate_l7_gpu5
	gate_l7_gpu5 -> expert_l7_gpu5 [style=dashed]
	expert_l7_gpu5 -> agg_l7_gpu5
	agg_l7_gpu5 -> global_agg_l7
	dist_l7 -> mha_l7_gpu6
	mha_l7_gpu6 -> gate_l7_gpu6
	gate_l7_gpu6 -> expert_l7_gpu6 [style=dashed]
	expert_l7_gpu6 -> agg_l7_gpu6
	agg_l7_gpu6 -> global_agg_l7
	dist_l7 -> mha_l7_gpu7
	mha_l7_gpu7 -> gate_l7_gpu7
	gate_l7_gpu7 -> expert_l7_gpu7 [style=dashed]
	expert_l7_gpu7 -> agg_l7_gpu7
	agg_l7_gpu7 -> global_agg_l7
	dist_l7 -> mha_l7_gpu8
	mha_l7_gpu8 -> gate_l7_gpu8
	gate_l7_gpu8 -> expert_l7_gpu8 [style=dashed]
	expert_l7_gpu8 -> agg_l7_gpu8
	agg_l7_gpu8 -> global_agg_l7
	dist_l7 -> mha_l7_gpu9
	mha_l7_gpu9 -> gate_l7_gpu9
	gate_l7_gpu9 -> expert_l7_gpu9 [style=dashed]
	expert_l7_gpu9 -> agg_l7_gpu9
	agg_l7_gpu9 -> global_agg_l7
	dist_l7 -> mha_l7_gpu10
	mha_l7_gpu10 -> gate_l7_gpu10
	gate_l7_gpu10 -> expert_l7_gpu10 [style=dashed]
	expert_l7_gpu10 -> agg_l7_gpu10
	agg_l7_gpu10 -> global_agg_l7
	dist_l7 -> mha_l7_gpu11
	mha_l7_gpu11 -> gate_l7_gpu11
	gate_l7_gpu11 -> expert_l7_gpu11 [style=dashed]
	expert_l7_gpu11 -> agg_l7_gpu11
	agg_l7_gpu11 -> global_agg_l7
	dist_l7 -> mha_l7_gpu12
	mha_l7_gpu12 -> gate_l7_gpu12
	gate_l7_gpu12 -> expert_l7_gpu12 [style=dashed]
	expert_l7_gpu12 -> agg_l7_gpu12
	agg_l7_gpu12 -> global_agg_l7
	dist_l7 -> mha_l7_gpu13
	mha_l7_gpu13 -> gate_l7_gpu13
	gate_l7_gpu13 -> expert_l7_gpu13 [style=dashed]
	expert_l7_gpu13 -> agg_l7_gpu13
	agg_l7_gpu13 -> global_agg_l7
	dist_l7 -> mha_l7_gpu14
	mha_l7_gpu14 -> gate_l7_gpu14
	gate_l7_gpu14 -> expert_l7_gpu14 [style=dashed]
	expert_l7_gpu14 -> agg_l7_gpu14
	agg_l7_gpu14 -> global_agg_l7
	dist_l7 -> mha_l7_gpu15
	mha_l7_gpu15 -> gate_l7_gpu15
	gate_l7_gpu15 -> expert_l7_gpu15 [style=dashed]
	expert_l7_gpu15 -> agg_l7_gpu15
	agg_l7_gpu15 -> global_agg_l7
	global_agg_l7 -> residual_l7
	residual_l6 -> residual_l7
	residual_l7 -> dist_l8
	dist_l8 -> mha_l8_gpu0
	mha_l8_gpu0 -> gate_l8_gpu0
	gate_l8_gpu0 -> expert_l8_gpu0 [style=dashed]
	expert_l8_gpu0 -> agg_l8_gpu0
	agg_l8_gpu0 -> global_agg_l8
	dist_l8 -> mha_l8_gpu1
	mha_l8_gpu1 -> gate_l8_gpu1
	gate_l8_gpu1 -> expert_l8_gpu1 [style=dashed]
	expert_l8_gpu1 -> agg_l8_gpu1
	agg_l8_gpu1 -> global_agg_l8
	dist_l8 -> mha_l8_gpu2
	mha_l8_gpu2 -> gate_l8_gpu2
	gate_l8_gpu2 -> expert_l8_gpu2 [style=dashed]
	expert_l8_gpu2 -> agg_l8_gpu2
	agg_l8_gpu2 -> global_agg_l8
	dist_l8 -> mha_l8_gpu3
	mha_l8_gpu3 -> gate_l8_gpu3
	gate_l8_gpu3 -> expert_l8_gpu3 [style=dashed]
	expert_l8_gpu3 -> agg_l8_gpu3
	agg_l8_gpu3 -> global_agg_l8
	dist_l8 -> mha_l8_gpu4
	mha_l8_gpu4 -> gate_l8_gpu4
	gate_l8_gpu4 -> expert_l8_gpu4 [style=dashed]
	expert_l8_gpu4 -> agg_l8_gpu4
	agg_l8_gpu4 -> global_agg_l8
	dist_l8 -> mha_l8_gpu5
	mha_l8_gpu5 -> gate_l8_gpu5
	gate_l8_gpu5 -> expert_l8_gpu5 [style=dashed]
	expert_l8_gpu5 -> agg_l8_gpu5
	agg_l8_gpu5 -> global_agg_l8
	dist_l8 -> mha_l8_gpu6
	mha_l8_gpu6 -> gate_l8_gpu6
	gate_l8_gpu6 -> expert_l8_gpu6 [style=dashed]
	expert_l8_gpu6 -> agg_l8_gpu6
	agg_l8_gpu6 -> global_agg_l8
	dist_l8 -> mha_l8_gpu7
	mha_l8_gpu7 -> gate_l8_gpu7
	gate_l8_gpu7 -> expert_l8_gpu7 [style=dashed]
	expert_l8_gpu7 -> agg_l8_gpu7
	agg_l8_gpu7 -> global_agg_l8
	dist_l8 -> mha_l8_gpu8
	mha_l8_gpu8 -> gate_l8_gpu8
	gate_l8_gpu8 -> expert_l8_gpu8 [style=dashed]
	expert_l8_gpu8 -> agg_l8_gpu8
	agg_l8_gpu8 -> global_agg_l8
	dist_l8 -> mha_l8_gpu9
	mha_l8_gpu9 -> gate_l8_gpu9
	gate_l8_gpu9 -> expert_l8_gpu9 [style=dashed]
	expert_l8_gpu9 -> agg_l8_gpu9
	agg_l8_gpu9 -> global_agg_l8
	dist_l8 -> mha_l8_gpu10
	mha_l8_gpu10 -> gate_l8_gpu10
	gate_l8_gpu10 -> expert_l8_gpu10 [style=dashed]
	expert_l8_gpu10 -> agg_l8_gpu10
	agg_l8_gpu10 -> global_agg_l8
	dist_l8 -> mha_l8_gpu11
	mha_l8_gpu11 -> gate_l8_gpu11
	gate_l8_gpu11 -> expert_l8_gpu11 [style=dashed]
	expert_l8_gpu11 -> agg_l8_gpu11
	agg_l8_gpu11 -> global_agg_l8
	dist_l8 -> mha_l8_gpu12
	mha_l8_gpu12 -> gate_l8_gpu12
	gate_l8_gpu12 -> expert_l8_gpu12 [style=dashed]
	expert_l8_gpu12 -> agg_l8_gpu12
	agg_l8_gpu12 -> global_agg_l8
	dist_l8 -> mha_l8_gpu13
	mha_l8_gpu13 -> gate_l8_gpu13
	gate_l8_gpu13 -> expert_l8_gpu13 [style=dashed]
	expert_l8_gpu13 -> agg_l8_gpu13
	agg_l8_gpu13 -> global_agg_l8
	dist_l8 -> mha_l8_gpu14
	mha_l8_gpu14 -> gate_l8_gpu14
	gate_l8_gpu14 -> expert_l8_gpu14 [style=dashed]
	expert_l8_gpu14 -> agg_l8_gpu14
	agg_l8_gpu14 -> global_agg_l8
	dist_l8 -> mha_l8_gpu15
	mha_l8_gpu15 -> gate_l8_gpu15
	gate_l8_gpu15 -> expert_l8_gpu15 [style=dashed]
	expert_l8_gpu15 -> agg_l8_gpu15
	agg_l8_gpu15 -> global_agg_l8
	global_agg_l8 -> residual_l8
	residual_l7 -> residual_l8
	residual_l8 -> dist_l9
	dist_l9 -> mha_l9_gpu0
	mha_l9_gpu0 -> gate_l9_gpu0
	gate_l9_gpu0 -> expert_l9_gpu0 [style=dashed]
	expert_l9_gpu0 -> agg_l9_gpu0
	agg_l9_gpu0 -> global_agg_l9
	dist_l9 -> mha_l9_gpu1
	mha_l9_gpu1 -> gate_l9_gpu1
	gate_l9_gpu1 -> expert_l9_gpu1 [style=dashed]
	expert_l9_gpu1 -> agg_l9_gpu1
	agg_l9_gpu1 -> global_agg_l9
	dist_l9 -> mha_l9_gpu2
	mha_l9_gpu2 -> gate_l9_gpu2
	gate_l9_gpu2 -> expert_l9_gpu2 [style=dashed]
	expert_l9_gpu2 -> agg_l9_gpu2
	agg_l9_gpu2 -> global_agg_l9
	dist_l9 -> mha_l9_gpu3
	mha_l9_gpu3 -> gate_l9_gpu3
	gate_l9_gpu3 -> expert_l9_gpu3 [style=dashed]
	expert_l9_gpu3 -> agg_l9_gpu3
	agg_l9_gpu3 -> global_agg_l9
	dist_l9 -> mha_l9_gpu4
	mha_l9_gpu4 -> gate_l9_gpu4
	gate_l9_gpu4 -> expert_l9_gpu4 [style=dashed]
	expert_l9_gpu4 -> agg_l9_gpu4
	agg_l9_gpu4 -> global_agg_l9
	dist_l9 -> mha_l9_gpu5
	mha_l9_gpu5 -> gate_l9_gpu5
	gate_l9_gpu5 -> expert_l9_gpu5 [style=dashed]
	expert_l9_gpu5 -> agg_l9_gpu5
	agg_l9_gpu5 -> global_agg_l9
	dist_l9 -> mha_l9_gpu6
	mha_l9_gpu6 -> gate_l9_gpu6
	gate_l9_gpu6 -> expert_l9_gpu6 [style=dashed]
	expert_l9_gpu6 -> agg_l9_gpu6
	agg_l9_gpu6 -> global_agg_l9
	dist_l9 -> mha_l9_gpu7
	mha_l9_gpu7 -> gate_l9_gpu7
	gate_l9_gpu7 -> expert_l9_gpu7 [style=dashed]
	expert_l9_gpu7 -> agg_l9_gpu7
	agg_l9_gpu7 -> global_agg_l9
	dist_l9 -> mha_l9_gpu8
	mha_l9_gpu8 -> gate_l9_gpu8
	gate_l9_gpu8 -> expert_l9_gpu8 [style=dashed]
	expert_l9_gpu8 -> agg_l9_gpu8
	agg_l9_gpu8 -> global_agg_l9
	dist_l9 -> mha_l9_gpu9
	mha_l9_gpu9 -> gate_l9_gpu9
	gate_l9_gpu9 -> expert_l9_gpu9 [style=dashed]
	expert_l9_gpu9 -> agg_l9_gpu9
	agg_l9_gpu9 -> global_agg_l9
	dist_l9 -> mha_l9_gpu10
	mha_l9_gpu10 -> gate_l9_gpu10
	gate_l9_gpu10 -> expert_l9_gpu10 [style=dashed]
	expert_l9_gpu10 -> agg_l9_gpu10
	agg_l9_gpu10 -> global_agg_l9
	dist_l9 -> mha_l9_gpu11
	mha_l9_gpu11 -> gate_l9_gpu11
	gate_l9_gpu11 -> expert_l9_gpu11 [style=dashed]
	expert_l9_gpu11 -> agg_l9_gpu11
	agg_l9_gpu11 -> global_agg_l9
	dist_l9 -> mha_l9_gpu12
	mha_l9_gpu12 -> gate_l9_gpu12
	gate_l9_gpu12 -> expert_l9_gpu12 [style=dashed]
	expert_l9_gpu12 -> agg_l9_gpu12
	agg_l9_gpu12 -> global_agg_l9
	dist_l9 -> mha_l9_gpu13
	mha_l9_gpu13 -> gate_l9_gpu13
	gate_l9_gpu13 -> expert_l9_gpu13 [style=dashed]
	expert_l9_gpu13 -> agg_l9_gpu13
	agg_l9_gpu13 -> global_agg_l9
	dist_l9 -> mha_l9_gpu14
	mha_l9_gpu14 -> gate_l9_gpu14
	gate_l9_gpu14 -> expert_l9_gpu14 [style=dashed]
	expert_l9_gpu14 -> agg_l9_gpu14
	agg_l9_gpu14 -> global_agg_l9
	dist_l9 -> mha_l9_gpu15
	mha_l9_gpu15 -> gate_l9_gpu15
	gate_l9_gpu15 -> expert_l9_gpu15 [style=dashed]
	expert_l9_gpu15 -> agg_l9_gpu15
	agg_l9_gpu15 -> global_agg_l9
	global_agg_l9 -> residual_l9
	residual_l8 -> residual_l9
	residual_l9 -> dist_l10
	dist_l10 -> mha_l10_gpu0
	mha_l10_gpu0 -> gate_l10_gpu0
	gate_l10_gpu0 -> expert_l10_gpu0 [style=dashed]
	expert_l10_gpu0 -> agg_l10_gpu0
	agg_l10_gpu0 -> global_agg_l10
	dist_l10 -> mha_l10_gpu1
	mha_l10_gpu1 -> gate_l10_gpu1
	gate_l10_gpu1 -> expert_l10_gpu1 [style=dashed]
	expert_l10_gpu1 -> agg_l10_gpu1
	agg_l10_gpu1 -> global_agg_l10
	dist_l10 -> mha_l10_gpu2
	mha_l10_gpu2 -> gate_l10_gpu2
	gate_l10_gpu2 -> expert_l10_gpu2 [style=dashed]
	expert_l10_gpu2 -> agg_l10_gpu2
	agg_l10_gpu2 -> global_agg_l10
	dist_l10 -> mha_l10_gpu3
	mha_l10_gpu3 -> gate_l10_gpu3
	gate_l10_gpu3 -> expert_l10_gpu3 [style=dashed]
	expert_l10_gpu3 -> agg_l10_gpu3
	agg_l10_gpu3 -> global_agg_l10
	dist_l10 -> mha_l10_gpu4
	mha_l10_gpu4 -> gate_l10_gpu4
	gate_l10_gpu4 -> expert_l10_gpu4 [style=dashed]
	expert_l10_gpu4 -> agg_l10_gpu4
	agg_l10_gpu4 -> global_agg_l10
	dist_l10 -> mha_l10_gpu5
	mha_l10_gpu5 -> gate_l10_gpu5
	gate_l10_gpu5 -> expert_l10_gpu5 [style=dashed]
	expert_l10_gpu5 -> agg_l10_gpu5
	agg_l10_gpu5 -> global_agg_l10
	dist_l10 -> mha_l10_gpu6
	mha_l10_gpu6 -> gate_l10_gpu6
	gate_l10_gpu6 -> expert_l10_gpu6 [style=dashed]
	expert_l10_gpu6 -> agg_l10_gpu6
	agg_l10_gpu6 -> global_agg_l10
	dist_l10 -> mha_l10_gpu7
	mha_l10_gpu7 -> gate_l10_gpu7
	gate_l10_gpu7 -> expert_l10_gpu7 [style=dashed]
	expert_l10_gpu7 -> agg_l10_gpu7
	agg_l10_gpu7 -> global_agg_l10
	dist_l10 -> mha_l10_gpu8
	mha_l10_gpu8 -> gate_l10_gpu8
	gate_l10_gpu8 -> expert_l10_gpu8 [style=dashed]
	expert_l10_gpu8 -> agg_l10_gpu8
	agg_l10_gpu8 -> global_agg_l10
	dist_l10 -> mha_l10_gpu9
	mha_l10_gpu9 -> gate_l10_gpu9
	gate_l10_gpu9 -> expert_l10_gpu9 [style=dashed]
	expert_l10_gpu9 -> agg_l10_gpu9
	agg_l10_gpu9 -> global_agg_l10
	dist_l10 -> mha_l10_gpu10
	mha_l10_gpu10 -> gate_l10_gpu10
	gate_l10_gpu10 -> expert_l10_gpu10 [style=dashed]
	expert_l10_gpu10 -> agg_l10_gpu10
	agg_l10_gpu10 -> global_agg_l10
	dist_l10 -> mha_l10_gpu11
	mha_l10_gpu11 -> gate_l10_gpu11
	gate_l10_gpu11 -> expert_l10_gpu11 [style=dashed]
	expert_l10_gpu11 -> agg_l10_gpu11
	agg_l10_gpu11 -> global_agg_l10
	dist_l10 -> mha_l10_gpu12
	mha_l10_gpu12 -> gate_l10_gpu12
	gate_l10_gpu12 -> expert_l10_gpu12 [style=dashed]
	expert_l10_gpu12 -> agg_l10_gpu12
	agg_l10_gpu12 -> global_agg_l10
	dist_l10 -> mha_l10_gpu13
	mha_l10_gpu13 -> gate_l10_gpu13
	gate_l10_gpu13 -> expert_l10_gpu13 [style=dashed]
	expert_l10_gpu13 -> agg_l10_gpu13
	agg_l10_gpu13 -> global_agg_l10
	dist_l10 -> mha_l10_gpu14
	mha_l10_gpu14 -> gate_l10_gpu14
	gate_l10_gpu14 -> expert_l10_gpu14 [style=dashed]
	expert_l10_gpu14 -> agg_l10_gpu14
	agg_l10_gpu14 -> global_agg_l10
	dist_l10 -> mha_l10_gpu15
	mha_l10_gpu15 -> gate_l10_gpu15
	gate_l10_gpu15 -> expert_l10_gpu15 [style=dashed]
	expert_l10_gpu15 -> agg_l10_gpu15
	agg_l10_gpu15 -> global_agg_l10
	global_agg_l10 -> residual_l10
	residual_l9 -> residual_l10
	residual_l10 -> dist_l11
	dist_l11 -> mha_l11_gpu0
	mha_l11_gpu0 -> gate_l11_gpu0
	gate_l11_gpu0 -> expert_l11_gpu0 [style=dashed]
	expert_l11_gpu0 -> agg_l11_gpu0
	agg_l11_gpu0 -> global_agg_l11
	dist_l11 -> mha_l11_gpu1
	mha_l11_gpu1 -> gate_l11_gpu1
	gate_l11_gpu1 -> expert_l11_gpu1 [style=dashed]
	expert_l11_gpu1 -> agg_l11_gpu1
	agg_l11_gpu1 -> global_agg_l11
	dist_l11 -> mha_l11_gpu2
	mha_l11_gpu2 -> gate_l11_gpu2
	gate_l11_gpu2 -> expert_l11_gpu2 [style=dashed]
	expert_l11_gpu2 -> agg_l11_gpu2
	agg_l11_gpu2 -> global_agg_l11
	dist_l11 -> mha_l11_gpu3
	mha_l11_gpu3 -> gate_l11_gpu3
	gate_l11_gpu3 -> expert_l11_gpu3 [style=dashed]
	expert_l11_gpu3 -> agg_l11_gpu3
	agg_l11_gpu3 -> global_agg_l11
	dist_l11 -> mha_l11_gpu4
	mha_l11_gpu4 -> gate_l11_gpu4
	gate_l11_gpu4 -> expert_l11_gpu4 [style=dashed]
	expert_l11_gpu4 -> agg_l11_gpu4
	agg_l11_gpu4 -> global_agg_l11
	dist_l11 -> mha_l11_gpu5
	mha_l11_gpu5 -> gate_l11_gpu5
	gate_l11_gpu5 -> expert_l11_gpu5 [style=dashed]
	expert_l11_gpu5 -> agg_l11_gpu5
	agg_l11_gpu5 -> global_agg_l11
	dist_l11 -> mha_l11_gpu6
	mha_l11_gpu6 -> gate_l11_gpu6
	gate_l11_gpu6 -> expert_l11_gpu6 [style=dashed]
	expert_l11_gpu6 -> agg_l11_gpu6
	agg_l11_gpu6 -> global_agg_l11
	dist_l11 -> mha_l11_gpu7
	mha_l11_gpu7 -> gate_l11_gpu7
	gate_l11_gpu7 -> expert_l11_gpu7 [style=dashed]
	expert_l11_gpu7 -> agg_l11_gpu7
	agg_l11_gpu7 -> global_agg_l11
	dist_l11 -> mha_l11_gpu8
	mha_l11_gpu8 -> gate_l11_gpu8
	gate_l11_gpu8 -> expert_l11_gpu8 [style=dashed]
	expert_l11_gpu8 -> agg_l11_gpu8
	agg_l11_gpu8 -> global_agg_l11
	dist_l11 -> mha_l11_gpu9
	mha_l11_gpu9 -> gate_l11_gpu9
	gate_l11_gpu9 -> expert_l11_gpu9 [style=dashed]
	expert_l11_gpu9 -> agg_l11_gpu9
	agg_l11_gpu9 -> global_agg_l11
	dist_l11 -> mha_l11_gpu10
	mha_l11_gpu10 -> gate_l11_gpu10
	gate_l11_gpu10 -> expert_l11_gpu10 [style=dashed]
	expert_l11_gpu10 -> agg_l11_gpu10
	agg_l11_gpu10 -> global_agg_l11
	dist_l11 -> mha_l11_gpu11
	mha_l11_gpu11 -> gate_l11_gpu11
	gate_l11_gpu11 -> expert_l11_gpu11 [style=dashed]
	expert_l11_gpu11 -> agg_l11_gpu11
	agg_l11_gpu11 -> global_agg_l11
	dist_l11 -> mha_l11_gpu12
	mha_l11_gpu12 -> gate_l11_gpu12
	gate_l11_gpu12 -> expert_l11_gpu12 [style=dashed]
	expert_l11_gpu12 -> agg_l11_gpu12
	agg_l11_gpu12 -> global_agg_l11
	dist_l11 -> mha_l11_gpu13
	mha_l11_gpu13 -> gate_l11_gpu13
	gate_l11_gpu13 -> expert_l11_gpu13 [style=dashed]
	expert_l11_gpu13 -> agg_l11_gpu13
	agg_l11_gpu13 -> global_agg_l11
	dist_l11 -> mha_l11_gpu14
	mha_l11_gpu14 -> gate_l11_gpu14
	gate_l11_gpu14 -> expert_l11_gpu14 [style=dashed]
	expert_l11_gpu14 -> agg_l11_gpu14
	agg_l11_gpu14 -> global_agg_l11
	dist_l11 -> mha_l11_gpu15
	mha_l11_gpu15 -> gate_l11_gpu15
	gate_l11_gpu15 -> expert_l11_gpu15 [style=dashed]
	expert_l11_gpu15 -> agg_l11_gpu15
	agg_l11_gpu15 -> global_agg_l11
	global_agg_l11 -> residual_l11
	residual_l10 -> residual_l11
	residual_l11 -> dist_l12
	dist_l12 -> mha_l12_gpu0
	mha_l12_gpu0 -> gate_l12_gpu0
	gate_l12_gpu0 -> expert_l12_gpu0 [style=dashed]
	expert_l12_gpu0 -> agg_l12_gpu0
	agg_l12_gpu0 -> global_agg_l12
	dist_l12 -> mha_l12_gpu1
	mha_l12_gpu1 -> gate_l12_gpu1
	gate_l12_gpu1 -> expert_l12_gpu1 [style=dashed]
	expert_l12_gpu1 -> agg_l12_gpu1
	agg_l12_gpu1 -> global_agg_l12
	dist_l12 -> mha_l12_gpu2
	mha_l12_gpu2 -> gate_l12_gpu2
	gate_l12_gpu2 -> expert_l12_gpu2 [style=dashed]
	expert_l12_gpu2 -> agg_l12_gpu2
	agg_l12_gpu2 -> global_agg_l12
	dist_l12 -> mha_l12_gpu3
	mha_l12_gpu3 -> gate_l12_gpu3
	gate_l12_gpu3 -> expert_l12_gpu3 [style=dashed]
	expert_l12_gpu3 -> agg_l12_gpu3
	agg_l12_gpu3 -> global_agg_l12
	dist_l12 -> mha_l12_gpu4
	mha_l12_gpu4 -> gate_l12_gpu4
	gate_l12_gpu4 -> expert_l12_gpu4 [style=dashed]
	expert_l12_gpu4 -> agg_l12_gpu4
	agg_l12_gpu4 -> global_agg_l12
	dist_l12 -> mha_l12_gpu5
	mha_l12_gpu5 -> gate_l12_gpu5
	gate_l12_gpu5 -> expert_l12_gpu5 [style=dashed]
	expert_l12_gpu5 -> agg_l12_gpu5
	agg_l12_gpu5 -> global_agg_l12
	dist_l12 -> mha_l12_gpu6
	mha_l12_gpu6 -> gate_l12_gpu6
	gate_l12_gpu6 -> expert_l12_gpu6 [style=dashed]
	expert_l12_gpu6 -> agg_l12_gpu6
	agg_l12_gpu6 -> global_agg_l12
	dist_l12 -> mha_l12_gpu7
	mha_l12_gpu7 -> gate_l12_gpu7
	gate_l12_gpu7 -> expert_l12_gpu7 [style=dashed]
	expert_l12_gpu7 -> agg_l12_gpu7
	agg_l12_gpu7 -> global_agg_l12
	dist_l12 -> mha_l12_gpu8
	mha_l12_gpu8 -> gate_l12_gpu8
	gate_l12_gpu8 -> expert_l12_gpu8 [style=dashed]
	expert_l12_gpu8 -> agg_l12_gpu8
	agg_l12_gpu8 -> global_agg_l12
	dist_l12 -> mha_l12_gpu9
	mha_l12_gpu9 -> gate_l12_gpu9
	gate_l12_gpu9 -> expert_l12_gpu9 [style=dashed]
	expert_l12_gpu9 -> agg_l12_gpu9
	agg_l12_gpu9 -> global_agg_l12
	dist_l12 -> mha_l12_gpu10
	mha_l12_gpu10 -> gate_l12_gpu10
	gate_l12_gpu10 -> expert_l12_gpu10 [style=dashed]
	expert_l12_gpu10 -> agg_l12_gpu10
	agg_l12_gpu10 -> global_agg_l12
	dist_l12 -> mha_l12_gpu11
	mha_l12_gpu11 -> gate_l12_gpu11
	gate_l12_gpu11 -> expert_l12_gpu11 [style=dashed]
	expert_l12_gpu11 -> agg_l12_gpu11
	agg_l12_gpu11 -> global_agg_l12
	dist_l12 -> mha_l12_gpu12
	mha_l12_gpu12 -> gate_l12_gpu12
	gate_l12_gpu12 -> expert_l12_gpu12 [style=dashed]
	expert_l12_gpu12 -> agg_l12_gpu12
	agg_l12_gpu12 -> global_agg_l12
	dist_l12 -> mha_l12_gpu13
	mha_l12_gpu13 -> gate_l12_gpu13
	gate_l12_gpu13 -> expert_l12_gpu13 [style=dashed]
	expert_l12_gpu13 -> agg_l12_gpu13
	agg_l12_gpu13 -> global_agg_l12
	dist_l12 -> mha_l12_gpu14
	mha_l12_gpu14 -> gate_l12_gpu14
	gate_l12_gpu14 -> expert_l12_gpu14 [style=dashed]
	expert_l12_gpu14 -> agg_l12_gpu14
	agg_l12_gpu14 -> global_agg_l12
	dist_l12 -> mha_l12_gpu15
	mha_l12_gpu15 -> gate_l12_gpu15
	gate_l12_gpu15 -> expert_l12_gpu15 [style=dashed]
	expert_l12_gpu15 -> agg_l12_gpu15
	agg_l12_gpu15 -> global_agg_l12
	global_agg_l12 -> residual_l12
	residual_l11 -> residual_l12
	residual_l12 -> dist_l13
	dist_l13 -> mha_l13_gpu0
	mha_l13_gpu0 -> gate_l13_gpu0
	gate_l13_gpu0 -> expert_l13_gpu0 [style=dashed]
	expert_l13_gpu0 -> agg_l13_gpu0
	agg_l13_gpu0 -> global_agg_l13
	dist_l13 -> mha_l13_gpu1
	mha_l13_gpu1 -> gate_l13_gpu1
	gate_l13_gpu1 -> expert_l13_gpu1 [style=dashed]
	expert_l13_gpu1 -> agg_l13_gpu1
	agg_l13_gpu1 -> global_agg_l13
	dist_l13 -> mha_l13_gpu2
	mha_l13_gpu2 -> gate_l13_gpu2
	gate_l13_gpu2 -> expert_l13_gpu2 [style=dashed]
	expert_l13_gpu2 -> agg_l13_gpu2
	agg_l13_gpu2 -> global_agg_l13
	dist_l13 -> mha_l13_gpu3
	mha_l13_gpu3 -> gate_l13_gpu3
	gate_l13_gpu3 -> expert_l13_gpu3 [style=dashed]
	expert_l13_gpu3 -> agg_l13_gpu3
	agg_l13_gpu3 -> global_agg_l13
	dist_l13 -> mha_l13_gpu4
	mha_l13_gpu4 -> gate_l13_gpu4
	gate_l13_gpu4 -> expert_l13_gpu4 [style=dashed]
	expert_l13_gpu4 -> agg_l13_gpu4
	agg_l13_gpu4 -> global_agg_l13
	dist_l13 -> mha_l13_gpu5
	mha_l13_gpu5 -> gate_l13_gpu5
	gate_l13_gpu5 -> expert_l13_gpu5 [style=dashed]
	expert_l13_gpu5 -> agg_l13_gpu5
	agg_l13_gpu5 -> global_agg_l13
	dist_l13 -> mha_l13_gpu6
	mha_l13_gpu6 -> gate_l13_gpu6
	gate_l13_gpu6 -> expert_l13_gpu6 [style=dashed]
	expert_l13_gpu6 -> agg_l13_gpu6
	agg_l13_gpu6 -> global_agg_l13
	dist_l13 -> mha_l13_gpu7
	mha_l13_gpu7 -> gate_l13_gpu7
	gate_l13_gpu7 -> expert_l13_gpu7 [style=dashed]
	expert_l13_gpu7 -> agg_l13_gpu7
	agg_l13_gpu7 -> global_agg_l13
	dist_l13 -> mha_l13_gpu8
	mha_l13_gpu8 -> gate_l13_gpu8
	gate_l13_gpu8 -> expert_l13_gpu8 [style=dashed]
	expert_l13_gpu8 -> agg_l13_gpu8
	agg_l13_gpu8 -> global_agg_l13
	dist_l13 -> mha_l13_gpu9
	mha_l13_gpu9 -> gate_l13_gpu9
	gate_l13_gpu9 -> expert_l13_gpu9 [style=dashed]
	expert_l13_gpu9 -> agg_l13_gpu9
	agg_l13_gpu9 -> global_agg_l13
	dist_l13 -> mha_l13_gpu10
	mha_l13_gpu10 -> gate_l13_gpu10
	gate_l13_gpu10 -> expert_l13_gpu10 [style=dashed]
	expert_l13_gpu10 -> agg_l13_gpu10
	agg_l13_gpu10 -> global_agg_l13
	dist_l13 -> mha_l13_gpu11
	mha_l13_gpu11 -> gate_l13_gpu11
	gate_l13_gpu11 -> expert_l13_gpu11 [style=dashed]
	expert_l13_gpu11 -> agg_l13_gpu11
	agg_l13_gpu11 -> global_agg_l13
	dist_l13 -> mha_l13_gpu12
	mha_l13_gpu12 -> gate_l13_gpu12
	gate_l13_gpu12 -> expert_l13_gpu12 [style=dashed]
	expert_l13_gpu12 -> agg_l13_gpu12
	agg_l13_gpu12 -> global_agg_l13
	dist_l13 -> mha_l13_gpu13
	mha_l13_gpu13 -> gate_l13_gpu13
	gate_l13_gpu13 -> expert_l13_gpu13 [style=dashed]
	expert_l13_gpu13 -> agg_l13_gpu13
	agg_l13_gpu13 -> global_agg_l13
	dist_l13 -> mha_l13_gpu14
	mha_l13_gpu14 -> gate_l13_gpu14
	gate_l13_gpu14 -> expert_l13_gpu14 [style=dashed]
	expert_l13_gpu14 -> agg_l13_gpu14
	agg_l13_gpu14 -> global_agg_l13
	dist_l13 -> mha_l13_gpu15
	mha_l13_gpu15 -> gate_l13_gpu15
	gate_l13_gpu15 -> expert_l13_gpu15 [style=dashed]
	expert_l13_gpu15 -> agg_l13_gpu15
	agg_l13_gpu15 -> global_agg_l13
	global_agg_l13 -> residual_l13
	residual_l12 -> residual_l13
	residual_l13 -> dist_l14
	dist_l14 -> mha_l14_gpu0
	mha_l14_gpu0 -> gate_l14_gpu0
	gate_l14_gpu0 -> expert_l14_gpu0 [style=dashed]
	expert_l14_gpu0 -> agg_l14_gpu0
	agg_l14_gpu0 -> global_agg_l14
	dist_l14 -> mha_l14_gpu1
	mha_l14_gpu1 -> gate_l14_gpu1
	gate_l14_gpu1 -> expert_l14_gpu1 [style=dashed]
	expert_l14_gpu1 -> agg_l14_gpu1
	agg_l14_gpu1 -> global_agg_l14
	dist_l14 -> mha_l14_gpu2
	mha_l14_gpu2 -> gate_l14_gpu2
	gate_l14_gpu2 -> expert_l14_gpu2 [style=dashed]
	expert_l14_gpu2 -> agg_l14_gpu2
	agg_l14_gpu2 -> global_agg_l14
	dist_l14 -> mha_l14_gpu3
	mha_l14_gpu3 -> gate_l14_gpu3
	gate_l14_gpu3 -> expert_l14_gpu3 [style=dashed]
	expert_l14_gpu3 -> agg_l14_gpu3
	agg_l14_gpu3 -> global_agg_l14
	dist_l14 -> mha_l14_gpu4
	mha_l14_gpu4 -> gate_l14_gpu4
	gate_l14_gpu4 -> expert_l14_gpu4 [style=dashed]
	expert_l14_gpu4 -> agg_l14_gpu4
	agg_l14_gpu4 -> global_agg_l14
	dist_l14 -> mha_l14_gpu5
	mha_l14_gpu5 -> gate_l14_gpu5
	gate_l14_gpu5 -> expert_l14_gpu5 [style=dashed]
	expert_l14_gpu5 -> agg_l14_gpu5
	agg_l14_gpu5 -> global_agg_l14
	dist_l14 -> mha_l14_gpu6
	mha_l14_gpu6 -> gate_l14_gpu6
	gate_l14_gpu6 -> expert_l14_gpu6 [style=dashed]
	expert_l14_gpu6 -> agg_l14_gpu6
	agg_l14_gpu6 -> global_agg_l14
	dist_l14 -> mha_l14_gpu7
	mha_l14_gpu7 -> gate_l14_gpu7
	gate_l14_gpu7 -> expert_l14_gpu7 [style=dashed]
	expert_l14_gpu7 -> agg_l14_gpu7
	agg_l14_gpu7 -> global_agg_l14
	dist_l14 -> mha_l14_gpu8
	mha_l14_gpu8 -> gate_l14_gpu8
	gate_l14_gpu8 -> expert_l14_gpu8 [style=dashed]
	expert_l14_gpu8 -> agg_l14_gpu8
	agg_l14_gpu8 -> global_agg_l14
	dist_l14 -> mha_l14_gpu9
	mha_l14_gpu9 -> gate_l14_gpu9
	gate_l14_gpu9 -> expert_l14_gpu9 [style=dashed]
	expert_l14_gpu9 -> agg_l14_gpu9
	agg_l14_gpu9 -> global_agg_l14
	dist_l14 -> mha_l14_gpu10
	mha_l14_gpu10 -> gate_l14_gpu10
	gate_l14_gpu10 -> expert_l14_gpu10 [style=dashed]
	expert_l14_gpu10 -> agg_l14_gpu10
	agg_l14_gpu10 -> global_agg_l14
	dist_l14 -> mha_l14_gpu11
	mha_l14_gpu11 -> gate_l14_gpu11
	gate_l14_gpu11 -> expert_l14_gpu11 [style=dashed]
	expert_l14_gpu11 -> agg_l14_gpu11
	agg_l14_gpu11 -> global_agg_l14
	dist_l14 -> mha_l14_gpu12
	mha_l14_gpu12 -> gate_l14_gpu12
	gate_l14_gpu12 -> expert_l14_gpu12 [style=dashed]
	expert_l14_gpu12 -> agg_l14_gpu12
	agg_l14_gpu12 -> global_agg_l14
	dist_l14 -> mha_l14_gpu13
	mha_l14_gpu13 -> gate_l14_gpu13
	gate_l14_gpu13 -> expert_l14_gpu13 [style=dashed]
	expert_l14_gpu13 -> agg_l14_gpu13
	agg_l14_gpu13 -> global_agg_l14
	dist_l14 -> mha_l14_gpu14
	mha_l14_gpu14 -> gate_l14_gpu14
	gate_l14_gpu14 -> expert_l14_gpu14 [style=dashed]
	expert_l14_gpu14 -> agg_l14_gpu14
	agg_l14_gpu14 -> global_agg_l14
	dist_l14 -> mha_l14_gpu15
	mha_l14_gpu15 -> gate_l14_gpu15
	gate_l14_gpu15 -> expert_l14_gpu15 [style=dashed]
	expert_l14_gpu15 -> agg_l14_gpu15
	agg_l14_gpu15 -> global_agg_l14
	global_agg_l14 -> residual_l14
	residual_l13 -> residual_l14
	residual_l14 -> dist_l15
	dist_l15 -> mha_l15_gpu0
	mha_l15_gpu0 -> gate_l15_gpu0
	gate_l15_gpu0 -> expert_l15_gpu0 [style=dashed]
	expert_l15_gpu0 -> agg_l15_gpu0
	agg_l15_gpu0 -> global_agg_l15
	dist_l15 -> mha_l15_gpu1
	mha_l15_gpu1 -> gate_l15_gpu1
	gate_l15_gpu1 -> expert_l15_gpu1 [style=dashed]
	expert_l15_gpu1 -> agg_l15_gpu1
	agg_l15_gpu1 -> global_agg_l15
	dist_l15 -> mha_l15_gpu2
	mha_l15_gpu2 -> gate_l15_gpu2
	gate_l15_gpu2 -> expert_l15_gpu2 [style=dashed]
	expert_l15_gpu2 -> agg_l15_gpu2
	agg_l15_gpu2 -> global_agg_l15
	dist_l15 -> mha_l15_gpu3
	mha_l15_gpu3 -> gate_l15_gpu3
	gate_l15_gpu3 -> expert_l15_gpu3 [style=dashed]
	expert_l15_gpu3 -> agg_l15_gpu3
	agg_l15_gpu3 -> global_agg_l15
	dist_l15 -> mha_l15_gpu4
	mha_l15_gpu4 -> gate_l15_gpu4
	gate_l15_gpu4 -> expert_l15_gpu4 [style=dashed]
	expert_l15_gpu4 -> agg_l15_gpu4
	agg_l15_gpu4 -> global_agg_l15
	dist_l15 -> mha_l15_gpu5
	mha_l15_gpu5 -> gate_l15_gpu5
	gate_l15_gpu5 -> expert_l15_gpu5 [style=dashed]
	expert_l15_gpu5 -> agg_l15_gpu5
	agg_l15_gpu5 -> global_agg_l15
	dist_l15 -> mha_l15_gpu6
	mha_l15_gpu6 -> gate_l15_gpu6
	gate_l15_gpu6 -> expert_l15_gpu6 [style=dashed]
	expert_l15_gpu6 -> agg_l15_gpu6
	agg_l15_gpu6 -> global_agg_l15
	dist_l15 -> mha_l15_gpu7
	mha_l15_gpu7 -> gate_l15_gpu7
	gate_l15_gpu7 -> expert_l15_gpu7 [style=dashed]
	expert_l15_gpu7 -> agg_l15_gpu7
	agg_l15_gpu7 -> global_agg_l15
	dist_l15 -> mha_l15_gpu8
	mha_l15_gpu8 -> gate_l15_gpu8
	gate_l15_gpu8 -> expert_l15_gpu8 [style=dashed]
	expert_l15_gpu8 -> agg_l15_gpu8
	agg_l15_gpu8 -> global_agg_l15
	dist_l15 -> mha_l15_gpu9
	mha_l15_gpu9 -> gate_l15_gpu9
	gate_l15_gpu9 -> expert_l15_gpu9 [style=dashed]
	expert_l15_gpu9 -> agg_l15_gpu9
	agg_l15_gpu9 -> global_agg_l15
	dist_l15 -> mha_l15_gpu10
	mha_l15_gpu10 -> gate_l15_gpu10
	gate_l15_gpu10 -> expert_l15_gpu10 [style=dashed]
	expert_l15_gpu10 -> agg_l15_gpu10
	agg_l15_gpu10 -> global_agg_l15
	dist_l15 -> mha_l15_gpu11
	mha_l15_gpu11 -> gate_l15_gpu11
	gate_l15_gpu11 -> expert_l15_gpu11 [style=dashed]
	expert_l15_gpu11 -> agg_l15_gpu11
	agg_l15_gpu11 -> global_agg_l15
	dist_l15 -> mha_l15_gpu12
	mha_l15_gpu12 -> gate_l15_gpu12
	gate_l15_gpu12 -> expert_l15_gpu12 [style=dashed]
	expert_l15_gpu12 -> agg_l15_gpu12
	agg_l15_gpu12 -> global_agg_l15
	dist_l15 -> mha_l15_gpu13
	mha_l15_gpu13 -> gate_l15_gpu13
	gate_l15_gpu13 -> expert_l15_gpu13 [style=dashed]
	expert_l15_gpu13 -> agg_l15_gpu13
	agg_l15_gpu13 -> global_agg_l15
	dist_l15 -> mha_l15_gpu14
	mha_l15_gpu14 -> gate_l15_gpu14
	gate_l15_gpu14 -> expert_l15_gpu14 [style=dashed]
	expert_l15_gpu14 -> agg_l15_gpu14
	agg_l15_gpu14 -> global_agg_l15
	dist_l15 -> mha_l15_gpu15
	mha_l15_gpu15 -> gate_l15_gpu15
	gate_l15_gpu15 -> expert_l15_gpu15 [style=dashed]
	expert_l15_gpu15 -> agg_l15_gpu15
	agg_l15_gpu15 -> global_agg_l15
	global_agg_l15 -> residual_l15
	residual_l14 -> residual_l15
	residual_l15 -> dist_l16
	dist_l16 -> mha_l16_gpu0
	mha_l16_gpu0 -> gate_l16_gpu0
	gate_l16_gpu0 -> expert_l16_gpu0 [style=dashed]
	expert_l16_gpu0 -> agg_l16_gpu0
	agg_l16_gpu0 -> global_agg_l16
	dist_l16 -> mha_l16_gpu1
	mha_l16_gpu1 -> gate_l16_gpu1
	gate_l16_gpu1 -> expert_l16_gpu1 [style=dashed]
	expert_l16_gpu1 -> agg_l16_gpu1
	agg_l16_gpu1 -> global_agg_l16
	dist_l16 -> mha_l16_gpu2
	mha_l16_gpu2 -> gate_l16_gpu2
	gate_l16_gpu2 -> expert_l16_gpu2 [style=dashed]
	expert_l16_gpu2 -> agg_l16_gpu2
	agg_l16_gpu2 -> global_agg_l16
	dist_l16 -> mha_l16_gpu3
	mha_l16_gpu3 -> gate_l16_gpu3
	gate_l16_gpu3 -> expert_l16_gpu3 [style=dashed]
	expert_l16_gpu3 -> agg_l16_gpu3
	agg_l16_gpu3 -> global_agg_l16
	dist_l16 -> mha_l16_gpu4
	mha_l16_gpu4 -> gate_l16_gpu4
	gate_l16_gpu4 -> expert_l16_gpu4 [style=dashed]
	expert_l16_gpu4 -> agg_l16_gpu4
	agg_l16_gpu4 -> global_agg_l16
	dist_l16 -> mha_l16_gpu5
	mha_l16_gpu5 -> gate_l16_gpu5
	gate_l16_gpu5 -> expert_l16_gpu5 [style=dashed]
	expert_l16_gpu5 -> agg_l16_gpu5
	agg_l16_gpu5 -> global_agg_l16
	dist_l16 -> mha_l16_gpu6
	mha_l16_gpu6 -> gate_l16_gpu6
	gate_l16_gpu6 -> expert_l16_gpu6 [style=dashed]
	expert_l16_gpu6 -> agg_l16_gpu6
	agg_l16_gpu6 -> global_agg_l16
	dist_l16 -> mha_l16_gpu7
	mha_l16_gpu7 -> gate_l16_gpu7
	gate_l16_gpu7 -> expert_l16_gpu7 [style=dashed]
	expert_l16_gpu7 -> agg_l16_gpu7
	agg_l16_gpu7 -> global_agg_l16
	dist_l16 -> mha_l16_gpu8
	mha_l16_gpu8 -> gate_l16_gpu8
	gate_l16_gpu8 -> expert_l16_gpu8 [style=dashed]
	expert_l16_gpu8 -> agg_l16_gpu8
	agg_l16_gpu8 -> global_agg_l16
	dist_l16 -> mha_l16_gpu9
	mha_l16_gpu9 -> gate_l16_gpu9
	gate_l16_gpu9 -> expert_l16_gpu9 [style=dashed]
	expert_l16_gpu9 -> agg_l16_gpu9
	agg_l16_gpu9 -> global_agg_l16
	dist_l16 -> mha_l16_gpu10
	mha_l16_gpu10 -> gate_l16_gpu10
	gate_l16_gpu10 -> expert_l16_gpu10 [style=dashed]
	expert_l16_gpu10 -> agg_l16_gpu10
	agg_l16_gpu10 -> global_agg_l16
	dist_l16 -> mha_l16_gpu11
	mha_l16_gpu11 -> gate_l16_gpu11
	gate_l16_gpu11 -> expert_l16_gpu11 [style=dashed]
	expert_l16_gpu11 -> agg_l16_gpu11
	agg_l16_gpu11 -> global_agg_l16
	dist_l16 -> mha_l16_gpu12
	mha_l16_gpu12 -> gate_l16_gpu12
	gate_l16_gpu12 -> expert_l16_gpu12 [style=dashed]
	expert_l16_gpu12 -> agg_l16_gpu12
	agg_l16_gpu12 -> global_agg_l16
	dist_l16 -> mha_l16_gpu13
	mha_l16_gpu13 -> gate_l16_gpu13
	gate_l16_gpu13 -> expert_l16_gpu13 [style=dashed]
	expert_l16_gpu13 -> agg_l16_gpu13
	agg_l16_gpu13 -> global_agg_l16
	dist_l16 -> mha_l16_gpu14
	mha_l16_gpu14 -> gate_l16_gpu14
	gate_l16_gpu14 -> expert_l16_gpu14 [style=dashed]
	expert_l16_gpu14 -> agg_l16_gpu14
	agg_l16_gpu14 -> global_agg_l16
	dist_l16 -> mha_l16_gpu15
	mha_l16_gpu15 -> gate_l16_gpu15
	gate_l16_gpu15 -> expert_l16_gpu15 [style=dashed]
	expert_l16_gpu15 -> agg_l16_gpu15
	agg_l16_gpu15 -> global_agg_l16
	global_agg_l16 -> residual_l16
	residual_l15 -> residual_l16
	residual_l16 -> output
}
