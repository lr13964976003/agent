// GPU Assignment and Communication Patterns
digraph {
	bgcolor=white rankdir=LR size="25,20"
	node [fontname=Arial fontsize=11]
	edge [fontname=Arial fontsize=9]
	subgraph cluster_node_0 {
		label="Node 0 (GPUs 0-15)"
		bgcolor=lightgray style=rounded
		gpu_0 [label="GPU 0\nExpert 0\nTP Rank 0" fillcolor=lightgreen shape=rectangle]
		gpu_1 [label="GPU 1\nExpert 0\nTP Rank 1" fillcolor=lightblue shape=rectangle]
		gpu_2 [label="GPU 2\nExpert 1\nTP Rank 0" fillcolor=lightgreen shape=rectangle]
		gpu_3 [label="GPU 3\nExpert 1\nTP Rank 1" fillcolor=lightblue shape=rectangle]
		gpu_4 [label="GPU 4\nExpert 2\nTP Rank 0" fillcolor=lightgreen shape=rectangle]
		gpu_5 [label="GPU 5\nExpert 2\nTP Rank 1" fillcolor=lightblue shape=rectangle]
		gpu_6 [label="GPU 6\nExpert 3\nTP Rank 0" fillcolor=lightgreen shape=rectangle]
		gpu_7 [label="GPU 7\nExpert 3\nTP Rank 1" fillcolor=lightblue shape=rectangle]
		gpu_8 [label="GPU 8\nExpert 4\nTP Rank 0" fillcolor=lightgreen shape=rectangle]
		gpu_9 [label="GPU 9\nExpert 4\nTP Rank 1" fillcolor=lightblue shape=rectangle]
		gpu_10 [label="GPU 10\nExpert 5\nTP Rank 0" fillcolor=lightgreen shape=rectangle]
		gpu_11 [label="GPU 11\nExpert 5\nTP Rank 1" fillcolor=lightblue shape=rectangle]
		gpu_12 [label="GPU 12\nExpert 6\nTP Rank 0" fillcolor=lightgreen shape=rectangle]
		gpu_13 [label="GPU 13\nExpert 6\nTP Rank 1" fillcolor=lightblue shape=rectangle]
		gpu_14 [label="GPU 14\nExpert 7\nTP Rank 0" fillcolor=lightgreen shape=rectangle]
		gpu_15 [label="GPU 15\nExpert 7\nTP Rank 1" fillcolor=lightblue shape=rectangle]
	}
	subgraph cluster_node_1 {
		label="Node 1 (GPUs 16-31)"
		bgcolor=lightgray style=rounded
		gpu_16 [label="GPU 16\nExpert 8\nTP Rank 0" fillcolor=lightgreen shape=rectangle]
		gpu_17 [label="GPU 17\nExpert 8\nTP Rank 1" fillcolor=lightblue shape=rectangle]
		gpu_18 [label="GPU 18\nExpert 9\nTP Rank 0" fillcolor=lightgreen shape=rectangle]
		gpu_19 [label="GPU 19\nExpert 9\nTP Rank 1" fillcolor=lightblue shape=rectangle]
		gpu_20 [label="GPU 20\nExpert 10\nTP Rank 0" fillcolor=lightgreen shape=rectangle]
		gpu_21 [label="GPU 21\nExpert 10\nTP Rank 1" fillcolor=lightblue shape=rectangle]
		gpu_22 [label="GPU 22\nExpert 11\nTP Rank 0" fillcolor=lightgreen shape=rectangle]
		gpu_23 [label="GPU 23\nExpert 11\nTP Rank 1" fillcolor=lightblue shape=rectangle]
		gpu_24 [label="GPU 24\nExpert 12\nTP Rank 0" fillcolor=lightgreen shape=rectangle]
		gpu_25 [label="GPU 25\nExpert 12\nTP Rank 1" fillcolor=lightblue shape=rectangle]
		gpu_26 [label="GPU 26\nExpert 13\nTP Rank 0" fillcolor=lightgreen shape=rectangle]
		gpu_27 [label="GPU 27\nExpert 13\nTP Rank 1" fillcolor=lightblue shape=rectangle]
		gpu_28 [label="GPU 28\nExpert 14\nTP Rank 0" fillcolor=lightgreen shape=rectangle]
		gpu_29 [label="GPU 29\nExpert 14\nTP Rank 1" fillcolor=lightblue shape=rectangle]
		gpu_30 [label="GPU 30\nExpert 15\nTP Rank 0" fillcolor=lightgreen shape=rectangle]
		gpu_31 [label="GPU 31\nExpert 15\nTP Rank 1" fillcolor=lightblue shape=rectangle]
	}
	gpu_0 -> gpu_1 [label=TP_AllReduce color=red style=dashed]
	gpu_1 -> gpu_0 [label=TP_AllReduce color=red style=dashed]
	gpu_2 -> gpu_3 [label=TP_AllReduce color=red style=dashed]
	gpu_3 -> gpu_2 [label=TP_AllReduce color=red style=dashed]
	gpu_4 -> gpu_5 [label=TP_AllReduce color=red style=dashed]
	gpu_5 -> gpu_4 [label=TP_AllReduce color=red style=dashed]
	gpu_6 -> gpu_7 [label=TP_AllReduce color=red style=dashed]
	gpu_7 -> gpu_6 [label=TP_AllReduce color=red style=dashed]
	gpu_8 -> gpu_9 [label=TP_AllReduce color=red style=dashed]
	gpu_9 -> gpu_8 [label=TP_AllReduce color=red style=dashed]
	gpu_10 -> gpu_11 [label=TP_AllReduce color=red style=dashed]
	gpu_11 -> gpu_10 [label=TP_AllReduce color=red style=dashed]
	gpu_12 -> gpu_13 [label=TP_AllReduce color=red style=dashed]
	gpu_13 -> gpu_12 [label=TP_AllReduce color=red style=dashed]
	gpu_14 -> gpu_15 [label=TP_AllReduce color=red style=dashed]
	gpu_15 -> gpu_14 [label=TP_AllReduce color=red style=dashed]
	all2all [label="All2All Router" fillcolor=yellow shape=diamond]
	gpu_0 -> all2all [color=blue style=dotted]
	all2all -> gpu_0 [color=blue style=dotted]
	gpu_2 -> all2all [color=blue style=dotted]
	all2all -> gpu_2 [color=blue style=dotted]
	gpu_4 -> all2all [color=blue style=dotted]
	all2all -> gpu_4 [color=blue style=dotted]
	gpu_6 -> all2all [color=blue style=dotted]
	all2all -> gpu_6 [color=blue style=dotted]
	gpu_8 -> all2all [color=blue style=dotted]
	all2all -> gpu_8 [color=blue style=dotted]
	gpu_10 -> all2all [color=blue style=dotted]
	all2all -> gpu_10 [color=blue style=dotted]
	gpu_12 -> all2all [color=blue style=dotted]
	all2all -> gpu_12 [color=blue style=dotted]
	gpu_14 -> all2all [color=blue style=dotted]
	all2all -> gpu_14 [color=blue style=dotted]
}
