<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: optimized_communication_patterns Pages: 1 -->
<svg width="932pt" height="2498pt"
 viewBox="0.00 0.00 932.00 2498.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2494)">
<title>optimized_communication_patterns</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2494 928,-2494 928,4 -4,4"/>
<!-- model_start -->
<g id="node1" class="node">
<title>model_start</title>
<polygon fill="lightgreen" stroke="black" points="519.86,-2490 174.88,-2490 86.14,-2414 431.12,-2414 519.86,-2490"/>
<text text-anchor="middle" x="303" y="-2455.8" font-family="Times,serif" font-size="14.00">Model Start</text>
<text text-anchor="middle" x="303" y="-2440.8" font-family="Times,serif" font-size="14.00">Input: [1024, 10000, 8192]</text>
</g>
<!-- gpus_0_7 -->
<g id="node3" class="node">
<title>gpus_0_7</title>
<polygon fill="lightyellow" stroke="black" points="224,-2351.5 0,-2351.5 0,-2298.5 224,-2298.5 224,-2351.5"/>
<text text-anchor="middle" x="112" y="-2336.3" font-family="Times,serif" font-size="14.00">GPUs 0&#45;7</text>
<text text-anchor="middle" x="112" y="-2321.3" font-family="Times,serif" font-size="14.00">Pipeline Stage 0</text>
<text text-anchor="middle" x="112" y="-2306.3" font-family="Times,serif" font-size="14.00">MHA Layer 0 + MLP Layer 0</text>
</g>
<!-- model_start&#45;&gt;gpus_0_7 -->
<g id="edge1" class="edge">
<title>model_start&#45;&gt;gpus_0_7</title>
<path fill="none" stroke="black" d="M246.21,-2413.83C218.65,-2395.8 185.9,-2374.37 159.66,-2357.19"/>
<polygon fill="black" stroke="black" points="161.31,-2354.09 151.03,-2351.54 157.48,-2359.94 161.31,-2354.09"/>
</g>
<!-- mha0_input -->
<g id="node5" class="node">
<title>mha0_input</title>
<polygon fill="lightsteelblue" stroke="black" points="745.86,-2378 345.21,-2378 242.14,-2272 642.79,-2272 745.86,-2378"/>
<text text-anchor="middle" x="494" y="-2336.3" font-family="Times,serif" font-size="14.00">MHA0 Input Distribution</text>
<text text-anchor="middle" x="494" y="-2321.3" font-family="Times,serif" font-size="14.00">Broadcast: [1024, 10000, 8192]</text>
<text text-anchor="middle" x="494" y="-2306.3" font-family="Times,serif" font-size="14.00">GPU: 0&#45;7</text>
</g>
<!-- model_start&#45;&gt;mha0_input -->
<g id="edge2" class="edge">
<title>model_start&#45;&gt;mha0_input</title>
<path fill="none" stroke="black" d="M359.79,-2413.83C374.26,-2404.36 390.17,-2393.95 405.8,-2383.72"/>
<polygon fill="black" stroke="black" points="408,-2386.46 414.46,-2378.06 404.17,-2380.61 408,-2386.46"/>
</g>
<!-- model_end -->
<g id="node2" class="node">
<title>model_end</title>
<polygon fill="lightgreen" stroke="black" points="870.24,-76 505.57,-76 411.76,0 776.43,0 870.24,-76"/>
<text text-anchor="middle" x="641" y="-41.8" font-family="Times,serif" font-size="14.00">Model End</text>
<text text-anchor="middle" x="641" y="-26.8" font-family="Times,serif" font-size="14.00">Output: [1024, 10000, 8192]</text>
</g>
<!-- gpus_8_15 -->
<g id="node4" class="node">
<title>gpus_8_15</title>
<polygon fill="lightyellow" stroke="black" points="395,-1129.5 171,-1129.5 171,-1076.5 395,-1076.5 395,-1129.5"/>
<text text-anchor="middle" x="283" y="-1114.3" font-family="Times,serif" font-size="14.00">GPUs 8&#45;15</text>
<text text-anchor="middle" x="283" y="-1099.3" font-family="Times,serif" font-size="14.00">Pipeline Stage 1</text>
<text text-anchor="middle" x="283" y="-1084.3" font-family="Times,serif" font-size="14.00">MHA Layer 1 + MLP Layer 1</text>
</g>
<!-- mha0_head0 -->
<g id="node6" class="node">
<title>mha0_head0</title>
<polygon fill="lightcoral" stroke="black" points="351,-2236 235,-2236 235,-2183 351,-2183 351,-2236"/>
<text text-anchor="middle" x="293" y="-2220.8" font-family="Times,serif" font-size="14.00">Head Group 0</text>
<text text-anchor="middle" x="293" y="-2205.8" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;1</text>
<text text-anchor="middle" x="293" y="-2190.8" font-family="Times,serif" font-size="14.00">Q,K,V Linear</text>
</g>
<!-- mha0_input&#45;&gt;mha0_head0 -->
<g id="edge3" class="edge">
<title>mha0_input&#45;&gt;mha0_head0</title>
<path fill="none" stroke="black" d="M401.74,-2271.9C383.1,-2261.38 364.09,-2250.64 347.28,-2241.15"/>
<polygon fill="black" stroke="black" points="348.61,-2237.88 338.18,-2236.01 345.17,-2243.98 348.61,-2237.88"/>
</g>
<!-- mha0_head1 -->
<g id="node7" class="node">
<title>mha0_head1</title>
<polygon fill="lightcoral" stroke="black" points="485,-2236 369,-2236 369,-2183 485,-2183 485,-2236"/>
<text text-anchor="middle" x="427" y="-2220.8" font-family="Times,serif" font-size="14.00">Head Group 1</text>
<text text-anchor="middle" x="427" y="-2205.8" font-family="Times,serif" font-size="14.00">GPUs: 2&#45;3</text>
<text text-anchor="middle" x="427" y="-2190.8" font-family="Times,serif" font-size="14.00">Q,K,V Linear</text>
</g>
<!-- mha0_input&#45;&gt;mha0_head1 -->
<g id="edge4" class="edge">
<title>mha0_input&#45;&gt;mha0_head1</title>
<path fill="none" stroke="black" d="M463.25,-2271.9C457.78,-2262.64 452.22,-2253.22 447.15,-2244.63"/>
<polygon fill="black" stroke="black" points="450.16,-2242.85 442.06,-2236.01 444.13,-2246.4 450.16,-2242.85"/>
</g>
<!-- mha0_head2 -->
<g id="node8" class="node">
<title>mha0_head2</title>
<polygon fill="lightcoral" stroke="black" points="619,-2236 503,-2236 503,-2183 619,-2183 619,-2236"/>
<text text-anchor="middle" x="561" y="-2220.8" font-family="Times,serif" font-size="14.00">Head Group 2</text>
<text text-anchor="middle" x="561" y="-2205.8" font-family="Times,serif" font-size="14.00">GPUs: 4&#45;5</text>
<text text-anchor="middle" x="561" y="-2190.8" font-family="Times,serif" font-size="14.00">Q,K,V Linear</text>
</g>
<!-- mha0_input&#45;&gt;mha0_head2 -->
<g id="edge5" class="edge">
<title>mha0_input&#45;&gt;mha0_head2</title>
<path fill="none" stroke="black" d="M524.75,-2271.9C530.22,-2262.64 535.78,-2253.22 540.85,-2244.63"/>
<polygon fill="black" stroke="black" points="543.87,-2246.4 545.94,-2236.01 537.84,-2242.85 543.87,-2246.4"/>
</g>
<!-- mha0_head3 -->
<g id="node9" class="node">
<title>mha0_head3</title>
<polygon fill="lightcoral" stroke="black" points="753,-2236 637,-2236 637,-2183 753,-2183 753,-2236"/>
<text text-anchor="middle" x="695" y="-2220.8" font-family="Times,serif" font-size="14.00">Head Group 3</text>
<text text-anchor="middle" x="695" y="-2205.8" font-family="Times,serif" font-size="14.00">GPUs: 6&#45;7</text>
<text text-anchor="middle" x="695" y="-2190.8" font-family="Times,serif" font-size="14.00">Q,K,V Linear</text>
</g>
<!-- mha0_input&#45;&gt;mha0_head3 -->
<g id="edge6" class="edge">
<title>mha0_input&#45;&gt;mha0_head3</title>
<path fill="none" stroke="black" d="M586.26,-2271.9C604.9,-2261.38 623.91,-2250.64 640.72,-2241.15"/>
<polygon fill="black" stroke="black" points="642.83,-2243.98 649.82,-2236.01 639.39,-2237.88 642.83,-2243.98"/>
</g>
<!-- mha0_attn0 -->
<g id="node10" class="node">
<title>mha0_attn0</title>
<polygon fill="lightpink" stroke="black" points="351,-2147 235,-2147 235,-2094 351,-2094 351,-2147"/>
<text text-anchor="middle" x="293" y="-2131.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="293" y="-2116.8" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;1</text>
<text text-anchor="middle" x="293" y="-2101.8" font-family="Times,serif" font-size="14.00">Head Group 0</text>
</g>
<!-- mha0_head0&#45;&gt;mha0_attn0 -->
<g id="edge7" class="edge">
<title>mha0_head0&#45;&gt;mha0_attn0</title>
<path fill="none" stroke="black" d="M293,-2182.87C293,-2174.89 293,-2165.93 293,-2157.38"/>
<polygon fill="black" stroke="black" points="296.5,-2157.25 293,-2147.25 289.5,-2157.25 296.5,-2157.25"/>
</g>
<!-- mha0_attn1 -->
<g id="node11" class="node">
<title>mha0_attn1</title>
<polygon fill="lightpink" stroke="black" points="485,-2147 369,-2147 369,-2094 485,-2094 485,-2147"/>
<text text-anchor="middle" x="427" y="-2131.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="427" y="-2116.8" font-family="Times,serif" font-size="14.00">GPUs: 2&#45;3</text>
<text text-anchor="middle" x="427" y="-2101.8" font-family="Times,serif" font-size="14.00">Head Group 1</text>
</g>
<!-- mha0_head1&#45;&gt;mha0_attn1 -->
<g id="edge8" class="edge">
<title>mha0_head1&#45;&gt;mha0_attn1</title>
<path fill="none" stroke="black" d="M427,-2182.87C427,-2174.89 427,-2165.93 427,-2157.38"/>
<polygon fill="black" stroke="black" points="430.5,-2157.25 427,-2147.25 423.5,-2157.25 430.5,-2157.25"/>
</g>
<!-- mha0_attn2 -->
<g id="node12" class="node">
<title>mha0_attn2</title>
<polygon fill="lightpink" stroke="black" points="619,-2147 503,-2147 503,-2094 619,-2094 619,-2147"/>
<text text-anchor="middle" x="561" y="-2131.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="561" y="-2116.8" font-family="Times,serif" font-size="14.00">GPUs: 4&#45;5</text>
<text text-anchor="middle" x="561" y="-2101.8" font-family="Times,serif" font-size="14.00">Head Group 2</text>
</g>
<!-- mha0_head2&#45;&gt;mha0_attn2 -->
<g id="edge9" class="edge">
<title>mha0_head2&#45;&gt;mha0_attn2</title>
<path fill="none" stroke="black" d="M561,-2182.87C561,-2174.89 561,-2165.93 561,-2157.38"/>
<polygon fill="black" stroke="black" points="564.5,-2157.25 561,-2147.25 557.5,-2157.25 564.5,-2157.25"/>
</g>
<!-- mha0_attn3 -->
<g id="node13" class="node">
<title>mha0_attn3</title>
<polygon fill="lightpink" stroke="black" points="753,-2147 637,-2147 637,-2094 753,-2094 753,-2147"/>
<text text-anchor="middle" x="695" y="-2131.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="695" y="-2116.8" font-family="Times,serif" font-size="14.00">GPUs: 6&#45;7</text>
<text text-anchor="middle" x="695" y="-2101.8" font-family="Times,serif" font-size="14.00">Head Group 3</text>
</g>
<!-- mha0_head3&#45;&gt;mha0_attn3 -->
<g id="edge10" class="edge">
<title>mha0_head3&#45;&gt;mha0_attn3</title>
<path fill="none" stroke="black" d="M695,-2182.87C695,-2174.89 695,-2165.93 695,-2157.38"/>
<polygon fill="black" stroke="black" points="698.5,-2157.25 695,-2147.25 691.5,-2157.25 698.5,-2157.25"/>
</g>
<!-- mha0_concat -->
<g id="node14" class="node">
<title>mha0_concat</title>
<polygon fill="lightsteelblue" stroke="black" points="608.09,-2058 426.6,-2058 379.91,-1952 561.4,-1952 608.09,-2058"/>
<text text-anchor="middle" x="494" y="-2016.3" font-family="Times,serif" font-size="14.00">Concatenate</text>
<text text-anchor="middle" x="494" y="-2001.3" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
<text text-anchor="middle" x="494" y="-1986.3" font-family="Times,serif" font-size="14.00">Head Groups</text>
</g>
<!-- mha0_attn0&#45;&gt;mha0_concat -->
<g id="edge11" class="edge">
<title>mha0_attn0&#45;&gt;mha0_concat</title>
<path fill="none" stroke="black" d="M338.36,-2093.89C360.32,-2081.49 387.36,-2066.22 412.71,-2051.9"/>
<polygon fill="black" stroke="black" points="414.61,-2054.85 421.6,-2046.88 411.17,-2048.75 414.61,-2054.85"/>
</g>
<!-- mha0_attn1&#45;&gt;mha0_concat -->
<g id="edge12" class="edge">
<title>mha0_attn1&#45;&gt;mha0_concat</title>
<path fill="none" stroke="black" d="M442.2,-2093.75C446.99,-2085.63 452.5,-2076.3 458.1,-2066.82"/>
<polygon fill="black" stroke="black" points="461.18,-2068.49 463.25,-2058.1 455.15,-2064.93 461.18,-2068.49"/>
</g>
<!-- mha0_attn2&#45;&gt;mha0_concat -->
<g id="edge13" class="edge">
<title>mha0_attn2&#45;&gt;mha0_concat</title>
<path fill="none" stroke="black" d="M545.8,-2093.75C541.01,-2085.63 535.5,-2076.3 529.9,-2066.82"/>
<polygon fill="black" stroke="black" points="532.85,-2064.93 524.75,-2058.1 526.82,-2068.49 532.85,-2064.93"/>
</g>
<!-- mha0_attn3&#45;&gt;mha0_concat -->
<g id="edge14" class="edge">
<title>mha0_attn3&#45;&gt;mha0_concat</title>
<path fill="none" stroke="black" d="M649.64,-2093.89C633.37,-2084.7 614.32,-2073.94 595.22,-2063.16"/>
<polygon fill="black" stroke="black" points="596.89,-2060.08 586.46,-2058.21 593.45,-2066.17 596.89,-2060.08"/>
</g>
<!-- mha0_outproj -->
<g id="node15" class="node">
<title>mha0_outproj</title>
<polygon fill="lightcoral" stroke="black" points="566,-1916 422,-1916 422,-1863 566,-1863 566,-1916"/>
<text text-anchor="middle" x="494" y="-1900.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="494" y="-1885.8" font-family="Times,serif" font-size="14.00">Tensor Parallel</text>
<text text-anchor="middle" x="494" y="-1870.8" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- mha0_concat&#45;&gt;mha0_outproj -->
<g id="edge15" class="edge">
<title>mha0_concat&#45;&gt;mha0_outproj</title>
<path fill="none" stroke="black" d="M494,-1951.9C494,-1943.23 494,-1934.41 494,-1926.27"/>
<polygon fill="black" stroke="black" points="497.5,-1926.01 494,-1916.01 490.5,-1926.01 497.5,-1926.01"/>
</g>
<!-- mlp0_split -->
<g id="node16" class="node">
<title>mlp0_split</title>
<polygon fill="lightsteelblue" stroke="black" points="623.69,-1827 417.38,-1827 364.31,-1721 570.62,-1721 623.69,-1827"/>
<text text-anchor="middle" x="494" y="-1785.3" font-family="Times,serif" font-size="14.00">Input Split</text>
<text text-anchor="middle" x="494" y="-1770.3" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
<text text-anchor="middle" x="494" y="-1755.3" font-family="Times,serif" font-size="14.00">2&#45;way Grouped</text>
</g>
<!-- mha0_outproj&#45;&gt;mlp0_split -->
<g id="edge16" class="edge">
<title>mha0_outproj&#45;&gt;mlp0_split</title>
<path fill="none" stroke="black" d="M494,-1862.75C494,-1855.05 494,-1846.25 494,-1837.27"/>
<polygon fill="black" stroke="black" points="497.5,-1837.1 494,-1827.1 490.5,-1837.1 497.5,-1837.1"/>
</g>
<!-- mlp0_group0 -->
<g id="node17" class="node">
<title>mlp0_group0</title>
<polygon fill="lightcoral" stroke="black" points="485,-1685 373,-1685 373,-1632 485,-1632 485,-1685"/>
<text text-anchor="middle" x="429" y="-1669.8" font-family="Times,serif" font-size="14.00">MLP Group 0</text>
<text text-anchor="middle" x="429" y="-1654.8" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;3</text>
<text text-anchor="middle" x="429" y="-1639.8" font-family="Times,serif" font-size="14.00">FC1 + FC2</text>
</g>
<!-- mlp0_split&#45;&gt;mlp0_group0 -->
<g id="edge17" class="edge">
<title>mlp0_split&#45;&gt;mlp0_group0</title>
<path fill="none" stroke="black" d="M464.16,-1720.9C458.92,-1711.74 453.58,-1702.42 448.7,-1693.9"/>
<polygon fill="black" stroke="black" points="451.62,-1691.95 443.61,-1685.01 445.54,-1695.43 451.62,-1691.95"/>
</g>
<!-- mlp0_group1 -->
<g id="node18" class="node">
<title>mlp0_group1</title>
<polygon fill="lightcoral" stroke="black" points="625,-1685 513,-1685 513,-1632 625,-1632 625,-1685"/>
<text text-anchor="middle" x="569" y="-1669.8" font-family="Times,serif" font-size="14.00">MLP Group 1</text>
<text text-anchor="middle" x="569" y="-1654.8" font-family="Times,serif" font-size="14.00">GPUs: 4&#45;7</text>
<text text-anchor="middle" x="569" y="-1639.8" font-family="Times,serif" font-size="14.00">FC1 + FC2</text>
</g>
<!-- mlp0_split&#45;&gt;mlp0_group1 -->
<g id="edge18" class="edge">
<title>mlp0_split&#45;&gt;mlp0_group1</title>
<path fill="none" stroke="black" d="M528.43,-1720.9C534.61,-1711.55 540.9,-1702.02 546.63,-1693.36"/>
<polygon fill="black" stroke="black" points="549.55,-1695.29 552.14,-1685.01 543.71,-1691.43 549.55,-1695.29"/>
</g>
<!-- mlp0_gelu0 -->
<g id="node19" class="node">
<title>mlp0_gelu0</title>
<polygon fill="lightyellow" stroke="black" points="434,-1596 346,-1596 346,-1558 434,-1558 434,-1596"/>
<text text-anchor="middle" x="390" y="-1580.8" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="390" y="-1565.8" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;3</text>
</g>
<!-- mlp0_group0&#45;&gt;mlp0_gelu0 -->
<g id="edge19" class="edge">
<title>mlp0_group0&#45;&gt;mlp0_gelu0</title>
<path fill="none" stroke="black" d="M416.45,-1631.91C412.3,-1623.47 407.68,-1614.04 403.47,-1605.47"/>
<polygon fill="black" stroke="black" points="406.49,-1603.68 398.95,-1596.24 400.21,-1606.76 406.49,-1603.68"/>
</g>
<!-- mlp0_gelu1 -->
<g id="node20" class="node">
<title>mlp0_gelu1</title>
<polygon fill="lightyellow" stroke="black" points="618,-1596 530,-1596 530,-1558 618,-1558 618,-1596"/>
<text text-anchor="middle" x="574" y="-1580.8" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="574" y="-1565.8" font-family="Times,serif" font-size="14.00">GPUs: 4&#45;7</text>
</g>
<!-- mlp0_group1&#45;&gt;mlp0_gelu1 -->
<g id="edge20" class="edge">
<title>mlp0_group1&#45;&gt;mlp0_gelu1</title>
<path fill="none" stroke="black" d="M570.61,-1631.91C571.12,-1623.74 571.7,-1614.65 572.22,-1606.3"/>
<polygon fill="black" stroke="black" points="575.72,-1606.44 572.85,-1596.24 568.73,-1606 575.72,-1606.44"/>
</g>
<!-- mlp0_allreduce0 -->
<g id="node21" class="node">
<title>mlp0_allreduce0</title>
<polygon fill="lightsteelblue" stroke="black" points="465.26,-1522 313.72,-1522 274.74,-1446 426.28,-1446 465.26,-1522"/>
<text text-anchor="middle" x="370" y="-1487.8" font-family="Times,serif" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="370" y="-1472.8" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;3</text>
</g>
<!-- mlp0_gelu0&#45;&gt;mlp0_allreduce0 -->
<g id="edge21" class="edge">
<title>mlp0_gelu0&#45;&gt;mlp0_allreduce0</title>
<path fill="none" stroke="black" d="M385.95,-1557.58C384.31,-1550.11 382.33,-1541.1 380.33,-1532.01"/>
<polygon fill="black" stroke="black" points="383.74,-1531.2 378.17,-1522.19 376.9,-1532.7 383.74,-1531.2"/>
</g>
<!-- mlp0_allreduce1 -->
<g id="node22" class="node">
<title>mlp0_allreduce1</title>
<polygon fill="lightsteelblue" stroke="black" points="674.26,-1522 522.72,-1522 483.74,-1446 635.28,-1446 674.26,-1522"/>
<text text-anchor="middle" x="579" y="-1487.8" font-family="Times,serif" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="579" y="-1472.8" font-family="Times,serif" font-size="14.00">GPUs: 4&#45;7</text>
</g>
<!-- mlp0_gelu1&#45;&gt;mlp0_allreduce1 -->
<g id="edge22" class="edge">
<title>mlp0_gelu1&#45;&gt;mlp0_allreduce1</title>
<path fill="none" stroke="black" d="M575.01,-1557.58C575.42,-1550.19 575.91,-1541.29 576.4,-1532.3"/>
<polygon fill="black" stroke="black" points="579.9,-1532.36 576.96,-1522.19 572.91,-1531.98 579.9,-1532.36"/>
</g>
<!-- mlp0_concat -->
<g id="node23" class="node">
<title>mlp0_concat</title>
<polygon fill="lightsteelblue" stroke="black" points="625.23,-1410 384.66,-1410 322.77,-1334 563.34,-1334 625.23,-1410"/>
<text text-anchor="middle" x="474" y="-1375.8" font-family="Times,serif" font-size="14.00">Final Concatenate</text>
<text text-anchor="middle" x="474" y="-1360.8" font-family="Times,serif" font-size="14.00">GPUs: 0&#45;7</text>
</g>
<!-- mlp0_allreduce0&#45;&gt;mlp0_concat -->
<g id="edge23" class="edge">
<title>mlp0_allreduce0&#45;&gt;mlp0_concat</title>
<path fill="none" stroke="black" d="M405.21,-1445.76C413.77,-1436.71 423,-1426.94 431.84,-1417.59"/>
<polygon fill="black" stroke="black" points="434.5,-1419.87 438.83,-1410.2 429.41,-1415.06 434.5,-1419.87"/>
</g>
<!-- mlp0_allreduce1&#45;&gt;mlp0_concat -->
<g id="edge24" class="edge">
<title>mlp0_allreduce1&#45;&gt;mlp0_concat</title>
<path fill="none" stroke="black" d="M543.45,-1445.76C534.81,-1436.71 525.49,-1426.94 516.56,-1417.59"/>
<polygon fill="black" stroke="black" points="518.95,-1415.02 509.51,-1410.2 513.88,-1419.85 518.95,-1415.02"/>
</g>
<!-- pipeline_comm -->
<g id="node24" class="node">
<title>pipeline_comm</title>
<polygon fill="lightgreen" stroke="black" points="672.04,-1298 357,-1298 275.96,-1192 591,-1192 672.04,-1298"/>
<text text-anchor="middle" x="474" y="-1256.3" font-family="Times,serif" font-size="14.00">Pipeline Communication</text>
<text text-anchor="middle" x="474" y="-1241.3" font-family="Times,serif" font-size="14.00">GPUs: 7→8</text>
<text text-anchor="middle" x="474" y="-1226.3" font-family="Times,serif" font-size="14.00">Data Transfer</text>
</g>
<!-- mlp0_concat&#45;&gt;pipeline_comm -->
<g id="edge25" class="edge">
<title>mlp0_concat&#45;&gt;pipeline_comm</title>
<path fill="none" stroke="black" d="M474,-1333.83C474,-1325.77 474,-1317.02 474,-1308.28"/>
<polygon fill="black" stroke="black" points="477.5,-1308.06 474,-1298.06 470.5,-1308.06 477.5,-1308.06"/>
</g>
<!-- pipeline_comm&#45;&gt;gpus_8_15 -->
<g id="edge26" class="edge">
<title>pipeline_comm&#45;&gt;gpus_8_15</title>
<path fill="none" stroke="black" d="M402.88,-1191.87C377,-1172.9 348.55,-1152.05 325.87,-1135.42"/>
<polygon fill="black" stroke="black" points="327.92,-1132.59 317.79,-1129.5 323.79,-1138.23 327.92,-1132.59"/>
</g>
<!-- mha1_input -->
<g id="node25" class="node">
<title>mha1_input</title>
<polygon fill="lightsteelblue" stroke="black" points="916.86,-1156 516.21,-1156 413.14,-1050 813.79,-1050 916.86,-1156"/>
<text text-anchor="middle" x="665" y="-1114.3" font-family="Times,serif" font-size="14.00">MHA1 Input Distribution</text>
<text text-anchor="middle" x="665" y="-1099.3" font-family="Times,serif" font-size="14.00">Broadcast: [1024, 10000, 8192]</text>
<text text-anchor="middle" x="665" y="-1084.3" font-family="Times,serif" font-size="14.00">GPU: 8&#45;15</text>
</g>
<!-- pipeline_comm&#45;&gt;mha1_input -->
<g id="edge27" class="edge">
<title>pipeline_comm&#45;&gt;mha1_input</title>
<path fill="none" stroke="black" d="M545.12,-1191.87C558.3,-1182.21 572.13,-1172.07 585.54,-1162.24"/>
<polygon fill="black" stroke="black" points="587.82,-1164.91 593.82,-1156.17 583.68,-1159.26 587.82,-1164.91"/>
</g>
<!-- mha1_head0 -->
<g id="node26" class="node">
<title>mha1_head0</title>
<polygon fill="lightcoral" stroke="black" points="522,-1014 406,-1014 406,-961 522,-961 522,-1014"/>
<text text-anchor="middle" x="464" y="-998.8" font-family="Times,serif" font-size="14.00">Head Group 0</text>
<text text-anchor="middle" x="464" y="-983.8" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;9</text>
<text text-anchor="middle" x="464" y="-968.8" font-family="Times,serif" font-size="14.00">Q,K,V Linear</text>
</g>
<!-- mha1_input&#45;&gt;mha1_head0 -->
<g id="edge28" class="edge">
<title>mha1_input&#45;&gt;mha1_head0</title>
<path fill="none" stroke="black" d="M572.74,-1049.9C554.1,-1039.38 535.09,-1028.64 518.28,-1019.15"/>
<polygon fill="black" stroke="black" points="519.61,-1015.88 509.18,-1014.01 516.17,-1021.98 519.61,-1015.88"/>
</g>
<!-- mha1_head1 -->
<g id="node27" class="node">
<title>mha1_head1</title>
<polygon fill="lightcoral" stroke="black" points="656,-1014 540,-1014 540,-961 656,-961 656,-1014"/>
<text text-anchor="middle" x="598" y="-998.8" font-family="Times,serif" font-size="14.00">Head Group 1</text>
<text text-anchor="middle" x="598" y="-983.8" font-family="Times,serif" font-size="14.00">GPUs: 10&#45;11</text>
<text text-anchor="middle" x="598" y="-968.8" font-family="Times,serif" font-size="14.00">Q,K,V Linear</text>
</g>
<!-- mha1_input&#45;&gt;mha1_head1 -->
<g id="edge29" class="edge">
<title>mha1_input&#45;&gt;mha1_head1</title>
<path fill="none" stroke="black" d="M634.25,-1049.9C628.78,-1040.64 623.22,-1031.22 618.15,-1022.63"/>
<polygon fill="black" stroke="black" points="621.16,-1020.85 613.06,-1014.01 615.13,-1024.4 621.16,-1020.85"/>
</g>
<!-- mha1_head2 -->
<g id="node28" class="node">
<title>mha1_head2</title>
<polygon fill="lightcoral" stroke="black" points="790,-1014 674,-1014 674,-961 790,-961 790,-1014"/>
<text text-anchor="middle" x="732" y="-998.8" font-family="Times,serif" font-size="14.00">Head Group 2</text>
<text text-anchor="middle" x="732" y="-983.8" font-family="Times,serif" font-size="14.00">GPUs: 12&#45;13</text>
<text text-anchor="middle" x="732" y="-968.8" font-family="Times,serif" font-size="14.00">Q,K,V Linear</text>
</g>
<!-- mha1_input&#45;&gt;mha1_head2 -->
<g id="edge30" class="edge">
<title>mha1_input&#45;&gt;mha1_head2</title>
<path fill="none" stroke="black" d="M695.75,-1049.9C701.22,-1040.64 706.78,-1031.22 711.85,-1022.63"/>
<polygon fill="black" stroke="black" points="714.87,-1024.4 716.94,-1014.01 708.84,-1020.85 714.87,-1024.4"/>
</g>
<!-- mha1_head3 -->
<g id="node29" class="node">
<title>mha1_head3</title>
<polygon fill="lightcoral" stroke="black" points="924,-1014 808,-1014 808,-961 924,-961 924,-1014"/>
<text text-anchor="middle" x="866" y="-998.8" font-family="Times,serif" font-size="14.00">Head Group 3</text>
<text text-anchor="middle" x="866" y="-983.8" font-family="Times,serif" font-size="14.00">GPUs: 14&#45;15</text>
<text text-anchor="middle" x="866" y="-968.8" font-family="Times,serif" font-size="14.00">Q,K,V Linear</text>
</g>
<!-- mha1_input&#45;&gt;mha1_head3 -->
<g id="edge31" class="edge">
<title>mha1_input&#45;&gt;mha1_head3</title>
<path fill="none" stroke="black" d="M757.26,-1049.9C775.9,-1039.38 794.91,-1028.64 811.72,-1019.15"/>
<polygon fill="black" stroke="black" points="813.83,-1021.98 820.82,-1014.01 810.39,-1015.88 813.83,-1021.98"/>
</g>
<!-- mha1_attn0 -->
<g id="node30" class="node">
<title>mha1_attn0</title>
<polygon fill="lightpink" stroke="black" points="522,-925 406,-925 406,-872 522,-872 522,-925"/>
<text text-anchor="middle" x="464" y="-909.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="464" y="-894.8" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;9</text>
<text text-anchor="middle" x="464" y="-879.8" font-family="Times,serif" font-size="14.00">Head Group 0</text>
</g>
<!-- mha1_head0&#45;&gt;mha1_attn0 -->
<g id="edge32" class="edge">
<title>mha1_head0&#45;&gt;mha1_attn0</title>
<path fill="none" stroke="black" d="M464,-960.87C464,-952.89 464,-943.93 464,-935.38"/>
<polygon fill="black" stroke="black" points="467.5,-935.25 464,-925.25 460.5,-935.25 467.5,-935.25"/>
</g>
<!-- mha1_attn1 -->
<g id="node31" class="node">
<title>mha1_attn1</title>
<polygon fill="lightpink" stroke="black" points="656,-925 540,-925 540,-872 656,-872 656,-925"/>
<text text-anchor="middle" x="598" y="-909.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="598" y="-894.8" font-family="Times,serif" font-size="14.00">GPUs: 10&#45;11</text>
<text text-anchor="middle" x="598" y="-879.8" font-family="Times,serif" font-size="14.00">Head Group 1</text>
</g>
<!-- mha1_head1&#45;&gt;mha1_attn1 -->
<g id="edge33" class="edge">
<title>mha1_head1&#45;&gt;mha1_attn1</title>
<path fill="none" stroke="black" d="M598,-960.87C598,-952.89 598,-943.93 598,-935.38"/>
<polygon fill="black" stroke="black" points="601.5,-935.25 598,-925.25 594.5,-935.25 601.5,-935.25"/>
</g>
<!-- mha1_attn2 -->
<g id="node32" class="node">
<title>mha1_attn2</title>
<polygon fill="lightpink" stroke="black" points="790,-925 674,-925 674,-872 790,-872 790,-925"/>
<text text-anchor="middle" x="732" y="-909.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="732" y="-894.8" font-family="Times,serif" font-size="14.00">GPUs: 12&#45;13</text>
<text text-anchor="middle" x="732" y="-879.8" font-family="Times,serif" font-size="14.00">Head Group 2</text>
</g>
<!-- mha1_head2&#45;&gt;mha1_attn2 -->
<g id="edge34" class="edge">
<title>mha1_head2&#45;&gt;mha1_attn2</title>
<path fill="none" stroke="black" d="M732,-960.87C732,-952.89 732,-943.93 732,-935.38"/>
<polygon fill="black" stroke="black" points="735.5,-935.25 732,-925.25 728.5,-935.25 735.5,-935.25"/>
</g>
<!-- mha1_attn3 -->
<g id="node33" class="node">
<title>mha1_attn3</title>
<polygon fill="lightpink" stroke="black" points="924,-925 808,-925 808,-872 924,-872 924,-925"/>
<text text-anchor="middle" x="866" y="-909.8" font-family="Times,serif" font-size="14.00">Attention</text>
<text text-anchor="middle" x="866" y="-894.8" font-family="Times,serif" font-size="14.00">GPUs: 14&#45;15</text>
<text text-anchor="middle" x="866" y="-879.8" font-family="Times,serif" font-size="14.00">Head Group 3</text>
</g>
<!-- mha1_head3&#45;&gt;mha1_attn3 -->
<g id="edge35" class="edge">
<title>mha1_head3&#45;&gt;mha1_attn3</title>
<path fill="none" stroke="black" d="M866,-960.87C866,-952.89 866,-943.93 866,-935.38"/>
<polygon fill="black" stroke="black" points="869.5,-935.25 866,-925.25 862.5,-935.25 869.5,-935.25"/>
</g>
<!-- mha1_concat -->
<g id="node34" class="node">
<title>mha1_concat</title>
<polygon fill="lightsteelblue" stroke="black" points="779.09,-836 597.6,-836 550.91,-730 732.4,-730 779.09,-836"/>
<text text-anchor="middle" x="665" y="-794.3" font-family="Times,serif" font-size="14.00">Concatenate</text>
<text text-anchor="middle" x="665" y="-779.3" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
<text text-anchor="middle" x="665" y="-764.3" font-family="Times,serif" font-size="14.00">Head Groups</text>
</g>
<!-- mha1_attn0&#45;&gt;mha1_concat -->
<g id="edge36" class="edge">
<title>mha1_attn0&#45;&gt;mha1_concat</title>
<path fill="none" stroke="black" d="M509.36,-871.89C531.32,-859.49 558.36,-844.22 583.71,-829.9"/>
<polygon fill="black" stroke="black" points="585.61,-832.85 592.6,-824.88 582.17,-826.75 585.61,-832.85"/>
</g>
<!-- mha1_attn1&#45;&gt;mha1_concat -->
<g id="edge37" class="edge">
<title>mha1_attn1&#45;&gt;mha1_concat</title>
<path fill="none" stroke="black" d="M613.2,-871.75C617.99,-863.63 623.5,-854.3 629.1,-844.82"/>
<polygon fill="black" stroke="black" points="632.18,-846.49 634.25,-836.1 626.15,-842.93 632.18,-846.49"/>
</g>
<!-- mha1_attn2&#45;&gt;mha1_concat -->
<g id="edge38" class="edge">
<title>mha1_attn2&#45;&gt;mha1_concat</title>
<path fill="none" stroke="black" d="M716.8,-871.75C712.01,-863.63 706.5,-854.3 700.9,-844.82"/>
<polygon fill="black" stroke="black" points="703.85,-842.93 695.75,-836.1 697.82,-846.49 703.85,-842.93"/>
</g>
<!-- mha1_attn3&#45;&gt;mha1_concat -->
<g id="edge39" class="edge">
<title>mha1_attn3&#45;&gt;mha1_concat</title>
<path fill="none" stroke="black" d="M820.64,-871.89C804.37,-862.7 785.32,-851.94 766.22,-841.16"/>
<polygon fill="black" stroke="black" points="767.89,-838.08 757.46,-836.21 764.45,-844.17 767.89,-838.08"/>
</g>
<!-- mha1_outproj -->
<g id="node35" class="node">
<title>mha1_outproj</title>
<polygon fill="lightcoral" stroke="black" points="737,-694 593,-694 593,-641 737,-641 737,-694"/>
<text text-anchor="middle" x="665" y="-678.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="665" y="-663.8" font-family="Times,serif" font-size="14.00">Tensor Parallel</text>
<text text-anchor="middle" x="665" y="-648.8" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- mha1_concat&#45;&gt;mha1_outproj -->
<g id="edge40" class="edge">
<title>mha1_concat&#45;&gt;mha1_outproj</title>
<path fill="none" stroke="black" d="M665,-729.9C665,-721.23 665,-712.41 665,-704.27"/>
<polygon fill="black" stroke="black" points="668.5,-704.01 665,-694.01 661.5,-704.01 668.5,-704.01"/>
</g>
<!-- mlp1_split -->
<g id="node36" class="node">
<title>mlp1_split</title>
<polygon fill="lightsteelblue" stroke="black" points="794.69,-605 588.38,-605 535.31,-499 741.62,-499 794.69,-605"/>
<text text-anchor="middle" x="665" y="-563.3" font-family="Times,serif" font-size="14.00">Input Split</text>
<text text-anchor="middle" x="665" y="-548.3" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
<text text-anchor="middle" x="665" y="-533.3" font-family="Times,serif" font-size="14.00">2&#45;way Grouped</text>
</g>
<!-- mha1_outproj&#45;&gt;mlp1_split -->
<g id="edge41" class="edge">
<title>mha1_outproj&#45;&gt;mlp1_split</title>
<path fill="none" stroke="black" d="M665,-640.75C665,-633.05 665,-624.25 665,-615.27"/>
<polygon fill="black" stroke="black" points="668.5,-615.1 665,-605.1 661.5,-615.1 668.5,-615.1"/>
</g>
<!-- mlp1_group0 -->
<g id="node37" class="node">
<title>mlp1_group0</title>
<polygon fill="lightcoral" stroke="black" points="656,-463 544,-463 544,-410 656,-410 656,-463"/>
<text text-anchor="middle" x="600" y="-447.8" font-family="Times,serif" font-size="14.00">MLP Group 0</text>
<text text-anchor="middle" x="600" y="-432.8" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;11</text>
<text text-anchor="middle" x="600" y="-417.8" font-family="Times,serif" font-size="14.00">FC1 + FC2</text>
</g>
<!-- mlp1_split&#45;&gt;mlp1_group0 -->
<g id="edge42" class="edge">
<title>mlp1_split&#45;&gt;mlp1_group0</title>
<path fill="none" stroke="black" d="M635.16,-498.9C629.92,-489.74 624.58,-480.42 619.7,-471.9"/>
<polygon fill="black" stroke="black" points="622.62,-469.95 614.61,-463.01 616.54,-473.43 622.62,-469.95"/>
</g>
<!-- mlp1_group1 -->
<g id="node38" class="node">
<title>mlp1_group1</title>
<polygon fill="lightcoral" stroke="black" points="798,-463 686,-463 686,-410 798,-410 798,-463"/>
<text text-anchor="middle" x="742" y="-447.8" font-family="Times,serif" font-size="14.00">MLP Group 1</text>
<text text-anchor="middle" x="742" y="-432.8" font-family="Times,serif" font-size="14.00">GPUs: 12&#45;15</text>
<text text-anchor="middle" x="742" y="-417.8" font-family="Times,serif" font-size="14.00">FC1 + FC2</text>
</g>
<!-- mlp1_split&#45;&gt;mlp1_group1 -->
<g id="edge43" class="edge">
<title>mlp1_split&#45;&gt;mlp1_group1</title>
<path fill="none" stroke="black" d="M700.34,-498.9C706.69,-489.55 713.15,-480.02 719.03,-471.36"/>
<polygon fill="black" stroke="black" points="721.97,-473.25 724.69,-463.01 716.18,-469.32 721.97,-473.25"/>
</g>
<!-- mlp1_gelu0 -->
<g id="node39" class="node">
<title>mlp1_gelu0</title>
<polygon fill="lightyellow" stroke="black" points="599.5,-374 502.5,-374 502.5,-336 599.5,-336 599.5,-374"/>
<text text-anchor="middle" x="551" y="-358.8" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="551" y="-343.8" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;11</text>
</g>
<!-- mlp1_group0&#45;&gt;mlp1_gelu0 -->
<g id="edge44" class="edge">
<title>mlp1_group0&#45;&gt;mlp1_gelu0</title>
<path fill="none" stroke="black" d="M584.23,-409.91C578.91,-401.28 572.96,-391.64 567.59,-382.91"/>
<polygon fill="black" stroke="black" points="570.47,-380.92 562.24,-374.24 564.51,-384.59 570.47,-380.92"/>
</g>
<!-- mlp1_gelu1 -->
<g id="node40" class="node">
<title>mlp1_gelu1</title>
<polygon fill="lightyellow" stroke="black" points="801,-374 695,-374 695,-336 801,-336 801,-374"/>
<text text-anchor="middle" x="748" y="-358.8" font-family="Times,serif" font-size="14.00">GELU</text>
<text text-anchor="middle" x="748" y="-343.8" font-family="Times,serif" font-size="14.00">GPUs: 12&#45;15</text>
</g>
<!-- mlp1_group1&#45;&gt;mlp1_gelu1 -->
<g id="edge45" class="edge">
<title>mlp1_group1&#45;&gt;mlp1_gelu1</title>
<path fill="none" stroke="black" d="M743.93,-409.91C744.55,-401.74 745.23,-392.65 745.86,-384.3"/>
<polygon fill="black" stroke="black" points="749.36,-384.47 746.62,-374.24 742.38,-383.95 749.36,-384.47"/>
</g>
<!-- mlp1_allreduce0 -->
<g id="node41" class="node">
<title>mlp1_allreduce0</title>
<polygon fill="lightsteelblue" stroke="black" points="627.63,-300 467.55,-300 426.37,-224 586.45,-224 627.63,-300"/>
<text text-anchor="middle" x="527" y="-265.8" font-family="Times,serif" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="527" y="-250.8" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;11</text>
</g>
<!-- mlp1_gelu0&#45;&gt;mlp1_allreduce0 -->
<g id="edge46" class="edge">
<title>mlp1_gelu0&#45;&gt;mlp1_allreduce0</title>
<path fill="none" stroke="black" d="M546.14,-335.58C544.17,-328.11 541.8,-319.1 539.4,-310.01"/>
<polygon fill="black" stroke="black" points="542.74,-308.96 536.81,-300.19 535.97,-310.75 542.74,-308.96"/>
</g>
<!-- mlp1_allreduce1 -->
<g id="node42" class="node">
<title>mlp1_allreduce1</title>
<polygon fill="lightsteelblue" stroke="black" points="864.79,-300 690.14,-300 645.21,-224 819.86,-224 864.79,-300"/>
<text text-anchor="middle" x="755" y="-265.8" font-family="Times,serif" font-size="14.00">All&#45;Reduce</text>
<text text-anchor="middle" x="755" y="-250.8" font-family="Times,serif" font-size="14.00">GPUs: 12&#45;15</text>
</g>
<!-- mlp1_gelu1&#45;&gt;mlp1_allreduce1 -->
<g id="edge47" class="edge">
<title>mlp1_gelu1&#45;&gt;mlp1_allreduce1</title>
<path fill="none" stroke="black" d="M749.42,-335.58C749.99,-328.19 750.67,-319.29 751.36,-310.3"/>
<polygon fill="black" stroke="black" points="754.86,-310.42 752.14,-300.19 747.88,-309.89 754.86,-310.42"/>
</g>
<!-- mlp1_concat -->
<g id="node43" class="node">
<title>mlp1_concat</title>
<polygon fill="lightsteelblue" stroke="black" points="792.23,-188 551.66,-188 489.77,-112 730.34,-112 792.23,-188"/>
<text text-anchor="middle" x="641" y="-153.8" font-family="Times,serif" font-size="14.00">Final Concatenate</text>
<text text-anchor="middle" x="641" y="-138.8" font-family="Times,serif" font-size="14.00">GPUs: 8&#45;15</text>
</g>
<!-- mlp1_allreduce0&#45;&gt;mlp1_concat -->
<g id="edge48" class="edge">
<title>mlp1_allreduce0&#45;&gt;mlp1_concat</title>
<path fill="none" stroke="black" d="M565.6,-223.76C575.07,-214.62 585.3,-204.75 595.08,-195.31"/>
<polygon fill="black" stroke="black" points="597.68,-197.67 602.44,-188.2 592.82,-192.63 597.68,-197.67"/>
</g>
<!-- mlp1_allreduce1&#45;&gt;mlp1_concat -->
<g id="edge49" class="edge">
<title>mlp1_allreduce1&#45;&gt;mlp1_concat</title>
<path fill="none" stroke="black" d="M716.4,-223.76C706.93,-214.62 696.7,-204.75 686.92,-195.31"/>
<polygon fill="black" stroke="black" points="689.18,-192.63 679.56,-188.2 684.32,-197.67 689.18,-192.63"/>
</g>
<!-- mlp1_concat&#45;&gt;model_end -->
<g id="edge50" class="edge">
<title>mlp1_concat&#45;&gt;model_end</title>
<path fill="none" stroke="black" d="M641,-111.76C641,-103.61 641,-94.87 641,-86.38"/>
<polygon fill="black" stroke="black" points="644.5,-86.2 641,-76.2 637.5,-86.2 644.5,-86.2"/>
</g>
</g>
</svg>
