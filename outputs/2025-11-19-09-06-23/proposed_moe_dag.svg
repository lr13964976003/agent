<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proposed_moe Pages: 1 -->
<svg width="5832pt" height="5154pt"
 viewBox="0.00 0.00 5832.00 5154.04" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 5150.04)">
<title>proposed_moe</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-5150.04 5828,-5150.04 5828,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<text text-anchor="start" x="4459.5" y="-5131.84" font-family="Arial" font-weight="bold" font-size="14.00">Model Input</text>
<text text-anchor="start" x="4443" y="-5117.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;Batch Size: 128</text>
<text text-anchor="start" x="4415" y="-5103.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;Sequence Length: 10000</text>
<text text-anchor="start" x="4436" y="-5089.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;Hidden Dim: 4096</text>
</g>
<!-- global_router -->
<g id="node2" class="node">
<title>global_router</title>
<polygon fill="lightgreen" stroke="black" points="4901.09,-5046.04 4259.86,-5046.04 4094.91,-4918.04 4736.14,-4918.04 4901.09,-5046.04"/>
<text text-anchor="start" x="4431.5" y="-4999.84" font-family="Arial" font-weight="bold" font-size="14.00">Global Token Router</text>
<text text-anchor="start" x="4463" y="-4985.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4311.5" y="-4971.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="start" x="4361" y="-4957.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;Output: [token routing decisions per expert]</text>
</g>
<!-- input&#45;&gt;global_router -->
<g id="edge1" class="edge">
<title>input&#45;&gt;global_router</title>
<path fill="none" stroke="black" d="M4498,-5081.75C4498,-5081.75 4498,-5056.28 4498,-5056.28"/>
<polygon fill="black" stroke="black" points="4501.5,-5056.28 4498,-5046.28 4494.5,-5056.28 4501.5,-5056.28"/>
</g>
<!-- layernorm_0 -->
<g id="node3" class="node">
<title>layernorm_0</title>
<polygon fill="lightblue" stroke="black" points="4705.5,-4882.04 4290.5,-4882.04 4290.5,-4818.04 4705.5,-4818.04 4705.5,-4882.04"/>
<text text-anchor="start" x="4431.5" y="-4867.84" font-family="Arial" font-weight="bold" font-size="14.00">LayerNorm (Layer 0)</text>
<text text-anchor="start" x="4455.5" y="-4853.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4304" y="-4839.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="start" x="4298.5" y="-4825.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- global_router&#45;&gt;layernorm_0 -->
<g id="edge2" class="edge">
<title>global_router&#45;&gt;layernorm_0</title>
<path fill="none" stroke="black" d="M4498,-4917.97C4498,-4917.97 4498,-4892.04 4498,-4892.04"/>
<polygon fill="black" stroke="black" points="4501.5,-4892.04 4498,-4882.04 4494.5,-4892.04 4501.5,-4892.04"/>
</g>
<!-- mha_qkv_0 -->
<g id="node4" class="node">
<title>mha_qkv_0</title>
<polygon fill="lightblue" stroke="black" points="4591,-4782.04 4165,-4782.04 4165,-4718.04 4591,-4718.04 4591,-4782.04"/>
<text text-anchor="start" x="4323" y="-4767.84" font-family="Arial" font-weight="bold" font-size="14.00">MHA QKV Linear</text>
<text text-anchor="start" x="4335.5" y="-4753.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4184" y="-4739.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="start" x="4173" y="-4725.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, heads=32, d_k=128]</text>
</g>
<!-- layernorm_0&#45;&gt;mha_qkv_0 -->
<g id="edge3" class="edge">
<title>layernorm_0&#45;&gt;mha_qkv_0</title>
<path fill="none" stroke="black" d="M4440.75,-4817.85C4440.75,-4817.85 4440.75,-4792.17 4440.75,-4792.17"/>
<polygon fill="black" stroke="black" points="4444.25,-4792.17 4440.75,-4782.17 4437.25,-4792.17 4444.25,-4792.17"/>
</g>
<!-- attn_res_0 -->
<g id="node7" class="node">
<title>attn_res_0</title>
<polygon fill="lightblue" stroke="black" points="4715.5,-4482.04 4284.5,-4482.04 4284.5,-4418.04 4715.5,-4418.04 4715.5,-4482.04"/>
<text text-anchor="start" x="4425.5" y="-4467.84" font-family="Arial" font-weight="bold" font-size="14.00">Attention Residual Add</text>
<text text-anchor="start" x="4457.5" y="-4453.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4292.5" y="-4439.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096] (x2)</text>
<text text-anchor="start" x="4300.5" y="-4425.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layernorm_0&#45;&gt;attn_res_0 -->
<g id="edge7" class="edge">
<title>layernorm_0&#45;&gt;attn_res_0</title>
<path fill="none" stroke="black" d="M4648.25,-4817.98C4648.25,-4817.98 4648.25,-4492.25 4648.25,-4492.25"/>
<polygon fill="black" stroke="black" points="4651.75,-4492.25 4648.25,-4482.25 4644.75,-4492.25 4651.75,-4492.25"/>
</g>
<!-- mha_attn_0 -->
<g id="node5" class="node">
<title>mha_attn_0</title>
<polygon fill="lightblue" stroke="black" points="4588.5,-4682.04 4173.5,-4682.04 4173.5,-4618.04 4588.5,-4618.04 4588.5,-4682.04"/>
<text text-anchor="start" x="4334" y="-4667.84" font-family="Arial" font-weight="bold" font-size="14.00">MHA Attention</text>
<text text-anchor="start" x="4338.5" y="-4653.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4181.5" y="-4639.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, heads=32, d_k=128]</text>
<text text-anchor="start" x="4181.5" y="-4625.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- mha_qkv_0&#45;&gt;mha_attn_0 -->
<g id="edge4" class="edge">
<title>mha_qkv_0&#45;&gt;mha_attn_0</title>
<path fill="none" stroke="black" d="M4381,-4717.85C4381,-4717.85 4381,-4692.17 4381,-4692.17"/>
<polygon fill="black" stroke="black" points="4384.5,-4692.17 4381,-4682.17 4377.5,-4692.17 4384.5,-4692.17"/>
</g>
<!-- mha_out_0 -->
<g id="node6" class="node">
<title>mha_out_0</title>
<polygon fill="lightblue" stroke="black" points="4590.5,-4582.04 4175.5,-4582.04 4175.5,-4518.04 4590.5,-4518.04 4590.5,-4582.04"/>
<text text-anchor="start" x="4320.5" y="-4567.84" font-family="Arial" font-weight="bold" font-size="14.00">MHA Output Linear</text>
<text text-anchor="start" x="4340.5" y="-4553.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4189" y="-4539.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="start" x="4183.5" y="-4525.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- mha_attn_0&#45;&gt;mha_out_0 -->
<g id="edge5" class="edge">
<title>mha_attn_0&#45;&gt;mha_out_0</title>
<path fill="none" stroke="black" d="M4382,-4617.85C4382,-4617.85 4382,-4592.17 4382,-4592.17"/>
<polygon fill="black" stroke="black" points="4385.5,-4592.17 4382,-4582.17 4378.5,-4592.17 4385.5,-4592.17"/>
</g>
<!-- mha_out_0&#45;&gt;attn_res_0 -->
<g id="edge6" class="edge">
<title>mha_out_0&#45;&gt;attn_res_0</title>
<path fill="none" stroke="black" d="M4437.5,-4517.85C4437.5,-4517.85 4437.5,-4492.17 4437.5,-4492.17"/>
<polygon fill="black" stroke="black" points="4441,-4492.17 4437.5,-4482.17 4434,-4492.17 4441,-4492.17"/>
</g>
<!-- local_gating_0 -->
<g id="node8" class="node">
<title>local_gating_0</title>
<polygon fill="lightgreen" stroke="black" points="4695.7,-4382.04 4029.64,-4382.04 3858.3,-4254.04 4524.36,-4254.04 4695.7,-4382.04"/>
<text text-anchor="start" x="4210" y="-4335.84" font-family="Arial" font-weight="bold" font-size="14.00">Layer 0 Local Gating</text>
<text text-anchor="start" x="4234.5" y="-4321.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4083" y="-4307.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="start" x="4109.5" y="-4293.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [token assignments → expert destinations]</text>
</g>
<!-- attn_res_0&#45;&gt;local_gating_0 -->
<g id="edge8" class="edge">
<title>attn_res_0&#45;&gt;local_gating_0</title>
<path fill="none" stroke="black" d="M4490.17,-4417.75C4490.17,-4417.75 4490.17,-4392.28 4490.17,-4392.28"/>
<polygon fill="black" stroke="black" points="4493.67,-4392.28 4490.17,-4382.28 4486.67,-4392.28 4493.67,-4392.28"/>
</g>
<!-- moe_res_0 -->
<g id="node28" class="node">
<title>moe_res_0</title>
<polygon fill="lightblue" stroke="black" points="5332.5,-3777.53 4901.5,-3777.53 4901.5,-3713.53 5332.5,-3713.53 5332.5,-3777.53"/>
<text text-anchor="start" x="5057.5" y="-3763.33" font-family="Arial" font-weight="bold" font-size="14.00">MoE Residual Add</text>
<text text-anchor="start" x="5074.5" y="-3749.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4909.5" y="-3735.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096] (x2)</text>
<text text-anchor="start" x="4917.5" y="-3721.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- attn_res_0&#45;&gt;moe_res_0 -->
<g id="edge44" class="edge">
<title>attn_res_0&#45;&gt;moe_res_0</title>
<path fill="none" stroke="black" d="M4715.8,-4450C4893.72,-4450 5117,-4450 5117,-4450 5117,-4450 5117,-3787.63 5117,-3787.63"/>
<polygon fill="black" stroke="black" points="5120.5,-3787.63 5117,-3777.63 5113.5,-3787.63 5120.5,-3787.63"/>
</g>
<!-- token_batch_0 -->
<g id="node9" class="node">
<title>token_batch_0</title>
<ellipse fill="lightyellow" stroke="black" cx="3148" cy="-4200.04" rx="68.49" ry="18"/>
<text text-anchor="middle" x="3148" y="-4196.34" font-family="Arial" font-size="14.00">token_batch_0</text>
</g>
<!-- local_gating_0&#45;&gt;token_batch_0 -->
<g id="edge9" class="edge">
<title>local_gating_0&#45;&gt;token_batch_0</title>
<path fill="none" stroke="black" d="M3946.08,-4253.93C3946.08,-4232.52 3946.08,-4214 3946.08,-4214 3946.08,-4214 3201.19,-4214 3201.19,-4214"/>
<polygon fill="black" stroke="black" points="3201.19,-4210.5 3191.19,-4214 3201.19,-4217.5 3201.19,-4210.5"/>
</g>
<!-- expert_0_0 -->
<g id="node10" class="node">
<title>expert_0_0</title>
<polygon fill="lightcoral" stroke="black" points="454,-4146.04 114,-4146.04 114,-4040.04 454,-4040.04 454,-4146.04"/>
<text text-anchor="start" x="227" y="-4131.84" font-family="Arial" font-weight="bold" font-size="14.00">Expert 0 (Layer 0)</text>
<text text-anchor="start" x="238.5" y="-4117.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 0</text>
<text text-anchor="start" x="225.5" y="-4103.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 0</text>
<text text-anchor="start" x="145.5" y="-4089.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="122" y="-4075.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="210.5" y="-4061.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="181.5" y="-4047.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_0&#45;&gt;expert_0_0 -->
<g id="edge10" class="edge">
<title>token_batch_0&#45;&gt;expert_0_0</title>
<path fill="none" stroke="black" d="M3104.73,-4214C2746.43,-4214 284,-4214 284,-4214 284,-4214 284,-4156.09 284,-4156.09"/>
<polygon fill="black" stroke="black" points="287.5,-4156.09 284,-4146.09 280.5,-4156.09 287.5,-4156.09"/>
</g>
<!-- expert_0_1 -->
<g id="node11" class="node">
<title>expert_0_1</title>
<polygon fill="lightcoral" stroke="black" points="812,-4146.04 472,-4146.04 472,-4040.04 812,-4040.04 812,-4146.04"/>
<text text-anchor="start" x="585" y="-4131.84" font-family="Arial" font-weight="bold" font-size="14.00">Expert 1 (Layer 0)</text>
<text text-anchor="start" x="596.5" y="-4117.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 1</text>
<text text-anchor="start" x="583.5" y="-4103.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 1</text>
<text text-anchor="start" x="503.5" y="-4089.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="480" y="-4075.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="568.5" y="-4061.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="539.5" y="-4047.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_0&#45;&gt;expert_0_1 -->
<g id="edge12" class="edge">
<title>token_batch_0&#45;&gt;expert_0_1</title>
<path fill="none" stroke="black" d="M3090.95,-4210C2717.93,-4210 642,-4210 642,-4210 642,-4210 642,-4156.04 642,-4156.04"/>
<polygon fill="black" stroke="black" points="645.5,-4156.04 642,-4146.04 638.5,-4156.04 645.5,-4156.04"/>
</g>
<!-- expert_0_2 -->
<g id="node12" class="node">
<title>expert_0_2</title>
<polygon fill="lightcoral" stroke="black" points="1170,-4146.04 830,-4146.04 830,-4040.04 1170,-4040.04 1170,-4146.04"/>
<text text-anchor="start" x="943" y="-4131.84" font-family="Arial" font-weight="bold" font-size="14.00">Expert 2 (Layer 0)</text>
<text text-anchor="start" x="954.5" y="-4117.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 2</text>
<text text-anchor="start" x="941.5" y="-4103.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 2</text>
<text text-anchor="start" x="861.5" y="-4089.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="838" y="-4075.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="926.5" y="-4061.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="897.5" y="-4047.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_0&#45;&gt;expert_0_2 -->
<g id="edge14" class="edge">
<title>token_batch_0&#45;&gt;expert_0_2</title>
<path fill="none" stroke="black" d="M3083.42,-4206C2725.37,-4206 1000,-4206 1000,-4206 1000,-4206 1000,-4156.21 1000,-4156.21"/>
<polygon fill="black" stroke="black" points="1003.5,-4156.21 1000,-4146.21 996.5,-4156.21 1003.5,-4156.21"/>
</g>
<!-- expert_0_3 -->
<g id="node13" class="node">
<title>expert_0_3</title>
<polygon fill="lightcoral" stroke="black" points="1528,-4146.04 1188,-4146.04 1188,-4040.04 1528,-4040.04 1528,-4146.04"/>
<text text-anchor="start" x="1301" y="-4131.84" font-family="Arial" font-weight="bold" font-size="14.00">Expert 3 (Layer 0)</text>
<text text-anchor="start" x="1312.5" y="-4117.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 3</text>
<text text-anchor="start" x="1299.5" y="-4103.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 3</text>
<text text-anchor="start" x="1219.5" y="-4089.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="1196" y="-4075.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="1284.5" y="-4061.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="1255.5" y="-4047.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_0&#45;&gt;expert_0_3 -->
<g id="edge16" class="edge">
<title>token_batch_0&#45;&gt;expert_0_3</title>
<path fill="none" stroke="black" d="M3080.02,-4202C2753.05,-4202 1358,-4202 1358,-4202 1358,-4202 1358,-4156.24 1358,-4156.24"/>
<polygon fill="black" stroke="black" points="1361.5,-4156.24 1358,-4146.24 1354.5,-4156.24 1361.5,-4156.24"/>
</g>
<!-- expert_0_4 -->
<g id="node14" class="node">
<title>expert_0_4</title>
<polygon fill="lightcoral" stroke="black" points="1886,-4146.04 1546,-4146.04 1546,-4040.04 1886,-4040.04 1886,-4146.04"/>
<text text-anchor="start" x="1659" y="-4131.84" font-family="Arial" font-weight="bold" font-size="14.00">Expert 4 (Layer 0)</text>
<text text-anchor="start" x="1670.5" y="-4117.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 4</text>
<text text-anchor="start" x="1657.5" y="-4103.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 4</text>
<text text-anchor="start" x="1577.5" y="-4089.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="1554" y="-4075.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="1642.5" y="-4061.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="1613.5" y="-4047.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_0&#45;&gt;expert_0_4 -->
<g id="edge18" class="edge">
<title>token_batch_0&#45;&gt;expert_0_4</title>
<path fill="none" stroke="black" d="M3079.9,-4198C2795.31,-4198 1716,-4198 1716,-4198 1716,-4198 1716,-4156.13 1716,-4156.13"/>
<polygon fill="black" stroke="black" points="1719.5,-4156.13 1716,-4146.13 1712.5,-4156.13 1719.5,-4156.13"/>
</g>
<!-- expert_0_5 -->
<g id="node15" class="node">
<title>expert_0_5</title>
<polygon fill="lightcoral" stroke="black" points="2244,-4146.04 1904,-4146.04 1904,-4040.04 2244,-4040.04 2244,-4146.04"/>
<text text-anchor="start" x="2017" y="-4131.84" font-family="Arial" font-weight="bold" font-size="14.00">Expert 5 (Layer 0)</text>
<text text-anchor="start" x="2028.5" y="-4117.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 5</text>
<text text-anchor="start" x="2015.5" y="-4103.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 5</text>
<text text-anchor="start" x="1935.5" y="-4089.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="1912" y="-4075.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="2000.5" y="-4061.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="1971.5" y="-4047.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_0&#45;&gt;expert_0_5 -->
<g id="edge20" class="edge">
<title>token_batch_0&#45;&gt;expert_0_5</title>
<path fill="none" stroke="black" d="M3083.63,-4194C2851.93,-4194 2074,-4194 2074,-4194 2074,-4194 2074,-4156.18 2074,-4156.18"/>
<polygon fill="black" stroke="black" points="2077.5,-4156.18 2074,-4146.18 2070.5,-4156.18 2077.5,-4156.18"/>
</g>
<!-- expert_0_6 -->
<g id="node16" class="node">
<title>expert_0_6</title>
<polygon fill="lightcoral" stroke="black" points="2602,-4146.04 2262,-4146.04 2262,-4040.04 2602,-4040.04 2602,-4146.04"/>
<text text-anchor="start" x="2375" y="-4131.84" font-family="Arial" font-weight="bold" font-size="14.00">Expert 6 (Layer 0)</text>
<text text-anchor="start" x="2386.5" y="-4117.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 6</text>
<text text-anchor="start" x="2373.5" y="-4103.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 6</text>
<text text-anchor="start" x="2293.5" y="-4089.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="2270" y="-4075.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="2358.5" y="-4061.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="2329.5" y="-4047.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_0&#45;&gt;expert_0_6 -->
<g id="edge22" class="edge">
<title>token_batch_0&#45;&gt;expert_0_6</title>
<path fill="none" stroke="black" d="M3091.22,-4190C2921.87,-4190 2432,-4190 2432,-4190 2432,-4190 2432,-4156.06 2432,-4156.06"/>
<polygon fill="black" stroke="black" points="2435.5,-4156.06 2432,-4146.06 2428.5,-4156.06 2435.5,-4156.06"/>
</g>
<!-- expert_0_7 -->
<g id="node17" class="node">
<title>expert_0_7</title>
<polygon fill="lightcoral" stroke="black" points="2960,-4146.04 2620,-4146.04 2620,-4040.04 2960,-4040.04 2960,-4146.04"/>
<text text-anchor="start" x="2733" y="-4131.84" font-family="Arial" font-weight="bold" font-size="14.00">Expert 7 (Layer 0)</text>
<text text-anchor="start" x="2744.5" y="-4117.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 7</text>
<text text-anchor="start" x="2731.5" y="-4103.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 7</text>
<text text-anchor="start" x="2651.5" y="-4089.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="2628" y="-4075.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="2716.5" y="-4061.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="2687.5" y="-4047.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_0&#45;&gt;expert_0_7 -->
<g id="edge24" class="edge">
<title>token_batch_0&#45;&gt;expert_0_7</title>
<path fill="none" stroke="black" d="M3105.17,-4186C3010.15,-4186 2790,-4186 2790,-4186 2790,-4186 2790,-4156.31 2790,-4156.31"/>
<polygon fill="black" stroke="black" points="2793.5,-4156.31 2790,-4146.31 2786.5,-4156.31 2793.5,-4156.31"/>
</g>
<!-- expert_0_8 -->
<g id="node18" class="node">
<title>expert_0_8</title>
<polygon fill="lightcoral" stroke="black" points="3318,-4146.04 2978,-4146.04 2978,-4040.04 3318,-4040.04 3318,-4146.04"/>
<text text-anchor="start" x="3091" y="-4131.84" font-family="Arial" font-weight="bold" font-size="14.00">Expert 8 (Layer 0)</text>
<text text-anchor="start" x="3102.5" y="-4117.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 8</text>
<text text-anchor="start" x="3089.5" y="-4103.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 8</text>
<text text-anchor="start" x="3009.5" y="-4089.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="2986" y="-4075.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="3074.5" y="-4061.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="3045.5" y="-4047.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_0&#45;&gt;expert_0_8 -->
<g id="edge26" class="edge">
<title>token_batch_0&#45;&gt;expert_0_8</title>
<path fill="none" stroke="black" d="M3148,-4181.89C3148,-4181.89 3148,-4156.36 3148,-4156.36"/>
<polygon fill="black" stroke="black" points="3151.5,-4156.36 3148,-4146.36 3144.5,-4156.36 3151.5,-4156.36"/>
</g>
<!-- expert_0_9 -->
<g id="node19" class="node">
<title>expert_0_9</title>
<polygon fill="lightcoral" stroke="black" points="3676,-4146.04 3336,-4146.04 3336,-4040.04 3676,-4040.04 3676,-4146.04"/>
<text text-anchor="start" x="3449" y="-4131.84" font-family="Arial" font-weight="bold" font-size="14.00">Expert 9 (Layer 0)</text>
<text text-anchor="start" x="3460.5" y="-4117.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 9</text>
<text text-anchor="start" x="3447.5" y="-4103.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 9</text>
<text text-anchor="start" x="3367.5" y="-4089.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="3344" y="-4075.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="3432.5" y="-4061.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="3403.5" y="-4047.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_0&#45;&gt;expert_0_9 -->
<g id="edge28" class="edge">
<title>token_batch_0&#45;&gt;expert_0_9</title>
<path fill="none" stroke="black" d="M3190.83,-4186C3285.85,-4186 3506,-4186 3506,-4186 3506,-4186 3506,-4156.31 3506,-4156.31"/>
<polygon fill="black" stroke="black" points="3509.5,-4156.31 3506,-4146.31 3502.5,-4156.31 3509.5,-4156.31"/>
</g>
<!-- expert_0_10 -->
<g id="node20" class="node">
<title>expert_0_10</title>
<polygon fill="lightcoral" stroke="black" points="4034,-4146.04 3694,-4146.04 3694,-4040.04 4034,-4040.04 4034,-4146.04"/>
<text text-anchor="start" x="3803.5" y="-4131.84" font-family="Arial" font-weight="bold" font-size="14.00">Expert 10 (Layer 0)</text>
<text text-anchor="start" x="3815" y="-4117.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 10</text>
<text text-anchor="start" x="3802" y="-4103.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 10</text>
<text text-anchor="start" x="3725.5" y="-4089.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="3702" y="-4075.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="3790.5" y="-4061.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="3761.5" y="-4047.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_0&#45;&gt;expert_0_10 -->
<g id="edge30" class="edge">
<title>token_batch_0&#45;&gt;expert_0_10</title>
<path fill="none" stroke="black" d="M3204.85,-4190C3359.45,-4190 3776.08,-4190 3776.08,-4190 3776.08,-4190 3776.08,-4156.06 3776.08,-4156.06"/>
<polygon fill="black" stroke="black" points="3779.58,-4156.06 3776.08,-4146.06 3772.58,-4156.06 3779.58,-4156.06"/>
</g>
<!-- expert_0_11 -->
<g id="node21" class="node">
<title>expert_0_11</title>
<polygon fill="lightcoral" stroke="black" points="4392,-4146.04 4052,-4146.04 4052,-4040.04 4392,-4040.04 4392,-4146.04"/>
<text text-anchor="start" x="4161.5" y="-4131.84" font-family="Arial" font-weight="bold" font-size="14.00">Expert 11 (Layer 0)</text>
<text text-anchor="start" x="4173" y="-4117.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 11</text>
<text text-anchor="start" x="4160" y="-4103.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 11</text>
<text text-anchor="start" x="4083.5" y="-4089.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="4060" y="-4075.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="4148.5" y="-4061.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="4119.5" y="-4047.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_0&#45;&gt;expert_0_11 -->
<g id="edge32" class="edge">
<title>token_batch_0&#45;&gt;expert_0_11</title>
<path fill="none" stroke="black" d="M3212.37,-4194C3444.07,-4194 4222,-4194 4222,-4194 4222,-4194 4222,-4156.18 4222,-4156.18"/>
<polygon fill="black" stroke="black" points="4225.5,-4156.18 4222,-4146.18 4218.5,-4156.18 4225.5,-4156.18"/>
</g>
<!-- expert_0_12 -->
<g id="node22" class="node">
<title>expert_0_12</title>
<polygon fill="lightcoral" stroke="black" points="4750,-4146.04 4410,-4146.04 4410,-4040.04 4750,-4040.04 4750,-4146.04"/>
<text text-anchor="start" x="4519.5" y="-4131.84" font-family="Arial" font-weight="bold" font-size="14.00">Expert 12 (Layer 0)</text>
<text text-anchor="start" x="4531" y="-4117.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 12</text>
<text text-anchor="start" x="4518" y="-4103.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 12</text>
<text text-anchor="start" x="4441.5" y="-4089.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="4418" y="-4075.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="4506.5" y="-4061.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="4477.5" y="-4047.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_0&#45;&gt;expert_0_12 -->
<g id="edge34" class="edge">
<title>token_batch_0&#45;&gt;expert_0_12</title>
<path fill="none" stroke="black" d="M3216.24,-4198C3497.59,-4198 4552.92,-4198 4552.92,-4198 4552.92,-4198 4552.92,-4156.13 4552.92,-4156.13"/>
<polygon fill="black" stroke="black" points="4556.42,-4156.13 4552.92,-4146.13 4549.42,-4156.13 4556.42,-4156.13"/>
</g>
<!-- expert_0_13 -->
<g id="node23" class="node">
<title>expert_0_13</title>
<polygon fill="lightcoral" stroke="black" points="5108,-4146.04 4768,-4146.04 4768,-4040.04 5108,-4040.04 5108,-4146.04"/>
<text text-anchor="start" x="4877.5" y="-4131.84" font-family="Arial" font-weight="bold" font-size="14.00">Expert 13 (Layer 0)</text>
<text text-anchor="start" x="4889" y="-4117.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 13</text>
<text text-anchor="start" x="4876" y="-4103.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 13</text>
<text text-anchor="start" x="4799.5" y="-4089.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="4776" y="-4075.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="4864.5" y="-4061.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="4835.5" y="-4047.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_0&#45;&gt;expert_0_13 -->
<g id="edge36" class="edge">
<title>token_batch_0&#45;&gt;expert_0_13</title>
<path fill="none" stroke="black" d="M3215.94,-4202C3531.03,-4202 4834.65,-4202 4834.65,-4202 4834.65,-4202 4834.65,-4156.24 4834.65,-4156.24"/>
<polygon fill="black" stroke="black" points="4838.15,-4156.24 4834.65,-4146.24 4831.15,-4156.24 4838.15,-4156.24"/>
</g>
<!-- expert_0_14 -->
<g id="node24" class="node">
<title>expert_0_14</title>
<polygon fill="lightcoral" stroke="black" points="5466,-4146.04 5126,-4146.04 5126,-4040.04 5466,-4040.04 5466,-4146.04"/>
<text text-anchor="start" x="5235.5" y="-4131.84" font-family="Arial" font-weight="bold" font-size="14.00">Expert 14 (Layer 0)</text>
<text text-anchor="start" x="5247" y="-4117.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 14</text>
<text text-anchor="start" x="5234" y="-4103.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 14</text>
<text text-anchor="start" x="5157.5" y="-4089.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="5134" y="-4075.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="5222.5" y="-4061.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="5193.5" y="-4047.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_0&#45;&gt;expert_0_14 -->
<g id="edge38" class="edge">
<title>token_batch_0&#45;&gt;expert_0_14</title>
<path fill="none" stroke="black" d="M3212.58,-4206C3570.63,-4206 5296,-4206 5296,-4206 5296,-4206 5296,-4156.21 5296,-4156.21"/>
<polygon fill="black" stroke="black" points="5299.5,-4156.21 5296,-4146.21 5292.5,-4156.21 5299.5,-4156.21"/>
</g>
<!-- expert_0_15 -->
<g id="node25" class="node">
<title>expert_0_15</title>
<polygon fill="lightcoral" stroke="black" points="5824,-4146.04 5484,-4146.04 5484,-4040.04 5824,-4040.04 5824,-4146.04"/>
<text text-anchor="start" x="5593.5" y="-4131.84" font-family="Arial" font-weight="bold" font-size="14.00">Expert 15 (Layer 0)</text>
<text text-anchor="start" x="5605" y="-4117.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 15</text>
<text text-anchor="start" x="5592" y="-4103.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 15</text>
<text text-anchor="start" x="5515.5" y="-4089.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="5492" y="-4075.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="5580.5" y="-4061.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="5551.5" y="-4047.84" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_0&#45;&gt;expert_0_15 -->
<g id="edge40" class="edge">
<title>token_batch_0&#45;&gt;expert_0_15</title>
<path fill="none" stroke="black" d="M3205.05,-4210C3578.07,-4210 5654,-4210 5654,-4210 5654,-4210 5654,-4156.04 5654,-4156.04"/>
<polygon fill="black" stroke="black" points="5657.5,-4156.04 5654,-4146.04 5650.5,-4156.04 5657.5,-4156.04"/>
</g>
<!-- expert_results_0 -->
<g id="node26" class="node">
<title>expert_results_0</title>
<ellipse fill="lightyellow" stroke="black" cx="3148" cy="-3958.78" rx="370.55" ry="45.01"/>
<text text-anchor="start" x="3066" y="-3976.58" font-family="Arial" font-weight="bold" font-size="14.00">Expert Results Collection</text>
<text text-anchor="start" x="3105.5" y="-3962.58" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="3008" y="-3948.58" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [processed tokens from 16 experts]</text>
<text text-anchor="start" x="2894" y="-3934.58" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [reordered tokens, batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- expert_0_0&#45;&gt;expert_results_0 -->
<g id="edge11" class="edge">
<title>expert_0_0&#45;&gt;expert_results_0</title>
<path fill="none" stroke="black" d="M434.5,-4040.02C434.5,-3990.44 434.5,-3924 434.5,-3924 434.5,-3924 2900.76,-3924 2900.76,-3924"/>
<polygon fill="black" stroke="black" points="2900.76,-3927.5 2910.76,-3924 2900.76,-3920.5 2900.76,-3927.5"/>
</g>
<!-- expert_0_1&#45;&gt;expert_results_0 -->
<g id="edge13" class="edge">
<title>expert_0_1&#45;&gt;expert_results_0</title>
<path fill="none" stroke="black" d="M792.5,-4039.87C792.5,-3994.31 792.5,-3936 792.5,-3936 792.5,-3936 2817.57,-3936 2817.57,-3936"/>
<polygon fill="black" stroke="black" points="2817.57,-3939.5 2827.57,-3936 2817.57,-3932.5 2817.57,-3939.5"/>
</g>
<!-- expert_0_2&#45;&gt;expert_results_0 -->
<g id="edge15" class="edge">
<title>expert_0_2&#45;&gt;expert_results_0</title>
<path fill="none" stroke="black" d="M1150.5,-4039.9C1150.5,-3998.15 1150.5,-3947 1150.5,-3947 1150.5,-3947 2780.02,-3947 2780.02,-3947"/>
<polygon fill="black" stroke="black" points="2780.02,-3950.5 2790.02,-3947 2780.02,-3943.5 2780.02,-3950.5"/>
</g>
<!-- expert_0_3&#45;&gt;expert_results_0 -->
<g id="edge17" class="edge">
<title>expert_0_3&#45;&gt;expert_results_0</title>
<path fill="none" stroke="black" d="M1508.5,-4039.67C1508.5,-4001.92 1508.5,-3958 1508.5,-3958 1508.5,-3958 2767.51,-3958 2767.51,-3958"/>
<polygon fill="black" stroke="black" points="2767.51,-3961.5 2777.51,-3958 2767.51,-3954.5 2767.51,-3961.5"/>
</g>
<!-- expert_0_4&#45;&gt;expert_results_0 -->
<g id="edge19" class="edge">
<title>expert_0_4&#45;&gt;expert_results_0</title>
<path fill="none" stroke="black" d="M1866.5,-4039.79C1866.5,-4006.54 1866.5,-3970 1866.5,-3970 1866.5,-3970 2778.9,-3970 2778.9,-3970"/>
<polygon fill="black" stroke="black" points="2778.9,-3973.5 2788.9,-3970 2778.9,-3966.5 2778.9,-3973.5"/>
</g>
<!-- expert_0_5&#45;&gt;expert_results_0 -->
<g id="edge21" class="edge">
<title>expert_0_5&#45;&gt;expert_results_0</title>
<path fill="none" stroke="black" d="M2224.5,-4039.97C2224.5,-4011.01 2224.5,-3981 2224.5,-3981 2224.5,-3981 2815,-3981 2815,-3981"/>
<polygon fill="black" stroke="black" points="2815,-3984.5 2825,-3981 2815,-3977.5 2815,-3984.5"/>
</g>
<!-- expert_0_6&#45;&gt;expert_results_0 -->
<g id="edge23" class="edge">
<title>expert_0_6&#45;&gt;expert_results_0</title>
<path fill="none" stroke="black" d="M2582.5,-4039.86C2582.5,-4015.51 2582.5,-3992 2582.5,-3992 2582.5,-3992 2886.26,-3992 2886.26,-3992"/>
<polygon fill="black" stroke="black" points="2886.26,-3995.5 2896.26,-3992 2886.26,-3988.5 2886.26,-3995.5"/>
</g>
<!-- expert_0_7&#45;&gt;expert_results_0 -->
<g id="edge25" class="edge">
<title>expert_0_7&#45;&gt;expert_results_0</title>
<path fill="none" stroke="black" d="M2868.74,-4039.98C2868.74,-4039.98 2868.74,-3998.67 2868.74,-3998.67"/>
<polygon fill="black" stroke="black" points="2872.24,-3998.67 2868.74,-3988.67 2865.24,-3998.67 2872.24,-3998.67"/>
</g>
<!-- expert_0_8&#45;&gt;expert_results_0 -->
<g id="edge27" class="edge">
<title>expert_0_8&#45;&gt;expert_results_0</title>
<path fill="none" stroke="black" d="M3148,-4039.98C3148,-4039.98 3148,-4014.09 3148,-4014.09"/>
<polygon fill="black" stroke="black" points="3151.5,-4014.09 3148,-4004.09 3144.5,-4014.09 3151.5,-4014.09"/>
</g>
<!-- expert_0_9&#45;&gt;expert_results_0 -->
<g id="edge29" class="edge">
<title>expert_0_9&#45;&gt;expert_results_0</title>
<path fill="none" stroke="black" d="M3427.26,-4039.98C3427.26,-4039.98 3427.26,-3998.67 3427.26,-3998.67"/>
<polygon fill="black" stroke="black" points="3430.76,-3998.67 3427.26,-3988.67 3423.76,-3998.67 3430.76,-3998.67"/>
</g>
<!-- expert_0_10&#45;&gt;expert_results_0 -->
<g id="edge31" class="edge">
<title>expert_0_10&#45;&gt;expert_results_0</title>
<path fill="none" stroke="black" d="M3864,-4039.93C3864,-4015.13 3864,-3991 3864,-3991 3864,-3991 3418.26,-3991 3418.26,-3991"/>
<polygon fill="black" stroke="black" points="3418.26,-3987.5 3408.26,-3991 3418.26,-3994.5 3418.26,-3987.5"/>
</g>
<!-- expert_0_11&#45;&gt;expert_results_0 -->
<g id="edge33" class="edge">
<title>expert_0_11&#45;&gt;expert_results_0</title>
<path fill="none" stroke="black" d="M4113.25,-4039.9C4113.25,-4009.75 4113.25,-3978 4113.25,-3978 4113.25,-3978 3493.57,-3978 3493.57,-3978"/>
<polygon fill="black" stroke="black" points="3493.57,-3974.5 3483.57,-3978 3493.57,-3981.5 3493.57,-3974.5"/>
</g>
<!-- expert_0_12&#45;&gt;expert_results_0 -->
<g id="edge35" class="edge">
<title>expert_0_12&#45;&gt;expert_results_0</title>
<path fill="none" stroke="black" d="M4499.75,-4039.85C4499.75,-4004.67 4499.75,-3965 4499.75,-3965 4499.75,-3965 3525.14,-3965 3525.14,-3965"/>
<polygon fill="black" stroke="black" points="3525.14,-3961.5 3515.14,-3965 3525.14,-3968.5 3525.14,-3961.5"/>
</g>
<!-- expert_0_13&#45;&gt;expert_results_0 -->
<g id="edge37" class="edge">
<title>expert_0_13&#45;&gt;expert_results_0</title>
<path fill="none" stroke="black" d="M4776,-4039.72C4776,-3999.78 4776,-3952 4776,-3952 4776,-3952 3524.37,-3952 3524.37,-3952"/>
<polygon fill="black" stroke="black" points="3524.37,-3948.5 3514.37,-3952 3524.37,-3955.5 3524.37,-3948.5"/>
</g>
<!-- expert_0_14&#45;&gt;expert_results_0 -->
<g id="edge39" class="edge">
<title>expert_0_14&#45;&gt;expert_results_0</title>
<path fill="none" stroke="black" d="M5229.25,-4040.03C5229.25,-3995.47 5229.25,-3939 5229.25,-3939 5229.25,-3939 3491.52,-3939 3491.52,-3939"/>
<polygon fill="black" stroke="black" points="3491.52,-3935.5 3481.52,-3939 3491.52,-3942.5 3491.52,-3935.5"/>
</g>
<!-- expert_0_15&#45;&gt;expert_results_0 -->
<g id="edge41" class="edge">
<title>expert_0_15&#45;&gt;expert_results_0</title>
<path fill="none" stroke="black" d="M5625.5,-4039.73C5625.5,-3990.84 5625.5,-3926 5625.5,-3926 5625.5,-3926 3413.52,-3926 3413.52,-3926"/>
<polygon fill="black" stroke="black" points="3413.52,-3922.5 3403.52,-3926 3413.52,-3929.5 3413.52,-3922.5"/>
</g>
<!-- moe_combine_0 -->
<g id="node27" class="node">
<title>moe_combine_0</title>
<polygon fill="lightblue" stroke="black" points="4589.5,-3877.53 4174.5,-3877.53 4174.5,-3813.53 4589.5,-3813.53 4589.5,-3877.53"/>
<text text-anchor="start" x="4311.5" y="-3863.33" font-family="Arial" font-weight="bold" font-size="14.00">MoE Output Combine</text>
<text text-anchor="start" x="4339.5" y="-3849.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4254.5" y="-3835.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [expert outputs, gating weights]</text>
<text text-anchor="start" x="4182.5" y="-3821.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- expert_results_0&#45;&gt;moe_combine_0 -->
<g id="edge42" class="edge">
<title>expert_results_0&#45;&gt;moe_combine_0</title>
<path fill="none" stroke="black" d="M3433.34,-3929.78C3433.34,-3896.07 3433.34,-3845 3433.34,-3845 3433.34,-3845 4164.4,-3845 4164.4,-3845"/>
<polygon fill="black" stroke="black" points="4164.4,-3848.5 4174.4,-3845 4164.4,-3841.5 4164.4,-3848.5"/>
</g>
<!-- moe_combine_0&#45;&gt;moe_res_0 -->
<g id="edge43" class="edge">
<title>moe_combine_0&#45;&gt;moe_res_0</title>
<path fill="none" stroke="black" d="M4589.8,-3845C4770.9,-3845 5004.75,-3845 5004.75,-3845 5004.75,-3845 5004.75,-3787.55 5004.75,-3787.55"/>
<polygon fill="black" stroke="black" points="5008.25,-3787.55 5004.75,-3777.55 5001.25,-3787.55 5008.25,-3787.55"/>
</g>
<!-- layernorm_1 -->
<g id="node29" class="node">
<title>layernorm_1</title>
<polygon fill="lightblue" stroke="black" points="5324.5,-3677.53 4909.5,-3677.53 4909.5,-3613.53 5324.5,-3613.53 5324.5,-3677.53"/>
<text text-anchor="start" x="5050.5" y="-3663.33" font-family="Arial" font-weight="bold" font-size="14.00">LayerNorm (Layer 1)</text>
<text text-anchor="start" x="5074.5" y="-3649.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4923" y="-3635.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="start" x="4917.5" y="-3621.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- moe_res_0&#45;&gt;layernorm_1 -->
<g id="edge45" class="edge">
<title>moe_res_0&#45;&gt;layernorm_1</title>
<path fill="none" stroke="black" d="M5117,-3713.34C5117,-3713.34 5117,-3687.66 5117,-3687.66"/>
<polygon fill="black" stroke="black" points="5120.5,-3687.66 5117,-3677.66 5113.5,-3687.66 5120.5,-3687.66"/>
</g>
<!-- mha_qkv_1 -->
<g id="node30" class="node">
<title>mha_qkv_1</title>
<polygon fill="lightblue" stroke="black" points="5210,-3577.53 4784,-3577.53 4784,-3513.53 5210,-3513.53 5210,-3577.53"/>
<text text-anchor="start" x="4942" y="-3563.33" font-family="Arial" font-weight="bold" font-size="14.00">MHA QKV Linear</text>
<text text-anchor="start" x="4954.5" y="-3549.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4803" y="-3535.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="start" x="4792" y="-3521.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, heads=32, d_k=128]</text>
</g>
<!-- layernorm_1&#45;&gt;mha_qkv_1 -->
<g id="edge46" class="edge">
<title>layernorm_1&#45;&gt;mha_qkv_1</title>
<path fill="none" stroke="black" d="M5059.75,-3613.34C5059.75,-3613.34 5059.75,-3587.66 5059.75,-3587.66"/>
<polygon fill="black" stroke="black" points="5063.25,-3587.66 5059.75,-3577.66 5056.25,-3587.66 5063.25,-3587.66"/>
</g>
<!-- attn_res_1 -->
<g id="node33" class="node">
<title>attn_res_1</title>
<polygon fill="lightblue" stroke="black" points="5334.5,-3277.53 4903.5,-3277.53 4903.5,-3213.53 5334.5,-3213.53 5334.5,-3277.53"/>
<text text-anchor="start" x="5044.5" y="-3263.33" font-family="Arial" font-weight="bold" font-size="14.00">Attention Residual Add</text>
<text text-anchor="start" x="5076.5" y="-3249.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4911.5" y="-3235.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096] (x2)</text>
<text text-anchor="start" x="4919.5" y="-3221.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layernorm_1&#45;&gt;attn_res_1 -->
<g id="edge50" class="edge">
<title>layernorm_1&#45;&gt;attn_res_1</title>
<path fill="none" stroke="black" d="M5267.25,-3613.47C5267.25,-3613.47 5267.25,-3287.74 5267.25,-3287.74"/>
<polygon fill="black" stroke="black" points="5270.75,-3287.74 5267.25,-3277.74 5263.75,-3287.74 5270.75,-3287.74"/>
</g>
<!-- mha_attn_1 -->
<g id="node31" class="node">
<title>mha_attn_1</title>
<polygon fill="lightblue" stroke="black" points="5207.5,-3477.53 4792.5,-3477.53 4792.5,-3413.53 5207.5,-3413.53 5207.5,-3477.53"/>
<text text-anchor="start" x="4953" y="-3463.33" font-family="Arial" font-weight="bold" font-size="14.00">MHA Attention</text>
<text text-anchor="start" x="4957.5" y="-3449.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4800.5" y="-3435.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, heads=32, d_k=128]</text>
<text text-anchor="start" x="4800.5" y="-3421.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- mha_qkv_1&#45;&gt;mha_attn_1 -->
<g id="edge47" class="edge">
<title>mha_qkv_1&#45;&gt;mha_attn_1</title>
<path fill="none" stroke="black" d="M5000,-3513.34C5000,-3513.34 5000,-3487.66 5000,-3487.66"/>
<polygon fill="black" stroke="black" points="5003.5,-3487.66 5000,-3477.66 4996.5,-3487.66 5003.5,-3487.66"/>
</g>
<!-- mha_out_1 -->
<g id="node32" class="node">
<title>mha_out_1</title>
<polygon fill="lightblue" stroke="black" points="5208.5,-3377.53 4793.5,-3377.53 4793.5,-3313.53 5208.5,-3313.53 5208.5,-3377.53"/>
<text text-anchor="start" x="4938.5" y="-3363.33" font-family="Arial" font-weight="bold" font-size="14.00">MHA Output Linear</text>
<text text-anchor="start" x="4958.5" y="-3349.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4807" y="-3335.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="start" x="4801.5" y="-3321.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- mha_attn_1&#45;&gt;mha_out_1 -->
<g id="edge48" class="edge">
<title>mha_attn_1&#45;&gt;mha_out_1</title>
<path fill="none" stroke="black" d="M5000.5,-3413.34C5000.5,-3413.34 5000.5,-3387.66 5000.5,-3387.66"/>
<polygon fill="black" stroke="black" points="5004,-3387.66 5000.5,-3377.66 4997,-3387.66 5004,-3387.66"/>
</g>
<!-- mha_out_1&#45;&gt;attn_res_1 -->
<g id="edge49" class="edge">
<title>mha_out_1&#45;&gt;attn_res_1</title>
<path fill="none" stroke="black" d="M5056,-3313.34C5056,-3313.34 5056,-3287.66 5056,-3287.66"/>
<polygon fill="black" stroke="black" points="5059.5,-3287.66 5056,-3277.66 5052.5,-3287.66 5059.5,-3287.66"/>
</g>
<!-- local_gating_1 -->
<g id="node34" class="node">
<title>local_gating_1</title>
<polygon fill="lightgreen" stroke="black" points="4185.7,-3177.53 3519.64,-3177.53 3348.3,-3049.53 4014.36,-3049.53 4185.7,-3177.53"/>
<text text-anchor="start" x="3700" y="-3131.33" font-family="Arial" font-weight="bold" font-size="14.00">Layer 1 Local Gating</text>
<text text-anchor="start" x="3724.5" y="-3117.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="3573" y="-3103.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="start" x="3599.5" y="-3089.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [token assignments → expert destinations]</text>
</g>
<!-- attn_res_1&#45;&gt;local_gating_1 -->
<g id="edge51" class="edge">
<title>attn_res_1&#45;&gt;local_gating_1</title>
<path fill="none" stroke="black" d="M4903.32,-3245C4626.12,-3245 4180.17,-3245 4180.17,-3245 4180.17,-3245 4180.17,-3123.62 4180.17,-3123.62"/>
<polygon fill="black" stroke="black" points="4183.67,-3123.62 4180.17,-3113.62 4176.67,-3123.62 4183.67,-3123.62"/>
</g>
<!-- moe_res_1 -->
<g id="node54" class="node">
<title>moe_res_1</title>
<polygon fill="lightblue" stroke="black" points="5275.5,-2573.02 4844.5,-2573.02 4844.5,-2509.02 5275.5,-2509.02 5275.5,-2573.02"/>
<text text-anchor="start" x="5000.5" y="-2558.82" font-family="Arial" font-weight="bold" font-size="14.00">MoE Residual Add</text>
<text text-anchor="start" x="5017.5" y="-2544.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4852.5" y="-2530.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096] (x2)</text>
<text text-anchor="start" x="4860.5" y="-2516.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- attn_res_1&#45;&gt;moe_res_1 -->
<g id="edge87" class="edge">
<title>attn_res_1&#45;&gt;moe_res_1</title>
<path fill="none" stroke="black" d="M5060,-3213.43C5060,-3213.43 5060,-2583.31 5060,-2583.31"/>
<polygon fill="black" stroke="black" points="5063.5,-2583.31 5060,-2573.31 5056.5,-2583.31 5063.5,-2583.31"/>
</g>
<!-- token_batch_1 -->
<g id="node35" class="node">
<title>token_batch_1</title>
<ellipse fill="lightyellow" stroke="black" cx="3091" cy="-2995.53" rx="68.49" ry="18"/>
<text text-anchor="middle" x="3091" y="-2991.83" font-family="Arial" font-size="14.00">token_batch_1</text>
</g>
<!-- local_gating_1&#45;&gt;token_batch_1 -->
<g id="edge52" class="edge">
<title>local_gating_1&#45;&gt;token_batch_1</title>
<path fill="none" stroke="black" d="M3432.96,-3113C3262.65,-3113 3091,-3113 3091,-3113 3091,-3113 3091,-3023.63 3091,-3023.63"/>
<polygon fill="black" stroke="black" points="3094.5,-3023.63 3091,-3013.63 3087.5,-3023.63 3094.5,-3023.63"/>
</g>
<!-- expert_1_0 -->
<g id="node36" class="node">
<title>expert_1_0</title>
<polygon fill="lightcoral" stroke="black" points="397,-2941.53 57,-2941.53 57,-2835.53 397,-2835.53 397,-2941.53"/>
<text text-anchor="start" x="170" y="-2927.33" font-family="Arial" font-weight="bold" font-size="14.00">Expert 0 (Layer 1)</text>
<text text-anchor="start" x="181.5" y="-2913.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 0</text>
<text text-anchor="start" x="168.5" y="-2899.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 0</text>
<text text-anchor="start" x="88.5" y="-2885.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="65" y="-2871.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="153.5" y="-2857.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="124.5" y="-2843.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_1&#45;&gt;expert_1_0 -->
<g id="edge53" class="edge">
<title>token_batch_1&#45;&gt;expert_1_0</title>
<path fill="none" stroke="black" d="M3045.6,-3009C2681.88,-3009 255.5,-3009 255.5,-3009 255.5,-3009 255.5,-2951.72 255.5,-2951.72"/>
<polygon fill="black" stroke="black" points="259,-2951.72 255.5,-2941.72 252,-2951.72 259,-2951.72"/>
</g>
<!-- expert_1_1 -->
<g id="node37" class="node">
<title>expert_1_1</title>
<polygon fill="lightcoral" stroke="black" points="755,-2941.53 415,-2941.53 415,-2835.53 755,-2835.53 755,-2941.53"/>
<text text-anchor="start" x="528" y="-2927.33" font-family="Arial" font-weight="bold" font-size="14.00">Expert 1 (Layer 1)</text>
<text text-anchor="start" x="539.5" y="-2913.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 1</text>
<text text-anchor="start" x="526.5" y="-2899.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 1</text>
<text text-anchor="start" x="446.5" y="-2885.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="423" y="-2871.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="511.5" y="-2857.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="482.5" y="-2843.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_1&#45;&gt;expert_1_1 -->
<g id="edge55" class="edge">
<title>token_batch_1&#45;&gt;expert_1_1</title>
<path fill="none" stroke="black" d="M3032.81,-3005C2659.22,-3005 613.5,-3005 613.5,-3005 613.5,-3005 613.5,-2951.65 613.5,-2951.65"/>
<polygon fill="black" stroke="black" points="617,-2951.65 613.5,-2941.65 610,-2951.65 617,-2951.65"/>
</g>
<!-- expert_1_2 -->
<g id="node38" class="node">
<title>expert_1_2</title>
<polygon fill="lightcoral" stroke="black" points="1113,-2941.53 773,-2941.53 773,-2835.53 1113,-2835.53 1113,-2941.53"/>
<text text-anchor="start" x="886" y="-2927.33" font-family="Arial" font-weight="bold" font-size="14.00">Expert 2 (Layer 1)</text>
<text text-anchor="start" x="897.5" y="-2913.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 2</text>
<text text-anchor="start" x="884.5" y="-2899.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 2</text>
<text text-anchor="start" x="804.5" y="-2885.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="781" y="-2871.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="869.5" y="-2857.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="840.5" y="-2843.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_1&#45;&gt;expert_1_2 -->
<g id="edge57" class="edge">
<title>token_batch_1&#45;&gt;expert_1_2</title>
<path fill="none" stroke="black" d="M3025.83,-3001C2669.35,-3001 971.5,-3001 971.5,-3001 971.5,-3001 971.5,-2951.8 971.5,-2951.8"/>
<polygon fill="black" stroke="black" points="975,-2951.8 971.5,-2941.8 968,-2951.8 975,-2951.8"/>
</g>
<!-- expert_1_3 -->
<g id="node39" class="node">
<title>expert_1_3</title>
<polygon fill="lightcoral" stroke="black" points="1471,-2941.53 1131,-2941.53 1131,-2835.53 1471,-2835.53 1471,-2941.53"/>
<text text-anchor="start" x="1244" y="-2927.33" font-family="Arial" font-weight="bold" font-size="14.00">Expert 3 (Layer 1)</text>
<text text-anchor="start" x="1255.5" y="-2913.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 3</text>
<text text-anchor="start" x="1242.5" y="-2899.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 3</text>
<text text-anchor="start" x="1162.5" y="-2885.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="1139" y="-2871.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="1227.5" y="-2857.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="1198.5" y="-2843.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_1&#45;&gt;expert_1_3 -->
<g id="edge59" class="edge">
<title>token_batch_1&#45;&gt;expert_1_3</title>
<path fill="none" stroke="black" d="M3022.76,-2997C2698.55,-2997 1329.5,-2997 1329.5,-2997 1329.5,-2997 1329.5,-2951.81 1329.5,-2951.81"/>
<polygon fill="black" stroke="black" points="1333,-2951.81 1329.5,-2941.81 1326,-2951.81 1333,-2951.81"/>
</g>
<!-- expert_1_4 -->
<g id="node40" class="node">
<title>expert_1_4</title>
<polygon fill="lightcoral" stroke="black" points="1829,-2941.53 1489,-2941.53 1489,-2835.53 1829,-2835.53 1829,-2941.53"/>
<text text-anchor="start" x="1602" y="-2927.33" font-family="Arial" font-weight="bold" font-size="14.00">Expert 4 (Layer 1)</text>
<text text-anchor="start" x="1613.5" y="-2913.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 4</text>
<text text-anchor="start" x="1600.5" y="-2899.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 4</text>
<text text-anchor="start" x="1520.5" y="-2885.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="1497" y="-2871.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="1585.5" y="-2857.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="1556.5" y="-2843.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_1&#45;&gt;expert_1_4 -->
<g id="edge61" class="edge">
<title>token_batch_1&#45;&gt;expert_1_4</title>
<path fill="none" stroke="black" d="M3023.31,-2993C2742.95,-2993 1687.5,-2993 1687.5,-2993 1687.5,-2993 1687.5,-2951.68 1687.5,-2951.68"/>
<polygon fill="black" stroke="black" points="1691,-2951.68 1687.5,-2941.68 1684,-2951.68 1691,-2951.68"/>
</g>
<!-- expert_1_5 -->
<g id="node41" class="node">
<title>expert_1_5</title>
<polygon fill="lightcoral" stroke="black" points="2187,-2941.53 1847,-2941.53 1847,-2835.53 2187,-2835.53 2187,-2941.53"/>
<text text-anchor="start" x="1960" y="-2927.33" font-family="Arial" font-weight="bold" font-size="14.00">Expert 5 (Layer 1)</text>
<text text-anchor="start" x="1971.5" y="-2913.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 5</text>
<text text-anchor="start" x="1958.5" y="-2899.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 5</text>
<text text-anchor="start" x="1878.5" y="-2885.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="1855" y="-2871.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="1943.5" y="-2857.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="1914.5" y="-2843.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_1&#45;&gt;expert_1_5 -->
<g id="edge63" class="edge">
<title>token_batch_1&#45;&gt;expert_1_5</title>
<path fill="none" stroke="black" d="M3027.17,-2989C2800.18,-2989 2045.5,-2989 2045.5,-2989 2045.5,-2989 2045.5,-2951.71 2045.5,-2951.71"/>
<polygon fill="black" stroke="black" points="2049,-2951.71 2045.5,-2941.71 2042,-2951.71 2049,-2951.71"/>
</g>
<!-- expert_1_6 -->
<g id="node42" class="node">
<title>expert_1_6</title>
<polygon fill="lightcoral" stroke="black" points="2545,-2941.53 2205,-2941.53 2205,-2835.53 2545,-2835.53 2545,-2941.53"/>
<text text-anchor="start" x="2318" y="-2927.33" font-family="Arial" font-weight="bold" font-size="14.00">Expert 6 (Layer 1)</text>
<text text-anchor="start" x="2329.5" y="-2913.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 6</text>
<text text-anchor="start" x="2316.5" y="-2899.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 6</text>
<text text-anchor="start" x="2236.5" y="-2885.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="2213" y="-2871.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="2301.5" y="-2857.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="2272.5" y="-2843.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_1&#45;&gt;expert_1_6 -->
<g id="edge65" class="edge">
<title>token_batch_1&#45;&gt;expert_1_6</title>
<path fill="none" stroke="black" d="M3035.61,-2985C2872.21,-2985 2403.5,-2985 2403.5,-2985 2403.5,-2985 2403.5,-2951.56 2403.5,-2951.56"/>
<polygon fill="black" stroke="black" points="2407,-2951.56 2403.5,-2941.56 2400,-2951.56 2407,-2951.56"/>
</g>
<!-- expert_1_7 -->
<g id="node43" class="node">
<title>expert_1_7</title>
<polygon fill="lightcoral" stroke="black" points="2903,-2941.53 2563,-2941.53 2563,-2835.53 2903,-2835.53 2903,-2941.53"/>
<text text-anchor="start" x="2676" y="-2927.33" font-family="Arial" font-weight="bold" font-size="14.00">Expert 7 (Layer 1)</text>
<text text-anchor="start" x="2687.5" y="-2913.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 7</text>
<text text-anchor="start" x="2674.5" y="-2899.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 7</text>
<text text-anchor="start" x="2594.5" y="-2885.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="2571" y="-2871.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="2659.5" y="-2857.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="2630.5" y="-2843.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_1&#45;&gt;expert_1_7 -->
<g id="edge67" class="edge">
<title>token_batch_1&#45;&gt;expert_1_7</title>
<path fill="none" stroke="black" d="M3050.71,-2981C2979.83,-2981 2840.24,-2981 2840.24,-2981 2840.24,-2981 2840.24,-2951.78 2840.24,-2951.78"/>
<polygon fill="black" stroke="black" points="2843.74,-2951.78 2840.24,-2941.78 2836.74,-2951.78 2843.74,-2951.78"/>
</g>
<!-- expert_1_8 -->
<g id="node44" class="node">
<title>expert_1_8</title>
<polygon fill="lightcoral" stroke="black" points="3261,-2941.53 2921,-2941.53 2921,-2835.53 3261,-2835.53 3261,-2941.53"/>
<text text-anchor="start" x="3034" y="-2927.33" font-family="Arial" font-weight="bold" font-size="14.00">Expert 8 (Layer 1)</text>
<text text-anchor="start" x="3045.5" y="-2913.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 8</text>
<text text-anchor="start" x="3032.5" y="-2899.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 8</text>
<text text-anchor="start" x="2952.5" y="-2885.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="2929" y="-2871.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="3017.5" y="-2857.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="2988.5" y="-2843.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_1&#45;&gt;expert_1_8 -->
<g id="edge69" class="edge">
<title>token_batch_1&#45;&gt;expert_1_8</title>
<path fill="none" stroke="black" d="M3091,-2977.38C3091,-2977.38 3091,-2951.86 3091,-2951.86"/>
<polygon fill="black" stroke="black" points="3094.5,-2951.86 3091,-2941.86 3087.5,-2951.86 3094.5,-2951.86"/>
</g>
<!-- expert_1_9 -->
<g id="node45" class="node">
<title>expert_1_9</title>
<polygon fill="lightcoral" stroke="black" points="3619,-2941.53 3279,-2941.53 3279,-2835.53 3619,-2835.53 3619,-2941.53"/>
<text text-anchor="start" x="3392" y="-2927.33" font-family="Arial" font-weight="bold" font-size="14.00">Expert 9 (Layer 1)</text>
<text text-anchor="start" x="3403.5" y="-2913.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 9</text>
<text text-anchor="start" x="3390.5" y="-2899.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 9</text>
<text text-anchor="start" x="3310.5" y="-2885.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="3287" y="-2871.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="3375.5" y="-2857.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="3346.5" y="-2843.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_1&#45;&gt;expert_1_9 -->
<g id="edge71" class="edge">
<title>token_batch_1&#45;&gt;expert_1_9</title>
<path fill="none" stroke="black" d="M3136.04,-2982C3201.08,-2982 3313.58,-2982 3313.58,-2982 3313.58,-2982 3313.58,-2951.55 3313.58,-2951.55"/>
<polygon fill="black" stroke="black" points="3317.08,-2951.55 3313.58,-2941.55 3310.08,-2951.55 3317.08,-2951.55"/>
</g>
<!-- expert_1_10 -->
<g id="node46" class="node">
<title>expert_1_10</title>
<polygon fill="lightcoral" stroke="black" points="3977,-2941.53 3637,-2941.53 3637,-2835.53 3977,-2835.53 3977,-2941.53"/>
<text text-anchor="start" x="3746.5" y="-2927.33" font-family="Arial" font-weight="bold" font-size="14.00">Expert 10 (Layer 1)</text>
<text text-anchor="start" x="3758" y="-2913.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 10</text>
<text text-anchor="start" x="3745" y="-2899.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 10</text>
<text text-anchor="start" x="3668.5" y="-2885.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="3645" y="-2871.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="3733.5" y="-2857.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="3704.5" y="-2843.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_1&#45;&gt;expert_1_10 -->
<g id="edge73" class="edge">
<title>token_batch_1&#45;&gt;expert_1_10</title>
<path fill="none" stroke="black" d="M3148.99,-2986C3319.44,-2986 3807,-2986 3807,-2986 3807,-2986 3807,-2951.54 3807,-2951.54"/>
<polygon fill="black" stroke="black" points="3810.5,-2951.54 3807,-2941.54 3803.5,-2951.54 3810.5,-2951.54"/>
</g>
<!-- expert_1_11 -->
<g id="node47" class="node">
<title>expert_1_11</title>
<polygon fill="lightcoral" stroke="black" points="4335,-2941.53 3995,-2941.53 3995,-2835.53 4335,-2835.53 4335,-2941.53"/>
<text text-anchor="start" x="4104.5" y="-2927.33" font-family="Arial" font-weight="bold" font-size="14.00">Expert 11 (Layer 1)</text>
<text text-anchor="start" x="4116" y="-2913.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 11</text>
<text text-anchor="start" x="4103" y="-2899.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 11</text>
<text text-anchor="start" x="4026.5" y="-2885.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="4003" y="-2871.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="4091.5" y="-2857.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="4062.5" y="-2843.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_1&#45;&gt;expert_1_11 -->
<g id="edge75" class="edge">
<title>token_batch_1&#45;&gt;expert_1_11</title>
<path fill="none" stroke="black" d="M3157.35,-2991C3380.57,-2991 4090.42,-2991 4090.42,-2991 4090.42,-2991 4090.42,-2951.57 4090.42,-2951.57"/>
<polygon fill="black" stroke="black" points="4093.92,-2951.57 4090.42,-2941.57 4086.92,-2951.57 4093.92,-2951.57"/>
</g>
<!-- expert_1_12 -->
<g id="node48" class="node">
<title>expert_1_12</title>
<polygon fill="lightcoral" stroke="black" points="4693,-2941.53 4353,-2941.53 4353,-2835.53 4693,-2835.53 4693,-2941.53"/>
<text text-anchor="start" x="4462.5" y="-2927.33" font-family="Arial" font-weight="bold" font-size="14.00">Expert 12 (Layer 1)</text>
<text text-anchor="start" x="4474" y="-2913.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 12</text>
<text text-anchor="start" x="4461" y="-2899.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 12</text>
<text text-anchor="start" x="4384.5" y="-2885.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="4361" y="-2871.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="4449.5" y="-2857.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="4420.5" y="-2843.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_1&#45;&gt;expert_1_12 -->
<g id="edge77" class="edge">
<title>token_batch_1&#45;&gt;expert_1_12</title>
<path fill="none" stroke="black" d="M3159.45,-2995C3437.95,-2995 4471.25,-2995 4471.25,-2995 4471.25,-2995 4471.25,-2951.76 4471.25,-2951.76"/>
<polygon fill="black" stroke="black" points="4474.75,-2951.76 4471.25,-2941.76 4467.75,-2951.76 4474.75,-2951.76"/>
</g>
<!-- expert_1_13 -->
<g id="node49" class="node">
<title>expert_1_13</title>
<polygon fill="lightcoral" stroke="black" points="5051,-2941.53 4711,-2941.53 4711,-2835.53 5051,-2835.53 5051,-2941.53"/>
<text text-anchor="start" x="4820.5" y="-2927.33" font-family="Arial" font-weight="bold" font-size="14.00">Expert 13 (Layer 1)</text>
<text text-anchor="start" x="4832" y="-2913.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 13</text>
<text text-anchor="start" x="4819" y="-2899.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 13</text>
<text text-anchor="start" x="4742.5" y="-2885.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="4719" y="-2871.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="4807.5" y="-2857.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="4778.5" y="-2843.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_1&#45;&gt;expert_1_13 -->
<g id="edge79" class="edge">
<title>token_batch_1&#45;&gt;expert_1_13</title>
<path fill="none" stroke="black" d="M3157.3,-3000C3464.03,-3000 4730.5,-3000 4730.5,-3000 4730.5,-3000 4730.5,-2951.65 4730.5,-2951.65"/>
<polygon fill="black" stroke="black" points="4734,-2951.65 4730.5,-2941.65 4727,-2951.65 4734,-2951.65"/>
</g>
<!-- expert_1_14 -->
<g id="node50" class="node">
<title>expert_1_14</title>
<polygon fill="lightcoral" stroke="black" points="5409,-2941.53 5069,-2941.53 5069,-2835.53 5409,-2835.53 5409,-2941.53"/>
<text text-anchor="start" x="5178.5" y="-2927.33" font-family="Arial" font-weight="bold" font-size="14.00">Expert 14 (Layer 1)</text>
<text text-anchor="start" x="5190" y="-2913.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 14</text>
<text text-anchor="start" x="5177" y="-2899.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 14</text>
<text text-anchor="start" x="5100.5" y="-2885.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="5077" y="-2871.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="5165.5" y="-2857.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="5136.5" y="-2843.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_1&#45;&gt;expert_1_14 -->
<g id="edge81" class="edge">
<title>token_batch_1&#45;&gt;expert_1_14</title>
<path fill="none" stroke="black" d="M3151.33,-3004C3496.12,-3004 5201.75,-3004 5201.75,-3004 5201.75,-3004 5201.75,-2951.53 5201.75,-2951.53"/>
<polygon fill="black" stroke="black" points="5205.25,-2951.53 5201.75,-2941.53 5198.25,-2951.53 5205.25,-2951.53"/>
</g>
<!-- expert_1_15 -->
<g id="node51" class="node">
<title>expert_1_15</title>
<polygon fill="lightcoral" stroke="black" points="5767,-2941.53 5427,-2941.53 5427,-2835.53 5767,-2835.53 5767,-2941.53"/>
<text text-anchor="start" x="5536.5" y="-2927.33" font-family="Arial" font-weight="bold" font-size="14.00">Expert 15 (Layer 1)</text>
<text text-anchor="start" x="5548" y="-2913.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 15</text>
<text text-anchor="start" x="5535" y="-2899.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 15</text>
<text text-anchor="start" x="5458.5" y="-2885.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="5435" y="-2871.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="5523.5" y="-2857.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="5494.5" y="-2843.33" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_1&#45;&gt;expert_1_15 -->
<g id="edge83" class="edge">
<title>token_batch_1&#45;&gt;expert_1_15</title>
<path fill="none" stroke="black" d="M3136.47,-3009C3463.71,-3009 5446.5,-3009 5446.5,-3009 5446.5,-3009 5446.5,-2951.72 5446.5,-2951.72"/>
<polygon fill="black" stroke="black" points="5450,-2951.72 5446.5,-2941.72 5443,-2951.72 5450,-2951.72"/>
</g>
<!-- expert_results_1 -->
<g id="node52" class="node">
<title>expert_results_1</title>
<ellipse fill="lightyellow" stroke="black" cx="3091" cy="-2754.27" rx="370.55" ry="45.01"/>
<text text-anchor="start" x="3009" y="-2772.07" font-family="Arial" font-weight="bold" font-size="14.00">Expert Results Collection</text>
<text text-anchor="start" x="3048.5" y="-2758.07" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="2951" y="-2744.07" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [processed tokens from 16 experts]</text>
<text text-anchor="start" x="2837" y="-2730.07" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [reordered tokens, batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- expert_1_0&#45;&gt;expert_results_1 -->
<g id="edge54" class="edge">
<title>expert_1_0&#45;&gt;expert_results_1</title>
<path fill="none" stroke="black" d="M377.5,-2835.21C377.5,-2785.83 377.5,-2720 377.5,-2720 377.5,-2720 2839,-2720 2839,-2720"/>
<polygon fill="black" stroke="black" points="2839,-2723.5 2849,-2720 2839,-2716.5 2839,-2723.5"/>
</g>
<!-- expert_1_1&#45;&gt;expert_results_1 -->
<g id="edge56" class="edge">
<title>expert_1_1&#45;&gt;expert_results_1</title>
<path fill="none" stroke="black" d="M735.5,-2835.2C735.5,-2789.5 735.5,-2731 735.5,-2731 735.5,-2731 2763.02,-2731 2763.02,-2731"/>
<polygon fill="black" stroke="black" points="2763.02,-2734.5 2773.02,-2731 2763.02,-2727.5 2763.02,-2734.5"/>
</g>
<!-- expert_1_2&#45;&gt;expert_results_1 -->
<g id="edge58" class="edge">
<title>expert_1_2&#45;&gt;expert_results_1</title>
<path fill="none" stroke="black" d="M1093.5,-2835.21C1093.5,-2793.32 1093.5,-2742 1093.5,-2742 1093.5,-2742 2724.18,-2742 2724.18,-2742"/>
<polygon fill="black" stroke="black" points="2724.18,-2745.5 2734.18,-2742 2724.17,-2738.5 2724.18,-2745.5"/>
</g>
<!-- expert_1_3&#45;&gt;expert_results_1 -->
<g id="edge60" class="edge">
<title>expert_1_3&#45;&gt;expert_results_1</title>
<path fill="none" stroke="black" d="M1451.5,-2835.36C1451.5,-2797.76 1451.5,-2754 1451.5,-2754 1451.5,-2754 2710.25,-2754 2710.25,-2754"/>
<polygon fill="black" stroke="black" points="2710.25,-2757.5 2720.25,-2754 2710.25,-2750.5 2710.25,-2757.5"/>
</g>
<!-- expert_1_4&#45;&gt;expert_results_1 -->
<g id="edge62" class="edge">
<title>expert_1_4&#45;&gt;expert_results_1</title>
<path fill="none" stroke="black" d="M1809.5,-2835.42C1809.5,-2801.94 1809.5,-2765 1809.5,-2765 1809.5,-2765 2720.62,-2765 2720.62,-2765"/>
<polygon fill="black" stroke="black" points="2720.62,-2768.5 2730.62,-2765 2720.62,-2761.5 2720.62,-2768.5"/>
</g>
<!-- expert_1_5&#45;&gt;expert_results_1 -->
<g id="edge64" class="edge">
<title>expert_1_5&#45;&gt;expert_results_1</title>
<path fill="none" stroke="black" d="M2167.5,-2835.23C2167.5,-2806.15 2167.5,-2776 2167.5,-2776 2167.5,-2776 2755.73,-2776 2755.73,-2776"/>
<polygon fill="black" stroke="black" points="2755.73,-2779.5 2765.73,-2776 2755.73,-2772.5 2755.73,-2779.5"/>
</g>
<!-- expert_1_6&#45;&gt;expert_results_1 -->
<g id="edge66" class="edge">
<title>expert_1_6&#45;&gt;expert_results_1</title>
<path fill="none" stroke="black" d="M2525.5,-2835.32C2525.5,-2811.21 2525.5,-2788 2525.5,-2788 2525.5,-2788 2833.79,-2788 2833.79,-2788"/>
<polygon fill="black" stroke="black" points="2833.79,-2791.5 2843.79,-2788 2833.79,-2784.5 2833.79,-2791.5"/>
</g>
<!-- expert_1_7&#45;&gt;expert_results_1 -->
<g id="edge68" class="edge">
<title>expert_1_7&#45;&gt;expert_results_1</title>
<path fill="none" stroke="black" d="M2811.74,-2835.47C2811.74,-2835.47 2811.74,-2794.16 2811.74,-2794.16"/>
<polygon fill="black" stroke="black" points="2815.24,-2794.16 2811.74,-2784.16 2808.24,-2794.16 2815.24,-2794.16"/>
</g>
<!-- expert_1_8&#45;&gt;expert_results_1 -->
<g id="edge70" class="edge">
<title>expert_1_8&#45;&gt;expert_results_1</title>
<path fill="none" stroke="black" d="M3091,-2835.47C3091,-2835.47 3091,-2809.58 3091,-2809.58"/>
<polygon fill="black" stroke="black" points="3094.5,-2809.58 3091,-2799.58 3087.5,-2809.58 3094.5,-2809.58"/>
</g>
<!-- expert_1_9&#45;&gt;expert_results_1 -->
<g id="edge72" class="edge">
<title>expert_1_9&#45;&gt;expert_results_1</title>
<path fill="none" stroke="black" d="M3370.26,-2835.47C3370.26,-2835.47 3370.26,-2794.16 3370.26,-2794.16"/>
<polygon fill="black" stroke="black" points="3373.76,-2794.16 3370.26,-2784.16 3366.76,-2794.16 3373.76,-2794.16"/>
</g>
<!-- expert_1_10&#45;&gt;expert_results_1 -->
<g id="edge74" class="edge">
<title>expert_1_10&#45;&gt;expert_results_1</title>
<path fill="none" stroke="black" d="M3807,-2835.46C3807,-2810.44 3807,-2786 3807,-2786 3807,-2786 3365.32,-2786 3365.32,-2786"/>
<polygon fill="black" stroke="black" points="3365.32,-2782.5 3355.32,-2786 3365.32,-2789.5 3365.32,-2782.5"/>
</g>
<!-- expert_1_11&#45;&gt;expert_results_1 -->
<g id="edge76" class="edge">
<title>expert_1_11&#45;&gt;expert_results_1</title>
<path fill="none" stroke="black" d="M4056.25,-2835.5C4056.25,-2805.13 4056.25,-2773 4056.25,-2773 4056.25,-2773 3438.6,-2773 3438.6,-2773"/>
<polygon fill="black" stroke="black" points="3438.6,-2769.5 3428.6,-2773 3438.6,-2776.5 3438.6,-2769.5"/>
</g>
<!-- expert_1_12&#45;&gt;expert_results_1 -->
<g id="edge78" class="edge">
<title>expert_1_12&#45;&gt;expert_results_1</title>
<path fill="none" stroke="black" d="M4442.75,-2835.51C4442.75,-2800.1 4442.75,-2760 4442.75,-2760 4442.75,-2760 3468.59,-2760 3468.59,-2760"/>
<polygon fill="black" stroke="black" points="3468.59,-2756.5 3458.59,-2760 3468.59,-2763.5 3468.59,-2756.5"/>
</g>
<!-- expert_1_13&#45;&gt;expert_results_1 -->
<g id="edge80" class="edge">
<title>expert_1_13&#45;&gt;expert_results_1</title>
<path fill="none" stroke="black" d="M4719,-2835.43C4719,-2795.27 4719,-2747 4719,-2747 4719,-2747 3466.86,-2747 3466.86,-2747"/>
<polygon fill="black" stroke="black" points="3466.86,-2743.5 3456.86,-2747 3466.86,-2750.5 3466.86,-2743.5"/>
</g>
<!-- expert_1_14&#45;&gt;expert_results_1 -->
<g id="edge82" class="edge">
<title>expert_1_14&#45;&gt;expert_results_1</title>
<path fill="none" stroke="black" d="M5172.25,-2835.35C5172.25,-2790.65 5172.25,-2734 5172.25,-2734 5172.25,-2734 3432.51,-2734 3432.51,-2734"/>
<polygon fill="black" stroke="black" points="3432.51,-2730.5 3422.51,-2734 3432.51,-2737.5 3432.51,-2730.5"/>
</g>
<!-- expert_1_15&#45;&gt;expert_results_1 -->
<g id="edge84" class="edge">
<title>expert_1_15&#45;&gt;expert_results_1</title>
<path fill="none" stroke="black" d="M5568.5,-2835.52C5568.5,-2786.44 5568.5,-2721 5568.5,-2721 5568.5,-2721 3352.19,-2721 3352.19,-2721"/>
<polygon fill="black" stroke="black" points="3352.19,-2717.5 3342.19,-2721 3352.19,-2724.5 3352.19,-2717.5"/>
</g>
<!-- moe_combine_1 -->
<g id="node53" class="node">
<title>moe_combine_1</title>
<polygon fill="lightblue" stroke="black" points="4532.5,-2673.02 4117.5,-2673.02 4117.5,-2609.02 4532.5,-2609.02 4532.5,-2673.02"/>
<text text-anchor="start" x="4254.5" y="-2658.82" font-family="Arial" font-weight="bold" font-size="14.00">MoE Output Combine</text>
<text text-anchor="start" x="4282.5" y="-2644.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4197.5" y="-2630.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [expert outputs, gating weights]</text>
<text text-anchor="start" x="4125.5" y="-2616.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- expert_results_1&#45;&gt;moe_combine_1 -->
<g id="edge85" class="edge">
<title>expert_results_1&#45;&gt;moe_combine_1</title>
<path fill="none" stroke="black" d="M3376.34,-2725.4C3376.34,-2691.84 3376.34,-2641 3376.34,-2641 3376.34,-2641 4107.4,-2641 4107.4,-2641"/>
<polygon fill="black" stroke="black" points="4107.4,-2644.5 4117.4,-2641 4107.4,-2637.5 4107.4,-2644.5"/>
</g>
<!-- moe_combine_1&#45;&gt;moe_res_1 -->
<g id="edge86" class="edge">
<title>moe_combine_1&#45;&gt;moe_res_1</title>
<path fill="none" stroke="black" d="M4532.8,-2641C4713.9,-2641 4947.75,-2641 4947.75,-2641 4947.75,-2641 4947.75,-2583.2 4947.75,-2583.2"/>
<polygon fill="black" stroke="black" points="4951.25,-2583.2 4947.75,-2573.2 4944.25,-2583.2 4951.25,-2583.2"/>
</g>
<!-- layernorm_2 -->
<g id="node55" class="node">
<title>layernorm_2</title>
<polygon fill="lightblue" stroke="black" points="5267.5,-2473.02 4852.5,-2473.02 4852.5,-2409.02 5267.5,-2409.02 5267.5,-2473.02"/>
<text text-anchor="start" x="4993.5" y="-2458.82" font-family="Arial" font-weight="bold" font-size="14.00">LayerNorm (Layer 2)</text>
<text text-anchor="start" x="5017.5" y="-2444.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4866" y="-2430.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="start" x="4860.5" y="-2416.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- moe_res_1&#45;&gt;layernorm_2 -->
<g id="edge88" class="edge">
<title>moe_res_1&#45;&gt;layernorm_2</title>
<path fill="none" stroke="black" d="M5060,-2508.83C5060,-2508.83 5060,-2483.15 5060,-2483.15"/>
<polygon fill="black" stroke="black" points="5063.5,-2483.15 5060,-2473.15 5056.5,-2483.15 5063.5,-2483.15"/>
</g>
<!-- mha_qkv_2 -->
<g id="node56" class="node">
<title>mha_qkv_2</title>
<polygon fill="lightblue" stroke="black" points="5153,-2373.02 4727,-2373.02 4727,-2309.02 5153,-2309.02 5153,-2373.02"/>
<text text-anchor="start" x="4885" y="-2358.82" font-family="Arial" font-weight="bold" font-size="14.00">MHA QKV Linear</text>
<text text-anchor="start" x="4897.5" y="-2344.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4746" y="-2330.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="start" x="4735" y="-2316.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, heads=32, d_k=128]</text>
</g>
<!-- layernorm_2&#45;&gt;mha_qkv_2 -->
<g id="edge89" class="edge">
<title>layernorm_2&#45;&gt;mha_qkv_2</title>
<path fill="none" stroke="black" d="M5002.75,-2408.83C5002.75,-2408.83 5002.75,-2383.15 5002.75,-2383.15"/>
<polygon fill="black" stroke="black" points="5006.25,-2383.15 5002.75,-2373.15 4999.25,-2383.15 5006.25,-2383.15"/>
</g>
<!-- attn_res_2 -->
<g id="node59" class="node">
<title>attn_res_2</title>
<polygon fill="lightblue" stroke="black" points="5277.5,-2073.02 4846.5,-2073.02 4846.5,-2009.02 5277.5,-2009.02 5277.5,-2073.02"/>
<text text-anchor="start" x="4987.5" y="-2058.82" font-family="Arial" font-weight="bold" font-size="14.00">Attention Residual Add</text>
<text text-anchor="start" x="5019.5" y="-2044.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4854.5" y="-2030.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096] (x2)</text>
<text text-anchor="start" x="4862.5" y="-2016.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layernorm_2&#45;&gt;attn_res_2 -->
<g id="edge93" class="edge">
<title>layernorm_2&#45;&gt;attn_res_2</title>
<path fill="none" stroke="black" d="M5210.25,-2408.96C5210.25,-2408.96 5210.25,-2083.23 5210.25,-2083.23"/>
<polygon fill="black" stroke="black" points="5213.75,-2083.23 5210.25,-2073.23 5206.75,-2083.23 5213.75,-2083.23"/>
</g>
<!-- mha_attn_2 -->
<g id="node57" class="node">
<title>mha_attn_2</title>
<polygon fill="lightblue" stroke="black" points="5150.5,-2273.02 4735.5,-2273.02 4735.5,-2209.02 5150.5,-2209.02 5150.5,-2273.02"/>
<text text-anchor="start" x="4896" y="-2258.82" font-family="Arial" font-weight="bold" font-size="14.00">MHA Attention</text>
<text text-anchor="start" x="4900.5" y="-2244.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4743.5" y="-2230.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, heads=32, d_k=128]</text>
<text text-anchor="start" x="4743.5" y="-2216.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- mha_qkv_2&#45;&gt;mha_attn_2 -->
<g id="edge90" class="edge">
<title>mha_qkv_2&#45;&gt;mha_attn_2</title>
<path fill="none" stroke="black" d="M4943,-2308.83C4943,-2308.83 4943,-2283.15 4943,-2283.15"/>
<polygon fill="black" stroke="black" points="4946.5,-2283.15 4943,-2273.15 4939.5,-2283.15 4946.5,-2283.15"/>
</g>
<!-- mha_out_2 -->
<g id="node58" class="node">
<title>mha_out_2</title>
<polygon fill="lightblue" stroke="black" points="5151.5,-2173.02 4736.5,-2173.02 4736.5,-2109.02 5151.5,-2109.02 5151.5,-2173.02"/>
<text text-anchor="start" x="4881.5" y="-2158.82" font-family="Arial" font-weight="bold" font-size="14.00">MHA Output Linear</text>
<text text-anchor="start" x="4901.5" y="-2144.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4750" y="-2130.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="start" x="4744.5" y="-2116.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- mha_attn_2&#45;&gt;mha_out_2 -->
<g id="edge91" class="edge">
<title>mha_attn_2&#45;&gt;mha_out_2</title>
<path fill="none" stroke="black" d="M4943.5,-2208.83C4943.5,-2208.83 4943.5,-2183.15 4943.5,-2183.15"/>
<polygon fill="black" stroke="black" points="4947,-2183.15 4943.5,-2173.15 4940,-2183.15 4947,-2183.15"/>
</g>
<!-- mha_out_2&#45;&gt;attn_res_2 -->
<g id="edge92" class="edge">
<title>mha_out_2&#45;&gt;attn_res_2</title>
<path fill="none" stroke="black" d="M4999,-2108.83C4999,-2108.83 4999,-2083.15 4999,-2083.15"/>
<polygon fill="black" stroke="black" points="5002.5,-2083.15 4999,-2073.15 4995.5,-2083.15 5002.5,-2083.15"/>
</g>
<!-- local_gating_2 -->
<g id="node60" class="node">
<title>local_gating_2</title>
<polygon fill="lightgreen" stroke="black" points="4128.7,-1973.02 3462.64,-1973.02 3291.3,-1845.02 3957.36,-1845.02 4128.7,-1973.02"/>
<text text-anchor="start" x="3643" y="-1926.82" font-family="Arial" font-weight="bold" font-size="14.00">Layer 2 Local Gating</text>
<text text-anchor="start" x="3667.5" y="-1912.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="3516" y="-1898.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="start" x="3542.5" y="-1884.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [token assignments → expert destinations]</text>
</g>
<!-- attn_res_2&#45;&gt;local_gating_2 -->
<g id="edge94" class="edge">
<title>attn_res_2&#45;&gt;local_gating_2</title>
<path fill="none" stroke="black" d="M4846.32,-2041C4569.12,-2041 4123.17,-2041 4123.17,-2041 4123.17,-2041 4123.17,-1919.11 4123.17,-1919.11"/>
<polygon fill="black" stroke="black" points="4126.67,-1919.11 4123.17,-1909.11 4119.67,-1919.12 4126.67,-1919.11"/>
</g>
<!-- moe_res_2 -->
<g id="node80" class="node">
<title>moe_res_2</title>
<polygon fill="lightblue" stroke="black" points="4601.5,-1368.51 4170.5,-1368.51 4170.5,-1304.51 4601.5,-1304.51 4601.5,-1368.51"/>
<text text-anchor="start" x="4326.5" y="-1354.31" font-family="Arial" font-weight="bold" font-size="14.00">MoE Residual Add</text>
<text text-anchor="start" x="4343.5" y="-1340.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4178.5" y="-1326.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096] (x2)</text>
<text text-anchor="start" x="4186.5" y="-1312.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- attn_res_2&#45;&gt;moe_res_2 -->
<g id="edge130" class="edge">
<title>attn_res_2&#45;&gt;moe_res_2</title>
<path fill="none" stroke="black" d="M5004,-2008.89C5004,-1870.97 5004,-1336 5004,-1336 5004,-1336 4611.71,-1336 4611.71,-1336"/>
<polygon fill="black" stroke="black" points="4611.71,-1332.5 4601.71,-1336 4611.71,-1339.5 4611.71,-1332.5"/>
</g>
<!-- token_batch_2 -->
<g id="node61" class="node">
<title>token_batch_2</title>
<ellipse fill="lightyellow" stroke="black" cx="3034" cy="-1791.02" rx="68.49" ry="18"/>
<text text-anchor="middle" x="3034" y="-1787.32" font-family="Arial" font-size="14.00">token_batch_2</text>
</g>
<!-- local_gating_2&#45;&gt;token_batch_2 -->
<g id="edge95" class="edge">
<title>local_gating_2&#45;&gt;token_batch_2</title>
<path fill="none" stroke="black" d="M3376.46,-1909C3205.98,-1909 3034,-1909 3034,-1909 3034,-1909 3034,-1819.2 3034,-1819.2"/>
<polygon fill="black" stroke="black" points="3037.5,-1819.2 3034,-1809.2 3030.5,-1819.2 3037.5,-1819.2"/>
</g>
<!-- expert_2_0 -->
<g id="node62" class="node">
<title>expert_2_0</title>
<polygon fill="lightcoral" stroke="black" points="340,-1737.02 0,-1737.02 0,-1631.02 340,-1631.02 340,-1737.02"/>
<text text-anchor="start" x="113" y="-1722.82" font-family="Arial" font-weight="bold" font-size="14.00">Expert 0 (Layer 2)</text>
<text text-anchor="start" x="124.5" y="-1708.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 0</text>
<text text-anchor="start" x="111.5" y="-1694.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 0</text>
<text text-anchor="start" x="31.5" y="-1680.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="8" y="-1666.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="96.5" y="-1652.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="67.5" y="-1638.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_2&#45;&gt;expert_2_0 -->
<g id="edge96" class="edge">
<title>token_batch_2&#45;&gt;expert_2_0</title>
<path fill="none" stroke="black" d="M2990.88,-1805C2635.14,-1805 198.5,-1805 198.5,-1805 198.5,-1805 198.5,-1747.08 198.5,-1747.08"/>
<polygon fill="black" stroke="black" points="202,-1747.08 198.5,-1737.08 195,-1747.08 202,-1747.08"/>
</g>
<!-- expert_2_1 -->
<g id="node63" class="node">
<title>expert_2_1</title>
<polygon fill="lightcoral" stroke="black" points="698,-1737.02 358,-1737.02 358,-1631.02 698,-1631.02 698,-1737.02"/>
<text text-anchor="start" x="471" y="-1722.82" font-family="Arial" font-weight="bold" font-size="14.00">Expert 1 (Layer 2)</text>
<text text-anchor="start" x="482.5" y="-1708.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 1</text>
<text text-anchor="start" x="469.5" y="-1694.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 1</text>
<text text-anchor="start" x="389.5" y="-1680.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="366" y="-1666.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="454.5" y="-1652.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="425.5" y="-1638.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_2&#45;&gt;expert_2_1 -->
<g id="edge98" class="edge">
<title>token_batch_2&#45;&gt;expert_2_1</title>
<path fill="none" stroke="black" d="M2977,-1801C2606.62,-1801 556.5,-1801 556.5,-1801 556.5,-1801 556.5,-1747.03 556.5,-1747.03"/>
<polygon fill="black" stroke="black" points="560,-1747.03 556.5,-1737.03 553,-1747.03 560,-1747.03"/>
</g>
<!-- expert_2_2 -->
<g id="node64" class="node">
<title>expert_2_2</title>
<polygon fill="lightcoral" stroke="black" points="1056,-1737.02 716,-1737.02 716,-1631.02 1056,-1631.02 1056,-1737.02"/>
<text text-anchor="start" x="829" y="-1722.82" font-family="Arial" font-weight="bold" font-size="14.00">Expert 2 (Layer 2)</text>
<text text-anchor="start" x="840.5" y="-1708.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 2</text>
<text text-anchor="start" x="827.5" y="-1694.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 2</text>
<text text-anchor="start" x="747.5" y="-1680.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="724" y="-1666.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="812.5" y="-1652.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="783.5" y="-1638.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_2&#45;&gt;expert_2_2 -->
<g id="edge100" class="edge">
<title>token_batch_2&#45;&gt;expert_2_2</title>
<path fill="none" stroke="black" d="M2969.41,-1797C2614.2,-1797 914.5,-1797 914.5,-1797 914.5,-1797 914.5,-1747.2 914.5,-1747.2"/>
<polygon fill="black" stroke="black" points="918,-1747.2 914.5,-1737.2 911,-1747.2 918,-1747.2"/>
</g>
<!-- expert_2_3 -->
<g id="node65" class="node">
<title>expert_2_3</title>
<polygon fill="lightcoral" stroke="black" points="1414,-1737.02 1074,-1737.02 1074,-1631.02 1414,-1631.02 1414,-1737.02"/>
<text text-anchor="start" x="1187" y="-1722.82" font-family="Arial" font-weight="bold" font-size="14.00">Expert 3 (Layer 2)</text>
<text text-anchor="start" x="1198.5" y="-1708.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 3</text>
<text text-anchor="start" x="1185.5" y="-1694.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 3</text>
<text text-anchor="start" x="1105.5" y="-1680.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="1082" y="-1666.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="1170.5" y="-1652.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="1141.5" y="-1638.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_2&#45;&gt;expert_2_3 -->
<g id="edge102" class="edge">
<title>token_batch_2&#45;&gt;expert_2_3</title>
<path fill="none" stroke="black" d="M2966.03,-1793C2642.3,-1793 1272.5,-1793 1272.5,-1793 1272.5,-1793 1272.5,-1747.23 1272.5,-1747.23"/>
<polygon fill="black" stroke="black" points="1276,-1747.23 1272.5,-1737.23 1269,-1747.23 1276,-1747.23"/>
</g>
<!-- expert_2_4 -->
<g id="node66" class="node">
<title>expert_2_4</title>
<polygon fill="lightcoral" stroke="black" points="1772,-1737.02 1432,-1737.02 1432,-1631.02 1772,-1631.02 1772,-1737.02"/>
<text text-anchor="start" x="1545" y="-1722.82" font-family="Arial" font-weight="bold" font-size="14.00">Expert 4 (Layer 2)</text>
<text text-anchor="start" x="1556.5" y="-1708.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 4</text>
<text text-anchor="start" x="1543.5" y="-1694.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 4</text>
<text text-anchor="start" x="1463.5" y="-1680.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="1440" y="-1666.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="1528.5" y="-1652.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="1499.5" y="-1638.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_2&#45;&gt;expert_2_4 -->
<g id="edge104" class="edge">
<title>token_batch_2&#45;&gt;expert_2_4</title>
<path fill="none" stroke="black" d="M2965.83,-1789C2684.76,-1789 1630.5,-1789 1630.5,-1789 1630.5,-1789 1630.5,-1747.12 1630.5,-1747.12"/>
<polygon fill="black" stroke="black" points="1634,-1747.12 1630.5,-1737.12 1627,-1747.12 1634,-1747.12"/>
</g>
<!-- expert_2_5 -->
<g id="node67" class="node">
<title>expert_2_5</title>
<polygon fill="lightcoral" stroke="black" points="2130,-1737.02 1790,-1737.02 1790,-1631.02 2130,-1631.02 2130,-1737.02"/>
<text text-anchor="start" x="1903" y="-1722.82" font-family="Arial" font-weight="bold" font-size="14.00">Expert 5 (Layer 2)</text>
<text text-anchor="start" x="1914.5" y="-1708.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 5</text>
<text text-anchor="start" x="1901.5" y="-1694.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 5</text>
<text text-anchor="start" x="1821.5" y="-1680.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="1798" y="-1666.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="1886.5" y="-1652.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="1857.5" y="-1638.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_2&#45;&gt;expert_2_5 -->
<g id="edge106" class="edge">
<title>token_batch_2&#45;&gt;expert_2_5</title>
<path fill="none" stroke="black" d="M2969.39,-1785C2741.45,-1785 1988.5,-1785 1988.5,-1785 1988.5,-1785 1988.5,-1747.17 1988.5,-1747.17"/>
<polygon fill="black" stroke="black" points="1992,-1747.17 1988.5,-1737.17 1985,-1747.17 1992,-1747.17"/>
</g>
<!-- expert_2_6 -->
<g id="node68" class="node">
<title>expert_2_6</title>
<polygon fill="lightcoral" stroke="black" points="2488,-1737.02 2148,-1737.02 2148,-1631.02 2488,-1631.02 2488,-1737.02"/>
<text text-anchor="start" x="2261" y="-1722.82" font-family="Arial" font-weight="bold" font-size="14.00">Expert 6 (Layer 2)</text>
<text text-anchor="start" x="2272.5" y="-1708.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 6</text>
<text text-anchor="start" x="2259.5" y="-1694.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 6</text>
<text text-anchor="start" x="2179.5" y="-1680.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="2156" y="-1666.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="2244.5" y="-1652.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="2215.5" y="-1638.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_2&#45;&gt;expert_2_6 -->
<g id="edge108" class="edge">
<title>token_batch_2&#45;&gt;expert_2_6</title>
<path fill="none" stroke="black" d="M2977.15,-1781C2812.44,-1781 2346.5,-1781 2346.5,-1781 2346.5,-1781 2346.5,-1747.05 2346.5,-1747.05"/>
<polygon fill="black" stroke="black" points="2350,-1747.05 2346.5,-1737.05 2343,-1747.05 2350,-1747.05"/>
</g>
<!-- expert_2_7 -->
<g id="node69" class="node">
<title>expert_2_7</title>
<polygon fill="lightcoral" stroke="black" points="2846,-1737.02 2506,-1737.02 2506,-1631.02 2846,-1631.02 2846,-1737.02"/>
<text text-anchor="start" x="2619" y="-1722.82" font-family="Arial" font-weight="bold" font-size="14.00">Expert 7 (Layer 2)</text>
<text text-anchor="start" x="2630.5" y="-1708.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 7</text>
<text text-anchor="start" x="2617.5" y="-1694.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 7</text>
<text text-anchor="start" x="2537.5" y="-1680.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="2514" y="-1666.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="2602.5" y="-1652.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="2573.5" y="-1638.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_2&#45;&gt;expert_2_7 -->
<g id="edge110" class="edge">
<title>token_batch_2&#45;&gt;expert_2_7</title>
<path fill="none" stroke="black" d="M2991.18,-1777C2919.56,-1777 2783.24,-1777 2783.24,-1777 2783.24,-1777 2783.24,-1747.03 2783.24,-1747.03"/>
<polygon fill="black" stroke="black" points="2786.74,-1747.03 2783.24,-1737.03 2779.74,-1747.03 2786.74,-1747.03"/>
</g>
<!-- expert_2_8 -->
<g id="node70" class="node">
<title>expert_2_8</title>
<polygon fill="lightcoral" stroke="black" points="3204,-1737.02 2864,-1737.02 2864,-1631.02 3204,-1631.02 3204,-1737.02"/>
<text text-anchor="start" x="2977" y="-1722.82" font-family="Arial" font-weight="bold" font-size="14.00">Expert 8 (Layer 2)</text>
<text text-anchor="start" x="2988.5" y="-1708.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 8</text>
<text text-anchor="start" x="2975.5" y="-1694.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 8</text>
<text text-anchor="start" x="2895.5" y="-1680.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="2872" y="-1666.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="2960.5" y="-1652.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="2931.5" y="-1638.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_2&#45;&gt;expert_2_8 -->
<g id="edge112" class="edge">
<title>token_batch_2&#45;&gt;expert_2_8</title>
<path fill="none" stroke="black" d="M3034,-1772.87C3034,-1772.87 3034,-1747.35 3034,-1747.35"/>
<polygon fill="black" stroke="black" points="3037.5,-1747.35 3034,-1737.35 3030.5,-1747.35 3037.5,-1747.35"/>
</g>
<!-- expert_2_9 -->
<g id="node71" class="node">
<title>expert_2_9</title>
<polygon fill="lightcoral" stroke="black" points="3562,-1737.02 3222,-1737.02 3222,-1631.02 3562,-1631.02 3562,-1737.02"/>
<text text-anchor="start" x="3335" y="-1722.82" font-family="Arial" font-weight="bold" font-size="14.00">Expert 9 (Layer 2)</text>
<text text-anchor="start" x="3346.5" y="-1708.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 9</text>
<text text-anchor="start" x="3333.5" y="-1694.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 9</text>
<text text-anchor="start" x="3253.5" y="-1680.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="3230" y="-1666.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="3318.5" y="-1652.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="3289.5" y="-1638.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_2&#45;&gt;expert_2_9 -->
<g id="edge114" class="edge">
<title>token_batch_2&#45;&gt;expert_2_9</title>
<path fill="none" stroke="black" d="M3076.91,-1777C3141.59,-1777 3256.58,-1777 3256.58,-1777 3256.58,-1777 3256.58,-1747.03 3256.58,-1747.03"/>
<polygon fill="black" stroke="black" points="3260.08,-1747.03 3256.58,-1737.03 3253.08,-1747.03 3260.08,-1747.03"/>
</g>
<!-- expert_2_10 -->
<g id="node72" class="node">
<title>expert_2_10</title>
<polygon fill="lightcoral" stroke="black" points="3920,-1737.02 3580,-1737.02 3580,-1631.02 3920,-1631.02 3920,-1737.02"/>
<text text-anchor="start" x="3689.5" y="-1722.82" font-family="Arial" font-weight="bold" font-size="14.00">Expert 10 (Layer 2)</text>
<text text-anchor="start" x="3701" y="-1708.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 10</text>
<text text-anchor="start" x="3688" y="-1694.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 10</text>
<text text-anchor="start" x="3611.5" y="-1680.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="3588" y="-1666.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="3676.5" y="-1652.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="3647.5" y="-1638.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_2&#45;&gt;expert_2_10 -->
<g id="edge116" class="edge">
<title>token_batch_2&#45;&gt;expert_2_10</title>
<path fill="none" stroke="black" d="M3093.2,-1782C3264.75,-1782 3750,-1782 3750,-1782 3750,-1782 3750,-1747.02 3750,-1747.02"/>
<polygon fill="black" stroke="black" points="3753.5,-1747.02 3750,-1737.02 3746.5,-1747.02 3753.5,-1747.02"/>
</g>
<!-- expert_2_11 -->
<g id="node73" class="node">
<title>expert_2_11</title>
<polygon fill="lightcoral" stroke="black" points="4278,-1737.02 3938,-1737.02 3938,-1631.02 4278,-1631.02 4278,-1737.02"/>
<text text-anchor="start" x="4047.5" y="-1722.82" font-family="Arial" font-weight="bold" font-size="14.00">Expert 11 (Layer 2)</text>
<text text-anchor="start" x="4059" y="-1708.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 11</text>
<text text-anchor="start" x="4046" y="-1694.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 11</text>
<text text-anchor="start" x="3969.5" y="-1680.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="3946" y="-1666.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="4034.5" y="-1652.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="4005.5" y="-1638.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_2&#45;&gt;expert_2_11 -->
<g id="edge118" class="edge">
<title>token_batch_2&#45;&gt;expert_2_11</title>
<path fill="none" stroke="black" d="M3099.58,-1786C3321.92,-1786 4033.42,-1786 4033.42,-1786 4033.42,-1786 4033.42,-1747.1 4033.42,-1747.1"/>
<polygon fill="black" stroke="black" points="4036.92,-1747.1 4033.42,-1737.1 4029.92,-1747.1 4036.92,-1747.1"/>
</g>
<!-- expert_2_12 -->
<g id="node74" class="node">
<title>expert_2_12</title>
<polygon fill="lightcoral" stroke="black" points="4636,-1737.02 4296,-1737.02 4296,-1631.02 4636,-1631.02 4636,-1737.02"/>
<text text-anchor="start" x="4405.5" y="-1722.82" font-family="Arial" font-weight="bold" font-size="14.00">Expert 12 (Layer 2)</text>
<text text-anchor="start" x="4417" y="-1708.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 12</text>
<text text-anchor="start" x="4404" y="-1694.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 12</text>
<text text-anchor="start" x="4327.5" y="-1680.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="4304" y="-1666.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="4392.5" y="-1652.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="4363.5" y="-1638.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_2&#45;&gt;expert_2_12 -->
<g id="edge120" class="edge">
<title>token_batch_2&#45;&gt;expert_2_12</title>
<path fill="none" stroke="black" d="M3102.45,-1791C3380.95,-1791 4414.25,-1791 4414.25,-1791 4414.25,-1791 4414.25,-1747.2 4414.25,-1747.2"/>
<polygon fill="black" stroke="black" points="4417.75,-1747.2 4414.25,-1737.2 4410.75,-1747.2 4417.75,-1747.2"/>
</g>
<!-- expert_2_13 -->
<g id="node75" class="node">
<title>expert_2_13</title>
<polygon fill="lightcoral" stroke="black" points="4994,-1737.02 4654,-1737.02 4654,-1631.02 4994,-1631.02 4994,-1737.02"/>
<text text-anchor="start" x="4763.5" y="-1722.82" font-family="Arial" font-weight="bold" font-size="14.00">Expert 13 (Layer 2)</text>
<text text-anchor="start" x="4775" y="-1708.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 13</text>
<text text-anchor="start" x="4762" y="-1694.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 13</text>
<text text-anchor="start" x="4685.5" y="-1680.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="4662" y="-1666.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="4750.5" y="-1652.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="4721.5" y="-1638.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_2&#45;&gt;expert_2_13 -->
<g id="edge122" class="edge">
<title>token_batch_2&#45;&gt;expert_2_13</title>
<path fill="none" stroke="black" d="M3100.56,-1795C3407.73,-1795 4673.5,-1795 4673.5,-1795 4673.5,-1795 4673.5,-1747.23 4673.5,-1747.23"/>
<polygon fill="black" stroke="black" points="4677,-1747.23 4673.5,-1737.23 4670,-1747.23 4677,-1747.23"/>
</g>
<!-- expert_2_14 -->
<g id="node76" class="node">
<title>expert_2_14</title>
<polygon fill="lightcoral" stroke="black" points="5352,-1737.02 5012,-1737.02 5012,-1631.02 5352,-1631.02 5352,-1737.02"/>
<text text-anchor="start" x="5121.5" y="-1722.82" font-family="Arial" font-weight="bold" font-size="14.00">Expert 14 (Layer 2)</text>
<text text-anchor="start" x="5133" y="-1708.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 14</text>
<text text-anchor="start" x="5120" y="-1694.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 14</text>
<text text-anchor="start" x="5043.5" y="-1680.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="5020" y="-1666.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="5108.5" y="-1652.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="5079.5" y="-1638.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_2&#45;&gt;expert_2_14 -->
<g id="edge124" class="edge">
<title>token_batch_2&#45;&gt;expert_2_14</title>
<path fill="none" stroke="black" d="M3093.21,-1800C3435.41,-1800 5144.75,-1800 5144.75,-1800 5144.75,-1800 5144.75,-1747.26 5144.75,-1747.26"/>
<polygon fill="black" stroke="black" points="5148.25,-1747.26 5144.75,-1737.26 5141.25,-1747.26 5148.25,-1747.26"/>
</g>
<!-- expert_2_15 -->
<g id="node77" class="node">
<title>expert_2_15</title>
<polygon fill="lightcoral" stroke="black" points="5710,-1737.02 5370,-1737.02 5370,-1631.02 5710,-1631.02 5710,-1737.02"/>
<text text-anchor="start" x="5479.5" y="-1722.82" font-family="Arial" font-weight="bold" font-size="14.00">Expert 15 (Layer 2)</text>
<text text-anchor="start" x="5491" y="-1708.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 15</text>
<text text-anchor="start" x="5478" y="-1694.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 15</text>
<text text-anchor="start" x="5401.5" y="-1680.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="5378" y="-1666.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="5466.5" y="-1652.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="5437.5" y="-1638.82" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_2&#45;&gt;expert_2_15 -->
<g id="edge126" class="edge">
<title>token_batch_2&#45;&gt;expert_2_15</title>
<path fill="none" stroke="black" d="M3081.32,-1804C3414.09,-1804 5389.5,-1804 5389.5,-1804 5389.5,-1804 5389.5,-1747.34 5389.5,-1747.34"/>
<polygon fill="black" stroke="black" points="5393,-1747.34 5389.5,-1737.34 5386,-1747.34 5393,-1747.34"/>
</g>
<!-- expert_results_2 -->
<g id="node78" class="node">
<title>expert_results_2</title>
<ellipse fill="lightyellow" stroke="black" cx="3034" cy="-1549.76" rx="370.55" ry="45.01"/>
<text text-anchor="start" x="2952" y="-1567.56" font-family="Arial" font-weight="bold" font-size="14.00">Expert Results Collection</text>
<text text-anchor="start" x="2991.5" y="-1553.56" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="2894" y="-1539.56" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [processed tokens from 16 experts]</text>
<text text-anchor="start" x="2780" y="-1525.56" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [reordered tokens, batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- expert_2_0&#45;&gt;expert_results_2 -->
<g id="edge97" class="edge">
<title>expert_2_0&#45;&gt;expert_results_2</title>
<path fill="none" stroke="black" d="M114.67,-1631C114.67,-1581.44 114.67,-1515 114.67,-1515 114.67,-1515 2786.65,-1515 2786.65,-1515"/>
<polygon fill="black" stroke="black" points="2786.65,-1518.5 2796.65,-1515 2786.65,-1511.5 2786.65,-1518.5"/>
</g>
<!-- expert_2_1&#45;&gt;expert_results_2 -->
<g id="edge99" class="edge">
<title>expert_2_1&#45;&gt;expert_results_2</title>
<path fill="none" stroke="black" d="M472.67,-1630.86C472.67,-1585.31 472.67,-1527 472.67,-1527 472.67,-1527 2703.49,-1527 2703.49,-1527"/>
<polygon fill="black" stroke="black" points="2703.49,-1530.5 2713.49,-1527 2703.49,-1523.5 2703.49,-1530.5"/>
</g>
<!-- expert_2_2&#45;&gt;expert_results_2 -->
<g id="edge101" class="edge">
<title>expert_2_2&#45;&gt;expert_results_2</title>
<path fill="none" stroke="black" d="M830.67,-1630.89C830.67,-1589.14 830.67,-1538 830.67,-1538 830.67,-1538 2666.01,-1538 2666.01,-1538"/>
<polygon fill="black" stroke="black" points="2666.01,-1541.5 2676.01,-1538 2666.01,-1534.5 2666.01,-1541.5"/>
</g>
<!-- expert_2_3&#45;&gt;expert_results_2 -->
<g id="edge103" class="edge">
<title>expert_2_3&#45;&gt;expert_results_2</title>
<path fill="none" stroke="black" d="M1188.67,-1630.66C1188.67,-1592.92 1188.67,-1549 1188.67,-1549 1188.67,-1549 2653.34,-1549 2653.34,-1549"/>
<polygon fill="black" stroke="black" points="2653.34,-1552.5 2663.34,-1549 2653.34,-1545.5 2653.34,-1552.5"/>
</g>
<!-- expert_2_4&#45;&gt;expert_results_2 -->
<g id="edge105" class="edge">
<title>expert_2_4&#45;&gt;expert_results_2</title>
<path fill="none" stroke="black" d="M1546.67,-1630.78C1546.67,-1597.53 1546.67,-1561 1546.67,-1561 1546.67,-1561 2664.91,-1561 2664.91,-1561"/>
<polygon fill="black" stroke="black" points="2664.91,-1564.5 2674.91,-1561 2664.91,-1557.5 2664.91,-1564.5"/>
</g>
<!-- expert_2_5&#45;&gt;expert_results_2 -->
<g id="edge107" class="edge">
<title>expert_2_5&#45;&gt;expert_results_2</title>
<path fill="none" stroke="black" d="M1904.67,-1630.96C1904.67,-1602.01 1904.67,-1572 1904.67,-1572 1904.67,-1572 2701.13,-1572 2701.13,-1572"/>
<polygon fill="black" stroke="black" points="2701.13,-1575.5 2711.13,-1572 2701.13,-1568.5 2701.13,-1575.5"/>
</g>
<!-- expert_2_6&#45;&gt;expert_results_2 -->
<g id="edge109" class="edge">
<title>expert_2_6&#45;&gt;expert_results_2</title>
<path fill="none" stroke="black" d="M2262.67,-1630.85C2262.67,-1606.51 2262.67,-1583 2262.67,-1583 2262.67,-1583 2772.5,-1583 2772.5,-1583"/>
<polygon fill="black" stroke="black" points="2772.5,-1586.5 2782.5,-1583 2772.5,-1579.5 2772.5,-1586.5"/>
</g>
<!-- expert_2_7&#45;&gt;expert_results_2 -->
<g id="edge111" class="edge">
<title>expert_2_7&#45;&gt;expert_results_2</title>
<path fill="none" stroke="black" d="M2754.74,-1630.96C2754.74,-1630.96 2754.74,-1589.65 2754.74,-1589.65"/>
<polygon fill="black" stroke="black" points="2758.24,-1589.65 2754.74,-1579.65 2751.24,-1589.65 2758.24,-1589.65"/>
</g>
<!-- expert_2_8&#45;&gt;expert_results_2 -->
<g id="edge113" class="edge">
<title>expert_2_8&#45;&gt;expert_results_2</title>
<path fill="none" stroke="black" d="M3034,-1630.96C3034,-1630.96 3034,-1605.07 3034,-1605.07"/>
<polygon fill="black" stroke="black" points="3037.5,-1605.07 3034,-1595.07 3030.5,-1605.07 3037.5,-1605.07"/>
</g>
<!-- expert_2_9&#45;&gt;expert_results_2 -->
<g id="edge115" class="edge">
<title>expert_2_9&#45;&gt;expert_results_2</title>
<path fill="none" stroke="black" d="M3313.26,-1630.96C3313.26,-1630.96 3313.26,-1589.65 3313.26,-1589.65"/>
<polygon fill="black" stroke="black" points="3316.76,-1589.65 3313.26,-1579.65 3309.76,-1589.65 3316.76,-1589.65"/>
</g>
<!-- expert_2_10&#45;&gt;expert_results_2 -->
<g id="edge117" class="edge">
<title>expert_2_10&#45;&gt;expert_results_2</title>
<path fill="none" stroke="black" d="M3636.72,-1630.92C3636.72,-1606.13 3636.72,-1582 3636.72,-1582 3636.72,-1582 3304.42,-1582 3304.42,-1582"/>
<polygon fill="black" stroke="black" points="3304.42,-1578.5 3294.42,-1582 3304.42,-1585.5 3304.42,-1578.5"/>
</g>
<!-- expert_2_11&#45;&gt;expert_results_2 -->
<g id="edge119" class="edge">
<title>expert_2_11&#45;&gt;expert_results_2</title>
<path fill="none" stroke="black" d="M3995.5,-1630.89C3995.5,-1600.75 3995.5,-1569 3995.5,-1569 3995.5,-1569 3379.61,-1569 3379.61,-1569"/>
<polygon fill="black" stroke="black" points="3379.61,-1565.5 3369.61,-1569 3379.61,-1572.5 3379.61,-1565.5"/>
</g>
<!-- expert_2_12&#45;&gt;expert_results_2 -->
<g id="edge121" class="edge">
<title>expert_2_12&#45;&gt;expert_results_2</title>
<path fill="none" stroke="black" d="M4386.25,-1630.84C4386.25,-1595.67 4386.25,-1556 4386.25,-1556 4386.25,-1556 3411.28,-1556 3411.28,-1556"/>
<polygon fill="black" stroke="black" points="3411.28,-1552.5 3401.28,-1556 3411.28,-1559.5 3411.28,-1552.5"/>
</g>
<!-- expert_2_13&#45;&gt;expert_results_2 -->
<g id="edge123" class="edge">
<title>expert_2_13&#45;&gt;expert_results_2</title>
<path fill="none" stroke="black" d="M4768.67,-1630.71C4768.67,-1590.77 4768.67,-1543 4768.67,-1543 4768.67,-1543 3410.55,-1543 3410.55,-1543"/>
<polygon fill="black" stroke="black" points="3410.55,-1539.5 3400.55,-1543 3410.55,-1546.5 3410.55,-1539.5"/>
</g>
<!-- expert_2_14&#45;&gt;expert_results_2 -->
<g id="edge125" class="edge">
<title>expert_2_14&#45;&gt;expert_results_2</title>
<path fill="none" stroke="black" d="M5126.67,-1631.01C5126.67,-1586.46 5126.67,-1530 5126.67,-1530 5126.67,-1530 3377.32,-1530 3377.32,-1530"/>
<polygon fill="black" stroke="black" points="3377.32,-1526.5 3367.32,-1530 3377.32,-1533.5 3377.32,-1526.5"/>
</g>
<!-- expert_2_15&#45;&gt;expert_results_2 -->
<g id="edge127" class="edge">
<title>expert_2_15&#45;&gt;expert_results_2</title>
<path fill="none" stroke="black" d="M5484.67,-1630.71C5484.67,-1581.83 5484.67,-1517 5484.67,-1517 5484.67,-1517 3299.62,-1517 3299.62,-1517"/>
<polygon fill="black" stroke="black" points="3299.62,-1513.5 3289.62,-1517 3299.62,-1520.5 3299.62,-1513.5"/>
</g>
<!-- moe_combine_2 -->
<g id="node79" class="node">
<title>moe_combine_2</title>
<polygon fill="lightblue" stroke="black" points="4476.5,-1468.51 4061.5,-1468.51 4061.5,-1404.51 4476.5,-1404.51 4476.5,-1468.51"/>
<text text-anchor="start" x="4198.5" y="-1454.31" font-family="Arial" font-weight="bold" font-size="14.00">MoE Output Combine</text>
<text text-anchor="start" x="4226.5" y="-1440.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4141.5" y="-1426.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [expert outputs, gating weights]</text>
<text text-anchor="start" x="4069.5" y="-1412.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- expert_results_2&#45;&gt;moe_combine_2 -->
<g id="edge128" class="edge">
<title>expert_results_2&#45;&gt;moe_combine_2</title>
<path fill="none" stroke="black" d="M3284.17,-1516.25C3284.17,-1482.69 3284.17,-1436 3284.17,-1436 3284.17,-1436 4051.35,-1436 4051.35,-1436"/>
<polygon fill="black" stroke="black" points="4051.35,-1439.5 4061.35,-1436 4051.35,-1432.5 4051.35,-1439.5"/>
</g>
<!-- moe_combine_2&#45;&gt;moe_res_2 -->
<g id="edge129" class="edge">
<title>moe_combine_2&#45;&gt;moe_res_2</title>
<path fill="none" stroke="black" d="M4323.5,-1404.32C4323.5,-1404.32 4323.5,-1378.64 4323.5,-1378.64"/>
<polygon fill="black" stroke="black" points="4327,-1378.64 4323.5,-1368.64 4320,-1378.64 4327,-1378.64"/>
</g>
<!-- layernorm_3 -->
<g id="node81" class="node">
<title>layernorm_3</title>
<polygon fill="lightblue" stroke="black" points="4593.5,-1268.51 4178.5,-1268.51 4178.5,-1204.51 4593.5,-1204.51 4593.5,-1268.51"/>
<text text-anchor="start" x="4319.5" y="-1254.31" font-family="Arial" font-weight="bold" font-size="14.00">LayerNorm (Layer 3)</text>
<text text-anchor="start" x="4343.5" y="-1240.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4192" y="-1226.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="start" x="4186.5" y="-1212.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- moe_res_2&#45;&gt;layernorm_3 -->
<g id="edge131" class="edge">
<title>moe_res_2&#45;&gt;layernorm_3</title>
<path fill="none" stroke="black" d="M4386,-1304.32C4386,-1304.32 4386,-1278.64 4386,-1278.64"/>
<polygon fill="black" stroke="black" points="4389.5,-1278.64 4386,-1268.64 4382.5,-1278.64 4389.5,-1278.64"/>
</g>
<!-- mha_qkv_3 -->
<g id="node82" class="node">
<title>mha_qkv_3</title>
<polygon fill="lightblue" stroke="black" points="4479,-1168.51 4053,-1168.51 4053,-1104.51 4479,-1104.51 4479,-1168.51"/>
<text text-anchor="start" x="4211" y="-1154.31" font-family="Arial" font-weight="bold" font-size="14.00">MHA QKV Linear</text>
<text text-anchor="start" x="4223.5" y="-1140.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4072" y="-1126.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="start" x="4061" y="-1112.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, heads=32, d_k=128]</text>
</g>
<!-- layernorm_3&#45;&gt;mha_qkv_3 -->
<g id="edge132" class="edge">
<title>layernorm_3&#45;&gt;mha_qkv_3</title>
<path fill="none" stroke="black" d="M4328.75,-1204.32C4328.75,-1204.32 4328.75,-1178.64 4328.75,-1178.64"/>
<polygon fill="black" stroke="black" points="4332.25,-1178.64 4328.75,-1168.64 4325.25,-1178.64 4332.25,-1178.64"/>
</g>
<!-- attn_res_3 -->
<g id="node85" class="node">
<title>attn_res_3</title>
<polygon fill="lightblue" stroke="black" points="4603.5,-868.51 4172.5,-868.51 4172.5,-804.51 4603.5,-804.51 4603.5,-868.51"/>
<text text-anchor="start" x="4313.5" y="-854.31" font-family="Arial" font-weight="bold" font-size="14.00">Attention Residual Add</text>
<text text-anchor="start" x="4345.5" y="-840.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4180.5" y="-826.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096] (x2)</text>
<text text-anchor="start" x="4188.5" y="-812.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- layernorm_3&#45;&gt;attn_res_3 -->
<g id="edge136" class="edge">
<title>layernorm_3&#45;&gt;attn_res_3</title>
<path fill="none" stroke="black" d="M4536.25,-1204.45C4536.25,-1204.45 4536.25,-878.72 4536.25,-878.72"/>
<polygon fill="black" stroke="black" points="4539.75,-878.72 4536.25,-868.72 4532.75,-878.72 4539.75,-878.72"/>
</g>
<!-- mha_attn_3 -->
<g id="node83" class="node">
<title>mha_attn_3</title>
<polygon fill="lightblue" stroke="black" points="4475.5,-1068.51 4060.5,-1068.51 4060.5,-1004.51 4475.5,-1004.51 4475.5,-1068.51"/>
<text text-anchor="start" x="4221" y="-1054.31" font-family="Arial" font-weight="bold" font-size="14.00">MHA Attention</text>
<text text-anchor="start" x="4225.5" y="-1040.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4068.5" y="-1026.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, heads=32, d_k=128]</text>
<text text-anchor="start" x="4068.5" y="-1012.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- mha_qkv_3&#45;&gt;mha_attn_3 -->
<g id="edge133" class="edge">
<title>mha_qkv_3&#45;&gt;mha_attn_3</title>
<path fill="none" stroke="black" d="M4268,-1104.32C4268,-1104.32 4268,-1078.64 4268,-1078.64"/>
<polygon fill="black" stroke="black" points="4271.5,-1078.64 4268,-1068.64 4264.5,-1078.64 4271.5,-1078.64"/>
</g>
<!-- mha_out_3 -->
<g id="node84" class="node">
<title>mha_out_3</title>
<polygon fill="lightblue" stroke="black" points="4478.5,-968.51 4063.5,-968.51 4063.5,-904.51 4478.5,-904.51 4478.5,-968.51"/>
<text text-anchor="start" x="4208.5" y="-954.31" font-family="Arial" font-weight="bold" font-size="14.00">MHA Output Linear</text>
<text text-anchor="start" x="4228.5" y="-940.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4077" y="-926.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="start" x="4071.5" y="-912.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- mha_attn_3&#45;&gt;mha_out_3 -->
<g id="edge134" class="edge">
<title>mha_attn_3&#45;&gt;mha_out_3</title>
<path fill="none" stroke="black" d="M4269.5,-1004.32C4269.5,-1004.32 4269.5,-978.64 4269.5,-978.64"/>
<polygon fill="black" stroke="black" points="4273,-978.64 4269.5,-968.64 4266,-978.64 4273,-978.64"/>
</g>
<!-- mha_out_3&#45;&gt;attn_res_3 -->
<g id="edge135" class="edge">
<title>mha_out_3&#45;&gt;attn_res_3</title>
<path fill="none" stroke="black" d="M4325.5,-904.32C4325.5,-904.32 4325.5,-878.64 4325.5,-878.64"/>
<polygon fill="black" stroke="black" points="4329,-878.64 4325.5,-868.64 4322,-878.64 4329,-878.64"/>
</g>
<!-- local_gating_3 -->
<g id="node86" class="node">
<title>local_gating_3</title>
<polygon fill="lightgreen" stroke="black" points="4583.7,-768.51 3917.64,-768.51 3746.3,-640.51 4412.36,-640.51 4583.7,-768.51"/>
<text text-anchor="start" x="4098" y="-722.31" font-family="Arial" font-weight="bold" font-size="14.00">Layer 3 Local Gating</text>
<text text-anchor="start" x="4122.5" y="-708.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="3971" y="-694.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
<text text-anchor="start" x="3997.5" y="-680.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [token assignments → expert destinations]</text>
</g>
<!-- attn_res_3&#45;&gt;local_gating_3 -->
<g id="edge137" class="edge">
<title>attn_res_3&#45;&gt;local_gating_3</title>
<path fill="none" stroke="black" d="M4378.17,-804.22C4378.17,-804.22 4378.17,-778.75 4378.17,-778.75"/>
<polygon fill="black" stroke="black" points="4381.67,-778.75 4378.17,-768.75 4374.67,-778.75 4381.67,-778.75"/>
</g>
<!-- moe_res_3 -->
<g id="node106" class="node">
<title>moe_res_3</title>
<polygon fill="lightblue" stroke="black" points="4603.5,-164 4172.5,-164 4172.5,-100 4603.5,-100 4603.5,-164"/>
<text text-anchor="start" x="4328.5" y="-149.8" font-family="Arial" font-weight="bold" font-size="14.00">MoE Residual Add</text>
<text text-anchor="start" x="4345.5" y="-135.8" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4180.5" y="-121.8" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [batch_size=128, seq_len=10000, hidden_dim=4096] (x2)</text>
<text text-anchor="start" x="4188.5" y="-107.8" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- attn_res_3&#45;&gt;moe_res_3 -->
<g id="edge173" class="edge">
<title>attn_res_3&#45;&gt;moe_res_3</title>
<path fill="none" stroke="black" d="M4603.69,-836C4628.98,-836 4646,-836 4646,-836 4646,-836 4646,-132 4646,-132 4646,-132 4613.69,-132 4613.69,-132"/>
<polygon fill="black" stroke="black" points="4613.69,-128.5 4603.69,-132 4613.69,-135.5 4613.69,-128.5"/>
</g>
<!-- token_batch_3 -->
<g id="node87" class="node">
<title>token_batch_3</title>
<ellipse fill="lightyellow" stroke="black" cx="3036" cy="-586.51" rx="68.49" ry="18"/>
<text text-anchor="middle" x="3036" y="-582.81" font-family="Arial" font-size="14.00">token_batch_3</text>
</g>
<!-- local_gating_3&#45;&gt;token_batch_3 -->
<g id="edge138" class="edge">
<title>local_gating_3&#45;&gt;token_batch_3</title>
<path fill="none" stroke="black" d="M3834.08,-640.41C3834.08,-618.77 3834.08,-600 3834.08,-600 3834.08,-600 3091.19,-600 3091.19,-600"/>
<polygon fill="black" stroke="black" points="3091.19,-596.5 3081.19,-600 3091.19,-603.5 3091.19,-596.5"/>
</g>
<!-- expert_3_0 -->
<g id="node88" class="node">
<title>expert_3_0</title>
<polygon fill="lightcoral" stroke="black" points="342,-532.51 2,-532.51 2,-426.51 342,-426.51 342,-532.51"/>
<text text-anchor="start" x="115" y="-518.31" font-family="Arial" font-weight="bold" font-size="14.00">Expert 0 (Layer 3)</text>
<text text-anchor="start" x="126.5" y="-504.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 0</text>
<text text-anchor="start" x="113.5" y="-490.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 0</text>
<text text-anchor="start" x="33.5" y="-476.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="10" y="-462.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="98.5" y="-448.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="69.5" y="-434.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_3&#45;&gt;expert_3_0 -->
<g id="edge139" class="edge">
<title>token_batch_3&#45;&gt;expert_3_0</title>
<path fill="none" stroke="black" d="M2990.74,-600C2629.48,-600 227.33,-600 227.33,-600 227.33,-600 227.33,-542.71 227.33,-542.71"/>
<polygon fill="black" stroke="black" points="230.83,-542.71 227.33,-532.71 223.83,-542.71 230.83,-542.71"/>
</g>
<!-- expert_3_1 -->
<g id="node89" class="node">
<title>expert_3_1</title>
<polygon fill="lightcoral" stroke="black" points="700,-532.51 360,-532.51 360,-426.51 700,-426.51 700,-532.51"/>
<text text-anchor="start" x="473" y="-518.31" font-family="Arial" font-weight="bold" font-size="14.00">Expert 1 (Layer 3)</text>
<text text-anchor="start" x="484.5" y="-504.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 1</text>
<text text-anchor="start" x="471.5" y="-490.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 1</text>
<text text-anchor="start" x="391.5" y="-476.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="368" y="-462.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="456.5" y="-448.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="427.5" y="-434.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_3&#45;&gt;expert_3_1 -->
<g id="edge141" class="edge">
<title>token_batch_3&#45;&gt;expert_3_1</title>
<path fill="none" stroke="black" d="M2977.84,-596C2606.72,-596 585.33,-596 585.33,-596 585.33,-596 585.33,-542.64 585.33,-542.64"/>
<polygon fill="black" stroke="black" points="588.83,-542.64 585.33,-532.64 581.83,-542.64 588.83,-542.64"/>
</g>
<!-- expert_3_2 -->
<g id="node90" class="node">
<title>expert_3_2</title>
<polygon fill="lightcoral" stroke="black" points="1058,-532.51 718,-532.51 718,-426.51 1058,-426.51 1058,-532.51"/>
<text text-anchor="start" x="831" y="-518.31" font-family="Arial" font-weight="bold" font-size="14.00">Expert 2 (Layer 3)</text>
<text text-anchor="start" x="842.5" y="-504.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 2</text>
<text text-anchor="start" x="829.5" y="-490.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 2</text>
<text text-anchor="start" x="749.5" y="-476.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="726" y="-462.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="814.5" y="-448.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="785.5" y="-434.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_3&#45;&gt;expert_3_2 -->
<g id="edge143" class="edge">
<title>token_batch_3&#45;&gt;expert_3_2</title>
<path fill="none" stroke="black" d="M2970.79,-592C2616.94,-592 943.33,-592 943.33,-592 943.33,-592 943.33,-542.79 943.33,-542.79"/>
<polygon fill="black" stroke="black" points="946.83,-542.79 943.33,-532.79 939.83,-542.79 946.83,-542.79"/>
</g>
<!-- expert_3_3 -->
<g id="node91" class="node">
<title>expert_3_3</title>
<polygon fill="lightcoral" stroke="black" points="1416,-532.51 1076,-532.51 1076,-426.51 1416,-426.51 1416,-532.51"/>
<text text-anchor="start" x="1189" y="-518.31" font-family="Arial" font-weight="bold" font-size="14.00">Expert 3 (Layer 3)</text>
<text text-anchor="start" x="1200.5" y="-504.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 3</text>
<text text-anchor="start" x="1187.5" y="-490.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 3</text>
<text text-anchor="start" x="1107.5" y="-476.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="1084" y="-462.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="1172.5" y="-448.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="1143.5" y="-434.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_3&#45;&gt;expert_3_3 -->
<g id="edge145" class="edge">
<title>token_batch_3&#45;&gt;expert_3_3</title>
<path fill="none" stroke="black" d="M2967.73,-588C2646.54,-588 1301.33,-588 1301.33,-588 1301.33,-588 1301.33,-542.8 1301.33,-542.8"/>
<polygon fill="black" stroke="black" points="1304.83,-542.8 1301.33,-532.8 1297.83,-542.8 1304.83,-542.8"/>
</g>
<!-- expert_3_4 -->
<g id="node92" class="node">
<title>expert_3_4</title>
<polygon fill="lightcoral" stroke="black" points="1774,-532.51 1434,-532.51 1434,-426.51 1774,-426.51 1774,-532.51"/>
<text text-anchor="start" x="1547" y="-518.31" font-family="Arial" font-weight="bold" font-size="14.00">Expert 4 (Layer 3)</text>
<text text-anchor="start" x="1558.5" y="-504.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 4</text>
<text text-anchor="start" x="1545.5" y="-490.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 4</text>
<text text-anchor="start" x="1465.5" y="-476.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="1442" y="-462.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="1530.5" y="-448.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="1501.5" y="-434.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_3&#45;&gt;expert_3_4 -->
<g id="edge147" class="edge">
<title>token_batch_3&#45;&gt;expert_3_4</title>
<path fill="none" stroke="black" d="M2968.2,-584C2691.11,-584 1659.33,-584 1659.33,-584 1659.33,-584 1659.33,-542.67 1659.33,-542.67"/>
<polygon fill="black" stroke="black" points="1662.83,-542.67 1659.33,-532.67 1655.83,-542.67 1662.83,-542.67"/>
</g>
<!-- expert_3_5 -->
<g id="node93" class="node">
<title>expert_3_5</title>
<polygon fill="lightcoral" stroke="black" points="2132,-532.51 1792,-532.51 1792,-426.51 2132,-426.51 2132,-532.51"/>
<text text-anchor="start" x="1905" y="-518.31" font-family="Arial" font-weight="bold" font-size="14.00">Expert 5 (Layer 3)</text>
<text text-anchor="start" x="1916.5" y="-504.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 5</text>
<text text-anchor="start" x="1903.5" y="-490.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 5</text>
<text text-anchor="start" x="1823.5" y="-476.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="1800" y="-462.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="1888.5" y="-448.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="1859.5" y="-434.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_3&#45;&gt;expert_3_5 -->
<g id="edge149" class="edge">
<title>token_batch_3&#45;&gt;expert_3_5</title>
<path fill="none" stroke="black" d="M2972.28,-580C2749.27,-580 2017.33,-580 2017.33,-580 2017.33,-580 2017.33,-542.7 2017.33,-542.7"/>
<polygon fill="black" stroke="black" points="2020.83,-542.7 2017.33,-532.7 2013.83,-542.7 2020.83,-542.7"/>
</g>
<!-- expert_3_6 -->
<g id="node94" class="node">
<title>expert_3_6</title>
<polygon fill="lightcoral" stroke="black" points="2490,-532.51 2150,-532.51 2150,-426.51 2490,-426.51 2490,-532.51"/>
<text text-anchor="start" x="2263" y="-518.31" font-family="Arial" font-weight="bold" font-size="14.00">Expert 6 (Layer 3)</text>
<text text-anchor="start" x="2274.5" y="-504.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 6</text>
<text text-anchor="start" x="2261.5" y="-490.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 6</text>
<text text-anchor="start" x="2181.5" y="-476.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="2158" y="-462.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="2246.5" y="-448.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="2217.5" y="-434.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_3&#45;&gt;expert_3_6 -->
<g id="edge151" class="edge">
<title>token_batch_3&#45;&gt;expert_3_6</title>
<path fill="none" stroke="black" d="M2980.53,-576C2821.49,-576 2375.33,-576 2375.33,-576 2375.33,-576 2375.33,-542.55 2375.33,-542.55"/>
<polygon fill="black" stroke="black" points="2378.83,-542.55 2375.33,-532.55 2371.83,-542.55 2378.83,-542.55"/>
</g>
<!-- expert_3_7 -->
<g id="node95" class="node">
<title>expert_3_7</title>
<polygon fill="lightcoral" stroke="black" points="2848,-532.51 2508,-532.51 2508,-426.51 2848,-426.51 2848,-532.51"/>
<text text-anchor="start" x="2621" y="-518.31" font-family="Arial" font-weight="bold" font-size="14.00">Expert 7 (Layer 3)</text>
<text text-anchor="start" x="2632.5" y="-504.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 7</text>
<text text-anchor="start" x="2619.5" y="-490.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 7</text>
<text text-anchor="start" x="2539.5" y="-476.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="2516" y="-462.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="2604.5" y="-448.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="2575.5" y="-434.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_3&#45;&gt;expert_3_7 -->
<g id="edge153" class="edge">
<title>token_batch_3&#45;&gt;expert_3_7</title>
<path fill="none" stroke="black" d="M2995.55,-572C2917.93,-572 2755.74,-572 2755.74,-572 2755.74,-572 2755.74,-542.78 2755.74,-542.78"/>
<polygon fill="black" stroke="black" points="2759.24,-542.78 2755.74,-532.78 2752.24,-542.78 2759.24,-542.78"/>
</g>
<!-- expert_3_8 -->
<g id="node96" class="node">
<title>expert_3_8</title>
<polygon fill="lightcoral" stroke="black" points="3206,-532.51 2866,-532.51 2866,-426.51 3206,-426.51 3206,-532.51"/>
<text text-anchor="start" x="2979" y="-518.31" font-family="Arial" font-weight="bold" font-size="14.00">Expert 8 (Layer 3)</text>
<text text-anchor="start" x="2990.5" y="-504.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 8</text>
<text text-anchor="start" x="2977.5" y="-490.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 8</text>
<text text-anchor="start" x="2897.5" y="-476.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="2874" y="-462.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="2962.5" y="-448.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="2933.5" y="-434.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_3&#45;&gt;expert_3_8 -->
<g id="edge155" class="edge">
<title>token_batch_3&#45;&gt;expert_3_8</title>
<path fill="none" stroke="black" d="M3036,-568.36C3036,-568.36 3036,-542.84 3036,-542.84"/>
<polygon fill="black" stroke="black" points="3039.5,-542.84 3036,-532.84 3032.5,-542.84 3039.5,-542.84"/>
</g>
<!-- expert_3_9 -->
<g id="node97" class="node">
<title>expert_3_9</title>
<polygon fill="lightcoral" stroke="black" points="3564,-532.51 3224,-532.51 3224,-426.51 3564,-426.51 3564,-532.51"/>
<text text-anchor="start" x="3337" y="-518.31" font-family="Arial" font-weight="bold" font-size="14.00">Expert 9 (Layer 3)</text>
<text text-anchor="start" x="3348.5" y="-504.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 9</text>
<text text-anchor="start" x="3335.5" y="-490.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 9</text>
<text text-anchor="start" x="3255.5" y="-476.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="3232" y="-462.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="3320.5" y="-448.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="3291.5" y="-434.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_3&#45;&gt;expert_3_9 -->
<g id="edge157" class="edge">
<title>token_batch_3&#45;&gt;expert_3_9</title>
<path fill="none" stroke="black" d="M3076.63,-572C3160.36,-572 3344.35,-572 3344.35,-572 3344.35,-572 3344.35,-542.78 3344.35,-542.78"/>
<polygon fill="black" stroke="black" points="3347.85,-542.78 3344.35,-532.78 3340.85,-542.78 3347.85,-542.78"/>
</g>
<!-- expert_3_10 -->
<g id="node98" class="node">
<title>expert_3_10</title>
<polygon fill="lightcoral" stroke="black" points="3922,-532.51 3582,-532.51 3582,-426.51 3922,-426.51 3922,-532.51"/>
<text text-anchor="start" x="3691.5" y="-518.31" font-family="Arial" font-weight="bold" font-size="14.00">Expert 10 (Layer 3)</text>
<text text-anchor="start" x="3703" y="-504.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 10</text>
<text text-anchor="start" x="3690" y="-490.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 10</text>
<text text-anchor="start" x="3613.5" y="-476.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="3590" y="-462.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="3678.5" y="-448.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="3649.5" y="-434.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_3&#45;&gt;expert_3_10 -->
<g id="edge159" class="edge">
<title>token_batch_3&#45;&gt;expert_3_10</title>
<path fill="none" stroke="black" d="M3091.6,-576C3249.86,-576 3691.43,-576 3691.43,-576 3691.43,-576 3691.43,-542.55 3691.43,-542.55"/>
<polygon fill="black" stroke="black" points="3694.93,-542.55 3691.43,-532.55 3687.93,-542.55 3694.93,-542.55"/>
</g>
<!-- expert_3_11 -->
<g id="node99" class="node">
<title>expert_3_11</title>
<polygon fill="lightcoral" stroke="black" points="4280,-532.51 3940,-532.51 3940,-426.51 4280,-426.51 4280,-532.51"/>
<text text-anchor="start" x="4049.5" y="-518.31" font-family="Arial" font-weight="bold" font-size="14.00">Expert 11 (Layer 3)</text>
<text text-anchor="start" x="4061" y="-504.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 11</text>
<text text-anchor="start" x="4048" y="-490.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 11</text>
<text text-anchor="start" x="3971.5" y="-476.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="3948" y="-462.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="4036.5" y="-448.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="4007.5" y="-434.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_3&#45;&gt;expert_3_11 -->
<g id="edge161" class="edge">
<title>token_batch_3&#45;&gt;expert_3_11</title>
<path fill="none" stroke="black" d="M3099.97,-580C3331.18,-580 4110,-580 4110,-580 4110,-580 4110,-542.7 4110,-542.7"/>
<polygon fill="black" stroke="black" points="4113.5,-542.7 4110,-532.7 4106.5,-542.7 4113.5,-542.7"/>
</g>
<!-- expert_3_12 -->
<g id="node100" class="node">
<title>expert_3_12</title>
<polygon fill="lightcoral" stroke="black" points="4638,-532.51 4298,-532.51 4298,-426.51 4638,-426.51 4638,-532.51"/>
<text text-anchor="start" x="4407.5" y="-518.31" font-family="Arial" font-weight="bold" font-size="14.00">Expert 12 (Layer 3)</text>
<text text-anchor="start" x="4419" y="-504.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 12</text>
<text text-anchor="start" x="4406" y="-490.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 12</text>
<text text-anchor="start" x="4329.5" y="-476.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="4306" y="-462.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="4394.5" y="-448.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="4365.5" y="-434.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_3&#45;&gt;expert_3_12 -->
<g id="edge163" class="edge">
<title>token_batch_3&#45;&gt;expert_3_12</title>
<path fill="none" stroke="black" d="M3103.76,-584C3384.4,-584 4440.92,-584 4440.92,-584 4440.92,-584 4440.92,-542.67 4440.92,-542.67"/>
<polygon fill="black" stroke="black" points="4444.42,-542.67 4440.92,-532.67 4437.42,-542.67 4444.42,-542.67"/>
</g>
<!-- expert_3_13 -->
<g id="node101" class="node">
<title>expert_3_13</title>
<polygon fill="lightcoral" stroke="black" points="4996,-532.51 4656,-532.51 4656,-426.51 4996,-426.51 4996,-532.51"/>
<text text-anchor="start" x="4765.5" y="-518.31" font-family="Arial" font-weight="bold" font-size="14.00">Expert 13 (Layer 3)</text>
<text text-anchor="start" x="4777" y="-504.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 13</text>
<text text-anchor="start" x="4764" y="-490.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 13</text>
<text text-anchor="start" x="4687.5" y="-476.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="4664" y="-462.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="4752.5" y="-448.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="4723.5" y="-434.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_3&#45;&gt;expert_3_13 -->
<g id="edge165" class="edge">
<title>token_batch_3&#45;&gt;expert_3_13</title>
<path fill="none" stroke="black" d="M3104.14,-588C3437.58,-588 4881.33,-588 4881.33,-588 4881.33,-588 4881.33,-542.8 4881.33,-542.8"/>
<polygon fill="black" stroke="black" points="4884.83,-542.8 4881.33,-532.8 4877.83,-542.8 4884.83,-542.8"/>
</g>
<!-- expert_3_14 -->
<g id="node102" class="node">
<title>expert_3_14</title>
<polygon fill="lightcoral" stroke="black" points="5354,-532.51 5014,-532.51 5014,-426.51 5354,-426.51 5354,-532.51"/>
<text text-anchor="start" x="5123.5" y="-518.31" font-family="Arial" font-weight="bold" font-size="14.00">Expert 14 (Layer 3)</text>
<text text-anchor="start" x="5135" y="-504.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 14</text>
<text text-anchor="start" x="5122" y="-490.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 14</text>
<text text-anchor="start" x="5045.5" y="-476.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="5022" y="-462.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="5110.5" y="-448.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="5081.5" y="-434.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_3&#45;&gt;expert_3_14 -->
<g id="edge167" class="edge">
<title>token_batch_3&#45;&gt;expert_3_14</title>
<path fill="none" stroke="black" d="M3101.05,-592C3465.65,-592 5239.33,-592 5239.33,-592 5239.33,-592 5239.33,-542.79 5239.33,-542.79"/>
<polygon fill="black" stroke="black" points="5242.83,-542.79 5239.33,-532.79 5235.83,-542.79 5242.83,-542.79"/>
</g>
<!-- expert_3_15 -->
<g id="node103" class="node">
<title>expert_3_15</title>
<polygon fill="lightcoral" stroke="black" points="5712,-532.51 5372,-532.51 5372,-426.51 5712,-426.51 5712,-532.51"/>
<text text-anchor="start" x="5481.5" y="-518.31" font-family="Arial" font-weight="bold" font-size="14.00">Expert 15 (Layer 3)</text>
<text text-anchor="start" x="5493" y="-504.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GPU: 15</text>
<text text-anchor="start" x="5480" y="-490.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Expert ID: 15</text>
<text text-anchor="start" x="5403.5" y="-476.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [token batch, hidden_dim=4096]</text>
<text text-anchor="start" x="5380" y="-462.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [processed tokens, hidden_dim=4096]</text>
<text text-anchor="start" x="5468.5" y="-448.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memory: 512MB</text>
<text text-anchor="start" x="5439.5" y="-434.31" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FFN: 4096→32768→4096</text>
</g>
<!-- token_batch_3&#45;&gt;expert_3_15 -->
<g id="edge169" class="edge">
<title>token_batch_3&#45;&gt;expert_3_15</title>
<path fill="none" stroke="black" d="M3094,-596C3474.43,-596 5597.33,-596 5597.33,-596 5597.33,-596 5597.33,-542.64 5597.33,-542.64"/>
<polygon fill="black" stroke="black" points="5600.83,-542.64 5597.33,-532.64 5593.83,-542.64 5600.83,-542.64"/>
</g>
<!-- expert_results_3 -->
<g id="node104" class="node">
<title>expert_results_3</title>
<ellipse fill="lightyellow" stroke="black" cx="3036" cy="-345.25" rx="370.55" ry="45.01"/>
<text text-anchor="start" x="2954" y="-363.05" font-family="Arial" font-weight="bold" font-size="14.00">Expert Results Collection</text>
<text text-anchor="start" x="2993.5" y="-349.05" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="2896" y="-335.05" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [processed tokens from 16 experts]</text>
<text text-anchor="start" x="2782" y="-321.05" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [reordered tokens, batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- expert_3_0&#45;&gt;expert_results_3 -->
<g id="edge140" class="edge">
<title>expert_3_0&#45;&gt;expert_results_3</title>
<path fill="none" stroke="black" d="M172,-426.19C172,-376.82 172,-311 172,-311 172,-311 2783.67,-311 2783.67,-311"/>
<polygon fill="black" stroke="black" points="2783.67,-314.5 2793.67,-311 2783.67,-307.5 2783.67,-314.5"/>
</g>
<!-- expert_3_1&#45;&gt;expert_results_3 -->
<g id="edge142" class="edge">
<title>expert_3_1&#45;&gt;expert_results_3</title>
<path fill="none" stroke="black" d="M530,-426.18C530,-380.49 530,-322 530,-322 530,-322 2707.98,-322 2707.98,-322"/>
<polygon fill="black" stroke="black" points="2707.98,-325.5 2717.98,-322 2707.98,-318.5 2707.98,-325.5"/>
</g>
<!-- expert_3_2&#45;&gt;expert_results_3 -->
<g id="edge144" class="edge">
<title>expert_3_2&#45;&gt;expert_results_3</title>
<path fill="none" stroke="black" d="M888,-426.2C888,-384.31 888,-333 888,-333 888,-333 2669.19,-333 2669.19,-333"/>
<polygon fill="black" stroke="black" points="2669.19,-336.5 2679.19,-333 2669.19,-329.5 2669.19,-336.5"/>
</g>
<!-- expert_3_3&#45;&gt;expert_results_3 -->
<g id="edge146" class="edge">
<title>expert_3_3&#45;&gt;expert_results_3</title>
<path fill="none" stroke="black" d="M1246,-426.35C1246,-388.75 1246,-345 1246,-345 1246,-345 2655.38,-345 2655.38,-345"/>
<polygon fill="black" stroke="black" points="2655.38,-348.5 2665.38,-345 2655.38,-341.5 2655.38,-348.5"/>
</g>
<!-- expert_3_4&#45;&gt;expert_results_3 -->
<g id="edge148" class="edge">
<title>expert_3_4&#45;&gt;expert_results_3</title>
<path fill="none" stroke="black" d="M1604,-426.41C1604,-392.94 1604,-356 1604,-356 1604,-356 2666.03,-356 2666.03,-356"/>
<polygon fill="black" stroke="black" points="2666.03,-359.5 2676.03,-356 2666.03,-352.5 2666.03,-359.5"/>
</g>
<!-- expert_3_5&#45;&gt;expert_results_3 -->
<g id="edge150" class="edge">
<title>expert_3_5&#45;&gt;expert_results_3</title>
<path fill="none" stroke="black" d="M1962,-426.22C1962,-397.14 1962,-367 1962,-367 1962,-367 2700.85,-367 2700.85,-367"/>
<polygon fill="black" stroke="black" points="2700.85,-370.5 2710.85,-367 2700.85,-363.5 2700.85,-370.5"/>
</g>
<!-- expert_3_6&#45;&gt;expert_results_3 -->
<g id="edge152" class="edge">
<title>expert_3_6&#45;&gt;expert_results_3</title>
<path fill="none" stroke="black" d="M2320,-426.31C2320,-402.2 2320,-379 2320,-379 2320,-379 2779.09,-379 2779.09,-379"/>
<polygon fill="black" stroke="black" points="2779.09,-382.5 2789.09,-379 2779.09,-375.5 2779.09,-382.5"/>
</g>
<!-- expert_3_7&#45;&gt;expert_results_3 -->
<g id="edge154" class="edge">
<title>expert_3_7&#45;&gt;expert_results_3</title>
<path fill="none" stroke="black" d="M2756.74,-426.45C2756.74,-426.45 2756.74,-385.14 2756.74,-385.14"/>
<polygon fill="black" stroke="black" points="2760.24,-385.14 2756.74,-375.14 2753.24,-385.14 2760.24,-385.14"/>
</g>
<!-- expert_3_8&#45;&gt;expert_results_3 -->
<g id="edge156" class="edge">
<title>expert_3_8&#45;&gt;expert_results_3</title>
<path fill="none" stroke="black" d="M3036,-426.45C3036,-426.45 3036,-400.56 3036,-400.56"/>
<polygon fill="black" stroke="black" points="3039.5,-400.56 3036,-390.56 3032.5,-400.56 3039.5,-400.56"/>
</g>
<!-- expert_3_9&#45;&gt;expert_results_3 -->
<g id="edge158" class="edge">
<title>expert_3_9&#45;&gt;expert_results_3</title>
<path fill="none" stroke="black" d="M3315.26,-426.45C3315.26,-426.45 3315.26,-385.14 3315.26,-385.14"/>
<polygon fill="black" stroke="black" points="3318.76,-385.14 3315.26,-375.14 3311.76,-385.14 3318.76,-385.14"/>
</g>
<!-- expert_3_10&#45;&gt;expert_results_3 -->
<g id="edge160" class="edge">
<title>expert_3_10&#45;&gt;expert_results_3</title>
<path fill="none" stroke="black" d="M3752,-426.31C3752,-402.2 3752,-379 3752,-379 3752,-379 3292.91,-379 3292.91,-379"/>
<polygon fill="black" stroke="black" points="3292.91,-375.5 3282.91,-379 3292.91,-382.5 3292.91,-375.5"/>
</g>
<!-- expert_3_11&#45;&gt;expert_results_3 -->
<g id="edge162" class="edge">
<title>expert_3_11&#45;&gt;expert_results_3</title>
<path fill="none" stroke="black" d="M4001.75,-426.22C4001.75,-397.14 4001.75,-367 4001.75,-367 4001.75,-367 3371.28,-367 3371.28,-367"/>
<polygon fill="black" stroke="black" points="3371.28,-363.5 3361.28,-367 3371.28,-370.5 3371.28,-363.5"/>
</g>
<!-- expert_3_12&#45;&gt;expert_results_3 -->
<g id="edge164" class="edge">
<title>expert_3_12&#45;&gt;expert_results_3</title>
<path fill="none" stroke="black" d="M4388.25,-426.41C4388.25,-392.94 4388.25,-356 4388.25,-356 4388.25,-356 3406.16,-356 3406.16,-356"/>
<polygon fill="black" stroke="black" points="3406.16,-352.5 3396.16,-356 3406.16,-359.5 3406.16,-352.5"/>
</g>
<!-- expert_3_13&#45;&gt;expert_results_3 -->
<g id="edge166" class="edge">
<title>expert_3_13&#45;&gt;expert_results_3</title>
<path fill="none" stroke="black" d="M4826,-426.35C4826,-388.75 4826,-345 4826,-345 4826,-345 3416.62,-345 3416.62,-345"/>
<polygon fill="black" stroke="black" points="3416.62,-341.5 3406.62,-345 3416.62,-348.5 3416.62,-341.5"/>
</g>
<!-- expert_3_14&#45;&gt;expert_results_3 -->
<g id="edge168" class="edge">
<title>expert_3_14&#45;&gt;expert_results_3</title>
<path fill="none" stroke="black" d="M5184,-426.2C5184,-384.31 5184,-333 5184,-333 5184,-333 3402.81,-333 3402.81,-333"/>
<polygon fill="black" stroke="black" points="3402.81,-329.5 3392.81,-333 3402.81,-336.5 3402.81,-329.5"/>
</g>
<!-- expert_3_15&#45;&gt;expert_results_3 -->
<g id="edge170" class="edge">
<title>expert_3_15&#45;&gt;expert_results_3</title>
<path fill="none" stroke="black" d="M5542,-426.18C5542,-380.49 5542,-322 5542,-322 5542,-322 3364.02,-322 3364.02,-322"/>
<polygon fill="black" stroke="black" points="3364.02,-318.5 3354.02,-322 3364.02,-325.5 3364.02,-318.5"/>
</g>
<!-- moe_combine_3 -->
<g id="node105" class="node">
<title>moe_combine_3</title>
<polygon fill="lightblue" stroke="black" points="4478.5,-264 4063.5,-264 4063.5,-200 4478.5,-200 4478.5,-264"/>
<text text-anchor="start" x="4200.5" y="-249.8" font-family="Arial" font-weight="bold" font-size="14.00">MoE Output Combine</text>
<text text-anchor="start" x="4228.5" y="-235.8" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;All GPUs</text>
<text text-anchor="start" x="4143.5" y="-221.8" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Input: [expert outputs, gating weights]</text>
<text text-anchor="start" x="4071.5" y="-207.8" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Output: [batch_size=128, seq_len=10000, hidden_dim=4096]</text>
</g>
<!-- expert_results_3&#45;&gt;moe_combine_3 -->
<g id="edge171" class="edge">
<title>expert_results_3&#45;&gt;moe_combine_3</title>
<path fill="none" stroke="black" d="M3278.25,-311C3611.81,-311 4171.75,-311 4171.75,-311 4171.75,-311 4171.75,-274.13 4171.75,-274.13"/>
<polygon fill="black" stroke="black" points="4175.25,-274.13 4171.75,-264.13 4168.25,-274.13 4175.25,-274.13"/>
</g>
<!-- moe_combine_3&#45;&gt;moe_res_3 -->
<g id="edge172" class="edge">
<title>moe_combine_3&#45;&gt;moe_res_3</title>
<path fill="none" stroke="black" d="M4325.5,-199.81C4325.5,-199.81 4325.5,-174.13 4325.5,-174.13"/>
<polygon fill="black" stroke="black" points="4329,-174.13 4325.5,-164.13 4322,-174.13 4329,-174.13"/>
</g>
<!-- output -->
<g id="node107" class="node">
<title>output</title>
<text text-anchor="start" x="4343.5" y="-49.8" font-family="Arial" font-weight="bold" font-size="14.00">Model Output</text>
<text text-anchor="start" x="4333" y="-35.8" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;Batch Size: 128</text>
<text text-anchor="start" x="4305" y="-21.8" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;Sequence Length: 10000</text>
<text text-anchor="start" x="4326" y="-7.8" font-family="Arial" font-size="14.00"> &#160;&#160;&#160;Hidden Dim: 4096</text>
</g>
<!-- moe_res_3&#45;&gt;output -->
<g id="edge174" class="edge">
<title>moe_res_3&#45;&gt;output</title>
<path fill="none" stroke="black" d="M4388,-99.81C4388,-99.81 4388,-74.13 4388,-74.13"/>
<polygon fill="black" stroke="black" points="4391.5,-74.13 4388,-64.13 4384.5,-74.13 4391.5,-74.13"/>
</g>
</g>
</svg>
