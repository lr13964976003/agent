// FA Pool Detailed Dynamic Attention Distribution DAG
digraph fa_pool_detailed_dag {
	rankdir=LR size="50,30" splines=ortho
	node [fontname=Arial fontsize=9]
	node [fillcolor=lightblue shape=ellipse style=filled]
	node [fillcolor=lightgreen shape=rectangle style=filled]
	node [fillcolor=lightyellow shape=parallelogram style=filled]
	node [fillcolor=lightgray shape=diamond style=filled]
	node [fillcolor=lightcoral shape=hexagon style=filled]
	input [label="<b>Model Input</b><br/>[batch=1024, seq_len=?, vocab=32000]" fillcolor=lightblue shape=ellipse]
	seq_analyzer [label="<b>Sequence Length Analyzer</b><br/>Analyzes seq_len<br/>Determines GPU allocation<br/>
             < 4096: Base only<br/>
             4096-8192: +8 pool GPUs<br/>
             8192-16384: +16 pool GPUs<br/>
             >16384: +24 pool GPUs" fillcolor=lightcoral shape=hexagon]
	subgraph cluster_base_components {
		fontsize=12 label="Base Layer (8 GPUs - Always Active)" style=rounded
		base_embed_0 [label="<b>Embedding</b><br/>base_gpu_0<br/>[batch=1024, seq=?, 512]" fillcolor=lightgreen shape=rectangle]
		base_embed_1 [label="<b>Embedding</b><br/>base_gpu_1<br/>[batch=1024, seq=?, 512]" fillcolor=lightgreen shape=rectangle]
		base_embed_2 [label="<b>Embedding</b><br/>base_gpu_2<br/>[batch=1024, seq=?, 512]" fillcolor=lightgreen shape=rectangle]
		base_embed_3 [label="<b>Embedding</b><br/>base_gpu_3<br/>[batch=1024, seq=?, 512]" fillcolor=lightgreen shape=rectangle]
		base_embed_4 [label="<b>Embedding</b><br/>base_gpu_4<br/>[batch=1024, seq=?, 512]" fillcolor=lightgreen shape=rectangle]
		base_embed_5 [label="<b>Embedding</b><br/>base_gpu_5<br/>[batch=1024, seq=?, 512]" fillcolor=lightgreen shape=rectangle]
		base_embed_6 [label="<b>Embedding</b><br/>base_gpu_6<br/>[batch=1024, seq=?, 512]" fillcolor=lightgreen shape=rectangle]
		base_embed_7 [label="<b>Embedding</b><br/>base_gpu_7<br/>[batch=1024, seq=?, 512]" fillcolor=lightgreen shape=rectangle]
		subgraph cluster_base_ffn_l0 {
			fontsize=10 label="Layer 0 FFN" style=dashed
			base_ffn_up_l0_0 [label="<b>FFN Up</b><br/>base_gpu_0<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l0_0 [label="<b>FFN Down</b><br/>base_gpu_0<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l0_1 [label="<b>FFN Up</b><br/>base_gpu_1<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l0_1 [label="<b>FFN Down</b><br/>base_gpu_1<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l0_2 [label="<b>FFN Up</b><br/>base_gpu_2<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l0_2 [label="<b>FFN Down</b><br/>base_gpu_2<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l0_3 [label="<b>FFN Up</b><br/>base_gpu_3<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l0_3 [label="<b>FFN Down</b><br/>base_gpu_3<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l0_4 [label="<b>FFN Up</b><br/>base_gpu_4<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l0_4 [label="<b>FFN Down</b><br/>base_gpu_4<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l0_5 [label="<b>FFN Up</b><br/>base_gpu_5<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l0_5 [label="<b>FFN Down</b><br/>base_gpu_5<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l0_6 [label="<b>FFN Up</b><br/>base_gpu_6<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l0_6 [label="<b>FFN Down</b><br/>base_gpu_6<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l0_7 [label="<b>FFN Up</b><br/>base_gpu_7<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l0_7 [label="<b>FFN Down</b><br/>base_gpu_7<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_base_ffn_l1 {
			fontsize=10 label="Layer 1 FFN" style=dashed
			base_ffn_up_l1_0 [label="<b>FFN Up</b><br/>base_gpu_0<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l1_0 [label="<b>FFN Down</b><br/>base_gpu_0<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l1_1 [label="<b>FFN Up</b><br/>base_gpu_1<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l1_1 [label="<b>FFN Down</b><br/>base_gpu_1<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l1_2 [label="<b>FFN Up</b><br/>base_gpu_2<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l1_2 [label="<b>FFN Down</b><br/>base_gpu_2<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l1_3 [label="<b>FFN Up</b><br/>base_gpu_3<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l1_3 [label="<b>FFN Down</b><br/>base_gpu_3<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l1_4 [label="<b>FFN Up</b><br/>base_gpu_4<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l1_4 [label="<b>FFN Down</b><br/>base_gpu_4<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l1_5 [label="<b>FFN Up</b><br/>base_gpu_5<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l1_5 [label="<b>FFN Down</b><br/>base_gpu_5<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l1_6 [label="<b>FFN Up</b><br/>base_gpu_6<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l1_6 [label="<b>FFN Down</b><br/>base_gpu_6<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l1_7 [label="<b>FFN Up</b><br/>base_gpu_7<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l1_7 [label="<b>FFN Down</b><br/>base_gpu_7<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_base_ffn_l2 {
			fontsize=10 label="Layer 2 FFN" style=dashed
			base_ffn_up_l2_0 [label="<b>FFN Up</b><br/>base_gpu_0<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l2_0 [label="<b>FFN Down</b><br/>base_gpu_0<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l2_1 [label="<b>FFN Up</b><br/>base_gpu_1<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l2_1 [label="<b>FFN Down</b><br/>base_gpu_1<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l2_2 [label="<b>FFN Up</b><br/>base_gpu_2<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l2_2 [label="<b>FFN Down</b><br/>base_gpu_2<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l2_3 [label="<b>FFN Up</b><br/>base_gpu_3<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l2_3 [label="<b>FFN Down</b><br/>base_gpu_3<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l2_4 [label="<b>FFN Up</b><br/>base_gpu_4<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l2_4 [label="<b>FFN Down</b><br/>base_gpu_4<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l2_5 [label="<b>FFN Up</b><br/>base_gpu_5<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l2_5 [label="<b>FFN Down</b><br/>base_gpu_5<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l2_6 [label="<b>FFN Up</b><br/>base_gpu_6<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l2_6 [label="<b>FFN Down</b><br/>base_gpu_6<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l2_7 [label="<b>FFN Up</b><br/>base_gpu_7<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l2_7 [label="<b>FFN Down</b><br/>base_gpu_7<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
		}
		subgraph cluster_base_ffn_l3 {
			fontsize=10 label="Layer 3 FFN" style=dashed
			base_ffn_up_l3_0 [label="<b>FFN Up</b><br/>base_gpu_0<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l3_0 [label="<b>FFN Down</b><br/>base_gpu_0<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l3_1 [label="<b>FFN Up</b><br/>base_gpu_1<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l3_1 [label="<b>FFN Down</b><br/>base_gpu_1<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l3_2 [label="<b>FFN Up</b><br/>base_gpu_2<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l3_2 [label="<b>FFN Down</b><br/>base_gpu_2<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l3_3 [label="<b>FFN Up</b><br/>base_gpu_3<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l3_3 [label="<b>FFN Down</b><br/>base_gpu_3<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l3_4 [label="<b>FFN Up</b><br/>base_gpu_4<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l3_4 [label="<b>FFN Down</b><br/>base_gpu_4<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l3_5 [label="<b>FFN Up</b><br/>base_gpu_5<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l3_5 [label="<b>FFN Down</b><br/>base_gpu_5<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l3_6 [label="<b>FFN Up</b><br/>base_gpu_6<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l3_6 [label="<b>FFN Down</b><br/>base_gpu_6<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
			base_ffn_up_l3_7 [label="<b>FFN Up</b><br/>base_gpu_7<br/>[512→2048]" fillcolor=lightgreen shape=rectangle]
			base_ffn_down_l3_7 [label="<b>FFN Down</b><br/>base_gpu_7<br/>[2048→512]" fillcolor=lightgreen shape=rectangle]
		}
	}
	subgraph cluster_short_scenario {
		color=lightblue fontsize=11 label="< 4096 tokens (Base)" style=rounded
		subgraph cluster_layer0_short {
			fontsize=10 label="Layer 0"
			q_proj_0_short_0 [label="<b>Q Proj</b><br/>base_gpu_0<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_0_short_0 [label="<b>K Proj</b><br/>base_gpu_0<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_0_short_0 [label="<b>V Proj</b><br/>base_gpu_0<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_0_short_0 [label="<b>Flash Attention</b><br/>base_gpu_0<br/>Block: 1/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_0_short_1 [label="<b>Q Proj</b><br/>base_gpu_1<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_0_short_1 [label="<b>K Proj</b><br/>base_gpu_1<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_0_short_1 [label="<b>V Proj</b><br/>base_gpu_1<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_0_short_1 [label="<b>Flash Attention</b><br/>base_gpu_1<br/>Block: 2/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_0_short_2 [label="<b>Q Proj</b><br/>base_gpu_2<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_0_short_2 [label="<b>K Proj</b><br/>base_gpu_2<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_0_short_2 [label="<b>V Proj</b><br/>base_gpu_2<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_0_short_2 [label="<b>Flash Attention</b><br/>base_gpu_2<br/>Block: 3/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_0_short_3 [label="<b>Q Proj</b><br/>base_gpu_3<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_0_short_3 [label="<b>K Proj</b><br/>base_gpu_3<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_0_short_3 [label="<b>V Proj</b><br/>base_gpu_3<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_0_short_3 [label="<b>Flash Attention</b><br/>base_gpu_3<br/>Block: 4/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_0_short_4 [label="<b>Q Proj</b><br/>base_gpu_4<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_0_short_4 [label="<b>K Proj</b><br/>base_gpu_4<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_0_short_4 [label="<b>V Proj</b><br/>base_gpu_4<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_0_short_4 [label="<b>Flash Attention</b><br/>base_gpu_4<br/>Block: 5/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_0_short_5 [label="<b>Q Proj</b><br/>base_gpu_5<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_0_short_5 [label="<b>K Proj</b><br/>base_gpu_5<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_0_short_5 [label="<b>V Proj</b><br/>base_gpu_5<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_0_short_5 [label="<b>Flash Attention</b><br/>base_gpu_5<br/>Block: 6/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_0_short_6 [label="<b>Q Proj</b><br/>base_gpu_6<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_0_short_6 [label="<b>K Proj</b><br/>base_gpu_6<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_0_short_6 [label="<b>V Proj</b><br/>base_gpu_6<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_0_short_6 [label="<b>Flash Attention</b><br/>base_gpu_6<br/>Block: 7/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_0_short_7 [label="<b>Q Proj</b><br/>base_gpu_7<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_0_short_7 [label="<b>K Proj</b><br/>base_gpu_7<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_0_short_7 [label="<b>V Proj</b><br/>base_gpu_7<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_0_short_7 [label="<b>Flash Attention</b><br/>base_gpu_7<br/>Block: 8/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
		}
		subgraph cluster_layer1_short {
			fontsize=10 label="Layer 1"
			q_proj_1_short_0 [label="<b>Q Proj</b><br/>base_gpu_0<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_1_short_0 [label="<b>K Proj</b><br/>base_gpu_0<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_1_short_0 [label="<b>V Proj</b><br/>base_gpu_0<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_1_short_0 [label="<b>Flash Attention</b><br/>base_gpu_0<br/>Block: 1/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_1_short_1 [label="<b>Q Proj</b><br/>base_gpu_1<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_1_short_1 [label="<b>K Proj</b><br/>base_gpu_1<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_1_short_1 [label="<b>V Proj</b><br/>base_gpu_1<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_1_short_1 [label="<b>Flash Attention</b><br/>base_gpu_1<br/>Block: 2/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_1_short_2 [label="<b>Q Proj</b><br/>base_gpu_2<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_1_short_2 [label="<b>K Proj</b><br/>base_gpu_2<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_1_short_2 [label="<b>V Proj</b><br/>base_gpu_2<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_1_short_2 [label="<b>Flash Attention</b><br/>base_gpu_2<br/>Block: 3/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_1_short_3 [label="<b>Q Proj</b><br/>base_gpu_3<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_1_short_3 [label="<b>K Proj</b><br/>base_gpu_3<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_1_short_3 [label="<b>V Proj</b><br/>base_gpu_3<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_1_short_3 [label="<b>Flash Attention</b><br/>base_gpu_3<br/>Block: 4/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_1_short_4 [label="<b>Q Proj</b><br/>base_gpu_4<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_1_short_4 [label="<b>K Proj</b><br/>base_gpu_4<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_1_short_4 [label="<b>V Proj</b><br/>base_gpu_4<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_1_short_4 [label="<b>Flash Attention</b><br/>base_gpu_4<br/>Block: 5/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_1_short_5 [label="<b>Q Proj</b><br/>base_gpu_5<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_1_short_5 [label="<b>K Proj</b><br/>base_gpu_5<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_1_short_5 [label="<b>V Proj</b><br/>base_gpu_5<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_1_short_5 [label="<b>Flash Attention</b><br/>base_gpu_5<br/>Block: 6/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_1_short_6 [label="<b>Q Proj</b><br/>base_gpu_6<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_1_short_6 [label="<b>K Proj</b><br/>base_gpu_6<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_1_short_6 [label="<b>V Proj</b><br/>base_gpu_6<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_1_short_6 [label="<b>Flash Attention</b><br/>base_gpu_6<br/>Block: 7/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_1_short_7 [label="<b>Q Proj</b><br/>base_gpu_7<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_1_short_7 [label="<b>K Proj</b><br/>base_gpu_7<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_1_short_7 [label="<b>V Proj</b><br/>base_gpu_7<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_1_short_7 [label="<b>Flash Attention</b><br/>base_gpu_7<br/>Block: 8/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
		}
		subgraph cluster_layer2_short {
			fontsize=10 label="Layer 2"
			q_proj_2_short_0 [label="<b>Q Proj</b><br/>base_gpu_0<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_2_short_0 [label="<b>K Proj</b><br/>base_gpu_0<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_2_short_0 [label="<b>V Proj</b><br/>base_gpu_0<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_2_short_0 [label="<b>Flash Attention</b><br/>base_gpu_0<br/>Block: 1/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_2_short_1 [label="<b>Q Proj</b><br/>base_gpu_1<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_2_short_1 [label="<b>K Proj</b><br/>base_gpu_1<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_2_short_1 [label="<b>V Proj</b><br/>base_gpu_1<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_2_short_1 [label="<b>Flash Attention</b><br/>base_gpu_1<br/>Block: 2/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_2_short_2 [label="<b>Q Proj</b><br/>base_gpu_2<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_2_short_2 [label="<b>K Proj</b><br/>base_gpu_2<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_2_short_2 [label="<b>V Proj</b><br/>base_gpu_2<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_2_short_2 [label="<b>Flash Attention</b><br/>base_gpu_2<br/>Block: 3/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_2_short_3 [label="<b>Q Proj</b><br/>base_gpu_3<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_2_short_3 [label="<b>K Proj</b><br/>base_gpu_3<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_2_short_3 [label="<b>V Proj</b><br/>base_gpu_3<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_2_short_3 [label="<b>Flash Attention</b><br/>base_gpu_3<br/>Block: 4/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_2_short_4 [label="<b>Q Proj</b><br/>base_gpu_4<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_2_short_4 [label="<b>K Proj</b><br/>base_gpu_4<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_2_short_4 [label="<b>V Proj</b><br/>base_gpu_4<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_2_short_4 [label="<b>Flash Attention</b><br/>base_gpu_4<br/>Block: 5/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_2_short_5 [label="<b>Q Proj</b><br/>base_gpu_5<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_2_short_5 [label="<b>K Proj</b><br/>base_gpu_5<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_2_short_5 [label="<b>V Proj</b><br/>base_gpu_5<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_2_short_5 [label="<b>Flash Attention</b><br/>base_gpu_5<br/>Block: 6/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_2_short_6 [label="<b>Q Proj</b><br/>base_gpu_6<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_2_short_6 [label="<b>K Proj</b><br/>base_gpu_6<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_2_short_6 [label="<b>V Proj</b><br/>base_gpu_6<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_2_short_6 [label="<b>Flash Attention</b><br/>base_gpu_6<br/>Block: 7/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_2_short_7 [label="<b>Q Proj</b><br/>base_gpu_7<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_2_short_7 [label="<b>K Proj</b><br/>base_gpu_7<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_2_short_7 [label="<b>V Proj</b><br/>base_gpu_7<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_2_short_7 [label="<b>Flash Attention</b><br/>base_gpu_7<br/>Block: 8/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
		}
		subgraph cluster_layer3_short {
			fontsize=10 label="Layer 3"
			q_proj_3_short_0 [label="<b>Q Proj</b><br/>base_gpu_0<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_3_short_0 [label="<b>K Proj</b><br/>base_gpu_0<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_3_short_0 [label="<b>V Proj</b><br/>base_gpu_0<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_3_short_0 [label="<b>Flash Attention</b><br/>base_gpu_0<br/>Block: 1/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_3_short_1 [label="<b>Q Proj</b><br/>base_gpu_1<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_3_short_1 [label="<b>K Proj</b><br/>base_gpu_1<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_3_short_1 [label="<b>V Proj</b><br/>base_gpu_1<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_3_short_1 [label="<b>Flash Attention</b><br/>base_gpu_1<br/>Block: 2/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_3_short_2 [label="<b>Q Proj</b><br/>base_gpu_2<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_3_short_2 [label="<b>K Proj</b><br/>base_gpu_2<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_3_short_2 [label="<b>V Proj</b><br/>base_gpu_2<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_3_short_2 [label="<b>Flash Attention</b><br/>base_gpu_2<br/>Block: 3/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_3_short_3 [label="<b>Q Proj</b><br/>base_gpu_3<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_3_short_3 [label="<b>K Proj</b><br/>base_gpu_3<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_3_short_3 [label="<b>V Proj</b><br/>base_gpu_3<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_3_short_3 [label="<b>Flash Attention</b><br/>base_gpu_3<br/>Block: 4/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_3_short_4 [label="<b>Q Proj</b><br/>base_gpu_4<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_3_short_4 [label="<b>K Proj</b><br/>base_gpu_4<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_3_short_4 [label="<b>V Proj</b><br/>base_gpu_4<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_3_short_4 [label="<b>Flash Attention</b><br/>base_gpu_4<br/>Block: 5/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_3_short_5 [label="<b>Q Proj</b><br/>base_gpu_5<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_3_short_5 [label="<b>K Proj</b><br/>base_gpu_5<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_3_short_5 [label="<b>V Proj</b><br/>base_gpu_5<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_3_short_5 [label="<b>Flash Attention</b><br/>base_gpu_5<br/>Block: 6/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_3_short_6 [label="<b>Q Proj</b><br/>base_gpu_6<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_3_short_6 [label="<b>K Proj</b><br/>base_gpu_6<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_3_short_6 [label="<b>V Proj</b><br/>base_gpu_6<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_3_short_6 [label="<b>Flash Attention</b><br/>base_gpu_6<br/>Block: 7/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
			q_proj_3_short_7 [label="<b>Q Proj</b><br/>base_gpu_7<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			k_proj_3_short_7 [label="<b>K Proj</b><br/>base_gpu_7<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			v_proj_3_short_7 [label="<b>V Proj</b><br/>base_gpu_7<br/>[512→(32×16)]" fillcolor=lightblue shape=rectangle]
			flash_attn_3_short_7 [label="<b>Flash Attention</b><br/>base_gpu_7<br/>Block: 8/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightblue shape=rectangle]
		}
	}
	subgraph cluster_medium_scenario {
		color=lightgreen fontsize=11 label="4096-8192 tokens (8 pool GPUs)" style=rounded
		subgraph cluster_layer0_medium {
			fontsize=10 label="Layer 0"
			q_proj_0_medium_0 [label="<b>Q Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_0_medium_0 [label="<b>K Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_0_medium_0 [label="<b>V Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_0_medium_0 [label="<b>Flash Attention</b><br/>pool_gpu_0<br/>Block: 1/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_0_medium_1 [label="<b>Q Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_0_medium_1 [label="<b>K Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_0_medium_1 [label="<b>V Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_0_medium_1 [label="<b>Flash Attention</b><br/>pool_gpu_1<br/>Block: 2/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_0_medium_2 [label="<b>Q Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_0_medium_2 [label="<b>K Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_0_medium_2 [label="<b>V Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_0_medium_2 [label="<b>Flash Attention</b><br/>pool_gpu_2<br/>Block: 3/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_0_medium_3 [label="<b>Q Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_0_medium_3 [label="<b>K Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_0_medium_3 [label="<b>V Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_0_medium_3 [label="<b>Flash Attention</b><br/>pool_gpu_3<br/>Block: 4/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_0_medium_4 [label="<b>Q Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_0_medium_4 [label="<b>K Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_0_medium_4 [label="<b>V Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_0_medium_4 [label="<b>Flash Attention</b><br/>pool_gpu_4<br/>Block: 5/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_0_medium_5 [label="<b>Q Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_0_medium_5 [label="<b>K Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_0_medium_5 [label="<b>V Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_0_medium_5 [label="<b>Flash Attention</b><br/>pool_gpu_5<br/>Block: 6/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_0_medium_6 [label="<b>Q Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_0_medium_6 [label="<b>K Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_0_medium_6 [label="<b>V Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_0_medium_6 [label="<b>Flash Attention</b><br/>pool_gpu_6<br/>Block: 7/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_0_medium_7 [label="<b>Q Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_0_medium_7 [label="<b>K Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_0_medium_7 [label="<b>V Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_0_medium_7 [label="<b>Flash Attention</b><br/>pool_gpu_7<br/>Block: 8/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			reduce_0_medium [label="<b>Hierarchical Reduce</b><br/>8→8 GPUs<br/>Concatenate blocks" fillcolor=lightgray shape=diamond]
		}
		subgraph cluster_layer1_medium {
			fontsize=10 label="Layer 1"
			q_proj_1_medium_0 [label="<b>Q Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_1_medium_0 [label="<b>K Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_1_medium_0 [label="<b>V Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_1_medium_0 [label="<b>Flash Attention</b><br/>pool_gpu_0<br/>Block: 1/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_1_medium_1 [label="<b>Q Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_1_medium_1 [label="<b>K Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_1_medium_1 [label="<b>V Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_1_medium_1 [label="<b>Flash Attention</b><br/>pool_gpu_1<br/>Block: 2/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_1_medium_2 [label="<b>Q Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_1_medium_2 [label="<b>K Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_1_medium_2 [label="<b>V Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_1_medium_2 [label="<b>Flash Attention</b><br/>pool_gpu_2<br/>Block: 3/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_1_medium_3 [label="<b>Q Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_1_medium_3 [label="<b>K Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_1_medium_3 [label="<b>V Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_1_medium_3 [label="<b>Flash Attention</b><br/>pool_gpu_3<br/>Block: 4/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_1_medium_4 [label="<b>Q Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_1_medium_4 [label="<b>K Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_1_medium_4 [label="<b>V Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_1_medium_4 [label="<b>Flash Attention</b><br/>pool_gpu_4<br/>Block: 5/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_1_medium_5 [label="<b>Q Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_1_medium_5 [label="<b>K Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_1_medium_5 [label="<b>V Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_1_medium_5 [label="<b>Flash Attention</b><br/>pool_gpu_5<br/>Block: 6/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_1_medium_6 [label="<b>Q Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_1_medium_6 [label="<b>K Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_1_medium_6 [label="<b>V Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_1_medium_6 [label="<b>Flash Attention</b><br/>pool_gpu_6<br/>Block: 7/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_1_medium_7 [label="<b>Q Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_1_medium_7 [label="<b>K Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_1_medium_7 [label="<b>V Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_1_medium_7 [label="<b>Flash Attention</b><br/>pool_gpu_7<br/>Block: 8/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			reduce_1_medium [label="<b>Hierarchical Reduce</b><br/>8→8 GPUs<br/>Concatenate blocks" fillcolor=lightgray shape=diamond]
		}
		subgraph cluster_layer2_medium {
			fontsize=10 label="Layer 2"
			q_proj_2_medium_0 [label="<b>Q Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_2_medium_0 [label="<b>K Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_2_medium_0 [label="<b>V Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_2_medium_0 [label="<b>Flash Attention</b><br/>pool_gpu_0<br/>Block: 1/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_2_medium_1 [label="<b>Q Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_2_medium_1 [label="<b>K Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_2_medium_1 [label="<b>V Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_2_medium_1 [label="<b>Flash Attention</b><br/>pool_gpu_1<br/>Block: 2/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_2_medium_2 [label="<b>Q Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_2_medium_2 [label="<b>K Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_2_medium_2 [label="<b>V Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_2_medium_2 [label="<b>Flash Attention</b><br/>pool_gpu_2<br/>Block: 3/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_2_medium_3 [label="<b>Q Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_2_medium_3 [label="<b>K Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_2_medium_3 [label="<b>V Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_2_medium_3 [label="<b>Flash Attention</b><br/>pool_gpu_3<br/>Block: 4/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_2_medium_4 [label="<b>Q Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_2_medium_4 [label="<b>K Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_2_medium_4 [label="<b>V Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_2_medium_4 [label="<b>Flash Attention</b><br/>pool_gpu_4<br/>Block: 5/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_2_medium_5 [label="<b>Q Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_2_medium_5 [label="<b>K Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_2_medium_5 [label="<b>V Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_2_medium_5 [label="<b>Flash Attention</b><br/>pool_gpu_5<br/>Block: 6/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_2_medium_6 [label="<b>Q Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_2_medium_6 [label="<b>K Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_2_medium_6 [label="<b>V Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_2_medium_6 [label="<b>Flash Attention</b><br/>pool_gpu_6<br/>Block: 7/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_2_medium_7 [label="<b>Q Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_2_medium_7 [label="<b>K Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_2_medium_7 [label="<b>V Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_2_medium_7 [label="<b>Flash Attention</b><br/>pool_gpu_7<br/>Block: 8/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			reduce_2_medium [label="<b>Hierarchical Reduce</b><br/>8→8 GPUs<br/>Concatenate blocks" fillcolor=lightgray shape=diamond]
		}
		subgraph cluster_layer3_medium {
			fontsize=10 label="Layer 3"
			q_proj_3_medium_0 [label="<b>Q Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_3_medium_0 [label="<b>K Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_3_medium_0 [label="<b>V Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_3_medium_0 [label="<b>Flash Attention</b><br/>pool_gpu_0<br/>Block: 1/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_3_medium_1 [label="<b>Q Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_3_medium_1 [label="<b>K Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_3_medium_1 [label="<b>V Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_3_medium_1 [label="<b>Flash Attention</b><br/>pool_gpu_1<br/>Block: 2/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_3_medium_2 [label="<b>Q Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_3_medium_2 [label="<b>K Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_3_medium_2 [label="<b>V Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_3_medium_2 [label="<b>Flash Attention</b><br/>pool_gpu_2<br/>Block: 3/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_3_medium_3 [label="<b>Q Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_3_medium_3 [label="<b>K Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_3_medium_3 [label="<b>V Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_3_medium_3 [label="<b>Flash Attention</b><br/>pool_gpu_3<br/>Block: 4/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_3_medium_4 [label="<b>Q Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_3_medium_4 [label="<b>K Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_3_medium_4 [label="<b>V Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_3_medium_4 [label="<b>Flash Attention</b><br/>pool_gpu_4<br/>Block: 5/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_3_medium_5 [label="<b>Q Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_3_medium_5 [label="<b>K Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_3_medium_5 [label="<b>V Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_3_medium_5 [label="<b>Flash Attention</b><br/>pool_gpu_5<br/>Block: 6/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_3_medium_6 [label="<b>Q Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_3_medium_6 [label="<b>K Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_3_medium_6 [label="<b>V Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_3_medium_6 [label="<b>Flash Attention</b><br/>pool_gpu_6<br/>Block: 7/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			q_proj_3_medium_7 [label="<b>Q Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			k_proj_3_medium_7 [label="<b>K Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			v_proj_3_medium_7 [label="<b>V Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightgreen shape=rectangle]
			flash_attn_3_medium_7 [label="<b>Flash Attention</b><br/>pool_gpu_7<br/>Block: 8/8<br/>[batch=1024, seq=ceil(seq/8), 4096]" fillcolor=lightgreen shape=rectangle]
			reduce_3_medium [label="<b>Hierarchical Reduce</b><br/>8→8 GPUs<br/>Concatenate blocks" fillcolor=lightgray shape=diamond]
		}
	}
	subgraph cluster_long_scenario {
		color=lightyellow fontsize=11 label="8192-16384 tokens (16 pool GPUs)" style=rounded
		subgraph cluster_layer0_long {
			fontsize=10 label="Layer 0"
			q_proj_0_long_0 [label="<b>Q Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_0_long_0 [label="<b>K Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_0_long_0 [label="<b>V Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_0_long_0 [label="<b>Flash Attention</b><br/>pool_gpu_0<br/>Block: 1/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_0_long_1 [label="<b>Q Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_0_long_1 [label="<b>K Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_0_long_1 [label="<b>V Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_0_long_1 [label="<b>Flash Attention</b><br/>pool_gpu_1<br/>Block: 2/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_0_long_2 [label="<b>Q Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_0_long_2 [label="<b>K Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_0_long_2 [label="<b>V Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_0_long_2 [label="<b>Flash Attention</b><br/>pool_gpu_2<br/>Block: 3/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_0_long_3 [label="<b>Q Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_0_long_3 [label="<b>K Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_0_long_3 [label="<b>V Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_0_long_3 [label="<b>Flash Attention</b><br/>pool_gpu_3<br/>Block: 4/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_0_long_4 [label="<b>Q Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_0_long_4 [label="<b>K Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_0_long_4 [label="<b>V Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_0_long_4 [label="<b>Flash Attention</b><br/>pool_gpu_4<br/>Block: 5/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_0_long_5 [label="<b>Q Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_0_long_5 [label="<b>K Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_0_long_5 [label="<b>V Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_0_long_5 [label="<b>Flash Attention</b><br/>pool_gpu_5<br/>Block: 6/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_0_long_6 [label="<b>Q Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_0_long_6 [label="<b>K Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_0_long_6 [label="<b>V Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_0_long_6 [label="<b>Flash Attention</b><br/>pool_gpu_6<br/>Block: 7/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_0_long_7 [label="<b>Q Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_0_long_7 [label="<b>K Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_0_long_7 [label="<b>V Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_0_long_7 [label="<b>Flash Attention</b><br/>pool_gpu_7<br/>Block: 8/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_0_long_8 [label="<b>Q Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_0_long_8 [label="<b>K Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_0_long_8 [label="<b>V Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_0_long_8 [label="<b>Flash Attention</b><br/>pool_gpu_8<br/>Block: 9/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_0_long_9 [label="<b>Q Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_0_long_9 [label="<b>K Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_0_long_9 [label="<b>V Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_0_long_9 [label="<b>Flash Attention</b><br/>pool_gpu_9<br/>Block: 10/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_0_long_10 [label="<b>Q Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_0_long_10 [label="<b>K Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_0_long_10 [label="<b>V Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_0_long_10 [label="<b>Flash Attention</b><br/>pool_gpu_10<br/>Block: 11/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_0_long_11 [label="<b>Q Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_0_long_11 [label="<b>K Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_0_long_11 [label="<b>V Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_0_long_11 [label="<b>Flash Attention</b><br/>pool_gpu_11<br/>Block: 12/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_0_long_12 [label="<b>Q Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_0_long_12 [label="<b>K Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_0_long_12 [label="<b>V Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_0_long_12 [label="<b>Flash Attention</b><br/>pool_gpu_12<br/>Block: 13/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_0_long_13 [label="<b>Q Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_0_long_13 [label="<b>K Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_0_long_13 [label="<b>V Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_0_long_13 [label="<b>Flash Attention</b><br/>pool_gpu_13<br/>Block: 14/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_0_long_14 [label="<b>Q Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_0_long_14 [label="<b>K Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_0_long_14 [label="<b>V Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_0_long_14 [label="<b>Flash Attention</b><br/>pool_gpu_14<br/>Block: 15/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_0_long_15 [label="<b>Q Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_0_long_15 [label="<b>K Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_0_long_15 [label="<b>V Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_0_long_15 [label="<b>Flash Attention</b><br/>pool_gpu_15<br/>Block: 16/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			reduce_0_long [label="<b>Hierarchical Reduce</b><br/>16→8 GPUs<br/>Concatenate blocks" fillcolor=lightgray shape=diamond]
		}
		subgraph cluster_layer1_long {
			fontsize=10 label="Layer 1"
			q_proj_1_long_0 [label="<b>Q Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_1_long_0 [label="<b>K Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_1_long_0 [label="<b>V Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_1_long_0 [label="<b>Flash Attention</b><br/>pool_gpu_0<br/>Block: 1/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_1_long_1 [label="<b>Q Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_1_long_1 [label="<b>K Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_1_long_1 [label="<b>V Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_1_long_1 [label="<b>Flash Attention</b><br/>pool_gpu_1<br/>Block: 2/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_1_long_2 [label="<b>Q Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_1_long_2 [label="<b>K Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_1_long_2 [label="<b>V Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_1_long_2 [label="<b>Flash Attention</b><br/>pool_gpu_2<br/>Block: 3/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_1_long_3 [label="<b>Q Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_1_long_3 [label="<b>K Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_1_long_3 [label="<b>V Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_1_long_3 [label="<b>Flash Attention</b><br/>pool_gpu_3<br/>Block: 4/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_1_long_4 [label="<b>Q Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_1_long_4 [label="<b>K Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_1_long_4 [label="<b>V Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_1_long_4 [label="<b>Flash Attention</b><br/>pool_gpu_4<br/>Block: 5/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_1_long_5 [label="<b>Q Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_1_long_5 [label="<b>K Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_1_long_5 [label="<b>V Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_1_long_5 [label="<b>Flash Attention</b><br/>pool_gpu_5<br/>Block: 6/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_1_long_6 [label="<b>Q Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_1_long_6 [label="<b>K Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_1_long_6 [label="<b>V Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_1_long_6 [label="<b>Flash Attention</b><br/>pool_gpu_6<br/>Block: 7/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_1_long_7 [label="<b>Q Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_1_long_7 [label="<b>K Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_1_long_7 [label="<b>V Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_1_long_7 [label="<b>Flash Attention</b><br/>pool_gpu_7<br/>Block: 8/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_1_long_8 [label="<b>Q Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_1_long_8 [label="<b>K Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_1_long_8 [label="<b>V Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_1_long_8 [label="<b>Flash Attention</b><br/>pool_gpu_8<br/>Block: 9/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_1_long_9 [label="<b>Q Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_1_long_9 [label="<b>K Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_1_long_9 [label="<b>V Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_1_long_9 [label="<b>Flash Attention</b><br/>pool_gpu_9<br/>Block: 10/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_1_long_10 [label="<b>Q Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_1_long_10 [label="<b>K Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_1_long_10 [label="<b>V Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_1_long_10 [label="<b>Flash Attention</b><br/>pool_gpu_10<br/>Block: 11/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_1_long_11 [label="<b>Q Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_1_long_11 [label="<b>K Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_1_long_11 [label="<b>V Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_1_long_11 [label="<b>Flash Attention</b><br/>pool_gpu_11<br/>Block: 12/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_1_long_12 [label="<b>Q Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_1_long_12 [label="<b>K Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_1_long_12 [label="<b>V Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_1_long_12 [label="<b>Flash Attention</b><br/>pool_gpu_12<br/>Block: 13/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_1_long_13 [label="<b>Q Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_1_long_13 [label="<b>K Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_1_long_13 [label="<b>V Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_1_long_13 [label="<b>Flash Attention</b><br/>pool_gpu_13<br/>Block: 14/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_1_long_14 [label="<b>Q Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_1_long_14 [label="<b>K Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_1_long_14 [label="<b>V Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_1_long_14 [label="<b>Flash Attention</b><br/>pool_gpu_14<br/>Block: 15/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_1_long_15 [label="<b>Q Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_1_long_15 [label="<b>K Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_1_long_15 [label="<b>V Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_1_long_15 [label="<b>Flash Attention</b><br/>pool_gpu_15<br/>Block: 16/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			reduce_1_long [label="<b>Hierarchical Reduce</b><br/>16→8 GPUs<br/>Concatenate blocks" fillcolor=lightgray shape=diamond]
		}
		subgraph cluster_layer2_long {
			fontsize=10 label="Layer 2"
			q_proj_2_long_0 [label="<b>Q Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_2_long_0 [label="<b>K Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_2_long_0 [label="<b>V Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_2_long_0 [label="<b>Flash Attention</b><br/>pool_gpu_0<br/>Block: 1/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_2_long_1 [label="<b>Q Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_2_long_1 [label="<b>K Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_2_long_1 [label="<b>V Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_2_long_1 [label="<b>Flash Attention</b><br/>pool_gpu_1<br/>Block: 2/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_2_long_2 [label="<b>Q Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_2_long_2 [label="<b>K Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_2_long_2 [label="<b>V Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_2_long_2 [label="<b>Flash Attention</b><br/>pool_gpu_2<br/>Block: 3/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_2_long_3 [label="<b>Q Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_2_long_3 [label="<b>K Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_2_long_3 [label="<b>V Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_2_long_3 [label="<b>Flash Attention</b><br/>pool_gpu_3<br/>Block: 4/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_2_long_4 [label="<b>Q Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_2_long_4 [label="<b>K Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_2_long_4 [label="<b>V Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_2_long_4 [label="<b>Flash Attention</b><br/>pool_gpu_4<br/>Block: 5/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_2_long_5 [label="<b>Q Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_2_long_5 [label="<b>K Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_2_long_5 [label="<b>V Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_2_long_5 [label="<b>Flash Attention</b><br/>pool_gpu_5<br/>Block: 6/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_2_long_6 [label="<b>Q Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_2_long_6 [label="<b>K Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_2_long_6 [label="<b>V Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_2_long_6 [label="<b>Flash Attention</b><br/>pool_gpu_6<br/>Block: 7/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_2_long_7 [label="<b>Q Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_2_long_7 [label="<b>K Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_2_long_7 [label="<b>V Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_2_long_7 [label="<b>Flash Attention</b><br/>pool_gpu_7<br/>Block: 8/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_2_long_8 [label="<b>Q Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_2_long_8 [label="<b>K Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_2_long_8 [label="<b>V Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_2_long_8 [label="<b>Flash Attention</b><br/>pool_gpu_8<br/>Block: 9/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_2_long_9 [label="<b>Q Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_2_long_9 [label="<b>K Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_2_long_9 [label="<b>V Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_2_long_9 [label="<b>Flash Attention</b><br/>pool_gpu_9<br/>Block: 10/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_2_long_10 [label="<b>Q Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_2_long_10 [label="<b>K Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_2_long_10 [label="<b>V Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_2_long_10 [label="<b>Flash Attention</b><br/>pool_gpu_10<br/>Block: 11/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_2_long_11 [label="<b>Q Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_2_long_11 [label="<b>K Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_2_long_11 [label="<b>V Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_2_long_11 [label="<b>Flash Attention</b><br/>pool_gpu_11<br/>Block: 12/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_2_long_12 [label="<b>Q Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_2_long_12 [label="<b>K Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_2_long_12 [label="<b>V Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_2_long_12 [label="<b>Flash Attention</b><br/>pool_gpu_12<br/>Block: 13/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_2_long_13 [label="<b>Q Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_2_long_13 [label="<b>K Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_2_long_13 [label="<b>V Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_2_long_13 [label="<b>Flash Attention</b><br/>pool_gpu_13<br/>Block: 14/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_2_long_14 [label="<b>Q Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_2_long_14 [label="<b>K Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_2_long_14 [label="<b>V Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_2_long_14 [label="<b>Flash Attention</b><br/>pool_gpu_14<br/>Block: 15/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_2_long_15 [label="<b>Q Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_2_long_15 [label="<b>K Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_2_long_15 [label="<b>V Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_2_long_15 [label="<b>Flash Attention</b><br/>pool_gpu_15<br/>Block: 16/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			reduce_2_long [label="<b>Hierarchical Reduce</b><br/>16→8 GPUs<br/>Concatenate blocks" fillcolor=lightgray shape=diamond]
		}
		subgraph cluster_layer3_long {
			fontsize=10 label="Layer 3"
			q_proj_3_long_0 [label="<b>Q Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_3_long_0 [label="<b>K Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_3_long_0 [label="<b>V Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_3_long_0 [label="<b>Flash Attention</b><br/>pool_gpu_0<br/>Block: 1/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_3_long_1 [label="<b>Q Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_3_long_1 [label="<b>K Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_3_long_1 [label="<b>V Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_3_long_1 [label="<b>Flash Attention</b><br/>pool_gpu_1<br/>Block: 2/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_3_long_2 [label="<b>Q Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_3_long_2 [label="<b>K Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_3_long_2 [label="<b>V Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_3_long_2 [label="<b>Flash Attention</b><br/>pool_gpu_2<br/>Block: 3/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_3_long_3 [label="<b>Q Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_3_long_3 [label="<b>K Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_3_long_3 [label="<b>V Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_3_long_3 [label="<b>Flash Attention</b><br/>pool_gpu_3<br/>Block: 4/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_3_long_4 [label="<b>Q Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_3_long_4 [label="<b>K Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_3_long_4 [label="<b>V Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_3_long_4 [label="<b>Flash Attention</b><br/>pool_gpu_4<br/>Block: 5/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_3_long_5 [label="<b>Q Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_3_long_5 [label="<b>K Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_3_long_5 [label="<b>V Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_3_long_5 [label="<b>Flash Attention</b><br/>pool_gpu_5<br/>Block: 6/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_3_long_6 [label="<b>Q Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_3_long_6 [label="<b>K Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_3_long_6 [label="<b>V Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_3_long_6 [label="<b>Flash Attention</b><br/>pool_gpu_6<br/>Block: 7/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_3_long_7 [label="<b>Q Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_3_long_7 [label="<b>K Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_3_long_7 [label="<b>V Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_3_long_7 [label="<b>Flash Attention</b><br/>pool_gpu_7<br/>Block: 8/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_3_long_8 [label="<b>Q Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_3_long_8 [label="<b>K Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_3_long_8 [label="<b>V Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_3_long_8 [label="<b>Flash Attention</b><br/>pool_gpu_8<br/>Block: 9/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_3_long_9 [label="<b>Q Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_3_long_9 [label="<b>K Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_3_long_9 [label="<b>V Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_3_long_9 [label="<b>Flash Attention</b><br/>pool_gpu_9<br/>Block: 10/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_3_long_10 [label="<b>Q Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_3_long_10 [label="<b>K Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_3_long_10 [label="<b>V Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_3_long_10 [label="<b>Flash Attention</b><br/>pool_gpu_10<br/>Block: 11/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_3_long_11 [label="<b>Q Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_3_long_11 [label="<b>K Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_3_long_11 [label="<b>V Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_3_long_11 [label="<b>Flash Attention</b><br/>pool_gpu_11<br/>Block: 12/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_3_long_12 [label="<b>Q Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_3_long_12 [label="<b>K Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_3_long_12 [label="<b>V Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_3_long_12 [label="<b>Flash Attention</b><br/>pool_gpu_12<br/>Block: 13/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_3_long_13 [label="<b>Q Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_3_long_13 [label="<b>K Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_3_long_13 [label="<b>V Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_3_long_13 [label="<b>Flash Attention</b><br/>pool_gpu_13<br/>Block: 14/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_3_long_14 [label="<b>Q Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_3_long_14 [label="<b>K Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_3_long_14 [label="<b>V Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_3_long_14 [label="<b>Flash Attention</b><br/>pool_gpu_14<br/>Block: 15/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			q_proj_3_long_15 [label="<b>Q Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			k_proj_3_long_15 [label="<b>K Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			v_proj_3_long_15 [label="<b>V Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightyellow shape=rectangle]
			flash_attn_3_long_15 [label="<b>Flash Attention</b><br/>pool_gpu_15<br/>Block: 16/16<br/>[batch=1024, seq=ceil(seq/16), 4096]" fillcolor=lightyellow shape=rectangle]
			reduce_3_long [label="<b>Hierarchical Reduce</b><br/>16→8 GPUs<br/>Concatenate blocks" fillcolor=lightgray shape=diamond]
		}
	}
	subgraph cluster_very_long_scenario {
		color=lightcoral fontsize=11 label="> 16384 tokens (24 pool GPUs)" style=rounded
		subgraph cluster_layer0_very_long {
			fontsize=10 label="Layer 0"
			q_proj_0_very_long_0 [label="<b>Q Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_0 [label="<b>K Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_0 [label="<b>V Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_0 [label="<b>Flash Attention</b><br/>pool_gpu_0<br/>Block: 1/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_1 [label="<b>Q Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_1 [label="<b>K Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_1 [label="<b>V Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_1 [label="<b>Flash Attention</b><br/>pool_gpu_1<br/>Block: 2/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_2 [label="<b>Q Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_2 [label="<b>K Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_2 [label="<b>V Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_2 [label="<b>Flash Attention</b><br/>pool_gpu_2<br/>Block: 3/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_3 [label="<b>Q Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_3 [label="<b>K Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_3 [label="<b>V Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_3 [label="<b>Flash Attention</b><br/>pool_gpu_3<br/>Block: 4/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_4 [label="<b>Q Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_4 [label="<b>K Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_4 [label="<b>V Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_4 [label="<b>Flash Attention</b><br/>pool_gpu_4<br/>Block: 5/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_5 [label="<b>Q Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_5 [label="<b>K Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_5 [label="<b>V Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_5 [label="<b>Flash Attention</b><br/>pool_gpu_5<br/>Block: 6/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_6 [label="<b>Q Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_6 [label="<b>K Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_6 [label="<b>V Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_6 [label="<b>Flash Attention</b><br/>pool_gpu_6<br/>Block: 7/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_7 [label="<b>Q Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_7 [label="<b>K Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_7 [label="<b>V Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_7 [label="<b>Flash Attention</b><br/>pool_gpu_7<br/>Block: 8/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_8 [label="<b>Q Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_8 [label="<b>K Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_8 [label="<b>V Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_8 [label="<b>Flash Attention</b><br/>pool_gpu_8<br/>Block: 9/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_9 [label="<b>Q Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_9 [label="<b>K Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_9 [label="<b>V Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_9 [label="<b>Flash Attention</b><br/>pool_gpu_9<br/>Block: 10/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_10 [label="<b>Q Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_10 [label="<b>K Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_10 [label="<b>V Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_10 [label="<b>Flash Attention</b><br/>pool_gpu_10<br/>Block: 11/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_11 [label="<b>Q Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_11 [label="<b>K Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_11 [label="<b>V Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_11 [label="<b>Flash Attention</b><br/>pool_gpu_11<br/>Block: 12/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_12 [label="<b>Q Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_12 [label="<b>K Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_12 [label="<b>V Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_12 [label="<b>Flash Attention</b><br/>pool_gpu_12<br/>Block: 13/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_13 [label="<b>Q Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_13 [label="<b>K Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_13 [label="<b>V Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_13 [label="<b>Flash Attention</b><br/>pool_gpu_13<br/>Block: 14/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_14 [label="<b>Q Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_14 [label="<b>K Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_14 [label="<b>V Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_14 [label="<b>Flash Attention</b><br/>pool_gpu_14<br/>Block: 15/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_15 [label="<b>Q Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_15 [label="<b>K Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_15 [label="<b>V Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_15 [label="<b>Flash Attention</b><br/>pool_gpu_15<br/>Block: 16/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_16 [label="<b>Q Proj</b><br/>pool_gpu_16<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_16 [label="<b>K Proj</b><br/>pool_gpu_16<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_16 [label="<b>V Proj</b><br/>pool_gpu_16<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_16 [label="<b>Flash Attention</b><br/>pool_gpu_16<br/>Block: 17/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_17 [label="<b>Q Proj</b><br/>pool_gpu_17<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_17 [label="<b>K Proj</b><br/>pool_gpu_17<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_17 [label="<b>V Proj</b><br/>pool_gpu_17<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_17 [label="<b>Flash Attention</b><br/>pool_gpu_17<br/>Block: 18/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_18 [label="<b>Q Proj</b><br/>pool_gpu_18<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_18 [label="<b>K Proj</b><br/>pool_gpu_18<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_18 [label="<b>V Proj</b><br/>pool_gpu_18<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_18 [label="<b>Flash Attention</b><br/>pool_gpu_18<br/>Block: 19/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_19 [label="<b>Q Proj</b><br/>pool_gpu_19<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_19 [label="<b>K Proj</b><br/>pool_gpu_19<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_19 [label="<b>V Proj</b><br/>pool_gpu_19<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_19 [label="<b>Flash Attention</b><br/>pool_gpu_19<br/>Block: 20/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_20 [label="<b>Q Proj</b><br/>pool_gpu_20<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_20 [label="<b>K Proj</b><br/>pool_gpu_20<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_20 [label="<b>V Proj</b><br/>pool_gpu_20<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_20 [label="<b>Flash Attention</b><br/>pool_gpu_20<br/>Block: 21/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_21 [label="<b>Q Proj</b><br/>pool_gpu_21<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_21 [label="<b>K Proj</b><br/>pool_gpu_21<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_21 [label="<b>V Proj</b><br/>pool_gpu_21<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_21 [label="<b>Flash Attention</b><br/>pool_gpu_21<br/>Block: 22/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_22 [label="<b>Q Proj</b><br/>pool_gpu_22<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_22 [label="<b>K Proj</b><br/>pool_gpu_22<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_22 [label="<b>V Proj</b><br/>pool_gpu_22<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_22 [label="<b>Flash Attention</b><br/>pool_gpu_22<br/>Block: 23/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_0_very_long_23 [label="<b>Q Proj</b><br/>pool_gpu_23<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_0_very_long_23 [label="<b>K Proj</b><br/>pool_gpu_23<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_0_very_long_23 [label="<b>V Proj</b><br/>pool_gpu_23<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_0_very_long_23 [label="<b>Flash Attention</b><br/>pool_gpu_23<br/>Block: 24/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			reduce_0_very_long [label="<b>Hierarchical Reduce</b><br/>24→8 GPUs<br/>Concatenate blocks" fillcolor=lightgray shape=diamond]
		}
		subgraph cluster_layer1_very_long {
			fontsize=10 label="Layer 1"
			q_proj_1_very_long_0 [label="<b>Q Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_0 [label="<b>K Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_0 [label="<b>V Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_0 [label="<b>Flash Attention</b><br/>pool_gpu_0<br/>Block: 1/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_1 [label="<b>Q Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_1 [label="<b>K Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_1 [label="<b>V Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_1 [label="<b>Flash Attention</b><br/>pool_gpu_1<br/>Block: 2/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_2 [label="<b>Q Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_2 [label="<b>K Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_2 [label="<b>V Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_2 [label="<b>Flash Attention</b><br/>pool_gpu_2<br/>Block: 3/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_3 [label="<b>Q Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_3 [label="<b>K Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_3 [label="<b>V Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_3 [label="<b>Flash Attention</b><br/>pool_gpu_3<br/>Block: 4/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_4 [label="<b>Q Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_4 [label="<b>K Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_4 [label="<b>V Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_4 [label="<b>Flash Attention</b><br/>pool_gpu_4<br/>Block: 5/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_5 [label="<b>Q Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_5 [label="<b>K Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_5 [label="<b>V Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_5 [label="<b>Flash Attention</b><br/>pool_gpu_5<br/>Block: 6/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_6 [label="<b>Q Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_6 [label="<b>K Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_6 [label="<b>V Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_6 [label="<b>Flash Attention</b><br/>pool_gpu_6<br/>Block: 7/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_7 [label="<b>Q Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_7 [label="<b>K Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_7 [label="<b>V Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_7 [label="<b>Flash Attention</b><br/>pool_gpu_7<br/>Block: 8/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_8 [label="<b>Q Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_8 [label="<b>K Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_8 [label="<b>V Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_8 [label="<b>Flash Attention</b><br/>pool_gpu_8<br/>Block: 9/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_9 [label="<b>Q Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_9 [label="<b>K Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_9 [label="<b>V Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_9 [label="<b>Flash Attention</b><br/>pool_gpu_9<br/>Block: 10/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_10 [label="<b>Q Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_10 [label="<b>K Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_10 [label="<b>V Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_10 [label="<b>Flash Attention</b><br/>pool_gpu_10<br/>Block: 11/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_11 [label="<b>Q Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_11 [label="<b>K Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_11 [label="<b>V Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_11 [label="<b>Flash Attention</b><br/>pool_gpu_11<br/>Block: 12/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_12 [label="<b>Q Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_12 [label="<b>K Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_12 [label="<b>V Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_12 [label="<b>Flash Attention</b><br/>pool_gpu_12<br/>Block: 13/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_13 [label="<b>Q Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_13 [label="<b>K Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_13 [label="<b>V Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_13 [label="<b>Flash Attention</b><br/>pool_gpu_13<br/>Block: 14/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_14 [label="<b>Q Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_14 [label="<b>K Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_14 [label="<b>V Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_14 [label="<b>Flash Attention</b><br/>pool_gpu_14<br/>Block: 15/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_15 [label="<b>Q Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_15 [label="<b>K Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_15 [label="<b>V Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_15 [label="<b>Flash Attention</b><br/>pool_gpu_15<br/>Block: 16/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_16 [label="<b>Q Proj</b><br/>pool_gpu_16<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_16 [label="<b>K Proj</b><br/>pool_gpu_16<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_16 [label="<b>V Proj</b><br/>pool_gpu_16<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_16 [label="<b>Flash Attention</b><br/>pool_gpu_16<br/>Block: 17/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_17 [label="<b>Q Proj</b><br/>pool_gpu_17<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_17 [label="<b>K Proj</b><br/>pool_gpu_17<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_17 [label="<b>V Proj</b><br/>pool_gpu_17<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_17 [label="<b>Flash Attention</b><br/>pool_gpu_17<br/>Block: 18/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_18 [label="<b>Q Proj</b><br/>pool_gpu_18<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_18 [label="<b>K Proj</b><br/>pool_gpu_18<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_18 [label="<b>V Proj</b><br/>pool_gpu_18<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_18 [label="<b>Flash Attention</b><br/>pool_gpu_18<br/>Block: 19/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_19 [label="<b>Q Proj</b><br/>pool_gpu_19<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_19 [label="<b>K Proj</b><br/>pool_gpu_19<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_19 [label="<b>V Proj</b><br/>pool_gpu_19<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_19 [label="<b>Flash Attention</b><br/>pool_gpu_19<br/>Block: 20/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_20 [label="<b>Q Proj</b><br/>pool_gpu_20<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_20 [label="<b>K Proj</b><br/>pool_gpu_20<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_20 [label="<b>V Proj</b><br/>pool_gpu_20<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_20 [label="<b>Flash Attention</b><br/>pool_gpu_20<br/>Block: 21/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_21 [label="<b>Q Proj</b><br/>pool_gpu_21<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_21 [label="<b>K Proj</b><br/>pool_gpu_21<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_21 [label="<b>V Proj</b><br/>pool_gpu_21<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_21 [label="<b>Flash Attention</b><br/>pool_gpu_21<br/>Block: 22/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_22 [label="<b>Q Proj</b><br/>pool_gpu_22<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_22 [label="<b>K Proj</b><br/>pool_gpu_22<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_22 [label="<b>V Proj</b><br/>pool_gpu_22<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_22 [label="<b>Flash Attention</b><br/>pool_gpu_22<br/>Block: 23/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_1_very_long_23 [label="<b>Q Proj</b><br/>pool_gpu_23<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_1_very_long_23 [label="<b>K Proj</b><br/>pool_gpu_23<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_1_very_long_23 [label="<b>V Proj</b><br/>pool_gpu_23<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_1_very_long_23 [label="<b>Flash Attention</b><br/>pool_gpu_23<br/>Block: 24/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			reduce_1_very_long [label="<b>Hierarchical Reduce</b><br/>24→8 GPUs<br/>Concatenate blocks" fillcolor=lightgray shape=diamond]
		}
		subgraph cluster_layer2_very_long {
			fontsize=10 label="Layer 2"
			q_proj_2_very_long_0 [label="<b>Q Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_0 [label="<b>K Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_0 [label="<b>V Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_0 [label="<b>Flash Attention</b><br/>pool_gpu_0<br/>Block: 1/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_1 [label="<b>Q Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_1 [label="<b>K Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_1 [label="<b>V Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_1 [label="<b>Flash Attention</b><br/>pool_gpu_1<br/>Block: 2/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_2 [label="<b>Q Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_2 [label="<b>K Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_2 [label="<b>V Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_2 [label="<b>Flash Attention</b><br/>pool_gpu_2<br/>Block: 3/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_3 [label="<b>Q Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_3 [label="<b>K Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_3 [label="<b>V Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_3 [label="<b>Flash Attention</b><br/>pool_gpu_3<br/>Block: 4/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_4 [label="<b>Q Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_4 [label="<b>K Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_4 [label="<b>V Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_4 [label="<b>Flash Attention</b><br/>pool_gpu_4<br/>Block: 5/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_5 [label="<b>Q Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_5 [label="<b>K Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_5 [label="<b>V Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_5 [label="<b>Flash Attention</b><br/>pool_gpu_5<br/>Block: 6/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_6 [label="<b>Q Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_6 [label="<b>K Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_6 [label="<b>V Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_6 [label="<b>Flash Attention</b><br/>pool_gpu_6<br/>Block: 7/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_7 [label="<b>Q Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_7 [label="<b>K Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_7 [label="<b>V Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_7 [label="<b>Flash Attention</b><br/>pool_gpu_7<br/>Block: 8/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_8 [label="<b>Q Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_8 [label="<b>K Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_8 [label="<b>V Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_8 [label="<b>Flash Attention</b><br/>pool_gpu_8<br/>Block: 9/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_9 [label="<b>Q Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_9 [label="<b>K Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_9 [label="<b>V Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_9 [label="<b>Flash Attention</b><br/>pool_gpu_9<br/>Block: 10/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_10 [label="<b>Q Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_10 [label="<b>K Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_10 [label="<b>V Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_10 [label="<b>Flash Attention</b><br/>pool_gpu_10<br/>Block: 11/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_11 [label="<b>Q Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_11 [label="<b>K Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_11 [label="<b>V Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_11 [label="<b>Flash Attention</b><br/>pool_gpu_11<br/>Block: 12/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_12 [label="<b>Q Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_12 [label="<b>K Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_12 [label="<b>V Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_12 [label="<b>Flash Attention</b><br/>pool_gpu_12<br/>Block: 13/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_13 [label="<b>Q Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_13 [label="<b>K Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_13 [label="<b>V Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_13 [label="<b>Flash Attention</b><br/>pool_gpu_13<br/>Block: 14/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_14 [label="<b>Q Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_14 [label="<b>K Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_14 [label="<b>V Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_14 [label="<b>Flash Attention</b><br/>pool_gpu_14<br/>Block: 15/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_15 [label="<b>Q Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_15 [label="<b>K Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_15 [label="<b>V Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_15 [label="<b>Flash Attention</b><br/>pool_gpu_15<br/>Block: 16/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_16 [label="<b>Q Proj</b><br/>pool_gpu_16<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_16 [label="<b>K Proj</b><br/>pool_gpu_16<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_16 [label="<b>V Proj</b><br/>pool_gpu_16<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_16 [label="<b>Flash Attention</b><br/>pool_gpu_16<br/>Block: 17/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_17 [label="<b>Q Proj</b><br/>pool_gpu_17<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_17 [label="<b>K Proj</b><br/>pool_gpu_17<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_17 [label="<b>V Proj</b><br/>pool_gpu_17<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_17 [label="<b>Flash Attention</b><br/>pool_gpu_17<br/>Block: 18/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_18 [label="<b>Q Proj</b><br/>pool_gpu_18<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_18 [label="<b>K Proj</b><br/>pool_gpu_18<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_18 [label="<b>V Proj</b><br/>pool_gpu_18<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_18 [label="<b>Flash Attention</b><br/>pool_gpu_18<br/>Block: 19/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_19 [label="<b>Q Proj</b><br/>pool_gpu_19<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_19 [label="<b>K Proj</b><br/>pool_gpu_19<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_19 [label="<b>V Proj</b><br/>pool_gpu_19<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_19 [label="<b>Flash Attention</b><br/>pool_gpu_19<br/>Block: 20/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_20 [label="<b>Q Proj</b><br/>pool_gpu_20<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_20 [label="<b>K Proj</b><br/>pool_gpu_20<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_20 [label="<b>V Proj</b><br/>pool_gpu_20<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_20 [label="<b>Flash Attention</b><br/>pool_gpu_20<br/>Block: 21/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_21 [label="<b>Q Proj</b><br/>pool_gpu_21<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_21 [label="<b>K Proj</b><br/>pool_gpu_21<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_21 [label="<b>V Proj</b><br/>pool_gpu_21<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_21 [label="<b>Flash Attention</b><br/>pool_gpu_21<br/>Block: 22/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_22 [label="<b>Q Proj</b><br/>pool_gpu_22<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_22 [label="<b>K Proj</b><br/>pool_gpu_22<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_22 [label="<b>V Proj</b><br/>pool_gpu_22<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_22 [label="<b>Flash Attention</b><br/>pool_gpu_22<br/>Block: 23/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_2_very_long_23 [label="<b>Q Proj</b><br/>pool_gpu_23<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_2_very_long_23 [label="<b>K Proj</b><br/>pool_gpu_23<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_2_very_long_23 [label="<b>V Proj</b><br/>pool_gpu_23<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_2_very_long_23 [label="<b>Flash Attention</b><br/>pool_gpu_23<br/>Block: 24/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			reduce_2_very_long [label="<b>Hierarchical Reduce</b><br/>24→8 GPUs<br/>Concatenate blocks" fillcolor=lightgray shape=diamond]
		}
		subgraph cluster_layer3_very_long {
			fontsize=10 label="Layer 3"
			q_proj_3_very_long_0 [label="<b>Q Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_0 [label="<b>K Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_0 [label="<b>V Proj</b><br/>pool_gpu_0<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_0 [label="<b>Flash Attention</b><br/>pool_gpu_0<br/>Block: 1/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_1 [label="<b>Q Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_1 [label="<b>K Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_1 [label="<b>V Proj</b><br/>pool_gpu_1<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_1 [label="<b>Flash Attention</b><br/>pool_gpu_1<br/>Block: 2/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_2 [label="<b>Q Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_2 [label="<b>K Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_2 [label="<b>V Proj</b><br/>pool_gpu_2<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_2 [label="<b>Flash Attention</b><br/>pool_gpu_2<br/>Block: 3/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_3 [label="<b>Q Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_3 [label="<b>K Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_3 [label="<b>V Proj</b><br/>pool_gpu_3<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_3 [label="<b>Flash Attention</b><br/>pool_gpu_3<br/>Block: 4/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_4 [label="<b>Q Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_4 [label="<b>K Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_4 [label="<b>V Proj</b><br/>pool_gpu_4<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_4 [label="<b>Flash Attention</b><br/>pool_gpu_4<br/>Block: 5/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_5 [label="<b>Q Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_5 [label="<b>K Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_5 [label="<b>V Proj</b><br/>pool_gpu_5<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_5 [label="<b>Flash Attention</b><br/>pool_gpu_5<br/>Block: 6/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_6 [label="<b>Q Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_6 [label="<b>K Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_6 [label="<b>V Proj</b><br/>pool_gpu_6<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_6 [label="<b>Flash Attention</b><br/>pool_gpu_6<br/>Block: 7/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_7 [label="<b>Q Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_7 [label="<b>K Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_7 [label="<b>V Proj</b><br/>pool_gpu_7<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_7 [label="<b>Flash Attention</b><br/>pool_gpu_7<br/>Block: 8/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_8 [label="<b>Q Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_8 [label="<b>K Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_8 [label="<b>V Proj</b><br/>pool_gpu_8<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_8 [label="<b>Flash Attention</b><br/>pool_gpu_8<br/>Block: 9/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_9 [label="<b>Q Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_9 [label="<b>K Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_9 [label="<b>V Proj</b><br/>pool_gpu_9<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_9 [label="<b>Flash Attention</b><br/>pool_gpu_9<br/>Block: 10/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_10 [label="<b>Q Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_10 [label="<b>K Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_10 [label="<b>V Proj</b><br/>pool_gpu_10<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_10 [label="<b>Flash Attention</b><br/>pool_gpu_10<br/>Block: 11/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_11 [label="<b>Q Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_11 [label="<b>K Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_11 [label="<b>V Proj</b><br/>pool_gpu_11<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_11 [label="<b>Flash Attention</b><br/>pool_gpu_11<br/>Block: 12/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_12 [label="<b>Q Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_12 [label="<b>K Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_12 [label="<b>V Proj</b><br/>pool_gpu_12<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_12 [label="<b>Flash Attention</b><br/>pool_gpu_12<br/>Block: 13/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_13 [label="<b>Q Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_13 [label="<b>K Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_13 [label="<b>V Proj</b><br/>pool_gpu_13<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_13 [label="<b>Flash Attention</b><br/>pool_gpu_13<br/>Block: 14/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_14 [label="<b>Q Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_14 [label="<b>K Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_14 [label="<b>V Proj</b><br/>pool_gpu_14<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_14 [label="<b>Flash Attention</b><br/>pool_gpu_14<br/>Block: 15/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_15 [label="<b>Q Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_15 [label="<b>K Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_15 [label="<b>V Proj</b><br/>pool_gpu_15<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_15 [label="<b>Flash Attention</b><br/>pool_gpu_15<br/>Block: 16/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_16 [label="<b>Q Proj</b><br/>pool_gpu_16<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_16 [label="<b>K Proj</b><br/>pool_gpu_16<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_16 [label="<b>V Proj</b><br/>pool_gpu_16<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_16 [label="<b>Flash Attention</b><br/>pool_gpu_16<br/>Block: 17/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_17 [label="<b>Q Proj</b><br/>pool_gpu_17<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_17 [label="<b>K Proj</b><br/>pool_gpu_17<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_17 [label="<b>V Proj</b><br/>pool_gpu_17<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_17 [label="<b>Flash Attention</b><br/>pool_gpu_17<br/>Block: 18/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_18 [label="<b>Q Proj</b><br/>pool_gpu_18<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_18 [label="<b>K Proj</b><br/>pool_gpu_18<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_18 [label="<b>V Proj</b><br/>pool_gpu_18<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_18 [label="<b>Flash Attention</b><br/>pool_gpu_18<br/>Block: 19/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_19 [label="<b>Q Proj</b><br/>pool_gpu_19<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_19 [label="<b>K Proj</b><br/>pool_gpu_19<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_19 [label="<b>V Proj</b><br/>pool_gpu_19<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_19 [label="<b>Flash Attention</b><br/>pool_gpu_19<br/>Block: 20/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_20 [label="<b>Q Proj</b><br/>pool_gpu_20<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_20 [label="<b>K Proj</b><br/>pool_gpu_20<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_20 [label="<b>V Proj</b><br/>pool_gpu_20<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_20 [label="<b>Flash Attention</b><br/>pool_gpu_20<br/>Block: 21/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_21 [label="<b>Q Proj</b><br/>pool_gpu_21<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_21 [label="<b>K Proj</b><br/>pool_gpu_21<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_21 [label="<b>V Proj</b><br/>pool_gpu_21<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_21 [label="<b>Flash Attention</b><br/>pool_gpu_21<br/>Block: 22/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_22 [label="<b>Q Proj</b><br/>pool_gpu_22<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_22 [label="<b>K Proj</b><br/>pool_gpu_22<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_22 [label="<b>V Proj</b><br/>pool_gpu_22<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_22 [label="<b>Flash Attention</b><br/>pool_gpu_22<br/>Block: 23/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			q_proj_3_very_long_23 [label="<b>Q Proj</b><br/>pool_gpu_23<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			k_proj_3_very_long_23 [label="<b>K Proj</b><br/>pool_gpu_23<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			v_proj_3_very_long_23 [label="<b>V Proj</b><br/>pool_gpu_23<br/>[512→(32×16)]" fillcolor=lightcoral shape=rectangle]
			flash_attn_3_very_long_23 [label="<b>Flash Attention</b><br/>pool_gpu_23<br/>Block: 24/24<br/>[batch=1024, seq=ceil(seq/24), 4096]" fillcolor=lightcoral shape=rectangle]
			reduce_3_very_long [label="<b>Hierarchical Reduce</b><br/>24→8 GPUs<br/>Concatenate blocks" fillcolor=lightgray shape=diamond]
		}
	}
	kv_broadcast [label="<b>KV Cache Broadcast</b><br/>Replicates K,V tensors<br/>Across all attention GPUs" fillcolor=lightyellow shape=parallelogram style=dashed]
	async_overlap [label="<b>Async Overlap</b><br/>Attention computation<br/>Overlaps with FFN<br/>85% efficiency" fillcolor=lightyellow shape=parallelogram]
	output_agg [label="<b>Output Aggregation</b><br/>Final result from base GPUs<br/>[batch=1024, seq=?, vocab=32000]" fillcolor=lightblue shape=ellipse]
	input -> seq_analyzer
	seq_analyzer -> q_proj_0_short_0 [label="< 4096"]
	seq_analyzer -> q_proj_0_medium_0 [label="4096-8192"]
	seq_analyzer -> q_proj_0_long_0 [label="8192-16384"]
	seq_analyzer -> q_proj_0_very_long_0 [label="> 16384"]
	q_proj_0_short_0 -> flash_attn_0_short_0
	k_proj_0_short_0 -> flash_attn_0_short_0
	v_proj_0_short_0 -> flash_attn_0_short_0
	kv_broadcast -> flash_attn_0_short_0
	q_proj_0_short_1 -> flash_attn_0_short_1
	k_proj_0_short_1 -> flash_attn_0_short_1
	v_proj_0_short_1 -> flash_attn_0_short_1
	kv_broadcast -> flash_attn_0_short_1
	q_proj_0_short_2 -> flash_attn_0_short_2
	k_proj_0_short_2 -> flash_attn_0_short_2
	v_proj_0_short_2 -> flash_attn_0_short_2
	kv_broadcast -> flash_attn_0_short_2
	q_proj_0_short_3 -> flash_attn_0_short_3
	k_proj_0_short_3 -> flash_attn_0_short_3
	v_proj_0_short_3 -> flash_attn_0_short_3
	kv_broadcast -> flash_attn_0_short_3
	q_proj_0_short_4 -> flash_attn_0_short_4
	k_proj_0_short_4 -> flash_attn_0_short_4
	v_proj_0_short_4 -> flash_attn_0_short_4
	kv_broadcast -> flash_attn_0_short_4
	q_proj_0_short_5 -> flash_attn_0_short_5
	k_proj_0_short_5 -> flash_attn_0_short_5
	v_proj_0_short_5 -> flash_attn_0_short_5
	kv_broadcast -> flash_attn_0_short_5
	q_proj_0_short_6 -> flash_attn_0_short_6
	k_proj_0_short_6 -> flash_attn_0_short_6
	v_proj_0_short_6 -> flash_attn_0_short_6
	kv_broadcast -> flash_attn_0_short_6
	q_proj_0_short_7 -> flash_attn_0_short_7
	k_proj_0_short_7 -> flash_attn_0_short_7
	v_proj_0_short_7 -> flash_attn_0_short_7
	kv_broadcast -> flash_attn_0_short_7
	flash_attn_0_short_0 -> base_ffn_up_l0_0
	flash_attn_0_short_1 -> base_ffn_up_l0_1
	flash_attn_0_short_2 -> base_ffn_up_l0_2
	flash_attn_0_short_3 -> base_ffn_up_l0_3
	flash_attn_0_short_4 -> base_ffn_up_l0_4
	flash_attn_0_short_5 -> base_ffn_up_l0_5
	flash_attn_0_short_6 -> base_ffn_up_l0_6
	flash_attn_0_short_7 -> base_ffn_up_l0_7
	q_proj_0_medium_0 -> flash_attn_0_medium_0
	k_proj_0_medium_0 -> flash_attn_0_medium_0
	v_proj_0_medium_0 -> flash_attn_0_medium_0
	kv_broadcast -> flash_attn_0_medium_0
	q_proj_0_medium_1 -> flash_attn_0_medium_1
	k_proj_0_medium_1 -> flash_attn_0_medium_1
	v_proj_0_medium_1 -> flash_attn_0_medium_1
	kv_broadcast -> flash_attn_0_medium_1
	q_proj_0_medium_2 -> flash_attn_0_medium_2
	k_proj_0_medium_2 -> flash_attn_0_medium_2
	v_proj_0_medium_2 -> flash_attn_0_medium_2
	kv_broadcast -> flash_attn_0_medium_2
	q_proj_0_medium_3 -> flash_attn_0_medium_3
	k_proj_0_medium_3 -> flash_attn_0_medium_3
	v_proj_0_medium_3 -> flash_attn_0_medium_3
	kv_broadcast -> flash_attn_0_medium_3
	q_proj_0_medium_4 -> flash_attn_0_medium_4
	k_proj_0_medium_4 -> flash_attn_0_medium_4
	v_proj_0_medium_4 -> flash_attn_0_medium_4
	kv_broadcast -> flash_attn_0_medium_4
	q_proj_0_medium_5 -> flash_attn_0_medium_5
	k_proj_0_medium_5 -> flash_attn_0_medium_5
	v_proj_0_medium_5 -> flash_attn_0_medium_5
	kv_broadcast -> flash_attn_0_medium_5
	q_proj_0_medium_6 -> flash_attn_0_medium_6
	k_proj_0_medium_6 -> flash_attn_0_medium_6
	v_proj_0_medium_6 -> flash_attn_0_medium_6
	kv_broadcast -> flash_attn_0_medium_6
	q_proj_0_medium_7 -> flash_attn_0_medium_7
	k_proj_0_medium_7 -> flash_attn_0_medium_7
	v_proj_0_medium_7 -> flash_attn_0_medium_7
	kv_broadcast -> flash_attn_0_medium_7
	flash_attn_0_medium_0 -> reduce_0_medium
	flash_attn_0_medium_1 -> reduce_0_medium
	flash_attn_0_medium_2 -> reduce_0_medium
	flash_attn_0_medium_3 -> reduce_0_medium
	flash_attn_0_medium_4 -> reduce_0_medium
	flash_attn_0_medium_5 -> reduce_0_medium
	flash_attn_0_medium_6 -> reduce_0_medium
	flash_attn_0_medium_7 -> reduce_0_medium
	reduce_0_medium -> base_ffn_up_l0_0
	reduce_0_medium -> base_ffn_up_l0_1
	reduce_0_medium -> base_ffn_up_l0_2
	reduce_0_medium -> base_ffn_up_l0_3
	reduce_0_medium -> base_ffn_up_l0_4
	reduce_0_medium -> base_ffn_up_l0_5
	reduce_0_medium -> base_ffn_up_l0_6
	reduce_0_medium -> base_ffn_up_l0_7
	q_proj_0_long_0 -> flash_attn_0_long_0
	k_proj_0_long_0 -> flash_attn_0_long_0
	v_proj_0_long_0 -> flash_attn_0_long_0
	kv_broadcast -> flash_attn_0_long_0
	q_proj_0_long_1 -> flash_attn_0_long_1
	k_proj_0_long_1 -> flash_attn_0_long_1
	v_proj_0_long_1 -> flash_attn_0_long_1
	kv_broadcast -> flash_attn_0_long_1
	q_proj_0_long_2 -> flash_attn_0_long_2
	k_proj_0_long_2 -> flash_attn_0_long_2
	v_proj_0_long_2 -> flash_attn_0_long_2
	kv_broadcast -> flash_attn_0_long_2
	q_proj_0_long_3 -> flash_attn_0_long_3
	k_proj_0_long_3 -> flash_attn_0_long_3
	v_proj_0_long_3 -> flash_attn_0_long_3
	kv_broadcast -> flash_attn_0_long_3
	q_proj_0_long_4 -> flash_attn_0_long_4
	k_proj_0_long_4 -> flash_attn_0_long_4
	v_proj_0_long_4 -> flash_attn_0_long_4
	kv_broadcast -> flash_attn_0_long_4
	q_proj_0_long_5 -> flash_attn_0_long_5
	k_proj_0_long_5 -> flash_attn_0_long_5
	v_proj_0_long_5 -> flash_attn_0_long_5
	kv_broadcast -> flash_attn_0_long_5
	q_proj_0_long_6 -> flash_attn_0_long_6
	k_proj_0_long_6 -> flash_attn_0_long_6
	v_proj_0_long_6 -> flash_attn_0_long_6
	kv_broadcast -> flash_attn_0_long_6
	q_proj_0_long_7 -> flash_attn_0_long_7
	k_proj_0_long_7 -> flash_attn_0_long_7
	v_proj_0_long_7 -> flash_attn_0_long_7
	kv_broadcast -> flash_attn_0_long_7
	q_proj_0_long_8 -> flash_attn_0_long_8
	k_proj_0_long_8 -> flash_attn_0_long_8
	v_proj_0_long_8 -> flash_attn_0_long_8
	kv_broadcast -> flash_attn_0_long_8
	q_proj_0_long_9 -> flash_attn_0_long_9
	k_proj_0_long_9 -> flash_attn_0_long_9
	v_proj_0_long_9 -> flash_attn_0_long_9
	kv_broadcast -> flash_attn_0_long_9
	q_proj_0_long_10 -> flash_attn_0_long_10
	k_proj_0_long_10 -> flash_attn_0_long_10
	v_proj_0_long_10 -> flash_attn_0_long_10
	kv_broadcast -> flash_attn_0_long_10
	q_proj_0_long_11 -> flash_attn_0_long_11
	k_proj_0_long_11 -> flash_attn_0_long_11
	v_proj_0_long_11 -> flash_attn_0_long_11
	kv_broadcast -> flash_attn_0_long_11
	q_proj_0_long_12 -> flash_attn_0_long_12
	k_proj_0_long_12 -> flash_attn_0_long_12
	v_proj_0_long_12 -> flash_attn_0_long_12
	kv_broadcast -> flash_attn_0_long_12
	q_proj_0_long_13 -> flash_attn_0_long_13
	k_proj_0_long_13 -> flash_attn_0_long_13
	v_proj_0_long_13 -> flash_attn_0_long_13
	kv_broadcast -> flash_attn_0_long_13
	q_proj_0_long_14 -> flash_attn_0_long_14
	k_proj_0_long_14 -> flash_attn_0_long_14
	v_proj_0_long_14 -> flash_attn_0_long_14
	kv_broadcast -> flash_attn_0_long_14
	q_proj_0_long_15 -> flash_attn_0_long_15
	k_proj_0_long_15 -> flash_attn_0_long_15
	v_proj_0_long_15 -> flash_attn_0_long_15
	kv_broadcast -> flash_attn_0_long_15
	flash_attn_0_long_0 -> reduce_0_long
	flash_attn_0_long_1 -> reduce_0_long
	flash_attn_0_long_2 -> reduce_0_long
	flash_attn_0_long_3 -> reduce_0_long
	flash_attn_0_long_4 -> reduce_0_long
	flash_attn_0_long_5 -> reduce_0_long
	flash_attn_0_long_6 -> reduce_0_long
	flash_attn_0_long_7 -> reduce_0_long
	flash_attn_0_long_8 -> reduce_0_long
	flash_attn_0_long_9 -> reduce_0_long
	flash_attn_0_long_10 -> reduce_0_long
	flash_attn_0_long_11 -> reduce_0_long
	flash_attn_0_long_12 -> reduce_0_long
	flash_attn_0_long_13 -> reduce_0_long
	flash_attn_0_long_14 -> reduce_0_long
	flash_attn_0_long_15 -> reduce_0_long
	reduce_0_long -> base_ffn_up_l0_0
	reduce_0_long -> base_ffn_up_l0_1
	reduce_0_long -> base_ffn_up_l0_2
	reduce_0_long -> base_ffn_up_l0_3
	reduce_0_long -> base_ffn_up_l0_4
	reduce_0_long -> base_ffn_up_l0_5
	reduce_0_long -> base_ffn_up_l0_6
	reduce_0_long -> base_ffn_up_l0_7
	q_proj_0_very_long_0 -> flash_attn_0_very_long_0
	k_proj_0_very_long_0 -> flash_attn_0_very_long_0
	v_proj_0_very_long_0 -> flash_attn_0_very_long_0
	kv_broadcast -> flash_attn_0_very_long_0
	q_proj_0_very_long_1 -> flash_attn_0_very_long_1
	k_proj_0_very_long_1 -> flash_attn_0_very_long_1
	v_proj_0_very_long_1 -> flash_attn_0_very_long_1
	kv_broadcast -> flash_attn_0_very_long_1
	q_proj_0_very_long_2 -> flash_attn_0_very_long_2
	k_proj_0_very_long_2 -> flash_attn_0_very_long_2
	v_proj_0_very_long_2 -> flash_attn_0_very_long_2
	kv_broadcast -> flash_attn_0_very_long_2
	q_proj_0_very_long_3 -> flash_attn_0_very_long_3
	k_proj_0_very_long_3 -> flash_attn_0_very_long_3
	v_proj_0_very_long_3 -> flash_attn_0_very_long_3
	kv_broadcast -> flash_attn_0_very_long_3
	q_proj_0_very_long_4 -> flash_attn_0_very_long_4
	k_proj_0_very_long_4 -> flash_attn_0_very_long_4
	v_proj_0_very_long_4 -> flash_attn_0_very_long_4
	kv_broadcast -> flash_attn_0_very_long_4
	q_proj_0_very_long_5 -> flash_attn_0_very_long_5
	k_proj_0_very_long_5 -> flash_attn_0_very_long_5
	v_proj_0_very_long_5 -> flash_attn_0_very_long_5
	kv_broadcast -> flash_attn_0_very_long_5
	q_proj_0_very_long_6 -> flash_attn_0_very_long_6
	k_proj_0_very_long_6 -> flash_attn_0_very_long_6
	v_proj_0_very_long_6 -> flash_attn_0_very_long_6
	kv_broadcast -> flash_attn_0_very_long_6
	q_proj_0_very_long_7 -> flash_attn_0_very_long_7
	k_proj_0_very_long_7 -> flash_attn_0_very_long_7
	v_proj_0_very_long_7 -> flash_attn_0_very_long_7
	kv_broadcast -> flash_attn_0_very_long_7
	q_proj_0_very_long_8 -> flash_attn_0_very_long_8
	k_proj_0_very_long_8 -> flash_attn_0_very_long_8
	v_proj_0_very_long_8 -> flash_attn_0_very_long_8
	kv_broadcast -> flash_attn_0_very_long_8
	q_proj_0_very_long_9 -> flash_attn_0_very_long_9
	k_proj_0_very_long_9 -> flash_attn_0_very_long_9
	v_proj_0_very_long_9 -> flash_attn_0_very_long_9
	kv_broadcast -> flash_attn_0_very_long_9
	q_proj_0_very_long_10 -> flash_attn_0_very_long_10
	k_proj_0_very_long_10 -> flash_attn_0_very_long_10
	v_proj_0_very_long_10 -> flash_attn_0_very_long_10
	kv_broadcast -> flash_attn_0_very_long_10
	q_proj_0_very_long_11 -> flash_attn_0_very_long_11
	k_proj_0_very_long_11 -> flash_attn_0_very_long_11
	v_proj_0_very_long_11 -> flash_attn_0_very_long_11
	kv_broadcast -> flash_attn_0_very_long_11
	q_proj_0_very_long_12 -> flash_attn_0_very_long_12
	k_proj_0_very_long_12 -> flash_attn_0_very_long_12
	v_proj_0_very_long_12 -> flash_attn_0_very_long_12
	kv_broadcast -> flash_attn_0_very_long_12
	q_proj_0_very_long_13 -> flash_attn_0_very_long_13
	k_proj_0_very_long_13 -> flash_attn_0_very_long_13
	v_proj_0_very_long_13 -> flash_attn_0_very_long_13
	kv_broadcast -> flash_attn_0_very_long_13
	q_proj_0_very_long_14 -> flash_attn_0_very_long_14
	k_proj_0_very_long_14 -> flash_attn_0_very_long_14
	v_proj_0_very_long_14 -> flash_attn_0_very_long_14
	kv_broadcast -> flash_attn_0_very_long_14
	q_proj_0_very_long_15 -> flash_attn_0_very_long_15
	k_proj_0_very_long_15 -> flash_attn_0_very_long_15
	v_proj_0_very_long_15 -> flash_attn_0_very_long_15
	kv_broadcast -> flash_attn_0_very_long_15
	q_proj_0_very_long_16 -> flash_attn_0_very_long_16
	k_proj_0_very_long_16 -> flash_attn_0_very_long_16
	v_proj_0_very_long_16 -> flash_attn_0_very_long_16
	kv_broadcast -> flash_attn_0_very_long_16
	q_proj_0_very_long_17 -> flash_attn_0_very_long_17
	k_proj_0_very_long_17 -> flash_attn_0_very_long_17
	v_proj_0_very_long_17 -> flash_attn_0_very_long_17
	kv_broadcast -> flash_attn_0_very_long_17
	q_proj_0_very_long_18 -> flash_attn_0_very_long_18
	k_proj_0_very_long_18 -> flash_attn_0_very_long_18
	v_proj_0_very_long_18 -> flash_attn_0_very_long_18
	kv_broadcast -> flash_attn_0_very_long_18
	q_proj_0_very_long_19 -> flash_attn_0_very_long_19
	k_proj_0_very_long_19 -> flash_attn_0_very_long_19
	v_proj_0_very_long_19 -> flash_attn_0_very_long_19
	kv_broadcast -> flash_attn_0_very_long_19
	q_proj_0_very_long_20 -> flash_attn_0_very_long_20
	k_proj_0_very_long_20 -> flash_attn_0_very_long_20
	v_proj_0_very_long_20 -> flash_attn_0_very_long_20
	kv_broadcast -> flash_attn_0_very_long_20
	q_proj_0_very_long_21 -> flash_attn_0_very_long_21
	k_proj_0_very_long_21 -> flash_attn_0_very_long_21
	v_proj_0_very_long_21 -> flash_attn_0_very_long_21
	kv_broadcast -> flash_attn_0_very_long_21
	q_proj_0_very_long_22 -> flash_attn_0_very_long_22
	k_proj_0_very_long_22 -> flash_attn_0_very_long_22
	v_proj_0_very_long_22 -> flash_attn_0_very_long_22
	kv_broadcast -> flash_attn_0_very_long_22
	q_proj_0_very_long_23 -> flash_attn_0_very_long_23
	k_proj_0_very_long_23 -> flash_attn_0_very_long_23
	v_proj_0_very_long_23 -> flash_attn_0_very_long_23
	kv_broadcast -> flash_attn_0_very_long_23
	flash_attn_0_very_long_0 -> reduce_0_very_long
	flash_attn_0_very_long_1 -> reduce_0_very_long
	flash_attn_0_very_long_2 -> reduce_0_very_long
	flash_attn_0_very_long_3 -> reduce_0_very_long
	flash_attn_0_very_long_4 -> reduce_0_very_long
	flash_attn_0_very_long_5 -> reduce_0_very_long
	flash_attn_0_very_long_6 -> reduce_0_very_long
	flash_attn_0_very_long_7 -> reduce_0_very_long
	flash_attn_0_very_long_8 -> reduce_0_very_long
	flash_attn_0_very_long_9 -> reduce_0_very_long
	flash_attn_0_very_long_10 -> reduce_0_very_long
	flash_attn_0_very_long_11 -> reduce_0_very_long
	flash_attn_0_very_long_12 -> reduce_0_very_long
	flash_attn_0_very_long_13 -> reduce_0_very_long
	flash_attn_0_very_long_14 -> reduce_0_very_long
	flash_attn_0_very_long_15 -> reduce_0_very_long
	flash_attn_0_very_long_16 -> reduce_0_very_long
	flash_attn_0_very_long_17 -> reduce_0_very_long
	flash_attn_0_very_long_18 -> reduce_0_very_long
	flash_attn_0_very_long_19 -> reduce_0_very_long
	flash_attn_0_very_long_20 -> reduce_0_very_long
	flash_attn_0_very_long_21 -> reduce_0_very_long
	flash_attn_0_very_long_22 -> reduce_0_very_long
	flash_attn_0_very_long_23 -> reduce_0_very_long
	reduce_0_very_long -> base_ffn_up_l0_0
	reduce_0_very_long -> base_ffn_up_l0_1
	reduce_0_very_long -> base_ffn_up_l0_2
	reduce_0_very_long -> base_ffn_up_l0_3
	reduce_0_very_long -> base_ffn_up_l0_4
	reduce_0_very_long -> base_ffn_up_l0_5
	reduce_0_very_long -> base_ffn_up_l0_6
	reduce_0_very_long -> base_ffn_up_l0_7
	q_proj_1_short_0 -> flash_attn_1_short_0
	k_proj_1_short_0 -> flash_attn_1_short_0
	v_proj_1_short_0 -> flash_attn_1_short_0
	kv_broadcast -> flash_attn_1_short_0
	q_proj_1_short_1 -> flash_attn_1_short_1
	k_proj_1_short_1 -> flash_attn_1_short_1
	v_proj_1_short_1 -> flash_attn_1_short_1
	kv_broadcast -> flash_attn_1_short_1
	q_proj_1_short_2 -> flash_attn_1_short_2
	k_proj_1_short_2 -> flash_attn_1_short_2
	v_proj_1_short_2 -> flash_attn_1_short_2
	kv_broadcast -> flash_attn_1_short_2
	q_proj_1_short_3 -> flash_attn_1_short_3
	k_proj_1_short_3 -> flash_attn_1_short_3
	v_proj_1_short_3 -> flash_attn_1_short_3
	kv_broadcast -> flash_attn_1_short_3
	q_proj_1_short_4 -> flash_attn_1_short_4
	k_proj_1_short_4 -> flash_attn_1_short_4
	v_proj_1_short_4 -> flash_attn_1_short_4
	kv_broadcast -> flash_attn_1_short_4
	q_proj_1_short_5 -> flash_attn_1_short_5
	k_proj_1_short_5 -> flash_attn_1_short_5
	v_proj_1_short_5 -> flash_attn_1_short_5
	kv_broadcast -> flash_attn_1_short_5
	q_proj_1_short_6 -> flash_attn_1_short_6
	k_proj_1_short_6 -> flash_attn_1_short_6
	v_proj_1_short_6 -> flash_attn_1_short_6
	kv_broadcast -> flash_attn_1_short_6
	q_proj_1_short_7 -> flash_attn_1_short_7
	k_proj_1_short_7 -> flash_attn_1_short_7
	v_proj_1_short_7 -> flash_attn_1_short_7
	kv_broadcast -> flash_attn_1_short_7
	flash_attn_1_short_0 -> base_ffn_up_l1_0
	flash_attn_1_short_1 -> base_ffn_up_l1_1
	flash_attn_1_short_2 -> base_ffn_up_l1_2
	flash_attn_1_short_3 -> base_ffn_up_l1_3
	flash_attn_1_short_4 -> base_ffn_up_l1_4
	flash_attn_1_short_5 -> base_ffn_up_l1_5
	flash_attn_1_short_6 -> base_ffn_up_l1_6
	flash_attn_1_short_7 -> base_ffn_up_l1_7
	q_proj_1_medium_0 -> flash_attn_1_medium_0
	k_proj_1_medium_0 -> flash_attn_1_medium_0
	v_proj_1_medium_0 -> flash_attn_1_medium_0
	kv_broadcast -> flash_attn_1_medium_0
	q_proj_1_medium_1 -> flash_attn_1_medium_1
	k_proj_1_medium_1 -> flash_attn_1_medium_1
	v_proj_1_medium_1 -> flash_attn_1_medium_1
	kv_broadcast -> flash_attn_1_medium_1
	q_proj_1_medium_2 -> flash_attn_1_medium_2
	k_proj_1_medium_2 -> flash_attn_1_medium_2
	v_proj_1_medium_2 -> flash_attn_1_medium_2
	kv_broadcast -> flash_attn_1_medium_2
	q_proj_1_medium_3 -> flash_attn_1_medium_3
	k_proj_1_medium_3 -> flash_attn_1_medium_3
	v_proj_1_medium_3 -> flash_attn_1_medium_3
	kv_broadcast -> flash_attn_1_medium_3
	q_proj_1_medium_4 -> flash_attn_1_medium_4
	k_proj_1_medium_4 -> flash_attn_1_medium_4
	v_proj_1_medium_4 -> flash_attn_1_medium_4
	kv_broadcast -> flash_attn_1_medium_4
	q_proj_1_medium_5 -> flash_attn_1_medium_5
	k_proj_1_medium_5 -> flash_attn_1_medium_5
	v_proj_1_medium_5 -> flash_attn_1_medium_5
	kv_broadcast -> flash_attn_1_medium_5
	q_proj_1_medium_6 -> flash_attn_1_medium_6
	k_proj_1_medium_6 -> flash_attn_1_medium_6
	v_proj_1_medium_6 -> flash_attn_1_medium_6
	kv_broadcast -> flash_attn_1_medium_6
	q_proj_1_medium_7 -> flash_attn_1_medium_7
	k_proj_1_medium_7 -> flash_attn_1_medium_7
	v_proj_1_medium_7 -> flash_attn_1_medium_7
	kv_broadcast -> flash_attn_1_medium_7
	flash_attn_1_medium_0 -> reduce_1_medium
	flash_attn_1_medium_1 -> reduce_1_medium
	flash_attn_1_medium_2 -> reduce_1_medium
	flash_attn_1_medium_3 -> reduce_1_medium
	flash_attn_1_medium_4 -> reduce_1_medium
	flash_attn_1_medium_5 -> reduce_1_medium
	flash_attn_1_medium_6 -> reduce_1_medium
	flash_attn_1_medium_7 -> reduce_1_medium
	reduce_1_medium -> base_ffn_up_l1_0
	reduce_1_medium -> base_ffn_up_l1_1
	reduce_1_medium -> base_ffn_up_l1_2
	reduce_1_medium -> base_ffn_up_l1_3
	reduce_1_medium -> base_ffn_up_l1_4
	reduce_1_medium -> base_ffn_up_l1_5
	reduce_1_medium -> base_ffn_up_l1_6
	reduce_1_medium -> base_ffn_up_l1_7
	q_proj_1_long_0 -> flash_attn_1_long_0
	k_proj_1_long_0 -> flash_attn_1_long_0
	v_proj_1_long_0 -> flash_attn_1_long_0
	kv_broadcast -> flash_attn_1_long_0
	q_proj_1_long_1 -> flash_attn_1_long_1
	k_proj_1_long_1 -> flash_attn_1_long_1
	v_proj_1_long_1 -> flash_attn_1_long_1
	kv_broadcast -> flash_attn_1_long_1
	q_proj_1_long_2 -> flash_attn_1_long_2
	k_proj_1_long_2 -> flash_attn_1_long_2
	v_proj_1_long_2 -> flash_attn_1_long_2
	kv_broadcast -> flash_attn_1_long_2
	q_proj_1_long_3 -> flash_attn_1_long_3
	k_proj_1_long_3 -> flash_attn_1_long_3
	v_proj_1_long_3 -> flash_attn_1_long_3
	kv_broadcast -> flash_attn_1_long_3
	q_proj_1_long_4 -> flash_attn_1_long_4
	k_proj_1_long_4 -> flash_attn_1_long_4
	v_proj_1_long_4 -> flash_attn_1_long_4
	kv_broadcast -> flash_attn_1_long_4
	q_proj_1_long_5 -> flash_attn_1_long_5
	k_proj_1_long_5 -> flash_attn_1_long_5
	v_proj_1_long_5 -> flash_attn_1_long_5
	kv_broadcast -> flash_attn_1_long_5
	q_proj_1_long_6 -> flash_attn_1_long_6
	k_proj_1_long_6 -> flash_attn_1_long_6
	v_proj_1_long_6 -> flash_attn_1_long_6
	kv_broadcast -> flash_attn_1_long_6
	q_proj_1_long_7 -> flash_attn_1_long_7
	k_proj_1_long_7 -> flash_attn_1_long_7
	v_proj_1_long_7 -> flash_attn_1_long_7
	kv_broadcast -> flash_attn_1_long_7
	q_proj_1_long_8 -> flash_attn_1_long_8
	k_proj_1_long_8 -> flash_attn_1_long_8
	v_proj_1_long_8 -> flash_attn_1_long_8
	kv_broadcast -> flash_attn_1_long_8
	q_proj_1_long_9 -> flash_attn_1_long_9
	k_proj_1_long_9 -> flash_attn_1_long_9
	v_proj_1_long_9 -> flash_attn_1_long_9
	kv_broadcast -> flash_attn_1_long_9
	q_proj_1_long_10 -> flash_attn_1_long_10
	k_proj_1_long_10 -> flash_attn_1_long_10
	v_proj_1_long_10 -> flash_attn_1_long_10
	kv_broadcast -> flash_attn_1_long_10
	q_proj_1_long_11 -> flash_attn_1_long_11
	k_proj_1_long_11 -> flash_attn_1_long_11
	v_proj_1_long_11 -> flash_attn_1_long_11
	kv_broadcast -> flash_attn_1_long_11
	q_proj_1_long_12 -> flash_attn_1_long_12
	k_proj_1_long_12 -> flash_attn_1_long_12
	v_proj_1_long_12 -> flash_attn_1_long_12
	kv_broadcast -> flash_attn_1_long_12
	q_proj_1_long_13 -> flash_attn_1_long_13
	k_proj_1_long_13 -> flash_attn_1_long_13
	v_proj_1_long_13 -> flash_attn_1_long_13
	kv_broadcast -> flash_attn_1_long_13
	q_proj_1_long_14 -> flash_attn_1_long_14
	k_proj_1_long_14 -> flash_attn_1_long_14
	v_proj_1_long_14 -> flash_attn_1_long_14
	kv_broadcast -> flash_attn_1_long_14
	q_proj_1_long_15 -> flash_attn_1_long_15
	k_proj_1_long_15 -> flash_attn_1_long_15
	v_proj_1_long_15 -> flash_attn_1_long_15
	kv_broadcast -> flash_attn_1_long_15
	flash_attn_1_long_0 -> reduce_1_long
	flash_attn_1_long_1 -> reduce_1_long
	flash_attn_1_long_2 -> reduce_1_long
	flash_attn_1_long_3 -> reduce_1_long
	flash_attn_1_long_4 -> reduce_1_long
	flash_attn_1_long_5 -> reduce_1_long
	flash_attn_1_long_6 -> reduce_1_long
	flash_attn_1_long_7 -> reduce_1_long
	flash_attn_1_long_8 -> reduce_1_long
	flash_attn_1_long_9 -> reduce_1_long
	flash_attn_1_long_10 -> reduce_1_long
	flash_attn_1_long_11 -> reduce_1_long
	flash_attn_1_long_12 -> reduce_1_long
	flash_attn_1_long_13 -> reduce_1_long
	flash_attn_1_long_14 -> reduce_1_long
	flash_attn_1_long_15 -> reduce_1_long
	reduce_1_long -> base_ffn_up_l1_0
	reduce_1_long -> base_ffn_up_l1_1
	reduce_1_long -> base_ffn_up_l1_2
	reduce_1_long -> base_ffn_up_l1_3
	reduce_1_long -> base_ffn_up_l1_4
	reduce_1_long -> base_ffn_up_l1_5
	reduce_1_long -> base_ffn_up_l1_6
	reduce_1_long -> base_ffn_up_l1_7
	q_proj_1_very_long_0 -> flash_attn_1_very_long_0
	k_proj_1_very_long_0 -> flash_attn_1_very_long_0
	v_proj_1_very_long_0 -> flash_attn_1_very_long_0
	kv_broadcast -> flash_attn_1_very_long_0
	q_proj_1_very_long_1 -> flash_attn_1_very_long_1
	k_proj_1_very_long_1 -> flash_attn_1_very_long_1
	v_proj_1_very_long_1 -> flash_attn_1_very_long_1
	kv_broadcast -> flash_attn_1_very_long_1
	q_proj_1_very_long_2 -> flash_attn_1_very_long_2
	k_proj_1_very_long_2 -> flash_attn_1_very_long_2
	v_proj_1_very_long_2 -> flash_attn_1_very_long_2
	kv_broadcast -> flash_attn_1_very_long_2
	q_proj_1_very_long_3 -> flash_attn_1_very_long_3
	k_proj_1_very_long_3 -> flash_attn_1_very_long_3
	v_proj_1_very_long_3 -> flash_attn_1_very_long_3
	kv_broadcast -> flash_attn_1_very_long_3
	q_proj_1_very_long_4 -> flash_attn_1_very_long_4
	k_proj_1_very_long_4 -> flash_attn_1_very_long_4
	v_proj_1_very_long_4 -> flash_attn_1_very_long_4
	kv_broadcast -> flash_attn_1_very_long_4
	q_proj_1_very_long_5 -> flash_attn_1_very_long_5
	k_proj_1_very_long_5 -> flash_attn_1_very_long_5
	v_proj_1_very_long_5 -> flash_attn_1_very_long_5
	kv_broadcast -> flash_attn_1_very_long_5
	q_proj_1_very_long_6 -> flash_attn_1_very_long_6
	k_proj_1_very_long_6 -> flash_attn_1_very_long_6
	v_proj_1_very_long_6 -> flash_attn_1_very_long_6
	kv_broadcast -> flash_attn_1_very_long_6
	q_proj_1_very_long_7 -> flash_attn_1_very_long_7
	k_proj_1_very_long_7 -> flash_attn_1_very_long_7
	v_proj_1_very_long_7 -> flash_attn_1_very_long_7
	kv_broadcast -> flash_attn_1_very_long_7
	q_proj_1_very_long_8 -> flash_attn_1_very_long_8
	k_proj_1_very_long_8 -> flash_attn_1_very_long_8
	v_proj_1_very_long_8 -> flash_attn_1_very_long_8
	kv_broadcast -> flash_attn_1_very_long_8
	q_proj_1_very_long_9 -> flash_attn_1_very_long_9
	k_proj_1_very_long_9 -> flash_attn_1_very_long_9
	v_proj_1_very_long_9 -> flash_attn_1_very_long_9
	kv_broadcast -> flash_attn_1_very_long_9
	q_proj_1_very_long_10 -> flash_attn_1_very_long_10
	k_proj_1_very_long_10 -> flash_attn_1_very_long_10
	v_proj_1_very_long_10 -> flash_attn_1_very_long_10
	kv_broadcast -> flash_attn_1_very_long_10
	q_proj_1_very_long_11 -> flash_attn_1_very_long_11
	k_proj_1_very_long_11 -> flash_attn_1_very_long_11
	v_proj_1_very_long_11 -> flash_attn_1_very_long_11
	kv_broadcast -> flash_attn_1_very_long_11
	q_proj_1_very_long_12 -> flash_attn_1_very_long_12
	k_proj_1_very_long_12 -> flash_attn_1_very_long_12
	v_proj_1_very_long_12 -> flash_attn_1_very_long_12
	kv_broadcast -> flash_attn_1_very_long_12
	q_proj_1_very_long_13 -> flash_attn_1_very_long_13
	k_proj_1_very_long_13 -> flash_attn_1_very_long_13
	v_proj_1_very_long_13 -> flash_attn_1_very_long_13
	kv_broadcast -> flash_attn_1_very_long_13
	q_proj_1_very_long_14 -> flash_attn_1_very_long_14
	k_proj_1_very_long_14 -> flash_attn_1_very_long_14
	v_proj_1_very_long_14 -> flash_attn_1_very_long_14
	kv_broadcast -> flash_attn_1_very_long_14
	q_proj_1_very_long_15 -> flash_attn_1_very_long_15
	k_proj_1_very_long_15 -> flash_attn_1_very_long_15
	v_proj_1_very_long_15 -> flash_attn_1_very_long_15
	kv_broadcast -> flash_attn_1_very_long_15
	q_proj_1_very_long_16 -> flash_attn_1_very_long_16
	k_proj_1_very_long_16 -> flash_attn_1_very_long_16
	v_proj_1_very_long_16 -> flash_attn_1_very_long_16
	kv_broadcast -> flash_attn_1_very_long_16
	q_proj_1_very_long_17 -> flash_attn_1_very_long_17
	k_proj_1_very_long_17 -> flash_attn_1_very_long_17
	v_proj_1_very_long_17 -> flash_attn_1_very_long_17
	kv_broadcast -> flash_attn_1_very_long_17
	q_proj_1_very_long_18 -> flash_attn_1_very_long_18
	k_proj_1_very_long_18 -> flash_attn_1_very_long_18
	v_proj_1_very_long_18 -> flash_attn_1_very_long_18
	kv_broadcast -> flash_attn_1_very_long_18
	q_proj_1_very_long_19 -> flash_attn_1_very_long_19
	k_proj_1_very_long_19 -> flash_attn_1_very_long_19
	v_proj_1_very_long_19 -> flash_attn_1_very_long_19
	kv_broadcast -> flash_attn_1_very_long_19
	q_proj_1_very_long_20 -> flash_attn_1_very_long_20
	k_proj_1_very_long_20 -> flash_attn_1_very_long_20
	v_proj_1_very_long_20 -> flash_attn_1_very_long_20
	kv_broadcast -> flash_attn_1_very_long_20
	q_proj_1_very_long_21 -> flash_attn_1_very_long_21
	k_proj_1_very_long_21 -> flash_attn_1_very_long_21
	v_proj_1_very_long_21 -> flash_attn_1_very_long_21
	kv_broadcast -> flash_attn_1_very_long_21
	q_proj_1_very_long_22 -> flash_attn_1_very_long_22
	k_proj_1_very_long_22 -> flash_attn_1_very_long_22
	v_proj_1_very_long_22 -> flash_attn_1_very_long_22
	kv_broadcast -> flash_attn_1_very_long_22
	q_proj_1_very_long_23 -> flash_attn_1_very_long_23
	k_proj_1_very_long_23 -> flash_attn_1_very_long_23
	v_proj_1_very_long_23 -> flash_attn_1_very_long_23
	kv_broadcast -> flash_attn_1_very_long_23
	flash_attn_1_very_long_0 -> reduce_1_very_long
	flash_attn_1_very_long_1 -> reduce_1_very_long
	flash_attn_1_very_long_2 -> reduce_1_very_long
	flash_attn_1_very_long_3 -> reduce_1_very_long
	flash_attn_1_very_long_4 -> reduce_1_very_long
	flash_attn_1_very_long_5 -> reduce_1_very_long
	flash_attn_1_very_long_6 -> reduce_1_very_long
	flash_attn_1_very_long_7 -> reduce_1_very_long
	flash_attn_1_very_long_8 -> reduce_1_very_long
	flash_attn_1_very_long_9 -> reduce_1_very_long
	flash_attn_1_very_long_10 -> reduce_1_very_long
	flash_attn_1_very_long_11 -> reduce_1_very_long
	flash_attn_1_very_long_12 -> reduce_1_very_long
	flash_attn_1_very_long_13 -> reduce_1_very_long
	flash_attn_1_very_long_14 -> reduce_1_very_long
	flash_attn_1_very_long_15 -> reduce_1_very_long
	flash_attn_1_very_long_16 -> reduce_1_very_long
	flash_attn_1_very_long_17 -> reduce_1_very_long
	flash_attn_1_very_long_18 -> reduce_1_very_long
	flash_attn_1_very_long_19 -> reduce_1_very_long
	flash_attn_1_very_long_20 -> reduce_1_very_long
	flash_attn_1_very_long_21 -> reduce_1_very_long
	flash_attn_1_very_long_22 -> reduce_1_very_long
	flash_attn_1_very_long_23 -> reduce_1_very_long
	reduce_1_very_long -> base_ffn_up_l1_0
	reduce_1_very_long -> base_ffn_up_l1_1
	reduce_1_very_long -> base_ffn_up_l1_2
	reduce_1_very_long -> base_ffn_up_l1_3
	reduce_1_very_long -> base_ffn_up_l1_4
	reduce_1_very_long -> base_ffn_up_l1_5
	reduce_1_very_long -> base_ffn_up_l1_6
	reduce_1_very_long -> base_ffn_up_l1_7
	q_proj_2_short_0 -> flash_attn_2_short_0
	k_proj_2_short_0 -> flash_attn_2_short_0
	v_proj_2_short_0 -> flash_attn_2_short_0
	kv_broadcast -> flash_attn_2_short_0
	q_proj_2_short_1 -> flash_attn_2_short_1
	k_proj_2_short_1 -> flash_attn_2_short_1
	v_proj_2_short_1 -> flash_attn_2_short_1
	kv_broadcast -> flash_attn_2_short_1
	q_proj_2_short_2 -> flash_attn_2_short_2
	k_proj_2_short_2 -> flash_attn_2_short_2
	v_proj_2_short_2 -> flash_attn_2_short_2
	kv_broadcast -> flash_attn_2_short_2
	q_proj_2_short_3 -> flash_attn_2_short_3
	k_proj_2_short_3 -> flash_attn_2_short_3
	v_proj_2_short_3 -> flash_attn_2_short_3
	kv_broadcast -> flash_attn_2_short_3
	q_proj_2_short_4 -> flash_attn_2_short_4
	k_proj_2_short_4 -> flash_attn_2_short_4
	v_proj_2_short_4 -> flash_attn_2_short_4
	kv_broadcast -> flash_attn_2_short_4
	q_proj_2_short_5 -> flash_attn_2_short_5
	k_proj_2_short_5 -> flash_attn_2_short_5
	v_proj_2_short_5 -> flash_attn_2_short_5
	kv_broadcast -> flash_attn_2_short_5
	q_proj_2_short_6 -> flash_attn_2_short_6
	k_proj_2_short_6 -> flash_attn_2_short_6
	v_proj_2_short_6 -> flash_attn_2_short_6
	kv_broadcast -> flash_attn_2_short_6
	q_proj_2_short_7 -> flash_attn_2_short_7
	k_proj_2_short_7 -> flash_attn_2_short_7
	v_proj_2_short_7 -> flash_attn_2_short_7
	kv_broadcast -> flash_attn_2_short_7
	flash_attn_2_short_0 -> base_ffn_up_l2_0
	flash_attn_2_short_1 -> base_ffn_up_l2_1
	flash_attn_2_short_2 -> base_ffn_up_l2_2
	flash_attn_2_short_3 -> base_ffn_up_l2_3
	flash_attn_2_short_4 -> base_ffn_up_l2_4
	flash_attn_2_short_5 -> base_ffn_up_l2_5
	flash_attn_2_short_6 -> base_ffn_up_l2_6
	flash_attn_2_short_7 -> base_ffn_up_l2_7
	q_proj_2_medium_0 -> flash_attn_2_medium_0
	k_proj_2_medium_0 -> flash_attn_2_medium_0
	v_proj_2_medium_0 -> flash_attn_2_medium_0
	kv_broadcast -> flash_attn_2_medium_0
	q_proj_2_medium_1 -> flash_attn_2_medium_1
	k_proj_2_medium_1 -> flash_attn_2_medium_1
	v_proj_2_medium_1 -> flash_attn_2_medium_1
	kv_broadcast -> flash_attn_2_medium_1
	q_proj_2_medium_2 -> flash_attn_2_medium_2
	k_proj_2_medium_2 -> flash_attn_2_medium_2
	v_proj_2_medium_2 -> flash_attn_2_medium_2
	kv_broadcast -> flash_attn_2_medium_2
	q_proj_2_medium_3 -> flash_attn_2_medium_3
	k_proj_2_medium_3 -> flash_attn_2_medium_3
	v_proj_2_medium_3 -> flash_attn_2_medium_3
	kv_broadcast -> flash_attn_2_medium_3
	q_proj_2_medium_4 -> flash_attn_2_medium_4
	k_proj_2_medium_4 -> flash_attn_2_medium_4
	v_proj_2_medium_4 -> flash_attn_2_medium_4
	kv_broadcast -> flash_attn_2_medium_4
	q_proj_2_medium_5 -> flash_attn_2_medium_5
	k_proj_2_medium_5 -> flash_attn_2_medium_5
	v_proj_2_medium_5 -> flash_attn_2_medium_5
	kv_broadcast -> flash_attn_2_medium_5
	q_proj_2_medium_6 -> flash_attn_2_medium_6
	k_proj_2_medium_6 -> flash_attn_2_medium_6
	v_proj_2_medium_6 -> flash_attn_2_medium_6
	kv_broadcast -> flash_attn_2_medium_6
	q_proj_2_medium_7 -> flash_attn_2_medium_7
	k_proj_2_medium_7 -> flash_attn_2_medium_7
	v_proj_2_medium_7 -> flash_attn_2_medium_7
	kv_broadcast -> flash_attn_2_medium_7
	flash_attn_2_medium_0 -> reduce_2_medium
	flash_attn_2_medium_1 -> reduce_2_medium
	flash_attn_2_medium_2 -> reduce_2_medium
	flash_attn_2_medium_3 -> reduce_2_medium
	flash_attn_2_medium_4 -> reduce_2_medium
	flash_attn_2_medium_5 -> reduce_2_medium
	flash_attn_2_medium_6 -> reduce_2_medium
	flash_attn_2_medium_7 -> reduce_2_medium
	reduce_2_medium -> base_ffn_up_l2_0
	reduce_2_medium -> base_ffn_up_l2_1
	reduce_2_medium -> base_ffn_up_l2_2
	reduce_2_medium -> base_ffn_up_l2_3
	reduce_2_medium -> base_ffn_up_l2_4
	reduce_2_medium -> base_ffn_up_l2_5
	reduce_2_medium -> base_ffn_up_l2_6
	reduce_2_medium -> base_ffn_up_l2_7
	q_proj_2_long_0 -> flash_attn_2_long_0
	k_proj_2_long_0 -> flash_attn_2_long_0
	v_proj_2_long_0 -> flash_attn_2_long_0
	kv_broadcast -> flash_attn_2_long_0
	q_proj_2_long_1 -> flash_attn_2_long_1
	k_proj_2_long_1 -> flash_attn_2_long_1
	v_proj_2_long_1 -> flash_attn_2_long_1
	kv_broadcast -> flash_attn_2_long_1
	q_proj_2_long_2 -> flash_attn_2_long_2
	k_proj_2_long_2 -> flash_attn_2_long_2
	v_proj_2_long_2 -> flash_attn_2_long_2
	kv_broadcast -> flash_attn_2_long_2
	q_proj_2_long_3 -> flash_attn_2_long_3
	k_proj_2_long_3 -> flash_attn_2_long_3
	v_proj_2_long_3 -> flash_attn_2_long_3
	kv_broadcast -> flash_attn_2_long_3
	q_proj_2_long_4 -> flash_attn_2_long_4
	k_proj_2_long_4 -> flash_attn_2_long_4
	v_proj_2_long_4 -> flash_attn_2_long_4
	kv_broadcast -> flash_attn_2_long_4
	q_proj_2_long_5 -> flash_attn_2_long_5
	k_proj_2_long_5 -> flash_attn_2_long_5
	v_proj_2_long_5 -> flash_attn_2_long_5
	kv_broadcast -> flash_attn_2_long_5
	q_proj_2_long_6 -> flash_attn_2_long_6
	k_proj_2_long_6 -> flash_attn_2_long_6
	v_proj_2_long_6 -> flash_attn_2_long_6
	kv_broadcast -> flash_attn_2_long_6
	q_proj_2_long_7 -> flash_attn_2_long_7
	k_proj_2_long_7 -> flash_attn_2_long_7
	v_proj_2_long_7 -> flash_attn_2_long_7
	kv_broadcast -> flash_attn_2_long_7
	q_proj_2_long_8 -> flash_attn_2_long_8
	k_proj_2_long_8 -> flash_attn_2_long_8
	v_proj_2_long_8 -> flash_attn_2_long_8
	kv_broadcast -> flash_attn_2_long_8
	q_proj_2_long_9 -> flash_attn_2_long_9
	k_proj_2_long_9 -> flash_attn_2_long_9
	v_proj_2_long_9 -> flash_attn_2_long_9
	kv_broadcast -> flash_attn_2_long_9
	q_proj_2_long_10 -> flash_attn_2_long_10
	k_proj_2_long_10 -> flash_attn_2_long_10
	v_proj_2_long_10 -> flash_attn_2_long_10
	kv_broadcast -> flash_attn_2_long_10
	q_proj_2_long_11 -> flash_attn_2_long_11
	k_proj_2_long_11 -> flash_attn_2_long_11
	v_proj_2_long_11 -> flash_attn_2_long_11
	kv_broadcast -> flash_attn_2_long_11
	q_proj_2_long_12 -> flash_attn_2_long_12
	k_proj_2_long_12 -> flash_attn_2_long_12
	v_proj_2_long_12 -> flash_attn_2_long_12
	kv_broadcast -> flash_attn_2_long_12
	q_proj_2_long_13 -> flash_attn_2_long_13
	k_proj_2_long_13 -> flash_attn_2_long_13
	v_proj_2_long_13 -> flash_attn_2_long_13
	kv_broadcast -> flash_attn_2_long_13
	q_proj_2_long_14 -> flash_attn_2_long_14
	k_proj_2_long_14 -> flash_attn_2_long_14
	v_proj_2_long_14 -> flash_attn_2_long_14
	kv_broadcast -> flash_attn_2_long_14
	q_proj_2_long_15 -> flash_attn_2_long_15
	k_proj_2_long_15 -> flash_attn_2_long_15
	v_proj_2_long_15 -> flash_attn_2_long_15
	kv_broadcast -> flash_attn_2_long_15
	flash_attn_2_long_0 -> reduce_2_long
	flash_attn_2_long_1 -> reduce_2_long
	flash_attn_2_long_2 -> reduce_2_long
	flash_attn_2_long_3 -> reduce_2_long
	flash_attn_2_long_4 -> reduce_2_long
	flash_attn_2_long_5 -> reduce_2_long
	flash_attn_2_long_6 -> reduce_2_long
	flash_attn_2_long_7 -> reduce_2_long
	flash_attn_2_long_8 -> reduce_2_long
	flash_attn_2_long_9 -> reduce_2_long
	flash_attn_2_long_10 -> reduce_2_long
	flash_attn_2_long_11 -> reduce_2_long
	flash_attn_2_long_12 -> reduce_2_long
	flash_attn_2_long_13 -> reduce_2_long
	flash_attn_2_long_14 -> reduce_2_long
	flash_attn_2_long_15 -> reduce_2_long
	reduce_2_long -> base_ffn_up_l2_0
	reduce_2_long -> base_ffn_up_l2_1
	reduce_2_long -> base_ffn_up_l2_2
	reduce_2_long -> base_ffn_up_l2_3
	reduce_2_long -> base_ffn_up_l2_4
	reduce_2_long -> base_ffn_up_l2_5
	reduce_2_long -> base_ffn_up_l2_6
	reduce_2_long -> base_ffn_up_l2_7
	q_proj_2_very_long_0 -> flash_attn_2_very_long_0
	k_proj_2_very_long_0 -> flash_attn_2_very_long_0
	v_proj_2_very_long_0 -> flash_attn_2_very_long_0
	kv_broadcast -> flash_attn_2_very_long_0
	q_proj_2_very_long_1 -> flash_attn_2_very_long_1
	k_proj_2_very_long_1 -> flash_attn_2_very_long_1
	v_proj_2_very_long_1 -> flash_attn_2_very_long_1
	kv_broadcast -> flash_attn_2_very_long_1
	q_proj_2_very_long_2 -> flash_attn_2_very_long_2
	k_proj_2_very_long_2 -> flash_attn_2_very_long_2
	v_proj_2_very_long_2 -> flash_attn_2_very_long_2
	kv_broadcast -> flash_attn_2_very_long_2
	q_proj_2_very_long_3 -> flash_attn_2_very_long_3
	k_proj_2_very_long_3 -> flash_attn_2_very_long_3
	v_proj_2_very_long_3 -> flash_attn_2_very_long_3
	kv_broadcast -> flash_attn_2_very_long_3
	q_proj_2_very_long_4 -> flash_attn_2_very_long_4
	k_proj_2_very_long_4 -> flash_attn_2_very_long_4
	v_proj_2_very_long_4 -> flash_attn_2_very_long_4
	kv_broadcast -> flash_attn_2_very_long_4
	q_proj_2_very_long_5 -> flash_attn_2_very_long_5
	k_proj_2_very_long_5 -> flash_attn_2_very_long_5
	v_proj_2_very_long_5 -> flash_attn_2_very_long_5
	kv_broadcast -> flash_attn_2_very_long_5
	q_proj_2_very_long_6 -> flash_attn_2_very_long_6
	k_proj_2_very_long_6 -> flash_attn_2_very_long_6
	v_proj_2_very_long_6 -> flash_attn_2_very_long_6
	kv_broadcast -> flash_attn_2_very_long_6
	q_proj_2_very_long_7 -> flash_attn_2_very_long_7
	k_proj_2_very_long_7 -> flash_attn_2_very_long_7
	v_proj_2_very_long_7 -> flash_attn_2_very_long_7
	kv_broadcast -> flash_attn_2_very_long_7
	q_proj_2_very_long_8 -> flash_attn_2_very_long_8
	k_proj_2_very_long_8 -> flash_attn_2_very_long_8
	v_proj_2_very_long_8 -> flash_attn_2_very_long_8
	kv_broadcast -> flash_attn_2_very_long_8
	q_proj_2_very_long_9 -> flash_attn_2_very_long_9
	k_proj_2_very_long_9 -> flash_attn_2_very_long_9
	v_proj_2_very_long_9 -> flash_attn_2_very_long_9
	kv_broadcast -> flash_attn_2_very_long_9
	q_proj_2_very_long_10 -> flash_attn_2_very_long_10
	k_proj_2_very_long_10 -> flash_attn_2_very_long_10
	v_proj_2_very_long_10 -> flash_attn_2_very_long_10
	kv_broadcast -> flash_attn_2_very_long_10
	q_proj_2_very_long_11 -> flash_attn_2_very_long_11
	k_proj_2_very_long_11 -> flash_attn_2_very_long_11
	v_proj_2_very_long_11 -> flash_attn_2_very_long_11
	kv_broadcast -> flash_attn_2_very_long_11
	q_proj_2_very_long_12 -> flash_attn_2_very_long_12
	k_proj_2_very_long_12 -> flash_attn_2_very_long_12
	v_proj_2_very_long_12 -> flash_attn_2_very_long_12
	kv_broadcast -> flash_attn_2_very_long_12
	q_proj_2_very_long_13 -> flash_attn_2_very_long_13
	k_proj_2_very_long_13 -> flash_attn_2_very_long_13
	v_proj_2_very_long_13 -> flash_attn_2_very_long_13
	kv_broadcast -> flash_attn_2_very_long_13
	q_proj_2_very_long_14 -> flash_attn_2_very_long_14
	k_proj_2_very_long_14 -> flash_attn_2_very_long_14
	v_proj_2_very_long_14 -> flash_attn_2_very_long_14
	kv_broadcast -> flash_attn_2_very_long_14
	q_proj_2_very_long_15 -> flash_attn_2_very_long_15
	k_proj_2_very_long_15 -> flash_attn_2_very_long_15
	v_proj_2_very_long_15 -> flash_attn_2_very_long_15
	kv_broadcast -> flash_attn_2_very_long_15
	q_proj_2_very_long_16 -> flash_attn_2_very_long_16
	k_proj_2_very_long_16 -> flash_attn_2_very_long_16
	v_proj_2_very_long_16 -> flash_attn_2_very_long_16
	kv_broadcast -> flash_attn_2_very_long_16
	q_proj_2_very_long_17 -> flash_attn_2_very_long_17
	k_proj_2_very_long_17 -> flash_attn_2_very_long_17
	v_proj_2_very_long_17 -> flash_attn_2_very_long_17
	kv_broadcast -> flash_attn_2_very_long_17
	q_proj_2_very_long_18 -> flash_attn_2_very_long_18
	k_proj_2_very_long_18 -> flash_attn_2_very_long_18
	v_proj_2_very_long_18 -> flash_attn_2_very_long_18
	kv_broadcast -> flash_attn_2_very_long_18
	q_proj_2_very_long_19 -> flash_attn_2_very_long_19
	k_proj_2_very_long_19 -> flash_attn_2_very_long_19
	v_proj_2_very_long_19 -> flash_attn_2_very_long_19
	kv_broadcast -> flash_attn_2_very_long_19
	q_proj_2_very_long_20 -> flash_attn_2_very_long_20
	k_proj_2_very_long_20 -> flash_attn_2_very_long_20
	v_proj_2_very_long_20 -> flash_attn_2_very_long_20
	kv_broadcast -> flash_attn_2_very_long_20
	q_proj_2_very_long_21 -> flash_attn_2_very_long_21
	k_proj_2_very_long_21 -> flash_attn_2_very_long_21
	v_proj_2_very_long_21 -> flash_attn_2_very_long_21
	kv_broadcast -> flash_attn_2_very_long_21
	q_proj_2_very_long_22 -> flash_attn_2_very_long_22
	k_proj_2_very_long_22 -> flash_attn_2_very_long_22
	v_proj_2_very_long_22 -> flash_attn_2_very_long_22
	kv_broadcast -> flash_attn_2_very_long_22
	q_proj_2_very_long_23 -> flash_attn_2_very_long_23
	k_proj_2_very_long_23 -> flash_attn_2_very_long_23
	v_proj_2_very_long_23 -> flash_attn_2_very_long_23
	kv_broadcast -> flash_attn_2_very_long_23
	flash_attn_2_very_long_0 -> reduce_2_very_long
	flash_attn_2_very_long_1 -> reduce_2_very_long
	flash_attn_2_very_long_2 -> reduce_2_very_long
	flash_attn_2_very_long_3 -> reduce_2_very_long
	flash_attn_2_very_long_4 -> reduce_2_very_long
	flash_attn_2_very_long_5 -> reduce_2_very_long
	flash_attn_2_very_long_6 -> reduce_2_very_long
	flash_attn_2_very_long_7 -> reduce_2_very_long
	flash_attn_2_very_long_8 -> reduce_2_very_long
	flash_attn_2_very_long_9 -> reduce_2_very_long
	flash_attn_2_very_long_10 -> reduce_2_very_long
	flash_attn_2_very_long_11 -> reduce_2_very_long
	flash_attn_2_very_long_12 -> reduce_2_very_long
	flash_attn_2_very_long_13 -> reduce_2_very_long
	flash_attn_2_very_long_14 -> reduce_2_very_long
	flash_attn_2_very_long_15 -> reduce_2_very_long
	flash_attn_2_very_long_16 -> reduce_2_very_long
	flash_attn_2_very_long_17 -> reduce_2_very_long
	flash_attn_2_very_long_18 -> reduce_2_very_long
	flash_attn_2_very_long_19 -> reduce_2_very_long
	flash_attn_2_very_long_20 -> reduce_2_very_long
	flash_attn_2_very_long_21 -> reduce_2_very_long
	flash_attn_2_very_long_22 -> reduce_2_very_long
	flash_attn_2_very_long_23 -> reduce_2_very_long
	reduce_2_very_long -> base_ffn_up_l2_0
	reduce_2_very_long -> base_ffn_up_l2_1
	reduce_2_very_long -> base_ffn_up_l2_2
	reduce_2_very_long -> base_ffn_up_l2_3
	reduce_2_very_long -> base_ffn_up_l2_4
	reduce_2_very_long -> base_ffn_up_l2_5
	reduce_2_very_long -> base_ffn_up_l2_6
	reduce_2_very_long -> base_ffn_up_l2_7
	q_proj_3_short_0 -> flash_attn_3_short_0
	k_proj_3_short_0 -> flash_attn_3_short_0
	v_proj_3_short_0 -> flash_attn_3_short_0
	kv_broadcast -> flash_attn_3_short_0
	q_proj_3_short_1 -> flash_attn_3_short_1
	k_proj_3_short_1 -> flash_attn_3_short_1
	v_proj_3_short_1 -> flash_attn_3_short_1
	kv_broadcast -> flash_attn_3_short_1
	q_proj_3_short_2 -> flash_attn_3_short_2
	k_proj_3_short_2 -> flash_attn_3_short_2
	v_proj_3_short_2 -> flash_attn_3_short_2
	kv_broadcast -> flash_attn_3_short_2
	q_proj_3_short_3 -> flash_attn_3_short_3
	k_proj_3_short_3 -> flash_attn_3_short_3
	v_proj_3_short_3 -> flash_attn_3_short_3
	kv_broadcast -> flash_attn_3_short_3
	q_proj_3_short_4 -> flash_attn_3_short_4
	k_proj_3_short_4 -> flash_attn_3_short_4
	v_proj_3_short_4 -> flash_attn_3_short_4
	kv_broadcast -> flash_attn_3_short_4
	q_proj_3_short_5 -> flash_attn_3_short_5
	k_proj_3_short_5 -> flash_attn_3_short_5
	v_proj_3_short_5 -> flash_attn_3_short_5
	kv_broadcast -> flash_attn_3_short_5
	q_proj_3_short_6 -> flash_attn_3_short_6
	k_proj_3_short_6 -> flash_attn_3_short_6
	v_proj_3_short_6 -> flash_attn_3_short_6
	kv_broadcast -> flash_attn_3_short_6
	q_proj_3_short_7 -> flash_attn_3_short_7
	k_proj_3_short_7 -> flash_attn_3_short_7
	v_proj_3_short_7 -> flash_attn_3_short_7
	kv_broadcast -> flash_attn_3_short_7
	flash_attn_3_short_0 -> base_ffn_up_l3_0
	flash_attn_3_short_1 -> base_ffn_up_l3_1
	flash_attn_3_short_2 -> base_ffn_up_l3_2
	flash_attn_3_short_3 -> base_ffn_up_l3_3
	flash_attn_3_short_4 -> base_ffn_up_l3_4
	flash_attn_3_short_5 -> base_ffn_up_l3_5
	flash_attn_3_short_6 -> base_ffn_up_l3_6
	flash_attn_3_short_7 -> base_ffn_up_l3_7
	q_proj_3_medium_0 -> flash_attn_3_medium_0
	k_proj_3_medium_0 -> flash_attn_3_medium_0
	v_proj_3_medium_0 -> flash_attn_3_medium_0
	kv_broadcast -> flash_attn_3_medium_0
	q_proj_3_medium_1 -> flash_attn_3_medium_1
	k_proj_3_medium_1 -> flash_attn_3_medium_1
	v_proj_3_medium_1 -> flash_attn_3_medium_1
	kv_broadcast -> flash_attn_3_medium_1
	q_proj_3_medium_2 -> flash_attn_3_medium_2
	k_proj_3_medium_2 -> flash_attn_3_medium_2
	v_proj_3_medium_2 -> flash_attn_3_medium_2
	kv_broadcast -> flash_attn_3_medium_2
	q_proj_3_medium_3 -> flash_attn_3_medium_3
	k_proj_3_medium_3 -> flash_attn_3_medium_3
	v_proj_3_medium_3 -> flash_attn_3_medium_3
	kv_broadcast -> flash_attn_3_medium_3
	q_proj_3_medium_4 -> flash_attn_3_medium_4
	k_proj_3_medium_4 -> flash_attn_3_medium_4
	v_proj_3_medium_4 -> flash_attn_3_medium_4
	kv_broadcast -> flash_attn_3_medium_4
	q_proj_3_medium_5 -> flash_attn_3_medium_5
	k_proj_3_medium_5 -> flash_attn_3_medium_5
	v_proj_3_medium_5 -> flash_attn_3_medium_5
	kv_broadcast -> flash_attn_3_medium_5
	q_proj_3_medium_6 -> flash_attn_3_medium_6
	k_proj_3_medium_6 -> flash_attn_3_medium_6
	v_proj_3_medium_6 -> flash_attn_3_medium_6
	kv_broadcast -> flash_attn_3_medium_6
	q_proj_3_medium_7 -> flash_attn_3_medium_7
	k_proj_3_medium_7 -> flash_attn_3_medium_7
	v_proj_3_medium_7 -> flash_attn_3_medium_7
	kv_broadcast -> flash_attn_3_medium_7
	flash_attn_3_medium_0 -> reduce_3_medium
	flash_attn_3_medium_1 -> reduce_3_medium
	flash_attn_3_medium_2 -> reduce_3_medium
	flash_attn_3_medium_3 -> reduce_3_medium
	flash_attn_3_medium_4 -> reduce_3_medium
	flash_attn_3_medium_5 -> reduce_3_medium
	flash_attn_3_medium_6 -> reduce_3_medium
	flash_attn_3_medium_7 -> reduce_3_medium
	reduce_3_medium -> base_ffn_up_l3_0
	reduce_3_medium -> base_ffn_up_l3_1
	reduce_3_medium -> base_ffn_up_l3_2
	reduce_3_medium -> base_ffn_up_l3_3
	reduce_3_medium -> base_ffn_up_l3_4
	reduce_3_medium -> base_ffn_up_l3_5
	reduce_3_medium -> base_ffn_up_l3_6
	reduce_3_medium -> base_ffn_up_l3_7
	q_proj_3_long_0 -> flash_attn_3_long_0
	k_proj_3_long_0 -> flash_attn_3_long_0
	v_proj_3_long_0 -> flash_attn_3_long_0
	kv_broadcast -> flash_attn_3_long_0
	q_proj_3_long_1 -> flash_attn_3_long_1
	k_proj_3_long_1 -> flash_attn_3_long_1
	v_proj_3_long_1 -> flash_attn_3_long_1
	kv_broadcast -> flash_attn_3_long_1
	q_proj_3_long_2 -> flash_attn_3_long_2
	k_proj_3_long_2 -> flash_attn_3_long_2
	v_proj_3_long_2 -> flash_attn_3_long_2
	kv_broadcast -> flash_attn_3_long_2
	q_proj_3_long_3 -> flash_attn_3_long_3
	k_proj_3_long_3 -> flash_attn_3_long_3
	v_proj_3_long_3 -> flash_attn_3_long_3
	kv_broadcast -> flash_attn_3_long_3
	q_proj_3_long_4 -> flash_attn_3_long_4
	k_proj_3_long_4 -> flash_attn_3_long_4
	v_proj_3_long_4 -> flash_attn_3_long_4
	kv_broadcast -> flash_attn_3_long_4
	q_proj_3_long_5 -> flash_attn_3_long_5
	k_proj_3_long_5 -> flash_attn_3_long_5
	v_proj_3_long_5 -> flash_attn_3_long_5
	kv_broadcast -> flash_attn_3_long_5
	q_proj_3_long_6 -> flash_attn_3_long_6
	k_proj_3_long_6 -> flash_attn_3_long_6
	v_proj_3_long_6 -> flash_attn_3_long_6
	kv_broadcast -> flash_attn_3_long_6
	q_proj_3_long_7 -> flash_attn_3_long_7
	k_proj_3_long_7 -> flash_attn_3_long_7
	v_proj_3_long_7 -> flash_attn_3_long_7
	kv_broadcast -> flash_attn_3_long_7
	q_proj_3_long_8 -> flash_attn_3_long_8
	k_proj_3_long_8 -> flash_attn_3_long_8
	v_proj_3_long_8 -> flash_attn_3_long_8
	kv_broadcast -> flash_attn_3_long_8
	q_proj_3_long_9 -> flash_attn_3_long_9
	k_proj_3_long_9 -> flash_attn_3_long_9
	v_proj_3_long_9 -> flash_attn_3_long_9
	kv_broadcast -> flash_attn_3_long_9
	q_proj_3_long_10 -> flash_attn_3_long_10
	k_proj_3_long_10 -> flash_attn_3_long_10
	v_proj_3_long_10 -> flash_attn_3_long_10
	kv_broadcast -> flash_attn_3_long_10
	q_proj_3_long_11 -> flash_attn_3_long_11
	k_proj_3_long_11 -> flash_attn_3_long_11
	v_proj_3_long_11 -> flash_attn_3_long_11
	kv_broadcast -> flash_attn_3_long_11
	q_proj_3_long_12 -> flash_attn_3_long_12
	k_proj_3_long_12 -> flash_attn_3_long_12
	v_proj_3_long_12 -> flash_attn_3_long_12
	kv_broadcast -> flash_attn_3_long_12
	q_proj_3_long_13 -> flash_attn_3_long_13
	k_proj_3_long_13 -> flash_attn_3_long_13
	v_proj_3_long_13 -> flash_attn_3_long_13
	kv_broadcast -> flash_attn_3_long_13
	q_proj_3_long_14 -> flash_attn_3_long_14
	k_proj_3_long_14 -> flash_attn_3_long_14
	v_proj_3_long_14 -> flash_attn_3_long_14
	kv_broadcast -> flash_attn_3_long_14
	q_proj_3_long_15 -> flash_attn_3_long_15
	k_proj_3_long_15 -> flash_attn_3_long_15
	v_proj_3_long_15 -> flash_attn_3_long_15
	kv_broadcast -> flash_attn_3_long_15
	flash_attn_3_long_0 -> reduce_3_long
	flash_attn_3_long_1 -> reduce_3_long
	flash_attn_3_long_2 -> reduce_3_long
	flash_attn_3_long_3 -> reduce_3_long
	flash_attn_3_long_4 -> reduce_3_long
	flash_attn_3_long_5 -> reduce_3_long
	flash_attn_3_long_6 -> reduce_3_long
	flash_attn_3_long_7 -> reduce_3_long
	flash_attn_3_long_8 -> reduce_3_long
	flash_attn_3_long_9 -> reduce_3_long
	flash_attn_3_long_10 -> reduce_3_long
	flash_attn_3_long_11 -> reduce_3_long
	flash_attn_3_long_12 -> reduce_3_long
	flash_attn_3_long_13 -> reduce_3_long
	flash_attn_3_long_14 -> reduce_3_long
	flash_attn_3_long_15 -> reduce_3_long
	reduce_3_long -> base_ffn_up_l3_0
	reduce_3_long -> base_ffn_up_l3_1
	reduce_3_long -> base_ffn_up_l3_2
	reduce_3_long -> base_ffn_up_l3_3
	reduce_3_long -> base_ffn_up_l3_4
	reduce_3_long -> base_ffn_up_l3_5
	reduce_3_long -> base_ffn_up_l3_6
	reduce_3_long -> base_ffn_up_l3_7
	q_proj_3_very_long_0 -> flash_attn_3_very_long_0
	k_proj_3_very_long_0 -> flash_attn_3_very_long_0
	v_proj_3_very_long_0 -> flash_attn_3_very_long_0
	kv_broadcast -> flash_attn_3_very_long_0
	q_proj_3_very_long_1 -> flash_attn_3_very_long_1
	k_proj_3_very_long_1 -> flash_attn_3_very_long_1
	v_proj_3_very_long_1 -> flash_attn_3_very_long_1
	kv_broadcast -> flash_attn_3_very_long_1
	q_proj_3_very_long_2 -> flash_attn_3_very_long_2
	k_proj_3_very_long_2 -> flash_attn_3_very_long_2
	v_proj_3_very_long_2 -> flash_attn_3_very_long_2
	kv_broadcast -> flash_attn_3_very_long_2
	q_proj_3_very_long_3 -> flash_attn_3_very_long_3
	k_proj_3_very_long_3 -> flash_attn_3_very_long_3
	v_proj_3_very_long_3 -> flash_attn_3_very_long_3
	kv_broadcast -> flash_attn_3_very_long_3
	q_proj_3_very_long_4 -> flash_attn_3_very_long_4
	k_proj_3_very_long_4 -> flash_attn_3_very_long_4
	v_proj_3_very_long_4 -> flash_attn_3_very_long_4
	kv_broadcast -> flash_attn_3_very_long_4
	q_proj_3_very_long_5 -> flash_attn_3_very_long_5
	k_proj_3_very_long_5 -> flash_attn_3_very_long_5
	v_proj_3_very_long_5 -> flash_attn_3_very_long_5
	kv_broadcast -> flash_attn_3_very_long_5
	q_proj_3_very_long_6 -> flash_attn_3_very_long_6
	k_proj_3_very_long_6 -> flash_attn_3_very_long_6
	v_proj_3_very_long_6 -> flash_attn_3_very_long_6
	kv_broadcast -> flash_attn_3_very_long_6
	q_proj_3_very_long_7 -> flash_attn_3_very_long_7
	k_proj_3_very_long_7 -> flash_attn_3_very_long_7
	v_proj_3_very_long_7 -> flash_attn_3_very_long_7
	kv_broadcast -> flash_attn_3_very_long_7
	q_proj_3_very_long_8 -> flash_attn_3_very_long_8
	k_proj_3_very_long_8 -> flash_attn_3_very_long_8
	v_proj_3_very_long_8 -> flash_attn_3_very_long_8
	kv_broadcast -> flash_attn_3_very_long_8
	q_proj_3_very_long_9 -> flash_attn_3_very_long_9
	k_proj_3_very_long_9 -> flash_attn_3_very_long_9
	v_proj_3_very_long_9 -> flash_attn_3_very_long_9
	kv_broadcast -> flash_attn_3_very_long_9
	q_proj_3_very_long_10 -> flash_attn_3_very_long_10
	k_proj_3_very_long_10 -> flash_attn_3_very_long_10
	v_proj_3_very_long_10 -> flash_attn_3_very_long_10
	kv_broadcast -> flash_attn_3_very_long_10
	q_proj_3_very_long_11 -> flash_attn_3_very_long_11
	k_proj_3_very_long_11 -> flash_attn_3_very_long_11
	v_proj_3_very_long_11 -> flash_attn_3_very_long_11
	kv_broadcast -> flash_attn_3_very_long_11
	q_proj_3_very_long_12 -> flash_attn_3_very_long_12
	k_proj_3_very_long_12 -> flash_attn_3_very_long_12
	v_proj_3_very_long_12 -> flash_attn_3_very_long_12
	kv_broadcast -> flash_attn_3_very_long_12
	q_proj_3_very_long_13 -> flash_attn_3_very_long_13
	k_proj_3_very_long_13 -> flash_attn_3_very_long_13
	v_proj_3_very_long_13 -> flash_attn_3_very_long_13
	kv_broadcast -> flash_attn_3_very_long_13
	q_proj_3_very_long_14 -> flash_attn_3_very_long_14
	k_proj_3_very_long_14 -> flash_attn_3_very_long_14
	v_proj_3_very_long_14 -> flash_attn_3_very_long_14
	kv_broadcast -> flash_attn_3_very_long_14
	q_proj_3_very_long_15 -> flash_attn_3_very_long_15
	k_proj_3_very_long_15 -> flash_attn_3_very_long_15
	v_proj_3_very_long_15 -> flash_attn_3_very_long_15
	kv_broadcast -> flash_attn_3_very_long_15
	q_proj_3_very_long_16 -> flash_attn_3_very_long_16
	k_proj_3_very_long_16 -> flash_attn_3_very_long_16
	v_proj_3_very_long_16 -> flash_attn_3_very_long_16
	kv_broadcast -> flash_attn_3_very_long_16
	q_proj_3_very_long_17 -> flash_attn_3_very_long_17
	k_proj_3_very_long_17 -> flash_attn_3_very_long_17
	v_proj_3_very_long_17 -> flash_attn_3_very_long_17
	kv_broadcast -> flash_attn_3_very_long_17
	q_proj_3_very_long_18 -> flash_attn_3_very_long_18
	k_proj_3_very_long_18 -> flash_attn_3_very_long_18
	v_proj_3_very_long_18 -> flash_attn_3_very_long_18
	kv_broadcast -> flash_attn_3_very_long_18
	q_proj_3_very_long_19 -> flash_attn_3_very_long_19
	k_proj_3_very_long_19 -> flash_attn_3_very_long_19
	v_proj_3_very_long_19 -> flash_attn_3_very_long_19
	kv_broadcast -> flash_attn_3_very_long_19
	q_proj_3_very_long_20 -> flash_attn_3_very_long_20
	k_proj_3_very_long_20 -> flash_attn_3_very_long_20
	v_proj_3_very_long_20 -> flash_attn_3_very_long_20
	kv_broadcast -> flash_attn_3_very_long_20
	q_proj_3_very_long_21 -> flash_attn_3_very_long_21
	k_proj_3_very_long_21 -> flash_attn_3_very_long_21
	v_proj_3_very_long_21 -> flash_attn_3_very_long_21
	kv_broadcast -> flash_attn_3_very_long_21
	q_proj_3_very_long_22 -> flash_attn_3_very_long_22
	k_proj_3_very_long_22 -> flash_attn_3_very_long_22
	v_proj_3_very_long_22 -> flash_attn_3_very_long_22
	kv_broadcast -> flash_attn_3_very_long_22
	q_proj_3_very_long_23 -> flash_attn_3_very_long_23
	k_proj_3_very_long_23 -> flash_attn_3_very_long_23
	v_proj_3_very_long_23 -> flash_attn_3_very_long_23
	kv_broadcast -> flash_attn_3_very_long_23
	flash_attn_3_very_long_0 -> reduce_3_very_long
	flash_attn_3_very_long_1 -> reduce_3_very_long
	flash_attn_3_very_long_2 -> reduce_3_very_long
	flash_attn_3_very_long_3 -> reduce_3_very_long
	flash_attn_3_very_long_4 -> reduce_3_very_long
	flash_attn_3_very_long_5 -> reduce_3_very_long
	flash_attn_3_very_long_6 -> reduce_3_very_long
	flash_attn_3_very_long_7 -> reduce_3_very_long
	flash_attn_3_very_long_8 -> reduce_3_very_long
	flash_attn_3_very_long_9 -> reduce_3_very_long
	flash_attn_3_very_long_10 -> reduce_3_very_long
	flash_attn_3_very_long_11 -> reduce_3_very_long
	flash_attn_3_very_long_12 -> reduce_3_very_long
	flash_attn_3_very_long_13 -> reduce_3_very_long
	flash_attn_3_very_long_14 -> reduce_3_very_long
	flash_attn_3_very_long_15 -> reduce_3_very_long
	flash_attn_3_very_long_16 -> reduce_3_very_long
	flash_attn_3_very_long_17 -> reduce_3_very_long
	flash_attn_3_very_long_18 -> reduce_3_very_long
	flash_attn_3_very_long_19 -> reduce_3_very_long
	flash_attn_3_very_long_20 -> reduce_3_very_long
	flash_attn_3_very_long_21 -> reduce_3_very_long
	flash_attn_3_very_long_22 -> reduce_3_very_long
	flash_attn_3_very_long_23 -> reduce_3_very_long
	reduce_3_very_long -> base_ffn_up_l3_0
	reduce_3_very_long -> base_ffn_up_l3_1
	reduce_3_very_long -> base_ffn_up_l3_2
	reduce_3_very_long -> base_ffn_up_l3_3
	reduce_3_very_long -> base_ffn_up_l3_4
	reduce_3_very_long -> base_ffn_up_l3_5
	reduce_3_very_long -> base_ffn_up_l3_6
	reduce_3_very_long -> base_ffn_up_l3_7
	base_ffn_up_l0_0 -> base_ffn_down_l0_0
	async_overlap -> base_ffn_up_l0_0
	base_ffn_up_l0_1 -> base_ffn_down_l0_1
	async_overlap -> base_ffn_up_l0_1
	base_ffn_up_l0_2 -> base_ffn_down_l0_2
	async_overlap -> base_ffn_up_l0_2
	base_ffn_up_l0_3 -> base_ffn_down_l0_3
	async_overlap -> base_ffn_up_l0_3
	base_ffn_up_l0_4 -> base_ffn_down_l0_4
	async_overlap -> base_ffn_up_l0_4
	base_ffn_up_l0_5 -> base_ffn_down_l0_5
	async_overlap -> base_ffn_up_l0_5
	base_ffn_up_l0_6 -> base_ffn_down_l0_6
	async_overlap -> base_ffn_up_l0_6
	base_ffn_up_l0_7 -> base_ffn_down_l0_7
	async_overlap -> base_ffn_up_l0_7
	base_ffn_up_l1_0 -> base_ffn_down_l1_0
	async_overlap -> base_ffn_up_l1_0
	base_ffn_up_l1_1 -> base_ffn_down_l1_1
	async_overlap -> base_ffn_up_l1_1
	base_ffn_up_l1_2 -> base_ffn_down_l1_2
	async_overlap -> base_ffn_up_l1_2
	base_ffn_up_l1_3 -> base_ffn_down_l1_3
	async_overlap -> base_ffn_up_l1_3
	base_ffn_up_l1_4 -> base_ffn_down_l1_4
	async_overlap -> base_ffn_up_l1_4
	base_ffn_up_l1_5 -> base_ffn_down_l1_5
	async_overlap -> base_ffn_up_l1_5
	base_ffn_up_l1_6 -> base_ffn_down_l1_6
	async_overlap -> base_ffn_up_l1_6
	base_ffn_up_l1_7 -> base_ffn_down_l1_7
	async_overlap -> base_ffn_up_l1_7
	base_ffn_up_l2_0 -> base_ffn_down_l2_0
	async_overlap -> base_ffn_up_l2_0
	base_ffn_up_l2_1 -> base_ffn_down_l2_1
	async_overlap -> base_ffn_up_l2_1
	base_ffn_up_l2_2 -> base_ffn_down_l2_2
	async_overlap -> base_ffn_up_l2_2
	base_ffn_up_l2_3 -> base_ffn_down_l2_3
	async_overlap -> base_ffn_up_l2_3
	base_ffn_up_l2_4 -> base_ffn_down_l2_4
	async_overlap -> base_ffn_up_l2_4
	base_ffn_up_l2_5 -> base_ffn_down_l2_5
	async_overlap -> base_ffn_up_l2_5
	base_ffn_up_l2_6 -> base_ffn_down_l2_6
	async_overlap -> base_ffn_up_l2_6
	base_ffn_up_l2_7 -> base_ffn_down_l2_7
	async_overlap -> base_ffn_up_l2_7
	base_ffn_up_l3_0 -> base_ffn_down_l3_0
	async_overlap -> base_ffn_up_l3_0
	base_ffn_up_l3_1 -> base_ffn_down_l3_1
	async_overlap -> base_ffn_up_l3_1
	base_ffn_up_l3_2 -> base_ffn_down_l3_2
	async_overlap -> base_ffn_up_l3_2
	base_ffn_up_l3_3 -> base_ffn_down_l3_3
	async_overlap -> base_ffn_up_l3_3
	base_ffn_up_l3_4 -> base_ffn_down_l3_4
	async_overlap -> base_ffn_up_l3_4
	base_ffn_up_l3_5 -> base_ffn_down_l3_5
	async_overlap -> base_ffn_up_l3_5
	base_ffn_up_l3_6 -> base_ffn_down_l3_6
	async_overlap -> base_ffn_up_l3_6
	base_ffn_up_l3_7 -> base_ffn_down_l3_7
	async_overlap -> base_ffn_up_l3_7
	base_ffn_down_l3_0 -> output_agg
	base_ffn_down_l3_1 -> output_agg
	base_ffn_down_l3_2 -> output_agg
	base_ffn_down_l3_3 -> output_agg
	base_ffn_down_l3_4 -> output_agg
	base_ffn_down_l3_5 -> output_agg
	base_ffn_down_l3_6 -> output_agg
	base_ffn_down_l3_7 -> output_agg
}
