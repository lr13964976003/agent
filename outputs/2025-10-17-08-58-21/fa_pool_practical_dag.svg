<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: fa_pool_practical_dag Pages: 1 -->
<svg width="535pt" height="480pt"
 viewBox="0.00 0.00 534.50 480.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 476)">
<title>fa_pool_practical_dag</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-476 530.5,-476 530.5,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="none" stroke="black" cx="244.5" cy="-454" rx="137.99" ry="18"/>
<text text-anchor="middle" x="244.5" y="-451.5" font-family="Arial" font-size="10.00">Input&lt;br/&gt;[batch=1024, seq_len=?, vocab=32000]</text>
</g>
<!-- decision -->
<g id="node2" class="node">
<title>decision</title>
<polygon fill="none" stroke="black" points="244.5,-399 86.5,-358 244.5,-317 402.5,-358 244.5,-399"/>
<text text-anchor="middle" x="244.5" y="-366.5" font-family="Arial" font-size="10.00">Sequence Length Decision&lt;br/&gt;</text>
<text text-anchor="middle" x="244.5" y="-355.5" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt; 4096: Base only&lt;br/&gt;</text>
<text text-anchor="middle" x="244.5" y="-344.5" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;≥ 4096: Activate pool</text>
</g>
<!-- input&#45;&gt;decision -->
<g id="edge1" class="edge">
<title>input&#45;&gt;decision</title>
<path fill="none" stroke="black" d="M244.5,-435.94C244.5,-435.94 244.5,-409.06 244.5,-409.06"/>
<polygon fill="black" stroke="black" points="248,-409.06 244.5,-399.06 241,-409.06 248,-409.06"/>
</g>
<!-- base_processing -->
<g id="node3" class="node">
<title>base_processing</title>
<polygon fill="none" stroke="black" points="159,-260.5 0,-260.5 0,-219.5 159,-219.5 159,-260.5"/>
<text text-anchor="middle" x="79.5" y="-248.5" font-family="Arial" font-size="10.00">Base Layer (8 GPUs)&lt;br/&gt;</text>
<text text-anchor="middle" x="79.5" y="-237.5" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Embedding + FFN&lt;br/&gt;</text>
<text text-anchor="middle" x="79.5" y="-226.5" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Always active</text>
</g>
<!-- decision&#45;&gt;base_processing -->
<g id="edge2" class="edge">
<title>decision&#45;&gt;base_processing</title>
<path fill="none" stroke="black" d="M122.75,-348.34C122.75,-348.34 122.75,-270.78 122.75,-270.78"/>
<polygon fill="black" stroke="black" points="126.25,-270.78 122.75,-260.78 119.25,-270.78 126.25,-270.78"/>
</g>
<!-- base_attention -->
<g id="node4" class="node">
<title>base_attention</title>
<polygon fill="none" stroke="black" points="312,-260.5 177,-260.5 177,-219.5 312,-219.5 312,-260.5"/>
<text text-anchor="middle" x="244.5" y="-248.5" font-family="Arial" font-size="10.00">Base Attention&lt;br/&gt;</text>
<text text-anchor="middle" x="244.5" y="-237.5" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;8 GPUs&lt;br/&gt;</text>
<text text-anchor="middle" x="244.5" y="-226.5" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;TP=8 across base</text>
</g>
<!-- decision&#45;&gt;base_attention -->
<g id="edge3" class="edge">
<title>decision&#45;&gt;base_attention</title>
<path fill="none" stroke="black" d="M244.5,-316.73C244.5,-316.73 244.5,-270.54 244.5,-270.54"/>
<polygon fill="black" stroke="black" points="248,-270.54 244.5,-260.54 241,-270.54 248,-270.54"/>
<text text-anchor="middle" x="271" y="-287.8" font-family="Times,serif" font-size="14.00">&lt; 4096</text>
</g>
<!-- pool_attention -->
<g id="node5" class="node">
<title>pool_attention</title>
<polygon fill="none" stroke="black" points="526.5,-266 330.5,-266 330.5,-214 526.5,-214 526.5,-266"/>
<text text-anchor="middle" x="428.5" y="-254" font-family="Arial" font-size="10.00">Attention Pool&lt;br/&gt;</text>
<text text-anchor="middle" x="428.5" y="-243" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;8&#45;32 GPUs&lt;br/&gt;</text>
<text text-anchor="middle" x="428.5" y="-232" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Block&#45;wise parallel&lt;br/&gt;</text>
<text text-anchor="middle" x="428.5" y="-221" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Sequence length / GPUs blocks</text>
</g>
<!-- decision&#45;&gt;pool_attention -->
<g id="edge4" class="edge">
<title>decision&#45;&gt;pool_attention</title>
<path fill="none" stroke="black" d="M366.5,-348.34C366.5,-348.34 366.5,-276.36 366.5,-276.36"/>
<polygon fill="black" stroke="black" points="370,-276.36 366.5,-266.36 363,-276.36 370,-276.36"/>
<text text-anchor="middle" x="401" y="-287.8" font-family="Times,serif" font-size="14.00">≥ 4096</text>
</g>
<!-- communication -->
<g id="node6" class="node">
<title>communication</title>
<polygon fill="none" stroke="black" points="423.72,-177 138.62,-177 65.28,-73 350.38,-73 423.72,-177"/>
<text text-anchor="middle" x="244.5" y="-139" font-family="Arial" font-size="10.00">Communication&lt;br/&gt;</text>
<text text-anchor="middle" x="244.5" y="-128" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;KV cache sharing&lt;br/&gt;</text>
<text text-anchor="middle" x="244.5" y="-117" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Hierarchical reduction&lt;br/&gt;</text>
<text text-anchor="middle" x="244.5" y="-106" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Async overlap</text>
</g>
<!-- base_processing&#45;&gt;communication -->
<g id="edge5" class="edge">
<title>base_processing&#45;&gt;communication</title>
<path fill="none" stroke="black" d="M112.07,-219.44C112.07,-219.44 112.07,-149.55 112.07,-149.55"/>
<polygon fill="black" stroke="black" points="115.57,-149.55 112.07,-139.55 108.57,-149.55 115.57,-149.55"/>
</g>
<!-- base_attention&#45;&gt;communication -->
<g id="edge6" class="edge">
<title>base_attention&#45;&gt;communication</title>
<path fill="none" stroke="black" d="M244.5,-219.44C244.5,-219.44 244.5,-187.47 244.5,-187.47"/>
<polygon fill="black" stroke="black" points="248,-187.47 244.5,-177.47 241,-187.47 248,-187.47"/>
</g>
<!-- pool_attention&#45;&gt;communication -->
<g id="edge7" class="edge">
<title>pool_attention&#45;&gt;communication</title>
<path fill="none" stroke="black" d="M377.18,-213.9C377.18,-213.9 377.18,-187.32 377.18,-187.32"/>
<polygon fill="black" stroke="black" points="380.68,-187.32 377.18,-177.32 373.68,-187.32 380.68,-187.32"/>
</g>
<!-- output -->
<g id="node7" class="node">
<title>output</title>
<ellipse fill="none" stroke="black" cx="244.5" cy="-18" rx="142.41" ry="18"/>
<text text-anchor="middle" x="244.5" y="-15.5" font-family="Arial" font-size="10.00">Output&lt;br/&gt;[batch=1024, seq_len=?, vocab=32000]</text>
</g>
<!-- communication&#45;&gt;output -->
<g id="edge8" class="edge">
<title>communication&#45;&gt;output</title>
<path fill="none" stroke="black" d="M244.5,-72.75C244.5,-72.75 244.5,-46.17 244.5,-46.17"/>
<polygon fill="black" stroke="black" points="248,-46.17 244.5,-36.17 241,-46.17 248,-46.17"/>
</g>
</g>
</svg>
