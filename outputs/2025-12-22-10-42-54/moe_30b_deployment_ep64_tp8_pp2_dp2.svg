<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: MoE_30B_Deployment_EP64_TP8_PP2_DP2 Pages: 1 -->
<svg width="3929pt" height="12000pt"
 viewBox="0.00 0.00 942.88 2880.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(2.42 2.42) rotate(0) translate(4 4950.34)">
<title>MoE_30B_Deployment_EP64_TP8_PP2_DP2</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-4950.34 1618,-4950.34 1618,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_pp_0</title>
<path fill="lightgray" stroke="black" stroke-width="2" d="M506,-2657.58C506,-2657.58 1594,-2657.58 1594,-2657.58 1600,-2657.58 1606,-2663.58 1606,-2669.58 1606,-2669.58 1606,-4926.34 1606,-4926.34 1606,-4932.34 1600,-4938.34 1594,-4938.34 1594,-4938.34 506,-4938.34 506,-4938.34 500,-4938.34 494,-4932.34 494,-4926.34 494,-4926.34 494,-2669.58 494,-2669.58 494,-2663.58 500,-2657.58 506,-2657.58"/>
<text text-anchor="middle" x="1050" y="-4923.14" font-family="Times,serif" font-size="14.00">Pipeline Stage 0</text>
<text text-anchor="middle" x="1050" y="-4908.14" font-family="Times,serif" font-size="14.00">Layers 0&#45;7</text>
<text text-anchor="middle" x="1050" y="-4893.14" font-family="Times,serif" font-size="14.00">PP Rank: 0</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_layer_0</title>
<path fill="white" stroke="black" stroke-dasharray="5,2" d="M1097,-2665.58C1097,-2665.58 1586,-2665.58 1586,-2665.58 1592,-2665.58 1598,-2671.58 1598,-2677.58 1598,-2677.58 1598,-4865.34 1598,-4865.34 1598,-4871.34 1592,-4877.34 1586,-4877.34 1586,-4877.34 1097,-4877.34 1097,-4877.34 1091,-4877.34 1085,-4871.34 1085,-4865.34 1085,-4865.34 1085,-2677.58 1085,-2677.58 1085,-2671.58 1091,-2665.58 1097,-2665.58"/>
<text text-anchor="middle" x="1341.5" y="-4862.14" font-family="Times,serif" font-size="14.00">Layer 0</text>
<text text-anchor="middle" x="1341.5" y="-4847.14" font-family="Times,serif" font-size="14.00">PP Rank: 0</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_attn_0</title>
<path fill="lightblue" stroke="black" d="M1241,-3917.86C1241,-3917.86 1503,-3917.86 1503,-3917.86 1509,-3917.86 1515,-3923.86 1515,-3929.86 1515,-3929.86 1515,-4522.23 1515,-4522.23 1515,-4528.23 1509,-4534.23 1503,-4534.23 1503,-4534.23 1241,-4534.23 1241,-4534.23 1235,-4534.23 1229,-4528.23 1229,-4522.23 1229,-4522.23 1229,-3929.86 1229,-3929.86 1229,-3923.86 1235,-3917.86 1241,-3917.86"/>
<text text-anchor="middle" x="1372" y="-4519.03" font-family="Times,serif" font-size="14.00">Attention Block (TP8)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_moe_0</title>
<path fill="lightgreen" stroke="black" d="M1105,-2972.7C1105,-2972.7 1578,-2972.7 1578,-2972.7 1584,-2972.7 1590,-2978.7 1590,-2984.7 1590,-2984.7 1590,-3886.86 1590,-3886.86 1590,-3892.86 1584,-3898.86 1578,-3898.86 1578,-3898.86 1105,-3898.86 1105,-3898.86 1099,-3898.86 1093,-3892.86 1093,-3886.86 1093,-3886.86 1093,-2984.7 1093,-2984.7 1093,-2978.7 1099,-2972.7 1105,-2972.7"/>
<text text-anchor="middle" x="1341.5" y="-3883.66" font-family="Times,serif" font-size="14.00">MoE Block (EP64)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_experts_0</title>
<path fill="lightyellow" stroke="black" d="M1113,-3477.21C1113,-3477.21 1570,-3477.21 1570,-3477.21 1576,-3477.21 1582,-3483.21 1582,-3489.21 1582,-3489.21 1582,-3628.46 1582,-3628.46 1582,-3634.46 1576,-3640.46 1570,-3640.46 1570,-3640.46 1113,-3640.46 1113,-3640.46 1107,-3640.46 1101,-3634.46 1101,-3628.46 1101,-3628.46 1101,-3489.21 1101,-3489.21 1101,-3483.21 1107,-3477.21 1113,-3477.21"/>
<text text-anchor="middle" x="1341.5" y="-3625.26" font-family="Times,serif" font-size="14.00">Expert Computation (64 Experts Total, TP8 Each)</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_layer_1</title>
<path fill="white" stroke="black" stroke-dasharray="5,2" d="M576,-2665.58C576,-2665.58 1065,-2665.58 1065,-2665.58 1071,-2665.58 1077,-2671.58 1077,-2677.58 1077,-2677.58 1077,-4865.34 1077,-4865.34 1077,-4871.34 1071,-4877.34 1065,-4877.34 1065,-4877.34 576,-4877.34 576,-4877.34 570,-4877.34 564,-4871.34 564,-4865.34 564,-4865.34 564,-2677.58 564,-2677.58 564,-2671.58 570,-2665.58 576,-2665.58"/>
<text text-anchor="middle" x="820.5" y="-4862.14" font-family="Times,serif" font-size="14.00">Layer 1</text>
<text text-anchor="middle" x="820.5" y="-4847.14" font-family="Times,serif" font-size="14.00">PP Rank: 0</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_attn_1</title>
<path fill="lightblue" stroke="black" d="M716,-3917.86C716,-3917.86 978,-3917.86 978,-3917.86 984,-3917.86 990,-3923.86 990,-3929.86 990,-3929.86 990,-4522.23 990,-4522.23 990,-4528.23 984,-4534.23 978,-4534.23 978,-4534.23 716,-4534.23 716,-4534.23 710,-4534.23 704,-4528.23 704,-4522.23 704,-4522.23 704,-3929.86 704,-3929.86 704,-3923.86 710,-3917.86 716,-3917.86"/>
<text text-anchor="middle" x="847" y="-4519.03" font-family="Times,serif" font-size="14.00">Attention Block (TP8)</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_moe_1</title>
<path fill="lightgreen" stroke="black" d="M584,-2972.7C584,-2972.7 1057,-2972.7 1057,-2972.7 1063,-2972.7 1069,-2978.7 1069,-2984.7 1069,-2984.7 1069,-3886.86 1069,-3886.86 1069,-3892.86 1063,-3898.86 1057,-3898.86 1057,-3898.86 584,-3898.86 584,-3898.86 578,-3898.86 572,-3892.86 572,-3886.86 572,-3886.86 572,-2984.7 572,-2984.7 572,-2978.7 578,-2972.7 584,-2972.7"/>
<text text-anchor="middle" x="820.5" y="-3883.66" font-family="Times,serif" font-size="14.00">MoE Block (EP64)</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_experts_1</title>
<path fill="lightyellow" stroke="black" d="M592,-3477.21C592,-3477.21 1049,-3477.21 1049,-3477.21 1055,-3477.21 1061,-3483.21 1061,-3489.21 1061,-3489.21 1061,-3628.46 1061,-3628.46 1061,-3634.46 1055,-3640.46 1049,-3640.46 1049,-3640.46 592,-3640.46 592,-3640.46 586,-3640.46 580,-3634.46 580,-3628.46 580,-3628.46 580,-3489.21 580,-3489.21 580,-3483.21 586,-3477.21 592,-3477.21"/>
<text text-anchor="middle" x="820.5" y="-3625.26" font-family="Times,serif" font-size="14.00">Expert Computation (64 Experts Total, TP8 Each)</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_pp_1</title>
<path fill="lightgray" stroke="black" stroke-width="2" d="M20,-277.56C20,-277.56 1046,-277.56 1046,-277.56 1052,-277.56 1058,-283.56 1058,-289.56 1058,-289.56 1058,-2546.33 1058,-2546.33 1058,-2552.33 1052,-2558.33 1046,-2558.33 1046,-2558.33 20,-2558.33 20,-2558.33 14,-2558.33 8,-2552.33 8,-2546.33 8,-2546.33 8,-289.56 8,-289.56 8,-283.56 14,-277.56 20,-277.56"/>
<text text-anchor="middle" x="533" y="-2543.13" font-family="Times,serif" font-size="14.00">Pipeline Stage 1</text>
<text text-anchor="middle" x="533" y="-2528.13" font-family="Times,serif" font-size="14.00">Layers 8&#45;15</text>
<text text-anchor="middle" x="533" y="-2513.13" font-family="Times,serif" font-size="14.00">PP Rank: 1</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_layer_14</title>
<path fill="white" stroke="black" stroke-dasharray="5,2" d="M549,-285.56C549,-285.56 1038,-285.56 1038,-285.56 1044,-285.56 1050,-291.56 1050,-297.56 1050,-297.56 1050,-2485.33 1050,-2485.33 1050,-2491.33 1044,-2497.33 1038,-2497.33 1038,-2497.33 549,-2497.33 549,-2497.33 543,-2497.33 537,-2491.33 537,-2485.33 537,-2485.33 537,-297.56 537,-297.56 537,-291.56 543,-285.56 549,-285.56"/>
<text text-anchor="middle" x="793.5" y="-2482.13" font-family="Times,serif" font-size="14.00">Layer 14</text>
<text text-anchor="middle" x="793.5" y="-2467.13" font-family="Times,serif" font-size="14.00">PP Rank: 1</text>
</g>
<g id="clust12" class="cluster">
<title>cluster_attn_14</title>
<path fill="lightblue" stroke="black" d="M689,-1537.84C689,-1537.84 951,-1537.84 951,-1537.84 957,-1537.84 963,-1543.84 963,-1549.84 963,-1549.84 963,-2142.21 963,-2142.21 963,-2148.21 957,-2154.21 951,-2154.21 951,-2154.21 689,-2154.21 689,-2154.21 683,-2154.21 677,-2148.21 677,-2142.21 677,-2142.21 677,-1549.84 677,-1549.84 677,-1543.84 683,-1537.84 689,-1537.84"/>
<text text-anchor="middle" x="820" y="-2139.01" font-family="Times,serif" font-size="14.00">Attention Block (TP8)</text>
</g>
<g id="clust13" class="cluster">
<title>cluster_moe_14</title>
<path fill="lightgreen" stroke="black" d="M557,-592.68C557,-592.68 1030,-592.68 1030,-592.68 1036,-592.68 1042,-598.68 1042,-604.68 1042,-604.68 1042,-1506.84 1042,-1506.84 1042,-1512.84 1036,-1518.84 1030,-1518.84 1030,-1518.84 557,-1518.84 557,-1518.84 551,-1518.84 545,-1512.84 545,-1506.84 545,-1506.84 545,-604.68 545,-604.68 545,-598.68 551,-592.68 557,-592.68"/>
<text text-anchor="middle" x="793.5" y="-1503.64" font-family="Times,serif" font-size="14.00">MoE Block (EP64)</text>
</g>
<g id="clust14" class="cluster">
<title>cluster_experts_14</title>
<path fill="lightyellow" stroke="black" d="M565,-1097.19C565,-1097.19 1022,-1097.19 1022,-1097.19 1028,-1097.19 1034,-1103.19 1034,-1109.19 1034,-1109.19 1034,-1248.45 1034,-1248.45 1034,-1254.45 1028,-1260.45 1022,-1260.45 1022,-1260.45 565,-1260.45 565,-1260.45 559,-1260.45 553,-1254.45 553,-1248.45 553,-1248.45 553,-1109.19 553,-1109.19 553,-1103.19 559,-1097.19 565,-1097.19"/>
<text text-anchor="middle" x="793.5" y="-1245.25" font-family="Times,serif" font-size="14.00">Expert Computation (64 Experts Total, TP8 Each)</text>
</g>
<g id="clust15" class="cluster">
<title>cluster_layer_15</title>
<path fill="white" stroke="black" stroke-dasharray="5,2" d="M28,-285.56C28,-285.56 517,-285.56 517,-285.56 523,-285.56 529,-291.56 529,-297.56 529,-297.56 529,-2485.33 529,-2485.33 529,-2491.33 523,-2497.33 517,-2497.33 517,-2497.33 28,-2497.33 28,-2497.33 22,-2497.33 16,-2491.33 16,-2485.33 16,-2485.33 16,-297.56 16,-297.56 16,-291.56 22,-285.56 28,-285.56"/>
<text text-anchor="middle" x="272.5" y="-2482.13" font-family="Times,serif" font-size="14.00">Layer 15</text>
<text text-anchor="middle" x="272.5" y="-2467.13" font-family="Times,serif" font-size="14.00">PP Rank: 1</text>
</g>
<g id="clust16" class="cluster">
<title>cluster_attn_15</title>
<path fill="lightblue" stroke="black" d="M168,-1537.84C168,-1537.84 430,-1537.84 430,-1537.84 436,-1537.84 442,-1543.84 442,-1549.84 442,-1549.84 442,-2142.21 442,-2142.21 442,-2148.21 436,-2154.21 430,-2154.21 430,-2154.21 168,-2154.21 168,-2154.21 162,-2154.21 156,-2148.21 156,-2142.21 156,-2142.21 156,-1549.84 156,-1549.84 156,-1543.84 162,-1537.84 168,-1537.84"/>
<text text-anchor="middle" x="299" y="-2139.01" font-family="Times,serif" font-size="14.00">Attention Block (TP8)</text>
</g>
<g id="clust17" class="cluster">
<title>cluster_moe_15</title>
<path fill="lightgreen" stroke="black" d="M36,-592.68C36,-592.68 509,-592.68 509,-592.68 515,-592.68 521,-598.68 521,-604.68 521,-604.68 521,-1506.84 521,-1506.84 521,-1512.84 515,-1518.84 509,-1518.84 509,-1518.84 36,-1518.84 36,-1518.84 30,-1518.84 24,-1512.84 24,-1506.84 24,-1506.84 24,-604.68 24,-604.68 24,-598.68 30,-592.68 36,-592.68"/>
<text text-anchor="middle" x="272.5" y="-1503.64" font-family="Times,serif" font-size="14.00">MoE Block (EP64)</text>
</g>
<g id="clust18" class="cluster">
<title>cluster_experts_15</title>
<path fill="lightyellow" stroke="black" d="M44,-1097.19C44,-1097.19 501,-1097.19 501,-1097.19 507,-1097.19 513,-1103.19 513,-1109.19 513,-1109.19 513,-1248.45 513,-1248.45 513,-1254.45 507,-1260.45 501,-1260.45 501,-1260.45 44,-1260.45 44,-1260.45 38,-1260.45 32,-1254.45 32,-1248.45 32,-1248.45 32,-1109.19 32,-1109.19 32,-1103.19 38,-1097.19 44,-1097.19"/>
<text text-anchor="middle" x="272.5" y="-1245.25" font-family="Times,serif" font-size="14.00">Expert Computation (64 Experts Total, TP8 Each)</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<ellipse fill="white" stroke="black" stroke-width="2" cx="363" cy="-4696.29" rx="120.8" ry="120.8"/>
<text text-anchor="middle" x="363" y="-4699.09" font-family="Times,serif" font-size="9.00">Model Input</text>
<text text-anchor="middle" x="363" y="-4689.09" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
</g>
<!-- layer_0_input -->
<g id="node2" class="node">
<title>layer_0_input</title>
<ellipse fill="white" stroke="black" cx="1372" cy="-4696.29" rx="135.11" ry="135.11"/>
<text text-anchor="middle" x="1372" y="-4699.09" font-family="Times,serif" font-size="9.00">Layer 0 Input</text>
<text text-anchor="middle" x="1372" y="-4689.09" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
</g>
<!-- qkv_0 -->
<g id="node3" class="node">
<title>qkv_0</title>
<polygon fill="lightblue" stroke="black" points="1436,-4503.23 1308,-4503.23 1308,-4461.23 1436,-4461.23 1436,-4503.23"/>
<text text-anchor="middle" x="1372" y="-4495.03" font-family="Times,serif" font-size="9.00">QKV Projection</text>
<text text-anchor="middle" x="1372" y="-4485.03" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024]</text>
<text text-anchor="middle" x="1372" y="-4475.03" font-family="Times,serif" font-size="9.00">→ [3×heads=16, d_k=64]</text>
<text text-anchor="middle" x="1372" y="-4465.03" font-family="Times,serif" font-size="9.00">GPU: All TP Ranks</text>
</g>
<!-- layer_0_input&#45;&gt;qkv_0 -->
<g id="edge16" class="edge">
<title>layer_0_input&#45;&gt;qkv_0</title>
<path fill="none" stroke="black" d="M1372,-4560.99C1372,-4543.39 1372,-4526.92 1372,-4513.7"/>
<polygon fill="black" stroke="black" points="1375.5,-4513.42 1372,-4503.42 1368.5,-4513.42 1375.5,-4513.42"/>
</g>
<!-- attn_comp_0 -->
<g id="node4" class="node">
<title>attn_comp_0</title>
<polygon fill="lightblue" stroke="black" points="1459,-4424.23 1285,-4424.23 1285,-4388.23 1459,-4388.23 1459,-4424.23"/>
<text text-anchor="middle" x="1372" y="-4414.03" font-family="Times,serif" font-size="9.00">Attention Scores+Softmax</text>
<text text-anchor="middle" x="1372" y="-4404.03" font-family="Times,serif" font-size="9.00">[batch=128, heads=16, seq=1024]</text>
<text text-anchor="middle" x="1372" y="-4394.03" font-family="Times,serif" font-size="9.00">GPU: All TP Ranks</text>
</g>
<!-- qkv_0&#45;&gt;attn_comp_0 -->
<g id="edge1" class="edge">
<title>qkv_0&#45;&gt;attn_comp_0</title>
<path fill="none" stroke="black" d="M1372,-4461.01C1372,-4452.85 1372,-4443.32 1372,-4434.57"/>
<polygon fill="black" stroke="black" points="1375.5,-4434.42 1372,-4424.42 1368.5,-4434.42 1375.5,-4434.42"/>
</g>
<!-- attn_ar_0 -->
<g id="node5" class="node">
<title>attn_ar_0</title>
<ellipse fill="lightyellow" stroke="black" cx="1372" cy="-4328.6" rx="135.11" ry="22.76"/>
<text text-anchor="middle" x="1372" y="-4336.4" font-family="Times,serif" font-size="9.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="1372" y="-4326.4" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
<text text-anchor="middle" x="1372" y="-4316.4" font-family="Times,serif" font-size="9.00">GPU: All TP Ranks</text>
</g>
<!-- attn_comp_0&#45;&gt;attn_ar_0 -->
<g id="edge2" class="edge">
<title>attn_comp_0&#45;&gt;attn_ar_0</title>
<path fill="none" stroke="black" d="M1372,-4388.07C1372,-4380.15 1372,-4370.49 1372,-4361.33"/>
<polygon fill="black" stroke="black" points="1375.5,-4361.3 1372,-4351.3 1368.5,-4361.3 1375.5,-4361.3"/>
</g>
<!-- attn_proj_0 -->
<g id="node6" class="node">
<title>attn_proj_0</title>
<polygon fill="lightblue" stroke="black" points="1467.5,-4268.97 1276.5,-4268.97 1276.5,-4232.97 1467.5,-4232.97 1467.5,-4268.97"/>
<text text-anchor="middle" x="1372" y="-4258.77" font-family="Times,serif" font-size="9.00">Output Projection</text>
<text text-anchor="middle" x="1372" y="-4248.77" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
<text text-anchor="middle" x="1372" y="-4238.77" font-family="Times,serif" font-size="9.00">GPU: All TP Ranks</text>
</g>
<!-- attn_ar_0&#45;&gt;attn_proj_0 -->
<g id="edge3" class="edge">
<title>attn_ar_0&#45;&gt;attn_proj_0</title>
<path fill="none" stroke="black" d="M1372,-4305.73C1372,-4297.42 1372,-4287.85 1372,-4279.11"/>
<polygon fill="black" stroke="black" points="1375.5,-4279 1372,-4269 1368.5,-4279 1375.5,-4279"/>
</g>
<!-- attn_out_0 -->
<g id="node7" class="node">
<title>attn_out_0</title>
<ellipse fill="white" stroke="black" cx="1372" cy="-4060.92" rx="135.11" ry="135.11"/>
<text text-anchor="middle" x="1372" y="-4063.72" font-family="Times,serif" font-size="9.00">Attention Output</text>
<text text-anchor="middle" x="1372" y="-4053.72" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
</g>
<!-- attn_proj_0&#45;&gt;attn_out_0 -->
<g id="edge4" class="edge">
<title>attn_proj_0&#45;&gt;attn_out_0</title>
<path fill="none" stroke="black" d="M1372,-4232.95C1372,-4225.76 1372,-4216.67 1372,-4206.45"/>
<polygon fill="black" stroke="black" points="1375.5,-4206.33 1372,-4196.33 1368.5,-4206.33 1375.5,-4206.33"/>
</g>
<!-- gate_0 -->
<g id="node8" class="node">
<title>gate_0</title>
<polygon fill="lightgreen" stroke="black" points="1497.39,-3867.86 1297.92,-3867.86 1246.61,-3763.86 1446.08,-3763.86 1497.39,-3867.86"/>
<text text-anchor="middle" x="1372" y="-3833.66" font-family="Times,serif" font-size="9.00">Gate Selection</text>
<text text-anchor="middle" x="1372" y="-3823.66" font-family="Times,serif" font-size="9.00">Top&#45;2 Experts</text>
<text text-anchor="middle" x="1372" y="-3813.66" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024]</text>
<text text-anchor="middle" x="1372" y="-3803.66" font-family="Times,serif" font-size="9.00">→ [num_experts=64]</text>
<text text-anchor="middle" x="1372" y="-3793.66" font-family="Times,serif" font-size="9.00">GPU: All EP Ranks</text>
</g>
<!-- attn_out_0&#45;&gt;gate_0 -->
<g id="edge17" class="edge">
<title>attn_out_0&#45;&gt;gate_0</title>
<path fill="none" stroke="black" d="M1372,-3925.59C1372,-3909.16 1372,-3893.04 1372,-3878.46"/>
<polygon fill="black" stroke="black" points="1375.5,-3878.13 1372,-3868.13 1368.5,-3878.13 1375.5,-3878.13"/>
</g>
<!-- dispatch_0 -->
<g id="node9" class="node">
<title>dispatch_0</title>
<ellipse fill="lightyellow" stroke="black" cx="1372" cy="-3697.16" rx="85.62" ry="29.9"/>
<text text-anchor="middle" x="1372" y="-3709.96" font-family="Times,serif" font-size="9.00">Expert Dispatch</text>
<text text-anchor="middle" x="1372" y="-3699.96" font-family="Times,serif" font-size="9.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="1372" y="-3689.96" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024]</text>
<text text-anchor="middle" x="1372" y="-3679.96" font-family="Times,serif" font-size="9.00">GPU: All EP Ranks</text>
</g>
<!-- gate_0&#45;&gt;dispatch_0 -->
<g id="edge7" class="edge">
<title>gate_0&#45;&gt;dispatch_0</title>
<path fill="none" stroke="black" d="M1372,-3763.67C1372,-3754.71 1372,-3745.51 1372,-3736.94"/>
<polygon fill="black" stroke="black" points="1375.5,-3736.87 1372,-3726.87 1368.5,-3736.87 1375.5,-3736.87"/>
</g>
<!-- expert_0_0 -->
<g id="node10" class="node">
<title>expert_0_0</title>
<polygon fill="lightblue" stroke="black" points="1339,-3609.46 1181,-3609.46 1181,-3567.46 1339,-3567.46 1339,-3609.46"/>
<text text-anchor="middle" x="1260" y="-3601.26" font-family="Times,serif" font-size="9.00">Expert 0 MLP</text>
<text text-anchor="middle" x="1260" y="-3591.26" font-family="Times,serif" font-size="9.00">[batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="1260" y="-3581.26" font-family="Times,serif" font-size="9.00">→ [2048] → [1024]</text>
<text text-anchor="middle" x="1260" y="-3571.26" font-family="Times,serif" font-size="9.00">GPU: EP0, TP0&#45;TP7</text>
</g>
<!-- gate_0&#45;&gt;expert_0_0 -->
<g id="edge14" class="edge">
<title>gate_0&#45;&gt;expert_0_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1268.2,-3763.7C1255.7,-3753.23 1244.66,-3741 1237,-3726.86 1218.68,-3693.04 1231.99,-3648.22 1244.71,-3619.12"/>
<polygon fill="black" stroke="black" points="1247.96,-3620.44 1248.95,-3609.89 1241.6,-3617.51 1247.96,-3620.44"/>
<text text-anchor="middle" x="1257" y="-3693.46" font-family="Times,serif" font-size="14.00">Top&#45;2</text>
</g>
<!-- expert_0_1 -->
<g id="node12" class="node">
<title>expert_0_1</title>
<polygon fill="lightblue" stroke="black" points="1541,-3609.46 1383,-3609.46 1383,-3567.46 1541,-3567.46 1541,-3609.46"/>
<text text-anchor="middle" x="1462" y="-3601.26" font-family="Times,serif" font-size="9.00">Expert 1 MLP</text>
<text text-anchor="middle" x="1462" y="-3591.26" font-family="Times,serif" font-size="9.00">[batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="1462" y="-3581.26" font-family="Times,serif" font-size="9.00">→ [2048] → [1024]</text>
<text text-anchor="middle" x="1462" y="-3571.26" font-family="Times,serif" font-size="9.00">GPU: EP1, TP0&#45;TP7</text>
</g>
<!-- gate_0&#45;&gt;expert_0_1 -->
<g id="edge15" class="edge">
<title>gate_0&#45;&gt;expert_0_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1441.97,-3763.36C1452.15,-3752.52 1461.15,-3740.25 1467,-3726.86 1482.06,-3692.38 1476.68,-3648.26 1470.32,-3619.45"/>
<polygon fill="black" stroke="black" points="1473.69,-3618.5 1467.97,-3609.58 1466.88,-3620.12 1473.69,-3618.5"/>
<text text-anchor="middle" x="1496" y="-3693.46" font-family="Times,serif" font-size="14.00">Top&#45;2</text>
</g>
<!-- dispatch_0&#45;&gt;expert_0_0 -->
<g id="edge8" class="edge">
<title>dispatch_0&#45;&gt;expert_0_0</title>
<path fill="none" stroke="black" d="M1343.45,-3668.96C1326.59,-3652.9 1305.32,-3632.63 1288.47,-3616.58"/>
<polygon fill="black" stroke="black" points="1290.73,-3613.9 1281.07,-3609.54 1285.9,-3618.97 1290.73,-3613.9"/>
</g>
<!-- dispatch_0&#45;&gt;expert_0_1 -->
<g id="edge9" class="edge">
<title>dispatch_0&#45;&gt;expert_0_1</title>
<path fill="none" stroke="black" d="M1395.41,-3668.41C1408.63,-3652.74 1425.1,-3633.21 1438.36,-3617.49"/>
<polygon fill="black" stroke="black" points="1441.19,-3619.56 1444.96,-3609.66 1435.84,-3615.05 1441.19,-3619.56"/>
</g>
<!-- expert_ar_0_0 -->
<g id="node11" class="node">
<title>expert_ar_0_0</title>
<ellipse fill="lightyellow" stroke="black" cx="1221" cy="-3507.84" rx="111.95" ry="22.76"/>
<text text-anchor="middle" x="1221" y="-3515.64" font-family="Times,serif" font-size="9.00">Expert 0 TP All&#45;Reduce</text>
<text text-anchor="middle" x="1221" y="-3505.64" font-family="Times,serif" font-size="9.00">[batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="1221" y="-3495.64" font-family="Times,serif" font-size="9.00">GPU: EP0, TP0&#45;TP7</text>
</g>
<!-- expert_0_0&#45;&gt;expert_ar_0_0 -->
<g id="edge5" class="edge">
<title>expert_0_0&#45;&gt;expert_ar_0_0</title>
<path fill="none" stroke="black" d="M1249.96,-3567.21C1245.76,-3558.75 1240.79,-3548.73 1236.16,-3539.41"/>
<polygon fill="black" stroke="black" points="1239.27,-3537.8 1231.69,-3530.39 1233,-3540.91 1239.27,-3537.8"/>
</g>
<!-- combine_0 -->
<g id="node15" class="node">
<title>combine_0</title>
<ellipse fill="lightyellow" stroke="black" cx="1341" cy="-3418.51" rx="85.62" ry="29.9"/>
<text text-anchor="middle" x="1341" y="-3431.31" font-family="Times,serif" font-size="9.00">Expert Combine</text>
<text text-anchor="middle" x="1341" y="-3421.31" font-family="Times,serif" font-size="9.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="1341" y="-3411.31" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024]</text>
<text text-anchor="middle" x="1341" y="-3401.31" font-family="Times,serif" font-size="9.00">GPU: All EP Ranks</text>
</g>
<!-- expert_ar_0_0&#45;&gt;combine_0 -->
<g id="edge10" class="edge">
<title>expert_ar_0_0&#45;&gt;combine_0</title>
<path fill="none" stroke="black" d="M1249.74,-3485.92C1263.91,-3475.61 1281.31,-3462.95 1297.1,-3451.45"/>
<polygon fill="black" stroke="black" points="1299.16,-3454.28 1305.19,-3445.57 1295.04,-3448.62 1299.16,-3454.28"/>
</g>
<!-- expert_ar_0_1 -->
<g id="node13" class="node">
<title>expert_ar_0_1</title>
<ellipse fill="lightyellow" stroke="black" cx="1462" cy="-3507.84" rx="111.95" ry="22.76"/>
<text text-anchor="middle" x="1462" y="-3515.64" font-family="Times,serif" font-size="9.00">Expert 1 TP All&#45;Reduce</text>
<text text-anchor="middle" x="1462" y="-3505.64" font-family="Times,serif" font-size="9.00">[batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="1462" y="-3495.64" font-family="Times,serif" font-size="9.00">GPU: EP1, TP0&#45;TP7</text>
</g>
<!-- expert_0_1&#45;&gt;expert_ar_0_1 -->
<g id="edge6" class="edge">
<title>expert_0_1&#45;&gt;expert_ar_0_1</title>
<path fill="none" stroke="black" d="M1462,-3567.21C1462,-3559.17 1462,-3549.72 1462,-3540.79"/>
<polygon fill="black" stroke="black" points="1465.5,-3540.67 1462,-3530.67 1458.5,-3540.67 1465.5,-3540.67"/>
</g>
<!-- expert_ar_0_1&#45;&gt;combine_0 -->
<g id="edge11" class="edge">
<title>expert_ar_0_1&#45;&gt;combine_0</title>
<path fill="none" stroke="black" d="M1433.02,-3485.92C1418.73,-3475.61 1401.19,-3462.95 1385.26,-3451.45"/>
<polygon fill="black" stroke="black" points="1387.27,-3448.58 1377.11,-3445.57 1383.17,-3454.26 1387.27,-3448.58"/>
</g>
<!-- expert_ellipsis_0 -->
<g id="node14" class="node">
<title>expert_ellipsis_0</title>
<text text-anchor="middle" x="1136" y="-3586.26" font-family="Times,serif" font-size="9.00">...</text>
</g>
<!-- aggregate_0 -->
<g id="node16" class="node">
<title>aggregate_0</title>
<polygon fill="lightcoral" stroke="black" points="1539.04,-3351.81 1224,-3351.81 1142.96,-3287.81 1458,-3287.81 1539.04,-3351.81"/>
<text text-anchor="middle" x="1341" y="-3327.61" font-family="Times,serif" font-size="9.00">Expert Output Aggregation</text>
<text text-anchor="middle" x="1341" y="-3317.61" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
<text text-anchor="middle" x="1341" y="-3307.61" font-family="Times,serif" font-size="9.00">GPU: All EP Ranks</text>
</g>
<!-- combine_0&#45;&gt;aggregate_0 -->
<g id="edge12" class="edge">
<title>combine_0&#45;&gt;aggregate_0</title>
<path fill="none" stroke="black" d="M1341,-3388.76C1341,-3380.44 1341,-3371.18 1341,-3362.25"/>
<polygon fill="black" stroke="black" points="1344.5,-3361.98 1341,-3351.98 1337.5,-3361.98 1344.5,-3361.98"/>
</g>
<!-- moe_out_0 -->
<g id="node17" class="node">
<title>moe_out_0</title>
<ellipse fill="white" stroke="black" cx="1341" cy="-3115.75" rx="135.11" ry="135.11"/>
<text text-anchor="middle" x="1341" y="-3118.55" font-family="Times,serif" font-size="9.00">MoE Output</text>
<text text-anchor="middle" x="1341" y="-3108.55" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
</g>
<!-- aggregate_0&#45;&gt;moe_out_0 -->
<g id="edge13" class="edge">
<title>aggregate_0&#45;&gt;moe_out_0</title>
<path fill="none" stroke="black" d="M1341,-3287.68C1341,-3279.79 1341,-3270.79 1341,-3261.14"/>
<polygon fill="black" stroke="black" points="1344.5,-3260.86 1341,-3250.86 1337.5,-3260.86 1344.5,-3260.86"/>
</g>
<!-- layer_0_output -->
<g id="node18" class="node">
<title>layer_0_output</title>
<ellipse fill="white" stroke="black" cx="1341" cy="-2808.64" rx="135.11" ry="135.11"/>
<text text-anchor="middle" x="1341" y="-2811.44" font-family="Times,serif" font-size="9.00">Layer 0 Output</text>
<text text-anchor="middle" x="1341" y="-2801.44" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
</g>
<!-- moe_out_0&#45;&gt;layer_0_output -->
<g id="edge18" class="edge">
<title>moe_out_0&#45;&gt;layer_0_output</title>
<path fill="none" stroke="black" d="M1341,-2980.48C1341,-2971.75 1341,-2962.93 1341,-2954.15"/>
<polygon fill="black" stroke="black" points="1344.5,-2953.87 1341,-2943.87 1337.5,-2953.87 1344.5,-2953.87"/>
</g>
<!-- layer_1_input -->
<g id="node19" class="node">
<title>layer_1_input</title>
<ellipse fill="white" stroke="black" cx="847" cy="-4696.29" rx="135.11" ry="135.11"/>
<text text-anchor="middle" x="847" y="-4699.09" font-family="Times,serif" font-size="9.00">Layer 1 Input</text>
<text text-anchor="middle" x="847" y="-4689.09" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
</g>
<!-- qkv_1 -->
<g id="node20" class="node">
<title>qkv_1</title>
<polygon fill="lightblue" stroke="black" points="911,-4503.23 783,-4503.23 783,-4461.23 911,-4461.23 911,-4503.23"/>
<text text-anchor="middle" x="847" y="-4495.03" font-family="Times,serif" font-size="9.00">QKV Projection</text>
<text text-anchor="middle" x="847" y="-4485.03" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024]</text>
<text text-anchor="middle" x="847" y="-4475.03" font-family="Times,serif" font-size="9.00">→ [3×heads=16, d_k=64]</text>
<text text-anchor="middle" x="847" y="-4465.03" font-family="Times,serif" font-size="9.00">GPU: All TP Ranks</text>
</g>
<!-- layer_1_input&#45;&gt;qkv_1 -->
<g id="edge34" class="edge">
<title>layer_1_input&#45;&gt;qkv_1</title>
<path fill="none" stroke="black" d="M847,-4560.99C847,-4543.39 847,-4526.92 847,-4513.7"/>
<polygon fill="black" stroke="black" points="850.5,-4513.42 847,-4503.42 843.5,-4513.42 850.5,-4513.42"/>
</g>
<!-- attn_comp_1 -->
<g id="node21" class="node">
<title>attn_comp_1</title>
<polygon fill="lightblue" stroke="black" points="934,-4424.23 760,-4424.23 760,-4388.23 934,-4388.23 934,-4424.23"/>
<text text-anchor="middle" x="847" y="-4414.03" font-family="Times,serif" font-size="9.00">Attention Scores+Softmax</text>
<text text-anchor="middle" x="847" y="-4404.03" font-family="Times,serif" font-size="9.00">[batch=128, heads=16, seq=1024]</text>
<text text-anchor="middle" x="847" y="-4394.03" font-family="Times,serif" font-size="9.00">GPU: All TP Ranks</text>
</g>
<!-- qkv_1&#45;&gt;attn_comp_1 -->
<g id="edge19" class="edge">
<title>qkv_1&#45;&gt;attn_comp_1</title>
<path fill="none" stroke="black" d="M847,-4461.01C847,-4452.85 847,-4443.32 847,-4434.57"/>
<polygon fill="black" stroke="black" points="850.5,-4434.42 847,-4424.42 843.5,-4434.42 850.5,-4434.42"/>
</g>
<!-- attn_ar_1 -->
<g id="node22" class="node">
<title>attn_ar_1</title>
<ellipse fill="lightyellow" stroke="black" cx="847" cy="-4328.6" rx="135.11" ry="22.76"/>
<text text-anchor="middle" x="847" y="-4336.4" font-family="Times,serif" font-size="9.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="847" y="-4326.4" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
<text text-anchor="middle" x="847" y="-4316.4" font-family="Times,serif" font-size="9.00">GPU: All TP Ranks</text>
</g>
<!-- attn_comp_1&#45;&gt;attn_ar_1 -->
<g id="edge20" class="edge">
<title>attn_comp_1&#45;&gt;attn_ar_1</title>
<path fill="none" stroke="black" d="M847,-4388.07C847,-4380.15 847,-4370.49 847,-4361.33"/>
<polygon fill="black" stroke="black" points="850.5,-4361.3 847,-4351.3 843.5,-4361.3 850.5,-4361.3"/>
</g>
<!-- attn_proj_1 -->
<g id="node23" class="node">
<title>attn_proj_1</title>
<polygon fill="lightblue" stroke="black" points="942.5,-4268.97 751.5,-4268.97 751.5,-4232.97 942.5,-4232.97 942.5,-4268.97"/>
<text text-anchor="middle" x="847" y="-4258.77" font-family="Times,serif" font-size="9.00">Output Projection</text>
<text text-anchor="middle" x="847" y="-4248.77" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
<text text-anchor="middle" x="847" y="-4238.77" font-family="Times,serif" font-size="9.00">GPU: All TP Ranks</text>
</g>
<!-- attn_ar_1&#45;&gt;attn_proj_1 -->
<g id="edge21" class="edge">
<title>attn_ar_1&#45;&gt;attn_proj_1</title>
<path fill="none" stroke="black" d="M847,-4305.73C847,-4297.42 847,-4287.85 847,-4279.11"/>
<polygon fill="black" stroke="black" points="850.5,-4279 847,-4269 843.5,-4279 850.5,-4279"/>
</g>
<!-- attn_out_1 -->
<g id="node24" class="node">
<title>attn_out_1</title>
<ellipse fill="white" stroke="black" cx="847" cy="-4060.92" rx="135.11" ry="135.11"/>
<text text-anchor="middle" x="847" y="-4063.72" font-family="Times,serif" font-size="9.00">Attention Output</text>
<text text-anchor="middle" x="847" y="-4053.72" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
</g>
<!-- attn_proj_1&#45;&gt;attn_out_1 -->
<g id="edge22" class="edge">
<title>attn_proj_1&#45;&gt;attn_out_1</title>
<path fill="none" stroke="black" d="M847,-4232.95C847,-4225.76 847,-4216.67 847,-4206.45"/>
<polygon fill="black" stroke="black" points="850.5,-4206.33 847,-4196.33 843.5,-4206.33 850.5,-4206.33"/>
</g>
<!-- gate_1 -->
<g id="node25" class="node">
<title>gate_1</title>
<polygon fill="lightgreen" stroke="black" points="972.39,-3867.86 772.92,-3867.86 721.61,-3763.86 921.08,-3763.86 972.39,-3867.86"/>
<text text-anchor="middle" x="847" y="-3833.66" font-family="Times,serif" font-size="9.00">Gate Selection</text>
<text text-anchor="middle" x="847" y="-3823.66" font-family="Times,serif" font-size="9.00">Top&#45;2 Experts</text>
<text text-anchor="middle" x="847" y="-3813.66" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024]</text>
<text text-anchor="middle" x="847" y="-3803.66" font-family="Times,serif" font-size="9.00">→ [num_experts=64]</text>
<text text-anchor="middle" x="847" y="-3793.66" font-family="Times,serif" font-size="9.00">GPU: All EP Ranks</text>
</g>
<!-- attn_out_1&#45;&gt;gate_1 -->
<g id="edge35" class="edge">
<title>attn_out_1&#45;&gt;gate_1</title>
<path fill="none" stroke="black" d="M847,-3925.59C847,-3909.16 847,-3893.04 847,-3878.46"/>
<polygon fill="black" stroke="black" points="850.5,-3878.13 847,-3868.13 843.5,-3878.13 850.5,-3878.13"/>
</g>
<!-- dispatch_1 -->
<g id="node26" class="node">
<title>dispatch_1</title>
<ellipse fill="lightyellow" stroke="black" cx="847" cy="-3697.16" rx="85.62" ry="29.9"/>
<text text-anchor="middle" x="847" y="-3709.96" font-family="Times,serif" font-size="9.00">Expert Dispatch</text>
<text text-anchor="middle" x="847" y="-3699.96" font-family="Times,serif" font-size="9.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="847" y="-3689.96" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024]</text>
<text text-anchor="middle" x="847" y="-3679.96" font-family="Times,serif" font-size="9.00">GPU: All EP Ranks</text>
</g>
<!-- gate_1&#45;&gt;dispatch_1 -->
<g id="edge25" class="edge">
<title>gate_1&#45;&gt;dispatch_1</title>
<path fill="none" stroke="black" d="M847,-3763.67C847,-3754.71 847,-3745.51 847,-3736.94"/>
<polygon fill="black" stroke="black" points="850.5,-3736.87 847,-3726.87 843.5,-3736.87 850.5,-3736.87"/>
</g>
<!-- expert_1_0 -->
<g id="node27" class="node">
<title>expert_1_0</title>
<polygon fill="lightblue" stroke="black" points="818,-3609.46 660,-3609.46 660,-3567.46 818,-3567.46 818,-3609.46"/>
<text text-anchor="middle" x="739" y="-3601.26" font-family="Times,serif" font-size="9.00">Expert 0 MLP</text>
<text text-anchor="middle" x="739" y="-3591.26" font-family="Times,serif" font-size="9.00">[batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="739" y="-3581.26" font-family="Times,serif" font-size="9.00">→ [2048] → [1024]</text>
<text text-anchor="middle" x="739" y="-3571.26" font-family="Times,serif" font-size="9.00">GPU: EP0, TP0&#45;TP7</text>
</g>
<!-- gate_1&#45;&gt;expert_1_0 -->
<g id="edge32" class="edge">
<title>gate_1&#45;&gt;expert_1_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M743.2,-3763.7C730.7,-3753.23 719.66,-3741 712,-3726.86 693.58,-3692.87 708.47,-3648.09 722.38,-3619.04"/>
<polygon fill="black" stroke="black" points="725.65,-3620.34 727.02,-3609.83 719.4,-3617.19 725.65,-3620.34"/>
<text text-anchor="middle" x="732" y="-3693.46" font-family="Times,serif" font-size="14.00">Top&#45;2</text>
</g>
<!-- expert_1_1 -->
<g id="node29" class="node">
<title>expert_1_1</title>
<polygon fill="lightblue" stroke="black" points="1020,-3609.46 862,-3609.46 862,-3567.46 1020,-3567.46 1020,-3609.46"/>
<text text-anchor="middle" x="941" y="-3601.26" font-family="Times,serif" font-size="9.00">Expert 1 MLP</text>
<text text-anchor="middle" x="941" y="-3591.26" font-family="Times,serif" font-size="9.00">[batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="941" y="-3581.26" font-family="Times,serif" font-size="9.00">→ [2048] → [1024]</text>
<text text-anchor="middle" x="941" y="-3571.26" font-family="Times,serif" font-size="9.00">GPU: EP1, TP0&#45;TP7</text>
</g>
<!-- gate_1&#45;&gt;expert_1_1 -->
<g id="edge33" class="edge">
<title>gate_1&#45;&gt;expert_1_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M916.97,-3763.36C927.15,-3752.52 936.15,-3740.25 942,-3726.86 957.05,-3692.4 953.19,-3648.28 948,-3619.46"/>
<polygon fill="black" stroke="black" points="951.42,-3618.72 946.06,-3609.59 944.55,-3620.07 951.42,-3618.72"/>
<text text-anchor="middle" x="973" y="-3693.46" font-family="Times,serif" font-size="14.00">Top&#45;2</text>
</g>
<!-- dispatch_1&#45;&gt;expert_1_0 -->
<g id="edge26" class="edge">
<title>dispatch_1&#45;&gt;expert_1_0</title>
<path fill="none" stroke="black" d="M819.47,-3668.96C803.21,-3652.9 782.7,-3632.63 766.45,-3616.58"/>
<polygon fill="black" stroke="black" points="768.89,-3614.08 759.32,-3609.54 763.97,-3619.06 768.89,-3614.08"/>
</g>
<!-- dispatch_1&#45;&gt;expert_1_1 -->
<g id="edge27" class="edge">
<title>dispatch_1&#45;&gt;expert_1_1</title>
<path fill="none" stroke="black" d="M871.45,-3668.41C885.26,-3652.74 902.46,-3633.21 916.31,-3617.49"/>
<polygon fill="black" stroke="black" points="919.22,-3619.48 923.2,-3609.66 913.97,-3614.85 919.22,-3619.48"/>
</g>
<!-- expert_ar_1_0 -->
<g id="node28" class="node">
<title>expert_ar_1_0</title>
<ellipse fill="lightyellow" stroke="black" cx="700" cy="-3507.84" rx="111.95" ry="22.76"/>
<text text-anchor="middle" x="700" y="-3515.64" font-family="Times,serif" font-size="9.00">Expert 0 TP All&#45;Reduce</text>
<text text-anchor="middle" x="700" y="-3505.64" font-family="Times,serif" font-size="9.00">[batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="700" y="-3495.64" font-family="Times,serif" font-size="9.00">GPU: EP0, TP0&#45;TP7</text>
</g>
<!-- expert_1_0&#45;&gt;expert_ar_1_0 -->
<g id="edge23" class="edge">
<title>expert_1_0&#45;&gt;expert_ar_1_0</title>
<path fill="none" stroke="black" d="M728.96,-3567.21C724.76,-3558.75 719.79,-3548.73 715.16,-3539.41"/>
<polygon fill="black" stroke="black" points="718.27,-3537.8 710.69,-3530.39 712,-3540.91 718.27,-3537.8"/>
</g>
<!-- combine_1 -->
<g id="node32" class="node">
<title>combine_1</title>
<ellipse fill="lightyellow" stroke="black" cx="820" cy="-3418.51" rx="85.62" ry="29.9"/>
<text text-anchor="middle" x="820" y="-3431.31" font-family="Times,serif" font-size="9.00">Expert Combine</text>
<text text-anchor="middle" x="820" y="-3421.31" font-family="Times,serif" font-size="9.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="820" y="-3411.31" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024]</text>
<text text-anchor="middle" x="820" y="-3401.31" font-family="Times,serif" font-size="9.00">GPU: All EP Ranks</text>
</g>
<!-- expert_ar_1_0&#45;&gt;combine_1 -->
<g id="edge28" class="edge">
<title>expert_ar_1_0&#45;&gt;combine_1</title>
<path fill="none" stroke="black" d="M728.74,-3485.92C742.91,-3475.61 760.31,-3462.95 776.1,-3451.45"/>
<polygon fill="black" stroke="black" points="778.16,-3454.28 784.19,-3445.57 774.04,-3448.62 778.16,-3454.28"/>
</g>
<!-- expert_ar_1_1 -->
<g id="node30" class="node">
<title>expert_ar_1_1</title>
<ellipse fill="lightyellow" stroke="black" cx="941" cy="-3507.84" rx="111.95" ry="22.76"/>
<text text-anchor="middle" x="941" y="-3515.64" font-family="Times,serif" font-size="9.00">Expert 1 TP All&#45;Reduce</text>
<text text-anchor="middle" x="941" y="-3505.64" font-family="Times,serif" font-size="9.00">[batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="941" y="-3495.64" font-family="Times,serif" font-size="9.00">GPU: EP1, TP0&#45;TP7</text>
</g>
<!-- expert_1_1&#45;&gt;expert_ar_1_1 -->
<g id="edge24" class="edge">
<title>expert_1_1&#45;&gt;expert_ar_1_1</title>
<path fill="none" stroke="black" d="M941,-3567.21C941,-3559.17 941,-3549.72 941,-3540.79"/>
<polygon fill="black" stroke="black" points="944.5,-3540.67 941,-3530.67 937.5,-3540.67 944.5,-3540.67"/>
</g>
<!-- expert_ar_1_1&#45;&gt;combine_1 -->
<g id="edge29" class="edge">
<title>expert_ar_1_1&#45;&gt;combine_1</title>
<path fill="none" stroke="black" d="M912.02,-3485.92C897.73,-3475.61 880.19,-3462.95 864.26,-3451.45"/>
<polygon fill="black" stroke="black" points="866.27,-3448.58 856.11,-3445.57 862.17,-3454.26 866.27,-3448.58"/>
</g>
<!-- expert_ellipsis_1 -->
<g id="node31" class="node">
<title>expert_ellipsis_1</title>
<text text-anchor="middle" x="615" y="-3586.26" font-family="Times,serif" font-size="9.00">...</text>
</g>
<!-- aggregate_1 -->
<g id="node33" class="node">
<title>aggregate_1</title>
<polygon fill="lightcoral" stroke="black" points="1018.04,-3351.81 703,-3351.81 621.96,-3287.81 937,-3287.81 1018.04,-3351.81"/>
<text text-anchor="middle" x="820" y="-3327.61" font-family="Times,serif" font-size="9.00">Expert Output Aggregation</text>
<text text-anchor="middle" x="820" y="-3317.61" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
<text text-anchor="middle" x="820" y="-3307.61" font-family="Times,serif" font-size="9.00">GPU: All EP Ranks</text>
</g>
<!-- combine_1&#45;&gt;aggregate_1 -->
<g id="edge30" class="edge">
<title>combine_1&#45;&gt;aggregate_1</title>
<path fill="none" stroke="black" d="M820,-3388.76C820,-3380.44 820,-3371.18 820,-3362.25"/>
<polygon fill="black" stroke="black" points="823.5,-3361.98 820,-3351.98 816.5,-3361.98 823.5,-3361.98"/>
</g>
<!-- moe_out_1 -->
<g id="node34" class="node">
<title>moe_out_1</title>
<ellipse fill="white" stroke="black" cx="820" cy="-3115.75" rx="135.11" ry="135.11"/>
<text text-anchor="middle" x="820" y="-3118.55" font-family="Times,serif" font-size="9.00">MoE Output</text>
<text text-anchor="middle" x="820" y="-3108.55" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
</g>
<!-- aggregate_1&#45;&gt;moe_out_1 -->
<g id="edge31" class="edge">
<title>aggregate_1&#45;&gt;moe_out_1</title>
<path fill="none" stroke="black" d="M820,-3287.68C820,-3279.79 820,-3270.79 820,-3261.14"/>
<polygon fill="black" stroke="black" points="823.5,-3260.86 820,-3250.86 816.5,-3260.86 823.5,-3260.86"/>
</g>
<!-- layer_1_output -->
<g id="node35" class="node">
<title>layer_1_output</title>
<ellipse fill="white" stroke="black" cx="820" cy="-2808.64" rx="135.11" ry="135.11"/>
<text text-anchor="middle" x="820" y="-2811.44" font-family="Times,serif" font-size="9.00">Layer 1 Output</text>
<text text-anchor="middle" x="820" y="-2801.44" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
</g>
<!-- moe_out_1&#45;&gt;layer_1_output -->
<g id="edge36" class="edge">
<title>moe_out_1&#45;&gt;layer_1_output</title>
<path fill="none" stroke="black" d="M820,-2980.48C820,-2971.75 820,-2962.93 820,-2954.15"/>
<polygon fill="black" stroke="black" points="823.5,-2953.87 820,-2943.87 816.5,-2953.87 823.5,-2953.87"/>
</g>
<!-- pp_comm_0_1 -->
<g id="node71" class="node">
<title>pp_comm_0_1</title>
<ellipse fill="lightyellow" stroke="black" cx="820" cy="-2607.95" rx="78.48" ry="22.76"/>
<text text-anchor="middle" x="820" y="-2615.75" font-family="Times,serif" font-size="9.00">PP Communication</text>
<text text-anchor="middle" x="820" y="-2605.75" font-family="Times,serif" font-size="9.00">Send/Recv All&#45;Reduce</text>
<text text-anchor="middle" x="820" y="-2595.75" font-family="Times,serif" font-size="9.00">Stage 0 → 1</text>
</g>
<!-- layer_1_output&#45;&gt;pp_comm_0_1 -->
<g id="edge73" class="edge">
<title>layer_1_output&#45;&gt;pp_comm_0_1</title>
<path fill="none" stroke="black" d="M820,-2673.46C820,-2661.51 820,-2650.33 820,-2640.74"/>
<polygon fill="black" stroke="black" points="823.5,-2640.64 820,-2630.64 816.5,-2640.64 823.5,-2640.64"/>
</g>
<!-- ellipsis_pp0 -->
<g id="node36" class="node">
<title>ellipsis_pp0</title>
<text text-anchor="middle" x="529" y="-4694.09" font-family="Times,serif" font-size="9.00">...</text>
</g>
<!-- layer_14_input -->
<g id="node37" class="node">
<title>layer_14_input</title>
<ellipse fill="white" stroke="black" cx="820" cy="-2316.27" rx="135.11" ry="135.11"/>
<text text-anchor="middle" x="820" y="-2319.07" font-family="Times,serif" font-size="9.00">Layer 14 Input</text>
<text text-anchor="middle" x="820" y="-2309.07" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
</g>
<!-- qkv_14 -->
<g id="node38" class="node">
<title>qkv_14</title>
<polygon fill="lightblue" stroke="black" points="884,-2123.21 756,-2123.21 756,-2081.21 884,-2081.21 884,-2123.21"/>
<text text-anchor="middle" x="820" y="-2115.01" font-family="Times,serif" font-size="9.00">QKV Projection</text>
<text text-anchor="middle" x="820" y="-2105.01" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024]</text>
<text text-anchor="middle" x="820" y="-2095.01" font-family="Times,serif" font-size="9.00">→ [3×heads=16, d_k=64]</text>
<text text-anchor="middle" x="820" y="-2085.01" font-family="Times,serif" font-size="9.00">GPU: All TP Ranks</text>
</g>
<!-- layer_14_input&#45;&gt;qkv_14 -->
<g id="edge52" class="edge">
<title>layer_14_input&#45;&gt;qkv_14</title>
<path fill="none" stroke="black" d="M820,-2180.97C820,-2163.37 820,-2146.9 820,-2133.68"/>
<polygon fill="black" stroke="black" points="823.5,-2133.4 820,-2123.4 816.5,-2133.4 823.5,-2133.4"/>
</g>
<!-- attn_comp_14 -->
<g id="node39" class="node">
<title>attn_comp_14</title>
<polygon fill="lightblue" stroke="black" points="907,-2044.21 733,-2044.21 733,-2008.21 907,-2008.21 907,-2044.21"/>
<text text-anchor="middle" x="820" y="-2034.01" font-family="Times,serif" font-size="9.00">Attention Scores+Softmax</text>
<text text-anchor="middle" x="820" y="-2024.01" font-family="Times,serif" font-size="9.00">[batch=128, heads=16, seq=1024]</text>
<text text-anchor="middle" x="820" y="-2014.01" font-family="Times,serif" font-size="9.00">GPU: All TP Ranks</text>
</g>
<!-- qkv_14&#45;&gt;attn_comp_14 -->
<g id="edge37" class="edge">
<title>qkv_14&#45;&gt;attn_comp_14</title>
<path fill="none" stroke="black" d="M820,-2080.99C820,-2072.84 820,-2063.3 820,-2054.55"/>
<polygon fill="black" stroke="black" points="823.5,-2054.4 820,-2044.4 816.5,-2054.4 823.5,-2054.4"/>
</g>
<!-- attn_ar_14 -->
<g id="node40" class="node">
<title>attn_ar_14</title>
<ellipse fill="lightyellow" stroke="black" cx="820" cy="-1948.58" rx="135.11" ry="22.76"/>
<text text-anchor="middle" x="820" y="-1956.38" font-family="Times,serif" font-size="9.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="820" y="-1946.38" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
<text text-anchor="middle" x="820" y="-1936.38" font-family="Times,serif" font-size="9.00">GPU: All TP Ranks</text>
</g>
<!-- attn_comp_14&#45;&gt;attn_ar_14 -->
<g id="edge38" class="edge">
<title>attn_comp_14&#45;&gt;attn_ar_14</title>
<path fill="none" stroke="black" d="M820,-2008.05C820,-2000.13 820,-1990.48 820,-1981.31"/>
<polygon fill="black" stroke="black" points="823.5,-1981.29 820,-1971.29 816.5,-1981.29 823.5,-1981.29"/>
</g>
<!-- attn_proj_14 -->
<g id="node41" class="node">
<title>attn_proj_14</title>
<polygon fill="lightblue" stroke="black" points="915.5,-1888.96 724.5,-1888.96 724.5,-1852.96 915.5,-1852.96 915.5,-1888.96"/>
<text text-anchor="middle" x="820" y="-1878.76" font-family="Times,serif" font-size="9.00">Output Projection</text>
<text text-anchor="middle" x="820" y="-1868.76" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
<text text-anchor="middle" x="820" y="-1858.76" font-family="Times,serif" font-size="9.00">GPU: All TP Ranks</text>
</g>
<!-- attn_ar_14&#45;&gt;attn_proj_14 -->
<g id="edge39" class="edge">
<title>attn_ar_14&#45;&gt;attn_proj_14</title>
<path fill="none" stroke="black" d="M820,-1925.71C820,-1917.4 820,-1907.83 820,-1899.09"/>
<polygon fill="black" stroke="black" points="823.5,-1898.98 820,-1888.98 816.5,-1898.98 823.5,-1898.98"/>
</g>
<!-- attn_out_14 -->
<g id="node42" class="node">
<title>attn_out_14</title>
<ellipse fill="white" stroke="black" cx="820" cy="-1680.9" rx="135.11" ry="135.11"/>
<text text-anchor="middle" x="820" y="-1683.7" font-family="Times,serif" font-size="9.00">Attention Output</text>
<text text-anchor="middle" x="820" y="-1673.7" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
</g>
<!-- attn_proj_14&#45;&gt;attn_out_14 -->
<g id="edge40" class="edge">
<title>attn_proj_14&#45;&gt;attn_out_14</title>
<path fill="none" stroke="black" d="M820,-1852.94C820,-1845.74 820,-1836.65 820,-1826.43"/>
<polygon fill="black" stroke="black" points="823.5,-1826.31 820,-1816.31 816.5,-1826.31 823.5,-1826.31"/>
</g>
<!-- gate_14 -->
<g id="node43" class="node">
<title>gate_14</title>
<polygon fill="lightgreen" stroke="black" points="945.39,-1487.84 745.92,-1487.84 694.61,-1383.84 894.08,-1383.84 945.39,-1487.84"/>
<text text-anchor="middle" x="820" y="-1453.64" font-family="Times,serif" font-size="9.00">Gate Selection</text>
<text text-anchor="middle" x="820" y="-1443.64" font-family="Times,serif" font-size="9.00">Top&#45;2 Experts</text>
<text text-anchor="middle" x="820" y="-1433.64" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024]</text>
<text text-anchor="middle" x="820" y="-1423.64" font-family="Times,serif" font-size="9.00">→ [num_experts=64]</text>
<text text-anchor="middle" x="820" y="-1413.64" font-family="Times,serif" font-size="9.00">GPU: All EP Ranks</text>
</g>
<!-- attn_out_14&#45;&gt;gate_14 -->
<g id="edge53" class="edge">
<title>attn_out_14&#45;&gt;gate_14</title>
<path fill="none" stroke="black" d="M820,-1545.57C820,-1529.14 820,-1513.02 820,-1498.44"/>
<polygon fill="black" stroke="black" points="823.5,-1498.11 820,-1488.11 816.5,-1498.11 823.5,-1498.11"/>
</g>
<!-- dispatch_14 -->
<g id="node44" class="node">
<title>dispatch_14</title>
<ellipse fill="lightyellow" stroke="black" cx="820" cy="-1317.14" rx="85.62" ry="29.9"/>
<text text-anchor="middle" x="820" y="-1329.94" font-family="Times,serif" font-size="9.00">Expert Dispatch</text>
<text text-anchor="middle" x="820" y="-1319.94" font-family="Times,serif" font-size="9.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="820" y="-1309.94" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024]</text>
<text text-anchor="middle" x="820" y="-1299.94" font-family="Times,serif" font-size="9.00">GPU: All EP Ranks</text>
</g>
<!-- gate_14&#45;&gt;dispatch_14 -->
<g id="edge43" class="edge">
<title>gate_14&#45;&gt;dispatch_14</title>
<path fill="none" stroke="black" d="M820,-1383.66C820,-1374.69 820,-1365.49 820,-1356.93"/>
<polygon fill="black" stroke="black" points="823.5,-1356.86 820,-1346.86 816.5,-1356.86 823.5,-1356.86"/>
</g>
<!-- expert_14_0 -->
<g id="node45" class="node">
<title>expert_14_0</title>
<polygon fill="lightblue" stroke="black" points="791,-1229.45 633,-1229.45 633,-1187.45 791,-1187.45 791,-1229.45"/>
<text text-anchor="middle" x="712" y="-1221.25" font-family="Times,serif" font-size="9.00">Expert 0 MLP</text>
<text text-anchor="middle" x="712" y="-1211.25" font-family="Times,serif" font-size="9.00">[batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="712" y="-1201.25" font-family="Times,serif" font-size="9.00">→ [2048] → [1024]</text>
<text text-anchor="middle" x="712" y="-1191.25" font-family="Times,serif" font-size="9.00">GPU: EP0, TP0&#45;TP7</text>
</g>
<!-- gate_14&#45;&gt;expert_14_0 -->
<g id="edge50" class="edge">
<title>gate_14&#45;&gt;expert_14_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M716.2,-1383.68C703.7,-1373.22 692.66,-1360.99 685,-1346.84 666.58,-1312.85 681.47,-1268.07 695.38,-1239.02"/>
<polygon fill="black" stroke="black" points="698.65,-1240.32 700.02,-1229.81 692.4,-1237.17 698.65,-1240.32"/>
<text text-anchor="middle" x="705" y="-1313.44" font-family="Times,serif" font-size="14.00">Top&#45;2</text>
</g>
<!-- expert_14_1 -->
<g id="node47" class="node">
<title>expert_14_1</title>
<polygon fill="lightblue" stroke="black" points="993,-1229.45 835,-1229.45 835,-1187.45 993,-1187.45 993,-1229.45"/>
<text text-anchor="middle" x="914" y="-1221.25" font-family="Times,serif" font-size="9.00">Expert 1 MLP</text>
<text text-anchor="middle" x="914" y="-1211.25" font-family="Times,serif" font-size="9.00">[batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="914" y="-1201.25" font-family="Times,serif" font-size="9.00">→ [2048] → [1024]</text>
<text text-anchor="middle" x="914" y="-1191.25" font-family="Times,serif" font-size="9.00">GPU: EP1, TP0&#45;TP7</text>
</g>
<!-- gate_14&#45;&gt;expert_14_1 -->
<g id="edge51" class="edge">
<title>gate_14&#45;&gt;expert_14_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M889.97,-1383.34C900.15,-1372.5 909.15,-1360.23 915,-1346.84 930.05,-1312.38 926.19,-1268.26 921,-1239.45"/>
<polygon fill="black" stroke="black" points="924.42,-1238.71 919.06,-1229.57 917.55,-1240.06 924.42,-1238.71"/>
<text text-anchor="middle" x="946" y="-1313.44" font-family="Times,serif" font-size="14.00">Top&#45;2</text>
</g>
<!-- dispatch_14&#45;&gt;expert_14_0 -->
<g id="edge44" class="edge">
<title>dispatch_14&#45;&gt;expert_14_0</title>
<path fill="none" stroke="black" d="M792.47,-1288.94C776.21,-1272.88 755.7,-1252.62 739.45,-1236.57"/>
<polygon fill="black" stroke="black" points="741.89,-1234.06 732.32,-1229.52 736.97,-1239.04 741.89,-1234.06"/>
</g>
<!-- dispatch_14&#45;&gt;expert_14_1 -->
<g id="edge45" class="edge">
<title>dispatch_14&#45;&gt;expert_14_1</title>
<path fill="none" stroke="black" d="M844.45,-1288.39C858.26,-1272.72 875.46,-1253.19 889.31,-1237.48"/>
<polygon fill="black" stroke="black" points="892.22,-1239.46 896.2,-1229.65 886.97,-1234.84 892.22,-1239.46"/>
</g>
<!-- expert_ar_14_0 -->
<g id="node46" class="node">
<title>expert_ar_14_0</title>
<ellipse fill="lightyellow" stroke="black" cx="673" cy="-1127.82" rx="111.95" ry="22.76"/>
<text text-anchor="middle" x="673" y="-1135.62" font-family="Times,serif" font-size="9.00">Expert 0 TP All&#45;Reduce</text>
<text text-anchor="middle" x="673" y="-1125.62" font-family="Times,serif" font-size="9.00">[batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="673" y="-1115.62" font-family="Times,serif" font-size="9.00">GPU: EP0, TP0&#45;TP7</text>
</g>
<!-- expert_14_0&#45;&gt;expert_ar_14_0 -->
<g id="edge41" class="edge">
<title>expert_14_0&#45;&gt;expert_ar_14_0</title>
<path fill="none" stroke="black" d="M701.96,-1187.2C697.76,-1178.73 692.79,-1168.71 688.16,-1159.39"/>
<polygon fill="black" stroke="black" points="691.27,-1157.78 683.69,-1150.37 685,-1160.89 691.27,-1157.78"/>
</g>
<!-- combine_14 -->
<g id="node50" class="node">
<title>combine_14</title>
<ellipse fill="lightyellow" stroke="black" cx="793" cy="-1038.49" rx="85.62" ry="29.9"/>
<text text-anchor="middle" x="793" y="-1051.29" font-family="Times,serif" font-size="9.00">Expert Combine</text>
<text text-anchor="middle" x="793" y="-1041.29" font-family="Times,serif" font-size="9.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="793" y="-1031.29" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024]</text>
<text text-anchor="middle" x="793" y="-1021.29" font-family="Times,serif" font-size="9.00">GPU: All EP Ranks</text>
</g>
<!-- expert_ar_14_0&#45;&gt;combine_14 -->
<g id="edge46" class="edge">
<title>expert_ar_14_0&#45;&gt;combine_14</title>
<path fill="none" stroke="black" d="M701.74,-1105.9C715.91,-1095.59 733.31,-1082.93 749.1,-1071.44"/>
<polygon fill="black" stroke="black" points="751.16,-1074.27 757.19,-1065.55 747.04,-1068.61 751.16,-1074.27"/>
</g>
<!-- expert_ar_14_1 -->
<g id="node48" class="node">
<title>expert_ar_14_1</title>
<ellipse fill="lightyellow" stroke="black" cx="914" cy="-1127.82" rx="111.95" ry="22.76"/>
<text text-anchor="middle" x="914" y="-1135.62" font-family="Times,serif" font-size="9.00">Expert 1 TP All&#45;Reduce</text>
<text text-anchor="middle" x="914" y="-1125.62" font-family="Times,serif" font-size="9.00">[batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="914" y="-1115.62" font-family="Times,serif" font-size="9.00">GPU: EP1, TP0&#45;TP7</text>
</g>
<!-- expert_14_1&#45;&gt;expert_ar_14_1 -->
<g id="edge42" class="edge">
<title>expert_14_1&#45;&gt;expert_ar_14_1</title>
<path fill="none" stroke="black" d="M914,-1187.2C914,-1179.15 914,-1169.7 914,-1160.77"/>
<polygon fill="black" stroke="black" points="917.5,-1160.65 914,-1150.65 910.5,-1160.65 917.5,-1160.65"/>
</g>
<!-- expert_ar_14_1&#45;&gt;combine_14 -->
<g id="edge47" class="edge">
<title>expert_ar_14_1&#45;&gt;combine_14</title>
<path fill="none" stroke="black" d="M885.02,-1105.9C870.73,-1095.59 853.19,-1082.93 837.26,-1071.44"/>
<polygon fill="black" stroke="black" points="839.27,-1068.57 829.11,-1065.55 835.17,-1074.24 839.27,-1068.57"/>
</g>
<!-- expert_ellipsis_14 -->
<g id="node49" class="node">
<title>expert_ellipsis_14</title>
<text text-anchor="middle" x="588" y="-1206.25" font-family="Times,serif" font-size="9.00">...</text>
</g>
<!-- aggregate_14 -->
<g id="node51" class="node">
<title>aggregate_14</title>
<polygon fill="lightcoral" stroke="black" points="991.04,-971.79 676,-971.79 594.96,-907.79 910,-907.79 991.04,-971.79"/>
<text text-anchor="middle" x="793" y="-947.59" font-family="Times,serif" font-size="9.00">Expert Output Aggregation</text>
<text text-anchor="middle" x="793" y="-937.59" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
<text text-anchor="middle" x="793" y="-927.59" font-family="Times,serif" font-size="9.00">GPU: All EP Ranks</text>
</g>
<!-- combine_14&#45;&gt;aggregate_14 -->
<g id="edge48" class="edge">
<title>combine_14&#45;&gt;aggregate_14</title>
<path fill="none" stroke="black" d="M793,-1008.74C793,-1000.42 793,-991.16 793,-982.23"/>
<polygon fill="black" stroke="black" points="796.5,-981.96 793,-971.96 789.5,-981.96 796.5,-981.96"/>
</g>
<!-- moe_out_14 -->
<g id="node52" class="node">
<title>moe_out_14</title>
<ellipse fill="white" stroke="black" cx="793" cy="-735.74" rx="135.11" ry="135.11"/>
<text text-anchor="middle" x="793" y="-738.54" font-family="Times,serif" font-size="9.00">MoE Output</text>
<text text-anchor="middle" x="793" y="-728.54" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
</g>
<!-- aggregate_14&#45;&gt;moe_out_14 -->
<g id="edge49" class="edge">
<title>aggregate_14&#45;&gt;moe_out_14</title>
<path fill="none" stroke="black" d="M793,-907.66C793,-899.78 793,-890.77 793,-881.12"/>
<polygon fill="black" stroke="black" points="796.5,-880.84 793,-870.84 789.5,-880.84 796.5,-880.84"/>
</g>
<!-- layer_14_output -->
<g id="node53" class="node">
<title>layer_14_output</title>
<ellipse fill="white" stroke="black" cx="793" cy="-428.62" rx="135.11" ry="135.11"/>
<text text-anchor="middle" x="793" y="-431.42" font-family="Times,serif" font-size="9.00">Layer 14 Output</text>
<text text-anchor="middle" x="793" y="-421.42" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
</g>
<!-- moe_out_14&#45;&gt;layer_14_output -->
<g id="edge54" class="edge">
<title>moe_out_14&#45;&gt;layer_14_output</title>
<path fill="none" stroke="black" d="M793,-600.46C793,-591.73 793,-582.92 793,-574.14"/>
<polygon fill="black" stroke="black" points="796.5,-573.85 793,-563.85 789.5,-573.85 796.5,-573.85"/>
</g>
<!-- layer_15_input -->
<g id="node54" class="node">
<title>layer_15_input</title>
<ellipse fill="white" stroke="black" cx="299" cy="-2316.27" rx="135.11" ry="135.11"/>
<text text-anchor="middle" x="299" y="-2319.07" font-family="Times,serif" font-size="9.00">Layer 15 Input</text>
<text text-anchor="middle" x="299" y="-2309.07" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
</g>
<!-- qkv_15 -->
<g id="node55" class="node">
<title>qkv_15</title>
<polygon fill="lightblue" stroke="black" points="363,-2123.21 235,-2123.21 235,-2081.21 363,-2081.21 363,-2123.21"/>
<text text-anchor="middle" x="299" y="-2115.01" font-family="Times,serif" font-size="9.00">QKV Projection</text>
<text text-anchor="middle" x="299" y="-2105.01" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024]</text>
<text text-anchor="middle" x="299" y="-2095.01" font-family="Times,serif" font-size="9.00">→ [3×heads=16, d_k=64]</text>
<text text-anchor="middle" x="299" y="-2085.01" font-family="Times,serif" font-size="9.00">GPU: All TP Ranks</text>
</g>
<!-- layer_15_input&#45;&gt;qkv_15 -->
<g id="edge70" class="edge">
<title>layer_15_input&#45;&gt;qkv_15</title>
<path fill="none" stroke="black" d="M299,-2180.97C299,-2163.37 299,-2146.9 299,-2133.68"/>
<polygon fill="black" stroke="black" points="302.5,-2133.4 299,-2123.4 295.5,-2133.4 302.5,-2133.4"/>
</g>
<!-- attn_comp_15 -->
<g id="node56" class="node">
<title>attn_comp_15</title>
<polygon fill="lightblue" stroke="black" points="386,-2044.21 212,-2044.21 212,-2008.21 386,-2008.21 386,-2044.21"/>
<text text-anchor="middle" x="299" y="-2034.01" font-family="Times,serif" font-size="9.00">Attention Scores+Softmax</text>
<text text-anchor="middle" x="299" y="-2024.01" font-family="Times,serif" font-size="9.00">[batch=128, heads=16, seq=1024]</text>
<text text-anchor="middle" x="299" y="-2014.01" font-family="Times,serif" font-size="9.00">GPU: All TP Ranks</text>
</g>
<!-- qkv_15&#45;&gt;attn_comp_15 -->
<g id="edge55" class="edge">
<title>qkv_15&#45;&gt;attn_comp_15</title>
<path fill="none" stroke="black" d="M299,-2080.99C299,-2072.84 299,-2063.3 299,-2054.55"/>
<polygon fill="black" stroke="black" points="302.5,-2054.4 299,-2044.4 295.5,-2054.4 302.5,-2054.4"/>
</g>
<!-- attn_ar_15 -->
<g id="node57" class="node">
<title>attn_ar_15</title>
<ellipse fill="lightyellow" stroke="black" cx="299" cy="-1948.58" rx="135.11" ry="22.76"/>
<text text-anchor="middle" x="299" y="-1956.38" font-family="Times,serif" font-size="9.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="299" y="-1946.38" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
<text text-anchor="middle" x="299" y="-1936.38" font-family="Times,serif" font-size="9.00">GPU: All TP Ranks</text>
</g>
<!-- attn_comp_15&#45;&gt;attn_ar_15 -->
<g id="edge56" class="edge">
<title>attn_comp_15&#45;&gt;attn_ar_15</title>
<path fill="none" stroke="black" d="M299,-2008.05C299,-2000.13 299,-1990.48 299,-1981.31"/>
<polygon fill="black" stroke="black" points="302.5,-1981.29 299,-1971.29 295.5,-1981.29 302.5,-1981.29"/>
</g>
<!-- attn_proj_15 -->
<g id="node58" class="node">
<title>attn_proj_15</title>
<polygon fill="lightblue" stroke="black" points="394.5,-1888.96 203.5,-1888.96 203.5,-1852.96 394.5,-1852.96 394.5,-1888.96"/>
<text text-anchor="middle" x="299" y="-1878.76" font-family="Times,serif" font-size="9.00">Output Projection</text>
<text text-anchor="middle" x="299" y="-1868.76" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
<text text-anchor="middle" x="299" y="-1858.76" font-family="Times,serif" font-size="9.00">GPU: All TP Ranks</text>
</g>
<!-- attn_ar_15&#45;&gt;attn_proj_15 -->
<g id="edge57" class="edge">
<title>attn_ar_15&#45;&gt;attn_proj_15</title>
<path fill="none" stroke="black" d="M299,-1925.71C299,-1917.4 299,-1907.83 299,-1899.09"/>
<polygon fill="black" stroke="black" points="302.5,-1898.98 299,-1888.98 295.5,-1898.98 302.5,-1898.98"/>
</g>
<!-- attn_out_15 -->
<g id="node59" class="node">
<title>attn_out_15</title>
<ellipse fill="white" stroke="black" cx="299" cy="-1680.9" rx="135.11" ry="135.11"/>
<text text-anchor="middle" x="299" y="-1683.7" font-family="Times,serif" font-size="9.00">Attention Output</text>
<text text-anchor="middle" x="299" y="-1673.7" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
</g>
<!-- attn_proj_15&#45;&gt;attn_out_15 -->
<g id="edge58" class="edge">
<title>attn_proj_15&#45;&gt;attn_out_15</title>
<path fill="none" stroke="black" d="M299,-1852.94C299,-1845.74 299,-1836.65 299,-1826.43"/>
<polygon fill="black" stroke="black" points="302.5,-1826.31 299,-1816.31 295.5,-1826.31 302.5,-1826.31"/>
</g>
<!-- gate_15 -->
<g id="node60" class="node">
<title>gate_15</title>
<polygon fill="lightgreen" stroke="black" points="424.39,-1487.84 224.92,-1487.84 173.61,-1383.84 373.08,-1383.84 424.39,-1487.84"/>
<text text-anchor="middle" x="299" y="-1453.64" font-family="Times,serif" font-size="9.00">Gate Selection</text>
<text text-anchor="middle" x="299" y="-1443.64" font-family="Times,serif" font-size="9.00">Top&#45;2 Experts</text>
<text text-anchor="middle" x="299" y="-1433.64" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024]</text>
<text text-anchor="middle" x="299" y="-1423.64" font-family="Times,serif" font-size="9.00">→ [num_experts=64]</text>
<text text-anchor="middle" x="299" y="-1413.64" font-family="Times,serif" font-size="9.00">GPU: All EP Ranks</text>
</g>
<!-- attn_out_15&#45;&gt;gate_15 -->
<g id="edge71" class="edge">
<title>attn_out_15&#45;&gt;gate_15</title>
<path fill="none" stroke="black" d="M299,-1545.57C299,-1529.14 299,-1513.02 299,-1498.44"/>
<polygon fill="black" stroke="black" points="302.5,-1498.11 299,-1488.11 295.5,-1498.11 302.5,-1498.11"/>
</g>
<!-- dispatch_15 -->
<g id="node61" class="node">
<title>dispatch_15</title>
<ellipse fill="lightyellow" stroke="black" cx="299" cy="-1317.14" rx="85.62" ry="29.9"/>
<text text-anchor="middle" x="299" y="-1329.94" font-family="Times,serif" font-size="9.00">Expert Dispatch</text>
<text text-anchor="middle" x="299" y="-1319.94" font-family="Times,serif" font-size="9.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="299" y="-1309.94" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024]</text>
<text text-anchor="middle" x="299" y="-1299.94" font-family="Times,serif" font-size="9.00">GPU: All EP Ranks</text>
</g>
<!-- gate_15&#45;&gt;dispatch_15 -->
<g id="edge61" class="edge">
<title>gate_15&#45;&gt;dispatch_15</title>
<path fill="none" stroke="black" d="M299,-1383.66C299,-1374.69 299,-1365.49 299,-1356.93"/>
<polygon fill="black" stroke="black" points="302.5,-1356.86 299,-1346.86 295.5,-1356.86 302.5,-1356.86"/>
</g>
<!-- expert_15_0 -->
<g id="node62" class="node">
<title>expert_15_0</title>
<polygon fill="lightblue" stroke="black" points="270,-1229.45 112,-1229.45 112,-1187.45 270,-1187.45 270,-1229.45"/>
<text text-anchor="middle" x="191" y="-1221.25" font-family="Times,serif" font-size="9.00">Expert 0 MLP</text>
<text text-anchor="middle" x="191" y="-1211.25" font-family="Times,serif" font-size="9.00">[batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="191" y="-1201.25" font-family="Times,serif" font-size="9.00">→ [2048] → [1024]</text>
<text text-anchor="middle" x="191" y="-1191.25" font-family="Times,serif" font-size="9.00">GPU: EP0, TP0&#45;TP7</text>
</g>
<!-- gate_15&#45;&gt;expert_15_0 -->
<g id="edge68" class="edge">
<title>gate_15&#45;&gt;expert_15_0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M195.2,-1383.68C182.7,-1373.22 171.66,-1360.99 164,-1346.84 145.58,-1312.85 160.47,-1268.07 174.38,-1239.02"/>
<polygon fill="black" stroke="black" points="177.65,-1240.32 179.02,-1229.81 171.4,-1237.17 177.65,-1240.32"/>
<text text-anchor="middle" x="184" y="-1313.44" font-family="Times,serif" font-size="14.00">Top&#45;2</text>
</g>
<!-- expert_15_1 -->
<g id="node64" class="node">
<title>expert_15_1</title>
<polygon fill="lightblue" stroke="black" points="472,-1229.45 314,-1229.45 314,-1187.45 472,-1187.45 472,-1229.45"/>
<text text-anchor="middle" x="393" y="-1221.25" font-family="Times,serif" font-size="9.00">Expert 1 MLP</text>
<text text-anchor="middle" x="393" y="-1211.25" font-family="Times,serif" font-size="9.00">[batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="393" y="-1201.25" font-family="Times,serif" font-size="9.00">→ [2048] → [1024]</text>
<text text-anchor="middle" x="393" y="-1191.25" font-family="Times,serif" font-size="9.00">GPU: EP1, TP0&#45;TP7</text>
</g>
<!-- gate_15&#45;&gt;expert_15_1 -->
<g id="edge69" class="edge">
<title>gate_15&#45;&gt;expert_15_1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M368.97,-1383.34C379.15,-1372.5 388.15,-1360.23 394,-1346.84 409.05,-1312.38 405.19,-1268.26 400,-1239.45"/>
<polygon fill="black" stroke="black" points="403.42,-1238.71 398.06,-1229.57 396.55,-1240.06 403.42,-1238.71"/>
<text text-anchor="middle" x="425" y="-1313.44" font-family="Times,serif" font-size="14.00">Top&#45;2</text>
</g>
<!-- dispatch_15&#45;&gt;expert_15_0 -->
<g id="edge62" class="edge">
<title>dispatch_15&#45;&gt;expert_15_0</title>
<path fill="none" stroke="black" d="M271.47,-1288.94C255.21,-1272.88 234.7,-1252.62 218.45,-1236.57"/>
<polygon fill="black" stroke="black" points="220.89,-1234.06 211.32,-1229.52 215.97,-1239.04 220.89,-1234.06"/>
</g>
<!-- dispatch_15&#45;&gt;expert_15_1 -->
<g id="edge63" class="edge">
<title>dispatch_15&#45;&gt;expert_15_1</title>
<path fill="none" stroke="black" d="M323.45,-1288.39C337.26,-1272.72 354.46,-1253.19 368.31,-1237.48"/>
<polygon fill="black" stroke="black" points="371.22,-1239.46 375.2,-1229.65 365.97,-1234.84 371.22,-1239.46"/>
</g>
<!-- expert_ar_15_0 -->
<g id="node63" class="node">
<title>expert_ar_15_0</title>
<ellipse fill="lightyellow" stroke="black" cx="152" cy="-1127.82" rx="111.95" ry="22.76"/>
<text text-anchor="middle" x="152" y="-1135.62" font-family="Times,serif" font-size="9.00">Expert 0 TP All&#45;Reduce</text>
<text text-anchor="middle" x="152" y="-1125.62" font-family="Times,serif" font-size="9.00">[batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="152" y="-1115.62" font-family="Times,serif" font-size="9.00">GPU: EP0, TP0&#45;TP7</text>
</g>
<!-- expert_15_0&#45;&gt;expert_ar_15_0 -->
<g id="edge59" class="edge">
<title>expert_15_0&#45;&gt;expert_ar_15_0</title>
<path fill="none" stroke="black" d="M180.96,-1187.2C176.76,-1178.73 171.79,-1168.71 167.16,-1159.39"/>
<polygon fill="black" stroke="black" points="170.27,-1157.78 162.69,-1150.37 164,-1160.89 170.27,-1157.78"/>
</g>
<!-- combine_15 -->
<g id="node67" class="node">
<title>combine_15</title>
<ellipse fill="lightyellow" stroke="black" cx="272" cy="-1038.49" rx="85.62" ry="29.9"/>
<text text-anchor="middle" x="272" y="-1051.29" font-family="Times,serif" font-size="9.00">Expert Combine</text>
<text text-anchor="middle" x="272" y="-1041.29" font-family="Times,serif" font-size="9.00">All&#45;to&#45;All</text>
<text text-anchor="middle" x="272" y="-1031.29" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024]</text>
<text text-anchor="middle" x="272" y="-1021.29" font-family="Times,serif" font-size="9.00">GPU: All EP Ranks</text>
</g>
<!-- expert_ar_15_0&#45;&gt;combine_15 -->
<g id="edge64" class="edge">
<title>expert_ar_15_0&#45;&gt;combine_15</title>
<path fill="none" stroke="black" d="M180.74,-1105.9C194.91,-1095.59 212.31,-1082.93 228.1,-1071.44"/>
<polygon fill="black" stroke="black" points="230.16,-1074.27 236.19,-1065.55 226.04,-1068.61 230.16,-1074.27"/>
</g>
<!-- expert_ar_15_1 -->
<g id="node65" class="node">
<title>expert_ar_15_1</title>
<ellipse fill="lightyellow" stroke="black" cx="393" cy="-1127.82" rx="111.95" ry="22.76"/>
<text text-anchor="middle" x="393" y="-1135.62" font-family="Times,serif" font-size="9.00">Expert 1 TP All&#45;Reduce</text>
<text text-anchor="middle" x="393" y="-1125.62" font-family="Times,serif" font-size="9.00">[batch=?, seq=?, hidden=1024]</text>
<text text-anchor="middle" x="393" y="-1115.62" font-family="Times,serif" font-size="9.00">GPU: EP1, TP0&#45;TP7</text>
</g>
<!-- expert_15_1&#45;&gt;expert_ar_15_1 -->
<g id="edge60" class="edge">
<title>expert_15_1&#45;&gt;expert_ar_15_1</title>
<path fill="none" stroke="black" d="M393,-1187.2C393,-1179.15 393,-1169.7 393,-1160.77"/>
<polygon fill="black" stroke="black" points="396.5,-1160.65 393,-1150.65 389.5,-1160.65 396.5,-1160.65"/>
</g>
<!-- expert_ar_15_1&#45;&gt;combine_15 -->
<g id="edge65" class="edge">
<title>expert_ar_15_1&#45;&gt;combine_15</title>
<path fill="none" stroke="black" d="M364.02,-1105.9C349.73,-1095.59 332.19,-1082.93 316.26,-1071.44"/>
<polygon fill="black" stroke="black" points="318.27,-1068.57 308.11,-1065.55 314.17,-1074.24 318.27,-1068.57"/>
</g>
<!-- expert_ellipsis_15 -->
<g id="node66" class="node">
<title>expert_ellipsis_15</title>
<text text-anchor="middle" x="67" y="-1206.25" font-family="Times,serif" font-size="9.00">...</text>
</g>
<!-- aggregate_15 -->
<g id="node68" class="node">
<title>aggregate_15</title>
<polygon fill="lightcoral" stroke="black" points="470.04,-971.79 155,-971.79 73.96,-907.79 389,-907.79 470.04,-971.79"/>
<text text-anchor="middle" x="272" y="-947.59" font-family="Times,serif" font-size="9.00">Expert Output Aggregation</text>
<text text-anchor="middle" x="272" y="-937.59" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
<text text-anchor="middle" x="272" y="-927.59" font-family="Times,serif" font-size="9.00">GPU: All EP Ranks</text>
</g>
<!-- combine_15&#45;&gt;aggregate_15 -->
<g id="edge66" class="edge">
<title>combine_15&#45;&gt;aggregate_15</title>
<path fill="none" stroke="black" d="M272,-1008.74C272,-1000.42 272,-991.16 272,-982.23"/>
<polygon fill="black" stroke="black" points="275.5,-981.96 272,-971.96 268.5,-981.96 275.5,-981.96"/>
</g>
<!-- moe_out_15 -->
<g id="node69" class="node">
<title>moe_out_15</title>
<ellipse fill="white" stroke="black" cx="272" cy="-735.74" rx="135.11" ry="135.11"/>
<text text-anchor="middle" x="272" y="-738.54" font-family="Times,serif" font-size="9.00">MoE Output</text>
<text text-anchor="middle" x="272" y="-728.54" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
</g>
<!-- aggregate_15&#45;&gt;moe_out_15 -->
<g id="edge67" class="edge">
<title>aggregate_15&#45;&gt;moe_out_15</title>
<path fill="none" stroke="black" d="M272,-907.66C272,-899.78 272,-890.77 272,-881.12"/>
<polygon fill="black" stroke="black" points="275.5,-880.84 272,-870.84 268.5,-880.84 275.5,-880.84"/>
</g>
<!-- layer_15_output -->
<g id="node70" class="node">
<title>layer_15_output</title>
<ellipse fill="white" stroke="black" cx="272" cy="-428.62" rx="135.11" ry="135.11"/>
<text text-anchor="middle" x="272" y="-431.42" font-family="Times,serif" font-size="9.00">Layer 15 Output</text>
<text text-anchor="middle" x="272" y="-421.42" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, hidden=1024]</text>
</g>
<!-- moe_out_15&#45;&gt;layer_15_output -->
<g id="edge72" class="edge">
<title>moe_out_15&#45;&gt;layer_15_output</title>
<path fill="none" stroke="black" d="M272,-600.46C272,-591.73 272,-582.92 272,-574.14"/>
<polygon fill="black" stroke="black" points="275.5,-573.85 272,-563.85 268.5,-573.85 275.5,-573.85"/>
</g>
<!-- output -->
<g id="node72" class="node">
<title>output</title>
<ellipse fill="white" stroke="black" stroke-width="2" cx="272" cy="-125.28" rx="121.07" ry="121.07"/>
<ellipse fill="none" stroke="black" stroke-width="2" cx="272" cy="-125.28" rx="125.06" ry="125.06"/>
<text text-anchor="middle" x="272" y="-128.08" font-family="Times,serif" font-size="9.00">Model Output</text>
<text text-anchor="middle" x="272" y="-118.08" font-family="Times,serif" font-size="9.00">[batch=128, seq=1024, vocab=32000]</text>
</g>
<!-- layer_15_output&#45;&gt;output -->
<g id="edge75" class="edge">
<title>layer_15_output&#45;&gt;output</title>
<path fill="none" stroke="black" d="M272,-293.26C272,-282.55 272,-271.74 272,-261.03"/>
<polygon fill="black" stroke="black" points="275.5,-260.8 272,-250.8 268.5,-260.8 275.5,-260.8"/>
</g>
<!-- pp_comm_0_1&#45;&gt;layer_14_input -->
<g id="edge74" class="edge">
<title>pp_comm_0_1&#45;&gt;layer_14_input</title>
<path fill="none" stroke="black" d="M820,-2585.18C820,-2558.22 820,-2509.92 820,-2461.68"/>
<polygon fill="black" stroke="black" points="823.5,-2461.4 820,-2451.4 816.5,-2461.4 823.5,-2461.4"/>
</g>
</g>
</svg>
