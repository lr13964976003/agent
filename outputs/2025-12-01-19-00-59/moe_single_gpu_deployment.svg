<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="6828pt" height="11015pt"
 viewBox="0.00 0.00 6827.71 11015.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 11011)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-11011 6823.71,-11011 6823.71,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="lightblue" stroke="black" points="3781.99,-11007 3368.99,-11007 3368.99,-10954 3781.99,-10954 3781.99,-11007"/>
<text text-anchor="middle" x="3575.49" y="-10991.8" font-family="Times,serif" font-size="14.00">Input</text>
<text text-anchor="middle" x="3575.49" y="-10976.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3575.49" y="-10961.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer0_ln_attn -->
<g id="node2" class="node">
<title>layer0_ln_attn</title>
<polygon fill="lightblue" stroke="black" points="3781.99,-10917 3368.99,-10917 3368.99,-10864 3781.99,-10864 3781.99,-10917"/>
<text text-anchor="middle" x="3575.49" y="-10901.8" font-family="Times,serif" font-size="14.00">LayerNorm (Attention)</text>
<text text-anchor="middle" x="3575.49" y="-10886.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3575.49" y="-10871.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- input&#45;&gt;layer0_ln_attn -->
<g id="edge1" class="edge">
<title>input&#45;&gt;layer0_ln_attn</title>
<path fill="none" stroke="black" d="M3575.49,-10953.98C3575.49,-10953.98 3575.49,-10927.14 3575.49,-10927.14"/>
<polygon fill="black" stroke="black" points="3578.99,-10927.14 3575.49,-10917.14 3571.99,-10927.14 3578.99,-10927.14"/>
</g>
<!-- layer0_q_proj -->
<g id="node3" class="node">
<title>layer0_q_proj</title>
<polygon fill="lightblue" stroke="black" points="3909.99,-10827 3482.99,-10827 3482.99,-10774 3909.99,-10774 3909.99,-10827"/>
<text text-anchor="middle" x="3696.49" y="-10811.8" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="3696.49" y="-10796.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3696.49" y="-10781.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer0_ln_attn&#45;&gt;layer0_q_proj -->
<g id="edge2" class="edge">
<title>layer0_ln_attn&#45;&gt;layer0_q_proj</title>
<path fill="none" stroke="black" d="M3632.49,-10863.98C3632.49,-10863.98 3632.49,-10837.14 3632.49,-10837.14"/>
<polygon fill="black" stroke="black" points="3635.99,-10837.14 3632.49,-10827.14 3628.99,-10837.14 3635.99,-10837.14"/>
</g>
<!-- layer0_k_proj -->
<g id="node4" class="node">
<title>layer0_k_proj</title>
<polygon fill="lightblue" stroke="black" points="4354.99,-10827 3927.99,-10827 3927.99,-10774 4354.99,-10774 4354.99,-10827"/>
<text text-anchor="middle" x="4141.49" y="-10811.8" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="4141.49" y="-10796.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="4141.49" y="-10781.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer0_ln_attn&#45;&gt;layer0_k_proj -->
<g id="edge3" class="edge">
<title>layer0_ln_attn&#45;&gt;layer0_k_proj</title>
<path fill="none" stroke="black" d="M3782.23,-10890C3943.92,-10890 4141.49,-10890 4141.49,-10890 4141.49,-10890 4141.49,-10837.35 4141.49,-10837.35"/>
<polygon fill="black" stroke="black" points="4144.99,-10837.35 4141.49,-10827.35 4137.99,-10837.35 4144.99,-10837.35"/>
</g>
<!-- layer0_v_proj -->
<g id="node5" class="node">
<title>layer0_v_proj</title>
<polygon fill="lightblue" stroke="black" points="3667.99,-10756 3240.99,-10756 3240.99,-10703 3667.99,-10703 3667.99,-10756"/>
<text text-anchor="middle" x="3454.49" y="-10740.8" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="3454.49" y="-10725.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3454.49" y="-10710.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer0_ln_attn&#45;&gt;layer0_v_proj -->
<g id="edge4" class="edge">
<title>layer0_ln_attn&#45;&gt;layer0_v_proj</title>
<path fill="none" stroke="black" d="M3425.99,-10863.91C3425.99,-10863.91 3425.99,-10766.13 3425.99,-10766.13"/>
<polygon fill="black" stroke="black" points="3429.49,-10766.13 3425.99,-10756.13 3422.49,-10766.13 3429.49,-10766.13"/>
</g>
<!-- layer0_residual_attn -->
<g id="node10" class="node">
<title>layer0_residual_attn</title>
<polygon fill="yellow" stroke="black" points="4000.97,-10325 2767.35,-10325 2450.01,-10219 3683.63,-10219 4000.97,-10325"/>
<text text-anchor="middle" x="3225.49" y="-10283.3" font-family="Times,serif" font-size="14.00">Residual Add (Attention)</text>
<text text-anchor="middle" x="3225.49" y="-10268.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024], [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3225.49" y="-10253.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer0_ln_attn&#45;&gt;layer0_residual_attn -->
<g id="edge11" class="edge">
<title>layer0_ln_attn&#45;&gt;layer0_residual_attn</title>
<path fill="none" stroke="black" d="M3368.74,-10890C3152.9,-10890 2845.5,-10890 2845.5,-10890 2845.5,-10890 2845.5,-10335.23 2845.5,-10335.23"/>
<polygon fill="black" stroke="black" points="2849,-10335.23 2845.5,-10325.23 2842,-10335.23 2849,-10335.23"/>
</g>
<!-- layer0_attn_scores -->
<g id="node6" class="node">
<title>layer0_attn_scores</title>
<polygon fill="lightblue" stroke="black" points="4550.99,-10685 3729.99,-10685 3729.99,-10632 4550.99,-10632 4550.99,-10685"/>
<text text-anchor="middle" x="4140.49" y="-10669.8" font-family="Times,serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="4140.49" y="-10654.8" font-family="Times,serif" font-size="14.00">Input: Q=[batch_size=8, seq_len=256, heads=8, d_k=128], K=[batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="4140.49" y="-10639.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
</g>
<!-- layer0_q_proj&#45;&gt;layer0_attn_scores -->
<g id="edge5" class="edge">
<title>layer0_q_proj&#45;&gt;layer0_attn_scores</title>
<path fill="none" stroke="black" d="M3819.99,-10773.79C3819.99,-10773.79 3819.99,-10695.09 3819.99,-10695.09"/>
<polygon fill="black" stroke="black" points="3823.49,-10695.09 3819.99,-10685.09 3816.49,-10695.09 3823.49,-10695.09"/>
</g>
<!-- layer0_k_proj&#45;&gt;layer0_attn_scores -->
<g id="edge6" class="edge">
<title>layer0_k_proj&#45;&gt;layer0_attn_scores</title>
<path fill="none" stroke="black" d="M4141.49,-10773.79C4141.49,-10773.79 4141.49,-10695.09 4141.49,-10695.09"/>
<polygon fill="black" stroke="black" points="4144.99,-10695.09 4141.49,-10685.09 4137.99,-10695.09 4144.99,-10695.09"/>
</g>
<!-- layer0_attn_out -->
<g id="node8" class="node">
<title>layer0_attn_out</title>
<polygon fill="lightblue" stroke="black" points="4149.49,-10505 3253.49,-10505 3253.49,-10452 4149.49,-10452 4149.49,-10505"/>
<text text-anchor="middle" x="3701.49" y="-10489.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3701.49" y="-10474.8" font-family="Times,serif" font-size="14.00">Input: Weights=[batch_size=8, heads=8, seq_len=256, seq_len=256], V=[batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="3701.49" y="-10459.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer0_v_proj&#45;&gt;layer0_attn_out -->
<g id="edge9" class="edge">
<title>layer0_v_proj&#45;&gt;layer0_attn_out</title>
<path fill="none" stroke="black" d="M3460.74,-10702.64C3460.74,-10702.64 3460.74,-10515.17 3460.74,-10515.17"/>
<polygon fill="black" stroke="black" points="3464.24,-10515.17 3460.74,-10505.17 3457.24,-10515.17 3464.24,-10515.17"/>
</g>
<!-- layer0_attn_weights -->
<g id="node7" class="node">
<title>layer0_attn_weights</title>
<polygon fill="lightblue" stroke="black" points="4185.49,-10595 3729.49,-10595 3729.49,-10542 4185.49,-10542 4185.49,-10595"/>
<text text-anchor="middle" x="3957.49" y="-10579.8" font-family="Times,serif" font-size="14.00">Softmax (Attention)</text>
<text text-anchor="middle" x="3957.49" y="-10564.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
<text text-anchor="middle" x="3957.49" y="-10549.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
</g>
<!-- layer0_attn_scores&#45;&gt;layer0_attn_weights -->
<g id="edge7" class="edge">
<title>layer0_attn_scores&#45;&gt;layer0_attn_weights</title>
<path fill="none" stroke="black" d="M3957.74,-10631.98C3957.74,-10631.98 3957.74,-10605.14 3957.74,-10605.14"/>
<polygon fill="black" stroke="black" points="3961.24,-10605.14 3957.74,-10595.14 3954.24,-10605.14 3961.24,-10605.14"/>
</g>
<!-- layer0_attn_weights&#45;&gt;layer0_attn_out -->
<g id="edge8" class="edge">
<title>layer0_attn_weights&#45;&gt;layer0_attn_out</title>
<path fill="none" stroke="black" d="M3939.49,-10541.98C3939.49,-10541.98 3939.49,-10515.14 3939.49,-10515.14"/>
<polygon fill="black" stroke="black" points="3942.99,-10515.14 3939.49,-10505.14 3935.99,-10515.14 3942.99,-10515.14"/>
</g>
<!-- layer0_attn_proj -->
<g id="node9" class="node">
<title>layer0_attn_proj</title>
<polygon fill="lightblue" stroke="black" points="3667.99,-10415 3252.99,-10415 3252.99,-10362 3667.99,-10362 3667.99,-10415"/>
<text text-anchor="middle" x="3460.49" y="-10399.8" font-family="Times,serif" font-size="14.00">Attention Output Projection</text>
<text text-anchor="middle" x="3460.49" y="-10384.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="3460.49" y="-10369.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer0_attn_out&#45;&gt;layer0_attn_proj -->
<g id="edge10" class="edge">
<title>layer0_attn_out&#45;&gt;layer0_attn_proj</title>
<path fill="none" stroke="black" d="M3460.74,-10451.98C3460.74,-10451.98 3460.74,-10425.14 3460.74,-10425.14"/>
<polygon fill="black" stroke="black" points="3464.24,-10425.14 3460.74,-10415.14 3457.24,-10425.14 3464.24,-10425.14"/>
</g>
<!-- layer0_attn_proj&#45;&gt;layer0_residual_attn -->
<g id="edge12" class="edge">
<title>layer0_attn_proj&#45;&gt;layer0_residual_attn</title>
<path fill="none" stroke="black" d="M3460.49,-10361.77C3460.49,-10361.77 3460.49,-10335.24 3460.49,-10335.24"/>
<polygon fill="black" stroke="black" points="3463.99,-10335.24 3460.49,-10325.24 3456.99,-10335.24 3463.99,-10335.24"/>
</g>
<!-- layer0_ln_moe -->
<g id="node11" class="node">
<title>layer0_ln_moe</title>
<polygon fill="lightblue" stroke="black" points="3666.99,-10182 3253.99,-10182 3253.99,-10129 3666.99,-10129 3666.99,-10182"/>
<text text-anchor="middle" x="3460.49" y="-10166.8" font-family="Times,serif" font-size="14.00">LayerNorm (MoE)</text>
<text text-anchor="middle" x="3460.49" y="-10151.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3460.49" y="-10136.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer0_residual_attn&#45;&gt;layer0_ln_moe -->
<g id="edge13" class="edge">
<title>layer0_residual_attn&#45;&gt;layer0_ln_moe</title>
<path fill="none" stroke="black" d="M3460.49,-10218.86C3460.49,-10218.86 3460.49,-10192.17 3460.49,-10192.17"/>
<polygon fill="black" stroke="black" points="3463.99,-10192.17 3460.49,-10182.17 3456.99,-10192.17 3463.99,-10192.17"/>
</g>
<!-- layer0_residual_moe -->
<g id="node18" class="node">
<title>layer0_residual_moe</title>
<polygon fill="yellow" stroke="black" points="4000.97,-9702 2767.35,-9702 2450.01,-9596 3683.63,-9596 4000.97,-9702"/>
<text text-anchor="middle" x="3225.49" y="-9660.3" font-family="Times,serif" font-size="14.00">Residual Add (MoE)</text>
<text text-anchor="middle" x="3225.49" y="-9645.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024], [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3225.49" y="-9630.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer0_residual_attn&#45;&gt;layer0_residual_moe -->
<g id="edge27" class="edge">
<title>layer0_residual_attn&#45;&gt;layer0_residual_moe</title>
<path fill="none" stroke="black" d="M2851.64,-10218.88C2851.64,-10218.88 2851.64,-9712.42 2851.64,-9712.42"/>
<polygon fill="black" stroke="black" points="2855.14,-9712.42 2851.64,-9702.42 2848.14,-9712.42 2855.14,-9712.42"/>
</g>
<!-- layer0_gate -->
<g id="node12" class="node">
<title>layer0_gate</title>
<polygon fill="yellow" stroke="black" points="4832.47,-10092 4170.74,-10092 4000.52,-9986 4662.24,-9986 4832.47,-10092"/>
<text text-anchor="middle" x="4416.49" y="-10050.3" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="4416.49" y="-10035.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="4416.49" y="-10020.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, experts=4]</text>
</g>
<!-- layer0_ln_moe&#45;&gt;layer0_gate -->
<g id="edge14" class="edge">
<title>layer0_ln_moe&#45;&gt;layer0_gate</title>
<path fill="none" stroke="black" d="M3652.99,-10128.77C3652.99,-10094.38 3652.99,-10039 3652.99,-10039 3652.99,-10039 4075.49,-10039 4075.49,-10039"/>
<polygon fill="black" stroke="black" points="4075.5,-10042.5 4085.49,-10039 4075.49,-10035.5 4075.5,-10042.5"/>
</g>
<!-- layer0_expert0 -->
<g id="node13" class="node">
<title>layer0_expert0</title>
<polygon fill="lightblue" stroke="black" points="4023.99,-9935 3610.99,-9935 3610.99,-9882 4023.99,-9882 4023.99,-9935"/>
<text text-anchor="middle" x="3817.49" y="-9919.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="3817.49" y="-9904.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3817.49" y="-9889.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer0_ln_moe&#45;&gt;layer0_expert0 -->
<g id="edge16" class="edge">
<title>layer0_ln_moe&#45;&gt;layer0_expert0</title>
<path fill="none" stroke="black" d="M3624.99,-10128.6C3624.99,-10128.6 3624.99,-9945.37 3624.99,-9945.37"/>
<polygon fill="black" stroke="black" points="3628.49,-9945.37 3624.99,-9935.37 3621.49,-9945.37 3628.49,-9945.37"/>
</g>
<!-- layer0_expert1 -->
<g id="node14" class="node">
<title>layer0_expert1</title>
<polygon fill="lightblue" stroke="black" points="4454.99,-9935 4041.99,-9935 4041.99,-9882 4454.99,-9882 4454.99,-9935"/>
<text text-anchor="middle" x="4248.49" y="-9919.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="4248.49" y="-9904.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="4248.49" y="-9889.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer0_ln_moe&#45;&gt;layer0_expert1 -->
<g id="edge18" class="edge">
<title>layer0_ln_moe&#45;&gt;layer0_expert1</title>
<path fill="none" stroke="black" d="M3638.99,-10128.73C3638.99,-10075.18 3638.99,-9960 3638.99,-9960 3638.99,-9960 4179.66,-9960 4179.66,-9960 4179.66,-9960 4179.66,-9945.16 4179.66,-9945.16"/>
<polygon fill="black" stroke="black" points="4183.16,-9945.16 4179.66,-9935.16 4176.16,-9945.16 4183.16,-9945.16"/>
</g>
<!-- layer0_expert2 -->
<g id="node15" class="node">
<title>layer0_expert2</title>
<polygon fill="lightblue" stroke="black" points="4885.99,-9935 4472.99,-9935 4472.99,-9882 4885.99,-9882 4885.99,-9935"/>
<text text-anchor="middle" x="4679.49" y="-9919.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="4679.49" y="-9904.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="4679.49" y="-9889.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer0_ln_moe&#45;&gt;layer0_expert2 -->
<g id="edge20" class="edge">
<title>layer0_ln_moe&#45;&gt;layer0_expert2</title>
<path fill="none" stroke="black" d="M3667.24,-10146C4056.43,-10146 4859.11,-10146 4859.11,-10146 4859.11,-10146 4859.11,-9945.28 4859.11,-9945.28"/>
<polygon fill="black" stroke="black" points="4862.61,-9945.28 4859.11,-9935.28 4855.61,-9945.28 4862.61,-9945.28"/>
</g>
<!-- layer0_expert3 -->
<g id="node16" class="node">
<title>layer0_expert3</title>
<polygon fill="lightblue" stroke="black" points="5316.99,-9935 4903.99,-9935 4903.99,-9882 5316.99,-9882 5316.99,-9935"/>
<text text-anchor="middle" x="5110.49" y="-9919.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="5110.49" y="-9904.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="5110.49" y="-9889.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer0_ln_moe&#45;&gt;layer0_expert3 -->
<g id="edge22" class="edge">
<title>layer0_ln_moe&#45;&gt;layer0_expert3</title>
<path fill="none" stroke="black" d="M3667.4,-10164C4124.32,-10164 5179.32,-10164 5179.32,-10164 5179.32,-10164 5179.32,-9945.36 5179.32,-9945.36"/>
<polygon fill="black" stroke="black" points="5182.82,-9945.36 5179.32,-9935.36 5175.82,-9945.36 5182.82,-9945.36"/>
</g>
<!-- layer0_gate&#45;&gt;layer0_expert0 -->
<g id="edge15" class="edge">
<title>layer0_gate&#45;&gt;layer0_expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4012.37,-10038.91C4012.37,-10038.91 4012.37,-9945.11 4012.37,-9945.11"/>
<polygon fill="black" stroke="black" points="4015.87,-9945.11 4012.37,-9935.11 4008.87,-9945.11 4015.87,-9945.11"/>
<text text-anchor="middle" x="3903.99" y="-9956.8" font-family="Times,serif" font-size="14.00">select expert 0</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_expert1 -->
<g id="edge17" class="edge">
<title>layer0_gate&#45;&gt;layer0_expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4317.32,-9985.92C4317.32,-9985.92 4317.32,-9945.07 4317.32,-9945.07"/>
<polygon fill="black" stroke="black" points="4320.82,-9945.07 4317.32,-9935.07 4313.82,-9945.07 4320.82,-9945.07"/>
<text text-anchor="middle" x="4361.99" y="-9956.8" font-family="Times,serif" font-size="14.00">select expert 1</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_expert2 -->
<g id="edge19" class="edge">
<title>layer0_gate&#45;&gt;layer0_expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4652.61,-9985.92C4652.61,-9985.92 4652.61,-9945.07 4652.61,-9945.07"/>
<polygon fill="black" stroke="black" points="4656.11,-9945.07 4652.61,-9935.07 4649.11,-9945.07 4656.11,-9945.07"/>
<text text-anchor="middle" x="4552.99" y="-9956.8" font-family="Times,serif" font-size="14.00">select expert 2</text>
</g>
<!-- layer0_gate&#45;&gt;layer0_expert3 -->
<g id="edge21" class="edge">
<title>layer0_gate&#45;&gt;layer0_expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4747.38,-10039C4897.34,-10039 5041.66,-10039 5041.66,-10039 5041.66,-10039 5041.66,-9945.22 5041.66,-9945.22"/>
<polygon fill="black" stroke="black" points="5045.16,-9945.22 5041.66,-9935.22 5038.16,-9945.22 5045.16,-9945.22"/>
<text text-anchor="middle" x="4791.99" y="-9956.8" font-family="Times,serif" font-size="14.00">select expert 3</text>
</g>
<!-- layer0_expert_agg -->
<g id="node17" class="node">
<title>layer0_expert_agg</title>
<polygon fill="yellow" stroke="black" points="6819.92,-9845 3982.88,-9845 3253.06,-9739 6090.1,-9739 6819.92,-9845"/>
<text text-anchor="middle" x="5036.49" y="-9803.3" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="5036.49" y="-9788.3" font-family="Times,serif" font-size="14.00">Input: Expert0=[batch_size=8, seq_len=256, token_dim=1024], Expert1=[batch_size=8, seq_len=256, token_dim=1024], Expert2=[batch_size=8, seq_len=256, token_dim=1024], Expert3=[batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="5036.49" y="-9773.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer0_expert0&#45;&gt;layer0_expert_agg -->
<g id="edge23" class="edge">
<title>layer0_expert0&#45;&gt;layer0_expert_agg</title>
<path fill="none" stroke="black" d="M3817.49,-9881.77C3817.49,-9881.77 3817.49,-9831.05 3817.49,-9831.05"/>
<polygon fill="black" stroke="black" points="3820.99,-9831.05 3817.49,-9821.05 3813.99,-9831.05 3820.99,-9831.05"/>
</g>
<!-- layer0_expert1&#45;&gt;layer0_expert_agg -->
<g id="edge24" class="edge">
<title>layer0_expert1&#45;&gt;layer0_expert_agg</title>
<path fill="none" stroke="black" d="M4248.49,-9881.77C4248.49,-9881.77 4248.49,-9855.24 4248.49,-9855.24"/>
<polygon fill="black" stroke="black" points="4251.99,-9855.24 4248.49,-9845.24 4244.99,-9855.24 4251.99,-9855.24"/>
</g>
<!-- layer0_expert2&#45;&gt;layer0_expert_agg -->
<g id="edge25" class="edge">
<title>layer0_expert2&#45;&gt;layer0_expert_agg</title>
<path fill="none" stroke="black" d="M4679.49,-9881.77C4679.49,-9881.77 4679.49,-9855.24 4679.49,-9855.24"/>
<polygon fill="black" stroke="black" points="4682.99,-9855.24 4679.49,-9845.24 4675.99,-9855.24 4682.99,-9855.24"/>
</g>
<!-- layer0_expert3&#45;&gt;layer0_expert_agg -->
<g id="edge26" class="edge">
<title>layer0_expert3&#45;&gt;layer0_expert_agg</title>
<path fill="none" stroke="black" d="M5110.49,-9881.77C5110.49,-9881.77 5110.49,-9855.24 5110.49,-9855.24"/>
<polygon fill="black" stroke="black" points="5113.99,-9855.24 5110.49,-9845.24 5106.99,-9855.24 5113.99,-9855.24"/>
</g>
<!-- layer0_expert_agg&#45;&gt;layer0_residual_moe -->
<g id="edge28" class="edge">
<title>layer0_expert_agg&#45;&gt;layer0_residual_moe</title>
<path fill="none" stroke="black" d="M3627.13,-9738.75C3627.13,-9738.75 3627.13,-9712.29 3627.13,-9712.29"/>
<polygon fill="black" stroke="black" points="3630.63,-9712.29 3627.13,-9702.29 3623.63,-9712.29 3630.63,-9712.29"/>
</g>
<!-- layer1_ln_attn -->
<g id="node19" class="node">
<title>layer1_ln_attn</title>
<polygon fill="lightblue" stroke="black" points="3431.99,-9559 3018.99,-9559 3018.99,-9506 3431.99,-9506 3431.99,-9559"/>
<text text-anchor="middle" x="3225.49" y="-9543.8" font-family="Times,serif" font-size="14.00">LayerNorm (Attention)</text>
<text text-anchor="middle" x="3225.49" y="-9528.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3225.49" y="-9513.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer0_residual_moe&#45;&gt;layer1_ln_attn -->
<g id="edge29" class="edge">
<title>layer0_residual_moe&#45;&gt;layer1_ln_attn</title>
<path fill="none" stroke="black" d="M3225.49,-9595.86C3225.49,-9595.86 3225.49,-9569.17 3225.49,-9569.17"/>
<polygon fill="black" stroke="black" points="3228.99,-9569.17 3225.49,-9559.17 3221.99,-9569.17 3228.99,-9569.17"/>
</g>
<!-- layer1_q_proj -->
<g id="node20" class="node">
<title>layer1_q_proj</title>
<polygon fill="lightblue" stroke="black" points="3559.99,-9469 3132.99,-9469 3132.99,-9416 3559.99,-9416 3559.99,-9469"/>
<text text-anchor="middle" x="3346.49" y="-9453.8" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="3346.49" y="-9438.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3346.49" y="-9423.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer1_ln_attn&#45;&gt;layer1_q_proj -->
<g id="edge30" class="edge">
<title>layer1_ln_attn&#45;&gt;layer1_q_proj</title>
<path fill="none" stroke="black" d="M3282.49,-9505.98C3282.49,-9505.98 3282.49,-9479.14 3282.49,-9479.14"/>
<polygon fill="black" stroke="black" points="3285.99,-9479.14 3282.49,-9469.14 3278.99,-9479.14 3285.99,-9479.14"/>
</g>
<!-- layer1_k_proj -->
<g id="node21" class="node">
<title>layer1_k_proj</title>
<polygon fill="lightblue" stroke="black" points="4004.99,-9469 3577.99,-9469 3577.99,-9416 4004.99,-9416 4004.99,-9469"/>
<text text-anchor="middle" x="3791.49" y="-9453.8" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="3791.49" y="-9438.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3791.49" y="-9423.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer1_ln_attn&#45;&gt;layer1_k_proj -->
<g id="edge31" class="edge">
<title>layer1_ln_attn&#45;&gt;layer1_k_proj</title>
<path fill="none" stroke="black" d="M3432.3,-9532C3593.26,-9532 3789.49,-9532 3789.49,-9532 3789.49,-9532 3789.49,-9479.35 3789.49,-9479.35"/>
<polygon fill="black" stroke="black" points="3792.99,-9479.35 3789.49,-9469.35 3785.99,-9479.35 3792.99,-9479.35"/>
</g>
<!-- layer1_v_proj -->
<g id="node22" class="node">
<title>layer1_v_proj</title>
<polygon fill="lightblue" stroke="black" points="3317.99,-9398 2890.99,-9398 2890.99,-9345 3317.99,-9345 3317.99,-9398"/>
<text text-anchor="middle" x="3104.49" y="-9382.8" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="3104.49" y="-9367.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3104.49" y="-9352.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer1_ln_attn&#45;&gt;layer1_v_proj -->
<g id="edge32" class="edge">
<title>layer1_ln_attn&#45;&gt;layer1_v_proj</title>
<path fill="none" stroke="black" d="M3075.99,-9505.91C3075.99,-9505.91 3075.99,-9408.13 3075.99,-9408.13"/>
<polygon fill="black" stroke="black" points="3079.49,-9408.13 3075.99,-9398.13 3072.49,-9408.13 3079.49,-9408.13"/>
</g>
<!-- layer1_residual_attn -->
<g id="node27" class="node">
<title>layer1_residual_attn</title>
<polygon fill="yellow" stroke="black" points="3650.97,-8967 2417.35,-8967 2100.01,-8861 3333.63,-8861 3650.97,-8967"/>
<text text-anchor="middle" x="2875.49" y="-8925.3" font-family="Times,serif" font-size="14.00">Residual Add (Attention)</text>
<text text-anchor="middle" x="2875.49" y="-8910.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024], [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2875.49" y="-8895.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer1_ln_attn&#45;&gt;layer1_residual_attn -->
<g id="edge39" class="edge">
<title>layer1_ln_attn&#45;&gt;layer1_residual_attn</title>
<path fill="none" stroke="black" d="M3018.83,-9532C2861.04,-9532 2670.5,-9532 2670.5,-9532 2670.5,-9532 2670.5,-8977.23 2670.5,-8977.23"/>
<polygon fill="black" stroke="black" points="2674,-8977.23 2670.5,-8967.23 2667,-8977.23 2674,-8977.23"/>
</g>
<!-- layer1_attn_scores -->
<g id="node23" class="node">
<title>layer1_attn_scores</title>
<polygon fill="lightblue" stroke="black" points="4200.99,-9327 3379.99,-9327 3379.99,-9274 4200.99,-9274 4200.99,-9327"/>
<text text-anchor="middle" x="3790.49" y="-9311.8" font-family="Times,serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="3790.49" y="-9296.8" font-family="Times,serif" font-size="14.00">Input: Q=[batch_size=8, seq_len=256, heads=8, d_k=128], K=[batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="3790.49" y="-9281.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
</g>
<!-- layer1_q_proj&#45;&gt;layer1_attn_scores -->
<g id="edge33" class="edge">
<title>layer1_q_proj&#45;&gt;layer1_attn_scores</title>
<path fill="none" stroke="black" d="M3469.99,-9415.79C3469.99,-9415.79 3469.99,-9337.09 3469.99,-9337.09"/>
<polygon fill="black" stroke="black" points="3473.49,-9337.09 3469.99,-9327.09 3466.49,-9337.09 3473.49,-9337.09"/>
</g>
<!-- layer1_k_proj&#45;&gt;layer1_attn_scores -->
<g id="edge34" class="edge">
<title>layer1_k_proj&#45;&gt;layer1_attn_scores</title>
<path fill="none" stroke="black" d="M3791.49,-9415.79C3791.49,-9415.79 3791.49,-9337.09 3791.49,-9337.09"/>
<polygon fill="black" stroke="black" points="3794.99,-9337.09 3791.49,-9327.09 3787.99,-9337.09 3794.99,-9337.09"/>
</g>
<!-- layer1_attn_out -->
<g id="node25" class="node">
<title>layer1_attn_out</title>
<polygon fill="lightblue" stroke="black" points="3799.49,-9147 2903.49,-9147 2903.49,-9094 3799.49,-9094 3799.49,-9147"/>
<text text-anchor="middle" x="3351.49" y="-9131.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3351.49" y="-9116.8" font-family="Times,serif" font-size="14.00">Input: Weights=[batch_size=8, heads=8, seq_len=256, seq_len=256], V=[batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="3351.49" y="-9101.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer1_v_proj&#45;&gt;layer1_attn_out -->
<g id="edge37" class="edge">
<title>layer1_v_proj&#45;&gt;layer1_attn_out</title>
<path fill="none" stroke="black" d="M3110.74,-9344.64C3110.74,-9344.64 3110.74,-9157.17 3110.74,-9157.17"/>
<polygon fill="black" stroke="black" points="3114.24,-9157.17 3110.74,-9147.17 3107.24,-9157.17 3114.24,-9157.17"/>
</g>
<!-- layer1_attn_weights -->
<g id="node24" class="node">
<title>layer1_attn_weights</title>
<polygon fill="lightblue" stroke="black" points="3835.49,-9237 3379.49,-9237 3379.49,-9184 3835.49,-9184 3835.49,-9237"/>
<text text-anchor="middle" x="3607.49" y="-9221.8" font-family="Times,serif" font-size="14.00">Softmax (Attention)</text>
<text text-anchor="middle" x="3607.49" y="-9206.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
<text text-anchor="middle" x="3607.49" y="-9191.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
</g>
<!-- layer1_attn_scores&#45;&gt;layer1_attn_weights -->
<g id="edge35" class="edge">
<title>layer1_attn_scores&#45;&gt;layer1_attn_weights</title>
<path fill="none" stroke="black" d="M3607.74,-9273.98C3607.74,-9273.98 3607.74,-9247.14 3607.74,-9247.14"/>
<polygon fill="black" stroke="black" points="3611.24,-9247.14 3607.74,-9237.14 3604.24,-9247.14 3611.24,-9247.14"/>
</g>
<!-- layer1_attn_weights&#45;&gt;layer1_attn_out -->
<g id="edge36" class="edge">
<title>layer1_attn_weights&#45;&gt;layer1_attn_out</title>
<path fill="none" stroke="black" d="M3589.49,-9183.98C3589.49,-9183.98 3589.49,-9157.14 3589.49,-9157.14"/>
<polygon fill="black" stroke="black" points="3592.99,-9157.14 3589.49,-9147.14 3585.99,-9157.14 3592.99,-9157.14"/>
</g>
<!-- layer1_attn_proj -->
<g id="node26" class="node">
<title>layer1_attn_proj</title>
<polygon fill="lightblue" stroke="black" points="3317.99,-9057 2902.99,-9057 2902.99,-9004 3317.99,-9004 3317.99,-9057"/>
<text text-anchor="middle" x="3110.49" y="-9041.8" font-family="Times,serif" font-size="14.00">Attention Output Projection</text>
<text text-anchor="middle" x="3110.49" y="-9026.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="3110.49" y="-9011.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer1_attn_out&#45;&gt;layer1_attn_proj -->
<g id="edge38" class="edge">
<title>layer1_attn_out&#45;&gt;layer1_attn_proj</title>
<path fill="none" stroke="black" d="M3110.74,-9093.98C3110.74,-9093.98 3110.74,-9067.14 3110.74,-9067.14"/>
<polygon fill="black" stroke="black" points="3114.24,-9067.14 3110.74,-9057.14 3107.24,-9067.14 3114.24,-9067.14"/>
</g>
<!-- layer1_attn_proj&#45;&gt;layer1_residual_attn -->
<g id="edge40" class="edge">
<title>layer1_attn_proj&#45;&gt;layer1_residual_attn</title>
<path fill="none" stroke="black" d="M3110.49,-9003.77C3110.49,-9003.77 3110.49,-8977.24 3110.49,-8977.24"/>
<polygon fill="black" stroke="black" points="3113.99,-8977.24 3110.49,-8967.24 3106.99,-8977.24 3113.99,-8977.24"/>
</g>
<!-- layer1_ln_moe -->
<g id="node28" class="node">
<title>layer1_ln_moe</title>
<polygon fill="lightblue" stroke="black" points="3316.99,-8824 2903.99,-8824 2903.99,-8771 3316.99,-8771 3316.99,-8824"/>
<text text-anchor="middle" x="3110.49" y="-8808.8" font-family="Times,serif" font-size="14.00">LayerNorm (MoE)</text>
<text text-anchor="middle" x="3110.49" y="-8793.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3110.49" y="-8778.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer1_residual_attn&#45;&gt;layer1_ln_moe -->
<g id="edge41" class="edge">
<title>layer1_residual_attn&#45;&gt;layer1_ln_moe</title>
<path fill="none" stroke="black" d="M3110.49,-8860.86C3110.49,-8860.86 3110.49,-8834.17 3110.49,-8834.17"/>
<polygon fill="black" stroke="black" points="3113.99,-8834.17 3110.49,-8824.17 3106.99,-8834.17 3113.99,-8834.17"/>
</g>
<!-- layer1_residual_moe -->
<g id="node35" class="node">
<title>layer1_residual_moe</title>
<polygon fill="yellow" stroke="black" points="3650.97,-8344 2417.35,-8344 2100.01,-8238 3333.63,-8238 3650.97,-8344"/>
<text text-anchor="middle" x="2875.49" y="-8302.3" font-family="Times,serif" font-size="14.00">Residual Add (MoE)</text>
<text text-anchor="middle" x="2875.49" y="-8287.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024], [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2875.49" y="-8272.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer1_residual_attn&#45;&gt;layer1_residual_moe -->
<g id="edge55" class="edge">
<title>layer1_residual_attn&#45;&gt;layer1_residual_moe</title>
<path fill="none" stroke="black" d="M2501.64,-8860.88C2501.64,-8860.88 2501.64,-8354.42 2501.64,-8354.42"/>
<polygon fill="black" stroke="black" points="2505.14,-8354.42 2501.64,-8344.42 2498.14,-8354.42 2505.14,-8354.42"/>
</g>
<!-- layer1_gate -->
<g id="node29" class="node">
<title>layer1_gate</title>
<polygon fill="yellow" stroke="black" points="4482.47,-8734 3820.74,-8734 3650.52,-8628 4312.24,-8628 4482.47,-8734"/>
<text text-anchor="middle" x="4066.49" y="-8692.3" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="4066.49" y="-8677.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="4066.49" y="-8662.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, experts=4]</text>
</g>
<!-- layer1_ln_moe&#45;&gt;layer1_gate -->
<g id="edge42" class="edge">
<title>layer1_ln_moe&#45;&gt;layer1_gate</title>
<path fill="none" stroke="black" d="M3302.99,-8770.77C3302.99,-8736.38 3302.99,-8681 3302.99,-8681 3302.99,-8681 3725.49,-8681 3725.49,-8681"/>
<polygon fill="black" stroke="black" points="3725.5,-8684.5 3735.49,-8681 3725.49,-8677.5 3725.5,-8684.5"/>
</g>
<!-- layer1_expert0 -->
<g id="node30" class="node">
<title>layer1_expert0</title>
<polygon fill="lightblue" stroke="black" points="3673.99,-8577 3260.99,-8577 3260.99,-8524 3673.99,-8524 3673.99,-8577"/>
<text text-anchor="middle" x="3467.49" y="-8561.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="3467.49" y="-8546.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3467.49" y="-8531.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer1_ln_moe&#45;&gt;layer1_expert0 -->
<g id="edge44" class="edge">
<title>layer1_ln_moe&#45;&gt;layer1_expert0</title>
<path fill="none" stroke="black" d="M3274.99,-8770.6C3274.99,-8770.6 3274.99,-8587.37 3274.99,-8587.37"/>
<polygon fill="black" stroke="black" points="3278.49,-8587.37 3274.99,-8577.37 3271.49,-8587.37 3278.49,-8587.37"/>
</g>
<!-- layer1_expert1 -->
<g id="node31" class="node">
<title>layer1_expert1</title>
<polygon fill="lightblue" stroke="black" points="4104.99,-8577 3691.99,-8577 3691.99,-8524 4104.99,-8524 4104.99,-8577"/>
<text text-anchor="middle" x="3898.49" y="-8561.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3898.49" y="-8546.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3898.49" y="-8531.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer1_ln_moe&#45;&gt;layer1_expert1 -->
<g id="edge46" class="edge">
<title>layer1_ln_moe&#45;&gt;layer1_expert1</title>
<path fill="none" stroke="black" d="M3288.99,-8770.73C3288.99,-8717.18 3288.99,-8602 3288.99,-8602 3288.99,-8602 3829.66,-8602 3829.66,-8602 3829.66,-8602 3829.66,-8587.16 3829.66,-8587.16"/>
<polygon fill="black" stroke="black" points="3833.16,-8587.16 3829.66,-8577.16 3826.16,-8587.16 3833.16,-8587.16"/>
</g>
<!-- layer1_expert2 -->
<g id="node32" class="node">
<title>layer1_expert2</title>
<polygon fill="lightblue" stroke="black" points="4535.99,-8577 4122.99,-8577 4122.99,-8524 4535.99,-8524 4535.99,-8577"/>
<text text-anchor="middle" x="4329.49" y="-8561.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="4329.49" y="-8546.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="4329.49" y="-8531.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer1_ln_moe&#45;&gt;layer1_expert2 -->
<g id="edge48" class="edge">
<title>layer1_ln_moe&#45;&gt;layer1_expert2</title>
<path fill="none" stroke="black" d="M3317.24,-8788C3706.43,-8788 4509.11,-8788 4509.11,-8788 4509.11,-8788 4509.11,-8587.28 4509.11,-8587.28"/>
<polygon fill="black" stroke="black" points="4512.61,-8587.28 4509.11,-8577.28 4505.61,-8587.28 4512.61,-8587.28"/>
</g>
<!-- layer1_expert3 -->
<g id="node33" class="node">
<title>layer1_expert3</title>
<polygon fill="lightblue" stroke="black" points="4966.99,-8577 4553.99,-8577 4553.99,-8524 4966.99,-8524 4966.99,-8577"/>
<text text-anchor="middle" x="4760.49" y="-8561.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="4760.49" y="-8546.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="4760.49" y="-8531.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer1_ln_moe&#45;&gt;layer1_expert3 -->
<g id="edge50" class="edge">
<title>layer1_ln_moe&#45;&gt;layer1_expert3</title>
<path fill="none" stroke="black" d="M3317.4,-8806C3774.32,-8806 4829.32,-8806 4829.32,-8806 4829.32,-8806 4829.32,-8587.36 4829.32,-8587.36"/>
<polygon fill="black" stroke="black" points="4832.82,-8587.36 4829.32,-8577.36 4825.82,-8587.36 4832.82,-8587.36"/>
</g>
<!-- layer1_gate&#45;&gt;layer1_expert0 -->
<g id="edge43" class="edge">
<title>layer1_gate&#45;&gt;layer1_expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3662.37,-8680.91C3662.37,-8680.91 3662.37,-8587.11 3662.37,-8587.11"/>
<polygon fill="black" stroke="black" points="3665.87,-8587.11 3662.37,-8577.11 3658.87,-8587.11 3665.87,-8587.11"/>
<text text-anchor="middle" x="3553.99" y="-8598.8" font-family="Times,serif" font-size="14.00">select expert 0</text>
</g>
<!-- layer1_gate&#45;&gt;layer1_expert1 -->
<g id="edge45" class="edge">
<title>layer1_gate&#45;&gt;layer1_expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3967.32,-8627.92C3967.32,-8627.92 3967.32,-8587.07 3967.32,-8587.07"/>
<polygon fill="black" stroke="black" points="3970.82,-8587.07 3967.32,-8577.07 3963.82,-8587.07 3970.82,-8587.07"/>
<text text-anchor="middle" x="4035.99" y="-8598.8" font-family="Times,serif" font-size="14.00">select expert 1</text>
</g>
<!-- layer1_gate&#45;&gt;layer1_expert2 -->
<g id="edge47" class="edge">
<title>layer1_gate&#45;&gt;layer1_expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4302.61,-8627.92C4302.61,-8627.92 4302.61,-8587.07 4302.61,-8587.07"/>
<polygon fill="black" stroke="black" points="4306.11,-8587.07 4302.61,-8577.07 4299.11,-8587.07 4306.11,-8587.07"/>
<text text-anchor="middle" x="4268.99" y="-8598.8" font-family="Times,serif" font-size="14.00">select expert 2</text>
</g>
<!-- layer1_gate&#45;&gt;layer1_expert3 -->
<g id="edge49" class="edge">
<title>layer1_gate&#45;&gt;layer1_expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4397.38,-8681C4547.34,-8681 4691.66,-8681 4691.66,-8681 4691.66,-8681 4691.66,-8587.22 4691.66,-8587.22"/>
<polygon fill="black" stroke="black" points="4695.16,-8587.22 4691.66,-8577.22 4688.16,-8587.22 4695.16,-8587.22"/>
<text text-anchor="middle" x="4441.99" y="-8598.8" font-family="Times,serif" font-size="14.00">select expert 3</text>
</g>
<!-- layer1_expert_agg -->
<g id="node34" class="node">
<title>layer1_expert_agg</title>
<polygon fill="yellow" stroke="black" points="6469.92,-8487 3632.88,-8487 2903.06,-8381 5740.1,-8381 6469.92,-8487"/>
<text text-anchor="middle" x="4686.49" y="-8445.3" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4686.49" y="-8430.3" font-family="Times,serif" font-size="14.00">Input: Expert0=[batch_size=8, seq_len=256, token_dim=1024], Expert1=[batch_size=8, seq_len=256, token_dim=1024], Expert2=[batch_size=8, seq_len=256, token_dim=1024], Expert3=[batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="4686.49" y="-8415.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer1_expert0&#45;&gt;layer1_expert_agg -->
<g id="edge51" class="edge">
<title>layer1_expert0&#45;&gt;layer1_expert_agg</title>
<path fill="none" stroke="black" d="M3467.49,-8523.77C3467.49,-8523.77 3467.49,-8473.05 3467.49,-8473.05"/>
<polygon fill="black" stroke="black" points="3470.99,-8473.05 3467.49,-8463.05 3463.99,-8473.05 3470.99,-8473.05"/>
</g>
<!-- layer1_expert1&#45;&gt;layer1_expert_agg -->
<g id="edge52" class="edge">
<title>layer1_expert1&#45;&gt;layer1_expert_agg</title>
<path fill="none" stroke="black" d="M3898.49,-8523.77C3898.49,-8523.77 3898.49,-8497.24 3898.49,-8497.24"/>
<polygon fill="black" stroke="black" points="3901.99,-8497.24 3898.49,-8487.24 3894.99,-8497.24 3901.99,-8497.24"/>
</g>
<!-- layer1_expert2&#45;&gt;layer1_expert_agg -->
<g id="edge53" class="edge">
<title>layer1_expert2&#45;&gt;layer1_expert_agg</title>
<path fill="none" stroke="black" d="M4329.49,-8523.77C4329.49,-8523.77 4329.49,-8497.24 4329.49,-8497.24"/>
<polygon fill="black" stroke="black" points="4332.99,-8497.24 4329.49,-8487.24 4325.99,-8497.24 4332.99,-8497.24"/>
</g>
<!-- layer1_expert3&#45;&gt;layer1_expert_agg -->
<g id="edge54" class="edge">
<title>layer1_expert3&#45;&gt;layer1_expert_agg</title>
<path fill="none" stroke="black" d="M4760.49,-8523.77C4760.49,-8523.77 4760.49,-8497.24 4760.49,-8497.24"/>
<polygon fill="black" stroke="black" points="4763.99,-8497.24 4760.49,-8487.24 4756.99,-8497.24 4763.99,-8497.24"/>
</g>
<!-- layer1_expert_agg&#45;&gt;layer1_residual_moe -->
<g id="edge56" class="edge">
<title>layer1_expert_agg&#45;&gt;layer1_residual_moe</title>
<path fill="none" stroke="black" d="M3277.13,-8380.75C3277.13,-8380.75 3277.13,-8354.29 3277.13,-8354.29"/>
<polygon fill="black" stroke="black" points="3280.63,-8354.29 3277.13,-8344.29 3273.63,-8354.29 3280.63,-8354.29"/>
</g>
<!-- layer2_ln_attn -->
<g id="node36" class="node">
<title>layer2_ln_attn</title>
<polygon fill="lightblue" stroke="black" points="3081.99,-8201 2668.99,-8201 2668.99,-8148 3081.99,-8148 3081.99,-8201"/>
<text text-anchor="middle" x="2875.49" y="-8185.8" font-family="Times,serif" font-size="14.00">LayerNorm (Attention)</text>
<text text-anchor="middle" x="2875.49" y="-8170.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2875.49" y="-8155.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer1_residual_moe&#45;&gt;layer2_ln_attn -->
<g id="edge57" class="edge">
<title>layer1_residual_moe&#45;&gt;layer2_ln_attn</title>
<path fill="none" stroke="black" d="M2875.49,-8237.86C2875.49,-8237.86 2875.49,-8211.17 2875.49,-8211.17"/>
<polygon fill="black" stroke="black" points="2878.99,-8211.17 2875.49,-8201.17 2871.99,-8211.17 2878.99,-8211.17"/>
</g>
<!-- layer2_q_proj -->
<g id="node37" class="node">
<title>layer2_q_proj</title>
<polygon fill="lightblue" stroke="black" points="3209.99,-8111 2782.99,-8111 2782.99,-8058 3209.99,-8058 3209.99,-8111"/>
<text text-anchor="middle" x="2996.49" y="-8095.8" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="2996.49" y="-8080.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2996.49" y="-8065.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer2_ln_attn&#45;&gt;layer2_q_proj -->
<g id="edge58" class="edge">
<title>layer2_ln_attn&#45;&gt;layer2_q_proj</title>
<path fill="none" stroke="black" d="M2932.49,-8147.98C2932.49,-8147.98 2932.49,-8121.14 2932.49,-8121.14"/>
<polygon fill="black" stroke="black" points="2935.99,-8121.14 2932.49,-8111.14 2928.99,-8121.14 2935.99,-8121.14"/>
</g>
<!-- layer2_k_proj -->
<g id="node38" class="node">
<title>layer2_k_proj</title>
<polygon fill="lightblue" stroke="black" points="3654.99,-8111 3227.99,-8111 3227.99,-8058 3654.99,-8058 3654.99,-8111"/>
<text text-anchor="middle" x="3441.49" y="-8095.8" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="3441.49" y="-8080.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3441.49" y="-8065.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer2_ln_attn&#45;&gt;layer2_k_proj -->
<g id="edge59" class="edge">
<title>layer2_ln_attn&#45;&gt;layer2_k_proj</title>
<path fill="none" stroke="black" d="M3082.3,-8174C3243.26,-8174 3439.49,-8174 3439.49,-8174 3439.49,-8174 3439.49,-8121.35 3439.49,-8121.35"/>
<polygon fill="black" stroke="black" points="3442.99,-8121.35 3439.49,-8111.35 3435.99,-8121.35 3442.99,-8121.35"/>
</g>
<!-- layer2_v_proj -->
<g id="node39" class="node">
<title>layer2_v_proj</title>
<polygon fill="lightblue" stroke="black" points="2967.99,-8040 2540.99,-8040 2540.99,-7987 2967.99,-7987 2967.99,-8040"/>
<text text-anchor="middle" x="2754.49" y="-8024.8" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="2754.49" y="-8009.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2754.49" y="-7994.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer2_ln_attn&#45;&gt;layer2_v_proj -->
<g id="edge60" class="edge">
<title>layer2_ln_attn&#45;&gt;layer2_v_proj</title>
<path fill="none" stroke="black" d="M2725.99,-8147.91C2725.99,-8147.91 2725.99,-8050.13 2725.99,-8050.13"/>
<polygon fill="black" stroke="black" points="2729.49,-8050.13 2725.99,-8040.13 2722.49,-8050.13 2729.49,-8050.13"/>
</g>
<!-- layer2_residual_attn -->
<g id="node44" class="node">
<title>layer2_residual_attn</title>
<polygon fill="yellow" stroke="black" points="3300.97,-7609 2067.35,-7609 1750.01,-7503 2983.63,-7503 3300.97,-7609"/>
<text text-anchor="middle" x="2525.49" y="-7567.3" font-family="Times,serif" font-size="14.00">Residual Add (Attention)</text>
<text text-anchor="middle" x="2525.49" y="-7552.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024], [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2525.49" y="-7537.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer2_ln_attn&#45;&gt;layer2_residual_attn -->
<g id="edge67" class="edge">
<title>layer2_ln_attn&#45;&gt;layer2_residual_attn</title>
<path fill="none" stroke="black" d="M2668.83,-8174C2511.04,-8174 2320.5,-8174 2320.5,-8174 2320.5,-8174 2320.5,-7619.23 2320.5,-7619.23"/>
<polygon fill="black" stroke="black" points="2324,-7619.23 2320.5,-7609.23 2317,-7619.23 2324,-7619.23"/>
</g>
<!-- layer2_attn_scores -->
<g id="node40" class="node">
<title>layer2_attn_scores</title>
<polygon fill="lightblue" stroke="black" points="3850.99,-7969 3029.99,-7969 3029.99,-7916 3850.99,-7916 3850.99,-7969"/>
<text text-anchor="middle" x="3440.49" y="-7953.8" font-family="Times,serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="3440.49" y="-7938.8" font-family="Times,serif" font-size="14.00">Input: Q=[batch_size=8, seq_len=256, heads=8, d_k=128], K=[batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="3440.49" y="-7923.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
</g>
<!-- layer2_q_proj&#45;&gt;layer2_attn_scores -->
<g id="edge61" class="edge">
<title>layer2_q_proj&#45;&gt;layer2_attn_scores</title>
<path fill="none" stroke="black" d="M3119.99,-8057.79C3119.99,-8057.79 3119.99,-7979.09 3119.99,-7979.09"/>
<polygon fill="black" stroke="black" points="3123.49,-7979.09 3119.99,-7969.09 3116.49,-7979.09 3123.49,-7979.09"/>
</g>
<!-- layer2_k_proj&#45;&gt;layer2_attn_scores -->
<g id="edge62" class="edge">
<title>layer2_k_proj&#45;&gt;layer2_attn_scores</title>
<path fill="none" stroke="black" d="M3441.49,-8057.79C3441.49,-8057.79 3441.49,-7979.09 3441.49,-7979.09"/>
<polygon fill="black" stroke="black" points="3444.99,-7979.09 3441.49,-7969.09 3437.99,-7979.09 3444.99,-7979.09"/>
</g>
<!-- layer2_attn_out -->
<g id="node42" class="node">
<title>layer2_attn_out</title>
<polygon fill="lightblue" stroke="black" points="3449.49,-7789 2553.49,-7789 2553.49,-7736 3449.49,-7736 3449.49,-7789"/>
<text text-anchor="middle" x="3001.49" y="-7773.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="3001.49" y="-7758.8" font-family="Times,serif" font-size="14.00">Input: Weights=[batch_size=8, heads=8, seq_len=256, seq_len=256], V=[batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="3001.49" y="-7743.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer2_v_proj&#45;&gt;layer2_attn_out -->
<g id="edge65" class="edge">
<title>layer2_v_proj&#45;&gt;layer2_attn_out</title>
<path fill="none" stroke="black" d="M2760.74,-7986.64C2760.74,-7986.64 2760.74,-7799.17 2760.74,-7799.17"/>
<polygon fill="black" stroke="black" points="2764.24,-7799.17 2760.74,-7789.17 2757.24,-7799.17 2764.24,-7799.17"/>
</g>
<!-- layer2_attn_weights -->
<g id="node41" class="node">
<title>layer2_attn_weights</title>
<polygon fill="lightblue" stroke="black" points="3485.49,-7879 3029.49,-7879 3029.49,-7826 3485.49,-7826 3485.49,-7879"/>
<text text-anchor="middle" x="3257.49" y="-7863.8" font-family="Times,serif" font-size="14.00">Softmax (Attention)</text>
<text text-anchor="middle" x="3257.49" y="-7848.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
<text text-anchor="middle" x="3257.49" y="-7833.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
</g>
<!-- layer2_attn_scores&#45;&gt;layer2_attn_weights -->
<g id="edge63" class="edge">
<title>layer2_attn_scores&#45;&gt;layer2_attn_weights</title>
<path fill="none" stroke="black" d="M3257.74,-7915.98C3257.74,-7915.98 3257.74,-7889.14 3257.74,-7889.14"/>
<polygon fill="black" stroke="black" points="3261.24,-7889.14 3257.74,-7879.14 3254.24,-7889.14 3261.24,-7889.14"/>
</g>
<!-- layer2_attn_weights&#45;&gt;layer2_attn_out -->
<g id="edge64" class="edge">
<title>layer2_attn_weights&#45;&gt;layer2_attn_out</title>
<path fill="none" stroke="black" d="M3239.49,-7825.98C3239.49,-7825.98 3239.49,-7799.14 3239.49,-7799.14"/>
<polygon fill="black" stroke="black" points="3242.99,-7799.14 3239.49,-7789.14 3235.99,-7799.14 3242.99,-7799.14"/>
</g>
<!-- layer2_attn_proj -->
<g id="node43" class="node">
<title>layer2_attn_proj</title>
<polygon fill="lightblue" stroke="black" points="2967.99,-7699 2552.99,-7699 2552.99,-7646 2967.99,-7646 2967.99,-7699"/>
<text text-anchor="middle" x="2760.49" y="-7683.8" font-family="Times,serif" font-size="14.00">Attention Output Projection</text>
<text text-anchor="middle" x="2760.49" y="-7668.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="2760.49" y="-7653.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer2_attn_out&#45;&gt;layer2_attn_proj -->
<g id="edge66" class="edge">
<title>layer2_attn_out&#45;&gt;layer2_attn_proj</title>
<path fill="none" stroke="black" d="M2760.74,-7735.98C2760.74,-7735.98 2760.74,-7709.14 2760.74,-7709.14"/>
<polygon fill="black" stroke="black" points="2764.24,-7709.14 2760.74,-7699.14 2757.24,-7709.14 2764.24,-7709.14"/>
</g>
<!-- layer2_attn_proj&#45;&gt;layer2_residual_attn -->
<g id="edge68" class="edge">
<title>layer2_attn_proj&#45;&gt;layer2_residual_attn</title>
<path fill="none" stroke="black" d="M2760.49,-7645.77C2760.49,-7645.77 2760.49,-7619.24 2760.49,-7619.24"/>
<polygon fill="black" stroke="black" points="2763.99,-7619.24 2760.49,-7609.24 2756.99,-7619.24 2763.99,-7619.24"/>
</g>
<!-- layer2_ln_moe -->
<g id="node45" class="node">
<title>layer2_ln_moe</title>
<polygon fill="lightblue" stroke="black" points="2966.99,-7466 2553.99,-7466 2553.99,-7413 2966.99,-7413 2966.99,-7466"/>
<text text-anchor="middle" x="2760.49" y="-7450.8" font-family="Times,serif" font-size="14.00">LayerNorm (MoE)</text>
<text text-anchor="middle" x="2760.49" y="-7435.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2760.49" y="-7420.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer2_residual_attn&#45;&gt;layer2_ln_moe -->
<g id="edge69" class="edge">
<title>layer2_residual_attn&#45;&gt;layer2_ln_moe</title>
<path fill="none" stroke="black" d="M2760.49,-7502.86C2760.49,-7502.86 2760.49,-7476.17 2760.49,-7476.17"/>
<polygon fill="black" stroke="black" points="2763.99,-7476.17 2760.49,-7466.17 2756.99,-7476.17 2763.99,-7476.17"/>
</g>
<!-- layer2_residual_moe -->
<g id="node52" class="node">
<title>layer2_residual_moe</title>
<polygon fill="yellow" stroke="black" points="3300.97,-6986 2067.35,-6986 1750.01,-6880 2983.63,-6880 3300.97,-6986"/>
<text text-anchor="middle" x="2525.49" y="-6944.3" font-family="Times,serif" font-size="14.00">Residual Add (MoE)</text>
<text text-anchor="middle" x="2525.49" y="-6929.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024], [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2525.49" y="-6914.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer2_residual_attn&#45;&gt;layer2_residual_moe -->
<g id="edge83" class="edge">
<title>layer2_residual_attn&#45;&gt;layer2_residual_moe</title>
<path fill="none" stroke="black" d="M2151.64,-7502.88C2151.64,-7502.88 2151.64,-6996.42 2151.64,-6996.42"/>
<polygon fill="black" stroke="black" points="2155.14,-6996.42 2151.64,-6986.42 2148.14,-6996.42 2155.14,-6996.42"/>
</g>
<!-- layer2_gate -->
<g id="node46" class="node">
<title>layer2_gate</title>
<polygon fill="yellow" stroke="black" points="4132.47,-7376 3470.74,-7376 3300.52,-7270 3962.24,-7270 4132.47,-7376"/>
<text text-anchor="middle" x="3716.49" y="-7334.3" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="3716.49" y="-7319.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3716.49" y="-7304.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, experts=4]</text>
</g>
<!-- layer2_ln_moe&#45;&gt;layer2_gate -->
<g id="edge70" class="edge">
<title>layer2_ln_moe&#45;&gt;layer2_gate</title>
<path fill="none" stroke="black" d="M2952.99,-7412.77C2952.99,-7378.38 2952.99,-7323 2952.99,-7323 2952.99,-7323 3375.49,-7323 3375.49,-7323"/>
<polygon fill="black" stroke="black" points="3375.5,-7326.5 3385.49,-7323 3375.49,-7319.5 3375.5,-7326.5"/>
</g>
<!-- layer2_expert0 -->
<g id="node47" class="node">
<title>layer2_expert0</title>
<polygon fill="lightblue" stroke="black" points="3323.99,-7219 2910.99,-7219 2910.99,-7166 3323.99,-7166 3323.99,-7219"/>
<text text-anchor="middle" x="3117.49" y="-7203.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="3117.49" y="-7188.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3117.49" y="-7173.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer2_ln_moe&#45;&gt;layer2_expert0 -->
<g id="edge72" class="edge">
<title>layer2_ln_moe&#45;&gt;layer2_expert0</title>
<path fill="none" stroke="black" d="M2924.99,-7412.6C2924.99,-7412.6 2924.99,-7229.37 2924.99,-7229.37"/>
<polygon fill="black" stroke="black" points="2928.49,-7229.37 2924.99,-7219.37 2921.49,-7229.37 2928.49,-7229.37"/>
</g>
<!-- layer2_expert1 -->
<g id="node48" class="node">
<title>layer2_expert1</title>
<polygon fill="lightblue" stroke="black" points="3754.99,-7219 3341.99,-7219 3341.99,-7166 3754.99,-7166 3754.99,-7219"/>
<text text-anchor="middle" x="3548.49" y="-7203.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3548.49" y="-7188.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3548.49" y="-7173.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer2_ln_moe&#45;&gt;layer2_expert1 -->
<g id="edge74" class="edge">
<title>layer2_ln_moe&#45;&gt;layer2_expert1</title>
<path fill="none" stroke="black" d="M2938.99,-7412.73C2938.99,-7359.18 2938.99,-7244 2938.99,-7244 2938.99,-7244 3479.66,-7244 3479.66,-7244 3479.66,-7244 3479.66,-7229.16 3479.66,-7229.16"/>
<polygon fill="black" stroke="black" points="3483.16,-7229.16 3479.66,-7219.16 3476.16,-7229.16 3483.16,-7229.16"/>
</g>
<!-- layer2_expert2 -->
<g id="node49" class="node">
<title>layer2_expert2</title>
<polygon fill="lightblue" stroke="black" points="4185.99,-7219 3772.99,-7219 3772.99,-7166 4185.99,-7166 4185.99,-7219"/>
<text text-anchor="middle" x="3979.49" y="-7203.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3979.49" y="-7188.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3979.49" y="-7173.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer2_ln_moe&#45;&gt;layer2_expert2 -->
<g id="edge76" class="edge">
<title>layer2_ln_moe&#45;&gt;layer2_expert2</title>
<path fill="none" stroke="black" d="M2967.24,-7430C3356.43,-7430 4159.11,-7430 4159.11,-7430 4159.11,-7430 4159.11,-7229.28 4159.11,-7229.28"/>
<polygon fill="black" stroke="black" points="4162.61,-7229.28 4159.11,-7219.28 4155.61,-7229.28 4162.61,-7229.28"/>
</g>
<!-- layer2_expert3 -->
<g id="node50" class="node">
<title>layer2_expert3</title>
<polygon fill="lightblue" stroke="black" points="4616.99,-7219 4203.99,-7219 4203.99,-7166 4616.99,-7166 4616.99,-7219"/>
<text text-anchor="middle" x="4410.49" y="-7203.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="4410.49" y="-7188.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="4410.49" y="-7173.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer2_ln_moe&#45;&gt;layer2_expert3 -->
<g id="edge78" class="edge">
<title>layer2_ln_moe&#45;&gt;layer2_expert3</title>
<path fill="none" stroke="black" d="M2967.4,-7448C3424.32,-7448 4479.32,-7448 4479.32,-7448 4479.32,-7448 4479.32,-7229.36 4479.32,-7229.36"/>
<polygon fill="black" stroke="black" points="4482.82,-7229.36 4479.32,-7219.36 4475.82,-7229.36 4482.82,-7229.36"/>
</g>
<!-- layer2_gate&#45;&gt;layer2_expert0 -->
<g id="edge71" class="edge">
<title>layer2_gate&#45;&gt;layer2_expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3312.37,-7322.91C3312.37,-7322.91 3312.37,-7229.11 3312.37,-7229.11"/>
<polygon fill="black" stroke="black" points="3315.87,-7229.11 3312.37,-7219.11 3308.87,-7229.11 3315.87,-7229.11"/>
<text text-anchor="middle" x="3203.99" y="-7240.8" font-family="Times,serif" font-size="14.00">select expert 0</text>
</g>
<!-- layer2_gate&#45;&gt;layer2_expert1 -->
<g id="edge73" class="edge">
<title>layer2_gate&#45;&gt;layer2_expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3617.32,-7269.92C3617.32,-7269.92 3617.32,-7229.07 3617.32,-7229.07"/>
<polygon fill="black" stroke="black" points="3620.82,-7229.07 3617.32,-7219.07 3613.82,-7229.07 3620.82,-7229.07"/>
<text text-anchor="middle" x="3685.99" y="-7240.8" font-family="Times,serif" font-size="14.00">select expert 1</text>
</g>
<!-- layer2_gate&#45;&gt;layer2_expert2 -->
<g id="edge75" class="edge">
<title>layer2_gate&#45;&gt;layer2_expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3952.61,-7269.92C3952.61,-7269.92 3952.61,-7229.07 3952.61,-7229.07"/>
<polygon fill="black" stroke="black" points="3956.11,-7229.07 3952.61,-7219.07 3949.11,-7229.07 3956.11,-7229.07"/>
<text text-anchor="middle" x="3918.99" y="-7240.8" font-family="Times,serif" font-size="14.00">select expert 2</text>
</g>
<!-- layer2_gate&#45;&gt;layer2_expert3 -->
<g id="edge77" class="edge">
<title>layer2_gate&#45;&gt;layer2_expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4047.38,-7323C4197.34,-7323 4341.66,-7323 4341.66,-7323 4341.66,-7323 4341.66,-7229.22 4341.66,-7229.22"/>
<polygon fill="black" stroke="black" points="4345.16,-7229.22 4341.66,-7219.22 4338.16,-7229.22 4345.16,-7229.22"/>
<text text-anchor="middle" x="4091.99" y="-7240.8" font-family="Times,serif" font-size="14.00">select expert 3</text>
</g>
<!-- layer2_expert_agg -->
<g id="node51" class="node">
<title>layer2_expert_agg</title>
<polygon fill="yellow" stroke="black" points="6119.92,-7129 3282.88,-7129 2553.06,-7023 5390.1,-7023 6119.92,-7129"/>
<text text-anchor="middle" x="4336.49" y="-7087.3" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="4336.49" y="-7072.3" font-family="Times,serif" font-size="14.00">Input: Expert0=[batch_size=8, seq_len=256, token_dim=1024], Expert1=[batch_size=8, seq_len=256, token_dim=1024], Expert2=[batch_size=8, seq_len=256, token_dim=1024], Expert3=[batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="4336.49" y="-7057.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer2_expert0&#45;&gt;layer2_expert_agg -->
<g id="edge79" class="edge">
<title>layer2_expert0&#45;&gt;layer2_expert_agg</title>
<path fill="none" stroke="black" d="M3117.49,-7165.77C3117.49,-7165.77 3117.49,-7115.05 3117.49,-7115.05"/>
<polygon fill="black" stroke="black" points="3120.99,-7115.05 3117.49,-7105.05 3113.99,-7115.05 3120.99,-7115.05"/>
</g>
<!-- layer2_expert1&#45;&gt;layer2_expert_agg -->
<g id="edge80" class="edge">
<title>layer2_expert1&#45;&gt;layer2_expert_agg</title>
<path fill="none" stroke="black" d="M3548.49,-7165.77C3548.49,-7165.77 3548.49,-7139.24 3548.49,-7139.24"/>
<polygon fill="black" stroke="black" points="3551.99,-7139.24 3548.49,-7129.24 3544.99,-7139.24 3551.99,-7139.24"/>
</g>
<!-- layer2_expert2&#45;&gt;layer2_expert_agg -->
<g id="edge81" class="edge">
<title>layer2_expert2&#45;&gt;layer2_expert_agg</title>
<path fill="none" stroke="black" d="M3979.49,-7165.77C3979.49,-7165.77 3979.49,-7139.24 3979.49,-7139.24"/>
<polygon fill="black" stroke="black" points="3982.99,-7139.24 3979.49,-7129.24 3975.99,-7139.24 3982.99,-7139.24"/>
</g>
<!-- layer2_expert3&#45;&gt;layer2_expert_agg -->
<g id="edge82" class="edge">
<title>layer2_expert3&#45;&gt;layer2_expert_agg</title>
<path fill="none" stroke="black" d="M4410.49,-7165.77C4410.49,-7165.77 4410.49,-7139.24 4410.49,-7139.24"/>
<polygon fill="black" stroke="black" points="4413.99,-7139.24 4410.49,-7129.24 4406.99,-7139.24 4413.99,-7139.24"/>
</g>
<!-- layer2_expert_agg&#45;&gt;layer2_residual_moe -->
<g id="edge84" class="edge">
<title>layer2_expert_agg&#45;&gt;layer2_residual_moe</title>
<path fill="none" stroke="black" d="M2927.13,-7022.75C2927.13,-7022.75 2927.13,-6996.29 2927.13,-6996.29"/>
<polygon fill="black" stroke="black" points="2930.63,-6996.29 2927.13,-6986.29 2923.63,-6996.29 2930.63,-6996.29"/>
</g>
<!-- layer3_ln_attn -->
<g id="node53" class="node">
<title>layer3_ln_attn</title>
<polygon fill="lightblue" stroke="black" points="2731.99,-6843 2318.99,-6843 2318.99,-6790 2731.99,-6790 2731.99,-6843"/>
<text text-anchor="middle" x="2525.49" y="-6827.8" font-family="Times,serif" font-size="14.00">LayerNorm (Attention)</text>
<text text-anchor="middle" x="2525.49" y="-6812.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2525.49" y="-6797.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer2_residual_moe&#45;&gt;layer3_ln_attn -->
<g id="edge85" class="edge">
<title>layer2_residual_moe&#45;&gt;layer3_ln_attn</title>
<path fill="none" stroke="black" d="M2525.49,-6879.86C2525.49,-6879.86 2525.49,-6853.17 2525.49,-6853.17"/>
<polygon fill="black" stroke="black" points="2528.99,-6853.17 2525.49,-6843.17 2521.99,-6853.17 2528.99,-6853.17"/>
</g>
<!-- layer3_q_proj -->
<g id="node54" class="node">
<title>layer3_q_proj</title>
<polygon fill="lightblue" stroke="black" points="2859.99,-6753 2432.99,-6753 2432.99,-6700 2859.99,-6700 2859.99,-6753"/>
<text text-anchor="middle" x="2646.49" y="-6737.8" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="2646.49" y="-6722.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2646.49" y="-6707.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer3_ln_attn&#45;&gt;layer3_q_proj -->
<g id="edge86" class="edge">
<title>layer3_ln_attn&#45;&gt;layer3_q_proj</title>
<path fill="none" stroke="black" d="M2582.49,-6789.98C2582.49,-6789.98 2582.49,-6763.14 2582.49,-6763.14"/>
<polygon fill="black" stroke="black" points="2585.99,-6763.14 2582.49,-6753.14 2578.99,-6763.14 2585.99,-6763.14"/>
</g>
<!-- layer3_k_proj -->
<g id="node55" class="node">
<title>layer3_k_proj</title>
<polygon fill="lightblue" stroke="black" points="3304.99,-6753 2877.99,-6753 2877.99,-6700 3304.99,-6700 3304.99,-6753"/>
<text text-anchor="middle" x="3091.49" y="-6737.8" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="3091.49" y="-6722.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3091.49" y="-6707.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer3_ln_attn&#45;&gt;layer3_k_proj -->
<g id="edge87" class="edge">
<title>layer3_ln_attn&#45;&gt;layer3_k_proj</title>
<path fill="none" stroke="black" d="M2732.3,-6816C2893.26,-6816 3089.49,-6816 3089.49,-6816 3089.49,-6816 3089.49,-6763.35 3089.49,-6763.35"/>
<polygon fill="black" stroke="black" points="3092.99,-6763.35 3089.49,-6753.35 3085.99,-6763.35 3092.99,-6763.35"/>
</g>
<!-- layer3_v_proj -->
<g id="node56" class="node">
<title>layer3_v_proj</title>
<polygon fill="lightblue" stroke="black" points="2617.99,-6682 2190.99,-6682 2190.99,-6629 2617.99,-6629 2617.99,-6682"/>
<text text-anchor="middle" x="2404.49" y="-6666.8" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="2404.49" y="-6651.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2404.49" y="-6636.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer3_ln_attn&#45;&gt;layer3_v_proj -->
<g id="edge88" class="edge">
<title>layer3_ln_attn&#45;&gt;layer3_v_proj</title>
<path fill="none" stroke="black" d="M2375.99,-6789.91C2375.99,-6789.91 2375.99,-6692.13 2375.99,-6692.13"/>
<polygon fill="black" stroke="black" points="2379.49,-6692.13 2375.99,-6682.13 2372.49,-6692.13 2379.49,-6692.13"/>
</g>
<!-- layer3_residual_attn -->
<g id="node61" class="node">
<title>layer3_residual_attn</title>
<polygon fill="yellow" stroke="black" points="2950.97,-6251 1717.35,-6251 1400.01,-6145 2633.63,-6145 2950.97,-6251"/>
<text text-anchor="middle" x="2175.49" y="-6209.3" font-family="Times,serif" font-size="14.00">Residual Add (Attention)</text>
<text text-anchor="middle" x="2175.49" y="-6194.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024], [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2175.49" y="-6179.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer3_ln_attn&#45;&gt;layer3_residual_attn -->
<g id="edge95" class="edge">
<title>layer3_ln_attn&#45;&gt;layer3_residual_attn</title>
<path fill="none" stroke="black" d="M2318.83,-6816C2161.04,-6816 1970.5,-6816 1970.5,-6816 1970.5,-6816 1970.5,-6261.23 1970.5,-6261.23"/>
<polygon fill="black" stroke="black" points="1974,-6261.23 1970.5,-6251.23 1967,-6261.23 1974,-6261.23"/>
</g>
<!-- layer3_attn_scores -->
<g id="node57" class="node">
<title>layer3_attn_scores</title>
<polygon fill="lightblue" stroke="black" points="3500.99,-6611 2679.99,-6611 2679.99,-6558 3500.99,-6558 3500.99,-6611"/>
<text text-anchor="middle" x="3090.49" y="-6595.8" font-family="Times,serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="3090.49" y="-6580.8" font-family="Times,serif" font-size="14.00">Input: Q=[batch_size=8, seq_len=256, heads=8, d_k=128], K=[batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="3090.49" y="-6565.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
</g>
<!-- layer3_q_proj&#45;&gt;layer3_attn_scores -->
<g id="edge89" class="edge">
<title>layer3_q_proj&#45;&gt;layer3_attn_scores</title>
<path fill="none" stroke="black" d="M2769.99,-6699.79C2769.99,-6699.79 2769.99,-6621.09 2769.99,-6621.09"/>
<polygon fill="black" stroke="black" points="2773.49,-6621.09 2769.99,-6611.09 2766.49,-6621.09 2773.49,-6621.09"/>
</g>
<!-- layer3_k_proj&#45;&gt;layer3_attn_scores -->
<g id="edge90" class="edge">
<title>layer3_k_proj&#45;&gt;layer3_attn_scores</title>
<path fill="none" stroke="black" d="M3091.49,-6699.79C3091.49,-6699.79 3091.49,-6621.09 3091.49,-6621.09"/>
<polygon fill="black" stroke="black" points="3094.99,-6621.09 3091.49,-6611.09 3087.99,-6621.09 3094.99,-6621.09"/>
</g>
<!-- layer3_attn_out -->
<g id="node59" class="node">
<title>layer3_attn_out</title>
<polygon fill="lightblue" stroke="black" points="3099.49,-6431 2203.49,-6431 2203.49,-6378 3099.49,-6378 3099.49,-6431"/>
<text text-anchor="middle" x="2651.49" y="-6415.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="2651.49" y="-6400.8" font-family="Times,serif" font-size="14.00">Input: Weights=[batch_size=8, heads=8, seq_len=256, seq_len=256], V=[batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="2651.49" y="-6385.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer3_v_proj&#45;&gt;layer3_attn_out -->
<g id="edge93" class="edge">
<title>layer3_v_proj&#45;&gt;layer3_attn_out</title>
<path fill="none" stroke="black" d="M2410.74,-6628.64C2410.74,-6628.64 2410.74,-6441.17 2410.74,-6441.17"/>
<polygon fill="black" stroke="black" points="2414.24,-6441.17 2410.74,-6431.17 2407.24,-6441.17 2414.24,-6441.17"/>
</g>
<!-- layer3_attn_weights -->
<g id="node58" class="node">
<title>layer3_attn_weights</title>
<polygon fill="lightblue" stroke="black" points="3135.49,-6521 2679.49,-6521 2679.49,-6468 3135.49,-6468 3135.49,-6521"/>
<text text-anchor="middle" x="2907.49" y="-6505.8" font-family="Times,serif" font-size="14.00">Softmax (Attention)</text>
<text text-anchor="middle" x="2907.49" y="-6490.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
<text text-anchor="middle" x="2907.49" y="-6475.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
</g>
<!-- layer3_attn_scores&#45;&gt;layer3_attn_weights -->
<g id="edge91" class="edge">
<title>layer3_attn_scores&#45;&gt;layer3_attn_weights</title>
<path fill="none" stroke="black" d="M2907.74,-6557.98C2907.74,-6557.98 2907.74,-6531.14 2907.74,-6531.14"/>
<polygon fill="black" stroke="black" points="2911.24,-6531.14 2907.74,-6521.14 2904.24,-6531.14 2911.24,-6531.14"/>
</g>
<!-- layer3_attn_weights&#45;&gt;layer3_attn_out -->
<g id="edge92" class="edge">
<title>layer3_attn_weights&#45;&gt;layer3_attn_out</title>
<path fill="none" stroke="black" d="M2889.49,-6467.98C2889.49,-6467.98 2889.49,-6441.14 2889.49,-6441.14"/>
<polygon fill="black" stroke="black" points="2892.99,-6441.14 2889.49,-6431.14 2885.99,-6441.14 2892.99,-6441.14"/>
</g>
<!-- layer3_attn_proj -->
<g id="node60" class="node">
<title>layer3_attn_proj</title>
<polygon fill="lightblue" stroke="black" points="2617.99,-6341 2202.99,-6341 2202.99,-6288 2617.99,-6288 2617.99,-6341"/>
<text text-anchor="middle" x="2410.49" y="-6325.8" font-family="Times,serif" font-size="14.00">Attention Output Projection</text>
<text text-anchor="middle" x="2410.49" y="-6310.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="2410.49" y="-6295.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer3_attn_out&#45;&gt;layer3_attn_proj -->
<g id="edge94" class="edge">
<title>layer3_attn_out&#45;&gt;layer3_attn_proj</title>
<path fill="none" stroke="black" d="M2410.74,-6377.98C2410.74,-6377.98 2410.74,-6351.14 2410.74,-6351.14"/>
<polygon fill="black" stroke="black" points="2414.24,-6351.14 2410.74,-6341.14 2407.24,-6351.14 2414.24,-6351.14"/>
</g>
<!-- layer3_attn_proj&#45;&gt;layer3_residual_attn -->
<g id="edge96" class="edge">
<title>layer3_attn_proj&#45;&gt;layer3_residual_attn</title>
<path fill="none" stroke="black" d="M2410.49,-6287.77C2410.49,-6287.77 2410.49,-6261.24 2410.49,-6261.24"/>
<polygon fill="black" stroke="black" points="2413.99,-6261.24 2410.49,-6251.24 2406.99,-6261.24 2413.99,-6261.24"/>
</g>
<!-- layer3_ln_moe -->
<g id="node62" class="node">
<title>layer3_ln_moe</title>
<polygon fill="lightblue" stroke="black" points="2616.99,-6108 2203.99,-6108 2203.99,-6055 2616.99,-6055 2616.99,-6108"/>
<text text-anchor="middle" x="2410.49" y="-6092.8" font-family="Times,serif" font-size="14.00">LayerNorm (MoE)</text>
<text text-anchor="middle" x="2410.49" y="-6077.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2410.49" y="-6062.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer3_residual_attn&#45;&gt;layer3_ln_moe -->
<g id="edge97" class="edge">
<title>layer3_residual_attn&#45;&gt;layer3_ln_moe</title>
<path fill="none" stroke="black" d="M2410.49,-6144.86C2410.49,-6144.86 2410.49,-6118.17 2410.49,-6118.17"/>
<polygon fill="black" stroke="black" points="2413.99,-6118.17 2410.49,-6108.17 2406.99,-6118.17 2413.99,-6118.17"/>
</g>
<!-- layer3_residual_moe -->
<g id="node69" class="node">
<title>layer3_residual_moe</title>
<polygon fill="yellow" stroke="black" points="2950.97,-5628 1717.35,-5628 1400.01,-5522 2633.63,-5522 2950.97,-5628"/>
<text text-anchor="middle" x="2175.49" y="-5586.3" font-family="Times,serif" font-size="14.00">Residual Add (MoE)</text>
<text text-anchor="middle" x="2175.49" y="-5571.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024], [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2175.49" y="-5556.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer3_residual_attn&#45;&gt;layer3_residual_moe -->
<g id="edge111" class="edge">
<title>layer3_residual_attn&#45;&gt;layer3_residual_moe</title>
<path fill="none" stroke="black" d="M1801.64,-6144.88C1801.64,-6144.88 1801.64,-5638.42 1801.64,-5638.42"/>
<polygon fill="black" stroke="black" points="1805.14,-5638.42 1801.64,-5628.42 1798.14,-5638.42 1805.14,-5638.42"/>
</g>
<!-- layer3_gate -->
<g id="node63" class="node">
<title>layer3_gate</title>
<polygon fill="yellow" stroke="black" points="3782.47,-6018 3120.74,-6018 2950.52,-5912 3612.24,-5912 3782.47,-6018"/>
<text text-anchor="middle" x="3366.49" y="-5976.3" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="3366.49" y="-5961.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3366.49" y="-5946.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, experts=4]</text>
</g>
<!-- layer3_ln_moe&#45;&gt;layer3_gate -->
<g id="edge98" class="edge">
<title>layer3_ln_moe&#45;&gt;layer3_gate</title>
<path fill="none" stroke="black" d="M2602.99,-6054.77C2602.99,-6020.38 2602.99,-5965 2602.99,-5965 2602.99,-5965 3025.49,-5965 3025.49,-5965"/>
<polygon fill="black" stroke="black" points="3025.5,-5968.5 3035.49,-5965 3025.49,-5961.5 3025.5,-5968.5"/>
</g>
<!-- layer3_expert0 -->
<g id="node64" class="node">
<title>layer3_expert0</title>
<polygon fill="lightblue" stroke="black" points="2973.99,-5861 2560.99,-5861 2560.99,-5808 2973.99,-5808 2973.99,-5861"/>
<text text-anchor="middle" x="2767.49" y="-5845.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2767.49" y="-5830.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2767.49" y="-5815.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer3_ln_moe&#45;&gt;layer3_expert0 -->
<g id="edge100" class="edge">
<title>layer3_ln_moe&#45;&gt;layer3_expert0</title>
<path fill="none" stroke="black" d="M2574.99,-6054.6C2574.99,-6054.6 2574.99,-5871.37 2574.99,-5871.37"/>
<polygon fill="black" stroke="black" points="2578.49,-5871.37 2574.99,-5861.37 2571.49,-5871.37 2578.49,-5871.37"/>
</g>
<!-- layer3_expert1 -->
<g id="node65" class="node">
<title>layer3_expert1</title>
<polygon fill="lightblue" stroke="black" points="3404.99,-5861 2991.99,-5861 2991.99,-5808 3404.99,-5808 3404.99,-5861"/>
<text text-anchor="middle" x="3198.49" y="-5845.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="3198.49" y="-5830.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3198.49" y="-5815.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer3_ln_moe&#45;&gt;layer3_expert1 -->
<g id="edge102" class="edge">
<title>layer3_ln_moe&#45;&gt;layer3_expert1</title>
<path fill="none" stroke="black" d="M2588.99,-6054.73C2588.99,-6001.18 2588.99,-5886 2588.99,-5886 2588.99,-5886 3129.66,-5886 3129.66,-5886 3129.66,-5886 3129.66,-5871.16 3129.66,-5871.16"/>
<polygon fill="black" stroke="black" points="3133.16,-5871.16 3129.66,-5861.16 3126.16,-5871.16 3133.16,-5871.16"/>
</g>
<!-- layer3_expert2 -->
<g id="node66" class="node">
<title>layer3_expert2</title>
<polygon fill="lightblue" stroke="black" points="3835.99,-5861 3422.99,-5861 3422.99,-5808 3835.99,-5808 3835.99,-5861"/>
<text text-anchor="middle" x="3629.49" y="-5845.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3629.49" y="-5830.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3629.49" y="-5815.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer3_ln_moe&#45;&gt;layer3_expert2 -->
<g id="edge104" class="edge">
<title>layer3_ln_moe&#45;&gt;layer3_expert2</title>
<path fill="none" stroke="black" d="M2617.24,-6072C3006.43,-6072 3809.11,-6072 3809.11,-6072 3809.11,-6072 3809.11,-5871.28 3809.11,-5871.28"/>
<polygon fill="black" stroke="black" points="3812.61,-5871.28 3809.11,-5861.28 3805.61,-5871.28 3812.61,-5871.28"/>
</g>
<!-- layer3_expert3 -->
<g id="node67" class="node">
<title>layer3_expert3</title>
<polygon fill="lightblue" stroke="black" points="4266.99,-5861 3853.99,-5861 3853.99,-5808 4266.99,-5808 4266.99,-5861"/>
<text text-anchor="middle" x="4060.49" y="-5845.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="4060.49" y="-5830.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="4060.49" y="-5815.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer3_ln_moe&#45;&gt;layer3_expert3 -->
<g id="edge106" class="edge">
<title>layer3_ln_moe&#45;&gt;layer3_expert3</title>
<path fill="none" stroke="black" d="M2617.4,-6090C3074.32,-6090 4129.32,-6090 4129.32,-6090 4129.32,-6090 4129.32,-5871.36 4129.32,-5871.36"/>
<polygon fill="black" stroke="black" points="4132.82,-5871.36 4129.32,-5861.36 4125.82,-5871.36 4132.82,-5871.36"/>
</g>
<!-- layer3_gate&#45;&gt;layer3_expert0 -->
<g id="edge99" class="edge">
<title>layer3_gate&#45;&gt;layer3_expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2962.37,-5964.91C2962.37,-5964.91 2962.37,-5871.11 2962.37,-5871.11"/>
<polygon fill="black" stroke="black" points="2965.87,-5871.11 2962.37,-5861.11 2958.87,-5871.11 2965.87,-5871.11"/>
<text text-anchor="middle" x="2853.99" y="-5882.8" font-family="Times,serif" font-size="14.00">select expert 0</text>
</g>
<!-- layer3_gate&#45;&gt;layer3_expert1 -->
<g id="edge101" class="edge">
<title>layer3_gate&#45;&gt;layer3_expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3267.32,-5911.92C3267.32,-5911.92 3267.32,-5871.07 3267.32,-5871.07"/>
<polygon fill="black" stroke="black" points="3270.82,-5871.07 3267.32,-5861.07 3263.82,-5871.07 3270.82,-5871.07"/>
<text text-anchor="middle" x="3335.99" y="-5882.8" font-family="Times,serif" font-size="14.00">select expert 1</text>
</g>
<!-- layer3_gate&#45;&gt;layer3_expert2 -->
<g id="edge103" class="edge">
<title>layer3_gate&#45;&gt;layer3_expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3602.61,-5911.92C3602.61,-5911.92 3602.61,-5871.07 3602.61,-5871.07"/>
<polygon fill="black" stroke="black" points="3606.11,-5871.07 3602.61,-5861.07 3599.11,-5871.07 3606.11,-5871.07"/>
<text text-anchor="middle" x="3568.99" y="-5882.8" font-family="Times,serif" font-size="14.00">select expert 2</text>
</g>
<!-- layer3_gate&#45;&gt;layer3_expert3 -->
<g id="edge105" class="edge">
<title>layer3_gate&#45;&gt;layer3_expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3697.38,-5965C3847.34,-5965 3991.66,-5965 3991.66,-5965 3991.66,-5965 3991.66,-5871.22 3991.66,-5871.22"/>
<polygon fill="black" stroke="black" points="3995.16,-5871.22 3991.66,-5861.22 3988.16,-5871.22 3995.16,-5871.22"/>
<text text-anchor="middle" x="3741.99" y="-5882.8" font-family="Times,serif" font-size="14.00">select expert 3</text>
</g>
<!-- layer3_expert_agg -->
<g id="node68" class="node">
<title>layer3_expert_agg</title>
<polygon fill="yellow" stroke="black" points="5769.92,-5771 2932.88,-5771 2203.06,-5665 5040.1,-5665 5769.92,-5771"/>
<text text-anchor="middle" x="3986.49" y="-5729.3" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="3986.49" y="-5714.3" font-family="Times,serif" font-size="14.00">Input: Expert0=[batch_size=8, seq_len=256, token_dim=1024], Expert1=[batch_size=8, seq_len=256, token_dim=1024], Expert2=[batch_size=8, seq_len=256, token_dim=1024], Expert3=[batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3986.49" y="-5699.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer3_expert0&#45;&gt;layer3_expert_agg -->
<g id="edge107" class="edge">
<title>layer3_expert0&#45;&gt;layer3_expert_agg</title>
<path fill="none" stroke="black" d="M2767.49,-5807.77C2767.49,-5807.77 2767.49,-5757.05 2767.49,-5757.05"/>
<polygon fill="black" stroke="black" points="2770.99,-5757.05 2767.49,-5747.05 2763.99,-5757.05 2770.99,-5757.05"/>
</g>
<!-- layer3_expert1&#45;&gt;layer3_expert_agg -->
<g id="edge108" class="edge">
<title>layer3_expert1&#45;&gt;layer3_expert_agg</title>
<path fill="none" stroke="black" d="M3198.49,-5807.77C3198.49,-5807.77 3198.49,-5781.24 3198.49,-5781.24"/>
<polygon fill="black" stroke="black" points="3201.99,-5781.24 3198.49,-5771.24 3194.99,-5781.24 3201.99,-5781.24"/>
</g>
<!-- layer3_expert2&#45;&gt;layer3_expert_agg -->
<g id="edge109" class="edge">
<title>layer3_expert2&#45;&gt;layer3_expert_agg</title>
<path fill="none" stroke="black" d="M3629.49,-5807.77C3629.49,-5807.77 3629.49,-5781.24 3629.49,-5781.24"/>
<polygon fill="black" stroke="black" points="3632.99,-5781.24 3629.49,-5771.24 3625.99,-5781.24 3632.99,-5781.24"/>
</g>
<!-- layer3_expert3&#45;&gt;layer3_expert_agg -->
<g id="edge110" class="edge">
<title>layer3_expert3&#45;&gt;layer3_expert_agg</title>
<path fill="none" stroke="black" d="M4060.49,-5807.77C4060.49,-5807.77 4060.49,-5781.24 4060.49,-5781.24"/>
<polygon fill="black" stroke="black" points="4063.99,-5781.24 4060.49,-5771.24 4056.99,-5781.24 4063.99,-5781.24"/>
</g>
<!-- layer3_expert_agg&#45;&gt;layer3_residual_moe -->
<g id="edge112" class="edge">
<title>layer3_expert_agg&#45;&gt;layer3_residual_moe</title>
<path fill="none" stroke="black" d="M2577.13,-5664.75C2577.13,-5664.75 2577.13,-5638.29 2577.13,-5638.29"/>
<polygon fill="black" stroke="black" points="2580.63,-5638.29 2577.13,-5628.29 2573.63,-5638.29 2580.63,-5638.29"/>
</g>
<!-- layer4_ln_attn -->
<g id="node70" class="node">
<title>layer4_ln_attn</title>
<polygon fill="lightblue" stroke="black" points="2381.99,-5485 1968.99,-5485 1968.99,-5432 2381.99,-5432 2381.99,-5485"/>
<text text-anchor="middle" x="2175.49" y="-5469.8" font-family="Times,serif" font-size="14.00">LayerNorm (Attention)</text>
<text text-anchor="middle" x="2175.49" y="-5454.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2175.49" y="-5439.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer3_residual_moe&#45;&gt;layer4_ln_attn -->
<g id="edge113" class="edge">
<title>layer3_residual_moe&#45;&gt;layer4_ln_attn</title>
<path fill="none" stroke="black" d="M2175.49,-5521.86C2175.49,-5521.86 2175.49,-5495.17 2175.49,-5495.17"/>
<polygon fill="black" stroke="black" points="2178.99,-5495.17 2175.49,-5485.17 2171.99,-5495.17 2178.99,-5495.17"/>
</g>
<!-- layer4_q_proj -->
<g id="node71" class="node">
<title>layer4_q_proj</title>
<polygon fill="lightblue" stroke="black" points="2509.99,-5395 2082.99,-5395 2082.99,-5342 2509.99,-5342 2509.99,-5395"/>
<text text-anchor="middle" x="2296.49" y="-5379.8" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="2296.49" y="-5364.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2296.49" y="-5349.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer4_ln_attn&#45;&gt;layer4_q_proj -->
<g id="edge114" class="edge">
<title>layer4_ln_attn&#45;&gt;layer4_q_proj</title>
<path fill="none" stroke="black" d="M2232.49,-5431.98C2232.49,-5431.98 2232.49,-5405.14 2232.49,-5405.14"/>
<polygon fill="black" stroke="black" points="2235.99,-5405.14 2232.49,-5395.14 2228.99,-5405.14 2235.99,-5405.14"/>
</g>
<!-- layer4_k_proj -->
<g id="node72" class="node">
<title>layer4_k_proj</title>
<polygon fill="lightblue" stroke="black" points="2954.99,-5395 2527.99,-5395 2527.99,-5342 2954.99,-5342 2954.99,-5395"/>
<text text-anchor="middle" x="2741.49" y="-5379.8" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="2741.49" y="-5364.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2741.49" y="-5349.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer4_ln_attn&#45;&gt;layer4_k_proj -->
<g id="edge115" class="edge">
<title>layer4_ln_attn&#45;&gt;layer4_k_proj</title>
<path fill="none" stroke="black" d="M2382.3,-5458C2543.26,-5458 2739.49,-5458 2739.49,-5458 2739.49,-5458 2739.49,-5405.35 2739.49,-5405.35"/>
<polygon fill="black" stroke="black" points="2742.99,-5405.35 2739.49,-5395.35 2735.99,-5405.35 2742.99,-5405.35"/>
</g>
<!-- layer4_v_proj -->
<g id="node73" class="node">
<title>layer4_v_proj</title>
<polygon fill="lightblue" stroke="black" points="2267.99,-5324 1840.99,-5324 1840.99,-5271 2267.99,-5271 2267.99,-5324"/>
<text text-anchor="middle" x="2054.49" y="-5308.8" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="2054.49" y="-5293.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2054.49" y="-5278.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer4_ln_attn&#45;&gt;layer4_v_proj -->
<g id="edge116" class="edge">
<title>layer4_ln_attn&#45;&gt;layer4_v_proj</title>
<path fill="none" stroke="black" d="M2025.99,-5431.91C2025.99,-5431.91 2025.99,-5334.13 2025.99,-5334.13"/>
<polygon fill="black" stroke="black" points="2029.49,-5334.13 2025.99,-5324.13 2022.49,-5334.13 2029.49,-5334.13"/>
</g>
<!-- layer4_residual_attn -->
<g id="node78" class="node">
<title>layer4_residual_attn</title>
<polygon fill="yellow" stroke="black" points="2600.97,-4893 1367.35,-4893 1050.01,-4787 2283.63,-4787 2600.97,-4893"/>
<text text-anchor="middle" x="1825.49" y="-4851.3" font-family="Times,serif" font-size="14.00">Residual Add (Attention)</text>
<text text-anchor="middle" x="1825.49" y="-4836.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024], [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1825.49" y="-4821.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer4_ln_attn&#45;&gt;layer4_residual_attn -->
<g id="edge123" class="edge">
<title>layer4_ln_attn&#45;&gt;layer4_residual_attn</title>
<path fill="none" stroke="black" d="M1968.83,-5458C1811.04,-5458 1620.5,-5458 1620.5,-5458 1620.5,-5458 1620.5,-4903.23 1620.5,-4903.23"/>
<polygon fill="black" stroke="black" points="1624,-4903.23 1620.5,-4893.23 1617,-4903.23 1624,-4903.23"/>
</g>
<!-- layer4_attn_scores -->
<g id="node74" class="node">
<title>layer4_attn_scores</title>
<polygon fill="lightblue" stroke="black" points="3150.99,-5253 2329.99,-5253 2329.99,-5200 3150.99,-5200 3150.99,-5253"/>
<text text-anchor="middle" x="2740.49" y="-5237.8" font-family="Times,serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="2740.49" y="-5222.8" font-family="Times,serif" font-size="14.00">Input: Q=[batch_size=8, seq_len=256, heads=8, d_k=128], K=[batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="2740.49" y="-5207.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
</g>
<!-- layer4_q_proj&#45;&gt;layer4_attn_scores -->
<g id="edge117" class="edge">
<title>layer4_q_proj&#45;&gt;layer4_attn_scores</title>
<path fill="none" stroke="black" d="M2419.99,-5341.79C2419.99,-5341.79 2419.99,-5263.09 2419.99,-5263.09"/>
<polygon fill="black" stroke="black" points="2423.49,-5263.09 2419.99,-5253.09 2416.49,-5263.09 2423.49,-5263.09"/>
</g>
<!-- layer4_k_proj&#45;&gt;layer4_attn_scores -->
<g id="edge118" class="edge">
<title>layer4_k_proj&#45;&gt;layer4_attn_scores</title>
<path fill="none" stroke="black" d="M2741.49,-5341.79C2741.49,-5341.79 2741.49,-5263.09 2741.49,-5263.09"/>
<polygon fill="black" stroke="black" points="2744.99,-5263.09 2741.49,-5253.09 2737.99,-5263.09 2744.99,-5263.09"/>
</g>
<!-- layer4_attn_out -->
<g id="node76" class="node">
<title>layer4_attn_out</title>
<polygon fill="lightblue" stroke="black" points="2749.49,-5073 1853.49,-5073 1853.49,-5020 2749.49,-5020 2749.49,-5073"/>
<text text-anchor="middle" x="2301.49" y="-5057.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="2301.49" y="-5042.8" font-family="Times,serif" font-size="14.00">Input: Weights=[batch_size=8, heads=8, seq_len=256, seq_len=256], V=[batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="2301.49" y="-5027.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer4_v_proj&#45;&gt;layer4_attn_out -->
<g id="edge121" class="edge">
<title>layer4_v_proj&#45;&gt;layer4_attn_out</title>
<path fill="none" stroke="black" d="M2060.74,-5270.64C2060.74,-5270.64 2060.74,-5083.17 2060.74,-5083.17"/>
<polygon fill="black" stroke="black" points="2064.24,-5083.17 2060.74,-5073.17 2057.24,-5083.17 2064.24,-5083.17"/>
</g>
<!-- layer4_attn_weights -->
<g id="node75" class="node">
<title>layer4_attn_weights</title>
<polygon fill="lightblue" stroke="black" points="2785.49,-5163 2329.49,-5163 2329.49,-5110 2785.49,-5110 2785.49,-5163"/>
<text text-anchor="middle" x="2557.49" y="-5147.8" font-family="Times,serif" font-size="14.00">Softmax (Attention)</text>
<text text-anchor="middle" x="2557.49" y="-5132.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
<text text-anchor="middle" x="2557.49" y="-5117.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
</g>
<!-- layer4_attn_scores&#45;&gt;layer4_attn_weights -->
<g id="edge119" class="edge">
<title>layer4_attn_scores&#45;&gt;layer4_attn_weights</title>
<path fill="none" stroke="black" d="M2557.74,-5199.98C2557.74,-5199.98 2557.74,-5173.14 2557.74,-5173.14"/>
<polygon fill="black" stroke="black" points="2561.24,-5173.14 2557.74,-5163.14 2554.24,-5173.14 2561.24,-5173.14"/>
</g>
<!-- layer4_attn_weights&#45;&gt;layer4_attn_out -->
<g id="edge120" class="edge">
<title>layer4_attn_weights&#45;&gt;layer4_attn_out</title>
<path fill="none" stroke="black" d="M2539.49,-5109.98C2539.49,-5109.98 2539.49,-5083.14 2539.49,-5083.14"/>
<polygon fill="black" stroke="black" points="2542.99,-5083.14 2539.49,-5073.14 2535.99,-5083.14 2542.99,-5083.14"/>
</g>
<!-- layer4_attn_proj -->
<g id="node77" class="node">
<title>layer4_attn_proj</title>
<polygon fill="lightblue" stroke="black" points="2267.99,-4983 1852.99,-4983 1852.99,-4930 2267.99,-4930 2267.99,-4983"/>
<text text-anchor="middle" x="2060.49" y="-4967.8" font-family="Times,serif" font-size="14.00">Attention Output Projection</text>
<text text-anchor="middle" x="2060.49" y="-4952.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="2060.49" y="-4937.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer4_attn_out&#45;&gt;layer4_attn_proj -->
<g id="edge122" class="edge">
<title>layer4_attn_out&#45;&gt;layer4_attn_proj</title>
<path fill="none" stroke="black" d="M2060.74,-5019.98C2060.74,-5019.98 2060.74,-4993.14 2060.74,-4993.14"/>
<polygon fill="black" stroke="black" points="2064.24,-4993.14 2060.74,-4983.14 2057.24,-4993.14 2064.24,-4993.14"/>
</g>
<!-- layer4_attn_proj&#45;&gt;layer4_residual_attn -->
<g id="edge124" class="edge">
<title>layer4_attn_proj&#45;&gt;layer4_residual_attn</title>
<path fill="none" stroke="black" d="M2060.49,-4929.77C2060.49,-4929.77 2060.49,-4903.24 2060.49,-4903.24"/>
<polygon fill="black" stroke="black" points="2063.99,-4903.24 2060.49,-4893.24 2056.99,-4903.24 2063.99,-4903.24"/>
</g>
<!-- layer4_ln_moe -->
<g id="node79" class="node">
<title>layer4_ln_moe</title>
<polygon fill="lightblue" stroke="black" points="2266.99,-4750 1853.99,-4750 1853.99,-4697 2266.99,-4697 2266.99,-4750"/>
<text text-anchor="middle" x="2060.49" y="-4734.8" font-family="Times,serif" font-size="14.00">LayerNorm (MoE)</text>
<text text-anchor="middle" x="2060.49" y="-4719.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2060.49" y="-4704.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer4_residual_attn&#45;&gt;layer4_ln_moe -->
<g id="edge125" class="edge">
<title>layer4_residual_attn&#45;&gt;layer4_ln_moe</title>
<path fill="none" stroke="black" d="M2060.49,-4786.86C2060.49,-4786.86 2060.49,-4760.17 2060.49,-4760.17"/>
<polygon fill="black" stroke="black" points="2063.99,-4760.17 2060.49,-4750.17 2056.99,-4760.17 2063.99,-4760.17"/>
</g>
<!-- layer4_residual_moe -->
<g id="node86" class="node">
<title>layer4_residual_moe</title>
<polygon fill="yellow" stroke="black" points="2600.97,-4270 1367.35,-4270 1050.01,-4164 2283.63,-4164 2600.97,-4270"/>
<text text-anchor="middle" x="1825.49" y="-4228.3" font-family="Times,serif" font-size="14.00">Residual Add (MoE)</text>
<text text-anchor="middle" x="1825.49" y="-4213.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024], [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1825.49" y="-4198.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer4_residual_attn&#45;&gt;layer4_residual_moe -->
<g id="edge139" class="edge">
<title>layer4_residual_attn&#45;&gt;layer4_residual_moe</title>
<path fill="none" stroke="black" d="M1451.64,-4786.88C1451.64,-4786.88 1451.64,-4280.42 1451.64,-4280.42"/>
<polygon fill="black" stroke="black" points="1455.14,-4280.42 1451.64,-4270.42 1448.14,-4280.42 1455.14,-4280.42"/>
</g>
<!-- layer4_gate -->
<g id="node80" class="node">
<title>layer4_gate</title>
<polygon fill="yellow" stroke="black" points="3432.47,-4660 2770.74,-4660 2600.52,-4554 3262.24,-4554 3432.47,-4660"/>
<text text-anchor="middle" x="3016.49" y="-4618.3" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="3016.49" y="-4603.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3016.49" y="-4588.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, experts=4]</text>
</g>
<!-- layer4_ln_moe&#45;&gt;layer4_gate -->
<g id="edge126" class="edge">
<title>layer4_ln_moe&#45;&gt;layer4_gate</title>
<path fill="none" stroke="black" d="M2252.99,-4696.77C2252.99,-4662.38 2252.99,-4607 2252.99,-4607 2252.99,-4607 2675.49,-4607 2675.49,-4607"/>
<polygon fill="black" stroke="black" points="2675.5,-4610.5 2685.49,-4607 2675.49,-4603.5 2675.5,-4610.5"/>
</g>
<!-- layer4_expert0 -->
<g id="node81" class="node">
<title>layer4_expert0</title>
<polygon fill="lightblue" stroke="black" points="2623.99,-4503 2210.99,-4503 2210.99,-4450 2623.99,-4450 2623.99,-4503"/>
<text text-anchor="middle" x="2417.49" y="-4487.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2417.49" y="-4472.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2417.49" y="-4457.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer4_ln_moe&#45;&gt;layer4_expert0 -->
<g id="edge128" class="edge">
<title>layer4_ln_moe&#45;&gt;layer4_expert0</title>
<path fill="none" stroke="black" d="M2224.99,-4696.6C2224.99,-4696.6 2224.99,-4513.37 2224.99,-4513.37"/>
<polygon fill="black" stroke="black" points="2228.49,-4513.37 2224.99,-4503.37 2221.49,-4513.37 2228.49,-4513.37"/>
</g>
<!-- layer4_expert1 -->
<g id="node82" class="node">
<title>layer4_expert1</title>
<polygon fill="lightblue" stroke="black" points="3054.99,-4503 2641.99,-4503 2641.99,-4450 3054.99,-4450 3054.99,-4503"/>
<text text-anchor="middle" x="2848.49" y="-4487.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2848.49" y="-4472.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2848.49" y="-4457.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer4_ln_moe&#45;&gt;layer4_expert1 -->
<g id="edge130" class="edge">
<title>layer4_ln_moe&#45;&gt;layer4_expert1</title>
<path fill="none" stroke="black" d="M2238.99,-4696.73C2238.99,-4643.18 2238.99,-4528 2238.99,-4528 2238.99,-4528 2779.66,-4528 2779.66,-4528 2779.66,-4528 2779.66,-4513.16 2779.66,-4513.16"/>
<polygon fill="black" stroke="black" points="2783.16,-4513.16 2779.66,-4503.16 2776.16,-4513.16 2783.16,-4513.16"/>
</g>
<!-- layer4_expert2 -->
<g id="node83" class="node">
<title>layer4_expert2</title>
<polygon fill="lightblue" stroke="black" points="3485.99,-4503 3072.99,-4503 3072.99,-4450 3485.99,-4450 3485.99,-4503"/>
<text text-anchor="middle" x="3279.49" y="-4487.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="3279.49" y="-4472.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3279.49" y="-4457.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer4_ln_moe&#45;&gt;layer4_expert2 -->
<g id="edge132" class="edge">
<title>layer4_ln_moe&#45;&gt;layer4_expert2</title>
<path fill="none" stroke="black" d="M2267.24,-4714C2656.43,-4714 3459.11,-4714 3459.11,-4714 3459.11,-4714 3459.11,-4513.28 3459.11,-4513.28"/>
<polygon fill="black" stroke="black" points="3462.61,-4513.28 3459.11,-4503.28 3455.61,-4513.28 3462.61,-4513.28"/>
</g>
<!-- layer4_expert3 -->
<g id="node84" class="node">
<title>layer4_expert3</title>
<polygon fill="lightblue" stroke="black" points="3916.99,-4503 3503.99,-4503 3503.99,-4450 3916.99,-4450 3916.99,-4503"/>
<text text-anchor="middle" x="3710.49" y="-4487.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3710.49" y="-4472.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3710.49" y="-4457.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer4_ln_moe&#45;&gt;layer4_expert3 -->
<g id="edge134" class="edge">
<title>layer4_ln_moe&#45;&gt;layer4_expert3</title>
<path fill="none" stroke="black" d="M2267.4,-4732C2724.32,-4732 3779.32,-4732 3779.32,-4732 3779.32,-4732 3779.32,-4513.36 3779.32,-4513.36"/>
<polygon fill="black" stroke="black" points="3782.82,-4513.36 3779.32,-4503.36 3775.82,-4513.36 3782.82,-4513.36"/>
</g>
<!-- layer4_gate&#45;&gt;layer4_expert0 -->
<g id="edge127" class="edge">
<title>layer4_gate&#45;&gt;layer4_expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2612.37,-4606.91C2612.37,-4606.91 2612.37,-4513.11 2612.37,-4513.11"/>
<polygon fill="black" stroke="black" points="2615.87,-4513.11 2612.37,-4503.11 2608.87,-4513.11 2615.87,-4513.11"/>
<text text-anchor="middle" x="2503.99" y="-4524.8" font-family="Times,serif" font-size="14.00">select expert 0</text>
</g>
<!-- layer4_gate&#45;&gt;layer4_expert1 -->
<g id="edge129" class="edge">
<title>layer4_gate&#45;&gt;layer4_expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2917.32,-4553.92C2917.32,-4553.92 2917.32,-4513.07 2917.32,-4513.07"/>
<polygon fill="black" stroke="black" points="2920.82,-4513.07 2917.32,-4503.07 2913.82,-4513.07 2920.82,-4513.07"/>
<text text-anchor="middle" x="2985.99" y="-4524.8" font-family="Times,serif" font-size="14.00">select expert 1</text>
</g>
<!-- layer4_gate&#45;&gt;layer4_expert2 -->
<g id="edge131" class="edge">
<title>layer4_gate&#45;&gt;layer4_expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3252.61,-4553.92C3252.61,-4553.92 3252.61,-4513.07 3252.61,-4513.07"/>
<polygon fill="black" stroke="black" points="3256.11,-4513.07 3252.61,-4503.07 3249.11,-4513.07 3256.11,-4513.07"/>
<text text-anchor="middle" x="3218.99" y="-4524.8" font-family="Times,serif" font-size="14.00">select expert 2</text>
</g>
<!-- layer4_gate&#45;&gt;layer4_expert3 -->
<g id="edge133" class="edge">
<title>layer4_gate&#45;&gt;layer4_expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3347.38,-4607C3497.34,-4607 3641.66,-4607 3641.66,-4607 3641.66,-4607 3641.66,-4513.22 3641.66,-4513.22"/>
<polygon fill="black" stroke="black" points="3645.16,-4513.22 3641.66,-4503.22 3638.16,-4513.22 3645.16,-4513.22"/>
<text text-anchor="middle" x="3391.99" y="-4524.8" font-family="Times,serif" font-size="14.00">select expert 3</text>
</g>
<!-- layer4_expert_agg -->
<g id="node85" class="node">
<title>layer4_expert_agg</title>
<polygon fill="yellow" stroke="black" points="5419.92,-4413 2582.88,-4413 1853.06,-4307 4690.1,-4307 5419.92,-4413"/>
<text text-anchor="middle" x="3636.49" y="-4371.3" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="3636.49" y="-4356.3" font-family="Times,serif" font-size="14.00">Input: Expert0=[batch_size=8, seq_len=256, token_dim=1024], Expert1=[batch_size=8, seq_len=256, token_dim=1024], Expert2=[batch_size=8, seq_len=256, token_dim=1024], Expert3=[batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3636.49" y="-4341.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer4_expert0&#45;&gt;layer4_expert_agg -->
<g id="edge135" class="edge">
<title>layer4_expert0&#45;&gt;layer4_expert_agg</title>
<path fill="none" stroke="black" d="M2417.49,-4449.77C2417.49,-4449.77 2417.49,-4399.05 2417.49,-4399.05"/>
<polygon fill="black" stroke="black" points="2420.99,-4399.05 2417.49,-4389.05 2413.99,-4399.05 2420.99,-4399.05"/>
</g>
<!-- layer4_expert1&#45;&gt;layer4_expert_agg -->
<g id="edge136" class="edge">
<title>layer4_expert1&#45;&gt;layer4_expert_agg</title>
<path fill="none" stroke="black" d="M2848.49,-4449.77C2848.49,-4449.77 2848.49,-4423.24 2848.49,-4423.24"/>
<polygon fill="black" stroke="black" points="2851.99,-4423.24 2848.49,-4413.24 2844.99,-4423.24 2851.99,-4423.24"/>
</g>
<!-- layer4_expert2&#45;&gt;layer4_expert_agg -->
<g id="edge137" class="edge">
<title>layer4_expert2&#45;&gt;layer4_expert_agg</title>
<path fill="none" stroke="black" d="M3279.49,-4449.77C3279.49,-4449.77 3279.49,-4423.24 3279.49,-4423.24"/>
<polygon fill="black" stroke="black" points="3282.99,-4423.24 3279.49,-4413.24 3275.99,-4423.24 3282.99,-4423.24"/>
</g>
<!-- layer4_expert3&#45;&gt;layer4_expert_agg -->
<g id="edge138" class="edge">
<title>layer4_expert3&#45;&gt;layer4_expert_agg</title>
<path fill="none" stroke="black" d="M3710.49,-4449.77C3710.49,-4449.77 3710.49,-4423.24 3710.49,-4423.24"/>
<polygon fill="black" stroke="black" points="3713.99,-4423.24 3710.49,-4413.24 3706.99,-4423.24 3713.99,-4423.24"/>
</g>
<!-- layer4_expert_agg&#45;&gt;layer4_residual_moe -->
<g id="edge140" class="edge">
<title>layer4_expert_agg&#45;&gt;layer4_residual_moe</title>
<path fill="none" stroke="black" d="M2227.13,-4306.75C2227.13,-4306.75 2227.13,-4280.29 2227.13,-4280.29"/>
<polygon fill="black" stroke="black" points="2230.63,-4280.29 2227.13,-4270.29 2223.63,-4280.29 2230.63,-4280.29"/>
</g>
<!-- layer5_ln_attn -->
<g id="node87" class="node">
<title>layer5_ln_attn</title>
<polygon fill="lightblue" stroke="black" points="2031.99,-4127 1618.99,-4127 1618.99,-4074 2031.99,-4074 2031.99,-4127"/>
<text text-anchor="middle" x="1825.49" y="-4111.8" font-family="Times,serif" font-size="14.00">LayerNorm (Attention)</text>
<text text-anchor="middle" x="1825.49" y="-4096.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1825.49" y="-4081.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer4_residual_moe&#45;&gt;layer5_ln_attn -->
<g id="edge141" class="edge">
<title>layer4_residual_moe&#45;&gt;layer5_ln_attn</title>
<path fill="none" stroke="black" d="M1825.49,-4163.86C1825.49,-4163.86 1825.49,-4137.17 1825.49,-4137.17"/>
<polygon fill="black" stroke="black" points="1828.99,-4137.17 1825.49,-4127.17 1821.99,-4137.17 1828.99,-4137.17"/>
</g>
<!-- layer5_q_proj -->
<g id="node88" class="node">
<title>layer5_q_proj</title>
<polygon fill="lightblue" stroke="black" points="2159.99,-4037 1732.99,-4037 1732.99,-3984 2159.99,-3984 2159.99,-4037"/>
<text text-anchor="middle" x="1946.49" y="-4021.8" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="1946.49" y="-4006.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1946.49" y="-3991.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer5_ln_attn&#45;&gt;layer5_q_proj -->
<g id="edge142" class="edge">
<title>layer5_ln_attn&#45;&gt;layer5_q_proj</title>
<path fill="none" stroke="black" d="M1882.49,-4073.98C1882.49,-4073.98 1882.49,-4047.14 1882.49,-4047.14"/>
<polygon fill="black" stroke="black" points="1885.99,-4047.14 1882.49,-4037.14 1878.99,-4047.14 1885.99,-4047.14"/>
</g>
<!-- layer5_k_proj -->
<g id="node89" class="node">
<title>layer5_k_proj</title>
<polygon fill="lightblue" stroke="black" points="2604.99,-4037 2177.99,-4037 2177.99,-3984 2604.99,-3984 2604.99,-4037"/>
<text text-anchor="middle" x="2391.49" y="-4021.8" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="2391.49" y="-4006.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2391.49" y="-3991.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer5_ln_attn&#45;&gt;layer5_k_proj -->
<g id="edge143" class="edge">
<title>layer5_ln_attn&#45;&gt;layer5_k_proj</title>
<path fill="none" stroke="black" d="M2032.3,-4100C2193.26,-4100 2389.49,-4100 2389.49,-4100 2389.49,-4100 2389.49,-4047.35 2389.49,-4047.35"/>
<polygon fill="black" stroke="black" points="2392.99,-4047.35 2389.49,-4037.35 2385.99,-4047.35 2392.99,-4047.35"/>
</g>
<!-- layer5_v_proj -->
<g id="node90" class="node">
<title>layer5_v_proj</title>
<polygon fill="lightblue" stroke="black" points="1917.99,-3966 1490.99,-3966 1490.99,-3913 1917.99,-3913 1917.99,-3966"/>
<text text-anchor="middle" x="1704.49" y="-3950.8" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="1704.49" y="-3935.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1704.49" y="-3920.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer5_ln_attn&#45;&gt;layer5_v_proj -->
<g id="edge144" class="edge">
<title>layer5_ln_attn&#45;&gt;layer5_v_proj</title>
<path fill="none" stroke="black" d="M1675.99,-4073.91C1675.99,-4073.91 1675.99,-3976.13 1675.99,-3976.13"/>
<polygon fill="black" stroke="black" points="1679.49,-3976.13 1675.99,-3966.13 1672.49,-3976.13 1679.49,-3976.13"/>
</g>
<!-- layer5_residual_attn -->
<g id="node95" class="node">
<title>layer5_residual_attn</title>
<polygon fill="yellow" stroke="black" points="2250.97,-3535 1017.35,-3535 700.01,-3429 1933.63,-3429 2250.97,-3535"/>
<text text-anchor="middle" x="1475.49" y="-3493.3" font-family="Times,serif" font-size="14.00">Residual Add (Attention)</text>
<text text-anchor="middle" x="1475.49" y="-3478.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024], [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1475.49" y="-3463.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer5_ln_attn&#45;&gt;layer5_residual_attn -->
<g id="edge151" class="edge">
<title>layer5_ln_attn&#45;&gt;layer5_residual_attn</title>
<path fill="none" stroke="black" d="M1618.83,-4100C1461.04,-4100 1270.5,-4100 1270.5,-4100 1270.5,-4100 1270.5,-3545.23 1270.5,-3545.23"/>
<polygon fill="black" stroke="black" points="1274,-3545.23 1270.5,-3535.23 1267,-3545.23 1274,-3545.23"/>
</g>
<!-- layer5_attn_scores -->
<g id="node91" class="node">
<title>layer5_attn_scores</title>
<polygon fill="lightblue" stroke="black" points="2800.99,-3895 1979.99,-3895 1979.99,-3842 2800.99,-3842 2800.99,-3895"/>
<text text-anchor="middle" x="2390.49" y="-3879.8" font-family="Times,serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="2390.49" y="-3864.8" font-family="Times,serif" font-size="14.00">Input: Q=[batch_size=8, seq_len=256, heads=8, d_k=128], K=[batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="2390.49" y="-3849.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
</g>
<!-- layer5_q_proj&#45;&gt;layer5_attn_scores -->
<g id="edge145" class="edge">
<title>layer5_q_proj&#45;&gt;layer5_attn_scores</title>
<path fill="none" stroke="black" d="M2069.99,-3983.79C2069.99,-3983.79 2069.99,-3905.09 2069.99,-3905.09"/>
<polygon fill="black" stroke="black" points="2073.49,-3905.09 2069.99,-3895.09 2066.49,-3905.09 2073.49,-3905.09"/>
</g>
<!-- layer5_k_proj&#45;&gt;layer5_attn_scores -->
<g id="edge146" class="edge">
<title>layer5_k_proj&#45;&gt;layer5_attn_scores</title>
<path fill="none" stroke="black" d="M2391.49,-3983.79C2391.49,-3983.79 2391.49,-3905.09 2391.49,-3905.09"/>
<polygon fill="black" stroke="black" points="2394.99,-3905.09 2391.49,-3895.09 2387.99,-3905.09 2394.99,-3905.09"/>
</g>
<!-- layer5_attn_out -->
<g id="node93" class="node">
<title>layer5_attn_out</title>
<polygon fill="lightblue" stroke="black" points="2399.49,-3715 1503.49,-3715 1503.49,-3662 2399.49,-3662 2399.49,-3715"/>
<text text-anchor="middle" x="1951.49" y="-3699.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="1951.49" y="-3684.8" font-family="Times,serif" font-size="14.00">Input: Weights=[batch_size=8, heads=8, seq_len=256, seq_len=256], V=[batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="1951.49" y="-3669.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer5_v_proj&#45;&gt;layer5_attn_out -->
<g id="edge149" class="edge">
<title>layer5_v_proj&#45;&gt;layer5_attn_out</title>
<path fill="none" stroke="black" d="M1710.74,-3912.64C1710.74,-3912.64 1710.74,-3725.17 1710.74,-3725.17"/>
<polygon fill="black" stroke="black" points="1714.24,-3725.17 1710.74,-3715.17 1707.24,-3725.17 1714.24,-3725.17"/>
</g>
<!-- layer5_attn_weights -->
<g id="node92" class="node">
<title>layer5_attn_weights</title>
<polygon fill="lightblue" stroke="black" points="2435.49,-3805 1979.49,-3805 1979.49,-3752 2435.49,-3752 2435.49,-3805"/>
<text text-anchor="middle" x="2207.49" y="-3789.8" font-family="Times,serif" font-size="14.00">Softmax (Attention)</text>
<text text-anchor="middle" x="2207.49" y="-3774.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
<text text-anchor="middle" x="2207.49" y="-3759.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
</g>
<!-- layer5_attn_scores&#45;&gt;layer5_attn_weights -->
<g id="edge147" class="edge">
<title>layer5_attn_scores&#45;&gt;layer5_attn_weights</title>
<path fill="none" stroke="black" d="M2207.74,-3841.98C2207.74,-3841.98 2207.74,-3815.14 2207.74,-3815.14"/>
<polygon fill="black" stroke="black" points="2211.24,-3815.14 2207.74,-3805.14 2204.24,-3815.14 2211.24,-3815.14"/>
</g>
<!-- layer5_attn_weights&#45;&gt;layer5_attn_out -->
<g id="edge148" class="edge">
<title>layer5_attn_weights&#45;&gt;layer5_attn_out</title>
<path fill="none" stroke="black" d="M2189.49,-3751.98C2189.49,-3751.98 2189.49,-3725.14 2189.49,-3725.14"/>
<polygon fill="black" stroke="black" points="2192.99,-3725.14 2189.49,-3715.14 2185.99,-3725.14 2192.99,-3725.14"/>
</g>
<!-- layer5_attn_proj -->
<g id="node94" class="node">
<title>layer5_attn_proj</title>
<polygon fill="lightblue" stroke="black" points="1917.99,-3625 1502.99,-3625 1502.99,-3572 1917.99,-3572 1917.99,-3625"/>
<text text-anchor="middle" x="1710.49" y="-3609.8" font-family="Times,serif" font-size="14.00">Attention Output Projection</text>
<text text-anchor="middle" x="1710.49" y="-3594.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="1710.49" y="-3579.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer5_attn_out&#45;&gt;layer5_attn_proj -->
<g id="edge150" class="edge">
<title>layer5_attn_out&#45;&gt;layer5_attn_proj</title>
<path fill="none" stroke="black" d="M1710.74,-3661.98C1710.74,-3661.98 1710.74,-3635.14 1710.74,-3635.14"/>
<polygon fill="black" stroke="black" points="1714.24,-3635.14 1710.74,-3625.14 1707.24,-3635.14 1714.24,-3635.14"/>
</g>
<!-- layer5_attn_proj&#45;&gt;layer5_residual_attn -->
<g id="edge152" class="edge">
<title>layer5_attn_proj&#45;&gt;layer5_residual_attn</title>
<path fill="none" stroke="black" d="M1710.49,-3571.77C1710.49,-3571.77 1710.49,-3545.24 1710.49,-3545.24"/>
<polygon fill="black" stroke="black" points="1713.99,-3545.24 1710.49,-3535.24 1706.99,-3545.24 1713.99,-3545.24"/>
</g>
<!-- layer5_ln_moe -->
<g id="node96" class="node">
<title>layer5_ln_moe</title>
<polygon fill="lightblue" stroke="black" points="1916.99,-3392 1503.99,-3392 1503.99,-3339 1916.99,-3339 1916.99,-3392"/>
<text text-anchor="middle" x="1710.49" y="-3376.8" font-family="Times,serif" font-size="14.00">LayerNorm (MoE)</text>
<text text-anchor="middle" x="1710.49" y="-3361.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1710.49" y="-3346.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer5_residual_attn&#45;&gt;layer5_ln_moe -->
<g id="edge153" class="edge">
<title>layer5_residual_attn&#45;&gt;layer5_ln_moe</title>
<path fill="none" stroke="black" d="M1710.49,-3428.86C1710.49,-3428.86 1710.49,-3402.17 1710.49,-3402.17"/>
<polygon fill="black" stroke="black" points="1713.99,-3402.17 1710.49,-3392.17 1706.99,-3402.17 1713.99,-3402.17"/>
</g>
<!-- layer5_residual_moe -->
<g id="node103" class="node">
<title>layer5_residual_moe</title>
<polygon fill="yellow" stroke="black" points="2250.97,-2912 1017.35,-2912 700.01,-2806 1933.63,-2806 2250.97,-2912"/>
<text text-anchor="middle" x="1475.49" y="-2870.3" font-family="Times,serif" font-size="14.00">Residual Add (MoE)</text>
<text text-anchor="middle" x="1475.49" y="-2855.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024], [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1475.49" y="-2840.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer5_residual_attn&#45;&gt;layer5_residual_moe -->
<g id="edge167" class="edge">
<title>layer5_residual_attn&#45;&gt;layer5_residual_moe</title>
<path fill="none" stroke="black" d="M1101.64,-3428.88C1101.64,-3428.88 1101.64,-2922.42 1101.64,-2922.42"/>
<polygon fill="black" stroke="black" points="1105.14,-2922.42 1101.64,-2912.42 1098.14,-2922.42 1105.14,-2922.42"/>
</g>
<!-- layer5_gate -->
<g id="node97" class="node">
<title>layer5_gate</title>
<polygon fill="yellow" stroke="black" points="3082.47,-3302 2420.74,-3302 2250.52,-3196 2912.24,-3196 3082.47,-3302"/>
<text text-anchor="middle" x="2666.49" y="-3260.3" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="2666.49" y="-3245.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2666.49" y="-3230.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, experts=4]</text>
</g>
<!-- layer5_ln_moe&#45;&gt;layer5_gate -->
<g id="edge154" class="edge">
<title>layer5_ln_moe&#45;&gt;layer5_gate</title>
<path fill="none" stroke="black" d="M1902.99,-3338.77C1902.99,-3304.38 1902.99,-3249 1902.99,-3249 1902.99,-3249 2325.49,-3249 2325.49,-3249"/>
<polygon fill="black" stroke="black" points="2325.5,-3252.5 2335.49,-3249 2325.49,-3245.5 2325.5,-3252.5"/>
</g>
<!-- layer5_expert0 -->
<g id="node98" class="node">
<title>layer5_expert0</title>
<polygon fill="lightblue" stroke="black" points="2273.99,-3145 1860.99,-3145 1860.99,-3092 2273.99,-3092 2273.99,-3145"/>
<text text-anchor="middle" x="2067.49" y="-3129.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="2067.49" y="-3114.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2067.49" y="-3099.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer5_ln_moe&#45;&gt;layer5_expert0 -->
<g id="edge156" class="edge">
<title>layer5_ln_moe&#45;&gt;layer5_expert0</title>
<path fill="none" stroke="black" d="M1874.99,-3338.6C1874.99,-3338.6 1874.99,-3155.37 1874.99,-3155.37"/>
<polygon fill="black" stroke="black" points="1878.49,-3155.37 1874.99,-3145.37 1871.49,-3155.37 1878.49,-3155.37"/>
</g>
<!-- layer5_expert1 -->
<g id="node99" class="node">
<title>layer5_expert1</title>
<polygon fill="lightblue" stroke="black" points="2704.99,-3145 2291.99,-3145 2291.99,-3092 2704.99,-3092 2704.99,-3145"/>
<text text-anchor="middle" x="2498.49" y="-3129.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2498.49" y="-3114.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2498.49" y="-3099.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer5_ln_moe&#45;&gt;layer5_expert1 -->
<g id="edge158" class="edge">
<title>layer5_ln_moe&#45;&gt;layer5_expert1</title>
<path fill="none" stroke="black" d="M1888.99,-3338.73C1888.99,-3285.18 1888.99,-3170 1888.99,-3170 1888.99,-3170 2429.66,-3170 2429.66,-3170 2429.66,-3170 2429.66,-3155.16 2429.66,-3155.16"/>
<polygon fill="black" stroke="black" points="2433.16,-3155.16 2429.66,-3145.16 2426.16,-3155.16 2433.16,-3155.16"/>
</g>
<!-- layer5_expert2 -->
<g id="node100" class="node">
<title>layer5_expert2</title>
<polygon fill="lightblue" stroke="black" points="3135.99,-3145 2722.99,-3145 2722.99,-3092 3135.99,-3092 3135.99,-3145"/>
<text text-anchor="middle" x="2929.49" y="-3129.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2929.49" y="-3114.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2929.49" y="-3099.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer5_ln_moe&#45;&gt;layer5_expert2 -->
<g id="edge160" class="edge">
<title>layer5_ln_moe&#45;&gt;layer5_expert2</title>
<path fill="none" stroke="black" d="M1917.24,-3356C2306.43,-3356 3109.11,-3356 3109.11,-3356 3109.11,-3356 3109.11,-3155.28 3109.11,-3155.28"/>
<polygon fill="black" stroke="black" points="3112.61,-3155.28 3109.11,-3145.28 3105.61,-3155.28 3112.61,-3155.28"/>
</g>
<!-- layer5_expert3 -->
<g id="node101" class="node">
<title>layer5_expert3</title>
<polygon fill="lightblue" stroke="black" points="3566.99,-3145 3153.99,-3145 3153.99,-3092 3566.99,-3092 3566.99,-3145"/>
<text text-anchor="middle" x="3360.49" y="-3129.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3360.49" y="-3114.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3360.49" y="-3099.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer5_ln_moe&#45;&gt;layer5_expert3 -->
<g id="edge162" class="edge">
<title>layer5_ln_moe&#45;&gt;layer5_expert3</title>
<path fill="none" stroke="black" d="M1917.4,-3374C2374.32,-3374 3429.32,-3374 3429.32,-3374 3429.32,-3374 3429.32,-3155.36 3429.32,-3155.36"/>
<polygon fill="black" stroke="black" points="3432.82,-3155.36 3429.32,-3145.36 3425.82,-3155.36 3432.82,-3155.36"/>
</g>
<!-- layer5_gate&#45;&gt;layer5_expert0 -->
<g id="edge155" class="edge">
<title>layer5_gate&#45;&gt;layer5_expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2262.37,-3248.91C2262.37,-3248.91 2262.37,-3155.11 2262.37,-3155.11"/>
<polygon fill="black" stroke="black" points="2265.87,-3155.11 2262.37,-3145.11 2258.87,-3155.11 2265.87,-3155.11"/>
<text text-anchor="middle" x="2153.99" y="-3166.8" font-family="Times,serif" font-size="14.00">select expert 0</text>
</g>
<!-- layer5_gate&#45;&gt;layer5_expert1 -->
<g id="edge157" class="edge">
<title>layer5_gate&#45;&gt;layer5_expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2567.32,-3195.92C2567.32,-3195.92 2567.32,-3155.07 2567.32,-3155.07"/>
<polygon fill="black" stroke="black" points="2570.82,-3155.07 2567.32,-3145.07 2563.82,-3155.07 2570.82,-3155.07"/>
<text text-anchor="middle" x="2611.99" y="-3166.8" font-family="Times,serif" font-size="14.00">select expert 1</text>
</g>
<!-- layer5_gate&#45;&gt;layer5_expert2 -->
<g id="edge159" class="edge">
<title>layer5_gate&#45;&gt;layer5_expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2902.61,-3195.92C2902.61,-3195.92 2902.61,-3155.07 2902.61,-3155.07"/>
<polygon fill="black" stroke="black" points="2906.11,-3155.07 2902.61,-3145.07 2899.11,-3155.07 2906.11,-3155.07"/>
<text text-anchor="middle" x="2802.99" y="-3166.8" font-family="Times,serif" font-size="14.00">select expert 2</text>
</g>
<!-- layer5_gate&#45;&gt;layer5_expert3 -->
<g id="edge161" class="edge">
<title>layer5_gate&#45;&gt;layer5_expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2997.38,-3249C3147.34,-3249 3291.66,-3249 3291.66,-3249 3291.66,-3249 3291.66,-3155.22 3291.66,-3155.22"/>
<polygon fill="black" stroke="black" points="3295.16,-3155.22 3291.66,-3145.22 3288.16,-3155.22 3295.16,-3155.22"/>
<text text-anchor="middle" x="3041.99" y="-3166.8" font-family="Times,serif" font-size="14.00">select expert 3</text>
</g>
<!-- layer5_expert_agg -->
<g id="node102" class="node">
<title>layer5_expert_agg</title>
<polygon fill="yellow" stroke="black" points="5069.92,-3055 2232.88,-3055 1503.06,-2949 4340.1,-2949 5069.92,-3055"/>
<text text-anchor="middle" x="3286.49" y="-3013.3" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="3286.49" y="-2998.3" font-family="Times,serif" font-size="14.00">Input: Expert0=[batch_size=8, seq_len=256, token_dim=1024], Expert1=[batch_size=8, seq_len=256, token_dim=1024], Expert2=[batch_size=8, seq_len=256, token_dim=1024], Expert3=[batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3286.49" y="-2983.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer5_expert0&#45;&gt;layer5_expert_agg -->
<g id="edge163" class="edge">
<title>layer5_expert0&#45;&gt;layer5_expert_agg</title>
<path fill="none" stroke="black" d="M2067.49,-3091.77C2067.49,-3091.77 2067.49,-3041.05 2067.49,-3041.05"/>
<polygon fill="black" stroke="black" points="2070.99,-3041.05 2067.49,-3031.05 2063.99,-3041.05 2070.99,-3041.05"/>
</g>
<!-- layer5_expert1&#45;&gt;layer5_expert_agg -->
<g id="edge164" class="edge">
<title>layer5_expert1&#45;&gt;layer5_expert_agg</title>
<path fill="none" stroke="black" d="M2498.49,-3091.77C2498.49,-3091.77 2498.49,-3065.24 2498.49,-3065.24"/>
<polygon fill="black" stroke="black" points="2501.99,-3065.24 2498.49,-3055.24 2494.99,-3065.24 2501.99,-3065.24"/>
</g>
<!-- layer5_expert2&#45;&gt;layer5_expert_agg -->
<g id="edge165" class="edge">
<title>layer5_expert2&#45;&gt;layer5_expert_agg</title>
<path fill="none" stroke="black" d="M2929.49,-3091.77C2929.49,-3091.77 2929.49,-3065.24 2929.49,-3065.24"/>
<polygon fill="black" stroke="black" points="2932.99,-3065.24 2929.49,-3055.24 2925.99,-3065.24 2932.99,-3065.24"/>
</g>
<!-- layer5_expert3&#45;&gt;layer5_expert_agg -->
<g id="edge166" class="edge">
<title>layer5_expert3&#45;&gt;layer5_expert_agg</title>
<path fill="none" stroke="black" d="M3360.49,-3091.77C3360.49,-3091.77 3360.49,-3065.24 3360.49,-3065.24"/>
<polygon fill="black" stroke="black" points="3363.99,-3065.24 3360.49,-3055.24 3356.99,-3065.24 3363.99,-3065.24"/>
</g>
<!-- layer5_expert_agg&#45;&gt;layer5_residual_moe -->
<g id="edge168" class="edge">
<title>layer5_expert_agg&#45;&gt;layer5_residual_moe</title>
<path fill="none" stroke="black" d="M1877.13,-2948.75C1877.13,-2948.75 1877.13,-2922.29 1877.13,-2922.29"/>
<polygon fill="black" stroke="black" points="1880.63,-2922.29 1877.13,-2912.29 1873.63,-2922.29 1880.63,-2922.29"/>
</g>
<!-- layer6_ln_attn -->
<g id="node104" class="node">
<title>layer6_ln_attn</title>
<polygon fill="lightblue" stroke="black" points="1681.99,-2769 1268.99,-2769 1268.99,-2716 1681.99,-2716 1681.99,-2769"/>
<text text-anchor="middle" x="1475.49" y="-2753.8" font-family="Times,serif" font-size="14.00">LayerNorm (Attention)</text>
<text text-anchor="middle" x="1475.49" y="-2738.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1475.49" y="-2723.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer5_residual_moe&#45;&gt;layer6_ln_attn -->
<g id="edge169" class="edge">
<title>layer5_residual_moe&#45;&gt;layer6_ln_attn</title>
<path fill="none" stroke="black" d="M1475.49,-2805.86C1475.49,-2805.86 1475.49,-2779.17 1475.49,-2779.17"/>
<polygon fill="black" stroke="black" points="1478.99,-2779.17 1475.49,-2769.17 1471.99,-2779.17 1478.99,-2779.17"/>
</g>
<!-- layer6_q_proj -->
<g id="node105" class="node">
<title>layer6_q_proj</title>
<polygon fill="lightblue" stroke="black" points="1809.99,-2679 1382.99,-2679 1382.99,-2626 1809.99,-2626 1809.99,-2679"/>
<text text-anchor="middle" x="1596.49" y="-2663.8" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="1596.49" y="-2648.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1596.49" y="-2633.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer6_ln_attn&#45;&gt;layer6_q_proj -->
<g id="edge170" class="edge">
<title>layer6_ln_attn&#45;&gt;layer6_q_proj</title>
<path fill="none" stroke="black" d="M1532.49,-2715.98C1532.49,-2715.98 1532.49,-2689.14 1532.49,-2689.14"/>
<polygon fill="black" stroke="black" points="1535.99,-2689.14 1532.49,-2679.14 1528.99,-2689.14 1535.99,-2689.14"/>
</g>
<!-- layer6_k_proj -->
<g id="node106" class="node">
<title>layer6_k_proj</title>
<polygon fill="lightblue" stroke="black" points="2254.99,-2679 1827.99,-2679 1827.99,-2626 2254.99,-2626 2254.99,-2679"/>
<text text-anchor="middle" x="2041.49" y="-2663.8" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="2041.49" y="-2648.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2041.49" y="-2633.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer6_ln_attn&#45;&gt;layer6_k_proj -->
<g id="edge171" class="edge">
<title>layer6_ln_attn&#45;&gt;layer6_k_proj</title>
<path fill="none" stroke="black" d="M1682.3,-2742C1843.26,-2742 2039.49,-2742 2039.49,-2742 2039.49,-2742 2039.49,-2689.35 2039.49,-2689.35"/>
<polygon fill="black" stroke="black" points="2042.99,-2689.35 2039.49,-2679.35 2035.99,-2689.35 2042.99,-2689.35"/>
</g>
<!-- layer6_v_proj -->
<g id="node107" class="node">
<title>layer6_v_proj</title>
<polygon fill="lightblue" stroke="black" points="1567.99,-2608 1140.99,-2608 1140.99,-2555 1567.99,-2555 1567.99,-2608"/>
<text text-anchor="middle" x="1354.49" y="-2592.8" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="1354.49" y="-2577.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1354.49" y="-2562.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer6_ln_attn&#45;&gt;layer6_v_proj -->
<g id="edge172" class="edge">
<title>layer6_ln_attn&#45;&gt;layer6_v_proj</title>
<path fill="none" stroke="black" d="M1325.99,-2715.91C1325.99,-2715.91 1325.99,-2618.13 1325.99,-2618.13"/>
<polygon fill="black" stroke="black" points="1329.49,-2618.13 1325.99,-2608.13 1322.49,-2618.13 1329.49,-2618.13"/>
</g>
<!-- layer6_residual_attn -->
<g id="node112" class="node">
<title>layer6_residual_attn</title>
<polygon fill="yellow" stroke="black" points="1900.97,-2177 667.35,-2177 350.01,-2071 1583.63,-2071 1900.97,-2177"/>
<text text-anchor="middle" x="1125.49" y="-2135.3" font-family="Times,serif" font-size="14.00">Residual Add (Attention)</text>
<text text-anchor="middle" x="1125.49" y="-2120.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024], [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1125.49" y="-2105.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer6_ln_attn&#45;&gt;layer6_residual_attn -->
<g id="edge179" class="edge">
<title>layer6_ln_attn&#45;&gt;layer6_residual_attn</title>
<path fill="none" stroke="black" d="M1268.83,-2742C1111.04,-2742 920.5,-2742 920.5,-2742 920.5,-2742 920.5,-2187.23 920.5,-2187.23"/>
<polygon fill="black" stroke="black" points="924,-2187.23 920.5,-2177.23 917,-2187.23 924,-2187.23"/>
</g>
<!-- layer6_attn_scores -->
<g id="node108" class="node">
<title>layer6_attn_scores</title>
<polygon fill="lightblue" stroke="black" points="2450.99,-2537 1629.99,-2537 1629.99,-2484 2450.99,-2484 2450.99,-2537"/>
<text text-anchor="middle" x="2040.49" y="-2521.8" font-family="Times,serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="2040.49" y="-2506.8" font-family="Times,serif" font-size="14.00">Input: Q=[batch_size=8, seq_len=256, heads=8, d_k=128], K=[batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="2040.49" y="-2491.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
</g>
<!-- layer6_q_proj&#45;&gt;layer6_attn_scores -->
<g id="edge173" class="edge">
<title>layer6_q_proj&#45;&gt;layer6_attn_scores</title>
<path fill="none" stroke="black" d="M1719.99,-2625.79C1719.99,-2625.79 1719.99,-2547.09 1719.99,-2547.09"/>
<polygon fill="black" stroke="black" points="1723.49,-2547.09 1719.99,-2537.09 1716.49,-2547.09 1723.49,-2547.09"/>
</g>
<!-- layer6_k_proj&#45;&gt;layer6_attn_scores -->
<g id="edge174" class="edge">
<title>layer6_k_proj&#45;&gt;layer6_attn_scores</title>
<path fill="none" stroke="black" d="M2041.49,-2625.79C2041.49,-2625.79 2041.49,-2547.09 2041.49,-2547.09"/>
<polygon fill="black" stroke="black" points="2044.99,-2547.09 2041.49,-2537.09 2037.99,-2547.09 2044.99,-2547.09"/>
</g>
<!-- layer6_attn_out -->
<g id="node110" class="node">
<title>layer6_attn_out</title>
<polygon fill="lightblue" stroke="black" points="2049.49,-2357 1153.49,-2357 1153.49,-2304 2049.49,-2304 2049.49,-2357"/>
<text text-anchor="middle" x="1601.49" y="-2341.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="1601.49" y="-2326.8" font-family="Times,serif" font-size="14.00">Input: Weights=[batch_size=8, heads=8, seq_len=256, seq_len=256], V=[batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="1601.49" y="-2311.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer6_v_proj&#45;&gt;layer6_attn_out -->
<g id="edge177" class="edge">
<title>layer6_v_proj&#45;&gt;layer6_attn_out</title>
<path fill="none" stroke="black" d="M1360.74,-2554.64C1360.74,-2554.64 1360.74,-2367.17 1360.74,-2367.17"/>
<polygon fill="black" stroke="black" points="1364.24,-2367.17 1360.74,-2357.17 1357.24,-2367.17 1364.24,-2367.17"/>
</g>
<!-- layer6_attn_weights -->
<g id="node109" class="node">
<title>layer6_attn_weights</title>
<polygon fill="lightblue" stroke="black" points="2085.49,-2447 1629.49,-2447 1629.49,-2394 2085.49,-2394 2085.49,-2447"/>
<text text-anchor="middle" x="1857.49" y="-2431.8" font-family="Times,serif" font-size="14.00">Softmax (Attention)</text>
<text text-anchor="middle" x="1857.49" y="-2416.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
<text text-anchor="middle" x="1857.49" y="-2401.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
</g>
<!-- layer6_attn_scores&#45;&gt;layer6_attn_weights -->
<g id="edge175" class="edge">
<title>layer6_attn_scores&#45;&gt;layer6_attn_weights</title>
<path fill="none" stroke="black" d="M1857.74,-2483.98C1857.74,-2483.98 1857.74,-2457.14 1857.74,-2457.14"/>
<polygon fill="black" stroke="black" points="1861.24,-2457.14 1857.74,-2447.14 1854.24,-2457.14 1861.24,-2457.14"/>
</g>
<!-- layer6_attn_weights&#45;&gt;layer6_attn_out -->
<g id="edge176" class="edge">
<title>layer6_attn_weights&#45;&gt;layer6_attn_out</title>
<path fill="none" stroke="black" d="M1839.49,-2393.98C1839.49,-2393.98 1839.49,-2367.14 1839.49,-2367.14"/>
<polygon fill="black" stroke="black" points="1842.99,-2367.14 1839.49,-2357.14 1835.99,-2367.14 1842.99,-2367.14"/>
</g>
<!-- layer6_attn_proj -->
<g id="node111" class="node">
<title>layer6_attn_proj</title>
<polygon fill="lightblue" stroke="black" points="1567.99,-2267 1152.99,-2267 1152.99,-2214 1567.99,-2214 1567.99,-2267"/>
<text text-anchor="middle" x="1360.49" y="-2251.8" font-family="Times,serif" font-size="14.00">Attention Output Projection</text>
<text text-anchor="middle" x="1360.49" y="-2236.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="1360.49" y="-2221.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer6_attn_out&#45;&gt;layer6_attn_proj -->
<g id="edge178" class="edge">
<title>layer6_attn_out&#45;&gt;layer6_attn_proj</title>
<path fill="none" stroke="black" d="M1360.74,-2303.98C1360.74,-2303.98 1360.74,-2277.14 1360.74,-2277.14"/>
<polygon fill="black" stroke="black" points="1364.24,-2277.14 1360.74,-2267.14 1357.24,-2277.14 1364.24,-2277.14"/>
</g>
<!-- layer6_attn_proj&#45;&gt;layer6_residual_attn -->
<g id="edge180" class="edge">
<title>layer6_attn_proj&#45;&gt;layer6_residual_attn</title>
<path fill="none" stroke="black" d="M1360.49,-2213.77C1360.49,-2213.77 1360.49,-2187.24 1360.49,-2187.24"/>
<polygon fill="black" stroke="black" points="1363.99,-2187.24 1360.49,-2177.24 1356.99,-2187.24 1363.99,-2187.24"/>
</g>
<!-- layer6_ln_moe -->
<g id="node113" class="node">
<title>layer6_ln_moe</title>
<polygon fill="lightblue" stroke="black" points="1566.99,-2034 1153.99,-2034 1153.99,-1981 1566.99,-1981 1566.99,-2034"/>
<text text-anchor="middle" x="1360.49" y="-2018.8" font-family="Times,serif" font-size="14.00">LayerNorm (MoE)</text>
<text text-anchor="middle" x="1360.49" y="-2003.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1360.49" y="-1988.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer6_residual_attn&#45;&gt;layer6_ln_moe -->
<g id="edge181" class="edge">
<title>layer6_residual_attn&#45;&gt;layer6_ln_moe</title>
<path fill="none" stroke="black" d="M1360.49,-2070.86C1360.49,-2070.86 1360.49,-2044.17 1360.49,-2044.17"/>
<polygon fill="black" stroke="black" points="1363.99,-2044.17 1360.49,-2034.17 1356.99,-2044.17 1363.99,-2044.17"/>
</g>
<!-- layer6_residual_moe -->
<g id="node120" class="node">
<title>layer6_residual_moe</title>
<polygon fill="yellow" stroke="black" points="1900.97,-1554 667.35,-1554 350.01,-1448 1583.63,-1448 1900.97,-1554"/>
<text text-anchor="middle" x="1125.49" y="-1512.3" font-family="Times,serif" font-size="14.00">Residual Add (MoE)</text>
<text text-anchor="middle" x="1125.49" y="-1497.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024], [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1125.49" y="-1482.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer6_residual_attn&#45;&gt;layer6_residual_moe -->
<g id="edge195" class="edge">
<title>layer6_residual_attn&#45;&gt;layer6_residual_moe</title>
<path fill="none" stroke="black" d="M751.64,-2070.88C751.64,-2070.88 751.64,-1564.42 751.64,-1564.42"/>
<polygon fill="black" stroke="black" points="755.14,-1564.42 751.64,-1554.42 748.14,-1564.42 755.14,-1564.42"/>
</g>
<!-- layer6_gate -->
<g id="node114" class="node">
<title>layer6_gate</title>
<polygon fill="yellow" stroke="black" points="2732.47,-1944 2070.74,-1944 1900.52,-1838 2562.24,-1838 2732.47,-1944"/>
<text text-anchor="middle" x="2316.49" y="-1902.3" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="2316.49" y="-1887.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2316.49" y="-1872.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, experts=4]</text>
</g>
<!-- layer6_ln_moe&#45;&gt;layer6_gate -->
<g id="edge182" class="edge">
<title>layer6_ln_moe&#45;&gt;layer6_gate</title>
<path fill="none" stroke="black" d="M1552.99,-1980.77C1552.99,-1946.38 1552.99,-1891 1552.99,-1891 1552.99,-1891 1975.49,-1891 1975.49,-1891"/>
<polygon fill="black" stroke="black" points="1975.5,-1894.5 1985.49,-1891 1975.49,-1887.5 1975.5,-1894.5"/>
</g>
<!-- layer6_expert0 -->
<g id="node115" class="node">
<title>layer6_expert0</title>
<polygon fill="lightblue" stroke="black" points="1923.99,-1787 1510.99,-1787 1510.99,-1734 1923.99,-1734 1923.99,-1787"/>
<text text-anchor="middle" x="1717.49" y="-1771.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1717.49" y="-1756.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1717.49" y="-1741.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer6_ln_moe&#45;&gt;layer6_expert0 -->
<g id="edge184" class="edge">
<title>layer6_ln_moe&#45;&gt;layer6_expert0</title>
<path fill="none" stroke="black" d="M1524.99,-1980.6C1524.99,-1980.6 1524.99,-1797.37 1524.99,-1797.37"/>
<polygon fill="black" stroke="black" points="1528.49,-1797.37 1524.99,-1787.37 1521.49,-1797.37 1528.49,-1797.37"/>
</g>
<!-- layer6_expert1 -->
<g id="node116" class="node">
<title>layer6_expert1</title>
<polygon fill="lightblue" stroke="black" points="2354.99,-1787 1941.99,-1787 1941.99,-1734 2354.99,-1734 2354.99,-1787"/>
<text text-anchor="middle" x="2148.49" y="-1771.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="2148.49" y="-1756.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2148.49" y="-1741.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer6_ln_moe&#45;&gt;layer6_expert1 -->
<g id="edge186" class="edge">
<title>layer6_ln_moe&#45;&gt;layer6_expert1</title>
<path fill="none" stroke="black" d="M1538.99,-1980.73C1538.99,-1927.18 1538.99,-1812 1538.99,-1812 1538.99,-1812 2079.66,-1812 2079.66,-1812 2079.66,-1812 2079.66,-1797.16 2079.66,-1797.16"/>
<polygon fill="black" stroke="black" points="2083.16,-1797.16 2079.66,-1787.16 2076.16,-1797.16 2083.16,-1797.16"/>
</g>
<!-- layer6_expert2 -->
<g id="node117" class="node">
<title>layer6_expert2</title>
<polygon fill="lightblue" stroke="black" points="2785.99,-1787 2372.99,-1787 2372.99,-1734 2785.99,-1734 2785.99,-1787"/>
<text text-anchor="middle" x="2579.49" y="-1771.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2579.49" y="-1756.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2579.49" y="-1741.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer6_ln_moe&#45;&gt;layer6_expert2 -->
<g id="edge188" class="edge">
<title>layer6_ln_moe&#45;&gt;layer6_expert2</title>
<path fill="none" stroke="black" d="M1567.24,-1998C1956.43,-1998 2759.11,-1998 2759.11,-1998 2759.11,-1998 2759.11,-1797.28 2759.11,-1797.28"/>
<polygon fill="black" stroke="black" points="2762.61,-1797.28 2759.11,-1787.28 2755.61,-1797.28 2762.61,-1797.28"/>
</g>
<!-- layer6_expert3 -->
<g id="node118" class="node">
<title>layer6_expert3</title>
<polygon fill="lightblue" stroke="black" points="3216.99,-1787 2803.99,-1787 2803.99,-1734 3216.99,-1734 3216.99,-1787"/>
<text text-anchor="middle" x="3010.49" y="-1771.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="3010.49" y="-1756.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="3010.49" y="-1741.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer6_ln_moe&#45;&gt;layer6_expert3 -->
<g id="edge190" class="edge">
<title>layer6_ln_moe&#45;&gt;layer6_expert3</title>
<path fill="none" stroke="black" d="M1567.4,-2016C2024.32,-2016 3079.32,-2016 3079.32,-2016 3079.32,-2016 3079.32,-1797.36 3079.32,-1797.36"/>
<polygon fill="black" stroke="black" points="3082.82,-1797.36 3079.32,-1787.36 3075.82,-1797.36 3082.82,-1797.36"/>
</g>
<!-- layer6_gate&#45;&gt;layer6_expert0 -->
<g id="edge183" class="edge">
<title>layer6_gate&#45;&gt;layer6_expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1912.37,-1890.91C1912.37,-1890.91 1912.37,-1797.11 1912.37,-1797.11"/>
<polygon fill="black" stroke="black" points="1915.87,-1797.11 1912.37,-1787.11 1908.87,-1797.11 1915.87,-1797.11"/>
<text text-anchor="middle" x="1803.99" y="-1808.8" font-family="Times,serif" font-size="14.00">select expert 0</text>
</g>
<!-- layer6_gate&#45;&gt;layer6_expert1 -->
<g id="edge185" class="edge">
<title>layer6_gate&#45;&gt;layer6_expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2217.32,-1837.92C2217.32,-1837.92 2217.32,-1797.07 2217.32,-1797.07"/>
<polygon fill="black" stroke="black" points="2220.82,-1797.07 2217.32,-1787.07 2213.82,-1797.07 2220.82,-1797.07"/>
<text text-anchor="middle" x="2294.99" y="-1808.8" font-family="Times,serif" font-size="14.00">select expert 1</text>
</g>
<!-- layer6_gate&#45;&gt;layer6_expert2 -->
<g id="edge187" class="edge">
<title>layer6_gate&#45;&gt;layer6_expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2552.61,-1837.92C2552.61,-1837.92 2552.61,-1797.07 2552.61,-1797.07"/>
<polygon fill="black" stroke="black" points="2556.11,-1797.07 2552.61,-1787.07 2549.11,-1797.07 2556.11,-1797.07"/>
<text text-anchor="middle" x="2443.99" y="-1808.8" font-family="Times,serif" font-size="14.00">select expert 2</text>
</g>
<!-- layer6_gate&#45;&gt;layer6_expert3 -->
<g id="edge189" class="edge">
<title>layer6_gate&#45;&gt;layer6_expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2647.38,-1891C2797.34,-1891 2941.66,-1891 2941.66,-1891 2941.66,-1891 2941.66,-1797.22 2941.66,-1797.22"/>
<polygon fill="black" stroke="black" points="2945.16,-1797.22 2941.66,-1787.22 2938.16,-1797.22 2945.16,-1797.22"/>
<text text-anchor="middle" x="2691.99" y="-1808.8" font-family="Times,serif" font-size="14.00">select expert 3</text>
</g>
<!-- layer6_expert_agg -->
<g id="node119" class="node">
<title>layer6_expert_agg</title>
<polygon fill="yellow" stroke="black" points="4719.92,-1697 1882.88,-1697 1153.06,-1591 3990.1,-1591 4719.92,-1697"/>
<text text-anchor="middle" x="2936.49" y="-1655.3" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="2936.49" y="-1640.3" font-family="Times,serif" font-size="14.00">Input: Expert0=[batch_size=8, seq_len=256, token_dim=1024], Expert1=[batch_size=8, seq_len=256, token_dim=1024], Expert2=[batch_size=8, seq_len=256, token_dim=1024], Expert3=[batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2936.49" y="-1625.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer6_expert0&#45;&gt;layer6_expert_agg -->
<g id="edge191" class="edge">
<title>layer6_expert0&#45;&gt;layer6_expert_agg</title>
<path fill="none" stroke="black" d="M1717.49,-1733.77C1717.49,-1733.77 1717.49,-1683.05 1717.49,-1683.05"/>
<polygon fill="black" stroke="black" points="1720.99,-1683.05 1717.49,-1673.05 1713.99,-1683.05 1720.99,-1683.05"/>
</g>
<!-- layer6_expert1&#45;&gt;layer6_expert_agg -->
<g id="edge192" class="edge">
<title>layer6_expert1&#45;&gt;layer6_expert_agg</title>
<path fill="none" stroke="black" d="M2148.49,-1733.77C2148.49,-1733.77 2148.49,-1707.24 2148.49,-1707.24"/>
<polygon fill="black" stroke="black" points="2151.99,-1707.24 2148.49,-1697.24 2144.99,-1707.24 2151.99,-1707.24"/>
</g>
<!-- layer6_expert2&#45;&gt;layer6_expert_agg -->
<g id="edge193" class="edge">
<title>layer6_expert2&#45;&gt;layer6_expert_agg</title>
<path fill="none" stroke="black" d="M2579.49,-1733.77C2579.49,-1733.77 2579.49,-1707.24 2579.49,-1707.24"/>
<polygon fill="black" stroke="black" points="2582.99,-1707.24 2579.49,-1697.24 2575.99,-1707.24 2582.99,-1707.24"/>
</g>
<!-- layer6_expert3&#45;&gt;layer6_expert_agg -->
<g id="edge194" class="edge">
<title>layer6_expert3&#45;&gt;layer6_expert_agg</title>
<path fill="none" stroke="black" d="M3010.49,-1733.77C3010.49,-1733.77 3010.49,-1707.24 3010.49,-1707.24"/>
<polygon fill="black" stroke="black" points="3013.99,-1707.24 3010.49,-1697.24 3006.99,-1707.24 3013.99,-1707.24"/>
</g>
<!-- layer6_expert_agg&#45;&gt;layer6_residual_moe -->
<g id="edge196" class="edge">
<title>layer6_expert_agg&#45;&gt;layer6_residual_moe</title>
<path fill="none" stroke="black" d="M1527.13,-1590.75C1527.13,-1590.75 1527.13,-1564.29 1527.13,-1564.29"/>
<polygon fill="black" stroke="black" points="1530.63,-1564.29 1527.13,-1554.29 1523.63,-1564.29 1530.63,-1564.29"/>
</g>
<!-- layer7_ln_attn -->
<g id="node121" class="node">
<title>layer7_ln_attn</title>
<polygon fill="lightblue" stroke="black" points="1331.99,-1411 918.99,-1411 918.99,-1358 1331.99,-1358 1331.99,-1411"/>
<text text-anchor="middle" x="1125.49" y="-1395.8" font-family="Times,serif" font-size="14.00">LayerNorm (Attention)</text>
<text text-anchor="middle" x="1125.49" y="-1380.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1125.49" y="-1365.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer6_residual_moe&#45;&gt;layer7_ln_attn -->
<g id="edge197" class="edge">
<title>layer6_residual_moe&#45;&gt;layer7_ln_attn</title>
<path fill="none" stroke="black" d="M1125.49,-1447.86C1125.49,-1447.86 1125.49,-1421.17 1125.49,-1421.17"/>
<polygon fill="black" stroke="black" points="1128.99,-1421.17 1125.49,-1411.17 1121.99,-1421.17 1128.99,-1421.17"/>
</g>
<!-- layer7_q_proj -->
<g id="node122" class="node">
<title>layer7_q_proj</title>
<polygon fill="lightblue" stroke="black" points="1459.99,-1321 1032.99,-1321 1032.99,-1268 1459.99,-1268 1459.99,-1321"/>
<text text-anchor="middle" x="1246.49" y="-1305.8" font-family="Times,serif" font-size="14.00">Q Projection</text>
<text text-anchor="middle" x="1246.49" y="-1290.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1246.49" y="-1275.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer7_ln_attn&#45;&gt;layer7_q_proj -->
<g id="edge198" class="edge">
<title>layer7_ln_attn&#45;&gt;layer7_q_proj</title>
<path fill="none" stroke="black" d="M1182.49,-1357.98C1182.49,-1357.98 1182.49,-1331.14 1182.49,-1331.14"/>
<polygon fill="black" stroke="black" points="1185.99,-1331.14 1182.49,-1321.14 1178.99,-1331.14 1185.99,-1331.14"/>
</g>
<!-- layer7_k_proj -->
<g id="node123" class="node">
<title>layer7_k_proj</title>
<polygon fill="lightblue" stroke="black" points="1904.99,-1321 1477.99,-1321 1477.99,-1268 1904.99,-1268 1904.99,-1321"/>
<text text-anchor="middle" x="1691.49" y="-1305.8" font-family="Times,serif" font-size="14.00">K Projection</text>
<text text-anchor="middle" x="1691.49" y="-1290.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1691.49" y="-1275.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer7_ln_attn&#45;&gt;layer7_k_proj -->
<g id="edge199" class="edge">
<title>layer7_ln_attn&#45;&gt;layer7_k_proj</title>
<path fill="none" stroke="black" d="M1332.3,-1384C1493.26,-1384 1689.49,-1384 1689.49,-1384 1689.49,-1384 1689.49,-1331.35 1689.49,-1331.35"/>
<polygon fill="black" stroke="black" points="1692.99,-1331.35 1689.49,-1321.35 1685.99,-1331.35 1692.99,-1331.35"/>
</g>
<!-- layer7_v_proj -->
<g id="node124" class="node">
<title>layer7_v_proj</title>
<polygon fill="lightblue" stroke="black" points="1217.99,-1250 790.99,-1250 790.99,-1197 1217.99,-1197 1217.99,-1250"/>
<text text-anchor="middle" x="1004.49" y="-1234.8" font-family="Times,serif" font-size="14.00">V Projection</text>
<text text-anchor="middle" x="1004.49" y="-1219.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1004.49" y="-1204.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer7_ln_attn&#45;&gt;layer7_v_proj -->
<g id="edge200" class="edge">
<title>layer7_ln_attn&#45;&gt;layer7_v_proj</title>
<path fill="none" stroke="black" d="M975.99,-1357.91C975.99,-1357.91 975.99,-1260.13 975.99,-1260.13"/>
<polygon fill="black" stroke="black" points="979.49,-1260.13 975.99,-1250.13 972.49,-1260.13 979.49,-1260.13"/>
</g>
<!-- layer7_residual_attn -->
<g id="node129" class="node">
<title>layer7_residual_attn</title>
<polygon fill="yellow" stroke="black" points="1550.97,-819 317.35,-819 0.01,-713 1233.63,-713 1550.97,-819"/>
<text text-anchor="middle" x="775.49" y="-777.3" font-family="Times,serif" font-size="14.00">Residual Add (Attention)</text>
<text text-anchor="middle" x="775.49" y="-762.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024], [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="775.49" y="-747.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer7_ln_attn&#45;&gt;layer7_residual_attn -->
<g id="edge207" class="edge">
<title>layer7_ln_attn&#45;&gt;layer7_residual_attn</title>
<path fill="none" stroke="black" d="M918.83,-1384C761.04,-1384 570.5,-1384 570.5,-1384 570.5,-1384 570.5,-829.23 570.5,-829.23"/>
<polygon fill="black" stroke="black" points="574,-829.23 570.5,-819.23 567,-829.23 574,-829.23"/>
</g>
<!-- layer7_attn_scores -->
<g id="node125" class="node">
<title>layer7_attn_scores</title>
<polygon fill="lightblue" stroke="black" points="2100.99,-1179 1279.99,-1179 1279.99,-1126 2100.99,-1126 2100.99,-1179"/>
<text text-anchor="middle" x="1690.49" y="-1163.8" font-family="Times,serif" font-size="14.00">Attention Scores</text>
<text text-anchor="middle" x="1690.49" y="-1148.8" font-family="Times,serif" font-size="14.00">Input: Q=[batch_size=8, seq_len=256, heads=8, d_k=128], K=[batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="1690.49" y="-1133.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
</g>
<!-- layer7_q_proj&#45;&gt;layer7_attn_scores -->
<g id="edge201" class="edge">
<title>layer7_q_proj&#45;&gt;layer7_attn_scores</title>
<path fill="none" stroke="black" d="M1369.99,-1267.79C1369.99,-1267.79 1369.99,-1189.09 1369.99,-1189.09"/>
<polygon fill="black" stroke="black" points="1373.49,-1189.09 1369.99,-1179.09 1366.49,-1189.09 1373.49,-1189.09"/>
</g>
<!-- layer7_k_proj&#45;&gt;layer7_attn_scores -->
<g id="edge202" class="edge">
<title>layer7_k_proj&#45;&gt;layer7_attn_scores</title>
<path fill="none" stroke="black" d="M1691.49,-1267.79C1691.49,-1267.79 1691.49,-1189.09 1691.49,-1189.09"/>
<polygon fill="black" stroke="black" points="1694.99,-1189.09 1691.49,-1179.09 1687.99,-1189.09 1694.99,-1189.09"/>
</g>
<!-- layer7_attn_out -->
<g id="node127" class="node">
<title>layer7_attn_out</title>
<polygon fill="lightblue" stroke="black" points="1699.49,-999 803.49,-999 803.49,-946 1699.49,-946 1699.49,-999"/>
<text text-anchor="middle" x="1251.49" y="-983.8" font-family="Times,serif" font-size="14.00">Attention Output</text>
<text text-anchor="middle" x="1251.49" y="-968.8" font-family="Times,serif" font-size="14.00">Input: Weights=[batch_size=8, heads=8, seq_len=256, seq_len=256], V=[batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="1251.49" y="-953.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
</g>
<!-- layer7_v_proj&#45;&gt;layer7_attn_out -->
<g id="edge205" class="edge">
<title>layer7_v_proj&#45;&gt;layer7_attn_out</title>
<path fill="none" stroke="black" d="M1010.74,-1196.64C1010.74,-1196.64 1010.74,-1009.17 1010.74,-1009.17"/>
<polygon fill="black" stroke="black" points="1014.24,-1009.17 1010.74,-999.17 1007.24,-1009.17 1014.24,-1009.17"/>
</g>
<!-- layer7_attn_weights -->
<g id="node126" class="node">
<title>layer7_attn_weights</title>
<polygon fill="lightblue" stroke="black" points="1735.49,-1089 1279.49,-1089 1279.49,-1036 1735.49,-1036 1735.49,-1089"/>
<text text-anchor="middle" x="1507.49" y="-1073.8" font-family="Times,serif" font-size="14.00">Softmax (Attention)</text>
<text text-anchor="middle" x="1507.49" y="-1058.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
<text text-anchor="middle" x="1507.49" y="-1043.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, heads=8, seq_len=256, seq_len=256]</text>
</g>
<!-- layer7_attn_scores&#45;&gt;layer7_attn_weights -->
<g id="edge203" class="edge">
<title>layer7_attn_scores&#45;&gt;layer7_attn_weights</title>
<path fill="none" stroke="black" d="M1507.74,-1125.98C1507.74,-1125.98 1507.74,-1099.14 1507.74,-1099.14"/>
<polygon fill="black" stroke="black" points="1511.24,-1099.14 1507.74,-1089.14 1504.24,-1099.14 1511.24,-1099.14"/>
</g>
<!-- layer7_attn_weights&#45;&gt;layer7_attn_out -->
<g id="edge204" class="edge">
<title>layer7_attn_weights&#45;&gt;layer7_attn_out</title>
<path fill="none" stroke="black" d="M1489.49,-1035.98C1489.49,-1035.98 1489.49,-1009.14 1489.49,-1009.14"/>
<polygon fill="black" stroke="black" points="1492.99,-1009.14 1489.49,-999.14 1485.99,-1009.14 1492.99,-1009.14"/>
</g>
<!-- layer7_attn_proj -->
<g id="node128" class="node">
<title>layer7_attn_proj</title>
<polygon fill="lightblue" stroke="black" points="1217.99,-909 802.99,-909 802.99,-856 1217.99,-856 1217.99,-909"/>
<text text-anchor="middle" x="1010.49" y="-893.8" font-family="Times,serif" font-size="14.00">Attention Output Projection</text>
<text text-anchor="middle" x="1010.49" y="-878.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, heads=8, d_k=128]</text>
<text text-anchor="middle" x="1010.49" y="-863.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer7_attn_out&#45;&gt;layer7_attn_proj -->
<g id="edge206" class="edge">
<title>layer7_attn_out&#45;&gt;layer7_attn_proj</title>
<path fill="none" stroke="black" d="M1010.74,-945.98C1010.74,-945.98 1010.74,-919.14 1010.74,-919.14"/>
<polygon fill="black" stroke="black" points="1014.24,-919.14 1010.74,-909.14 1007.24,-919.14 1014.24,-919.14"/>
</g>
<!-- layer7_attn_proj&#45;&gt;layer7_residual_attn -->
<g id="edge208" class="edge">
<title>layer7_attn_proj&#45;&gt;layer7_residual_attn</title>
<path fill="none" stroke="black" d="M1010.49,-855.77C1010.49,-855.77 1010.49,-829.24 1010.49,-829.24"/>
<polygon fill="black" stroke="black" points="1013.99,-829.24 1010.49,-819.24 1006.99,-829.24 1013.99,-829.24"/>
</g>
<!-- layer7_ln_moe -->
<g id="node130" class="node">
<title>layer7_ln_moe</title>
<polygon fill="lightblue" stroke="black" points="1216.99,-676 803.99,-676 803.99,-623 1216.99,-623 1216.99,-676"/>
<text text-anchor="middle" x="1010.49" y="-660.8" font-family="Times,serif" font-size="14.00">LayerNorm (MoE)</text>
<text text-anchor="middle" x="1010.49" y="-645.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1010.49" y="-630.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer7_residual_attn&#45;&gt;layer7_ln_moe -->
<g id="edge209" class="edge">
<title>layer7_residual_attn&#45;&gt;layer7_ln_moe</title>
<path fill="none" stroke="black" d="M1010.49,-712.86C1010.49,-712.86 1010.49,-686.17 1010.49,-686.17"/>
<polygon fill="black" stroke="black" points="1013.99,-686.17 1010.49,-676.17 1006.99,-686.17 1013.99,-686.17"/>
</g>
<!-- layer7_residual_moe -->
<g id="node137" class="node">
<title>layer7_residual_moe</title>
<polygon fill="yellow" stroke="black" points="1550.97,-196 317.35,-196 0.01,-90 1233.63,-90 1550.97,-196"/>
<text text-anchor="middle" x="775.49" y="-154.3" font-family="Times,serif" font-size="14.00">Residual Add (MoE)</text>
<text text-anchor="middle" x="775.49" y="-139.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024], [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="775.49" y="-124.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer7_residual_attn&#45;&gt;layer7_residual_moe -->
<g id="edge223" class="edge">
<title>layer7_residual_attn&#45;&gt;layer7_residual_moe</title>
<path fill="none" stroke="black" d="M401.64,-712.88C401.64,-712.88 401.64,-206.42 401.64,-206.42"/>
<polygon fill="black" stroke="black" points="405.14,-206.42 401.64,-196.42 398.14,-206.42 405.14,-206.42"/>
</g>
<!-- layer7_gate -->
<g id="node131" class="node">
<title>layer7_gate</title>
<polygon fill="yellow" stroke="black" points="2382.47,-586 1720.74,-586 1550.52,-480 2212.24,-480 2382.47,-586"/>
<text text-anchor="middle" x="1966.49" y="-544.3" font-family="Times,serif" font-size="14.00">Gate Network</text>
<text text-anchor="middle" x="1966.49" y="-529.3" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1966.49" y="-514.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, experts=4]</text>
</g>
<!-- layer7_ln_moe&#45;&gt;layer7_gate -->
<g id="edge210" class="edge">
<title>layer7_ln_moe&#45;&gt;layer7_gate</title>
<path fill="none" stroke="black" d="M1202.99,-622.77C1202.99,-588.38 1202.99,-533 1202.99,-533 1202.99,-533 1625.49,-533 1625.49,-533"/>
<polygon fill="black" stroke="black" points="1625.5,-536.5 1635.49,-533 1625.49,-529.5 1625.5,-536.5"/>
</g>
<!-- layer7_expert0 -->
<g id="node132" class="node">
<title>layer7_expert0</title>
<polygon fill="lightblue" stroke="black" points="1573.99,-429 1160.99,-429 1160.99,-376 1573.99,-376 1573.99,-429"/>
<text text-anchor="middle" x="1367.49" y="-413.8" font-family="Times,serif" font-size="14.00">Expert 0</text>
<text text-anchor="middle" x="1367.49" y="-398.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1367.49" y="-383.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer7_ln_moe&#45;&gt;layer7_expert0 -->
<g id="edge212" class="edge">
<title>layer7_ln_moe&#45;&gt;layer7_expert0</title>
<path fill="none" stroke="black" d="M1174.99,-622.6C1174.99,-622.6 1174.99,-439.37 1174.99,-439.37"/>
<polygon fill="black" stroke="black" points="1178.49,-439.37 1174.99,-429.37 1171.49,-439.37 1178.49,-439.37"/>
</g>
<!-- layer7_expert1 -->
<g id="node133" class="node">
<title>layer7_expert1</title>
<polygon fill="lightblue" stroke="black" points="2004.99,-429 1591.99,-429 1591.99,-376 2004.99,-376 2004.99,-429"/>
<text text-anchor="middle" x="1798.49" y="-413.8" font-family="Times,serif" font-size="14.00">Expert 1</text>
<text text-anchor="middle" x="1798.49" y="-398.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="1798.49" y="-383.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer7_ln_moe&#45;&gt;layer7_expert1 -->
<g id="edge214" class="edge">
<title>layer7_ln_moe&#45;&gt;layer7_expert1</title>
<path fill="none" stroke="black" d="M1188.99,-622.73C1188.99,-569.18 1188.99,-454 1188.99,-454 1188.99,-454 1729.66,-454 1729.66,-454 1729.66,-454 1729.66,-439.16 1729.66,-439.16"/>
<polygon fill="black" stroke="black" points="1733.16,-439.16 1729.66,-429.16 1726.16,-439.16 1733.16,-439.16"/>
</g>
<!-- layer7_expert2 -->
<g id="node134" class="node">
<title>layer7_expert2</title>
<polygon fill="lightblue" stroke="black" points="2435.99,-429 2022.99,-429 2022.99,-376 2435.99,-376 2435.99,-429"/>
<text text-anchor="middle" x="2229.49" y="-413.8" font-family="Times,serif" font-size="14.00">Expert 2</text>
<text text-anchor="middle" x="2229.49" y="-398.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2229.49" y="-383.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer7_ln_moe&#45;&gt;layer7_expert2 -->
<g id="edge216" class="edge">
<title>layer7_ln_moe&#45;&gt;layer7_expert2</title>
<path fill="none" stroke="black" d="M1217.24,-640C1606.43,-640 2409.11,-640 2409.11,-640 2409.11,-640 2409.11,-439.28 2409.11,-439.28"/>
<polygon fill="black" stroke="black" points="2412.61,-439.28 2409.11,-429.28 2405.61,-439.28 2412.61,-439.28"/>
</g>
<!-- layer7_expert3 -->
<g id="node135" class="node">
<title>layer7_expert3</title>
<polygon fill="lightblue" stroke="black" points="2866.99,-429 2453.99,-429 2453.99,-376 2866.99,-376 2866.99,-429"/>
<text text-anchor="middle" x="2660.49" y="-413.8" font-family="Times,serif" font-size="14.00">Expert 3</text>
<text text-anchor="middle" x="2660.49" y="-398.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2660.49" y="-383.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer7_ln_moe&#45;&gt;layer7_expert3 -->
<g id="edge218" class="edge">
<title>layer7_ln_moe&#45;&gt;layer7_expert3</title>
<path fill="none" stroke="black" d="M1217.4,-658C1674.32,-658 2729.32,-658 2729.32,-658 2729.32,-658 2729.32,-439.36 2729.32,-439.36"/>
<polygon fill="black" stroke="black" points="2732.82,-439.36 2729.32,-429.36 2725.82,-439.36 2732.82,-439.36"/>
</g>
<!-- layer7_gate&#45;&gt;layer7_expert0 -->
<g id="edge211" class="edge">
<title>layer7_gate&#45;&gt;layer7_expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1562.37,-532.91C1562.37,-532.91 1562.37,-439.11 1562.37,-439.11"/>
<polygon fill="black" stroke="black" points="1565.87,-439.11 1562.37,-429.11 1558.87,-439.11 1565.87,-439.11"/>
<text text-anchor="middle" x="1453.99" y="-450.8" font-family="Times,serif" font-size="14.00">select expert 0</text>
</g>
<!-- layer7_gate&#45;&gt;layer7_expert1 -->
<g id="edge213" class="edge">
<title>layer7_gate&#45;&gt;layer7_expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1867.32,-479.92C1867.32,-479.92 1867.32,-439.07 1867.32,-439.07"/>
<polygon fill="black" stroke="black" points="1870.82,-439.07 1867.32,-429.07 1863.82,-439.07 1870.82,-439.07"/>
<text text-anchor="middle" x="1944.99" y="-450.8" font-family="Times,serif" font-size="14.00">select expert 1</text>
</g>
<!-- layer7_gate&#45;&gt;layer7_expert2 -->
<g id="edge215" class="edge">
<title>layer7_gate&#45;&gt;layer7_expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2202.61,-479.92C2202.61,-479.92 2202.61,-439.07 2202.61,-439.07"/>
<polygon fill="black" stroke="black" points="2206.11,-439.07 2202.61,-429.07 2199.11,-439.07 2206.11,-439.07"/>
<text text-anchor="middle" x="2093.99" y="-450.8" font-family="Times,serif" font-size="14.00">select expert 2</text>
</g>
<!-- layer7_gate&#45;&gt;layer7_expert3 -->
<g id="edge217" class="edge">
<title>layer7_gate&#45;&gt;layer7_expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2297.38,-533C2447.34,-533 2591.66,-533 2591.66,-533 2591.66,-533 2591.66,-439.22 2591.66,-439.22"/>
<polygon fill="black" stroke="black" points="2595.16,-439.22 2591.66,-429.22 2588.16,-439.22 2595.16,-439.22"/>
<text text-anchor="middle" x="2341.99" y="-450.8" font-family="Times,serif" font-size="14.00">select expert 3</text>
</g>
<!-- layer7_expert_agg -->
<g id="node136" class="node">
<title>layer7_expert_agg</title>
<polygon fill="yellow" stroke="black" points="4369.92,-339 1532.88,-339 803.06,-233 3640.1,-233 4369.92,-339"/>
<text text-anchor="middle" x="2586.49" y="-297.3" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="2586.49" y="-282.3" font-family="Times,serif" font-size="14.00">Input: Expert0=[batch_size=8, seq_len=256, token_dim=1024], Expert1=[batch_size=8, seq_len=256, token_dim=1024], Expert2=[batch_size=8, seq_len=256, token_dim=1024], Expert3=[batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="2586.49" y="-267.3" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer7_expert0&#45;&gt;layer7_expert_agg -->
<g id="edge219" class="edge">
<title>layer7_expert0&#45;&gt;layer7_expert_agg</title>
<path fill="none" stroke="black" d="M1367.49,-375.77C1367.49,-375.77 1367.49,-325.05 1367.49,-325.05"/>
<polygon fill="black" stroke="black" points="1370.99,-325.05 1367.49,-315.05 1363.99,-325.05 1370.99,-325.05"/>
</g>
<!-- layer7_expert1&#45;&gt;layer7_expert_agg -->
<g id="edge220" class="edge">
<title>layer7_expert1&#45;&gt;layer7_expert_agg</title>
<path fill="none" stroke="black" d="M1798.49,-375.77C1798.49,-375.77 1798.49,-349.24 1798.49,-349.24"/>
<polygon fill="black" stroke="black" points="1801.99,-349.24 1798.49,-339.24 1794.99,-349.24 1801.99,-349.24"/>
</g>
<!-- layer7_expert2&#45;&gt;layer7_expert_agg -->
<g id="edge221" class="edge">
<title>layer7_expert2&#45;&gt;layer7_expert_agg</title>
<path fill="none" stroke="black" d="M2229.49,-375.77C2229.49,-375.77 2229.49,-349.24 2229.49,-349.24"/>
<polygon fill="black" stroke="black" points="2232.99,-349.24 2229.49,-339.24 2225.99,-349.24 2232.99,-349.24"/>
</g>
<!-- layer7_expert3&#45;&gt;layer7_expert_agg -->
<g id="edge222" class="edge">
<title>layer7_expert3&#45;&gt;layer7_expert_agg</title>
<path fill="none" stroke="black" d="M2660.49,-375.77C2660.49,-375.77 2660.49,-349.24 2660.49,-349.24"/>
<polygon fill="black" stroke="black" points="2663.99,-349.24 2660.49,-339.24 2656.99,-349.24 2663.99,-349.24"/>
</g>
<!-- layer7_expert_agg&#45;&gt;layer7_residual_moe -->
<g id="edge224" class="edge">
<title>layer7_expert_agg&#45;&gt;layer7_residual_moe</title>
<path fill="none" stroke="black" d="M1177.13,-232.75C1177.13,-232.75 1177.13,-206.29 1177.13,-206.29"/>
<polygon fill="black" stroke="black" points="1180.63,-206.29 1177.13,-196.29 1173.63,-206.29 1180.63,-206.29"/>
</g>
<!-- output -->
<g id="node138" class="node">
<title>output</title>
<polygon fill="lightblue" stroke="black" points="981.99,-53 568.99,-53 568.99,0 981.99,0 981.99,-53"/>
<text text-anchor="middle" x="775.49" y="-37.8" font-family="Times,serif" font-size="14.00">Output</text>
<text text-anchor="middle" x="775.49" y="-22.8" font-family="Times,serif" font-size="14.00">Input: [batch_size=8, seq_len=256, token_dim=1024]</text>
<text text-anchor="middle" x="775.49" y="-7.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=8, seq_len=256, token_dim=1024]</text>
</g>
<!-- layer7_residual_moe&#45;&gt;output -->
<g id="edge225" class="edge">
<title>layer7_residual_moe&#45;&gt;output</title>
<path fill="none" stroke="black" d="M775.49,-89.86C775.49,-89.86 775.49,-63.17 775.49,-63.17"/>
<polygon fill="black" stroke="black" points="778.99,-63.17 775.49,-53.17 771.99,-63.17 778.99,-63.17"/>
</g>
</g>
</svg>
