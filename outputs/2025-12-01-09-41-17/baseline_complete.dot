digraph Baseline {
  rank_policy=TB;
  node [shape=rectangle];

  Input [shape=ellipse, label="Input\n[batch_size=128,seq_len=128,hidden=1024]"];
  QKV_s0_l1_tp0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_s0_l1_tp0;
  QKV_s0_l1_tp1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_s0_l1_tp1;
  QKV_s0_l1_tp2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_s0_l1_tp2;
  QKV_s0_l1_tp3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_s0_l1_tp3;
  QKV_s0_l1_tp4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_s0_l1_tp4;
  QKV_s0_l1_tp5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_s0_l1_tp5;
  QKV_s0_l1_tp6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_s0_l1_tp6;
  QKV_s0_l1_tp7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_s0_l1_tp7;
  SplitHeads_s0_l1_tp0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l1_tp0 -> SplitHeads_s0_l1_tp0;
  SplitHeads_s0_l1_tp1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l1_tp1 -> SplitHeads_s0_l1_tp1;
  SplitHeads_s0_l1_tp2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l1_tp2 -> SplitHeads_s0_l1_tp2;
  SplitHeads_s0_l1_tp3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l1_tp3 -> SplitHeads_s0_l1_tp3;
  SplitHeads_s0_l1_tp4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l1_tp4 -> SplitHeads_s0_l1_tp4;
  SplitHeads_s0_l1_tp5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l1_tp5 -> SplitHeads_s0_l1_tp5;
  SplitHeads_s0_l1_tp6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l1_tp6 -> SplitHeads_s0_l1_tp6;
  SplitHeads_s0_l1_tp7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l1_tp7 -> SplitHeads_s0_l1_tp7;
  A2A_s0_l1 [shape=ellipse, label="AllToAll\nstage0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_s0_l1_tp0 -> A2A_s0_l1;
  SplitHeads_s0_l1_tp1 -> A2A_s0_l1;
  SplitHeads_s0_l1_tp2 -> A2A_s0_l1;
  SplitHeads_s0_l1_tp3 -> A2A_s0_l1;
  SplitHeads_s0_l1_tp4 -> A2A_s0_l1;
  SplitHeads_s0_l1_tp5 -> A2A_s0_l1;
  SplitHeads_s0_l1_tp6 -> A2A_s0_l1;
  SplitHeads_s0_l1_tp7 -> A2A_s0_l1;
  Attn_s0_l1_tp0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l1 -> Attn_s0_l1_tp0;
  Attn_s0_l1_tp1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l1 -> Attn_s0_l1_tp1;
  Attn_s0_l1_tp2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l1 -> Attn_s0_l1_tp2;
  Attn_s0_l1_tp3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l1 -> Attn_s0_l1_tp3;
  Attn_s0_l1_tp4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l1 -> Attn_s0_l1_tp4;
  Attn_s0_l1_tp5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l1 -> Attn_s0_l1_tp5;
  Attn_s0_l1_tp6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l1 -> Attn_s0_l1_tp6;
  Attn_s0_l1_tp7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l1 -> Attn_s0_l1_tp7;
  AR_attn_s0_l1 [shape=ellipse, label="AllReduce\nstage0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_s0_l1_tp0 -> AR_attn_s0_l1;
  Attn_s0_l1_tp1 -> AR_attn_s0_l1;
  Attn_s0_l1_tp2 -> AR_attn_s0_l1;
  Attn_s0_l1_tp3 -> AR_attn_s0_l1;
  Attn_s0_l1_tp4 -> AR_attn_s0_l1;
  Attn_s0_l1_tp5 -> AR_attn_s0_l1;
  Attn_s0_l1_tp6 -> AR_attn_s0_l1;
  Attn_s0_l1_tp7 -> AR_attn_s0_l1;
  O_s0_l1_tp0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l1 -> O_s0_l1_tp0;
  O_s0_l1_tp1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l1 -> O_s0_l1_tp1;
  O_s0_l1_tp2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l1 -> O_s0_l1_tp2;
  O_s0_l1_tp3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l1 -> O_s0_l1_tp3;
  O_s0_l1_tp4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l1 -> O_s0_l1_tp4;
  O_s0_l1_tp5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l1 -> O_s0_l1_tp5;
  O_s0_l1_tp6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l1 -> O_s0_l1_tp6;
  O_s0_l1_tp7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l1 -> O_s0_l1_tp7;
  ResAttn_s0_l1_tp0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l1_tp0 -> ResAttn_s0_l1_tp0;
  Input -> ResAttn_s0_l1_tp0;
  ResAttn_s0_l1_tp1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l1_tp1 -> ResAttn_s0_l1_tp1;
  Input -> ResAttn_s0_l1_tp1;
  ResAttn_s0_l1_tp2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l1_tp2 -> ResAttn_s0_l1_tp2;
  Input -> ResAttn_s0_l1_tp2;
  ResAttn_s0_l1_tp3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l1_tp3 -> ResAttn_s0_l1_tp3;
  Input -> ResAttn_s0_l1_tp3;
  ResAttn_s0_l1_tp4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l1_tp4 -> ResAttn_s0_l1_tp4;
  Input -> ResAttn_s0_l1_tp4;
  ResAttn_s0_l1_tp5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l1_tp5 -> ResAttn_s0_l1_tp5;
  Input -> ResAttn_s0_l1_tp5;
  ResAttn_s0_l1_tp6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l1_tp6 -> ResAttn_s0_l1_tp6;
  Input -> ResAttn_s0_l1_tp6;
  ResAttn_s0_l1_tp7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l1_tp7 -> ResAttn_s0_l1_tp7;
  Input -> ResAttn_s0_l1_tp7;
  Gate_s0_l1_tp0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l1_tp0 -> Gate_s0_l1_tp0;
  Gate_s0_l1_tp1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l1_tp1 -> Gate_s0_l1_tp1;
  Gate_s0_l1_tp2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l1_tp2 -> Gate_s0_l1_tp2;
  Gate_s0_l1_tp3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l1_tp3 -> Gate_s0_l1_tp3;
  Gate_s0_l1_tp4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l1_tp4 -> Gate_s0_l1_tp4;
  Gate_s0_l1_tp5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l1_tp5 -> Gate_s0_l1_tp5;
  Gate_s0_l1_tp6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l1_tp6 -> Gate_s0_l1_tp6;
  Gate_s0_l1_tp7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l1_tp7 -> Gate_s0_l1_tp7;
  Expert0_s0_l1_tp0 [label="Expert0\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp0 -> Expert0_s0_l1_tp0 [style=dashed];
  Expert1_s0_l1_tp0 [label="Expert1\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp0 -> Expert1_s0_l1_tp0 [style=dashed];
  Expert2_s0_l1_tp0 [label="Expert2\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp0 -> Expert2_s0_l1_tp0 [style=dashed];
  Expert3_s0_l1_tp0 [label="Expert3\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp0 -> Expert3_s0_l1_tp0 [style=dashed];
  Expert4_s0_l1_tp1 [label="Expert4\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp1 -> Expert4_s0_l1_tp1 [style=dashed];
  Expert5_s0_l1_tp1 [label="Expert5\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp1 -> Expert5_s0_l1_tp1 [style=dashed];
  Expert6_s0_l1_tp1 [label="Expert6\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp1 -> Expert6_s0_l1_tp1 [style=dashed];
  Expert7_s0_l1_tp1 [label="Expert7\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp1 -> Expert7_s0_l1_tp1 [style=dashed];
  Expert8_s0_l1_tp2 [label="Expert8\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp2 -> Expert8_s0_l1_tp2 [style=dashed];
  Expert9_s0_l1_tp2 [label="Expert9\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp2 -> Expert9_s0_l1_tp2 [style=dashed];
  Expert10_s0_l1_tp2 [label="Expert10\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp2 -> Expert10_s0_l1_tp2 [style=dashed];
  Expert11_s0_l1_tp2 [label="Expert11\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp2 -> Expert11_s0_l1_tp2 [style=dashed];
  Expert12_s0_l1_tp3 [label="Expert12\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp3 -> Expert12_s0_l1_tp3 [style=dashed];
  Expert13_s0_l1_tp3 [label="Expert13\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp3 -> Expert13_s0_l1_tp3 [style=dashed];
  Expert14_s0_l1_tp3 [label="Expert14\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp3 -> Expert14_s0_l1_tp3 [style=dashed];
  Expert15_s0_l1_tp3 [label="Expert15\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp3 -> Expert15_s0_l1_tp3 [style=dashed];
  Expert16_s0_l1_tp4 [label="Expert16\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp4 -> Expert16_s0_l1_tp4 [style=dashed];
  Expert17_s0_l1_tp4 [label="Expert17\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp4 -> Expert17_s0_l1_tp4 [style=dashed];
  Expert18_s0_l1_tp4 [label="Expert18\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp4 -> Expert18_s0_l1_tp4 [style=dashed];
  Expert19_s0_l1_tp4 [label="Expert19\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp4 -> Expert19_s0_l1_tp4 [style=dashed];
  Expert20_s0_l1_tp5 [label="Expert20\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp5 -> Expert20_s0_l1_tp5 [style=dashed];
  Expert21_s0_l1_tp5 [label="Expert21\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp5 -> Expert21_s0_l1_tp5 [style=dashed];
  Expert22_s0_l1_tp5 [label="Expert22\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp5 -> Expert22_s0_l1_tp5 [style=dashed];
  Expert23_s0_l1_tp5 [label="Expert23\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp5 -> Expert23_s0_l1_tp5 [style=dashed];
  Expert24_s0_l1_tp6 [label="Expert24\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp6 -> Expert24_s0_l1_tp6 [style=dashed];
  Expert25_s0_l1_tp6 [label="Expert25\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp6 -> Expert25_s0_l1_tp6 [style=dashed];
  Expert26_s0_l1_tp6 [label="Expert26\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp6 -> Expert26_s0_l1_tp6 [style=dashed];
  Expert27_s0_l1_tp6 [label="Expert27\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp6 -> Expert27_s0_l1_tp6 [style=dashed];
  Expert28_s0_l1_tp7 [label="Expert28\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp7 -> Expert28_s0_l1_tp7 [style=dashed];
  Expert29_s0_l1_tp7 [label="Expert29\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp7 -> Expert29_s0_l1_tp7 [style=dashed];
  Expert30_s0_l1_tp7 [label="Expert30\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp7 -> Expert30_s0_l1_tp7 [style=dashed];
  Expert31_s0_l1_tp7 [label="Expert31\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l1_tp7 -> Expert31_s0_l1_tp7 [style=dashed];
  AR_exp_s0_l1 [shape=ellipse, label="AllReduceExperts\nstage0\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert0_s0_l1_tp0 -> AR_exp_s0_l1;
  Expert1_s0_l1_tp0 -> AR_exp_s0_l1;
  Expert2_s0_l1_tp0 -> AR_exp_s0_l1;
  Expert3_s0_l1_tp0 -> AR_exp_s0_l1;
  Expert4_s0_l1_tp1 -> AR_exp_s0_l1;
  Expert5_s0_l1_tp1 -> AR_exp_s0_l1;
  Expert6_s0_l1_tp1 -> AR_exp_s0_l1;
  Expert7_s0_l1_tp1 -> AR_exp_s0_l1;
  Expert8_s0_l1_tp2 -> AR_exp_s0_l1;
  Expert9_s0_l1_tp2 -> AR_exp_s0_l1;
  Expert10_s0_l1_tp2 -> AR_exp_s0_l1;
  Expert11_s0_l1_tp2 -> AR_exp_s0_l1;
  Expert12_s0_l1_tp3 -> AR_exp_s0_l1;
  Expert13_s0_l1_tp3 -> AR_exp_s0_l1;
  Expert14_s0_l1_tp3 -> AR_exp_s0_l1;
  Expert15_s0_l1_tp3 -> AR_exp_s0_l1;
  Expert16_s0_l1_tp4 -> AR_exp_s0_l1;
  Expert17_s0_l1_tp4 -> AR_exp_s0_l1;
  Expert18_s0_l1_tp4 -> AR_exp_s0_l1;
  Expert19_s0_l1_tp4 -> AR_exp_s0_l1;
  Expert20_s0_l1_tp5 -> AR_exp_s0_l1;
  Expert21_s0_l1_tp5 -> AR_exp_s0_l1;
  Expert22_s0_l1_tp5 -> AR_exp_s0_l1;
  Expert23_s0_l1_tp5 -> AR_exp_s0_l1;
  Expert24_s0_l1_tp6 -> AR_exp_s0_l1;
  Expert25_s0_l1_tp6 -> AR_exp_s0_l1;
  Expert26_s0_l1_tp6 -> AR_exp_s0_l1;
  Expert27_s0_l1_tp6 -> AR_exp_s0_l1;
  Expert28_s0_l1_tp7 -> AR_exp_s0_l1;
  Expert29_s0_l1_tp7 -> AR_exp_s0_l1;
  Expert30_s0_l1_tp7 -> AR_exp_s0_l1;
  Expert31_s0_l1_tp7 -> AR_exp_s0_l1;
  ResMOE_s0_l1_tp0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l1 -> ResMOE_s0_l1_tp0;
  ResAttn_s0_l1_tp0 -> ResMOE_s0_l1_tp0;
  ResMOE_s0_l1_tp1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l1 -> ResMOE_s0_l1_tp1;
  ResAttn_s0_l1_tp1 -> ResMOE_s0_l1_tp1;
  ResMOE_s0_l1_tp2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l1 -> ResMOE_s0_l1_tp2;
  ResAttn_s0_l1_tp2 -> ResMOE_s0_l1_tp2;
  ResMOE_s0_l1_tp3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l1 -> ResMOE_s0_l1_tp3;
  ResAttn_s0_l1_tp3 -> ResMOE_s0_l1_tp3;
  ResMOE_s0_l1_tp4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l1 -> ResMOE_s0_l1_tp4;
  ResAttn_s0_l1_tp4 -> ResMOE_s0_l1_tp4;
  ResMOE_s0_l1_tp5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l1 -> ResMOE_s0_l1_tp5;
  ResAttn_s0_l1_tp5 -> ResMOE_s0_l1_tp5;
  ResMOE_s0_l1_tp6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l1 -> ResMOE_s0_l1_tp6;
  ResAttn_s0_l1_tp6 -> ResMOE_s0_l1_tp6;
  ResMOE_s0_l1_tp7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l1 -> ResMOE_s0_l1_tp7;
  ResAttn_s0_l1_tp7 -> ResMOE_s0_l1_tp7;
  QKV_s0_l2_tp0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l1_tp0 -> QKV_s0_l2_tp0;
  QKV_s0_l2_tp1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l1_tp0 -> QKV_s0_l2_tp1;
  QKV_s0_l2_tp2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l1_tp0 -> QKV_s0_l2_tp2;
  QKV_s0_l2_tp3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l1_tp0 -> QKV_s0_l2_tp3;
  QKV_s0_l2_tp4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l1_tp0 -> QKV_s0_l2_tp4;
  QKV_s0_l2_tp5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l1_tp0 -> QKV_s0_l2_tp5;
  QKV_s0_l2_tp6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l1_tp0 -> QKV_s0_l2_tp6;
  QKV_s0_l2_tp7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l1_tp0 -> QKV_s0_l2_tp7;
  SplitHeads_s0_l2_tp0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l2_tp0 -> SplitHeads_s0_l2_tp0;
  SplitHeads_s0_l2_tp1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l2_tp1 -> SplitHeads_s0_l2_tp1;
  SplitHeads_s0_l2_tp2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l2_tp2 -> SplitHeads_s0_l2_tp2;
  SplitHeads_s0_l2_tp3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l2_tp3 -> SplitHeads_s0_l2_tp3;
  SplitHeads_s0_l2_tp4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l2_tp4 -> SplitHeads_s0_l2_tp4;
  SplitHeads_s0_l2_tp5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l2_tp5 -> SplitHeads_s0_l2_tp5;
  SplitHeads_s0_l2_tp6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l2_tp6 -> SplitHeads_s0_l2_tp6;
  SplitHeads_s0_l2_tp7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l2_tp7 -> SplitHeads_s0_l2_tp7;
  A2A_s0_l2 [shape=ellipse, label="AllToAll\nstage0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_s0_l2_tp0 -> A2A_s0_l2;
  SplitHeads_s0_l2_tp1 -> A2A_s0_l2;
  SplitHeads_s0_l2_tp2 -> A2A_s0_l2;
  SplitHeads_s0_l2_tp3 -> A2A_s0_l2;
  SplitHeads_s0_l2_tp4 -> A2A_s0_l2;
  SplitHeads_s0_l2_tp5 -> A2A_s0_l2;
  SplitHeads_s0_l2_tp6 -> A2A_s0_l2;
  SplitHeads_s0_l2_tp7 -> A2A_s0_l2;
  Attn_s0_l2_tp0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l2 -> Attn_s0_l2_tp0;
  Attn_s0_l2_tp1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l2 -> Attn_s0_l2_tp1;
  Attn_s0_l2_tp2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l2 -> Attn_s0_l2_tp2;
  Attn_s0_l2_tp3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l2 -> Attn_s0_l2_tp3;
  Attn_s0_l2_tp4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l2 -> Attn_s0_l2_tp4;
  Attn_s0_l2_tp5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l2 -> Attn_s0_l2_tp5;
  Attn_s0_l2_tp6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l2 -> Attn_s0_l2_tp6;
  Attn_s0_l2_tp7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l2 -> Attn_s0_l2_tp7;
  AR_attn_s0_l2 [shape=ellipse, label="AllReduce\nstage0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_s0_l2_tp0 -> AR_attn_s0_l2;
  Attn_s0_l2_tp1 -> AR_attn_s0_l2;
  Attn_s0_l2_tp2 -> AR_attn_s0_l2;
  Attn_s0_l2_tp3 -> AR_attn_s0_l2;
  Attn_s0_l2_tp4 -> AR_attn_s0_l2;
  Attn_s0_l2_tp5 -> AR_attn_s0_l2;
  Attn_s0_l2_tp6 -> AR_attn_s0_l2;
  Attn_s0_l2_tp7 -> AR_attn_s0_l2;
  O_s0_l2_tp0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l2 -> O_s0_l2_tp0;
  O_s0_l2_tp1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l2 -> O_s0_l2_tp1;
  O_s0_l2_tp2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l2 -> O_s0_l2_tp2;
  O_s0_l2_tp3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l2 -> O_s0_l2_tp3;
  O_s0_l2_tp4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l2 -> O_s0_l2_tp4;
  O_s0_l2_tp5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l2 -> O_s0_l2_tp5;
  O_s0_l2_tp6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l2 -> O_s0_l2_tp6;
  O_s0_l2_tp7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l2 -> O_s0_l2_tp7;
  ResAttn_s0_l2_tp0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l2_tp0 -> ResAttn_s0_l2_tp0;
  ResMOE_s0_l1_tp0 -> ResAttn_s0_l2_tp0;
  ResAttn_s0_l2_tp1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l2_tp1 -> ResAttn_s0_l2_tp1;
  ResMOE_s0_l1_tp0 -> ResAttn_s0_l2_tp1;
  ResAttn_s0_l2_tp2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l2_tp2 -> ResAttn_s0_l2_tp2;
  ResMOE_s0_l1_tp0 -> ResAttn_s0_l2_tp2;
  ResAttn_s0_l2_tp3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l2_tp3 -> ResAttn_s0_l2_tp3;
  ResMOE_s0_l1_tp0 -> ResAttn_s0_l2_tp3;
  ResAttn_s0_l2_tp4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l2_tp4 -> ResAttn_s0_l2_tp4;
  ResMOE_s0_l1_tp0 -> ResAttn_s0_l2_tp4;
  ResAttn_s0_l2_tp5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l2_tp5 -> ResAttn_s0_l2_tp5;
  ResMOE_s0_l1_tp0 -> ResAttn_s0_l2_tp5;
  ResAttn_s0_l2_tp6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l2_tp6 -> ResAttn_s0_l2_tp6;
  ResMOE_s0_l1_tp0 -> ResAttn_s0_l2_tp6;
  ResAttn_s0_l2_tp7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l2_tp7 -> ResAttn_s0_l2_tp7;
  ResMOE_s0_l1_tp0 -> ResAttn_s0_l2_tp7;
  Gate_s0_l2_tp0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l2_tp0 -> Gate_s0_l2_tp0;
  Gate_s0_l2_tp1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l2_tp1 -> Gate_s0_l2_tp1;
  Gate_s0_l2_tp2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l2_tp2 -> Gate_s0_l2_tp2;
  Gate_s0_l2_tp3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l2_tp3 -> Gate_s0_l2_tp3;
  Gate_s0_l2_tp4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l2_tp4 -> Gate_s0_l2_tp4;
  Gate_s0_l2_tp5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l2_tp5 -> Gate_s0_l2_tp5;
  Gate_s0_l2_tp6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l2_tp6 -> Gate_s0_l2_tp6;
  Gate_s0_l2_tp7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l2_tp7 -> Gate_s0_l2_tp7;
  Expert0_s0_l2_tp0 [label="Expert0\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp0 -> Expert0_s0_l2_tp0 [style=dashed];
  Expert1_s0_l2_tp0 [label="Expert1\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp0 -> Expert1_s0_l2_tp0 [style=dashed];
  Expert2_s0_l2_tp0 [label="Expert2\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp0 -> Expert2_s0_l2_tp0 [style=dashed];
  Expert3_s0_l2_tp0 [label="Expert3\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp0 -> Expert3_s0_l2_tp0 [style=dashed];
  Expert4_s0_l2_tp1 [label="Expert4\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp1 -> Expert4_s0_l2_tp1 [style=dashed];
  Expert5_s0_l2_tp1 [label="Expert5\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp1 -> Expert5_s0_l2_tp1 [style=dashed];
  Expert6_s0_l2_tp1 [label="Expert6\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp1 -> Expert6_s0_l2_tp1 [style=dashed];
  Expert7_s0_l2_tp1 [label="Expert7\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp1 -> Expert7_s0_l2_tp1 [style=dashed];
  Expert8_s0_l2_tp2 [label="Expert8\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp2 -> Expert8_s0_l2_tp2 [style=dashed];
  Expert9_s0_l2_tp2 [label="Expert9\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp2 -> Expert9_s0_l2_tp2 [style=dashed];
  Expert10_s0_l2_tp2 [label="Expert10\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp2 -> Expert10_s0_l2_tp2 [style=dashed];
  Expert11_s0_l2_tp2 [label="Expert11\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp2 -> Expert11_s0_l2_tp2 [style=dashed];
  Expert12_s0_l2_tp3 [label="Expert12\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp3 -> Expert12_s0_l2_tp3 [style=dashed];
  Expert13_s0_l2_tp3 [label="Expert13\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp3 -> Expert13_s0_l2_tp3 [style=dashed];
  Expert14_s0_l2_tp3 [label="Expert14\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp3 -> Expert14_s0_l2_tp3 [style=dashed];
  Expert15_s0_l2_tp3 [label="Expert15\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp3 -> Expert15_s0_l2_tp3 [style=dashed];
  Expert16_s0_l2_tp4 [label="Expert16\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp4 -> Expert16_s0_l2_tp4 [style=dashed];
  Expert17_s0_l2_tp4 [label="Expert17\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp4 -> Expert17_s0_l2_tp4 [style=dashed];
  Expert18_s0_l2_tp4 [label="Expert18\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp4 -> Expert18_s0_l2_tp4 [style=dashed];
  Expert19_s0_l2_tp4 [label="Expert19\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp4 -> Expert19_s0_l2_tp4 [style=dashed];
  Expert20_s0_l2_tp5 [label="Expert20\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp5 -> Expert20_s0_l2_tp5 [style=dashed];
  Expert21_s0_l2_tp5 [label="Expert21\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp5 -> Expert21_s0_l2_tp5 [style=dashed];
  Expert22_s0_l2_tp5 [label="Expert22\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp5 -> Expert22_s0_l2_tp5 [style=dashed];
  Expert23_s0_l2_tp5 [label="Expert23\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp5 -> Expert23_s0_l2_tp5 [style=dashed];
  Expert24_s0_l2_tp6 [label="Expert24\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp6 -> Expert24_s0_l2_tp6 [style=dashed];
  Expert25_s0_l2_tp6 [label="Expert25\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp6 -> Expert25_s0_l2_tp6 [style=dashed];
  Expert26_s0_l2_tp6 [label="Expert26\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp6 -> Expert26_s0_l2_tp6 [style=dashed];
  Expert27_s0_l2_tp6 [label="Expert27\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp6 -> Expert27_s0_l2_tp6 [style=dashed];
  Expert28_s0_l2_tp7 [label="Expert28\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp7 -> Expert28_s0_l2_tp7 [style=dashed];
  Expert29_s0_l2_tp7 [label="Expert29\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp7 -> Expert29_s0_l2_tp7 [style=dashed];
  Expert30_s0_l2_tp7 [label="Expert30\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp7 -> Expert30_s0_l2_tp7 [style=dashed];
  Expert31_s0_l2_tp7 [label="Expert31\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l2_tp7 -> Expert31_s0_l2_tp7 [style=dashed];
  AR_exp_s0_l2 [shape=ellipse, label="AllReduceExperts\nstage0\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert0_s0_l2_tp0 -> AR_exp_s0_l2;
  Expert1_s0_l2_tp0 -> AR_exp_s0_l2;
  Expert2_s0_l2_tp0 -> AR_exp_s0_l2;
  Expert3_s0_l2_tp0 -> AR_exp_s0_l2;
  Expert4_s0_l2_tp1 -> AR_exp_s0_l2;
  Expert5_s0_l2_tp1 -> AR_exp_s0_l2;
  Expert6_s0_l2_tp1 -> AR_exp_s0_l2;
  Expert7_s0_l2_tp1 -> AR_exp_s0_l2;
  Expert8_s0_l2_tp2 -> AR_exp_s0_l2;
  Expert9_s0_l2_tp2 -> AR_exp_s0_l2;
  Expert10_s0_l2_tp2 -> AR_exp_s0_l2;
  Expert11_s0_l2_tp2 -> AR_exp_s0_l2;
  Expert12_s0_l2_tp3 -> AR_exp_s0_l2;
  Expert13_s0_l2_tp3 -> AR_exp_s0_l2;
  Expert14_s0_l2_tp3 -> AR_exp_s0_l2;
  Expert15_s0_l2_tp3 -> AR_exp_s0_l2;
  Expert16_s0_l2_tp4 -> AR_exp_s0_l2;
  Expert17_s0_l2_tp4 -> AR_exp_s0_l2;
  Expert18_s0_l2_tp4 -> AR_exp_s0_l2;
  Expert19_s0_l2_tp4 -> AR_exp_s0_l2;
  Expert20_s0_l2_tp5 -> AR_exp_s0_l2;
  Expert21_s0_l2_tp5 -> AR_exp_s0_l2;
  Expert22_s0_l2_tp5 -> AR_exp_s0_l2;
  Expert23_s0_l2_tp5 -> AR_exp_s0_l2;
  Expert24_s0_l2_tp6 -> AR_exp_s0_l2;
  Expert25_s0_l2_tp6 -> AR_exp_s0_l2;
  Expert26_s0_l2_tp6 -> AR_exp_s0_l2;
  Expert27_s0_l2_tp6 -> AR_exp_s0_l2;
  Expert28_s0_l2_tp7 -> AR_exp_s0_l2;
  Expert29_s0_l2_tp7 -> AR_exp_s0_l2;
  Expert30_s0_l2_tp7 -> AR_exp_s0_l2;
  Expert31_s0_l2_tp7 -> AR_exp_s0_l2;
  ResMOE_s0_l2_tp0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l2 -> ResMOE_s0_l2_tp0;
  ResAttn_s0_l2_tp0 -> ResMOE_s0_l2_tp0;
  ResMOE_s0_l2_tp1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l2 -> ResMOE_s0_l2_tp1;
  ResAttn_s0_l2_tp1 -> ResMOE_s0_l2_tp1;
  ResMOE_s0_l2_tp2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l2 -> ResMOE_s0_l2_tp2;
  ResAttn_s0_l2_tp2 -> ResMOE_s0_l2_tp2;
  ResMOE_s0_l2_tp3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l2 -> ResMOE_s0_l2_tp3;
  ResAttn_s0_l2_tp3 -> ResMOE_s0_l2_tp3;
  ResMOE_s0_l2_tp4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l2 -> ResMOE_s0_l2_tp4;
  ResAttn_s0_l2_tp4 -> ResMOE_s0_l2_tp4;
  ResMOE_s0_l2_tp5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l2 -> ResMOE_s0_l2_tp5;
  ResAttn_s0_l2_tp5 -> ResMOE_s0_l2_tp5;
  ResMOE_s0_l2_tp6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l2 -> ResMOE_s0_l2_tp6;
  ResAttn_s0_l2_tp6 -> ResMOE_s0_l2_tp6;
  ResMOE_s0_l2_tp7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l2 -> ResMOE_s0_l2_tp7;
  ResAttn_s0_l2_tp7 -> ResMOE_s0_l2_tp7;
  QKV_s0_l3_tp0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l2_tp0 -> QKV_s0_l3_tp0;
  QKV_s0_l3_tp1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l2_tp0 -> QKV_s0_l3_tp1;
  QKV_s0_l3_tp2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l2_tp0 -> QKV_s0_l3_tp2;
  QKV_s0_l3_tp3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l2_tp0 -> QKV_s0_l3_tp3;
  QKV_s0_l3_tp4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l2_tp0 -> QKV_s0_l3_tp4;
  QKV_s0_l3_tp5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l2_tp0 -> QKV_s0_l3_tp5;
  QKV_s0_l3_tp6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l2_tp0 -> QKV_s0_l3_tp6;
  QKV_s0_l3_tp7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l2_tp0 -> QKV_s0_l3_tp7;
  SplitHeads_s0_l3_tp0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l3_tp0 -> SplitHeads_s0_l3_tp0;
  SplitHeads_s0_l3_tp1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l3_tp1 -> SplitHeads_s0_l3_tp1;
  SplitHeads_s0_l3_tp2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l3_tp2 -> SplitHeads_s0_l3_tp2;
  SplitHeads_s0_l3_tp3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l3_tp3 -> SplitHeads_s0_l3_tp3;
  SplitHeads_s0_l3_tp4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l3_tp4 -> SplitHeads_s0_l3_tp4;
  SplitHeads_s0_l3_tp5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l3_tp5 -> SplitHeads_s0_l3_tp5;
  SplitHeads_s0_l3_tp6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l3_tp6 -> SplitHeads_s0_l3_tp6;
  SplitHeads_s0_l3_tp7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l3_tp7 -> SplitHeads_s0_l3_tp7;
  A2A_s0_l3 [shape=ellipse, label="AllToAll\nstage0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_s0_l3_tp0 -> A2A_s0_l3;
  SplitHeads_s0_l3_tp1 -> A2A_s0_l3;
  SplitHeads_s0_l3_tp2 -> A2A_s0_l3;
  SplitHeads_s0_l3_tp3 -> A2A_s0_l3;
  SplitHeads_s0_l3_tp4 -> A2A_s0_l3;
  SplitHeads_s0_l3_tp5 -> A2A_s0_l3;
  SplitHeads_s0_l3_tp6 -> A2A_s0_l3;
  SplitHeads_s0_l3_tp7 -> A2A_s0_l3;
  Attn_s0_l3_tp0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l3 -> Attn_s0_l3_tp0;
  Attn_s0_l3_tp1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l3 -> Attn_s0_l3_tp1;
  Attn_s0_l3_tp2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l3 -> Attn_s0_l3_tp2;
  Attn_s0_l3_tp3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l3 -> Attn_s0_l3_tp3;
  Attn_s0_l3_tp4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l3 -> Attn_s0_l3_tp4;
  Attn_s0_l3_tp5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l3 -> Attn_s0_l3_tp5;
  Attn_s0_l3_tp6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l3 -> Attn_s0_l3_tp6;
  Attn_s0_l3_tp7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l3 -> Attn_s0_l3_tp7;
  AR_attn_s0_l3 [shape=ellipse, label="AllReduce\nstage0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_s0_l3_tp0 -> AR_attn_s0_l3;
  Attn_s0_l3_tp1 -> AR_attn_s0_l3;
  Attn_s0_l3_tp2 -> AR_attn_s0_l3;
  Attn_s0_l3_tp3 -> AR_attn_s0_l3;
  Attn_s0_l3_tp4 -> AR_attn_s0_l3;
  Attn_s0_l3_tp5 -> AR_attn_s0_l3;
  Attn_s0_l3_tp6 -> AR_attn_s0_l3;
  Attn_s0_l3_tp7 -> AR_attn_s0_l3;
  O_s0_l3_tp0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l3 -> O_s0_l3_tp0;
  O_s0_l3_tp1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l3 -> O_s0_l3_tp1;
  O_s0_l3_tp2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l3 -> O_s0_l3_tp2;
  O_s0_l3_tp3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l3 -> O_s0_l3_tp3;
  O_s0_l3_tp4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l3 -> O_s0_l3_tp4;
  O_s0_l3_tp5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l3 -> O_s0_l3_tp5;
  O_s0_l3_tp6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l3 -> O_s0_l3_tp6;
  O_s0_l3_tp7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l3 -> O_s0_l3_tp7;
  ResAttn_s0_l3_tp0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l3_tp0 -> ResAttn_s0_l3_tp0;
  ResMOE_s0_l2_tp0 -> ResAttn_s0_l3_tp0;
  ResAttn_s0_l3_tp1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l3_tp1 -> ResAttn_s0_l3_tp1;
  ResMOE_s0_l2_tp0 -> ResAttn_s0_l3_tp1;
  ResAttn_s0_l3_tp2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l3_tp2 -> ResAttn_s0_l3_tp2;
  ResMOE_s0_l2_tp0 -> ResAttn_s0_l3_tp2;
  ResAttn_s0_l3_tp3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l3_tp3 -> ResAttn_s0_l3_tp3;
  ResMOE_s0_l2_tp0 -> ResAttn_s0_l3_tp3;
  ResAttn_s0_l3_tp4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l3_tp4 -> ResAttn_s0_l3_tp4;
  ResMOE_s0_l2_tp0 -> ResAttn_s0_l3_tp4;
  ResAttn_s0_l3_tp5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l3_tp5 -> ResAttn_s0_l3_tp5;
  ResMOE_s0_l2_tp0 -> ResAttn_s0_l3_tp5;
  ResAttn_s0_l3_tp6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l3_tp6 -> ResAttn_s0_l3_tp6;
  ResMOE_s0_l2_tp0 -> ResAttn_s0_l3_tp6;
  ResAttn_s0_l3_tp7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l3_tp7 -> ResAttn_s0_l3_tp7;
  ResMOE_s0_l2_tp0 -> ResAttn_s0_l3_tp7;
  Gate_s0_l3_tp0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l3_tp0 -> Gate_s0_l3_tp0;
  Gate_s0_l3_tp1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l3_tp1 -> Gate_s0_l3_tp1;
  Gate_s0_l3_tp2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l3_tp2 -> Gate_s0_l3_tp2;
  Gate_s0_l3_tp3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l3_tp3 -> Gate_s0_l3_tp3;
  Gate_s0_l3_tp4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l3_tp4 -> Gate_s0_l3_tp4;
  Gate_s0_l3_tp5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l3_tp5 -> Gate_s0_l3_tp5;
  Gate_s0_l3_tp6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l3_tp6 -> Gate_s0_l3_tp6;
  Gate_s0_l3_tp7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l3_tp7 -> Gate_s0_l3_tp7;
  Expert0_s0_l3_tp0 [label="Expert0\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp0 -> Expert0_s0_l3_tp0 [style=dashed];
  Expert1_s0_l3_tp0 [label="Expert1\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp0 -> Expert1_s0_l3_tp0 [style=dashed];
  Expert2_s0_l3_tp0 [label="Expert2\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp0 -> Expert2_s0_l3_tp0 [style=dashed];
  Expert3_s0_l3_tp0 [label="Expert3\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp0 -> Expert3_s0_l3_tp0 [style=dashed];
  Expert4_s0_l3_tp1 [label="Expert4\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp1 -> Expert4_s0_l3_tp1 [style=dashed];
  Expert5_s0_l3_tp1 [label="Expert5\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp1 -> Expert5_s0_l3_tp1 [style=dashed];
  Expert6_s0_l3_tp1 [label="Expert6\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp1 -> Expert6_s0_l3_tp1 [style=dashed];
  Expert7_s0_l3_tp1 [label="Expert7\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp1 -> Expert7_s0_l3_tp1 [style=dashed];
  Expert8_s0_l3_tp2 [label="Expert8\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp2 -> Expert8_s0_l3_tp2 [style=dashed];
  Expert9_s0_l3_tp2 [label="Expert9\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp2 -> Expert9_s0_l3_tp2 [style=dashed];
  Expert10_s0_l3_tp2 [label="Expert10\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp2 -> Expert10_s0_l3_tp2 [style=dashed];
  Expert11_s0_l3_tp2 [label="Expert11\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp2 -> Expert11_s0_l3_tp2 [style=dashed];
  Expert12_s0_l3_tp3 [label="Expert12\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp3 -> Expert12_s0_l3_tp3 [style=dashed];
  Expert13_s0_l3_tp3 [label="Expert13\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp3 -> Expert13_s0_l3_tp3 [style=dashed];
  Expert14_s0_l3_tp3 [label="Expert14\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp3 -> Expert14_s0_l3_tp3 [style=dashed];
  Expert15_s0_l3_tp3 [label="Expert15\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp3 -> Expert15_s0_l3_tp3 [style=dashed];
  Expert16_s0_l3_tp4 [label="Expert16\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp4 -> Expert16_s0_l3_tp4 [style=dashed];
  Expert17_s0_l3_tp4 [label="Expert17\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp4 -> Expert17_s0_l3_tp4 [style=dashed];
  Expert18_s0_l3_tp4 [label="Expert18\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp4 -> Expert18_s0_l3_tp4 [style=dashed];
  Expert19_s0_l3_tp4 [label="Expert19\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp4 -> Expert19_s0_l3_tp4 [style=dashed];
  Expert20_s0_l3_tp5 [label="Expert20\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp5 -> Expert20_s0_l3_tp5 [style=dashed];
  Expert21_s0_l3_tp5 [label="Expert21\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp5 -> Expert21_s0_l3_tp5 [style=dashed];
  Expert22_s0_l3_tp5 [label="Expert22\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp5 -> Expert22_s0_l3_tp5 [style=dashed];
  Expert23_s0_l3_tp5 [label="Expert23\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp5 -> Expert23_s0_l3_tp5 [style=dashed];
  Expert24_s0_l3_tp6 [label="Expert24\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp6 -> Expert24_s0_l3_tp6 [style=dashed];
  Expert25_s0_l3_tp6 [label="Expert25\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp6 -> Expert25_s0_l3_tp6 [style=dashed];
  Expert26_s0_l3_tp6 [label="Expert26\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp6 -> Expert26_s0_l3_tp6 [style=dashed];
  Expert27_s0_l3_tp6 [label="Expert27\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp6 -> Expert27_s0_l3_tp6 [style=dashed];
  Expert28_s0_l3_tp7 [label="Expert28\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp7 -> Expert28_s0_l3_tp7 [style=dashed];
  Expert29_s0_l3_tp7 [label="Expert29\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp7 -> Expert29_s0_l3_tp7 [style=dashed];
  Expert30_s0_l3_tp7 [label="Expert30\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp7 -> Expert30_s0_l3_tp7 [style=dashed];
  Expert31_s0_l3_tp7 [label="Expert31\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l3_tp7 -> Expert31_s0_l3_tp7 [style=dashed];
  AR_exp_s0_l3 [shape=ellipse, label="AllReduceExperts\nstage0\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert0_s0_l3_tp0 -> AR_exp_s0_l3;
  Expert1_s0_l3_tp0 -> AR_exp_s0_l3;
  Expert2_s0_l3_tp0 -> AR_exp_s0_l3;
  Expert3_s0_l3_tp0 -> AR_exp_s0_l3;
  Expert4_s0_l3_tp1 -> AR_exp_s0_l3;
  Expert5_s0_l3_tp1 -> AR_exp_s0_l3;
  Expert6_s0_l3_tp1 -> AR_exp_s0_l3;
  Expert7_s0_l3_tp1 -> AR_exp_s0_l3;
  Expert8_s0_l3_tp2 -> AR_exp_s0_l3;
  Expert9_s0_l3_tp2 -> AR_exp_s0_l3;
  Expert10_s0_l3_tp2 -> AR_exp_s0_l3;
  Expert11_s0_l3_tp2 -> AR_exp_s0_l3;
  Expert12_s0_l3_tp3 -> AR_exp_s0_l3;
  Expert13_s0_l3_tp3 -> AR_exp_s0_l3;
  Expert14_s0_l3_tp3 -> AR_exp_s0_l3;
  Expert15_s0_l3_tp3 -> AR_exp_s0_l3;
  Expert16_s0_l3_tp4 -> AR_exp_s0_l3;
  Expert17_s0_l3_tp4 -> AR_exp_s0_l3;
  Expert18_s0_l3_tp4 -> AR_exp_s0_l3;
  Expert19_s0_l3_tp4 -> AR_exp_s0_l3;
  Expert20_s0_l3_tp5 -> AR_exp_s0_l3;
  Expert21_s0_l3_tp5 -> AR_exp_s0_l3;
  Expert22_s0_l3_tp5 -> AR_exp_s0_l3;
  Expert23_s0_l3_tp5 -> AR_exp_s0_l3;
  Expert24_s0_l3_tp6 -> AR_exp_s0_l3;
  Expert25_s0_l3_tp6 -> AR_exp_s0_l3;
  Expert26_s0_l3_tp6 -> AR_exp_s0_l3;
  Expert27_s0_l3_tp6 -> AR_exp_s0_l3;
  Expert28_s0_l3_tp7 -> AR_exp_s0_l3;
  Expert29_s0_l3_tp7 -> AR_exp_s0_l3;
  Expert30_s0_l3_tp7 -> AR_exp_s0_l3;
  Expert31_s0_l3_tp7 -> AR_exp_s0_l3;
  ResMOE_s0_l3_tp0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l3 -> ResMOE_s0_l3_tp0;
  ResAttn_s0_l3_tp0 -> ResMOE_s0_l3_tp0;
  ResMOE_s0_l3_tp1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l3 -> ResMOE_s0_l3_tp1;
  ResAttn_s0_l3_tp1 -> ResMOE_s0_l3_tp1;
  ResMOE_s0_l3_tp2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l3 -> ResMOE_s0_l3_tp2;
  ResAttn_s0_l3_tp2 -> ResMOE_s0_l3_tp2;
  ResMOE_s0_l3_tp3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l3 -> ResMOE_s0_l3_tp3;
  ResAttn_s0_l3_tp3 -> ResMOE_s0_l3_tp3;
  ResMOE_s0_l3_tp4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l3 -> ResMOE_s0_l3_tp4;
  ResAttn_s0_l3_tp4 -> ResMOE_s0_l3_tp4;
  ResMOE_s0_l3_tp5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l3 -> ResMOE_s0_l3_tp5;
  ResAttn_s0_l3_tp5 -> ResMOE_s0_l3_tp5;
  ResMOE_s0_l3_tp6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l3 -> ResMOE_s0_l3_tp6;
  ResAttn_s0_l3_tp6 -> ResMOE_s0_l3_tp6;
  ResMOE_s0_l3_tp7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l3 -> ResMOE_s0_l3_tp7;
  ResAttn_s0_l3_tp7 -> ResMOE_s0_l3_tp7;
  QKV_s0_l4_tp0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l3_tp0 -> QKV_s0_l4_tp0;
  QKV_s0_l4_tp1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l3_tp0 -> QKV_s0_l4_tp1;
  QKV_s0_l4_tp2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l3_tp0 -> QKV_s0_l4_tp2;
  QKV_s0_l4_tp3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l3_tp0 -> QKV_s0_l4_tp3;
  QKV_s0_l4_tp4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l3_tp0 -> QKV_s0_l4_tp4;
  QKV_s0_l4_tp5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l3_tp0 -> QKV_s0_l4_tp5;
  QKV_s0_l4_tp6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l3_tp0 -> QKV_s0_l4_tp6;
  QKV_s0_l4_tp7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l3_tp0 -> QKV_s0_l4_tp7;
  SplitHeads_s0_l4_tp0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l4_tp0 -> SplitHeads_s0_l4_tp0;
  SplitHeads_s0_l4_tp1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l4_tp1 -> SplitHeads_s0_l4_tp1;
  SplitHeads_s0_l4_tp2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l4_tp2 -> SplitHeads_s0_l4_tp2;
  SplitHeads_s0_l4_tp3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l4_tp3 -> SplitHeads_s0_l4_tp3;
  SplitHeads_s0_l4_tp4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l4_tp4 -> SplitHeads_s0_l4_tp4;
  SplitHeads_s0_l4_tp5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l4_tp5 -> SplitHeads_s0_l4_tp5;
  SplitHeads_s0_l4_tp6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l4_tp6 -> SplitHeads_s0_l4_tp6;
  SplitHeads_s0_l4_tp7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l4_tp7 -> SplitHeads_s0_l4_tp7;
  A2A_s0_l4 [shape=ellipse, label="AllToAll\nstage0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_s0_l4_tp0 -> A2A_s0_l4;
  SplitHeads_s0_l4_tp1 -> A2A_s0_l4;
  SplitHeads_s0_l4_tp2 -> A2A_s0_l4;
  SplitHeads_s0_l4_tp3 -> A2A_s0_l4;
  SplitHeads_s0_l4_tp4 -> A2A_s0_l4;
  SplitHeads_s0_l4_tp5 -> A2A_s0_l4;
  SplitHeads_s0_l4_tp6 -> A2A_s0_l4;
  SplitHeads_s0_l4_tp7 -> A2A_s0_l4;
  Attn_s0_l4_tp0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l4 -> Attn_s0_l4_tp0;
  Attn_s0_l4_tp1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l4 -> Attn_s0_l4_tp1;
  Attn_s0_l4_tp2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l4 -> Attn_s0_l4_tp2;
  Attn_s0_l4_tp3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l4 -> Attn_s0_l4_tp3;
  Attn_s0_l4_tp4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l4 -> Attn_s0_l4_tp4;
  Attn_s0_l4_tp5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l4 -> Attn_s0_l4_tp5;
  Attn_s0_l4_tp6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l4 -> Attn_s0_l4_tp6;
  Attn_s0_l4_tp7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l4 -> Attn_s0_l4_tp7;
  AR_attn_s0_l4 [shape=ellipse, label="AllReduce\nstage0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_s0_l4_tp0 -> AR_attn_s0_l4;
  Attn_s0_l4_tp1 -> AR_attn_s0_l4;
  Attn_s0_l4_tp2 -> AR_attn_s0_l4;
  Attn_s0_l4_tp3 -> AR_attn_s0_l4;
  Attn_s0_l4_tp4 -> AR_attn_s0_l4;
  Attn_s0_l4_tp5 -> AR_attn_s0_l4;
  Attn_s0_l4_tp6 -> AR_attn_s0_l4;
  Attn_s0_l4_tp7 -> AR_attn_s0_l4;
  O_s0_l4_tp0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l4 -> O_s0_l4_tp0;
  O_s0_l4_tp1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l4 -> O_s0_l4_tp1;
  O_s0_l4_tp2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l4 -> O_s0_l4_tp2;
  O_s0_l4_tp3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l4 -> O_s0_l4_tp3;
  O_s0_l4_tp4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l4 -> O_s0_l4_tp4;
  O_s0_l4_tp5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l4 -> O_s0_l4_tp5;
  O_s0_l4_tp6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l4 -> O_s0_l4_tp6;
  O_s0_l4_tp7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l4 -> O_s0_l4_tp7;
  ResAttn_s0_l4_tp0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l4_tp0 -> ResAttn_s0_l4_tp0;
  ResMOE_s0_l3_tp0 -> ResAttn_s0_l4_tp0;
  ResAttn_s0_l4_tp1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l4_tp1 -> ResAttn_s0_l4_tp1;
  ResMOE_s0_l3_tp0 -> ResAttn_s0_l4_tp1;
  ResAttn_s0_l4_tp2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l4_tp2 -> ResAttn_s0_l4_tp2;
  ResMOE_s0_l3_tp0 -> ResAttn_s0_l4_tp2;
  ResAttn_s0_l4_tp3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l4_tp3 -> ResAttn_s0_l4_tp3;
  ResMOE_s0_l3_tp0 -> ResAttn_s0_l4_tp3;
  ResAttn_s0_l4_tp4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l4_tp4 -> ResAttn_s0_l4_tp4;
  ResMOE_s0_l3_tp0 -> ResAttn_s0_l4_tp4;
  ResAttn_s0_l4_tp5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l4_tp5 -> ResAttn_s0_l4_tp5;
  ResMOE_s0_l3_tp0 -> ResAttn_s0_l4_tp5;
  ResAttn_s0_l4_tp6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l4_tp6 -> ResAttn_s0_l4_tp6;
  ResMOE_s0_l3_tp0 -> ResAttn_s0_l4_tp6;
  ResAttn_s0_l4_tp7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l4_tp7 -> ResAttn_s0_l4_tp7;
  ResMOE_s0_l3_tp0 -> ResAttn_s0_l4_tp7;
  Gate_s0_l4_tp0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l4_tp0 -> Gate_s0_l4_tp0;
  Gate_s0_l4_tp1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l4_tp1 -> Gate_s0_l4_tp1;
  Gate_s0_l4_tp2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l4_tp2 -> Gate_s0_l4_tp2;
  Gate_s0_l4_tp3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l4_tp3 -> Gate_s0_l4_tp3;
  Gate_s0_l4_tp4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l4_tp4 -> Gate_s0_l4_tp4;
  Gate_s0_l4_tp5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l4_tp5 -> Gate_s0_l4_tp5;
  Gate_s0_l4_tp6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l4_tp6 -> Gate_s0_l4_tp6;
  Gate_s0_l4_tp7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l4_tp7 -> Gate_s0_l4_tp7;
  Expert0_s0_l4_tp0 [label="Expert0\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp0 -> Expert0_s0_l4_tp0 [style=dashed];
  Expert1_s0_l4_tp0 [label="Expert1\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp0 -> Expert1_s0_l4_tp0 [style=dashed];
  Expert2_s0_l4_tp0 [label="Expert2\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp0 -> Expert2_s0_l4_tp0 [style=dashed];
  Expert3_s0_l4_tp0 [label="Expert3\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp0 -> Expert3_s0_l4_tp0 [style=dashed];
  Expert4_s0_l4_tp1 [label="Expert4\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp1 -> Expert4_s0_l4_tp1 [style=dashed];
  Expert5_s0_l4_tp1 [label="Expert5\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp1 -> Expert5_s0_l4_tp1 [style=dashed];
  Expert6_s0_l4_tp1 [label="Expert6\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp1 -> Expert6_s0_l4_tp1 [style=dashed];
  Expert7_s0_l4_tp1 [label="Expert7\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp1 -> Expert7_s0_l4_tp1 [style=dashed];
  Expert8_s0_l4_tp2 [label="Expert8\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp2 -> Expert8_s0_l4_tp2 [style=dashed];
  Expert9_s0_l4_tp2 [label="Expert9\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp2 -> Expert9_s0_l4_tp2 [style=dashed];
  Expert10_s0_l4_tp2 [label="Expert10\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp2 -> Expert10_s0_l4_tp2 [style=dashed];
  Expert11_s0_l4_tp2 [label="Expert11\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp2 -> Expert11_s0_l4_tp2 [style=dashed];
  Expert12_s0_l4_tp3 [label="Expert12\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp3 -> Expert12_s0_l4_tp3 [style=dashed];
  Expert13_s0_l4_tp3 [label="Expert13\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp3 -> Expert13_s0_l4_tp3 [style=dashed];
  Expert14_s0_l4_tp3 [label="Expert14\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp3 -> Expert14_s0_l4_tp3 [style=dashed];
  Expert15_s0_l4_tp3 [label="Expert15\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp3 -> Expert15_s0_l4_tp3 [style=dashed];
  Expert16_s0_l4_tp4 [label="Expert16\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp4 -> Expert16_s0_l4_tp4 [style=dashed];
  Expert17_s0_l4_tp4 [label="Expert17\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp4 -> Expert17_s0_l4_tp4 [style=dashed];
  Expert18_s0_l4_tp4 [label="Expert18\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp4 -> Expert18_s0_l4_tp4 [style=dashed];
  Expert19_s0_l4_tp4 [label="Expert19\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp4 -> Expert19_s0_l4_tp4 [style=dashed];
  Expert20_s0_l4_tp5 [label="Expert20\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp5 -> Expert20_s0_l4_tp5 [style=dashed];
  Expert21_s0_l4_tp5 [label="Expert21\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp5 -> Expert21_s0_l4_tp5 [style=dashed];
  Expert22_s0_l4_tp5 [label="Expert22\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp5 -> Expert22_s0_l4_tp5 [style=dashed];
  Expert23_s0_l4_tp5 [label="Expert23\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp5 -> Expert23_s0_l4_tp5 [style=dashed];
  Expert24_s0_l4_tp6 [label="Expert24\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp6 -> Expert24_s0_l4_tp6 [style=dashed];
  Expert25_s0_l4_tp6 [label="Expert25\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp6 -> Expert25_s0_l4_tp6 [style=dashed];
  Expert26_s0_l4_tp6 [label="Expert26\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp6 -> Expert26_s0_l4_tp6 [style=dashed];
  Expert27_s0_l4_tp6 [label="Expert27\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp6 -> Expert27_s0_l4_tp6 [style=dashed];
  Expert28_s0_l4_tp7 [label="Expert28\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp7 -> Expert28_s0_l4_tp7 [style=dashed];
  Expert29_s0_l4_tp7 [label="Expert29\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp7 -> Expert29_s0_l4_tp7 [style=dashed];
  Expert30_s0_l4_tp7 [label="Expert30\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp7 -> Expert30_s0_l4_tp7 [style=dashed];
  Expert31_s0_l4_tp7 [label="Expert31\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l4_tp7 -> Expert31_s0_l4_tp7 [style=dashed];
  AR_exp_s0_l4 [shape=ellipse, label="AllReduceExperts\nstage0\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert0_s0_l4_tp0 -> AR_exp_s0_l4;
  Expert1_s0_l4_tp0 -> AR_exp_s0_l4;
  Expert2_s0_l4_tp0 -> AR_exp_s0_l4;
  Expert3_s0_l4_tp0 -> AR_exp_s0_l4;
  Expert4_s0_l4_tp1 -> AR_exp_s0_l4;
  Expert5_s0_l4_tp1 -> AR_exp_s0_l4;
  Expert6_s0_l4_tp1 -> AR_exp_s0_l4;
  Expert7_s0_l4_tp1 -> AR_exp_s0_l4;
  Expert8_s0_l4_tp2 -> AR_exp_s0_l4;
  Expert9_s0_l4_tp2 -> AR_exp_s0_l4;
  Expert10_s0_l4_tp2 -> AR_exp_s0_l4;
  Expert11_s0_l4_tp2 -> AR_exp_s0_l4;
  Expert12_s0_l4_tp3 -> AR_exp_s0_l4;
  Expert13_s0_l4_tp3 -> AR_exp_s0_l4;
  Expert14_s0_l4_tp3 -> AR_exp_s0_l4;
  Expert15_s0_l4_tp3 -> AR_exp_s0_l4;
  Expert16_s0_l4_tp4 -> AR_exp_s0_l4;
  Expert17_s0_l4_tp4 -> AR_exp_s0_l4;
  Expert18_s0_l4_tp4 -> AR_exp_s0_l4;
  Expert19_s0_l4_tp4 -> AR_exp_s0_l4;
  Expert20_s0_l4_tp5 -> AR_exp_s0_l4;
  Expert21_s0_l4_tp5 -> AR_exp_s0_l4;
  Expert22_s0_l4_tp5 -> AR_exp_s0_l4;
  Expert23_s0_l4_tp5 -> AR_exp_s0_l4;
  Expert24_s0_l4_tp6 -> AR_exp_s0_l4;
  Expert25_s0_l4_tp6 -> AR_exp_s0_l4;
  Expert26_s0_l4_tp6 -> AR_exp_s0_l4;
  Expert27_s0_l4_tp6 -> AR_exp_s0_l4;
  Expert28_s0_l4_tp7 -> AR_exp_s0_l4;
  Expert29_s0_l4_tp7 -> AR_exp_s0_l4;
  Expert30_s0_l4_tp7 -> AR_exp_s0_l4;
  Expert31_s0_l4_tp7 -> AR_exp_s0_l4;
  ResMOE_s0_l4_tp0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l4 -> ResMOE_s0_l4_tp0;
  ResAttn_s0_l4_tp0 -> ResMOE_s0_l4_tp0;
  ResMOE_s0_l4_tp1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l4 -> ResMOE_s0_l4_tp1;
  ResAttn_s0_l4_tp1 -> ResMOE_s0_l4_tp1;
  ResMOE_s0_l4_tp2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l4 -> ResMOE_s0_l4_tp2;
  ResAttn_s0_l4_tp2 -> ResMOE_s0_l4_tp2;
  ResMOE_s0_l4_tp3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l4 -> ResMOE_s0_l4_tp3;
  ResAttn_s0_l4_tp3 -> ResMOE_s0_l4_tp3;
  ResMOE_s0_l4_tp4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l4 -> ResMOE_s0_l4_tp4;
  ResAttn_s0_l4_tp4 -> ResMOE_s0_l4_tp4;
  ResMOE_s0_l4_tp5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l4 -> ResMOE_s0_l4_tp5;
  ResAttn_s0_l4_tp5 -> ResMOE_s0_l4_tp5;
  ResMOE_s0_l4_tp6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l4 -> ResMOE_s0_l4_tp6;
  ResAttn_s0_l4_tp6 -> ResMOE_s0_l4_tp6;
  ResMOE_s0_l4_tp7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l4 -> ResMOE_s0_l4_tp7;
  ResAttn_s0_l4_tp7 -> ResMOE_s0_l4_tp7;
  QKV_s0_l5_tp0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l4_tp0 -> QKV_s0_l5_tp0;
  QKV_s0_l5_tp1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l4_tp0 -> QKV_s0_l5_tp1;
  QKV_s0_l5_tp2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l4_tp0 -> QKV_s0_l5_tp2;
  QKV_s0_l5_tp3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l4_tp0 -> QKV_s0_l5_tp3;
  QKV_s0_l5_tp4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l4_tp0 -> QKV_s0_l5_tp4;
  QKV_s0_l5_tp5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l4_tp0 -> QKV_s0_l5_tp5;
  QKV_s0_l5_tp6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l4_tp0 -> QKV_s0_l5_tp6;
  QKV_s0_l5_tp7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l4_tp0 -> QKV_s0_l5_tp7;
  SplitHeads_s0_l5_tp0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l5_tp0 -> SplitHeads_s0_l5_tp0;
  SplitHeads_s0_l5_tp1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l5_tp1 -> SplitHeads_s0_l5_tp1;
  SplitHeads_s0_l5_tp2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l5_tp2 -> SplitHeads_s0_l5_tp2;
  SplitHeads_s0_l5_tp3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l5_tp3 -> SplitHeads_s0_l5_tp3;
  SplitHeads_s0_l5_tp4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l5_tp4 -> SplitHeads_s0_l5_tp4;
  SplitHeads_s0_l5_tp5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l5_tp5 -> SplitHeads_s0_l5_tp5;
  SplitHeads_s0_l5_tp6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l5_tp6 -> SplitHeads_s0_l5_tp6;
  SplitHeads_s0_l5_tp7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l5_tp7 -> SplitHeads_s0_l5_tp7;
  A2A_s0_l5 [shape=ellipse, label="AllToAll\nstage0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_s0_l5_tp0 -> A2A_s0_l5;
  SplitHeads_s0_l5_tp1 -> A2A_s0_l5;
  SplitHeads_s0_l5_tp2 -> A2A_s0_l5;
  SplitHeads_s0_l5_tp3 -> A2A_s0_l5;
  SplitHeads_s0_l5_tp4 -> A2A_s0_l5;
  SplitHeads_s0_l5_tp5 -> A2A_s0_l5;
  SplitHeads_s0_l5_tp6 -> A2A_s0_l5;
  SplitHeads_s0_l5_tp7 -> A2A_s0_l5;
  Attn_s0_l5_tp0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l5 -> Attn_s0_l5_tp0;
  Attn_s0_l5_tp1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l5 -> Attn_s0_l5_tp1;
  Attn_s0_l5_tp2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l5 -> Attn_s0_l5_tp2;
  Attn_s0_l5_tp3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l5 -> Attn_s0_l5_tp3;
  Attn_s0_l5_tp4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l5 -> Attn_s0_l5_tp4;
  Attn_s0_l5_tp5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l5 -> Attn_s0_l5_tp5;
  Attn_s0_l5_tp6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l5 -> Attn_s0_l5_tp6;
  Attn_s0_l5_tp7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l5 -> Attn_s0_l5_tp7;
  AR_attn_s0_l5 [shape=ellipse, label="AllReduce\nstage0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_s0_l5_tp0 -> AR_attn_s0_l5;
  Attn_s0_l5_tp1 -> AR_attn_s0_l5;
  Attn_s0_l5_tp2 -> AR_attn_s0_l5;
  Attn_s0_l5_tp3 -> AR_attn_s0_l5;
  Attn_s0_l5_tp4 -> AR_attn_s0_l5;
  Attn_s0_l5_tp5 -> AR_attn_s0_l5;
  Attn_s0_l5_tp6 -> AR_attn_s0_l5;
  Attn_s0_l5_tp7 -> AR_attn_s0_l5;
  O_s0_l5_tp0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l5 -> O_s0_l5_tp0;
  O_s0_l5_tp1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l5 -> O_s0_l5_tp1;
  O_s0_l5_tp2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l5 -> O_s0_l5_tp2;
  O_s0_l5_tp3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l5 -> O_s0_l5_tp3;
  O_s0_l5_tp4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l5 -> O_s0_l5_tp4;
  O_s0_l5_tp5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l5 -> O_s0_l5_tp5;
  O_s0_l5_tp6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l5 -> O_s0_l5_tp6;
  O_s0_l5_tp7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l5 -> O_s0_l5_tp7;
  ResAttn_s0_l5_tp0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l5_tp0 -> ResAttn_s0_l5_tp0;
  ResMOE_s0_l4_tp0 -> ResAttn_s0_l5_tp0;
  ResAttn_s0_l5_tp1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l5_tp1 -> ResAttn_s0_l5_tp1;
  ResMOE_s0_l4_tp0 -> ResAttn_s0_l5_tp1;
  ResAttn_s0_l5_tp2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l5_tp2 -> ResAttn_s0_l5_tp2;
  ResMOE_s0_l4_tp0 -> ResAttn_s0_l5_tp2;
  ResAttn_s0_l5_tp3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l5_tp3 -> ResAttn_s0_l5_tp3;
  ResMOE_s0_l4_tp0 -> ResAttn_s0_l5_tp3;
  ResAttn_s0_l5_tp4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l5_tp4 -> ResAttn_s0_l5_tp4;
  ResMOE_s0_l4_tp0 -> ResAttn_s0_l5_tp4;
  ResAttn_s0_l5_tp5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l5_tp5 -> ResAttn_s0_l5_tp5;
  ResMOE_s0_l4_tp0 -> ResAttn_s0_l5_tp5;
  ResAttn_s0_l5_tp6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l5_tp6 -> ResAttn_s0_l5_tp6;
  ResMOE_s0_l4_tp0 -> ResAttn_s0_l5_tp6;
  ResAttn_s0_l5_tp7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l5_tp7 -> ResAttn_s0_l5_tp7;
  ResMOE_s0_l4_tp0 -> ResAttn_s0_l5_tp7;
  Gate_s0_l5_tp0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l5_tp0 -> Gate_s0_l5_tp0;
  Gate_s0_l5_tp1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l5_tp1 -> Gate_s0_l5_tp1;
  Gate_s0_l5_tp2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l5_tp2 -> Gate_s0_l5_tp2;
  Gate_s0_l5_tp3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l5_tp3 -> Gate_s0_l5_tp3;
  Gate_s0_l5_tp4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l5_tp4 -> Gate_s0_l5_tp4;
  Gate_s0_l5_tp5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l5_tp5 -> Gate_s0_l5_tp5;
  Gate_s0_l5_tp6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l5_tp6 -> Gate_s0_l5_tp6;
  Gate_s0_l5_tp7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l5_tp7 -> Gate_s0_l5_tp7;
  Expert0_s0_l5_tp0 [label="Expert0\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp0 -> Expert0_s0_l5_tp0 [style=dashed];
  Expert1_s0_l5_tp0 [label="Expert1\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp0 -> Expert1_s0_l5_tp0 [style=dashed];
  Expert2_s0_l5_tp0 [label="Expert2\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp0 -> Expert2_s0_l5_tp0 [style=dashed];
  Expert3_s0_l5_tp0 [label="Expert3\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp0 -> Expert3_s0_l5_tp0 [style=dashed];
  Expert4_s0_l5_tp1 [label="Expert4\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp1 -> Expert4_s0_l5_tp1 [style=dashed];
  Expert5_s0_l5_tp1 [label="Expert5\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp1 -> Expert5_s0_l5_tp1 [style=dashed];
  Expert6_s0_l5_tp1 [label="Expert6\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp1 -> Expert6_s0_l5_tp1 [style=dashed];
  Expert7_s0_l5_tp1 [label="Expert7\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp1 -> Expert7_s0_l5_tp1 [style=dashed];
  Expert8_s0_l5_tp2 [label="Expert8\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp2 -> Expert8_s0_l5_tp2 [style=dashed];
  Expert9_s0_l5_tp2 [label="Expert9\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp2 -> Expert9_s0_l5_tp2 [style=dashed];
  Expert10_s0_l5_tp2 [label="Expert10\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp2 -> Expert10_s0_l5_tp2 [style=dashed];
  Expert11_s0_l5_tp2 [label="Expert11\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp2 -> Expert11_s0_l5_tp2 [style=dashed];
  Expert12_s0_l5_tp3 [label="Expert12\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp3 -> Expert12_s0_l5_tp3 [style=dashed];
  Expert13_s0_l5_tp3 [label="Expert13\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp3 -> Expert13_s0_l5_tp3 [style=dashed];
  Expert14_s0_l5_tp3 [label="Expert14\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp3 -> Expert14_s0_l5_tp3 [style=dashed];
  Expert15_s0_l5_tp3 [label="Expert15\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp3 -> Expert15_s0_l5_tp3 [style=dashed];
  Expert16_s0_l5_tp4 [label="Expert16\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp4 -> Expert16_s0_l5_tp4 [style=dashed];
  Expert17_s0_l5_tp4 [label="Expert17\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp4 -> Expert17_s0_l5_tp4 [style=dashed];
  Expert18_s0_l5_tp4 [label="Expert18\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp4 -> Expert18_s0_l5_tp4 [style=dashed];
  Expert19_s0_l5_tp4 [label="Expert19\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp4 -> Expert19_s0_l5_tp4 [style=dashed];
  Expert20_s0_l5_tp5 [label="Expert20\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp5 -> Expert20_s0_l5_tp5 [style=dashed];
  Expert21_s0_l5_tp5 [label="Expert21\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp5 -> Expert21_s0_l5_tp5 [style=dashed];
  Expert22_s0_l5_tp5 [label="Expert22\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp5 -> Expert22_s0_l5_tp5 [style=dashed];
  Expert23_s0_l5_tp5 [label="Expert23\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp5 -> Expert23_s0_l5_tp5 [style=dashed];
  Expert24_s0_l5_tp6 [label="Expert24\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp6 -> Expert24_s0_l5_tp6 [style=dashed];
  Expert25_s0_l5_tp6 [label="Expert25\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp6 -> Expert25_s0_l5_tp6 [style=dashed];
  Expert26_s0_l5_tp6 [label="Expert26\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp6 -> Expert26_s0_l5_tp6 [style=dashed];
  Expert27_s0_l5_tp6 [label="Expert27\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp6 -> Expert27_s0_l5_tp6 [style=dashed];
  Expert28_s0_l5_tp7 [label="Expert28\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp7 -> Expert28_s0_l5_tp7 [style=dashed];
  Expert29_s0_l5_tp7 [label="Expert29\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp7 -> Expert29_s0_l5_tp7 [style=dashed];
  Expert30_s0_l5_tp7 [label="Expert30\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp7 -> Expert30_s0_l5_tp7 [style=dashed];
  Expert31_s0_l5_tp7 [label="Expert31\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l5_tp7 -> Expert31_s0_l5_tp7 [style=dashed];
  AR_exp_s0_l5 [shape=ellipse, label="AllReduceExperts\nstage0\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert0_s0_l5_tp0 -> AR_exp_s0_l5;
  Expert1_s0_l5_tp0 -> AR_exp_s0_l5;
  Expert2_s0_l5_tp0 -> AR_exp_s0_l5;
  Expert3_s0_l5_tp0 -> AR_exp_s0_l5;
  Expert4_s0_l5_tp1 -> AR_exp_s0_l5;
  Expert5_s0_l5_tp1 -> AR_exp_s0_l5;
  Expert6_s0_l5_tp1 -> AR_exp_s0_l5;
  Expert7_s0_l5_tp1 -> AR_exp_s0_l5;
  Expert8_s0_l5_tp2 -> AR_exp_s0_l5;
  Expert9_s0_l5_tp2 -> AR_exp_s0_l5;
  Expert10_s0_l5_tp2 -> AR_exp_s0_l5;
  Expert11_s0_l5_tp2 -> AR_exp_s0_l5;
  Expert12_s0_l5_tp3 -> AR_exp_s0_l5;
  Expert13_s0_l5_tp3 -> AR_exp_s0_l5;
  Expert14_s0_l5_tp3 -> AR_exp_s0_l5;
  Expert15_s0_l5_tp3 -> AR_exp_s0_l5;
  Expert16_s0_l5_tp4 -> AR_exp_s0_l5;
  Expert17_s0_l5_tp4 -> AR_exp_s0_l5;
  Expert18_s0_l5_tp4 -> AR_exp_s0_l5;
  Expert19_s0_l5_tp4 -> AR_exp_s0_l5;
  Expert20_s0_l5_tp5 -> AR_exp_s0_l5;
  Expert21_s0_l5_tp5 -> AR_exp_s0_l5;
  Expert22_s0_l5_tp5 -> AR_exp_s0_l5;
  Expert23_s0_l5_tp5 -> AR_exp_s0_l5;
  Expert24_s0_l5_tp6 -> AR_exp_s0_l5;
  Expert25_s0_l5_tp6 -> AR_exp_s0_l5;
  Expert26_s0_l5_tp6 -> AR_exp_s0_l5;
  Expert27_s0_l5_tp6 -> AR_exp_s0_l5;
  Expert28_s0_l5_tp7 -> AR_exp_s0_l5;
  Expert29_s0_l5_tp7 -> AR_exp_s0_l5;
  Expert30_s0_l5_tp7 -> AR_exp_s0_l5;
  Expert31_s0_l5_tp7 -> AR_exp_s0_l5;
  ResMOE_s0_l5_tp0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l5 -> ResMOE_s0_l5_tp0;
  ResAttn_s0_l5_tp0 -> ResMOE_s0_l5_tp0;
  ResMOE_s0_l5_tp1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l5 -> ResMOE_s0_l5_tp1;
  ResAttn_s0_l5_tp1 -> ResMOE_s0_l5_tp1;
  ResMOE_s0_l5_tp2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l5 -> ResMOE_s0_l5_tp2;
  ResAttn_s0_l5_tp2 -> ResMOE_s0_l5_tp2;
  ResMOE_s0_l5_tp3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l5 -> ResMOE_s0_l5_tp3;
  ResAttn_s0_l5_tp3 -> ResMOE_s0_l5_tp3;
  ResMOE_s0_l5_tp4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l5 -> ResMOE_s0_l5_tp4;
  ResAttn_s0_l5_tp4 -> ResMOE_s0_l5_tp4;
  ResMOE_s0_l5_tp5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l5 -> ResMOE_s0_l5_tp5;
  ResAttn_s0_l5_tp5 -> ResMOE_s0_l5_tp5;
  ResMOE_s0_l5_tp6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l5 -> ResMOE_s0_l5_tp6;
  ResAttn_s0_l5_tp6 -> ResMOE_s0_l5_tp6;
  ResMOE_s0_l5_tp7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l5 -> ResMOE_s0_l5_tp7;
  ResAttn_s0_l5_tp7 -> ResMOE_s0_l5_tp7;
  QKV_s0_l6_tp0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l5_tp0 -> QKV_s0_l6_tp0;
  QKV_s0_l6_tp1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l5_tp0 -> QKV_s0_l6_tp1;
  QKV_s0_l6_tp2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l5_tp0 -> QKV_s0_l6_tp2;
  QKV_s0_l6_tp3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l5_tp0 -> QKV_s0_l6_tp3;
  QKV_s0_l6_tp4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l5_tp0 -> QKV_s0_l6_tp4;
  QKV_s0_l6_tp5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l5_tp0 -> QKV_s0_l6_tp5;
  QKV_s0_l6_tp6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l5_tp0 -> QKV_s0_l6_tp6;
  QKV_s0_l6_tp7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l5_tp0 -> QKV_s0_l6_tp7;
  SplitHeads_s0_l6_tp0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l6_tp0 -> SplitHeads_s0_l6_tp0;
  SplitHeads_s0_l6_tp1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l6_tp1 -> SplitHeads_s0_l6_tp1;
  SplitHeads_s0_l6_tp2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l6_tp2 -> SplitHeads_s0_l6_tp2;
  SplitHeads_s0_l6_tp3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l6_tp3 -> SplitHeads_s0_l6_tp3;
  SplitHeads_s0_l6_tp4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l6_tp4 -> SplitHeads_s0_l6_tp4;
  SplitHeads_s0_l6_tp5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l6_tp5 -> SplitHeads_s0_l6_tp5;
  SplitHeads_s0_l6_tp6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l6_tp6 -> SplitHeads_s0_l6_tp6;
  SplitHeads_s0_l6_tp7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l6_tp7 -> SplitHeads_s0_l6_tp7;
  A2A_s0_l6 [shape=ellipse, label="AllToAll\nstage0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_s0_l6_tp0 -> A2A_s0_l6;
  SplitHeads_s0_l6_tp1 -> A2A_s0_l6;
  SplitHeads_s0_l6_tp2 -> A2A_s0_l6;
  SplitHeads_s0_l6_tp3 -> A2A_s0_l6;
  SplitHeads_s0_l6_tp4 -> A2A_s0_l6;
  SplitHeads_s0_l6_tp5 -> A2A_s0_l6;
  SplitHeads_s0_l6_tp6 -> A2A_s0_l6;
  SplitHeads_s0_l6_tp7 -> A2A_s0_l6;
  Attn_s0_l6_tp0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l6 -> Attn_s0_l6_tp0;
  Attn_s0_l6_tp1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l6 -> Attn_s0_l6_tp1;
  Attn_s0_l6_tp2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l6 -> Attn_s0_l6_tp2;
  Attn_s0_l6_tp3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l6 -> Attn_s0_l6_tp3;
  Attn_s0_l6_tp4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l6 -> Attn_s0_l6_tp4;
  Attn_s0_l6_tp5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l6 -> Attn_s0_l6_tp5;
  Attn_s0_l6_tp6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l6 -> Attn_s0_l6_tp6;
  Attn_s0_l6_tp7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l6 -> Attn_s0_l6_tp7;
  AR_attn_s0_l6 [shape=ellipse, label="AllReduce\nstage0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_s0_l6_tp0 -> AR_attn_s0_l6;
  Attn_s0_l6_tp1 -> AR_attn_s0_l6;
  Attn_s0_l6_tp2 -> AR_attn_s0_l6;
  Attn_s0_l6_tp3 -> AR_attn_s0_l6;
  Attn_s0_l6_tp4 -> AR_attn_s0_l6;
  Attn_s0_l6_tp5 -> AR_attn_s0_l6;
  Attn_s0_l6_tp6 -> AR_attn_s0_l6;
  Attn_s0_l6_tp7 -> AR_attn_s0_l6;
  O_s0_l6_tp0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l6 -> O_s0_l6_tp0;
  O_s0_l6_tp1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l6 -> O_s0_l6_tp1;
  O_s0_l6_tp2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l6 -> O_s0_l6_tp2;
  O_s0_l6_tp3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l6 -> O_s0_l6_tp3;
  O_s0_l6_tp4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l6 -> O_s0_l6_tp4;
  O_s0_l6_tp5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l6 -> O_s0_l6_tp5;
  O_s0_l6_tp6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l6 -> O_s0_l6_tp6;
  O_s0_l6_tp7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l6 -> O_s0_l6_tp7;
  ResAttn_s0_l6_tp0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l6_tp0 -> ResAttn_s0_l6_tp0;
  ResMOE_s0_l5_tp0 -> ResAttn_s0_l6_tp0;
  ResAttn_s0_l6_tp1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l6_tp1 -> ResAttn_s0_l6_tp1;
  ResMOE_s0_l5_tp0 -> ResAttn_s0_l6_tp1;
  ResAttn_s0_l6_tp2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l6_tp2 -> ResAttn_s0_l6_tp2;
  ResMOE_s0_l5_tp0 -> ResAttn_s0_l6_tp2;
  ResAttn_s0_l6_tp3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l6_tp3 -> ResAttn_s0_l6_tp3;
  ResMOE_s0_l5_tp0 -> ResAttn_s0_l6_tp3;
  ResAttn_s0_l6_tp4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l6_tp4 -> ResAttn_s0_l6_tp4;
  ResMOE_s0_l5_tp0 -> ResAttn_s0_l6_tp4;
  ResAttn_s0_l6_tp5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l6_tp5 -> ResAttn_s0_l6_tp5;
  ResMOE_s0_l5_tp0 -> ResAttn_s0_l6_tp5;
  ResAttn_s0_l6_tp6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l6_tp6 -> ResAttn_s0_l6_tp6;
  ResMOE_s0_l5_tp0 -> ResAttn_s0_l6_tp6;
  ResAttn_s0_l6_tp7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l6_tp7 -> ResAttn_s0_l6_tp7;
  ResMOE_s0_l5_tp0 -> ResAttn_s0_l6_tp7;
  Gate_s0_l6_tp0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l6_tp0 -> Gate_s0_l6_tp0;
  Gate_s0_l6_tp1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l6_tp1 -> Gate_s0_l6_tp1;
  Gate_s0_l6_tp2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l6_tp2 -> Gate_s0_l6_tp2;
  Gate_s0_l6_tp3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l6_tp3 -> Gate_s0_l6_tp3;
  Gate_s0_l6_tp4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l6_tp4 -> Gate_s0_l6_tp4;
  Gate_s0_l6_tp5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l6_tp5 -> Gate_s0_l6_tp5;
  Gate_s0_l6_tp6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l6_tp6 -> Gate_s0_l6_tp6;
  Gate_s0_l6_tp7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l6_tp7 -> Gate_s0_l6_tp7;
  Expert0_s0_l6_tp0 [label="Expert0\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp0 -> Expert0_s0_l6_tp0 [style=dashed];
  Expert1_s0_l6_tp0 [label="Expert1\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp0 -> Expert1_s0_l6_tp0 [style=dashed];
  Expert2_s0_l6_tp0 [label="Expert2\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp0 -> Expert2_s0_l6_tp0 [style=dashed];
  Expert3_s0_l6_tp0 [label="Expert3\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp0 -> Expert3_s0_l6_tp0 [style=dashed];
  Expert4_s0_l6_tp1 [label="Expert4\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp1 -> Expert4_s0_l6_tp1 [style=dashed];
  Expert5_s0_l6_tp1 [label="Expert5\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp1 -> Expert5_s0_l6_tp1 [style=dashed];
  Expert6_s0_l6_tp1 [label="Expert6\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp1 -> Expert6_s0_l6_tp1 [style=dashed];
  Expert7_s0_l6_tp1 [label="Expert7\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp1 -> Expert7_s0_l6_tp1 [style=dashed];
  Expert8_s0_l6_tp2 [label="Expert8\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp2 -> Expert8_s0_l6_tp2 [style=dashed];
  Expert9_s0_l6_tp2 [label="Expert9\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp2 -> Expert9_s0_l6_tp2 [style=dashed];
  Expert10_s0_l6_tp2 [label="Expert10\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp2 -> Expert10_s0_l6_tp2 [style=dashed];
  Expert11_s0_l6_tp2 [label="Expert11\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp2 -> Expert11_s0_l6_tp2 [style=dashed];
  Expert12_s0_l6_tp3 [label="Expert12\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp3 -> Expert12_s0_l6_tp3 [style=dashed];
  Expert13_s0_l6_tp3 [label="Expert13\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp3 -> Expert13_s0_l6_tp3 [style=dashed];
  Expert14_s0_l6_tp3 [label="Expert14\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp3 -> Expert14_s0_l6_tp3 [style=dashed];
  Expert15_s0_l6_tp3 [label="Expert15\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp3 -> Expert15_s0_l6_tp3 [style=dashed];
  Expert16_s0_l6_tp4 [label="Expert16\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp4 -> Expert16_s0_l6_tp4 [style=dashed];
  Expert17_s0_l6_tp4 [label="Expert17\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp4 -> Expert17_s0_l6_tp4 [style=dashed];
  Expert18_s0_l6_tp4 [label="Expert18\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp4 -> Expert18_s0_l6_tp4 [style=dashed];
  Expert19_s0_l6_tp4 [label="Expert19\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp4 -> Expert19_s0_l6_tp4 [style=dashed];
  Expert20_s0_l6_tp5 [label="Expert20\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp5 -> Expert20_s0_l6_tp5 [style=dashed];
  Expert21_s0_l6_tp5 [label="Expert21\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp5 -> Expert21_s0_l6_tp5 [style=dashed];
  Expert22_s0_l6_tp5 [label="Expert22\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp5 -> Expert22_s0_l6_tp5 [style=dashed];
  Expert23_s0_l6_tp5 [label="Expert23\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp5 -> Expert23_s0_l6_tp5 [style=dashed];
  Expert24_s0_l6_tp6 [label="Expert24\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp6 -> Expert24_s0_l6_tp6 [style=dashed];
  Expert25_s0_l6_tp6 [label="Expert25\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp6 -> Expert25_s0_l6_tp6 [style=dashed];
  Expert26_s0_l6_tp6 [label="Expert26\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp6 -> Expert26_s0_l6_tp6 [style=dashed];
  Expert27_s0_l6_tp6 [label="Expert27\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp6 -> Expert27_s0_l6_tp6 [style=dashed];
  Expert28_s0_l6_tp7 [label="Expert28\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp7 -> Expert28_s0_l6_tp7 [style=dashed];
  Expert29_s0_l6_tp7 [label="Expert29\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp7 -> Expert29_s0_l6_tp7 [style=dashed];
  Expert30_s0_l6_tp7 [label="Expert30\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp7 -> Expert30_s0_l6_tp7 [style=dashed];
  Expert31_s0_l6_tp7 [label="Expert31\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l6_tp7 -> Expert31_s0_l6_tp7 [style=dashed];
  AR_exp_s0_l6 [shape=ellipse, label="AllReduceExperts\nstage0\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert0_s0_l6_tp0 -> AR_exp_s0_l6;
  Expert1_s0_l6_tp0 -> AR_exp_s0_l6;
  Expert2_s0_l6_tp0 -> AR_exp_s0_l6;
  Expert3_s0_l6_tp0 -> AR_exp_s0_l6;
  Expert4_s0_l6_tp1 -> AR_exp_s0_l6;
  Expert5_s0_l6_tp1 -> AR_exp_s0_l6;
  Expert6_s0_l6_tp1 -> AR_exp_s0_l6;
  Expert7_s0_l6_tp1 -> AR_exp_s0_l6;
  Expert8_s0_l6_tp2 -> AR_exp_s0_l6;
  Expert9_s0_l6_tp2 -> AR_exp_s0_l6;
  Expert10_s0_l6_tp2 -> AR_exp_s0_l6;
  Expert11_s0_l6_tp2 -> AR_exp_s0_l6;
  Expert12_s0_l6_tp3 -> AR_exp_s0_l6;
  Expert13_s0_l6_tp3 -> AR_exp_s0_l6;
  Expert14_s0_l6_tp3 -> AR_exp_s0_l6;
  Expert15_s0_l6_tp3 -> AR_exp_s0_l6;
  Expert16_s0_l6_tp4 -> AR_exp_s0_l6;
  Expert17_s0_l6_tp4 -> AR_exp_s0_l6;
  Expert18_s0_l6_tp4 -> AR_exp_s0_l6;
  Expert19_s0_l6_tp4 -> AR_exp_s0_l6;
  Expert20_s0_l6_tp5 -> AR_exp_s0_l6;
  Expert21_s0_l6_tp5 -> AR_exp_s0_l6;
  Expert22_s0_l6_tp5 -> AR_exp_s0_l6;
  Expert23_s0_l6_tp5 -> AR_exp_s0_l6;
  Expert24_s0_l6_tp6 -> AR_exp_s0_l6;
  Expert25_s0_l6_tp6 -> AR_exp_s0_l6;
  Expert26_s0_l6_tp6 -> AR_exp_s0_l6;
  Expert27_s0_l6_tp6 -> AR_exp_s0_l6;
  Expert28_s0_l6_tp7 -> AR_exp_s0_l6;
  Expert29_s0_l6_tp7 -> AR_exp_s0_l6;
  Expert30_s0_l6_tp7 -> AR_exp_s0_l6;
  Expert31_s0_l6_tp7 -> AR_exp_s0_l6;
  ResMOE_s0_l6_tp0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l6 -> ResMOE_s0_l6_tp0;
  ResAttn_s0_l6_tp0 -> ResMOE_s0_l6_tp0;
  ResMOE_s0_l6_tp1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l6 -> ResMOE_s0_l6_tp1;
  ResAttn_s0_l6_tp1 -> ResMOE_s0_l6_tp1;
  ResMOE_s0_l6_tp2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l6 -> ResMOE_s0_l6_tp2;
  ResAttn_s0_l6_tp2 -> ResMOE_s0_l6_tp2;
  ResMOE_s0_l6_tp3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l6 -> ResMOE_s0_l6_tp3;
  ResAttn_s0_l6_tp3 -> ResMOE_s0_l6_tp3;
  ResMOE_s0_l6_tp4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l6 -> ResMOE_s0_l6_tp4;
  ResAttn_s0_l6_tp4 -> ResMOE_s0_l6_tp4;
  ResMOE_s0_l6_tp5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l6 -> ResMOE_s0_l6_tp5;
  ResAttn_s0_l6_tp5 -> ResMOE_s0_l6_tp5;
  ResMOE_s0_l6_tp6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l6 -> ResMOE_s0_l6_tp6;
  ResAttn_s0_l6_tp6 -> ResMOE_s0_l6_tp6;
  ResMOE_s0_l6_tp7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l6 -> ResMOE_s0_l6_tp7;
  ResAttn_s0_l6_tp7 -> ResMOE_s0_l6_tp7;
  QKV_s0_l7_tp0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l6_tp0 -> QKV_s0_l7_tp0;
  QKV_s0_l7_tp1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l6_tp0 -> QKV_s0_l7_tp1;
  QKV_s0_l7_tp2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l6_tp0 -> QKV_s0_l7_tp2;
  QKV_s0_l7_tp3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l6_tp0 -> QKV_s0_l7_tp3;
  QKV_s0_l7_tp4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l6_tp0 -> QKV_s0_l7_tp4;
  QKV_s0_l7_tp5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l6_tp0 -> QKV_s0_l7_tp5;
  QKV_s0_l7_tp6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l6_tp0 -> QKV_s0_l7_tp6;
  QKV_s0_l7_tp7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l6_tp0 -> QKV_s0_l7_tp7;
  SplitHeads_s0_l7_tp0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l7_tp0 -> SplitHeads_s0_l7_tp0;
  SplitHeads_s0_l7_tp1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l7_tp1 -> SplitHeads_s0_l7_tp1;
  SplitHeads_s0_l7_tp2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l7_tp2 -> SplitHeads_s0_l7_tp2;
  SplitHeads_s0_l7_tp3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l7_tp3 -> SplitHeads_s0_l7_tp3;
  SplitHeads_s0_l7_tp4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l7_tp4 -> SplitHeads_s0_l7_tp4;
  SplitHeads_s0_l7_tp5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l7_tp5 -> SplitHeads_s0_l7_tp5;
  SplitHeads_s0_l7_tp6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l7_tp6 -> SplitHeads_s0_l7_tp6;
  SplitHeads_s0_l7_tp7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l7_tp7 -> SplitHeads_s0_l7_tp7;
  A2A_s0_l7 [shape=ellipse, label="AllToAll\nstage0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_s0_l7_tp0 -> A2A_s0_l7;
  SplitHeads_s0_l7_tp1 -> A2A_s0_l7;
  SplitHeads_s0_l7_tp2 -> A2A_s0_l7;
  SplitHeads_s0_l7_tp3 -> A2A_s0_l7;
  SplitHeads_s0_l7_tp4 -> A2A_s0_l7;
  SplitHeads_s0_l7_tp5 -> A2A_s0_l7;
  SplitHeads_s0_l7_tp6 -> A2A_s0_l7;
  SplitHeads_s0_l7_tp7 -> A2A_s0_l7;
  Attn_s0_l7_tp0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l7 -> Attn_s0_l7_tp0;
  Attn_s0_l7_tp1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l7 -> Attn_s0_l7_tp1;
  Attn_s0_l7_tp2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l7 -> Attn_s0_l7_tp2;
  Attn_s0_l7_tp3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l7 -> Attn_s0_l7_tp3;
  Attn_s0_l7_tp4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l7 -> Attn_s0_l7_tp4;
  Attn_s0_l7_tp5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l7 -> Attn_s0_l7_tp5;
  Attn_s0_l7_tp6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l7 -> Attn_s0_l7_tp6;
  Attn_s0_l7_tp7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l7 -> Attn_s0_l7_tp7;
  AR_attn_s0_l7 [shape=ellipse, label="AllReduce\nstage0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_s0_l7_tp0 -> AR_attn_s0_l7;
  Attn_s0_l7_tp1 -> AR_attn_s0_l7;
  Attn_s0_l7_tp2 -> AR_attn_s0_l7;
  Attn_s0_l7_tp3 -> AR_attn_s0_l7;
  Attn_s0_l7_tp4 -> AR_attn_s0_l7;
  Attn_s0_l7_tp5 -> AR_attn_s0_l7;
  Attn_s0_l7_tp6 -> AR_attn_s0_l7;
  Attn_s0_l7_tp7 -> AR_attn_s0_l7;
  O_s0_l7_tp0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l7 -> O_s0_l7_tp0;
  O_s0_l7_tp1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l7 -> O_s0_l7_tp1;
  O_s0_l7_tp2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l7 -> O_s0_l7_tp2;
  O_s0_l7_tp3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l7 -> O_s0_l7_tp3;
  O_s0_l7_tp4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l7 -> O_s0_l7_tp4;
  O_s0_l7_tp5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l7 -> O_s0_l7_tp5;
  O_s0_l7_tp6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l7 -> O_s0_l7_tp6;
  O_s0_l7_tp7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l7 -> O_s0_l7_tp7;
  ResAttn_s0_l7_tp0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l7_tp0 -> ResAttn_s0_l7_tp0;
  ResMOE_s0_l6_tp0 -> ResAttn_s0_l7_tp0;
  ResAttn_s0_l7_tp1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l7_tp1 -> ResAttn_s0_l7_tp1;
  ResMOE_s0_l6_tp0 -> ResAttn_s0_l7_tp1;
  ResAttn_s0_l7_tp2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l7_tp2 -> ResAttn_s0_l7_tp2;
  ResMOE_s0_l6_tp0 -> ResAttn_s0_l7_tp2;
  ResAttn_s0_l7_tp3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l7_tp3 -> ResAttn_s0_l7_tp3;
  ResMOE_s0_l6_tp0 -> ResAttn_s0_l7_tp3;
  ResAttn_s0_l7_tp4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l7_tp4 -> ResAttn_s0_l7_tp4;
  ResMOE_s0_l6_tp0 -> ResAttn_s0_l7_tp4;
  ResAttn_s0_l7_tp5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l7_tp5 -> ResAttn_s0_l7_tp5;
  ResMOE_s0_l6_tp0 -> ResAttn_s0_l7_tp5;
  ResAttn_s0_l7_tp6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l7_tp6 -> ResAttn_s0_l7_tp6;
  ResMOE_s0_l6_tp0 -> ResAttn_s0_l7_tp6;
  ResAttn_s0_l7_tp7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l7_tp7 -> ResAttn_s0_l7_tp7;
  ResMOE_s0_l6_tp0 -> ResAttn_s0_l7_tp7;
  Gate_s0_l7_tp0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l7_tp0 -> Gate_s0_l7_tp0;
  Gate_s0_l7_tp1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l7_tp1 -> Gate_s0_l7_tp1;
  Gate_s0_l7_tp2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l7_tp2 -> Gate_s0_l7_tp2;
  Gate_s0_l7_tp3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l7_tp3 -> Gate_s0_l7_tp3;
  Gate_s0_l7_tp4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l7_tp4 -> Gate_s0_l7_tp4;
  Gate_s0_l7_tp5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l7_tp5 -> Gate_s0_l7_tp5;
  Gate_s0_l7_tp6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l7_tp6 -> Gate_s0_l7_tp6;
  Gate_s0_l7_tp7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l7_tp7 -> Gate_s0_l7_tp7;
  Expert0_s0_l7_tp0 [label="Expert0\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp0 -> Expert0_s0_l7_tp0 [style=dashed];
  Expert1_s0_l7_tp0 [label="Expert1\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp0 -> Expert1_s0_l7_tp0 [style=dashed];
  Expert2_s0_l7_tp0 [label="Expert2\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp0 -> Expert2_s0_l7_tp0 [style=dashed];
  Expert3_s0_l7_tp0 [label="Expert3\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp0 -> Expert3_s0_l7_tp0 [style=dashed];
  Expert4_s0_l7_tp1 [label="Expert4\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp1 -> Expert4_s0_l7_tp1 [style=dashed];
  Expert5_s0_l7_tp1 [label="Expert5\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp1 -> Expert5_s0_l7_tp1 [style=dashed];
  Expert6_s0_l7_tp1 [label="Expert6\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp1 -> Expert6_s0_l7_tp1 [style=dashed];
  Expert7_s0_l7_tp1 [label="Expert7\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp1 -> Expert7_s0_l7_tp1 [style=dashed];
  Expert8_s0_l7_tp2 [label="Expert8\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp2 -> Expert8_s0_l7_tp2 [style=dashed];
  Expert9_s0_l7_tp2 [label="Expert9\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp2 -> Expert9_s0_l7_tp2 [style=dashed];
  Expert10_s0_l7_tp2 [label="Expert10\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp2 -> Expert10_s0_l7_tp2 [style=dashed];
  Expert11_s0_l7_tp2 [label="Expert11\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp2 -> Expert11_s0_l7_tp2 [style=dashed];
  Expert12_s0_l7_tp3 [label="Expert12\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp3 -> Expert12_s0_l7_tp3 [style=dashed];
  Expert13_s0_l7_tp3 [label="Expert13\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp3 -> Expert13_s0_l7_tp3 [style=dashed];
  Expert14_s0_l7_tp3 [label="Expert14\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp3 -> Expert14_s0_l7_tp3 [style=dashed];
  Expert15_s0_l7_tp3 [label="Expert15\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp3 -> Expert15_s0_l7_tp3 [style=dashed];
  Expert16_s0_l7_tp4 [label="Expert16\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp4 -> Expert16_s0_l7_tp4 [style=dashed];
  Expert17_s0_l7_tp4 [label="Expert17\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp4 -> Expert17_s0_l7_tp4 [style=dashed];
  Expert18_s0_l7_tp4 [label="Expert18\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp4 -> Expert18_s0_l7_tp4 [style=dashed];
  Expert19_s0_l7_tp4 [label="Expert19\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp4 -> Expert19_s0_l7_tp4 [style=dashed];
  Expert20_s0_l7_tp5 [label="Expert20\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp5 -> Expert20_s0_l7_tp5 [style=dashed];
  Expert21_s0_l7_tp5 [label="Expert21\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp5 -> Expert21_s0_l7_tp5 [style=dashed];
  Expert22_s0_l7_tp5 [label="Expert22\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp5 -> Expert22_s0_l7_tp5 [style=dashed];
  Expert23_s0_l7_tp5 [label="Expert23\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp5 -> Expert23_s0_l7_tp5 [style=dashed];
  Expert24_s0_l7_tp6 [label="Expert24\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp6 -> Expert24_s0_l7_tp6 [style=dashed];
  Expert25_s0_l7_tp6 [label="Expert25\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp6 -> Expert25_s0_l7_tp6 [style=dashed];
  Expert26_s0_l7_tp6 [label="Expert26\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp6 -> Expert26_s0_l7_tp6 [style=dashed];
  Expert27_s0_l7_tp6 [label="Expert27\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp6 -> Expert27_s0_l7_tp6 [style=dashed];
  Expert28_s0_l7_tp7 [label="Expert28\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp7 -> Expert28_s0_l7_tp7 [style=dashed];
  Expert29_s0_l7_tp7 [label="Expert29\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp7 -> Expert29_s0_l7_tp7 [style=dashed];
  Expert30_s0_l7_tp7 [label="Expert30\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp7 -> Expert30_s0_l7_tp7 [style=dashed];
  Expert31_s0_l7_tp7 [label="Expert31\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l7_tp7 -> Expert31_s0_l7_tp7 [style=dashed];
  AR_exp_s0_l7 [shape=ellipse, label="AllReduceExperts\nstage0\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert0_s0_l7_tp0 -> AR_exp_s0_l7;
  Expert1_s0_l7_tp0 -> AR_exp_s0_l7;
  Expert2_s0_l7_tp0 -> AR_exp_s0_l7;
  Expert3_s0_l7_tp0 -> AR_exp_s0_l7;
  Expert4_s0_l7_tp1 -> AR_exp_s0_l7;
  Expert5_s0_l7_tp1 -> AR_exp_s0_l7;
  Expert6_s0_l7_tp1 -> AR_exp_s0_l7;
  Expert7_s0_l7_tp1 -> AR_exp_s0_l7;
  Expert8_s0_l7_tp2 -> AR_exp_s0_l7;
  Expert9_s0_l7_tp2 -> AR_exp_s0_l7;
  Expert10_s0_l7_tp2 -> AR_exp_s0_l7;
  Expert11_s0_l7_tp2 -> AR_exp_s0_l7;
  Expert12_s0_l7_tp3 -> AR_exp_s0_l7;
  Expert13_s0_l7_tp3 -> AR_exp_s0_l7;
  Expert14_s0_l7_tp3 -> AR_exp_s0_l7;
  Expert15_s0_l7_tp3 -> AR_exp_s0_l7;
  Expert16_s0_l7_tp4 -> AR_exp_s0_l7;
  Expert17_s0_l7_tp4 -> AR_exp_s0_l7;
  Expert18_s0_l7_tp4 -> AR_exp_s0_l7;
  Expert19_s0_l7_tp4 -> AR_exp_s0_l7;
  Expert20_s0_l7_tp5 -> AR_exp_s0_l7;
  Expert21_s0_l7_tp5 -> AR_exp_s0_l7;
  Expert22_s0_l7_tp5 -> AR_exp_s0_l7;
  Expert23_s0_l7_tp5 -> AR_exp_s0_l7;
  Expert24_s0_l7_tp6 -> AR_exp_s0_l7;
  Expert25_s0_l7_tp6 -> AR_exp_s0_l7;
  Expert26_s0_l7_tp6 -> AR_exp_s0_l7;
  Expert27_s0_l7_tp6 -> AR_exp_s0_l7;
  Expert28_s0_l7_tp7 -> AR_exp_s0_l7;
  Expert29_s0_l7_tp7 -> AR_exp_s0_l7;
  Expert30_s0_l7_tp7 -> AR_exp_s0_l7;
  Expert31_s0_l7_tp7 -> AR_exp_s0_l7;
  ResMOE_s0_l7_tp0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l7 -> ResMOE_s0_l7_tp0;
  ResAttn_s0_l7_tp0 -> ResMOE_s0_l7_tp0;
  ResMOE_s0_l7_tp1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l7 -> ResMOE_s0_l7_tp1;
  ResAttn_s0_l7_tp1 -> ResMOE_s0_l7_tp1;
  ResMOE_s0_l7_tp2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l7 -> ResMOE_s0_l7_tp2;
  ResAttn_s0_l7_tp2 -> ResMOE_s0_l7_tp2;
  ResMOE_s0_l7_tp3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l7 -> ResMOE_s0_l7_tp3;
  ResAttn_s0_l7_tp3 -> ResMOE_s0_l7_tp3;
  ResMOE_s0_l7_tp4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l7 -> ResMOE_s0_l7_tp4;
  ResAttn_s0_l7_tp4 -> ResMOE_s0_l7_tp4;
  ResMOE_s0_l7_tp5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l7 -> ResMOE_s0_l7_tp5;
  ResAttn_s0_l7_tp5 -> ResMOE_s0_l7_tp5;
  ResMOE_s0_l7_tp6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l7 -> ResMOE_s0_l7_tp6;
  ResAttn_s0_l7_tp6 -> ResMOE_s0_l7_tp6;
  ResMOE_s0_l7_tp7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l7 -> ResMOE_s0_l7_tp7;
  ResAttn_s0_l7_tp7 -> ResMOE_s0_l7_tp7;
  QKV_s0_l8_tp0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l7_tp0 -> QKV_s0_l8_tp0;
  QKV_s0_l8_tp1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l7_tp0 -> QKV_s0_l8_tp1;
  QKV_s0_l8_tp2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l7_tp0 -> QKV_s0_l8_tp2;
  QKV_s0_l8_tp3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l7_tp0 -> QKV_s0_l8_tp3;
  QKV_s0_l8_tp4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l7_tp0 -> QKV_s0_l8_tp4;
  QKV_s0_l8_tp5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l7_tp0 -> QKV_s0_l8_tp5;
  QKV_s0_l8_tp6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l7_tp0 -> QKV_s0_l8_tp6;
  QKV_s0_l8_tp7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l7_tp0 -> QKV_s0_l8_tp7;
  SplitHeads_s0_l8_tp0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l8_tp0 -> SplitHeads_s0_l8_tp0;
  SplitHeads_s0_l8_tp1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l8_tp1 -> SplitHeads_s0_l8_tp1;
  SplitHeads_s0_l8_tp2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l8_tp2 -> SplitHeads_s0_l8_tp2;
  SplitHeads_s0_l8_tp3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l8_tp3 -> SplitHeads_s0_l8_tp3;
  SplitHeads_s0_l8_tp4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l8_tp4 -> SplitHeads_s0_l8_tp4;
  SplitHeads_s0_l8_tp5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l8_tp5 -> SplitHeads_s0_l8_tp5;
  SplitHeads_s0_l8_tp6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l8_tp6 -> SplitHeads_s0_l8_tp6;
  SplitHeads_s0_l8_tp7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s0_l8_tp7 -> SplitHeads_s0_l8_tp7;
  A2A_s0_l8 [shape=ellipse, label="AllToAll\nstage0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_s0_l8_tp0 -> A2A_s0_l8;
  SplitHeads_s0_l8_tp1 -> A2A_s0_l8;
  SplitHeads_s0_l8_tp2 -> A2A_s0_l8;
  SplitHeads_s0_l8_tp3 -> A2A_s0_l8;
  SplitHeads_s0_l8_tp4 -> A2A_s0_l8;
  SplitHeads_s0_l8_tp5 -> A2A_s0_l8;
  SplitHeads_s0_l8_tp6 -> A2A_s0_l8;
  SplitHeads_s0_l8_tp7 -> A2A_s0_l8;
  Attn_s0_l8_tp0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l8 -> Attn_s0_l8_tp0;
  Attn_s0_l8_tp1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l8 -> Attn_s0_l8_tp1;
  Attn_s0_l8_tp2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l8 -> Attn_s0_l8_tp2;
  Attn_s0_l8_tp3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l8 -> Attn_s0_l8_tp3;
  Attn_s0_l8_tp4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l8 -> Attn_s0_l8_tp4;
  Attn_s0_l8_tp5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l8 -> Attn_s0_l8_tp5;
  Attn_s0_l8_tp6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l8 -> Attn_s0_l8_tp6;
  Attn_s0_l8_tp7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s0_l8 -> Attn_s0_l8_tp7;
  AR_attn_s0_l8 [shape=ellipse, label="AllReduce\nstage0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_s0_l8_tp0 -> AR_attn_s0_l8;
  Attn_s0_l8_tp1 -> AR_attn_s0_l8;
  Attn_s0_l8_tp2 -> AR_attn_s0_l8;
  Attn_s0_l8_tp3 -> AR_attn_s0_l8;
  Attn_s0_l8_tp4 -> AR_attn_s0_l8;
  Attn_s0_l8_tp5 -> AR_attn_s0_l8;
  Attn_s0_l8_tp6 -> AR_attn_s0_l8;
  Attn_s0_l8_tp7 -> AR_attn_s0_l8;
  O_s0_l8_tp0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l8 -> O_s0_l8_tp0;
  O_s0_l8_tp1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l8 -> O_s0_l8_tp1;
  O_s0_l8_tp2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l8 -> O_s0_l8_tp2;
  O_s0_l8_tp3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l8 -> O_s0_l8_tp3;
  O_s0_l8_tp4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l8 -> O_s0_l8_tp4;
  O_s0_l8_tp5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l8 -> O_s0_l8_tp5;
  O_s0_l8_tp6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l8 -> O_s0_l8_tp6;
  O_s0_l8_tp7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s0_l8 -> O_s0_l8_tp7;
  ResAttn_s0_l8_tp0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l8_tp0 -> ResAttn_s0_l8_tp0;
  ResMOE_s0_l7_tp0 -> ResAttn_s0_l8_tp0;
  ResAttn_s0_l8_tp1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l8_tp1 -> ResAttn_s0_l8_tp1;
  ResMOE_s0_l7_tp0 -> ResAttn_s0_l8_tp1;
  ResAttn_s0_l8_tp2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l8_tp2 -> ResAttn_s0_l8_tp2;
  ResMOE_s0_l7_tp0 -> ResAttn_s0_l8_tp2;
  ResAttn_s0_l8_tp3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l8_tp3 -> ResAttn_s0_l8_tp3;
  ResMOE_s0_l7_tp0 -> ResAttn_s0_l8_tp3;
  ResAttn_s0_l8_tp4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l8_tp4 -> ResAttn_s0_l8_tp4;
  ResMOE_s0_l7_tp0 -> ResAttn_s0_l8_tp4;
  ResAttn_s0_l8_tp5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l8_tp5 -> ResAttn_s0_l8_tp5;
  ResMOE_s0_l7_tp0 -> ResAttn_s0_l8_tp5;
  ResAttn_s0_l8_tp6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l8_tp6 -> ResAttn_s0_l8_tp6;
  ResMOE_s0_l7_tp0 -> ResAttn_s0_l8_tp6;
  ResAttn_s0_l8_tp7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s0_l8_tp7 -> ResAttn_s0_l8_tp7;
  ResMOE_s0_l7_tp0 -> ResAttn_s0_l8_tp7;
  Gate_s0_l8_tp0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l8_tp0 -> Gate_s0_l8_tp0;
  Gate_s0_l8_tp1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l8_tp1 -> Gate_s0_l8_tp1;
  Gate_s0_l8_tp2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l8_tp2 -> Gate_s0_l8_tp2;
  Gate_s0_l8_tp3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l8_tp3 -> Gate_s0_l8_tp3;
  Gate_s0_l8_tp4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l8_tp4 -> Gate_s0_l8_tp4;
  Gate_s0_l8_tp5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l8_tp5 -> Gate_s0_l8_tp5;
  Gate_s0_l8_tp6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l8_tp6 -> Gate_s0_l8_tp6;
  Gate_s0_l8_tp7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s0_l8_tp7 -> Gate_s0_l8_tp7;
  Expert0_s0_l8_tp0 [label="Expert0\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp0 -> Expert0_s0_l8_tp0 [style=dashed];
  Expert1_s0_l8_tp0 [label="Expert1\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp0 -> Expert1_s0_l8_tp0 [style=dashed];
  Expert2_s0_l8_tp0 [label="Expert2\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp0 -> Expert2_s0_l8_tp0 [style=dashed];
  Expert3_s0_l8_tp0 [label="Expert3\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp0 -> Expert3_s0_l8_tp0 [style=dashed];
  Expert4_s0_l8_tp1 [label="Expert4\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp1 -> Expert4_s0_l8_tp1 [style=dashed];
  Expert5_s0_l8_tp1 [label="Expert5\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp1 -> Expert5_s0_l8_tp1 [style=dashed];
  Expert6_s0_l8_tp1 [label="Expert6\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp1 -> Expert6_s0_l8_tp1 [style=dashed];
  Expert7_s0_l8_tp1 [label="Expert7\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp1 -> Expert7_s0_l8_tp1 [style=dashed];
  Expert8_s0_l8_tp2 [label="Expert8\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp2 -> Expert8_s0_l8_tp2 [style=dashed];
  Expert9_s0_l8_tp2 [label="Expert9\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp2 -> Expert9_s0_l8_tp2 [style=dashed];
  Expert10_s0_l8_tp2 [label="Expert10\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp2 -> Expert10_s0_l8_tp2 [style=dashed];
  Expert11_s0_l8_tp2 [label="Expert11\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp2 -> Expert11_s0_l8_tp2 [style=dashed];
  Expert12_s0_l8_tp3 [label="Expert12\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp3 -> Expert12_s0_l8_tp3 [style=dashed];
  Expert13_s0_l8_tp3 [label="Expert13\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp3 -> Expert13_s0_l8_tp3 [style=dashed];
  Expert14_s0_l8_tp3 [label="Expert14\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp3 -> Expert14_s0_l8_tp3 [style=dashed];
  Expert15_s0_l8_tp3 [label="Expert15\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp3 -> Expert15_s0_l8_tp3 [style=dashed];
  Expert16_s0_l8_tp4 [label="Expert16\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp4 -> Expert16_s0_l8_tp4 [style=dashed];
  Expert17_s0_l8_tp4 [label="Expert17\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp4 -> Expert17_s0_l8_tp4 [style=dashed];
  Expert18_s0_l8_tp4 [label="Expert18\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp4 -> Expert18_s0_l8_tp4 [style=dashed];
  Expert19_s0_l8_tp4 [label="Expert19\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp4 -> Expert19_s0_l8_tp4 [style=dashed];
  Expert20_s0_l8_tp5 [label="Expert20\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp5 -> Expert20_s0_l8_tp5 [style=dashed];
  Expert21_s0_l8_tp5 [label="Expert21\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp5 -> Expert21_s0_l8_tp5 [style=dashed];
  Expert22_s0_l8_tp5 [label="Expert22\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp5 -> Expert22_s0_l8_tp5 [style=dashed];
  Expert23_s0_l8_tp5 [label="Expert23\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp5 -> Expert23_s0_l8_tp5 [style=dashed];
  Expert24_s0_l8_tp6 [label="Expert24\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp6 -> Expert24_s0_l8_tp6 [style=dashed];
  Expert25_s0_l8_tp6 [label="Expert25\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp6 -> Expert25_s0_l8_tp6 [style=dashed];
  Expert26_s0_l8_tp6 [label="Expert26\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp6 -> Expert26_s0_l8_tp6 [style=dashed];
  Expert27_s0_l8_tp6 [label="Expert27\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp6 -> Expert27_s0_l8_tp6 [style=dashed];
  Expert28_s0_l8_tp7 [label="Expert28\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp7 -> Expert28_s0_l8_tp7 [style=dashed];
  Expert29_s0_l8_tp7 [label="Expert29\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp7 -> Expert29_s0_l8_tp7 [style=dashed];
  Expert30_s0_l8_tp7 [label="Expert30\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp7 -> Expert30_s0_l8_tp7 [style=dashed];
  Expert31_s0_l8_tp7 [label="Expert31\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s0_l8_tp7 -> Expert31_s0_l8_tp7 [style=dashed];
  AR_exp_s0_l8 [shape=ellipse, label="AllReduceExperts\nstage0\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert0_s0_l8_tp0 -> AR_exp_s0_l8;
  Expert1_s0_l8_tp0 -> AR_exp_s0_l8;
  Expert2_s0_l8_tp0 -> AR_exp_s0_l8;
  Expert3_s0_l8_tp0 -> AR_exp_s0_l8;
  Expert4_s0_l8_tp1 -> AR_exp_s0_l8;
  Expert5_s0_l8_tp1 -> AR_exp_s0_l8;
  Expert6_s0_l8_tp1 -> AR_exp_s0_l8;
  Expert7_s0_l8_tp1 -> AR_exp_s0_l8;
  Expert8_s0_l8_tp2 -> AR_exp_s0_l8;
  Expert9_s0_l8_tp2 -> AR_exp_s0_l8;
  Expert10_s0_l8_tp2 -> AR_exp_s0_l8;
  Expert11_s0_l8_tp2 -> AR_exp_s0_l8;
  Expert12_s0_l8_tp3 -> AR_exp_s0_l8;
  Expert13_s0_l8_tp3 -> AR_exp_s0_l8;
  Expert14_s0_l8_tp3 -> AR_exp_s0_l8;
  Expert15_s0_l8_tp3 -> AR_exp_s0_l8;
  Expert16_s0_l8_tp4 -> AR_exp_s0_l8;
  Expert17_s0_l8_tp4 -> AR_exp_s0_l8;
  Expert18_s0_l8_tp4 -> AR_exp_s0_l8;
  Expert19_s0_l8_tp4 -> AR_exp_s0_l8;
  Expert20_s0_l8_tp5 -> AR_exp_s0_l8;
  Expert21_s0_l8_tp5 -> AR_exp_s0_l8;
  Expert22_s0_l8_tp5 -> AR_exp_s0_l8;
  Expert23_s0_l8_tp5 -> AR_exp_s0_l8;
  Expert24_s0_l8_tp6 -> AR_exp_s0_l8;
  Expert25_s0_l8_tp6 -> AR_exp_s0_l8;
  Expert26_s0_l8_tp6 -> AR_exp_s0_l8;
  Expert27_s0_l8_tp6 -> AR_exp_s0_l8;
  Expert28_s0_l8_tp7 -> AR_exp_s0_l8;
  Expert29_s0_l8_tp7 -> AR_exp_s0_l8;
  Expert30_s0_l8_tp7 -> AR_exp_s0_l8;
  Expert31_s0_l8_tp7 -> AR_exp_s0_l8;
  ResMOE_s0_l8_tp0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l8 -> ResMOE_s0_l8_tp0;
  ResAttn_s0_l8_tp0 -> ResMOE_s0_l8_tp0;
  ResMOE_s0_l8_tp1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l8 -> ResMOE_s0_l8_tp1;
  ResAttn_s0_l8_tp1 -> ResMOE_s0_l8_tp1;
  ResMOE_s0_l8_tp2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l8 -> ResMOE_s0_l8_tp2;
  ResAttn_s0_l8_tp2 -> ResMOE_s0_l8_tp2;
  ResMOE_s0_l8_tp3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l8 -> ResMOE_s0_l8_tp3;
  ResAttn_s0_l8_tp3 -> ResMOE_s0_l8_tp3;
  ResMOE_s0_l8_tp4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l8 -> ResMOE_s0_l8_tp4;
  ResAttn_s0_l8_tp4 -> ResMOE_s0_l8_tp4;
  ResMOE_s0_l8_tp5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l8 -> ResMOE_s0_l8_tp5;
  ResAttn_s0_l8_tp5 -> ResMOE_s0_l8_tp5;
  ResMOE_s0_l8_tp6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l8 -> ResMOE_s0_l8_tp6;
  ResAttn_s0_l8_tp6 -> ResMOE_s0_l8_tp6;
  ResMOE_s0_l8_tp7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s0_l8 -> ResMOE_s0_l8_tp7;
  ResAttn_s0_l8_tp7 -> ResMOE_s0_l8_tp7;
  QKV_s1_l9_tp0 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l8_tp0 -> QKV_s1_l9_tp0;
  QKV_s1_l9_tp1 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l8_tp0 -> QKV_s1_l9_tp1;
  QKV_s1_l9_tp2 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l8_tp0 -> QKV_s1_l9_tp2;
  QKV_s1_l9_tp3 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l8_tp0 -> QKV_s1_l9_tp3;
  QKV_s1_l9_tp4 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l8_tp0 -> QKV_s1_l9_tp4;
  QKV_s1_l9_tp5 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l8_tp0 -> QKV_s1_l9_tp5;
  QKV_s1_l9_tp6 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l8_tp0 -> QKV_s1_l9_tp6;
  QKV_s1_l9_tp7 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s0_l8_tp0 -> QKV_s1_l9_tp7;
  SplitHeads_s1_l9_tp0 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l9_tp0 -> SplitHeads_s1_l9_tp0;
  SplitHeads_s1_l9_tp1 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l9_tp1 -> SplitHeads_s1_l9_tp1;
  SplitHeads_s1_l9_tp2 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l9_tp2 -> SplitHeads_s1_l9_tp2;
  SplitHeads_s1_l9_tp3 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l9_tp3 -> SplitHeads_s1_l9_tp3;
  SplitHeads_s1_l9_tp4 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l9_tp4 -> SplitHeads_s1_l9_tp4;
  SplitHeads_s1_l9_tp5 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l9_tp5 -> SplitHeads_s1_l9_tp5;
  SplitHeads_s1_l9_tp6 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l9_tp6 -> SplitHeads_s1_l9_tp6;
  SplitHeads_s1_l9_tp7 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l9_tp7 -> SplitHeads_s1_l9_tp7;
  A2A_s1_l9 [shape=ellipse, label="AllToAll\nstage1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_s1_l9_tp0 -> A2A_s1_l9;
  SplitHeads_s1_l9_tp1 -> A2A_s1_l9;
  SplitHeads_s1_l9_tp2 -> A2A_s1_l9;
  SplitHeads_s1_l9_tp3 -> A2A_s1_l9;
  SplitHeads_s1_l9_tp4 -> A2A_s1_l9;
  SplitHeads_s1_l9_tp5 -> A2A_s1_l9;
  SplitHeads_s1_l9_tp6 -> A2A_s1_l9;
  SplitHeads_s1_l9_tp7 -> A2A_s1_l9;
  Attn_s1_l9_tp0 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l9 -> Attn_s1_l9_tp0;
  Attn_s1_l9_tp1 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l9 -> Attn_s1_l9_tp1;
  Attn_s1_l9_tp2 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l9 -> Attn_s1_l9_tp2;
  Attn_s1_l9_tp3 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l9 -> Attn_s1_l9_tp3;
  Attn_s1_l9_tp4 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l9 -> Attn_s1_l9_tp4;
  Attn_s1_l9_tp5 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l9 -> Attn_s1_l9_tp5;
  Attn_s1_l9_tp6 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l9 -> Attn_s1_l9_tp6;
  Attn_s1_l9_tp7 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l9 -> Attn_s1_l9_tp7;
  AR_attn_s1_l9 [shape=ellipse, label="AllReduce\nstage1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_s1_l9_tp0 -> AR_attn_s1_l9;
  Attn_s1_l9_tp1 -> AR_attn_s1_l9;
  Attn_s1_l9_tp2 -> AR_attn_s1_l9;
  Attn_s1_l9_tp3 -> AR_attn_s1_l9;
  Attn_s1_l9_tp4 -> AR_attn_s1_l9;
  Attn_s1_l9_tp5 -> AR_attn_s1_l9;
  Attn_s1_l9_tp6 -> AR_attn_s1_l9;
  Attn_s1_l9_tp7 -> AR_attn_s1_l9;
  O_s1_l9_tp0 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l9 -> O_s1_l9_tp0;
  O_s1_l9_tp1 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l9 -> O_s1_l9_tp1;
  O_s1_l9_tp2 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l9 -> O_s1_l9_tp2;
  O_s1_l9_tp3 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l9 -> O_s1_l9_tp3;
  O_s1_l9_tp4 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l9 -> O_s1_l9_tp4;
  O_s1_l9_tp5 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l9 -> O_s1_l9_tp5;
  O_s1_l9_tp6 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l9 -> O_s1_l9_tp6;
  O_s1_l9_tp7 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l9 -> O_s1_l9_tp7;
  ResAttn_s1_l9_tp0 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l9_tp0 -> ResAttn_s1_l9_tp0;
  ResMOE_s0_l8_tp0 -> ResAttn_s1_l9_tp0;
  ResAttn_s1_l9_tp1 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l9_tp1 -> ResAttn_s1_l9_tp1;
  ResMOE_s0_l8_tp0 -> ResAttn_s1_l9_tp1;
  ResAttn_s1_l9_tp2 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l9_tp2 -> ResAttn_s1_l9_tp2;
  ResMOE_s0_l8_tp0 -> ResAttn_s1_l9_tp2;
  ResAttn_s1_l9_tp3 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l9_tp3 -> ResAttn_s1_l9_tp3;
  ResMOE_s0_l8_tp0 -> ResAttn_s1_l9_tp3;
  ResAttn_s1_l9_tp4 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l9_tp4 -> ResAttn_s1_l9_tp4;
  ResMOE_s0_l8_tp0 -> ResAttn_s1_l9_tp4;
  ResAttn_s1_l9_tp5 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l9_tp5 -> ResAttn_s1_l9_tp5;
  ResMOE_s0_l8_tp0 -> ResAttn_s1_l9_tp5;
  ResAttn_s1_l9_tp6 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l9_tp6 -> ResAttn_s1_l9_tp6;
  ResMOE_s0_l8_tp0 -> ResAttn_s1_l9_tp6;
  ResAttn_s1_l9_tp7 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l9_tp7 -> ResAttn_s1_l9_tp7;
  ResMOE_s0_l8_tp0 -> ResAttn_s1_l9_tp7;
  Gate_s1_l9_tp0 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l9_tp0 -> Gate_s1_l9_tp0;
  Gate_s1_l9_tp1 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l9_tp1 -> Gate_s1_l9_tp1;
  Gate_s1_l9_tp2 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l9_tp2 -> Gate_s1_l9_tp2;
  Gate_s1_l9_tp3 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l9_tp3 -> Gate_s1_l9_tp3;
  Gate_s1_l9_tp4 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l9_tp4 -> Gate_s1_l9_tp4;
  Gate_s1_l9_tp5 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l9_tp5 -> Gate_s1_l9_tp5;
  Gate_s1_l9_tp6 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l9_tp6 -> Gate_s1_l9_tp6;
  Gate_s1_l9_tp7 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l9_tp7 -> Gate_s1_l9_tp7;
  Expert32_s1_l9_tp0 [label="Expert32\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp0 -> Expert32_s1_l9_tp0 [style=dashed];
  Expert33_s1_l9_tp0 [label="Expert33\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp0 -> Expert33_s1_l9_tp0 [style=dashed];
  Expert34_s1_l9_tp0 [label="Expert34\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp0 -> Expert34_s1_l9_tp0 [style=dashed];
  Expert35_s1_l9_tp0 [label="Expert35\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp0 -> Expert35_s1_l9_tp0 [style=dashed];
  Expert36_s1_l9_tp1 [label="Expert36\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp1 -> Expert36_s1_l9_tp1 [style=dashed];
  Expert37_s1_l9_tp1 [label="Expert37\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp1 -> Expert37_s1_l9_tp1 [style=dashed];
  Expert38_s1_l9_tp1 [label="Expert38\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp1 -> Expert38_s1_l9_tp1 [style=dashed];
  Expert39_s1_l9_tp1 [label="Expert39\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp1 -> Expert39_s1_l9_tp1 [style=dashed];
  Expert40_s1_l9_tp2 [label="Expert40\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp2 -> Expert40_s1_l9_tp2 [style=dashed];
  Expert41_s1_l9_tp2 [label="Expert41\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp2 -> Expert41_s1_l9_tp2 [style=dashed];
  Expert42_s1_l9_tp2 [label="Expert42\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp2 -> Expert42_s1_l9_tp2 [style=dashed];
  Expert43_s1_l9_tp2 [label="Expert43\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp2 -> Expert43_s1_l9_tp2 [style=dashed];
  Expert44_s1_l9_tp3 [label="Expert44\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp3 -> Expert44_s1_l9_tp3 [style=dashed];
  Expert45_s1_l9_tp3 [label="Expert45\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp3 -> Expert45_s1_l9_tp3 [style=dashed];
  Expert46_s1_l9_tp3 [label="Expert46\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp3 -> Expert46_s1_l9_tp3 [style=dashed];
  Expert47_s1_l9_tp3 [label="Expert47\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp3 -> Expert47_s1_l9_tp3 [style=dashed];
  Expert48_s1_l9_tp4 [label="Expert48\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp4 -> Expert48_s1_l9_tp4 [style=dashed];
  Expert49_s1_l9_tp4 [label="Expert49\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp4 -> Expert49_s1_l9_tp4 [style=dashed];
  Expert50_s1_l9_tp4 [label="Expert50\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp4 -> Expert50_s1_l9_tp4 [style=dashed];
  Expert51_s1_l9_tp4 [label="Expert51\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp4 -> Expert51_s1_l9_tp4 [style=dashed];
  Expert52_s1_l9_tp5 [label="Expert52\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp5 -> Expert52_s1_l9_tp5 [style=dashed];
  Expert53_s1_l9_tp5 [label="Expert53\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp5 -> Expert53_s1_l9_tp5 [style=dashed];
  Expert54_s1_l9_tp5 [label="Expert54\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp5 -> Expert54_s1_l9_tp5 [style=dashed];
  Expert55_s1_l9_tp5 [label="Expert55\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp5 -> Expert55_s1_l9_tp5 [style=dashed];
  Expert56_s1_l9_tp6 [label="Expert56\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp6 -> Expert56_s1_l9_tp6 [style=dashed];
  Expert57_s1_l9_tp6 [label="Expert57\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp6 -> Expert57_s1_l9_tp6 [style=dashed];
  Expert58_s1_l9_tp6 [label="Expert58\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp6 -> Expert58_s1_l9_tp6 [style=dashed];
  Expert59_s1_l9_tp6 [label="Expert59\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp6 -> Expert59_s1_l9_tp6 [style=dashed];
  Expert60_s1_l9_tp7 [label="Expert60\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp7 -> Expert60_s1_l9_tp7 [style=dashed];
  Expert61_s1_l9_tp7 [label="Expert61\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp7 -> Expert61_s1_l9_tp7 [style=dashed];
  Expert62_s1_l9_tp7 [label="Expert62\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp7 -> Expert62_s1_l9_tp7 [style=dashed];
  Expert63_s1_l9_tp7 [label="Expert63\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l9_tp7 -> Expert63_s1_l9_tp7 [style=dashed];
  AR_exp_s1_l9 [shape=ellipse, label="AllReduceExperts\nstage1\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert32_s1_l9_tp0 -> AR_exp_s1_l9;
  Expert33_s1_l9_tp0 -> AR_exp_s1_l9;
  Expert34_s1_l9_tp0 -> AR_exp_s1_l9;
  Expert35_s1_l9_tp0 -> AR_exp_s1_l9;
  Expert36_s1_l9_tp1 -> AR_exp_s1_l9;
  Expert37_s1_l9_tp1 -> AR_exp_s1_l9;
  Expert38_s1_l9_tp1 -> AR_exp_s1_l9;
  Expert39_s1_l9_tp1 -> AR_exp_s1_l9;
  Expert40_s1_l9_tp2 -> AR_exp_s1_l9;
  Expert41_s1_l9_tp2 -> AR_exp_s1_l9;
  Expert42_s1_l9_tp2 -> AR_exp_s1_l9;
  Expert43_s1_l9_tp2 -> AR_exp_s1_l9;
  Expert44_s1_l9_tp3 -> AR_exp_s1_l9;
  Expert45_s1_l9_tp3 -> AR_exp_s1_l9;
  Expert46_s1_l9_tp3 -> AR_exp_s1_l9;
  Expert47_s1_l9_tp3 -> AR_exp_s1_l9;
  Expert48_s1_l9_tp4 -> AR_exp_s1_l9;
  Expert49_s1_l9_tp4 -> AR_exp_s1_l9;
  Expert50_s1_l9_tp4 -> AR_exp_s1_l9;
  Expert51_s1_l9_tp4 -> AR_exp_s1_l9;
  Expert52_s1_l9_tp5 -> AR_exp_s1_l9;
  Expert53_s1_l9_tp5 -> AR_exp_s1_l9;
  Expert54_s1_l9_tp5 -> AR_exp_s1_l9;
  Expert55_s1_l9_tp5 -> AR_exp_s1_l9;
  Expert56_s1_l9_tp6 -> AR_exp_s1_l9;
  Expert57_s1_l9_tp6 -> AR_exp_s1_l9;
  Expert58_s1_l9_tp6 -> AR_exp_s1_l9;
  Expert59_s1_l9_tp6 -> AR_exp_s1_l9;
  Expert60_s1_l9_tp7 -> AR_exp_s1_l9;
  Expert61_s1_l9_tp7 -> AR_exp_s1_l9;
  Expert62_s1_l9_tp7 -> AR_exp_s1_l9;
  Expert63_s1_l9_tp7 -> AR_exp_s1_l9;
  ResMOE_s1_l9_tp0 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l9 -> ResMOE_s1_l9_tp0;
  ResAttn_s1_l9_tp0 -> ResMOE_s1_l9_tp0;
  ResMOE_s1_l9_tp1 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l9 -> ResMOE_s1_l9_tp1;
  ResAttn_s1_l9_tp1 -> ResMOE_s1_l9_tp1;
  ResMOE_s1_l9_tp2 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l9 -> ResMOE_s1_l9_tp2;
  ResAttn_s1_l9_tp2 -> ResMOE_s1_l9_tp2;
  ResMOE_s1_l9_tp3 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l9 -> ResMOE_s1_l9_tp3;
  ResAttn_s1_l9_tp3 -> ResMOE_s1_l9_tp3;
  ResMOE_s1_l9_tp4 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l9 -> ResMOE_s1_l9_tp4;
  ResAttn_s1_l9_tp4 -> ResMOE_s1_l9_tp4;
  ResMOE_s1_l9_tp5 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l9 -> ResMOE_s1_l9_tp5;
  ResAttn_s1_l9_tp5 -> ResMOE_s1_l9_tp5;
  ResMOE_s1_l9_tp6 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l9 -> ResMOE_s1_l9_tp6;
  ResAttn_s1_l9_tp6 -> ResMOE_s1_l9_tp6;
  ResMOE_s1_l9_tp7 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l9 -> ResMOE_s1_l9_tp7;
  ResAttn_s1_l9_tp7 -> ResMOE_s1_l9_tp7;
  QKV_s1_l10_tp0 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l9_tp0 -> QKV_s1_l10_tp0;
  QKV_s1_l10_tp1 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l9_tp0 -> QKV_s1_l10_tp1;
  QKV_s1_l10_tp2 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l9_tp0 -> QKV_s1_l10_tp2;
  QKV_s1_l10_tp3 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l9_tp0 -> QKV_s1_l10_tp3;
  QKV_s1_l10_tp4 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l9_tp0 -> QKV_s1_l10_tp4;
  QKV_s1_l10_tp5 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l9_tp0 -> QKV_s1_l10_tp5;
  QKV_s1_l10_tp6 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l9_tp0 -> QKV_s1_l10_tp6;
  QKV_s1_l10_tp7 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l9_tp0 -> QKV_s1_l10_tp7;
  SplitHeads_s1_l10_tp0 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l10_tp0 -> SplitHeads_s1_l10_tp0;
  SplitHeads_s1_l10_tp1 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l10_tp1 -> SplitHeads_s1_l10_tp1;
  SplitHeads_s1_l10_tp2 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l10_tp2 -> SplitHeads_s1_l10_tp2;
  SplitHeads_s1_l10_tp3 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l10_tp3 -> SplitHeads_s1_l10_tp3;
  SplitHeads_s1_l10_tp4 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l10_tp4 -> SplitHeads_s1_l10_tp4;
  SplitHeads_s1_l10_tp5 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l10_tp5 -> SplitHeads_s1_l10_tp5;
  SplitHeads_s1_l10_tp6 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l10_tp6 -> SplitHeads_s1_l10_tp6;
  SplitHeads_s1_l10_tp7 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l10_tp7 -> SplitHeads_s1_l10_tp7;
  A2A_s1_l10 [shape=ellipse, label="AllToAll\nstage1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_s1_l10_tp0 -> A2A_s1_l10;
  SplitHeads_s1_l10_tp1 -> A2A_s1_l10;
  SplitHeads_s1_l10_tp2 -> A2A_s1_l10;
  SplitHeads_s1_l10_tp3 -> A2A_s1_l10;
  SplitHeads_s1_l10_tp4 -> A2A_s1_l10;
  SplitHeads_s1_l10_tp5 -> A2A_s1_l10;
  SplitHeads_s1_l10_tp6 -> A2A_s1_l10;
  SplitHeads_s1_l10_tp7 -> A2A_s1_l10;
  Attn_s1_l10_tp0 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l10 -> Attn_s1_l10_tp0;
  Attn_s1_l10_tp1 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l10 -> Attn_s1_l10_tp1;
  Attn_s1_l10_tp2 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l10 -> Attn_s1_l10_tp2;
  Attn_s1_l10_tp3 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l10 -> Attn_s1_l10_tp3;
  Attn_s1_l10_tp4 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l10 -> Attn_s1_l10_tp4;
  Attn_s1_l10_tp5 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l10 -> Attn_s1_l10_tp5;
  Attn_s1_l10_tp6 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l10 -> Attn_s1_l10_tp6;
  Attn_s1_l10_tp7 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l10 -> Attn_s1_l10_tp7;
  AR_attn_s1_l10 [shape=ellipse, label="AllReduce\nstage1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_s1_l10_tp0 -> AR_attn_s1_l10;
  Attn_s1_l10_tp1 -> AR_attn_s1_l10;
  Attn_s1_l10_tp2 -> AR_attn_s1_l10;
  Attn_s1_l10_tp3 -> AR_attn_s1_l10;
  Attn_s1_l10_tp4 -> AR_attn_s1_l10;
  Attn_s1_l10_tp5 -> AR_attn_s1_l10;
  Attn_s1_l10_tp6 -> AR_attn_s1_l10;
  Attn_s1_l10_tp7 -> AR_attn_s1_l10;
  O_s1_l10_tp0 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l10 -> O_s1_l10_tp0;
  O_s1_l10_tp1 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l10 -> O_s1_l10_tp1;
  O_s1_l10_tp2 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l10 -> O_s1_l10_tp2;
  O_s1_l10_tp3 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l10 -> O_s1_l10_tp3;
  O_s1_l10_tp4 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l10 -> O_s1_l10_tp4;
  O_s1_l10_tp5 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l10 -> O_s1_l10_tp5;
  O_s1_l10_tp6 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l10 -> O_s1_l10_tp6;
  O_s1_l10_tp7 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l10 -> O_s1_l10_tp7;
  ResAttn_s1_l10_tp0 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l10_tp0 -> ResAttn_s1_l10_tp0;
  ResMOE_s1_l9_tp0 -> ResAttn_s1_l10_tp0;
  ResAttn_s1_l10_tp1 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l10_tp1 -> ResAttn_s1_l10_tp1;
  ResMOE_s1_l9_tp0 -> ResAttn_s1_l10_tp1;
  ResAttn_s1_l10_tp2 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l10_tp2 -> ResAttn_s1_l10_tp2;
  ResMOE_s1_l9_tp0 -> ResAttn_s1_l10_tp2;
  ResAttn_s1_l10_tp3 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l10_tp3 -> ResAttn_s1_l10_tp3;
  ResMOE_s1_l9_tp0 -> ResAttn_s1_l10_tp3;
  ResAttn_s1_l10_tp4 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l10_tp4 -> ResAttn_s1_l10_tp4;
  ResMOE_s1_l9_tp0 -> ResAttn_s1_l10_tp4;
  ResAttn_s1_l10_tp5 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l10_tp5 -> ResAttn_s1_l10_tp5;
  ResMOE_s1_l9_tp0 -> ResAttn_s1_l10_tp5;
  ResAttn_s1_l10_tp6 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l10_tp6 -> ResAttn_s1_l10_tp6;
  ResMOE_s1_l9_tp0 -> ResAttn_s1_l10_tp6;
  ResAttn_s1_l10_tp7 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l10_tp7 -> ResAttn_s1_l10_tp7;
  ResMOE_s1_l9_tp0 -> ResAttn_s1_l10_tp7;
  Gate_s1_l10_tp0 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l10_tp0 -> Gate_s1_l10_tp0;
  Gate_s1_l10_tp1 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l10_tp1 -> Gate_s1_l10_tp1;
  Gate_s1_l10_tp2 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l10_tp2 -> Gate_s1_l10_tp2;
  Gate_s1_l10_tp3 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l10_tp3 -> Gate_s1_l10_tp3;
  Gate_s1_l10_tp4 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l10_tp4 -> Gate_s1_l10_tp4;
  Gate_s1_l10_tp5 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l10_tp5 -> Gate_s1_l10_tp5;
  Gate_s1_l10_tp6 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l10_tp6 -> Gate_s1_l10_tp6;
  Gate_s1_l10_tp7 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l10_tp7 -> Gate_s1_l10_tp7;
  Expert32_s1_l10_tp0 [label="Expert32\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp0 -> Expert32_s1_l10_tp0 [style=dashed];
  Expert33_s1_l10_tp0 [label="Expert33\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp0 -> Expert33_s1_l10_tp0 [style=dashed];
  Expert34_s1_l10_tp0 [label="Expert34\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp0 -> Expert34_s1_l10_tp0 [style=dashed];
  Expert35_s1_l10_tp0 [label="Expert35\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp0 -> Expert35_s1_l10_tp0 [style=dashed];
  Expert36_s1_l10_tp1 [label="Expert36\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp1 -> Expert36_s1_l10_tp1 [style=dashed];
  Expert37_s1_l10_tp1 [label="Expert37\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp1 -> Expert37_s1_l10_tp1 [style=dashed];
  Expert38_s1_l10_tp1 [label="Expert38\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp1 -> Expert38_s1_l10_tp1 [style=dashed];
  Expert39_s1_l10_tp1 [label="Expert39\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp1 -> Expert39_s1_l10_tp1 [style=dashed];
  Expert40_s1_l10_tp2 [label="Expert40\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp2 -> Expert40_s1_l10_tp2 [style=dashed];
  Expert41_s1_l10_tp2 [label="Expert41\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp2 -> Expert41_s1_l10_tp2 [style=dashed];
  Expert42_s1_l10_tp2 [label="Expert42\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp2 -> Expert42_s1_l10_tp2 [style=dashed];
  Expert43_s1_l10_tp2 [label="Expert43\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp2 -> Expert43_s1_l10_tp2 [style=dashed];
  Expert44_s1_l10_tp3 [label="Expert44\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp3 -> Expert44_s1_l10_tp3 [style=dashed];
  Expert45_s1_l10_tp3 [label="Expert45\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp3 -> Expert45_s1_l10_tp3 [style=dashed];
  Expert46_s1_l10_tp3 [label="Expert46\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp3 -> Expert46_s1_l10_tp3 [style=dashed];
  Expert47_s1_l10_tp3 [label="Expert47\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp3 -> Expert47_s1_l10_tp3 [style=dashed];
  Expert48_s1_l10_tp4 [label="Expert48\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp4 -> Expert48_s1_l10_tp4 [style=dashed];
  Expert49_s1_l10_tp4 [label="Expert49\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp4 -> Expert49_s1_l10_tp4 [style=dashed];
  Expert50_s1_l10_tp4 [label="Expert50\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp4 -> Expert50_s1_l10_tp4 [style=dashed];
  Expert51_s1_l10_tp4 [label="Expert51\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp4 -> Expert51_s1_l10_tp4 [style=dashed];
  Expert52_s1_l10_tp5 [label="Expert52\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp5 -> Expert52_s1_l10_tp5 [style=dashed];
  Expert53_s1_l10_tp5 [label="Expert53\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp5 -> Expert53_s1_l10_tp5 [style=dashed];
  Expert54_s1_l10_tp5 [label="Expert54\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp5 -> Expert54_s1_l10_tp5 [style=dashed];
  Expert55_s1_l10_tp5 [label="Expert55\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp5 -> Expert55_s1_l10_tp5 [style=dashed];
  Expert56_s1_l10_tp6 [label="Expert56\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp6 -> Expert56_s1_l10_tp6 [style=dashed];
  Expert57_s1_l10_tp6 [label="Expert57\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp6 -> Expert57_s1_l10_tp6 [style=dashed];
  Expert58_s1_l10_tp6 [label="Expert58\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp6 -> Expert58_s1_l10_tp6 [style=dashed];
  Expert59_s1_l10_tp6 [label="Expert59\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp6 -> Expert59_s1_l10_tp6 [style=dashed];
  Expert60_s1_l10_tp7 [label="Expert60\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp7 -> Expert60_s1_l10_tp7 [style=dashed];
  Expert61_s1_l10_tp7 [label="Expert61\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp7 -> Expert61_s1_l10_tp7 [style=dashed];
  Expert62_s1_l10_tp7 [label="Expert62\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp7 -> Expert62_s1_l10_tp7 [style=dashed];
  Expert63_s1_l10_tp7 [label="Expert63\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l10_tp7 -> Expert63_s1_l10_tp7 [style=dashed];
  AR_exp_s1_l10 [shape=ellipse, label="AllReduceExperts\nstage1\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert32_s1_l10_tp0 -> AR_exp_s1_l10;
  Expert33_s1_l10_tp0 -> AR_exp_s1_l10;
  Expert34_s1_l10_tp0 -> AR_exp_s1_l10;
  Expert35_s1_l10_tp0 -> AR_exp_s1_l10;
  Expert36_s1_l10_tp1 -> AR_exp_s1_l10;
  Expert37_s1_l10_tp1 -> AR_exp_s1_l10;
  Expert38_s1_l10_tp1 -> AR_exp_s1_l10;
  Expert39_s1_l10_tp1 -> AR_exp_s1_l10;
  Expert40_s1_l10_tp2 -> AR_exp_s1_l10;
  Expert41_s1_l10_tp2 -> AR_exp_s1_l10;
  Expert42_s1_l10_tp2 -> AR_exp_s1_l10;
  Expert43_s1_l10_tp2 -> AR_exp_s1_l10;
  Expert44_s1_l10_tp3 -> AR_exp_s1_l10;
  Expert45_s1_l10_tp3 -> AR_exp_s1_l10;
  Expert46_s1_l10_tp3 -> AR_exp_s1_l10;
  Expert47_s1_l10_tp3 -> AR_exp_s1_l10;
  Expert48_s1_l10_tp4 -> AR_exp_s1_l10;
  Expert49_s1_l10_tp4 -> AR_exp_s1_l10;
  Expert50_s1_l10_tp4 -> AR_exp_s1_l10;
  Expert51_s1_l10_tp4 -> AR_exp_s1_l10;
  Expert52_s1_l10_tp5 -> AR_exp_s1_l10;
  Expert53_s1_l10_tp5 -> AR_exp_s1_l10;
  Expert54_s1_l10_tp5 -> AR_exp_s1_l10;
  Expert55_s1_l10_tp5 -> AR_exp_s1_l10;
  Expert56_s1_l10_tp6 -> AR_exp_s1_l10;
  Expert57_s1_l10_tp6 -> AR_exp_s1_l10;
  Expert58_s1_l10_tp6 -> AR_exp_s1_l10;
  Expert59_s1_l10_tp6 -> AR_exp_s1_l10;
  Expert60_s1_l10_tp7 -> AR_exp_s1_l10;
  Expert61_s1_l10_tp7 -> AR_exp_s1_l10;
  Expert62_s1_l10_tp7 -> AR_exp_s1_l10;
  Expert63_s1_l10_tp7 -> AR_exp_s1_l10;
  ResMOE_s1_l10_tp0 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l10 -> ResMOE_s1_l10_tp0;
  ResAttn_s1_l10_tp0 -> ResMOE_s1_l10_tp0;
  ResMOE_s1_l10_tp1 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l10 -> ResMOE_s1_l10_tp1;
  ResAttn_s1_l10_tp1 -> ResMOE_s1_l10_tp1;
  ResMOE_s1_l10_tp2 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l10 -> ResMOE_s1_l10_tp2;
  ResAttn_s1_l10_tp2 -> ResMOE_s1_l10_tp2;
  ResMOE_s1_l10_tp3 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l10 -> ResMOE_s1_l10_tp3;
  ResAttn_s1_l10_tp3 -> ResMOE_s1_l10_tp3;
  ResMOE_s1_l10_tp4 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l10 -> ResMOE_s1_l10_tp4;
  ResAttn_s1_l10_tp4 -> ResMOE_s1_l10_tp4;
  ResMOE_s1_l10_tp5 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l10 -> ResMOE_s1_l10_tp5;
  ResAttn_s1_l10_tp5 -> ResMOE_s1_l10_tp5;
  ResMOE_s1_l10_tp6 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l10 -> ResMOE_s1_l10_tp6;
  ResAttn_s1_l10_tp6 -> ResMOE_s1_l10_tp6;
  ResMOE_s1_l10_tp7 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l10 -> ResMOE_s1_l10_tp7;
  ResAttn_s1_l10_tp7 -> ResMOE_s1_l10_tp7;
  QKV_s1_l11_tp0 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l10_tp0 -> QKV_s1_l11_tp0;
  QKV_s1_l11_tp1 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l10_tp0 -> QKV_s1_l11_tp1;
  QKV_s1_l11_tp2 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l10_tp0 -> QKV_s1_l11_tp2;
  QKV_s1_l11_tp3 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l10_tp0 -> QKV_s1_l11_tp3;
  QKV_s1_l11_tp4 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l10_tp0 -> QKV_s1_l11_tp4;
  QKV_s1_l11_tp5 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l10_tp0 -> QKV_s1_l11_tp5;
  QKV_s1_l11_tp6 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l10_tp0 -> QKV_s1_l11_tp6;
  QKV_s1_l11_tp7 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l10_tp0 -> QKV_s1_l11_tp7;
  SplitHeads_s1_l11_tp0 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l11_tp0 -> SplitHeads_s1_l11_tp0;
  SplitHeads_s1_l11_tp1 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l11_tp1 -> SplitHeads_s1_l11_tp1;
  SplitHeads_s1_l11_tp2 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l11_tp2 -> SplitHeads_s1_l11_tp2;
  SplitHeads_s1_l11_tp3 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l11_tp3 -> SplitHeads_s1_l11_tp3;
  SplitHeads_s1_l11_tp4 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l11_tp4 -> SplitHeads_s1_l11_tp4;
  SplitHeads_s1_l11_tp5 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l11_tp5 -> SplitHeads_s1_l11_tp5;
  SplitHeads_s1_l11_tp6 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l11_tp6 -> SplitHeads_s1_l11_tp6;
  SplitHeads_s1_l11_tp7 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l11_tp7 -> SplitHeads_s1_l11_tp7;
  A2A_s1_l11 [shape=ellipse, label="AllToAll\nstage1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_s1_l11_tp0 -> A2A_s1_l11;
  SplitHeads_s1_l11_tp1 -> A2A_s1_l11;
  SplitHeads_s1_l11_tp2 -> A2A_s1_l11;
  SplitHeads_s1_l11_tp3 -> A2A_s1_l11;
  SplitHeads_s1_l11_tp4 -> A2A_s1_l11;
  SplitHeads_s1_l11_tp5 -> A2A_s1_l11;
  SplitHeads_s1_l11_tp6 -> A2A_s1_l11;
  SplitHeads_s1_l11_tp7 -> A2A_s1_l11;
  Attn_s1_l11_tp0 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l11 -> Attn_s1_l11_tp0;
  Attn_s1_l11_tp1 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l11 -> Attn_s1_l11_tp1;
  Attn_s1_l11_tp2 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l11 -> Attn_s1_l11_tp2;
  Attn_s1_l11_tp3 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l11 -> Attn_s1_l11_tp3;
  Attn_s1_l11_tp4 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l11 -> Attn_s1_l11_tp4;
  Attn_s1_l11_tp5 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l11 -> Attn_s1_l11_tp5;
  Attn_s1_l11_tp6 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l11 -> Attn_s1_l11_tp6;
  Attn_s1_l11_tp7 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l11 -> Attn_s1_l11_tp7;
  AR_attn_s1_l11 [shape=ellipse, label="AllReduce\nstage1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_s1_l11_tp0 -> AR_attn_s1_l11;
  Attn_s1_l11_tp1 -> AR_attn_s1_l11;
  Attn_s1_l11_tp2 -> AR_attn_s1_l11;
  Attn_s1_l11_tp3 -> AR_attn_s1_l11;
  Attn_s1_l11_tp4 -> AR_attn_s1_l11;
  Attn_s1_l11_tp5 -> AR_attn_s1_l11;
  Attn_s1_l11_tp6 -> AR_attn_s1_l11;
  Attn_s1_l11_tp7 -> AR_attn_s1_l11;
  O_s1_l11_tp0 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l11 -> O_s1_l11_tp0;
  O_s1_l11_tp1 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l11 -> O_s1_l11_tp1;
  O_s1_l11_tp2 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l11 -> O_s1_l11_tp2;
  O_s1_l11_tp3 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l11 -> O_s1_l11_tp3;
  O_s1_l11_tp4 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l11 -> O_s1_l11_tp4;
  O_s1_l11_tp5 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l11 -> O_s1_l11_tp5;
  O_s1_l11_tp6 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l11 -> O_s1_l11_tp6;
  O_s1_l11_tp7 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l11 -> O_s1_l11_tp7;
  ResAttn_s1_l11_tp0 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l11_tp0 -> ResAttn_s1_l11_tp0;
  ResMOE_s1_l10_tp0 -> ResAttn_s1_l11_tp0;
  ResAttn_s1_l11_tp1 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l11_tp1 -> ResAttn_s1_l11_tp1;
  ResMOE_s1_l10_tp0 -> ResAttn_s1_l11_tp1;
  ResAttn_s1_l11_tp2 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l11_tp2 -> ResAttn_s1_l11_tp2;
  ResMOE_s1_l10_tp0 -> ResAttn_s1_l11_tp2;
  ResAttn_s1_l11_tp3 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l11_tp3 -> ResAttn_s1_l11_tp3;
  ResMOE_s1_l10_tp0 -> ResAttn_s1_l11_tp3;
  ResAttn_s1_l11_tp4 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l11_tp4 -> ResAttn_s1_l11_tp4;
  ResMOE_s1_l10_tp0 -> ResAttn_s1_l11_tp4;
  ResAttn_s1_l11_tp5 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l11_tp5 -> ResAttn_s1_l11_tp5;
  ResMOE_s1_l10_tp0 -> ResAttn_s1_l11_tp5;
  ResAttn_s1_l11_tp6 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l11_tp6 -> ResAttn_s1_l11_tp6;
  ResMOE_s1_l10_tp0 -> ResAttn_s1_l11_tp6;
  ResAttn_s1_l11_tp7 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l11_tp7 -> ResAttn_s1_l11_tp7;
  ResMOE_s1_l10_tp0 -> ResAttn_s1_l11_tp7;
  Gate_s1_l11_tp0 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l11_tp0 -> Gate_s1_l11_tp0;
  Gate_s1_l11_tp1 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l11_tp1 -> Gate_s1_l11_tp1;
  Gate_s1_l11_tp2 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l11_tp2 -> Gate_s1_l11_tp2;
  Gate_s1_l11_tp3 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l11_tp3 -> Gate_s1_l11_tp3;
  Gate_s1_l11_tp4 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l11_tp4 -> Gate_s1_l11_tp4;
  Gate_s1_l11_tp5 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l11_tp5 -> Gate_s1_l11_tp5;
  Gate_s1_l11_tp6 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l11_tp6 -> Gate_s1_l11_tp6;
  Gate_s1_l11_tp7 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l11_tp7 -> Gate_s1_l11_tp7;
  Expert32_s1_l11_tp0 [label="Expert32\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp0 -> Expert32_s1_l11_tp0 [style=dashed];
  Expert33_s1_l11_tp0 [label="Expert33\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp0 -> Expert33_s1_l11_tp0 [style=dashed];
  Expert34_s1_l11_tp0 [label="Expert34\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp0 -> Expert34_s1_l11_tp0 [style=dashed];
  Expert35_s1_l11_tp0 [label="Expert35\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp0 -> Expert35_s1_l11_tp0 [style=dashed];
  Expert36_s1_l11_tp1 [label="Expert36\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp1 -> Expert36_s1_l11_tp1 [style=dashed];
  Expert37_s1_l11_tp1 [label="Expert37\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp1 -> Expert37_s1_l11_tp1 [style=dashed];
  Expert38_s1_l11_tp1 [label="Expert38\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp1 -> Expert38_s1_l11_tp1 [style=dashed];
  Expert39_s1_l11_tp1 [label="Expert39\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp1 -> Expert39_s1_l11_tp1 [style=dashed];
  Expert40_s1_l11_tp2 [label="Expert40\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp2 -> Expert40_s1_l11_tp2 [style=dashed];
  Expert41_s1_l11_tp2 [label="Expert41\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp2 -> Expert41_s1_l11_tp2 [style=dashed];
  Expert42_s1_l11_tp2 [label="Expert42\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp2 -> Expert42_s1_l11_tp2 [style=dashed];
  Expert43_s1_l11_tp2 [label="Expert43\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp2 -> Expert43_s1_l11_tp2 [style=dashed];
  Expert44_s1_l11_tp3 [label="Expert44\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp3 -> Expert44_s1_l11_tp3 [style=dashed];
  Expert45_s1_l11_tp3 [label="Expert45\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp3 -> Expert45_s1_l11_tp3 [style=dashed];
  Expert46_s1_l11_tp3 [label="Expert46\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp3 -> Expert46_s1_l11_tp3 [style=dashed];
  Expert47_s1_l11_tp3 [label="Expert47\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp3 -> Expert47_s1_l11_tp3 [style=dashed];
  Expert48_s1_l11_tp4 [label="Expert48\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp4 -> Expert48_s1_l11_tp4 [style=dashed];
  Expert49_s1_l11_tp4 [label="Expert49\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp4 -> Expert49_s1_l11_tp4 [style=dashed];
  Expert50_s1_l11_tp4 [label="Expert50\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp4 -> Expert50_s1_l11_tp4 [style=dashed];
  Expert51_s1_l11_tp4 [label="Expert51\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp4 -> Expert51_s1_l11_tp4 [style=dashed];
  Expert52_s1_l11_tp5 [label="Expert52\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp5 -> Expert52_s1_l11_tp5 [style=dashed];
  Expert53_s1_l11_tp5 [label="Expert53\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp5 -> Expert53_s1_l11_tp5 [style=dashed];
  Expert54_s1_l11_tp5 [label="Expert54\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp5 -> Expert54_s1_l11_tp5 [style=dashed];
  Expert55_s1_l11_tp5 [label="Expert55\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp5 -> Expert55_s1_l11_tp5 [style=dashed];
  Expert56_s1_l11_tp6 [label="Expert56\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp6 -> Expert56_s1_l11_tp6 [style=dashed];
  Expert57_s1_l11_tp6 [label="Expert57\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp6 -> Expert57_s1_l11_tp6 [style=dashed];
  Expert58_s1_l11_tp6 [label="Expert58\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp6 -> Expert58_s1_l11_tp6 [style=dashed];
  Expert59_s1_l11_tp6 [label="Expert59\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp6 -> Expert59_s1_l11_tp6 [style=dashed];
  Expert60_s1_l11_tp7 [label="Expert60\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp7 -> Expert60_s1_l11_tp7 [style=dashed];
  Expert61_s1_l11_tp7 [label="Expert61\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp7 -> Expert61_s1_l11_tp7 [style=dashed];
  Expert62_s1_l11_tp7 [label="Expert62\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp7 -> Expert62_s1_l11_tp7 [style=dashed];
  Expert63_s1_l11_tp7 [label="Expert63\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l11_tp7 -> Expert63_s1_l11_tp7 [style=dashed];
  AR_exp_s1_l11 [shape=ellipse, label="AllReduceExperts\nstage1\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert32_s1_l11_tp0 -> AR_exp_s1_l11;
  Expert33_s1_l11_tp0 -> AR_exp_s1_l11;
  Expert34_s1_l11_tp0 -> AR_exp_s1_l11;
  Expert35_s1_l11_tp0 -> AR_exp_s1_l11;
  Expert36_s1_l11_tp1 -> AR_exp_s1_l11;
  Expert37_s1_l11_tp1 -> AR_exp_s1_l11;
  Expert38_s1_l11_tp1 -> AR_exp_s1_l11;
  Expert39_s1_l11_tp1 -> AR_exp_s1_l11;
  Expert40_s1_l11_tp2 -> AR_exp_s1_l11;
  Expert41_s1_l11_tp2 -> AR_exp_s1_l11;
  Expert42_s1_l11_tp2 -> AR_exp_s1_l11;
  Expert43_s1_l11_tp2 -> AR_exp_s1_l11;
  Expert44_s1_l11_tp3 -> AR_exp_s1_l11;
  Expert45_s1_l11_tp3 -> AR_exp_s1_l11;
  Expert46_s1_l11_tp3 -> AR_exp_s1_l11;
  Expert47_s1_l11_tp3 -> AR_exp_s1_l11;
  Expert48_s1_l11_tp4 -> AR_exp_s1_l11;
  Expert49_s1_l11_tp4 -> AR_exp_s1_l11;
  Expert50_s1_l11_tp4 -> AR_exp_s1_l11;
  Expert51_s1_l11_tp4 -> AR_exp_s1_l11;
  Expert52_s1_l11_tp5 -> AR_exp_s1_l11;
  Expert53_s1_l11_tp5 -> AR_exp_s1_l11;
  Expert54_s1_l11_tp5 -> AR_exp_s1_l11;
  Expert55_s1_l11_tp5 -> AR_exp_s1_l11;
  Expert56_s1_l11_tp6 -> AR_exp_s1_l11;
  Expert57_s1_l11_tp6 -> AR_exp_s1_l11;
  Expert58_s1_l11_tp6 -> AR_exp_s1_l11;
  Expert59_s1_l11_tp6 -> AR_exp_s1_l11;
  Expert60_s1_l11_tp7 -> AR_exp_s1_l11;
  Expert61_s1_l11_tp7 -> AR_exp_s1_l11;
  Expert62_s1_l11_tp7 -> AR_exp_s1_l11;
  Expert63_s1_l11_tp7 -> AR_exp_s1_l11;
  ResMOE_s1_l11_tp0 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l11 -> ResMOE_s1_l11_tp0;
  ResAttn_s1_l11_tp0 -> ResMOE_s1_l11_tp0;
  ResMOE_s1_l11_tp1 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l11 -> ResMOE_s1_l11_tp1;
  ResAttn_s1_l11_tp1 -> ResMOE_s1_l11_tp1;
  ResMOE_s1_l11_tp2 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l11 -> ResMOE_s1_l11_tp2;
  ResAttn_s1_l11_tp2 -> ResMOE_s1_l11_tp2;
  ResMOE_s1_l11_tp3 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l11 -> ResMOE_s1_l11_tp3;
  ResAttn_s1_l11_tp3 -> ResMOE_s1_l11_tp3;
  ResMOE_s1_l11_tp4 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l11 -> ResMOE_s1_l11_tp4;
  ResAttn_s1_l11_tp4 -> ResMOE_s1_l11_tp4;
  ResMOE_s1_l11_tp5 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l11 -> ResMOE_s1_l11_tp5;
  ResAttn_s1_l11_tp5 -> ResMOE_s1_l11_tp5;
  ResMOE_s1_l11_tp6 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l11 -> ResMOE_s1_l11_tp6;
  ResAttn_s1_l11_tp6 -> ResMOE_s1_l11_tp6;
  ResMOE_s1_l11_tp7 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l11 -> ResMOE_s1_l11_tp7;
  ResAttn_s1_l11_tp7 -> ResMOE_s1_l11_tp7;
  QKV_s1_l12_tp0 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l11_tp0 -> QKV_s1_l12_tp0;
  QKV_s1_l12_tp1 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l11_tp0 -> QKV_s1_l12_tp1;
  QKV_s1_l12_tp2 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l11_tp0 -> QKV_s1_l12_tp2;
  QKV_s1_l12_tp3 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l11_tp0 -> QKV_s1_l12_tp3;
  QKV_s1_l12_tp4 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l11_tp0 -> QKV_s1_l12_tp4;
  QKV_s1_l12_tp5 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l11_tp0 -> QKV_s1_l12_tp5;
  QKV_s1_l12_tp6 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l11_tp0 -> QKV_s1_l12_tp6;
  QKV_s1_l12_tp7 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l11_tp0 -> QKV_s1_l12_tp7;
  SplitHeads_s1_l12_tp0 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l12_tp0 -> SplitHeads_s1_l12_tp0;
  SplitHeads_s1_l12_tp1 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l12_tp1 -> SplitHeads_s1_l12_tp1;
  SplitHeads_s1_l12_tp2 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l12_tp2 -> SplitHeads_s1_l12_tp2;
  SplitHeads_s1_l12_tp3 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l12_tp3 -> SplitHeads_s1_l12_tp3;
  SplitHeads_s1_l12_tp4 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l12_tp4 -> SplitHeads_s1_l12_tp4;
  SplitHeads_s1_l12_tp5 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l12_tp5 -> SplitHeads_s1_l12_tp5;
  SplitHeads_s1_l12_tp6 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l12_tp6 -> SplitHeads_s1_l12_tp6;
  SplitHeads_s1_l12_tp7 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l12_tp7 -> SplitHeads_s1_l12_tp7;
  A2A_s1_l12 [shape=ellipse, label="AllToAll\nstage1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_s1_l12_tp0 -> A2A_s1_l12;
  SplitHeads_s1_l12_tp1 -> A2A_s1_l12;
  SplitHeads_s1_l12_tp2 -> A2A_s1_l12;
  SplitHeads_s1_l12_tp3 -> A2A_s1_l12;
  SplitHeads_s1_l12_tp4 -> A2A_s1_l12;
  SplitHeads_s1_l12_tp5 -> A2A_s1_l12;
  SplitHeads_s1_l12_tp6 -> A2A_s1_l12;
  SplitHeads_s1_l12_tp7 -> A2A_s1_l12;
  Attn_s1_l12_tp0 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l12 -> Attn_s1_l12_tp0;
  Attn_s1_l12_tp1 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l12 -> Attn_s1_l12_tp1;
  Attn_s1_l12_tp2 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l12 -> Attn_s1_l12_tp2;
  Attn_s1_l12_tp3 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l12 -> Attn_s1_l12_tp3;
  Attn_s1_l12_tp4 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l12 -> Attn_s1_l12_tp4;
  Attn_s1_l12_tp5 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l12 -> Attn_s1_l12_tp5;
  Attn_s1_l12_tp6 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l12 -> Attn_s1_l12_tp6;
  Attn_s1_l12_tp7 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l12 -> Attn_s1_l12_tp7;
  AR_attn_s1_l12 [shape=ellipse, label="AllReduce\nstage1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_s1_l12_tp0 -> AR_attn_s1_l12;
  Attn_s1_l12_tp1 -> AR_attn_s1_l12;
  Attn_s1_l12_tp2 -> AR_attn_s1_l12;
  Attn_s1_l12_tp3 -> AR_attn_s1_l12;
  Attn_s1_l12_tp4 -> AR_attn_s1_l12;
  Attn_s1_l12_tp5 -> AR_attn_s1_l12;
  Attn_s1_l12_tp6 -> AR_attn_s1_l12;
  Attn_s1_l12_tp7 -> AR_attn_s1_l12;
  O_s1_l12_tp0 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l12 -> O_s1_l12_tp0;
  O_s1_l12_tp1 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l12 -> O_s1_l12_tp1;
  O_s1_l12_tp2 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l12 -> O_s1_l12_tp2;
  O_s1_l12_tp3 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l12 -> O_s1_l12_tp3;
  O_s1_l12_tp4 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l12 -> O_s1_l12_tp4;
  O_s1_l12_tp5 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l12 -> O_s1_l12_tp5;
  O_s1_l12_tp6 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l12 -> O_s1_l12_tp6;
  O_s1_l12_tp7 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l12 -> O_s1_l12_tp7;
  ResAttn_s1_l12_tp0 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l12_tp0 -> ResAttn_s1_l12_tp0;
  ResMOE_s1_l11_tp0 -> ResAttn_s1_l12_tp0;
  ResAttn_s1_l12_tp1 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l12_tp1 -> ResAttn_s1_l12_tp1;
  ResMOE_s1_l11_tp0 -> ResAttn_s1_l12_tp1;
  ResAttn_s1_l12_tp2 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l12_tp2 -> ResAttn_s1_l12_tp2;
  ResMOE_s1_l11_tp0 -> ResAttn_s1_l12_tp2;
  ResAttn_s1_l12_tp3 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l12_tp3 -> ResAttn_s1_l12_tp3;
  ResMOE_s1_l11_tp0 -> ResAttn_s1_l12_tp3;
  ResAttn_s1_l12_tp4 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l12_tp4 -> ResAttn_s1_l12_tp4;
  ResMOE_s1_l11_tp0 -> ResAttn_s1_l12_tp4;
  ResAttn_s1_l12_tp5 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l12_tp5 -> ResAttn_s1_l12_tp5;
  ResMOE_s1_l11_tp0 -> ResAttn_s1_l12_tp5;
  ResAttn_s1_l12_tp6 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l12_tp6 -> ResAttn_s1_l12_tp6;
  ResMOE_s1_l11_tp0 -> ResAttn_s1_l12_tp6;
  ResAttn_s1_l12_tp7 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l12_tp7 -> ResAttn_s1_l12_tp7;
  ResMOE_s1_l11_tp0 -> ResAttn_s1_l12_tp7;
  Gate_s1_l12_tp0 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l12_tp0 -> Gate_s1_l12_tp0;
  Gate_s1_l12_tp1 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l12_tp1 -> Gate_s1_l12_tp1;
  Gate_s1_l12_tp2 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l12_tp2 -> Gate_s1_l12_tp2;
  Gate_s1_l12_tp3 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l12_tp3 -> Gate_s1_l12_tp3;
  Gate_s1_l12_tp4 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l12_tp4 -> Gate_s1_l12_tp4;
  Gate_s1_l12_tp5 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l12_tp5 -> Gate_s1_l12_tp5;
  Gate_s1_l12_tp6 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l12_tp6 -> Gate_s1_l12_tp6;
  Gate_s1_l12_tp7 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l12_tp7 -> Gate_s1_l12_tp7;
  Expert32_s1_l12_tp0 [label="Expert32\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp0 -> Expert32_s1_l12_tp0 [style=dashed];
  Expert33_s1_l12_tp0 [label="Expert33\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp0 -> Expert33_s1_l12_tp0 [style=dashed];
  Expert34_s1_l12_tp0 [label="Expert34\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp0 -> Expert34_s1_l12_tp0 [style=dashed];
  Expert35_s1_l12_tp0 [label="Expert35\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp0 -> Expert35_s1_l12_tp0 [style=dashed];
  Expert36_s1_l12_tp1 [label="Expert36\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp1 -> Expert36_s1_l12_tp1 [style=dashed];
  Expert37_s1_l12_tp1 [label="Expert37\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp1 -> Expert37_s1_l12_tp1 [style=dashed];
  Expert38_s1_l12_tp1 [label="Expert38\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp1 -> Expert38_s1_l12_tp1 [style=dashed];
  Expert39_s1_l12_tp1 [label="Expert39\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp1 -> Expert39_s1_l12_tp1 [style=dashed];
  Expert40_s1_l12_tp2 [label="Expert40\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp2 -> Expert40_s1_l12_tp2 [style=dashed];
  Expert41_s1_l12_tp2 [label="Expert41\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp2 -> Expert41_s1_l12_tp2 [style=dashed];
  Expert42_s1_l12_tp2 [label="Expert42\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp2 -> Expert42_s1_l12_tp2 [style=dashed];
  Expert43_s1_l12_tp2 [label="Expert43\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp2 -> Expert43_s1_l12_tp2 [style=dashed];
  Expert44_s1_l12_tp3 [label="Expert44\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp3 -> Expert44_s1_l12_tp3 [style=dashed];
  Expert45_s1_l12_tp3 [label="Expert45\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp3 -> Expert45_s1_l12_tp3 [style=dashed];
  Expert46_s1_l12_tp3 [label="Expert46\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp3 -> Expert46_s1_l12_tp3 [style=dashed];
  Expert47_s1_l12_tp3 [label="Expert47\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp3 -> Expert47_s1_l12_tp3 [style=dashed];
  Expert48_s1_l12_tp4 [label="Expert48\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp4 -> Expert48_s1_l12_tp4 [style=dashed];
  Expert49_s1_l12_tp4 [label="Expert49\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp4 -> Expert49_s1_l12_tp4 [style=dashed];
  Expert50_s1_l12_tp4 [label="Expert50\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp4 -> Expert50_s1_l12_tp4 [style=dashed];
  Expert51_s1_l12_tp4 [label="Expert51\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp4 -> Expert51_s1_l12_tp4 [style=dashed];
  Expert52_s1_l12_tp5 [label="Expert52\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp5 -> Expert52_s1_l12_tp5 [style=dashed];
  Expert53_s1_l12_tp5 [label="Expert53\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp5 -> Expert53_s1_l12_tp5 [style=dashed];
  Expert54_s1_l12_tp5 [label="Expert54\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp5 -> Expert54_s1_l12_tp5 [style=dashed];
  Expert55_s1_l12_tp5 [label="Expert55\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp5 -> Expert55_s1_l12_tp5 [style=dashed];
  Expert56_s1_l12_tp6 [label="Expert56\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp6 -> Expert56_s1_l12_tp6 [style=dashed];
  Expert57_s1_l12_tp6 [label="Expert57\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp6 -> Expert57_s1_l12_tp6 [style=dashed];
  Expert58_s1_l12_tp6 [label="Expert58\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp6 -> Expert58_s1_l12_tp6 [style=dashed];
  Expert59_s1_l12_tp6 [label="Expert59\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp6 -> Expert59_s1_l12_tp6 [style=dashed];
  Expert60_s1_l12_tp7 [label="Expert60\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp7 -> Expert60_s1_l12_tp7 [style=dashed];
  Expert61_s1_l12_tp7 [label="Expert61\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp7 -> Expert61_s1_l12_tp7 [style=dashed];
  Expert62_s1_l12_tp7 [label="Expert62\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp7 -> Expert62_s1_l12_tp7 [style=dashed];
  Expert63_s1_l12_tp7 [label="Expert63\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l12_tp7 -> Expert63_s1_l12_tp7 [style=dashed];
  AR_exp_s1_l12 [shape=ellipse, label="AllReduceExperts\nstage1\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert32_s1_l12_tp0 -> AR_exp_s1_l12;
  Expert33_s1_l12_tp0 -> AR_exp_s1_l12;
  Expert34_s1_l12_tp0 -> AR_exp_s1_l12;
  Expert35_s1_l12_tp0 -> AR_exp_s1_l12;
  Expert36_s1_l12_tp1 -> AR_exp_s1_l12;
  Expert37_s1_l12_tp1 -> AR_exp_s1_l12;
  Expert38_s1_l12_tp1 -> AR_exp_s1_l12;
  Expert39_s1_l12_tp1 -> AR_exp_s1_l12;
  Expert40_s1_l12_tp2 -> AR_exp_s1_l12;
  Expert41_s1_l12_tp2 -> AR_exp_s1_l12;
  Expert42_s1_l12_tp2 -> AR_exp_s1_l12;
  Expert43_s1_l12_tp2 -> AR_exp_s1_l12;
  Expert44_s1_l12_tp3 -> AR_exp_s1_l12;
  Expert45_s1_l12_tp3 -> AR_exp_s1_l12;
  Expert46_s1_l12_tp3 -> AR_exp_s1_l12;
  Expert47_s1_l12_tp3 -> AR_exp_s1_l12;
  Expert48_s1_l12_tp4 -> AR_exp_s1_l12;
  Expert49_s1_l12_tp4 -> AR_exp_s1_l12;
  Expert50_s1_l12_tp4 -> AR_exp_s1_l12;
  Expert51_s1_l12_tp4 -> AR_exp_s1_l12;
  Expert52_s1_l12_tp5 -> AR_exp_s1_l12;
  Expert53_s1_l12_tp5 -> AR_exp_s1_l12;
  Expert54_s1_l12_tp5 -> AR_exp_s1_l12;
  Expert55_s1_l12_tp5 -> AR_exp_s1_l12;
  Expert56_s1_l12_tp6 -> AR_exp_s1_l12;
  Expert57_s1_l12_tp6 -> AR_exp_s1_l12;
  Expert58_s1_l12_tp6 -> AR_exp_s1_l12;
  Expert59_s1_l12_tp6 -> AR_exp_s1_l12;
  Expert60_s1_l12_tp7 -> AR_exp_s1_l12;
  Expert61_s1_l12_tp7 -> AR_exp_s1_l12;
  Expert62_s1_l12_tp7 -> AR_exp_s1_l12;
  Expert63_s1_l12_tp7 -> AR_exp_s1_l12;
  ResMOE_s1_l12_tp0 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l12 -> ResMOE_s1_l12_tp0;
  ResAttn_s1_l12_tp0 -> ResMOE_s1_l12_tp0;
  ResMOE_s1_l12_tp1 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l12 -> ResMOE_s1_l12_tp1;
  ResAttn_s1_l12_tp1 -> ResMOE_s1_l12_tp1;
  ResMOE_s1_l12_tp2 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l12 -> ResMOE_s1_l12_tp2;
  ResAttn_s1_l12_tp2 -> ResMOE_s1_l12_tp2;
  ResMOE_s1_l12_tp3 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l12 -> ResMOE_s1_l12_tp3;
  ResAttn_s1_l12_tp3 -> ResMOE_s1_l12_tp3;
  ResMOE_s1_l12_tp4 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l12 -> ResMOE_s1_l12_tp4;
  ResAttn_s1_l12_tp4 -> ResMOE_s1_l12_tp4;
  ResMOE_s1_l12_tp5 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l12 -> ResMOE_s1_l12_tp5;
  ResAttn_s1_l12_tp5 -> ResMOE_s1_l12_tp5;
  ResMOE_s1_l12_tp6 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l12 -> ResMOE_s1_l12_tp6;
  ResAttn_s1_l12_tp6 -> ResMOE_s1_l12_tp6;
  ResMOE_s1_l12_tp7 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l12 -> ResMOE_s1_l12_tp7;
  ResAttn_s1_l12_tp7 -> ResMOE_s1_l12_tp7;
  QKV_s1_l13_tp0 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l12_tp0 -> QKV_s1_l13_tp0;
  QKV_s1_l13_tp1 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l12_tp0 -> QKV_s1_l13_tp1;
  QKV_s1_l13_tp2 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l12_tp0 -> QKV_s1_l13_tp2;
  QKV_s1_l13_tp3 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l12_tp0 -> QKV_s1_l13_tp3;
  QKV_s1_l13_tp4 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l12_tp0 -> QKV_s1_l13_tp4;
  QKV_s1_l13_tp5 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l12_tp0 -> QKV_s1_l13_tp5;
  QKV_s1_l13_tp6 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l12_tp0 -> QKV_s1_l13_tp6;
  QKV_s1_l13_tp7 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l12_tp0 -> QKV_s1_l13_tp7;
  SplitHeads_s1_l13_tp0 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l13_tp0 -> SplitHeads_s1_l13_tp0;
  SplitHeads_s1_l13_tp1 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l13_tp1 -> SplitHeads_s1_l13_tp1;
  SplitHeads_s1_l13_tp2 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l13_tp2 -> SplitHeads_s1_l13_tp2;
  SplitHeads_s1_l13_tp3 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l13_tp3 -> SplitHeads_s1_l13_tp3;
  SplitHeads_s1_l13_tp4 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l13_tp4 -> SplitHeads_s1_l13_tp4;
  SplitHeads_s1_l13_tp5 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l13_tp5 -> SplitHeads_s1_l13_tp5;
  SplitHeads_s1_l13_tp6 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l13_tp6 -> SplitHeads_s1_l13_tp6;
  SplitHeads_s1_l13_tp7 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l13_tp7 -> SplitHeads_s1_l13_tp7;
  A2A_s1_l13 [shape=ellipse, label="AllToAll\nstage1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_s1_l13_tp0 -> A2A_s1_l13;
  SplitHeads_s1_l13_tp1 -> A2A_s1_l13;
  SplitHeads_s1_l13_tp2 -> A2A_s1_l13;
  SplitHeads_s1_l13_tp3 -> A2A_s1_l13;
  SplitHeads_s1_l13_tp4 -> A2A_s1_l13;
  SplitHeads_s1_l13_tp5 -> A2A_s1_l13;
  SplitHeads_s1_l13_tp6 -> A2A_s1_l13;
  SplitHeads_s1_l13_tp7 -> A2A_s1_l13;
  Attn_s1_l13_tp0 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l13 -> Attn_s1_l13_tp0;
  Attn_s1_l13_tp1 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l13 -> Attn_s1_l13_tp1;
  Attn_s1_l13_tp2 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l13 -> Attn_s1_l13_tp2;
  Attn_s1_l13_tp3 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l13 -> Attn_s1_l13_tp3;
  Attn_s1_l13_tp4 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l13 -> Attn_s1_l13_tp4;
  Attn_s1_l13_tp5 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l13 -> Attn_s1_l13_tp5;
  Attn_s1_l13_tp6 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l13 -> Attn_s1_l13_tp6;
  Attn_s1_l13_tp7 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l13 -> Attn_s1_l13_tp7;
  AR_attn_s1_l13 [shape=ellipse, label="AllReduce\nstage1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_s1_l13_tp0 -> AR_attn_s1_l13;
  Attn_s1_l13_tp1 -> AR_attn_s1_l13;
  Attn_s1_l13_tp2 -> AR_attn_s1_l13;
  Attn_s1_l13_tp3 -> AR_attn_s1_l13;
  Attn_s1_l13_tp4 -> AR_attn_s1_l13;
  Attn_s1_l13_tp5 -> AR_attn_s1_l13;
  Attn_s1_l13_tp6 -> AR_attn_s1_l13;
  Attn_s1_l13_tp7 -> AR_attn_s1_l13;
  O_s1_l13_tp0 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l13 -> O_s1_l13_tp0;
  O_s1_l13_tp1 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l13 -> O_s1_l13_tp1;
  O_s1_l13_tp2 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l13 -> O_s1_l13_tp2;
  O_s1_l13_tp3 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l13 -> O_s1_l13_tp3;
  O_s1_l13_tp4 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l13 -> O_s1_l13_tp4;
  O_s1_l13_tp5 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l13 -> O_s1_l13_tp5;
  O_s1_l13_tp6 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l13 -> O_s1_l13_tp6;
  O_s1_l13_tp7 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l13 -> O_s1_l13_tp7;
  ResAttn_s1_l13_tp0 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l13_tp0 -> ResAttn_s1_l13_tp0;
  ResMOE_s1_l12_tp0 -> ResAttn_s1_l13_tp0;
  ResAttn_s1_l13_tp1 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l13_tp1 -> ResAttn_s1_l13_tp1;
  ResMOE_s1_l12_tp0 -> ResAttn_s1_l13_tp1;
  ResAttn_s1_l13_tp2 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l13_tp2 -> ResAttn_s1_l13_tp2;
  ResMOE_s1_l12_tp0 -> ResAttn_s1_l13_tp2;
  ResAttn_s1_l13_tp3 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l13_tp3 -> ResAttn_s1_l13_tp3;
  ResMOE_s1_l12_tp0 -> ResAttn_s1_l13_tp3;
  ResAttn_s1_l13_tp4 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l13_tp4 -> ResAttn_s1_l13_tp4;
  ResMOE_s1_l12_tp0 -> ResAttn_s1_l13_tp4;
  ResAttn_s1_l13_tp5 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l13_tp5 -> ResAttn_s1_l13_tp5;
  ResMOE_s1_l12_tp0 -> ResAttn_s1_l13_tp5;
  ResAttn_s1_l13_tp6 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l13_tp6 -> ResAttn_s1_l13_tp6;
  ResMOE_s1_l12_tp0 -> ResAttn_s1_l13_tp6;
  ResAttn_s1_l13_tp7 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l13_tp7 -> ResAttn_s1_l13_tp7;
  ResMOE_s1_l12_tp0 -> ResAttn_s1_l13_tp7;
  Gate_s1_l13_tp0 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l13_tp0 -> Gate_s1_l13_tp0;
  Gate_s1_l13_tp1 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l13_tp1 -> Gate_s1_l13_tp1;
  Gate_s1_l13_tp2 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l13_tp2 -> Gate_s1_l13_tp2;
  Gate_s1_l13_tp3 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l13_tp3 -> Gate_s1_l13_tp3;
  Gate_s1_l13_tp4 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l13_tp4 -> Gate_s1_l13_tp4;
  Gate_s1_l13_tp5 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l13_tp5 -> Gate_s1_l13_tp5;
  Gate_s1_l13_tp6 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l13_tp6 -> Gate_s1_l13_tp6;
  Gate_s1_l13_tp7 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l13_tp7 -> Gate_s1_l13_tp7;
  Expert32_s1_l13_tp0 [label="Expert32\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp0 -> Expert32_s1_l13_tp0 [style=dashed];
  Expert33_s1_l13_tp0 [label="Expert33\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp0 -> Expert33_s1_l13_tp0 [style=dashed];
  Expert34_s1_l13_tp0 [label="Expert34\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp0 -> Expert34_s1_l13_tp0 [style=dashed];
  Expert35_s1_l13_tp0 [label="Expert35\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp0 -> Expert35_s1_l13_tp0 [style=dashed];
  Expert36_s1_l13_tp1 [label="Expert36\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp1 -> Expert36_s1_l13_tp1 [style=dashed];
  Expert37_s1_l13_tp1 [label="Expert37\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp1 -> Expert37_s1_l13_tp1 [style=dashed];
  Expert38_s1_l13_tp1 [label="Expert38\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp1 -> Expert38_s1_l13_tp1 [style=dashed];
  Expert39_s1_l13_tp1 [label="Expert39\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp1 -> Expert39_s1_l13_tp1 [style=dashed];
  Expert40_s1_l13_tp2 [label="Expert40\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp2 -> Expert40_s1_l13_tp2 [style=dashed];
  Expert41_s1_l13_tp2 [label="Expert41\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp2 -> Expert41_s1_l13_tp2 [style=dashed];
  Expert42_s1_l13_tp2 [label="Expert42\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp2 -> Expert42_s1_l13_tp2 [style=dashed];
  Expert43_s1_l13_tp2 [label="Expert43\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp2 -> Expert43_s1_l13_tp2 [style=dashed];
  Expert44_s1_l13_tp3 [label="Expert44\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp3 -> Expert44_s1_l13_tp3 [style=dashed];
  Expert45_s1_l13_tp3 [label="Expert45\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp3 -> Expert45_s1_l13_tp3 [style=dashed];
  Expert46_s1_l13_tp3 [label="Expert46\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp3 -> Expert46_s1_l13_tp3 [style=dashed];
  Expert47_s1_l13_tp3 [label="Expert47\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp3 -> Expert47_s1_l13_tp3 [style=dashed];
  Expert48_s1_l13_tp4 [label="Expert48\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp4 -> Expert48_s1_l13_tp4 [style=dashed];
  Expert49_s1_l13_tp4 [label="Expert49\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp4 -> Expert49_s1_l13_tp4 [style=dashed];
  Expert50_s1_l13_tp4 [label="Expert50\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp4 -> Expert50_s1_l13_tp4 [style=dashed];
  Expert51_s1_l13_tp4 [label="Expert51\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp4 -> Expert51_s1_l13_tp4 [style=dashed];
  Expert52_s1_l13_tp5 [label="Expert52\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp5 -> Expert52_s1_l13_tp5 [style=dashed];
  Expert53_s1_l13_tp5 [label="Expert53\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp5 -> Expert53_s1_l13_tp5 [style=dashed];
  Expert54_s1_l13_tp5 [label="Expert54\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp5 -> Expert54_s1_l13_tp5 [style=dashed];
  Expert55_s1_l13_tp5 [label="Expert55\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp5 -> Expert55_s1_l13_tp5 [style=dashed];
  Expert56_s1_l13_tp6 [label="Expert56\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp6 -> Expert56_s1_l13_tp6 [style=dashed];
  Expert57_s1_l13_tp6 [label="Expert57\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp6 -> Expert57_s1_l13_tp6 [style=dashed];
  Expert58_s1_l13_tp6 [label="Expert58\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp6 -> Expert58_s1_l13_tp6 [style=dashed];
  Expert59_s1_l13_tp6 [label="Expert59\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp6 -> Expert59_s1_l13_tp6 [style=dashed];
  Expert60_s1_l13_tp7 [label="Expert60\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp7 -> Expert60_s1_l13_tp7 [style=dashed];
  Expert61_s1_l13_tp7 [label="Expert61\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp7 -> Expert61_s1_l13_tp7 [style=dashed];
  Expert62_s1_l13_tp7 [label="Expert62\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp7 -> Expert62_s1_l13_tp7 [style=dashed];
  Expert63_s1_l13_tp7 [label="Expert63\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l13_tp7 -> Expert63_s1_l13_tp7 [style=dashed];
  AR_exp_s1_l13 [shape=ellipse, label="AllReduceExperts\nstage1\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert32_s1_l13_tp0 -> AR_exp_s1_l13;
  Expert33_s1_l13_tp0 -> AR_exp_s1_l13;
  Expert34_s1_l13_tp0 -> AR_exp_s1_l13;
  Expert35_s1_l13_tp0 -> AR_exp_s1_l13;
  Expert36_s1_l13_tp1 -> AR_exp_s1_l13;
  Expert37_s1_l13_tp1 -> AR_exp_s1_l13;
  Expert38_s1_l13_tp1 -> AR_exp_s1_l13;
  Expert39_s1_l13_tp1 -> AR_exp_s1_l13;
  Expert40_s1_l13_tp2 -> AR_exp_s1_l13;
  Expert41_s1_l13_tp2 -> AR_exp_s1_l13;
  Expert42_s1_l13_tp2 -> AR_exp_s1_l13;
  Expert43_s1_l13_tp2 -> AR_exp_s1_l13;
  Expert44_s1_l13_tp3 -> AR_exp_s1_l13;
  Expert45_s1_l13_tp3 -> AR_exp_s1_l13;
  Expert46_s1_l13_tp3 -> AR_exp_s1_l13;
  Expert47_s1_l13_tp3 -> AR_exp_s1_l13;
  Expert48_s1_l13_tp4 -> AR_exp_s1_l13;
  Expert49_s1_l13_tp4 -> AR_exp_s1_l13;
  Expert50_s1_l13_tp4 -> AR_exp_s1_l13;
  Expert51_s1_l13_tp4 -> AR_exp_s1_l13;
  Expert52_s1_l13_tp5 -> AR_exp_s1_l13;
  Expert53_s1_l13_tp5 -> AR_exp_s1_l13;
  Expert54_s1_l13_tp5 -> AR_exp_s1_l13;
  Expert55_s1_l13_tp5 -> AR_exp_s1_l13;
  Expert56_s1_l13_tp6 -> AR_exp_s1_l13;
  Expert57_s1_l13_tp6 -> AR_exp_s1_l13;
  Expert58_s1_l13_tp6 -> AR_exp_s1_l13;
  Expert59_s1_l13_tp6 -> AR_exp_s1_l13;
  Expert60_s1_l13_tp7 -> AR_exp_s1_l13;
  Expert61_s1_l13_tp7 -> AR_exp_s1_l13;
  Expert62_s1_l13_tp7 -> AR_exp_s1_l13;
  Expert63_s1_l13_tp7 -> AR_exp_s1_l13;
  ResMOE_s1_l13_tp0 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l13 -> ResMOE_s1_l13_tp0;
  ResAttn_s1_l13_tp0 -> ResMOE_s1_l13_tp0;
  ResMOE_s1_l13_tp1 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l13 -> ResMOE_s1_l13_tp1;
  ResAttn_s1_l13_tp1 -> ResMOE_s1_l13_tp1;
  ResMOE_s1_l13_tp2 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l13 -> ResMOE_s1_l13_tp2;
  ResAttn_s1_l13_tp2 -> ResMOE_s1_l13_tp2;
  ResMOE_s1_l13_tp3 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l13 -> ResMOE_s1_l13_tp3;
  ResAttn_s1_l13_tp3 -> ResMOE_s1_l13_tp3;
  ResMOE_s1_l13_tp4 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l13 -> ResMOE_s1_l13_tp4;
  ResAttn_s1_l13_tp4 -> ResMOE_s1_l13_tp4;
  ResMOE_s1_l13_tp5 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l13 -> ResMOE_s1_l13_tp5;
  ResAttn_s1_l13_tp5 -> ResMOE_s1_l13_tp5;
  ResMOE_s1_l13_tp6 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l13 -> ResMOE_s1_l13_tp6;
  ResAttn_s1_l13_tp6 -> ResMOE_s1_l13_tp6;
  ResMOE_s1_l13_tp7 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l13 -> ResMOE_s1_l13_tp7;
  ResAttn_s1_l13_tp7 -> ResMOE_s1_l13_tp7;
  QKV_s1_l14_tp0 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l13_tp0 -> QKV_s1_l14_tp0;
  QKV_s1_l14_tp1 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l13_tp0 -> QKV_s1_l14_tp1;
  QKV_s1_l14_tp2 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l13_tp0 -> QKV_s1_l14_tp2;
  QKV_s1_l14_tp3 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l13_tp0 -> QKV_s1_l14_tp3;
  QKV_s1_l14_tp4 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l13_tp0 -> QKV_s1_l14_tp4;
  QKV_s1_l14_tp5 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l13_tp0 -> QKV_s1_l14_tp5;
  QKV_s1_l14_tp6 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l13_tp0 -> QKV_s1_l14_tp6;
  QKV_s1_l14_tp7 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l13_tp0 -> QKV_s1_l14_tp7;
  SplitHeads_s1_l14_tp0 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l14_tp0 -> SplitHeads_s1_l14_tp0;
  SplitHeads_s1_l14_tp1 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l14_tp1 -> SplitHeads_s1_l14_tp1;
  SplitHeads_s1_l14_tp2 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l14_tp2 -> SplitHeads_s1_l14_tp2;
  SplitHeads_s1_l14_tp3 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l14_tp3 -> SplitHeads_s1_l14_tp3;
  SplitHeads_s1_l14_tp4 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l14_tp4 -> SplitHeads_s1_l14_tp4;
  SplitHeads_s1_l14_tp5 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l14_tp5 -> SplitHeads_s1_l14_tp5;
  SplitHeads_s1_l14_tp6 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l14_tp6 -> SplitHeads_s1_l14_tp6;
  SplitHeads_s1_l14_tp7 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l14_tp7 -> SplitHeads_s1_l14_tp7;
  A2A_s1_l14 [shape=ellipse, label="AllToAll\nstage1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_s1_l14_tp0 -> A2A_s1_l14;
  SplitHeads_s1_l14_tp1 -> A2A_s1_l14;
  SplitHeads_s1_l14_tp2 -> A2A_s1_l14;
  SplitHeads_s1_l14_tp3 -> A2A_s1_l14;
  SplitHeads_s1_l14_tp4 -> A2A_s1_l14;
  SplitHeads_s1_l14_tp5 -> A2A_s1_l14;
  SplitHeads_s1_l14_tp6 -> A2A_s1_l14;
  SplitHeads_s1_l14_tp7 -> A2A_s1_l14;
  Attn_s1_l14_tp0 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l14 -> Attn_s1_l14_tp0;
  Attn_s1_l14_tp1 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l14 -> Attn_s1_l14_tp1;
  Attn_s1_l14_tp2 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l14 -> Attn_s1_l14_tp2;
  Attn_s1_l14_tp3 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l14 -> Attn_s1_l14_tp3;
  Attn_s1_l14_tp4 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l14 -> Attn_s1_l14_tp4;
  Attn_s1_l14_tp5 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l14 -> Attn_s1_l14_tp5;
  Attn_s1_l14_tp6 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l14 -> Attn_s1_l14_tp6;
  Attn_s1_l14_tp7 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l14 -> Attn_s1_l14_tp7;
  AR_attn_s1_l14 [shape=ellipse, label="AllReduce\nstage1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_s1_l14_tp0 -> AR_attn_s1_l14;
  Attn_s1_l14_tp1 -> AR_attn_s1_l14;
  Attn_s1_l14_tp2 -> AR_attn_s1_l14;
  Attn_s1_l14_tp3 -> AR_attn_s1_l14;
  Attn_s1_l14_tp4 -> AR_attn_s1_l14;
  Attn_s1_l14_tp5 -> AR_attn_s1_l14;
  Attn_s1_l14_tp6 -> AR_attn_s1_l14;
  Attn_s1_l14_tp7 -> AR_attn_s1_l14;
  O_s1_l14_tp0 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l14 -> O_s1_l14_tp0;
  O_s1_l14_tp1 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l14 -> O_s1_l14_tp1;
  O_s1_l14_tp2 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l14 -> O_s1_l14_tp2;
  O_s1_l14_tp3 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l14 -> O_s1_l14_tp3;
  O_s1_l14_tp4 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l14 -> O_s1_l14_tp4;
  O_s1_l14_tp5 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l14 -> O_s1_l14_tp5;
  O_s1_l14_tp6 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l14 -> O_s1_l14_tp6;
  O_s1_l14_tp7 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l14 -> O_s1_l14_tp7;
  ResAttn_s1_l14_tp0 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l14_tp0 -> ResAttn_s1_l14_tp0;
  ResMOE_s1_l13_tp0 -> ResAttn_s1_l14_tp0;
  ResAttn_s1_l14_tp1 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l14_tp1 -> ResAttn_s1_l14_tp1;
  ResMOE_s1_l13_tp0 -> ResAttn_s1_l14_tp1;
  ResAttn_s1_l14_tp2 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l14_tp2 -> ResAttn_s1_l14_tp2;
  ResMOE_s1_l13_tp0 -> ResAttn_s1_l14_tp2;
  ResAttn_s1_l14_tp3 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l14_tp3 -> ResAttn_s1_l14_tp3;
  ResMOE_s1_l13_tp0 -> ResAttn_s1_l14_tp3;
  ResAttn_s1_l14_tp4 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l14_tp4 -> ResAttn_s1_l14_tp4;
  ResMOE_s1_l13_tp0 -> ResAttn_s1_l14_tp4;
  ResAttn_s1_l14_tp5 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l14_tp5 -> ResAttn_s1_l14_tp5;
  ResMOE_s1_l13_tp0 -> ResAttn_s1_l14_tp5;
  ResAttn_s1_l14_tp6 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l14_tp6 -> ResAttn_s1_l14_tp6;
  ResMOE_s1_l13_tp0 -> ResAttn_s1_l14_tp6;
  ResAttn_s1_l14_tp7 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l14_tp7 -> ResAttn_s1_l14_tp7;
  ResMOE_s1_l13_tp0 -> ResAttn_s1_l14_tp7;
  Gate_s1_l14_tp0 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l14_tp0 -> Gate_s1_l14_tp0;
  Gate_s1_l14_tp1 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l14_tp1 -> Gate_s1_l14_tp1;
  Gate_s1_l14_tp2 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l14_tp2 -> Gate_s1_l14_tp2;
  Gate_s1_l14_tp3 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l14_tp3 -> Gate_s1_l14_tp3;
  Gate_s1_l14_tp4 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l14_tp4 -> Gate_s1_l14_tp4;
  Gate_s1_l14_tp5 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l14_tp5 -> Gate_s1_l14_tp5;
  Gate_s1_l14_tp6 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l14_tp6 -> Gate_s1_l14_tp6;
  Gate_s1_l14_tp7 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l14_tp7 -> Gate_s1_l14_tp7;
  Expert32_s1_l14_tp0 [label="Expert32\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp0 -> Expert32_s1_l14_tp0 [style=dashed];
  Expert33_s1_l14_tp0 [label="Expert33\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp0 -> Expert33_s1_l14_tp0 [style=dashed];
  Expert34_s1_l14_tp0 [label="Expert34\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp0 -> Expert34_s1_l14_tp0 [style=dashed];
  Expert35_s1_l14_tp0 [label="Expert35\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp0 -> Expert35_s1_l14_tp0 [style=dashed];
  Expert36_s1_l14_tp1 [label="Expert36\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp1 -> Expert36_s1_l14_tp1 [style=dashed];
  Expert37_s1_l14_tp1 [label="Expert37\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp1 -> Expert37_s1_l14_tp1 [style=dashed];
  Expert38_s1_l14_tp1 [label="Expert38\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp1 -> Expert38_s1_l14_tp1 [style=dashed];
  Expert39_s1_l14_tp1 [label="Expert39\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp1 -> Expert39_s1_l14_tp1 [style=dashed];
  Expert40_s1_l14_tp2 [label="Expert40\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp2 -> Expert40_s1_l14_tp2 [style=dashed];
  Expert41_s1_l14_tp2 [label="Expert41\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp2 -> Expert41_s1_l14_tp2 [style=dashed];
  Expert42_s1_l14_tp2 [label="Expert42\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp2 -> Expert42_s1_l14_tp2 [style=dashed];
  Expert43_s1_l14_tp2 [label="Expert43\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp2 -> Expert43_s1_l14_tp2 [style=dashed];
  Expert44_s1_l14_tp3 [label="Expert44\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp3 -> Expert44_s1_l14_tp3 [style=dashed];
  Expert45_s1_l14_tp3 [label="Expert45\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp3 -> Expert45_s1_l14_tp3 [style=dashed];
  Expert46_s1_l14_tp3 [label="Expert46\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp3 -> Expert46_s1_l14_tp3 [style=dashed];
  Expert47_s1_l14_tp3 [label="Expert47\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp3 -> Expert47_s1_l14_tp3 [style=dashed];
  Expert48_s1_l14_tp4 [label="Expert48\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp4 -> Expert48_s1_l14_tp4 [style=dashed];
  Expert49_s1_l14_tp4 [label="Expert49\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp4 -> Expert49_s1_l14_tp4 [style=dashed];
  Expert50_s1_l14_tp4 [label="Expert50\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp4 -> Expert50_s1_l14_tp4 [style=dashed];
  Expert51_s1_l14_tp4 [label="Expert51\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp4 -> Expert51_s1_l14_tp4 [style=dashed];
  Expert52_s1_l14_tp5 [label="Expert52\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp5 -> Expert52_s1_l14_tp5 [style=dashed];
  Expert53_s1_l14_tp5 [label="Expert53\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp5 -> Expert53_s1_l14_tp5 [style=dashed];
  Expert54_s1_l14_tp5 [label="Expert54\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp5 -> Expert54_s1_l14_tp5 [style=dashed];
  Expert55_s1_l14_tp5 [label="Expert55\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp5 -> Expert55_s1_l14_tp5 [style=dashed];
  Expert56_s1_l14_tp6 [label="Expert56\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp6 -> Expert56_s1_l14_tp6 [style=dashed];
  Expert57_s1_l14_tp6 [label="Expert57\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp6 -> Expert57_s1_l14_tp6 [style=dashed];
  Expert58_s1_l14_tp6 [label="Expert58\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp6 -> Expert58_s1_l14_tp6 [style=dashed];
  Expert59_s1_l14_tp6 [label="Expert59\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp6 -> Expert59_s1_l14_tp6 [style=dashed];
  Expert60_s1_l14_tp7 [label="Expert60\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp7 -> Expert60_s1_l14_tp7 [style=dashed];
  Expert61_s1_l14_tp7 [label="Expert61\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp7 -> Expert61_s1_l14_tp7 [style=dashed];
  Expert62_s1_l14_tp7 [label="Expert62\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp7 -> Expert62_s1_l14_tp7 [style=dashed];
  Expert63_s1_l14_tp7 [label="Expert63\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l14_tp7 -> Expert63_s1_l14_tp7 [style=dashed];
  AR_exp_s1_l14 [shape=ellipse, label="AllReduceExperts\nstage1\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert32_s1_l14_tp0 -> AR_exp_s1_l14;
  Expert33_s1_l14_tp0 -> AR_exp_s1_l14;
  Expert34_s1_l14_tp0 -> AR_exp_s1_l14;
  Expert35_s1_l14_tp0 -> AR_exp_s1_l14;
  Expert36_s1_l14_tp1 -> AR_exp_s1_l14;
  Expert37_s1_l14_tp1 -> AR_exp_s1_l14;
  Expert38_s1_l14_tp1 -> AR_exp_s1_l14;
  Expert39_s1_l14_tp1 -> AR_exp_s1_l14;
  Expert40_s1_l14_tp2 -> AR_exp_s1_l14;
  Expert41_s1_l14_tp2 -> AR_exp_s1_l14;
  Expert42_s1_l14_tp2 -> AR_exp_s1_l14;
  Expert43_s1_l14_tp2 -> AR_exp_s1_l14;
  Expert44_s1_l14_tp3 -> AR_exp_s1_l14;
  Expert45_s1_l14_tp3 -> AR_exp_s1_l14;
  Expert46_s1_l14_tp3 -> AR_exp_s1_l14;
  Expert47_s1_l14_tp3 -> AR_exp_s1_l14;
  Expert48_s1_l14_tp4 -> AR_exp_s1_l14;
  Expert49_s1_l14_tp4 -> AR_exp_s1_l14;
  Expert50_s1_l14_tp4 -> AR_exp_s1_l14;
  Expert51_s1_l14_tp4 -> AR_exp_s1_l14;
  Expert52_s1_l14_tp5 -> AR_exp_s1_l14;
  Expert53_s1_l14_tp5 -> AR_exp_s1_l14;
  Expert54_s1_l14_tp5 -> AR_exp_s1_l14;
  Expert55_s1_l14_tp5 -> AR_exp_s1_l14;
  Expert56_s1_l14_tp6 -> AR_exp_s1_l14;
  Expert57_s1_l14_tp6 -> AR_exp_s1_l14;
  Expert58_s1_l14_tp6 -> AR_exp_s1_l14;
  Expert59_s1_l14_tp6 -> AR_exp_s1_l14;
  Expert60_s1_l14_tp7 -> AR_exp_s1_l14;
  Expert61_s1_l14_tp7 -> AR_exp_s1_l14;
  Expert62_s1_l14_tp7 -> AR_exp_s1_l14;
  Expert63_s1_l14_tp7 -> AR_exp_s1_l14;
  ResMOE_s1_l14_tp0 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l14 -> ResMOE_s1_l14_tp0;
  ResAttn_s1_l14_tp0 -> ResMOE_s1_l14_tp0;
  ResMOE_s1_l14_tp1 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l14 -> ResMOE_s1_l14_tp1;
  ResAttn_s1_l14_tp1 -> ResMOE_s1_l14_tp1;
  ResMOE_s1_l14_tp2 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l14 -> ResMOE_s1_l14_tp2;
  ResAttn_s1_l14_tp2 -> ResMOE_s1_l14_tp2;
  ResMOE_s1_l14_tp3 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l14 -> ResMOE_s1_l14_tp3;
  ResAttn_s1_l14_tp3 -> ResMOE_s1_l14_tp3;
  ResMOE_s1_l14_tp4 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l14 -> ResMOE_s1_l14_tp4;
  ResAttn_s1_l14_tp4 -> ResMOE_s1_l14_tp4;
  ResMOE_s1_l14_tp5 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l14 -> ResMOE_s1_l14_tp5;
  ResAttn_s1_l14_tp5 -> ResMOE_s1_l14_tp5;
  ResMOE_s1_l14_tp6 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l14 -> ResMOE_s1_l14_tp6;
  ResAttn_s1_l14_tp6 -> ResMOE_s1_l14_tp6;
  ResMOE_s1_l14_tp7 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l14 -> ResMOE_s1_l14_tp7;
  ResAttn_s1_l14_tp7 -> ResMOE_s1_l14_tp7;
  QKV_s1_l15_tp0 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l14_tp0 -> QKV_s1_l15_tp0;
  QKV_s1_l15_tp1 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l14_tp0 -> QKV_s1_l15_tp1;
  QKV_s1_l15_tp2 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l14_tp0 -> QKV_s1_l15_tp2;
  QKV_s1_l15_tp3 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l14_tp0 -> QKV_s1_l15_tp3;
  QKV_s1_l15_tp4 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l14_tp0 -> QKV_s1_l15_tp4;
  QKV_s1_l15_tp5 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l14_tp0 -> QKV_s1_l15_tp5;
  QKV_s1_l15_tp6 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l14_tp0 -> QKV_s1_l15_tp6;
  QKV_s1_l15_tp7 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l14_tp0 -> QKV_s1_l15_tp7;
  SplitHeads_s1_l15_tp0 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l15_tp0 -> SplitHeads_s1_l15_tp0;
  SplitHeads_s1_l15_tp1 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l15_tp1 -> SplitHeads_s1_l15_tp1;
  SplitHeads_s1_l15_tp2 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l15_tp2 -> SplitHeads_s1_l15_tp2;
  SplitHeads_s1_l15_tp3 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l15_tp3 -> SplitHeads_s1_l15_tp3;
  SplitHeads_s1_l15_tp4 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l15_tp4 -> SplitHeads_s1_l15_tp4;
  SplitHeads_s1_l15_tp5 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l15_tp5 -> SplitHeads_s1_l15_tp5;
  SplitHeads_s1_l15_tp6 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l15_tp6 -> SplitHeads_s1_l15_tp6;
  SplitHeads_s1_l15_tp7 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l15_tp7 -> SplitHeads_s1_l15_tp7;
  A2A_s1_l15 [shape=ellipse, label="AllToAll\nstage1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_s1_l15_tp0 -> A2A_s1_l15;
  SplitHeads_s1_l15_tp1 -> A2A_s1_l15;
  SplitHeads_s1_l15_tp2 -> A2A_s1_l15;
  SplitHeads_s1_l15_tp3 -> A2A_s1_l15;
  SplitHeads_s1_l15_tp4 -> A2A_s1_l15;
  SplitHeads_s1_l15_tp5 -> A2A_s1_l15;
  SplitHeads_s1_l15_tp6 -> A2A_s1_l15;
  SplitHeads_s1_l15_tp7 -> A2A_s1_l15;
  Attn_s1_l15_tp0 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l15 -> Attn_s1_l15_tp0;
  Attn_s1_l15_tp1 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l15 -> Attn_s1_l15_tp1;
  Attn_s1_l15_tp2 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l15 -> Attn_s1_l15_tp2;
  Attn_s1_l15_tp3 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l15 -> Attn_s1_l15_tp3;
  Attn_s1_l15_tp4 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l15 -> Attn_s1_l15_tp4;
  Attn_s1_l15_tp5 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l15 -> Attn_s1_l15_tp5;
  Attn_s1_l15_tp6 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l15 -> Attn_s1_l15_tp6;
  Attn_s1_l15_tp7 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l15 -> Attn_s1_l15_tp7;
  AR_attn_s1_l15 [shape=ellipse, label="AllReduce\nstage1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_s1_l15_tp0 -> AR_attn_s1_l15;
  Attn_s1_l15_tp1 -> AR_attn_s1_l15;
  Attn_s1_l15_tp2 -> AR_attn_s1_l15;
  Attn_s1_l15_tp3 -> AR_attn_s1_l15;
  Attn_s1_l15_tp4 -> AR_attn_s1_l15;
  Attn_s1_l15_tp5 -> AR_attn_s1_l15;
  Attn_s1_l15_tp6 -> AR_attn_s1_l15;
  Attn_s1_l15_tp7 -> AR_attn_s1_l15;
  O_s1_l15_tp0 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l15 -> O_s1_l15_tp0;
  O_s1_l15_tp1 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l15 -> O_s1_l15_tp1;
  O_s1_l15_tp2 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l15 -> O_s1_l15_tp2;
  O_s1_l15_tp3 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l15 -> O_s1_l15_tp3;
  O_s1_l15_tp4 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l15 -> O_s1_l15_tp4;
  O_s1_l15_tp5 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l15 -> O_s1_l15_tp5;
  O_s1_l15_tp6 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l15 -> O_s1_l15_tp6;
  O_s1_l15_tp7 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l15 -> O_s1_l15_tp7;
  ResAttn_s1_l15_tp0 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l15_tp0 -> ResAttn_s1_l15_tp0;
  ResMOE_s1_l14_tp0 -> ResAttn_s1_l15_tp0;
  ResAttn_s1_l15_tp1 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l15_tp1 -> ResAttn_s1_l15_tp1;
  ResMOE_s1_l14_tp0 -> ResAttn_s1_l15_tp1;
  ResAttn_s1_l15_tp2 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l15_tp2 -> ResAttn_s1_l15_tp2;
  ResMOE_s1_l14_tp0 -> ResAttn_s1_l15_tp2;
  ResAttn_s1_l15_tp3 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l15_tp3 -> ResAttn_s1_l15_tp3;
  ResMOE_s1_l14_tp0 -> ResAttn_s1_l15_tp3;
  ResAttn_s1_l15_tp4 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l15_tp4 -> ResAttn_s1_l15_tp4;
  ResMOE_s1_l14_tp0 -> ResAttn_s1_l15_tp4;
  ResAttn_s1_l15_tp5 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l15_tp5 -> ResAttn_s1_l15_tp5;
  ResMOE_s1_l14_tp0 -> ResAttn_s1_l15_tp5;
  ResAttn_s1_l15_tp6 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l15_tp6 -> ResAttn_s1_l15_tp6;
  ResMOE_s1_l14_tp0 -> ResAttn_s1_l15_tp6;
  ResAttn_s1_l15_tp7 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l15_tp7 -> ResAttn_s1_l15_tp7;
  ResMOE_s1_l14_tp0 -> ResAttn_s1_l15_tp7;
  Gate_s1_l15_tp0 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l15_tp0 -> Gate_s1_l15_tp0;
  Gate_s1_l15_tp1 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l15_tp1 -> Gate_s1_l15_tp1;
  Gate_s1_l15_tp2 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l15_tp2 -> Gate_s1_l15_tp2;
  Gate_s1_l15_tp3 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l15_tp3 -> Gate_s1_l15_tp3;
  Gate_s1_l15_tp4 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l15_tp4 -> Gate_s1_l15_tp4;
  Gate_s1_l15_tp5 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l15_tp5 -> Gate_s1_l15_tp5;
  Gate_s1_l15_tp6 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l15_tp6 -> Gate_s1_l15_tp6;
  Gate_s1_l15_tp7 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l15_tp7 -> Gate_s1_l15_tp7;
  Expert32_s1_l15_tp0 [label="Expert32\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp0 -> Expert32_s1_l15_tp0 [style=dashed];
  Expert33_s1_l15_tp0 [label="Expert33\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp0 -> Expert33_s1_l15_tp0 [style=dashed];
  Expert34_s1_l15_tp0 [label="Expert34\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp0 -> Expert34_s1_l15_tp0 [style=dashed];
  Expert35_s1_l15_tp0 [label="Expert35\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp0 -> Expert35_s1_l15_tp0 [style=dashed];
  Expert36_s1_l15_tp1 [label="Expert36\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp1 -> Expert36_s1_l15_tp1 [style=dashed];
  Expert37_s1_l15_tp1 [label="Expert37\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp1 -> Expert37_s1_l15_tp1 [style=dashed];
  Expert38_s1_l15_tp1 [label="Expert38\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp1 -> Expert38_s1_l15_tp1 [style=dashed];
  Expert39_s1_l15_tp1 [label="Expert39\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp1 -> Expert39_s1_l15_tp1 [style=dashed];
  Expert40_s1_l15_tp2 [label="Expert40\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp2 -> Expert40_s1_l15_tp2 [style=dashed];
  Expert41_s1_l15_tp2 [label="Expert41\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp2 -> Expert41_s1_l15_tp2 [style=dashed];
  Expert42_s1_l15_tp2 [label="Expert42\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp2 -> Expert42_s1_l15_tp2 [style=dashed];
  Expert43_s1_l15_tp2 [label="Expert43\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp2 -> Expert43_s1_l15_tp2 [style=dashed];
  Expert44_s1_l15_tp3 [label="Expert44\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp3 -> Expert44_s1_l15_tp3 [style=dashed];
  Expert45_s1_l15_tp3 [label="Expert45\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp3 -> Expert45_s1_l15_tp3 [style=dashed];
  Expert46_s1_l15_tp3 [label="Expert46\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp3 -> Expert46_s1_l15_tp3 [style=dashed];
  Expert47_s1_l15_tp3 [label="Expert47\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp3 -> Expert47_s1_l15_tp3 [style=dashed];
  Expert48_s1_l15_tp4 [label="Expert48\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp4 -> Expert48_s1_l15_tp4 [style=dashed];
  Expert49_s1_l15_tp4 [label="Expert49\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp4 -> Expert49_s1_l15_tp4 [style=dashed];
  Expert50_s1_l15_tp4 [label="Expert50\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp4 -> Expert50_s1_l15_tp4 [style=dashed];
  Expert51_s1_l15_tp4 [label="Expert51\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp4 -> Expert51_s1_l15_tp4 [style=dashed];
  Expert52_s1_l15_tp5 [label="Expert52\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp5 -> Expert52_s1_l15_tp5 [style=dashed];
  Expert53_s1_l15_tp5 [label="Expert53\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp5 -> Expert53_s1_l15_tp5 [style=dashed];
  Expert54_s1_l15_tp5 [label="Expert54\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp5 -> Expert54_s1_l15_tp5 [style=dashed];
  Expert55_s1_l15_tp5 [label="Expert55\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp5 -> Expert55_s1_l15_tp5 [style=dashed];
  Expert56_s1_l15_tp6 [label="Expert56\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp6 -> Expert56_s1_l15_tp6 [style=dashed];
  Expert57_s1_l15_tp6 [label="Expert57\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp6 -> Expert57_s1_l15_tp6 [style=dashed];
  Expert58_s1_l15_tp6 [label="Expert58\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp6 -> Expert58_s1_l15_tp6 [style=dashed];
  Expert59_s1_l15_tp6 [label="Expert59\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp6 -> Expert59_s1_l15_tp6 [style=dashed];
  Expert60_s1_l15_tp7 [label="Expert60\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp7 -> Expert60_s1_l15_tp7 [style=dashed];
  Expert61_s1_l15_tp7 [label="Expert61\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp7 -> Expert61_s1_l15_tp7 [style=dashed];
  Expert62_s1_l15_tp7 [label="Expert62\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp7 -> Expert62_s1_l15_tp7 [style=dashed];
  Expert63_s1_l15_tp7 [label="Expert63\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l15_tp7 -> Expert63_s1_l15_tp7 [style=dashed];
  AR_exp_s1_l15 [shape=ellipse, label="AllReduceExperts\nstage1\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert32_s1_l15_tp0 -> AR_exp_s1_l15;
  Expert33_s1_l15_tp0 -> AR_exp_s1_l15;
  Expert34_s1_l15_tp0 -> AR_exp_s1_l15;
  Expert35_s1_l15_tp0 -> AR_exp_s1_l15;
  Expert36_s1_l15_tp1 -> AR_exp_s1_l15;
  Expert37_s1_l15_tp1 -> AR_exp_s1_l15;
  Expert38_s1_l15_tp1 -> AR_exp_s1_l15;
  Expert39_s1_l15_tp1 -> AR_exp_s1_l15;
  Expert40_s1_l15_tp2 -> AR_exp_s1_l15;
  Expert41_s1_l15_tp2 -> AR_exp_s1_l15;
  Expert42_s1_l15_tp2 -> AR_exp_s1_l15;
  Expert43_s1_l15_tp2 -> AR_exp_s1_l15;
  Expert44_s1_l15_tp3 -> AR_exp_s1_l15;
  Expert45_s1_l15_tp3 -> AR_exp_s1_l15;
  Expert46_s1_l15_tp3 -> AR_exp_s1_l15;
  Expert47_s1_l15_tp3 -> AR_exp_s1_l15;
  Expert48_s1_l15_tp4 -> AR_exp_s1_l15;
  Expert49_s1_l15_tp4 -> AR_exp_s1_l15;
  Expert50_s1_l15_tp4 -> AR_exp_s1_l15;
  Expert51_s1_l15_tp4 -> AR_exp_s1_l15;
  Expert52_s1_l15_tp5 -> AR_exp_s1_l15;
  Expert53_s1_l15_tp5 -> AR_exp_s1_l15;
  Expert54_s1_l15_tp5 -> AR_exp_s1_l15;
  Expert55_s1_l15_tp5 -> AR_exp_s1_l15;
  Expert56_s1_l15_tp6 -> AR_exp_s1_l15;
  Expert57_s1_l15_tp6 -> AR_exp_s1_l15;
  Expert58_s1_l15_tp6 -> AR_exp_s1_l15;
  Expert59_s1_l15_tp6 -> AR_exp_s1_l15;
  Expert60_s1_l15_tp7 -> AR_exp_s1_l15;
  Expert61_s1_l15_tp7 -> AR_exp_s1_l15;
  Expert62_s1_l15_tp7 -> AR_exp_s1_l15;
  Expert63_s1_l15_tp7 -> AR_exp_s1_l15;
  ResMOE_s1_l15_tp0 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l15 -> ResMOE_s1_l15_tp0;
  ResAttn_s1_l15_tp0 -> ResMOE_s1_l15_tp0;
  ResMOE_s1_l15_tp1 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l15 -> ResMOE_s1_l15_tp1;
  ResAttn_s1_l15_tp1 -> ResMOE_s1_l15_tp1;
  ResMOE_s1_l15_tp2 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l15 -> ResMOE_s1_l15_tp2;
  ResAttn_s1_l15_tp2 -> ResMOE_s1_l15_tp2;
  ResMOE_s1_l15_tp3 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l15 -> ResMOE_s1_l15_tp3;
  ResAttn_s1_l15_tp3 -> ResMOE_s1_l15_tp3;
  ResMOE_s1_l15_tp4 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l15 -> ResMOE_s1_l15_tp4;
  ResAttn_s1_l15_tp4 -> ResMOE_s1_l15_tp4;
  ResMOE_s1_l15_tp5 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l15 -> ResMOE_s1_l15_tp5;
  ResAttn_s1_l15_tp5 -> ResMOE_s1_l15_tp5;
  ResMOE_s1_l15_tp6 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l15 -> ResMOE_s1_l15_tp6;
  ResAttn_s1_l15_tp6 -> ResMOE_s1_l15_tp6;
  ResMOE_s1_l15_tp7 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l15 -> ResMOE_s1_l15_tp7;
  ResAttn_s1_l15_tp7 -> ResMOE_s1_l15_tp7;
  QKV_s1_l16_tp0 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l15_tp0 -> QKV_s1_l16_tp0;
  QKV_s1_l16_tp1 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l15_tp0 -> QKV_s1_l16_tp1;
  QKV_s1_l16_tp2 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l15_tp0 -> QKV_s1_l16_tp2;
  QKV_s1_l16_tp3 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l15_tp0 -> QKV_s1_l16_tp3;
  QKV_s1_l16_tp4 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l15_tp0 -> QKV_s1_l16_tp4;
  QKV_s1_l16_tp5 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l15_tp0 -> QKV_s1_l16_tp5;
  QKV_s1_l16_tp6 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l15_tp0 -> QKV_s1_l16_tp6;
  QKV_s1_l16_tp7 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l15_tp0 -> QKV_s1_l16_tp7;
  SplitHeads_s1_l16_tp0 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l16_tp0 -> SplitHeads_s1_l16_tp0;
  SplitHeads_s1_l16_tp1 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l16_tp1 -> SplitHeads_s1_l16_tp1;
  SplitHeads_s1_l16_tp2 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l16_tp2 -> SplitHeads_s1_l16_tp2;
  SplitHeads_s1_l16_tp3 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l16_tp3 -> SplitHeads_s1_l16_tp3;
  SplitHeads_s1_l16_tp4 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l16_tp4 -> SplitHeads_s1_l16_tp4;
  SplitHeads_s1_l16_tp5 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l16_tp5 -> SplitHeads_s1_l16_tp5;
  SplitHeads_s1_l16_tp6 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l16_tp6 -> SplitHeads_s1_l16_tp6;
  SplitHeads_s1_l16_tp7 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_s1_l16_tp7 -> SplitHeads_s1_l16_tp7;
  A2A_s1_l16 [shape=ellipse, label="AllToAll\nstage1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_s1_l16_tp0 -> A2A_s1_l16;
  SplitHeads_s1_l16_tp1 -> A2A_s1_l16;
  SplitHeads_s1_l16_tp2 -> A2A_s1_l16;
  SplitHeads_s1_l16_tp3 -> A2A_s1_l16;
  SplitHeads_s1_l16_tp4 -> A2A_s1_l16;
  SplitHeads_s1_l16_tp5 -> A2A_s1_l16;
  SplitHeads_s1_l16_tp6 -> A2A_s1_l16;
  SplitHeads_s1_l16_tp7 -> A2A_s1_l16;
  Attn_s1_l16_tp0 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l16 -> Attn_s1_l16_tp0;
  Attn_s1_l16_tp1 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l16 -> Attn_s1_l16_tp1;
  Attn_s1_l16_tp2 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l16 -> Attn_s1_l16_tp2;
  Attn_s1_l16_tp3 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l16 -> Attn_s1_l16_tp3;
  Attn_s1_l16_tp4 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l16 -> Attn_s1_l16_tp4;
  Attn_s1_l16_tp5 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l16 -> Attn_s1_l16_tp5;
  Attn_s1_l16_tp6 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l16 -> Attn_s1_l16_tp6;
  Attn_s1_l16_tp7 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_s1_l16 -> Attn_s1_l16_tp7;
  AR_attn_s1_l16 [shape=ellipse, label="AllReduce\nstage1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_s1_l16_tp0 -> AR_attn_s1_l16;
  Attn_s1_l16_tp1 -> AR_attn_s1_l16;
  Attn_s1_l16_tp2 -> AR_attn_s1_l16;
  Attn_s1_l16_tp3 -> AR_attn_s1_l16;
  Attn_s1_l16_tp4 -> AR_attn_s1_l16;
  Attn_s1_l16_tp5 -> AR_attn_s1_l16;
  Attn_s1_l16_tp6 -> AR_attn_s1_l16;
  Attn_s1_l16_tp7 -> AR_attn_s1_l16;
  O_s1_l16_tp0 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l16 -> O_s1_l16_tp0;
  O_s1_l16_tp1 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l16 -> O_s1_l16_tp1;
  O_s1_l16_tp2 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l16 -> O_s1_l16_tp2;
  O_s1_l16_tp3 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l16 -> O_s1_l16_tp3;
  O_s1_l16_tp4 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l16 -> O_s1_l16_tp4;
  O_s1_l16_tp5 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l16 -> O_s1_l16_tp5;
  O_s1_l16_tp6 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l16 -> O_s1_l16_tp6;
  O_s1_l16_tp7 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_s1_l16 -> O_s1_l16_tp7;
  ResAttn_s1_l16_tp0 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l16_tp0 -> ResAttn_s1_l16_tp0;
  ResMOE_s1_l15_tp0 -> ResAttn_s1_l16_tp0;
  ResAttn_s1_l16_tp1 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l16_tp1 -> ResAttn_s1_l16_tp1;
  ResMOE_s1_l15_tp0 -> ResAttn_s1_l16_tp1;
  ResAttn_s1_l16_tp2 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l16_tp2 -> ResAttn_s1_l16_tp2;
  ResMOE_s1_l15_tp0 -> ResAttn_s1_l16_tp2;
  ResAttn_s1_l16_tp3 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l16_tp3 -> ResAttn_s1_l16_tp3;
  ResMOE_s1_l15_tp0 -> ResAttn_s1_l16_tp3;
  ResAttn_s1_l16_tp4 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l16_tp4 -> ResAttn_s1_l16_tp4;
  ResMOE_s1_l15_tp0 -> ResAttn_s1_l16_tp4;
  ResAttn_s1_l16_tp5 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l16_tp5 -> ResAttn_s1_l16_tp5;
  ResMOE_s1_l15_tp0 -> ResAttn_s1_l16_tp5;
  ResAttn_s1_l16_tp6 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l16_tp6 -> ResAttn_s1_l16_tp6;
  ResMOE_s1_l15_tp0 -> ResAttn_s1_l16_tp6;
  ResAttn_s1_l16_tp7 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_s1_l16_tp7 -> ResAttn_s1_l16_tp7;
  ResMOE_s1_l15_tp0 -> ResAttn_s1_l16_tp7;
  Gate_s1_l16_tp0 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l16_tp0 -> Gate_s1_l16_tp0;
  Gate_s1_l16_tp1 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l16_tp1 -> Gate_s1_l16_tp1;
  Gate_s1_l16_tp2 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l16_tp2 -> Gate_s1_l16_tp2;
  Gate_s1_l16_tp3 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l16_tp3 -> Gate_s1_l16_tp3;
  Gate_s1_l16_tp4 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l16_tp4 -> Gate_s1_l16_tp4;
  Gate_s1_l16_tp5 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l16_tp5 -> Gate_s1_l16_tp5;
  Gate_s1_l16_tp6 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l16_tp6 -> Gate_s1_l16_tp6;
  Gate_s1_l16_tp7 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_s1_l16_tp7 -> Gate_s1_l16_tp7;
  Expert32_s1_l16_tp0 [label="Expert32\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp0 -> Expert32_s1_l16_tp0 [style=dashed];
  Expert33_s1_l16_tp0 [label="Expert33\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp0 -> Expert33_s1_l16_tp0 [style=dashed];
  Expert34_s1_l16_tp0 [label="Expert34\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp0 -> Expert34_s1_l16_tp0 [style=dashed];
  Expert35_s1_l16_tp0 [label="Expert35\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp0 -> Expert35_s1_l16_tp0 [style=dashed];
  Expert36_s1_l16_tp1 [label="Expert36\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp1 -> Expert36_s1_l16_tp1 [style=dashed];
  Expert37_s1_l16_tp1 [label="Expert37\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp1 -> Expert37_s1_l16_tp1 [style=dashed];
  Expert38_s1_l16_tp1 [label="Expert38\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp1 -> Expert38_s1_l16_tp1 [style=dashed];
  Expert39_s1_l16_tp1 [label="Expert39\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp1 -> Expert39_s1_l16_tp1 [style=dashed];
  Expert40_s1_l16_tp2 [label="Expert40\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp2 -> Expert40_s1_l16_tp2 [style=dashed];
  Expert41_s1_l16_tp2 [label="Expert41\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp2 -> Expert41_s1_l16_tp2 [style=dashed];
  Expert42_s1_l16_tp2 [label="Expert42\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp2 -> Expert42_s1_l16_tp2 [style=dashed];
  Expert43_s1_l16_tp2 [label="Expert43\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp2 -> Expert43_s1_l16_tp2 [style=dashed];
  Expert44_s1_l16_tp3 [label="Expert44\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp3 -> Expert44_s1_l16_tp3 [style=dashed];
  Expert45_s1_l16_tp3 [label="Expert45\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp3 -> Expert45_s1_l16_tp3 [style=dashed];
  Expert46_s1_l16_tp3 [label="Expert46\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp3 -> Expert46_s1_l16_tp3 [style=dashed];
  Expert47_s1_l16_tp3 [label="Expert47\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp3 -> Expert47_s1_l16_tp3 [style=dashed];
  Expert48_s1_l16_tp4 [label="Expert48\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp4 -> Expert48_s1_l16_tp4 [style=dashed];
  Expert49_s1_l16_tp4 [label="Expert49\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp4 -> Expert49_s1_l16_tp4 [style=dashed];
  Expert50_s1_l16_tp4 [label="Expert50\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp4 -> Expert50_s1_l16_tp4 [style=dashed];
  Expert51_s1_l16_tp4 [label="Expert51\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp4 -> Expert51_s1_l16_tp4 [style=dashed];
  Expert52_s1_l16_tp5 [label="Expert52\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp5 -> Expert52_s1_l16_tp5 [style=dashed];
  Expert53_s1_l16_tp5 [label="Expert53\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp5 -> Expert53_s1_l16_tp5 [style=dashed];
  Expert54_s1_l16_tp5 [label="Expert54\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp5 -> Expert54_s1_l16_tp5 [style=dashed];
  Expert55_s1_l16_tp5 [label="Expert55\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp5 -> Expert55_s1_l16_tp5 [style=dashed];
  Expert56_s1_l16_tp6 [label="Expert56\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp6 -> Expert56_s1_l16_tp6 [style=dashed];
  Expert57_s1_l16_tp6 [label="Expert57\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp6 -> Expert57_s1_l16_tp6 [style=dashed];
  Expert58_s1_l16_tp6 [label="Expert58\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp6 -> Expert58_s1_l16_tp6 [style=dashed];
  Expert59_s1_l16_tp6 [label="Expert59\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp6 -> Expert59_s1_l16_tp6 [style=dashed];
  Expert60_s1_l16_tp7 [label="Expert60\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp7 -> Expert60_s1_l16_tp7 [style=dashed];
  Expert61_s1_l16_tp7 [label="Expert61\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp7 -> Expert61_s1_l16_tp7 [style=dashed];
  Expert62_s1_l16_tp7 [label="Expert62\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp7 -> Expert62_s1_l16_tp7 [style=dashed];
  Expert63_s1_l16_tp7 [label="Expert63\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_s1_l16_tp7 -> Expert63_s1_l16_tp7 [style=dashed];
  AR_exp_s1_l16 [shape=ellipse, label="AllReduceExperts\nstage1\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert32_s1_l16_tp0 -> AR_exp_s1_l16;
  Expert33_s1_l16_tp0 -> AR_exp_s1_l16;
  Expert34_s1_l16_tp0 -> AR_exp_s1_l16;
  Expert35_s1_l16_tp0 -> AR_exp_s1_l16;
  Expert36_s1_l16_tp1 -> AR_exp_s1_l16;
  Expert37_s1_l16_tp1 -> AR_exp_s1_l16;
  Expert38_s1_l16_tp1 -> AR_exp_s1_l16;
  Expert39_s1_l16_tp1 -> AR_exp_s1_l16;
  Expert40_s1_l16_tp2 -> AR_exp_s1_l16;
  Expert41_s1_l16_tp2 -> AR_exp_s1_l16;
  Expert42_s1_l16_tp2 -> AR_exp_s1_l16;
  Expert43_s1_l16_tp2 -> AR_exp_s1_l16;
  Expert44_s1_l16_tp3 -> AR_exp_s1_l16;
  Expert45_s1_l16_tp3 -> AR_exp_s1_l16;
  Expert46_s1_l16_tp3 -> AR_exp_s1_l16;
  Expert47_s1_l16_tp3 -> AR_exp_s1_l16;
  Expert48_s1_l16_tp4 -> AR_exp_s1_l16;
  Expert49_s1_l16_tp4 -> AR_exp_s1_l16;
  Expert50_s1_l16_tp4 -> AR_exp_s1_l16;
  Expert51_s1_l16_tp4 -> AR_exp_s1_l16;
  Expert52_s1_l16_tp5 -> AR_exp_s1_l16;
  Expert53_s1_l16_tp5 -> AR_exp_s1_l16;
  Expert54_s1_l16_tp5 -> AR_exp_s1_l16;
  Expert55_s1_l16_tp5 -> AR_exp_s1_l16;
  Expert56_s1_l16_tp6 -> AR_exp_s1_l16;
  Expert57_s1_l16_tp6 -> AR_exp_s1_l16;
  Expert58_s1_l16_tp6 -> AR_exp_s1_l16;
  Expert59_s1_l16_tp6 -> AR_exp_s1_l16;
  Expert60_s1_l16_tp7 -> AR_exp_s1_l16;
  Expert61_s1_l16_tp7 -> AR_exp_s1_l16;
  Expert62_s1_l16_tp7 -> AR_exp_s1_l16;
  Expert63_s1_l16_tp7 -> AR_exp_s1_l16;
  ResMOE_s1_l16_tp0 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l16 -> ResMOE_s1_l16_tp0;
  ResAttn_s1_l16_tp0 -> ResMOE_s1_l16_tp0;
  ResMOE_s1_l16_tp1 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l16 -> ResMOE_s1_l16_tp1;
  ResAttn_s1_l16_tp1 -> ResMOE_s1_l16_tp1;
  ResMOE_s1_l16_tp2 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l16 -> ResMOE_s1_l16_tp2;
  ResAttn_s1_l16_tp2 -> ResMOE_s1_l16_tp2;
  ResMOE_s1_l16_tp3 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l16 -> ResMOE_s1_l16_tp3;
  ResAttn_s1_l16_tp3 -> ResMOE_s1_l16_tp3;
  ResMOE_s1_l16_tp4 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l16 -> ResMOE_s1_l16_tp4;
  ResAttn_s1_l16_tp4 -> ResMOE_s1_l16_tp4;
  ResMOE_s1_l16_tp5 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l16 -> ResMOE_s1_l16_tp5;
  ResAttn_s1_l16_tp5 -> ResMOE_s1_l16_tp5;
  ResMOE_s1_l16_tp6 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l16 -> ResMOE_s1_l16_tp6;
  ResAttn_s1_l16_tp6 -> ResMOE_s1_l16_tp6;
  ResMOE_s1_l16_tp7 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_s1_l16 -> ResMOE_s1_l16_tp7;
  ResAttn_s1_l16_tp7 -> ResMOE_s1_l16_tp7;
  Output [shape=ellipse, label="Output\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_s1_l16_tp0 -> Output;
}