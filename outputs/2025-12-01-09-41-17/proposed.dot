digraph Proposed {
  rank_policy=TB;
  node [shape=rectangle];

  Input [shape=ellipse, label="Input\n[batch_size=128,seq_len=128,hidden=1024]"];
  QKV_l1_gpu0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_l1_gpu0;
  QKV_l1_gpu1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_l1_gpu1;
  QKV_l1_gpu2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_l1_gpu2;
  QKV_l1_gpu3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_l1_gpu3;
  QKV_l1_gpu4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_l1_gpu4;
  QKV_l1_gpu5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_l1_gpu5;
  QKV_l1_gpu6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_l1_gpu6;
  QKV_l1_gpu7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_l1_gpu7;
  QKV_l1_gpu8 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_l1_gpu8;
  QKV_l1_gpu9 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_l1_gpu9;
  QKV_l1_gpu10 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_l1_gpu10;
  QKV_l1_gpu11 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_l1_gpu11;
  QKV_l1_gpu12 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_l1_gpu12;
  QKV_l1_gpu13 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_l1_gpu13;
  QKV_l1_gpu14 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_l1_gpu14;
  QKV_l1_gpu15 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  Input -> QKV_l1_gpu15;
  SplitHeads_l1_gpu0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l1_gpu0 -> SplitHeads_l1_gpu0;
  SplitHeads_l1_gpu1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l1_gpu1 -> SplitHeads_l1_gpu1;
  SplitHeads_l1_gpu2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l1_gpu2 -> SplitHeads_l1_gpu2;
  SplitHeads_l1_gpu3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l1_gpu3 -> SplitHeads_l1_gpu3;
  SplitHeads_l1_gpu4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l1_gpu4 -> SplitHeads_l1_gpu4;
  SplitHeads_l1_gpu5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l1_gpu5 -> SplitHeads_l1_gpu5;
  SplitHeads_l1_gpu6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l1_gpu6 -> SplitHeads_l1_gpu6;
  SplitHeads_l1_gpu7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l1_gpu7 -> SplitHeads_l1_gpu7;
  SplitHeads_l1_gpu8 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l1_gpu8 -> SplitHeads_l1_gpu8;
  SplitHeads_l1_gpu9 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l1_gpu9 -> SplitHeads_l1_gpu9;
  SplitHeads_l1_gpu10 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l1_gpu10 -> SplitHeads_l1_gpu10;
  SplitHeads_l1_gpu11 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l1_gpu11 -> SplitHeads_l1_gpu11;
  SplitHeads_l1_gpu12 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l1_gpu12 -> SplitHeads_l1_gpu12;
  SplitHeads_l1_gpu13 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l1_gpu13 -> SplitHeads_l1_gpu13;
  SplitHeads_l1_gpu14 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l1_gpu14 -> SplitHeads_l1_gpu14;
  SplitHeads_l1_gpu15 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l1_gpu15 -> SplitHeads_l1_gpu15;
  A2A_l1 [shape=ellipse, label="AllToAll\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_l1_gpu0 -> A2A_l1;
  SplitHeads_l1_gpu1 -> A2A_l1;
  SplitHeads_l1_gpu2 -> A2A_l1;
  SplitHeads_l1_gpu3 -> A2A_l1;
  SplitHeads_l1_gpu4 -> A2A_l1;
  SplitHeads_l1_gpu5 -> A2A_l1;
  SplitHeads_l1_gpu6 -> A2A_l1;
  SplitHeads_l1_gpu7 -> A2A_l1;
  SplitHeads_l1_gpu8 -> A2A_l1;
  SplitHeads_l1_gpu9 -> A2A_l1;
  SplitHeads_l1_gpu10 -> A2A_l1;
  SplitHeads_l1_gpu11 -> A2A_l1;
  SplitHeads_l1_gpu12 -> A2A_l1;
  SplitHeads_l1_gpu13 -> A2A_l1;
  SplitHeads_l1_gpu14 -> A2A_l1;
  SplitHeads_l1_gpu15 -> A2A_l1;
  Attn_l1_gpu0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l1 -> Attn_l1_gpu0;
  Attn_l1_gpu1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l1 -> Attn_l1_gpu1;
  Attn_l1_gpu2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l1 -> Attn_l1_gpu2;
  Attn_l1_gpu3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l1 -> Attn_l1_gpu3;
  Attn_l1_gpu4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l1 -> Attn_l1_gpu4;
  Attn_l1_gpu5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l1 -> Attn_l1_gpu5;
  Attn_l1_gpu6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l1 -> Attn_l1_gpu6;
  Attn_l1_gpu7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l1 -> Attn_l1_gpu7;
  Attn_l1_gpu8 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l1 -> Attn_l1_gpu8;
  Attn_l1_gpu9 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l1 -> Attn_l1_gpu9;
  Attn_l1_gpu10 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l1 -> Attn_l1_gpu10;
  Attn_l1_gpu11 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l1 -> Attn_l1_gpu11;
  Attn_l1_gpu12 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l1 -> Attn_l1_gpu12;
  Attn_l1_gpu13 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l1 -> Attn_l1_gpu13;
  Attn_l1_gpu14 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l1 -> Attn_l1_gpu14;
  Attn_l1_gpu15 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l1 -> Attn_l1_gpu15;
  AR_attn_l1 [shape=ellipse, label="AllReduce\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_l1_gpu0 -> AR_attn_l1;
  Attn_l1_gpu1 -> AR_attn_l1;
  Attn_l1_gpu2 -> AR_attn_l1;
  Attn_l1_gpu3 -> AR_attn_l1;
  Attn_l1_gpu4 -> AR_attn_l1;
  Attn_l1_gpu5 -> AR_attn_l1;
  Attn_l1_gpu6 -> AR_attn_l1;
  Attn_l1_gpu7 -> AR_attn_l1;
  Attn_l1_gpu8 -> AR_attn_l1;
  Attn_l1_gpu9 -> AR_attn_l1;
  Attn_l1_gpu10 -> AR_attn_l1;
  Attn_l1_gpu11 -> AR_attn_l1;
  Attn_l1_gpu12 -> AR_attn_l1;
  Attn_l1_gpu13 -> AR_attn_l1;
  Attn_l1_gpu14 -> AR_attn_l1;
  Attn_l1_gpu15 -> AR_attn_l1;
  O_l1_gpu0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l1 -> O_l1_gpu0;
  O_l1_gpu1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l1 -> O_l1_gpu1;
  O_l1_gpu2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l1 -> O_l1_gpu2;
  O_l1_gpu3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l1 -> O_l1_gpu3;
  O_l1_gpu4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l1 -> O_l1_gpu4;
  O_l1_gpu5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l1 -> O_l1_gpu5;
  O_l1_gpu6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l1 -> O_l1_gpu6;
  O_l1_gpu7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l1 -> O_l1_gpu7;
  O_l1_gpu8 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l1 -> O_l1_gpu8;
  O_l1_gpu9 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l1 -> O_l1_gpu9;
  O_l1_gpu10 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l1 -> O_l1_gpu10;
  O_l1_gpu11 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l1 -> O_l1_gpu11;
  O_l1_gpu12 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l1 -> O_l1_gpu12;
  O_l1_gpu13 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l1 -> O_l1_gpu13;
  O_l1_gpu14 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l1 -> O_l1_gpu14;
  O_l1_gpu15 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l1 -> O_l1_gpu15;
  ResAttn_l1_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l1_gpu0 -> ResAttn_l1_gpu0;
  Input -> ResAttn_l1_gpu0;
  ResAttn_l1_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l1_gpu1 -> ResAttn_l1_gpu1;
  Input -> ResAttn_l1_gpu1;
  ResAttn_l1_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l1_gpu2 -> ResAttn_l1_gpu2;
  Input -> ResAttn_l1_gpu2;
  ResAttn_l1_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l1_gpu3 -> ResAttn_l1_gpu3;
  Input -> ResAttn_l1_gpu3;
  ResAttn_l1_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l1_gpu4 -> ResAttn_l1_gpu4;
  Input -> ResAttn_l1_gpu4;
  ResAttn_l1_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l1_gpu5 -> ResAttn_l1_gpu5;
  Input -> ResAttn_l1_gpu5;
  ResAttn_l1_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l1_gpu6 -> ResAttn_l1_gpu6;
  Input -> ResAttn_l1_gpu6;
  ResAttn_l1_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l1_gpu7 -> ResAttn_l1_gpu7;
  Input -> ResAttn_l1_gpu7;
  ResAttn_l1_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l1_gpu8 -> ResAttn_l1_gpu8;
  Input -> ResAttn_l1_gpu8;
  ResAttn_l1_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l1_gpu9 -> ResAttn_l1_gpu9;
  Input -> ResAttn_l1_gpu9;
  ResAttn_l1_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l1_gpu10 -> ResAttn_l1_gpu10;
  Input -> ResAttn_l1_gpu10;
  ResAttn_l1_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l1_gpu11 -> ResAttn_l1_gpu11;
  Input -> ResAttn_l1_gpu11;
  ResAttn_l1_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l1_gpu12 -> ResAttn_l1_gpu12;
  Input -> ResAttn_l1_gpu12;
  ResAttn_l1_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l1_gpu13 -> ResAttn_l1_gpu13;
  Input -> ResAttn_l1_gpu13;
  ResAttn_l1_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l1_gpu14 -> ResAttn_l1_gpu14;
  Input -> ResAttn_l1_gpu14;
  ResAttn_l1_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l1_gpu15 -> ResAttn_l1_gpu15;
  Input -> ResAttn_l1_gpu15;
  Gate_l1_gpu0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l1_gpu0 -> Gate_l1_gpu0;
  Gate_l1_gpu1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l1_gpu1 -> Gate_l1_gpu1;
  Gate_l1_gpu2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l1_gpu2 -> Gate_l1_gpu2;
  Gate_l1_gpu3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l1_gpu3 -> Gate_l1_gpu3;
  Gate_l1_gpu4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l1_gpu4 -> Gate_l1_gpu4;
  Gate_l1_gpu5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l1_gpu5 -> Gate_l1_gpu5;
  Gate_l1_gpu6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l1_gpu6 -> Gate_l1_gpu6;
  Gate_l1_gpu7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l1_gpu7 -> Gate_l1_gpu7;
  Gate_l1_gpu8 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l1_gpu8 -> Gate_l1_gpu8;
  Gate_l1_gpu9 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l1_gpu9 -> Gate_l1_gpu9;
  Gate_l1_gpu10 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l1_gpu10 -> Gate_l1_gpu10;
  Gate_l1_gpu11 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l1_gpu11 -> Gate_l1_gpu11;
  Gate_l1_gpu12 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l1_gpu12 -> Gate_l1_gpu12;
  Gate_l1_gpu13 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l1_gpu13 -> Gate_l1_gpu13;
  Gate_l1_gpu14 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l1_gpu14 -> Gate_l1_gpu14;
  Gate_l1_gpu15 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l1_gpu15 -> Gate_l1_gpu15;
  Expert_l1_gpu0 [label="Expert_l1\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l1_gpu0 -> Expert_l1_gpu0 [style=dashed];
  Expert_l1_gpu1 [label="Expert_l1\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l1_gpu1 -> Expert_l1_gpu1 [style=dashed];
  Expert_l1_gpu2 [label="Expert_l1\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l1_gpu2 -> Expert_l1_gpu2 [style=dashed];
  Expert_l1_gpu3 [label="Expert_l1\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l1_gpu3 -> Expert_l1_gpu3 [style=dashed];
  Expert_l1_gpu4 [label="Expert_l1\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l1_gpu4 -> Expert_l1_gpu4 [style=dashed];
  Expert_l1_gpu5 [label="Expert_l1\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l1_gpu5 -> Expert_l1_gpu5 [style=dashed];
  Expert_l1_gpu6 [label="Expert_l1\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l1_gpu6 -> Expert_l1_gpu6 [style=dashed];
  Expert_l1_gpu7 [label="Expert_l1\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l1_gpu7 -> Expert_l1_gpu7 [style=dashed];
  Expert_l1_gpu8 [label="Expert_l1\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l1_gpu8 -> Expert_l1_gpu8 [style=dashed];
  Expert_l1_gpu9 [label="Expert_l1\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l1_gpu9 -> Expert_l1_gpu9 [style=dashed];
  Expert_l1_gpu10 [label="Expert_l1\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l1_gpu10 -> Expert_l1_gpu10 [style=dashed];
  Expert_l1_gpu11 [label="Expert_l1\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l1_gpu11 -> Expert_l1_gpu11 [style=dashed];
  Expert_l1_gpu12 [label="Expert_l1\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l1_gpu12 -> Expert_l1_gpu12 [style=dashed];
  Expert_l1_gpu13 [label="Expert_l1\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l1_gpu13 -> Expert_l1_gpu13 [style=dashed];
  Expert_l1_gpu14 [label="Expert_l1\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l1_gpu14 -> Expert_l1_gpu14 [style=dashed];
  Expert_l1_gpu15 [label="Expert_l1\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l1_gpu15 -> Expert_l1_gpu15 [style=dashed];
  AR_exp_l1 [shape=ellipse, label="AllReduceExperts\nall16GPUs\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert_l1_gpu0 -> AR_exp_l1;
  Expert_l1_gpu1 -> AR_exp_l1;
  Expert_l1_gpu2 -> AR_exp_l1;
  Expert_l1_gpu3 -> AR_exp_l1;
  Expert_l1_gpu4 -> AR_exp_l1;
  Expert_l1_gpu5 -> AR_exp_l1;
  Expert_l1_gpu6 -> AR_exp_l1;
  Expert_l1_gpu7 -> AR_exp_l1;
  Expert_l1_gpu8 -> AR_exp_l1;
  Expert_l1_gpu9 -> AR_exp_l1;
  Expert_l1_gpu10 -> AR_exp_l1;
  Expert_l1_gpu11 -> AR_exp_l1;
  Expert_l1_gpu12 -> AR_exp_l1;
  Expert_l1_gpu13 -> AR_exp_l1;
  Expert_l1_gpu14 -> AR_exp_l1;
  Expert_l1_gpu15 -> AR_exp_l1;
  ResMOE_l1_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l1 -> ResMOE_l1_gpu0;
  ResAttn_l1_gpu0 -> ResMOE_l1_gpu0;
  ResMOE_l1_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l1 -> ResMOE_l1_gpu1;
  ResAttn_l1_gpu1 -> ResMOE_l1_gpu1;
  ResMOE_l1_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l1 -> ResMOE_l1_gpu2;
  ResAttn_l1_gpu2 -> ResMOE_l1_gpu2;
  ResMOE_l1_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l1 -> ResMOE_l1_gpu3;
  ResAttn_l1_gpu3 -> ResMOE_l1_gpu3;
  ResMOE_l1_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l1 -> ResMOE_l1_gpu4;
  ResAttn_l1_gpu4 -> ResMOE_l1_gpu4;
  ResMOE_l1_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l1 -> ResMOE_l1_gpu5;
  ResAttn_l1_gpu5 -> ResMOE_l1_gpu5;
  ResMOE_l1_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l1 -> ResMOE_l1_gpu6;
  ResAttn_l1_gpu6 -> ResMOE_l1_gpu6;
  ResMOE_l1_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l1 -> ResMOE_l1_gpu7;
  ResAttn_l1_gpu7 -> ResMOE_l1_gpu7;
  ResMOE_l1_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l1 -> ResMOE_l1_gpu8;
  ResAttn_l1_gpu8 -> ResMOE_l1_gpu8;
  ResMOE_l1_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l1 -> ResMOE_l1_gpu9;
  ResAttn_l1_gpu9 -> ResMOE_l1_gpu9;
  ResMOE_l1_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l1 -> ResMOE_l1_gpu10;
  ResAttn_l1_gpu10 -> ResMOE_l1_gpu10;
  ResMOE_l1_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l1 -> ResMOE_l1_gpu11;
  ResAttn_l1_gpu11 -> ResMOE_l1_gpu11;
  ResMOE_l1_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l1 -> ResMOE_l1_gpu12;
  ResAttn_l1_gpu12 -> ResMOE_l1_gpu12;
  ResMOE_l1_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l1 -> ResMOE_l1_gpu13;
  ResAttn_l1_gpu13 -> ResMOE_l1_gpu13;
  ResMOE_l1_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l1 -> ResMOE_l1_gpu14;
  ResAttn_l1_gpu14 -> ResMOE_l1_gpu14;
  ResMOE_l1_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l1 -> ResMOE_l1_gpu15;
  ResAttn_l1_gpu15 -> ResMOE_l1_gpu15;
  QKV_l2_gpu0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l1_gpu0 -> QKV_l2_gpu0;
  QKV_l2_gpu1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l1_gpu0 -> QKV_l2_gpu1;
  QKV_l2_gpu2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l1_gpu0 -> QKV_l2_gpu2;
  QKV_l2_gpu3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l1_gpu0 -> QKV_l2_gpu3;
  QKV_l2_gpu4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l1_gpu0 -> QKV_l2_gpu4;
  QKV_l2_gpu5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l1_gpu0 -> QKV_l2_gpu5;
  QKV_l2_gpu6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l1_gpu0 -> QKV_l2_gpu6;
  QKV_l2_gpu7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l1_gpu0 -> QKV_l2_gpu7;
  QKV_l2_gpu8 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l1_gpu0 -> QKV_l2_gpu8;
  QKV_l2_gpu9 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l1_gpu0 -> QKV_l2_gpu9;
  QKV_l2_gpu10 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l1_gpu0 -> QKV_l2_gpu10;
  QKV_l2_gpu11 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l1_gpu0 -> QKV_l2_gpu11;
  QKV_l2_gpu12 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l1_gpu0 -> QKV_l2_gpu12;
  QKV_l2_gpu13 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l1_gpu0 -> QKV_l2_gpu13;
  QKV_l2_gpu14 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l1_gpu0 -> QKV_l2_gpu14;
  QKV_l2_gpu15 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l1_gpu0 -> QKV_l2_gpu15;
  SplitHeads_l2_gpu0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l2_gpu0 -> SplitHeads_l2_gpu0;
  SplitHeads_l2_gpu1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l2_gpu1 -> SplitHeads_l2_gpu1;
  SplitHeads_l2_gpu2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l2_gpu2 -> SplitHeads_l2_gpu2;
  SplitHeads_l2_gpu3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l2_gpu3 -> SplitHeads_l2_gpu3;
  SplitHeads_l2_gpu4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l2_gpu4 -> SplitHeads_l2_gpu4;
  SplitHeads_l2_gpu5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l2_gpu5 -> SplitHeads_l2_gpu5;
  SplitHeads_l2_gpu6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l2_gpu6 -> SplitHeads_l2_gpu6;
  SplitHeads_l2_gpu7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l2_gpu7 -> SplitHeads_l2_gpu7;
  SplitHeads_l2_gpu8 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l2_gpu8 -> SplitHeads_l2_gpu8;
  SplitHeads_l2_gpu9 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l2_gpu9 -> SplitHeads_l2_gpu9;
  SplitHeads_l2_gpu10 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l2_gpu10 -> SplitHeads_l2_gpu10;
  SplitHeads_l2_gpu11 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l2_gpu11 -> SplitHeads_l2_gpu11;
  SplitHeads_l2_gpu12 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l2_gpu12 -> SplitHeads_l2_gpu12;
  SplitHeads_l2_gpu13 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l2_gpu13 -> SplitHeads_l2_gpu13;
  SplitHeads_l2_gpu14 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l2_gpu14 -> SplitHeads_l2_gpu14;
  SplitHeads_l2_gpu15 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l2_gpu15 -> SplitHeads_l2_gpu15;
  A2A_l2 [shape=ellipse, label="AllToAll\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_l2_gpu0 -> A2A_l2;
  SplitHeads_l2_gpu1 -> A2A_l2;
  SplitHeads_l2_gpu2 -> A2A_l2;
  SplitHeads_l2_gpu3 -> A2A_l2;
  SplitHeads_l2_gpu4 -> A2A_l2;
  SplitHeads_l2_gpu5 -> A2A_l2;
  SplitHeads_l2_gpu6 -> A2A_l2;
  SplitHeads_l2_gpu7 -> A2A_l2;
  SplitHeads_l2_gpu8 -> A2A_l2;
  SplitHeads_l2_gpu9 -> A2A_l2;
  SplitHeads_l2_gpu10 -> A2A_l2;
  SplitHeads_l2_gpu11 -> A2A_l2;
  SplitHeads_l2_gpu12 -> A2A_l2;
  SplitHeads_l2_gpu13 -> A2A_l2;
  SplitHeads_l2_gpu14 -> A2A_l2;
  SplitHeads_l2_gpu15 -> A2A_l2;
  Attn_l2_gpu0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l2 -> Attn_l2_gpu0;
  Attn_l2_gpu1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l2 -> Attn_l2_gpu1;
  Attn_l2_gpu2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l2 -> Attn_l2_gpu2;
  Attn_l2_gpu3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l2 -> Attn_l2_gpu3;
  Attn_l2_gpu4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l2 -> Attn_l2_gpu4;
  Attn_l2_gpu5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l2 -> Attn_l2_gpu5;
  Attn_l2_gpu6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l2 -> Attn_l2_gpu6;
  Attn_l2_gpu7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l2 -> Attn_l2_gpu7;
  Attn_l2_gpu8 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l2 -> Attn_l2_gpu8;
  Attn_l2_gpu9 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l2 -> Attn_l2_gpu9;
  Attn_l2_gpu10 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l2 -> Attn_l2_gpu10;
  Attn_l2_gpu11 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l2 -> Attn_l2_gpu11;
  Attn_l2_gpu12 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l2 -> Attn_l2_gpu12;
  Attn_l2_gpu13 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l2 -> Attn_l2_gpu13;
  Attn_l2_gpu14 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l2 -> Attn_l2_gpu14;
  Attn_l2_gpu15 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l2 -> Attn_l2_gpu15;
  AR_attn_l2 [shape=ellipse, label="AllReduce\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_l2_gpu0 -> AR_attn_l2;
  Attn_l2_gpu1 -> AR_attn_l2;
  Attn_l2_gpu2 -> AR_attn_l2;
  Attn_l2_gpu3 -> AR_attn_l2;
  Attn_l2_gpu4 -> AR_attn_l2;
  Attn_l2_gpu5 -> AR_attn_l2;
  Attn_l2_gpu6 -> AR_attn_l2;
  Attn_l2_gpu7 -> AR_attn_l2;
  Attn_l2_gpu8 -> AR_attn_l2;
  Attn_l2_gpu9 -> AR_attn_l2;
  Attn_l2_gpu10 -> AR_attn_l2;
  Attn_l2_gpu11 -> AR_attn_l2;
  Attn_l2_gpu12 -> AR_attn_l2;
  Attn_l2_gpu13 -> AR_attn_l2;
  Attn_l2_gpu14 -> AR_attn_l2;
  Attn_l2_gpu15 -> AR_attn_l2;
  O_l2_gpu0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l2 -> O_l2_gpu0;
  O_l2_gpu1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l2 -> O_l2_gpu1;
  O_l2_gpu2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l2 -> O_l2_gpu2;
  O_l2_gpu3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l2 -> O_l2_gpu3;
  O_l2_gpu4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l2 -> O_l2_gpu4;
  O_l2_gpu5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l2 -> O_l2_gpu5;
  O_l2_gpu6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l2 -> O_l2_gpu6;
  O_l2_gpu7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l2 -> O_l2_gpu7;
  O_l2_gpu8 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l2 -> O_l2_gpu8;
  O_l2_gpu9 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l2 -> O_l2_gpu9;
  O_l2_gpu10 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l2 -> O_l2_gpu10;
  O_l2_gpu11 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l2 -> O_l2_gpu11;
  O_l2_gpu12 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l2 -> O_l2_gpu12;
  O_l2_gpu13 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l2 -> O_l2_gpu13;
  O_l2_gpu14 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l2 -> O_l2_gpu14;
  O_l2_gpu15 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l2 -> O_l2_gpu15;
  ResAttn_l2_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l2_gpu0 -> ResAttn_l2_gpu0;
  ResMOE_l1_gpu0 -> ResAttn_l2_gpu0;
  ResAttn_l2_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l2_gpu1 -> ResAttn_l2_gpu1;
  ResMOE_l1_gpu0 -> ResAttn_l2_gpu1;
  ResAttn_l2_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l2_gpu2 -> ResAttn_l2_gpu2;
  ResMOE_l1_gpu0 -> ResAttn_l2_gpu2;
  ResAttn_l2_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l2_gpu3 -> ResAttn_l2_gpu3;
  ResMOE_l1_gpu0 -> ResAttn_l2_gpu3;
  ResAttn_l2_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l2_gpu4 -> ResAttn_l2_gpu4;
  ResMOE_l1_gpu0 -> ResAttn_l2_gpu4;
  ResAttn_l2_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l2_gpu5 -> ResAttn_l2_gpu5;
  ResMOE_l1_gpu0 -> ResAttn_l2_gpu5;
  ResAttn_l2_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l2_gpu6 -> ResAttn_l2_gpu6;
  ResMOE_l1_gpu0 -> ResAttn_l2_gpu6;
  ResAttn_l2_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l2_gpu7 -> ResAttn_l2_gpu7;
  ResMOE_l1_gpu0 -> ResAttn_l2_gpu7;
  ResAttn_l2_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l2_gpu8 -> ResAttn_l2_gpu8;
  ResMOE_l1_gpu0 -> ResAttn_l2_gpu8;
  ResAttn_l2_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l2_gpu9 -> ResAttn_l2_gpu9;
  ResMOE_l1_gpu0 -> ResAttn_l2_gpu9;
  ResAttn_l2_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l2_gpu10 -> ResAttn_l2_gpu10;
  ResMOE_l1_gpu0 -> ResAttn_l2_gpu10;
  ResAttn_l2_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l2_gpu11 -> ResAttn_l2_gpu11;
  ResMOE_l1_gpu0 -> ResAttn_l2_gpu11;
  ResAttn_l2_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l2_gpu12 -> ResAttn_l2_gpu12;
  ResMOE_l1_gpu0 -> ResAttn_l2_gpu12;
  ResAttn_l2_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l2_gpu13 -> ResAttn_l2_gpu13;
  ResMOE_l1_gpu0 -> ResAttn_l2_gpu13;
  ResAttn_l2_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l2_gpu14 -> ResAttn_l2_gpu14;
  ResMOE_l1_gpu0 -> ResAttn_l2_gpu14;
  ResAttn_l2_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l2_gpu15 -> ResAttn_l2_gpu15;
  ResMOE_l1_gpu0 -> ResAttn_l2_gpu15;
  Gate_l2_gpu0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l2_gpu0 -> Gate_l2_gpu0;
  Gate_l2_gpu1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l2_gpu1 -> Gate_l2_gpu1;
  Gate_l2_gpu2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l2_gpu2 -> Gate_l2_gpu2;
  Gate_l2_gpu3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l2_gpu3 -> Gate_l2_gpu3;
  Gate_l2_gpu4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l2_gpu4 -> Gate_l2_gpu4;
  Gate_l2_gpu5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l2_gpu5 -> Gate_l2_gpu5;
  Gate_l2_gpu6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l2_gpu6 -> Gate_l2_gpu6;
  Gate_l2_gpu7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l2_gpu7 -> Gate_l2_gpu7;
  Gate_l2_gpu8 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l2_gpu8 -> Gate_l2_gpu8;
  Gate_l2_gpu9 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l2_gpu9 -> Gate_l2_gpu9;
  Gate_l2_gpu10 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l2_gpu10 -> Gate_l2_gpu10;
  Gate_l2_gpu11 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l2_gpu11 -> Gate_l2_gpu11;
  Gate_l2_gpu12 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l2_gpu12 -> Gate_l2_gpu12;
  Gate_l2_gpu13 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l2_gpu13 -> Gate_l2_gpu13;
  Gate_l2_gpu14 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l2_gpu14 -> Gate_l2_gpu14;
  Gate_l2_gpu15 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l2_gpu15 -> Gate_l2_gpu15;
  Expert_l2_gpu0 [label="Expert_l2\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l2_gpu0 -> Expert_l2_gpu0 [style=dashed];
  Expert_l2_gpu1 [label="Expert_l2\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l2_gpu1 -> Expert_l2_gpu1 [style=dashed];
  Expert_l2_gpu2 [label="Expert_l2\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l2_gpu2 -> Expert_l2_gpu2 [style=dashed];
  Expert_l2_gpu3 [label="Expert_l2\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l2_gpu3 -> Expert_l2_gpu3 [style=dashed];
  Expert_l2_gpu4 [label="Expert_l2\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l2_gpu4 -> Expert_l2_gpu4 [style=dashed];
  Expert_l2_gpu5 [label="Expert_l2\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l2_gpu5 -> Expert_l2_gpu5 [style=dashed];
  Expert_l2_gpu6 [label="Expert_l2\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l2_gpu6 -> Expert_l2_gpu6 [style=dashed];
  Expert_l2_gpu7 [label="Expert_l2\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l2_gpu7 -> Expert_l2_gpu7 [style=dashed];
  Expert_l2_gpu8 [label="Expert_l2\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l2_gpu8 -> Expert_l2_gpu8 [style=dashed];
  Expert_l2_gpu9 [label="Expert_l2\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l2_gpu9 -> Expert_l2_gpu9 [style=dashed];
  Expert_l2_gpu10 [label="Expert_l2\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l2_gpu10 -> Expert_l2_gpu10 [style=dashed];
  Expert_l2_gpu11 [label="Expert_l2\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l2_gpu11 -> Expert_l2_gpu11 [style=dashed];
  Expert_l2_gpu12 [label="Expert_l2\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l2_gpu12 -> Expert_l2_gpu12 [style=dashed];
  Expert_l2_gpu13 [label="Expert_l2\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l2_gpu13 -> Expert_l2_gpu13 [style=dashed];
  Expert_l2_gpu14 [label="Expert_l2\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l2_gpu14 -> Expert_l2_gpu14 [style=dashed];
  Expert_l2_gpu15 [label="Expert_l2\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l2_gpu15 -> Expert_l2_gpu15 [style=dashed];
  AR_exp_l2 [shape=ellipse, label="AllReduceExperts\nall16GPUs\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert_l2_gpu0 -> AR_exp_l2;
  Expert_l2_gpu1 -> AR_exp_l2;
  Expert_l2_gpu2 -> AR_exp_l2;
  Expert_l2_gpu3 -> AR_exp_l2;
  Expert_l2_gpu4 -> AR_exp_l2;
  Expert_l2_gpu5 -> AR_exp_l2;
  Expert_l2_gpu6 -> AR_exp_l2;
  Expert_l2_gpu7 -> AR_exp_l2;
  Expert_l2_gpu8 -> AR_exp_l2;
  Expert_l2_gpu9 -> AR_exp_l2;
  Expert_l2_gpu10 -> AR_exp_l2;
  Expert_l2_gpu11 -> AR_exp_l2;
  Expert_l2_gpu12 -> AR_exp_l2;
  Expert_l2_gpu13 -> AR_exp_l2;
  Expert_l2_gpu14 -> AR_exp_l2;
  Expert_l2_gpu15 -> AR_exp_l2;
  ResMOE_l2_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l2 -> ResMOE_l2_gpu0;
  ResAttn_l2_gpu0 -> ResMOE_l2_gpu0;
  ResMOE_l2_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l2 -> ResMOE_l2_gpu1;
  ResAttn_l2_gpu1 -> ResMOE_l2_gpu1;
  ResMOE_l2_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l2 -> ResMOE_l2_gpu2;
  ResAttn_l2_gpu2 -> ResMOE_l2_gpu2;
  ResMOE_l2_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l2 -> ResMOE_l2_gpu3;
  ResAttn_l2_gpu3 -> ResMOE_l2_gpu3;
  ResMOE_l2_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l2 -> ResMOE_l2_gpu4;
  ResAttn_l2_gpu4 -> ResMOE_l2_gpu4;
  ResMOE_l2_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l2 -> ResMOE_l2_gpu5;
  ResAttn_l2_gpu5 -> ResMOE_l2_gpu5;
  ResMOE_l2_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l2 -> ResMOE_l2_gpu6;
  ResAttn_l2_gpu6 -> ResMOE_l2_gpu6;
  ResMOE_l2_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l2 -> ResMOE_l2_gpu7;
  ResAttn_l2_gpu7 -> ResMOE_l2_gpu7;
  ResMOE_l2_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l2 -> ResMOE_l2_gpu8;
  ResAttn_l2_gpu8 -> ResMOE_l2_gpu8;
  ResMOE_l2_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l2 -> ResMOE_l2_gpu9;
  ResAttn_l2_gpu9 -> ResMOE_l2_gpu9;
  ResMOE_l2_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l2 -> ResMOE_l2_gpu10;
  ResAttn_l2_gpu10 -> ResMOE_l2_gpu10;
  ResMOE_l2_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l2 -> ResMOE_l2_gpu11;
  ResAttn_l2_gpu11 -> ResMOE_l2_gpu11;
  ResMOE_l2_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l2 -> ResMOE_l2_gpu12;
  ResAttn_l2_gpu12 -> ResMOE_l2_gpu12;
  ResMOE_l2_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l2 -> ResMOE_l2_gpu13;
  ResAttn_l2_gpu13 -> ResMOE_l2_gpu13;
  ResMOE_l2_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l2 -> ResMOE_l2_gpu14;
  ResAttn_l2_gpu14 -> ResMOE_l2_gpu14;
  ResMOE_l2_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l2 -> ResMOE_l2_gpu15;
  ResAttn_l2_gpu15 -> ResMOE_l2_gpu15;
  QKV_l3_gpu0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l2_gpu0 -> QKV_l3_gpu0;
  QKV_l3_gpu1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l2_gpu0 -> QKV_l3_gpu1;
  QKV_l3_gpu2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l2_gpu0 -> QKV_l3_gpu2;
  QKV_l3_gpu3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l2_gpu0 -> QKV_l3_gpu3;
  QKV_l3_gpu4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l2_gpu0 -> QKV_l3_gpu4;
  QKV_l3_gpu5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l2_gpu0 -> QKV_l3_gpu5;
  QKV_l3_gpu6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l2_gpu0 -> QKV_l3_gpu6;
  QKV_l3_gpu7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l2_gpu0 -> QKV_l3_gpu7;
  QKV_l3_gpu8 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l2_gpu0 -> QKV_l3_gpu8;
  QKV_l3_gpu9 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l2_gpu0 -> QKV_l3_gpu9;
  QKV_l3_gpu10 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l2_gpu0 -> QKV_l3_gpu10;
  QKV_l3_gpu11 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l2_gpu0 -> QKV_l3_gpu11;
  QKV_l3_gpu12 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l2_gpu0 -> QKV_l3_gpu12;
  QKV_l3_gpu13 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l2_gpu0 -> QKV_l3_gpu13;
  QKV_l3_gpu14 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l2_gpu0 -> QKV_l3_gpu14;
  QKV_l3_gpu15 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l2_gpu0 -> QKV_l3_gpu15;
  SplitHeads_l3_gpu0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l3_gpu0 -> SplitHeads_l3_gpu0;
  SplitHeads_l3_gpu1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l3_gpu1 -> SplitHeads_l3_gpu1;
  SplitHeads_l3_gpu2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l3_gpu2 -> SplitHeads_l3_gpu2;
  SplitHeads_l3_gpu3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l3_gpu3 -> SplitHeads_l3_gpu3;
  SplitHeads_l3_gpu4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l3_gpu4 -> SplitHeads_l3_gpu4;
  SplitHeads_l3_gpu5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l3_gpu5 -> SplitHeads_l3_gpu5;
  SplitHeads_l3_gpu6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l3_gpu6 -> SplitHeads_l3_gpu6;
  SplitHeads_l3_gpu7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l3_gpu7 -> SplitHeads_l3_gpu7;
  SplitHeads_l3_gpu8 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l3_gpu8 -> SplitHeads_l3_gpu8;
  SplitHeads_l3_gpu9 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l3_gpu9 -> SplitHeads_l3_gpu9;
  SplitHeads_l3_gpu10 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l3_gpu10 -> SplitHeads_l3_gpu10;
  SplitHeads_l3_gpu11 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l3_gpu11 -> SplitHeads_l3_gpu11;
  SplitHeads_l3_gpu12 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l3_gpu12 -> SplitHeads_l3_gpu12;
  SplitHeads_l3_gpu13 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l3_gpu13 -> SplitHeads_l3_gpu13;
  SplitHeads_l3_gpu14 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l3_gpu14 -> SplitHeads_l3_gpu14;
  SplitHeads_l3_gpu15 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l3_gpu15 -> SplitHeads_l3_gpu15;
  A2A_l3 [shape=ellipse, label="AllToAll\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_l3_gpu0 -> A2A_l3;
  SplitHeads_l3_gpu1 -> A2A_l3;
  SplitHeads_l3_gpu2 -> A2A_l3;
  SplitHeads_l3_gpu3 -> A2A_l3;
  SplitHeads_l3_gpu4 -> A2A_l3;
  SplitHeads_l3_gpu5 -> A2A_l3;
  SplitHeads_l3_gpu6 -> A2A_l3;
  SplitHeads_l3_gpu7 -> A2A_l3;
  SplitHeads_l3_gpu8 -> A2A_l3;
  SplitHeads_l3_gpu9 -> A2A_l3;
  SplitHeads_l3_gpu10 -> A2A_l3;
  SplitHeads_l3_gpu11 -> A2A_l3;
  SplitHeads_l3_gpu12 -> A2A_l3;
  SplitHeads_l3_gpu13 -> A2A_l3;
  SplitHeads_l3_gpu14 -> A2A_l3;
  SplitHeads_l3_gpu15 -> A2A_l3;
  Attn_l3_gpu0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l3 -> Attn_l3_gpu0;
  Attn_l3_gpu1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l3 -> Attn_l3_gpu1;
  Attn_l3_gpu2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l3 -> Attn_l3_gpu2;
  Attn_l3_gpu3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l3 -> Attn_l3_gpu3;
  Attn_l3_gpu4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l3 -> Attn_l3_gpu4;
  Attn_l3_gpu5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l3 -> Attn_l3_gpu5;
  Attn_l3_gpu6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l3 -> Attn_l3_gpu6;
  Attn_l3_gpu7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l3 -> Attn_l3_gpu7;
  Attn_l3_gpu8 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l3 -> Attn_l3_gpu8;
  Attn_l3_gpu9 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l3 -> Attn_l3_gpu9;
  Attn_l3_gpu10 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l3 -> Attn_l3_gpu10;
  Attn_l3_gpu11 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l3 -> Attn_l3_gpu11;
  Attn_l3_gpu12 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l3 -> Attn_l3_gpu12;
  Attn_l3_gpu13 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l3 -> Attn_l3_gpu13;
  Attn_l3_gpu14 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l3 -> Attn_l3_gpu14;
  Attn_l3_gpu15 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l3 -> Attn_l3_gpu15;
  AR_attn_l3 [shape=ellipse, label="AllReduce\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_l3_gpu0 -> AR_attn_l3;
  Attn_l3_gpu1 -> AR_attn_l3;
  Attn_l3_gpu2 -> AR_attn_l3;
  Attn_l3_gpu3 -> AR_attn_l3;
  Attn_l3_gpu4 -> AR_attn_l3;
  Attn_l3_gpu5 -> AR_attn_l3;
  Attn_l3_gpu6 -> AR_attn_l3;
  Attn_l3_gpu7 -> AR_attn_l3;
  Attn_l3_gpu8 -> AR_attn_l3;
  Attn_l3_gpu9 -> AR_attn_l3;
  Attn_l3_gpu10 -> AR_attn_l3;
  Attn_l3_gpu11 -> AR_attn_l3;
  Attn_l3_gpu12 -> AR_attn_l3;
  Attn_l3_gpu13 -> AR_attn_l3;
  Attn_l3_gpu14 -> AR_attn_l3;
  Attn_l3_gpu15 -> AR_attn_l3;
  O_l3_gpu0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l3 -> O_l3_gpu0;
  O_l3_gpu1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l3 -> O_l3_gpu1;
  O_l3_gpu2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l3 -> O_l3_gpu2;
  O_l3_gpu3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l3 -> O_l3_gpu3;
  O_l3_gpu4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l3 -> O_l3_gpu4;
  O_l3_gpu5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l3 -> O_l3_gpu5;
  O_l3_gpu6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l3 -> O_l3_gpu6;
  O_l3_gpu7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l3 -> O_l3_gpu7;
  O_l3_gpu8 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l3 -> O_l3_gpu8;
  O_l3_gpu9 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l3 -> O_l3_gpu9;
  O_l3_gpu10 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l3 -> O_l3_gpu10;
  O_l3_gpu11 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l3 -> O_l3_gpu11;
  O_l3_gpu12 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l3 -> O_l3_gpu12;
  O_l3_gpu13 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l3 -> O_l3_gpu13;
  O_l3_gpu14 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l3 -> O_l3_gpu14;
  O_l3_gpu15 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l3 -> O_l3_gpu15;
  ResAttn_l3_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l3_gpu0 -> ResAttn_l3_gpu0;
  ResMOE_l2_gpu0 -> ResAttn_l3_gpu0;
  ResAttn_l3_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l3_gpu1 -> ResAttn_l3_gpu1;
  ResMOE_l2_gpu0 -> ResAttn_l3_gpu1;
  ResAttn_l3_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l3_gpu2 -> ResAttn_l3_gpu2;
  ResMOE_l2_gpu0 -> ResAttn_l3_gpu2;
  ResAttn_l3_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l3_gpu3 -> ResAttn_l3_gpu3;
  ResMOE_l2_gpu0 -> ResAttn_l3_gpu3;
  ResAttn_l3_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l3_gpu4 -> ResAttn_l3_gpu4;
  ResMOE_l2_gpu0 -> ResAttn_l3_gpu4;
  ResAttn_l3_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l3_gpu5 -> ResAttn_l3_gpu5;
  ResMOE_l2_gpu0 -> ResAttn_l3_gpu5;
  ResAttn_l3_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l3_gpu6 -> ResAttn_l3_gpu6;
  ResMOE_l2_gpu0 -> ResAttn_l3_gpu6;
  ResAttn_l3_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l3_gpu7 -> ResAttn_l3_gpu7;
  ResMOE_l2_gpu0 -> ResAttn_l3_gpu7;
  ResAttn_l3_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l3_gpu8 -> ResAttn_l3_gpu8;
  ResMOE_l2_gpu0 -> ResAttn_l3_gpu8;
  ResAttn_l3_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l3_gpu9 -> ResAttn_l3_gpu9;
  ResMOE_l2_gpu0 -> ResAttn_l3_gpu9;
  ResAttn_l3_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l3_gpu10 -> ResAttn_l3_gpu10;
  ResMOE_l2_gpu0 -> ResAttn_l3_gpu10;
  ResAttn_l3_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l3_gpu11 -> ResAttn_l3_gpu11;
  ResMOE_l2_gpu0 -> ResAttn_l3_gpu11;
  ResAttn_l3_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l3_gpu12 -> ResAttn_l3_gpu12;
  ResMOE_l2_gpu0 -> ResAttn_l3_gpu12;
  ResAttn_l3_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l3_gpu13 -> ResAttn_l3_gpu13;
  ResMOE_l2_gpu0 -> ResAttn_l3_gpu13;
  ResAttn_l3_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l3_gpu14 -> ResAttn_l3_gpu14;
  ResMOE_l2_gpu0 -> ResAttn_l3_gpu14;
  ResAttn_l3_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l3_gpu15 -> ResAttn_l3_gpu15;
  ResMOE_l2_gpu0 -> ResAttn_l3_gpu15;
  Gate_l3_gpu0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l3_gpu0 -> Gate_l3_gpu0;
  Gate_l3_gpu1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l3_gpu1 -> Gate_l3_gpu1;
  Gate_l3_gpu2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l3_gpu2 -> Gate_l3_gpu2;
  Gate_l3_gpu3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l3_gpu3 -> Gate_l3_gpu3;
  Gate_l3_gpu4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l3_gpu4 -> Gate_l3_gpu4;
  Gate_l3_gpu5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l3_gpu5 -> Gate_l3_gpu5;
  Gate_l3_gpu6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l3_gpu6 -> Gate_l3_gpu6;
  Gate_l3_gpu7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l3_gpu7 -> Gate_l3_gpu7;
  Gate_l3_gpu8 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l3_gpu8 -> Gate_l3_gpu8;
  Gate_l3_gpu9 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l3_gpu9 -> Gate_l3_gpu9;
  Gate_l3_gpu10 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l3_gpu10 -> Gate_l3_gpu10;
  Gate_l3_gpu11 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l3_gpu11 -> Gate_l3_gpu11;
  Gate_l3_gpu12 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l3_gpu12 -> Gate_l3_gpu12;
  Gate_l3_gpu13 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l3_gpu13 -> Gate_l3_gpu13;
  Gate_l3_gpu14 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l3_gpu14 -> Gate_l3_gpu14;
  Gate_l3_gpu15 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l3_gpu15 -> Gate_l3_gpu15;
  Expert_l3_gpu0 [label="Expert_l3\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l3_gpu0 -> Expert_l3_gpu0 [style=dashed];
  Expert_l3_gpu1 [label="Expert_l3\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l3_gpu1 -> Expert_l3_gpu1 [style=dashed];
  Expert_l3_gpu2 [label="Expert_l3\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l3_gpu2 -> Expert_l3_gpu2 [style=dashed];
  Expert_l3_gpu3 [label="Expert_l3\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l3_gpu3 -> Expert_l3_gpu3 [style=dashed];
  Expert_l3_gpu4 [label="Expert_l3\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l3_gpu4 -> Expert_l3_gpu4 [style=dashed];
  Expert_l3_gpu5 [label="Expert_l3\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l3_gpu5 -> Expert_l3_gpu5 [style=dashed];
  Expert_l3_gpu6 [label="Expert_l3\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l3_gpu6 -> Expert_l3_gpu6 [style=dashed];
  Expert_l3_gpu7 [label="Expert_l3\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l3_gpu7 -> Expert_l3_gpu7 [style=dashed];
  Expert_l3_gpu8 [label="Expert_l3\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l3_gpu8 -> Expert_l3_gpu8 [style=dashed];
  Expert_l3_gpu9 [label="Expert_l3\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l3_gpu9 -> Expert_l3_gpu9 [style=dashed];
  Expert_l3_gpu10 [label="Expert_l3\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l3_gpu10 -> Expert_l3_gpu10 [style=dashed];
  Expert_l3_gpu11 [label="Expert_l3\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l3_gpu11 -> Expert_l3_gpu11 [style=dashed];
  Expert_l3_gpu12 [label="Expert_l3\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l3_gpu12 -> Expert_l3_gpu12 [style=dashed];
  Expert_l3_gpu13 [label="Expert_l3\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l3_gpu13 -> Expert_l3_gpu13 [style=dashed];
  Expert_l3_gpu14 [label="Expert_l3\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l3_gpu14 -> Expert_l3_gpu14 [style=dashed];
  Expert_l3_gpu15 [label="Expert_l3\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l3_gpu15 -> Expert_l3_gpu15 [style=dashed];
  AR_exp_l3 [shape=ellipse, label="AllReduceExperts\nall16GPUs\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert_l3_gpu0 -> AR_exp_l3;
  Expert_l3_gpu1 -> AR_exp_l3;
  Expert_l3_gpu2 -> AR_exp_l3;
  Expert_l3_gpu3 -> AR_exp_l3;
  Expert_l3_gpu4 -> AR_exp_l3;
  Expert_l3_gpu5 -> AR_exp_l3;
  Expert_l3_gpu6 -> AR_exp_l3;
  Expert_l3_gpu7 -> AR_exp_l3;
  Expert_l3_gpu8 -> AR_exp_l3;
  Expert_l3_gpu9 -> AR_exp_l3;
  Expert_l3_gpu10 -> AR_exp_l3;
  Expert_l3_gpu11 -> AR_exp_l3;
  Expert_l3_gpu12 -> AR_exp_l3;
  Expert_l3_gpu13 -> AR_exp_l3;
  Expert_l3_gpu14 -> AR_exp_l3;
  Expert_l3_gpu15 -> AR_exp_l3;
  ResMOE_l3_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l3 -> ResMOE_l3_gpu0;
  ResAttn_l3_gpu0 -> ResMOE_l3_gpu0;
  ResMOE_l3_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l3 -> ResMOE_l3_gpu1;
  ResAttn_l3_gpu1 -> ResMOE_l3_gpu1;
  ResMOE_l3_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l3 -> ResMOE_l3_gpu2;
  ResAttn_l3_gpu2 -> ResMOE_l3_gpu2;
  ResMOE_l3_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l3 -> ResMOE_l3_gpu3;
  ResAttn_l3_gpu3 -> ResMOE_l3_gpu3;
  ResMOE_l3_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l3 -> ResMOE_l3_gpu4;
  ResAttn_l3_gpu4 -> ResMOE_l3_gpu4;
  ResMOE_l3_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l3 -> ResMOE_l3_gpu5;
  ResAttn_l3_gpu5 -> ResMOE_l3_gpu5;
  ResMOE_l3_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l3 -> ResMOE_l3_gpu6;
  ResAttn_l3_gpu6 -> ResMOE_l3_gpu6;
  ResMOE_l3_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l3 -> ResMOE_l3_gpu7;
  ResAttn_l3_gpu7 -> ResMOE_l3_gpu7;
  ResMOE_l3_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l3 -> ResMOE_l3_gpu8;
  ResAttn_l3_gpu8 -> ResMOE_l3_gpu8;
  ResMOE_l3_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l3 -> ResMOE_l3_gpu9;
  ResAttn_l3_gpu9 -> ResMOE_l3_gpu9;
  ResMOE_l3_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l3 -> ResMOE_l3_gpu10;
  ResAttn_l3_gpu10 -> ResMOE_l3_gpu10;
  ResMOE_l3_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l3 -> ResMOE_l3_gpu11;
  ResAttn_l3_gpu11 -> ResMOE_l3_gpu11;
  ResMOE_l3_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l3 -> ResMOE_l3_gpu12;
  ResAttn_l3_gpu12 -> ResMOE_l3_gpu12;
  ResMOE_l3_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l3 -> ResMOE_l3_gpu13;
  ResAttn_l3_gpu13 -> ResMOE_l3_gpu13;
  ResMOE_l3_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l3 -> ResMOE_l3_gpu14;
  ResAttn_l3_gpu14 -> ResMOE_l3_gpu14;
  ResMOE_l3_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l3 -> ResMOE_l3_gpu15;
  ResAttn_l3_gpu15 -> ResMOE_l3_gpu15;
  QKV_l4_gpu0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l3_gpu0 -> QKV_l4_gpu0;
  QKV_l4_gpu1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l3_gpu0 -> QKV_l4_gpu1;
  QKV_l4_gpu2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l3_gpu0 -> QKV_l4_gpu2;
  QKV_l4_gpu3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l3_gpu0 -> QKV_l4_gpu3;
  QKV_l4_gpu4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l3_gpu0 -> QKV_l4_gpu4;
  QKV_l4_gpu5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l3_gpu0 -> QKV_l4_gpu5;
  QKV_l4_gpu6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l3_gpu0 -> QKV_l4_gpu6;
  QKV_l4_gpu7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l3_gpu0 -> QKV_l4_gpu7;
  QKV_l4_gpu8 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l3_gpu0 -> QKV_l4_gpu8;
  QKV_l4_gpu9 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l3_gpu0 -> QKV_l4_gpu9;
  QKV_l4_gpu10 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l3_gpu0 -> QKV_l4_gpu10;
  QKV_l4_gpu11 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l3_gpu0 -> QKV_l4_gpu11;
  QKV_l4_gpu12 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l3_gpu0 -> QKV_l4_gpu12;
  QKV_l4_gpu13 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l3_gpu0 -> QKV_l4_gpu13;
  QKV_l4_gpu14 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l3_gpu0 -> QKV_l4_gpu14;
  QKV_l4_gpu15 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l3_gpu0 -> QKV_l4_gpu15;
  SplitHeads_l4_gpu0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l4_gpu0 -> SplitHeads_l4_gpu0;
  SplitHeads_l4_gpu1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l4_gpu1 -> SplitHeads_l4_gpu1;
  SplitHeads_l4_gpu2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l4_gpu2 -> SplitHeads_l4_gpu2;
  SplitHeads_l4_gpu3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l4_gpu3 -> SplitHeads_l4_gpu3;
  SplitHeads_l4_gpu4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l4_gpu4 -> SplitHeads_l4_gpu4;
  SplitHeads_l4_gpu5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l4_gpu5 -> SplitHeads_l4_gpu5;
  SplitHeads_l4_gpu6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l4_gpu6 -> SplitHeads_l4_gpu6;
  SplitHeads_l4_gpu7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l4_gpu7 -> SplitHeads_l4_gpu7;
  SplitHeads_l4_gpu8 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l4_gpu8 -> SplitHeads_l4_gpu8;
  SplitHeads_l4_gpu9 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l4_gpu9 -> SplitHeads_l4_gpu9;
  SplitHeads_l4_gpu10 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l4_gpu10 -> SplitHeads_l4_gpu10;
  SplitHeads_l4_gpu11 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l4_gpu11 -> SplitHeads_l4_gpu11;
  SplitHeads_l4_gpu12 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l4_gpu12 -> SplitHeads_l4_gpu12;
  SplitHeads_l4_gpu13 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l4_gpu13 -> SplitHeads_l4_gpu13;
  SplitHeads_l4_gpu14 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l4_gpu14 -> SplitHeads_l4_gpu14;
  SplitHeads_l4_gpu15 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l4_gpu15 -> SplitHeads_l4_gpu15;
  A2A_l4 [shape=ellipse, label="AllToAll\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_l4_gpu0 -> A2A_l4;
  SplitHeads_l4_gpu1 -> A2A_l4;
  SplitHeads_l4_gpu2 -> A2A_l4;
  SplitHeads_l4_gpu3 -> A2A_l4;
  SplitHeads_l4_gpu4 -> A2A_l4;
  SplitHeads_l4_gpu5 -> A2A_l4;
  SplitHeads_l4_gpu6 -> A2A_l4;
  SplitHeads_l4_gpu7 -> A2A_l4;
  SplitHeads_l4_gpu8 -> A2A_l4;
  SplitHeads_l4_gpu9 -> A2A_l4;
  SplitHeads_l4_gpu10 -> A2A_l4;
  SplitHeads_l4_gpu11 -> A2A_l4;
  SplitHeads_l4_gpu12 -> A2A_l4;
  SplitHeads_l4_gpu13 -> A2A_l4;
  SplitHeads_l4_gpu14 -> A2A_l4;
  SplitHeads_l4_gpu15 -> A2A_l4;
  Attn_l4_gpu0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l4 -> Attn_l4_gpu0;
  Attn_l4_gpu1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l4 -> Attn_l4_gpu1;
  Attn_l4_gpu2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l4 -> Attn_l4_gpu2;
  Attn_l4_gpu3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l4 -> Attn_l4_gpu3;
  Attn_l4_gpu4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l4 -> Attn_l4_gpu4;
  Attn_l4_gpu5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l4 -> Attn_l4_gpu5;
  Attn_l4_gpu6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l4 -> Attn_l4_gpu6;
  Attn_l4_gpu7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l4 -> Attn_l4_gpu7;
  Attn_l4_gpu8 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l4 -> Attn_l4_gpu8;
  Attn_l4_gpu9 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l4 -> Attn_l4_gpu9;
  Attn_l4_gpu10 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l4 -> Attn_l4_gpu10;
  Attn_l4_gpu11 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l4 -> Attn_l4_gpu11;
  Attn_l4_gpu12 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l4 -> Attn_l4_gpu12;
  Attn_l4_gpu13 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l4 -> Attn_l4_gpu13;
  Attn_l4_gpu14 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l4 -> Attn_l4_gpu14;
  Attn_l4_gpu15 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l4 -> Attn_l4_gpu15;
  AR_attn_l4 [shape=ellipse, label="AllReduce\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_l4_gpu0 -> AR_attn_l4;
  Attn_l4_gpu1 -> AR_attn_l4;
  Attn_l4_gpu2 -> AR_attn_l4;
  Attn_l4_gpu3 -> AR_attn_l4;
  Attn_l4_gpu4 -> AR_attn_l4;
  Attn_l4_gpu5 -> AR_attn_l4;
  Attn_l4_gpu6 -> AR_attn_l4;
  Attn_l4_gpu7 -> AR_attn_l4;
  Attn_l4_gpu8 -> AR_attn_l4;
  Attn_l4_gpu9 -> AR_attn_l4;
  Attn_l4_gpu10 -> AR_attn_l4;
  Attn_l4_gpu11 -> AR_attn_l4;
  Attn_l4_gpu12 -> AR_attn_l4;
  Attn_l4_gpu13 -> AR_attn_l4;
  Attn_l4_gpu14 -> AR_attn_l4;
  Attn_l4_gpu15 -> AR_attn_l4;
  O_l4_gpu0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l4 -> O_l4_gpu0;
  O_l4_gpu1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l4 -> O_l4_gpu1;
  O_l4_gpu2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l4 -> O_l4_gpu2;
  O_l4_gpu3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l4 -> O_l4_gpu3;
  O_l4_gpu4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l4 -> O_l4_gpu4;
  O_l4_gpu5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l4 -> O_l4_gpu5;
  O_l4_gpu6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l4 -> O_l4_gpu6;
  O_l4_gpu7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l4 -> O_l4_gpu7;
  O_l4_gpu8 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l4 -> O_l4_gpu8;
  O_l4_gpu9 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l4 -> O_l4_gpu9;
  O_l4_gpu10 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l4 -> O_l4_gpu10;
  O_l4_gpu11 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l4 -> O_l4_gpu11;
  O_l4_gpu12 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l4 -> O_l4_gpu12;
  O_l4_gpu13 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l4 -> O_l4_gpu13;
  O_l4_gpu14 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l4 -> O_l4_gpu14;
  O_l4_gpu15 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l4 -> O_l4_gpu15;
  ResAttn_l4_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l4_gpu0 -> ResAttn_l4_gpu0;
  ResMOE_l3_gpu0 -> ResAttn_l4_gpu0;
  ResAttn_l4_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l4_gpu1 -> ResAttn_l4_gpu1;
  ResMOE_l3_gpu0 -> ResAttn_l4_gpu1;
  ResAttn_l4_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l4_gpu2 -> ResAttn_l4_gpu2;
  ResMOE_l3_gpu0 -> ResAttn_l4_gpu2;
  ResAttn_l4_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l4_gpu3 -> ResAttn_l4_gpu3;
  ResMOE_l3_gpu0 -> ResAttn_l4_gpu3;
  ResAttn_l4_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l4_gpu4 -> ResAttn_l4_gpu4;
  ResMOE_l3_gpu0 -> ResAttn_l4_gpu4;
  ResAttn_l4_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l4_gpu5 -> ResAttn_l4_gpu5;
  ResMOE_l3_gpu0 -> ResAttn_l4_gpu5;
  ResAttn_l4_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l4_gpu6 -> ResAttn_l4_gpu6;
  ResMOE_l3_gpu0 -> ResAttn_l4_gpu6;
  ResAttn_l4_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l4_gpu7 -> ResAttn_l4_gpu7;
  ResMOE_l3_gpu0 -> ResAttn_l4_gpu7;
  ResAttn_l4_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l4_gpu8 -> ResAttn_l4_gpu8;
  ResMOE_l3_gpu0 -> ResAttn_l4_gpu8;
  ResAttn_l4_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l4_gpu9 -> ResAttn_l4_gpu9;
  ResMOE_l3_gpu0 -> ResAttn_l4_gpu9;
  ResAttn_l4_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l4_gpu10 -> ResAttn_l4_gpu10;
  ResMOE_l3_gpu0 -> ResAttn_l4_gpu10;
  ResAttn_l4_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l4_gpu11 -> ResAttn_l4_gpu11;
  ResMOE_l3_gpu0 -> ResAttn_l4_gpu11;
  ResAttn_l4_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l4_gpu12 -> ResAttn_l4_gpu12;
  ResMOE_l3_gpu0 -> ResAttn_l4_gpu12;
  ResAttn_l4_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l4_gpu13 -> ResAttn_l4_gpu13;
  ResMOE_l3_gpu0 -> ResAttn_l4_gpu13;
  ResAttn_l4_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l4_gpu14 -> ResAttn_l4_gpu14;
  ResMOE_l3_gpu0 -> ResAttn_l4_gpu14;
  ResAttn_l4_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l4_gpu15 -> ResAttn_l4_gpu15;
  ResMOE_l3_gpu0 -> ResAttn_l4_gpu15;
  Gate_l4_gpu0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l4_gpu0 -> Gate_l4_gpu0;
  Gate_l4_gpu1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l4_gpu1 -> Gate_l4_gpu1;
  Gate_l4_gpu2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l4_gpu2 -> Gate_l4_gpu2;
  Gate_l4_gpu3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l4_gpu3 -> Gate_l4_gpu3;
  Gate_l4_gpu4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l4_gpu4 -> Gate_l4_gpu4;
  Gate_l4_gpu5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l4_gpu5 -> Gate_l4_gpu5;
  Gate_l4_gpu6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l4_gpu6 -> Gate_l4_gpu6;
  Gate_l4_gpu7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l4_gpu7 -> Gate_l4_gpu7;
  Gate_l4_gpu8 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l4_gpu8 -> Gate_l4_gpu8;
  Gate_l4_gpu9 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l4_gpu9 -> Gate_l4_gpu9;
  Gate_l4_gpu10 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l4_gpu10 -> Gate_l4_gpu10;
  Gate_l4_gpu11 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l4_gpu11 -> Gate_l4_gpu11;
  Gate_l4_gpu12 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l4_gpu12 -> Gate_l4_gpu12;
  Gate_l4_gpu13 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l4_gpu13 -> Gate_l4_gpu13;
  Gate_l4_gpu14 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l4_gpu14 -> Gate_l4_gpu14;
  Gate_l4_gpu15 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l4_gpu15 -> Gate_l4_gpu15;
  Expert_l4_gpu0 [label="Expert_l4\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l4_gpu0 -> Expert_l4_gpu0 [style=dashed];
  Expert_l4_gpu1 [label="Expert_l4\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l4_gpu1 -> Expert_l4_gpu1 [style=dashed];
  Expert_l4_gpu2 [label="Expert_l4\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l4_gpu2 -> Expert_l4_gpu2 [style=dashed];
  Expert_l4_gpu3 [label="Expert_l4\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l4_gpu3 -> Expert_l4_gpu3 [style=dashed];
  Expert_l4_gpu4 [label="Expert_l4\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l4_gpu4 -> Expert_l4_gpu4 [style=dashed];
  Expert_l4_gpu5 [label="Expert_l4\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l4_gpu5 -> Expert_l4_gpu5 [style=dashed];
  Expert_l4_gpu6 [label="Expert_l4\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l4_gpu6 -> Expert_l4_gpu6 [style=dashed];
  Expert_l4_gpu7 [label="Expert_l4\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l4_gpu7 -> Expert_l4_gpu7 [style=dashed];
  Expert_l4_gpu8 [label="Expert_l4\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l4_gpu8 -> Expert_l4_gpu8 [style=dashed];
  Expert_l4_gpu9 [label="Expert_l4\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l4_gpu9 -> Expert_l4_gpu9 [style=dashed];
  Expert_l4_gpu10 [label="Expert_l4\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l4_gpu10 -> Expert_l4_gpu10 [style=dashed];
  Expert_l4_gpu11 [label="Expert_l4\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l4_gpu11 -> Expert_l4_gpu11 [style=dashed];
  Expert_l4_gpu12 [label="Expert_l4\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l4_gpu12 -> Expert_l4_gpu12 [style=dashed];
  Expert_l4_gpu13 [label="Expert_l4\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l4_gpu13 -> Expert_l4_gpu13 [style=dashed];
  Expert_l4_gpu14 [label="Expert_l4\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l4_gpu14 -> Expert_l4_gpu14 [style=dashed];
  Expert_l4_gpu15 [label="Expert_l4\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l4_gpu15 -> Expert_l4_gpu15 [style=dashed];
  AR_exp_l4 [shape=ellipse, label="AllReduceExperts\nall16GPUs\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert_l4_gpu0 -> AR_exp_l4;
  Expert_l4_gpu1 -> AR_exp_l4;
  Expert_l4_gpu2 -> AR_exp_l4;
  Expert_l4_gpu3 -> AR_exp_l4;
  Expert_l4_gpu4 -> AR_exp_l4;
  Expert_l4_gpu5 -> AR_exp_l4;
  Expert_l4_gpu6 -> AR_exp_l4;
  Expert_l4_gpu7 -> AR_exp_l4;
  Expert_l4_gpu8 -> AR_exp_l4;
  Expert_l4_gpu9 -> AR_exp_l4;
  Expert_l4_gpu10 -> AR_exp_l4;
  Expert_l4_gpu11 -> AR_exp_l4;
  Expert_l4_gpu12 -> AR_exp_l4;
  Expert_l4_gpu13 -> AR_exp_l4;
  Expert_l4_gpu14 -> AR_exp_l4;
  Expert_l4_gpu15 -> AR_exp_l4;
  ResMOE_l4_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l4 -> ResMOE_l4_gpu0;
  ResAttn_l4_gpu0 -> ResMOE_l4_gpu0;
  ResMOE_l4_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l4 -> ResMOE_l4_gpu1;
  ResAttn_l4_gpu1 -> ResMOE_l4_gpu1;
  ResMOE_l4_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l4 -> ResMOE_l4_gpu2;
  ResAttn_l4_gpu2 -> ResMOE_l4_gpu2;
  ResMOE_l4_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l4 -> ResMOE_l4_gpu3;
  ResAttn_l4_gpu3 -> ResMOE_l4_gpu3;
  ResMOE_l4_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l4 -> ResMOE_l4_gpu4;
  ResAttn_l4_gpu4 -> ResMOE_l4_gpu4;
  ResMOE_l4_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l4 -> ResMOE_l4_gpu5;
  ResAttn_l4_gpu5 -> ResMOE_l4_gpu5;
  ResMOE_l4_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l4 -> ResMOE_l4_gpu6;
  ResAttn_l4_gpu6 -> ResMOE_l4_gpu6;
  ResMOE_l4_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l4 -> ResMOE_l4_gpu7;
  ResAttn_l4_gpu7 -> ResMOE_l4_gpu7;
  ResMOE_l4_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l4 -> ResMOE_l4_gpu8;
  ResAttn_l4_gpu8 -> ResMOE_l4_gpu8;
  ResMOE_l4_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l4 -> ResMOE_l4_gpu9;
  ResAttn_l4_gpu9 -> ResMOE_l4_gpu9;
  ResMOE_l4_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l4 -> ResMOE_l4_gpu10;
  ResAttn_l4_gpu10 -> ResMOE_l4_gpu10;
  ResMOE_l4_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l4 -> ResMOE_l4_gpu11;
  ResAttn_l4_gpu11 -> ResMOE_l4_gpu11;
  ResMOE_l4_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l4 -> ResMOE_l4_gpu12;
  ResAttn_l4_gpu12 -> ResMOE_l4_gpu12;
  ResMOE_l4_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l4 -> ResMOE_l4_gpu13;
  ResAttn_l4_gpu13 -> ResMOE_l4_gpu13;
  ResMOE_l4_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l4 -> ResMOE_l4_gpu14;
  ResAttn_l4_gpu14 -> ResMOE_l4_gpu14;
  ResMOE_l4_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l4 -> ResMOE_l4_gpu15;
  ResAttn_l4_gpu15 -> ResMOE_l4_gpu15;
  QKV_l5_gpu0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l4_gpu0 -> QKV_l5_gpu0;
  QKV_l5_gpu1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l4_gpu0 -> QKV_l5_gpu1;
  QKV_l5_gpu2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l4_gpu0 -> QKV_l5_gpu2;
  QKV_l5_gpu3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l4_gpu0 -> QKV_l5_gpu3;
  QKV_l5_gpu4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l4_gpu0 -> QKV_l5_gpu4;
  QKV_l5_gpu5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l4_gpu0 -> QKV_l5_gpu5;
  QKV_l5_gpu6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l4_gpu0 -> QKV_l5_gpu6;
  QKV_l5_gpu7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l4_gpu0 -> QKV_l5_gpu7;
  QKV_l5_gpu8 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l4_gpu0 -> QKV_l5_gpu8;
  QKV_l5_gpu9 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l4_gpu0 -> QKV_l5_gpu9;
  QKV_l5_gpu10 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l4_gpu0 -> QKV_l5_gpu10;
  QKV_l5_gpu11 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l4_gpu0 -> QKV_l5_gpu11;
  QKV_l5_gpu12 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l4_gpu0 -> QKV_l5_gpu12;
  QKV_l5_gpu13 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l4_gpu0 -> QKV_l5_gpu13;
  QKV_l5_gpu14 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l4_gpu0 -> QKV_l5_gpu14;
  QKV_l5_gpu15 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l4_gpu0 -> QKV_l5_gpu15;
  SplitHeads_l5_gpu0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l5_gpu0 -> SplitHeads_l5_gpu0;
  SplitHeads_l5_gpu1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l5_gpu1 -> SplitHeads_l5_gpu1;
  SplitHeads_l5_gpu2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l5_gpu2 -> SplitHeads_l5_gpu2;
  SplitHeads_l5_gpu3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l5_gpu3 -> SplitHeads_l5_gpu3;
  SplitHeads_l5_gpu4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l5_gpu4 -> SplitHeads_l5_gpu4;
  SplitHeads_l5_gpu5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l5_gpu5 -> SplitHeads_l5_gpu5;
  SplitHeads_l5_gpu6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l5_gpu6 -> SplitHeads_l5_gpu6;
  SplitHeads_l5_gpu7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l5_gpu7 -> SplitHeads_l5_gpu7;
  SplitHeads_l5_gpu8 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l5_gpu8 -> SplitHeads_l5_gpu8;
  SplitHeads_l5_gpu9 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l5_gpu9 -> SplitHeads_l5_gpu9;
  SplitHeads_l5_gpu10 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l5_gpu10 -> SplitHeads_l5_gpu10;
  SplitHeads_l5_gpu11 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l5_gpu11 -> SplitHeads_l5_gpu11;
  SplitHeads_l5_gpu12 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l5_gpu12 -> SplitHeads_l5_gpu12;
  SplitHeads_l5_gpu13 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l5_gpu13 -> SplitHeads_l5_gpu13;
  SplitHeads_l5_gpu14 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l5_gpu14 -> SplitHeads_l5_gpu14;
  SplitHeads_l5_gpu15 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l5_gpu15 -> SplitHeads_l5_gpu15;
  A2A_l5 [shape=ellipse, label="AllToAll\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_l5_gpu0 -> A2A_l5;
  SplitHeads_l5_gpu1 -> A2A_l5;
  SplitHeads_l5_gpu2 -> A2A_l5;
  SplitHeads_l5_gpu3 -> A2A_l5;
  SplitHeads_l5_gpu4 -> A2A_l5;
  SplitHeads_l5_gpu5 -> A2A_l5;
  SplitHeads_l5_gpu6 -> A2A_l5;
  SplitHeads_l5_gpu7 -> A2A_l5;
  SplitHeads_l5_gpu8 -> A2A_l5;
  SplitHeads_l5_gpu9 -> A2A_l5;
  SplitHeads_l5_gpu10 -> A2A_l5;
  SplitHeads_l5_gpu11 -> A2A_l5;
  SplitHeads_l5_gpu12 -> A2A_l5;
  SplitHeads_l5_gpu13 -> A2A_l5;
  SplitHeads_l5_gpu14 -> A2A_l5;
  SplitHeads_l5_gpu15 -> A2A_l5;
  Attn_l5_gpu0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l5 -> Attn_l5_gpu0;
  Attn_l5_gpu1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l5 -> Attn_l5_gpu1;
  Attn_l5_gpu2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l5 -> Attn_l5_gpu2;
  Attn_l5_gpu3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l5 -> Attn_l5_gpu3;
  Attn_l5_gpu4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l5 -> Attn_l5_gpu4;
  Attn_l5_gpu5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l5 -> Attn_l5_gpu5;
  Attn_l5_gpu6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l5 -> Attn_l5_gpu6;
  Attn_l5_gpu7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l5 -> Attn_l5_gpu7;
  Attn_l5_gpu8 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l5 -> Attn_l5_gpu8;
  Attn_l5_gpu9 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l5 -> Attn_l5_gpu9;
  Attn_l5_gpu10 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l5 -> Attn_l5_gpu10;
  Attn_l5_gpu11 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l5 -> Attn_l5_gpu11;
  Attn_l5_gpu12 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l5 -> Attn_l5_gpu12;
  Attn_l5_gpu13 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l5 -> Attn_l5_gpu13;
  Attn_l5_gpu14 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l5 -> Attn_l5_gpu14;
  Attn_l5_gpu15 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l5 -> Attn_l5_gpu15;
  AR_attn_l5 [shape=ellipse, label="AllReduce\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_l5_gpu0 -> AR_attn_l5;
  Attn_l5_gpu1 -> AR_attn_l5;
  Attn_l5_gpu2 -> AR_attn_l5;
  Attn_l5_gpu3 -> AR_attn_l5;
  Attn_l5_gpu4 -> AR_attn_l5;
  Attn_l5_gpu5 -> AR_attn_l5;
  Attn_l5_gpu6 -> AR_attn_l5;
  Attn_l5_gpu7 -> AR_attn_l5;
  Attn_l5_gpu8 -> AR_attn_l5;
  Attn_l5_gpu9 -> AR_attn_l5;
  Attn_l5_gpu10 -> AR_attn_l5;
  Attn_l5_gpu11 -> AR_attn_l5;
  Attn_l5_gpu12 -> AR_attn_l5;
  Attn_l5_gpu13 -> AR_attn_l5;
  Attn_l5_gpu14 -> AR_attn_l5;
  Attn_l5_gpu15 -> AR_attn_l5;
  O_l5_gpu0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l5 -> O_l5_gpu0;
  O_l5_gpu1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l5 -> O_l5_gpu1;
  O_l5_gpu2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l5 -> O_l5_gpu2;
  O_l5_gpu3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l5 -> O_l5_gpu3;
  O_l5_gpu4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l5 -> O_l5_gpu4;
  O_l5_gpu5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l5 -> O_l5_gpu5;
  O_l5_gpu6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l5 -> O_l5_gpu6;
  O_l5_gpu7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l5 -> O_l5_gpu7;
  O_l5_gpu8 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l5 -> O_l5_gpu8;
  O_l5_gpu9 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l5 -> O_l5_gpu9;
  O_l5_gpu10 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l5 -> O_l5_gpu10;
  O_l5_gpu11 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l5 -> O_l5_gpu11;
  O_l5_gpu12 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l5 -> O_l5_gpu12;
  O_l5_gpu13 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l5 -> O_l5_gpu13;
  O_l5_gpu14 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l5 -> O_l5_gpu14;
  O_l5_gpu15 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l5 -> O_l5_gpu15;
  ResAttn_l5_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l5_gpu0 -> ResAttn_l5_gpu0;
  ResMOE_l4_gpu0 -> ResAttn_l5_gpu0;
  ResAttn_l5_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l5_gpu1 -> ResAttn_l5_gpu1;
  ResMOE_l4_gpu0 -> ResAttn_l5_gpu1;
  ResAttn_l5_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l5_gpu2 -> ResAttn_l5_gpu2;
  ResMOE_l4_gpu0 -> ResAttn_l5_gpu2;
  ResAttn_l5_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l5_gpu3 -> ResAttn_l5_gpu3;
  ResMOE_l4_gpu0 -> ResAttn_l5_gpu3;
  ResAttn_l5_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l5_gpu4 -> ResAttn_l5_gpu4;
  ResMOE_l4_gpu0 -> ResAttn_l5_gpu4;
  ResAttn_l5_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l5_gpu5 -> ResAttn_l5_gpu5;
  ResMOE_l4_gpu0 -> ResAttn_l5_gpu5;
  ResAttn_l5_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l5_gpu6 -> ResAttn_l5_gpu6;
  ResMOE_l4_gpu0 -> ResAttn_l5_gpu6;
  ResAttn_l5_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l5_gpu7 -> ResAttn_l5_gpu7;
  ResMOE_l4_gpu0 -> ResAttn_l5_gpu7;
  ResAttn_l5_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l5_gpu8 -> ResAttn_l5_gpu8;
  ResMOE_l4_gpu0 -> ResAttn_l5_gpu8;
  ResAttn_l5_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l5_gpu9 -> ResAttn_l5_gpu9;
  ResMOE_l4_gpu0 -> ResAttn_l5_gpu9;
  ResAttn_l5_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l5_gpu10 -> ResAttn_l5_gpu10;
  ResMOE_l4_gpu0 -> ResAttn_l5_gpu10;
  ResAttn_l5_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l5_gpu11 -> ResAttn_l5_gpu11;
  ResMOE_l4_gpu0 -> ResAttn_l5_gpu11;
  ResAttn_l5_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l5_gpu12 -> ResAttn_l5_gpu12;
  ResMOE_l4_gpu0 -> ResAttn_l5_gpu12;
  ResAttn_l5_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l5_gpu13 -> ResAttn_l5_gpu13;
  ResMOE_l4_gpu0 -> ResAttn_l5_gpu13;
  ResAttn_l5_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l5_gpu14 -> ResAttn_l5_gpu14;
  ResMOE_l4_gpu0 -> ResAttn_l5_gpu14;
  ResAttn_l5_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l5_gpu15 -> ResAttn_l5_gpu15;
  ResMOE_l4_gpu0 -> ResAttn_l5_gpu15;
  Gate_l5_gpu0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l5_gpu0 -> Gate_l5_gpu0;
  Gate_l5_gpu1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l5_gpu1 -> Gate_l5_gpu1;
  Gate_l5_gpu2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l5_gpu2 -> Gate_l5_gpu2;
  Gate_l5_gpu3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l5_gpu3 -> Gate_l5_gpu3;
  Gate_l5_gpu4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l5_gpu4 -> Gate_l5_gpu4;
  Gate_l5_gpu5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l5_gpu5 -> Gate_l5_gpu5;
  Gate_l5_gpu6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l5_gpu6 -> Gate_l5_gpu6;
  Gate_l5_gpu7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l5_gpu7 -> Gate_l5_gpu7;
  Gate_l5_gpu8 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l5_gpu8 -> Gate_l5_gpu8;
  Gate_l5_gpu9 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l5_gpu9 -> Gate_l5_gpu9;
  Gate_l5_gpu10 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l5_gpu10 -> Gate_l5_gpu10;
  Gate_l5_gpu11 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l5_gpu11 -> Gate_l5_gpu11;
  Gate_l5_gpu12 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l5_gpu12 -> Gate_l5_gpu12;
  Gate_l5_gpu13 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l5_gpu13 -> Gate_l5_gpu13;
  Gate_l5_gpu14 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l5_gpu14 -> Gate_l5_gpu14;
  Gate_l5_gpu15 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l5_gpu15 -> Gate_l5_gpu15;
  Expert_l5_gpu0 [label="Expert_l5\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l5_gpu0 -> Expert_l5_gpu0 [style=dashed];
  Expert_l5_gpu1 [label="Expert_l5\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l5_gpu1 -> Expert_l5_gpu1 [style=dashed];
  Expert_l5_gpu2 [label="Expert_l5\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l5_gpu2 -> Expert_l5_gpu2 [style=dashed];
  Expert_l5_gpu3 [label="Expert_l5\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l5_gpu3 -> Expert_l5_gpu3 [style=dashed];
  Expert_l5_gpu4 [label="Expert_l5\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l5_gpu4 -> Expert_l5_gpu4 [style=dashed];
  Expert_l5_gpu5 [label="Expert_l5\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l5_gpu5 -> Expert_l5_gpu5 [style=dashed];
  Expert_l5_gpu6 [label="Expert_l5\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l5_gpu6 -> Expert_l5_gpu6 [style=dashed];
  Expert_l5_gpu7 [label="Expert_l5\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l5_gpu7 -> Expert_l5_gpu7 [style=dashed];
  Expert_l5_gpu8 [label="Expert_l5\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l5_gpu8 -> Expert_l5_gpu8 [style=dashed];
  Expert_l5_gpu9 [label="Expert_l5\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l5_gpu9 -> Expert_l5_gpu9 [style=dashed];
  Expert_l5_gpu10 [label="Expert_l5\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l5_gpu10 -> Expert_l5_gpu10 [style=dashed];
  Expert_l5_gpu11 [label="Expert_l5\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l5_gpu11 -> Expert_l5_gpu11 [style=dashed];
  Expert_l5_gpu12 [label="Expert_l5\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l5_gpu12 -> Expert_l5_gpu12 [style=dashed];
  Expert_l5_gpu13 [label="Expert_l5\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l5_gpu13 -> Expert_l5_gpu13 [style=dashed];
  Expert_l5_gpu14 [label="Expert_l5\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l5_gpu14 -> Expert_l5_gpu14 [style=dashed];
  Expert_l5_gpu15 [label="Expert_l5\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l5_gpu15 -> Expert_l5_gpu15 [style=dashed];
  AR_exp_l5 [shape=ellipse, label="AllReduceExperts\nall16GPUs\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert_l5_gpu0 -> AR_exp_l5;
  Expert_l5_gpu1 -> AR_exp_l5;
  Expert_l5_gpu2 -> AR_exp_l5;
  Expert_l5_gpu3 -> AR_exp_l5;
  Expert_l5_gpu4 -> AR_exp_l5;
  Expert_l5_gpu5 -> AR_exp_l5;
  Expert_l5_gpu6 -> AR_exp_l5;
  Expert_l5_gpu7 -> AR_exp_l5;
  Expert_l5_gpu8 -> AR_exp_l5;
  Expert_l5_gpu9 -> AR_exp_l5;
  Expert_l5_gpu10 -> AR_exp_l5;
  Expert_l5_gpu11 -> AR_exp_l5;
  Expert_l5_gpu12 -> AR_exp_l5;
  Expert_l5_gpu13 -> AR_exp_l5;
  Expert_l5_gpu14 -> AR_exp_l5;
  Expert_l5_gpu15 -> AR_exp_l5;
  ResMOE_l5_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l5 -> ResMOE_l5_gpu0;
  ResAttn_l5_gpu0 -> ResMOE_l5_gpu0;
  ResMOE_l5_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l5 -> ResMOE_l5_gpu1;
  ResAttn_l5_gpu1 -> ResMOE_l5_gpu1;
  ResMOE_l5_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l5 -> ResMOE_l5_gpu2;
  ResAttn_l5_gpu2 -> ResMOE_l5_gpu2;
  ResMOE_l5_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l5 -> ResMOE_l5_gpu3;
  ResAttn_l5_gpu3 -> ResMOE_l5_gpu3;
  ResMOE_l5_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l5 -> ResMOE_l5_gpu4;
  ResAttn_l5_gpu4 -> ResMOE_l5_gpu4;
  ResMOE_l5_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l5 -> ResMOE_l5_gpu5;
  ResAttn_l5_gpu5 -> ResMOE_l5_gpu5;
  ResMOE_l5_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l5 -> ResMOE_l5_gpu6;
  ResAttn_l5_gpu6 -> ResMOE_l5_gpu6;
  ResMOE_l5_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l5 -> ResMOE_l5_gpu7;
  ResAttn_l5_gpu7 -> ResMOE_l5_gpu7;
  ResMOE_l5_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l5 -> ResMOE_l5_gpu8;
  ResAttn_l5_gpu8 -> ResMOE_l5_gpu8;
  ResMOE_l5_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l5 -> ResMOE_l5_gpu9;
  ResAttn_l5_gpu9 -> ResMOE_l5_gpu9;
  ResMOE_l5_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l5 -> ResMOE_l5_gpu10;
  ResAttn_l5_gpu10 -> ResMOE_l5_gpu10;
  ResMOE_l5_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l5 -> ResMOE_l5_gpu11;
  ResAttn_l5_gpu11 -> ResMOE_l5_gpu11;
  ResMOE_l5_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l5 -> ResMOE_l5_gpu12;
  ResAttn_l5_gpu12 -> ResMOE_l5_gpu12;
  ResMOE_l5_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l5 -> ResMOE_l5_gpu13;
  ResAttn_l5_gpu13 -> ResMOE_l5_gpu13;
  ResMOE_l5_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l5 -> ResMOE_l5_gpu14;
  ResAttn_l5_gpu14 -> ResMOE_l5_gpu14;
  ResMOE_l5_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l5 -> ResMOE_l5_gpu15;
  ResAttn_l5_gpu15 -> ResMOE_l5_gpu15;
  QKV_l6_gpu0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l5_gpu0 -> QKV_l6_gpu0;
  QKV_l6_gpu1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l5_gpu0 -> QKV_l6_gpu1;
  QKV_l6_gpu2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l5_gpu0 -> QKV_l6_gpu2;
  QKV_l6_gpu3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l5_gpu0 -> QKV_l6_gpu3;
  QKV_l6_gpu4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l5_gpu0 -> QKV_l6_gpu4;
  QKV_l6_gpu5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l5_gpu0 -> QKV_l6_gpu5;
  QKV_l6_gpu6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l5_gpu0 -> QKV_l6_gpu6;
  QKV_l6_gpu7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l5_gpu0 -> QKV_l6_gpu7;
  QKV_l6_gpu8 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l5_gpu0 -> QKV_l6_gpu8;
  QKV_l6_gpu9 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l5_gpu0 -> QKV_l6_gpu9;
  QKV_l6_gpu10 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l5_gpu0 -> QKV_l6_gpu10;
  QKV_l6_gpu11 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l5_gpu0 -> QKV_l6_gpu11;
  QKV_l6_gpu12 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l5_gpu0 -> QKV_l6_gpu12;
  QKV_l6_gpu13 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l5_gpu0 -> QKV_l6_gpu13;
  QKV_l6_gpu14 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l5_gpu0 -> QKV_l6_gpu14;
  QKV_l6_gpu15 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l5_gpu0 -> QKV_l6_gpu15;
  SplitHeads_l6_gpu0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l6_gpu0 -> SplitHeads_l6_gpu0;
  SplitHeads_l6_gpu1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l6_gpu1 -> SplitHeads_l6_gpu1;
  SplitHeads_l6_gpu2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l6_gpu2 -> SplitHeads_l6_gpu2;
  SplitHeads_l6_gpu3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l6_gpu3 -> SplitHeads_l6_gpu3;
  SplitHeads_l6_gpu4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l6_gpu4 -> SplitHeads_l6_gpu4;
  SplitHeads_l6_gpu5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l6_gpu5 -> SplitHeads_l6_gpu5;
  SplitHeads_l6_gpu6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l6_gpu6 -> SplitHeads_l6_gpu6;
  SplitHeads_l6_gpu7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l6_gpu7 -> SplitHeads_l6_gpu7;
  SplitHeads_l6_gpu8 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l6_gpu8 -> SplitHeads_l6_gpu8;
  SplitHeads_l6_gpu9 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l6_gpu9 -> SplitHeads_l6_gpu9;
  SplitHeads_l6_gpu10 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l6_gpu10 -> SplitHeads_l6_gpu10;
  SplitHeads_l6_gpu11 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l6_gpu11 -> SplitHeads_l6_gpu11;
  SplitHeads_l6_gpu12 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l6_gpu12 -> SplitHeads_l6_gpu12;
  SplitHeads_l6_gpu13 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l6_gpu13 -> SplitHeads_l6_gpu13;
  SplitHeads_l6_gpu14 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l6_gpu14 -> SplitHeads_l6_gpu14;
  SplitHeads_l6_gpu15 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l6_gpu15 -> SplitHeads_l6_gpu15;
  A2A_l6 [shape=ellipse, label="AllToAll\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_l6_gpu0 -> A2A_l6;
  SplitHeads_l6_gpu1 -> A2A_l6;
  SplitHeads_l6_gpu2 -> A2A_l6;
  SplitHeads_l6_gpu3 -> A2A_l6;
  SplitHeads_l6_gpu4 -> A2A_l6;
  SplitHeads_l6_gpu5 -> A2A_l6;
  SplitHeads_l6_gpu6 -> A2A_l6;
  SplitHeads_l6_gpu7 -> A2A_l6;
  SplitHeads_l6_gpu8 -> A2A_l6;
  SplitHeads_l6_gpu9 -> A2A_l6;
  SplitHeads_l6_gpu10 -> A2A_l6;
  SplitHeads_l6_gpu11 -> A2A_l6;
  SplitHeads_l6_gpu12 -> A2A_l6;
  SplitHeads_l6_gpu13 -> A2A_l6;
  SplitHeads_l6_gpu14 -> A2A_l6;
  SplitHeads_l6_gpu15 -> A2A_l6;
  Attn_l6_gpu0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l6 -> Attn_l6_gpu0;
  Attn_l6_gpu1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l6 -> Attn_l6_gpu1;
  Attn_l6_gpu2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l6 -> Attn_l6_gpu2;
  Attn_l6_gpu3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l6 -> Attn_l6_gpu3;
  Attn_l6_gpu4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l6 -> Attn_l6_gpu4;
  Attn_l6_gpu5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l6 -> Attn_l6_gpu5;
  Attn_l6_gpu6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l6 -> Attn_l6_gpu6;
  Attn_l6_gpu7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l6 -> Attn_l6_gpu7;
  Attn_l6_gpu8 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l6 -> Attn_l6_gpu8;
  Attn_l6_gpu9 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l6 -> Attn_l6_gpu9;
  Attn_l6_gpu10 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l6 -> Attn_l6_gpu10;
  Attn_l6_gpu11 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l6 -> Attn_l6_gpu11;
  Attn_l6_gpu12 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l6 -> Attn_l6_gpu12;
  Attn_l6_gpu13 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l6 -> Attn_l6_gpu13;
  Attn_l6_gpu14 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l6 -> Attn_l6_gpu14;
  Attn_l6_gpu15 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l6 -> Attn_l6_gpu15;
  AR_attn_l6 [shape=ellipse, label="AllReduce\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_l6_gpu0 -> AR_attn_l6;
  Attn_l6_gpu1 -> AR_attn_l6;
  Attn_l6_gpu2 -> AR_attn_l6;
  Attn_l6_gpu3 -> AR_attn_l6;
  Attn_l6_gpu4 -> AR_attn_l6;
  Attn_l6_gpu5 -> AR_attn_l6;
  Attn_l6_gpu6 -> AR_attn_l6;
  Attn_l6_gpu7 -> AR_attn_l6;
  Attn_l6_gpu8 -> AR_attn_l6;
  Attn_l6_gpu9 -> AR_attn_l6;
  Attn_l6_gpu10 -> AR_attn_l6;
  Attn_l6_gpu11 -> AR_attn_l6;
  Attn_l6_gpu12 -> AR_attn_l6;
  Attn_l6_gpu13 -> AR_attn_l6;
  Attn_l6_gpu14 -> AR_attn_l6;
  Attn_l6_gpu15 -> AR_attn_l6;
  O_l6_gpu0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l6 -> O_l6_gpu0;
  O_l6_gpu1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l6 -> O_l6_gpu1;
  O_l6_gpu2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l6 -> O_l6_gpu2;
  O_l6_gpu3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l6 -> O_l6_gpu3;
  O_l6_gpu4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l6 -> O_l6_gpu4;
  O_l6_gpu5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l6 -> O_l6_gpu5;
  O_l6_gpu6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l6 -> O_l6_gpu6;
  O_l6_gpu7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l6 -> O_l6_gpu7;
  O_l6_gpu8 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l6 -> O_l6_gpu8;
  O_l6_gpu9 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l6 -> O_l6_gpu9;
  O_l6_gpu10 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l6 -> O_l6_gpu10;
  O_l6_gpu11 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l6 -> O_l6_gpu11;
  O_l6_gpu12 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l6 -> O_l6_gpu12;
  O_l6_gpu13 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l6 -> O_l6_gpu13;
  O_l6_gpu14 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l6 -> O_l6_gpu14;
  O_l6_gpu15 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l6 -> O_l6_gpu15;
  ResAttn_l6_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l6_gpu0 -> ResAttn_l6_gpu0;
  ResMOE_l5_gpu0 -> ResAttn_l6_gpu0;
  ResAttn_l6_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l6_gpu1 -> ResAttn_l6_gpu1;
  ResMOE_l5_gpu0 -> ResAttn_l6_gpu1;
  ResAttn_l6_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l6_gpu2 -> ResAttn_l6_gpu2;
  ResMOE_l5_gpu0 -> ResAttn_l6_gpu2;
  ResAttn_l6_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l6_gpu3 -> ResAttn_l6_gpu3;
  ResMOE_l5_gpu0 -> ResAttn_l6_gpu3;
  ResAttn_l6_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l6_gpu4 -> ResAttn_l6_gpu4;
  ResMOE_l5_gpu0 -> ResAttn_l6_gpu4;
  ResAttn_l6_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l6_gpu5 -> ResAttn_l6_gpu5;
  ResMOE_l5_gpu0 -> ResAttn_l6_gpu5;
  ResAttn_l6_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l6_gpu6 -> ResAttn_l6_gpu6;
  ResMOE_l5_gpu0 -> ResAttn_l6_gpu6;
  ResAttn_l6_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l6_gpu7 -> ResAttn_l6_gpu7;
  ResMOE_l5_gpu0 -> ResAttn_l6_gpu7;
  ResAttn_l6_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l6_gpu8 -> ResAttn_l6_gpu8;
  ResMOE_l5_gpu0 -> ResAttn_l6_gpu8;
  ResAttn_l6_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l6_gpu9 -> ResAttn_l6_gpu9;
  ResMOE_l5_gpu0 -> ResAttn_l6_gpu9;
  ResAttn_l6_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l6_gpu10 -> ResAttn_l6_gpu10;
  ResMOE_l5_gpu0 -> ResAttn_l6_gpu10;
  ResAttn_l6_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l6_gpu11 -> ResAttn_l6_gpu11;
  ResMOE_l5_gpu0 -> ResAttn_l6_gpu11;
  ResAttn_l6_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l6_gpu12 -> ResAttn_l6_gpu12;
  ResMOE_l5_gpu0 -> ResAttn_l6_gpu12;
  ResAttn_l6_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l6_gpu13 -> ResAttn_l6_gpu13;
  ResMOE_l5_gpu0 -> ResAttn_l6_gpu13;
  ResAttn_l6_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l6_gpu14 -> ResAttn_l6_gpu14;
  ResMOE_l5_gpu0 -> ResAttn_l6_gpu14;
  ResAttn_l6_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l6_gpu15 -> ResAttn_l6_gpu15;
  ResMOE_l5_gpu0 -> ResAttn_l6_gpu15;
  Gate_l6_gpu0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l6_gpu0 -> Gate_l6_gpu0;
  Gate_l6_gpu1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l6_gpu1 -> Gate_l6_gpu1;
  Gate_l6_gpu2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l6_gpu2 -> Gate_l6_gpu2;
  Gate_l6_gpu3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l6_gpu3 -> Gate_l6_gpu3;
  Gate_l6_gpu4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l6_gpu4 -> Gate_l6_gpu4;
  Gate_l6_gpu5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l6_gpu5 -> Gate_l6_gpu5;
  Gate_l6_gpu6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l6_gpu6 -> Gate_l6_gpu6;
  Gate_l6_gpu7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l6_gpu7 -> Gate_l6_gpu7;
  Gate_l6_gpu8 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l6_gpu8 -> Gate_l6_gpu8;
  Gate_l6_gpu9 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l6_gpu9 -> Gate_l6_gpu9;
  Gate_l6_gpu10 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l6_gpu10 -> Gate_l6_gpu10;
  Gate_l6_gpu11 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l6_gpu11 -> Gate_l6_gpu11;
  Gate_l6_gpu12 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l6_gpu12 -> Gate_l6_gpu12;
  Gate_l6_gpu13 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l6_gpu13 -> Gate_l6_gpu13;
  Gate_l6_gpu14 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l6_gpu14 -> Gate_l6_gpu14;
  Gate_l6_gpu15 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l6_gpu15 -> Gate_l6_gpu15;
  Expert_l6_gpu0 [label="Expert_l6\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l6_gpu0 -> Expert_l6_gpu0 [style=dashed];
  Expert_l6_gpu1 [label="Expert_l6\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l6_gpu1 -> Expert_l6_gpu1 [style=dashed];
  Expert_l6_gpu2 [label="Expert_l6\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l6_gpu2 -> Expert_l6_gpu2 [style=dashed];
  Expert_l6_gpu3 [label="Expert_l6\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l6_gpu3 -> Expert_l6_gpu3 [style=dashed];
  Expert_l6_gpu4 [label="Expert_l6\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l6_gpu4 -> Expert_l6_gpu4 [style=dashed];
  Expert_l6_gpu5 [label="Expert_l6\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l6_gpu5 -> Expert_l6_gpu5 [style=dashed];
  Expert_l6_gpu6 [label="Expert_l6\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l6_gpu6 -> Expert_l6_gpu6 [style=dashed];
  Expert_l6_gpu7 [label="Expert_l6\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l6_gpu7 -> Expert_l6_gpu7 [style=dashed];
  Expert_l6_gpu8 [label="Expert_l6\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l6_gpu8 -> Expert_l6_gpu8 [style=dashed];
  Expert_l6_gpu9 [label="Expert_l6\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l6_gpu9 -> Expert_l6_gpu9 [style=dashed];
  Expert_l6_gpu10 [label="Expert_l6\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l6_gpu10 -> Expert_l6_gpu10 [style=dashed];
  Expert_l6_gpu11 [label="Expert_l6\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l6_gpu11 -> Expert_l6_gpu11 [style=dashed];
  Expert_l6_gpu12 [label="Expert_l6\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l6_gpu12 -> Expert_l6_gpu12 [style=dashed];
  Expert_l6_gpu13 [label="Expert_l6\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l6_gpu13 -> Expert_l6_gpu13 [style=dashed];
  Expert_l6_gpu14 [label="Expert_l6\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l6_gpu14 -> Expert_l6_gpu14 [style=dashed];
  Expert_l6_gpu15 [label="Expert_l6\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l6_gpu15 -> Expert_l6_gpu15 [style=dashed];
  AR_exp_l6 [shape=ellipse, label="AllReduceExperts\nall16GPUs\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert_l6_gpu0 -> AR_exp_l6;
  Expert_l6_gpu1 -> AR_exp_l6;
  Expert_l6_gpu2 -> AR_exp_l6;
  Expert_l6_gpu3 -> AR_exp_l6;
  Expert_l6_gpu4 -> AR_exp_l6;
  Expert_l6_gpu5 -> AR_exp_l6;
  Expert_l6_gpu6 -> AR_exp_l6;
  Expert_l6_gpu7 -> AR_exp_l6;
  Expert_l6_gpu8 -> AR_exp_l6;
  Expert_l6_gpu9 -> AR_exp_l6;
  Expert_l6_gpu10 -> AR_exp_l6;
  Expert_l6_gpu11 -> AR_exp_l6;
  Expert_l6_gpu12 -> AR_exp_l6;
  Expert_l6_gpu13 -> AR_exp_l6;
  Expert_l6_gpu14 -> AR_exp_l6;
  Expert_l6_gpu15 -> AR_exp_l6;
  ResMOE_l6_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l6 -> ResMOE_l6_gpu0;
  ResAttn_l6_gpu0 -> ResMOE_l6_gpu0;
  ResMOE_l6_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l6 -> ResMOE_l6_gpu1;
  ResAttn_l6_gpu1 -> ResMOE_l6_gpu1;
  ResMOE_l6_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l6 -> ResMOE_l6_gpu2;
  ResAttn_l6_gpu2 -> ResMOE_l6_gpu2;
  ResMOE_l6_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l6 -> ResMOE_l6_gpu3;
  ResAttn_l6_gpu3 -> ResMOE_l6_gpu3;
  ResMOE_l6_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l6 -> ResMOE_l6_gpu4;
  ResAttn_l6_gpu4 -> ResMOE_l6_gpu4;
  ResMOE_l6_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l6 -> ResMOE_l6_gpu5;
  ResAttn_l6_gpu5 -> ResMOE_l6_gpu5;
  ResMOE_l6_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l6 -> ResMOE_l6_gpu6;
  ResAttn_l6_gpu6 -> ResMOE_l6_gpu6;
  ResMOE_l6_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l6 -> ResMOE_l6_gpu7;
  ResAttn_l6_gpu7 -> ResMOE_l6_gpu7;
  ResMOE_l6_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l6 -> ResMOE_l6_gpu8;
  ResAttn_l6_gpu8 -> ResMOE_l6_gpu8;
  ResMOE_l6_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l6 -> ResMOE_l6_gpu9;
  ResAttn_l6_gpu9 -> ResMOE_l6_gpu9;
  ResMOE_l6_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l6 -> ResMOE_l6_gpu10;
  ResAttn_l6_gpu10 -> ResMOE_l6_gpu10;
  ResMOE_l6_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l6 -> ResMOE_l6_gpu11;
  ResAttn_l6_gpu11 -> ResMOE_l6_gpu11;
  ResMOE_l6_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l6 -> ResMOE_l6_gpu12;
  ResAttn_l6_gpu12 -> ResMOE_l6_gpu12;
  ResMOE_l6_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l6 -> ResMOE_l6_gpu13;
  ResAttn_l6_gpu13 -> ResMOE_l6_gpu13;
  ResMOE_l6_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l6 -> ResMOE_l6_gpu14;
  ResAttn_l6_gpu14 -> ResMOE_l6_gpu14;
  ResMOE_l6_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l6 -> ResMOE_l6_gpu15;
  ResAttn_l6_gpu15 -> ResMOE_l6_gpu15;
  QKV_l7_gpu0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l6_gpu0 -> QKV_l7_gpu0;
  QKV_l7_gpu1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l6_gpu0 -> QKV_l7_gpu1;
  QKV_l7_gpu2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l6_gpu0 -> QKV_l7_gpu2;
  QKV_l7_gpu3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l6_gpu0 -> QKV_l7_gpu3;
  QKV_l7_gpu4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l6_gpu0 -> QKV_l7_gpu4;
  QKV_l7_gpu5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l6_gpu0 -> QKV_l7_gpu5;
  QKV_l7_gpu6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l6_gpu0 -> QKV_l7_gpu6;
  QKV_l7_gpu7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l6_gpu0 -> QKV_l7_gpu7;
  QKV_l7_gpu8 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l6_gpu0 -> QKV_l7_gpu8;
  QKV_l7_gpu9 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l6_gpu0 -> QKV_l7_gpu9;
  QKV_l7_gpu10 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l6_gpu0 -> QKV_l7_gpu10;
  QKV_l7_gpu11 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l6_gpu0 -> QKV_l7_gpu11;
  QKV_l7_gpu12 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l6_gpu0 -> QKV_l7_gpu12;
  QKV_l7_gpu13 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l6_gpu0 -> QKV_l7_gpu13;
  QKV_l7_gpu14 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l6_gpu0 -> QKV_l7_gpu14;
  QKV_l7_gpu15 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l6_gpu0 -> QKV_l7_gpu15;
  SplitHeads_l7_gpu0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l7_gpu0 -> SplitHeads_l7_gpu0;
  SplitHeads_l7_gpu1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l7_gpu1 -> SplitHeads_l7_gpu1;
  SplitHeads_l7_gpu2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l7_gpu2 -> SplitHeads_l7_gpu2;
  SplitHeads_l7_gpu3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l7_gpu3 -> SplitHeads_l7_gpu3;
  SplitHeads_l7_gpu4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l7_gpu4 -> SplitHeads_l7_gpu4;
  SplitHeads_l7_gpu5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l7_gpu5 -> SplitHeads_l7_gpu5;
  SplitHeads_l7_gpu6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l7_gpu6 -> SplitHeads_l7_gpu6;
  SplitHeads_l7_gpu7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l7_gpu7 -> SplitHeads_l7_gpu7;
  SplitHeads_l7_gpu8 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l7_gpu8 -> SplitHeads_l7_gpu8;
  SplitHeads_l7_gpu9 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l7_gpu9 -> SplitHeads_l7_gpu9;
  SplitHeads_l7_gpu10 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l7_gpu10 -> SplitHeads_l7_gpu10;
  SplitHeads_l7_gpu11 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l7_gpu11 -> SplitHeads_l7_gpu11;
  SplitHeads_l7_gpu12 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l7_gpu12 -> SplitHeads_l7_gpu12;
  SplitHeads_l7_gpu13 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l7_gpu13 -> SplitHeads_l7_gpu13;
  SplitHeads_l7_gpu14 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l7_gpu14 -> SplitHeads_l7_gpu14;
  SplitHeads_l7_gpu15 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l7_gpu15 -> SplitHeads_l7_gpu15;
  A2A_l7 [shape=ellipse, label="AllToAll\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_l7_gpu0 -> A2A_l7;
  SplitHeads_l7_gpu1 -> A2A_l7;
  SplitHeads_l7_gpu2 -> A2A_l7;
  SplitHeads_l7_gpu3 -> A2A_l7;
  SplitHeads_l7_gpu4 -> A2A_l7;
  SplitHeads_l7_gpu5 -> A2A_l7;
  SplitHeads_l7_gpu6 -> A2A_l7;
  SplitHeads_l7_gpu7 -> A2A_l7;
  SplitHeads_l7_gpu8 -> A2A_l7;
  SplitHeads_l7_gpu9 -> A2A_l7;
  SplitHeads_l7_gpu10 -> A2A_l7;
  SplitHeads_l7_gpu11 -> A2A_l7;
  SplitHeads_l7_gpu12 -> A2A_l7;
  SplitHeads_l7_gpu13 -> A2A_l7;
  SplitHeads_l7_gpu14 -> A2A_l7;
  SplitHeads_l7_gpu15 -> A2A_l7;
  Attn_l7_gpu0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l7 -> Attn_l7_gpu0;
  Attn_l7_gpu1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l7 -> Attn_l7_gpu1;
  Attn_l7_gpu2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l7 -> Attn_l7_gpu2;
  Attn_l7_gpu3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l7 -> Attn_l7_gpu3;
  Attn_l7_gpu4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l7 -> Attn_l7_gpu4;
  Attn_l7_gpu5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l7 -> Attn_l7_gpu5;
  Attn_l7_gpu6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l7 -> Attn_l7_gpu6;
  Attn_l7_gpu7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l7 -> Attn_l7_gpu7;
  Attn_l7_gpu8 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l7 -> Attn_l7_gpu8;
  Attn_l7_gpu9 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l7 -> Attn_l7_gpu9;
  Attn_l7_gpu10 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l7 -> Attn_l7_gpu10;
  Attn_l7_gpu11 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l7 -> Attn_l7_gpu11;
  Attn_l7_gpu12 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l7 -> Attn_l7_gpu12;
  Attn_l7_gpu13 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l7 -> Attn_l7_gpu13;
  Attn_l7_gpu14 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l7 -> Attn_l7_gpu14;
  Attn_l7_gpu15 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l7 -> Attn_l7_gpu15;
  AR_attn_l7 [shape=ellipse, label="AllReduce\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_l7_gpu0 -> AR_attn_l7;
  Attn_l7_gpu1 -> AR_attn_l7;
  Attn_l7_gpu2 -> AR_attn_l7;
  Attn_l7_gpu3 -> AR_attn_l7;
  Attn_l7_gpu4 -> AR_attn_l7;
  Attn_l7_gpu5 -> AR_attn_l7;
  Attn_l7_gpu6 -> AR_attn_l7;
  Attn_l7_gpu7 -> AR_attn_l7;
  Attn_l7_gpu8 -> AR_attn_l7;
  Attn_l7_gpu9 -> AR_attn_l7;
  Attn_l7_gpu10 -> AR_attn_l7;
  Attn_l7_gpu11 -> AR_attn_l7;
  Attn_l7_gpu12 -> AR_attn_l7;
  Attn_l7_gpu13 -> AR_attn_l7;
  Attn_l7_gpu14 -> AR_attn_l7;
  Attn_l7_gpu15 -> AR_attn_l7;
  O_l7_gpu0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l7 -> O_l7_gpu0;
  O_l7_gpu1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l7 -> O_l7_gpu1;
  O_l7_gpu2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l7 -> O_l7_gpu2;
  O_l7_gpu3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l7 -> O_l7_gpu3;
  O_l7_gpu4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l7 -> O_l7_gpu4;
  O_l7_gpu5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l7 -> O_l7_gpu5;
  O_l7_gpu6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l7 -> O_l7_gpu6;
  O_l7_gpu7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l7 -> O_l7_gpu7;
  O_l7_gpu8 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l7 -> O_l7_gpu8;
  O_l7_gpu9 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l7 -> O_l7_gpu9;
  O_l7_gpu10 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l7 -> O_l7_gpu10;
  O_l7_gpu11 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l7 -> O_l7_gpu11;
  O_l7_gpu12 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l7 -> O_l7_gpu12;
  O_l7_gpu13 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l7 -> O_l7_gpu13;
  O_l7_gpu14 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l7 -> O_l7_gpu14;
  O_l7_gpu15 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l7 -> O_l7_gpu15;
  ResAttn_l7_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l7_gpu0 -> ResAttn_l7_gpu0;
  ResMOE_l6_gpu0 -> ResAttn_l7_gpu0;
  ResAttn_l7_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l7_gpu1 -> ResAttn_l7_gpu1;
  ResMOE_l6_gpu0 -> ResAttn_l7_gpu1;
  ResAttn_l7_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l7_gpu2 -> ResAttn_l7_gpu2;
  ResMOE_l6_gpu0 -> ResAttn_l7_gpu2;
  ResAttn_l7_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l7_gpu3 -> ResAttn_l7_gpu3;
  ResMOE_l6_gpu0 -> ResAttn_l7_gpu3;
  ResAttn_l7_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l7_gpu4 -> ResAttn_l7_gpu4;
  ResMOE_l6_gpu0 -> ResAttn_l7_gpu4;
  ResAttn_l7_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l7_gpu5 -> ResAttn_l7_gpu5;
  ResMOE_l6_gpu0 -> ResAttn_l7_gpu5;
  ResAttn_l7_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l7_gpu6 -> ResAttn_l7_gpu6;
  ResMOE_l6_gpu0 -> ResAttn_l7_gpu6;
  ResAttn_l7_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l7_gpu7 -> ResAttn_l7_gpu7;
  ResMOE_l6_gpu0 -> ResAttn_l7_gpu7;
  ResAttn_l7_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l7_gpu8 -> ResAttn_l7_gpu8;
  ResMOE_l6_gpu0 -> ResAttn_l7_gpu8;
  ResAttn_l7_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l7_gpu9 -> ResAttn_l7_gpu9;
  ResMOE_l6_gpu0 -> ResAttn_l7_gpu9;
  ResAttn_l7_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l7_gpu10 -> ResAttn_l7_gpu10;
  ResMOE_l6_gpu0 -> ResAttn_l7_gpu10;
  ResAttn_l7_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l7_gpu11 -> ResAttn_l7_gpu11;
  ResMOE_l6_gpu0 -> ResAttn_l7_gpu11;
  ResAttn_l7_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l7_gpu12 -> ResAttn_l7_gpu12;
  ResMOE_l6_gpu0 -> ResAttn_l7_gpu12;
  ResAttn_l7_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l7_gpu13 -> ResAttn_l7_gpu13;
  ResMOE_l6_gpu0 -> ResAttn_l7_gpu13;
  ResAttn_l7_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l7_gpu14 -> ResAttn_l7_gpu14;
  ResMOE_l6_gpu0 -> ResAttn_l7_gpu14;
  ResAttn_l7_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l7_gpu15 -> ResAttn_l7_gpu15;
  ResMOE_l6_gpu0 -> ResAttn_l7_gpu15;
  Gate_l7_gpu0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l7_gpu0 -> Gate_l7_gpu0;
  Gate_l7_gpu1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l7_gpu1 -> Gate_l7_gpu1;
  Gate_l7_gpu2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l7_gpu2 -> Gate_l7_gpu2;
  Gate_l7_gpu3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l7_gpu3 -> Gate_l7_gpu3;
  Gate_l7_gpu4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l7_gpu4 -> Gate_l7_gpu4;
  Gate_l7_gpu5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l7_gpu5 -> Gate_l7_gpu5;
  Gate_l7_gpu6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l7_gpu6 -> Gate_l7_gpu6;
  Gate_l7_gpu7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l7_gpu7 -> Gate_l7_gpu7;
  Gate_l7_gpu8 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l7_gpu8 -> Gate_l7_gpu8;
  Gate_l7_gpu9 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l7_gpu9 -> Gate_l7_gpu9;
  Gate_l7_gpu10 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l7_gpu10 -> Gate_l7_gpu10;
  Gate_l7_gpu11 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l7_gpu11 -> Gate_l7_gpu11;
  Gate_l7_gpu12 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l7_gpu12 -> Gate_l7_gpu12;
  Gate_l7_gpu13 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l7_gpu13 -> Gate_l7_gpu13;
  Gate_l7_gpu14 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l7_gpu14 -> Gate_l7_gpu14;
  Gate_l7_gpu15 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l7_gpu15 -> Gate_l7_gpu15;
  Expert_l7_gpu0 [label="Expert_l7\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l7_gpu0 -> Expert_l7_gpu0 [style=dashed];
  Expert_l7_gpu1 [label="Expert_l7\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l7_gpu1 -> Expert_l7_gpu1 [style=dashed];
  Expert_l7_gpu2 [label="Expert_l7\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l7_gpu2 -> Expert_l7_gpu2 [style=dashed];
  Expert_l7_gpu3 [label="Expert_l7\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l7_gpu3 -> Expert_l7_gpu3 [style=dashed];
  Expert_l7_gpu4 [label="Expert_l7\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l7_gpu4 -> Expert_l7_gpu4 [style=dashed];
  Expert_l7_gpu5 [label="Expert_l7\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l7_gpu5 -> Expert_l7_gpu5 [style=dashed];
  Expert_l7_gpu6 [label="Expert_l7\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l7_gpu6 -> Expert_l7_gpu6 [style=dashed];
  Expert_l7_gpu7 [label="Expert_l7\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l7_gpu7 -> Expert_l7_gpu7 [style=dashed];
  Expert_l7_gpu8 [label="Expert_l7\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l7_gpu8 -> Expert_l7_gpu8 [style=dashed];
  Expert_l7_gpu9 [label="Expert_l7\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l7_gpu9 -> Expert_l7_gpu9 [style=dashed];
  Expert_l7_gpu10 [label="Expert_l7\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l7_gpu10 -> Expert_l7_gpu10 [style=dashed];
  Expert_l7_gpu11 [label="Expert_l7\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l7_gpu11 -> Expert_l7_gpu11 [style=dashed];
  Expert_l7_gpu12 [label="Expert_l7\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l7_gpu12 -> Expert_l7_gpu12 [style=dashed];
  Expert_l7_gpu13 [label="Expert_l7\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l7_gpu13 -> Expert_l7_gpu13 [style=dashed];
  Expert_l7_gpu14 [label="Expert_l7\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l7_gpu14 -> Expert_l7_gpu14 [style=dashed];
  Expert_l7_gpu15 [label="Expert_l7\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l7_gpu15 -> Expert_l7_gpu15 [style=dashed];
  AR_exp_l7 [shape=ellipse, label="AllReduceExperts\nall16GPUs\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert_l7_gpu0 -> AR_exp_l7;
  Expert_l7_gpu1 -> AR_exp_l7;
  Expert_l7_gpu2 -> AR_exp_l7;
  Expert_l7_gpu3 -> AR_exp_l7;
  Expert_l7_gpu4 -> AR_exp_l7;
  Expert_l7_gpu5 -> AR_exp_l7;
  Expert_l7_gpu6 -> AR_exp_l7;
  Expert_l7_gpu7 -> AR_exp_l7;
  Expert_l7_gpu8 -> AR_exp_l7;
  Expert_l7_gpu9 -> AR_exp_l7;
  Expert_l7_gpu10 -> AR_exp_l7;
  Expert_l7_gpu11 -> AR_exp_l7;
  Expert_l7_gpu12 -> AR_exp_l7;
  Expert_l7_gpu13 -> AR_exp_l7;
  Expert_l7_gpu14 -> AR_exp_l7;
  Expert_l7_gpu15 -> AR_exp_l7;
  ResMOE_l7_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l7 -> ResMOE_l7_gpu0;
  ResAttn_l7_gpu0 -> ResMOE_l7_gpu0;
  ResMOE_l7_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l7 -> ResMOE_l7_gpu1;
  ResAttn_l7_gpu1 -> ResMOE_l7_gpu1;
  ResMOE_l7_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l7 -> ResMOE_l7_gpu2;
  ResAttn_l7_gpu2 -> ResMOE_l7_gpu2;
  ResMOE_l7_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l7 -> ResMOE_l7_gpu3;
  ResAttn_l7_gpu3 -> ResMOE_l7_gpu3;
  ResMOE_l7_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l7 -> ResMOE_l7_gpu4;
  ResAttn_l7_gpu4 -> ResMOE_l7_gpu4;
  ResMOE_l7_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l7 -> ResMOE_l7_gpu5;
  ResAttn_l7_gpu5 -> ResMOE_l7_gpu5;
  ResMOE_l7_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l7 -> ResMOE_l7_gpu6;
  ResAttn_l7_gpu6 -> ResMOE_l7_gpu6;
  ResMOE_l7_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l7 -> ResMOE_l7_gpu7;
  ResAttn_l7_gpu7 -> ResMOE_l7_gpu7;
  ResMOE_l7_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l7 -> ResMOE_l7_gpu8;
  ResAttn_l7_gpu8 -> ResMOE_l7_gpu8;
  ResMOE_l7_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l7 -> ResMOE_l7_gpu9;
  ResAttn_l7_gpu9 -> ResMOE_l7_gpu9;
  ResMOE_l7_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l7 -> ResMOE_l7_gpu10;
  ResAttn_l7_gpu10 -> ResMOE_l7_gpu10;
  ResMOE_l7_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l7 -> ResMOE_l7_gpu11;
  ResAttn_l7_gpu11 -> ResMOE_l7_gpu11;
  ResMOE_l7_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l7 -> ResMOE_l7_gpu12;
  ResAttn_l7_gpu12 -> ResMOE_l7_gpu12;
  ResMOE_l7_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l7 -> ResMOE_l7_gpu13;
  ResAttn_l7_gpu13 -> ResMOE_l7_gpu13;
  ResMOE_l7_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l7 -> ResMOE_l7_gpu14;
  ResAttn_l7_gpu14 -> ResMOE_l7_gpu14;
  ResMOE_l7_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l7 -> ResMOE_l7_gpu15;
  ResAttn_l7_gpu15 -> ResMOE_l7_gpu15;
  QKV_l8_gpu0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l7_gpu0 -> QKV_l8_gpu0;
  QKV_l8_gpu1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l7_gpu0 -> QKV_l8_gpu1;
  QKV_l8_gpu2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l7_gpu0 -> QKV_l8_gpu2;
  QKV_l8_gpu3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l7_gpu0 -> QKV_l8_gpu3;
  QKV_l8_gpu4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l7_gpu0 -> QKV_l8_gpu4;
  QKV_l8_gpu5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l7_gpu0 -> QKV_l8_gpu5;
  QKV_l8_gpu6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l7_gpu0 -> QKV_l8_gpu6;
  QKV_l8_gpu7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l7_gpu0 -> QKV_l8_gpu7;
  QKV_l8_gpu8 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l7_gpu0 -> QKV_l8_gpu8;
  QKV_l8_gpu9 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l7_gpu0 -> QKV_l8_gpu9;
  QKV_l8_gpu10 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l7_gpu0 -> QKV_l8_gpu10;
  QKV_l8_gpu11 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l7_gpu0 -> QKV_l8_gpu11;
  QKV_l8_gpu12 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l7_gpu0 -> QKV_l8_gpu12;
  QKV_l8_gpu13 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l7_gpu0 -> QKV_l8_gpu13;
  QKV_l8_gpu14 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l7_gpu0 -> QKV_l8_gpu14;
  QKV_l8_gpu15 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l7_gpu0 -> QKV_l8_gpu15;
  SplitHeads_l8_gpu0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l8_gpu0 -> SplitHeads_l8_gpu0;
  SplitHeads_l8_gpu1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l8_gpu1 -> SplitHeads_l8_gpu1;
  SplitHeads_l8_gpu2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l8_gpu2 -> SplitHeads_l8_gpu2;
  SplitHeads_l8_gpu3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l8_gpu3 -> SplitHeads_l8_gpu3;
  SplitHeads_l8_gpu4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l8_gpu4 -> SplitHeads_l8_gpu4;
  SplitHeads_l8_gpu5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l8_gpu5 -> SplitHeads_l8_gpu5;
  SplitHeads_l8_gpu6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l8_gpu6 -> SplitHeads_l8_gpu6;
  SplitHeads_l8_gpu7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l8_gpu7 -> SplitHeads_l8_gpu7;
  SplitHeads_l8_gpu8 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l8_gpu8 -> SplitHeads_l8_gpu8;
  SplitHeads_l8_gpu9 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l8_gpu9 -> SplitHeads_l8_gpu9;
  SplitHeads_l8_gpu10 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l8_gpu10 -> SplitHeads_l8_gpu10;
  SplitHeads_l8_gpu11 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l8_gpu11 -> SplitHeads_l8_gpu11;
  SplitHeads_l8_gpu12 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l8_gpu12 -> SplitHeads_l8_gpu12;
  SplitHeads_l8_gpu13 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l8_gpu13 -> SplitHeads_l8_gpu13;
  SplitHeads_l8_gpu14 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l8_gpu14 -> SplitHeads_l8_gpu14;
  SplitHeads_l8_gpu15 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l8_gpu15 -> SplitHeads_l8_gpu15;
  A2A_l8 [shape=ellipse, label="AllToAll\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_l8_gpu0 -> A2A_l8;
  SplitHeads_l8_gpu1 -> A2A_l8;
  SplitHeads_l8_gpu2 -> A2A_l8;
  SplitHeads_l8_gpu3 -> A2A_l8;
  SplitHeads_l8_gpu4 -> A2A_l8;
  SplitHeads_l8_gpu5 -> A2A_l8;
  SplitHeads_l8_gpu6 -> A2A_l8;
  SplitHeads_l8_gpu7 -> A2A_l8;
  SplitHeads_l8_gpu8 -> A2A_l8;
  SplitHeads_l8_gpu9 -> A2A_l8;
  SplitHeads_l8_gpu10 -> A2A_l8;
  SplitHeads_l8_gpu11 -> A2A_l8;
  SplitHeads_l8_gpu12 -> A2A_l8;
  SplitHeads_l8_gpu13 -> A2A_l8;
  SplitHeads_l8_gpu14 -> A2A_l8;
  SplitHeads_l8_gpu15 -> A2A_l8;
  Attn_l8_gpu0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l8 -> Attn_l8_gpu0;
  Attn_l8_gpu1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l8 -> Attn_l8_gpu1;
  Attn_l8_gpu2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l8 -> Attn_l8_gpu2;
  Attn_l8_gpu3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l8 -> Attn_l8_gpu3;
  Attn_l8_gpu4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l8 -> Attn_l8_gpu4;
  Attn_l8_gpu5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l8 -> Attn_l8_gpu5;
  Attn_l8_gpu6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l8 -> Attn_l8_gpu6;
  Attn_l8_gpu7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l8 -> Attn_l8_gpu7;
  Attn_l8_gpu8 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l8 -> Attn_l8_gpu8;
  Attn_l8_gpu9 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l8 -> Attn_l8_gpu9;
  Attn_l8_gpu10 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l8 -> Attn_l8_gpu10;
  Attn_l8_gpu11 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l8 -> Attn_l8_gpu11;
  Attn_l8_gpu12 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l8 -> Attn_l8_gpu12;
  Attn_l8_gpu13 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l8 -> Attn_l8_gpu13;
  Attn_l8_gpu14 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l8 -> Attn_l8_gpu14;
  Attn_l8_gpu15 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l8 -> Attn_l8_gpu15;
  AR_attn_l8 [shape=ellipse, label="AllReduce\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_l8_gpu0 -> AR_attn_l8;
  Attn_l8_gpu1 -> AR_attn_l8;
  Attn_l8_gpu2 -> AR_attn_l8;
  Attn_l8_gpu3 -> AR_attn_l8;
  Attn_l8_gpu4 -> AR_attn_l8;
  Attn_l8_gpu5 -> AR_attn_l8;
  Attn_l8_gpu6 -> AR_attn_l8;
  Attn_l8_gpu7 -> AR_attn_l8;
  Attn_l8_gpu8 -> AR_attn_l8;
  Attn_l8_gpu9 -> AR_attn_l8;
  Attn_l8_gpu10 -> AR_attn_l8;
  Attn_l8_gpu11 -> AR_attn_l8;
  Attn_l8_gpu12 -> AR_attn_l8;
  Attn_l8_gpu13 -> AR_attn_l8;
  Attn_l8_gpu14 -> AR_attn_l8;
  Attn_l8_gpu15 -> AR_attn_l8;
  O_l8_gpu0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l8 -> O_l8_gpu0;
  O_l8_gpu1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l8 -> O_l8_gpu1;
  O_l8_gpu2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l8 -> O_l8_gpu2;
  O_l8_gpu3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l8 -> O_l8_gpu3;
  O_l8_gpu4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l8 -> O_l8_gpu4;
  O_l8_gpu5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l8 -> O_l8_gpu5;
  O_l8_gpu6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l8 -> O_l8_gpu6;
  O_l8_gpu7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l8 -> O_l8_gpu7;
  O_l8_gpu8 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l8 -> O_l8_gpu8;
  O_l8_gpu9 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l8 -> O_l8_gpu9;
  O_l8_gpu10 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l8 -> O_l8_gpu10;
  O_l8_gpu11 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l8 -> O_l8_gpu11;
  O_l8_gpu12 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l8 -> O_l8_gpu12;
  O_l8_gpu13 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l8 -> O_l8_gpu13;
  O_l8_gpu14 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l8 -> O_l8_gpu14;
  O_l8_gpu15 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l8 -> O_l8_gpu15;
  ResAttn_l8_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l8_gpu0 -> ResAttn_l8_gpu0;
  ResMOE_l7_gpu0 -> ResAttn_l8_gpu0;
  ResAttn_l8_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l8_gpu1 -> ResAttn_l8_gpu1;
  ResMOE_l7_gpu0 -> ResAttn_l8_gpu1;
  ResAttn_l8_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l8_gpu2 -> ResAttn_l8_gpu2;
  ResMOE_l7_gpu0 -> ResAttn_l8_gpu2;
  ResAttn_l8_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l8_gpu3 -> ResAttn_l8_gpu3;
  ResMOE_l7_gpu0 -> ResAttn_l8_gpu3;
  ResAttn_l8_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l8_gpu4 -> ResAttn_l8_gpu4;
  ResMOE_l7_gpu0 -> ResAttn_l8_gpu4;
  ResAttn_l8_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l8_gpu5 -> ResAttn_l8_gpu5;
  ResMOE_l7_gpu0 -> ResAttn_l8_gpu5;
  ResAttn_l8_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l8_gpu6 -> ResAttn_l8_gpu6;
  ResMOE_l7_gpu0 -> ResAttn_l8_gpu6;
  ResAttn_l8_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l8_gpu7 -> ResAttn_l8_gpu7;
  ResMOE_l7_gpu0 -> ResAttn_l8_gpu7;
  ResAttn_l8_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l8_gpu8 -> ResAttn_l8_gpu8;
  ResMOE_l7_gpu0 -> ResAttn_l8_gpu8;
  ResAttn_l8_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l8_gpu9 -> ResAttn_l8_gpu9;
  ResMOE_l7_gpu0 -> ResAttn_l8_gpu9;
  ResAttn_l8_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l8_gpu10 -> ResAttn_l8_gpu10;
  ResMOE_l7_gpu0 -> ResAttn_l8_gpu10;
  ResAttn_l8_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l8_gpu11 -> ResAttn_l8_gpu11;
  ResMOE_l7_gpu0 -> ResAttn_l8_gpu11;
  ResAttn_l8_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l8_gpu12 -> ResAttn_l8_gpu12;
  ResMOE_l7_gpu0 -> ResAttn_l8_gpu12;
  ResAttn_l8_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l8_gpu13 -> ResAttn_l8_gpu13;
  ResMOE_l7_gpu0 -> ResAttn_l8_gpu13;
  ResAttn_l8_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l8_gpu14 -> ResAttn_l8_gpu14;
  ResMOE_l7_gpu0 -> ResAttn_l8_gpu14;
  ResAttn_l8_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l8_gpu15 -> ResAttn_l8_gpu15;
  ResMOE_l7_gpu0 -> ResAttn_l8_gpu15;
  Gate_l8_gpu0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l8_gpu0 -> Gate_l8_gpu0;
  Gate_l8_gpu1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l8_gpu1 -> Gate_l8_gpu1;
  Gate_l8_gpu2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l8_gpu2 -> Gate_l8_gpu2;
  Gate_l8_gpu3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l8_gpu3 -> Gate_l8_gpu3;
  Gate_l8_gpu4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l8_gpu4 -> Gate_l8_gpu4;
  Gate_l8_gpu5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l8_gpu5 -> Gate_l8_gpu5;
  Gate_l8_gpu6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l8_gpu6 -> Gate_l8_gpu6;
  Gate_l8_gpu7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l8_gpu7 -> Gate_l8_gpu7;
  Gate_l8_gpu8 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l8_gpu8 -> Gate_l8_gpu8;
  Gate_l8_gpu9 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l8_gpu9 -> Gate_l8_gpu9;
  Gate_l8_gpu10 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l8_gpu10 -> Gate_l8_gpu10;
  Gate_l8_gpu11 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l8_gpu11 -> Gate_l8_gpu11;
  Gate_l8_gpu12 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l8_gpu12 -> Gate_l8_gpu12;
  Gate_l8_gpu13 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l8_gpu13 -> Gate_l8_gpu13;
  Gate_l8_gpu14 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l8_gpu14 -> Gate_l8_gpu14;
  Gate_l8_gpu15 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l8_gpu15 -> Gate_l8_gpu15;
  Expert_l8_gpu0 [label="Expert_l8\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l8_gpu0 -> Expert_l8_gpu0 [style=dashed];
  Expert_l8_gpu1 [label="Expert_l8\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l8_gpu1 -> Expert_l8_gpu1 [style=dashed];
  Expert_l8_gpu2 [label="Expert_l8\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l8_gpu2 -> Expert_l8_gpu2 [style=dashed];
  Expert_l8_gpu3 [label="Expert_l8\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l8_gpu3 -> Expert_l8_gpu3 [style=dashed];
  Expert_l8_gpu4 [label="Expert_l8\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l8_gpu4 -> Expert_l8_gpu4 [style=dashed];
  Expert_l8_gpu5 [label="Expert_l8\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l8_gpu5 -> Expert_l8_gpu5 [style=dashed];
  Expert_l8_gpu6 [label="Expert_l8\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l8_gpu6 -> Expert_l8_gpu6 [style=dashed];
  Expert_l8_gpu7 [label="Expert_l8\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l8_gpu7 -> Expert_l8_gpu7 [style=dashed];
  Expert_l8_gpu8 [label="Expert_l8\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l8_gpu8 -> Expert_l8_gpu8 [style=dashed];
  Expert_l8_gpu9 [label="Expert_l8\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l8_gpu9 -> Expert_l8_gpu9 [style=dashed];
  Expert_l8_gpu10 [label="Expert_l8\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l8_gpu10 -> Expert_l8_gpu10 [style=dashed];
  Expert_l8_gpu11 [label="Expert_l8\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l8_gpu11 -> Expert_l8_gpu11 [style=dashed];
  Expert_l8_gpu12 [label="Expert_l8\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l8_gpu12 -> Expert_l8_gpu12 [style=dashed];
  Expert_l8_gpu13 [label="Expert_l8\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l8_gpu13 -> Expert_l8_gpu13 [style=dashed];
  Expert_l8_gpu14 [label="Expert_l8\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l8_gpu14 -> Expert_l8_gpu14 [style=dashed];
  Expert_l8_gpu15 [label="Expert_l8\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l8_gpu15 -> Expert_l8_gpu15 [style=dashed];
  AR_exp_l8 [shape=ellipse, label="AllReduceExperts\nall16GPUs\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert_l8_gpu0 -> AR_exp_l8;
  Expert_l8_gpu1 -> AR_exp_l8;
  Expert_l8_gpu2 -> AR_exp_l8;
  Expert_l8_gpu3 -> AR_exp_l8;
  Expert_l8_gpu4 -> AR_exp_l8;
  Expert_l8_gpu5 -> AR_exp_l8;
  Expert_l8_gpu6 -> AR_exp_l8;
  Expert_l8_gpu7 -> AR_exp_l8;
  Expert_l8_gpu8 -> AR_exp_l8;
  Expert_l8_gpu9 -> AR_exp_l8;
  Expert_l8_gpu10 -> AR_exp_l8;
  Expert_l8_gpu11 -> AR_exp_l8;
  Expert_l8_gpu12 -> AR_exp_l8;
  Expert_l8_gpu13 -> AR_exp_l8;
  Expert_l8_gpu14 -> AR_exp_l8;
  Expert_l8_gpu15 -> AR_exp_l8;
  ResMOE_l8_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l8 -> ResMOE_l8_gpu0;
  ResAttn_l8_gpu0 -> ResMOE_l8_gpu0;
  ResMOE_l8_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l8 -> ResMOE_l8_gpu1;
  ResAttn_l8_gpu1 -> ResMOE_l8_gpu1;
  ResMOE_l8_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l8 -> ResMOE_l8_gpu2;
  ResAttn_l8_gpu2 -> ResMOE_l8_gpu2;
  ResMOE_l8_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l8 -> ResMOE_l8_gpu3;
  ResAttn_l8_gpu3 -> ResMOE_l8_gpu3;
  ResMOE_l8_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l8 -> ResMOE_l8_gpu4;
  ResAttn_l8_gpu4 -> ResMOE_l8_gpu4;
  ResMOE_l8_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l8 -> ResMOE_l8_gpu5;
  ResAttn_l8_gpu5 -> ResMOE_l8_gpu5;
  ResMOE_l8_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l8 -> ResMOE_l8_gpu6;
  ResAttn_l8_gpu6 -> ResMOE_l8_gpu6;
  ResMOE_l8_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l8 -> ResMOE_l8_gpu7;
  ResAttn_l8_gpu7 -> ResMOE_l8_gpu7;
  ResMOE_l8_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l8 -> ResMOE_l8_gpu8;
  ResAttn_l8_gpu8 -> ResMOE_l8_gpu8;
  ResMOE_l8_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l8 -> ResMOE_l8_gpu9;
  ResAttn_l8_gpu9 -> ResMOE_l8_gpu9;
  ResMOE_l8_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l8 -> ResMOE_l8_gpu10;
  ResAttn_l8_gpu10 -> ResMOE_l8_gpu10;
  ResMOE_l8_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l8 -> ResMOE_l8_gpu11;
  ResAttn_l8_gpu11 -> ResMOE_l8_gpu11;
  ResMOE_l8_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l8 -> ResMOE_l8_gpu12;
  ResAttn_l8_gpu12 -> ResMOE_l8_gpu12;
  ResMOE_l8_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l8 -> ResMOE_l8_gpu13;
  ResAttn_l8_gpu13 -> ResMOE_l8_gpu13;
  ResMOE_l8_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l8 -> ResMOE_l8_gpu14;
  ResAttn_l8_gpu14 -> ResMOE_l8_gpu14;
  ResMOE_l8_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l8 -> ResMOE_l8_gpu15;
  ResAttn_l8_gpu15 -> ResMOE_l8_gpu15;
  QKV_l9_gpu0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l8_gpu0 -> QKV_l9_gpu0;
  QKV_l9_gpu1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l8_gpu0 -> QKV_l9_gpu1;
  QKV_l9_gpu2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l8_gpu0 -> QKV_l9_gpu2;
  QKV_l9_gpu3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l8_gpu0 -> QKV_l9_gpu3;
  QKV_l9_gpu4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l8_gpu0 -> QKV_l9_gpu4;
  QKV_l9_gpu5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l8_gpu0 -> QKV_l9_gpu5;
  QKV_l9_gpu6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l8_gpu0 -> QKV_l9_gpu6;
  QKV_l9_gpu7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l8_gpu0 -> QKV_l9_gpu7;
  QKV_l9_gpu8 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l8_gpu0 -> QKV_l9_gpu8;
  QKV_l9_gpu9 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l8_gpu0 -> QKV_l9_gpu9;
  QKV_l9_gpu10 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l8_gpu0 -> QKV_l9_gpu10;
  QKV_l9_gpu11 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l8_gpu0 -> QKV_l9_gpu11;
  QKV_l9_gpu12 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l8_gpu0 -> QKV_l9_gpu12;
  QKV_l9_gpu13 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l8_gpu0 -> QKV_l9_gpu13;
  QKV_l9_gpu14 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l8_gpu0 -> QKV_l9_gpu14;
  QKV_l9_gpu15 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l8_gpu0 -> QKV_l9_gpu15;
  SplitHeads_l9_gpu0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l9_gpu0 -> SplitHeads_l9_gpu0;
  SplitHeads_l9_gpu1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l9_gpu1 -> SplitHeads_l9_gpu1;
  SplitHeads_l9_gpu2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l9_gpu2 -> SplitHeads_l9_gpu2;
  SplitHeads_l9_gpu3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l9_gpu3 -> SplitHeads_l9_gpu3;
  SplitHeads_l9_gpu4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l9_gpu4 -> SplitHeads_l9_gpu4;
  SplitHeads_l9_gpu5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l9_gpu5 -> SplitHeads_l9_gpu5;
  SplitHeads_l9_gpu6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l9_gpu6 -> SplitHeads_l9_gpu6;
  SplitHeads_l9_gpu7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l9_gpu7 -> SplitHeads_l9_gpu7;
  SplitHeads_l9_gpu8 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l9_gpu8 -> SplitHeads_l9_gpu8;
  SplitHeads_l9_gpu9 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l9_gpu9 -> SplitHeads_l9_gpu9;
  SplitHeads_l9_gpu10 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l9_gpu10 -> SplitHeads_l9_gpu10;
  SplitHeads_l9_gpu11 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l9_gpu11 -> SplitHeads_l9_gpu11;
  SplitHeads_l9_gpu12 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l9_gpu12 -> SplitHeads_l9_gpu12;
  SplitHeads_l9_gpu13 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l9_gpu13 -> SplitHeads_l9_gpu13;
  SplitHeads_l9_gpu14 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l9_gpu14 -> SplitHeads_l9_gpu14;
  SplitHeads_l9_gpu15 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l9_gpu15 -> SplitHeads_l9_gpu15;
  A2A_l9 [shape=ellipse, label="AllToAll\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_l9_gpu0 -> A2A_l9;
  SplitHeads_l9_gpu1 -> A2A_l9;
  SplitHeads_l9_gpu2 -> A2A_l9;
  SplitHeads_l9_gpu3 -> A2A_l9;
  SplitHeads_l9_gpu4 -> A2A_l9;
  SplitHeads_l9_gpu5 -> A2A_l9;
  SplitHeads_l9_gpu6 -> A2A_l9;
  SplitHeads_l9_gpu7 -> A2A_l9;
  SplitHeads_l9_gpu8 -> A2A_l9;
  SplitHeads_l9_gpu9 -> A2A_l9;
  SplitHeads_l9_gpu10 -> A2A_l9;
  SplitHeads_l9_gpu11 -> A2A_l9;
  SplitHeads_l9_gpu12 -> A2A_l9;
  SplitHeads_l9_gpu13 -> A2A_l9;
  SplitHeads_l9_gpu14 -> A2A_l9;
  SplitHeads_l9_gpu15 -> A2A_l9;
  Attn_l9_gpu0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l9 -> Attn_l9_gpu0;
  Attn_l9_gpu1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l9 -> Attn_l9_gpu1;
  Attn_l9_gpu2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l9 -> Attn_l9_gpu2;
  Attn_l9_gpu3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l9 -> Attn_l9_gpu3;
  Attn_l9_gpu4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l9 -> Attn_l9_gpu4;
  Attn_l9_gpu5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l9 -> Attn_l9_gpu5;
  Attn_l9_gpu6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l9 -> Attn_l9_gpu6;
  Attn_l9_gpu7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l9 -> Attn_l9_gpu7;
  Attn_l9_gpu8 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l9 -> Attn_l9_gpu8;
  Attn_l9_gpu9 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l9 -> Attn_l9_gpu9;
  Attn_l9_gpu10 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l9 -> Attn_l9_gpu10;
  Attn_l9_gpu11 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l9 -> Attn_l9_gpu11;
  Attn_l9_gpu12 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l9 -> Attn_l9_gpu12;
  Attn_l9_gpu13 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l9 -> Attn_l9_gpu13;
  Attn_l9_gpu14 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l9 -> Attn_l9_gpu14;
  Attn_l9_gpu15 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l9 -> Attn_l9_gpu15;
  AR_attn_l9 [shape=ellipse, label="AllReduce\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_l9_gpu0 -> AR_attn_l9;
  Attn_l9_gpu1 -> AR_attn_l9;
  Attn_l9_gpu2 -> AR_attn_l9;
  Attn_l9_gpu3 -> AR_attn_l9;
  Attn_l9_gpu4 -> AR_attn_l9;
  Attn_l9_gpu5 -> AR_attn_l9;
  Attn_l9_gpu6 -> AR_attn_l9;
  Attn_l9_gpu7 -> AR_attn_l9;
  Attn_l9_gpu8 -> AR_attn_l9;
  Attn_l9_gpu9 -> AR_attn_l9;
  Attn_l9_gpu10 -> AR_attn_l9;
  Attn_l9_gpu11 -> AR_attn_l9;
  Attn_l9_gpu12 -> AR_attn_l9;
  Attn_l9_gpu13 -> AR_attn_l9;
  Attn_l9_gpu14 -> AR_attn_l9;
  Attn_l9_gpu15 -> AR_attn_l9;
  O_l9_gpu0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l9 -> O_l9_gpu0;
  O_l9_gpu1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l9 -> O_l9_gpu1;
  O_l9_gpu2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l9 -> O_l9_gpu2;
  O_l9_gpu3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l9 -> O_l9_gpu3;
  O_l9_gpu4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l9 -> O_l9_gpu4;
  O_l9_gpu5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l9 -> O_l9_gpu5;
  O_l9_gpu6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l9 -> O_l9_gpu6;
  O_l9_gpu7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l9 -> O_l9_gpu7;
  O_l9_gpu8 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l9 -> O_l9_gpu8;
  O_l9_gpu9 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l9 -> O_l9_gpu9;
  O_l9_gpu10 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l9 -> O_l9_gpu10;
  O_l9_gpu11 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l9 -> O_l9_gpu11;
  O_l9_gpu12 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l9 -> O_l9_gpu12;
  O_l9_gpu13 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l9 -> O_l9_gpu13;
  O_l9_gpu14 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l9 -> O_l9_gpu14;
  O_l9_gpu15 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l9 -> O_l9_gpu15;
  ResAttn_l9_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l9_gpu0 -> ResAttn_l9_gpu0;
  ResMOE_l8_gpu0 -> ResAttn_l9_gpu0;
  ResAttn_l9_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l9_gpu1 -> ResAttn_l9_gpu1;
  ResMOE_l8_gpu0 -> ResAttn_l9_gpu1;
  ResAttn_l9_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l9_gpu2 -> ResAttn_l9_gpu2;
  ResMOE_l8_gpu0 -> ResAttn_l9_gpu2;
  ResAttn_l9_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l9_gpu3 -> ResAttn_l9_gpu3;
  ResMOE_l8_gpu0 -> ResAttn_l9_gpu3;
  ResAttn_l9_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l9_gpu4 -> ResAttn_l9_gpu4;
  ResMOE_l8_gpu0 -> ResAttn_l9_gpu4;
  ResAttn_l9_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l9_gpu5 -> ResAttn_l9_gpu5;
  ResMOE_l8_gpu0 -> ResAttn_l9_gpu5;
  ResAttn_l9_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l9_gpu6 -> ResAttn_l9_gpu6;
  ResMOE_l8_gpu0 -> ResAttn_l9_gpu6;
  ResAttn_l9_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l9_gpu7 -> ResAttn_l9_gpu7;
  ResMOE_l8_gpu0 -> ResAttn_l9_gpu7;
  ResAttn_l9_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l9_gpu8 -> ResAttn_l9_gpu8;
  ResMOE_l8_gpu0 -> ResAttn_l9_gpu8;
  ResAttn_l9_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l9_gpu9 -> ResAttn_l9_gpu9;
  ResMOE_l8_gpu0 -> ResAttn_l9_gpu9;
  ResAttn_l9_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l9_gpu10 -> ResAttn_l9_gpu10;
  ResMOE_l8_gpu0 -> ResAttn_l9_gpu10;
  ResAttn_l9_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l9_gpu11 -> ResAttn_l9_gpu11;
  ResMOE_l8_gpu0 -> ResAttn_l9_gpu11;
  ResAttn_l9_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l9_gpu12 -> ResAttn_l9_gpu12;
  ResMOE_l8_gpu0 -> ResAttn_l9_gpu12;
  ResAttn_l9_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l9_gpu13 -> ResAttn_l9_gpu13;
  ResMOE_l8_gpu0 -> ResAttn_l9_gpu13;
  ResAttn_l9_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l9_gpu14 -> ResAttn_l9_gpu14;
  ResMOE_l8_gpu0 -> ResAttn_l9_gpu14;
  ResAttn_l9_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l9_gpu15 -> ResAttn_l9_gpu15;
  ResMOE_l8_gpu0 -> ResAttn_l9_gpu15;
  Gate_l9_gpu0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l9_gpu0 -> Gate_l9_gpu0;
  Gate_l9_gpu1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l9_gpu1 -> Gate_l9_gpu1;
  Gate_l9_gpu2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l9_gpu2 -> Gate_l9_gpu2;
  Gate_l9_gpu3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l9_gpu3 -> Gate_l9_gpu3;
  Gate_l9_gpu4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l9_gpu4 -> Gate_l9_gpu4;
  Gate_l9_gpu5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l9_gpu5 -> Gate_l9_gpu5;
  Gate_l9_gpu6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l9_gpu6 -> Gate_l9_gpu6;
  Gate_l9_gpu7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l9_gpu7 -> Gate_l9_gpu7;
  Gate_l9_gpu8 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l9_gpu8 -> Gate_l9_gpu8;
  Gate_l9_gpu9 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l9_gpu9 -> Gate_l9_gpu9;
  Gate_l9_gpu10 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l9_gpu10 -> Gate_l9_gpu10;
  Gate_l9_gpu11 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l9_gpu11 -> Gate_l9_gpu11;
  Gate_l9_gpu12 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l9_gpu12 -> Gate_l9_gpu12;
  Gate_l9_gpu13 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l9_gpu13 -> Gate_l9_gpu13;
  Gate_l9_gpu14 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l9_gpu14 -> Gate_l9_gpu14;
  Gate_l9_gpu15 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l9_gpu15 -> Gate_l9_gpu15;
  Expert_l9_gpu0 [label="Expert_l9\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l9_gpu0 -> Expert_l9_gpu0 [style=dashed];
  Expert_l9_gpu1 [label="Expert_l9\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l9_gpu1 -> Expert_l9_gpu1 [style=dashed];
  Expert_l9_gpu2 [label="Expert_l9\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l9_gpu2 -> Expert_l9_gpu2 [style=dashed];
  Expert_l9_gpu3 [label="Expert_l9\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l9_gpu3 -> Expert_l9_gpu3 [style=dashed];
  Expert_l9_gpu4 [label="Expert_l9\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l9_gpu4 -> Expert_l9_gpu4 [style=dashed];
  Expert_l9_gpu5 [label="Expert_l9\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l9_gpu5 -> Expert_l9_gpu5 [style=dashed];
  Expert_l9_gpu6 [label="Expert_l9\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l9_gpu6 -> Expert_l9_gpu6 [style=dashed];
  Expert_l9_gpu7 [label="Expert_l9\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l9_gpu7 -> Expert_l9_gpu7 [style=dashed];
  Expert_l9_gpu8 [label="Expert_l9\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l9_gpu8 -> Expert_l9_gpu8 [style=dashed];
  Expert_l9_gpu9 [label="Expert_l9\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l9_gpu9 -> Expert_l9_gpu9 [style=dashed];
  Expert_l9_gpu10 [label="Expert_l9\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l9_gpu10 -> Expert_l9_gpu10 [style=dashed];
  Expert_l9_gpu11 [label="Expert_l9\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l9_gpu11 -> Expert_l9_gpu11 [style=dashed];
  Expert_l9_gpu12 [label="Expert_l9\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l9_gpu12 -> Expert_l9_gpu12 [style=dashed];
  Expert_l9_gpu13 [label="Expert_l9\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l9_gpu13 -> Expert_l9_gpu13 [style=dashed];
  Expert_l9_gpu14 [label="Expert_l9\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l9_gpu14 -> Expert_l9_gpu14 [style=dashed];
  Expert_l9_gpu15 [label="Expert_l9\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l9_gpu15 -> Expert_l9_gpu15 [style=dashed];
  AR_exp_l9 [shape=ellipse, label="AllReduceExperts\nall16GPUs\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert_l9_gpu0 -> AR_exp_l9;
  Expert_l9_gpu1 -> AR_exp_l9;
  Expert_l9_gpu2 -> AR_exp_l9;
  Expert_l9_gpu3 -> AR_exp_l9;
  Expert_l9_gpu4 -> AR_exp_l9;
  Expert_l9_gpu5 -> AR_exp_l9;
  Expert_l9_gpu6 -> AR_exp_l9;
  Expert_l9_gpu7 -> AR_exp_l9;
  Expert_l9_gpu8 -> AR_exp_l9;
  Expert_l9_gpu9 -> AR_exp_l9;
  Expert_l9_gpu10 -> AR_exp_l9;
  Expert_l9_gpu11 -> AR_exp_l9;
  Expert_l9_gpu12 -> AR_exp_l9;
  Expert_l9_gpu13 -> AR_exp_l9;
  Expert_l9_gpu14 -> AR_exp_l9;
  Expert_l9_gpu15 -> AR_exp_l9;
  ResMOE_l9_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l9 -> ResMOE_l9_gpu0;
  ResAttn_l9_gpu0 -> ResMOE_l9_gpu0;
  ResMOE_l9_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l9 -> ResMOE_l9_gpu1;
  ResAttn_l9_gpu1 -> ResMOE_l9_gpu1;
  ResMOE_l9_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l9 -> ResMOE_l9_gpu2;
  ResAttn_l9_gpu2 -> ResMOE_l9_gpu2;
  ResMOE_l9_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l9 -> ResMOE_l9_gpu3;
  ResAttn_l9_gpu3 -> ResMOE_l9_gpu3;
  ResMOE_l9_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l9 -> ResMOE_l9_gpu4;
  ResAttn_l9_gpu4 -> ResMOE_l9_gpu4;
  ResMOE_l9_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l9 -> ResMOE_l9_gpu5;
  ResAttn_l9_gpu5 -> ResMOE_l9_gpu5;
  ResMOE_l9_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l9 -> ResMOE_l9_gpu6;
  ResAttn_l9_gpu6 -> ResMOE_l9_gpu6;
  ResMOE_l9_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l9 -> ResMOE_l9_gpu7;
  ResAttn_l9_gpu7 -> ResMOE_l9_gpu7;
  ResMOE_l9_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l9 -> ResMOE_l9_gpu8;
  ResAttn_l9_gpu8 -> ResMOE_l9_gpu8;
  ResMOE_l9_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l9 -> ResMOE_l9_gpu9;
  ResAttn_l9_gpu9 -> ResMOE_l9_gpu9;
  ResMOE_l9_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l9 -> ResMOE_l9_gpu10;
  ResAttn_l9_gpu10 -> ResMOE_l9_gpu10;
  ResMOE_l9_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l9 -> ResMOE_l9_gpu11;
  ResAttn_l9_gpu11 -> ResMOE_l9_gpu11;
  ResMOE_l9_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l9 -> ResMOE_l9_gpu12;
  ResAttn_l9_gpu12 -> ResMOE_l9_gpu12;
  ResMOE_l9_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l9 -> ResMOE_l9_gpu13;
  ResAttn_l9_gpu13 -> ResMOE_l9_gpu13;
  ResMOE_l9_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l9 -> ResMOE_l9_gpu14;
  ResAttn_l9_gpu14 -> ResMOE_l9_gpu14;
  ResMOE_l9_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l9 -> ResMOE_l9_gpu15;
  ResAttn_l9_gpu15 -> ResMOE_l9_gpu15;
  QKV_l10_gpu0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l9_gpu0 -> QKV_l10_gpu0;
  QKV_l10_gpu1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l9_gpu0 -> QKV_l10_gpu1;
  QKV_l10_gpu2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l9_gpu0 -> QKV_l10_gpu2;
  QKV_l10_gpu3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l9_gpu0 -> QKV_l10_gpu3;
  QKV_l10_gpu4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l9_gpu0 -> QKV_l10_gpu4;
  QKV_l10_gpu5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l9_gpu0 -> QKV_l10_gpu5;
  QKV_l10_gpu6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l9_gpu0 -> QKV_l10_gpu6;
  QKV_l10_gpu7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l9_gpu0 -> QKV_l10_gpu7;
  QKV_l10_gpu8 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l9_gpu0 -> QKV_l10_gpu8;
  QKV_l10_gpu9 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l9_gpu0 -> QKV_l10_gpu9;
  QKV_l10_gpu10 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l9_gpu0 -> QKV_l10_gpu10;
  QKV_l10_gpu11 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l9_gpu0 -> QKV_l10_gpu11;
  QKV_l10_gpu12 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l9_gpu0 -> QKV_l10_gpu12;
  QKV_l10_gpu13 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l9_gpu0 -> QKV_l10_gpu13;
  QKV_l10_gpu14 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l9_gpu0 -> QKV_l10_gpu14;
  QKV_l10_gpu15 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l9_gpu0 -> QKV_l10_gpu15;
  SplitHeads_l10_gpu0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l10_gpu0 -> SplitHeads_l10_gpu0;
  SplitHeads_l10_gpu1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l10_gpu1 -> SplitHeads_l10_gpu1;
  SplitHeads_l10_gpu2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l10_gpu2 -> SplitHeads_l10_gpu2;
  SplitHeads_l10_gpu3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l10_gpu3 -> SplitHeads_l10_gpu3;
  SplitHeads_l10_gpu4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l10_gpu4 -> SplitHeads_l10_gpu4;
  SplitHeads_l10_gpu5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l10_gpu5 -> SplitHeads_l10_gpu5;
  SplitHeads_l10_gpu6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l10_gpu6 -> SplitHeads_l10_gpu6;
  SplitHeads_l10_gpu7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l10_gpu7 -> SplitHeads_l10_gpu7;
  SplitHeads_l10_gpu8 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l10_gpu8 -> SplitHeads_l10_gpu8;
  SplitHeads_l10_gpu9 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l10_gpu9 -> SplitHeads_l10_gpu9;
  SplitHeads_l10_gpu10 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l10_gpu10 -> SplitHeads_l10_gpu10;
  SplitHeads_l10_gpu11 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l10_gpu11 -> SplitHeads_l10_gpu11;
  SplitHeads_l10_gpu12 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l10_gpu12 -> SplitHeads_l10_gpu12;
  SplitHeads_l10_gpu13 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l10_gpu13 -> SplitHeads_l10_gpu13;
  SplitHeads_l10_gpu14 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l10_gpu14 -> SplitHeads_l10_gpu14;
  SplitHeads_l10_gpu15 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l10_gpu15 -> SplitHeads_l10_gpu15;
  A2A_l10 [shape=ellipse, label="AllToAll\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_l10_gpu0 -> A2A_l10;
  SplitHeads_l10_gpu1 -> A2A_l10;
  SplitHeads_l10_gpu2 -> A2A_l10;
  SplitHeads_l10_gpu3 -> A2A_l10;
  SplitHeads_l10_gpu4 -> A2A_l10;
  SplitHeads_l10_gpu5 -> A2A_l10;
  SplitHeads_l10_gpu6 -> A2A_l10;
  SplitHeads_l10_gpu7 -> A2A_l10;
  SplitHeads_l10_gpu8 -> A2A_l10;
  SplitHeads_l10_gpu9 -> A2A_l10;
  SplitHeads_l10_gpu10 -> A2A_l10;
  SplitHeads_l10_gpu11 -> A2A_l10;
  SplitHeads_l10_gpu12 -> A2A_l10;
  SplitHeads_l10_gpu13 -> A2A_l10;
  SplitHeads_l10_gpu14 -> A2A_l10;
  SplitHeads_l10_gpu15 -> A2A_l10;
  Attn_l10_gpu0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l10 -> Attn_l10_gpu0;
  Attn_l10_gpu1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l10 -> Attn_l10_gpu1;
  Attn_l10_gpu2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l10 -> Attn_l10_gpu2;
  Attn_l10_gpu3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l10 -> Attn_l10_gpu3;
  Attn_l10_gpu4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l10 -> Attn_l10_gpu4;
  Attn_l10_gpu5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l10 -> Attn_l10_gpu5;
  Attn_l10_gpu6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l10 -> Attn_l10_gpu6;
  Attn_l10_gpu7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l10 -> Attn_l10_gpu7;
  Attn_l10_gpu8 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l10 -> Attn_l10_gpu8;
  Attn_l10_gpu9 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l10 -> Attn_l10_gpu9;
  Attn_l10_gpu10 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l10 -> Attn_l10_gpu10;
  Attn_l10_gpu11 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l10 -> Attn_l10_gpu11;
  Attn_l10_gpu12 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l10 -> Attn_l10_gpu12;
  Attn_l10_gpu13 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l10 -> Attn_l10_gpu13;
  Attn_l10_gpu14 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l10 -> Attn_l10_gpu14;
  Attn_l10_gpu15 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l10 -> Attn_l10_gpu15;
  AR_attn_l10 [shape=ellipse, label="AllReduce\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_l10_gpu0 -> AR_attn_l10;
  Attn_l10_gpu1 -> AR_attn_l10;
  Attn_l10_gpu2 -> AR_attn_l10;
  Attn_l10_gpu3 -> AR_attn_l10;
  Attn_l10_gpu4 -> AR_attn_l10;
  Attn_l10_gpu5 -> AR_attn_l10;
  Attn_l10_gpu6 -> AR_attn_l10;
  Attn_l10_gpu7 -> AR_attn_l10;
  Attn_l10_gpu8 -> AR_attn_l10;
  Attn_l10_gpu9 -> AR_attn_l10;
  Attn_l10_gpu10 -> AR_attn_l10;
  Attn_l10_gpu11 -> AR_attn_l10;
  Attn_l10_gpu12 -> AR_attn_l10;
  Attn_l10_gpu13 -> AR_attn_l10;
  Attn_l10_gpu14 -> AR_attn_l10;
  Attn_l10_gpu15 -> AR_attn_l10;
  O_l10_gpu0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l10 -> O_l10_gpu0;
  O_l10_gpu1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l10 -> O_l10_gpu1;
  O_l10_gpu2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l10 -> O_l10_gpu2;
  O_l10_gpu3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l10 -> O_l10_gpu3;
  O_l10_gpu4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l10 -> O_l10_gpu4;
  O_l10_gpu5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l10 -> O_l10_gpu5;
  O_l10_gpu6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l10 -> O_l10_gpu6;
  O_l10_gpu7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l10 -> O_l10_gpu7;
  O_l10_gpu8 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l10 -> O_l10_gpu8;
  O_l10_gpu9 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l10 -> O_l10_gpu9;
  O_l10_gpu10 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l10 -> O_l10_gpu10;
  O_l10_gpu11 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l10 -> O_l10_gpu11;
  O_l10_gpu12 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l10 -> O_l10_gpu12;
  O_l10_gpu13 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l10 -> O_l10_gpu13;
  O_l10_gpu14 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l10 -> O_l10_gpu14;
  O_l10_gpu15 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l10 -> O_l10_gpu15;
  ResAttn_l10_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l10_gpu0 -> ResAttn_l10_gpu0;
  ResMOE_l9_gpu0 -> ResAttn_l10_gpu0;
  ResAttn_l10_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l10_gpu1 -> ResAttn_l10_gpu1;
  ResMOE_l9_gpu0 -> ResAttn_l10_gpu1;
  ResAttn_l10_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l10_gpu2 -> ResAttn_l10_gpu2;
  ResMOE_l9_gpu0 -> ResAttn_l10_gpu2;
  ResAttn_l10_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l10_gpu3 -> ResAttn_l10_gpu3;
  ResMOE_l9_gpu0 -> ResAttn_l10_gpu3;
  ResAttn_l10_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l10_gpu4 -> ResAttn_l10_gpu4;
  ResMOE_l9_gpu0 -> ResAttn_l10_gpu4;
  ResAttn_l10_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l10_gpu5 -> ResAttn_l10_gpu5;
  ResMOE_l9_gpu0 -> ResAttn_l10_gpu5;
  ResAttn_l10_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l10_gpu6 -> ResAttn_l10_gpu6;
  ResMOE_l9_gpu0 -> ResAttn_l10_gpu6;
  ResAttn_l10_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l10_gpu7 -> ResAttn_l10_gpu7;
  ResMOE_l9_gpu0 -> ResAttn_l10_gpu7;
  ResAttn_l10_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l10_gpu8 -> ResAttn_l10_gpu8;
  ResMOE_l9_gpu0 -> ResAttn_l10_gpu8;
  ResAttn_l10_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l10_gpu9 -> ResAttn_l10_gpu9;
  ResMOE_l9_gpu0 -> ResAttn_l10_gpu9;
  ResAttn_l10_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l10_gpu10 -> ResAttn_l10_gpu10;
  ResMOE_l9_gpu0 -> ResAttn_l10_gpu10;
  ResAttn_l10_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l10_gpu11 -> ResAttn_l10_gpu11;
  ResMOE_l9_gpu0 -> ResAttn_l10_gpu11;
  ResAttn_l10_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l10_gpu12 -> ResAttn_l10_gpu12;
  ResMOE_l9_gpu0 -> ResAttn_l10_gpu12;
  ResAttn_l10_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l10_gpu13 -> ResAttn_l10_gpu13;
  ResMOE_l9_gpu0 -> ResAttn_l10_gpu13;
  ResAttn_l10_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l10_gpu14 -> ResAttn_l10_gpu14;
  ResMOE_l9_gpu0 -> ResAttn_l10_gpu14;
  ResAttn_l10_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l10_gpu15 -> ResAttn_l10_gpu15;
  ResMOE_l9_gpu0 -> ResAttn_l10_gpu15;
  Gate_l10_gpu0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l10_gpu0 -> Gate_l10_gpu0;
  Gate_l10_gpu1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l10_gpu1 -> Gate_l10_gpu1;
  Gate_l10_gpu2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l10_gpu2 -> Gate_l10_gpu2;
  Gate_l10_gpu3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l10_gpu3 -> Gate_l10_gpu3;
  Gate_l10_gpu4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l10_gpu4 -> Gate_l10_gpu4;
  Gate_l10_gpu5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l10_gpu5 -> Gate_l10_gpu5;
  Gate_l10_gpu6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l10_gpu6 -> Gate_l10_gpu6;
  Gate_l10_gpu7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l10_gpu7 -> Gate_l10_gpu7;
  Gate_l10_gpu8 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l10_gpu8 -> Gate_l10_gpu8;
  Gate_l10_gpu9 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l10_gpu9 -> Gate_l10_gpu9;
  Gate_l10_gpu10 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l10_gpu10 -> Gate_l10_gpu10;
  Gate_l10_gpu11 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l10_gpu11 -> Gate_l10_gpu11;
  Gate_l10_gpu12 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l10_gpu12 -> Gate_l10_gpu12;
  Gate_l10_gpu13 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l10_gpu13 -> Gate_l10_gpu13;
  Gate_l10_gpu14 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l10_gpu14 -> Gate_l10_gpu14;
  Gate_l10_gpu15 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l10_gpu15 -> Gate_l10_gpu15;
  Expert_l10_gpu0 [label="Expert_l10\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l10_gpu0 -> Expert_l10_gpu0 [style=dashed];
  Expert_l10_gpu1 [label="Expert_l10\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l10_gpu1 -> Expert_l10_gpu1 [style=dashed];
  Expert_l10_gpu2 [label="Expert_l10\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l10_gpu2 -> Expert_l10_gpu2 [style=dashed];
  Expert_l10_gpu3 [label="Expert_l10\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l10_gpu3 -> Expert_l10_gpu3 [style=dashed];
  Expert_l10_gpu4 [label="Expert_l10\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l10_gpu4 -> Expert_l10_gpu4 [style=dashed];
  Expert_l10_gpu5 [label="Expert_l10\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l10_gpu5 -> Expert_l10_gpu5 [style=dashed];
  Expert_l10_gpu6 [label="Expert_l10\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l10_gpu6 -> Expert_l10_gpu6 [style=dashed];
  Expert_l10_gpu7 [label="Expert_l10\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l10_gpu7 -> Expert_l10_gpu7 [style=dashed];
  Expert_l10_gpu8 [label="Expert_l10\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l10_gpu8 -> Expert_l10_gpu8 [style=dashed];
  Expert_l10_gpu9 [label="Expert_l10\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l10_gpu9 -> Expert_l10_gpu9 [style=dashed];
  Expert_l10_gpu10 [label="Expert_l10\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l10_gpu10 -> Expert_l10_gpu10 [style=dashed];
  Expert_l10_gpu11 [label="Expert_l10\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l10_gpu11 -> Expert_l10_gpu11 [style=dashed];
  Expert_l10_gpu12 [label="Expert_l10\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l10_gpu12 -> Expert_l10_gpu12 [style=dashed];
  Expert_l10_gpu13 [label="Expert_l10\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l10_gpu13 -> Expert_l10_gpu13 [style=dashed];
  Expert_l10_gpu14 [label="Expert_l10\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l10_gpu14 -> Expert_l10_gpu14 [style=dashed];
  Expert_l10_gpu15 [label="Expert_l10\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l10_gpu15 -> Expert_l10_gpu15 [style=dashed];
  AR_exp_l10 [shape=ellipse, label="AllReduceExperts\nall16GPUs\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert_l10_gpu0 -> AR_exp_l10;
  Expert_l10_gpu1 -> AR_exp_l10;
  Expert_l10_gpu2 -> AR_exp_l10;
  Expert_l10_gpu3 -> AR_exp_l10;
  Expert_l10_gpu4 -> AR_exp_l10;
  Expert_l10_gpu5 -> AR_exp_l10;
  Expert_l10_gpu6 -> AR_exp_l10;
  Expert_l10_gpu7 -> AR_exp_l10;
  Expert_l10_gpu8 -> AR_exp_l10;
  Expert_l10_gpu9 -> AR_exp_l10;
  Expert_l10_gpu10 -> AR_exp_l10;
  Expert_l10_gpu11 -> AR_exp_l10;
  Expert_l10_gpu12 -> AR_exp_l10;
  Expert_l10_gpu13 -> AR_exp_l10;
  Expert_l10_gpu14 -> AR_exp_l10;
  Expert_l10_gpu15 -> AR_exp_l10;
  ResMOE_l10_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l10 -> ResMOE_l10_gpu0;
  ResAttn_l10_gpu0 -> ResMOE_l10_gpu0;
  ResMOE_l10_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l10 -> ResMOE_l10_gpu1;
  ResAttn_l10_gpu1 -> ResMOE_l10_gpu1;
  ResMOE_l10_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l10 -> ResMOE_l10_gpu2;
  ResAttn_l10_gpu2 -> ResMOE_l10_gpu2;
  ResMOE_l10_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l10 -> ResMOE_l10_gpu3;
  ResAttn_l10_gpu3 -> ResMOE_l10_gpu3;
  ResMOE_l10_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l10 -> ResMOE_l10_gpu4;
  ResAttn_l10_gpu4 -> ResMOE_l10_gpu4;
  ResMOE_l10_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l10 -> ResMOE_l10_gpu5;
  ResAttn_l10_gpu5 -> ResMOE_l10_gpu5;
  ResMOE_l10_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l10 -> ResMOE_l10_gpu6;
  ResAttn_l10_gpu6 -> ResMOE_l10_gpu6;
  ResMOE_l10_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l10 -> ResMOE_l10_gpu7;
  ResAttn_l10_gpu7 -> ResMOE_l10_gpu7;
  ResMOE_l10_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l10 -> ResMOE_l10_gpu8;
  ResAttn_l10_gpu8 -> ResMOE_l10_gpu8;
  ResMOE_l10_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l10 -> ResMOE_l10_gpu9;
  ResAttn_l10_gpu9 -> ResMOE_l10_gpu9;
  ResMOE_l10_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l10 -> ResMOE_l10_gpu10;
  ResAttn_l10_gpu10 -> ResMOE_l10_gpu10;
  ResMOE_l10_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l10 -> ResMOE_l10_gpu11;
  ResAttn_l10_gpu11 -> ResMOE_l10_gpu11;
  ResMOE_l10_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l10 -> ResMOE_l10_gpu12;
  ResAttn_l10_gpu12 -> ResMOE_l10_gpu12;
  ResMOE_l10_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l10 -> ResMOE_l10_gpu13;
  ResAttn_l10_gpu13 -> ResMOE_l10_gpu13;
  ResMOE_l10_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l10 -> ResMOE_l10_gpu14;
  ResAttn_l10_gpu14 -> ResMOE_l10_gpu14;
  ResMOE_l10_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l10 -> ResMOE_l10_gpu15;
  ResAttn_l10_gpu15 -> ResMOE_l10_gpu15;
  QKV_l11_gpu0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l10_gpu0 -> QKV_l11_gpu0;
  QKV_l11_gpu1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l10_gpu0 -> QKV_l11_gpu1;
  QKV_l11_gpu2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l10_gpu0 -> QKV_l11_gpu2;
  QKV_l11_gpu3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l10_gpu0 -> QKV_l11_gpu3;
  QKV_l11_gpu4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l10_gpu0 -> QKV_l11_gpu4;
  QKV_l11_gpu5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l10_gpu0 -> QKV_l11_gpu5;
  QKV_l11_gpu6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l10_gpu0 -> QKV_l11_gpu6;
  QKV_l11_gpu7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l10_gpu0 -> QKV_l11_gpu7;
  QKV_l11_gpu8 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l10_gpu0 -> QKV_l11_gpu8;
  QKV_l11_gpu9 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l10_gpu0 -> QKV_l11_gpu9;
  QKV_l11_gpu10 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l10_gpu0 -> QKV_l11_gpu10;
  QKV_l11_gpu11 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l10_gpu0 -> QKV_l11_gpu11;
  QKV_l11_gpu12 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l10_gpu0 -> QKV_l11_gpu12;
  QKV_l11_gpu13 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l10_gpu0 -> QKV_l11_gpu13;
  QKV_l11_gpu14 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l10_gpu0 -> QKV_l11_gpu14;
  QKV_l11_gpu15 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l10_gpu0 -> QKV_l11_gpu15;
  SplitHeads_l11_gpu0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l11_gpu0 -> SplitHeads_l11_gpu0;
  SplitHeads_l11_gpu1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l11_gpu1 -> SplitHeads_l11_gpu1;
  SplitHeads_l11_gpu2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l11_gpu2 -> SplitHeads_l11_gpu2;
  SplitHeads_l11_gpu3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l11_gpu3 -> SplitHeads_l11_gpu3;
  SplitHeads_l11_gpu4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l11_gpu4 -> SplitHeads_l11_gpu4;
  SplitHeads_l11_gpu5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l11_gpu5 -> SplitHeads_l11_gpu5;
  SplitHeads_l11_gpu6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l11_gpu6 -> SplitHeads_l11_gpu6;
  SplitHeads_l11_gpu7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l11_gpu7 -> SplitHeads_l11_gpu7;
  SplitHeads_l11_gpu8 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l11_gpu8 -> SplitHeads_l11_gpu8;
  SplitHeads_l11_gpu9 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l11_gpu9 -> SplitHeads_l11_gpu9;
  SplitHeads_l11_gpu10 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l11_gpu10 -> SplitHeads_l11_gpu10;
  SplitHeads_l11_gpu11 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l11_gpu11 -> SplitHeads_l11_gpu11;
  SplitHeads_l11_gpu12 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l11_gpu12 -> SplitHeads_l11_gpu12;
  SplitHeads_l11_gpu13 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l11_gpu13 -> SplitHeads_l11_gpu13;
  SplitHeads_l11_gpu14 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l11_gpu14 -> SplitHeads_l11_gpu14;
  SplitHeads_l11_gpu15 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l11_gpu15 -> SplitHeads_l11_gpu15;
  A2A_l11 [shape=ellipse, label="AllToAll\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_l11_gpu0 -> A2A_l11;
  SplitHeads_l11_gpu1 -> A2A_l11;
  SplitHeads_l11_gpu2 -> A2A_l11;
  SplitHeads_l11_gpu3 -> A2A_l11;
  SplitHeads_l11_gpu4 -> A2A_l11;
  SplitHeads_l11_gpu5 -> A2A_l11;
  SplitHeads_l11_gpu6 -> A2A_l11;
  SplitHeads_l11_gpu7 -> A2A_l11;
  SplitHeads_l11_gpu8 -> A2A_l11;
  SplitHeads_l11_gpu9 -> A2A_l11;
  SplitHeads_l11_gpu10 -> A2A_l11;
  SplitHeads_l11_gpu11 -> A2A_l11;
  SplitHeads_l11_gpu12 -> A2A_l11;
  SplitHeads_l11_gpu13 -> A2A_l11;
  SplitHeads_l11_gpu14 -> A2A_l11;
  SplitHeads_l11_gpu15 -> A2A_l11;
  Attn_l11_gpu0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l11 -> Attn_l11_gpu0;
  Attn_l11_gpu1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l11 -> Attn_l11_gpu1;
  Attn_l11_gpu2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l11 -> Attn_l11_gpu2;
  Attn_l11_gpu3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l11 -> Attn_l11_gpu3;
  Attn_l11_gpu4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l11 -> Attn_l11_gpu4;
  Attn_l11_gpu5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l11 -> Attn_l11_gpu5;
  Attn_l11_gpu6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l11 -> Attn_l11_gpu6;
  Attn_l11_gpu7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l11 -> Attn_l11_gpu7;
  Attn_l11_gpu8 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l11 -> Attn_l11_gpu8;
  Attn_l11_gpu9 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l11 -> Attn_l11_gpu9;
  Attn_l11_gpu10 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l11 -> Attn_l11_gpu10;
  Attn_l11_gpu11 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l11 -> Attn_l11_gpu11;
  Attn_l11_gpu12 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l11 -> Attn_l11_gpu12;
  Attn_l11_gpu13 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l11 -> Attn_l11_gpu13;
  Attn_l11_gpu14 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l11 -> Attn_l11_gpu14;
  Attn_l11_gpu15 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l11 -> Attn_l11_gpu15;
  AR_attn_l11 [shape=ellipse, label="AllReduce\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_l11_gpu0 -> AR_attn_l11;
  Attn_l11_gpu1 -> AR_attn_l11;
  Attn_l11_gpu2 -> AR_attn_l11;
  Attn_l11_gpu3 -> AR_attn_l11;
  Attn_l11_gpu4 -> AR_attn_l11;
  Attn_l11_gpu5 -> AR_attn_l11;
  Attn_l11_gpu6 -> AR_attn_l11;
  Attn_l11_gpu7 -> AR_attn_l11;
  Attn_l11_gpu8 -> AR_attn_l11;
  Attn_l11_gpu9 -> AR_attn_l11;
  Attn_l11_gpu10 -> AR_attn_l11;
  Attn_l11_gpu11 -> AR_attn_l11;
  Attn_l11_gpu12 -> AR_attn_l11;
  Attn_l11_gpu13 -> AR_attn_l11;
  Attn_l11_gpu14 -> AR_attn_l11;
  Attn_l11_gpu15 -> AR_attn_l11;
  O_l11_gpu0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l11 -> O_l11_gpu0;
  O_l11_gpu1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l11 -> O_l11_gpu1;
  O_l11_gpu2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l11 -> O_l11_gpu2;
  O_l11_gpu3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l11 -> O_l11_gpu3;
  O_l11_gpu4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l11 -> O_l11_gpu4;
  O_l11_gpu5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l11 -> O_l11_gpu5;
  O_l11_gpu6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l11 -> O_l11_gpu6;
  O_l11_gpu7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l11 -> O_l11_gpu7;
  O_l11_gpu8 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l11 -> O_l11_gpu8;
  O_l11_gpu9 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l11 -> O_l11_gpu9;
  O_l11_gpu10 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l11 -> O_l11_gpu10;
  O_l11_gpu11 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l11 -> O_l11_gpu11;
  O_l11_gpu12 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l11 -> O_l11_gpu12;
  O_l11_gpu13 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l11 -> O_l11_gpu13;
  O_l11_gpu14 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l11 -> O_l11_gpu14;
  O_l11_gpu15 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l11 -> O_l11_gpu15;
  ResAttn_l11_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l11_gpu0 -> ResAttn_l11_gpu0;
  ResMOE_l10_gpu0 -> ResAttn_l11_gpu0;
  ResAttn_l11_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l11_gpu1 -> ResAttn_l11_gpu1;
  ResMOE_l10_gpu0 -> ResAttn_l11_gpu1;
  ResAttn_l11_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l11_gpu2 -> ResAttn_l11_gpu2;
  ResMOE_l10_gpu0 -> ResAttn_l11_gpu2;
  ResAttn_l11_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l11_gpu3 -> ResAttn_l11_gpu3;
  ResMOE_l10_gpu0 -> ResAttn_l11_gpu3;
  ResAttn_l11_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l11_gpu4 -> ResAttn_l11_gpu4;
  ResMOE_l10_gpu0 -> ResAttn_l11_gpu4;
  ResAttn_l11_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l11_gpu5 -> ResAttn_l11_gpu5;
  ResMOE_l10_gpu0 -> ResAttn_l11_gpu5;
  ResAttn_l11_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l11_gpu6 -> ResAttn_l11_gpu6;
  ResMOE_l10_gpu0 -> ResAttn_l11_gpu6;
  ResAttn_l11_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l11_gpu7 -> ResAttn_l11_gpu7;
  ResMOE_l10_gpu0 -> ResAttn_l11_gpu7;
  ResAttn_l11_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l11_gpu8 -> ResAttn_l11_gpu8;
  ResMOE_l10_gpu0 -> ResAttn_l11_gpu8;
  ResAttn_l11_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l11_gpu9 -> ResAttn_l11_gpu9;
  ResMOE_l10_gpu0 -> ResAttn_l11_gpu9;
  ResAttn_l11_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l11_gpu10 -> ResAttn_l11_gpu10;
  ResMOE_l10_gpu0 -> ResAttn_l11_gpu10;
  ResAttn_l11_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l11_gpu11 -> ResAttn_l11_gpu11;
  ResMOE_l10_gpu0 -> ResAttn_l11_gpu11;
  ResAttn_l11_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l11_gpu12 -> ResAttn_l11_gpu12;
  ResMOE_l10_gpu0 -> ResAttn_l11_gpu12;
  ResAttn_l11_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l11_gpu13 -> ResAttn_l11_gpu13;
  ResMOE_l10_gpu0 -> ResAttn_l11_gpu13;
  ResAttn_l11_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l11_gpu14 -> ResAttn_l11_gpu14;
  ResMOE_l10_gpu0 -> ResAttn_l11_gpu14;
  ResAttn_l11_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l11_gpu15 -> ResAttn_l11_gpu15;
  ResMOE_l10_gpu0 -> ResAttn_l11_gpu15;
  Gate_l11_gpu0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l11_gpu0 -> Gate_l11_gpu0;
  Gate_l11_gpu1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l11_gpu1 -> Gate_l11_gpu1;
  Gate_l11_gpu2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l11_gpu2 -> Gate_l11_gpu2;
  Gate_l11_gpu3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l11_gpu3 -> Gate_l11_gpu3;
  Gate_l11_gpu4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l11_gpu4 -> Gate_l11_gpu4;
  Gate_l11_gpu5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l11_gpu5 -> Gate_l11_gpu5;
  Gate_l11_gpu6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l11_gpu6 -> Gate_l11_gpu6;
  Gate_l11_gpu7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l11_gpu7 -> Gate_l11_gpu7;
  Gate_l11_gpu8 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l11_gpu8 -> Gate_l11_gpu8;
  Gate_l11_gpu9 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l11_gpu9 -> Gate_l11_gpu9;
  Gate_l11_gpu10 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l11_gpu10 -> Gate_l11_gpu10;
  Gate_l11_gpu11 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l11_gpu11 -> Gate_l11_gpu11;
  Gate_l11_gpu12 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l11_gpu12 -> Gate_l11_gpu12;
  Gate_l11_gpu13 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l11_gpu13 -> Gate_l11_gpu13;
  Gate_l11_gpu14 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l11_gpu14 -> Gate_l11_gpu14;
  Gate_l11_gpu15 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l11_gpu15 -> Gate_l11_gpu15;
  Expert_l11_gpu0 [label="Expert_l11\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l11_gpu0 -> Expert_l11_gpu0 [style=dashed];
  Expert_l11_gpu1 [label="Expert_l11\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l11_gpu1 -> Expert_l11_gpu1 [style=dashed];
  Expert_l11_gpu2 [label="Expert_l11\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l11_gpu2 -> Expert_l11_gpu2 [style=dashed];
  Expert_l11_gpu3 [label="Expert_l11\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l11_gpu3 -> Expert_l11_gpu3 [style=dashed];
  Expert_l11_gpu4 [label="Expert_l11\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l11_gpu4 -> Expert_l11_gpu4 [style=dashed];
  Expert_l11_gpu5 [label="Expert_l11\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l11_gpu5 -> Expert_l11_gpu5 [style=dashed];
  Expert_l11_gpu6 [label="Expert_l11\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l11_gpu6 -> Expert_l11_gpu6 [style=dashed];
  Expert_l11_gpu7 [label="Expert_l11\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l11_gpu7 -> Expert_l11_gpu7 [style=dashed];
  Expert_l11_gpu8 [label="Expert_l11\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l11_gpu8 -> Expert_l11_gpu8 [style=dashed];
  Expert_l11_gpu9 [label="Expert_l11\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l11_gpu9 -> Expert_l11_gpu9 [style=dashed];
  Expert_l11_gpu10 [label="Expert_l11\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l11_gpu10 -> Expert_l11_gpu10 [style=dashed];
  Expert_l11_gpu11 [label="Expert_l11\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l11_gpu11 -> Expert_l11_gpu11 [style=dashed];
  Expert_l11_gpu12 [label="Expert_l11\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l11_gpu12 -> Expert_l11_gpu12 [style=dashed];
  Expert_l11_gpu13 [label="Expert_l11\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l11_gpu13 -> Expert_l11_gpu13 [style=dashed];
  Expert_l11_gpu14 [label="Expert_l11\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l11_gpu14 -> Expert_l11_gpu14 [style=dashed];
  Expert_l11_gpu15 [label="Expert_l11\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l11_gpu15 -> Expert_l11_gpu15 [style=dashed];
  AR_exp_l11 [shape=ellipse, label="AllReduceExperts\nall16GPUs\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert_l11_gpu0 -> AR_exp_l11;
  Expert_l11_gpu1 -> AR_exp_l11;
  Expert_l11_gpu2 -> AR_exp_l11;
  Expert_l11_gpu3 -> AR_exp_l11;
  Expert_l11_gpu4 -> AR_exp_l11;
  Expert_l11_gpu5 -> AR_exp_l11;
  Expert_l11_gpu6 -> AR_exp_l11;
  Expert_l11_gpu7 -> AR_exp_l11;
  Expert_l11_gpu8 -> AR_exp_l11;
  Expert_l11_gpu9 -> AR_exp_l11;
  Expert_l11_gpu10 -> AR_exp_l11;
  Expert_l11_gpu11 -> AR_exp_l11;
  Expert_l11_gpu12 -> AR_exp_l11;
  Expert_l11_gpu13 -> AR_exp_l11;
  Expert_l11_gpu14 -> AR_exp_l11;
  Expert_l11_gpu15 -> AR_exp_l11;
  ResMOE_l11_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l11 -> ResMOE_l11_gpu0;
  ResAttn_l11_gpu0 -> ResMOE_l11_gpu0;
  ResMOE_l11_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l11 -> ResMOE_l11_gpu1;
  ResAttn_l11_gpu1 -> ResMOE_l11_gpu1;
  ResMOE_l11_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l11 -> ResMOE_l11_gpu2;
  ResAttn_l11_gpu2 -> ResMOE_l11_gpu2;
  ResMOE_l11_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l11 -> ResMOE_l11_gpu3;
  ResAttn_l11_gpu3 -> ResMOE_l11_gpu3;
  ResMOE_l11_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l11 -> ResMOE_l11_gpu4;
  ResAttn_l11_gpu4 -> ResMOE_l11_gpu4;
  ResMOE_l11_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l11 -> ResMOE_l11_gpu5;
  ResAttn_l11_gpu5 -> ResMOE_l11_gpu5;
  ResMOE_l11_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l11 -> ResMOE_l11_gpu6;
  ResAttn_l11_gpu6 -> ResMOE_l11_gpu6;
  ResMOE_l11_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l11 -> ResMOE_l11_gpu7;
  ResAttn_l11_gpu7 -> ResMOE_l11_gpu7;
  ResMOE_l11_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l11 -> ResMOE_l11_gpu8;
  ResAttn_l11_gpu8 -> ResMOE_l11_gpu8;
  ResMOE_l11_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l11 -> ResMOE_l11_gpu9;
  ResAttn_l11_gpu9 -> ResMOE_l11_gpu9;
  ResMOE_l11_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l11 -> ResMOE_l11_gpu10;
  ResAttn_l11_gpu10 -> ResMOE_l11_gpu10;
  ResMOE_l11_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l11 -> ResMOE_l11_gpu11;
  ResAttn_l11_gpu11 -> ResMOE_l11_gpu11;
  ResMOE_l11_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l11 -> ResMOE_l11_gpu12;
  ResAttn_l11_gpu12 -> ResMOE_l11_gpu12;
  ResMOE_l11_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l11 -> ResMOE_l11_gpu13;
  ResAttn_l11_gpu13 -> ResMOE_l11_gpu13;
  ResMOE_l11_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l11 -> ResMOE_l11_gpu14;
  ResAttn_l11_gpu14 -> ResMOE_l11_gpu14;
  ResMOE_l11_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l11 -> ResMOE_l11_gpu15;
  ResAttn_l11_gpu15 -> ResMOE_l11_gpu15;
  QKV_l12_gpu0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l11_gpu0 -> QKV_l12_gpu0;
  QKV_l12_gpu1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l11_gpu0 -> QKV_l12_gpu1;
  QKV_l12_gpu2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l11_gpu0 -> QKV_l12_gpu2;
  QKV_l12_gpu3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l11_gpu0 -> QKV_l12_gpu3;
  QKV_l12_gpu4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l11_gpu0 -> QKV_l12_gpu4;
  QKV_l12_gpu5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l11_gpu0 -> QKV_l12_gpu5;
  QKV_l12_gpu6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l11_gpu0 -> QKV_l12_gpu6;
  QKV_l12_gpu7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l11_gpu0 -> QKV_l12_gpu7;
  QKV_l12_gpu8 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l11_gpu0 -> QKV_l12_gpu8;
  QKV_l12_gpu9 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l11_gpu0 -> QKV_l12_gpu9;
  QKV_l12_gpu10 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l11_gpu0 -> QKV_l12_gpu10;
  QKV_l12_gpu11 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l11_gpu0 -> QKV_l12_gpu11;
  QKV_l12_gpu12 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l11_gpu0 -> QKV_l12_gpu12;
  QKV_l12_gpu13 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l11_gpu0 -> QKV_l12_gpu13;
  QKV_l12_gpu14 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l11_gpu0 -> QKV_l12_gpu14;
  QKV_l12_gpu15 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l11_gpu0 -> QKV_l12_gpu15;
  SplitHeads_l12_gpu0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l12_gpu0 -> SplitHeads_l12_gpu0;
  SplitHeads_l12_gpu1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l12_gpu1 -> SplitHeads_l12_gpu1;
  SplitHeads_l12_gpu2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l12_gpu2 -> SplitHeads_l12_gpu2;
  SplitHeads_l12_gpu3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l12_gpu3 -> SplitHeads_l12_gpu3;
  SplitHeads_l12_gpu4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l12_gpu4 -> SplitHeads_l12_gpu4;
  SplitHeads_l12_gpu5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l12_gpu5 -> SplitHeads_l12_gpu5;
  SplitHeads_l12_gpu6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l12_gpu6 -> SplitHeads_l12_gpu6;
  SplitHeads_l12_gpu7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l12_gpu7 -> SplitHeads_l12_gpu7;
  SplitHeads_l12_gpu8 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l12_gpu8 -> SplitHeads_l12_gpu8;
  SplitHeads_l12_gpu9 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l12_gpu9 -> SplitHeads_l12_gpu9;
  SplitHeads_l12_gpu10 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l12_gpu10 -> SplitHeads_l12_gpu10;
  SplitHeads_l12_gpu11 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l12_gpu11 -> SplitHeads_l12_gpu11;
  SplitHeads_l12_gpu12 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l12_gpu12 -> SplitHeads_l12_gpu12;
  SplitHeads_l12_gpu13 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l12_gpu13 -> SplitHeads_l12_gpu13;
  SplitHeads_l12_gpu14 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l12_gpu14 -> SplitHeads_l12_gpu14;
  SplitHeads_l12_gpu15 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l12_gpu15 -> SplitHeads_l12_gpu15;
  A2A_l12 [shape=ellipse, label="AllToAll\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_l12_gpu0 -> A2A_l12;
  SplitHeads_l12_gpu1 -> A2A_l12;
  SplitHeads_l12_gpu2 -> A2A_l12;
  SplitHeads_l12_gpu3 -> A2A_l12;
  SplitHeads_l12_gpu4 -> A2A_l12;
  SplitHeads_l12_gpu5 -> A2A_l12;
  SplitHeads_l12_gpu6 -> A2A_l12;
  SplitHeads_l12_gpu7 -> A2A_l12;
  SplitHeads_l12_gpu8 -> A2A_l12;
  SplitHeads_l12_gpu9 -> A2A_l12;
  SplitHeads_l12_gpu10 -> A2A_l12;
  SplitHeads_l12_gpu11 -> A2A_l12;
  SplitHeads_l12_gpu12 -> A2A_l12;
  SplitHeads_l12_gpu13 -> A2A_l12;
  SplitHeads_l12_gpu14 -> A2A_l12;
  SplitHeads_l12_gpu15 -> A2A_l12;
  Attn_l12_gpu0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l12 -> Attn_l12_gpu0;
  Attn_l12_gpu1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l12 -> Attn_l12_gpu1;
  Attn_l12_gpu2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l12 -> Attn_l12_gpu2;
  Attn_l12_gpu3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l12 -> Attn_l12_gpu3;
  Attn_l12_gpu4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l12 -> Attn_l12_gpu4;
  Attn_l12_gpu5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l12 -> Attn_l12_gpu5;
  Attn_l12_gpu6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l12 -> Attn_l12_gpu6;
  Attn_l12_gpu7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l12 -> Attn_l12_gpu7;
  Attn_l12_gpu8 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l12 -> Attn_l12_gpu8;
  Attn_l12_gpu9 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l12 -> Attn_l12_gpu9;
  Attn_l12_gpu10 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l12 -> Attn_l12_gpu10;
  Attn_l12_gpu11 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l12 -> Attn_l12_gpu11;
  Attn_l12_gpu12 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l12 -> Attn_l12_gpu12;
  Attn_l12_gpu13 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l12 -> Attn_l12_gpu13;
  Attn_l12_gpu14 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l12 -> Attn_l12_gpu14;
  Attn_l12_gpu15 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l12 -> Attn_l12_gpu15;
  AR_attn_l12 [shape=ellipse, label="AllReduce\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_l12_gpu0 -> AR_attn_l12;
  Attn_l12_gpu1 -> AR_attn_l12;
  Attn_l12_gpu2 -> AR_attn_l12;
  Attn_l12_gpu3 -> AR_attn_l12;
  Attn_l12_gpu4 -> AR_attn_l12;
  Attn_l12_gpu5 -> AR_attn_l12;
  Attn_l12_gpu6 -> AR_attn_l12;
  Attn_l12_gpu7 -> AR_attn_l12;
  Attn_l12_gpu8 -> AR_attn_l12;
  Attn_l12_gpu9 -> AR_attn_l12;
  Attn_l12_gpu10 -> AR_attn_l12;
  Attn_l12_gpu11 -> AR_attn_l12;
  Attn_l12_gpu12 -> AR_attn_l12;
  Attn_l12_gpu13 -> AR_attn_l12;
  Attn_l12_gpu14 -> AR_attn_l12;
  Attn_l12_gpu15 -> AR_attn_l12;
  O_l12_gpu0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l12 -> O_l12_gpu0;
  O_l12_gpu1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l12 -> O_l12_gpu1;
  O_l12_gpu2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l12 -> O_l12_gpu2;
  O_l12_gpu3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l12 -> O_l12_gpu3;
  O_l12_gpu4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l12 -> O_l12_gpu4;
  O_l12_gpu5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l12 -> O_l12_gpu5;
  O_l12_gpu6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l12 -> O_l12_gpu6;
  O_l12_gpu7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l12 -> O_l12_gpu7;
  O_l12_gpu8 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l12 -> O_l12_gpu8;
  O_l12_gpu9 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l12 -> O_l12_gpu9;
  O_l12_gpu10 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l12 -> O_l12_gpu10;
  O_l12_gpu11 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l12 -> O_l12_gpu11;
  O_l12_gpu12 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l12 -> O_l12_gpu12;
  O_l12_gpu13 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l12 -> O_l12_gpu13;
  O_l12_gpu14 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l12 -> O_l12_gpu14;
  O_l12_gpu15 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l12 -> O_l12_gpu15;
  ResAttn_l12_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l12_gpu0 -> ResAttn_l12_gpu0;
  ResMOE_l11_gpu0 -> ResAttn_l12_gpu0;
  ResAttn_l12_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l12_gpu1 -> ResAttn_l12_gpu1;
  ResMOE_l11_gpu0 -> ResAttn_l12_gpu1;
  ResAttn_l12_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l12_gpu2 -> ResAttn_l12_gpu2;
  ResMOE_l11_gpu0 -> ResAttn_l12_gpu2;
  ResAttn_l12_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l12_gpu3 -> ResAttn_l12_gpu3;
  ResMOE_l11_gpu0 -> ResAttn_l12_gpu3;
  ResAttn_l12_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l12_gpu4 -> ResAttn_l12_gpu4;
  ResMOE_l11_gpu0 -> ResAttn_l12_gpu4;
  ResAttn_l12_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l12_gpu5 -> ResAttn_l12_gpu5;
  ResMOE_l11_gpu0 -> ResAttn_l12_gpu5;
  ResAttn_l12_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l12_gpu6 -> ResAttn_l12_gpu6;
  ResMOE_l11_gpu0 -> ResAttn_l12_gpu6;
  ResAttn_l12_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l12_gpu7 -> ResAttn_l12_gpu7;
  ResMOE_l11_gpu0 -> ResAttn_l12_gpu7;
  ResAttn_l12_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l12_gpu8 -> ResAttn_l12_gpu8;
  ResMOE_l11_gpu0 -> ResAttn_l12_gpu8;
  ResAttn_l12_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l12_gpu9 -> ResAttn_l12_gpu9;
  ResMOE_l11_gpu0 -> ResAttn_l12_gpu9;
  ResAttn_l12_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l12_gpu10 -> ResAttn_l12_gpu10;
  ResMOE_l11_gpu0 -> ResAttn_l12_gpu10;
  ResAttn_l12_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l12_gpu11 -> ResAttn_l12_gpu11;
  ResMOE_l11_gpu0 -> ResAttn_l12_gpu11;
  ResAttn_l12_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l12_gpu12 -> ResAttn_l12_gpu12;
  ResMOE_l11_gpu0 -> ResAttn_l12_gpu12;
  ResAttn_l12_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l12_gpu13 -> ResAttn_l12_gpu13;
  ResMOE_l11_gpu0 -> ResAttn_l12_gpu13;
  ResAttn_l12_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l12_gpu14 -> ResAttn_l12_gpu14;
  ResMOE_l11_gpu0 -> ResAttn_l12_gpu14;
  ResAttn_l12_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l12_gpu15 -> ResAttn_l12_gpu15;
  ResMOE_l11_gpu0 -> ResAttn_l12_gpu15;
  Gate_l12_gpu0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l12_gpu0 -> Gate_l12_gpu0;
  Gate_l12_gpu1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l12_gpu1 -> Gate_l12_gpu1;
  Gate_l12_gpu2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l12_gpu2 -> Gate_l12_gpu2;
  Gate_l12_gpu3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l12_gpu3 -> Gate_l12_gpu3;
  Gate_l12_gpu4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l12_gpu4 -> Gate_l12_gpu4;
  Gate_l12_gpu5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l12_gpu5 -> Gate_l12_gpu5;
  Gate_l12_gpu6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l12_gpu6 -> Gate_l12_gpu6;
  Gate_l12_gpu7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l12_gpu7 -> Gate_l12_gpu7;
  Gate_l12_gpu8 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l12_gpu8 -> Gate_l12_gpu8;
  Gate_l12_gpu9 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l12_gpu9 -> Gate_l12_gpu9;
  Gate_l12_gpu10 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l12_gpu10 -> Gate_l12_gpu10;
  Gate_l12_gpu11 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l12_gpu11 -> Gate_l12_gpu11;
  Gate_l12_gpu12 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l12_gpu12 -> Gate_l12_gpu12;
  Gate_l12_gpu13 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l12_gpu13 -> Gate_l12_gpu13;
  Gate_l12_gpu14 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l12_gpu14 -> Gate_l12_gpu14;
  Gate_l12_gpu15 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l12_gpu15 -> Gate_l12_gpu15;
  Expert_l12_gpu0 [label="Expert_l12\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l12_gpu0 -> Expert_l12_gpu0 [style=dashed];
  Expert_l12_gpu1 [label="Expert_l12\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l12_gpu1 -> Expert_l12_gpu1 [style=dashed];
  Expert_l12_gpu2 [label="Expert_l12\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l12_gpu2 -> Expert_l12_gpu2 [style=dashed];
  Expert_l12_gpu3 [label="Expert_l12\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l12_gpu3 -> Expert_l12_gpu3 [style=dashed];
  Expert_l12_gpu4 [label="Expert_l12\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l12_gpu4 -> Expert_l12_gpu4 [style=dashed];
  Expert_l12_gpu5 [label="Expert_l12\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l12_gpu5 -> Expert_l12_gpu5 [style=dashed];
  Expert_l12_gpu6 [label="Expert_l12\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l12_gpu6 -> Expert_l12_gpu6 [style=dashed];
  Expert_l12_gpu7 [label="Expert_l12\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l12_gpu7 -> Expert_l12_gpu7 [style=dashed];
  Expert_l12_gpu8 [label="Expert_l12\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l12_gpu8 -> Expert_l12_gpu8 [style=dashed];
  Expert_l12_gpu9 [label="Expert_l12\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l12_gpu9 -> Expert_l12_gpu9 [style=dashed];
  Expert_l12_gpu10 [label="Expert_l12\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l12_gpu10 -> Expert_l12_gpu10 [style=dashed];
  Expert_l12_gpu11 [label="Expert_l12\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l12_gpu11 -> Expert_l12_gpu11 [style=dashed];
  Expert_l12_gpu12 [label="Expert_l12\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l12_gpu12 -> Expert_l12_gpu12 [style=dashed];
  Expert_l12_gpu13 [label="Expert_l12\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l12_gpu13 -> Expert_l12_gpu13 [style=dashed];
  Expert_l12_gpu14 [label="Expert_l12\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l12_gpu14 -> Expert_l12_gpu14 [style=dashed];
  Expert_l12_gpu15 [label="Expert_l12\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l12_gpu15 -> Expert_l12_gpu15 [style=dashed];
  AR_exp_l12 [shape=ellipse, label="AllReduceExperts\nall16GPUs\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert_l12_gpu0 -> AR_exp_l12;
  Expert_l12_gpu1 -> AR_exp_l12;
  Expert_l12_gpu2 -> AR_exp_l12;
  Expert_l12_gpu3 -> AR_exp_l12;
  Expert_l12_gpu4 -> AR_exp_l12;
  Expert_l12_gpu5 -> AR_exp_l12;
  Expert_l12_gpu6 -> AR_exp_l12;
  Expert_l12_gpu7 -> AR_exp_l12;
  Expert_l12_gpu8 -> AR_exp_l12;
  Expert_l12_gpu9 -> AR_exp_l12;
  Expert_l12_gpu10 -> AR_exp_l12;
  Expert_l12_gpu11 -> AR_exp_l12;
  Expert_l12_gpu12 -> AR_exp_l12;
  Expert_l12_gpu13 -> AR_exp_l12;
  Expert_l12_gpu14 -> AR_exp_l12;
  Expert_l12_gpu15 -> AR_exp_l12;
  ResMOE_l12_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l12 -> ResMOE_l12_gpu0;
  ResAttn_l12_gpu0 -> ResMOE_l12_gpu0;
  ResMOE_l12_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l12 -> ResMOE_l12_gpu1;
  ResAttn_l12_gpu1 -> ResMOE_l12_gpu1;
  ResMOE_l12_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l12 -> ResMOE_l12_gpu2;
  ResAttn_l12_gpu2 -> ResMOE_l12_gpu2;
  ResMOE_l12_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l12 -> ResMOE_l12_gpu3;
  ResAttn_l12_gpu3 -> ResMOE_l12_gpu3;
  ResMOE_l12_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l12 -> ResMOE_l12_gpu4;
  ResAttn_l12_gpu4 -> ResMOE_l12_gpu4;
  ResMOE_l12_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l12 -> ResMOE_l12_gpu5;
  ResAttn_l12_gpu5 -> ResMOE_l12_gpu5;
  ResMOE_l12_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l12 -> ResMOE_l12_gpu6;
  ResAttn_l12_gpu6 -> ResMOE_l12_gpu6;
  ResMOE_l12_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l12 -> ResMOE_l12_gpu7;
  ResAttn_l12_gpu7 -> ResMOE_l12_gpu7;
  ResMOE_l12_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l12 -> ResMOE_l12_gpu8;
  ResAttn_l12_gpu8 -> ResMOE_l12_gpu8;
  ResMOE_l12_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l12 -> ResMOE_l12_gpu9;
  ResAttn_l12_gpu9 -> ResMOE_l12_gpu9;
  ResMOE_l12_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l12 -> ResMOE_l12_gpu10;
  ResAttn_l12_gpu10 -> ResMOE_l12_gpu10;
  ResMOE_l12_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l12 -> ResMOE_l12_gpu11;
  ResAttn_l12_gpu11 -> ResMOE_l12_gpu11;
  ResMOE_l12_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l12 -> ResMOE_l12_gpu12;
  ResAttn_l12_gpu12 -> ResMOE_l12_gpu12;
  ResMOE_l12_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l12 -> ResMOE_l12_gpu13;
  ResAttn_l12_gpu13 -> ResMOE_l12_gpu13;
  ResMOE_l12_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l12 -> ResMOE_l12_gpu14;
  ResAttn_l12_gpu14 -> ResMOE_l12_gpu14;
  ResMOE_l12_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l12 -> ResMOE_l12_gpu15;
  ResAttn_l12_gpu15 -> ResMOE_l12_gpu15;
  QKV_l13_gpu0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l12_gpu0 -> QKV_l13_gpu0;
  QKV_l13_gpu1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l12_gpu0 -> QKV_l13_gpu1;
  QKV_l13_gpu2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l12_gpu0 -> QKV_l13_gpu2;
  QKV_l13_gpu3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l12_gpu0 -> QKV_l13_gpu3;
  QKV_l13_gpu4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l12_gpu0 -> QKV_l13_gpu4;
  QKV_l13_gpu5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l12_gpu0 -> QKV_l13_gpu5;
  QKV_l13_gpu6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l12_gpu0 -> QKV_l13_gpu6;
  QKV_l13_gpu7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l12_gpu0 -> QKV_l13_gpu7;
  QKV_l13_gpu8 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l12_gpu0 -> QKV_l13_gpu8;
  QKV_l13_gpu9 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l12_gpu0 -> QKV_l13_gpu9;
  QKV_l13_gpu10 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l12_gpu0 -> QKV_l13_gpu10;
  QKV_l13_gpu11 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l12_gpu0 -> QKV_l13_gpu11;
  QKV_l13_gpu12 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l12_gpu0 -> QKV_l13_gpu12;
  QKV_l13_gpu13 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l12_gpu0 -> QKV_l13_gpu13;
  QKV_l13_gpu14 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l12_gpu0 -> QKV_l13_gpu14;
  QKV_l13_gpu15 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l12_gpu0 -> QKV_l13_gpu15;
  SplitHeads_l13_gpu0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l13_gpu0 -> SplitHeads_l13_gpu0;
  SplitHeads_l13_gpu1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l13_gpu1 -> SplitHeads_l13_gpu1;
  SplitHeads_l13_gpu2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l13_gpu2 -> SplitHeads_l13_gpu2;
  SplitHeads_l13_gpu3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l13_gpu3 -> SplitHeads_l13_gpu3;
  SplitHeads_l13_gpu4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l13_gpu4 -> SplitHeads_l13_gpu4;
  SplitHeads_l13_gpu5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l13_gpu5 -> SplitHeads_l13_gpu5;
  SplitHeads_l13_gpu6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l13_gpu6 -> SplitHeads_l13_gpu6;
  SplitHeads_l13_gpu7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l13_gpu7 -> SplitHeads_l13_gpu7;
  SplitHeads_l13_gpu8 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l13_gpu8 -> SplitHeads_l13_gpu8;
  SplitHeads_l13_gpu9 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l13_gpu9 -> SplitHeads_l13_gpu9;
  SplitHeads_l13_gpu10 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l13_gpu10 -> SplitHeads_l13_gpu10;
  SplitHeads_l13_gpu11 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l13_gpu11 -> SplitHeads_l13_gpu11;
  SplitHeads_l13_gpu12 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l13_gpu12 -> SplitHeads_l13_gpu12;
  SplitHeads_l13_gpu13 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l13_gpu13 -> SplitHeads_l13_gpu13;
  SplitHeads_l13_gpu14 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l13_gpu14 -> SplitHeads_l13_gpu14;
  SplitHeads_l13_gpu15 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l13_gpu15 -> SplitHeads_l13_gpu15;
  A2A_l13 [shape=ellipse, label="AllToAll\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_l13_gpu0 -> A2A_l13;
  SplitHeads_l13_gpu1 -> A2A_l13;
  SplitHeads_l13_gpu2 -> A2A_l13;
  SplitHeads_l13_gpu3 -> A2A_l13;
  SplitHeads_l13_gpu4 -> A2A_l13;
  SplitHeads_l13_gpu5 -> A2A_l13;
  SplitHeads_l13_gpu6 -> A2A_l13;
  SplitHeads_l13_gpu7 -> A2A_l13;
  SplitHeads_l13_gpu8 -> A2A_l13;
  SplitHeads_l13_gpu9 -> A2A_l13;
  SplitHeads_l13_gpu10 -> A2A_l13;
  SplitHeads_l13_gpu11 -> A2A_l13;
  SplitHeads_l13_gpu12 -> A2A_l13;
  SplitHeads_l13_gpu13 -> A2A_l13;
  SplitHeads_l13_gpu14 -> A2A_l13;
  SplitHeads_l13_gpu15 -> A2A_l13;
  Attn_l13_gpu0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l13 -> Attn_l13_gpu0;
  Attn_l13_gpu1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l13 -> Attn_l13_gpu1;
  Attn_l13_gpu2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l13 -> Attn_l13_gpu2;
  Attn_l13_gpu3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l13 -> Attn_l13_gpu3;
  Attn_l13_gpu4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l13 -> Attn_l13_gpu4;
  Attn_l13_gpu5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l13 -> Attn_l13_gpu5;
  Attn_l13_gpu6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l13 -> Attn_l13_gpu6;
  Attn_l13_gpu7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l13 -> Attn_l13_gpu7;
  Attn_l13_gpu8 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l13 -> Attn_l13_gpu8;
  Attn_l13_gpu9 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l13 -> Attn_l13_gpu9;
  Attn_l13_gpu10 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l13 -> Attn_l13_gpu10;
  Attn_l13_gpu11 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l13 -> Attn_l13_gpu11;
  Attn_l13_gpu12 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l13 -> Attn_l13_gpu12;
  Attn_l13_gpu13 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l13 -> Attn_l13_gpu13;
  Attn_l13_gpu14 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l13 -> Attn_l13_gpu14;
  Attn_l13_gpu15 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l13 -> Attn_l13_gpu15;
  AR_attn_l13 [shape=ellipse, label="AllReduce\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_l13_gpu0 -> AR_attn_l13;
  Attn_l13_gpu1 -> AR_attn_l13;
  Attn_l13_gpu2 -> AR_attn_l13;
  Attn_l13_gpu3 -> AR_attn_l13;
  Attn_l13_gpu4 -> AR_attn_l13;
  Attn_l13_gpu5 -> AR_attn_l13;
  Attn_l13_gpu6 -> AR_attn_l13;
  Attn_l13_gpu7 -> AR_attn_l13;
  Attn_l13_gpu8 -> AR_attn_l13;
  Attn_l13_gpu9 -> AR_attn_l13;
  Attn_l13_gpu10 -> AR_attn_l13;
  Attn_l13_gpu11 -> AR_attn_l13;
  Attn_l13_gpu12 -> AR_attn_l13;
  Attn_l13_gpu13 -> AR_attn_l13;
  Attn_l13_gpu14 -> AR_attn_l13;
  Attn_l13_gpu15 -> AR_attn_l13;
  O_l13_gpu0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l13 -> O_l13_gpu0;
  O_l13_gpu1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l13 -> O_l13_gpu1;
  O_l13_gpu2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l13 -> O_l13_gpu2;
  O_l13_gpu3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l13 -> O_l13_gpu3;
  O_l13_gpu4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l13 -> O_l13_gpu4;
  O_l13_gpu5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l13 -> O_l13_gpu5;
  O_l13_gpu6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l13 -> O_l13_gpu6;
  O_l13_gpu7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l13 -> O_l13_gpu7;
  O_l13_gpu8 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l13 -> O_l13_gpu8;
  O_l13_gpu9 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l13 -> O_l13_gpu9;
  O_l13_gpu10 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l13 -> O_l13_gpu10;
  O_l13_gpu11 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l13 -> O_l13_gpu11;
  O_l13_gpu12 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l13 -> O_l13_gpu12;
  O_l13_gpu13 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l13 -> O_l13_gpu13;
  O_l13_gpu14 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l13 -> O_l13_gpu14;
  O_l13_gpu15 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l13 -> O_l13_gpu15;
  ResAttn_l13_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l13_gpu0 -> ResAttn_l13_gpu0;
  ResMOE_l12_gpu0 -> ResAttn_l13_gpu0;
  ResAttn_l13_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l13_gpu1 -> ResAttn_l13_gpu1;
  ResMOE_l12_gpu0 -> ResAttn_l13_gpu1;
  ResAttn_l13_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l13_gpu2 -> ResAttn_l13_gpu2;
  ResMOE_l12_gpu0 -> ResAttn_l13_gpu2;
  ResAttn_l13_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l13_gpu3 -> ResAttn_l13_gpu3;
  ResMOE_l12_gpu0 -> ResAttn_l13_gpu3;
  ResAttn_l13_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l13_gpu4 -> ResAttn_l13_gpu4;
  ResMOE_l12_gpu0 -> ResAttn_l13_gpu4;
  ResAttn_l13_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l13_gpu5 -> ResAttn_l13_gpu5;
  ResMOE_l12_gpu0 -> ResAttn_l13_gpu5;
  ResAttn_l13_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l13_gpu6 -> ResAttn_l13_gpu6;
  ResMOE_l12_gpu0 -> ResAttn_l13_gpu6;
  ResAttn_l13_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l13_gpu7 -> ResAttn_l13_gpu7;
  ResMOE_l12_gpu0 -> ResAttn_l13_gpu7;
  ResAttn_l13_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l13_gpu8 -> ResAttn_l13_gpu8;
  ResMOE_l12_gpu0 -> ResAttn_l13_gpu8;
  ResAttn_l13_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l13_gpu9 -> ResAttn_l13_gpu9;
  ResMOE_l12_gpu0 -> ResAttn_l13_gpu9;
  ResAttn_l13_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l13_gpu10 -> ResAttn_l13_gpu10;
  ResMOE_l12_gpu0 -> ResAttn_l13_gpu10;
  ResAttn_l13_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l13_gpu11 -> ResAttn_l13_gpu11;
  ResMOE_l12_gpu0 -> ResAttn_l13_gpu11;
  ResAttn_l13_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l13_gpu12 -> ResAttn_l13_gpu12;
  ResMOE_l12_gpu0 -> ResAttn_l13_gpu12;
  ResAttn_l13_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l13_gpu13 -> ResAttn_l13_gpu13;
  ResMOE_l12_gpu0 -> ResAttn_l13_gpu13;
  ResAttn_l13_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l13_gpu14 -> ResAttn_l13_gpu14;
  ResMOE_l12_gpu0 -> ResAttn_l13_gpu14;
  ResAttn_l13_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l13_gpu15 -> ResAttn_l13_gpu15;
  ResMOE_l12_gpu0 -> ResAttn_l13_gpu15;
  Gate_l13_gpu0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l13_gpu0 -> Gate_l13_gpu0;
  Gate_l13_gpu1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l13_gpu1 -> Gate_l13_gpu1;
  Gate_l13_gpu2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l13_gpu2 -> Gate_l13_gpu2;
  Gate_l13_gpu3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l13_gpu3 -> Gate_l13_gpu3;
  Gate_l13_gpu4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l13_gpu4 -> Gate_l13_gpu4;
  Gate_l13_gpu5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l13_gpu5 -> Gate_l13_gpu5;
  Gate_l13_gpu6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l13_gpu6 -> Gate_l13_gpu6;
  Gate_l13_gpu7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l13_gpu7 -> Gate_l13_gpu7;
  Gate_l13_gpu8 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l13_gpu8 -> Gate_l13_gpu8;
  Gate_l13_gpu9 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l13_gpu9 -> Gate_l13_gpu9;
  Gate_l13_gpu10 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l13_gpu10 -> Gate_l13_gpu10;
  Gate_l13_gpu11 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l13_gpu11 -> Gate_l13_gpu11;
  Gate_l13_gpu12 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l13_gpu12 -> Gate_l13_gpu12;
  Gate_l13_gpu13 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l13_gpu13 -> Gate_l13_gpu13;
  Gate_l13_gpu14 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l13_gpu14 -> Gate_l13_gpu14;
  Gate_l13_gpu15 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l13_gpu15 -> Gate_l13_gpu15;
  Expert_l13_gpu0 [label="Expert_l13\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l13_gpu0 -> Expert_l13_gpu0 [style=dashed];
  Expert_l13_gpu1 [label="Expert_l13\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l13_gpu1 -> Expert_l13_gpu1 [style=dashed];
  Expert_l13_gpu2 [label="Expert_l13\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l13_gpu2 -> Expert_l13_gpu2 [style=dashed];
  Expert_l13_gpu3 [label="Expert_l13\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l13_gpu3 -> Expert_l13_gpu3 [style=dashed];
  Expert_l13_gpu4 [label="Expert_l13\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l13_gpu4 -> Expert_l13_gpu4 [style=dashed];
  Expert_l13_gpu5 [label="Expert_l13\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l13_gpu5 -> Expert_l13_gpu5 [style=dashed];
  Expert_l13_gpu6 [label="Expert_l13\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l13_gpu6 -> Expert_l13_gpu6 [style=dashed];
  Expert_l13_gpu7 [label="Expert_l13\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l13_gpu7 -> Expert_l13_gpu7 [style=dashed];
  Expert_l13_gpu8 [label="Expert_l13\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l13_gpu8 -> Expert_l13_gpu8 [style=dashed];
  Expert_l13_gpu9 [label="Expert_l13\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l13_gpu9 -> Expert_l13_gpu9 [style=dashed];
  Expert_l13_gpu10 [label="Expert_l13\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l13_gpu10 -> Expert_l13_gpu10 [style=dashed];
  Expert_l13_gpu11 [label="Expert_l13\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l13_gpu11 -> Expert_l13_gpu11 [style=dashed];
  Expert_l13_gpu12 [label="Expert_l13\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l13_gpu12 -> Expert_l13_gpu12 [style=dashed];
  Expert_l13_gpu13 [label="Expert_l13\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l13_gpu13 -> Expert_l13_gpu13 [style=dashed];
  Expert_l13_gpu14 [label="Expert_l13\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l13_gpu14 -> Expert_l13_gpu14 [style=dashed];
  Expert_l13_gpu15 [label="Expert_l13\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l13_gpu15 -> Expert_l13_gpu15 [style=dashed];
  AR_exp_l13 [shape=ellipse, label="AllReduceExperts\nall16GPUs\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert_l13_gpu0 -> AR_exp_l13;
  Expert_l13_gpu1 -> AR_exp_l13;
  Expert_l13_gpu2 -> AR_exp_l13;
  Expert_l13_gpu3 -> AR_exp_l13;
  Expert_l13_gpu4 -> AR_exp_l13;
  Expert_l13_gpu5 -> AR_exp_l13;
  Expert_l13_gpu6 -> AR_exp_l13;
  Expert_l13_gpu7 -> AR_exp_l13;
  Expert_l13_gpu8 -> AR_exp_l13;
  Expert_l13_gpu9 -> AR_exp_l13;
  Expert_l13_gpu10 -> AR_exp_l13;
  Expert_l13_gpu11 -> AR_exp_l13;
  Expert_l13_gpu12 -> AR_exp_l13;
  Expert_l13_gpu13 -> AR_exp_l13;
  Expert_l13_gpu14 -> AR_exp_l13;
  Expert_l13_gpu15 -> AR_exp_l13;
  ResMOE_l13_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l13 -> ResMOE_l13_gpu0;
  ResAttn_l13_gpu0 -> ResMOE_l13_gpu0;
  ResMOE_l13_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l13 -> ResMOE_l13_gpu1;
  ResAttn_l13_gpu1 -> ResMOE_l13_gpu1;
  ResMOE_l13_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l13 -> ResMOE_l13_gpu2;
  ResAttn_l13_gpu2 -> ResMOE_l13_gpu2;
  ResMOE_l13_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l13 -> ResMOE_l13_gpu3;
  ResAttn_l13_gpu3 -> ResMOE_l13_gpu3;
  ResMOE_l13_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l13 -> ResMOE_l13_gpu4;
  ResAttn_l13_gpu4 -> ResMOE_l13_gpu4;
  ResMOE_l13_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l13 -> ResMOE_l13_gpu5;
  ResAttn_l13_gpu5 -> ResMOE_l13_gpu5;
  ResMOE_l13_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l13 -> ResMOE_l13_gpu6;
  ResAttn_l13_gpu6 -> ResMOE_l13_gpu6;
  ResMOE_l13_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l13 -> ResMOE_l13_gpu7;
  ResAttn_l13_gpu7 -> ResMOE_l13_gpu7;
  ResMOE_l13_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l13 -> ResMOE_l13_gpu8;
  ResAttn_l13_gpu8 -> ResMOE_l13_gpu8;
  ResMOE_l13_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l13 -> ResMOE_l13_gpu9;
  ResAttn_l13_gpu9 -> ResMOE_l13_gpu9;
  ResMOE_l13_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l13 -> ResMOE_l13_gpu10;
  ResAttn_l13_gpu10 -> ResMOE_l13_gpu10;
  ResMOE_l13_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l13 -> ResMOE_l13_gpu11;
  ResAttn_l13_gpu11 -> ResMOE_l13_gpu11;
  ResMOE_l13_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l13 -> ResMOE_l13_gpu12;
  ResAttn_l13_gpu12 -> ResMOE_l13_gpu12;
  ResMOE_l13_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l13 -> ResMOE_l13_gpu13;
  ResAttn_l13_gpu13 -> ResMOE_l13_gpu13;
  ResMOE_l13_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l13 -> ResMOE_l13_gpu14;
  ResAttn_l13_gpu14 -> ResMOE_l13_gpu14;
  ResMOE_l13_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l13 -> ResMOE_l13_gpu15;
  ResAttn_l13_gpu15 -> ResMOE_l13_gpu15;
  QKV_l14_gpu0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l13_gpu0 -> QKV_l14_gpu0;
  QKV_l14_gpu1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l13_gpu0 -> QKV_l14_gpu1;
  QKV_l14_gpu2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l13_gpu0 -> QKV_l14_gpu2;
  QKV_l14_gpu3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l13_gpu0 -> QKV_l14_gpu3;
  QKV_l14_gpu4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l13_gpu0 -> QKV_l14_gpu4;
  QKV_l14_gpu5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l13_gpu0 -> QKV_l14_gpu5;
  QKV_l14_gpu6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l13_gpu0 -> QKV_l14_gpu6;
  QKV_l14_gpu7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l13_gpu0 -> QKV_l14_gpu7;
  QKV_l14_gpu8 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l13_gpu0 -> QKV_l14_gpu8;
  QKV_l14_gpu9 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l13_gpu0 -> QKV_l14_gpu9;
  QKV_l14_gpu10 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l13_gpu0 -> QKV_l14_gpu10;
  QKV_l14_gpu11 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l13_gpu0 -> QKV_l14_gpu11;
  QKV_l14_gpu12 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l13_gpu0 -> QKV_l14_gpu12;
  QKV_l14_gpu13 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l13_gpu0 -> QKV_l14_gpu13;
  QKV_l14_gpu14 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l13_gpu0 -> QKV_l14_gpu14;
  QKV_l14_gpu15 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l13_gpu0 -> QKV_l14_gpu15;
  SplitHeads_l14_gpu0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l14_gpu0 -> SplitHeads_l14_gpu0;
  SplitHeads_l14_gpu1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l14_gpu1 -> SplitHeads_l14_gpu1;
  SplitHeads_l14_gpu2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l14_gpu2 -> SplitHeads_l14_gpu2;
  SplitHeads_l14_gpu3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l14_gpu3 -> SplitHeads_l14_gpu3;
  SplitHeads_l14_gpu4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l14_gpu4 -> SplitHeads_l14_gpu4;
  SplitHeads_l14_gpu5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l14_gpu5 -> SplitHeads_l14_gpu5;
  SplitHeads_l14_gpu6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l14_gpu6 -> SplitHeads_l14_gpu6;
  SplitHeads_l14_gpu7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l14_gpu7 -> SplitHeads_l14_gpu7;
  SplitHeads_l14_gpu8 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l14_gpu8 -> SplitHeads_l14_gpu8;
  SplitHeads_l14_gpu9 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l14_gpu9 -> SplitHeads_l14_gpu9;
  SplitHeads_l14_gpu10 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l14_gpu10 -> SplitHeads_l14_gpu10;
  SplitHeads_l14_gpu11 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l14_gpu11 -> SplitHeads_l14_gpu11;
  SplitHeads_l14_gpu12 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l14_gpu12 -> SplitHeads_l14_gpu12;
  SplitHeads_l14_gpu13 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l14_gpu13 -> SplitHeads_l14_gpu13;
  SplitHeads_l14_gpu14 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l14_gpu14 -> SplitHeads_l14_gpu14;
  SplitHeads_l14_gpu15 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l14_gpu15 -> SplitHeads_l14_gpu15;
  A2A_l14 [shape=ellipse, label="AllToAll\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_l14_gpu0 -> A2A_l14;
  SplitHeads_l14_gpu1 -> A2A_l14;
  SplitHeads_l14_gpu2 -> A2A_l14;
  SplitHeads_l14_gpu3 -> A2A_l14;
  SplitHeads_l14_gpu4 -> A2A_l14;
  SplitHeads_l14_gpu5 -> A2A_l14;
  SplitHeads_l14_gpu6 -> A2A_l14;
  SplitHeads_l14_gpu7 -> A2A_l14;
  SplitHeads_l14_gpu8 -> A2A_l14;
  SplitHeads_l14_gpu9 -> A2A_l14;
  SplitHeads_l14_gpu10 -> A2A_l14;
  SplitHeads_l14_gpu11 -> A2A_l14;
  SplitHeads_l14_gpu12 -> A2A_l14;
  SplitHeads_l14_gpu13 -> A2A_l14;
  SplitHeads_l14_gpu14 -> A2A_l14;
  SplitHeads_l14_gpu15 -> A2A_l14;
  Attn_l14_gpu0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l14 -> Attn_l14_gpu0;
  Attn_l14_gpu1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l14 -> Attn_l14_gpu1;
  Attn_l14_gpu2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l14 -> Attn_l14_gpu2;
  Attn_l14_gpu3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l14 -> Attn_l14_gpu3;
  Attn_l14_gpu4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l14 -> Attn_l14_gpu4;
  Attn_l14_gpu5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l14 -> Attn_l14_gpu5;
  Attn_l14_gpu6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l14 -> Attn_l14_gpu6;
  Attn_l14_gpu7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l14 -> Attn_l14_gpu7;
  Attn_l14_gpu8 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l14 -> Attn_l14_gpu8;
  Attn_l14_gpu9 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l14 -> Attn_l14_gpu9;
  Attn_l14_gpu10 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l14 -> Attn_l14_gpu10;
  Attn_l14_gpu11 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l14 -> Attn_l14_gpu11;
  Attn_l14_gpu12 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l14 -> Attn_l14_gpu12;
  Attn_l14_gpu13 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l14 -> Attn_l14_gpu13;
  Attn_l14_gpu14 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l14 -> Attn_l14_gpu14;
  Attn_l14_gpu15 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l14 -> Attn_l14_gpu15;
  AR_attn_l14 [shape=ellipse, label="AllReduce\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_l14_gpu0 -> AR_attn_l14;
  Attn_l14_gpu1 -> AR_attn_l14;
  Attn_l14_gpu2 -> AR_attn_l14;
  Attn_l14_gpu3 -> AR_attn_l14;
  Attn_l14_gpu4 -> AR_attn_l14;
  Attn_l14_gpu5 -> AR_attn_l14;
  Attn_l14_gpu6 -> AR_attn_l14;
  Attn_l14_gpu7 -> AR_attn_l14;
  Attn_l14_gpu8 -> AR_attn_l14;
  Attn_l14_gpu9 -> AR_attn_l14;
  Attn_l14_gpu10 -> AR_attn_l14;
  Attn_l14_gpu11 -> AR_attn_l14;
  Attn_l14_gpu12 -> AR_attn_l14;
  Attn_l14_gpu13 -> AR_attn_l14;
  Attn_l14_gpu14 -> AR_attn_l14;
  Attn_l14_gpu15 -> AR_attn_l14;
  O_l14_gpu0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l14 -> O_l14_gpu0;
  O_l14_gpu1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l14 -> O_l14_gpu1;
  O_l14_gpu2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l14 -> O_l14_gpu2;
  O_l14_gpu3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l14 -> O_l14_gpu3;
  O_l14_gpu4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l14 -> O_l14_gpu4;
  O_l14_gpu5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l14 -> O_l14_gpu5;
  O_l14_gpu6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l14 -> O_l14_gpu6;
  O_l14_gpu7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l14 -> O_l14_gpu7;
  O_l14_gpu8 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l14 -> O_l14_gpu8;
  O_l14_gpu9 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l14 -> O_l14_gpu9;
  O_l14_gpu10 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l14 -> O_l14_gpu10;
  O_l14_gpu11 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l14 -> O_l14_gpu11;
  O_l14_gpu12 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l14 -> O_l14_gpu12;
  O_l14_gpu13 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l14 -> O_l14_gpu13;
  O_l14_gpu14 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l14 -> O_l14_gpu14;
  O_l14_gpu15 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l14 -> O_l14_gpu15;
  ResAttn_l14_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l14_gpu0 -> ResAttn_l14_gpu0;
  ResMOE_l13_gpu0 -> ResAttn_l14_gpu0;
  ResAttn_l14_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l14_gpu1 -> ResAttn_l14_gpu1;
  ResMOE_l13_gpu0 -> ResAttn_l14_gpu1;
  ResAttn_l14_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l14_gpu2 -> ResAttn_l14_gpu2;
  ResMOE_l13_gpu0 -> ResAttn_l14_gpu2;
  ResAttn_l14_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l14_gpu3 -> ResAttn_l14_gpu3;
  ResMOE_l13_gpu0 -> ResAttn_l14_gpu3;
  ResAttn_l14_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l14_gpu4 -> ResAttn_l14_gpu4;
  ResMOE_l13_gpu0 -> ResAttn_l14_gpu4;
  ResAttn_l14_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l14_gpu5 -> ResAttn_l14_gpu5;
  ResMOE_l13_gpu0 -> ResAttn_l14_gpu5;
  ResAttn_l14_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l14_gpu6 -> ResAttn_l14_gpu6;
  ResMOE_l13_gpu0 -> ResAttn_l14_gpu6;
  ResAttn_l14_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l14_gpu7 -> ResAttn_l14_gpu7;
  ResMOE_l13_gpu0 -> ResAttn_l14_gpu7;
  ResAttn_l14_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l14_gpu8 -> ResAttn_l14_gpu8;
  ResMOE_l13_gpu0 -> ResAttn_l14_gpu8;
  ResAttn_l14_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l14_gpu9 -> ResAttn_l14_gpu9;
  ResMOE_l13_gpu0 -> ResAttn_l14_gpu9;
  ResAttn_l14_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l14_gpu10 -> ResAttn_l14_gpu10;
  ResMOE_l13_gpu0 -> ResAttn_l14_gpu10;
  ResAttn_l14_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l14_gpu11 -> ResAttn_l14_gpu11;
  ResMOE_l13_gpu0 -> ResAttn_l14_gpu11;
  ResAttn_l14_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l14_gpu12 -> ResAttn_l14_gpu12;
  ResMOE_l13_gpu0 -> ResAttn_l14_gpu12;
  ResAttn_l14_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l14_gpu13 -> ResAttn_l14_gpu13;
  ResMOE_l13_gpu0 -> ResAttn_l14_gpu13;
  ResAttn_l14_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l14_gpu14 -> ResAttn_l14_gpu14;
  ResMOE_l13_gpu0 -> ResAttn_l14_gpu14;
  ResAttn_l14_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l14_gpu15 -> ResAttn_l14_gpu15;
  ResMOE_l13_gpu0 -> ResAttn_l14_gpu15;
  Gate_l14_gpu0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l14_gpu0 -> Gate_l14_gpu0;
  Gate_l14_gpu1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l14_gpu1 -> Gate_l14_gpu1;
  Gate_l14_gpu2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l14_gpu2 -> Gate_l14_gpu2;
  Gate_l14_gpu3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l14_gpu3 -> Gate_l14_gpu3;
  Gate_l14_gpu4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l14_gpu4 -> Gate_l14_gpu4;
  Gate_l14_gpu5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l14_gpu5 -> Gate_l14_gpu5;
  Gate_l14_gpu6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l14_gpu6 -> Gate_l14_gpu6;
  Gate_l14_gpu7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l14_gpu7 -> Gate_l14_gpu7;
  Gate_l14_gpu8 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l14_gpu8 -> Gate_l14_gpu8;
  Gate_l14_gpu9 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l14_gpu9 -> Gate_l14_gpu9;
  Gate_l14_gpu10 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l14_gpu10 -> Gate_l14_gpu10;
  Gate_l14_gpu11 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l14_gpu11 -> Gate_l14_gpu11;
  Gate_l14_gpu12 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l14_gpu12 -> Gate_l14_gpu12;
  Gate_l14_gpu13 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l14_gpu13 -> Gate_l14_gpu13;
  Gate_l14_gpu14 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l14_gpu14 -> Gate_l14_gpu14;
  Gate_l14_gpu15 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l14_gpu15 -> Gate_l14_gpu15;
  Expert_l14_gpu0 [label="Expert_l14\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l14_gpu0 -> Expert_l14_gpu0 [style=dashed];
  Expert_l14_gpu1 [label="Expert_l14\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l14_gpu1 -> Expert_l14_gpu1 [style=dashed];
  Expert_l14_gpu2 [label="Expert_l14\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l14_gpu2 -> Expert_l14_gpu2 [style=dashed];
  Expert_l14_gpu3 [label="Expert_l14\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l14_gpu3 -> Expert_l14_gpu3 [style=dashed];
  Expert_l14_gpu4 [label="Expert_l14\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l14_gpu4 -> Expert_l14_gpu4 [style=dashed];
  Expert_l14_gpu5 [label="Expert_l14\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l14_gpu5 -> Expert_l14_gpu5 [style=dashed];
  Expert_l14_gpu6 [label="Expert_l14\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l14_gpu6 -> Expert_l14_gpu6 [style=dashed];
  Expert_l14_gpu7 [label="Expert_l14\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l14_gpu7 -> Expert_l14_gpu7 [style=dashed];
  Expert_l14_gpu8 [label="Expert_l14\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l14_gpu8 -> Expert_l14_gpu8 [style=dashed];
  Expert_l14_gpu9 [label="Expert_l14\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l14_gpu9 -> Expert_l14_gpu9 [style=dashed];
  Expert_l14_gpu10 [label="Expert_l14\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l14_gpu10 -> Expert_l14_gpu10 [style=dashed];
  Expert_l14_gpu11 [label="Expert_l14\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l14_gpu11 -> Expert_l14_gpu11 [style=dashed];
  Expert_l14_gpu12 [label="Expert_l14\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l14_gpu12 -> Expert_l14_gpu12 [style=dashed];
  Expert_l14_gpu13 [label="Expert_l14\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l14_gpu13 -> Expert_l14_gpu13 [style=dashed];
  Expert_l14_gpu14 [label="Expert_l14\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l14_gpu14 -> Expert_l14_gpu14 [style=dashed];
  Expert_l14_gpu15 [label="Expert_l14\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l14_gpu15 -> Expert_l14_gpu15 [style=dashed];
  AR_exp_l14 [shape=ellipse, label="AllReduceExperts\nall16GPUs\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert_l14_gpu0 -> AR_exp_l14;
  Expert_l14_gpu1 -> AR_exp_l14;
  Expert_l14_gpu2 -> AR_exp_l14;
  Expert_l14_gpu3 -> AR_exp_l14;
  Expert_l14_gpu4 -> AR_exp_l14;
  Expert_l14_gpu5 -> AR_exp_l14;
  Expert_l14_gpu6 -> AR_exp_l14;
  Expert_l14_gpu7 -> AR_exp_l14;
  Expert_l14_gpu8 -> AR_exp_l14;
  Expert_l14_gpu9 -> AR_exp_l14;
  Expert_l14_gpu10 -> AR_exp_l14;
  Expert_l14_gpu11 -> AR_exp_l14;
  Expert_l14_gpu12 -> AR_exp_l14;
  Expert_l14_gpu13 -> AR_exp_l14;
  Expert_l14_gpu14 -> AR_exp_l14;
  Expert_l14_gpu15 -> AR_exp_l14;
  ResMOE_l14_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l14 -> ResMOE_l14_gpu0;
  ResAttn_l14_gpu0 -> ResMOE_l14_gpu0;
  ResMOE_l14_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l14 -> ResMOE_l14_gpu1;
  ResAttn_l14_gpu1 -> ResMOE_l14_gpu1;
  ResMOE_l14_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l14 -> ResMOE_l14_gpu2;
  ResAttn_l14_gpu2 -> ResMOE_l14_gpu2;
  ResMOE_l14_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l14 -> ResMOE_l14_gpu3;
  ResAttn_l14_gpu3 -> ResMOE_l14_gpu3;
  ResMOE_l14_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l14 -> ResMOE_l14_gpu4;
  ResAttn_l14_gpu4 -> ResMOE_l14_gpu4;
  ResMOE_l14_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l14 -> ResMOE_l14_gpu5;
  ResAttn_l14_gpu5 -> ResMOE_l14_gpu5;
  ResMOE_l14_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l14 -> ResMOE_l14_gpu6;
  ResAttn_l14_gpu6 -> ResMOE_l14_gpu6;
  ResMOE_l14_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l14 -> ResMOE_l14_gpu7;
  ResAttn_l14_gpu7 -> ResMOE_l14_gpu7;
  ResMOE_l14_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l14 -> ResMOE_l14_gpu8;
  ResAttn_l14_gpu8 -> ResMOE_l14_gpu8;
  ResMOE_l14_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l14 -> ResMOE_l14_gpu9;
  ResAttn_l14_gpu9 -> ResMOE_l14_gpu9;
  ResMOE_l14_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l14 -> ResMOE_l14_gpu10;
  ResAttn_l14_gpu10 -> ResMOE_l14_gpu10;
  ResMOE_l14_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l14 -> ResMOE_l14_gpu11;
  ResAttn_l14_gpu11 -> ResMOE_l14_gpu11;
  ResMOE_l14_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l14 -> ResMOE_l14_gpu12;
  ResAttn_l14_gpu12 -> ResMOE_l14_gpu12;
  ResMOE_l14_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l14 -> ResMOE_l14_gpu13;
  ResAttn_l14_gpu13 -> ResMOE_l14_gpu13;
  ResMOE_l14_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l14 -> ResMOE_l14_gpu14;
  ResAttn_l14_gpu14 -> ResMOE_l14_gpu14;
  ResMOE_l14_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l14 -> ResMOE_l14_gpu15;
  ResAttn_l14_gpu15 -> ResMOE_l14_gpu15;
  QKV_l15_gpu0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l14_gpu0 -> QKV_l15_gpu0;
  QKV_l15_gpu1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l14_gpu0 -> QKV_l15_gpu1;
  QKV_l15_gpu2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l14_gpu0 -> QKV_l15_gpu2;
  QKV_l15_gpu3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l14_gpu0 -> QKV_l15_gpu3;
  QKV_l15_gpu4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l14_gpu0 -> QKV_l15_gpu4;
  QKV_l15_gpu5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l14_gpu0 -> QKV_l15_gpu5;
  QKV_l15_gpu6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l14_gpu0 -> QKV_l15_gpu6;
  QKV_l15_gpu7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l14_gpu0 -> QKV_l15_gpu7;
  QKV_l15_gpu8 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l14_gpu0 -> QKV_l15_gpu8;
  QKV_l15_gpu9 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l14_gpu0 -> QKV_l15_gpu9;
  QKV_l15_gpu10 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l14_gpu0 -> QKV_l15_gpu10;
  QKV_l15_gpu11 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l14_gpu0 -> QKV_l15_gpu11;
  QKV_l15_gpu12 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l14_gpu0 -> QKV_l15_gpu12;
  QKV_l15_gpu13 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l14_gpu0 -> QKV_l15_gpu13;
  QKV_l15_gpu14 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l14_gpu0 -> QKV_l15_gpu14;
  QKV_l15_gpu15 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l14_gpu0 -> QKV_l15_gpu15;
  SplitHeads_l15_gpu0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l15_gpu0 -> SplitHeads_l15_gpu0;
  SplitHeads_l15_gpu1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l15_gpu1 -> SplitHeads_l15_gpu1;
  SplitHeads_l15_gpu2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l15_gpu2 -> SplitHeads_l15_gpu2;
  SplitHeads_l15_gpu3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l15_gpu3 -> SplitHeads_l15_gpu3;
  SplitHeads_l15_gpu4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l15_gpu4 -> SplitHeads_l15_gpu4;
  SplitHeads_l15_gpu5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l15_gpu5 -> SplitHeads_l15_gpu5;
  SplitHeads_l15_gpu6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l15_gpu6 -> SplitHeads_l15_gpu6;
  SplitHeads_l15_gpu7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l15_gpu7 -> SplitHeads_l15_gpu7;
  SplitHeads_l15_gpu8 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l15_gpu8 -> SplitHeads_l15_gpu8;
  SplitHeads_l15_gpu9 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l15_gpu9 -> SplitHeads_l15_gpu9;
  SplitHeads_l15_gpu10 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l15_gpu10 -> SplitHeads_l15_gpu10;
  SplitHeads_l15_gpu11 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l15_gpu11 -> SplitHeads_l15_gpu11;
  SplitHeads_l15_gpu12 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l15_gpu12 -> SplitHeads_l15_gpu12;
  SplitHeads_l15_gpu13 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l15_gpu13 -> SplitHeads_l15_gpu13;
  SplitHeads_l15_gpu14 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l15_gpu14 -> SplitHeads_l15_gpu14;
  SplitHeads_l15_gpu15 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l15_gpu15 -> SplitHeads_l15_gpu15;
  A2A_l15 [shape=ellipse, label="AllToAll\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_l15_gpu0 -> A2A_l15;
  SplitHeads_l15_gpu1 -> A2A_l15;
  SplitHeads_l15_gpu2 -> A2A_l15;
  SplitHeads_l15_gpu3 -> A2A_l15;
  SplitHeads_l15_gpu4 -> A2A_l15;
  SplitHeads_l15_gpu5 -> A2A_l15;
  SplitHeads_l15_gpu6 -> A2A_l15;
  SplitHeads_l15_gpu7 -> A2A_l15;
  SplitHeads_l15_gpu8 -> A2A_l15;
  SplitHeads_l15_gpu9 -> A2A_l15;
  SplitHeads_l15_gpu10 -> A2A_l15;
  SplitHeads_l15_gpu11 -> A2A_l15;
  SplitHeads_l15_gpu12 -> A2A_l15;
  SplitHeads_l15_gpu13 -> A2A_l15;
  SplitHeads_l15_gpu14 -> A2A_l15;
  SplitHeads_l15_gpu15 -> A2A_l15;
  Attn_l15_gpu0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l15 -> Attn_l15_gpu0;
  Attn_l15_gpu1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l15 -> Attn_l15_gpu1;
  Attn_l15_gpu2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l15 -> Attn_l15_gpu2;
  Attn_l15_gpu3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l15 -> Attn_l15_gpu3;
  Attn_l15_gpu4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l15 -> Attn_l15_gpu4;
  Attn_l15_gpu5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l15 -> Attn_l15_gpu5;
  Attn_l15_gpu6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l15 -> Attn_l15_gpu6;
  Attn_l15_gpu7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l15 -> Attn_l15_gpu7;
  Attn_l15_gpu8 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l15 -> Attn_l15_gpu8;
  Attn_l15_gpu9 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l15 -> Attn_l15_gpu9;
  Attn_l15_gpu10 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l15 -> Attn_l15_gpu10;
  Attn_l15_gpu11 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l15 -> Attn_l15_gpu11;
  Attn_l15_gpu12 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l15 -> Attn_l15_gpu12;
  Attn_l15_gpu13 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l15 -> Attn_l15_gpu13;
  Attn_l15_gpu14 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l15 -> Attn_l15_gpu14;
  Attn_l15_gpu15 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l15 -> Attn_l15_gpu15;
  AR_attn_l15 [shape=ellipse, label="AllReduce\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_l15_gpu0 -> AR_attn_l15;
  Attn_l15_gpu1 -> AR_attn_l15;
  Attn_l15_gpu2 -> AR_attn_l15;
  Attn_l15_gpu3 -> AR_attn_l15;
  Attn_l15_gpu4 -> AR_attn_l15;
  Attn_l15_gpu5 -> AR_attn_l15;
  Attn_l15_gpu6 -> AR_attn_l15;
  Attn_l15_gpu7 -> AR_attn_l15;
  Attn_l15_gpu8 -> AR_attn_l15;
  Attn_l15_gpu9 -> AR_attn_l15;
  Attn_l15_gpu10 -> AR_attn_l15;
  Attn_l15_gpu11 -> AR_attn_l15;
  Attn_l15_gpu12 -> AR_attn_l15;
  Attn_l15_gpu13 -> AR_attn_l15;
  Attn_l15_gpu14 -> AR_attn_l15;
  Attn_l15_gpu15 -> AR_attn_l15;
  O_l15_gpu0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l15 -> O_l15_gpu0;
  O_l15_gpu1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l15 -> O_l15_gpu1;
  O_l15_gpu2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l15 -> O_l15_gpu2;
  O_l15_gpu3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l15 -> O_l15_gpu3;
  O_l15_gpu4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l15 -> O_l15_gpu4;
  O_l15_gpu5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l15 -> O_l15_gpu5;
  O_l15_gpu6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l15 -> O_l15_gpu6;
  O_l15_gpu7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l15 -> O_l15_gpu7;
  O_l15_gpu8 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l15 -> O_l15_gpu8;
  O_l15_gpu9 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l15 -> O_l15_gpu9;
  O_l15_gpu10 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l15 -> O_l15_gpu10;
  O_l15_gpu11 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l15 -> O_l15_gpu11;
  O_l15_gpu12 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l15 -> O_l15_gpu12;
  O_l15_gpu13 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l15 -> O_l15_gpu13;
  O_l15_gpu14 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l15 -> O_l15_gpu14;
  O_l15_gpu15 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l15 -> O_l15_gpu15;
  ResAttn_l15_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l15_gpu0 -> ResAttn_l15_gpu0;
  ResMOE_l14_gpu0 -> ResAttn_l15_gpu0;
  ResAttn_l15_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l15_gpu1 -> ResAttn_l15_gpu1;
  ResMOE_l14_gpu0 -> ResAttn_l15_gpu1;
  ResAttn_l15_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l15_gpu2 -> ResAttn_l15_gpu2;
  ResMOE_l14_gpu0 -> ResAttn_l15_gpu2;
  ResAttn_l15_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l15_gpu3 -> ResAttn_l15_gpu3;
  ResMOE_l14_gpu0 -> ResAttn_l15_gpu3;
  ResAttn_l15_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l15_gpu4 -> ResAttn_l15_gpu4;
  ResMOE_l14_gpu0 -> ResAttn_l15_gpu4;
  ResAttn_l15_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l15_gpu5 -> ResAttn_l15_gpu5;
  ResMOE_l14_gpu0 -> ResAttn_l15_gpu5;
  ResAttn_l15_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l15_gpu6 -> ResAttn_l15_gpu6;
  ResMOE_l14_gpu0 -> ResAttn_l15_gpu6;
  ResAttn_l15_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l15_gpu7 -> ResAttn_l15_gpu7;
  ResMOE_l14_gpu0 -> ResAttn_l15_gpu7;
  ResAttn_l15_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l15_gpu8 -> ResAttn_l15_gpu8;
  ResMOE_l14_gpu0 -> ResAttn_l15_gpu8;
  ResAttn_l15_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l15_gpu9 -> ResAttn_l15_gpu9;
  ResMOE_l14_gpu0 -> ResAttn_l15_gpu9;
  ResAttn_l15_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l15_gpu10 -> ResAttn_l15_gpu10;
  ResMOE_l14_gpu0 -> ResAttn_l15_gpu10;
  ResAttn_l15_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l15_gpu11 -> ResAttn_l15_gpu11;
  ResMOE_l14_gpu0 -> ResAttn_l15_gpu11;
  ResAttn_l15_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l15_gpu12 -> ResAttn_l15_gpu12;
  ResMOE_l14_gpu0 -> ResAttn_l15_gpu12;
  ResAttn_l15_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l15_gpu13 -> ResAttn_l15_gpu13;
  ResMOE_l14_gpu0 -> ResAttn_l15_gpu13;
  ResAttn_l15_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l15_gpu14 -> ResAttn_l15_gpu14;
  ResMOE_l14_gpu0 -> ResAttn_l15_gpu14;
  ResAttn_l15_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l15_gpu15 -> ResAttn_l15_gpu15;
  ResMOE_l14_gpu0 -> ResAttn_l15_gpu15;
  Gate_l15_gpu0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l15_gpu0 -> Gate_l15_gpu0;
  Gate_l15_gpu1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l15_gpu1 -> Gate_l15_gpu1;
  Gate_l15_gpu2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l15_gpu2 -> Gate_l15_gpu2;
  Gate_l15_gpu3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l15_gpu3 -> Gate_l15_gpu3;
  Gate_l15_gpu4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l15_gpu4 -> Gate_l15_gpu4;
  Gate_l15_gpu5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l15_gpu5 -> Gate_l15_gpu5;
  Gate_l15_gpu6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l15_gpu6 -> Gate_l15_gpu6;
  Gate_l15_gpu7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l15_gpu7 -> Gate_l15_gpu7;
  Gate_l15_gpu8 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l15_gpu8 -> Gate_l15_gpu8;
  Gate_l15_gpu9 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l15_gpu9 -> Gate_l15_gpu9;
  Gate_l15_gpu10 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l15_gpu10 -> Gate_l15_gpu10;
  Gate_l15_gpu11 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l15_gpu11 -> Gate_l15_gpu11;
  Gate_l15_gpu12 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l15_gpu12 -> Gate_l15_gpu12;
  Gate_l15_gpu13 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l15_gpu13 -> Gate_l15_gpu13;
  Gate_l15_gpu14 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l15_gpu14 -> Gate_l15_gpu14;
  Gate_l15_gpu15 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l15_gpu15 -> Gate_l15_gpu15;
  Expert_l15_gpu0 [label="Expert_l15\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l15_gpu0 -> Expert_l15_gpu0 [style=dashed];
  Expert_l15_gpu1 [label="Expert_l15\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l15_gpu1 -> Expert_l15_gpu1 [style=dashed];
  Expert_l15_gpu2 [label="Expert_l15\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l15_gpu2 -> Expert_l15_gpu2 [style=dashed];
  Expert_l15_gpu3 [label="Expert_l15\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l15_gpu3 -> Expert_l15_gpu3 [style=dashed];
  Expert_l15_gpu4 [label="Expert_l15\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l15_gpu4 -> Expert_l15_gpu4 [style=dashed];
  Expert_l15_gpu5 [label="Expert_l15\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l15_gpu5 -> Expert_l15_gpu5 [style=dashed];
  Expert_l15_gpu6 [label="Expert_l15\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l15_gpu6 -> Expert_l15_gpu6 [style=dashed];
  Expert_l15_gpu7 [label="Expert_l15\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l15_gpu7 -> Expert_l15_gpu7 [style=dashed];
  Expert_l15_gpu8 [label="Expert_l15\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l15_gpu8 -> Expert_l15_gpu8 [style=dashed];
  Expert_l15_gpu9 [label="Expert_l15\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l15_gpu9 -> Expert_l15_gpu9 [style=dashed];
  Expert_l15_gpu10 [label="Expert_l15\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l15_gpu10 -> Expert_l15_gpu10 [style=dashed];
  Expert_l15_gpu11 [label="Expert_l15\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l15_gpu11 -> Expert_l15_gpu11 [style=dashed];
  Expert_l15_gpu12 [label="Expert_l15\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l15_gpu12 -> Expert_l15_gpu12 [style=dashed];
  Expert_l15_gpu13 [label="Expert_l15\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l15_gpu13 -> Expert_l15_gpu13 [style=dashed];
  Expert_l15_gpu14 [label="Expert_l15\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l15_gpu14 -> Expert_l15_gpu14 [style=dashed];
  Expert_l15_gpu15 [label="Expert_l15\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l15_gpu15 -> Expert_l15_gpu15 [style=dashed];
  AR_exp_l15 [shape=ellipse, label="AllReduceExperts\nall16GPUs\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert_l15_gpu0 -> AR_exp_l15;
  Expert_l15_gpu1 -> AR_exp_l15;
  Expert_l15_gpu2 -> AR_exp_l15;
  Expert_l15_gpu3 -> AR_exp_l15;
  Expert_l15_gpu4 -> AR_exp_l15;
  Expert_l15_gpu5 -> AR_exp_l15;
  Expert_l15_gpu6 -> AR_exp_l15;
  Expert_l15_gpu7 -> AR_exp_l15;
  Expert_l15_gpu8 -> AR_exp_l15;
  Expert_l15_gpu9 -> AR_exp_l15;
  Expert_l15_gpu10 -> AR_exp_l15;
  Expert_l15_gpu11 -> AR_exp_l15;
  Expert_l15_gpu12 -> AR_exp_l15;
  Expert_l15_gpu13 -> AR_exp_l15;
  Expert_l15_gpu14 -> AR_exp_l15;
  Expert_l15_gpu15 -> AR_exp_l15;
  ResMOE_l15_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l15 -> ResMOE_l15_gpu0;
  ResAttn_l15_gpu0 -> ResMOE_l15_gpu0;
  ResMOE_l15_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l15 -> ResMOE_l15_gpu1;
  ResAttn_l15_gpu1 -> ResMOE_l15_gpu1;
  ResMOE_l15_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l15 -> ResMOE_l15_gpu2;
  ResAttn_l15_gpu2 -> ResMOE_l15_gpu2;
  ResMOE_l15_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l15 -> ResMOE_l15_gpu3;
  ResAttn_l15_gpu3 -> ResMOE_l15_gpu3;
  ResMOE_l15_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l15 -> ResMOE_l15_gpu4;
  ResAttn_l15_gpu4 -> ResMOE_l15_gpu4;
  ResMOE_l15_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l15 -> ResMOE_l15_gpu5;
  ResAttn_l15_gpu5 -> ResMOE_l15_gpu5;
  ResMOE_l15_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l15 -> ResMOE_l15_gpu6;
  ResAttn_l15_gpu6 -> ResMOE_l15_gpu6;
  ResMOE_l15_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l15 -> ResMOE_l15_gpu7;
  ResAttn_l15_gpu7 -> ResMOE_l15_gpu7;
  ResMOE_l15_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l15 -> ResMOE_l15_gpu8;
  ResAttn_l15_gpu8 -> ResMOE_l15_gpu8;
  ResMOE_l15_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l15 -> ResMOE_l15_gpu9;
  ResAttn_l15_gpu9 -> ResMOE_l15_gpu9;
  ResMOE_l15_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l15 -> ResMOE_l15_gpu10;
  ResAttn_l15_gpu10 -> ResMOE_l15_gpu10;
  ResMOE_l15_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l15 -> ResMOE_l15_gpu11;
  ResAttn_l15_gpu11 -> ResMOE_l15_gpu11;
  ResMOE_l15_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l15 -> ResMOE_l15_gpu12;
  ResAttn_l15_gpu12 -> ResMOE_l15_gpu12;
  ResMOE_l15_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l15 -> ResMOE_l15_gpu13;
  ResAttn_l15_gpu13 -> ResMOE_l15_gpu13;
  ResMOE_l15_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l15 -> ResMOE_l15_gpu14;
  ResAttn_l15_gpu14 -> ResMOE_l15_gpu14;
  ResMOE_l15_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l15 -> ResMOE_l15_gpu15;
  ResAttn_l15_gpu15 -> ResMOE_l15_gpu15;
  QKV_l16_gpu0 [label="QKV_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l15_gpu0 -> QKV_l16_gpu0;
  QKV_l16_gpu1 [label="QKV_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l15_gpu0 -> QKV_l16_gpu1;
  QKV_l16_gpu2 [label="QKV_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l15_gpu0 -> QKV_l16_gpu2;
  QKV_l16_gpu3 [label="QKV_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l15_gpu0 -> QKV_l16_gpu3;
  QKV_l16_gpu4 [label="QKV_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l15_gpu0 -> QKV_l16_gpu4;
  QKV_l16_gpu5 [label="QKV_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l15_gpu0 -> QKV_l16_gpu5;
  QKV_l16_gpu6 [label="QKV_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l15_gpu0 -> QKV_l16_gpu6;
  QKV_l16_gpu7 [label="QKV_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l15_gpu0 -> QKV_l16_gpu7;
  QKV_l16_gpu8 [label="QKV_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l15_gpu0 -> QKV_l16_gpu8;
  QKV_l16_gpu9 [label="QKV_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l15_gpu0 -> QKV_l16_gpu9;
  QKV_l16_gpu10 [label="QKV_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l15_gpu0 -> QKV_l16_gpu10;
  QKV_l16_gpu11 [label="QKV_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l15_gpu0 -> QKV_l16_gpu11;
  QKV_l16_gpu12 [label="QKV_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l15_gpu0 -> QKV_l16_gpu12;
  QKV_l16_gpu13 [label="QKV_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l15_gpu0 -> QKV_l16_gpu13;
  QKV_l16_gpu14 [label="QKV_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l15_gpu0 -> QKV_l16_gpu14;
  QKV_l16_gpu15 [label="QKV_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l15_gpu0 -> QKV_l16_gpu15;
  SplitHeads_l16_gpu0 [label="SplitHeads\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l16_gpu0 -> SplitHeads_l16_gpu0;
  SplitHeads_l16_gpu1 [label="SplitHeads\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l16_gpu1 -> SplitHeads_l16_gpu1;
  SplitHeads_l16_gpu2 [label="SplitHeads\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l16_gpu2 -> SplitHeads_l16_gpu2;
  SplitHeads_l16_gpu3 [label="SplitHeads\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l16_gpu3 -> SplitHeads_l16_gpu3;
  SplitHeads_l16_gpu4 [label="SplitHeads\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l16_gpu4 -> SplitHeads_l16_gpu4;
  SplitHeads_l16_gpu5 [label="SplitHeads\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l16_gpu5 -> SplitHeads_l16_gpu5;
  SplitHeads_l16_gpu6 [label="SplitHeads\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l16_gpu6 -> SplitHeads_l16_gpu6;
  SplitHeads_l16_gpu7 [label="SplitHeads\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l16_gpu7 -> SplitHeads_l16_gpu7;
  SplitHeads_l16_gpu8 [label="SplitHeads\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l16_gpu8 -> SplitHeads_l16_gpu8;
  SplitHeads_l16_gpu9 [label="SplitHeads\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l16_gpu9 -> SplitHeads_l16_gpu9;
  SplitHeads_l16_gpu10 [label="SplitHeads\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l16_gpu10 -> SplitHeads_l16_gpu10;
  SplitHeads_l16_gpu11 [label="SplitHeads\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l16_gpu11 -> SplitHeads_l16_gpu11;
  SplitHeads_l16_gpu12 [label="SplitHeads\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l16_gpu12 -> SplitHeads_l16_gpu12;
  SplitHeads_l16_gpu13 [label="SplitHeads\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l16_gpu13 -> SplitHeads_l16_gpu13;
  SplitHeads_l16_gpu14 [label="SplitHeads\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l16_gpu14 -> SplitHeads_l16_gpu14;
  SplitHeads_l16_gpu15 [label="SplitHeads\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  QKV_l16_gpu15 -> SplitHeads_l16_gpu15;
  A2A_l16 [shape=ellipse, label="AllToAll\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  SplitHeads_l16_gpu0 -> A2A_l16;
  SplitHeads_l16_gpu1 -> A2A_l16;
  SplitHeads_l16_gpu2 -> A2A_l16;
  SplitHeads_l16_gpu3 -> A2A_l16;
  SplitHeads_l16_gpu4 -> A2A_l16;
  SplitHeads_l16_gpu5 -> A2A_l16;
  SplitHeads_l16_gpu6 -> A2A_l16;
  SplitHeads_l16_gpu7 -> A2A_l16;
  SplitHeads_l16_gpu8 -> A2A_l16;
  SplitHeads_l16_gpu9 -> A2A_l16;
  SplitHeads_l16_gpu10 -> A2A_l16;
  SplitHeads_l16_gpu11 -> A2A_l16;
  SplitHeads_l16_gpu12 -> A2A_l16;
  SplitHeads_l16_gpu13 -> A2A_l16;
  SplitHeads_l16_gpu14 -> A2A_l16;
  SplitHeads_l16_gpu15 -> A2A_l16;
  Attn_l16_gpu0 [label="Attention\nGPU0\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l16 -> Attn_l16_gpu0;
  Attn_l16_gpu1 [label="Attention\nGPU1\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l16 -> Attn_l16_gpu1;
  Attn_l16_gpu2 [label="Attention\nGPU2\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l16 -> Attn_l16_gpu2;
  Attn_l16_gpu3 [label="Attention\nGPU3\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l16 -> Attn_l16_gpu3;
  Attn_l16_gpu4 [label="Attention\nGPU4\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l16 -> Attn_l16_gpu4;
  Attn_l16_gpu5 [label="Attention\nGPU5\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l16 -> Attn_l16_gpu5;
  Attn_l16_gpu6 [label="Attention\nGPU6\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l16 -> Attn_l16_gpu6;
  Attn_l16_gpu7 [label="Attention\nGPU7\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l16 -> Attn_l16_gpu7;
  Attn_l16_gpu8 [label="Attention\nGPU8\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l16 -> Attn_l16_gpu8;
  Attn_l16_gpu9 [label="Attention\nGPU9\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l16 -> Attn_l16_gpu9;
  Attn_l16_gpu10 [label="Attention\nGPU10\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l16 -> Attn_l16_gpu10;
  Attn_l16_gpu11 [label="Attention\nGPU11\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l16 -> Attn_l16_gpu11;
  Attn_l16_gpu12 [label="Attention\nGPU12\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l16 -> Attn_l16_gpu12;
  Attn_l16_gpu13 [label="Attention\nGPU13\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l16 -> Attn_l16_gpu13;
  Attn_l16_gpu14 [label="Attention\nGPU14\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l16 -> Attn_l16_gpu14;
  Attn_l16_gpu15 [label="Attention\nGPU15\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  A2A_l16 -> Attn_l16_gpu15;
  AR_attn_l16 [shape=ellipse, label="AllReduce\nall16GPUs\n[batch_size=128,seq_len=128,heads=16,d_k=64]"];
  Attn_l16_gpu0 -> AR_attn_l16;
  Attn_l16_gpu1 -> AR_attn_l16;
  Attn_l16_gpu2 -> AR_attn_l16;
  Attn_l16_gpu3 -> AR_attn_l16;
  Attn_l16_gpu4 -> AR_attn_l16;
  Attn_l16_gpu5 -> AR_attn_l16;
  Attn_l16_gpu6 -> AR_attn_l16;
  Attn_l16_gpu7 -> AR_attn_l16;
  Attn_l16_gpu8 -> AR_attn_l16;
  Attn_l16_gpu9 -> AR_attn_l16;
  Attn_l16_gpu10 -> AR_attn_l16;
  Attn_l16_gpu11 -> AR_attn_l16;
  Attn_l16_gpu12 -> AR_attn_l16;
  Attn_l16_gpu13 -> AR_attn_l16;
  Attn_l16_gpu14 -> AR_attn_l16;
  Attn_l16_gpu15 -> AR_attn_l16;
  O_l16_gpu0 [label="O_linear\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l16 -> O_l16_gpu0;
  O_l16_gpu1 [label="O_linear\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l16 -> O_l16_gpu1;
  O_l16_gpu2 [label="O_linear\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l16 -> O_l16_gpu2;
  O_l16_gpu3 [label="O_linear\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l16 -> O_l16_gpu3;
  O_l16_gpu4 [label="O_linear\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l16 -> O_l16_gpu4;
  O_l16_gpu5 [label="O_linear\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l16 -> O_l16_gpu5;
  O_l16_gpu6 [label="O_linear\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l16 -> O_l16_gpu6;
  O_l16_gpu7 [label="O_linear\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l16 -> O_l16_gpu7;
  O_l16_gpu8 [label="O_linear\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l16 -> O_l16_gpu8;
  O_l16_gpu9 [label="O_linear\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l16 -> O_l16_gpu9;
  O_l16_gpu10 [label="O_linear\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l16 -> O_l16_gpu10;
  O_l16_gpu11 [label="O_linear\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l16 -> O_l16_gpu11;
  O_l16_gpu12 [label="O_linear\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l16 -> O_l16_gpu12;
  O_l16_gpu13 [label="O_linear\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l16 -> O_l16_gpu13;
  O_l16_gpu14 [label="O_linear\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l16 -> O_l16_gpu14;
  O_l16_gpu15 [label="O_linear\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_attn_l16 -> O_l16_gpu15;
  ResAttn_l16_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l16_gpu0 -> ResAttn_l16_gpu0;
  ResMOE_l15_gpu0 -> ResAttn_l16_gpu0;
  ResAttn_l16_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l16_gpu1 -> ResAttn_l16_gpu1;
  ResMOE_l15_gpu0 -> ResAttn_l16_gpu1;
  ResAttn_l16_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l16_gpu2 -> ResAttn_l16_gpu2;
  ResMOE_l15_gpu0 -> ResAttn_l16_gpu2;
  ResAttn_l16_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l16_gpu3 -> ResAttn_l16_gpu3;
  ResMOE_l15_gpu0 -> ResAttn_l16_gpu3;
  ResAttn_l16_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l16_gpu4 -> ResAttn_l16_gpu4;
  ResMOE_l15_gpu0 -> ResAttn_l16_gpu4;
  ResAttn_l16_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l16_gpu5 -> ResAttn_l16_gpu5;
  ResMOE_l15_gpu0 -> ResAttn_l16_gpu5;
  ResAttn_l16_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l16_gpu6 -> ResAttn_l16_gpu6;
  ResMOE_l15_gpu0 -> ResAttn_l16_gpu6;
  ResAttn_l16_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l16_gpu7 -> ResAttn_l16_gpu7;
  ResMOE_l15_gpu0 -> ResAttn_l16_gpu7;
  ResAttn_l16_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l16_gpu8 -> ResAttn_l16_gpu8;
  ResMOE_l15_gpu0 -> ResAttn_l16_gpu8;
  ResAttn_l16_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l16_gpu9 -> ResAttn_l16_gpu9;
  ResMOE_l15_gpu0 -> ResAttn_l16_gpu9;
  ResAttn_l16_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l16_gpu10 -> ResAttn_l16_gpu10;
  ResMOE_l15_gpu0 -> ResAttn_l16_gpu10;
  ResAttn_l16_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l16_gpu11 -> ResAttn_l16_gpu11;
  ResMOE_l15_gpu0 -> ResAttn_l16_gpu11;
  ResAttn_l16_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l16_gpu12 -> ResAttn_l16_gpu12;
  ResMOE_l15_gpu0 -> ResAttn_l16_gpu12;
  ResAttn_l16_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l16_gpu13 -> ResAttn_l16_gpu13;
  ResMOE_l15_gpu0 -> ResAttn_l16_gpu13;
  ResAttn_l16_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l16_gpu14 -> ResAttn_l16_gpu14;
  ResMOE_l15_gpu0 -> ResAttn_l16_gpu14;
  ResAttn_l16_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  O_l16_gpu15 -> ResAttn_l16_gpu15;
  ResMOE_l15_gpu0 -> ResAttn_l16_gpu15;
  Gate_l16_gpu0 [label="Gate\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l16_gpu0 -> Gate_l16_gpu0;
  Gate_l16_gpu1 [label="Gate\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l16_gpu1 -> Gate_l16_gpu1;
  Gate_l16_gpu2 [label="Gate\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l16_gpu2 -> Gate_l16_gpu2;
  Gate_l16_gpu3 [label="Gate\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l16_gpu3 -> Gate_l16_gpu3;
  Gate_l16_gpu4 [label="Gate\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l16_gpu4 -> Gate_l16_gpu4;
  Gate_l16_gpu5 [label="Gate\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l16_gpu5 -> Gate_l16_gpu5;
  Gate_l16_gpu6 [label="Gate\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l16_gpu6 -> Gate_l16_gpu6;
  Gate_l16_gpu7 [label="Gate\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l16_gpu7 -> Gate_l16_gpu7;
  Gate_l16_gpu8 [label="Gate\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l16_gpu8 -> Gate_l16_gpu8;
  Gate_l16_gpu9 [label="Gate\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l16_gpu9 -> Gate_l16_gpu9;
  Gate_l16_gpu10 [label="Gate\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l16_gpu10 -> Gate_l16_gpu10;
  Gate_l16_gpu11 [label="Gate\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l16_gpu11 -> Gate_l16_gpu11;
  Gate_l16_gpu12 [label="Gate\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l16_gpu12 -> Gate_l16_gpu12;
  Gate_l16_gpu13 [label="Gate\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l16_gpu13 -> Gate_l16_gpu13;
  Gate_l16_gpu14 [label="Gate\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l16_gpu14 -> Gate_l16_gpu14;
  Gate_l16_gpu15 [label="Gate\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResAttn_l16_gpu15 -> Gate_l16_gpu15;
  Expert_l16_gpu0 [label="Expert_l16\nGPU0\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l16_gpu0 -> Expert_l16_gpu0 [style=dashed];
  Expert_l16_gpu1 [label="Expert_l16\nGPU1\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l16_gpu1 -> Expert_l16_gpu1 [style=dashed];
  Expert_l16_gpu2 [label="Expert_l16\nGPU2\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l16_gpu2 -> Expert_l16_gpu2 [style=dashed];
  Expert_l16_gpu3 [label="Expert_l16\nGPU3\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l16_gpu3 -> Expert_l16_gpu3 [style=dashed];
  Expert_l16_gpu4 [label="Expert_l16\nGPU4\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l16_gpu4 -> Expert_l16_gpu4 [style=dashed];
  Expert_l16_gpu5 [label="Expert_l16\nGPU5\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l16_gpu5 -> Expert_l16_gpu5 [style=dashed];
  Expert_l16_gpu6 [label="Expert_l16\nGPU6\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l16_gpu6 -> Expert_l16_gpu6 [style=dashed];
  Expert_l16_gpu7 [label="Expert_l16\nGPU7\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l16_gpu7 -> Expert_l16_gpu7 [style=dashed];
  Expert_l16_gpu8 [label="Expert_l16\nGPU8\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l16_gpu8 -> Expert_l16_gpu8 [style=dashed];
  Expert_l16_gpu9 [label="Expert_l16\nGPU9\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l16_gpu9 -> Expert_l16_gpu9 [style=dashed];
  Expert_l16_gpu10 [label="Expert_l16\nGPU10\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l16_gpu10 -> Expert_l16_gpu10 [style=dashed];
  Expert_l16_gpu11 [label="Expert_l16\nGPU11\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l16_gpu11 -> Expert_l16_gpu11 [style=dashed];
  Expert_l16_gpu12 [label="Expert_l16\nGPU12\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l16_gpu12 -> Expert_l16_gpu12 [style=dashed];
  Expert_l16_gpu13 [label="Expert_l16\nGPU13\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l16_gpu13 -> Expert_l16_gpu13 [style=dashed];
  Expert_l16_gpu14 [label="Expert_l16\nGPU14\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l16_gpu14 -> Expert_l16_gpu14 [style=dashed];
  Expert_l16_gpu15 [label="Expert_l16\nGPU15\n[batch_size=128,seq_len=128,ffn=2048]"];
  Gate_l16_gpu15 -> Expert_l16_gpu15 [style=dashed];
  AR_exp_l16 [shape=ellipse, label="AllReduceExperts\nall16GPUs\n[batch_size=128,seq_len=128,hidden=1024]"];
  Expert_l16_gpu0 -> AR_exp_l16;
  Expert_l16_gpu1 -> AR_exp_l16;
  Expert_l16_gpu2 -> AR_exp_l16;
  Expert_l16_gpu3 -> AR_exp_l16;
  Expert_l16_gpu4 -> AR_exp_l16;
  Expert_l16_gpu5 -> AR_exp_l16;
  Expert_l16_gpu6 -> AR_exp_l16;
  Expert_l16_gpu7 -> AR_exp_l16;
  Expert_l16_gpu8 -> AR_exp_l16;
  Expert_l16_gpu9 -> AR_exp_l16;
  Expert_l16_gpu10 -> AR_exp_l16;
  Expert_l16_gpu11 -> AR_exp_l16;
  Expert_l16_gpu12 -> AR_exp_l16;
  Expert_l16_gpu13 -> AR_exp_l16;
  Expert_l16_gpu14 -> AR_exp_l16;
  Expert_l16_gpu15 -> AR_exp_l16;
  ResMOE_l16_gpu0 [shape=parallelogram, label="ResAdd\nGPU0\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l16 -> ResMOE_l16_gpu0;
  ResAttn_l16_gpu0 -> ResMOE_l16_gpu0;
  ResMOE_l16_gpu1 [shape=parallelogram, label="ResAdd\nGPU1\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l16 -> ResMOE_l16_gpu1;
  ResAttn_l16_gpu1 -> ResMOE_l16_gpu1;
  ResMOE_l16_gpu2 [shape=parallelogram, label="ResAdd\nGPU2\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l16 -> ResMOE_l16_gpu2;
  ResAttn_l16_gpu2 -> ResMOE_l16_gpu2;
  ResMOE_l16_gpu3 [shape=parallelogram, label="ResAdd\nGPU3\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l16 -> ResMOE_l16_gpu3;
  ResAttn_l16_gpu3 -> ResMOE_l16_gpu3;
  ResMOE_l16_gpu4 [shape=parallelogram, label="ResAdd\nGPU4\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l16 -> ResMOE_l16_gpu4;
  ResAttn_l16_gpu4 -> ResMOE_l16_gpu4;
  ResMOE_l16_gpu5 [shape=parallelogram, label="ResAdd\nGPU5\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l16 -> ResMOE_l16_gpu5;
  ResAttn_l16_gpu5 -> ResMOE_l16_gpu5;
  ResMOE_l16_gpu6 [shape=parallelogram, label="ResAdd\nGPU6\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l16 -> ResMOE_l16_gpu6;
  ResAttn_l16_gpu6 -> ResMOE_l16_gpu6;
  ResMOE_l16_gpu7 [shape=parallelogram, label="ResAdd\nGPU7\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l16 -> ResMOE_l16_gpu7;
  ResAttn_l16_gpu7 -> ResMOE_l16_gpu7;
  ResMOE_l16_gpu8 [shape=parallelogram, label="ResAdd\nGPU8\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l16 -> ResMOE_l16_gpu8;
  ResAttn_l16_gpu8 -> ResMOE_l16_gpu8;
  ResMOE_l16_gpu9 [shape=parallelogram, label="ResAdd\nGPU9\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l16 -> ResMOE_l16_gpu9;
  ResAttn_l16_gpu9 -> ResMOE_l16_gpu9;
  ResMOE_l16_gpu10 [shape=parallelogram, label="ResAdd\nGPU10\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l16 -> ResMOE_l16_gpu10;
  ResAttn_l16_gpu10 -> ResMOE_l16_gpu10;
  ResMOE_l16_gpu11 [shape=parallelogram, label="ResAdd\nGPU11\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l16 -> ResMOE_l16_gpu11;
  ResAttn_l16_gpu11 -> ResMOE_l16_gpu11;
  ResMOE_l16_gpu12 [shape=parallelogram, label="ResAdd\nGPU12\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l16 -> ResMOE_l16_gpu12;
  ResAttn_l16_gpu12 -> ResMOE_l16_gpu12;
  ResMOE_l16_gpu13 [shape=parallelogram, label="ResAdd\nGPU13\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l16 -> ResMOE_l16_gpu13;
  ResAttn_l16_gpu13 -> ResMOE_l16_gpu13;
  ResMOE_l16_gpu14 [shape=parallelogram, label="ResAdd\nGPU14\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l16 -> ResMOE_l16_gpu14;
  ResAttn_l16_gpu14 -> ResMOE_l16_gpu14;
  ResMOE_l16_gpu15 [shape=parallelogram, label="ResAdd\nGPU15\n[batch_size=128,seq_len=128,hidden=1024]"];
  AR_exp_l16 -> ResMOE_l16_gpu15;
  ResAttn_l16_gpu15 -> ResMOE_l16_gpu15;
  Output [shape=ellipse, label="Output\n[batch_size=128,seq_len=128,hidden=1024]"];
  ResMOE_l16_gpu0 -> Output;
}