digraph baseline_tp8_pp2 {
rankdir=TB; splines=true;
"INPUT" [shape=box, label="INPUT\nGPU: all\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_mha_qkv_tp0" [shape=box, label="stage0_layer0_mha_qkv_tp0\nGPU: 0\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, heads=16, d_k=64"];
"stage0_layer0_mha_qkv_tp1" [shape=box, label="stage0_layer0_mha_qkv_tp1\nGPU: 1\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, heads=16, d_k=64"];
"stage0_layer0_mha_qkv_tp2" [shape=box, label="stage0_layer0_mha_qkv_tp2\nGPU: 2\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, heads=16, d_k=64"];
"stage0_layer0_mha_qkv_tp3" [shape=box, label="stage0_layer0_mha_qkv_tp3\nGPU: 3\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, heads=16, d_k=64"];
"stage0_layer0_mha_qkv_tp4" [shape=box, label="stage0_layer0_mha_qkv_tp4\nGPU: 4\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, heads=16, d_k=64"];
"stage0_layer0_mha_qkv_tp5" [shape=box, label="stage0_layer0_mha_qkv_tp5\nGPU: 5\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, heads=16, d_k=64"];
"stage0_layer0_mha_qkv_tp6" [shape=box, label="stage0_layer0_mha_qkv_tp6\nGPU: 6\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, heads=16, d_k=64"];
"stage0_layer0_mha_qkv_tp7" [shape=box, label="stage0_layer0_mha_qkv_tp7\nGPU: 7\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, heads=16, d_k=64"];
"stage0_layer0_ag_qkv" [shape=ellipse, style=dashed, label="stage0_layer0_ag_qkv\nIn: batch_size, seq_len=128, heads=16, d_k=64 (shard)\nOut: batch_size, seq_len=128, heads=16, d_k=64 (full)"];
"stage0_layer0_mha_qkv_tp0" -> "stage0_layer0_ag_qkv";
"stage0_layer0_mha_qkv_tp1" -> "stage0_layer0_ag_qkv";
"stage0_layer0_mha_qkv_tp2" -> "stage0_layer0_ag_qkv";
"stage0_layer0_mha_qkv_tp3" -> "stage0_layer0_ag_qkv";
"stage0_layer0_mha_qkv_tp4" -> "stage0_layer0_ag_qkv";
"stage0_layer0_mha_qkv_tp5" -> "stage0_layer0_ag_qkv";
"stage0_layer0_mha_qkv_tp6" -> "stage0_layer0_ag_qkv";
"stage0_layer0_mha_qkv_tp7" -> "stage0_layer0_ag_qkv";
"stage0_layer0_mha_score" [shape=box, label="stage0_layer0_mha_score\nGPU: all_stage0\nIn: batch_size, seq_len=128, heads=16, d_k=64\nOut: batch_size, heads=16, seq_len=128, seq_len=128"];
"stage0_layer0_ag_qkv" -> "stage0_layer0_mha_score";
"stage0_layer0_mha_softmax" [shape=box, label="stage0_layer0_mha_softmax\nGPU: all_stage0\nIn: batch_size, heads=16, seq_len=128, seq_len=128\nOut: batch_size, heads=16, seq_len=128, seq_len=128"];
"stage0_layer0_mha_score" -> "stage0_layer0_mha_softmax";
"stage0_layer0_mha_out_tp0" [shape=box, label="stage0_layer0_mha_out_tp0\nGPU: 0\nIn: batch_size, heads=16, seq_len=128, seq_len=128\nOut: batch_size, seq_len=128, d_model=1024//8"];
"stage0_layer0_mha_softmax" -> "stage0_layer0_mha_out_tp0";
"stage0_layer0_mha_out_tp1" [shape=box, label="stage0_layer0_mha_out_tp1\nGPU: 1\nIn: batch_size, heads=16, seq_len=128, seq_len=128\nOut: batch_size, seq_len=128, d_model=1024//8"];
"stage0_layer0_mha_softmax" -> "stage0_layer0_mha_out_tp1";
"stage0_layer0_mha_out_tp2" [shape=box, label="stage0_layer0_mha_out_tp2\nGPU: 2\nIn: batch_size, heads=16, seq_len=128, seq_len=128\nOut: batch_size, seq_len=128, d_model=1024//8"];
"stage0_layer0_mha_softmax" -> "stage0_layer0_mha_out_tp2";
"stage0_layer0_mha_out_tp3" [shape=box, label="stage0_layer0_mha_out_tp3\nGPU: 3\nIn: batch_size, heads=16, seq_len=128, seq_len=128\nOut: batch_size, seq_len=128, d_model=1024//8"];
"stage0_layer0_mha_softmax" -> "stage0_layer0_mha_out_tp3";
"stage0_layer0_mha_out_tp4" [shape=box, label="stage0_layer0_mha_out_tp4\nGPU: 4\nIn: batch_size, heads=16, seq_len=128, seq_len=128\nOut: batch_size, seq_len=128, d_model=1024//8"];
"stage0_layer0_mha_softmax" -> "stage0_layer0_mha_out_tp4";
"stage0_layer0_mha_out_tp5" [shape=box, label="stage0_layer0_mha_out_tp5\nGPU: 5\nIn: batch_size, heads=16, seq_len=128, seq_len=128\nOut: batch_size, seq_len=128, d_model=1024//8"];
"stage0_layer0_mha_softmax" -> "stage0_layer0_mha_out_tp5";
"stage0_layer0_mha_out_tp6" [shape=box, label="stage0_layer0_mha_out_tp6\nGPU: 6\nIn: batch_size, heads=16, seq_len=128, seq_len=128\nOut: batch_size, seq_len=128, d_model=1024//8"];
"stage0_layer0_mha_softmax" -> "stage0_layer0_mha_out_tp6";
"stage0_layer0_mha_out_tp7" [shape=box, label="stage0_layer0_mha_out_tp7\nGPU: 7\nIn: batch_size, heads=16, seq_len=128, seq_len=128\nOut: batch_size, seq_len=128, d_model=1024//8"];
"stage0_layer0_mha_softmax" -> "stage0_layer0_mha_out_tp7";
"stage0_layer0_ar_mha" [shape=ellipse, style=dashed, label="stage0_layer0_ar_mha\nIn: batch_size, seq_len=128, d_model=1024//8 (shard)\nOut: batch_size, seq_len=128, d_model=1024 (full)"];
"stage0_layer0_mha_out_tp0" -> "stage0_layer0_ar_mha";
"stage0_layer0_mha_out_tp1" -> "stage0_layer0_ar_mha";
"stage0_layer0_mha_out_tp2" -> "stage0_layer0_ar_mha";
"stage0_layer0_mha_out_tp3" -> "stage0_layer0_ar_mha";
"stage0_layer0_mha_out_tp4" -> "stage0_layer0_ar_mha";
"stage0_layer0_mha_out_tp5" -> "stage0_layer0_ar_mha";
"stage0_layer0_mha_out_tp6" -> "stage0_layer0_ar_mha";
"stage0_layer0_mha_out_tp7" -> "stage0_layer0_ar_mha";
"stage0_layer0_resid1" [shape=box, label="stage0_layer0_resid1\nGPU: all_stage0\nIn: batch_size, seq_len=128, d_model=1024 (x2)\nOut: batch_size, seq_len=128, d_model=1024"];
"INPUT" -> "stage0_layer0_resid1";
"stage0_layer0_ar_mha" -> "stage0_layer0_resid1";
"stage0_layer0_moe_gate" [shape=box, label="stage0_layer0_moe_gate\nGPU: all_stage0\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, 64"];
"stage0_layer0_resid1" -> "stage0_layer0_moe_gate";
"stage0_layer0_exp0" [shape=box, label="stage0_layer0_exp0\nGPU: 0\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp0";
"stage0_layer0_exp1" [shape=box, label="stage0_layer0_exp1\nGPU: 0\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp1";
"stage0_layer0_exp2" [shape=box, label="stage0_layer0_exp2\nGPU: 0\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp2";
"stage0_layer0_exp3" [shape=box, label="stage0_layer0_exp3\nGPU: 0\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp3";
"stage0_layer0_exp4" [shape=box, label="stage0_layer0_exp4\nGPU: 1\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp4";
"stage0_layer0_exp5" [shape=box, label="stage0_layer0_exp5\nGPU: 1\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp5";
"stage0_layer0_exp6" [shape=box, label="stage0_layer0_exp6\nGPU: 1\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp6";
"stage0_layer0_exp7" [shape=box, label="stage0_layer0_exp7\nGPU: 1\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp7";
"stage0_layer0_exp8" [shape=box, label="stage0_layer0_exp8\nGPU: 2\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp8";
"stage0_layer0_exp9" [shape=box, label="stage0_layer0_exp9\nGPU: 2\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp9";
"stage0_layer0_exp10" [shape=box, label="stage0_layer0_exp10\nGPU: 2\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp10";
"stage0_layer0_exp11" [shape=box, label="stage0_layer0_exp11\nGPU: 2\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp11";
"stage0_layer0_exp12" [shape=box, label="stage0_layer0_exp12\nGPU: 3\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp12";
"stage0_layer0_exp13" [shape=box, label="stage0_layer0_exp13\nGPU: 3\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp13";
"stage0_layer0_exp14" [shape=box, label="stage0_layer0_exp14\nGPU: 3\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp14";
"stage0_layer0_exp15" [shape=box, label="stage0_layer0_exp15\nGPU: 3\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp15";
"stage0_layer0_exp16" [shape=box, label="stage0_layer0_exp16\nGPU: 4\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp16";
"stage0_layer0_exp17" [shape=box, label="stage0_layer0_exp17\nGPU: 4\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp17";
"stage0_layer0_exp18" [shape=box, label="stage0_layer0_exp18\nGPU: 4\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp18";
"stage0_layer0_exp19" [shape=box, label="stage0_layer0_exp19\nGPU: 4\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp19";
"stage0_layer0_exp20" [shape=box, label="stage0_layer0_exp20\nGPU: 5\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp20";
"stage0_layer0_exp21" [shape=box, label="stage0_layer0_exp21\nGPU: 5\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp21";
"stage0_layer0_exp22" [shape=box, label="stage0_layer0_exp22\nGPU: 5\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp22";
"stage0_layer0_exp23" [shape=box, label="stage0_layer0_exp23\nGPU: 5\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp23";
"stage0_layer0_exp24" [shape=box, label="stage0_layer0_exp24\nGPU: 6\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp24";
"stage0_layer0_exp25" [shape=box, label="stage0_layer0_exp25\nGPU: 6\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp25";
"stage0_layer0_exp26" [shape=box, label="stage0_layer0_exp26\nGPU: 6\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp26";
"stage0_layer0_exp27" [shape=box, label="stage0_layer0_exp27\nGPU: 6\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp27";
"stage0_layer0_exp28" [shape=box, label="stage0_layer0_exp28\nGPU: 7\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp28";
"stage0_layer0_exp29" [shape=box, label="stage0_layer0_exp29\nGPU: 7\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp29";
"stage0_layer0_exp30" [shape=box, label="stage0_layer0_exp30\nGPU: 7\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp30";
"stage0_layer0_exp31" [shape=box, label="stage0_layer0_exp31\nGPU: 7\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_moe_gate" -> "stage0_layer0_exp31";
"stage0_layer0_moe_agg" [shape=box, label="stage0_layer0_moe_agg\nGPU: all_stage0\nIn: batch_size, seq_len=128, d_model=1024 (x4)\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_exp0" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp1" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp2" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp3" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp4" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp5" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp6" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp7" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp8" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp9" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp10" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp11" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp12" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp13" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp14" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp15" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp16" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp17" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp18" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp19" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp20" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp21" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp22" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp23" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp24" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp25" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp26" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp27" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp28" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp29" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp30" -> "stage0_layer0_moe_agg";
"stage0_layer0_exp31" -> "stage0_layer0_moe_agg";
"stage0_layer0_resid2" [shape=box, label="stage0_layer0_resid2\nGPU: all_stage0\nIn: batch_size, seq_len=128, d_model=1024 (x2)\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_resid1" -> "stage0_layer0_resid2";
"stage0_layer0_moe_agg" -> "stage0_layer0_resid2";
"stage0_layer0_send_stage1" [shape=ellipse, style=dashed, label="stage0_layer0_send_stage1\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_resid2" -> "stage0_layer0_send_stage1";
"stage1_layer0_recv" [shape=ellipse, style=dashed, label="stage1_layer0_recv\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage0_layer0_send_stage1" -> "stage1_layer0_recv";
"stage1_layer0_mha_qkv_tp0" [shape=box, label="stage1_layer0_mha_qkv_tp0\nGPU: 8\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, heads=16, d_k=64"];
"stage1_layer0_recv" -> "stage1_layer0_mha_qkv_tp0";
"stage1_layer0_mha_qkv_tp1" [shape=box, label="stage1_layer0_mha_qkv_tp1\nGPU: 9\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, heads=16, d_k=64"];
"stage1_layer0_recv" -> "stage1_layer0_mha_qkv_tp1";
"stage1_layer0_mha_qkv_tp2" [shape=box, label="stage1_layer0_mha_qkv_tp2\nGPU: 10\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, heads=16, d_k=64"];
"stage1_layer0_recv" -> "stage1_layer0_mha_qkv_tp2";
"stage1_layer0_mha_qkv_tp3" [shape=box, label="stage1_layer0_mha_qkv_tp3\nGPU: 11\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, heads=16, d_k=64"];
"stage1_layer0_recv" -> "stage1_layer0_mha_qkv_tp3";
"stage1_layer0_mha_qkv_tp4" [shape=box, label="stage1_layer0_mha_qkv_tp4\nGPU: 12\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, heads=16, d_k=64"];
"stage1_layer0_recv" -> "stage1_layer0_mha_qkv_tp4";
"stage1_layer0_mha_qkv_tp5" [shape=box, label="stage1_layer0_mha_qkv_tp5\nGPU: 13\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, heads=16, d_k=64"];
"stage1_layer0_recv" -> "stage1_layer0_mha_qkv_tp5";
"stage1_layer0_mha_qkv_tp6" [shape=box, label="stage1_layer0_mha_qkv_tp6\nGPU: 14\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, heads=16, d_k=64"];
"stage1_layer0_recv" -> "stage1_layer0_mha_qkv_tp6";
"stage1_layer0_mha_qkv_tp7" [shape=box, label="stage1_layer0_mha_qkv_tp7\nGPU: 15\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, heads=16, d_k=64"];
"stage1_layer0_recv" -> "stage1_layer0_mha_qkv_tp7";
"stage1_layer0_ag_qkv" [shape=ellipse, style=dashed, label="stage1_layer0_ag_qkv\nIn: shard\nOut: full"];
"stage1_layer0_mha_qkv_tp0" -> "stage1_layer0_ag_qkv";
"stage1_layer0_mha_qkv_tp1" -> "stage1_layer0_ag_qkv";
"stage1_layer0_mha_qkv_tp2" -> "stage1_layer0_ag_qkv";
"stage1_layer0_mha_qkv_tp3" -> "stage1_layer0_ag_qkv";
"stage1_layer0_mha_qkv_tp4" -> "stage1_layer0_ag_qkv";
"stage1_layer0_mha_qkv_tp5" -> "stage1_layer0_ag_qkv";
"stage1_layer0_mha_qkv_tp6" -> "stage1_layer0_ag_qkv";
"stage1_layer0_mha_qkv_tp7" -> "stage1_layer0_ag_qkv";
"stage1_layer0_mha_score" [shape=box, label="stage1_layer0_mha_score\nGPU: all_stage1\nIn: full\nOut: batch_size, heads=16, seq_len=128, seq_len=128"];
"stage1_layer0_ag_qkv" -> "stage1_layer0_mha_score";
"stage1_layer0_mha_softmax" [shape=box, label="stage1_layer0_mha_softmax\nGPU: all_stage1\nIn: batch_size, heads=16, seq_len=128, seq_len=128\nOut: batch_size, heads=16, seq_len=128, seq_len=128"];
"stage1_layer0_mha_score" -> "stage1_layer0_mha_softmax";
"stage1_layer0_mha_out_tp0" [shape=box, label="stage1_layer0_mha_out_tp0\nGPU: 8\nIn: full\nOut: batch_size, seq_len=128, d_model=1024//8"];
"stage1_layer0_mha_softmax" -> "stage1_layer0_mha_out_tp0";
"stage1_layer0_mha_out_tp1" [shape=box, label="stage1_layer0_mha_out_tp1\nGPU: 9\nIn: full\nOut: batch_size, seq_len=128, d_model=1024//8"];
"stage1_layer0_mha_softmax" -> "stage1_layer0_mha_out_tp1";
"stage1_layer0_mha_out_tp2" [shape=box, label="stage1_layer0_mha_out_tp2\nGPU: 10\nIn: full\nOut: batch_size, seq_len=128, d_model=1024//8"];
"stage1_layer0_mha_softmax" -> "stage1_layer0_mha_out_tp2";
"stage1_layer0_mha_out_tp3" [shape=box, label="stage1_layer0_mha_out_tp3\nGPU: 11\nIn: full\nOut: batch_size, seq_len=128, d_model=1024//8"];
"stage1_layer0_mha_softmax" -> "stage1_layer0_mha_out_tp3";
"stage1_layer0_mha_out_tp4" [shape=box, label="stage1_layer0_mha_out_tp4\nGPU: 12\nIn: full\nOut: batch_size, seq_len=128, d_model=1024//8"];
"stage1_layer0_mha_softmax" -> "stage1_layer0_mha_out_tp4";
"stage1_layer0_mha_out_tp5" [shape=box, label="stage1_layer0_mha_out_tp5\nGPU: 13\nIn: full\nOut: batch_size, seq_len=128, d_model=1024//8"];
"stage1_layer0_mha_softmax" -> "stage1_layer0_mha_out_tp5";
"stage1_layer0_mha_out_tp6" [shape=box, label="stage1_layer0_mha_out_tp6\nGPU: 14\nIn: full\nOut: batch_size, seq_len=128, d_model=1024//8"];
"stage1_layer0_mha_softmax" -> "stage1_layer0_mha_out_tp6";
"stage1_layer0_mha_out_tp7" [shape=box, label="stage1_layer0_mha_out_tp7\nGPU: 15\nIn: full\nOut: batch_size, seq_len=128, d_model=1024//8"];
"stage1_layer0_mha_softmax" -> "stage1_layer0_mha_out_tp7";
"stage1_layer0_ar_mha" [shape=ellipse, style=dashed, label="stage1_layer0_ar_mha\nIn: shard\nOut: full"];
"stage1_layer0_mha_out_tp0" -> "stage1_layer0_ar_mha";
"stage1_layer0_mha_out_tp1" -> "stage1_layer0_ar_mha";
"stage1_layer0_mha_out_tp2" -> "stage1_layer0_ar_mha";
"stage1_layer0_mha_out_tp3" -> "stage1_layer0_ar_mha";
"stage1_layer0_mha_out_tp4" -> "stage1_layer0_ar_mha";
"stage1_layer0_mha_out_tp5" -> "stage1_layer0_ar_mha";
"stage1_layer0_mha_out_tp6" -> "stage1_layer0_ar_mha";
"stage1_layer0_mha_out_tp7" -> "stage1_layer0_ar_mha";
"stage1_layer0_resid1" [shape=box, label="stage1_layer0_resid1\nGPU: all_stage1\nIn: x2\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_recv" -> "stage1_layer0_resid1";
"stage1_layer0_ar_mha" -> "stage1_layer0_resid1";
"stage1_layer0_moe_gate" [shape=box, label="stage1_layer0_moe_gate\nGPU: all_stage1\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, 64"];
"stage1_layer0_resid1" -> "stage1_layer0_moe_gate";
"stage1_layer0_exp32" [shape=box, label="stage1_layer0_exp32\nGPU: 8\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp32";
"stage1_layer0_exp33" [shape=box, label="stage1_layer0_exp33\nGPU: 8\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp33";
"stage1_layer0_exp34" [shape=box, label="stage1_layer0_exp34\nGPU: 8\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp34";
"stage1_layer0_exp35" [shape=box, label="stage1_layer0_exp35\nGPU: 8\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp35";
"stage1_layer0_exp36" [shape=box, label="stage1_layer0_exp36\nGPU: 9\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp36";
"stage1_layer0_exp37" [shape=box, label="stage1_layer0_exp37\nGPU: 9\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp37";
"stage1_layer0_exp38" [shape=box, label="stage1_layer0_exp38\nGPU: 9\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp38";
"stage1_layer0_exp39" [shape=box, label="stage1_layer0_exp39\nGPU: 9\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp39";
"stage1_layer0_exp40" [shape=box, label="stage1_layer0_exp40\nGPU: 10\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp40";
"stage1_layer0_exp41" [shape=box, label="stage1_layer0_exp41\nGPU: 10\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp41";
"stage1_layer0_exp42" [shape=box, label="stage1_layer0_exp42\nGPU: 10\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp42";
"stage1_layer0_exp43" [shape=box, label="stage1_layer0_exp43\nGPU: 10\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp43";
"stage1_layer0_exp44" [shape=box, label="stage1_layer0_exp44\nGPU: 11\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp44";
"stage1_layer0_exp45" [shape=box, label="stage1_layer0_exp45\nGPU: 11\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp45";
"stage1_layer0_exp46" [shape=box, label="stage1_layer0_exp46\nGPU: 11\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp46";
"stage1_layer0_exp47" [shape=box, label="stage1_layer0_exp47\nGPU: 11\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp47";
"stage1_layer0_exp48" [shape=box, label="stage1_layer0_exp48\nGPU: 12\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp48";
"stage1_layer0_exp49" [shape=box, label="stage1_layer0_exp49\nGPU: 12\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp49";
"stage1_layer0_exp50" [shape=box, label="stage1_layer0_exp50\nGPU: 12\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp50";
"stage1_layer0_exp51" [shape=box, label="stage1_layer0_exp51\nGPU: 12\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp51";
"stage1_layer0_exp52" [shape=box, label="stage1_layer0_exp52\nGPU: 13\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp52";
"stage1_layer0_exp53" [shape=box, label="stage1_layer0_exp53\nGPU: 13\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp53";
"stage1_layer0_exp54" [shape=box, label="stage1_layer0_exp54\nGPU: 13\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp54";
"stage1_layer0_exp55" [shape=box, label="stage1_layer0_exp55\nGPU: 13\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp55";
"stage1_layer0_exp56" [shape=box, label="stage1_layer0_exp56\nGPU: 14\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp56";
"stage1_layer0_exp57" [shape=box, label="stage1_layer0_exp57\nGPU: 14\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp57";
"stage1_layer0_exp58" [shape=box, label="stage1_layer0_exp58\nGPU: 14\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp58";
"stage1_layer0_exp59" [shape=box, label="stage1_layer0_exp59\nGPU: 14\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp59";
"stage1_layer0_exp60" [shape=box, label="stage1_layer0_exp60\nGPU: 15\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp60";
"stage1_layer0_exp61" [shape=box, label="stage1_layer0_exp61\nGPU: 15\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp61";
"stage1_layer0_exp62" [shape=box, label="stage1_layer0_exp62\nGPU: 15\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp62";
"stage1_layer0_exp63" [shape=box, label="stage1_layer0_exp63\nGPU: 15\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_moe_gate" -> "stage1_layer0_exp63";
"stage1_layer0_moe_agg" [shape=box, label="stage1_layer0_moe_agg\nGPU: all_stage1\nIn: x4\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_exp32" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp33" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp34" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp35" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp36" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp37" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp38" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp39" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp40" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp41" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp42" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp43" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp44" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp45" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp46" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp47" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp48" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp49" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp50" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp51" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp52" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp53" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp54" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp55" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp56" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp57" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp58" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp59" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp60" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp61" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp62" -> "stage1_layer0_moe_agg";
"stage1_layer0_exp63" -> "stage1_layer0_moe_agg";
"stage1_layer0_resid2" [shape=box, label="stage1_layer0_resid2\nGPU: all_stage1\nIn: x2\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_resid1" -> "stage1_layer0_resid2";
"stage1_layer0_moe_agg" -> "stage1_layer0_resid2";
"OUTPUT" [shape=box, label="OUTPUT\nGPU: all\nIn: batch_size, seq_len=128, d_model=1024\nOut: batch_size, seq_len=128, d_model=1024"];
"stage1_layer0_resid2" -> "OUTPUT";
}